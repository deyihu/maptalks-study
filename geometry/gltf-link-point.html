<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>User Interactions - Draw tool to draw geometries</title>
<style type="text/css">
    html,
    body {
        margin: 0px;
        height: 100%;
        width: 100%
    }

    .container {
        width: 100%;
        height: 100%;
        background-color: black;
    }
</style>
<link rel='stylesheet' href='./../assets/lib/maptalks/maptalks.css' />

<script type='text/javascript' src='./../assets/lib/maptalks/maptalks-gl.js'></script>
<script type='text/javascript' src='./../assets/lib/lil-gui.min.js'></script>

<body>

    <div id="map" class="container"></div>

    <script>

        var map = new maptalks.Map('map', {
            center: [116.33607780651141, 39.89606849343474],
            zoom: 18,
            pitch: 60,

        });

        const tileLayer = new maptalks.TileLayer('base', {
            urlTemplate: "https://webrd01.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}",
            subdomains: ["a", "b", "c", "d"],
        })
        const layer = new maptalks.GLTFLayer('layer');
        const layer1 = new maptalks.PointLayer('layer1');

        const groupLayer = new maptalks.GroupGLLayer('group', [tileLayer, layer, layer1]).addTo(map);

        const center = map.getCenter().toArray();
        const model = new maptalks.GLTFMarker(center, {
            symbol: {
                url: "./../assets/data/alien.gltf",
                modelHeight: 50, //model height,Unit is meters
                scaleX: 1,
                scaleY: 1,
                scaleZ: 1,
                // rotationZ: 180
            }
        });
        model.addTo(layer);

        let point;
        function syncPoint() {
            const coordinates = model.getCoordinates()
            const altitude = coordinates.z || 0;
            const symbol = model.getSymbol();
            const modelHeight = symbol.modelHeight;
            const scaleZ = symbol.scaleZ;

            const alt = altitude + (modelHeight * scaleZ);

            const c = coordinates.copy();
            c.z = alt;
            if (!point) {
                point = new maptalks.Marker(c, {
                    symbol: {
                        markerFile: './../assets/icon/钻石.png'
                    }
                }).addTo(layer1);
            } else {
                point.setCoordinates(c);
            }

        }

        syncPoint();

        model.on('positionchange shapechange symbolchange', (e) => {
            // console.log(e);
            syncPoint();
        });

        const [x, y] = center;
        let angle = 0;
        const radius = 0.001;
        function animation() {
            angle += 0.1;
            const rad = angle / Math.PI;
            const tx = Math.cos(rad) * radius + x;
            const ty = Math.sin(rad) * radius + y;
            model.setCoordinates(new maptalks.Coordinate(tx, ty));
            requestAnimationFrame(animation);
        }

        animation();



        const symbol = model.getSymbol();
        var params = {
            modelHeight: symbol.modelHeight,
            scaleZ: symbol.scaleZ,
            scaleX: symbol.scaleX,
            scaleY: symbol.scaleY,


        };
        var gui = new lil.GUI({ width: 250 });
        gui.add(params, 'modelHeight', 1, 100).onChange(() => {
            model.updateSymbol({ ...params })
        })
        gui.add(params, 'scaleZ', 1, 5).onChange(() => {
            model.updateSymbol({ ...params })
        })
        gui.add(params, 'scaleX', 1, 5).onChange(() => {
            model.updateSymbol({ ...params })
        })
        gui.add(params, 'scaleY', 1, 5).onChange(() => {
            model.updateSymbol({ ...params })
        })



    </script>
</body>

</html>