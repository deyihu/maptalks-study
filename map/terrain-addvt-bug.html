<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<head>
    <title>添加一个矢量瓦片图层</title>
    <style type="text/css">
        html,
        body {
            width: 100%;
            height: 100%;
            margin: 0px;
        }

        .container {
            width: 100%;
            height: 100%;
        }
    </style>
    <link rel="stylesheet" href="./../assets/lib/maptalks/maptalks.css" />
    <!-- <script type="text/javascript" src="./../assets/lib/maptalks/maptalks-gl.js"></script> -->
    <script type="text/javascript" src="./../assets/lib/maptalks/maptalks-gl.js"></script>
    <script type="text/javascript" src="./../assets/lib/lil-gui.min.js"></script>
    <script type="text/javascript" src="./../assets/lib/maptalks.tileclip.js"></script>
</head>

<body>
    <div id="map" class="container"></div>

    <script>


        const tileActor = maptalks.getTileActor();

        const map = new maptalks.Map("map", {
            // "center": [119.09557457, 30.14442343, 339.73126220703125], "zoom": 11.856275713521464, "pitch": 61.80000000000011, "bearing": -64.07337236948052,
            "center": [108.95986733, 34.21997952, 430.3062438964844], "zoom": 12.698416480987284, "pitch": 0, "bearing": 1.8437368186266667,
            // cameraInfiniteFar: true,
            // heightFactor: 4.2,
            zoomControl: true,
            // baseLayer: new maptalks.TileLayer('base', {
            //     urlTemplate: "https://webrd01.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}",
            //     subdomains: ["a", "b", "c", "d"],
            // })
        });


        const sceneConfig = {
            postProcess: {
                enable: true,
                antialias: {
                    enable: true,
                },
            },
        };


        const baseLayer = new maptalks.TileLayer('base', {
            // debug: true,
            urlTemplate: "https://webst01.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}",
            subdomains: ["a", "b", "c", "d"],
            zIndex: -1
            // bufferPixel: 1
        })

        const colors = [[0, "rgb(246,251,255)"], [369, "rgb(224,234,244)"], [738, "rgb(198,219,240)"], [1107, "rgb(157,202,225)"], [1476, "rgb(106,175,214)"], [1845, "rgb(66,146,197)"], [2214, "rgb(33,114,180)"], [2583, "rgb(11,80,157)"], [2952, "rgb(5,49,112)"], [3322, "rgb(5,49,112)"]]

        const terrain = {
            type: 'mapbox',
            //强制指定tileSize
            // tileSize: 256,
            maxAvailableZoom: 14,

            requireSkuToken: false,
            urlTemplate: "https://elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer/tile/{z}/{y}/{x}",
            subdomains: ['a', 'b', 'c', 'd'],
            // colors: colors,
            exaggeration: 1,
        };
        const group = new maptalks.GroupGLLayer('group', [baseLayer], {
            terrain
        });

        map.setView({
            center: [110.33486361, 31.05559996],
            zoom: 11,
        })
        group.on('terrainlayercreated', e => {
            const terrainLayer = group.getTerrainLayer();

            terrainLayer.getRenderer().loadTileBitmap = function (url, tile, callback, options) {
                // console.log(url);
                tileActor.encodeTerrainTile({
                    url: maptalks.Util.getAbsoluteURL(url),
                    terrainType: 'arcgis',
                    // timeout: 5000
                }).then(imagebitmap => {
                    callback(null, imagebitmap)


                }).catch(error => {
                    //do some things
                    console.error(error);
                })
            };
        })
        group.addTo(map);

        function addLine(glLayer) {
            const style = {
                renderPlugin: {
                    dataConfig: {
                        type: 'line',
                    },
                    sceneConfig: {},
                    type: 'line',
                },
                symbol: {
                    lineColor: '#409EFE',
                    lineOpacity: 1,
                    lineWidth: 2,
                },
            }

            const geojson = {
                type: 'FeatureCollection',
                features: [
                    {
                        "type": "Feature",
                        "geometry": {
                            "type": "LineString",
                            "coordinates": [
                                [
                                    110.3325125186147,
                                    31.062482110369924,
                                    366.89221416107915
                                ],
                                [
                                    110.33233770674933,
                                    31.06242107780248,
                                    362.27988516704556
                                ],
                                [
                                    110.33055426937045,
                                    31.06203109422133,
                                    313.1755810960361
                                ],
                                [
                                    110.32954104559512,
                                    31.061891481409212,
                                    284.36059065313617
                                ],
                                [
                                    110.32925509655979,
                                    31.061901022759145,
                                    277.14026035138437
                                ],
                                [
                                    110.32922673178254,
                                    31.061756635885242,
                                    275.89789591876905
                                ],
                                [
                                    110.32917205182639,
                                    31.061124216248196,
                                    266.90244579018025
                                ],
                                [
                                    110.32913839515196,
                                    31.060844173857546,
                                    260.237543518508
                                ],
                                [
                                    110.32930013416254,
                                    31.06030206731321,
                                    258.04543804834384
                                ],
                                [
                                    110.32956322405641,
                                    31.059594022569826,
                                    261.5231338149004
                                ],
                                [
                                    110.33017795527101,
                                    31.05815264112753,
                                    283.6232380824245
                                ],
                                [
                                    110.3305076245122,
                                    31.057879020059005,
                                    281.21735749712934
                                ],
                                [
                                    110.3310519163978,
                                    31.057964080938365,
                                    275.30784369300284
                                ],
                                [
                                    110.33175977631616,
                                    31.05807539312144,
                                    276.5919588625558
                                ],
                                [
                                    110.33316975087696,
                                    31.058261732811626,
                                    280.8905395463028
                                ],
                                [
                                    110.3344355203082,
                                    31.058378955427152,
                                    277.8156420189172
                                ],
                                [
                                    110.33616186884427,
                                    31.05881703304915,
                                    262.76466427461804
                                ],
                                [
                                    110.33732798386019,
                                    31.058885700946718,
                                    251.1372702089461
                                ],
                                [
                                    110.3377329324965,
                                    31.058692520413217,
                                    242.53340267558264
                                ],
                                [
                                    110.33782132605315,
                                    31.058324654967393,
                                    229.22648457902025
                                ],
                                [
                                    110.33752249527582,
                                    31.057640577517187,
                                    206.0342244886954
                                ],
                                [
                                    110.33697006580746,
                                    31.05705480206552,
                                    192.52534692691287
                                ],
                                [
                                    110.3357831434222,
                                    31.056582007213088,
                                    189.227285213768
                                ],
                                [
                                    110.33437011297393,
                                    31.05636987813486,
                                    198.05247842457462
                                ],
                                [
                                    110.3323533083972,
                                    31.056269522541324,
                                    211.46034115482232
                                ],
                                [
                                    110.33046202785984,
                                    31.05634554537442,
                                    224.03729495817313
                                ],
                                [
                                    110.32965498704816,
                                    31.056181898289466,
                                    226.1659385888328
                                ],
                                [
                                    110.32932466256575,
                                    31.055965485775634,
                                    218.86335303906867
                                ],
                                [
                                    110.3292313462886,
                                    31.05561928078192,
                                    208.44226533495083
                                ],
                                [
                                    110.32927369838359,
                                    31.055200294062285,
                                    192.42799938471163
                                ],
                                [
                                    110.3294662659005,
                                    31.05485259878255,
                                    175.30096050816536
                                ],
                                [
                                    110.32972664688273,
                                    31.054581104838714,
                                    160.46418581287628
                                ],
                                [
                                    110.33014064802995,
                                    31.054356332354352,
                                    147.30910228027207
                                ],
                                [
                                    110.33083501631056,
                                    31.054146326347183,
                                    137.58101530692272
                                ],
                                [
                                    110.33218334002522,
                                    31.05418306561772,
                                    127.28850200694873
                                ],
                                [
                                    110.33331242475192,
                                    31.054319682427504,
                                    121.09541094209668
                                ],
                                [
                                    110.33503245325859,
                                    31.054563986227087,
                                    112.5761597622773
                                ],
                                [
                                    110.33650550119374,
                                    31.05464554233452,
                                    109.75730215810103
                                ],
                                [
                                    110.33771577981375,
                                    31.054484598006642,
                                    105.00363223308366
                                ],
                                [
                                    110.33826010630821,
                                    31.054119488964307,
                                    90.36991750079743
                                ],
                                [
                                    110.33831075574693,
                                    31.053803490190397,
                                    79.48675491522287
                                ],
                                [
                                    110.3381198997534,
                                    31.053503698161865,
                                    70.14912665381492
                                ],
                                [
                                    110.33756680080658,
                                    31.05314733872554,
                                    63.052647685043446
                                ],
                                [
                                    110.33659953416016,
                                    31.052917104872133,
                                    62.26597920867326
                                ],
                                [
                                    110.33525975415687,
                                    31.0528530297942,
                                    62.55232367121506
                                ],
                                [
                                    110.33317841354207,
                                    31.05284599131137,
                                    63.0287071263566
                                ],
                                [
                                    110.33170838302513,
                                    31.052676634242626,
                                    66.46915959169216
                                ],
                                [
                                    110.33069193048674,
                                    31.0523139100322,
                                    65.39816791520825
                                ],
                                [
                                    110.33037280878355,
                                    31.052021905609692,
                                    62.000815680246475
                                ],
                                [
                                    110.330387179509,
                                    31.051607815193385,
                                    62.000815680246475
                                ],
                                [
                                    110.33057527883918,
                                    31.051049488068916,
                                    62.000815680246475
                                ],
                                [
                                    110.33093280712663,
                                    31.05041537985712,
                                    62.000815680246475
                                ],
                                [
                                    110.33155201690577,
                                    31.049812195738202,
                                    62.000815680246475
                                ],
                                [
                                    110.33206783900592,
                                    31.049578557880345,
                                    62.0432160231089
                                ],
                                [
                                    110.33398199905606,
                                    31.047578246284946,
                                    201.587267807422
                                ],
                                [
                                    110.33530334495273,
                                    31.046897297880495,
                                    243.74540359267982
                                ],
                                [
                                    110.33674767034073,
                                    31.04675312688015,
                                    243.14007490996346
                                ],
                                [
                                    110.33789782976179,
                                    31.047361188184592,
                                    184.7691377487079
                                ],
                                [
                                    110.33863523303067,
                                    31.04710739051096,
                                    203.17057971454867
                                ]
                            ]
                        },
                        "properties": null
                    }
                ],
            }

            const layer = new maptalks.GeoJSONVectorTileLayer('contourLine', {
                data: geojson,
                style,
                // awareOfTerrain: false,
            })
            layer.addTo(group)

        }

        addLine();






    </script>
</body>

</html>