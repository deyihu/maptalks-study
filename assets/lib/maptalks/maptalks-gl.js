/**
 * Skipped minification because the original files appears to be already minified.
 * Original file: /npm/maptalks-gl@0.103.1/dist/maptalks-gl.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
/*!
 * maptalks-gl v0.103.1
 * LICENSE : MIT
 * (c) 2016-2024 maptalks.com
 */
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).maptalks=e.maptalks||{})}(this,(function(e){"use strict";
/*!
   * maptalks v1.0.0-rc.40
   * LICENSE : BSD-3-Clause
   * (c) 2016-2024 maptalks.org
   */var n="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0)&&!process.versions.electron&&!process.versions.nw&&!process.versions["node-webkit"];function i(){return"undefined"!=typeof globalThis?globalThis:global||self}var o={isTest:!1,idleLog:!1,idleForceTimeThreshold:48,workerCount:i().MAPTALKS_WORKER_COUNT||0,messagePostRatioPerWorker:.3,maxFPS:0};function s(){return Date.now()}function a(e,...n){for(var i=0;i<n.length;i++){var o=n[i];for(var s in o)e[s]=o[s]}return e}function h(e){return null==e}function l(e){return"number"==typeof e&&!isNaN(e)}function c(e){return(0|e)===e}function A(e){return"object"==typeof e&&!!e}function f(e){return!h(e)&&("string"==typeof e||null!==e.constructor&&e.constructor===String)}function d(e){return!h(e)&&("function"==typeof e||null!==e.constructor&&e.constructor===Function)}var p=Object.prototype.hasOwnProperty;function g(e,n){return p.call(e,n)}var v=Math.PI/180;function w(e){return e*v}function C(e){return e/v}var P={};function T(){return window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI}if(!n){var S=navigator.userAgent.toLowerCase(),I=document.documentElement||{style:{}},E="ActiveXObject"in window,O=-1!==S.indexOf("webkit"),k=-1!==S.indexOf("phantom"),L=-1!==S.search("android [23]"),F=-1!==S.indexOf("chrome"),N=-1!==S.indexOf("gecko")&&!O&&!window.opera&&!E,z=/iphone/i.test(S)&&/micromessenger/i.test(S),H="undefined"!=typeof orientation||-1!==S.indexOf("mobile"),j=!window.PointerEvent&&window.MSPointerEvent,W=window.PointerEvent&&navigator.pointerEnabled||j,q=E&&"transition"in I.style,Y="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!L,J="MozPerspective"in I.style,$="OTransition"in I.style,it=(q||Y||J)&&!$&&!k,rt="undefined"!=typeof window&&d(window.createImageBitmap),ot="undefined"!=typeof window&&d(window.ResizeObserver),st="undefined"!=typeof window&&d(window.btoa),at="undefined"!=typeof window&&d(window.Proxy),ht="undefined"!=typeof window&&d(window.requestIdleCallback),At=0;F&&(At=S.match(/chrome\/([\d.]+)/)[1]);var ft=!k&&(W||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch),gt="undefined"!=typeof window&&"WebGLRenderingContext"in window,vt=T(),_t=!1;try{new OffscreenCanvas(2,2).getContext("2d"),_t=!0}catch(e){_t=!1}var xt=!1;try{window.addEventListener("testPassive",(function(){}),{get passive(){return xt=!0,!0}})}catch(Hst){}P={IS_NODE:n,isTest:!1,ie:E,ielt9:E&&!document.addEventListener,edge:"msLaunchUri"in navigator&&!("documentMode"in document),webkit:O,gecko:N,android:-1!==S.indexOf("android"),android23:L,chrome:F,chromeVersion:At,safari:!F&&-1!==S.indexOf("safari"),phantomjs:k,ie3d:q,webkit3d:Y,gecko3d:J,opera12:$,any3d:it,iosWeixin:z,mobile:H,mobileWebkit:H&&O,mobileWebkit3d:H&&Y,mobileOpera:H&&window.opera,mobileGecko:H&&N,touch:!!ft,msPointer:!!j,pointer:!!W,retina:vt>1,devicePixelRatio:vt,language:navigator.browserLanguage?navigator.browserLanguage:navigator.language,ie9:E&&9===document.documentMode,ie10:E&&10===document.documentMode,webgl:gt,imageBitMap:rt,resizeObserver:ot,btoa:st,decodeImageInWorker:_t,monitorDPRChange:!0,supportsPassive:xt,proxy:at,requestIdleCallback:ht,checkDevicePixelRatio:function(){if("undefined"!=typeof window&&P.monitorDPRChange){var e=T(),n=e!==P.devicePixelRatio;return n&&(P.devicePixelRatio=e),n}return!1}}}var wt=P;function Ct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Ct=function(){return!!e})()}function Ot(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var o=i.call(e,n);if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof n?n:n+""}function Dt(e,n,i){return n&&function(e,n){for(var i=0;i<n.length;i++){var o=n[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Ot(o.key),o)}}(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function kt(e,n){e.prototype=Object.create(n.prototype),e.prototype.constructor=e,Bt(e,n)}function Nt(e){return Nt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Nt(e)}function Bt(e,n){return Bt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,n){return e.__proto__=n,e},Bt(e,n)}function Ht(e){var n="function"==typeof Map?new Map:void 0;return Ht=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(n){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,i)}function i(){return function(e,n,i){if(Ct())return Reflect.construct.apply(null,arguments);var o=[null];o.push.apply(o,n);var s=new(e.bind.apply(e,o));return i&&Bt(s,i.prototype),s}(e,arguments,Nt(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Bt(i,e)},Ht(e)}function Ut(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Wt(e,n){(null==n||n>e.length)&&(n=e.length);for(var i=0,o=new Array(n);i<n;i++)o[i]=e[i];return o}function Xt(e,n){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=function(e,n){if(e){if("string"==typeof e)return Wt(e,n);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Wt(e,n):void 0}}(e))||n){i&&(e=i);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var Kt,$t,te=function(){function e(e,n,i){if(h(e)||h(n)?h(e.x)||h(e.y)?Array.isArray(e)&&(this.x=+e[0],this.y=+e[1],this.z=e[2]):(this.x=+e.x,this.y=+e.y,this.z=e.z):(this.x=+e,this.y=+n,this.z=i),this._isNaN())throw new Error("Position is NaN")}var n=e.prototype;return n.set=function(e,n,i){return this.x=e,this.y=n,this.z=i||0,this},n._abs=function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this},n._round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},n._ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},n.distanceTo=function(e){var n=e.x-this.x,i=e.y-this.y;return Math.sqrt(n*n+i*i)},n.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},n._floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},n._add=function(e,n){return h(e.x)?h(e[0])?(this.x+=e,this.y+=n):(this.x+=e[0],this.y+=e[1]):(this.x+=e.x,this.y+=e.y),this},n._sub=function(e,n){return h(e.x)?h(e[0])?(this.x-=e,this.y-=n):(this.x-=e[0],this.y-=e[1]):(this.x-=e.x,this.y-=e.y),this},n._substract=function(e,n){return l(n)?this._sub(e,n):this._sub(e)},n.substract=function(e,n){return this.sub(e,n)},n._multi=function(e){return this.x*=e,this.y*=e,this},n.div=function(e){return this.multi(1/e)},n._div=function(e){return this._multi(1/e)},n._isNaN=function(){return isNaN(this.x)||isNaN(this.y)||l(this.z)&&isNaN(this.z)},n.isZero=function(){return 0===this.x&&0===this.y},n.toArray=function(){return l(this.z)?[this.x,this.y,this.z]:[this.x,this.y]},n.toJSON=function(){var e={x:this.x,y:this.y};return l(this.z)&&(e.z=this.z),e},e}(),ee=function(e){function n(){return e.apply(this,arguments)||this}kt(n,e);var i=n.prototype;return i.closeTo=function(e,n){return n||(n=0),this.x>=e.x-n&&this.x<=e.x+n&&this.y>=e.y-n&&this.y<=e.y+n},i.unit=function(){return this.copy()._unit()},i._unit=function(){return this._div(this.mag()),this},i.perp=function(){return this.copy()._perp()},i._perp=function(){return[this.x,this.y]=[-this.y,this.x],this},i.angleWith=function(e){return this.angleWithSep(e.x,e.y)},i.angleWithSep=function(e,n){return Math.atan2(this.x*n-this.y*e,this.x*e+this.y*n)},i._rotate=function(e){var n=Math.cos(e),i=Math.sin(e),o=i*this.x+n*this.y;return this.x=n*this.x-i*this.y,this.y=o,this},i.rotate=function(e){return this.copy()._rotate(e)},i.abs=function(){return new n(Math.abs(this.x),Math.abs(this.y))},i.round=function(){return new n(Math.round(this.x),Math.round(this.y))},i.ceil=function(){return new n(Math.ceil(this.x),Math.ceil(this.y))},i.floor=function(){return new n(Math.floor(this.x),Math.floor(this.y))},i.copy=function(){return new n(this.x,this.y,this.z)},i.toFixed=function(e){return new n(this.x.toFixed(e),this.y.toFixed(e),l(this.z)?this.z.toFixed(e):void 0)},i.add=function(e,i){var o,s;return h(e.x)?h(e[0])?(o=this.x+e,s=this.y+i):(o=this.x+e[0],s=this.y+e[1]):(o=this.x+e.x,s=this.y+e.y),new n(o,s)},i.sub=function(e,i){var o,s;return h(e.x)?h(e[0])?(o=this.x-e,s=this.y-i):(o=this.x-e[0],s=this.y-e[1]):(o=this.x-e.x,s=this.y-e.y),new n(o,s)},i.multi=function(e){return new n(this.x*e,this.y*e)},i.equals=function(e){return e instanceof this.constructor&&(this.x===e.x&&this.y===e.y&&this.z===e.z)},n}(te);function ne(e){var n="data:image/svg+xml";return e.length>4&&".svg"===e.slice(-4)?1:e.slice(0,18)===n?2:0}function ie(e,i){n&&ie.node?ie.node(e,i):e.src=i[0]}!function(){if(n)return Kt=function(e){return setTimeout(e,16)},void($t=clearTimeout);var e,i,o=1e3/30;function s(e){return setTimeout(e,o)}function a(e){return window["webkit"+e]||window["moz"+e]||window["ms"+e]}"undefined"!=typeof window?(e=window.requestAnimationFrame||a("RequestAnimationFrame")||s,i=window.cancelAnimationFrame||a("CancelAnimationFrame")||a("CancelRequestAnimationFrame")||function(e){window.clearTimeout(e)}):(e=s,i=clearTimeout),Kt=function(n){return e(n)},$t=function(e){e&&i(e)}}();var re=0;function oe(){return re++}var se=oe;function ae(e){return e&&f(e)?JSON.parse(e):e}function he(...e){for(var n=e[0],i=1;i<e.length;i++){var o=e[i];if(o&&o.length)for(var s=0,a=o.length;s<a;s++)n.push(o[s])}return n.length}function le(e,n){var i=n.indexOf(e);i>-1&&n.splice(i,1)}function ue(e,n,i){if(!Array.isArray(e))return i?n.call(i,e):n(e);for(var o,s,a=[],l=0,c=e.length;l<c;l++)h(o=e[l])?a.push(null):Array.isArray(o)?a.push(ue(o,n,i)):(s=i?n.call(i,o):n(o),a.push(s));return a}function ce(e,n){return void 0===e?n:e}function Ae(e){return Math.sign?Math.sign(e):0===(e=+e)||isNaN(e)?Number(e):e>0?1:-1}function fe(e,n,i){return e*(1-i)+n*i}function pe(e,n,i){if(e===i||e===n)return e;var o=i-n;return((e-n)%o+o)%o+n}function _e(e,n,i){return Math.min(i,Math.max(n,e))}function xe(e){return Array.isArray(e)&&e.length>0}var be=/^([a-z][a-z\d+\-.]*:)?\/\//i;function we(e){return be.test(e)}var ke=/^url\((['"])(.+)\1\)$/i,Ne=/^url\(([^'"].*[^'"])\)$/i;function je(e){return f(e)?Ne.test(e)?1:ke.test(e)?2:3:0}function Ge(e){var n=je(e);return 3===n?e:1===n?Ne.exec(e)[1]:2===n?ke.exec(e)[2]:e}var qe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Ze(e){if(wt.btoa)return window.btoa(e);for(var n,i,o=String(e),s="",a=0,h=qe;o.charAt(0|a)||(h="=",a%1);s+=h.charAt(63&n>>8-a%1*8)){if((i=o.charCodeAt(a+=3/4))>255)throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");n=n<<8|i}return s}function Ye(e,n){for(var i=atob(e),o=new ArrayBuffer(i.length),s=new Uint8Array(o),a=0;a<i.length;a++)s[a]=255&i.charCodeAt(a);return new Blob([o],{type:n})}function Je(e,n,i,o){return Math.atan2(o-n,i-e)}var Ke="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";function $e(e,n){if(!e&&!n)return!0;if(!e||!n)return!1;for(var i in e)if("center"===i){if(!n[i]||!tn(e[i][0],n[i][0])||!tn(e[i][1],n[i][1]))return!1}else if(e[i]!==n[i])return!1;return!0}function tn(e,n,i){return null==i&&(i=1e-6),e>=n-i&&e<=n+i}function en(e=100,n=4,i=null,o=null){e||(e=100),n||(n=4);var s=this,a=this.isVisible();return n*=2,this._flashTimeout&&clearTimeout(this._flashTimeout),this._flashTimeout=setTimeout((function h(){if(0===n)return a?s.show():s.hide(),void(i&&(o?i.call(o):i()));n%2==0?s.hide():s.show(),n--,s._flashTimeout=setTimeout(h,e)}),e),this}function on(e=[],n="_pt"){for(var i=[],o=0,s=e.length;o<s;o++){var a=e[o];if(a){a[n]||(a[n]=new ee(0,0));var h=a[n];h.x=0,h.y=0,i.push(h)}else i.push(null)}return i}function sn(e,n){n(e.data)}function an(e){if(e&&0===e.indexOf("http://")||0===e.indexOf("https://"))return e;var n=document.createElement("a");return n.href=e,e=n.href,n=null,e}var hn={cssWidth:"1px",cssHeight:"1px",width:1,height:1};function cn(e,n=1){var{width:i,height:o}=e;return hn.cssWidth=i+"px",hn.cssHeight=o+"px",hn.width=Math.round(i*n),hn.height=Math.round(o*n),hn}var An="_maptalks__internal_layer_",gn=["MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"],mn=["FeatureCollection","Feature","Point","LineString","Polygon"].concat(gn),vn=["markerFile","polygonPatternFile","linePatternFile","markerFillPatternFile","markerLinePatternFile"],_n=[["markerWidth","markerHeight"],[],[null,"lineWidth"],[],[null,"markerLineWidth"]],xn={lineWidth:1,lineOpacity:1,lineDx:1,lineDy:1,polygonOpacity:1,markerWidth:1,markerHeight:1,markerDx:1,markerDy:1,markerOpacity:1,markerFillOpacity:1,markerLineWidth:1,markerLineOpacity:1,textSize:1,textOpacity:1,textHaloRadius:1,textWrapWidth:1,textLineSpacing:1,textDx:1,textDy:1},bn=["lineColor","polygonFill","markerFill","markerLineColor","textFill"],wn=14,Cn=function(){function e(e,n){l(e)&&l(n)?(this.width=e,this.height=n):l(e.width)?(this.width=e.width,this.height=e.height):Array.isArray(e)&&(this.width=e[0],this.height=e[1])}var n=e.prototype;return n.copy=function(){return new e(this.width,this.height)},n.add=function(n,i){var o,s;return n instanceof e?(o=this.width+n.width,s=this.height+n.height):(o=this.width+n,s=this.height+i),new e(o,s)},n.equals=function(e){return this.width===e.width&&this.height===e.height},n.multi=function(n){return new e(this.width*n,this.height*n)},n._multi=function(e){return this.width*=e,this.height*=e,this},n._round=function(){return this.width=Math.round(this.width),this.height=Math.round(this.height),this},n.toPoint=function(){return new ee(this.width,this.height)},n.toArray=function(){return[this.width,this.height]},n.toJSON=function(){return{width:this.width,height:this.height}},e}(),En="";function Fn(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Hn(e,n,i){if(!e)return e;for(;e.indexOf(n)>-1;)e=e.replace(n,i);return e}var Vn=/[\b\t\r\v\f]/gim;function $n(e){return f(e)?e.replace(Vn,En):e}function ei(e){return Fn(e).split(/\s+/)}var ii="undefined"!=typeof document?document.createElement("canvas").getContext("2d"):null;function ri(e,n){return ri.node?ri.node(e,n):(ii.font=n,ii.measureText(e).width)}function oi(e,n,i){var o=ri(e,n);return new Cn(o,i||wn)}function si(e,n,i,o){if(!e||0===e.length)return[{text:"",width:0}];var s=h(o)?ri(e,n):o,a=s/e.length,l=Math.floor(i/a/2);if(a>=i||l<=0)return[{text:"",width:i}];if(s<=i)return[{text:e,width:s}];for(var c=[],A=e.substring(0,l),f=a*l,d=l,p=e.length;d<p;d++){var g=e[d],v=ri(A+g);v>=i?(c.push({text:A,width:f}),A=e.substring(d,l+d),d+=l-1,f=a*l):(A+=g,f=v),d>=p-1&&(f=ri(A),c.push({text:A,width:f}))}return c}var ai=["{","}"];function li(e,n){if(!f(e))return e;function i(e){if(!n)return En;var i=n[e];return h(i)?En:Array.isArray(i)?i.join():i}for(var[o,s]=ai,a=function(e){e+=En;for(var[n,i]=ai,o=[],s=!1,a=En,h=0,l=e.length;h<l;h++){var c=e[h];s||c!==n||(s=!0),c===n&&s&&(a=En),s&&c!==n&&c!==i&&(a+=c),c===i&&a&&(s=!1,o.push(a),a=En)}return o}(e),l=0,c=a.length;l<c;l++){var A=a[l];e=Hn(e,""+o+A+s,i(A))}return e}function ui(e,n){l(e)&&(e+="");var i=n.textMaxHeight||0,o=mi(e=e||"",n);return i&&i<o.size.height&&(o.size.height=i),o}function ci(e,n,i){var o=e.width,s=e.height;return new ee("left"===n?-o:"right"===n?0:-o/2,"top"===i?-s:"bottom"===i?0:-s/2)}var Ai="sans-serif",fi=14;function gi(e){if(e.textFont)return e.textFont;var n=e.textSize;return h(n)&&(n=fi),(e.textStyle&&"normal"!==e.textStyle?e.textStyle+" ":"")+(e.textWeight&&"normal"!==e.textWeight?e.textWeight+" ":"")+n+"px "+(e.textFaceName&&function(e){for(var n=e.split(","),i=0;i<n.length;i++)n[i].trim&&(n[i]=n[i].trim()),n[i].indexOf(" ")>0&&'"'!==n[i][0]&&"'"!==n[i][0]&&(n[i]='"'+n[i]+'"');return n.join(",")}(e.textFaceName)||Ai)}function mi(e,n){var i=gi(n),o=n.textLineSpacing||0,s=oi(e,i,n.textSize),a=s.width,h=s.height,l=n.textWrapCharacter||"\n",c=[],A=n.textWrapWidth;(!A||A>a)&&(A=a),f(e)||(e+="");var d=0;if(l&&e.indexOf(l)>=0)for(var p=e.split(l),g=0,v=p.length;g<v;g++){var w=p[g],C=ri(w,i);if(C>A)for(var P=si(w,i,A,C),T=0,S=P.length;T<S;T++){var I=P[T].width;I>d&&(d=I),c.push({text:P[T].text,size:new Cn(I,h)})}else C>d&&(d=C),c.push({text:w,size:new Cn(C,h)})}else if(a>A)for(var E=si(e,i,A,a),O=0;O<E.length;O++){var k=E[O].width;k>d&&(d=k),c.push({text:E[O].text,size:new Cn(k,h)})}else a>d&&(d=a),c.push({text:e,size:s});var L=c.length;return{total:L,size:new Cn(d,h*L+o*(L-1)),rows:c,rawSize:s}}function yi(e){var n=0,i=e&&e.length||0;if(!i)return n;for(var o=0;o<i;o++)n=(n<<5)-n+e.charCodeAt(o),n|=0;return n}var vi=Object.freeze({__proto__:null,DEFAULT_FONT:Ai,DEFAULT_TEXTSIZE:fi,EMPTY_STRING:En,describeText:ui,escapeSpecialChars:$n,getAlignPoint:ci,getFont:gi,hashCode:yi,replaceAll:Hn,replaceVariable:li,splitContent:si,splitTextToRow:mi,splitWords:ei,stringLength:oi,stringWidth:ri,trim:Fn}),_i=n?function(e){return e[0]}:function(e){for(var n=document.documentElement&&document.documentElement.style||{},i=0;i<e.length;i++)if(e[i]in n)return e[i];return!1},xi=_i(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),bi=_i(["transformOrigin","WebkitTransformOrigin","OTransformOrigin","MozTransformOrigin","msTransformOrigin"]),wi=_i(["transition","WebkitTransition","OTransition","MozTransition","msTransition"]),Ci=_i(["filter","WebkitFilter","OFilter","MozFilter","msFilter"]);function Pi(e,n){var i=document.createElement(e);return n&&Wi(i,n),i}function Mi(e,n,i){var o=Pi(e);return n&&Ui(o,n),i&&i.appendChild(o),o}function Ti(e){if(!e)return this;if(wt.ielt9||wt.ie9){var n=Pi("div");n.appendChild(e),n.innerHTML="",n=null}else e.parentNode&&e.parentNode.removeChild(e);return this}function Si(e,n,i,o){if(!(e&&e.addEventListener&&n&&i))return this;for(var s=function(n){n||(n=window.event),i.call(o||e,n)},a=n.split(" "),h=a.length-1;h>=0;h--){var l=a[h];if(l)e["Z__"+l]||(e["Z__"+l]=[]),Oi(e,l,i)>=0&&(console.warn(e,"find '"+l+"' handler:",i," The old listener function will be removed"),Ii(e,l,i)),e["Z__"+l].push({callback:s,src:i}),e.addEventListener(l,s,!!wt.supportsPassive&&{capture:!1,passive:!1})}return this}function Ii(e,n,i){function o(n,i){"mousewheel"===n&&wt.gecko&&(n="DOMMouseScroll"),e.removeEventListener(n,i,!1)}if(!e||!e.removeEventListener||!n)return this;for(var s=n.split(" "),a=s.length-1;a>=0;a--){var h=s[a];if(h){if(!i&&e["Z__"+h]){for(var l=e["Z__"+h],c=0,A=l.length;c<A;c++)o(l[c].callback);return delete e["Z__"+h],this}var f=Oi(e,h,i);if(f<0)return this;o(h,e["Z__"+h][f].callback),e["Z__"+h].splice(f,1)}}return this}function Oi(e,n,i){if(!e||!e["Z__"+n]||!i)return-1;for(var o=e["Z__"+n],s=0,a=o.length;s<a;s++)if(o[s].src===i)return s;return-1}function Di(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,this}function ki(e){return e._cancelBubble=!0,e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,this}function Li(e){return e.onselectstart=function(){return!1},e.ondragstart=function(){return!1},e.setAttribute("unselectable","on"),this}function Fi(e,n){return e?(wt.any3d?Qi(e,n):(e.style.left=n.x+"px",e.style.top=n.y+"px"),n):null}function zi(e){var n=window.getComputedStyle(e),i=[parseInt(n["padding-left"]),parseInt(n["padding-top"])],o=e.getBoundingClientRect(),s=e.offsetWidth,a=e.offsetHeight;return e.__position=[o.left+i[0],o.top+i[1],s?o.width/s:1,a?o.height/a:1],e.__position}function Bi(e,n){e||(e=window.event);var i=n.__position;i||(i=zi(n));var o=e;return o.touches&&o.touches.length&&(e=o.touches[0]),o.changedTouches&&o.changedTouches.length&&(e=o.changedTouches[0]),new ee((e.clientX-i[0]-n.clientLeft)/i[2],(e.clientY-i[1]-n.clientTop)/i[3])}function Ui(e,n){var i=e.style.cssText;return function(e,n){var i=e.length-n.length;return i>=0&&e.indexOf(n,i)===i}(i,";")||(i+=";"),e.style.cssText=i+n,this}function Gi(e,n){if(void 0!==e.classList)return e.classList.contains(n);var i=qi(e);return i.length>0&&new RegExp("(^|\\s)"+n+"(\\s|$)").test(i)}function Vi(e,n){if(void 0===e.classList||Gi(e,n)){var i=qi(e);Wi(e,(i?i+" ":"")+n)}else for(var o=ei(n),s=0,a=o.length;s<a;s++)e.classList.add(o[s]);return this}function Wi(e,n){return h(e.className.baseVal)?e.className=n:e.className.baseVal=n,this}function qi(e){return h(e.className.baseVal)?e.className:e.className.baseVal}function Qi(e,n){var i=n||new ee(0,0);return e.style[xi]=wt.any3d?"translate3d("+i.x+"px,"+i.y+"px,0px)":"translate("+i.x+"px,"+i.y+"px)",this}function Xi(e){return/<[a-z\][\s\S]*>/i.test(e)}function Ji(e,n){var i=Ki(e);f(n)?i.innerHTML=n:i.appendChild(n);var o=new Cn(i.clientWidth,i.clientHeight);return Ti(i),o}function Ki(e){var n=document.createElement(e);return n.style.cssText="position:absolute;left:-10000px;top:-10000px;",document.body.appendChild(n),n}var $i=Si,tr=Ii;function er(e){return e&&("mousemove"===e||"touchmove"===e)}function nr(e,n){var i=s();return!!(e._mousemoveTime&&i-e._mousemoveTime<(n||48))||(e._mousemoveTime=i,!1)}var ir=Object.freeze({__proto__:null,CSSFILTER:Ci,MOUSEMOVE_THROTTLE_TIME:48,TRANSFORM:xi,TRANSFORMORIGIN:bi,TRANSITION:wi,addClass:Vi,addDomEvent:Si,computeDomPosition:zi,createEl:Pi,createElOn:Mi,getClass:qi,getDomRuler:Ki,getEventContainerPoint:Bi,hasClass:Gi,isHTML:Xi,isMousemoveEventBlocked:nr,isMoveEvent:er,listensDomEvent:Oi,measureDom:Ji,off:tr,offsetDom:Fi,on:$i,preventDefault:Di,preventSelection:Li,removeDomEvent:Ii,removeDomNode:Ti,removeTransform:function(e){return e.style[xi]&&(e.style[xi]=""),this},setClass:Wi,setOpacity:function(e,n){return e.style.opacity=n,this},setStyle:Ui,setTransform:Qi,setTransformMatrix:function(e,n){var i="matrix("+(f(n)?n:n.join())+")";return e.style[xi]!==i&&(e.style[xi]=i),this},stopPropagation:ki}),rr={jsonp:function(e,n){var i="_maptalks_jsonp_"+oe();e.match(/\?/)?e+="&callback="+i:e+="?callback="+i;var o=document.createElement("script");return o.type="text/javascript",o.src=e,window[i]=function(e){n(null,e),document.getElementsByTagName("head")[0].removeChild(o),o=null,delete window[i]},document.getElementsByTagName("head")[0].appendChild(o),this},get:function(e,i,o){if(d(i)){var s=o;o=i,i=s}if(n&&rr.get.node)return rr.get.node(e,o,i);var a=rr._getClient(o);if(a.open("GET",e,!0),i){for(var h in i.headers)a.setRequestHeader(h,i.headers[h]);a.withCredentials="include"===i.credentials,i.responseType&&(a.responseType=i.responseType)}return a.send(null),a},post:function(e,i,o){var s;if(f(e)){if(d(i)){var a=o;o=i,i=a}s=(i=i||{}).postData}else{s=i,e=(i=e).url,o=o}if(n&&rr.post.node)return i.url=e,rr.post.node(i,s,o);var h=rr._getClient(o);if(h.open("POST",i.url,!0),i.headers||(i.headers={}),i.headers["Content-Type"]||(i.headers["Content-Type"]="application/x-www-form-urlencoded"),"setRequestHeader"in h)for(var l in i.headers)i.headers.hasOwnProperty(l)&&h.setRequestHeader(l,i.headers[l]);return f(s)||(s=JSON.stringify(s)),h.send(s),h},_wrapCallback:function(e,n){return function(){4===e.readyState&&(200===e.status?"arraybuffer"===e.responseType?0===e.response.byteLength?n(new Error("http status 200 returned without content.")):n(null,{data:e.response,cacheControl:e.getResponseHeader("Cache-Control"),expires:e.getResponseHeader("Expires"),contentType:e.getResponseHeader("Content-Type")}):n(null,e.responseText):n(new Error(e.statusText+","+e.status)))}},_getClient:function(e){var n;try{n=new XMLHttpRequest}catch(e){try{n=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{n=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}}return n.onreadystatechange=rr._wrapCallback(n,e),n},getArrayBuffer:function(e,n,i){if(d(n)){var o=i;i=n,n=o}return n||(n={}),n.responseType="arraybuffer",rr.get(e,n,i)},getImage:function(e,n,i){return rr.getArrayBuffer(n,i,(function(n,i){if(n)e.onerror&&e.onerror(n);else if(i){var o=window.URL||window.webkitURL,s=e.onload;e.onload=function(){s&&s(),o.revokeObjectURL(e.src)};var a=new Blob([new Uint8Array(i.data)],{type:i.contentType});e.cacheControl=i.cacheControl,e.expires=i.expires,e.src=i.data.byteLength?o.createObjectURL(a):Ke}}))},getJSON:function(e,n,i){}};rr.getJSON=function(e,n,i){if(d(n)){var o=i;i=n,n=o}var s=function(e,n){var o=n?ae(n):null;i(e,o)};return n&&n.jsonp?rr.jsonp(e,s):rr.get(e,n,s)};var sr="",lr=/data:image\/.*;base64,/;function cr(e,n={}){for(var i in n){var o=n[i];if(o&&o.target&&(h=i,l(a=e)&&(a+=sr),l(h)&&(h+=sr),a&&h&&(a.includes?a.includes(h):a.indexOf(h)>-1))){var{target:s}=o;return e.replace(i,s)}}var a,h;return sr}var Ar={host:sr,resources:{},proxy:{},origin:{},fromJSON:function(e){try{f(e)&&(e=JSON.parse(e)),A(e)&&a(Ar,e)}catch(e){console.error(e)}},toJSON:function(){return{host:Ar.host,proxy:a({},Ar.proxy||{}),origin:a({},Ar.origin||{})}},getResource:function(e){return Ar.resources[e]},removeResource:function(e){delete Ar.resources[e]},addResource:function(e,n){Ar.resources[e]?console.warn(e+" resource Already exists,the "+e+" Cannot be added,the resource name Cannot repeat "):Ar.resources[e]=n},updateResource:function(e,n){Ar.resources[e]=n},allResource:function(){return Ar.resources},loadSprite:function(e={imgUrl:"",jsonUrl:""}){return new Promise((function(n,i){var{imgUrl:o,jsonUrl:s}=e;if(!o||!s)return i(new Error("not find imgUrl/jsonUrl from options")),void console.error(e);function a(e,n,i){e.width=n,e.height=i;var o=e.getContext("2d");return o.clearRect(0,0,n,i),o}function h(o={},s){var h=function(){var e;return wt.IS_NODE?console.error("Current environment does not support canvas dom"):e=Pi("canvas"),e}();if(h){var l=[];for(var c in o){l.push({name:c,spriteItem:o[c]})}var A=function(){var e;return wt.decodeImageInWorker&&(e=new OffscreenCanvas(2,2)),e}(),f=e.sourceName||"";l.forEach((function(e){var n,{name:i,spriteItem:o}=e,{x:l,y:c,width:d,height:p}=o;A?(a(A,d,p).drawImage(s,l,c,d,p,0,0,d,p),n=A.transferToImageBitmap()):(a(h,d,p).drawImage(s,l,c,d,p,0,0,d,p),n=h.toDataURL());e.resource=n,Ar.addResource(f+i,n)})),n(l)}else i(new Error("can not create canvas"))}rr.getJSON(s,{},(function(e,n){if(e)i(e);else{var s=new Image;s.onload=function(){h(n,s)},s.onerror=function(e){i(e)},rr.getImage(s,o,{})}}))}))},loadSvgs:function(e){return new Promise((function(n,i){var o="",s=[],a="",h="",l="";if(Array.isArray(e)||e instanceof NodeList)s=e;else if(A(e)){o=e.url,s=e.symbols,a=e.fill,h=e.stroke,l=e.sourceName||""}else f(e)&&(o=e);if(o||!s||0!==s.length){var c=[],d=function(e,n){var i=xr(n);i&&(i.forEach((function(e){a&&(e.fill=a),h&&(e.stroke=h)})),Ar.addResource(l+e,i)),c.push({name:e,paths:i,body:n})};if(o&&f(o))fetch(o).then((function(e){return e.json()})).then((function(e){e.forEach((function(e){var{name:n,body:i}=e;d(n,i)})),n(c)})).catch((function(e){console.log(e),i(e)}));else if(s){for(var p=0,g=s.length;p<g;p++){var v=s[p],w=v.id;w&&d(w,"<xml><svg>"+v.innerHTML+"</svg></xml>")}n(c)}else i(new Error("not support svgs params type"))}else i(new Error("not find svgs data"))}))}};function fr(e){if(l(e)&&(e+=sr),!e)return console.error("resouce path is null,path:",e),e;if(!f(e))return e;if(function(e){return lr.test(e)}(e)||function(e){return 0===e.indexOf("blob:")}(e))return e;if("$"===e[0])return Ar.getResource(e.substring(1,1/0))||"";var n=Ar.origin||{},i=we(e);if(i&&A(n)){var o=cr(e,n);return o||e}var s=Ar.proxy||{};if(A(s)){var a=cr(e,s);if(a)return a}var{host:h}=Ar;return!i&&h&&f(h)?""+h+e:an(e)}var pr=new DOMParser;function yr(e,n){return e?e[n]&&e[n].value:null}function xr(e){var n=pr.parseFromString(e,"text/xml").querySelector("svg");if(!n)return null;for(var i=n.childNodes,o=[],s=n.attributes,a=yr(s,"fill"),h=yr(s,"fill-opacity"),l=yr(s,"stroke"),c=yr(s,"stroke-opacity"),A=yr(s,"stroke-width"),f=0,d=i.length;f<d;f++){var p=i[f],g=p.attributes;if(g){var v=void 0,w="path"===(p.tagName||"").toLowerCase();if(v=w?yr(g,"d"):p){var C=yr(g,"fill")||a,P=yr(g,"stroke")||l,T={path:v};if(C&&(T.fill=C,T["fill-opacity"]=yr(g,"fill-opacity")||h||1),P&&(T.stroke=P,T["stroke-opacity"]=yr(g,"stroke-opacity")||c||1,T["stroke-width"]=yr(g,"stroke-width")||A||1),o.push(T),!w)for(var S in T)"path"!==S&&T.hasOwnProperty(S)&&p.setAttribute(S,T[S])}}}return o}let br;const wr={width:100,height:10};let Cr=!1;try{const e=new OffscreenCanvas(1,1);e.getContext("2d").fillText("hello",0,0),Cr=!0}catch(e){Cr=!1}let Pr=class ColorIn{constructor(e,n={}){if(!Array.isArray(e))return void console.error("colors is not array");if(e.length<2)return void console.error("colors.length should >1");this.colors=e;let i=1/0,o=-1/0;for(let n=0,s=e.length;n<s;n++){const s=e[n][0];i=Math.min(s,i),o=Math.max(s,o)}this.min=i,this.max=o,this.valueOffset=this.max-this.min,this.options=Object.assign({},wr,n),this._initImgData()}getImageData(){return this.imgData}_initImgData(){const e=function(){if(!br){const{width:e,height:n}=wr;Cr?br=new OffscreenCanvas(e,n):(br=document.createElement("canvas"),br.width=e,br.height=n)}return br}(),{width:n,height:i}=this.options;e.width=n,e.height=i;const o=e.getContext("2d");o.clearRect(0,0,e.width,e.height);const s=o.createLinearGradient(0,0,e.width,0),{colors:a,valueOffset:h}=this;for(let e=0,n=a.length;e<n;e++){const[n,i]=a[e];s.addColorStop((n-this.min)/h,i)}o.fillStyle=s,o.fillRect(0,0,e.width,e.height),this.imgData=o.getImageData(0,0,e.width,e.height)}getColor(e){e=Math.max(this.min,e),e=Math.min(e,this.max);let n=Math.round((e-this.min)/this.valueOffset*this.imgData.width);n=Math.min(n,this.imgData.width-1);const i=4*n;return[this.imgData.data[i],this.imgData.data[i+1],this.imgData.data[i+2],this.imgData.data[i+3]]}};var Mr;function Tr(e,n){var i,o,s;if(Hr(e)){var a,h=e.stops&&"object"==typeof e.stops[0][0],l=h||!(h||void 0!==e.property),c=e.type||n||"exponential";if("exponential"===c)a=Rr;else if("interval"===c)a=Or;else if("categorical"===c)a=Ir;else if("identity"===c)a=Lr;else if("color-interpolate"===c)a=kr;else{if("calculate-expression"!==c)throw new Error('Unknown function type "'+c+'"');a=Fr}if(h){var A={},f=[];for(let n=0;n<e.stops.length;n++){var d=e.stops[n];void 0===A[d[0].zoom]&&(A[d[0].zoom]={zoom:d[0].zoom,type:e.type,property:e.property,default:e.default,stops:[]}),A[d[0].zoom].stops.push([d[0].value,d[1]])}for(let e in A)f.push([A[e].zoom,Tr(A[e])]);i=function(n,i){const o=Rr({stops:f,base:e.base},n)(n,i);return"function"==typeof o?o(n,i):o},o=!1,s=!1}else l?(i=function(n){const i=a(e,n);return"function"==typeof i?i(n):i},o=!0,s=!1):(i=function(n,i){const o=a(e,i?i[e.property]:null);return"function"==typeof o?o(n,i):o},o=!1,s=!0)}else i=function(){return e},o=!0,s=!0;return i.isZoomConstant=s,i.isFeatureConstant=o,i}function Ir(e,n){for(let i=0;i<e.stops.length;i++)if(n===e.stops[i][0])return e.stops[i][1];return e.default}function Or(e,n){for(var i=0;i<e.stops.length&&!(n<e.stops[i][0]);i++);return e.stops[Math.max(i-1,0)][1]}function Rr(e,n){for(var i=void 0!==e.base?e.base:1,o=0;!(o>=e.stops.length||n<=e.stops[o][0]);)o++;return 0===o?e.stops[o][1]:o===e.stops.length?e.stops[o-1][1]:zr(n,i,e.stops[o-1][0],e.stops[o][0],e.stops[o-1][1],e.stops[o][1])}"function"==typeof Map&&(Mr=new Map);const Dr={width:100,height:1};function kr(e,n){const i=e.stops;if(i&&i.length>1){let e;if(Mr){const n=JSON.stringify(i);if(!Mr.has(n)){const e=new Pr(i,Dr);Mr.set(n,e)}e=Mr.get(n)}else e=new Pr(i,Dr);const[o,s,a,h]=e.getColor(n);return[o/255,s/255,a/255,h/255]}return i&&1===i.length?i[0][1]:null}function Lr(e,n){return function(e,n,i){return void 0!==e?e:void 0!==n?n:null}(n,e.default)}function Fr(e,n){const i=String(e.property),o=e.expression,s=n;function a(n){return null==n||""===n||isNaN(n)?e.default:n}if(null==n||""===n||isNaN(n)||n<0)return a(e.default);{const n=function e(n,i,o){const s=Number(o),a=String(i);return Array.isArray(n)?n.map((n=>e(n,a,s))):n===a?s:n}(o,i,s);return a(function n(i){if(!Array.isArray(i)){if("number"==typeof i)return i;throw new Error("Invalid expression format")}{const o=i[0];if(!["+","-","*","/"].includes(o))throw new Error(`Unknown operator: ${o}`);const s=i.slice(1).map((e=>n(e)));switch(o){case"+":return s.reduce(((e,n)=>e+n),0);case"-":return s.reduce(((e,n)=>e-n));case"*":return s.reduce(((e,n)=>e*n),1);case"/":return s.some((e=>0===e))?e.default:s.reduce(((e,n)=>e/n));default:throw new Error(`Unsupported operator: ${o}`)}}}(n))}}function zr(e,n,i,o,s,a){return"function"==typeof s?function(){var h=s.apply(void 0,arguments),l=a.apply(void 0,arguments);return zr(e,n,i,o,h,l)}:s.length?function(e,n,i,o,s,a){var h=[];for(let l=0;l<s.length;l++)h[l]=Br(e,n,i,o,s[l],a[l]);return h}(e,n,i,o,s,a):Br(e,n,i,o,s,a)}function Br(e,n,i,o,s,a){var h,l=o-i,c=e-i;return s*(1-(h=1===n?c/l:(Math.pow(n,c)-1)/(Math.pow(n,l)-1)))+a*h}function Hr(e){return e&&"object"==typeof e&&(e.stops||e.property&&"identity"===e.type||e.expression&&"calculate-expression"===e.type)}function jr(e){for(const n in e)if(Hr(e[n]))return!0;return!1}function Gr(e){return qr(e,"exponential")}function Vr(e,n){if(!e)return null;var i=!1;if(Array.isArray(e)){var o,s=[];for(let a=0;a<e.length;a++)(o=Vr(e[a],n))?(s.push(o),i=!0):s.push(e[a]);return i?s:e}var a,h={__fn_types_loaded:!0},l=[];for(a in e)e.hasOwnProperty(a)&&l.push(a);const c=function(e){Object.defineProperty(h,e,{get:function(){return this["__fn_"+e]||(this["__fn_"+e]=Gr(this["_"+e])),this["__fn_"+e].apply(this,n())},set:function(n){this["_"+e]=n},configurable:!0,enumerable:!0})};for(let n=0,o=l.length;n<o;n++)Hr(e[a=l[n]])?(i=!0,h["_"+a]=e[a],c(a)):h[a]=e[a];return i?h:e}function Wr(e){if(!e||!e.stops)return[];const n=[];for(let i=0,o=e.stops.length;i<o;i++)n.push(e.stops[i][1]);return n}function qr(e,n){if(!Hr(e))return function(){return e};let i=!0,o=!0;const s=(e=JSON.parse(JSON.stringify(e))).stops;if(s)for(let e=0;e<s.length;e++)if(Hr(s[e][1])){const a=qr(s[e][1],n);i=i&&a.isZoomConstant,o=o&&a.isFeatureConstant,s[e]=[s[e][0],a]}const a=Tr(e,n);return a.isZoomConstant=i&&a.isZoomConstant,a.isFeatureConstant=o&&a.isFeatureConstant,a}
/*!
      Feature Filter by

      (c) mapbox 2016 and maptalks 2018
      www.mapbox.com | www.maptalks.org
      License: MIT, header required.
  */const Zr=["Unknown","Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"];function Qr(e){return new Function("f",`var p = (f && f.properties || {}); return ${Xr(e)}`)}function Xr(e){if(!e)return"true";const n=e[0];if(e.length<=1)return"any"===n?"false":"true";const i="=="===n?Kr(e[1],e[2],"===",!1):"!="===n?Kr(e[1],e[2],"!==",!1):"<"===n||">"===n||"<="===n||">="===n?Kr(e[1],e[2],n,!0):"any"===n?no(e.slice(1),"||"):"all"===n?no(e.slice(1),"&&"):"none"===n?oo(no(e.slice(1),"||")):"in"===n?io(e[1],e.slice(2)):"!in"===n?oo(io(e[1],e.slice(2))):"has"===n?ro(e[1]):"!has"===n?oo(ro(e[1])):"contains"===n?function(e,n,i){const o=Jr(e);return void 0!==i?`(${o} + '').indexOf("${n}") === ${i}`:`(${o} + '').indexOf("${n}") >= 0`}(e[1],e[2],e[3]):"true";return`(${i})`}function Jr(e){return"$"===e[0]?"f."+e.substring(1):"p["+JSON.stringify(e)+"]"}function Kr(e,n,i,o){if("object"==typeof(s=e)&&s&&e.op)return function(e,n,i,o){const s=e.property,a=e.op;let h=Jr(s);return"length"!==a?(console.error(`not support ${a} op`),"false"):(h=`((${h}+='').length)`,eo(h,s,n,i,o))}(e,n,i,o);var s;return eo(Jr(e),e,n,i,o)}function eo(e,n,i,o,s){const a="$type"===n?Zr.indexOf(i):JSON.stringify(i);return(s?`typeof ${e}=== typeof ${a}&&`:"")+e+o+a}function no(e,n){return e.map(Xr).join(n)}function io(e,n){"$type"===e&&(n=n.map((e=>Zr.indexOf(e))));const i=JSON.stringify(n.sort(so)),o=Jr(e);return n.length<=200?`${i}.indexOf(${o}) !== -1`:`function(v, a, i, j) {\n        while (i <= j) { var m = (i + j) >> 1;\n            if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;\n        }\n    return false; }(${o}, ${i},0,${n.length-1})`}function ro(e){return"$id"===e?'"id" in f':`${JSON.stringify(e)} in p`}function oo(e){return`!(${e})`}function so(e,n){return e<n?-1:e>n?1:0}function ao(e){const n=e._toJSON(),i=n.feature;return i.type=Zr.indexOf(i.geometry.type),i.subType=n.subType,i}function ho(e){if(!Array.isArray(e))return ho([e]);const n=[];for(let i=0;i<e.length;i++){let o;o=!0===e[i].filter?function(){return!0}:Qr(e[i].filter),n.push(uo({},e[i],{filter:o}))}return n}function uo(e){for(let n=1;n<arguments.length;n++){const i=arguments[n];for(const n in i)e[n]=i[n]}return e}var co=[],Ao={};function fo(e,n){return Vr(e,(function(){var e=n.getMap();return function(e,n,i){return e[0]=n,e[1]=i,e}(co,e?e.getZoom():12,a({},n.getProperties(),function(e,n,i,o){return e["{bearing}"]=n,e["{pitch}"]=i,e["{zoom}"]=o,e}(Ao,e&&e.getBearing()||0,e&&e.getPitch()||0,e?e.getZoom():10)))}))}var po=Object.freeze({__proto__:null,compileStyle:ho,createFilter:Qr,getFilterFeature:ao,getFunctionTypeResources:Wr,hasFunctionDefinition:jr,interpolated:Gr,isFeatureFilter:function e(n){if(!0===n||!1===n)return!0;if(!Array.isArray(n)||0===n.length)return!1;switch(n[0]){case"has":case"!has":return 2===n.length&&("string"==typeof n[1]||n[1].property&&n[1].op);case"in":case"!in":return n.length>=2&&("string"==typeof n[1]||n[1].property&&n[1].op);case"==":case"!=":case">":case">=":case"<":case"<=":return 3===n.length&&("string"==typeof n[1]||n[1].property&&n[1].op);case"none":case"any":case"all":for(const i of n.slice(1))if(!e(i)&&"boolean"!=typeof i)return!1;return!0;case"contains":return!0;default:return!1}},isFunctionDefinition:Hr,loadFunctionTypes:Vr,loadGeoSymbol:fo});function mo(e){var n={stroke:{stroke:e.markerLineColor,"stroke-width":e.markerLineWidth,"stroke-opacity":e.markerLineOpacity,"stroke-dasharray":null,"stroke-linecap":"butt","stroke-linejoin":"round"},fill:{fill:e.markerFill,"fill-opacity":e.markerFillOpacity}};return 0===n.stroke["stroke-width"]&&(n.stroke["stroke-opacity"]=0),n}function yo(e,n,i){if(!e.markerPath)return null;var o=1,s=mo(e);l(e.markerOpacity)&&(o=e.markerOpacity),l(e.opacity)&&(o*=e.opacity);var c,A={};if(s){for(var d in s.stroke)s.stroke.hasOwnProperty(d)&&(h(s.stroke[d])||(A[d]=s.stroke[d]));for(var p in s.fill)s.fill.hasOwnProperty(p)&&(h(s.fill[p])||(A[p]=s.fill[p]))}var g,v=e.markerPath;c=f(v)&&"$"===v[0]?Ar.getResource(v.substring(1,1/0))||[]:Array.isArray(e.markerPath)?e.markerPath:[e.markerPath];for(var w=[],C=0;C<c.length;C++)(g=a({},g=f(c[C])?{path:c[C]}:c[C],A)).d=g.path,delete g.path,w.push(g);var P=['<svg version="1.1"','xmlns="http://www.w3.org/2000/svg"'];o<1&&P.push('opacity="'+o+'"'),e.markerPathWidth&&e.markerPathHeight&&P.push('viewBox="0 0 '+e.markerPathWidth+" "+e.markerPathHeight+'"'),P.push('preserveAspectRatio="none"'),n&&P.push('width="'+n+'"'),i&&P.push('height="'+i+'"'),P.push("><defs></defs>");for(var T=0;T<w.length;T++)if(w[T].d instanceof Element)P.push(w[T].d.outerHTML);else{var S="<path ";for(var I in w[T])w[T].hasOwnProperty(I)&&(S+=" "+I+'="'+w[T][I]+'"');P.push(S+="></path>")}return P.push("</svg>"),"data:image/svg+xml;base64,"+Ze(P.join(" "))}function vo(e,n){if(!e)return[];var i=e;Array.isArray(e)||(i=[e]);for(var o,s,a,h,l=[],c=vn,A=i.length-1;A>=0;A--)if(e=i[A]){n&&(e=_o(e));for(var f=0;f<c.length;f++)if(Hr(o=e[c[f]])&&(o=Wr(o)),o){Array.isArray(o)||(o=[o]);for(var d=0;d<o.length;d++)"url("===o[d].slice(0,4)&&(o[d]=Ge(o[d])),l.push([o[d],e[(s=_n[f])[0]],e[s[1]]])}if("path"===e.markerType&&e.markerPath)if(a=Hr(e.markerWidth)?200:e.markerWidth,h=Hr(e.markerHeight)?200:e.markerHeight,Hr(e.markerPath)){o=Wr(e.markerPath);for(var p=e.markerPath,g=0;g<o.length;g++)e.markerPath=o[g],l.push([yo(e),a,h]);e.markerPath=p}else l.push([yo(e),a,h])}return l}function _o(e){if(!e)return null;var i=e;if(n)return i;for(var o,s=vn,a=0,h=s.length;a<h;a++)(o=i[s[a]])&&(i[s[a]]=xo(o));return i}function xo(e){if(Hr(e)&&e.stops){for(var n=e.stops,i=0;i<n.length;i++)n[i][1]=xo(n[i][1]);return e}return"url("===e.slice(0,4)&&(e=Ge(e)),e}function wo(e){return e&&wt.decodeImageInWorker&&e instanceof ImageBitmap}function Mo(e){return e&&e.colorStops}function So(e){var n=[e.type];if(e.places&&n.push(e.places.join()),e.colorStops){for(var i=[],o=e.colorStops.length-1;o>=0;o--)i.push(e.colorStops[o].join());n.push(i.join(","))}return n.join("_")}function Eo(e,n){if(!e)return 1;var i=[];if(Array.isArray(e)){for(var o=0;o<e.length;o++)i.push(Eo(e[o],n));return i.sort().join(",")}var s=Object.keys(e).sort().reduce((function(i,o){return n&&0!==o.indexOf(n)||(i[o]=e[o]),i}),{});return yi(JSON.stringify(s))}function Oo(e,n){function i(e,n){h(e.opacity)?e.opacity=n:e.opacity*=n}var o;if(Array.isArray(e)){o=[];for(var s=0;s<e.length;s++){var l=a({},e[s]);i(l,n),o.push(l)}}else i(o=a({},e),n);return o}function ko(...e){var n=e[0],i=Array.prototype.slice.call(e,1);if(i&&i.length||(i=[{}]),Array.isArray(n)){for(var o,s,l=[],c=0,A=n.length;c<A;c++){o=n[c],s={};for(var f=0,d=i.length;f<d;f++)Array.isArray(i[f])?h(i[f][c])?a(s,o||{}):a(s,o,i[f][c]):a(s,o,i[f]?i[f]:{});l.push(s)}return l}var p=[{},n];return p.push.apply(p,i),a.apply(this,p)}function Lo(e){if(e.symbol&&(e=[e]),Array.isArray(e))return e;var n=e.$root,i=e.$iconset;if(e=e.style,n||i){n&&"/"===n[n.length-1]&&(n=n.substring(0,n.length-1)),i&&"/"===i[i.length-1]&&(i=i.substring(0,i.length-1));Fo(e,(function(e){return"{$root}"===e?n:"{$iconset}"===e?i:null}))}return e}function Fo(e,n){for(var i=0;i<e.length;i++){var{symbol:o}=e[i];o&&zo(o,n)}}var No=/(\{\$root\}|\{\$iconset\})/g;function zo(e,n){for(var i in e)e.hasOwnProperty(i)&&"textName"!==i&&(f(e[i])&&e[i].length>2?e[i]=e[i].replace(No,n):Hr(e[i])?e[i]=Bo(e[i],n):A(e[i])&&zo(e[i],n))}function Bo(e,n){var i=e.default;f(i)&&(e.default=i.replace(No,n));var o=e.stops;if(!o)return e;for(var s=0;s<o.length;s++)Array.isArray(o[s])&&(f(o[s][1])?o[s][1]=o[s][1].replace(No,n):Hr(o[s][1])&&(o[s][1]=Bo(o[s][1],n)));return e}function Ho(e=[]){Array.isArray(e)||(e=[e]);for(var n=e.length,i=0;i<n;i++){var o=e[i];if(o.style){var{lineDasharray:s,lineWidth:a}=o.style;if(a&&l(a)&&a>0&&s&&Array.isArray(s)&&s.length)return!0}}return!1}function jo(e,n,i,o,s){var a=1/Math.tan(n/2),h=1/(o-s);return e[0]=a/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(s+o)*h,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*s*o*h,e[15]=0,e}function Uo(e,n,i){var o,s,a,h,l,c,A,f,d,p,g,v,w=i[0],C=i[1],P=i[2];return n===e?(e[12]=n[0]*w+n[4]*C+n[8]*P+n[12],e[13]=n[1]*w+n[5]*C+n[9]*P+n[13],e[14]=n[2]*w+n[6]*C+n[10]*P+n[14],e[15]=n[3]*w+n[7]*C+n[11]*P+n[15]):(s=n[1],a=n[2],h=n[3],l=n[4],c=n[5],A=n[6],f=n[7],d=n[8],p=n[9],g=n[10],v=n[11],e[0]=o=n[0],e[1]=s,e[2]=a,e[3]=h,e[4]=l,e[5]=c,e[6]=A,e[7]=f,e[8]=d,e[9]=p,e[10]=g,e[11]=v,e[12]=o*w+l*C+d*P+n[12],e[13]=s*w+c*C+p*P+n[13],e[14]=a*w+A*C+g*P+n[14],e[15]=h*w+f*C+v*P+n[15]),e}function Go(e,n,i){var o=i[0],s=i[1],a=i[2];return e[0]=n[0]*o,e[1]=n[1]*o,e[2]=n[2]*o,e[3]=n[3]*o,e[4]=n[4]*s,e[5]=n[5]*s,e[6]=n[6]*s,e[7]=n[7]*s,e[8]=n[8]*a,e[9]=n[9]*a,e[10]=n[10]*a,e[11]=n[11]*a,e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e}function Vo(e,n,i){var o=Math.sin(i),s=Math.cos(i),a=n[4],h=n[5],l=n[6],c=n[7],A=n[8],f=n[9],d=n[10],p=n[11];return n!==e&&(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e[4]=a*s+A*o,e[5]=h*s+f*o,e[6]=l*s+d*o,e[7]=c*s+p*o,e[8]=A*s-a*o,e[9]=f*s-h*o,e[10]=d*s-l*o,e[11]=p*s-c*o,e}function Wo(e,n,i){var o=Math.sin(i),s=Math.cos(i),a=n[0],h=n[1],l=n[2],c=n[3],A=n[4],f=n[5],d=n[6],p=n[7];return n!==e&&(e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e[0]=a*s+A*o,e[1]=h*s+f*o,e[2]=l*s+d*o,e[3]=c*s+p*o,e[4]=A*s-a*o,e[5]=f*s-h*o,e[6]=d*s-l*o,e[7]=p*s-c*o,e}function qo(e,n,i){var o=n[0],s=n[1],a=n[2],h=n[3],l=n[4],c=n[5],A=n[6],f=n[7],d=n[8],p=n[9],g=n[10],v=n[11],w=n[12],C=n[13],P=n[14],T=n[15],S=i[0],I=i[1],E=i[2],O=i[3];return e[0]=S*o+I*l+E*d+O*w,e[1]=S*s+I*c+E*p+O*C,e[2]=S*a+I*A+E*g+O*P,e[3]=S*h+I*f+E*v+O*T,e[4]=(S=i[4])*o+(I=i[5])*l+(E=i[6])*d+(O=i[7])*w,e[5]=S*s+I*c+E*p+O*C,e[6]=S*a+I*A+E*g+O*P,e[7]=S*h+I*f+E*v+O*T,e[8]=(S=i[8])*o+(I=i[9])*l+(E=i[10])*d+(O=i[11])*w,e[9]=S*s+I*c+E*p+O*C,e[10]=S*a+I*A+E*g+O*P,e[11]=S*h+I*f+E*v+O*T,e[12]=(S=i[12])*o+(I=i[13])*l+(E=i[14])*d+(O=i[15])*w,e[13]=S*s+I*c+E*p+O*C,e[14]=S*a+I*A+E*g+O*P,e[15]=S*h+I*f+E*v+O*T,e}function Zo(e,n){var i=n[0],o=n[1],s=n[2],a=n[3],h=n[4],l=n[5],c=n[6],A=n[7],f=n[8],d=n[9],p=n[10],g=n[11],v=n[12],w=n[13],C=n[14],P=n[15],T=i*l-o*h,S=i*c-s*h,I=i*A-a*h,E=o*c-s*l,O=o*A-a*l,k=s*A-a*c,L=f*w-d*v,F=f*C-p*v,N=f*P-g*v,z=d*C-p*w,H=d*P-g*w,j=p*P-g*C,W=T*j-S*H+I*z+E*N-O*F+k*L;return W?(e[0]=(l*j-c*H+A*z)*(W=1/W),e[1]=(s*H-o*j-a*z)*W,e[2]=(w*k-C*O+P*E)*W,e[3]=(p*O-d*k-g*E)*W,e[4]=(c*N-h*j-A*F)*W,e[5]=(i*j-s*N+a*F)*W,e[6]=(C*I-v*k-P*S)*W,e[7]=(f*k-p*I+g*S)*W,e[8]=(h*H-l*N+A*L)*W,e[9]=(o*N-i*H-a*L)*W,e[10]=(v*O-w*I+P*T)*W,e[11]=(d*I-f*O-g*T)*W,e[12]=(l*F-h*z-c*L)*W,e[13]=(i*z-o*F+s*L)*W,e[14]=(w*S-v*E-C*T)*W,e[15]=(f*E-d*S+p*T)*W,e):null}function Qo(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Xo(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e}var Yo=Object.freeze({__proto__:null,DEFAULT_FONT:Ai,DEFAULT_TEXTSIZE:fi,EMPTY_STRING:En,GUID:se,IS_NODE:n,UID:oe,_defaults:function(e,n){for(var i=Object.getOwnPropertyNames(n),o=0;o<i.length;o++){var s=i[o],a=Object.getOwnPropertyDescriptor(n,s);a&&a.configurable&&void 0===e[s]&&Object.defineProperty(e,s,a)}return e},b64toBlob:Ye,btoa:Ze,calCanvasSize:cn,get cancelAnimFrame(){return $t},clamp:_e,computeDegree:Je,convertResourceUrl:_o,convertStylePath:Fo,copy:Xo,describeText:ui,emptyImageUrl:Ke,equalMapView:$e,escapeSpecialChars:$n,extend:a,extendSymbol:ko,extractCssUrl:Ge,flash:en,forEachCoord:ue,getAbsoluteURL:an,getAlignPoint:ci,getExternalResources:vo,getFont:gi,getGlobalThis:i,getGradientStamp:So,getImageBitMap:sn,getMarkerPathBase64:yo,getPointsResultPts:on,getSymbolHash:Eo,getSymbolStamp:function(e,n){return Eo(e,n)},getValueOrDefault:ce,hasOwn:g,hashCode:yi,identity:Qo,interpolate:fe,invert:Zo,isArrayHasData:xe,isCssUrl:je,isDashLine:Ho,isEmpty:function(e){var n;for(n in e)return!1;return!n},isFunction:d,isGradient:Mo,isImageBitMap:wo,isInteger:c,isNil:h,isNoContentHttpCode:function(e){return 204===e||e>=400&&e<500||501===e},isNumber:l,isObject:A,isSVG:ne,isString:f,isURL:we,join:function(e,n){return e.join?e.join(n||","):Array.prototype.join.call(e,n||",")},loadImage:ie,log2:function(e){if(Math.log2)return Math.log2(e);var n=Math.log(e)*Math.LOG2E,i=Math.round(n);return Math.abs(i-n)<1e-14?i:n},lowerSymbolOpacity:Oo,multiply:qo,now:s,parseJSON:ae,parseStyleRootPath:Lo,parseSymbolPath:zo,perspective:jo,pushIn:he,removeFromArray:le,replaceAll:Hn,replaceVariable:li,get requestAnimFrame(){return Kt},rotateX:Vo,rotateZ:Wo,scale:Go,sign:Ae,splitContent:si,splitTextToRow:mi,splitWords:ei,stringLength:oi,stringWidth:ri,toDegree:C,toRadian:w,translate:Uo,translateToSVGStyles:mo,trim:Fn,wrap:pe});"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function Jo(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Ko=$o;function $o(e,n,i){var o,s,a,h,l,c=e.length,A=is(e[0],n),f=[];for(i||(i=[]),o=1;o<c;o++){for(s=e[o-1],h=l=is(a=e[o],n);;){if(!(A|h)){f.push(s),h!==l?(f.push(a),o<c-1&&(i.push(f),f=[])):o===c-1&&f.push(a);break}if(A&h)break;A?A=is(s=ts(s,a,A,n),n):h=is(a=ts(s,a,h,n),n)}A=l}return f.length&&i.push(f),i}function ts(e,n,i,o){return 8&i?[e[0]+(n[0]-e[0])*(o[3]-e[1])/(n[1]-e[1]),o[3]]:4&i?[e[0]+(n[0]-e[0])*(o[1]-e[1])/(n[1]-e[1]),o[1]]:2&i?[o[2],e[1]+(n[1]-e[1])*(o[2]-e[0])/(n[0]-e[0])]:1&i?[o[0],e[1]+(n[1]-e[1])*(o[0]-e[0])/(n[0]-e[0])]:null}function is(e,n){var i=0;return e[0]<n[0]?i|=1:e[0]>n[2]&&(i|=2),e[1]<n[1]?i|=4:e[1]>n[3]&&(i|=8),i}$o.polyline=$o,$o.polygon=function(e,n){var i,o,s,a,h,l,c;for(o=1;o<=8;o*=2){for(i=[],a=!(is(s=e[e.length-1],n)&o),h=0;h<e.length;h++)(c=!(is(l=e[h],n)&o))!==a&&i.push(ts(s,l,o,n)),c&&i.push(l),s=l,a=c;if(!(e=i).length)break}return i};var os=Jo(Ko),as=1/0,hs=1/0,ls=-1/0,us=-1/0;function cs(){return[as,hs,ls,us]}var As=cs();function ds(e){e[0]=as,e[1]=hs,e[2]=ls,e[3]=us}function ps(e,n){if(e)if(Array.isArray(e[0]))for(var i=0,o=e.length;i<o;i++)ps(e[i],n);else if(Array.isArray(e))for(var s=0,a=e.length;s<a;s++){var{x:h,y:l}=e[s];n[0]=Math.min(h,n[0]),n[1]=Math.min(l,n[1]),n[2]=Math.max(h,n[2]),n[3]=Math.max(l,n[3])}else{var{x:c,y:A}=e;n[0]=Math.min(c,n[0]),n[1]=Math.min(A,n[1]),n[2]=Math.max(c,n[2]),n[3]=Math.max(A,n[3])}}function gs(e,n,i,o,s){(0===n||n)&&(Array.isArray(n)&&(i=n[1],o=n[2],s=n[3],n=n[0]),e[0]=Math.min(n,e[0]),e[1]=Math.min(i,e[1]),e[2]=Math.max(o,e[2]),e[3]=Math.max(s,e[3]))}function ms(e){return e&&e[0]!==1/0&&void 0!==e[0]}function ys(e,n=0){e[0]-=n,e[1]-=n,e[2]+=n,e[3]+=n}function vs(e,n){return!(e[2]<n[0])&&(!(e[1]>n[3])&&(!(e[0]>n[2])&&!(e[3]<n[1])))}function xs(e,n){var[i,o,s,a]=e;return i>=n[0]&&s<=n[2]&&o>=n[1]&&a<=n[3]}function bs(e,n){var i=n.bbox;if(!i)return console.error("maskGeoJSON bbox is null:",n),!1;if(vs(i,e)){var o=n.geometry;if(!o)return console.error("maskGeoJSON is error,not find geometry.",n),!1;var{coordinates:s}=o;"Polygon"===o.type&&(s=[s]);for(var a=0,h=s.length;a<h;a++){var l=os.polygon(s[a][0],e);if(l.length>0){for(var c=1/0,A=-1/0,f=1/0,d=-1/0,p=0,g=l.length;p<g;p++){var[v,w]=l[p];c=Math.min(v,c),f=Math.min(w,f),A=Math.max(v,A),d=Math.max(w,d)}if(c!==A&&f!==d)return!0}}return!1}return!1}var ws=Object.freeze({__proto__:null,BBOX_TEMP:As,bboxInBBOX:xs,bboxInMask:bs,bboxIntersect:vs,bufferBBOX:ys,getDefaultBBOX:cs,pointsBBOX:ps,resetBBOX:ds,setBBOX:gs,validateBBOX:ms});function Cs(e,n,i,o){return e[0]=n,e[1]=i,e[2]=o,e}function Ps(e,n,i){return e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e}function Ts(e,n,i){return e[0]=n[0]-i[0],e[1]=n[1]-i[1],e[2]=n[2]-i[2],e}function Ss(e,n,i){return Ts(e,n,i)}function Is(e){var n=e[0],i=e[1],o=e[2];return Math.sqrt(n*n+i*i+o*o)}function Es(e,n){var i=n[0],o=n[1],s=n[2],a=i*i+o*o+s*s;return a>0&&(a=1/Math.sqrt(a),e[0]=n[0]*a,e[1]=n[1]*a,e[2]=n[2]*a),e}function Os(e,n){return e[0]*n[0]+e[1]*n[1]+e[2]*n[2]}function Rs(e,n,i){return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e}function Ds(e,n,i){var o=n[0],s=n[1],a=n[2],h=i[0],l=i[1],c=i[2];return e[0]=s*c-a*l,e[1]=a*h-o*c,e[2]=o*l-s*h,e}function ks(e,n){var i=n[0]-e[0],o=n[1]-e[1],s=n[2]-e[2];return Math.hypot?Math.hypot(i,o,s):function(...e){var n=0,i=e.length;for(;i--;)n+=e[i]*e[i];return Math.sqrt(n)}(i,o,s)}function Ls(e,n){Es(e,e),Es(n,n);var i=Os(e,n);return i>1?0:i<-1?Math.PI:Math.acos(i)}var Ns,zs=function(){function e(e,n){this.normal=e,this.constant=n}return e.prototype.distanceToPoint=function(e){return Os(this.normal,e)+this.constant},e}(),Bs=[0,0,0],Hs=[0,0,0],js=[0,0,0],Us=[0,0,0],Gs=[0,0,0],Vs=new zs([0,0,1],0),qs=function(){function e(e,n){this.setFromTo(e,n)}var n=e.prototype;return n.setFromTo=function(e,n){this.origin=e;var i=this.direction||[0,0,0];this.direction=Es(i,Ss(i,n,e))},n.distanceToPlane=function(e){var n=Os(e.normal,this.direction);if(0===n)return 0===e.distanceToPoint(this.origin)?0:null;var i=-(Os(this.origin,e.normal)+e.constant)/n;return i>=0?i:null},n.intersectGround=function(e){return this.intersectPlane(Vs,e)},n.distanceToGround=function(){return this.distanceToPlane(Vs)},n.intersectPlane=function(e,n){var i=this.distanceToPlane(e);return null===i?null:this.at(i,n)},n.intersectBox=function(e,n){var i,o,s,a,h,l,c=1/this.direction[0],A=1/this.direction[1],f=1/this.direction[2],d=this.origin;return c>=0?(i=(e[0][0]-d[0])*c,o=(e[1][0]-d[0])*c):(i=(e[1][0]-d[0])*c,o=(e[0][0]-d[0])*c),A>=0?(s=(e[0][1]-d[1])*A,a=(e[1][1]-d[1])*A):(s=(e[1][1]-d[1])*A,a=(e[0][1]-d[1])*A),i>a||s>o?null:((s>i||isNaN(i))&&(i=s),(a<o||isNaN(o))&&(o=a),f>=0?(h=(e[0][2]-d[2])*f,l=(e[1][2]-d[2])*f):(h=(e[1][2]-d[2])*f,l=(e[0][2]-d[2])*f),i>l||h>o?null:((h>i||i!=i)&&(i=h),(l<o||o!=o)&&(o=l),o<0?null:this.at(i>=0?i:o,n)))},n.intersectTriangle=function(e,n,i,o,s){Ss(Hs,n,e),Ss(js,i,e),Ds(Us,Hs,js);var a,h=Os(this.direction,Us);if(h>0){if(o)return null;a=1}else{if(!(h<0))return null;a=-1,h=-h}Ss(Gs,this.origin,e),Ds(js,Gs,js);var l=a*Os(this.direction,js);if(l<0)return null;Ds(Hs,Hs,Gs);var c=a*Os(this.direction,Hs);if(c<0)return null;if(l+c>h)return null;var A=-a*Os(Gs,Us);return A<0?null:this.at(A/h,s)},n.at=function(e,n){return function(e,n){e[0]=n[0],e[1]=n[1],e[2]=n[2]}(n,this.origin),Ps(n,n,Rs(Bs,this.direction,e))},e}(),Qs=Object.freeze({__proto__:null,Plane:zs,Ray:qs}),Xs="core-fetch-image";var Ys=!1;var Js=[];function Ks(e){return Js.indexOf(e)>-1}function ta(e){Ks(e)||Js.push(e)}var ea={};function na(e,n){ea[e]=n}var ia,ra="\n    var adapters = {};\n    // Dynamic Create Adapter\n    function createAdapter(key,code){\n        if(adapters[key]||!code){\n            return;\n        }\n        var func=new Function('exports',code+'(exports)');\n        var workerExports={};\n        func(workerExports,self);\n        adapters[key]=workerExports;\n        workerExports.initialize && workerExports.initialize(self);\n\n    }\n    onmessage = function (msg) {\n        msg = msg.data;\n        //createAdapter\n        if (msg.messageType === 'createAdapter') {\n           var key=msg.key;\n           var code=msg.code;\n           createAdapter(key,code);\n           postMessage({adapterName:key});\n           return;\n        }\n        // postMessage when main thread idle\n        if(msg.messageType==='idle'){\n            var messageRatio = msg.messageRatio;\n            handleMessageQueue(messageRatio);\n            return;\n        }\n        if (msg.messageType === 'batch') {\n            const messages = msg.messages;\n            if (messages) {\n                for (let i = 0; i < messages.length; i++) {\n                    dispatch(messages[i]);\n                }\n            }\n        } else {\n            dispatch(msg);\n        }\n    };\n\n    function dispatch(msg) {\n        var workerKey = msg.workerKey;\n        var adapter = adapters[workerKey];\n        if (!adapter) {\n            post(msg.callback, 'Unregistered worker adapters for ' + workerKey);\n            return;\n        }\n        try {\n            adapter.onmessage(msg, wrap(msg.callback));\n        } catch (err) {\n            post(msg.callback, workerKey + ':' + err.message);\n            console.error(err);\n            throw err;\n        }\n    }\n\n    var messageResultQueue = [];\n\n    function handleMessageQueue(messageRatio){\n       if(messageResultQueue.length===0){\n          return;\n       }\n       var count = Math.ceil((messageRatio || 1) * messageResultQueue.length);\n       var queues = messageResultQueue.slice(0, count);\n       queues.forEach(function(queue){\n          post(queue.callback,queue.err,queue.data,queue.buffers);\n       });\n       messageResultQueue=messageResultQueue.slice(count, Infinity);\n    }\n\n    function post(callback, err, data, buffers) {\n        var msg = {\n            callback : callback\n        };\n        if (err) {\n            msg.error = err;\n        } else {\n            msg.data = data;\n        }\n        if (buffers && buffers.length > 0) {\n            postMessage(msg, buffers);\n        } else {\n            postMessage(msg);\n        }\n    }\n\n    function joinQueue(callback,err,data,buffers){\n        messageResultQueue.push({\n            callback:callback,\n            err:err,\n            data:data,\n            buffers:buffers\n        });\n    }\n\n    function wrap(callback) {\n        return function (err, data, buffers) {\n            joinQueue(callback, err, data, buffers);\n        };\n    }\n    var workerExports;\n",oa="\n    workerExports = null;\n";function sa(){if("undefined"==typeof window)return null;if(!ia){var e=function(){var e=ra;for(var n in ea){var i=ea[n];ta(n),d(i)&&0===i.length&&(i=i()),e+="\n    workerExports = {};\n    ("+i+")(workerExports, self);\n    adapters['"+n+"'] = workerExports",e+="\n    workerExports.initialize && workerExports.initialize(self);\n        "}return e+oa}();ia=window.URL.createObjectURL(new Blob([e],{type:"text/javascript"})),ea={}}return ia}function aa(e,n){if(ea[e]){var i=ea[e];d(i)&&0===i.length&&(i=i()),i="("+i+")";if(Ns){var o=Ns.workers||[];0===o.length&&console.error("workerpool workers count is 0");var s=0,a=function i(a){(a=a.data||{}).adapterName===e&&++s===o.length&&(o.forEach((function(e){e.removeEventListener("message",i)})),delete ea[e],n())};o.forEach((function(n){n.addEventListener("message",a),n.postMessage({key:e,code:i,messageType:"createAdapter"})}))}}else console.error("not find "+e+" adapter")}var ha,la="undefined"!=typeof window?window.navigator.hardwareConcurrency||4:0,ua=Math.max(Math.floor(la/2),1),ca=function(){function e(e=50){this._limit=e,this._messages=[],this.buffers=[]}var n=e.prototype;return n.addMessage=function(e,n){if(this._messages.push(e),Array.isArray(n))for(var i=0;i<n.length;i++)this.buffers.indexOf(n[i])<0&&this.buffers.push(n[i])},n.isFull=function(){return this._messages.length>=this._limit},n.getMessage=function(){return{messageType:"batch",messages:this._messages}},e}(),Aa=function(){function e(){this.active={},this.workerCount="undefined"!=typeof window?o.workerCount||ua:0,this._messages=[],this._messageBuffers=[]}var n=e.prototype;return n.acquire=function(e){if(!this.workers){this.workers=[];for(var n=sa(),i=0;i<this.workerCount;i++){var o=new Worker(n);o.id=i,this.workers.push(o)}URL.revokeObjectURL(n),Ys=!0}return this.active[e]=!0,this.workers.slice()},n.release=function(e){delete this.active[e],0===Object.keys(this.active).length&&(this.workers.forEach((function(e){e.terminate()})),this.workers=null)},n.addMessage=function(e,n,i){var o=this._messages[e];o&&o.length||(o=this._messages[e]=[new ca]);var s=o[o.length-1];s.isFull()&&(s=new ca,this._messages[e].push(s)),s.addMessage(n,i)},n.commit=function(){if(this.workers&&this._messages.length)for(var e=0;e<this._messages.length;e++)if(this._messages[e]&&this._messages[e].length){var n=this._messages[e].shift();this.workers[e].postMessage(n.getMessage(),n.buffers)}},n.getWorkers=function(){return this.workers||[]},n.broadcastIdleMessage=function(e){return this.getWorkers().forEach((function(n){n.postMessage({messageType:"idle",messageRatio:e})})),this},e}();function fa(){return ha||(ha=new Aa,Ns=ha),ha}var da=[],pa=[];function ma(e){return wa(),new Promise((function(n,i){if(e)if(d(e)&&(e={count:1,run:e}),e.run)if(h(e.count)&&(e.count=1),e.count=Math.ceil(e.count),l(e.count)){var o=e;o.results=[],da.push(o),o.resolve=n}else i(new Error("task.count is not number"));else i(new Error("task.run is null"));else i(new Error("task is null"))}))}function ya(e){var n=o.messagePostRatioPerWorker*(e?.5:1);fa().commit(),fa().broadcastIdleMessage(n),function(){if(0!==da.length){for(var e=[],n=[],i=da.length,o=0;o<i;o++){var s=da[o];if(s.count--,-1===s.count)n.push(s);else{e.push(s);var a=s.run();s.results.push(a)}}da=e,i=n.length;for(var h=0;h<i;h++){var l=n[h];l.resolve&&l.resolve(l.results)}}}(),pa.forEach((function(e){e()}))}var va=s();function _a(){ya(),va=s(),requestIdleCallback(_a)}function xa(){if(wt.requestIdleCallback){var{idleForceTimeThreshold:e,idleLog:n}=o;s()-va>e&&(ya(!0),va=s(),n&&console.warn("did not apply for availability, forced run idle"))}else ya();Kt(xa)}var ba=!1;function wa(){ba||(ba=!0,wt.requestIdleCallback&&requestIdleCallback(_a),Kt(xa))}function Ca(e){pa.indexOf(e)>-1||d(e)&&pa.push(e)}var Pa,Ma=Object.freeze({__proto__:null,pushLoopHook:Ca,runTaskAsync:ma,startTasks:wa}),Sa="function"==typeof Map,Ia=function(){},Ea=function(){function e(e,n){this.max=e,this.onRemove=n||Ia,this.reset()}var n=e.prototype;return n.reset=function(){for(var e in this.data)this.onRemove(this.data[e]);return this.data={},this.order=[],this},n.clear=function(){this.reset(),delete this.onRemove},n.add=function(e,n){if(this.has(e))this.order.splice(this.order.indexOf(e),1),this.data[e]=n,this.order.push(e);else if(this.data[e]=n,this.order.push(e),this.order.length>this.max){var i=this.getAndRemove(this.order[0]);i&&this.onRemove(i)}return this},n.has=function(e){return e in this.data},n.keys=function(){return this.order},n.getAndRemove=function(e){if(!this.has(e))return null;var n=this.data[e];return delete this.data[e],this.order.splice(this.order.indexOf(e),1),n},n.get=function(e){return this.has(e)?this.data[e]:null},n.remove=function(e){if(!this.has(e))return this;var n=this.data[e];return delete this.data[e],this.onRemove(n),this.order.splice(this.order.indexOf(e),1),this},n.setMaxSize=function(e){for(this.max=e;this.order.length>this.max;){var n=this.getAndRemove(this.order[0]);n&&this.onRemove(n)}return this},e}();Sa&&(Pa=function(){function e(e,n){this.max=e,this.onRemove=n||Ia,this.reset()}var n=e.prototype;return n.reset=function(){if(this.data)for(var e,n=Xt(this.data.values());!(e=n()).done;){this.onRemove(e.value)}return this.data=new Map,this},n.clear=function(){this.reset(),delete this.onRemove},n.add=function(e,n){return n?(this.has(e)?(this.data.delete(e),this.data.set(e,n)):this.data.set(e,n),this):this},n.keys=function(){for(var e,n=new Array(this.data.size),i=0,o=Xt(this.data.keys());!(e=o()).done;){n[i++]=e.value}return n},n.shrink=function(){for(var e=this.data.keys(),n=e.next();this.data.size>this.max;){var i=this.getAndRemove(n.value);i&&this.onRemove(i),n=e.next()}},n.has=function(e){return this.data.has(e)},n.getAndRemove=function(e){if(!this.has(e))return null;var n=this.data.get(e);return this.data.delete(e),n},n.get=function(e){return this.has(e)?this.data.get(e):null},n.remove=function(e){if(!this.has(e))return this;var n=this.data.get(e);return this.data.delete(e),this.onRemove(n),this},n.setMaxSize=function(e){return this.max=e,this.data.size>this.max&&this.shrink(),this},e}());var Oa=Sa?Pa:Ea,Ra={exports:{}},Da={exports:{}};!function(e,n){e.exports=function(){function e(e,i,s,a,h){n(e,i,s||0,a||e.length-1,h||o)}function n(e,o,s,a,h){for(;a>s;){if(a-s>600){var l=a-s+1,c=o-s+1,A=Math.log(l),f=.5*Math.exp(2*A/3),d=.5*Math.sqrt(A*f*(l-f)/l)*(c-l/2<0?-1:1);n(e,o,Math.max(s,Math.floor(o-c*f/l+d)),Math.min(a,Math.floor(o+(l-c)*f/l+d)),h)}var p=e[o],g=s,v=a;for(i(e,s,o),h(e[a],p)>0&&i(e,s,a);g<v;){for(i(e,g,v),g++,v--;h(e[g],p)<0;)g++;for(;h(e[v],p)>0;)v--}0===h(e[s],p)?i(e,s,v):i(e,++v,a),v<=o&&(s=v+1),o<=v&&(a=v-1)}}function i(e,n,i){var o=e[n];e[n]=e[i],e[i]=o}function o(e,n){return e<n?-1:e>n?1:0}return e}()}(Da);var ka=Da.exports;Ra.exports=Na,Ra.exports.default=Na;var Fa=ka;function Na(e,n){if(!(this instanceof Na))return new Na(e,n);this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),n&&this._initFormat(n),this.clear()}function za(e,n,i){if(!i)return n.indexOf(e);for(var o=0;o<n.length;o++)if(i(e,n[o]))return o;return-1}function Ba(e,n){Ha(e,0,e.children.length,n,e)}function Ha(e,n,i,o,s){s||(s=Ya(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(var a,h=n;h<i;h++)a=e.children[h],ja(s,e.leaf?o(a):a);return s}function ja(e,n){return e.minX=Math.min(e.minX,n.minX),e.minY=Math.min(e.minY,n.minY),e.maxX=Math.max(e.maxX,n.maxX),e.maxY=Math.max(e.maxY,n.maxY),e}function Ua(e,n){return e.minX-n.minX}function Ga(e,n){return e.minY-n.minY}function Va(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function Wa(e){return e.maxX-e.minX+(e.maxY-e.minY)}function qa(e,n){return(Math.max(n.maxX,e.maxX)-Math.min(n.minX,e.minX))*(Math.max(n.maxY,e.maxY)-Math.min(n.minY,e.minY))}function Za(e,n){var i=Math.max(e.minX,n.minX),o=Math.max(e.minY,n.minY),s=Math.min(e.maxX,n.maxX),a=Math.min(e.maxY,n.maxY);return Math.max(0,s-i)*Math.max(0,a-o)}function Qa(e,n){return e.minX<=n.minX&&e.minY<=n.minY&&n.maxX<=e.maxX&&n.maxY<=e.maxY}function Xa(e,n){return n.minX<=e.maxX&&n.minY<=e.maxY&&n.maxX>=e.minX&&n.maxY>=e.minY}function Ya(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Ja(e,n,i,o,s){for(var a,h=[n,i];h.length;)(i=h.pop())-(n=h.pop())<=o||(a=n+Math.ceil((i-n)/o/2)*o,Fa(e,a,n,i,s),h.push(n,a,a,i))}Na.prototype={all:function(){return this._all(this.data,[])},search:function(e){var n=this.data,i=[],o=this.toBBox;if(!Xa(e,n))return i;for(var s,a,h,l,c=[];n;){for(s=0,a=n.children.length;s<a;s++)h=n.children[s],Xa(e,l=n.leaf?o(h):h)&&(n.leaf?i.push(h):Qa(e,l)?this._all(h,i):c.push(h));n=c.pop()}return i},collides:function(e){var n=this.data,i=this.toBBox;if(!Xa(e,n))return!1;for(var o,s,a,h,l=[];n;){for(o=0,s=n.children.length;o<s;o++)if(a=n.children[o],Xa(e,h=n.leaf?i(a):a)){if(n.leaf||Qa(e,h))return!0;l.push(a)}n=l.pop()}return!1},load:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var n=0,i=e.length;n<i;n++)this.insert(e[n]);return this}var o=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===o.height)this._splitRoot(this.data,o);else{if(this.data.height<o.height){var s=this.data;this.data=o,o=s}this._insert(o,this.data.height-o.height-1,!0)}else this.data=o;return this},insert:function(e){return e&&this._insert(e,this.data.height-1),this},clear:function(){return this.data=Ya([]),this},remove:function(e,n){if(!e)return this;for(var i,o,s,a,h=this.data,l=this.toBBox(e),c=[],A=[];h||c.length;){if(h||(h=c.pop(),o=c[c.length-1],i=A.pop(),a=!0),h.leaf&&-1!==(s=za(e,h.children,n)))return h.children.splice(s,1),c.push(h),this._condense(c),this;a||h.leaf||!Qa(h,l)?o?(i++,h=o.children[i],a=!1):h=null:(c.push(h),A.push(i),i=0,o=h,h=h.children[0])}return this},toBBox:function(e){return e},compareMinX:Ua,compareMinY:Ga,toJSON:function(){return this.data},fromJSON:function(e){return this.data=e,this},_all:function(e,n){for(var i=[];e;)e.leaf?n.push.apply(n,e.children):i.push.apply(i,e.children),e=i.pop();return n},_build:function(e,n,i,o){var s,a=i-n+1,h=this._maxEntries;if(a<=h)return Ba(s=Ya(e.slice(n,i+1)),this.toBBox),s;o||(o=Math.ceil(Math.log(a)/Math.log(h)),h=Math.ceil(a/Math.pow(h,o-1))),(s=Ya([])).leaf=!1,s.height=o;var l,c,A,f,d=Math.ceil(a/h),p=d*Math.ceil(Math.sqrt(h));for(Ja(e,n,i,p,this.compareMinX),l=n;l<=i;l+=p)for(Ja(e,l,A=Math.min(l+p-1,i),d,this.compareMinY),c=l;c<=A;c+=d)f=Math.min(c+d-1,A),s.children.push(this._build(e,c,f,o-1));return Ba(s,this.toBBox),s},_chooseSubtree:function(e,n,i,o){for(var s,a,h,l,c,A,f,d;o.push(n),!n.leaf&&o.length-1!==i;){for(f=d=1/0,s=0,a=n.children.length;s<a;s++)c=Va(h=n.children[s]),(A=qa(e,h)-c)<d?(d=A,f=c<f?c:f,l=h):A===d&&c<f&&(f=c,l=h);n=l||n.children[0]}return n},_insert:function(e,n,i){var o=i?e:(0,this.toBBox)(e),s=[],a=this._chooseSubtree(o,this.data,n,s);for(a.children.push(e),ja(a,o);n>=0&&s[n].children.length>this._maxEntries;)this._split(s,n),n--;this._adjustParentBBoxes(o,s,n)},_split:function(e,n){var i=e[n],o=i.children.length,s=this._minEntries;this._chooseSplitAxis(i,s,o);var a=this._chooseSplitIndex(i,s,o),h=Ya(i.children.splice(a,i.children.length-a));h.height=i.height,h.leaf=i.leaf,Ba(i,this.toBBox),Ba(h,this.toBBox),n?e[n-1].children.push(h):this._splitRoot(i,h)},_splitRoot:function(e,n){this.data=Ya([e,n]),this.data.height=e.height+1,this.data.leaf=!1,Ba(this.data,this.toBBox)},_chooseSplitIndex:function(e,n,i){var o,s,a,h,l,c,A,f;for(c=A=1/0,o=n;o<=i-n;o++)h=Za(s=Ha(e,0,o,this.toBBox),a=Ha(e,o,i,this.toBBox)),l=Va(s)+Va(a),h<c?(c=h,f=o,A=l<A?l:A):h===c&&l<A&&(A=l,f=o);return f},_chooseSplitAxis:function(e,n,i){var o=e.leaf?this.compareMinX:Ua,s=e.leaf?this.compareMinY:Ga;this._allDistMargin(e,n,i,o)<this._allDistMargin(e,n,i,s)&&e.children.sort(o)},_allDistMargin:function(e,n,i,o){e.children.sort(o);var s,a,h=this.toBBox,l=Ha(e,0,n,h),c=Ha(e,i-n,i,h),A=Wa(l)+Wa(c);for(s=n;s<i-n;s++)a=e.children[s],ja(l,e.leaf?h(a):a),A+=Wa(l);for(s=i-n-1;s>=n;s--)a=e.children[s],ja(c,e.leaf?h(a):a),A+=Wa(c);return A},_adjustParentBBoxes:function(e,n,i){for(var o=i;o>=0;o--)ja(n[o],e)},_condense:function(e){for(var n,i=e.length-1;i>=0;i--)0===e[i].children.length?i>0?(n=e[i-1].children).splice(n.indexOf(e[i]),1):this.clear():Ba(e[i],this.toBBox)},_initFormat:function(e){var n=["return a"," - b",";"];this.compareMinX=new Function("a","b",n.join(e[0])),this.compareMinY=new Function("a","b",n.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}};var Ka=Jo(Ra.exports),$a={},eh=function(){function e(){this._tree=Ka(9,["[0]","[1]","[2]","[3]"])}var n=e.prototype;return n.collides=function(e){return[$a.minX,$a.minY,$a.maxX,$a.maxY]=e,this._tree.collides($a)},n.insertBox=function(e){return this._tree.insert(e),this},n.bulkInsertBox=function(e){return this._tree.load(e),this},n.clear=function(){return this._tree.clear(),this},e}(),nh=new Oa(5e4);function ih(e,n,i){var o=e.font,s=e.fillStyle,a=e.strokeStyle,h=n.textHaloFill||rh,c=n.textHaloRadius||0,A=n.textHaloOpacity;l(A)||(A=1);var f=o+"_"+s+"_"+h+"_"+c+"_"+A+"_"+i,d=nh.get(f);if(!d){var p=0!==A&&0!==c,g=2*(1.2*(n.textSize||14)+c),v=_h.createCanvas(g,g);v.style.width=g/2+"px",v.style.height=g/2+"px";var w=g/4,C=g/4,P=_h.getCanvas2DContext(v);P.scale(2,2),P.font=o,P.textAlign="center",P.textBaseline="middle",p&&(P.strokeStyle=a,P.lineWidth=2*c,P.globalAlpha=1,P.globalAlpha*=A,P.strokeText(i,w,C),P.globalAlpha=1),P.fillStyle=s,P.fillText(i,w,C),nh.add(f,d=v)}return d}var rh="#000",oh=!1,sh=null,ah=Math.PI/180,hh=new eh,lh=new eh;var uh=function(){for(var e={},n=32;n<128;n++){var i=String.fromCharCode(n);e[i]=i}return e}();function ch(e){if(e.toReversed)return e.toReversed();for(var n=[],i=0,o=e.length-1;i<=o;i++)n[i]=e[o-i];return n}function Ah(e,n,i,o,s){var a=Math.atan2(n.y-e.y,n.x-e.x),h=a/Math.PI*180;return"left"===o?a=(h+=180)/180*Math.PI:"down"!==o||s?"up"!==o||s?a:a=(h+=90)/180*Math.PI:a=(h-=90)/180*Math.PI}function fh(e,n){var i=n,o=n;return uh[e]&&(i=n/4,o=n),Math.sqrt(i*i+o*o)}function dh(e,n){var{distance:i,p1:o,p2:s}=e,a=n/i;return new ee(o.x+a*(s.x-o.x),o.y+a*(s.y-o.y),(o.z||0)+a*((s.z||0)-(o.z||0)))}function ph(e){for(var n=e[0].point,i=e[e.length-1].point,o=cs(),s=0,a=e.length;s<a;s++){ps(e[s].point,o)}var[h,l,c,A]=o,f=!0;return A-l>c-h&&(f=!1),f?n.x<i.x?"right":"left":n.y<i.y?"down":"up"}function gh(e,n,i,o){var s=yh(e),a=[],h=0,l=!1;hh.clear();for(var c=1,A=0,f=n.length;A<f;A++){for(var d=n[A],p=fh(d,i),g=p+h,v=c,w=e.length;v<w;v++){var C=e[v-1],P=e[v];if(!(P.distance<g)){c=v;var T=(g-C.distance)/(P.distance-C.distance),S=new ee(C.x+(P.x-C.x)*T,C.y+(P.y-C.y)*T),{x:I,y:E}=S,O=p/3,k=[I-O,E-O,I+O,E+O];if(o&&o.collides(k)){l=!0;break}if(hh.collides(k)){l=!0;break}hh.insertBox(k),a.push({char:d,charSize:p,point:S,bbox:[I-(O=p/2),E-O,I+O,E+O]}),h+=p;break}}if(l)break}return l||s<h?[]:a}function mh(e,n,i,o,s,a,h,l,c,A){var f=(e+i)/2,d=(n+o)/2,p=(i+s)/2,g=(o+a)/2,v=(s+h)/2,w=(a+l)/2,C=Math.sqrt((i-e)*(i-e)+(o-n)*(o-n)),P=Math.sqrt((s-i)*(s-i)+(a-o)*(a-o)),T=C/(C+P),S=P/(P+Math.sqrt((h-s)*(h-s)+(l-a)*(l-a))),I=f+(p-f)*T,E=d+(g-d)*T,O=p+(v-p)*S,k=g+(w-g)*S,L=I+(p-I)*c+i-I,F=E+(g-E)*c+o-E,N=O+(p-O)*c+s-O,z=k+(g-k)*c+a-k,H=[L,F,N,z];return A<1?function(e,n,i,o,s,a,h,l,c,A){var f=1-e,d=1-n,p=i*d*d+2*s*n*d+h*n*n,g=s*d*d+2*h*n*d+c*n*n,v=o*d*d+2*a*n*d+l*n*n,w=a*d*d+2*l*n*d+A*n*n;return[(i*f*f+2*s*e*f+h*e*e)*d+(s*f*f+2*h*e*f+c*e*e)*n,(o*f*f+2*a*e*f+l*e*e)*d+(a*f*f+2*l*e*f+A*e*e)*n,p*f+g*e,v*f+w*e,p*d+g*n,v*d+w*n]}(0,A,i,o,L,F,N,z,s,a):H}function yh(e){if(e.length<2)return 0;var n=0;e[0].distance=0;for(var i=1,o=e.length;i<o;i++){var s=e[i-1],a=e[i],h=s.distanceTo(a);a.distance=h+s.distance,n+=h}return n}function vh(e,n,i){var o=e.x,s=e.y;return new ee(o+(n.x-o)*i,s+(n.y-s)*i)}var _h={getCanvas2DContext:function(e){return e.getContext("2d",{willReadFrequently:!0})},setHitTesting:function(e){oh=e},createCanvas:function(e,i,o){var s;return n?s=new o(e,i):((s=Pi("canvas")).width=e,s.height=i),s},prepareCanvasFont:function(e,n){"top"!==e.textBaseline&&(e.textBaseline="top");var i=gi(n);e.font!==i&&(e.font=i);var o=n.textFill;o||(o="#000");var s=_h.getRgba(o,n.textOpacity);e.fillStyle!==s&&(e.fillStyle=s)},prepareCanvas:function(e,n,i,o){if(n){var s=n.lineWidth;h(s)||e.lineWidth===s||(e.lineWidth=s);var a=n.linePatternFile,l=n.lineColor||rh;if(o)e.strokeStyle="#000";else if(a&&i){var c;(n.linePatternDx||n.linePatternDy)&&(c=[n.linePatternDx,n.linePatternDy]),_h._setStrokePattern(e,a,s,c,i),n.lineDasharray=[]}else Mo(l)?e.strokeStyle=n.lineGradientExtent?_h._createGradient(e,l,n.lineGradientExtent):rh:(Array.isArray(l)&&(l=_h.normalizeColorToRGBA(l)),e.strokeStyle=l);n.lineJoin&&(e.lineJoin=n.lineJoin),n.lineCap&&(e.lineCap=n.lineCap),e.setLineDash&&xe(n.lineDasharray)&&e.setLineDash(n.lineDasharray);var A=n.polygonPatternFile,f=n.polygonFill||"rgba(255,255,255,0)";if(o)e.fillStyle="#000";else if(A&&i){var d=wh(A),p=i.getImage([d,null,null]);if(p||(p=i.getImage([d+"-texture",null,s])),ne(d)&&p instanceof Image&&(wt.edge||wt.ie)){var g=p.width||20,v=p.height||20,w=_h.createCanvas(g,v);_h.image(w.getContext("2d"),p,0,0,g,v),p=w}p?(e.fillStyle=e.createPattern(p,"repeat"),(n.polygonPatternDx||n.polygonPatternDy)&&(e.fillStyle.polygonPatternOffset=[n.polygonPatternDx,n.polygonPatternDy])):"undefined"!=typeof console&&console.warn("img not found for",d)}else Mo(f)?e.fillStyle=n.polygonGradientExtent?_h._createGradient(e,f,n.polygonGradientExtent):"rgba(255,255,255,0)":(Array.isArray(f)&&(f=_h.normalizeColorToRGBA(f)),e.fillStyle=f)}},_createGradient:function(e,n,i){var o=null,s=n.places,a=i.getMin(),h=i.getMax(),l=i.getWidth(),c=i.getHeight();if(n.type&&"linear"!==n.type){if("radial"===n.type){if(s){if(6!==s.length)throw new Error("A radial gradient's places should have 6 numbers.");s=[a.x+s[0]*l,a.y+s[1]*c,l*s[2],a.x+s[3]*l,a.y+s[4]*c,l*s[5]]}else{var A=i.getCenter()._round();s=[A.x,A.y,Math.abs(A.x-a.x),A.x,A.y,0]}o=e.createRadialGradient.apply(e,s)}}else{if(s){if(4!==s.length)throw new Error("A linear gradient's places should have 4 numbers.");s=[a.x+s[0]*l,a.y+s[1]*c,a.x+s[2]*l,a.y+s[3]*c]}else s=[a.x,a.y,h.x,a.y];o=e.createLinearGradient.apply(e,s)}return n.colorStops.forEach((function(e){o.addColorStop.apply(o,e)})),o},_setStrokePattern:function(e,i,o,s,a){var h,l=wh(i);if(n)h=a.getImage([l,null,o]);else{var c=l+"-texture-"+o;if(!(h=a.getImage(c))){var A=a.getImage([l,null,null]);if(A){var f;f=A.width&&A.height?Math.round(A.width*o/A.height):o;var d=_h.createCanvas(f,o,e.canvas.constructor);_h.image(d.getContext("2d"),A,0,0,f,o),a.addResource([c,null,o],d),h=d}}}h?(e.strokeStyle=e.createPattern(h,"repeat"),e.strokeStyle.linePatternOffset=s):"undefined"!=typeof console&&console.warn("img not found for",l)},clearRect:function(e,n,i,o,s){e.canvas._drawn=!1,e.clearRect(n,i,o,s)},fillCanvas:function(e,n,i,o){if(oh&&(n=1),e.canvas._drawn=!0,0!==n){var s,a=_h._isPattern(e.fillStyle),l=e.fillStyle&&e.fillStyle.polygonPatternOffset,c=l?l[0]:0,A=l?l[1]:0;h(n)&&(n=1),n<1&&(s=e.globalAlpha,e.globalAlpha*=n),a&&e.translate((i=i||0)+c,(o=o||0)+A),e.fill(),a&&e.translate(-i-c,-o-A),n<1&&(e.globalAlpha=s)}},getRgba:function(e,n){return h(n)&&(n=1),"#"!==e[0]?(Array.isArray(e)&&(e=_h.normalizeColorToRGBA(e,n)),e):(7===e.length?(i=parseInt(e.substring(1,3),16),o=parseInt(e.substring(3,5),16),s=parseInt(e.substring(5,7),16)):(i=17*parseInt(e.substring(1,2),16),o=17*parseInt(e.substring(2,3),16),s=17*parseInt(e.substring(3,4),16)),"rgba("+i+","+o+","+s+","+n+")");var i,o,s},normalizeColorToRGBA:function(e,n=1){return"rgba("+255*e[0]+", "+255*e[1]+", "+255*e[2]+", "+(4===e.length?e[3]:1)*n+")"},image:function(e,n,i,o,s,a){e.canvas._drawn=!0;try{l(s)&&l(a)?e.drawImage(n,i,o,s,a):e.drawImage(n,i,o)}catch(e){console&&(console.warn("error when drawing image on canvas:",e),console.warn(n))}},text:function(e,n,i,o,s){return _h._textOnMultiRow(e,s.rows,o,i,s.size,s.rawSize)},_textOnMultiRow:function(e,n,i,o,s,a){var h,l,c=ci(s,i.textHorizontalAlignment,i.textVerticalAlignment),A=a.height+i.textLineSpacing,f=o.add(0,c.y),d=i.textMaxHeight,p=0;ds(As);for(var g=0,v=n.length;g<v;g++){h=n[g].text,l=ci(n[g].size,i.textHorizontalAlignment,i.textVerticalAlignment);var w=f.add(l.x,g*A);_h._textOnLine(e,h,w,i.textHaloRadius,i.textHaloFill,i.textHaloOpacity);var C=n[g].size,P=w.x,T=w.y;if(gs(As,P,T,P+C.width,T+C.height),d>0&&(p+=A)+C.height>=d)break}return As},_textOnLine:function(e,n,i,o,s,a){oh&&(a=1);var h,l,c=0!==a&&0!==o;e.textBaseline="top";var A=e.shadowBlur,f=e.shadowOffsetX,d=e.shadowOffsetY;if(c){var p=e.globalAlpha;e.globalAlpha*=a,e.miterLimit=2,e.lineJoin="round",e.lineCap="round",e.lineWidth=2*o,Array.isArray(s)&&(s=_h.normalizeColorToRGBA(s)),e.strokeStyle=s,e.strokeText(n,i.x,i.y+1),e.miterLimit=10,e.globalAlpha=p,h=e.globalCompositeOperation,e.globalCompositeOperation="destination-out",l=e.fillStyle,e.fillStyle="#000"}A&&c&&(e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0),_h.fillText(e,n,i),h&&(e.globalCompositeOperation=h,_h.fillText(e,n,i,l),A&&(e.shadowBlur=A,e.shadowOffsetX=f,e.shadowOffsetY=d))},fillText:function(e,n,i,o){e.canvas._drawn=!0,o&&(e.fillStyle=o),e.fillText(n,i.x,i.y+1)},textAlongLine:function(e,n,i,o,s,a){if(n){var h=o.textSize||14,c=o.textSpacing||0,A=function(e,n){for(var i=0,o=0,s=e.length;o<s;o++)i+=fh(e[o],n);return i}(n,h);if(!(c<A)){Array.isArray(i[0])||(i=[i]);var f=e.textBaseline,d=e.textAlign,p=e.strokeStyle,g=e.globalAlpha,v=e.lineWidth,w=o.textAlongDebug,C=o.textHaloFill||rh,P=o.textHaloRadius||0,T=o.textHaloOpacity;l(T)||(T=1);var S=0!==T&&0!==P;e.textBaseline="middle",e.textAlign="center",S&&(Array.isArray(C)&&(C=_h.normalizeColorToRGBA(C)),e.strokeStyle=C,e.lineWidth=2*P),lh.clear();var I=cs(),E=n.split(""),O=function(e){for(var n=0,i=e.length;n<i;n++)if(!uh[e[n]])return!1;return!0}(E);if(i.forEach((function(n){if(!(yh(n)<A)){var i=function(e,n){n=Object.assign({segDistance:1,isGeo:!0},n);for(var i=Math.max(n.segDistance,1e-17),o=[],s=0,a=0,h=0,l=e.length;h<l-1;h++){var c=e[h],A=e[h+1],f=A.distanceTo(c);o[a]={p1:c,distance:f,p2:A},a++,s+=f}if(s<=i)return[{distance:s,points:e}];var d,p=o.length;a=0;for(var g=0,v=[],w=[o[0].p1];a<p;){var{distance:C,p2:P}=o[a];if((g+=C)<i)w.push(P),a++;else if(g!==i){if(g>i){var T=i-(g-C);d=dh(o[a],T),w.push(d),v.push(w),g=0,o[a].p1=d,o[a].distance=C-T,w=[d]}}else w.push(P),g=0,v.push(w),w=[P],a++}w.length&&v.push(w);for(var S=[],I=0,E=v.length;I<E;I++){var O=v[I];S[I]={points:O,distance:yh(O)}}return S}(n,{segDistance:c});if(i&&i.length)for(var s=0,l=i.length;s<l;s++){var f=i[s];if(!(f.distance<A)){var d=f.points;if(w){var p=e.fillStyle;e.fillStyle="red";var{x:g,y:v}=d[0];e.beginPath(),e.fillRect(g-2,v-2,4,4),e.fillStyle=p}var C=E,P=gh(d,C,h,a);if(P.length){var T=ph(P);"left"===T&&(P=gh(d,C=ch(C),h,a)),"up"!==T||O||(P=gh(d,C=ch(C),h,a));for(var S=!1,k=0,L=P.length;k<L;k++){var{bbox:F}=P[k];if(lh.collides(F)){S=!0;break}if(a&&a.collides(F)){S=!0;break}}if(!S)for(var N=0,z=P.length;N<z;N++){var H=void 0,j=void 0;0===N?(H=P[N].point,j=P[1].point):N===z-1?(H=P[z-2].point,j=P[z-1].point):(H=P[N-1].point,j=P[N].point);var W=C[N],{point:q,bbox:Y}=P[N];lh.insertBox(Y),a&&a.insertBox(Y);var{x:J,y:$}=q,it=Ah(H,j,0,T,O);e.save(),e.translate(J,$),e.rotate(it);var rt=ih(e,o,W),{width:ot,height:st}=rt;if(e.drawImage(rt,-ot/4,-st/4,ot/2,st/2),e.restore(),gs(I,Y),w){var at=e.strokeStyle,ht=e.lineWidth;e.strokeStyle="red",e.lineWidth=.5;var[At,ft,gt,vt]=Y;e.beginPath(),e.rect(At,ft,gt-At,vt-ft),e.stroke(),e.lineWidth=ht,e.strokeStyle=at}}}}}}})),e.textBaseline=f,e.textAlign=d,e.strokeStyle=p,e.globalAlpha=g,e.lineWidth=v,ms(I))return I}}},_stroke:function(e,n,i,o){if(oh&&(n=1),e.canvas._drawn=!0,0!==n){var s,a=e.strokeStyle&&e.strokeStyle.linePatternOffset,l=a?a[0]:0,c=a?a[1]:0,A=_h._isPattern(e.strokeStyle)&&(!h(i)&&!h(o)||!h(l)&&!h(c));h(n)&&(n=1),n<1&&(s=e.globalAlpha,e.globalAlpha*=n),A&&e.translate((i=i||0)+l,(o=o||0)+c),e.stroke(),A&&e.translate(-i-l,-o-c),n<1&&(e.globalAlpha=s)}},_gradientPath:function(e,n,i,o,s=!1){if(l(o)||(o=1),oh&&(o=1),0!==o&&0!==e.lineWidth){var a=e.globalAlpha;e.globalAlpha*=o;var h,c,A,f,d,p,g,v=e.lineColorIn,w=function(e){if(l(e.minStep))return e.minStep;for(var n=e.colors||[],i=n.length,o=[],s=0;s<i;s++)o[s]=n[s][0];o.sort((function(e,n){return e-n}));for(var a=1/0,h=1;h<i;h++)a=Math.min(a,o[h]-o[h-1]);return e.minStep=a,a}(v),C=yh(n),P=0,[T,S,I,E]=v.getColor(0);h="rgba("+T+", "+S+", "+I+", "+E+")";var O=n[0];if(A=O.x,f=O.y,s)O.equals(n[n.length-1])||n.push(O);for(var k=i&&Array.isArray(i)&&i.length>1,L=function(){!k&&g&&(e.strokeStyle=c,e.beginPath(),e.moveTo(A,f),e.lineTo(d,p),e.lineTo(g.x,g.y),e.stroke());var n=e.createLinearGradient(A,f,d,p);n.addColorStop(0,h),n.addColorStop(1,c),e.strokeStyle=n,e.beginPath(),e.moveTo(A,f),e.lineTo(d,p),e.stroke(),h=c,A=d,f=p},F=1,N=n.length;F<N;F++){var z=n[F-1],H=n[F];g=n[F+1];var j=H.x,W=H.y,q=H.distanceTo(z)/C;if(q<=w){var[Y,J,$,it]=v.getColor(P+q);c="rgba("+Y+", "+J+", "+$+", "+it+")",d=j,p=W,L()}else{var rt=Math.ceil(q/w);g=H;for(var ot=1;ot<=rt;ot++){var st=Math.min(ot*w,q),[at,ht,At,ft]=v.getColor(P+st);if((c="rgba("+at+", "+ht+", "+At+", "+ft+")")!==h){var gt=vh(z,H,st/q);d=gt.x,p=gt.y,L()}}}P+=q}e.globalAlpha=a}},_path:function(e,n,i,o,s){if(xe(n))for(var a,h=xe(i),l=!0!==s&&_h._isPattern(e.strokeStyle),c=0,A=n.length;c<A;c++)if(a=n[c],!h||e.setLineDash)e.lineTo(a.x,a.y),l&&c>0&&(f(n[c-1],a),e.beginPath(),e.moveTo(a.x,a.y));else if(h){if(c===A-1)break;xh(e,a,n[c+1],i)}function f(n,i){var s=Je(n.x,n.y,i.x,i.y);e.save(),e.rotate(s),_h._stroke(e,o),e.restore()}},path:function(e,n,i,o,s){xe(n)&&(e.lineColorIn?this._gradientPath(e,n,s,i):(e.beginPath(),e.moveTo(n[0].x,n[0].y),_h._path(e,n,s,i)),_h._stroke(e,i))},_multiClip:function(e,n){n&&0!==n.length&&n.forEach((function(n){for(var i=0,o=n.length;i<o;i++){var s=n[i],a=s.x,h=s.y;0===i?e.moveTo(a,h):e.lineTo(a,h),i===o-1&&e.lineTo(a=n[0].x,h=n[0].y)}}))},polygon:function(e,i,o,s,a,h){if(e.isMultiClip)_h._multiClip(e,i);else if(e.isClip)_h._multiClip(e,Array.isArray(i[0])?i:[i]);else if(xe(i)){var l=_h._isPattern(e.strokeStyle),c=xe(a)&&!e.setLineDash||l&&!h;xe(i[0])||(i=[i]);var A=e,f=e.dpr||1,d=1!==f;i.length>1&&!n&&(sh||(sh=_h.createCanvas(1,1)),e.canvas._drawn=!1,sh.width=e.canvas.width,sh.height=e.canvas.height,Ph(e=sh.getContext("2d"),[]),Ph(e,a),Ch(e,A),d&&e.scale(f,f));var p,g,v,w=e.lineColorIn,C=e.lineWidth;if(c){for(e.save(),g=0,v=i.length;g<v;g++)xe(i[g])&&(w&&(e.lineWidth=.1),_h._ring(e,i[g],null,0,!0),p=s,g>0&&(e.globalCompositeOperation="destination-out",p=1),_h.fillCanvas(e,p,i[g][0].x,i[g][0].y),g>0?e.globalCompositeOperation="source-over":v>1&&(e.fillStyle="#fff"),_h._stroke(e,0),e.lineWidth=C,w&&_h._gradientPath(e,i,null,0,!0));e.restore()}var P=e.fillStyle;for(g=0,v=i.length;g<v;g++)xe(i[g])&&(w&&(e.lineWidth=.1),h?(_h.paintSmoothLine(e,i[g],o,h,!0),e.closePath()):_h._ring(e,i[g],a,o),c||(p=s,g>0&&(e.globalCompositeOperation="destination-out",p=1),_h.fillCanvas(e,p,i[g][0].x,i[g][0].y),g>0?e.globalCompositeOperation="source-over":v>1&&(e.fillStyle="#fff")),_h._stroke(e,o),e.lineWidth=C,w&&_h._gradientPath(e,i[g],a,o,!0));if(e.fillStyle!==P&&(e.fillStyle=P),i.length>1&&!n){if(d){var T=1/f;A.scale(T,T)}A.drawImage(sh,0,0),d&&A.scale(f,f),A.canvas._drawn=e.canvas._drawn,Ch(A,e)}}},_ring:function(e,n,i,o,s){var a=_h._isPattern(e.strokeStyle);s||!a||n[0].equals(n[n.length-1])||(n=n.concat([n[0]])),e.beginPath(),e.moveTo(n[0].x,n[0].y),_h._path(e,n,i,o,s),a||e.closePath()},paintSmoothLine_bak:function(e,n,i,o,s,a,h){if(n)if(n.length<=2||!o)_h.path(e,n,i);else{var l,c=n.length,A=s?c:c-1;e.beginPath(),e.moveTo(n[0].x,n[0].y),void 0!==h&&(A-=Math.max(A-a-1,0));for(var f=0;f<A;f++){var d=void 0,p=void 0,g=void 0,v=void 0,w=void 0,C=void 0;f-1<0?s?(d=n[A-1].x,p=n[A-1].y):(d=n[f+1].x,p=n[f+1].y):(d=n[f-1].x,p=n[f-1].y),f+1<c?(g=n[f+1].x,v=n[f+1].y):(g=n[f+1-c].x,v=n[f+1-c].y),f+2<c?(w=n[f+2].x,C=n[f+2].y):s?(w=n[f+2-c].x,C=n[f+2-c].y):(w=n[f].x,C=n[f].y);var P=mh(d,p,n[f].x,n[f].y,g,v,w,C,o,f===A-1?h:1);if(f===A-1&&h>=0&&h<1){e.bezierCurveTo(P[0],P[1],P[2],P[3],P[4],P[5]),n.splice(A-1,c-(A-1)-1);var T=new ee(P[4],P[5]);T.prevCtrlPoint=new ee(P[2],P[3]),n.push(T),c=n.length}else e.bezierCurveTo(P[0],P[1],P[2],P[3],g,v);n[f].nextCtrlPoint=P.slice(0,2),n[f].prevCtrlPoint=l?l.slice(2):null,l=P}!s&&n[1].prevCtrlPoint&&(n[0].nextCtrlPoint=n[1].prevCtrlPoint,delete n[0].prevCtrlPoint),n[c-1].prevCtrlPoint||(n[c-1].prevCtrlPoint=n[c-2].nextCtrlPoint),_h._stroke(e,i)}},paintSmoothLine:function(e,n,i,o,s,a,h){if(n)if(n.length<=2||!o)_h.path(e,n,i);else{var l,c,A=n.length,f=s?A:A-1;e.beginPath(),e.moveTo(n[0].x,n[0].y),void 0!==h&&(f-=Math.max(f-a-1,0));for(var d=0;d<f;d++){var p=void 0,g=void 0,v=void 0,w=void 0,C=void 0,P=void 0;d-1<0?s?(p=n[f-1].x,g=n[f-1].y):(p=n[d+1].x,g=n[d+1].y):(p=n[d-1].x,g=n[d-1].y),d+1<A?(v=n[d+1].x,w=n[d+1].y):(v=n[d+1-A].x,w=n[d+1-A].y),d+2<A?(C=n[d+2].x,P=n[d+2].y):s?(C=n[d+2-A].x,P=n[d+2-A].y):(C=n[d].x,P=n[d].y);var T=n[d],S=mh(p,g,n[d].x,n[d].y,v,w,C,P,o,d===f-1?h:1);if(d===f-1&&h>=0&&h<1){e.bezierCurveTo(S[0],S[1],S[2],S[3],S[4],S[5]),n.splice(f-1,A-(f-1)-1);var I=new ee(S[4],S[5]);n.push(I),A=n.length}else e.bezierCurveTo(S[0],S[1],S[2],S[3],v,w);0===d?(T.arrowNextPoint=T.arrowNextPoint||new ee(0,0),c=S[3],T.arrowNextPoint.x=l=S[2],T.arrowNextPoint.y=c):(T.arrowPrePoint=T.arrowPrePoint||new ee(0,0),T.arrowPrePoint.x=l,T.arrowPrePoint.y=c,l=S[2],c=S[3],d===f-1&&n[d+1]&&(n[d+1].arrowPrePoint=n[d+1].arrowPrePoint||new ee(0,0),n[d+1].arrowPrePoint.x=S[0],n[d+1].arrowPrePoint.y=S[1]))}_h._stroke(e,i)}},_arcBetween:function(e,n,i,o){var s=Math.abs(o),a=n.distanceTo(i),h=Math.abs(a/2/Math.sin(s/2)),l=Math.asin((i.y-n.y)/a);n.x>i.x&&(l=Math.PI-l);var c=l-(90*ah-s/2),A=Math.cos(c)*h,f=Math.sin(c)*h,d=n.x+A,p=n.y+f,g=Math.asin((i.y-p)/h);d>i.x&&(g=Math.PI-g);var v=g+s;if(o<0){g+=Math.PI,v+=Math.PI;var w=(n.x+i.x)/2,C=(n.y+i.y)/2;d=w-(d-w),p=C-(p-C)}e.beginPath(),e.arc(d,p,h,g,v);var P=(v-g)/100,T=Math.cos(g+P)*h+d,S=Math.sin(g+P)*h+p,I=Math.cos(v-P)*h+d,E=Math.sin(v-P)*h+p;return n.arrowNextPoint=n.arrowNextPoint||new ee(0,0),i.arrowPrePoint=i.arrowPrePoint||new ee(0,0),o<0?(n.arrowNextPoint.x=T,n.arrowNextPoint.y=S,i.arrowPrePoint.x=I,i.arrowPrePoint.y=E):(n.arrowNextPoint.x=I,n.arrowNextPoint.y=E,i.arrowPrePoint.x=T,i.arrowPrePoint.y=S),[d,p]},_lineTo:function(e,n){e.lineTo(n.x,n.y)},bezierCurveAndFill:function(e,n,i,o){e.beginPath();var s=n[0];e.moveTo(s.x,s.y);var a=[e];a.push.apply(a,n.splice(1)),_h._bezierCurveTo.apply(_h,a),_h.fillCanvas(e,o),_h._stroke(e,i)},_bezierCurveTo:function(e,n,i,o){e.bezierCurveTo(n.x,n.y,i.x,i.y,o.x,o.y)},ellipse:function(e,n,i,o,s,a,h){e.beginPath(),i===o&&i===s?e.arc(n.x,n.y,i,0,2*Math.PI):e.ellipse?o!==s?(e.ellipse(n.x,n.y,i,o,0,180*ah,360*ah,!1),e.ellipse(n.x,n.y,i,s,0,0,180*ah,!1)):e.ellipse(n.x,n.y,i,o,0,0,360*ah,!1):function(n,i,o,s,a){var h=.5522848,l=o*h,c=s*h,A=a*h;e.moveTo(n-o,i),e.bezierCurveTo(n-o,i-c,n-l,i-s,n,i-s),e.bezierCurveTo(n+l,i-s,n+o,i-c,n+o,i),e.bezierCurveTo(n+o,i+A,n+l,i+a,n,i+a),e.bezierCurveTo(n-l,i+a,n-o,i+A,n-o,i),e.closePath()}(n.x,n.y,i,o,s),_h.fillCanvas(e,h,n.x-i,n.y-o),_h._stroke(e,a,n.x-i,n.y-o)},rectangle:function(e,n,i,o,s){var{x:a,y:h}=n;e.beginPath(),e.rect(a,h,i.width,i.height),_h.fillCanvas(e,s,a,h),_h._stroke(e,o,a,h)},sector:function(e,n,i,o,s,a){var h=ah;function l(e,n,i,o,l,c){var A=h*-c,f=h*-l;e.beginPath(),e.moveTo(n,i),e.arc(n,i,o,A,f),e.lineTo(n,i),_h.fillCanvas(e,a,n-o,i-o),_h._stroke(e,s,n-o,i-o)}l(e,n.x,n.y,i,o[0],o[1])},_isPattern:function(e){return!f(e)&&!("addColorStop"in e)},drawCross:function(e,n,i,o,s){e.canvas._drawn=!0,e.strokeStyle=s,e.lineWidth=o,e.beginPath(),e.moveTo(n-5,i),e.lineTo(n+5,i),e.moveTo(n,i-5),e.lineTo(n,i+5),e.stroke()},copy:function(e,n){var i=n||Pi("canvas");return i.width=e.width,i.height=e.height,i.getContext("2d").drawImage(e,0,0),i},pixelRect:function(e,n,i,o){var s=e.globalAlpha,a=!1;if(e.lineWidth>0&&i>0)a=!0,i<1&&(e.globalAlpha*=i);else{if(!(o>0))return;o<1&&(e.globalAlpha*=o)}e.canvas._drawn=!0,a?e.strokeRect(n[0],n[1],1,1):e.fillRect(n[0],n[1],1,1),e.globalAlpha!==s&&(e.globalAlpha=s)}};function xh(e,n,i,o){var s=n.x,a=n.y,h=i.x,l=i.y,c=o,A=function(e,n){return e<=n},f=function(e,n){return e>=n},d=function(e,n){return Math.min(e,n)},p=function(e,n){return Math.max(e,n)},g={thereYet:f,cap:d},v={thereYet:f,cap:d};a-l>0&&(v.thereYet=A,v.cap=p),s-h>0&&(g.thereYet=A,g.cap=p),e.moveTo(s,a);for(var w,C,P=s,T=a,S=0,I=!0;!g.thereYet(P,h)||!v.thereYet(T,l);)w=Math.atan2(l-a,h-s),C=c[S],P=g.cap(h,P+Math.cos(w)*C),T=v.cap(l,T+Math.sin(w)*C),I?e.lineTo(P,T):e.moveTo(P,T),S=(S+1)%c.length,I=!I}var bh="data:image/";function wh(e){return e.substring(0,bh.length)===bh?e:Ge(e)}function Ch(e,n){e.filter=n.filter,e.fillStyle=n.fillStyle,e.globalAlpha=n.globalAlpha,e.lineCap=n.lineCap,e.lineDashOffset=n.lineDashOffset,e.lineJoin=n.lineJoin,e.lineWidth=n.lineWidth,e.shadowBlur=n.shadowBlur,e.shadowColor=n.shadowColor,e.shadowOffsetX=n.shadowOffsetX,e.shadowOffsetY=n.shadowOffsetY,e.strokeStyle=n.strokeStyle,e.lineColorIn=n.lineColorIn}function Ph(e,n){n&&e.setLineDash&&Array.isArray(n)&&e.setLineDash(n)}function Mh(e){return"Z__"+e}function Th(e){return function(e){function n(){return e.apply(this,arguments)||this}kt(n,e);var i=n.prototype;return i.on=function(e,n,i){if(!e)return this;if(!f(e))return this._switch("on",e,n);if(!n)return this;this._eventMap||(this._eventMap={});var s,a=e.toLowerCase().split(" ");i||(i=this);var h,c=l(n._id);n._id=oe();for(var A=0,d=a.length;A<d;A++){var p=Mh(s=a[A]);if(n[p]&&(n[p]._id=n._id),(h=this._eventMap[s])||(this._eventMap[s]=h=[]),c){var g=h.length;if(g>0)for(var v=0;v<g;v++)if(n===h[v].handler&&h[v].context===i)return o.isTest||console.warn(this,"find '"+e+"' handler:",n," The old listener function will be removed"),this;h.push({handler:n,context:i})}else h.push({handler:n,context:i})}return this},i.addEventListener=function(...e){return this.on.call(this,...e)},i.once=function(e,n,i){if(!f(e)){var o={};for(var s in e)e.hasOwnProperty(s)&&(o[s]=this._wrapOnceHandler(s,e[s],n));return this._switch("on",o)}for(var a=e.split(" "),h=0,l=a.length;h<l;h++)this.on(a[h],this._wrapOnceHandler(a[h],n,i));return this},i.off=function(e,n,i){if(!this._eventMap||!e)return this;if(!f(e))return this._switch("off",e,n);if(!n)return this;if(!l(n._id))return this;var o,s,a,h=e.split(" ");i||(i=this);for(var c=0,A=h.length;c<A;c++)if(a=Mh(o=h[c].toLowerCase()),s=this._eventMap[o]){for(var d=s.length-1;d>=0;d--){var p=s[d];n!==p.handler&&n!==p.handler[a]||p.context!==i||(delete p.handler[a],s.splice(d,1))}s.length||delete this._eventMap[o]}return this},i.removeEventListener=function(...e){return this.off.call(this,...e)},i.listens=function(e,n,i){if(!this._eventMap||!f(e))return 0;var o=this._eventMap[e.toLowerCase()];if(!o||!o.length)return 0;if(!n)return o.length;for(var s=0,a=o.length;s<a;s++)if(n===o[s].handler&&(h(i)||o[s].context===i))return 1;return 0},i.getListeningEvents=function(){return this._eventMap?Object.keys(this._eventMap):[]},i.copyEventListeners=function(e){var n,i=e._eventMap;if(!i)return this;for(var o in i)for(var s=0,a=(n=i[o]).length;s<a;s++)this.on(o,n[s].handler,n[s].context);return this},i.fire=function(e,n){return this._eventParent?this._eventParent.fire.call(this._eventParent,e,n):this._fire.call(this,e,n)},i._wrapOnceHandler=function(e,n,i){var o=Mh(e),s=!1,a=function e(...h){s||(delete a[o],s=!0,i?n.call(i,...h):n.call(this,...h),e._called=!0)};return a[o]=n,a},i._switch=function(e,n,i){for(var o in n)n.hasOwnProperty(o)&&this[e](o,n[o],i);return this},i._clearListeners=function(e){this._eventMap&&f(e)&&(this._eventMap[e.toLowerCase()]&&(this._eventMap[e]=null))},i._clearAllListeners=function(){this._eventMap=null},i._setEventParent=function(e){return this._eventParent=e,this},i._setEventTarget=function(e){return this._eventTarget=e,this},i._fire=function(e,n){if(!this._eventMap)return this;e=e.toLowerCase();var i=this._eventMap[e];if(!i)return this;n||(n={type:e,target:this._eventTarget||this}),n.type=e,n.target=this._eventTarget||this;for(var o,s,h=i.slice(0),l=0,c=h.length;l<c;l++){if(h[l])h[l].handler._called||(o=h[l].context,!0,s=a({},n),!1===(o?h[l].handler.call(o,s):h[l].handler(s))&&n.domEvent&&ki(n.domEvent))}var A=this._eventMap[e];if(A){for(var f=[],d=0,p=A.length;d<p;d++){A[d].handler._called||f.push(A[d])}this._eventMap[e]=f}return this},n}(e)}var Sh=function(e){function n(n){var i;return(i=e.call(this)||this)._enabled=!1,i.target=n,i}kt(n,e);var i=n.prototype;return i.enable=function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},i.disable=function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},i.enabled=function(){return!!this._enabled},i.remove=function(){this.disable(),delete this.target,delete this.dom},n}(Th((function(){}))),Ih=function(){function e(e){if(!this||!this.setOptions)throw new Error('Class instance is being created without "new" operator.');this.setOptions(e),this.callInitHooks(),this._isUpdatingOptions=!1}var n=e.prototype;return n.proxyOptions=function(){var e=this;return wt.proxy?(this.options=new Proxy(this.options,{set:function(n,i,o){if(n[i]===o)return!0;if(n[i]=o,e._isUpdatingOptions)return!0;var s={};return s[i]=o,e.config(s),!0}}),this):this},n.callInitHooks=function(){var e=Object.getPrototypeOf(this);return this._visitInitHooks(e),this},n.setOptions=function(e){if(this.hasOwnProperty("options")&&!h(this.options)||(this.options=this.options?Object.create(this.options):{}),!e)return this;for(var n in e)this.options[n]=e[n];return this},n.config=function(e,n){if(this._isUpdatingOptions=!0,!e){var i={};for(var o in this.options)this.options.hasOwnProperty(o)&&(i[o]=this.options[o]);return this._isUpdatingOptions=!1,i}if(2===arguments.length&&"string"==typeof e){var s={};s[e]=n,e=s}for(var a in e)this.options[a]=e[a],this[a]&&this[a]instanceof Sh&&(e[a]?this[a].enable():this[a].disable());return this.onConfig(e),this._isUpdatingOptions=!1,this},n.onConfig=function(e){},n._visitInitHooks=function(e){if(!this._initHooksCalled){var n=Object.getPrototypeOf(e);n._visitInitHooks&&n._visitInitHooks.call(this,n),this._initHooksCalled=!0;var i=e._initHooks;if(i&&i!==n._initHooks)for(var o=0;o<i.length;o++)i[o].call(this)}},e.addInitHook=function(e,...n){var i="function"==typeof e?e:function(){this[e].call(this,...n)},o=this.prototype,s=Object.getPrototypeOf(o);return o._initHooks&&o._initHooks!==s._initHooks||(o._initHooks=[]),o._initHooks.push(i),this},e.include=function(...e){for(var n=0;n<e.length;n++)a(this.prototype,e[n]);return this},e.mergeOptions=function(e){var n=this.prototype,i=Object.getPrototypeOf(n);return n.options&&n.options!==i.options||(n.options=n.options?Object.create(n.options):{}),a(n.options,e),this},e}(),Eh=function(e){function n(){return e.apply(this,arguments)||this}return kt(n,e),n}(Th((function(){}))),Oh=new Eh,Rh="dprchange",Dh="docvisibilitychange",kh="dragstart",Lh="dragend";if("undefined"!=typeof window&&window.matchMedia)for(var Fh=1;Fh<500;Fh++){var Nh=(.01*Fh).toFixed(2),zh=window.matchMedia("screen and (resolution: "+Nh+"dppx)");zh&&(zh.addEventListener?zh.addEventListener("change",wt.checkDevicePixelRatio):zh.addListener&&zh.addListener(wt.checkDevicePixelRatio))}if(wt.devicePixelRatio){var Bh=wt.devicePixelRatio;Object.defineProperty(wt,"devicePixelRatio",{get:function(){return Bh},set:function(e){e!==Bh&&(Bh=e,wt.monitorDPRChange&&Oh.fire(Rh,{devicePixelRatio:e}))}})}wt.webgl&&"undefined"!=typeof document&&(Si(document,"visibilitychange",(function(){Oh.fire(Dh,{visibilityState:document.visibilityState})})),Si(document,"dragstart",(function(){Oh.fire(kh)})),Si(document,"dragend",(function(){Oh.fire(Lh)})));var Hh={};function jh(e){return function(e){function n(){return e.apply(this,arguments)||this}return kt(n,e),n.registerJSONType=function(e){e&&(Hh[e]?console.error(e+" has register. please use Different name for:",this):Hh[e]=this)},n.getJSONClass=function(e){return e?Hh[e]:null},n.prototype.getJSONType=function(){if(void 0===this._jsonType){var e=Object.getPrototypeOf(this).constructor;for(var n in Hh)if(Hh[n]===e){this._jsonType=n;break}}if(!this._jsonType)throw new Error("Found an unregistered Layer/Geometry class!");return this._jsonType},n}(e)}function Uh(e){return function(e){function n(){return e.apply(this,arguments)||this}kt(n,e);var i=n.prototype;return i.addHandler=function(e,n){if(!n)return this;if(this._handlers||(this._handlers=[]),this[e])return this[e].enable(),this;var i=this[e]=new n(this);return this._handlers.push(i),this.options[e]&&i.enable(),this},i.removeHandler=function(e){if(!e)return this;var n=this[e];if(n){var i=this._handlers.indexOf(n);i>=0&&this._handlers.splice(i,1),this[e].remove(),delete this[e]}return this},i._clearHandlers=function(){for(var e=0,n=this._handlers.length;e<n;e++)this._handlers[e].remove();this._handlers=[]},n}(e)}var Gh="touchstart mousedown",Vh={mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"},Wh={mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},qh=function(e){function n(n,i={}){var o;return(o=e.call(this,null)||this).dom=n,o.options=i,o}kt(n,e);var i=n.prototype;return i.addHooks=function(){},i.removeHooks=function(){},i.enable=function(){return this.dom?(this._onMouseDown=function(e){return this.onMouseDown(e)},$i(this.dom,Gh,this._onMouseDown,this),this):this},i.disable=function(){return this.dom?(this._offEvents(),tr(this.dom,Gh,this._onMouseDown),delete this._onMouseDown,this):this},i.onMouseDown=function(e){if(this.options.rightclick||2!==e.button){var n=e;if(!(n.touches&&n.touches.length>1||this.options.cancelOn&&!0===this.options.cancelOn(e))){var i=this.dom;i.setCapture?i.setCapture():window.captureEvents&&window.captureEvents(),i.ondragstart=function(){return!1},delete this.moved;var o=n.touches?n.touches[0]:e;this.startPos=new ee(o.clientX,o.clientY),tr(document,Vh[e.type],this.onMouseMove),tr(document,Wh[e.type],this.onMouseUp),$i(document,Vh[e.type],this.onMouseMove,this),$i(document,Wh[e.type],this.onMouseUp,this),this.options.ignoreMouseleave||(tr(this.dom,"mouseleave",this.onMouseUp),$i(this.dom,"mouseleave",this.onMouseUp,this)),this.fire("mousedown",{domEvent:e,mousePos:new ee(o.clientX,o.clientY)})}}},i.onMouseMove=function(e){var n=e;if(n.touches&&n.touches.length>1)this.moved&&(this.interupted=!0,this.onMouseUp(e));else{var i=n.touches?n.touches[0]:e,o=new ee(i.clientX,i.clientY).sub(this.startPos);(o.x||o.y)&&(this.moved?this.fire("dragging",{domEvent:e,mousePos:new ee(i.clientX,i.clientY)}):(this.fire("dragstart",{domEvent:e,mousePos:this.startPos.copy()}),this.moved=!0))}},i.onMouseUp=function(e){var n=e.changedTouches?e.changedTouches[0]:e;this._offEvents();var i={domEvent:e};l(n.clientX)&&(i.mousePos=new ee(parseInt(n.clientX+"",0),parseInt(n.clientY+"",0))),this.moved&&(i.interupted=this.interupted,this.fire("dragend",i),delete this.interupted,delete this.moved),this.fire("mouseup",i)},i._offEvents=function(){var e=this.dom;if(tr(e,"mouseleave",this.onMouseUp),"undefined"!=typeof document&&"undefined"!=typeof window){for(var n in Vh)tr(document,Vh[n],this.onMouseMove),tr(document,Wh[n],this.onMouseUp);e.releaseCapture?e.releaseCapture():window.captureEvents&&window.captureEvents()}},n}(Sh),Zh=function(e){function n(){return e.apply(this,arguments)||this}kt(n,e),n.toNumberArrays=function(e){return Array.isArray(e)?ue(e,(function(e){return e.toArray()})):e.toArray()},n.toCoordinates=function(e){if(l(e[0])&&l(e[1]))return new n(e);if(e instanceof n)return e;for(var i=[],o=0,s=e.length;o<s;o++){var a=e[o];Array.isArray(a)?l(a[0])?i.push(new n(a)):i.push(n.toCoordinates(a)):i.push(a instanceof n?a:new n(a))}return i};var i=n.prototype;return i.closeTo=function(e,n){return n||(n=0),this.x>=e.x-n&&this.x<=e.x+n&&this.y>=e.y-n&&this.y<=e.y+n},i.abs=function(){return new n(Math.abs(this.x),Math.abs(this.y))},i.round=function(){return new n(Math.round(this.x),Math.round(this.y))},i.ceil=function(){return new n(Math.ceil(this.x),Math.ceil(this.y))},i.floor=function(){return new n(Math.floor(this.x),Math.floor(this.y))},i.copy=function(){return new n(this.x,this.y,this.z)},i.toFixed=function(e){return new n(this.x.toFixed(e),this.y.toFixed(e),l(this.z)?this.z.toFixed(e):void 0)},i.add=function(e,i,o){var s,a,l=this.z;return h(e.x)?h(e[0])?(s=this.x+e,a=this.y+i,h(o)||(l=(this.z||0)+o)):(s=this.x+e[0],a=this.y+e[1],h(e[2])||(l=(this.z||0)+e[2])):(s=this.x+e.x,a=this.y+e.y,h(e.z)||(l=(this.z||0)+e.z)),new n(s,a,l)},i.sub=function(e,i,o){var s,a,l=this.z;return h(e.x)?h(e[0])?(s=this.x-e,a=this.y-i,h(o)||(l=(this.z||0)-o)):(s=this.x-e[0],a=this.y-e[1],h(e[2])||(l=(this.z||0)-e[2])):(s=this.x-e.x,a=this.y-e.y,h(e.z)||(l=(this.z||0)-e.z)),new n(s,a,l)},i.multi=function(e){return new n(this.x*e,this.y*e,h(this.z)?this.z:this.z*e)},i.equals=function(e){return e instanceof this.constructor&&(this.x===e.x&&this.y===e.y&&this.z===e.z)},n}(te),Qh=function(){function e(e,n){this.type=e,this.properties=n}return e.createProj4=function(n){return new e("proj4",{proj:n})},e.fromProjectionCode=function(n){return n&&e[n=n.toUpperCase().replace(":","")]||null},e}();Qh.WGS84=Qh.createProj4("+proj=longlat +datum=WGS84 +no_defs"),Qh.EPSG3857=Qh.createProj4("+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs"),Qh.IDENTITY=Qh.createProj4("+proj=identity +no_defs"),Qh.CGCS2000=Qh.createProj4("+proj=longlat +datum=CGCS2000"),Qh.EPSG4490=Qh.CGCS2000,Qh.BD09LL=Qh.createProj4("+proj=longlat +datum=BD09"),Qh.GCJ02=Qh.createProj4("+proj=longlat +datum=GCJ02");var Xh,Yh=new ee(0,0),Jh=new Zh(0,0),Kh=new Zh(0,0),$h=new Zh(0,0),tl=new Zh(0,0),el=new Zh(0,0),nl=new Zh(0,0),il=new Zh(0,0),rl=new Zh(0,0),ol=[],sl=[],al=function(){function e(...e){this._clazz=Zh;var n=e.length,i=n>0?e[n-1]:null;i&&i.unproject&&(this.projection=e[n-1]),this._dirty=!0,this.antiMeridian=!1,this._initialize(e[0],e[1],e[2],e[3])}var n=e.prototype;return n._initialize=function(e,n,i,o){if(this.xmin=null,this.xmax=null,this.ymin=null,this.ymax=null,!h(e)){var s=this.projection;if(l(e)&&l(n)&&l(i)&&l(o))s?this.set(e,n,i,o):this.set(Math.min(e,i),Math.min(n,o),Math.max(e,i),Math.max(n,o));else if(Array.isArray(e))s?this.set(e[0],e[1],e[2],e[3]):this.set(Math.min(e[0],e[2]),Math.min(e[1],e[3]),Math.max(e[0],e[2]),Math.max(e[1],e[3]));else if(l(e.x)&&l(n.x)&&l(e.y)&&l(n.y)){var a=e,c=n;s?this.set(a.x,a.y,c.x,c.y):(a.x>c.x?(this.xmin=c.x,this.xmax=a.x):(this.xmin=a.x,this.xmax=c.x),a.y>c.y?(this.ymin=c.y,this.ymax=a.y):(this.ymin=a.y,this.ymax=c.y))}else l(e.xmin)&&l(e.xmax)&&l(e.ymin)&&l(e.ymax)&&this.set(e.xmin,e.ymin,e.xmax,e.ymax)}},n._add=function(e){return this._dirty=!0,h(e.x)?h(e.xmin)?h(e[0])||(this.xmin+=e[0],this.ymin+=e[1],this.xmax+=e[0],this.ymax+=e[1]):(this.xmin+=e.xmin,this.ymin+=e.ymin,this.xmax+=e.xmax,this.ymax+=e.ymax):(this.xmin+=e.x,this.ymin+=e.y,this.xmax+=e.x,this.ymax+=e.y),this},n.add=function(e){return new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection)._add(e)},n._scale=function(e){return this._dirty=!0,this.xmin*=e,this.ymin*=e,this.xmax*=e,this.ymax*=e,this},n._sub=function(e){return this._dirty=!0,h(e.x)?h(e.xmin)?h(e[0])||(this.xmin-=e[0],this.ymin-=e[1],this.xmax-=e[0],this.ymax-=e[1]):(this.xmin-=e.xmin,this.ymin-=e.ymin,this.xmax-=e.xmax,this.ymax-=e.ymax):(this.xmin-=e.x,this.ymin-=e.y,this.xmax-=e.x,this.ymax-=e.y),this},n._substract=function(e){return this._sub(e)},n.sub=function(e){return new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection)._sub(e)},n.substract=function(e){return this.sub(e)},n.round=function(){return new this.constructor(Math.round(this.xmin),Math.round(this.ymin),Math.round(this.xmax),Math.round(this.ymax),this.projection)},n._round=function(){return this._dirty=!0,this.xmin=Math.round(this.xmin),this.ymin=Math.round(this.ymin),this.xmax=Math.round(this.xmax),this.ymax=Math.round(this.ymax),this},n.getMin=function(e){return e?(e.set(this.xmin,this.ymin),e):new this._clazz(this.xmin,this.ymin)},n.getMax=function(e){return e?(e.set(this.xmax,this.ymax),e):new this._clazz(this.xmax,this.ymax)},n.getCenter=function(e){var n=(this.xmin+this.xmax)/2,i=(this.ymin+this.ymax)/2;return e?(e.set(n,i),e):new this._clazz(n,i)},n.isValid=function(){return!(h(this.xmin)||h(this.ymin)||h(this.xmax)||h(this.ymax))},n.equals=function(e){return this.xmin===e.xmin&&this.xmax===e.xmax&&this.ymin===e.ymin&&this.ymax===e.ymax},n.intersects=function(e){this._project(this),this._project(e);var n=Math.max(this.pxmin,e.pxmin),i=Math.max(this.pymin,e.pymin),o=Math.min(this.pxmax,e.pxmax),s=Math.min(this.pymax,e.pymax);return!(n>o||i>s)},n.within=function(e){return this._project(this),this._project(e),this.pxmin>=e.pxmin&&this.pxmax<=e.pxmax&&this.pymin>=e.pymin&&this.pymax<=e.pymax},n.contains=function(e){if(!e)return!1;this._project(this);var n=this.projection;if(n){var i=Jh;Array.isArray(e)?(i.x=e[0],i.y=e[1],e=n.project(i,i)):void 0!==e.x?(i.x=e.x,i.y=e.y,e=n.project(i,i)):void 0!==e.xmin&&this._project(e)}return(e.x||e.pxmin||0)>=this.pxmin&&(e.x||e.pxmax||0)<=this.pxmax&&(e.y||e.pymin||0)>=this.pymin&&(e.y||e.pymax||0)<=this.pymax},n.getWidth=function(){return Math.abs(this.xmax-this.xmin)},n.getHeight=function(){return Math.abs(this.ymax-this.ymin)},n.getSize=function(){return new Cn(this.getWidth(),this.getHeight())},n.set=function(e,n,i,o){return this.xmin=e,this.ymin=n,this.xmax=i,this.ymax=o,this._dirty=!0,this},n.__combine=function(e){var n,i,o,s;void 0!==e.x&&(Xh.xmin=Xh.xmax=e.x,Xh.ymin=Xh.ymax=e.y,e=Xh),this._project(e),this._project(this),l(this.pxmin)?(n=Math.min(this.pxmin,e.pxmin),i=Math.min(this.pymin,e.pymin),o=Math.max(this.pxmax,e.pxmax),s=Math.max(this.pymax,e.pymax)):(n=e.pxmin,i=e.pymin,o=e.pxmax,s=e.pymax);var a=this.projection;if(a){Kh.set(n,i),$h.set(o,s);var h=a.unproject(Kh,Kh),c=a.unproject($h,$h);n=h.x,i=h.y,o=c.x,s=c.y}return sl[0]=n,sl[1]=i,sl[2]=o,sl[3]=s,sl},n._combine=function(e){if(!e||e.isValid&&!e.isValid())return this;var n=this.__combine(e);return this.set(n[0],n[1],n[2],n[3]),this._dirty=!0,this},n.combine=function(e){if(!e||e.isValid&&!e.isValid())return this;var n=this.__combine(e);return new this.constructor(n[0],n[1],n[2],n[3],this.projection)},n.intersection=function(e){if(!this.intersects(e))return null;tl.x=Math.max(this.pxmin,e.pxmin),tl.y=Math.max(this.pymin,e.pymin),el.x=Math.min(this.pxmax,e.pxmax),el.y=Math.min(this.pymax,e.pymax);var n=tl,i=el,o=this.projection;return o&&(n=o.unproject(n,n),i=o.unproject(i,i)),new this.constructor(n,i,o)},n.expand=function(e){var n,i;return l(e)?n=i=e:(n=e.width||e.x||e[0]||0,i=e.height||e.y||e[1]||0),new this.constructor(this.xmin-n,this.ymin-i,this.xmax+n,this.ymax+i,this.projection)},n._expand=function(e){var n,i;return l(e)?n=i=e:(n=e.width||e.x||e[0]||0,i=e.height||e.y||e[1]||0),this.xmin-=n,this.ymin-=i,this.xmax+=n,this.ymax+=i,this._dirty=!0,this},n.toJSON=function(){return{xmin:this.xmin,ymin:this.ymin,xmax:this.xmax,ymax:this.ymax}},n.toArray=function(e){var n=this.xmin,i=this.ymin,o=this.xmax,s=this.ymax;return e?(e[0].x=n,e[0].y=s,e[1].x=o,e[1].y=s,e[2].x=o,e[2].y=i,e[3].x=n,e[3].y=i,e[4].x=n,e[4].y=s,e):[new this._clazz([n,s]),new this._clazz([o,s]),new this._clazz([o,i]),new this._clazz([n,i]),new this._clazz([n,s])]},n.toString=function(){return this.xmin+","+this.ymin+","+this.xmax+","+this.ymax},n.copy=function(){return new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection)},n.convertTo=function(e,n){if(!this.isValid())return null;var i,o=n||new this.constructor;return n&&o.set(null,null,null,null),this._clazz===Zh?i=nl:this._clazz===ee&&(i=Yh),i.x=this.xmin,i.y=this.ymax,o._combine(e(i)),i.x=this.xmax,o._combine(e(i)),i.y=this.ymin,o._combine(e(i)),i.x=this.xmin,o._combine(e(i)),o},n._project=function(e){if(e&&e.isValid()){var n=this.projection;if(n){if(e._dirty){il.set(e.xmin,e.ymin),rl.set(e.xmax,e.ymax),ol[0]=il,ol[1]=rl;var i=n.projectCoords(ol,this.antiMeridian),o=i[0],s=i[1];e.pxmin=Math.min(o.x,s.x),e.pymin=Math.min(o.y,s.y),e.pxmax=Math.max(o.x,s.x),e.pymax=Math.max(o.y,s.y)}delete e._dirty}else e.pxmin=e.xmin,e.pxmax=e.xmax,e.pymin=e.ymin,e.pymax=e.ymax}else e&&(e.pxmin=e.pxmax=e.pymin=e.pymax=null)},e}();Xh=new al(0,0,0,0);var hl,ll=function(e){function n(...n){var i;return(i=e.call(this,...n)||this)._clazz=ee,i}return kt(n,e),n}(al),ul=function(){function e(e){this.matrix=e}var n=e.prototype;return n.transform=function(e,n,i){var o=this.matrix[0]*(e.x-this.matrix[2])/n,s=-this.matrix[1]*(e.y-this.matrix[3])/n;return i?(i.x=o,i.y=s,i):new ee(o,s)},n.untransform=function(e,n,i){var o=e.x*n/this.matrix[0]+this.matrix[2],s=e.y*n/-this.matrix[1]+this.matrix[3];return i?(i.x=o,i.y=s,i):new Zh(o,s)},e}(),cl={code:"",is:function(e){if(this.code===e)return!0;if(!this.aliases)return!1;for(var n=0;n<this.aliases.length;n++)if(this.aliases[n]===e)return!0;return!1},project:function(e){return e},unproject:function(e){return e},projectCoords:function(e,n){var i=this;if(!e)return[];if(!Array.isArray(e))return this.project(e);if(0===e.length)return[];if(!this.isSphere())return ue(e,this.project,this);if(Array.isArray(e[0]))return e.map((function(e){return i.projectCoords(e,n)}));for(var o,s,a,h,l,c=n,A=this.getCircum(),f=this.getSphereExtent().sy,d=e[0],p=[this.project(d)],g=1,v=e.length;g<v;g++){a=(s=e[g]).x-d.x,h=s.y-d.y,l=this.project(s);var w=!1;Math.abs(a)>180&&c&&(s.x=a<0?360-Math.abs(s.x):-180-(180-Math.abs(s.x)),w=!0),Math.abs(h)>90&&c&&(void 0===o&&(o=s.y<d.y),o&&(l._add(0,-A.y*Ae(h)*f),s._add(0,-180*Ae(h)))),w&&(l=this.project(s)),d=s,p.push(l)}return p},unprojectCoords:function(e){return e?Array.isArray(e)?ue(e,this.unproject,this):this.unproject(e):[]},isSphere:function(){return!!this.sphere},isOutSphere:function(e){return!!this.isSphere()&&!this.getSphereExtent().contains(e)},wrapCoord:function(e){if(!this.isSphere())return e;var n=this.getSphereExtent(),i=new Zh(e);return n.contains(i)||(i.x=pe(e.x,n.xmin,n.xmax),i.y=pe(e.y,n.ymin,n.ymax)),i},getCircum:function(){if(!this.circum&&this.isSphere()){var e=this.getSphereExtent();this.circum={x:e.getWidth(),y:e.getHeight()}}return this.circum},getSphereExtent:function(){if(!this.extent&&this.isSphere()){var e=this.project(new Zh(180,90)),n=this.project(new Zh(-180,-90));this.extent=new al(n,e,this),this.extent.sx=e.x>n.x?1:-1,this.extent.sy=e.y>n.y?1:-1}return this.extent}},fl={measureLength:function(e,n){if(!Array.isArray(e))return this.measureLenBetween(e,n);for(var i=0,o=0,s=e.length;o<s-1;o++)i+=this.measureLenBetween(e[o],e[o+1]);return i}},dl={measure:"IDENTITY",measureLenBetween:function(e,n,i=!1){if(!e||!n)return 0;try{var o=Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2));if(i)return o;var s=(e.z||0)-(n.z||0);return 0===s?o:Math.sqrt(o*o+s*s)}catch(e){return 0}},measureArea:function(e){if(!Array.isArray(e))return 0;for(var n=0,i=0,o=e.length;i<o;i++){var s=e[i],a=null;n+=s.x*(a=i===o-1?e[0]:e[i+1]).y-s.y*a.x}return Math.abs(n/2)},locate:function(e,n,i,o){return(o=o||new Zh(0,0)).set(e.x,e.y),this._locate(o,n,i)},_locate:function(e,n,i){return e?(n||(n=0),i||(i=0),n||i?(e.x=e.x+n,e.y=e.y+i,e):e):null},rotate:function(e,n,i){return e=new Zh(e.x,e.y),this._rotate(e,n,i)},_rotate:(hl=new ee(0,0),function(e,n,i){return hl.x=e.x-n.x,hl.y=e.y-n.y,hl._rotate(i*Math.PI/180),e.x=n.x+hl.x,e.y=n.y+hl.y,e})},pl=a(dl,fl),gl=function(){function e(e){this.radius=e}var n=e.prototype;return n.measureLenBetween=function(e,n,i=!1){if(!e||!n)return 0;var o=w(e.y),s=w(n.y),a=o-s,h=w(e.x)-w(n.x);o=2*Math.asin(Math.sqrt(Math.pow(Math.sin(a/2),2)+Math.cos(o)*Math.cos(s)*Math.pow(Math.sin(h/2),2)));o*=this.radius;if(i)return o;var l=(e.z||0)-(n.z||0);return 0===l?o:Math.sqrt(o*o+l*l)},n.measureArea=function(e){var n,i=w(this.radius),o=0,s=e,a=s.length;if(a<3)return 0;for(n=0;n<a-1;n++){var h=s[n],l=s[n+1];o+=h.x*i*Math.cos(w(h.y))*l.y*i-l.x*i*Math.cos(w(l.y))*h.y*i}var c=s[n],A=s[0];return o+=c.x*i*Math.cos(w(c.y))*A.y*i-A.x*i*Math.cos(w(A.y))*c.y*i,.5*Math.abs(o)},n.locate=function(e,n,i,o){return(o=o||new Zh(0,0)).set(e.x,e.y),this._locate(o,n,i)},n._locate=function(e,n,i){if(!e)return null;if(n||(n=0),i||(i=0),!n&&!i)return e;var o,s,a=w(e.y);if(0!==i){var h=Math.abs(i);s=pe(180*(a+=2*Math.sin(h/(2*this.radius))*(i>0?1:-1))/Math.PI,-90,90)}else s=e.y;if(0!==n){var l=Math.abs(n),c=w(e.x);o=pe(180*(c+=2*Math.sqrt(Math.pow(Math.sin(l/(2*this.radius)),2)/Math.pow(Math.cos(a),2))*(n>0?1:-1))/Math.PI,-180,180)}else o=e.x;return e.x=o,e.y=s,e},n.rotate=function(e,n,i){var o=new Zh(e);return this._rotate(o,n,i)},n._rotate=function(e,n,i){var o=function(e,n,i={}){var o;o=i.final?ml(n,e):ml(e,n);return o>180?-(360-o):o}(n,e),s=o-i,a=this.measureLenBetween(n,e,!0);return e.x=n.x,e.y=n.y,function(e,n,i,o){var s=n/o,a=e.x*Math.PI/180,h=w(e.y),l=w(i),c=s*Math.cos(l),A=h+c;Math.abs(A)>Math.PI/2&&(A=A>0?Math.PI-A:-Math.PI-A);var f=Math.log(Math.tan(A/2+Math.PI/4)/Math.tan(h/2+Math.PI/4)),d=Math.abs(f)>1e-11?c/f:Math.cos(h),p=s*Math.sin(l)/d;return e.x=(180*(a+p)/Math.PI+540)%360-180,e.y=180*A/Math.PI,e}(e,a,s,this.radius)},e}();function ml(e,n){var i=w(e.y),o=w(n.y),s=w(n.x-e.x);s>Math.PI&&(s-=2*Math.PI),s<-Math.PI&&(s+=2*Math.PI);var a=Math.log(Math.tan(o/2+Math.PI/4)/Math.tan(i/2+Math.PI/4));return(C(Math.atan2(s,a))+360)%360}var yl={measure:"EPSG:4326",sphere:new gl(6378137),measureLenBetween:function(e,n){return this.sphere.measureLenBetween(e,n)},measureArea:function(e){return this.sphere.measureArea.call(this.sphere,e)},_locate:function(e,n,i){return this.sphere._locate.call(this.sphere,e,n,i)},locate:function(e,n,i,o){return this.sphere.locate.call(this.sphere,e,n,i,o)},_rotate:function(e,n,i){return this.sphere._rotate.call(this.sphere,e,n,i)},rotate:function(e,n,i){return this.sphere.rotate.call(this.sphere,e,n,i)}},vl=a(yl,fl),_l={measure:"BAIDU",sphere:new gl(6370996.81),measureLenBetween:function(e,n){return this.sphere.measureLenBetween.call(this.sphere,e,n)},measureArea:function(e){return this.sphere.measureArea.call(this.sphere,e)},_locate:function(e,n,i){return this.sphere._locate.call(this.sphere,e,n,i)},locate:function(e,n,i,o){return this.sphere.locate.call(this.sphere,e,n,i,o)},_rotate:function(e,n,i){return this.sphere._rotate.call(this.sphere,e,n,i)},rotate:function(e,n,i){return this.sphere.rotate.call(this.sphere,e,n,i)}},xl=a(_l,fl),bl=vl,wl={};function Cl(e){wl[e.measure]=e}Cl(pl),Cl(vl),Cl(xl);var Pl={getInstance:function(e){if(!e)return bl;for(var n in wl)if(g(wl,n)){var i=wl[n].measure;if(!i)continue;if(e.toLowerCase()===i.toLowerCase())return wl[n]}return null}},Ml=Object.freeze({__proto__:null,BaiduSphere:xl,DEFAULT:bl,Identity:pl,Measurer:Pl,WGS84Sphere:vl}),Tl={code:"EPSG:3857",rad:Math.PI/180,metersPerDegree:6378137*Math.PI/180,maxLatitude:85.0511287798,project:function(e,n){var i=this.rad,o=this.metersPerDegree,s=this.maxLatitude,a=e.x,h=Math.max(Math.min(s,e.y),-s),l=a*o,c=(0===h?0:Math.log(Math.tan((90+h)*i/2))/i)*o;return n?(n.x=l,n.y=c,n):new Zh(l,c)},unproject:function(e,n){var i,o=this.rad,s=this.metersPerDegree,a=e.x/s,h=e.y;0===h?i=0:(i=h/s,i=(2*Math.atan(Math.exp(i*o))-Math.PI/2)/o),Math.abs(Math.abs(a)-180)<1e-7&&(a=180*Ae(a)),Math.abs(Math.abs(i)-this.maxLatitude)<1e-7&&(i=Ae(i)*this.maxLatitude);var l=a,c=i;return n?(n.x=l,n.y=c,n):new Zh(l,c)}},Il=a({},cl,Tl,vl),El={code:"EPSG:4326",aliases:["EPSG:4490"],project:function(e,n){return n?(n.x=e.x,n.y=e.y,n):new Zh(e)},unproject:function(e,n){return n?(n.x=e.x,n.y=e.y,n):new Zh(e)}},Ol=a({},cl,El,vl),Rl=Math.abs,Dl=Math.sin,kl=Math.cos,Ll=Math.tan,Fl=Math.atan,Nl=Math.atan2,Bl=Math.sqrt,Hl=Math.log,Ul=Math.hypot,Vl=Math.sinh,Wl=Math.cosh,ql=1/0;function Zl(e){var n,i,o,s,a,h,l=[],c=[],A=[],f=[];function d(e,n){for(var i,o=2*kl(2*n),s=e.length-1,a=e[s],h=0;--s>=0;)i=o*a-h+e[s],h=a,a=i;return n+i*Dl(2*n)}function p(e,n,i){for(var o,s,a=Dl(n),h=kl(n),l=Vl(i),c=Wl(i),A=2*h*c,f=-2*a*l,d=e.length-1,p=e[d],g=0,v=0,w=0;--d>=0;)o=v,s=g,p=A*(v=p)-o-f*(g=w)+e[d],w=f*v-s+A*g;return[(A=a*c)*p-(f=h*l)*w,A*w+f*p]}a=s=(o=e.es/(1+Bl(1-e.es)))/(2-o),l[0]=s*(2+s*(-2/3+s*(s*(116/45+s*(26/45+s*(-2854/675)))-2))),c[0]=s*(s*(2/3+s*(4/3+s*(-82/45+s*(32/45+s*(4642/4725)))))-2),l[1]=(a*=s)*(7/3+s*(s*(-227/45+s*(2704/315+s*(2323/945)))-1.6)),c[1]=a*(5/3+s*(-16/15+s*(-13/9+s*(904/315+s*(-1522/945))))),l[2]=(a*=s)*(56/15+s*(-136/35+s*(-1262/105+s*(73814/2835)))),c[2]=a*(-26/15+s*(34/21+s*(1.6+s*(-12686/2835)))),l[3]=(a*=s)*(4279/630+s*(-332/35+s*(-399572/14175))),c[3]=a*(1237/630+s*(s*(-24832/14175)-2.4)),l[4]=(a*=s)*(4174/315+s*(-144838/6237)),c[4]=a*(-734/315+s*(109598/31185)),l[5]=(a*=s)*(601676/22275),c[5]=a*(444337/155925),n=e.k0/(1+s)*(1+(a=s*s)*(1/4+a*(1/64+a/256))),A[0]=s*(s*(2/3+s*(-37/96+s*(1/360+s*(81/512+s*(-96199/604800)))))-.5),f[0]=s*(.5+s*(-2/3+s*(5/16+s*(41/180+s*(-127/288+s*(7891/37800)))))),A[1]=a*(-1/48+s*(-1/15+s*(437/1440+s*(-46/105+s*(1118711/3870720))))),f[1]=a*(13/48+s*(s*(557/1440+s*(281/630+s*(-1983433/1935360)))-.6)),A[2]=(a*=s)*(-17/480+s*(37/840+s*(209/4480+s*(-5569/90720)))),f[2]=a*(61/240+s*(-103/140+s*(15061/26880+s*(167603/181440)))),A[3]=(a*=s)*(-4397/161280+s*(11/504+s*(830251/7257600))),f[3]=a*(49561/161280+s*(-179/168+s*(6601661/7257600))),A[4]=(a*=s)*(-4583/161280+s*(108847/3991680)),f[4]=a*(34729/80640+s*(-3418889/1995840)),A[5]=(a*=s)*(-20648693/638668800),f[5]=.6650675310896665*a,h=d(c,e.phi0),i=-n*(h+function(e,n){var i,o=2*kl(n),s=e.length-1,a=e[s],h=0;for(;--s>=0;)i=o*a-h+e[s],h=a,a=i;return Dl(n)*i}(f,2*h)),e.fwd=function(e,o){var s,a,h,l,A,g=e.phi,v=e.lam;g=d(c,g),s=Dl(g),a=kl(g),l=Dl(v),h=kl(v),g=Nl(s,h*a),v=Nl(l*a,Ul(s,a*h)),v=function(e){var n=Rl(e);return n=function(e){var n=1+e,i=n-1;return 0===i?e:e*Hl(n)/i}(n*(1+n/(Ul(1,n)+1))),e<0?-n:n}(Ll(v)),A=p(f,2*g,2*v),g+=A[0],v+=A[1],Rl(v)<=2.623395162778?(o.y=n*g+i,o.x=n*v):o.x=o.y=ql},e.inv=function(e,o){var s,a,h,c,f,g=e.y,v=e.x;g=(g-i)/n,v/=n,Rl(v)<=2.623395162778?(g+=(f=p(A,2*g,2*v))[0],v=Fl(Vl(v+=f[1])),s=Dl(g),a=kl(g),c=Dl(v),h=kl(v),v=Nl(c,h*a),g=Nl(s*h,Ul(c,h*a)),o.phi=d(l,g),o.lam=v):o.phi=o.lam=ql}}var Ql=57.29577951308232,Xl=.017453292519943295,Yl=["Traverse_Mercator"],Jl={code:"EPSG:9807",aliases:Yl,centralMeridian:0,create:function(e){var n={a:6378137,es:.0066943799901413165,x0:h(e.falseEasting)?5e5:e.falseEasting,y0:h(e.falseNorthing)?0:e.falseNorthing,k0:e.scaleFactor||.9996,lam0:(e.centralMeridian||0)*Xl,phi0:(e.latitudeOfOrigin||0)*Xl,originLam0:e.startLongtitude||0,originPhi0:e.startLatitude||0};Zl(n);var i={lam:0,phi:0},o={},s=0,l=0;(n.originLam0||n.originPhi0)&&(i.lam=n.originLam0*Xl-n.lam0,i.phi=n.originPhi0*Xl,n.fwd(i,o),s=n.a*o.x+n.x0,l=n.a*o.y+n.y0);var c={code:"EPSG:9807",aliases:Yl,centralMeridian:e.centralMeridian,project:function(e,a){i.lam=e.x*Xl-n.lam0,i.phi=e.y*Xl,n.fwd(i,o);var h=n.a*o.x+n.x0-s,c=n.a*o.y+n.y0-l;return a?(a.x=h,a.y=c,a):new Zh(h,c)},unproject:function(e,a){o.x=(e.x-n.x0+s)/n.a,o.y=(e.y-n.y0+l)/n.a,n.inv(o,i);var h=(i.lam+n.lam0)*Ql,c=i.phi*Ql;return a?(a.x=h,a.y=c,a):new Zh(h,c)}};return a({},cl,c,vl)}},Kl=a({},cl,Jl),tu={code:"utm",aliases:[],create:function(e){var n={},i=parseInt(e.zone);if(n.falseNorthing=e.south?1e7:0,n.falseEasting=5e5,!(i>0&&i<=60))throw new Error("zone must be > 0 and <= 60.");return i--,n.centralMeridian=6*(i+.5)-180,n.scaleFactor=.9996,Kl.create(n)}},eu=a({},Kl,tu),nu={EARTHRADIUS:6370996.81,MCBAND:[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],LLBAND:[75,60,45,30,15,0],MC2LL:[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],LL2MC:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],convertMC2LL:function(e,n){for(var i,o=0,s=this.MCBAND.length;o<s;o++)if(Math.abs(e.y)>=this.MCBAND[o]){i=this.MC2LL[o];break}return this.convertor(e,i,n)},convertLL2MC:function(e,n){var i,o,s;e.x=this.getLoop(e.x,-180,180),e.y=this.getRange(e.y,-74,74);var a=new Zh(e.x,e.y);for(o=0,s=this.LLBAND.length;o<s;o++)if(a.y>=this.LLBAND[o]){i=this.LL2MC[o];break}if(!i)for(o=this.LLBAND.length-1;o>=0;o--)if(a.y<=-this.LLBAND[o]){i=this.LL2MC[o];break}return this.convertor(e,i,n)},convertor:function(e,n,i){if(!e||!n)return null;var o=n[0]+n[1]*Math.abs(e.x),s=Math.abs(e.y)/n[9],a=n[2]+n[3]*s+n[4]*s*s+n[5]*s*s*s+n[6]*s*s*s*s+n[7]*s*s*s*s*s+n[8]*s*s*s*s*s*s;return o*=e.x<0?-1:1,a*=e.y<0?-1:1,i?(i.x=o,i.y=a,i):new Zh(o,a)},toRadians:function(e){return Math.PI*e/180},toDegrees:function(e){return 180*e/Math.PI},getRange:function(e,n,i){return null!=n&&(e=Math.max(e,n)),null!=i&&(e=Math.min(e,i)),e},getLoop:function(e,n,i){if(e===1/0)return i;if(e===-1/0)return n;for(;e>i;)e-=i-n;for(;e<n;)e+=i-n;return e}},iu=a({},cl,{code:"BAIDU",project:function(e,n){return this.convertLL2MC(e,n)},unproject:function(e,n){return this.convertMC2LL(e,n)}},xl,nu),ru=a({},cl,{code:"IDENTITY",project:function(e,n){return n?(n.x=e.x,n.y=e.y,n):e.copy()},unproject:function(e,n){return n?(n.x=e.x,n.y=e.y,n):e.copy()}},pl),ou=Il,su=Object.freeze({__proto__:null,BAIDU:iu,Common:cl,DEFAULT:ou,EPSG3857:Il,EPSG4326:Ol,EPSG9807:Kl,IDENTITY:ru,UTM:eu});function au(e){return function(e){function n(){return e.apply(this,arguments)||this}return kt(n,e),n.registerRenderer=function(e,n){var i=this.prototype,o=Object.getPrototypeOf(i);return i._rendererClasses&&i._rendererClasses!==o._rendererClasses||(i._rendererClasses=i._rendererClasses?Object.create(i._rendererClasses):{}),i._rendererClasses[e.toLowerCase()]=n,this},n.getRendererClass=function(e){var n=this.prototype;return n._rendererClasses?n._rendererClasses[e.toLowerCase()]:null},n}(e)}var hu="check_browser_max_fps";na(hu,(function(){return"function (exports) {\n    exports.initialize = function () {};\n    function now(){\n        return  new Date().getTime();\n    }\n    function checkFPS(cb) {\n        if (!requestAnimationFrame) {\n            cb(-1);\n            return;\n        }\n        const count = 100;\n        let idx = 0;\n        let id;\n        let startTime;\n        function loop() {\n            idx++;\n            if (idx === count) {\n                cancelAnimationFrame(id);\n                const endTime = now();\n                const timePerFPS = (endTime - startTime) / count;\n                const fps = Math.floor(1000 / timePerFPS);\n                cb(fps);\n            } else {\n                id = requestAnimationFrame(loop);\n            }\n        }\n        startTime = now();\n        id = requestAnimationFrame(loop);\n    }\n    //recive message\n    exports.onmessage = function (msg, postResponse) {\n        checkFPS((fps) => {\n            if (fps < -1) {\n                postResponse('check fps fail');\n            } else {\n                postResponse(null, { fps });\n            }\n        })\n    }\n}"}));var lu,uu=0,cu=[],Au=function(){function e(e){var n=this;wa(),this._delayMessages=[],this.initializing=!1;var i=Ks(e);Ys&&!i&&(this.initializing=!0,console.log("Injecting codes in worker with worker key: :"+e),aa(e,(function(){n.initializing=!1,n.created()}))),this.workerKey=e,this.workerPool=fa(),this.currentActor=0,this.actorId=oe(),this.workers=this.workerPool.acquire(this.actorId),this.callbacks={},this.callbackID=0,this.receiveFn=this.receive.bind(this),this.workers.forEach((function(e){e.addEventListener("message",n.receiveFn,!1)})),ta(e)}var n=e.prototype;return n.created=function(){var e=this;this._delayMessages.forEach((function(n){var{command:i,data:o,buffers:s,cb:a,workerId:h}=n;e[i](o,s,a,h)})),this._delayMessages=[]},n.isActive=function(){return!!this.workers},n.broadcast=function(e,n,i){var o=this;return this.initializing?(this._delayMessages.push({command:"broadcast",data:e,buffers:n,cb:i}),this):(function(e,n,i){e.length||i(null,[]);var o=e.length,s=new Array(e.length),a=null;e.forEach((function(e,h){n(e,(function(e,n){e&&(a=e),s[h]=n,0==--o&&i(a,s)}))}))}(this.workers,(function(i,s){o.send(e,n,s,i.id)}),i=i||function(){}),this)},n.send=function(e,n,i,o){if(this.initializing)return this._delayMessages.push({command:"send",data:e,buffers:n,cb:i,workerId:o}),this;var s=i?this.actorId+":"+this.callbackID++:null;return i&&(this.callbacks[s]=i),this.post({data:e,callback:String(s)},n,o),this},n.receive=function(e){var n=this,i=e.data,o=i.callback,s=this.callbacks[o];delete this.callbacks[o],"<request>"===i.type?this.actorId===i.actorId&&this[i.command](i.params,(function(e,o,s){var a={type:"<response>",callback:i.callback};e?a.error=e.message:a.data=o,n.post(a,s||cu,i.workerId)})):s&&i.error?s(i.error):s&&s(null,i.data)},n.remove=function(){var e=this;this.workers.forEach((function(n){n.removeEventListener("message",e.receiveFn,!1)})),delete this.receiveFn,delete this.workers,delete this.callbacks,delete this.workerPool},n.post=function(e,n,i){return("number"!=typeof i||isNaN(i))&&(i=this.currentActor=(this.currentActor+1)%this.workerPool.workerCount),e.workerId=i,e.workerKey=this.workerKey,e.actorId=this.actorId,this.workerPool.addMessage(i,e,n||cu),i},n.getDedicatedWorker=function(){return uu=(uu+1)%this.workerPool.workerCount},e}();var fu=function(e){function n(){return e.call(this,hu)||this}return kt(n,e),n}(Au);var du=!1;Ca((function(){var e;du||o.maxFPS<=0&&(du=!0,e=function(e){l(e)&&e>0&&o.maxFPS<=0&&(o.maxFPS=e),du=!1},lu||(lu=new fu),lu.send({},[],(function(n,i){n?(console.error(n),e()):e(i.fps)})))}));var pu=[],gu=function(e){function n(){return e.call(this,Xs)||this}return kt(n,e),n.prototype.fetchImage=function(e,n){this.send({url:e},pu,n)},n}(Au),mu=function(e){function i(n){var i;return(i=e.call(this)||this).layer=n,i._painted=!1,i._drawTime=0,!wt.decodeImageInWorker||wt.safari||wt.iosWeixin||(i._resWorkerConn=new gu),i.setToRedraw(),i}kt(i,e);var o=i.prototype;return o.render=function(e){this.prepareRender(),this.getMap()&&this.layer.isVisible()&&(this.resources||(this.resources=new yu),this.checkAndDraw(this._tryToDraw,e),this._frameTime=e)},o.getFrameTimestamp=function(){return this._frameTime||0},o.checkAndDraw=function(e,...n){var i=this;if(this._toRedraw=!1,this.checkResources){var o=this.checkResources();o.length>0?(this._loadingResource=!0,this.loadResources(o).then((function(){if(i._loadingResource=!1,i.layer){i.layer.fire("resourceload");var e=i.layer.getMap();i.setToRedraw(),e.getRenderer().callInNextFrame((function(){i.setToRedraw()}))}}))):e.call(this,...n)}else e.call(this,...n)},o.testIfNeedRedraw=function(){var e=this.getMap();return!this._loadingResource&&(!!this._toRedraw||!(e.isInteracting()&&!this.drawOnInteracting)&&!!this.needToRedraw())},o.needToRedraw=function(){var e=this.getMap();return!(!e.isInteracting()&&!e.getRenderer().isViewChanged())&&!(!e.getPitch()&&e.isMoving()&&!e.isZooming()&&!e.isRotating()&&!this.layer.options.forceRenderOnMoving)},o.onSkipDrawOnInteracting=function(){},o.isLoadingResource=function(){return this._loadingResource},o.isRenderComplete=function(){return!!this._renderComplete},o.mustRenderOnInteracting=function(){return!this._painted},o.setToRedraw=function(){return this._toRedraw=!0,this},o.setCanvasUpdated=function(){return this._canvasUpdated=!0,this},o.isCanvasUpdated=function(){return!!this._canvasUpdated},o.remove=function(){this.onRemove(),delete this._loadingResource,delete this.middleWest,delete this.canvas,delete this.context,delete this.canvasExtent2D,delete this._extent2D,this.resources&&this.resources.remove(),delete this.resources,this._resWorkerConn&&(this._resWorkerConn.remove(),delete this._resWorkerConn),delete this.layer},o.onRemove=function(){},o.onAdd=function(){},o.getMap=function(){return this.layer?this.layer.getMap():null},o.getCanvasImage=function(){var e=this.getMap();if(this._canvasUpdated=!1,this._renderZoom!==e.getZoom()||!this.canvas||!this._extent2D)return null;if(this.isBlank())return null;if(this.layer.isEmpty&&this.layer.isEmpty())return null;var n=e._pointToContainerPoint(this.middleWest)._add(0,-e.height/2);return{image:this.canvas,layer:this.layer,point:n}},o.clear=function(){this.clearCanvas()},o.isBlank=function(){return!this._painted},o.show=function(){this.setToRedraw()},o.hide=function(){this.clear(),this.setToRedraw()},o.setZIndex=function(e){this.setToRedraw()},o.hitDetect=function(e){if(!this.context||this.layer.isEmpty&&this.layer.isEmpty()||this.isBlank()||this._errorThrown||this.layer.isVisible&&!this.layer.isVisible())return!1;var n=this.getMap(),i=n.getDevicePixelRatio(),o=n.getSize();if(e.x<0||e.x>o.width*i||e.y<0||e.y>o.height*i)return!1;var s=this.getImageData&&this.getImageData();if(s){var a=Math.round(i*e.x),h=Math.round(i*e.y);return s.data[h*s.width*4+4*a+3]>0}try{if(this.context.getImageData(i*e.x,i*e.y,1,1).data[3]>0)return!0}catch(e){return this._errorThrown||(console&&console.warn("hit detect failed with tainted canvas, some geometries have external resources in another domain:\n",e),this._errorThrown=!0),!1}return!1},o.loadResources=function(e){this.resources||(this.resources=new yu);var n=this.resources,i=[];if(xe(e))for(var o={},s=e.length-1;s>=0;s--){var a=e[s];a&&a.length&&!o[a.join("-")]&&(o[a.join("-")]=1,n.isResourceLoaded(a,!0)||i.push(new Promise(this._promiseResource(a))))}return Promise.all(i)},o.prepareRender=function(){delete this._renderComplete;var e=this.getMap();this._renderZoom=e.getZoom(),this.canvasExtent2D=this._extent2D=e.get2DExtent(),this.middleWest=e._containerPointToPoint(new ee(0,e.height/2))},o.createCanvas=function(){if(!this.canvas){var e=this.getMap(),n=e.getSize(),i=e.getDevicePixelRatio(),o=Math.round(i*n.width),s=Math.round(i*n.height);if(this.layer._canvas){var a=this.layer._canvas;a.width=o,a.height=s,a.style&&(a.style.width=n.width+"px",a.style.height=n.height+"px"),this.canvas=this.layer._canvas}else this.canvas=_h.createCanvas(o,s,e.CanvasClass);this.onCanvasCreate()}},o.onCanvasCreate=function(){},o._canvasContextScale=function(e,n){return e.scale(n,n),e.dpr=n,this},o.createContext=function(){if(!(this.gl&&this.gl.canvas===this.canvas||this.context)&&(this.context=_h.getCanvas2DContext(this.canvas),this.context)){this.context.dpr=1,this.layer.options.globalCompositeOperation&&(this.context.globalCompositeOperation=this.layer.options.globalCompositeOperation);var e=this.getMap().getDevicePixelRatio();1!==e&&this._canvasContextScale(this.context,e)}},o.resetCanvasTransform=function(){if(this.context){var e=this.getMap().getDevicePixelRatio();this.context.setTransform(e,0,0,e,0,0)}},o.resizeCanvas=function(e){var n=this.canvas;if(n){var i=e||this.getMap().getSize(),o=this.getMap().getDevicePixelRatio(),{width:s,height:a,cssWidth:h,cssHeight:l}=cn(i,o);!this.layer._canvas||n.style.width===h&&n.style.height===l||(n.style.width=h,n.style.height=l),n.width===s&&n.height===a||(n.height=a,n.width=s,this.context&&(this.context.dpr=1),1!==o&&this.context&&this._canvasContextScale(this.context,o))}},o.clearCanvas=function(){if(this.context&&this.getMap()){var e=1/this.getMap().getDevicePixelRatio(),n=this.canvas.height*e;_h.clearRect(this.context,0,0,Math.max(this.canvas.width*e,this.canvas.width),Math.max(n,this.canvas.height))}},o.prepareCanvas=function(){this.canvas?(this.resetCanvasTransform(),this.clearCanvas(),this.resizeCanvas()):(this.createCanvas(),this.createContext(),this.layer.onCanvasCreate(),this.layer.fire("canvascreate",{context:this.context,gl:this.gl})),delete this._maskExtent;var e=this.layer.getMask();if(!e)return this.layer.fire("renderstart",{context:this.context,gl:this.gl}),null;var n=this._maskExtent=e._getMaskPainter().get2DExtent();return n&&this._extent2D&&n.intersects(this._extent2D),this.layer.fire("renderstart",{context:this.context,gl:this.gl}),n},o.clipCanvas=function(e){var n=this.layer.getMask();if(!n)return!1;if(!this.layer.options.maskClip)return!1;var i=this.middleWest,o=this.getMap();this.middleWest=o._containerPointToPoint(new ee(0,o.height/2)),e.save();var s=o.getDevicePixelRatio();if(1!==s&&(e.save(),this._canvasContextScale(e,s)),n.getGeometries){e.isMultiClip=!0;var a=n.getGeometries()||[];e.beginPath(),a.forEach((function(n){n._getMaskPainter().paint(null,e)})),e.stroke(),e.isMultiClip=!1}else{e.isClip=!0,e.beginPath(),n._getMaskPainter().paint(null,e),e.isClip=!1}1!==s&&e.restore();try{e.clip("evenodd")}catch(e){console.error(e)}return this.middleWest=i,!0},o.getViewExtent=function(){return{extent:this._extent2D,maskExtent:this._maskExtent,zoom:this._renderZoom,middleWest:this.middleWest}},o.completeRender=function(){this.getMap()&&(this._renderComplete=!0,this.layer.fire("renderend",{context:this.context,gl:this.gl}),this.setCanvasUpdated())},o.getEvents=function(){return{_zoomstart:this.onZoomStart,_zooming:this.onZooming,_zoomend:this.onZoomEnd,_resize:this.onResize,_movestart:this.onMoveStart,_moving:this.onMoving,_moveend:this.onMoveEnd,_dragrotatestart:this.onDragRotateStart,_dragrotating:this.onDragRotating,_dragrotateend:this.onDragRotateEnd,_spatialreferencechange:this.onSpatialReferenceChange}},o.onZoomStart=function(e){},o.onZoomEnd=function(e){this.setToRedraw()},o.onZooming=function(e){},o.onMoveStart=function(e){},o.onMoving=function(e){},o.onMoveEnd=function(e){this.setToRedraw()},o.onResize=function(e){delete this._extent2D,this.resizeCanvas(),this.setToRedraw()},o.onDragRotateStart=function(e){},o.onDragRotating=function(e){},o.onDragRotateEnd=function(e){this.setToRedraw()},o.onSpatialReferenceChange=function(e){},o.getDrawTime=function(){return this._drawTime},o._tryToDraw=function(e){this._toRedraw=!1,!this.canvas&&this.layer.isEmpty&&this.layer.isEmpty()?this._renderComplete=!0:this._drawAndRecord(e)},o._drawAndRecord=function(e){if(this.getMap()){var n=this._painted;this._painted=!0;var i=s();this.draw(e),i=s()-i,this._drawTime=n?i:i/2,n&&this.layer&&this.layer.options.logDrawTime&&console.log(this.layer.getId(),"frameTimeStamp:",e,"drawTime:",this._drawTime)}},o._promiseResource=function(e){var i=this,o=this.layer,s=this.resources,a=o.options.crossOrigin,l=o.options.renderer||"";return function(c){if(s.isResourceLoaded(e,!0))c(e);else{var A=fr(e[0]);if(wo(A))createImageBitmap(A).then((function(n){i._cacheResource(e,n),c(e)})).catch((function(n){console.error(n),c(e)}));else if(!ne(e[0])&&i._resWorkerConn&&("canvas"!==o.options.renderer||o.options.decodeImageInWorker))i._resWorkerConn.fetchImage(A,(function(n,o){if(n)return n&&"undefined"!=typeof console&&console.warn(n),void c(e);sn(o,(function(n){i._cacheResource(e,n),c(e)}))}));else{var f=new Image;h(a)?"canvas"!==l&&(f.crossOrigin=""):f.crossOrigin=a,ne(e[0])&&!n&&(e[1]&&(e[1]*=2),e[2]&&(e[2]*=2)),f.onload=function(){i._cacheResource(e,f),c(e)},f.onabort=function(n){console&&console.warn("image loading aborted: "+e[0]),n&&console&&console.warn(n),c(e)},f.onerror=function(n){n&&"undefined"!=typeof console&&console.warn(n),s.markErrorResource(e),c(e)},ie(f,[A])}}}},o._cacheResource=function(e,n){if(this.layer&&this.resources){var i=e[1],o=e[2];if(this.layer.options.cacheSvgOnCanvas&&1===ne(e[0])&&(wt.edge||wt.ie)){h(i)&&(i=n.width||this.layer.options.defaultIconSize[0]),h(o)&&(o=n.height||this.layer.options.defaultIconSize[1]);var s=_h.createCanvas(i,o);_h.image(s.getContext("2d"),n,0,0,i,o),n=s}this.resources.addResource(e,n)}},i}(Ih),yu=function(){function e(){this.resources={},this._errors={}}var n=e.prototype;return n.addResource=function(e,n){var i=this;if(this.resources[e[0]]={image:n,width:+e[1],height:+e[2],refCnt:0},n&&n.width&&n.height&&!n.close&&wt.imageBitMap&&!wt.safari&&!wt.iosWeixin){if(n.src&&ne(n.src))return;createImageBitmap(n).then((function(n){i.resources[e[0]]&&(i.resources[e[0]].image=n)}))}},n.isResourceLoaded=function(e,n){if(!e)return!1;var i=this._getImgUrl(e);if(this._errors[i])return!0;var o=this.resources[i];return!!o&&!(n&&ne(e[0])&&(+e[1]>o.width||+e[2]>o.height))},n.login=function(e){var n=this.resources[e];n&&n.refCnt++},n.logout=function(e){var n=this.resources[e];n&&n.refCnt--<=0&&(n.image&&n.image.close&&n.image.close(),delete this.resources[e])},n.getImage=function(e){var n=this._getImgUrl(e);return!this.isResourceLoaded(e)||this._errors[n]?null:this.resources[n].image},n.markErrorResource=function(e){this._errors[this._getImgUrl(e)]=1},n.merge=function(e){if(!e)return this;for(var n in e.resources){var i=e.resources[n];this.addResource([n,i.width,i.height],i.image)}return this},n.forEach=function(e){if(!this.resources)return this;for(var n in this.resources)g(this.resources,n)&&e(n,this.resources[n]);return this},n._getImgUrl=function(e){return Array.isArray(e)?e[0]:e},n.remove=function(){for(var e in this.resources){var n=this.resources[e];n&&n.image&&n.image.close&&n.image.close()}this.resources={}},e}();wt.decodeImageInWorker&&na(Xs,(function(){return"\nfunction (exports) {\n    exports.onmessage = function (msg, postResponse) {\n        var url = msg.data.url;\n        var fetchOptions = msg.data.fetchOptions;\n        requestImageOffscreen(url, function (err, data) {\n            var buffers = [];\n            if (data && data.data) {\n                buffers.push(data.data);\n            }\n            postResponse(err, data, buffers);\n        }, fetchOptions);\n    };\n\n    function requestImageOffscreen(url, cb, fetchOptions) {\n        fetch(url, fetchOptions ? fetchOptions : {})\n            .then(response => response.arrayBuffer())\n            .then(arrayBuffer => {\n                const blob=new Blob([arrayBuffer]);\n                return createImageBitmap(blob);\n            })\n            .then(bitmap => {\n                cb(null, {data:bitmap});\n            }).catch(err => {\n                console.warn('error when loading tile:', url);\n                console.warn(err);\n                cb(err);\n            });\n    }\n}"}));var vu={markerWidth:10,markerHeight:10,markerLineWidth:1},_u=new ee(0,0);function xu(e,n,i,o,s,a){var h=s.x+a.x,l=s.y+a.y;_u.x=h,_u.y=l;var c=function(e){if(!e)return 0;var{x:n,y:i}=e;if(0===n&&0===i)return 0;if(0===n||!n){if(i<0)return-Math.PI/2;if(i>0)return Math.PI/2}var o=i/n;return i<0&&n<0?Math.atan(o)-Math.PI:i>0&&n<0?Math.atan(o)+Math.PI:Math.atan(o)}(_u),A=Math.sqrt(h*h+l*l),f=0,d=0;f+=Math.cos(n+c)*A,d+=Math.sin(n+c)*A;var[p,g,v,w]=function(e,n,i){var o=Math.PI/2+i,s=Math.PI/4+i,a=i,h=n,l=Math.sqrt(e*e+n*n),c=e,A=Math.cos(o)*h,f=Math.sin(o)*h,d=Math.cos(s)*l,p=Math.sin(s)*l,g=Math.cos(a)*c,v=Math.sin(a)*c,w=Math.min(A,d,g,0),C=Math.min(f,p,v,0);return[w,C,Math.max(A,d,g,0)-w,Math.max(f,p,v,0)-C]}(i,o,n);d+=g;var C=(f+=p)+Math.max(i,v),P=d+Math.max(o,w);return e.set(f,d,C,P),e}var wu=new ee(0,0);function Cu(e,n,i,o,s,a,h){var l=wu.set(n,i);if(o)return xu(e,o,a,h,l,s);var c=e.set(l.x,l.y,l.x+a,l.y+h);return c._add(s),o&&function(e,n){var{xmin:i,ymin:o,xmax:s,ymax:a}=e;Ru.set(i,o,s,a),Ru.convertTo((function(e){return e._rotate(n)}),e)}(c,o),c}var Pu=[];function Mu(e,n,i){if((i=i||Ou(Pu,n))&&(0===i[0]||0===i[1]))return Wu(e),e;var o=Eu(n,i[0],i[1]);return Cu(e,n.markerDx||0,n.markerDy||0,Du(n),o,i[0],i[1])}function Tu(e){return"rectangle"===e?"right":"middle"}function Su(e){return"bar"===e||"pie"===e||"pin"===e?"top":"rectangle"===e?"bottom":"middle"}var Iu=new Cn(0,0);function Eu(e,n,i){var o=2*(e.shadowBlur||0)+.5;Iu.width=n,Iu.height=i;var s=e.markerType,a=ci(Iu,e.markerHorizontalAlignment||Tu(s),e.markerVerticalAlignment||Su(s));return a.x!==-n/2&&(a.x-=Ae(a.x+n/2)*o),a.y!==-i/2&&(a.y-=Ae(a.y+i/2)*o),a}function Ou(e,n){var i=ce(n.markerWidth,vu.markerWidth),o=ce(n.markerHeight,vu.markerHeight);if(0===i||0===o)return e[0]=0,e[1]=0,e;var s=ce(n.markerLineWidth,vu.markerLineWidth),a=2*((n.shadowBlur||0)+Math.max(Math.abs(n.shadowOffsetX||0)+Math.abs(n.shadowOffsetY||0))),h=Math.round(i+s+a+1),l=Math.round(o+s+a+1);return e[0]=h,e[1]=l,e}var Ru=new ll;function Du(e,n="markerRotation"){var i=e[n];return l(i)?-i*Math.PI/180:0}function ku(e,n,i){var o=i?i.getImage(n.markerFile):null,s=n.markerWidth||(o?o.width:0),a=n.markerHeight||(o?o.height:0);if(Iu.width=s,Iu.height=a,0===n.markerWidth||0===n.markerHeight)return Wu(e),e;var h=ci(Iu,n.markerHorizontalAlignment||"middle",n.markerVerticalAlignment||"top");return Cu(e,n.markerDx||0,n.markerDy||0,Du(n),h,s,a)}function Lu(e,n,i){var o=i.size;if(o&&(0===o.width||0===o.height))return Wu(e),e;var s=ci(o,n.textHorizontalAlignment,n.textVerticalAlignment),a=n.textHaloRadius||0,h=Cu(e,n.textDx||0,n.textDy||0,Du(n,"textRotation"),s,o.width,o.height);return h.xmin-=a,h.xmax+=a,h.ymin-=a,h.ymax+=a,h}var Fu=new ll;function Nu(e,n,i,o){var s=e||new ll;if(Array.isArray(n)){for(var a=n,h=0;h<a.length;h++)Nu(s,a[h],i,o[h]);return s}return zu(n)&&s._combine(Lu(Fu,n,o)),Bu(n)&&s._combine(ku(Fu,n,i)),Hu(n)&&s._combine(Mu(Fu,n)),ju(n)&&s._combine(ku(Fu,n)),s}function zu(e){return!!e&&!h(e.textName)}function Bu(e){return!!e&&!h(e.markerFile)}function Hu(e){return!!e&&!(!h(e.markerFile)||h(e.markerType)||"path"===e.markerType)}function ju(e){return!!e&&!(!h(e.markerFile)||"path"!==e.markerType)}var Uu,Gu=["markerWidth","markerHeight","markerHorizontalAlignment","markerVerticalAlignment","markerDx","markerDy","markerRotation","textName","textSize","textDx","textDy","textVerticalAlignment","textHorizontalAlignment","textRotation","textWrapWidth"],Vu=["textName","markerType","markerFile","textHaloRadius","shadowBlur","shadowOffsetX","shadowOffsetY","textWrapWidth"];function Wu(e){e&&(e.xmin=1/0,e.ymin=1/0,e.xmax=-1/0,e.ymax=-1/0)}function qu(e,n,i,o){for(var s,a=[],h=0,l=0,c=e.length;l<c-1;l++)(s=Zu(e[l],e[l+1],n,l,i,o))&&(a[h]=a[h]||[],a[h].push({point:s[0],index:l}),s[1]===e[l+1]&&l!==c-2||(a[h].push({point:s[1],index:l+1}),h++));return a}function Zu(e,n,i,o,s,a){var h,l,c,A=o?Uu:Yu(e,i),f=Yu(n,i);for(Uu=f;;){if(!(A|f))return[e,n];if(A&f)return!1;if(a)return[e,n];c=Yu(l=Xu(e,n,h=A||f,i,s),i),h===A?(e=l,A=c):(n=l,f=c)}}function Qu(e,n,i){var o,s,a,h,l,c,A,f,d,p=[1,4,2,8];for(s=0,A=e.length;s<A;s++)e[s]._code=Yu(e[s],n);for(h=0;h<4;h++){for(f=p[h],o=[],s=0,a=(A=e.length)-1;s<A;a=s++)c=e[a],(l=e[s])._code&f?c._code&f||((d=Xu(c,l,f,n,i))._code=Yu(d,n),o.push(d)):(c._code&f&&((d=Xu(c,l,f,n,i))._code=Yu(d,n),o.push(d)),o.push(l));e=o}return e}function Xu(e,n,i,o,s){var a,h,l=n.x-e.x,c=n.y-e.y,A=o.getMin(),f=o.getMax();8&i?(a=e.x+l*(f.y-e.y)/c,h=f.y):4&i?(a=e.x+l*(A.y-e.y)/c,h=A.y):2&i?(a=f.x,h=e.y+c*(f.x-e.x)/l):1&i&&(a=A.x,h=e.y+c*(A.x-e.x)/l);var d=new ee(a,h);return s&&d._round(),d}function Yu(e,n){var i=0;return e.x<n.getMin().x?i|=1:e.x>n.getMax().x&&(i|=2),e.y<n.getMin().y?i|=4:e.y>n.getMax().y&&(i|=8),i}function Ju(e,n,i,o){e=new ee(e);var s,a,h,l=Math.abs(i.x-n.x),c=Math.abs(i.y-n.y),A=Math.sqrt(Math.abs(l*l-c*c));return l>=c?(s=new ee(n.x-A,n.y),a=new ee(n.x+A,n.y),h=2*l):(s=new ee(n.x,n.y-A),a=new ee(n.x,n.y+A),h=2*c),e.distanceTo(s)+e.distanceTo(a)<=h+2*o}function Ku(e){if(!e)return[0,0];var n=1/0,i=-1/0;if(l(e))return[n=i=e,i];var o=function(e){for(var o=0,s=e.length;o<s;o++){var a=e[o];n=Math.min(n,a),i=Math.max(i,a)}};if(!Array.isArray(e[0]))return o(e),[n,i];for(var s=0,a=e.length;s<a;s++){o(e[s])}return[n,i]}var $u=function(){function e(){this.bbox=cs()}var n=e.prototype;return n._setBBOX=function(e,n,i,o,s){return e.isHitTesting||gs(this.bbox,n,i,o,s),this},n._bufferBBOX=function(e,n){return e.isHitTesting||ys(this.bbox,n),this},n.getMap=function(){return this.geometry.getMap()},n.getPainter=function(){return this.painter},n.isDynamicSize=function(){return!1},n.isVisible=function(){if(!this.style)return!0;var e=this.style.visible;return!1!==e&&0!==e&&!(this.style.opacity<=0)},e.testColor=function(e){return!(!e||!f(e))&&bn.indexOf(e)>=0},e}(),tc=function(e){function n(){return e.apply(this,arguments)||this}kt(n,e);var i=n.prototype;return i._prepareContext=function(e){if(Hr(this.symbol.opacity)?this._opacityFn||(this._opacityFn=Gr(this.symbol.opacity)):delete this._opacityFn,l(this.symbol.opacity))e.globalAlpha!==this.symbol.opacity&&(e.globalAlpha=this.symbol.opacity);else if(this._opacityFn){var n=this.getMap();e.globalAlpha=this._opacityFn(n.getZoom())}else 1!==e.globalAlpha&&(e.globalAlpha=1)},i.prepareCanvas=function(e,n,i){e.setLineDash&&xe(n.lineDasharray)&&e.setLineDash(n.lineDasharray);var o=this.getPainter().isHitTesting();_h.prepareCanvas(e,n,i,o)},i.remove=function(){},i.setZIndex=function(){},i.show=function(){},i.hide=function(){},i._defineStyle=function(e){return this.symbol&&(e.visible=this.symbol.visible,e.opacity=this.symbol.opacity),fo(e,this.geometry)},n}($u);function ec(e,n,i,o){var s,a=nc(i),h=i,l=h.markerType.toLowerCase(),c=ic(l,h.markerWidth,h.markerHeight),A=a.lineOpacity,f=a.polygonOpacity;Mo(a.polygonFill)&&(Mo(a.polygonFill)&&(s||(s=function(e,n,i){var o=new ll;return o._combine(e),o.xmin+=-n/2,o.ymin+=-i/2,o.xmax+=n/2,o.ymax+=i/2,o}(n,h.markerWidth,h.markerHeight)),a.polygonGradientExtent=s));_h.prepareCanvas(e,a,o);var d=h.markerWidth,p=h.markerHeight,g=h.markerLineWidth/2;if("ellipse"===l)_h.ellipse(e,n,d/2,p/2,p/2,A,f);else if("cross"===l||"x"===l){for(var v=c.length-1;v>=0;v--)c[v]._add(n);_h.path(e,c.slice(0,2),A),_h.path(e,c.slice(2,4),A)}else if("diamond"===l||"bar"===l||"square"===l||"rectangle"===l||"triangle"===l){"bar"===l?n=n.add(0,-g):"rectangle"===l&&(n=n.add(g,g));for(var w=c.length-1;w>=0;w--)c[w]._add(n);_h.polygon(e,c,A,f)}else if("pin"===l){n=n.add(0,-g);for(var C=c.length-1;C>=0;C--)c[C]._add(n);var P=e.lineCap;e.lineCap="round",_h.bezierCurveAndFill(e,c,A,f),e.lineCap=P}else{if("pie"!==l)throw new Error("unsupported markerType: "+l);n=n.add(0,-g);var T=180*Math.atan(d/2/p)/Math.PI,S=e.lineCap;e.lineCap="round",_h.sector(e,n,p,[90-T,90+T],A,f),e.lineCap=S}return e.canvas}function nc(e){var n={lineColor:e.markerLineColor,linePatternFile:e.markerLinePatternFile,lineWidth:e.markerLineWidth,lineOpacity:e.markerLineOpacity,lineDasharray:e.markerLineDasharray,lineCap:"butt",lineJoin:"round",polygonFill:e.markerFill,polygonPatternFile:e.markerFillPatternFile,polygonOpacity:e.markerFillOpacity};return 0===n.lineWidth&&(n.lineOpacity=0),n}function ic(e,n,i){var o,s,a,h,l=i/2,c=n/2;if("triangle"===e)return[o=new ee(0,0-l),s=new ee(0-c,0+l),a=new ee(0+c,0+l)];if("cross"===e)return[o=new ee(0-c,0),s=new ee(0+c,0),a=new ee(0,0-l),h=new ee(0,0+l)];if("diamond"===e)return[o=new ee(0-c,0),s=new ee(0,0-l),a=new ee(0+c,0),h=new ee(0,0+l)];if("square"===e)return[o=new ee(0-c,0+l),s=new ee(0+c,0+l),a=new ee(0+c,0-l),h=new ee(0-c,0-l)];if("rectangle"===e)return s=(o=new ee(0,0)).add(n,0),a=o.add(n,i),h=o.add(0,i),[o,s,a,h];if("x"===e)return[o=new ee(0-c,0+l),s=new ee(0+c,0-l),a=new ee(0+c,0+l),h=new ee(0-c,0-l)];if("bar"===e)return[o=new ee(0-c,0-i),s=new ee(0+c,0-i),a=new ee(0+c,0),h=new ee(0-c,0)];if("pin"===e||"pie"===e){var A=i*Math.atan(c/l);return[o=new ee(0,0),s=new ee(0-A,0-i),a=new ee(0+A,0-i),h=new ee(0,0)]}return[]}var rc=new ee(0,0),oc=new ee(0,0),ac=new ee(0,0),hc=new ee(0,0),lc=function(e){function n(n,i,o){var s;return(s=e.call(this)||this).symbol=n,s.geometry=i,s.painter=o,s.rotations=[],s}kt(n,e);var i=n.prototype;return i.get2DExtent=function(){for(var e=this.getMap(),n=e.getGLRes(),i=new ll,o=this._getRenderPoints()[0],s=o.length-1;s>=0;s--)o[s]&&i._combine(e._pointAtResToPoint(o[s],n));return i},i.isDynamicSize=function(){var e=this.symbol;return Hr(e.markerWidth)||Hr(e.markerHeight)||Hr(e.textSize)},i._rotateExtent=function(e,n){return e.convertTo((function(e){return e._rotate(n)}))},i._getRenderPoints=function(){var e=this.getPainter().isSpriting()?"center":this.getPlacement();return this.getPainter().getRenderPoints(e)},i._getRenderContainerPoints=function(e){var n=this.getPainter();if(n.isSpriting())return this._getRenderPoints()[0];var i,o=this.geometry,s=this.getDxDy();if(o._cPoint&&!e){var a=e?ac:hc;a.set(o._cPoint.x,o._cPoint.y),a._sub(n.containerOffset);var h=s.x,l=s.y;(h||l)&&a._add(h||0,l||0),i=[a]}else{var c=this._getRenderPoints()[0];i=this.painter._pointContainerPoints(c,s.x,s.y,e,!0,this.getPlacement())}if(!i||!Array.isArray(i[0]))return i;for(var A=[],f=0,d=i.length;f<d;f++)for(var p=0,g=i[f].length;p<g;p++)A.push(i[f][p]);return A},i.getPlacement=function(){return this.symbol.markerPlacement},i.getRotation=function(){return Du(this.style)},i.getDxDy=function(){var e=this.style;return new ee(e.markerDx,e.markerDy)},i._getRotationAt=function(e){var n=this.getRotation();n||(n=0);var i=this._getRenderPoints()[1];if(!i||!i[e])return n;var o=this.getMap(),s=i[e][0],a=i[e][1];if(!s||!a)return n;if(o.isTransforming()){var h=o.getGLRes();return s=o._pointAtResToContainerPoint(i[e][0],h,0,rc),a=o._pointAtResToContainerPoint(i[e][1],h,0,oc),n+Je(s.x,s.y,a.x,a.y)}return n+-Je(s.x,s.y,a.x,a.y)},i._rotate=function(e,n,i){if(i){var o=this.getDxDy(),s=n.sub(o);return e.save(),e.translate(s.x,s.y),e.rotate(i),o}return null},n}(tc),cc=function(e){function n(){return e.apply(this,arguments)||this}kt(n,e);var i=n.prototype;return i.getPlacement=function(){return"point"},i.getDxDy=function(){return new ee(0,0)},i.symbolize=function(e){var n=this.geometry,i=n.getLayer();if(n.options.debug||!i||i.options.debug){var o=this.getMap();if(o&&!o.isZooming()){var s=i.options.debugOutline;e.strokeStyle=s,e.fillStyle=s,e.lineWidth=1,e.font="18px  serif";var a=n.getContainerExtent().toArray();_h.polygon(e,[a],1,0);for(var l=this._getRenderContainerPoints(),c=this.geometry.getId(),A=ic("cross",10,10),f=0;f<l.length;f++){var d=l[f];h(c)||_h.fillText(e,c,d.add(8,-4),s);for(var p=[],g=0;g<A.length;g++)p.push(A[g].add(d));_h.path(e,p.slice(0,2),1),_h.path(e,p.slice(2,4),1)}}}},n}(lc),Ac=new Cn(1,1),fc=new ll,pc=function(e){function n(n,i,o){var s;return(s=e.call(this,n,i,o)||this).style=s._defineStyle(s.translate()),s}kt(n,e),n.test=function(e){return Bu(e)};var i=n.prototype;return i.symbolize=function(e,n){if(this.isVisible()){var i=this.style;if(this.painter.isHitTesting()||0!==i.markerWidth&&0!==i.markerHeight&&0!==i.markerOpacity){var o=this._getRenderContainerPoints();if(xe(o)){var s=this._getImage(n);if(s){this._prepareContext(e);var a,h=i.markerWidth,c=i.markerHeight;if(!l(h)||!l(c)){c=s.height,i.markerWidth=h=s.width,i.markerHeight=c;var A=i.markerFile;n.isResourceLoaded(A)||n.addResource(A,s);var f=this.getPainter();f.isSpriting()||f.removeCache()}"path"!==this.symbol.markerType&&l(i.markerOpacity)&&i.markerOpacity<1&&(a=e.globalAlpha,e.globalAlpha*=i.markerOpacity),Ac.width=h,Ac.height=c;var d=ci(Ac,i.markerHorizontalAlignment,i.markerVerticalAlignment);this.rotations=[];for(var p=0,g=o.length;p<g;p++){var v=o[p],w=this._rotate(e,v,this._getRotationAt(p)),C=void 0;if(w){var P=v.sub(w);v=w;var T=this._getRotationAt(p);(C=xu(fc,T,h,c,v,d))._add(P),this.rotations.push(T)}var S=v.x+d.x,I=v.y+d.y;_h.image(e,s,S,I,h,c),w&&e.restore(),w?this._setBBOX(e,C.xmin,C.ymin,C.xmax,C.ymax):this._setBBOX(e,S,I,S+h,I+c)}void 0!==a&&(e.globalAlpha=a)}else"undefined"!=typeof console&&console.warn("no img found for "+(this.style.markerFile||this._url[0]))}}}},i._getImage=function(e){return function(e,n){return e&&e.getImage(n)||null}(e,this.style.markerFile)},i.getFixedExtent=function(e){return this._fixedExtent=this._fixedExtent||new ll,ku(this._fixedExtent,this.style,e)},i.translate=function(){var e=this.symbol;return{markerFile:e.markerFile,markerOpacity:ce(e.markerOpacity,1),markerWidth:ce(e.markerWidth,null),markerHeight:ce(e.markerHeight,null),markerRotation:ce(e.markerRotation,0),markerDx:ce(e.markerDx,0),markerDy:ce(e.markerDy,0),markerHorizontalAlignment:ce(e.markerHorizontalAlignment,"middle"),markerVerticalAlignment:ce(e.markerVerticalAlignment,"top")}},n}(lc);let gc;const mc={width:100,height:10};let yc=!1;try{const e=new OffscreenCanvas(1,1);e.getContext("2d").fillText("hello",0,0),yc=!0}catch(e){yc=!1}let vc=class ColorIn{constructor(e,n={}){if(!Array.isArray(e))return void console.error("colors is not array");if(e.length<2)return void console.error("colors.length should >1");this.colors=e;let i=1/0,o=-1/0;for(let n=0,s=e.length;n<s;n++){const s=e[n][0];i=Math.min(s,i),o=Math.max(s,o)}this.min=i,this.max=o,this.valueOffset=this.max-this.min,this.options=Object.assign({},mc,n),this._initImgData()}getImageData(){return this.imgData}_initImgData(){const e=function(){if(!gc){const{width:e,height:n}=mc;yc?gc=new OffscreenCanvas(e,n):(gc=document.createElement("canvas"),gc.width=e,gc.height=n)}return gc}(),{width:n,height:i}=this.options;e.width=n,e.height=i;const o=e.getContext("2d");o.clearRect(0,0,e.width,e.height);const s=o.createLinearGradient(0,0,e.width,0),{colors:a,valueOffset:h}=this;for(let e=0,n=a.length;e<n;e++){const[n,i]=a[e];s.addColorStop((n-this.min)/h,i)}o.fillStyle=s,o.fillRect(0,0,e.width,e.height),this.imgData=o.getImageData(0,0,e.width,e.height)}getColor(e){e=Math.max(this.min,e),e=Math.min(e,this.max);let n=Math.round((e-this.min)/this.valueOffset*this.imgData.width);n=Math.min(n,this.imgData.width-1);const i=4*n;return[this.imgData.data[i],this.imgData.data[i+1],this.imgData.data[i+2],this.imgData.data[i+3]]}};var _c=new Zh(0,0),xc=new Zh(0,0),bc=function(e){function n(n,i,o){var s;return(s=e.call(this)||this).symbol=n,s.geometry=i,s.painter=o,i.isPoint?Ut(s):(s.style=s._defineStyle(s.translate()),s)}kt(n,e),n.test=function(e,n){if(!e)return!1;if(n&&n.isPoint)return!1;for(var i in e){var o=i.slice(0,4);if("line"===o||"poly"===o)return!0}return!1};var i=n.prototype;return i.symbolize=function(e,n){if(this.isVisible()){var i=this.style;if(0!==i.polygonOpacity||0!==i.lineOpacity||this.painter.isHitTesting()){var o=this._getPaintParams();if(o){this._prepareContext(e);var s=Mo(i.lineColor)||i.lineGradientProperty,a="Polygon"===this.geometry.getJSONType()||"LineString"===this.geometry.type;!s||!i.lineColor.places&&a||(i.lineGradientExtent=this.geometry.getContainerExtent()._expand(i.lineWidth)),Mo(i.polygonFill)&&(i.polygonGradientExtent=this.geometry.getContainerExtent());var h=this.geometry.getLayer().options.geometryEventTolerance||0,l=this.geometry._hitTestTolerance()+h,c=o[0];if("Polygon"===this.geometry.getJSONType()&&c.length>0&&Array.isArray(c[0][0])||"LineString"===this.geometry.type&&c.length>0&&Array.isArray(c[0]))for(var A=0;A<c.length;A++){this.prepareCanvas(e,i,n),s&&a&&!i.lineColor.places&&this._createGradient(e,c[A],i.lineColor);var f=[e,c[A]];o.length>1&&f.push(...o.slice(1)),f.push(i.lineOpacity,i.polygonOpacity,i.lineDasharray),s&&f.push(this._lineColorIn);var d=this.geometry._paintOn(...f);this._setBBOX(e,d),this._bufferBBOX(e,l)}else{this.prepareCanvas(e,i,n),s&&a&&!i.lineColor.places&&this._createGradient(e,c,i.lineColor);var p=[e];p.push(...o),p.push(i.lineOpacity,i.polygonOpacity,i.lineDasharray),s&&p.push(this._lineColorIn);var g=this.geometry._paintOn(...p);this._setBBOX(e,g),this._bufferBBOX(e,l)}e.setLineDash&&Array.isArray(i.lineDasharray)&&e.setLineDash([]),this._tempRenderPoints=c}}}},i.get2DExtent=function(){var e=this.getMap(),n=this.geometry._getPrjExtent();if(!n)return null;this._extMin&&this._extMax||(this._extMin=new Zh(0,0),this._extMax=new Zh(0,0)),this._extMin.x=n.xmin,this._extMin.y=n.ymin,this._extMax.x=n.xmax,this._extMax.y=n.ymax;var i=e._prjToPoint(this._extMin,void 0,_c),o=e._prjToPoint(this._extMax,void 0,xc);return this._pxExtent?this._pxExtent.set(Math.min(i.x,o.x),Math.min(i.y,o.y),Math.max(i.x,o.x),Math.max(i.y,o.y)):this._pxExtent=new ll(i,o),this._pxExtent},i.getFixedExtent=function(){var e=this.style.lineWidth/2;return new ll(-e,-e,e,e)},i._getPaintParams=function(){return this.getPainter().getPaintParams(this.style.lineDx,this.style.lineDy)},i.translate=function(){var e=this.symbol,n={lineColor:ce(e.lineColor,"#000"),lineWidth:ce(e.lineWidth,2),lineOpacity:ce(e.lineOpacity,1),lineDasharray:ce(e.lineDasharray,[]),lineCap:ce(e.lineCap,"butt"),lineJoin:ce(e.lineJoin,"miter"),linePatternFile:ce(e.linePatternFile,null),lineDx:ce(e.lineDx,0),lineDy:ce(e.lineDy,0),polygonFill:ce(e.polygonFill,null),polygonOpacity:ce(e.polygonOpacity,1),polygonPatternFile:ce(e.polygonPatternFile,null),polygonPatternDx:ce(e.polygonPatternDx,0),polygonPatternDy:ce(e.polygonPatternDy,0),linePatternDx:ce(e.linePatternDx,0),linePatternDy:ce(e.linePatternDy,0),lineGradientProperty:ce(e.lineGradientProperty,null)};return 0===n.lineWidth&&(n.lineOpacity=0),"LineString"!==this.geometry.type||n.polygonFill||(n.polygonFill=n.lineColor),n},i._createGradient=function(e,n,i){if(Array.isArray(n)&&n.length){var[o,s]=function(e){var n,i=!0;Array.isArray(e[0])?(n=e[0],i=!1):n=e;var o=n.length;if(i)return[n[0],n[o-1]];for(var s,a=n[0],h=0,l=1;l<o;l++){var c=n[l],A=a.distanceTo(c);A>h&&(h=A,s=c)}return[a,s]}(n);if(o&&s){var a;if(i.colorStops&&(a=i.colorStops),!a)a=(this.geometry.properties||{})[(this.style||{}).lineGradientProperty];if(a&&Array.isArray(a)&&!(a.length<2)){if(!Array.isArray(a[0])){for(var h=[],l=[],c=0,A=0,f=a.length;A<f;A+=2)l[0]=a[A],l[1]=a[A+1],h[c]=l,c++,l=[];a=h}var d=e.createLinearGradient(o.x,o.y,s.x,s.y);a.forEach((function(e){d.addColorStop(...e)})),e.strokeStyle=d;var p=JSON.stringify(a);if(p!==this._lineColorStopsKey){this._lineColorStopsKey=p;var g=a.map((function(e){return[parseFloat(e[0]),e[1]]}));this._lineColorIn=new vc(g,{height:1,width:100})}}}else console.error("unable create canvas LinearGradient,error data:",n)}},n}(tc);var wc=new ll;var Cc,Pc=function(e){function n(n,i,o){var s,a=(s=e.call(this,n,i,o)||this).translate();return s._dynamic=jr(a),s.style=s._defineStyle(a),0===s.style.textWrapWidth?Ut(s):(s.strokeAndFill=s._defineStyle(s.translateLineAndFill(s.style)),s)}kt(n,e),n.test=function(e){return zu(e)};var i=n.prototype;return i.isAlongLine=function(){var e=this.getPlacement(),n=this.style.textSpacing;return"line"===e&&l(n)&&n>0},i.symbolize=function(e,n){if(this.isVisible()&&(this.painter.isHitTesting()||0!==this.style.textSize&&(this.style.textOpacity||this.style.textHaloRadius&&this.style.textHaloOpacity)&&0!==this.style.textWrapWidth)){var i=this.style,o=this.strokeAndFill,s=li(this.style.textName,this.geometry.getProperties());this._dynamic&&delete this._textDesc;var a=this._textDesc=this._textDesc||ui(s,this.style);this._prepareContext(e),this.prepareCanvas(e,o,n),_h.prepareCanvasFont(e,i);var h=i.textHaloRadius||0;if(this.rotations=[],this.isAlongLine()){var l=this.getPainter().getPathTempRenderPoints();if(!l)return;if(l=function(e,n){var{width:i,height:o}=n,s=i+0,a=o+0;wc.xmin=-0,wc.ymin=-0,wc.xmax=s,wc.ymax=a,Array.isArray(e[0])||(e=[e]);var h=[];return e.forEach((function(e){for(var n=!1,i=0,o=e.length;i<o;i++){var{x:l,y:c}=e[i];if(l<-0||l>s||c<-0||c>a){n=!0;break}}n?qu(e,wc,!1,!1).forEach((function(e){for(var n=[],i=0,o=e.length;i<o;i++)n[i]=e[i].point;h.push(n)})):h.push(e)})),h}(l,this.getMap().getSize()),l){var c=this.geometry.getLayer(),A=_h.textAlongLine(e,s,l,i,a,c.options.collision?c.getCollisionIndex():null);A&&(this._setBBOX(e,A),this._bufferBBOX(e,h))}}else{var f=this._getRenderContainerPoints();if(!xe(f))return;for(var d=0,p=f.length;d<p;d++){var g=f[d],v=this._rotate(e,g,this._getRotationAt(d)),w=void 0;if(v){var C=g.sub(v);g=v;var P=this._getRotationAt(d),{width:T,height:S}=a.size||{width:0,height:0},I=ci(a.size,i.textHorizontalAlignment,i.textVerticalAlignment);(w=xu(wc,P,T,S,g,I))._add(C),this.rotations.push(P)}var E=_h.text(e,s,g,i,a);v?(this._setBBOX(e,w.xmin,w.ymin,w.xmax,w.ymax),e.restore()):this._setBBOX(e,E),this._bufferBBOX(e,h)}}}},i.getPlacement=function(){return this.symbol.textPlacement},i.getRotation=function(){var e=this.style.textRotation;return l(e)?-e*Math.PI/180:null},i.getDxDy=function(){var e=this.style;return new ee(e.textDx,e.textDy)},i.getFixedExtent=function(){var e=this.geometry.getTextDesc();return Array.isArray(e)&&(e=e[this._index]),this._fixedExtent=this._fixedExtent||new ll,e?Lu(this._fixedExtent,this.style,e):this._fixedExtent},i.translate=function(){var e=this.symbol,n={textName:e.textName,textFaceName:ce(e.textFaceName,"monospace"),textWeight:ce(e.textWeight,"normal"),textStyle:ce(e.textStyle,"normal"),textSize:ce(e.textSize,wn),textFont:ce(e.textFont,null),textFill:ce(e.textFill,"#000"),textOpacity:ce(e.textOpacity,1),textHaloFill:ce(e.textHaloFill,"#ffffff"),textHaloRadius:ce(e.textHaloRadius,0),textHaloOpacity:ce(e.textHaloOpacity,1),textWrapWidth:ce(e.textWrapWidth,null),textWrapCharacter:ce(e.textWrapCharacter,"\n"),textLineSpacing:ce(e.textLineSpacing,0),textDx:ce(e.textDx,0),textDy:ce(e.textDy,0),textHorizontalAlignment:ce(e.textHorizontalAlignment,"middle"),textVerticalAlignment:ce(e.textVerticalAlignment,"middle"),textAlign:ce(e.textAlign,"center"),textRotation:ce(e.textRotation,0),textMaxWidth:ce(e.textMaxWidth,0),textMaxHeight:ce(e.textMaxHeight,0),textSpacing:ce(e.textSpacing,0),textAlongDebug:ce(e.textAlongDebug,!1)};return n.textMaxWidth>0&&(!n.textWrapWidth||n.textWrapWidth>n.textMaxWidth)&&(n.textWrapWidth||(n.textMaxHeight=1),n.textWrapWidth=n.textMaxWidth),n},i.translateLineAndFill=function(e){return{lineColor:e.textHaloRadius?e.textHaloFill:e.textFill,lineWidth:e.textHaloRadius,lineOpacity:e.textOpacity,lineDasharray:null,lineCap:"butt",lineJoin:"round",polygonFill:e.textFill,polygonOpacity:e.textOpacity}},n}(lc),Sc=[0,0],Ic=new ll,Oc=new ee(0,0),Rc=function(e){function n(n,i,o){var s,a=(s=e.call(this,n,i,o)||this).translate();return s._dynamic=jr(a),s.style=s._defineStyle(a),s.strokeAndFill=s._defineStyle(nc(s.style)),s.padding=0,s}kt(n,e),n.test=function(e){return Hu(e)};var i=n.prototype;return i.symbolize=function(e,n){if(this.isVisible()){var i=this.style;if(this.painter.isHitTesting()||0!==i.markerWidth&&0!==i.markerHeight&&(0!==i.polygonOpacity||0!==i.lineOpacity)){var o=this._getRenderContainerPoints();xe(o)&&(this._prepareContext(e),this.getPainter().isSpriting()||this.geometry.getLayer().getMask()===this.geometry||this._dynamic||!1===this.geometry.getLayer().options.cacheVectorOnCanvas?this._drawMarkers(e,o,n):this._drawMarkersWithCache(e,o,n))}}},i._drawMarkers=function(e,n,i){for(var o=n.length-1;o>=0;o--){var s=n[o],a=Ou(Sc,this.style),[h,l]=a,c=this._rotate(e,s,this._getRotationAt(o));this.rotations=[];var A=void 0;if(c){var f=s.sub(c);s=c;var d=this._getRotationAt(o);(A=xu(Ic,d,h,l,s,Oc))._add(f),this.rotations.push(d)}if(this._drawVectorMarker(e,s,i),c)e.restore(),this._setBBOX(e,A.xmin,A.ymin,A.xmax,A.ymax);else{var{x:p,y:g}=s;this._setBBOX(e,p,g,p+h,g+l)}}},i._drawMarkersWithCache=function(e,n,i){var o=this._stampSymbol(),s=i.getImage(o);s||(s=this._createMarkerImage(e,i),i.addResource([o,s.width,s.height],s));for(var a=Eu(this.style,s.width,s.height),h=n.length-1;h>=0;h--){var l=n[h],c=this._rotate(e,l,this._getRotationAt(h));this.rotations=[];var A=void 0;if(c){var f=l.sub(c);l=c;var d=this._getRotationAt(h);(A=xu(Ic,d,s.width,s.height,l,a))._add(f),this.rotations.push(d)}var p=l.x+a.x,g=l.y+a.y;_h.image(e,s,p,g),c?(e.restore(),this._setBBOX(e,A.xmin,A.ymin,A.xmax,A.ymax)):this._setBBOX(e,p,g,p+s.width,g+s.height)}},i._createMarkerImage=function(e,n){var i=e.canvas.constructor,o=Ou(Sc,this.style),s=_h.createCanvas(o[0],o[1],i),a=this._getCacheImageAnchor(o[0],o[1]),h=s.getContext("2d");return this._drawVectorMarker(h,a,n),s},i._stampSymbol=function(){return this._stamp||(this._stamp=yi([this.style.markerType,Mo(this.style.markerFill)?So(this.style.markerFill):this.style.markerFill,this.style.markerFillOpacity,this.style.markerFillPatternFile,Mo(this.style.markerLineColor)?So(this.style.markerLineColor):this.style.markerLineColor,this.style.markerLineWidth,this.style.markerLineOpacity,this.style.markerLineDasharray?this.style.markerLineDasharray.join(","):"",this.style.markerLinePatternFile,this.style.markerWidth,this.style.markerHeight,this.style.markerHorizontalAlignment,this.style.markerVerticalAlignment].join("_"))),this._stamp},i._getCacheImageAnchor=function(e,n){var i=2*(this.symbol.shadowBlur||0)+this.padding,o=this.style.markerType;return"bar"===o||"pie"===o||"pin"===o?new ee(e/2,n-i):"rectangle"===o?new ee(i,i):new ee(e/2,n/2)},i._getGraidentExtent=function(e){var n=new ll,i=this.getDxDy(),o=this.getFixedExtent();if(Array.isArray(e))for(var s=e.length-1;s>=0;s--)n._combine(e[s]);else n._combine(e);return n.xmin+=o.xmin-i.x,n.ymin+=o.ymin-i.y,n.xmax+=o.xmax-i.x,n.ymax+=o.ymax-i.y,n},i._drawVectorMarker=function(e,n,i){ec(e,n,this.style,i)},i.getFixedExtent=function(){var e=this.isDynamicSize(),n=this.style.markerWidth,i=this.style.markerHeight;return this._fixedExtent=this._fixedExtent||new ll,Mu(this._fixedExtent,this.style,e?[128,128*(0===n?1:i/n)]:null)},i.translate=function(){var e=this.symbol,n={markerType:ce(e.markerType,"ellipse"),markerFill:ce(e.markerFill,"#00f"),markerFillOpacity:ce(e.markerFillOpacity,1),markerFillPatternFile:ce(e.markerFillPatternFile,null),markerLineColor:ce(e.markerLineColor,"#000"),markerLineWidth:ce(e.markerLineWidth,vu.markerLineWidth),markerLineOpacity:ce(e.markerLineOpacity,1),markerLineDasharray:ce(e.markerLineDasharray,[]),markerLinePatternFile:ce(e.markerLinePatternFile,null),markerDx:ce(e.markerDx,0),markerDy:ce(e.markerDy,0),markerWidth:ce(e.markerWidth,vu.markerWidth),markerHeight:ce(e.markerHeight,vu.markerHeight),markerRotation:ce(e.markerRotation,0),shadowBlur:ce(e.shadowBlur,0),shadowOffsetX:ce(e.shadowOffsetX,0),shadowOffsetY:ce(e.shadowOffsetY,0)},i=n.markerType,o=Tu(i),s=Su(i);return n.markerHorizontalAlignment=ce(e.markerHorizontalAlignment,o),n.markerVerticalAlignment=ce(e.markerVerticalAlignment,s),l(e.markerOpacity)&&(l(e.markerFillOpacity)&&(n.markerFillOpacity*=e.markerOpacity),l(e.markerLineOpacity)&&(n.markerLineOpacity*=e.markerOpacity)),n},n}(lc),Dc=function(e){function n(n,i,o){var s;h(n.markerWidth)&&(n.markerWidth=80),h(n.markerHeight)&&(n.markerHeight=80),n=a({},n,(s=e.call(this,n,i,o)||this).translate());var l=s.style=s._defineStyle(n);return s._url=wt.gecko?[yo(l,l.markerWidth,l.markerHeight),l.markerWidth,l.markerHeight]:[yo(l),l.markerWidth,l.markerHeight],s}kt(n,e),n.test=function(e){return ju(e)};var i=n.prototype;return i._prepareContext=function(){},i._getImage=function(e){var n=this;if(e&&e.isResourceLoaded(this._url))return e.getImage(this._url);var i=this.painter,o=new Image;return o.onload=function(){var e=i.getLayer()&&i.getLayer().getRenderer();e&&e.setToRedraw()},o.onerror=function(i){i&&"undefined"!=typeof console&&console.warn(i),e.markErrorResource(n._url)},o.src=this._url[0],e&&e.addResource(this._url,o),o},n}(pc),Lc={lineWidth:1,polygonFill:"#fff",polygonOpacity:.5},Nc=function(e){function n(n,i,o){var s;return(s=e.call(this,n,i,o)||this).style=i.getLayer().options.drawAltitude,s.style&&A(s.style)||(s.style={lineWidth:2}),s.style.lineWidth||(s.style.lineWidth=0),s.dxdy=s._defineStyle({dx:n.textDx||n.markerDx,dy:n.textDy||n.markerDy}),s}kt(n,e),n.test=function(e,n){if(!n.getLayer())return!1;var i=n.getJSONType();return"Marker"===i||"LineString"===i};var i=n.prototype;return i.symbolize=function(e){if(this.geometry.getLayer().options.drawAltitude&&this.geometry.hasAltitude()){var n=this._getStyle();if(this._prepareContext(e),"LineString"===this.geometry.type){var i=this._getPaintParams(n.lineDx,n.lineDy);if(!i)return;var o=this.getPainter().getPaintParams(n.lineDx,n.lineDy,!0,!0,"_groundpt")[0];this._drawLineAltitude(e,i[0],o)}else{var s=this._getRenderContainerPoints(),a=this._getRenderContainerPoints(!0);if(!s||0===s.length)return;this._drawMarkerAltitude(e,s[0],a[0])}}},i.getDxDy=function(){var e=this.dxdy;return new ee(e.dx||0,e.dy||0)},i.get2DExtent=function(){return"LineString"===this.geometry.type?bc.prototype.get2DExtent.apply(this):e.prototype.get2DExtent.call(this)},i.getPlacement=function(){return"point"},i._getPaintParams=function(e,n){return this.getPainter().getPaintParams(e||0,n||0,null,!0,"_altpt")},i._drawMarkerAltitude=function(e,n,i){var o=this._getStyle();this.prepareCanvas(e,o),_h.path(e,[n,i],o.lineOpacity,null,o.lineDasharray)},i._drawLineAltitude=function(e,n,i){var o=this._getStyle();if(n.length>0&&Array.isArray(n[0]))for(var s=0;s<n.length;s++)this._drawLine(e,n[s],i[s]);else this._drawLine(e,n,i);e.setLineDash&&Array.isArray(o.lineDasharray)&&e.setLineDash([])},i._drawLine=function(e,n,i){var o=this._getStyle();this.prepareCanvas(e,o);for(var s=0,a=n.length-1;s<a;s++)_h.polygon(e,[n[s],n[s+1],i[s+1],i[s]],o.lineOpacity,o.polygonOpacity,o.lineDasharray)},i._getStyle=function(){var e=this.geometry.getLayer(),n=e.options.drawAltitude;if(Array.isArray(n)){var i=(e.getGeometries()||[]).indexOf(this.geometry);i>=0&&(n=n[i]||Lc)}return A(n)||(n=Lc),n.lineWidth||(n.lineWidth=0,n.lineOpacity=0),n},n}(lc),zc=Object.freeze({__proto__:null,CanvasSymbolizer:tc,DebugSymbolizer:cc,DrawAltitudeSymbolizer:Nc,ImageMarkerSymbolizer:pc,PointSymbolizer:lc,StrokeAndFillSymbolizer:bc,Symbolizer:$u,TextMarkerSymbolizer:Pc,VectorMarkerSymbolizer:Rc,VectorPathMarkerSymbolizer:Dc}),Bc=[Nc,bc,pc,Dc,Rc,Pc],Hc=new ee(0,0),jc=new ll,Uc=new ll,Gc=new ll,Vc=new ll,Wc=new ll,qc={code:void 0},Zc={minx:1/0,miny:1/0,maxx:-1/0,maxy:-1/0},Qc=function(e){function n(n){var i;return(i=e.call(this)||this).geometry=n,i.symbolizers=i._createSymbolizers(),i._altAtGL=i._getGeometryAltitude(),i.bbox=cs(),i._drawTime=0,i}kt(n,e);var i=n.prototype;return i._setDrawTime=function(e){return this._drawTime=e,this},i.getRenderBBOX=function(){var e=this.getLayer();if(e&&e._drawTime!==this._drawTime)return null;ds(this.bbox);for(var n=this.symbolizers.length-1;n>=0;n--){var i=this.symbolizers[n].bbox;ms(i)&&gs(this.bbox,i)}return ms(this.bbox)?this.bbox:null},i.getMap=function(){return this.geometry.getMap()},i.getLayer=function(){return this.geometry&&this.geometry.getLayer()},i._createSymbolizers=function(){var e=this.getSymbol(),n=[],i=Bc,o=e;Array.isArray(e)||(o=[e]);for(var s=o.length-1;s>=0;s--)for(var a=o[s],h=i.length-1;h>=0;h--)if(i[h].test(a,this.geometry)){var l=new i[h](a,this.geometry,this);l._index=s,n.push(l),l instanceof lc&&(this._hasPoint=!0)}if(!n.length&&console){var c=this.geometry.getId();console.warn("invalid symbol for geometry("+(this.geometry?this.geometry.getType()+(c?":"+c:""):"")+") to draw : "+JSON.stringify(e))}return this._debugSymbolizer=new cc(e,this.geometry,this),n},i.hasPoint=function(){return!!this._hasPoint},i.getRenderPoints=function(e){return this._verifyProjection(),this._renderPoints||(this._renderPoints={}),e||(e="center"),this._renderPoints[e]||(this._renderPoints[e]=this.geometry._getRenderPoints(e)),this._renderPoints[e]},i.getPaintParams=function(e,n,i,o,s="_pt"){var a,h,c,A,f,d=this.getLayer()._getRenderer().mapStateCache,p=this.getMap();d&&!this._hitPoint?(a=d.resolution,h=d.pitch,c=d.bearing,A=d.glScale,f=d.containerExtent):(a=p.getResolution(),h=p.getPitch(),c=p.getBearing(),A=p.getGLScale(),f=p.getContainerExtent());var g=this.geometry,v=a,w=0!==h,C=0!==c,P=this._cachedParams,T=g._paintAsPath&&g._paintAsPath();if(T&&this._unsimpledParams&&v<=this._unsimpledParams._res)P=this._unsimpledParams;else if(!P||P._res!==a||this._pitched!==w&&g._redrawWhenPitch()||this._rotated!==C&&g._redrawWhenRotate()){if(!(P=g._getPaintParams()))return null;P._res=v,!g._simplified&&T&&(this._unsimpledParams||(this._unsimpledParams=P),v>this._unsimpledParams._res&&(this._unsimpledParams._res=v)),this._cachedParams=P}if(!P)return null;this._pitched=w,this._rotated=C;var S=A,I=[],E=this._pointContainerPoints(P[0],e,n,i,o||this._hitPoint&&!f.contains(this._hitPoint),null,s);if(!E)return null;I.push(E);for(var O=1,k=P.length;O<k;O++)l(P[O])||P[O]instanceof Cn?l(P[O])?I.push(P[O]/S):I.push(P[O].multi(1/S)):I.push(P[O]);return I},i._pointContainerPoints=function(e,n,i,o,s,a,h="_pt"){if(this._aboveCamera())return null;var c,A,f,d=this.getLayer()._getRenderer(),p=d.mapStateCache,g=this.getMap(),v=this.geometry,w=this.containerOffset;p?(c=p.glRes,A=p.containerExtent):(c=g.getGLRes(),A=g.getContainerExtent());var C=this.getLayer().options.roundPoint,P=1/0,T=1/0,S=-1/0,I=-1/0,E=!s,O=d.layer.options.clipBBoxBufferSize||3,k=this.symbolizers,L=v.options.enableClip;function F(e=[],o=[]){for(var s=on(e,h),a=0,l=(s=g._pointsAtResToContainerPoints(e,c,o,s)).length;a<l;a++){var f=s[a];f._sub(w),(n||i)&&f._add(n||0,i||0),C&&(f.x=Math.ceil(f.x),f.y=Math.ceil(f.y)),P=Math.min(f.x,P),T=Math.min(f.y,T),S=Math.max(f.x,S),I=Math.max(f.y,I)}if(L&&E&&Ho(k)){if(Wc.ymin=A.ymin,Wc.ymin<O&&(Wc.ymin=A.ymin-O),Wc.xmin=A.xmin-O,Wc.xmax=A.xmax+O,Wc.ymax=A.ymax+O,v.getShell&&v.getHoles)return Qu(s,Wc);var d=qu(s,Wc,!1);if(d.length){var p=[];return d.forEach((function(e){for(var n=0,i=e.length;n<i;n++)p.push(e[n].point)})),p}}return s}var N=this.getAltitude();if(Array.isArray(e)){var z;!s&&this.geometry.options.enableClip?(z=this._clip(e,N)).inView&&(E=!1):z={points:e,altitude:N};var H=z.points;N=z.altitude,o&&(N=0);var j=N;f=[];for(var W=[],q=l(N),Y=0,J=H.length;Y<J;Y++){var $=H[Y];if(Array.isArray($)){if(q){var it=F($,N);f.push(it);continue}for(var rt=[],ot=0,st=$.length;ot<st;ot++)Array.isArray(N)&&(j=N[Y]?N[Y][ot]:0),rt.push(j);var at=F($,rt);f.push(at)}else Array.isArray(N)&&(j="vertex-last"===a?N[N.length-1-Y]:"line"===a?(N[Y]+N[Y+1])/2:N[Y]),W.push(j)}W.length&&(f=F(H,W))}else e instanceof ee&&(o&&(N=0),f=g._pointAtResToContainerPoint(e,c,N)._sub(w),(n||i)&&f._add(n,i));return Zc.minx=P,Zc.miny=T,Zc.maxx=S,Zc.maxy=I,this._containerBbox=Zc,f},i._clip=function(e,n){if(l(n)&&0!==n)return{points:e,altitude:n};if(Array.isArray(n)){for(var i=!1,o=0,s=n.length;o<s;o++)if(0!==n[o]){i=!0;break}if(i)return{points:e,altitude:n}}var a=this.getMap(),h=this.geometry,c=this.getSymbol().lineWidth;l(c)||(c=4);var A,f,d,p=this.getLayer()._getRenderer().mapStateCache;p?(A=p._2DExtent,f=p.glExtent,d=p.pitch):(A=a.get2DExtent(),f=a.get2DExtentAtRes(a.getGLRes()),d=a.getPitch());var g=A._expand(c);if(d>0&&n){var v=a.cameraLookAt,w=a.cameraPosition;Hc.set(w[0],w[1]),g=g._combine(Hc._add(Ae(v[0]-w[0]),Ae(v[1]-w[1])))}var C=e;if(this.get2DExtent(null,Vc).within(g))return{points:C,altitude:n,inView:!0};var P=f._expand(c*a.getGLScale());Gc.xmin=P.xmin,Gc.xmax=P.xmax,Gc.ymin=P.ymin,Gc.ymax=P.ymax;var T=h.options.smoothness;if(h.getShell&&this.geometry.getHoles&&!T){var{xmin:S,ymin:I,xmax:E,ymax:O}=P,k=Math.abs(E-S),L=Math.abs(O-I),F=Math.sqrt(k*k+L*L),N=(F-k)/2,z=(F-L)/2;if(Gc.xmin=P.xmin-N,Gc.xmax=P.xmax+N,Gc.ymin=P.ymin-z,Gc.ymax=P.ymax+z,Array.isArray(e[0])){C=[];for(var H=0;H<e.length;H++){var j=Qu(e[H],Gc);j.length&&C.push(j)}}else C=Qu(e,Gc)}else if("LineString"===h.getJSONType()&&!T){if(Array.isArray(e[0])){C=[];for(var W=0;W<e.length;W++)he(C,qu(e[W],Gc,!1,!!T))}else C=qu(e,Gc,!1,!!T);return this._interpolateSegAlt(C,e,n)}return{points:C,altitude:n}},i._interpolateSegAlt=function(e,n,i){if(!Array.isArray(i)){var o=function(e){return e.point};return{points:e.map((function(e){return Array.isArray(e)?e.map(o):e.point})),altitude:i}}var s=Jc(e,n,i);i=[];var a=s.map((function(e){if(Array.isArray(e)){var n=[],o=e.map((function(e){return n.push(e.altitude),e.point}));return i.push(n),o}return i.push(e.altitude),e.point}));return{points:a,altitude:i}},i.getSymbol=function(){return this.geometry._getInternalSymbol()},i._resetSymbolizersBBOX=function(){for(var e=this.symbolizers.length-1;e>=0;e--){ds(this.symbolizers[e].bbox)}return this},i.paint=function(e,n,i){if(this.symbolizers){var o=this.getLayer(),s=o._getRenderer();if(s&&(s.context||n)){var a=s.mapStateCache||{offset:void 0};if(this.geometry._isCheck||!e||e.intersects(this.get2DExtent(s.resources,jc))){var h=this.getMap();if(!this._aboveCamera()){this.containerOffset=i||a.offset||h._pointToContainerPoint(s.middleWest)._add(0,-h.height/2),this._beforePaint();var l=n||s.context;l.isHitTesting||this._resetSymbolizersBBOX();for(var c=[l,s.resources],A=this.symbolizers.length-1;A>=0;A--)(l.shadowBlur||this.symbolizers[A].symbol.shadowBlur)&&this._prepareShadow(l,this.symbolizers[A].symbol),this.symbolizers[A].symbolize(...c);this._afterPaint(),this._painted=!0,(this.geometry.options.debug||o.options.debug)&&this._debugSymbolizer.symbolize(l)}}}}},i.getSprite=function(e,n){if(!this.geometry.isPoint)return null;if(this._spriting=!0,!this._sprite&&this.symbolizers.length>0){var i=new ll;this.symbolizers.forEach((function(n){var o=n.getFixedExtent(e);i._combine(o)}));var o,s=i.getMin().multi(-1),a=n||(this.getMap()?this.getMap().CanvasClass:null),h=_h.createCanvas(i.getWidth(),i.getHeight(),a);this._renderPoints&&(o=this._renderPoints);for(var l=h.getContext("2d"),c=[l,e],A=this.symbolizers.length-1;A>=0;A--){var f=this.symbolizers[A].getDxDy();this._renderPoints={center:[[s.add(f)]]},this._prepareShadow(l,this.symbolizers[A].symbol),this.symbolizers[A].symbolize(...c)}o&&(this._renderPoints=o),this._sprite={canvas:h,offset:i.getCenter()}}return this._spriting=!1,this._sprite},i.isSpriting=function(){return!!this._spriting},i.hitTest=function(e,n){if((!n||n<.5)&&(n=.5),this._hitPoint=e.sub(n,n),!Cc){var i=this.getMap()?this.getMap().CanvasClass:null;Cc=_h.createCanvas(1,1,i)}_h.setHitTesting(!0),Cc.width=Cc.height=2*n;var o=_h.getCanvas2DContext(Cc);o.isHitTesting=!0;try{this.paint(null,o,this._hitPoint)}finally{_h.setHitTesting(!1)}delete this._hitPoint;for(var s=o.getImageData(0,0,Cc.width,Cc.height).data,a=3,h=s.length;a<h;a+=4)if(s[a]>0)return!0;return!1},i.isHitTesting=function(){return!!this._hitPoint},i._prepareShadow=function(e,n){n.shadowBlur?(e.shadowBlur=this.isHitTesting()?0:n.shadowBlur,e.shadowColor=n.shadowColor||"#000",e.shadowOffsetX=n.shadowOffsetX||0,e.shadowOffsetY=n.shadowOffsetY||0):e.shadowBlur&&(e.shadowBlur=null,e.shadowColor=null,e.shadowOffsetX=null,e.shadowOffsetY=null)},i._eachSymbolizer=function(e,n){if(this.symbolizers){n||(n=this);for(var i=this.symbolizers.length-1;i>=0;i--)e.apply(n,[this.symbolizers[i]])}},i.get2DExtent=function(e,n){this._verifyProjection();var i=this.getMap();e=e||this.getLayer()._getRenderer().resources;var o=i.getZoom(),s=this._isDynamicSize();if(this._extent2D&&this._extent2D._zoom===o&&this._fixedExtent||(this._extent2D&&this._extent2D._zoom!==o&&delete this._extent2D,this.symbolizers&&(this._extent2D||(this._extent2D=this._computeExtent2D(new ll),this._extent2D._zoom=o),this._fixedExtent||(this._fixedExtent=this._computeFixedExtent(e,new ll)))),!this._extent2D)return s&&delete this._fixedExtent,null;var{xmin:a,ymin:h,xmax:l,ymax:c}=this._fixedExtent;return s&&delete this._fixedExtent,Uc.set(a,-c,l,-h),n?(n.set(this._extent2D.xmin,this._extent2D.ymin,this._extent2D.xmax,this._extent2D.ymax),n._add(Uc),n):this._extent2D.add(Uc)},i._computeExtent2D=function(e){for(var n=this.symbolizers.length-1;n>=0;n--){e._combine(this.symbolizers[n].get2DExtent())}return e},i._computeFixedExtent=function(e,n){for(var i=this.symbolizers.length-1;i>=0;i--){var o=this.symbolizers[i];o.getFixedExtent&&n._combine(o.getFixedExtent(e))}return n},i._isDynamicSize=function(){for(var e=this.symbolizers.length-1;e>=0;e--){if(this.symbolizers[e].isDynamicSize())return!0}return!1},i._aboveCamera=function(){var e=this.getMinAltitude(),n=this.getMap(),i=n.getGLRes();e=n.altitudeToPoint(e,i)*Ae(e);var o=n.getFrustumAltitude();return e&&o&&o<e},i.getFixedExtent=function(){var e=this.getMap().getZoom();return this._isDynamicSize()?this._computeFixedExtent(null,new ll):(this._extent2D&&this._extent2D._zoom===e||this.get2DExtent(null,Uc),this._fixedExtent)},i.setZIndex=function(e){this._eachSymbolizer((function(n){n.setZIndex(e)}))},i.show=function(){this._painted?(this.removeCache(),this._eachSymbolizer((function(e){e.show()}))):this.getLayer().isCanvasRender()||this.paint()},i.hide=function(){this._eachSymbolizer((function(e){e.hide()}))},i.repaint=function(){this._altAtGL=this._getGeometryAltitude(),this.removeCache();var e=this.getLayer();if(e){var n=e.getRenderer();n&&n.setToRedraw()&&n.setToRedraw()}},i.refreshSymbol=function(){this.removeCache(),this._removeSymbolizers(),this.symbolizers=this._createSymbolizers()},i.remove=function(){this.removeCache(),this._removeSymbolizers()},i._removeSymbolizers=function(){this._eachSymbolizer((function(e){delete e.painter,e.remove()})),delete this.symbolizers},i.removeCache=function(){delete this._renderPoints,delete this._paintParams,delete this._sprite,delete this._extent2D,delete this._fixedExtent,delete this._cachedParams,delete this._unsimpledParams},i.getAltitude=function(){return this.geometry._getAltitude()!==this._propAlt&&(this._altAtGL=this._getGeometryAltitude()),this._altAtGL?this._altAtGL:0},i.getMinAltitude=function(){return this.minAltitude?this.minAltitude:0},i.getMaxAltitude=function(){return this.maxAltitude?this.maxAltitude:0},i._getGeometryAltitude=function(){if(!this.getMap())return 0;var e=this.geometry._getAltitude();this._propAlt=e;var[n,i]=Ku(e);return this.minAltitude=n,this.maxAltitude=i,e&&this.geometry.getCenter()?e:0},i._verifyProjection=function(){var e=this.geometry._getProjection()||qc;this._projCode&&this._projCode!==e.code&&this.removeCache(),this._projCode=e.code},i._beforePaint=function(){},i._afterPaint=function(){},i.getPathTempRenderPoints=function(){for(var e=0,n=(this.symbolizers||[]).length;e<n;e++){var i=this.symbolizers[e];if(i instanceof bc&&i._tempRenderPoints)return i._tempRenderPoints}},n}(Ih);function Jc(e,n,i){if(!Array.isArray(i))return e;for(var o=[],s=0,a=e.length;s<a;s++)if(Array.isArray(e[s]))o.push(Jc(e[s],n,i));else{var h=e[s];if(h.point.equals(n[h.index]))h.altitude=i[h.index],o.push(h);else{var l=void 0,c=void 0;0===h.index?(l=h.index,c=h.index+1):(l=h.index-1,c=h.index);var A=h.point.distanceTo(n[c]),f=A/(A+n[l].distanceTo(h.point)),d=fe(i[l],i[c],1-f);h.altitude=d,o.push(h)}}return o}var Kc=new ll,$c=function(e){function n(n,i){var o;return(o=e.call(this)||this).geometry=n,o.isMask=i,o.bbox=cs(),o._drawTime=0,o}kt(n,e);var i=n.prototype;return i._setDrawTime=function(e){return this._drawTime=e,this._eachPainter((function(n){n._setDrawTime(e)})),this},i.getRenderBBOX=function(){var e=this,n=this.getLayer();return n&&n._drawTime!==this._drawTime?null:(ds(this.bbox),this._eachPainter((function(n){var i=n.getRenderBBOX();ms(i)&&gs(e.bbox,i)})),ms(this.bbox)?this.bbox:null)},i._eachPainter=function(e){for(var n,i=this.geometry.getGeometries(),o=0,s=i.length;o<s&&(!(n=this.isMask?i[o]._getMaskPainter():i[o]._getPainter())||!n||!1!==e.call(this,n));o++);},i.getLayer=function(){return this.geometry&&this.geometry.getLayer()},i.paint=function(e){this.geometry&&this._eachPainter((function(n){n.paint(e)}))},i.get2DExtent=function(e,n){n&&n.set(null,null,null,null);var i=n||new ll;return this._eachPainter((function(n){i=i._combine(n.get2DExtent(e,Kc))})),i},i.remove=function(){this._eachPainter((function(e){e.remove()}))},i.setZIndex=function(e){this._eachPainter((function(n){n.setZIndex(e)}))},i.show=function(){this._eachPainter((function(e){e.show()}))},i.hide=function(){this._eachPainter((function(e){e.hide()}))},i.repaint=function(){this._eachPainter((function(e){e.repaint()}))},i.refreshSymbol=function(){this._eachPainter((function(e){e.refreshSymbol()}))},i.hasPoint=function(){var e=!1;return this._eachPainter((function(n){return!n.hasPoint()||(e=!0,!1)})),e},i.getMinAltitude=function(){var e=!0,n=0;return this._eachPainter((function(i){var o=i.getMinAltitude();(e||o<n)&&(e=!1,n=o)})),n},i.getMaxAltitude=function(){var e=0;return this._eachPainter((function(n){var i=n.getMaxAltitude();i>e&&(e=i)})),e},n}(Ih);function tA(e,n=[]){return n.forEach((function(n){var[i,o]=n;e=e.replace(i,o)})),e}function eA(e){var{projection:n,isArcgis:i,isGeoServer:o,isSuperMap:s}=e,a=.0002645833333333333;return(i||o||s)&&(a=28e-5),n&&n.indexOf("4326")>-1&&(a=2.3767925226029154e-9,(i||s)&&(a=2.518101729011901e-9),o&&(a=2.51528279553466e-9)),a}var nA="wmts";function iA(e,n){var i=e.getElementsByTagName(n);return i&&i.length?i:e.getElementsByTagName(nA+":"+n)}function rA(e,n){for(var i=0;i<e.length;i++){var o=e[i];if((o=o.getElementsByTagName("ows:Identifier")[0])&&o.textContent===n)return e[i]}return null}function oA(e,n={}){var i,o,s,a=iA(e,"TileMatrix"),h=[],l=[],c=[],A=!1;if(!i){var f=e.getElementsByTagName("ows:SupportedCRS")[0];f&&(i=function(e){for(var n="",i=e.split(""),o=i.length-1;o>=0&&!isNaN(i[o]);o--)n=i[o]+n;return n}(i=(i=f.textContent).split("EPSG")[1]),i=function(e){var n=e.indexOf("EPSG")>-1?e:"EPSG:"+e;return tA(n,[["4490","4326"],["102100","3857"],["900913","3857"]])}(i))}o||(o=e.getElementsByTagName("ows:Identifier")[0])&&(o=o.textContent),n.projection=i;for(var d=1/0,p=0;p<a.length;p++){var g=a[p],v=g.getElementsByTagName("ows:Identifier")[0].textContent;isNaN(parseInt(v))?(s=v.substr(0,v.lastIndexOf(":")),v=(v=v.split(":"))[v.length-1],v=parseInt(v),A=!0,n.isGeoServer=!0):v=parseInt(v),d=Math.min(d,v);var w=iA(g,"ScaleDenominator")[0].textContent,C=iA(g,"TopLeftCorner")[0].textContent,P=iA(g,"TileWidth")[0].textContent,T=iA(g,"TileHeight")[0].textContent;if(0===c.length&&c.push(parseInt(P),parseInt(T)),0===l.length){var[S,I]=C.split(" ").filter((function(e){return""!==e})).map((function(e){return parseFloat(e)}));S>0?l.push(1,-1,I,S):l.push(1,-1,S,I)}var E=eA(n),O=parseFloat(w)*E;h.push(O)}if(d>0)for(var k=h[0],L=d-1;L>=0;L--)h.splice(0,0,k*=2);return{resolutions:h,tileSize:c,tileSystem:l,projection:i,TileMatrixSet:o,isGeoServer:A,levelStr:s}}var hA=function(e,n,i={jsonp:!0}){f(e)&&rr.get(e,(function(o,s){if(o)n(o);else{var a=function(e,n,i){["isArcgis","isSuperMap","isGeoServer"].every((function(e){return null==i[e]}))&&console.warn("Please specify the server type, such as isArcgis, isSuperMap, isGeoServer, Otherwise, the system will determine by itself"),null==i.isArcgis&&(i.isArcgis=["arcgis","geoscene"].some((function(n){return e.indexOf(n)>-1}))),null==i.isSuperMap&&(i.isSuperMap=e.indexOf("supermap")>-1);var o=(new DOMParser).parseFromString(e,"text/xml").querySelectorAll("Contents")[0];if(!o)return[];var s=iA(o,"Layer");if(!s.length)return[];for(var a=[],h=0,l=o.childNodes.length;h<l;h++)"TileMatrixSet"===o.childNodes[h].localName&&a.push(o.childNodes[h]);if(!a.length)return[];for(var c=[],A=0,f=s.length;A<f;A++){var d=s[A],p=d.querySelectorAll("Style")[0];p&&(p=p.getElementsByTagName("ows:Identifier")[0])&&(p=p.textContent);var g=d.getElementsByTagName("ows:Identifier")[0];g&&(g=g.textContent);var v=iA(d,"TileMatrixSetLink");if(0!==v.length)for(var w=0,C=v.length;w<C;w++){var P=v[w];(P=iA(P,"TileMatrixSet")[0])&&(P=P.textContent);var T=rA(a,P);if(T){var S=d.querySelectorAll("ResourceURL")[0],I="";S&&(I=S.attributes.template.value);var{resolutions:E,tileSize:O,tileSystem:k,projection:L,TileMatrixSet:F,isGeoServer:N,levelStr:z}=oA(T,i);I.length||(I=n.substr(0,n.lastIndexOf("?")),I+="?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER={LAYER}&STYLE={Style}&TILEMATRIXSET={TileMatrixSet}&FORMAT={tiles}&TILEMATRIX={TileMatrix}&TILEROW={TileRow}&TILECOL={TileCol}");var H=tA(I,[["{LAYER}",g],["{Layer}",g],["{layer}",g],["{STYLE}",p],["{Style}",p],["{style}",p],["{TileMatrixSet}",F],["{TileMatrix}",N?z+":{z}":"{z}"],["{TileRow}","{y}"],["{TileCol}","{x}"],["{tiles}",N?"image/png":"tiles"]]);c.push({tileSize:O,tileSystem:k,spatialReference:{resolutions:E,projection:L},urlTemplate:H,info:{layerName:g,TileMatrixSet:F,style:p,tileSize:O,tileSystem:k,resolutions:E,projection:L,urlTemplate:H}})}}}return c}(s,e,i);n(null,a)}}),i)};function uA(e){for(var n=e.tileInfo,i=[n.cols,n.rows],o=[],s=n.lods,a=0,h=s.length;a<h;a++)o.push(s[a].resolution);var l=e.fullExtent,c=n.origin,A=[1,-1,c.x,c.y];return delete l.spatialReference,{spatialReference:{resolutions:o,fullExtent:l},tileSystem:A,tileSize:i}}var cA=23,AA={"EPSG:3857":{projection:"EPSG:3857",resolutions:function(){for(var e=[],n=12756274*Math.PI,i=0;i<cA;i++)e[i]=n/(256*Math.pow(2,i));return e}(),fullExtent:{top:6378137*Math.PI,left:-6378137*Math.PI,bottom:-6378137*Math.PI,right:6378137*Math.PI}},"EPSG:4326":{projection:"EPSG:4326",fullExtent:{top:90,left:-180,bottom:-90,right:180},resolutions:function(){for(var e=[],n=0;n<cA;n++)e[n]=180/(128*Math.pow(2,n));return e}()},BAIDU:{projection:"baidu",resolutions:function(){for(var e=Math.pow(2,18),n=[],i=0;i<cA;i++)n[i]=e,e*=.5;return n}(),fullExtent:{top:33554432,left:-33554432,bottom:-33554432,right:33554432}},IDENTITY:{projection:"identity",resolutions:function(){for(var e=Math.pow(2,8),n=[],i=0;i<cA;i++)n[i]=e,e*=.5;return n}(),fullExtent:{top:2e5,left:-2e5,bottom:-2e5,right:2e5}},"PRESET-VT-3857":{projection:"EPSG:3857",resolutions:function(){for(var e=[],n=6378137*Math.PI,i=0;i<cA;i++)e[i]=n/(256*Math.pow(2,i));return e}(),fullExtent:{top:6378137*Math.PI,left:-6378137*Math.PI,bottom:-6378137*Math.PI,right:6378137*Math.PI}},"PRESET-VT-4326":{projection:"EPSG:4326",fullExtent:{top:90,left:-180,bottom:-90,right:180},resolutions:function(){for(var e=[],n=0;n<cA;n++)e[n]=45/(128*Math.pow(2,n));return e}()}};AA["EPSG:4490"]=AA["EPSG:4326"],AA["PRESET-3857-512"]=AA["PRESET-VT-3857"],AA["PRESET-4326-512"]=AA["PRESET-VT-4326"],AA["PRESET-4490-512"]=AA["PRESET-VT-4326"];var fA=function(){function e(e={}){this.options=e,this._initSpatialRef()}e.registerPreset=function(e,n){e=e&&e.toUpperCase(),AA[e]&&console.warn("Spatial reference "+e+" already registered."),AA[e]=n},e.getPreset=function(e){return AA[e.toUpperCase()]},e.getAllPresets=function(){return Object.keys(AA)},e.loadArcgis=function(e,n,i){return function(e,n,i={jsonp:!0}){if(f(e)&&"{"!==e.substring(0,1))rr.getJSON(e,(function(e,i){if(e)n(e);else{var o=uA(i);n(null,o)}}),i);else{f(e)&&(e=ae(e));var o=uA(e);n(null,o)}}(e,n,i),this},e.loadWMTS=function(e,n,i){return hA(e,n,i),this},e.getProjectionInstance=function(e){var n;if(!e)return null;if((n=f(e)?{code:e}:e).project)return n.locate||(n=a({},n),a(n,Pl.getInstance("identity"===n.measure?"IDENTITY":"EPSG:4326"))),n;var i=(n.code+"").toLowerCase();for(var o in su)if(g(su,o)){var s=su[o].aliases||[],h=su[o].code;h&&s.push(h);for(var l=0;l<s.length;l++)if(s[l].toLowerCase()===i){if(su[o].create){var c=su[o].create(e);return c.code=s[l],c}if(su[o].code===s[l])return su[o];var A=a({},su[o]);return A.code=s[l],A}}return null},e.equals=function(e,n){if(f(e)||f(n))return e===n;if(!e&&!n)return!0;if(!e||!n)return!1;if(e.projection!==n.projection)return!1;var i=e.fullExtent,o=n.fullExtent;if(i&&!o||!i&&o)return!1;if(i&&o&&(i.top!==o.top||i.bottom!==o.bottom||i.left!==o.left||i.right!==o.right))return!1;var s=e.resolutions,a=n.resolutions;if(s&&a){if(s.length!==a.length)return!1;for(var h=0;h<s.length;h++)if(s[h]!==a[h])return!1}else if(s||a)return!1;return!0};var n=e.prototype;return n._initSpatialRef=function(){var n;if(!(n=this.options.projection?e.getProjectionInstance(this.options.projection):ou))throw new Error("must provide a valid projection in map's spatial reference.");(n=a({},cl,n)).measureLength||a(n,bl),this._projection=n;var i,o=this.options.resolutions;if(!o&&(n.code&&(i=AA[n.code.toUpperCase()])&&(o=i.resolutions,this.isEPSG="IDENTITY"!==n.code),!o))throw new Error("must provide valid resolutions in map's spatial reference.");if(this._resolutions=o,this._pyramid=!0,this._pyramid)for(var s=0;s<o.length;s++)if(o[s]&&o[s-1]&&Math.round(o[s-1]/o[s]*1e4)/1e4!=2){this._pyramid=!1;break}var l=this.options.fullExtent;if(!l&&(n.code&&(i=AA[n.code.toUpperCase()])&&(l=i.fullExtent),!l))throw new Error("must provide a valid fullExtent in map's spatial reference.");if(h(l.left)?(this._fullExtent=new al(l),l.left=l.xmin,l.right=l.xmax,l.top=l.ymax,l.bottom=l.ymin):this._fullExtent=new al(new Zh(l.left,l.top),new Zh(l.right,l.bottom)),h(l.top)||h(l.bottom)||h(l.left)||h(l.right))throw new Error("must provide valid top/bottom/left/right in fullExtent.");a(this._fullExtent,l),this._projection.fullExtent=l,this._transformation=new ul([l.right>=l.left?1:-1,l.top>=l.bottom?-1:1,0,0])},n.getResolutions=function(){return this._resolutions||[]},n.getResolution=function(e){var n=0|e;n<0?n=0:n>this._resolutions.length-1&&(n=this._resolutions.length-1);var i=this._resolutions[n];return n!==e&&e>0&&n<this._resolutions.length-1?i+(this._resolutions[n+1]-i)*(e-n):i},n.getProjection=function(){return this._projection},n.getFullExtent=function(){return this._fullExtent},n.getTransformation=function(){return this._transformation},n.getMinZoom=function(){for(var e=0;e<this._resolutions.length;e++)if(!h(this._resolutions[e]))return e;return 0},n.getMaxZoom=function(){for(var e=this._resolutions.length-1;e>=0;e--)if(!h(this._resolutions[e]))return e;return this._resolutions.length-1},n.getZoomDirection=function(){return Ae(this._resolutions[this.getMinZoom()]-this._resolutions[this.getMaxZoom()])},n.toJSON=function(){return this.json||(this.json={resolutions:this._resolutions,fullExtent:{top:this._fullExtent.top,left:this._fullExtent.left,bottom:this._fullExtent.bottom,right:this._fullExtent.right},projection:this._projection.code}),this.json},n.isPyramid=function(){return this._pyramid},e}();var dA=new ee(0,0),pA=new ll,yA={};var _A=function(e){function n(n){var i,o=a({},n),s=o.symbol,c=o.properties,A=o.id;return delete o.symbol,delete o.id,delete o.properties,i=e.call(this,o)||this,s?i.setSymbol(s):i._genSizeSymbol(),c&&i.setProperties(c),h(A)||i.setId(A),n&&l(n.rotateAngle)&&(i._dirtyRotate=!0),i}kt(n,e),n.fromJSON=function(e){return e};var i=n.prototype;return i.getFirstCoordinate=function(){if("GeometryCollection"===this.type){var e=this.getGeometries();return e.length?e[0].getFirstCoordinate():null}var n=this.getCoordinates();if(!Array.isArray(n))return n;do{n=n[0]}while(Array.isArray(n)&&n.length>0);return n},i.getLastCoordinate=function(){if("GeometryCollection"===this.type){var e=this.getGeometries();return e.length?e[e.length-1].getLastCoordinate():null}var n=this.getCoordinates();if(!Array.isArray(n))return n;do{n=n[n.length-1]}while(Array.isArray(n)&&n.length>0);return n},i.addTo=function(e,n){return e.addGeometry(this,n),this},i.getLayer=function(){return this._layer?this._layer:null},i.getMap=function(){return this._layer?this._layer.getMap():null},i.getId=function(){return this._id},i.setId=function(e){var n=this.getId();return this._id=e,this._fireEvent("idchange",{old:n,new:e}),this},i.getProperties=function(){return this.properties?this.properties:this._getParent()?this._getParent().getProperties():null},i.setProperties=function(e){var n=this.properties;return this.properties=A(e)?a({},e):e,this._clearAltitudeCache(),this._repaint(),this._fireEvent("propertieschange",{old:n,new:e}),this},i.getType=function(){return this.type},i.getSymbol=function(){var e=this._symbol;return e?Array.isArray(e)?ko(e):a({},e):null},i.setSymbol=function(e){return this._symbolUpdated=e,this._symbol=this._prepareSymbol(e),this.onSymbolChanged(),delete this._compiledSymbol,delete this._symbolHash,this},i.getSymbolHash=function(){return this._symbolHash||(this._symbolHash=Eo(this._symbolUpdated)),this._symbolHash},i.updateSymbol=function(e){if(!e)return this;var n=this._getSymbol();if(Array.isArray(n)){if(!Array.isArray(e))throw new Error("Parameter of updateSymbol is not an array.");for(var i=0;i<e.length;i++)zu(e[i])&&delete this._textDesc,n[i]&&e[i]&&(n[i]=ko(n[i],e[i]))}else{if(Array.isArray(e))throw new Error("Geometry's symbol is not an array to update.");zu(n)&&delete this._textDesc,n=ko(n||this._getInternalSymbol(),e)}return this._eventSymbolProperties=e,delete this._compiledSymbol,this.setSymbol(n)},i.getTextContent=function(){var e=this._getInternalSymbol();if(Array.isArray(e)){for(var n=[],i=!1,o=0;o<e.length;o++)n[o]=li(e[o]&&e[o].textName,this.getProperties()),h(n[o])||(i=!0);return i?n:null}return li(e&&e.textName,this.getProperties())},i.getTextDesc=function(){if(!this._textDesc){var e=this.getTextContent(),n=this._sizeSymbol,i=Array.isArray(e);this._textDesc=Array.isArray(n)?n.map((function(n,o){return ui(i?e[o]:"",n)})):ui(e,n)}return this._textDesc},i.getCenter=function(){return this._computeCenter(this._getMeasurer())},i.getExtent=function(){var e=this._getPrjExtent(),n=this._getProjection();if(e&&n){var i=n.unproject(new Zh(e.xmin,e.ymin)),o=n.unproject(new Zh(e.xmax,e.ymax));return new al(i,o,n)}return this._computeExtent(this._getMeasurer())},i.getContainerExtent=function(e){var n=this.get2DExtent();if(!n||!n.isValid())return null;var i=this.getMap(),o=i.getGLRes(),s=this.getMinAltitude(),a=n.convertTo((function(e){return i._pointAtResToContainerPoint(e,o,s,dA)}),e),h=this.getMaxAltitude();if(h!==s){var l=n.convertTo((function(e){return i._pointAtResToContainerPoint(e,o,h,dA)}),pA);a._combine(l)}var c=this.getLayer();if(c&&"LineString"===this.type&&h&&c.options.drawAltitude){var A=n.convertTo((function(e){return i._pointAtResToContainerPoint(e,o,0,dA)}),pA);a._combine(A)}if(a){var f=this._getFixedExtent();(function(e){if(!e)return!1;var{xmin:n,ymin:i,xmax:o,ymax:s}=e;return o-n>0&&s-i>0})(f)&&a._add(f)}return this.options.smoothness&&a._expand(.15*a.getWidth()),a},i._getFixedExtent=function(){this._fixedExtent||(this._fixedExtent=new ll);var e=this._sizeSymbol,n=(e&&e.lineWidth||1)/2;return this._fixedExtent.set(-n,-n,n,n),this._fixedExtent._add([e&&e.lineDx||0,0]),this._fixedExtent._add([0,e&&e.lineDy||0]),this._fixedExtent},i.get2DExtent=function(){var e=this.getMap();if(!e)return null;if(this._extent2d)return this._extent2d;var n=this._getPrjExtent();if(!n||!n.isValid())return null;var i=n.getMin(),o=n.getMax(),s=e.getGLRes();return e._prjToPointAtRes(i,s,i),e._prjToPointAtRes(o,s,o),this._extent2d=new ll(i,o),this._extent2d.z=e.getZoom(),this._extent2d},i.getSize=function(){var e=this.getContainerExtent();return e?e.getSize():null},i.containsPoint=function(e,n){if(!this.getMap())throw new Error('The geometry is required to be added on a map to perform "containsPoint".');return e instanceof Zh&&(e=this.getMap().coordToContainerPoint(e)),this._containsPoint(e,n)},i._containsPoint=function(e,n){var i=this._getPainter();return!!i&&(n=n||0,this._hitTestTolerance&&(n+=this._hitTestTolerance()),i.hitTest(e,n))},i.show=function(){if(this.options.visible=!0,this.getMap()){var e=this._getPainter();e&&e.show(),this._fireEvent("show")}return this},i.hide=function(){if(this.options.visible=!1,this.getMap()){this.onHide();var e=this._getPainter();e&&e.hide(),this._fireEvent("hide")}return this},i.isVisible=function(){if(!this.options.visible)return!1;var e=this._getInternalSymbol();if(!e)return!0;if(!this.symbolIsVisible())return!1;if(Array.isArray(e)){if(!e.length)return!0;for(var n=0,i=e.length;n<i;n++)if(h(e[n].opacity)||e[n].opacity>0)return!0;return!1}return h(e.opacity)||A(e.opacity)||l(e.opacity)&&e.opacity>0},i.symbolIsVisible=function(){var e=this._getCompiledSymbol();if(!e)return!0;Array.isArray(e)||(e=[e]);for(var n=0,i=e.length;n<i;n++){var o=e[n];if(o){var s=o.visible;if(!1!==s&&0!==s)return!0}}return!1},i.getZIndex=function(){return this.options.zIndex||0},i.setZIndex=function(e){var n=this.options.zIndex;return this.options.zIndex=e,this._fireEvent("zindexchange",{old:n,new:e}),this},i.setZIndexSilently=function(e){return this.options.zIndex=e,this},i.bringToFront=function(){var e=this.getLayer();if(!e||!e.getGeoMaxZIndex)return this;var n=e.getGeoMaxZIndex();return this.setZIndex(n+1),this},i.bringToBack=function(){var e=this.getLayer();if(!e||!e.getGeoMinZIndex)return this;var n=e.getGeoMinZIndex();return this.setZIndex(n-1),this},i.translate=function(e,n,i){if(h(e))return this;var o=new Zh(e,n,i);if(0===o.x&&0===o.y&&(h(o.z)||0===o.z))return this;var s=this.getCoordinates();if(this._silence=!0,s)if(Array.isArray(s)){var a=ue(s,(function(e){return e.add(o)}));this.setCoordinates(a)}else this.setCoordinates(s.add(o));return this._silence=!1,this._fireEvent("positionchange"),this},i._translateRotatePivot=function(e){if(!this._pivot||!e)return this;if(this.options.rotatePivot){var n=this.getCoordinates();if(!n)return this;e instanceof Zh||(e=new Zh(e));var i=e.sub(n);if(0===i.x&&0===i.y)return this;this._pivot._add(i),this.options.rotatePivot=this._pivot.toArray()}return this},i.flash=function(e,n,i,o){return en.call(this,e,n,i,o)},i.copy=function(){var e=this.toJSON(),i=n.fromJSON(e);return i.options.visible=!0,i},i.remove=function(){return this.getLayer()?(this._fireEvent("removestart"),this._unbind(),this._fireEvent("removeend"),this._fireEvent("remove"),this):this},i.toGeoJSONGeometry=function(){return this._exportGeoJSONGeometry()},i.toGeoJSON=function(e){e||(e={});var n={type:"Feature",geometry:null};if(h(e.geometry)||e.geometry){var i=this._exportGeoJSONGeometry();n.geometry=i}var o,s=this.getId();return h(s)||(n.id=s),(h(e.properties)||e.properties)&&(o=this._exportProperties()),n.properties=o,n},i.toJSON=function(e){e||(e={});var n=this._toJSON(e);return a(n,this._exportGraphicOptions(e)),n},i.getLength=function(){return this._computeGeodesicLength(this._getMeasurer())},i.getArea=function(){return this._computeGeodesicArea(this._getMeasurer())},i.rotate=function(e,n){if(!l(e))return console.error("angle:"+e+" is not number"),this;if(this._painter||(this._dirtyRotate=!0),"GeometryCollection"===this.type)return this.getGeometries().forEach((function(i){return i.rotate(e,n)})),this;n=n?new Zh(n):this.getCenter(),this._angle=e,this._pivot=n;var i=this._getMeasurer(),o=this.getCoordinates();if(!Array.isArray(o)){if(n.x===o.x&&n.y===o.y||this.getShell)this.onPositionChanged();else{var s=i._rotate(o,n,e);this.setCoordinates(s)}return this.getShell&&(this.options.rotateAngle=e,this.options.rotatePivot=n.toArray()),this}return ue(o,(function(o){return i._rotate(o,n,e)})),this.setCoordinates(o),this},i._rotatePrjCoordinates=function(e){if(!e||0===this._angle||!this._pivot)return e;var n=this._getProjection();if(!n)return e;var i,o,s=0,a=Array.isArray(e),h=a?e:[e],l=[];if(this.getRotateOffsetAngle){s=this.getRotateOffsetAngle();var c=h[h.length-1];i=c.x,o=c.y}else{var A=cs();ps(h,A);var[f,d,p,g]=A;i=(f+p)/2,o=(d+g)/2}for(var v=0,w=h.length;v<w;v++){var C=h[v],{x:P,y:T}=C,S=P-i,I=T-o,E=Math.sqrt(S*S+I*I),O=(EA(i,o,P,T)-this._angle+s)/180*Math.PI,k=Math.cos(O)*E,L=Math.sin(O)*E,F=new Zh(i+k,o+L);l.push(F)}for(var N=n.project(this._pivot),z=i-N.x,H=o-N.y,j=0,W=l.length;j<W;j++){var q=l[j];q.x-=z,q.y-=H}return a?l:l[0]},i.isRotated=function(){return!(!l(this._angle)||!this._pivot)},i._getConnectPoints=function(){return[this.getCenter()]},i._initOptions=function(e){var n=a({},e),i=n.symbol,o=n.properties,s=n.id;delete n.symbol,delete n.id,delete n.properties,this.setOptions(n),i&&this.setSymbol(i),o&&this.setProperties(o),h(s)||this.setId(s)},i._bindLayer=function(e){if(e!==this.getLayer()){if(this.getLayer())throw new Error("Geometry cannot be added to two or more layers at the same time.");this._layer=e,this._clearCache(),this._bindInfoWindow(),this._bindMenu()}},i._prepareSymbol=function(e){if(Array.isArray(e)){for(var n=[],i=0;i<e.length;i++)n.push(_o(this._checkAndCopySymbol(e[i])));return n}return e?_o(e=this._checkAndCopySymbol(e)):null},i._checkAndCopySymbol=function(e){var n={};for(var i in e)n[i]=xn[i]&&f(e[i])?+e[i]:e[i];return n},i._getSymbol=function(){return this._symbol},i._setExternSymbol=function(e){return this._eventSymbolProperties=e,this._symbol||delete this._textDesc,this._externSymbol=this._prepareSymbol(e),this.onSymbolChanged(),this},i._getInternalSymbol=function(){return this._symbol?this._symbol:this._externSymbol?this._externSymbol:this.options.symbol?this.options.symbol:null},i._getPrjExtent=function(){var e=this._getProjection();return this._verifyProjection(),!this._extent&&e&&(this._extent=this._computePrjExtent(e)),this._extent},i._unbind=function(){var e=this.getLayer();e&&(this._animPlayer&&this._animPlayer.finish(),this._unbindMenu(),this._unbindInfoWindow(),this.isEditing()&&this.endEdit(),this._removePainter(),this.onRemove&&this.onRemove(),e.onRemoveGeometry&&e.onRemoveGeometry(this),delete this._layer,delete this._internalId,delete this._extent)},i._getInternalId=function(){return this._internalId},i._setInternalId=function(e){this._internalId=e},i._getMeasurer=function(){return this._getProjection()?this._getProjection():fA.getProjectionInstance(this.options.defaultProjection)},i._getProjection=function(){var e=this.getMap();return e?e.getProjection():null},i._verifyProjection=function(){var e=this._getProjection();this._projCode&&e&&this._projCode!==e.code&&this._clearProjection(),this._projCode=e?e.code:this._projCode},i._getExternalResources=function(){return vo(this._getInternalSymbol())},i._getPainter=function(){if(this._painter)return this._painter;var e=this.getLayer();if(!this._painter&&e)if(-1!==gn.indexOf(this.type)){if(e.constructor.getCollectionPainterClass){var n=e.constructor.getCollectionPainterClass();n&&(this._painter=new n(this))}}else if(e.constructor.getPainterClass){var i=e.constructor.getPainterClass();i&&(this._painter=new i(this))}return this._painter},i._getMaskPainter=function(){return this._maskPainter||(this._maskPainter=this.getGeometries&&this.getGeometries()?new $c(this,!0):new Qc(this)),this._maskPainter},i._removePainter=function(){this._painter&&this._painter.remove(),delete this._painter},i._paint=function(e){if(this.symbolIsVisible()&&this._painter){if(this._dirtyCoords){delete this._dirtyCoords;var n=this._getProjection();n&&(this._pcenter=n.project(this._coordinates),this._clearCache())}this._dirtyRotate&&l(this.options.rotateAngle)&&this.rotate(this.options.rotateAngle,this.options.rotatePivot),this._dirtyRotate=!1,this._painter.paint(e)}},i._clearCache=function(){delete this._extent,delete this._extent2d,this._clearAltitudeCache()},i._clearProjection=function(){delete this._extent,delete this._extent2d},i._repaint=function(){this._painter&&this._painter.repaint()},i.onHide=function(){this.closeMenu(),this.closeInfoWindow()},i.onShapeChanged=function(){this._clearCache(),this._repaint(),this._fireEvent("shapechange")},i.onPositionChanged=function(){this._clearCache(),this._repaint(),this._fireEvent("positionchange")},i.onSymbolChanged=function(){this._painter&&this._painter.refreshSymbol();var e={};this._eventSymbolProperties?(e.properties=JSON.parse(JSON.stringify(this._eventSymbolProperties)),delete this._eventSymbolProperties):delete this._textDesc,this._genSizeSymbol(),this._fireEvent("symbolchange",e)},i._genSizeSymbol=function(){var e=this._getInternalSymbol();if(e)if(Array.isArray(e)){this._sizeSymbol=[];for(var n=!1,i=0;i<e.length;i++){var o=this._sizeSymbol[i]=this._getSizeSymbol(e[i]);!n&&o&&o._dynamic&&(n=!0)}this._sizeSymbol._dynamic=n}else this._sizeSymbol=this._getSizeSymbol(e);else delete this._sizeSymbol},i._getSizeSymbol=function(e){var n=fo({lineWidth:e.lineWidth,lineDx:e.lineDx,lineDy:e.lineDy},this);return(Hr(e.lineWidth)||Hr(e.lineDx)||Hr(e.lineDy))&&(n._dynamic=!0),n},i._getCompiledSymbol=function(){return this._compiledSymbol||(this._compiledSymbol=fo(this._getInternalSymbol(),this)),this._compiledSymbol},i.onConfig=function(e){var n;e.properties&&(n=e.properties,delete e.properties);var i=!1;for(var o in e)if(e.hasOwnProperty(o)){var s=o.slice(0,5);if("arrow"===s||"smoot"===s){i=!0;break}}n?(this.setProperties(n),this._repaint()):i&&this._repaint()},i._setParent=function(e){e&&(this._parent=e)},i._getParent=function(){return this._parent},i._fireEvent=function(e,n){this._silence||(this.getLayer()&&this.getLayer()._onGeometryEvent&&(n||(n={}),n.type=e,n.target=this,this.getLayer()._onGeometryEvent(n)),this.fire(e,n))},i._toJSON=function(e){return{feature:this.toGeoJSON(e)}},i._recordVisible=function(){var e=this.options.visible;h(e)&&(e=!0),this._savedVisible=e},i._recoveryVisible=function(){delete this._savedVisible},i._exportGraphicOptions=function(e){var n={};return(h(e.options)||e.options)&&(n.options=this.config()),n.options&&this.isEditing&&this.isEditing()&&(n.options.visible=this._savedVisible),(h(e.symbol)||e.symbol)&&(n.symbol=this.getSymbol()),(h(e.infoWindow)||e.infoWindow)&&this._infoWinOptions&&(n.infoWindow=this._infoWinOptions),n},i._exportGeoJSONGeometry=function(){var e=this.getCoordinates(),n=Zh.toNumberArrays(e);return{type:this.getType(),coordinates:n}},i._exportProperties=function(){var e=null,n=this.getProperties();return h(n)||(e=A(n)?a({},n):n),e},i._hitTestTolerance=function(){return 0},i._getAltitude=function(){var e=this.getLayer();if(!e)return 0;var n=e.options,i=e.getAltitude?e.getAltitude():0,o=n.enableAltitude;if(!o&&e.isVectorLayer)return i;var s=bA(e),a=(this.properties||yA)[s];if(h(a)){var l=wA(this,i,o);return h(l)?i:l}return Array.isArray(a)?a.map((function(e){return e+i})):a+i},i.getAltitude=function(){var e=bA(this.getLayer()),n=(this.properties||yA)[e];if(!h(n))return n;var i=wA(this,0,!1);return h(i)?0:i},i.hasAltitude=function(){return this._genMinMaxAlt(),!!this._minAlt||!!this._maxAlt},i.setAltitude=function(e){if(!l(e))return this;var n=this.getLayer(),i=bA(n),o=this.properties||yA,s=o[i];if(!h(s))if(Array.isArray(s))for(var a=0,c=s.length;a<c;a++)s[a]=e;else o[i]=e;var A=this.getCoordinates?this.getCoordinates():null;if(!A)return this;if(CA(A,e),n){var f=n.getRenderer();f&&f.gl?this.setCoordinates(A):f&&this._repaint()}return this._clearAltitudeCache(),this.onPositionChanged(),this},i._genMinMaxAlt=function(){if(void 0===this._minAlt||void 0===this._maxAlt){var e=this._getAltitude(),[n,i]=Ku(e);this._minAlt=n,this._maxAlt=i}},i.getMinAltitude=function(){return this._genMinMaxAlt(),this._minAlt},i.getMaxAltitude=function(){return this._genMinMaxAlt(),this._maxAlt},i._clearAltitudeCache=function(){return this._minAlt=void 0,this._maxAlt=void 0,this},i._getEditCenter=function(){var e=this.getCenter().copy();e.z=0;var n=this.getAltitude();if(l(n))return e.z=n,e;var i=0,o=0;return Array.isArray(n)&&(!function e(n){for(var s=0,a=n.length;s<a;s++)Array.isArray(n[s])?e(n[s]):(o++,i+=n[s])}(n),e.z=i/o),e},n}(jh(Th(Uh(Ih))));function bA(e){var n="altitude";if(e){if(!e.isVectorLayer)return null;n=e.options.altitudeProperty}return n}function wA(e,n,i){var o=e.getCoordinates?e.getCoordinates():null;if(o){var s=[];if(MA(o,s),s.length)return SA(o,n,i)}return null}function CA(e,n){if(Array.isArray(e))for(var i=0,o=e.length;i<o;i++)CA(e[i],n);else e.z=n}function MA(e,n){if(!n.length)if(Array.isArray(e))for(var i=0,o=e.length;i<o;i++)MA(e[i],n);else l(e.z)&&n.push(e.z)}function SA(e,n,i){if(Array.isArray(e)){for(var o=[],s=0,a=e.length;s<a;s++)o.push(SA(e[s],n,i));return o}return l(e.z)?i?n+e.z:e.z:i?n:0}function EA(e,n,i,o){return e===i?o>n?-90:90:(i-=e,o=-(o-=n),Math.atan2(o,i)/Math.PI*180)}_A.mergeOptions({id:null,visible:!0,interactive:!0,editable:!0,cursor:null,antiMeridian:!1,defaultProjection:"EPSG:4326"});var OA={attribution:null,minZoom:null,maxZoom:null,visible:!0,opacity:1,globalCompositeOperation:null,renderer:"canvas",debugOutline:"#0f0",cssFilter:null,forceRenderOnMoving:!1,forceRenderOnZooming:!1,forceRenderOnRotating:!1,collision:!1,collisionScope:"layer",hitDetect:!wt.mobile,maskClip:!0},RA=function(e){function n(n,i){var o,s;return i&&(s=i.canvas,delete i.canvas),(o=e.call(this,i)||this)._canvas=s,o.setId(n),i&&(o.setZIndex(i.zIndex),i.mask&&o.setMask(_A.fromJSON(i.mask))),o.proxyOptions(),o}kt(n,e);var i=n.prototype;return i.load=function(){if(!this.getMap())return this;if(this.onLoad()){this._initRenderer();var e=this.getZIndex();h(e)||(this._renderer.setZIndex(e),this.isCanvasRender()||this._renderer.render()),this.onLoadEnd()}return this},i.getId=function(){return this._id},i.setId=function(e){var n=this._id;return h(e)||(e+=""),this._id=e,this.fire("idchange",{type:"idchange",target:this,old:n,new:e}),this},i.addTo=function(e){return e.addLayer(this),this},i.setZIndex=function(e){return this._zIndex=e,h(e)?delete this.options.zIndex:this.options.zIndex=e,this.map&&this.map._sortLayersByZIndex(),this._renderer&&this._renderer.setZIndex(e),this.fire("setzindex",{type:"setzindex",target:this,zIndex:e}),this},i.getZIndex=function(){return this._zIndex||0},i.getMinZoom=function(){var e=this.getMap(),n=this.options.minZoom;return e?Math.max(e.getMinZoom(),n||0):n},i.getMaxZoom=function(){var e=this.getMap(),n=this.options.maxZoom;return e?Math.min(e.getMaxZoom(),h(n)?1/0:n):n},i.getOpacity=function(){return this.options.opacity},i.setOpacity=function(e){return this.config("opacity",e),this.fire("setopacity",{type:"setopacity",target:this,opacity:e}),this},i.isCanvasRender=function(){var e=this._getRenderer();return e&&e instanceof mu},i.getMap=function(){return this.map?this.map:null},i.getProjection=function(){var e=this.getMap();return e?e.getProjection():null},i.bringToFront=function(){var e=this._getLayerList();if(!e.length)return this;var n=e[e.length-1];if(1===e.length||n===this)return this;var i=n.getZIndex();return this.setZIndex(i+1),this},i.bringToBack=function(){var e=this._getLayerList();if(!e.length)return this;var n=e[0];if(1===e.length||n===this)return this;var i=n.getZIndex();return this.setZIndex(i-1),this},i.show=function(){var e=this;if(!this.options.visible){this.options.visible=!0;var n=this.getRenderer();n&&n.show();var i=this.getMap();n&&i&&i.getRenderer()?i.getRenderer().callInNextFrame((function(){i.getRenderer().callInNextFrame((function(){e.fire("show")}))})):this.fire("show")}return this},i.hide=function(){var e=this;if(this.options.visible){this.options.visible=!1;var n=this.getRenderer();n&&n.hide();var i=this.getMap();n&&i&&i.getRenderer()?i.getRenderer().callInNextFrame((function(){i.getRenderer().callInNextFrame((function(){e.fire("hide")}))})):this.fire("hide")}return this},i.isVisible=function(){if(l(this.options.opacity)&&this.options.opacity<=0)return!1;var e=this.getMap();if(e){var n=e.getZoom();if(!h(this.options.maxZoom)&&this.options.maxZoom<n||!h(this.options.minZoom)&&this.options.minZoom>n)return!1}return h(this.options.visible)&&(this.options.visible=!0),this.options.visible},i.remove=function(){if(this.map){var e=this.map.getRenderer();this.map.removeLayer(this),e&&e.setToRedraw()}else this.fire("remove");return this},i.getMask=function(){return this._mask},i.setMask=function(e){if(!("Point"===e.type&&e._isVectorMarker()||"Polygon"===e.type||"MultiPolygon"===e.type))throw new Error("Mask for a layer must be a marker with vector marker symbol or a Polygon(MultiPolygon).");if(e._bindLayer(this),"Point"===e.type?e.updateSymbol({markerLineColor:"rgba(0, 0, 0, 0)",markerFillOpacity:0}):e.setSymbol({lineColor:"rgba(0, 0, 0, 0)",polygonOpacity:0}),this._mask=e,e&&e.toGeoJSON)try{this._maskGeoJSON=e.toGeoJSON()}catch(e){delete this._maskGeoJSON,console.error(e)}if(this.options.mask=e.toJSON(),!this.getMap()||this.getMap().isZooming())return this;var n=this._getRenderer();return n&&n.setToRedraw&&this._getRenderer().setToRedraw(),this},i.removeMask=function(){if(delete this._mask,delete this._maskGeoJSON,delete this.options.mask,!this.getMap()||this.getMap().isZooming())return this;var e=this._getRenderer();return e&&e.setToRedraw&&this._getRenderer().setToRedraw(),this},i.onLoad=function(){return!0},i.onLoadEnd=function(){},i.isLoaded=function(){return!!this._loaded},i.getCollisionIndex=function(){if("layer"===this.options.collisionScope)return this._collisionIndex||(this._collisionIndex=new eh),this._collisionIndex;var e=this.getMap();return e?e.getCollisionIndex():null},i.clearCollisionIndex=function(){return"layer"===this.options.collisionScope&&this._collisionIndex&&this._collisionIndex.clear(),this},i.getRenderer=function(){return this._getRenderer()},i.onConfig=function(e){if(e&&Object.keys&&Object.keys(e).length>0&&h(e.animation)){if(this._optionsHook&&d(this._optionsHook)&&this._optionsHook(e),this._silentConfig)return;var n=this.getRenderer();if(n&&n.setToRedraw&&n.setToRedraw(),"attribution"in e){var i=this.getMap();i&&i.attributionControl&&i.attributionControl._update&&i.attributionControl._update()}}},i.onAdd=function(){},i.onRendererCreate=function(){},i.onCanvasCreate=function(){},i.onRemove=function(){},i._bindMap=function(e,n){e&&(this.map=e,h(n)||this.setZIndex(n),this._switchEvents("on",this),this.onAdd(),this.fire("add"))},i._initRenderer=function(){var e=this.options.renderer;if(this.constructor.getRendererClass){var n=this.constructor.getRendererClass(e);if(!n)throw new Error("Invalid renderer for Layer("+this.getId()+"):"+e);this._renderer=new n(this),this._renderer.layer=this,this._renderer.setZIndex(this.getZIndex()),this._switchEvents("on",this._renderer),this._renderer.onAdd&&this._renderer.onAdd(),this.onRendererCreate(),this.fire("renderercreate",{type:"renderercreate",target:this,renderer:this._renderer})}},i._doRemove=function(){this._loaded=!1,this._switchEvents("off",this),this.onRemove(),this._renderer&&(this._switchEvents("off",this._renderer),this._renderer.remove(),delete this._renderer),delete this.map,delete this._collisionIndex},i._switchEvents=function(e,n){n&&n.getEvents&&this.getMap()&&this.getMap()[e](n.getEvents(),n)},i._getRenderer=function(){return this._renderer},i._getLayerList=function(){if(!this.map)return[];var e=+!!this.map.getBaseLayer();return this.map.getLayers().slice(e)},i._getMask2DExtent=function(){if(!this._mask||!this.getMap())return null;var e=this._mask._getMaskPainter();return e?e.get2DExtent():null},i.toJSON=function(e){return{type:"Layer",id:this.getId(),options:e||this.config()}},n.fromJSON=function(e){if(!e)return null;var i=e.type,o=n.getJSONClass(i);if(!o||!o.fromJSON)throw new Error("unsupported layer type:"+i);return o.fromJSON(e)},n}(jh(Th(au(Ih))));RA.mergeOptions(OA);var DA=RA.prototype.fire;RA.prototype.fire=function(e,n){return"layerload"===e&&(this._loaded=!0),this.map&&(n||(n={type:null,target:null}),n.type=e,n.target=this,this.map._onLayerEvent(n)),DA.apply(this,arguments),["show","hide"].indexOf(e)>-1&&this.fire("visiblechange",Object.assign({},n,{visible:this.options.visible})),this};var kA=new Zh(0,0),LA=new ee(0,0),NA=["centerCross","fog","fogColor","debugSky"],zA={maxVisualPitch:70,maxPitch:80,centerCross:!1,zoomInCenter:!1,zoomOrigin:null,zoomAnimation:!n,zoomAnimationDuration:330,panAnimation:!n,panAnimationDuration:600,rotateAnimation:!n,zoomable:!0,enableInfoWindow:!0,hitDetect:!wt.mobile,hitDetectLimit:5,fpsOnInteracting:25,layerCanvasLimitOnInteracting:-1,maxZoom:null,minZoom:null,maxExtent:null,limitExtentOnMaxExtent:!1,fixCenterOnResize:!0,checkSize:!0,checkSizeInterval:1e3,renderer:"canvas",cascadePitches:[10,60],renderable:!0,clickTimeThreshold:280,stopRenderOnOffscreen:!0,preventWheelScroll:!0,preventTouch:!0,supportPluginEvent:!0,switchDragButton:!1,mousemoveThrottleTime:48,maxFPS:0,debug:!1,cameraFarUndergroundInMeter:2e3},BA=function(e){function i(n,o){var s;if(!o)throw new Error("Invalid options when creating map.");if(!o.center)throw new Error("Invalid center when creating map.");var h=a({},o),l=h.zoom;delete h.zoom;var c=new Zh(h.center);delete h.center;var A=h.baseLayer;delete h.baseLayer;var f=h.layers;return delete h.layers,(s=e.call(this,h)||this).VERSION=i.VERSION,Object.defineProperty(s,"id",{value:oe(),writable:!1}),s._loaded=!1,s._initContainer(n),s._panels={},s._baseLayer=null,s._layers=[],s._zoomLevel=l,s._center=c,s._centerZ=c.z,s.setSpatialReference(h.spatialReference||h.view),s._mapViewPoint=new ee(0,0),s._initRenderer(),s._updateMapSize(s._getContainerDomSize()),A&&s.setBaseLayer(A),f&&s.addLayer(f),s.setMaxExtent(h.maxExtent),s._Load(),s.proxyOptions(),s.isMap=!0,s}kt(i,e),i.addOnLoadHook=function(e,...n){var i="function"==typeof e?e:function(){this[e].call(this,...n)};return this.prototype._onLoadHooks=this.prototype._onLoadHooks||[],this.prototype._onLoadHooks.push(i),this};var o=i.prototype;return o.isLoaded=function(){return!!this._loaded},o.getContainer=function(){return this._containerDOM},o.getSpatialReference=function(){return this._spatialReference},o.setSpatialReference=function(e){var n=this.options.spatialReference;return this._loaded&&fA.equals(n,e)||this._updateSpatialReference(e,n),this},o._updateSpatialReference=function(e,n){f(e)&&(e=fA.getPreset(e)),e=a({},e),this._center=this.getCenter(),this.options.spatialReference=e,this._spatialReference=new fA(e);var i=this._spatialReference.getProjection();return this.options.spatialReference&&d(this.options.spatialReference.projection)&&(this.options.spatialReference.projection=i.code),this._resetMapStatus(),Kl.is(i.code)&&(this._originLng=i.centralMeridian,this._altitudeOriginDirty=!0),this._fireEvent("spatialreferencechange",{old:n,new:a({},this.options.spatialReference)}),this},o.onConfig=function(e){var n=e.spatialReference||e.view;h(n)||this._updateSpatialReference(n,null);for(var i=!1,o=0,s=NA.length;o<s;o++){if(!h(e[NA[o]])){i=!0;break}}if(!i)return this;var a=this.getRenderer();return a&&a.setToRedraw(),this},o.getProjection=function(){return this._spatialReference?this._spatialReference.getProjection():null},o.getFullExtent=function(){return this._spatialReference?this._spatialReference.getFullExtent():null},o.setCursor=function(e){return delete this._cursor,this._trySetCursor(e),this._cursor=e,this},o.resetCursor=function(){return this.setCursor(null)},o.getCenter=function(){if(!this._loaded||!this._prjCenter)return this._center;var e=this.getProjection().unproject(this._prjCenter);return e.x=Math.round(1e8*e.x)/1e8,e.y=Math.round(1e8*e.y)/1e8,e.z=this._centerZ,this.centerAltitude&&(e.z=this.centerAltitude),e},o.setCenter=function(e,n){if(!e)return this;e=new Zh(e),n&&(e=this._getCenterByPadding(e,this.getZoom(),n));var i=this.getProjection().project(e);return this._verifyExtent(i)||this.options.limitExtentOnMaxExtent?this._loaded?(this._centerZ=e.z,this.onMoveStart(),this._setPrjCenter(i),this.onMoveEnd(this._parseEventFromCoord(this.getCenter())),this):(this._center=e,this):this},o.getSize=function(){return h(this.width)||h(this.height)?this._getContainerDomSize():new Cn(this.width,this.height)},o.getContainerExtent=function(){var e=this.height,n=this.getPitch(),i=this.options.maxVisualPitch;return i&&n>i&&(e=this._getVisualHeight(i)),new ll(0,this.height-e,this.width,this.height)},o._getVisualHeight=function(e){e=e||.01;var n=(90-this.getPitch())*Math.PI/180,i=this.getFov()*Math.PI/180;e*=Math.PI/180;var o=this.cameraCenterDistance/this.getGLScale(),s=Math.tan(i/2),a=o*s/(1/Math.tan(e)-s)/Math.sin(e),h=o*(Math.sin(n)*a/(o+Math.cos(n)*a));return this.height/2+h},o.getExtent=function(){return this.pointToExtent(this.get2DExtent())},o.getProjExtent=function(){var e=this.get2DExtent();return new al(this._pointToPrj(e.getMin()),this._pointToPrj(e.getMax()))},o.getPrjExtent=function(){return this.getProjExtent()},o.getMaxExtent=function(){return this.options.maxExtent?new al(this.options.maxExtent,this.getProjection()):null},o.setMaxExtent=function(e){if(e){var n=new al(e,this.getProjection());this.options.maxExtent=n;var i=this.getProjection();this._prjMaxExtent=n.convertTo((function(e){return i.project(e)})),this._verifyExtent(this._getPrjCenter())||(this._loaded?this._panTo(this._prjMaxExtent.getCenter()):this._center=i.unproject(this._prjMaxExtent.getCenter()))}else delete this.options.maxExtent,delete this._prjMaxExtent;return this},o.getZoom=function(){return this._zoomLevel},o.getZoomForScale=function(e,n,i){var o=this.getZoom();if(h(n)&&(n=o),1===e&&n===o)return o;var s=this._getResolution(n),a=this.getZoomFromRes(s/e);if(i)return a;var l=1e-6;return this.getSpatialReference().getZoomDirection()<0?Math.ceil(a-l):Math.floor(a+l)},o.getZoomFromRes=function(e){var n=this._getResolutions(),i=this._getResolution(this.getMinZoom()),o=this._getResolution(this.getMaxZoom());if(i<=o){if(e<=i)return this.getMinZoom();if(e>=o)return this.getMaxZoom()}else{if(e>=i)return this.getMinZoom();if(e<=o)return this.getMaxZoom()}for(var s=n.length,a=0;a<s-1;a++)if(n[a]){var h=n[a+1]-n[a],l=e-n[a];if(Ae(h)===Ae(l)&&Math.abs(h)>=Math.abs(l))return a+l/h}return s-1},o.setZoom=function(e,n={animation:!0}){return isNaN(e)||h(e)||(e=+e,this._loaded&&this.options.zoomAnimation&&n.animation?this._zoomAnimation(e):this._zoom(e)),this},o.getMaxZoom=function(){return h(this.options.maxZoom)?this.getMaxNativeZoom():this.options.maxZoom},o.setMaxZoom=function(e){var n=this.getMaxNativeZoom();return e>n&&(e=n),null!==e&&e<this._zoomLevel&&(this.setZoom(e),e=+e),this.options.maxZoom=e,this},o.getMinZoom=function(){return h(this.options.minZoom)?this._spatialReference.getMinZoom():this.options.minZoom},o.setMinZoom=function(e){if(null!==e){e=+e;var n=this._spatialReference.getMinZoom();e<n&&(e=n),e>this._zoomLevel&&this.setZoom(e)}return this.options.minZoom=e,this},o.getMaxNativeZoom=function(){var e=this.getSpatialReference();return e?e.getMaxZoom():null},o.getGLRes=function(){if(this._glRes)return this._glRes;var e=this.getSpatialReference().getFullExtent();return this._glRes=(e.right-e.left)/Math.pow(2,19),this._glRes},o.getGLScale=function(e){return h(e)&&(e=this.getZoom()),this._getResolution(e)/this.getGLRes()},o.zoomIn=function(){return this.setZoom(this.getZoom()+1)},o.zoomOut=function(){return this.setZoom(this.getZoom()-1)},o.isZooming=function(){return!!this._zooming},o.isInteracting=function(){return this.isZooming()||this.isMoving()||this.isRotating()},o.setCenterAndZoom=function(e,n){return h(n)||this._zoomLevel===n?this.setCenter(e):(this.setCenter(e),this.setZoom(n,{animation:!1})),this},o._getPaddingSize=function(e={}){return e.paddingLeft||e.paddingTop||e.paddingRight||e.paddingBottom?{width:(e.paddingLeft||0)+(e.paddingRight||0),height:(e.paddingTop||0)+(e.paddingBottom||0)}:null},o.getFitZoom=function(e,n,i){var o=this;if(!(e&&e instanceof al))return this._zoomLevel;if(e.xmin===e.xmax&&e.ymin===e.ymax)return this.getMaxZoom();var s=this.getSize(),a=this._getPaddingSize(i);if(a){var h={width:s.width-(a.width||0),height:s.height-(a.height||0)};s=new Cn(h.width,h.height)}var l=e.convertTo((function(e){return o.coordToPoint(e)})),c=l.getWidth(),A=l.getHeight(),f=s.width/c,d=s.height/A,p=this.getSpatialReference().getZoomDirection()<0?Math.max(f,d):Math.min(f,d);return this.getZoomForScale(p,null,n)},o.getView=function(){return{center:this.getCenter().toArray(),zoom:this.getZoom(),pitch:this.getPitch(),bearing:this.getBearing()}},o._validateView=function(e){if(e&&A(e)){if(l(e.bearing)){var n=e.bearing;(n%=360)>180&&(n=-180+Math.abs(n-180)),n<-180&&(n=180-Math.abs(n+180)),e.bearing=n}l(e.pitch)&&(e.pitch=Math.max(0,e.pitch),e.pitch=Math.min(this.options.maxPitch,e.pitch));var i=this.getMaxZoom();l(e.zoom)&&(e.zoom=Math.max(0,e.zoom),e.zoom=Math.min(i,e.zoom))}},o.setView=function(e){return e?(this._validateView(e),e.center&&this.setCenter(e.center),null===e.zoom||isNaN(+e.zoom)||this.setZoom(+e.zoom,{animation:!1}),null===e.pitch||isNaN(+e.pitch)||this.setPitch(+e.pitch),null===e.bearing||isNaN(+e.bearing)||this.setBearing(+e.bearing),this):this},o.getResolution=function(e){return this._getResolution(e)},o.getScale=function(e){var n=h(e)?this.getZoom():e,i=this._getResolution(this.getMaxNativeZoom());return this._getResolution(n)/i},o._getCenterByPadding=function(e,n,i){var o=this.coordinateToPoint(e,n),{paddingLeft:s=0,paddingRight:a=0,paddingTop:h=0,paddingBottom:l=0}=i||{},c=0,A=0;(s||a)&&(c=(a-s)/2),(h||l)&&(A=(h-l)/2);var f=new ee({x:o.x+c,y:o.y+A});return this.pointToCoordinate(f,n)},o.fitExtent=function(e,n,i,o){if(i=i||{},!e)return this;e=new al(e,this.getProjection());var s=this.getFitZoom(e,i.isFraction||!1,i)+(n||0),a=e.getCenter();return this._getPaddingSize(i)&&(a=this._getCenterByPadding(a,s,i)),void 0===i.animation||i.animation?this._animateTo({center:a,zoom:s},{duration:i.duration||this.options.zoomAnimationDuration,easing:i.easing||"out"},o):this.setCenterAndZoom(a,s)},o.getBaseLayer=function(){return this._baseLayer},o.setBaseLayer=function(e){var n=!1;if(this._baseLayer&&(n=!0,this._fireEvent("baselayerchangestart"),this._baseLayer.remove()),!e)return delete this._baseLayer,this._fireEvent("baselayerchangeend"),this._fireEvent("setbaselayer"),this;return this._baseLayer=e,e._bindMap(this,-1),this._baseLayer.on("layerload",(function(){this._fireEvent("baselayerload"),n&&(n=!1,this._fireEvent("baselayerchangeend"))}),this),this._loaded&&this._baseLayer.load(),this._fireEvent("setbaselayer"),this},o.removeBaseLayer=function(){return this._baseLayer&&(this._baseLayer.remove(),delete this._baseLayer,this._fireEvent("baselayerremove")),this},o.getLayers=function(e){return this._getLayers((function(n){return!(n===this._baseLayer||n.getId().indexOf(An)>=0)&&(!e||e(n))}))},o.getLayer=function(e){if(!e)return null;var n=this._layerCache?this._layerCache[e]:null;if(n)return n;var i=this.getBaseLayer();return i&&i.getId()===e?i:null},o.addLayer=function(e,...n){if(!e)return this;Array.isArray(e)||(e=[e]),n&&n.length&&(e=e.concat(n)),this._layerCache||(this._layerCache={});for(var i=this._layers,o=0,s=e.length;o<s;o++){var a=e[o],l=a.getId();if(h(l))throw new Error("Invalid id for the layer: "+l);if(a.getMap()!==this){if(this._layerCache[l])throw new Error("Duplicate layer id in the map: "+l);this._layerCache[l]=a,a._bindMap(this),i.push(a),this._loaded&&a.load()}}return this._sortLayersByZIndex(),this._fireEvent("addlayer",{layers:e}),this},o.removeLayer=function(e){if(!e)return this;if(!Array.isArray(e))return this.removeLayer([e]);for(var n=[],i=0,o=e.length;i<o;i++){var s=e[i];if(s instanceof RA||(s=this.getLayer(s)),s){var a=s.getMap();if(a&&a===this){n.push(s),this._removeLayer(s,this._layers),this._loaded&&s._doRemove();var h=s.getId();this._layerCache&&delete this._layerCache[h]}}}if(n.length>0){var l=this.getRenderer();l&&l.setLayerCanvasUpdated(),this.once("frameend",(function(){n.forEach((function(e){e.fire("remove")}))}))}return this._fireEvent("removelayer",{layers:e}),this},o.sortLayers=function(e){if(!e||!Array.isArray(e))return this;for(var n=[],i=Number.MAX_VALUE,o=0,s=e.length;o<s;o++){var a=e[o];if(f(e[o])&&(a=this.getLayer(a)),!(a instanceof RA&&a.getMap()&&a.getMap()===this))throw new Error("It must be a layer added to this map to order.");a.getZIndex()<i&&(i=a.getZIndex()),n.push(a)}for(var h=0,l=n.length;h<l;h++)n[h].setZIndex(i+h);return this},o.toDataURL=function(e){e||(e={});var n=e.mimeType;n||(n="image/png");var i=e.save,o=this._getRenderer();if(o&&o.toDataURL){var s=e.fileName;s||(s="export");var a=o.toDataURL(n,e.quality||.92);if(i&&a){var h;if("undefined"!=typeof Blob&&"undefined"!=typeof atob){var l=Ye(a.replace(/^data:image\/(png|jpeg|jpg|webp);base64,/,""),n);h=URL.createObjectURL(l)}else h=a;var c=document.createElement("a");c.download=s,c.href=h,document.body.appendChild(c),c.click(),document.body.removeChild(c)}return a}return null},o.coordToPoint=function(e,n,i){return this.coordinateToPoint(e,n,i)},o.coordToPointAtRes=function(e,n,i){return this.coordinateToPointAtRes(e,n,i)},o.pointToCoord=function(e,n,i){return this.pointToCoordinate(e,n,i)},o.pointAtResToCoord=function(e,n,i){return this.pointAtResToCoordinate(e,n,i)},o.coordToViewPoint=function(e,n,i){return this.coordinateToViewPoint(e,n,i)},o.viewPointToCoord=function(e,n){return this.viewPointToCoordinate(e,n)},o.coordToContainerPoint=function(e,n,i){return this.coordinateToContainerPoint(e,n,i)},o.containerPointToCoord=function(e,n){return this.containerPointToCoordinate(e,n)},o.containerPointToViewPoint=function(e,n){return n?n.set(e.x,e.y):n=e.copy(),n._sub(this.getViewPoint())},o.viewPointToContainerPoint=function(e,n){return n?n.set(e.x,e.y):n=e.copy(),n._add(this.getViewPoint())},o.checkSize=function(e){var n=s()-this._initTime<1500&&0===this.width||0===this.height,i=this._getContainerDomSize(),o=this.height,a=this.width;if(!e&&i.width===a&&i.height===o)return this;zi(this._containerDOM);var h=this.getCenter();if(this.options.fixCenterOnResize)this._updateMapSize(i);else{var l=this._getVisualHeight(this.getPitch()),c=new ee(0,this.height-l),A=this._containerPointToPrj(c);this._updateMapSize(i);var f=this._getVisualHeight(this.getPitch()),d=new ee(0,this.height-f);this._setPrjCoordAtContainerPoint(A,d),this._mapViewCoord=this._getPrjCenter()}return(n||(0===i.width||0===i.height||0===a||0===o))&&(this._eventSilence=!0,this.setCenter(h),delete this._eventSilence),this._fireEvent("resize"),this},o.locate=function(e,n,i){return this.getProjection()._locate(new Zh(e),n,i)},o.getMainPanel=function(){var e=this._getRenderer();return e?e.getMainPanel():null},o.getPanels=function(){return this._panels},o.remove=function(){var e=this;if(this.isRemoved())return this;this._fireEvent("removestart"),this._removeDomEvents(),this._clearHandlers(),this.removeBaseLayer();for(var n=this.getLayers(),i=0;i<n.length;i++)n[i].remove();return this._getRenderer()&&this._getRenderer().remove(),this._containerDOM.childNodes&&this._containerDOM.childNodes.length>0&&Array.prototype.slice.call(this._containerDOM.childNodes,0).filter((function(e){return"maptalks-wrapper"===e.className})).forEach((function(n){return e._containerDOM.removeChild(n)})),delete this._panels,delete this._containerDOM,delete this._renderer,this._fireEvent("removeend"),this._clearAllListeners(),this},o.isRemoved=function(){return!this._containerDOM},o.isMoving=function(){return!!this._moving},o.onMoveStart=function(e){this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer);var n=this._getPrjCenter();this._originCenter&&!this._verifyExtent(n)||(this._originCenter=n),this._moving=!0,this._trySetCursor("move"),this._fireEvent("movestart",this._parseEvent(e?e.domEvent:null,"movestart"))},o.onMoving=function(e){this._fireEvent("moving",this._parseEvent(e?e.domEvent:null,"moving")),this._limitMaxExtent()},o.onMoveEnd=function(e){(this._moving=!1,this._suppressRecenter||this._recenterOnTerrain(),this._trySetCursor("default"),this._fireEvent("moveend",e&&e.domEvent?this._parseEvent(e.domEvent,"moveend"):e),this._verifyExtent(this._getPrjCenter())||!this._originCenter||this.options.limitExtentOnMaxExtent)||this._panTo(this._originCenter);this._limitMaxExtent()},o.onDragRotateStart=function(e){this._dragRotating=!0,this._fireEvent("dragrotatestart",this._parseEvent(e?e.domEvent:null,"dragrotatestart"))},o.onDragRotating=function(e){this._fireEvent("dragrotating",this._parseEvent(e?e.domEvent:null,"dragrotating"))},o.onDragRotateEnd=function(e){this._dragRotating=!1,this._fireEvent("dragrotateend",this._parseEvent(e?e.domEvent:null,"dragrotateend"))},o.isDragRotating=function(){return!!this._dragRotating},o.isOffscreen=function(e,n=0){var{width:i,height:o}=this,s=i+n,a=o+n,{xmin:h,ymin:l,xmax:c,ymax:A}=e;return Array.isArray(e)&&([h,l,c,A]=e),c<n||h>=s||A<n||l>a},o.getRenderer=function(){return this._getRenderer()},o.getDevicePixelRatio=function(){return this.options.devicePixelRatio||wt.devicePixelRatio||1},o.setDevicePixelRatio=function(e){return l(e)&&e>0&&e!==this.options.devicePixelRatio&&(this.options.devicePixelRatio=e,this.checkSize(!0)),this},o._initContainer=function(e){if(f(e)){if(this._containerDOM=document.getElementById(e),!this._containerDOM)throw new Error("Invalid container when creating map: '"+e+"'")}else this._containerDOM=e,n&&(this.CanvasClass=this._containerDOM.constructor);if(this._containerDOM.childNodes&&this._containerDOM.childNodes.length>0&&"maptalks-wrapper"===this._containerDOM.childNodes[0].className)throw new Error("Container is already loaded with another map instance, use map.remove() to clear it.")},o._trySetCursor=function(e){return this._cursor||this._priorityCursor||(e||(e="default"),this._setCursorToPanel(e)),this},o._setPriorityCursor=function(e){if(e)this._priorityCursor=e,this._setCursorToPanel(e);else{var n=!1;this._priorityCursor&&(n=!0),delete this._priorityCursor,n&&this.setCursor(this._cursor)}return this},o._setCursorToPanel=function(e){var n=this.getMainPanel();n&&n.style&&n.style.cursor!==e&&(n.style.cursor=e)},o._removeLayer=function(e,n){if(e&&n){var i=n.indexOf(e);i>-1&&n.splice(i,1)}},o._sortLayersByZIndex=function(){if(this._layers){for(var e=0,n=this._layers.length;e<n;e++){var i=this._layers[e];i._order=e,i.sortLayersByZIndex&&i.sortLayersByZIndex()}this._layers.sort((function(e,n){var i=e.getZIndex()-n.getZIndex();return 0===i?e._order-n._order:i}))}},o._fireEvent=function(e,n){if(!this._eventSilence){"_"!==e[0]&&this.fire("_"+e,n),this.fire(e,n)}},o._Load=function(){this._resetMapStatus(),this.options.pitch&&(this.setPitch(this.options.pitch),delete this.options.pitch),this.options.bearing&&(this.setBearing(this.options.bearing),delete this.options.bearing),delete this._glRes,this._loadAllLayers(),this._getRenderer().onLoad(),this._loaded=!0,this._callOnLoadHooks(),this._initTime=s()},o._initRenderer=function(){var e=i.getRendererClass(this.options.renderer);this._renderer=new e(this),this._renderer.load()},o._getRenderer=function(){return this._renderer},o._loadAllLayers=function(){this._baseLayer&&this._baseLayer.load(),this._eachLayer((function(e){e&&e.load()}),this.getLayers())},o._getLayers=function(e){for(var n=this._baseLayer?[this._baseLayer].concat(this._layers):this._layers,i=[],o=0;o<n.length;o++)e&&!e.call(this,n[o])||i.push(n[o]);return i},o._eachLayer=function(e,...n){if(!(arguments.length<2)){n&&!Array.isArray(n)&&(n=[n]);for(var i=[],o=0,s=n.length;o<s;o++)i=i.concat(n[o]);for(var a=0,h=i.length;a<h;a++)e.call(e,i[a])}},o._onLayerEvent=function(e){e&&"idchange"===e.type&&(delete this._layerCache[e.old],this._layerCache[e.new]=e.target)},o._resetMapStatus=function(){var e=this.getMaxZoom(),n=this.getMinZoom(),i=this._spatialReference.getMaxZoom(),o=this._spatialReference.getMinZoom();(h(e)||-1===e||e>i)&&this.setMaxZoom(i),(h(n)||-1===n||n<o)&&this.setMinZoom(o),(e=this.getMaxZoom())<(n=this.getMinZoom())&&this.setMaxZoom(n),(h(this._zoomLevel)||this._zoomLevel>e)&&(this._zoomLevel=e),this._zoomLevel<n&&(this._zoomLevel=n),delete this._prjCenter,delete this._glRes;var s=this.getProjection();this._prjCenter=s.project(this._center),this._prjCenter.z=this._center.z,this._calcMatrices();var a=this._getRenderer();a&&a.resetContainer()},o.setContainerDomRect=function(e){this._containerDomContentRect=e},o._getContainerDomSize=function(){if(!this._containerDOM)return null;var e,n,i=this._containerDOM;if(this._containerDomContentRect)return new Cn(e=this._containerDomContentRect.width,n=this._containerDomContentRect.height);var o=i;if(h(o.width)||h(o.height)){if(h(i.clientWidth)||h(i.clientHeight))throw new Error("can not get size of container");e=parseInt(i.clientWidth+"",0),n=parseInt(i.clientHeight+"",0)}else{e=o.width,n=o.height;var s=this.getDevicePixelRatio();1!==s&&i.layer&&(e/=s,n/=s)}return new Cn(e,n)},o._updateMapSize=function(e){return this.width=e.width,this.height=e.height,this._getRenderer().updateMapSize(e),this._calcMatrices(),this},o._getPrjCenter=function(){return this._prjCenter},o._setPrjCenter=function(e){this._prjCenter=e,this.isInteracting()&&!this.isMoving()&&(this._mapViewCoord=e),this._calcMatrices()},o._setPrjCoordAtContainerPoint=function(e,n){if(!this.centerAltitude&&n.x===this.width/2&&n.y===this.height/2)return this;var i=this._containerPointToPoint(n)._sub(this._prjToPoint(this._getPrjCenter())),o=this._pointToPrj(this._prjToPoint(e)._sub(i));return this._setPrjCenter(o),this},o._setPrjCoordAtOffsetToCenter=function(e,n){var i=this._pointToPrj(this._prjToPoint(e)._sub(n));return this._setPrjCenter(i),this},o._verifyExtent=function(e){if(!e)return!1;var n=this._prjMaxExtent;return!n||n.contains(e)},o._limitMaxExtent=function(){var e=this;if(this._limitMaxExtenting||!this.options.limitExtentOnMaxExtent)return this;var n=this._prjMaxExtent,i=this.getMaxExtent();if(!n||!i)return this;var o=n.toArray().map((function(n){return e.prjToContainerPoint(n)})),s=cs();ps(o,s);var{width:a,height:h}=this.getSize(),l=[0,0,a,h];if(xs(l,s))return this;if(xs(s,l))return this;var c=0,A=0,f=0,d=0,p=0,g=0,v=Math.abs,[w,C,P,T]=s;if(w>0&&P>a&&(c=f=v(w)),w<0&&P<a&&(c=f=-v(w)),w<0&&P<a&&(c=d=-v(a-P)),w>0&&P>a&&(c=d=v(a-P)),C>0&&T>h&&(A=p=v(C)),C<0&&T<h&&(A=p=-v(C)),C<0&&T<h&&(A=g=-v(h-T)),C>0&&T>h&&(A=g=v(h-T)),0!==f&&0!==d&&(c=f,v(d)<v(f)&&(c=d)),0!==p&&0!==g&&(A=p,v(g)<v(p)&&(A=g)),0!==c||0!==A){var S=new ee(a/2+c,h/2+A),I=this.containerPointToCoord(S);this._limitMaxExtenting=!0,this.setCenter(I),this._limitMaxExtenting=!1}return this},o._offsetCenterByPixel=function(e){var n=LA.set(this.width/2-e.x,this.height/2-e.y),i=this._containerPointToPrj(n,kA),o=LA.set(this.width/2,this.height/2);this._setPrjCoordAtContainerPoint(i,o)},o.offsetPlatform=function(e){return e?(this._getRenderer().offsetPlatform(e),this._mapViewCoord=this._getPrjCenter(),this._mapViewPoint=this._mapViewPoint.add(e),this._mapViewPoint):this._mapViewPoint},o.getViewPoint=function(){var e=this.getViewPointFrameOffset(),n=this.offsetPlatform();return e&&(n=n.add(e)),n},o._resetMapViewPoint=function(){this._mapViewPoint=new ee(0,0),this._mapViewCoord=this._getPrjCenter()},o._getResolution=function(e){return void 0!==e&&e!==this._zoomLevel||void 0===this._mapRes?(h(e)&&(e=this._zoomLevel),this._spatialReference.getResolution(e)):this._mapRes},o._getResolutions=function(){return this._spatialReference.getResolutions()},o._prjToPoint=function(e,n,i){n=h(n)?this.getZoom():n;var o=this._getResolution(n);return this._prjToPointAtRes(e,o,i)},o._prjToPointAtRes=function(e,n,i){return this._spatialReference.getTransformation().transform(e,n,i)},o._prjsToPointsAtRes=function(e,n,i=[]){for(var o=this._spatialReference.getTransformation(),s=[],a=0,h=e.length;a<h;a++){var l=o.transform(e[a],n,i[a]);s.push(l)}return s},o._pointToPrj=function(e,n,i){n=h(n)?this.getZoom():n;var o=this._getResolution(n);return this._pointToPrjAtRes(e,o,i)},o._pointToPrjAtRes=function(e,n,i){return this._spatialReference.getTransformation().untransform(e,n,i)},o._pointToPoint=function(e,n,i){return h(n)?(i?(i.x=e.x,i.y=e.y):i=e.copy(),i):this._pointAtResToPoint(e,this._getResolution(n),i)},o._pointAtResToPoint=function(e,n,i){return i?(i.x=e.x,i.y=e.y):i=e.copy(),i._multi(n/this._getResolution())},o._pointToPointAtRes=function(e,n,i){return i?(i.x=e.x,i.y=e.y):i=e.copy(),i._multi(this._getResolution()/n)},o._containerPointToPrj=function(e,n){return this._pointToPrj(this._containerPointToPoint(e,void 0,n),void 0,n)},o._callOnLoadHooks=function(){var e=i.prototype;if(e._onLoadHooks)for(var n=0,o=e._onLoadHooks.length;n<o;n++)e._onLoadHooks[n].call(this)},o._fixPrjOnWorldWide=function(e){var n=this.getProjection();if(n&&n.fullExtent&&e){var{left:i,bottom:o,top:s,right:a}=n.fullExtent||{};l(i)&&(e.x=Math.max(i,e.x)),l(a)&&(e.x=Math.min(a,e.x)),l(o)&&(e.y=Math.max(o,e.y)),l(s)&&(e.y=Math.min(s,e.y))}return this},o.toJSON=function(e){e||(e={});var n={jsonVersion:this.JSON_VERSION,version:this.VERSION,extent:this.getExtent().toJSON()};n.options=this.config(),n.options.center=this.getCenter(),n.options.zoom=this.getZoom(),n.options.bearing=this.getBearing(),n.options.pitch=this.getPitch();var i=this.getBaseLayer();(h(e.baseLayer)||e.baseLayer)&&i&&(n.baseLayer=i.toJSON(e.baseLayer));var o={};e.clipExtent&&(o.clipExtent=!0===e.clipExtent?this.getExtent():e.clipExtent);var s=[];if(h(e.layers)||e.layers&&!Array.isArray(e.layers)){for(var l=this.getLayers(),c=0,f=l.length;c<f;c++)if(l[c].toJSON){var d=a({},A(e.layers)?e.layers:{},o);s.push(l[c].toJSON(d))}n.layers=s}else if(xe(e.layers)){for(var p=e.layers,g=0;g<p.length;g++){var v=p[g],w=this.getLayer(v.id);if(w.toJSON){var C=a({},v.options,o);s.push(w.toJSON(C))}}n.layers=s}else n.layers=[];return n},i.fromJSON=function(e,n,o){if(!e||!n)return null;o||(o={});var s=new i(e,n.options);if(h(o.baseLayer)||o.baseLayer){var a=RA.fromJSON(n.baseLayer);a&&s.setBaseLayer(a)}if(h(o.layers)||o.layers){for(var l=[],c=n.layers,A=0;A<c.length;A++){var f=RA.fromJSON(c[A]);l.push(f)}s.addLayer(l)}return s},i}(Uh(Th(au(Ih))));BA.mergeOptions(zA);var HA=function(e){function n(){return e.apply(this,arguments)||this}kt(n,e);var i=n.prototype;return i.addHooks=function(){this.target&&this.target.on("_dblclick",this._onDoubleClick,this)},i.removeHooks=function(){this.target&&this.target.off("_dblclick",this._onDoubleClick,this)},i._onDoubleClick=function(e){var n=this.target;if(n.options.doubleClickZoom){var i=n.getZoom(),o=e.domEvent.shiftKey?Math.ceil(i)-1:Math.floor(i)+1;n._zoomAnimation(o,e.containerPoint)}},n}(Sh);BA.mergeOptions({doubleClickZoom:!0}),BA.addOnLoadHook("addHandler","doubleClickZoom",HA);var jA=function(e){function n(){return e.apply(this,arguments)||this}kt(n,e);var i=n.prototype;return i.addHooks=function(){var e=this.target;if(e){var n=e.getPanels().mapWrapper||e.getContainer();this._dragHandler=new qh(n,{cancelOn:this._cancelOn.bind(this),rightclick:!0}),this._dragHandler.on("mousedown",this._onMouseDown,this).on("dragstart",this._onDragStart,this).on("dragging",this._onDragging,this).on("dragend",this._onDragEnd,this).enable()}},i.removeHooks=function(){this._dragHandler.off("mousedown",this._onMouseDown,this).off("dragstart",this._onDragStart,this).off("dragging",this._onDragging,this).off("dragend",this._onDragEnd,this),this._dragHandler.remove(),delete this._dragHandler},i._cancelOn=function(e){return!(!this.target.isZooming()&&!this._ignore(e))},i._ignore=function(e){return!!e&&(e.domEvent&&(e=e.domEvent),this.target._ignoreEvent(e))},i._onMouseDown=function(e){delete this.startDragTime,delete this._mode;var n=this.target.options.switchDragButton;n&&"touchstart"===e.domEvent.type||e.domEvent.button===(n?0:2)||e.domEvent.ctrlKey?(this.target.options.dragRotate||this.target.options.dragPitch)&&(this._mode="rotatePitch"):this.target.options.dragPan&&(this._mode="move"),this.target._stopAnim(this.target._mapAnimPlayer),Di(e.domEvent)},i._onDragStart=function(e){this.startDragTime=s(),"move"===this._mode?this._moveStart(e):"rotatePitch"===this._mode&&this._rotateStart(e)},i._onDragging=function(e){"move"===this._mode?this._moving(e):"rotatePitch"===this._mode&&this._rotating(e)},i._onDragEnd=function(e){"move"===this._mode?this._moveEnd(e):"rotatePitch"===this._mode&&this._rotateEnd(e),delete this.startDragTime,delete this.startBearing},i._start=function(e){this.preX=e.mousePos.x,this.preY=e.mousePos.y,this.startX=this.preX,this.startY=this.preY,this._startPrjCenter=this.target._getPrjCenter().copy()},i._moveStart=function(e){delete this.startContainerPoint,this._start(e);var n=this.target;n.onMoveStart(e);var i=Bi(n._getActualEvent(e.domEvent),n.getContainer());this.startPrjCoord=n.queryPrjCoordAtContainerPoint(i),n._isContainerPointOutOfMap(i)&&void 0===this.startPrjCoord.z&&(this.startContainerPoint=i)},i._moving=function(e){if(this.startDragTime){var n=this.target,i=Bi(n._getActualEvent(e.domEvent),n.getContainer());if(this.startContainerPoint){var o=i._sub(this.startContainerPoint);i.set(n.width/2+o.x,n.height/2+o.y)}var s=n._containerPointToPoint(i,void 0,void 0,this.startPrjCoord.z)._sub(n._prjToPoint(n._getPrjCenter()));n._setPrjCoordAtOffsetToCenter(this.startPrjCoord,s),n.onMoving(e)}},i._moveEnd=function(e){if(this.startDragTime){var n="touchend"===e.domEvent.type,i=this.target,o=s()-this.startDragTime,a=e.mousePos.x-this.startX,h=e.mousePos.y-this.startY,l=i._getPrjCenter(),c=l.sub(this._startPrjCenter);if(this._clear(),i.options.panAnimation&&!e.interupted&&i._verifyExtent(i._getPrjCenter())&&o<280&&Math.abs(h)+Math.abs(a)>5){o*=5;var A=l.add(c._multi(n?5:2.8));i._panTo(A,{duration:n?3*o:2*o,easing:i.options.dragPanEasing||"outExpo"})}else i.onMoveEnd(e)}},i._rotateStart=function(e){this._start(e),delete this._rotateMode,this.startBearing=this.target.getBearing(),this.target.onDragRotateStart(e),this._db=0},i._rotating=function(e){var n=this.target,i=e.mousePos.x,o=e.mousePos.y,s=n.getPitch(),a=n.getBearing(),h=Math.abs(i-this.preX),l=Math.abs(o-this.preY);if(this._rotateMode||(this._rotateMode=n.options.dragRotatePitch?"rotate_pitch":h>l?"rotate":h<l?"pitch":"rotate"),!("pitch"===this._rotateMode&&0===s&&l<10)){if(this._rotateMode.indexOf("rotate")>=0&&n.options.dragRotate){var c=.15,A=0;A=n.options.dragPitch||h>l?-.15*(this.preX-i):i>n.width/2?c*(this.preY-o):-.15*(this.preY-o);var f=n.getBearing()+A;this._db=this._db||0,this._db+=A,n._setBearing(f)}this._rotateMode.indexOf("pitch")>=0&&n.options.dragPitch&&n._setPitch(n.getPitch()+.15*(this.preY-o)),this.preX=i,this.preY=o,n.getBearing()===a&&n.getPitch()===s||n.onDragRotating(e)}},i._rotateEnd=function(e){var n=this.target,i=n.getBearing();this._clear();var o=s()-this.startDragTime;if(n.onDragRotateEnd(e),n.options.rotateAnimation&&Math.abs(i-this.startBearing)>20&&("rotate"===this._rotateMode||"rotate_pitch"===this._rotateMode)&&!e.interupted&&o<400){var a=n.getBearing();n._animateTo({bearing:a+this._db/1.5},{easing:"outQuint",duration:1600})}},i._clear=function(){delete this.startPrjCoord,delete this.preX,delete this.preY,delete this.startX,delete this.startY},n}(Sh);BA.mergeOptions({draggable:!0,dragPan:!0,dragRotatePitch:!0,dragRotate:!0,dragPitch:!0}),BA.addOnLoadHook("addHandler","draggable",jA);var GA="mousedown mouseup mousemove click dblclick contextmenu touchstart touchmove touchend mouseout",VA={mousemove:["mousemove","mouseover","mouseout","mouseenter"],touchend:["touchend","click"]},WA=function(e){return e&&e.getLayer&&e.on&&e.fire},qA=function(e,n,i){if(e._onEvent)return e._onEvent(n,i);var o=e.getLayer();return o&&o.fireGeoEvent?o.fireGeoEvent(e,n,i):null},ZA=function(e){function n(){return e.apply(this,arguments)||this}kt(n,e);var i=n.prototype;return i.addHooks=function(){var e=this.target,n=e.getPanels().allLayers||e.getContainer();$i(n,GA,this._identifyGeometryEvents,this)},i.removeHooks=function(){var e=this.target,n=e.getPanels().allLayers||e.getContainer();tr(n,GA,this._identifyGeometryEvents)},i._identifyGeometryEvents=function(e,n){var i=this.target;if(!i.isInteracting()&&!i._ignoreEvent(e)){var a=null,h=n||e.type;if(er(h)&&!o.isTest&&nr(this,i.options.mousemoveThrottleTime))ki(e);else{var l="mousedown"===h||"touchstart"===h&&e.touches&&1===e.touches.length;if(l)this._mouseDownTime=s();else if(("click"===h||"touchend"===h)&&this._mouseDownTime){var c=this._mouseDownTime;if(delete this._mouseDownTime,s()-c>300){if("click"===h)return}else"touchend"===h&&(a="click")}var A=e.touches&&e.touches.length>0?e.touches[0]:e.changedTouches&&e.changedTouches.length>0?e.changedTouches[0]:e;if(A){var f=Bi(A,i.getContainer());"touchstart"===h&&i.options.preventTouch&&Di(e);for(var d=null,p=this.target.getRenderer().getTopElements(),g=l&&2!==e.button,v=0;v<p.length;v++)if(p[v].hitTest(f)){var w=p[v].options.cursor;if(w&&(d=w),g||p[v].events&&p[v].events.indexOf(h)>=0){var C={target:i,type:h,domEvent:e,containerPoint:f};if(g)return i._setPriorityCursor(d),void p[v].mousedown(C);p[v].onEvent(C)}}var P=i._getLayers((function(e){return!(!e.identify||!e.options.geometryEvents)}));if(P.length){var T={includeInternals:!0,filter:function(n){if(n instanceof _A){var i=n._getEventTypeToFire(e);return"mousemove"===h?(!d&&n.options.cursor&&(d=n.options.cursor),!0):!(!n.listens(i)&&!n.listens(a))}return!!WA(n)},count:1,onlyVisible:i.options.onlyVisibleGeometryEvents,containerPoint:f,layers:P,eventTypes:VA[h]||[h],domEvent:e},S=function(n){var o=this,s=!0,l=function(){return o._prevOverGeos&&o._prevOverGeos.geos||[]},c=function(n=[],i=[]){if(n&&n.length>0)for(var o=n.length-1;o>=0;o--){var a=n[o];WA(a)&&(-1===i.indexOf(a)&&(s=qA(a,e,"mouseout")))}};if("mouseout"===h){var A=l();this._prevOverGeos={geos:[],geomap:{}},c(A,[])}else if("mousemove"===h){var f={};if(n.length>0)for(var p=n.length-1;p>=0;p--){var g=n[p];if(WA(g)){var v=(P=g)._getInternalId?P._getInternalId():P.getId?P.getId():null;f[v]=g,qA(g,e),this._prevOverGeos&&this._prevOverGeos.geomap[v]||qA(g,e,"mouseenter"),s=qA(g,e,"mouseover")}}i._setPriorityCursor(d);var w=l();this._prevOverGeos={geos:n,geomap:f},c(w,n)}else{if(!n||!n.length)return;for(var C=n.length-1;C>=0;C--)if(WA(n[C])){s=qA(n[C],e),a&&qA(n[C],e,a);break}}var P;!1===s&&ki(e)}.bind(this);er(h)?this._queryIdentifyTimeout=i.getRenderer().callInNextFrame((function(){i.isInteracting()||i.identifyAtPoint(T,S)})):i.identifyAtPoint(T,S)}}}}},n}(Sh);BA.mergeOptions({geometryEvents:!0,onlyVisibleGeometryEvents:!0}),BA.addOnLoadHook("addHandler","geometryEvents",ZA);var QA=4.000244140625,XA=1/450,YA=function(e){function n(n){var i;return(i=e.call(this,n)||this)._thisScrollZoom=i._scrollZoom.bind(i),i._thisCheckIfEndZoom=i._checkIfEndZoom.bind(i),i._wheelZoomRate=XA,i._defaultZoomRate=.01,i._delta=0,i}kt(n,e);var i=n.prototype;return i.addHooks=function(){Si(this.target._containerDOM,"wheel",this._onWheelScroll,this)},i.removeHooks=function(){Ii(this.target._containerDOM,"wheel",this._onWheelScroll)},i._currentZoomCanScroll=function(e){if(l(e)){var n=this.target,i=n.getZoom(),o=n.getMinZoom(),s=n.getMaxZoom();if(i===o&&e>0)return!1;if(i===s&&e<0)return!1}return!0},i._onWheelScroll=function(e){var n=this.target;if(n.options.preventWheelScroll&&(Di(e),ki(e)),n._ignoreEvent(e)||!n.options.zoomable)return!1;var i=n.getContainer(),o=n._checkZoomOrigin(Bi(e,i));return n.options.seamlessZoom?(this._zooming||(this._trackPadSuspect=0,this._ensureTrackpad=!1),this._seamless(e,o)):this._interval(e,o)},i._seamless=function(e,n){var i=e.deltaMode===window.WheelEvent.DOM_DELTA_LINE?60*e.deltaY:e.deltaY;if(i%QA!=0&&(this._ensureTrackpad||(Math.abs(i)<60?this._trackPadSuspect++:this._trackPadSuspect=0,this._trackPadSuspect>=2&&(this._ensureTrackpad=!0)),this._ensureTrackpad&&(i*=14)),e.shiftKey&&i&&(i/=4),this._lastWheelEvent=e,h(this._delta)&&(this._delta=0),this._delta-=i,this._currentZoomCanScroll(i)){if(!this._zooming&&this._delta){var o=this.target;this._zoomOrigin=n,o.onZoomStart(null,n)}this._start()}},i._start=function(){this._delta&&(this._zooming=!0,this._active||(this.target.getRenderer().callInNextFrame(this._thisScrollZoom),this._active=!0))},i._scrollZoom=function(){if(this._active=!1,this._delta){var e=Math.abs(this._delta)>QA?this._wheelZoomRate:this._defaultZoomRate,n=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==n&&(n=1/n);var i=this.target,o=i.getZoom(),s=i.getZoomForScale(n,o,!0);this._delta=0,i.onZooming(s,this._zoomOrigin),this._scrollTime=performance.now(),i.getRenderer().callInNextFrame(this._thisCheckIfEndZoom)}},i._checkIfEndZoom=function(){if(this._zooming){var e=this.target;performance.now()-this._scrollTime>210?(this._zooming=!1,e.onZoomEnd(e.getZoom(),this._zoomOrigin)):e.getRenderer().callInNextFrame(this._thisCheckIfEndZoom)}},i._interval=function(e,n){var i=this,o=this.target;if(this._zooming)return this._requesting++,!1;this._requesting=0;var s=(e.deltaY?-1*e.deltaY:e.wheelDelta?e.wheelDelta:e.detail)>0?1:-1;e.detail&&(s*=-1);var a=o.getZoom(),l=a+s;if((l=o._checkZoom(s>0?Math.ceil(l):Math.floor(l)))===a)return!1;this._zooming=!0,this._delta||(o.onZoomStart(null,n),this._origin=n,this._delta=s,this._startZoom=o.getZoom());return o._animateTo({zoom:l-1*this._delta/2,around:this._origin},{continueOnViewChanged:!0,easing:"linear",duration:90,wheelZoom:!0},(function(n){"finished"===n.state.playState?i._requesting<1||Math.abs(l-i._startZoom)>2||l===o.getMaxZoom()||l===o.getMinZoom()?(o._animateTo({zoom:l,around:i._origin},{continueOnViewChanged:!0,duration:100},(function(e){"running"!==e.state.playState&&(delete i._zooming,delete i._requesting)})),delete i._startZoom,delete i._origin,delete i._delta,i._requesting=0):h(i._requesting)||(delete i._zooming,i._onWheelScroll(e)):"running"!==n.state.playState&&(delete i._zooming,delete i._requesting)})),!1},n}(Sh);BA.mergeOptions({scrollWheelZoom:!0,seamlessZoom:!0}),BA.addOnLoadHook("addHandler","scrollWheelZoom",YA);var JA=function(e){function n(){return e.apply(this,arguments)||this}kt(n,e);var i=n.prototype;return i.addHooks=function(){Si(this.target.getContainer(),"touchstart",this._onTouchStart,this)},i.removeHooks=function(){Ii(this.target.getContainer(),"touchstart",this._onTouchStart)},i._onTouchStart=function(e){var n=this.target;if(e.touches&&!(e.touches.length<2)){var i=n.getContainer(),o=Bi(e.touches[0],i),s=Bi(e.touches[1],i);this.preY=o.y,this._startP1=o,this._startP2=s,this._startDist=o.distanceTo(s),this._startVector=o.sub(s),this._startZoom=n.getZoom(),this._startBearing=n.getBearing(),tr(document,"touchmove",this._onTouchMove),tr(document,"touchend",this._onTouchEnd),Si(document,"touchmove",this._onTouchMove,this),Si(document,"touchend",this._onTouchEnd,this),n.options.preventTouch&&Di(e),n._fireEvent("touchactstart")}},i._onTouchMove=function(e){var n=this.target;if(e.touches&&!(e.touches.length<2)){var i=n.getContainer(),o=Bi(e.touches[0],i),s=Bi(e.touches[1],i),a=o.sub(this._startP1),h=s.sub(this._startP2),l=o.sub(s),c=o.distanceTo(s)/this._startDist,A=180*l.angleWith(this._startVector)/Math.PI,f=.4*((this.preY||o.y)-o.y);this.preY=o.y;var d={domEvent:e,mousePos:[o,s]};if(this.mode||(n.options.touchRotate&&Math.abs(A)>8?this.mode=n.options.touchZoomRotate?"rotate_zoom":"rotate":n.options.touchPitch&&a.y*h.y>0&&Math.abs(a.y)>10&&Math.abs(h.y)>10?this.mode="pitch":n.options.zoomable&&n.options.touchZoom&&Math.abs(1-c)>.15&&(this.mode=n.options.touchZoomRotate&&n.options.touchRotate?"rotate_zoom":"zoom"),this._startTouching(d)),"zoom"===this.mode||"rotate_zoom"===this.mode){this._scale=c;var p=n._getResolution(this._startZoom)/c,g=n.getZoomFromRes(p);n.onZooming(g,this._Origin)}"rotate"===this.mode||"rotate_zoom"===this.mode?(n._setBearing(this._startBearing+A),n.onDragRotating(d)):"pitch"===this.mode&&(n._setPitch(n.getPitch()+f),n.onDragRotating(d)),n._fireEvent("touchactinging")}},i._startTouching=function(e){var n=this.target;if("zoom"===this.mode||"rotate_zoom"===this.mode){var i=n.getSize();this._Origin=new ee(i.width/2,i.height/2),n.onZoomStart(null,this._Origin)}"rotate"!==this.mode&&"pitch"!==this.mode&&"rotate_zoom"!==this.mode||n.onDragRotateStart(e)},i._onTouchEnd=function(e){delete this.preY;var n=this.target;if(tr(document,"touchmove",this._onTouchMove),tr(document,"touchend",this._onTouchEnd),"zoom"===this.mode||"rotate_zoom"===this.mode){var i=this._scale,o=n._getResolution(this._startZoom)/i,s=n.getZoomFromRes(o);n.onZoomEnd(s,this._Origin)}"pitch"!==this.mode&&"rotate"!==this.mode&&"rotate_zoom"!==this.mode||n.onDragRotateEnd({domEvent:e}),delete this.mode,n._fireEvent("touchactend")},n}(Sh);BA.mergeOptions({touchGesture:!0,touchZoom:!0,touchPitch:!0,touchRotate:!0,touchZoomRotate:!1}),BA.addOnLoadHook("addHandler","touchGesture",JA);var KA="__anim_player",$A={outExpo:function(e){return 1===e?1:1-Math.pow(2,-10*e)},outQuint:function(e){return 1-Math.pow(1-e,5)},in:function(e){return Math.pow(e,2)},out:function(e){return 1-$A.in(1-e)},inAndOut:function(e){return 3*e*e-2*e*e*e},linear:function(e){return e},upAndDown:function(e){return e<.5?$A.inAndOut(2*e):1-$A.inAndOut(2*(e-.5))}},tf=Dt((function(e,n){this.state=e,this.styles=n}),[{key:"playState",get:function(){return this.state.playState}},{key:"symbol",get:function(){return this.styles.symbol}}]),nf=function(){function e(e,n,i,o){this._animation=e,this.options=n,this._onFrame=i,this.playState="idle",this.ready=!0,this.finished=!1,this.target=o}var n=e.prototype;return n._prepare=function(){var e=this.options,n=e.speed||e.duration;f(n)&&((n=rf.speed[n])||(n=+n)),n||(n=rf.speed.normal),this.duration=n,this._framer=e.framer||rf._requestAnimFrame.bind(rf)},n.play=function(){if("idle"!==this.playState&&"paused"!==this.playState||this.target&&this.target[KA])return this;this.target&&(this.target[KA]=1),"idle"===this.playState&&(this.currentTime=0,this._prepare());var e=s();if(!this.startTime){var n=this.options;this.startTime=n.startTime?n.startTime:e}return this._playStartTime=Math.max(e,this.startTime),"paused"===this.playState&&(this._playStartTime-=this.currentTime),this.playState="running",this._run(),this},n.pause=function(){return"paused"===this.playState||(this.playState="paused",this._run()),this},n.cancel=function(){return"idle"===this.playState||(this.playState="idle",this.finished=!1,this._run()),this},n.finish=function(){return"finished"===this.playState||(this.playState="finished",this.finished=!0,this._run()),this},n.reverse=function(){},n._run=function(){var e=this,n=this._onFrame,i=s(),o=i-this._playStartTime;if(this.options.repeat&&o>=this.duration&&(this._playStartTime=i,o=0),"running"===this.playState){var a=this._animation(o,this.duration);this.playState=a.state.playState,"running"!==this.playState&&this.target&&delete this.target[KA],"idle"===this.playState?this.startTime>i&&setTimeout(this._run.bind(this),this.startTime-i):"running"===this.playState?this._framer((function(){"running"===e.playState&&(e.currentTime=o,n&&n(a),e._run())})):"finished"===this.playState&&(this.finished=!0,n&&n(a))}else if(this.target&&delete this.target[KA],n){"finished"===this.playState?o=this.duration:"idle"===this.playState&&(o=0);var h=this._animation(o,this.duration);h.state.playState=this.playState,n(h)}},e}(),rf={speed:{slow:2e3,normal:1e3,fast:500},_resolveStyles:function(e){if(!e)return null;function n(e){if(!Array.isArray(e))return rf._resolveStyles(e);for(var n=[],i=[],o=[],s=0;s<e.length;s++){var a=rf._resolveStyles(e[s]);a&&(n.push(a[0]),i.push(a[1]),o.push(a[2]))}return n.length?[n,i,o]:null}function i(e){var n,i=e;Array.isArray(e)||(i=l(e)?[0,e]:e instanceof ee||e instanceof Zh?[new(n=e.constructor)(0,0),e]:[e,e]);var o=i[0],s=i[1];return l(o)&&l(s)?o===s?null:[o,s-o,s]:Array.isArray(o)&&l(o[0])||o instanceof Zh||o instanceof ee?(Array.isArray(o)?(o=new Zh(o),s=new Zh(s)):(o=new(n=o.constructor)(o),s=new n(s)),o.equals(s)?null:[o,s.sub(o),s]):[o,s,s]}var o,s={},a={},c={};for(var A in e)if(e.hasOwnProperty(A)){var f=e[A];if(!f)continue;if(Array.isArray(f)&&(h(f[0])||h(f[1])))continue;var d=void 0;o=f,(d=!Array.isArray(o)&&o.constructor===Object||Array.isArray(o)&&o[0].constructor===Object?n(f):i(f))&&(a[A]=d[0],s[A]=d[1],c[A]=d[2])}return[a,s,c]},framing:function(e,n){n||(n={});var i,o,s,a=n.easing?$A[n.easing]:$A.linear;a||(a=$A.linear),(e=rf._resolveStyles(e))&&(o=e[0],i=e[1],s=e[2]);var h=function e(n,i,o){if(!i||!o)return null;var a={};for(var h in o)if(o.hasOwnProperty(h)){if(i[h]===s[h]){a[h]=i[h];continue}var c=i[h],A=o[h];if(l(A))a[h]=c+n*A;else if(Array.isArray(A)){for(var f=[],d=0;d<A.length;d++)f.push(e(n,c[d],A[d]));a[h]=f}else{a[h]=A.constructor===Object?e(n,c,A):c instanceof ee||c instanceof Zh?c.add(A.multi(n)):A}}return a};return function(e,n){var l,c;if(e<0)l={playState:"idle",delta:0},c=o;else if(e<n){var A=a(e/n);l={playState:"running",delta:A},c=h(A,o,i)}else l={playState:"finished",delta:1},c=s;return l.startStyles=o,l.destStyles=s,l.progress=e,l.remainingMs=n-e,new tf(l,c)}},_requestAnimFrame:function(e){this._frameQueue||(this._frameQueue=[]),this._frameQueue.push(e),this._a()},_a:function(){this._animationFrameId||(this._animationFrameId=Kt(rf._frameFn))},_run:function(){if(this._frameQueue.length){var e=this._frameQueue;this._frameQueue=[];for(var n=0,i=e.length;n<i;n++)e[n]();this._frameQueue.length?this._animationFrameId=Kt(rf._frameFn):delete this._animationFrameId}},animate:function(e,n,i,o){n||(n={});var s=rf.framing(e,n);return new nf(s,n,i,o)},_frameFn:function(){}};rf._frameFn=rf._run.bind(rf);var of=rf.animate,sf=Object.freeze({__proto__:null,Animation:rf,Easing:$A,Frame:tf,Player:nf,animate:of}),af={exports:{}};!function(e){!function(){function n(e,n,i){var o=n.x,s=n.y,a=i.x-o,h=i.y-s;if(0!==a||0!==h){var l=((e.x-o)*a+(e.y-s)*h)/(a*a+h*h);l>1?(o=i.x,s=i.y):l>0&&(o+=a*l,s+=h*l)}return(a=e.x-o)*a+(h=e.y-s)*h}function i(e,o,s,a,h){for(var l,c=a,A=o+1;A<s;A++){var f=n(e[A],e[o],e[s]);f>c&&(l=A,c=f)}c>a&&(l-o>1&&i(e,o,l,a,h),h.push(e[l]),s-l>1&&i(e,l,s,a,h))}function o(e,n){var o=e.length-1,s=[e[0]];return i(e,0,o,n,s),s.push(e[o]),s}function s(e,n,i){if(e.length<=2)return e;var s=void 0!==n?n*n:1;return e=i?e:function(e,n){for(var i,o,s,a,h,l=e[0],c=[l],A=1,f=e.length;A<f;A++)a=void 0,h=void 0,(a=(o=i=e[A]).x-(s=l).x)*a+(h=o.y-s.y)*h>n&&(c.push(i),l=i);return l!==i&&c.push(i),c}(e,s),e=o(e,s)}e.exports=s,e.exports.default=s}()}(af);var hf=Jo(af.exports),lf="not find Geometry' Projection. please add Geometry to Layer and add Layer to Map",uf=function(e){function n(){return e.apply(this,arguments)||this}kt(n,e);var i=n.prototype;return i.animateShow=function(e={},n){var i=this;this._showPlayer&&this._showPlayer.finish(),d(e)&&(n=e={});var o=this.getCoordinates();if(0!==o.length){this._animIdx=0,this._animLenSoFar=0,this.show();var s=!!this.getShell?this.getShell().concat(this.getShell()[0]):o,a=this._getProjection();if(a){var h=a.projectCoords(s,this.options.antiMeridian);this._prjAniShowCenter=this._getPrjExtent().getCenter(),this._aniShowCenter=a.unproject(this._prjAniShowCenter);var l=e.duration||1e3,c=e.easing||"out";this.setCoordinates([]);var A=0;h.length&&(h[0]._distance=0);for(var f=1;f<h.length;f++){var p=h[f].distanceTo(h[f-1]);h[f]._distance=p,A+=p}this._tempCoord=new Zh(0,0),this._tempPrjCoord=new ee(0,0);var g=this._showPlayer=rf.animate({t:l},{duration:l,easing:c},(function(e){if(i.getMap()){var a=i._drawAnimShowFrame(e.styles.t,l,A,s,h);"finished"===e.state.playState&&(delete i._showPlayer,delete i._aniShowCenter,delete i._prjAniShowCenter,delete i._animIdx,delete i._animLenSoFar,delete i._animTailRatio,delete i._tempCoord,delete i._tempPrjCoord,i.setCoordinates(o)),n&&n(e,a)}else if("finished"!==g.playState&&(g.finish(),n)){var c=i.getCoordinates();n(e,c[c.length-1])}}),this);return g.play(),g}console.error(lf)}},i._drawAnimShowFrame=function(e,n,i,o,s){if(0===e)return o[0];var a,h,l=e/n*i,c=0;for(a=this._animIdx+1,h=s.length;a<h&&!(this._animLenSoFar+(c=s[a]._distance)>l);a++)this._animLenSoFar+=c;if(this._animIdx=a-1,this._animIdx>=h-1)return this.setCoordinates(o),o[o.length-1];var A=this._animIdx,f=s[A],d=s[A+1],p=(l-this._animLenSoFar)/c;this._animTailRatio=p;var g=f.y+(d.y-f.y)*p;this._tempPrjCoord.x=f.x+(d.x-f.x)*p,this._tempPrjCoord.y=g;var v=this._tempPrjCoord,w=o[A],C=o[A+1],P=w.y+(C.y-w.y)*p;this._tempCoord.x=w.x+(C.x-w.x)*p,this._tempCoord.y=P;var T=this._tempCoord,S=!!this.getShell;if(!S&&this.options.smoothness>0){for(var I=[],E=[],O=0;O<=this._animIdx;O++)I.push(o[O]),E.push(s[O]);I.push(T,T),E.push(v,v),this.setCoordinates(I),this._setPrjCoordinates(E)}else{var k=o.slice(0,this._animIdx+1);k.push(T);var L=s.slice(0,this._animIdx+1);L.push(v),S?(this.setCoordinates([this._aniShowCenter].concat(k)),this._setPrjCoordinates([this._prjAniShowCenter].concat(L))):(this.setCoordinates(k),this._setPrjCoordinates(L))}return T},i._getCenterInExtent=function(e,n,i){var o=this.getExtent();if(!e.intersects(o))return null;var s=i(n,e);if(0===s.length)return null;var[a,h,l]=[0,0,0];s.forEach((function(e){Array.isArray(e)?e.forEach((function(e){e.point&&(e=e.point),a+=e.x,h+=e.y,l++})):(e.point&&(e=e.point),a+=e.x,h+=e.y,l++)}));var c=new Zh(a,h)._multi(1/l);return c.count=l,c},i._getPath2DPoints=function(e,n,i){if(!xe(e))return[];var o=this.getMap(),s=!n&&this._shouldSimplify(),a=this.options.simplifyTolerance*o._getResolution(),h=Array.isArray(e[0]);if(delete this._simplified,s&&!h){var l=e.length;e=hf(e,a,!1),this._simplified=e.length<l}if(i||(i=o._getResolution()),Array.isArray(e)){var c=[],A="_glPt";if(!Array.isArray(e[0]))return c=on(e,A),o._prjsToPointsAtRes(e,i,c);for(var f=[],d=0,p=e.length;d<p;d++){var g=e[d];c=on(g,A);var v=o._prjsToPointsAtRes(g,i,c);f.push(v)}return f}return o._prjToPointAtRes(e,i)},i._shouldSimplify=function(){var e=this.getLayer();return e&&e.options.enableSimplify&&!e.options.enableAltitude&&this.options.enableSimplify&&!this._showPlayer},i._setPrjCoordinates=function(e){this._prjCoords=e,this.onShapeChanged()},i._getPrjCoordinates=function(){return this._verifyProjection(),!this._prjCoords&&this._getProjection()&&(this._prjCoords=this._projectCoords(this._coordinates)),this._prjCoords},i._updateCache=function(){this._clearCache(),this._getProjection()&&this._prjCoords&&(this._coordinates=this._unprojectCoords(this._getPrjCoordinates()))},i._clearProjection=function(){this._prjCoords=null,e.prototype._clearProjection.call(this)},i._projectCoords=function(e){var n=this._getProjection();return n?n.projectCoords(e,this.options.antiMeridian):[]},i._unprojectCoords=function(e){var n=this._getProjection();return n?n.unprojectCoords(e):[]},i._computeCenter=function(){var e=this._coordinates;if(!xe(e))return null;for(var n=0,i=0,o=0,s=e.length,a=0;a<s;a++)e[a]&&l(e[a].x)&&l(e[a].y)&&(n+=e[a].x,i+=e[a].y,o++);return new Zh(n/o,i/o)},i._computeExtent=function(e){var n=this._coordinates;if(!xe(n))return null;var i=[n];return this.hasHoles&&this.hasHoles()&&i.push.call(i,...this.getHoles()),this._coords2Extent(i,this._getProjection())},i._computePrjExtent=function(e){var n=[this._getPrjCoordinates()];return this.hasHoles&&this.hasHoles()&&n.push.call(n,...this._getPrjHoles()),this._coords2Extent(n)},i._get2DLength=function(){for(var e=this._getPath2DPoints(this._getPrjCoordinates(),!0),n=0,i=1,o=e.length;i<o;i++)n+=e[i].distanceTo(e[i-1]);return n},i._hitTestTolerance=function(){var n,i=this._getInternalSymbol();if(Array.isArray(i)){n=0;for(var o=0;o<i.length;o++)l(i[o].lineWidth)&&i[o].lineWidth>n&&(n=i[o].lineWidth)}else n=i.lineWidth;return e.prototype._hitTestTolerance.call(this)+(l(n)?n/2:1.5)},i._coords2Extent=function(e,n){if(!e||0===e.length||Array.isArray(e[0])&&0===e[0].length)return null;for(var i=new al(n),o=0,s=e.length;o<s;o++)for(var a=0,h=e[o].length;a<h;a++)i._combine(e[o][a]);return i},n}(_A);uf.mergeOptions({smoothness:!1,enableClip:!0,enableSimplify:!0,simplifyTolerance:2,symbol:{lineColor:"#000",lineWidth:2,lineOpacity:1,polygonFill:"#fff",polygonOpacity:1,opacity:1}});var cf="Polygon",Af=function(e){function n(n,i){var o;return(o=e.call(this,i)||this).type="Polygon",n&&o.setCoordinates(n),o}kt(n,e);var i=n.prototype;return i.getOutline=function(){return this._getPainter()?new n(this.getExtent().toArray(),{symbol:{lineWidth:1,lineColor:"6b707b"}}):null},i.setCoordinates=function(e){if(!e)return this._coordinates=null,this._holes=null,this._projectRings(),this;var n=Zh.toCoordinates(e),i=n.length;if(Array.isArray(n[0]))if(this._coordinates=this._trimRing(n[0]),i>1){for(var o=[],s=1;s<i;s++)n[s]&&o.push(this._trimRing(n[s]));this._holes=o}else this._holes=null;else this._coordinates=this._trimRing(n);return this._projectRings(),this},i.getCoordinates=function(){if(!this._coordinates)return[];for(var e=this.getHoles(),n=[this._copyAndCloseRing(this._coordinates)],i=0,o=e.length;i<o;i++)n.push(this._copyAndCloseRing(e[i]));return n},i.getCenterInExtent=function(e){return this._getCenterInExtent(e,this.getShell(),Qu)},i.getShell=function(){return this._coordinates||[]},i.getHoles=function(){return this._holes||[]},i.hasHoles=function(){return this.getHoles().length>0},i._projectRings=function(){this.getMap()?(this._prjCoords=this._projectCoords(this._coordinates),this._prjHoles=this._projectCoords(this._holes),this.onShapeChanged()):this.onShapeChanged()},i._setPrjCoordinates=function(e){this._prjCoords=e,this.onShapeChanged()},i._cleanRing=function(e){for(var n=e.length-1;n>=0;n--)e[n]||e.splice(n,1)},i._checkRing=function(e){if(this._cleanRing(e),!e||!xe(e))return!1;var n=e[e.length-1],i=!0;return e[0].x===n.x&&e[0].y===n.y||(i=!1),i},i._trimRing=function(e){var n=this._checkRing(e);return xe(e)&&n&&e.splice(e.length-1,1),e},i._copyAndCloseRing=function(e){e=e.slice(0);var n=this._checkRing(e);return xe(e)&&!n?(e.push(e[0].copy()),e):e},i._getPrjShell=function(){return this.getJSONType()===cf?this._getPrjCoordinates():(this._verifyProjection(),this._getProjection()&&!this._prjShell&&(this._prjShell=this._projectCoords(this._getShell?this._getShell():this.getShell())),this._prjShell)},i._getPrjHoles=function(){var e=this._getProjection();return this._verifyProjection(),e&&!this._prjHoles&&(this._prjHoles=this._projectCoords(this.getHoles())),this._prjHoles},i._computeGeodesicLength=function(e){var n=this.getCoordinates();if(!xe(n))return 0;for(var i=0,o=0,s=n.length;o<s;o++)i+=e.measureLength(n[o]);return i},i._computeGeodesicArea=function(e){var n=this.getCoordinates();if(!xe(n))return 0;for(var i=e.measureArea(n[0]),o=1,s=n.length;o<s;o++)i-=e.measureArea(n[o]);return i},i._updateCache=function(){e.prototype._updateCache.call(this),this._prjHoles&&(this._holes=this._unprojectCoords(this._getPrjHoles()))},i._clearCache=function(){return delete this._prjShell,e.prototype._clearCache.call(this)},i._clearProjection=function(){this._prjHoles&&(this._prjHoles=null),this._prjShell&&(this._prjShell=null),e.prototype._clearProjection.call(this)},n}(uf);function ff(e){return function(e){function n(){return e.apply(this,arguments)||this}kt(n,e);var i=n.prototype;return i.getCoordinates=function(){return this._coordinates},i.setCoordinates=function(e){var n=e instanceof Zh?e:new Zh(e);if(this._translateRotatePivot(n),this._coordinates=n,!this.getMap())return this._dirtyCoords=!0,this.onPositionChanged(),this;var i=this._getProjection();return this._setPrjCoordinates(i.project(this._coordinates)),this},i._getCenter2DPoint=function(e){var n=this.getMap();if(!n)return null;var i=this._getPrjCoordinates();return i?(e||(e=n._getResolution()),n._prjToPointAtRes(i,e)):null},i._getPrjCoordinates=function(){var e=this._getProjection();return this._verifyProjection(),!this._pcenter&&e&&this._coordinates&&(this._pcenter=e.project(this._coordinates)),this._pcenter},i._setPrjCoordinates=function(e){this._pcenter=e,this.onPositionChanged()},i._updateCache=function(){this._clearCache();var e=this._getProjection();this._pcenter&&e&&(this._coordinates=e.unproject(this._pcenter))},i._clearProjection=function(){this._pcenter=null,e.prototype._clearProjection.call(this)},i._computeCenter=function(){return this._coordinates?this._coordinates.copy():null},n}(e)}Af.registerJSONType(cf);var df=new ll,pf=function(e){function n(n,i){var o;return(o=e.call(this,i)||this).type="Point",o.isPoint=!0,n&&o.setCoordinates(n),o}kt(n,e);var i=n.prototype;return i.getOutline=function(){var e=this.getCoordinates(),i=this.getContainerExtent(),o=this.getMap().coordToContainerPoint(e);return new n(e,{symbol:{markerType:"square",markerWidth:i.getWidth(),markerHeight:i.getHeight(),markerLineWidth:1,markerLineColor:"6b707b",markerFill:"rgba(0, 0, 0, 0)",markerDx:i.xmin-(o.x-i.getWidth()/2),markerDy:i.ymin-(o.y-i.getHeight()/2)}})},i.setSymbol=function(n){return delete this._fixedExtent,e.prototype.setSymbol.call(this,n)},i._getSizeSymbol=function(e){for(var n,i={},o=!1,s=!1,a=0;a<Gu.length;a++){var l=e[Gu[a]];h(l)||(!o&&Hr(l)&&(o=!0,s=!0),i[Gu[a]]=l)}for(var c=0;c<Vu.length;c++){var A=e[Vu[c]];h(A)||(!o&&Hr(A)&&(o=!0),i[Vu[c]]=A)}return o?(n=fo(i,this),s&&(n._dynamic=!0)):n=i,n},i._setExternSymbol=function(n){return this._symbol||delete this._fixedExtent,e.prototype._setExternSymbol.call(this,n)},i._isDynamicSize=function(){return this._sizeSymbol&&this._sizeSymbol._dynamic},i._getFixedExtent=function(){if(this._fixedExtent&&!this._isDynamicSize())return this._fixedExtent;this._fixedExtent=this._fixedExtent||new ll,this._fixedExtent.set(null,null,null,null);var e=this._sizeSymbol;if(!e)return this._fixedExtent;var n=this.getLayer()&&this.getLayer().getRenderer(),i=n&&n.resources,o=this.getTextDesc();if(Array.isArray(e)){df.set(1/0,1/0,-1/0,-1/0);for(var s=0;s<e.length;s++)e[s]&&this._fixedExtent._combine(Nu(df,e[s],i,o&&o[s]))}else this._fixedExtent=Nu(this._fixedExtent,e,i,o);return this._fixedExtent},i._isVectorMarker=function(){var e=this._getInternalSymbol();return!Array.isArray(e)&&Hu(e)},i._canEdit=function(){var e=this._getInternalSymbol();return!Array.isArray(e)&&(Hu(e)||ju(e)||Bu(e))},i._containsPoint=function(n,i){var o=this.getContainerExtent();return i&&(o=o.expand(i)),!!o.contains(n)&&(!this.options.hitTestForEvent||e.prototype._containsPoint.call(this,n,i))},i._computeExtent=function(){return gf.call(this,"getCenter")},i._computePrjExtent=function(){return gf.call(this,"_getPrjCoordinates")},i._computeGeodesicLength=function(){return 0},i._computeGeodesicArea=function(){return 0},i._getSprite=function(e,n){return this._getPainter()?this._getPainter().getSprite(e,n):new Qc(this).getSprite(e,n)},n}(ff(_A));function gf(e){var n=this[e]();return n?new al(n,n,this._getProjection()):null}pf.mergeOptions({symbol:{markerType:"path",markerPath:[{path:"M8 23l0 0 0 0 0 0 0 0 0 0c-4,-5 -8,-10 -8,-14 0,-5 4,-9 8,-9l0 0 0 0c4,0 8,4 8,9 0,4 -4,9 -8,14z M3,9 a5,5 0,1,0,0,-0.9Z",fill:"#DE3333"}],markerPathWidth:16,markerPathHeight:23,markerWidth:24,markerHeight:34},hitTestForEvent:!1,collision:!0}),pf.registerJSONType("Marker");var mf=function(e){function n(n,i){var o;return(o=e.call(this,i)||this).type="LineString",n&&o.setCoordinates(n),o}kt(n,e);var i=n.prototype;return i.getOutline=function(){return Af.prototype.getOutline.call(this)},i.setCoordinates=function(e){return e?(this._coordinates=Zh.toCoordinates(e),this.getMap()?this._setPrjCoordinates(this._projectCoords(this._coordinates)):this.onShapeChanged(),this):(this._coordinates=null,this._setPrjCoordinates(null),this)},i.getCoordinates=function(){return this._coordinates||[]},i.getCenterInExtent=function(e){return this._getCenterInExtent(e,this.getCoordinates(),qu)},i._computeGeodesicLength=function(e){return e.measureLength(this.getCoordinates())},i._computeGeodesicArea=function(){return 0},n}(uf);mf.mergeOptions({arrowStyle:null,arrowPlacement:"vertex-last"}),mf.registerJSONType("LineString");var yf=new ll,_f=function(e){function n(n,i){var o;return(o=e.call(this,i)||this).type="GeometryCollection",o.setGeometries(n),o}kt(n,e);var i=n.prototype;return i.getContainerExtent=function(e){var n=e||new ll;return this.forEach((function(e){n._combine(e.getContainerExtent(yf))})),n},i.setGeometries=function(e){for(var n=this._checkGeometries(e||[]),i=this._getSymbol(),o=this.config(),s=this.getProperties(),a=n.length-1;a>=0;a--)n[a]._initOptions(o),n[a]._setParent(this),n[a]._setEventParent(this),i&&n[a].setSymbol(i),s&&n[a].setProperties(s);return this._geometries=n,this.getLayer()&&(this._bindGeometriesToLayer(),this.onShapeChanged()),this},i.getGeometries=function(){return this._geometries||[]},i.forEach=function(e,n){for(var i=this.getGeometries(),o=0,s=i.length;o<s;o++)i[o]&&(n?e.call(n,i[o],o):e(i[o],o));return this},i.filter=function(e,i){if(!e)return new n;var o=[],s=d(e),a=s?e:Qr(e);return this.forEach((function(e){var n=s?e:ao(e);(i?a.call(i,n):a(n))&&o.push(e)}),this),new n(o)},i.translate=function(e){if(!e)return this;if(this.isEmpty())return this;var n=arguments;return this.forEach((function(e){e&&e.translate&&e.translate.apply(e,n)})),this},i.isEmpty=function(){return!xe(this.getGeometries())},i.remove=function(){return this.forEach((function(e){e._unbind()})),_A.prototype.remove.apply(this,arguments)},i.show=function(){return this.options.visible=!0,this.forEach((function(e){e.show()})),this},i.hide=function(){return this.options.visible=!1,this.forEach((function(e){e.hide()})),this},i.onConfig=function(e){this.forEach((function(n){n.config(e)}))},i.getSymbol=function(){var n=e.prototype.getSymbol.call(this);if(!n){var i=[],o=!1;this.forEach((function(e){e.getSymbol()&&!o&&(o=!0),i.push(e.getSymbol())})),o&&(n={children:i})}return n},i.setSymbol=function(e){var n=this;if(e&&e.children)this._symbol=null,this.forEach((function(i,o){i._eventSymbolProperties=n._eventSymbolProperties,i.setSymbol(e.children[o])}));else{var i=this._prepareSymbol(e);this._symbol=i,this.forEach((function(e){e._eventSymbolProperties=n._eventSymbolProperties,e.setSymbol(i)}))}return this.onSymbolChanged(),this},i._setExternSymbol=function(e){return e=this._prepareSymbol(e),this._externSymbol=e,this.forEach((function(n){n._setExternSymbol(e)})),this.onSymbolChanged(),this},i._bindLayer=function(){e.prototype._bindLayer.apply(this,arguments),this._bindGeometriesToLayer()},i._bindGeometriesToLayer=function(){var e=this.getLayer();this.forEach((function(n){n._bindLayer(e)}))},i._checkGeometries=function(e){for(var n=[],i=0,s=(e=Array.isArray(e)?e:[e]).length;i<s;i++){var a=e[i];a&&(this._checkGeo(a)?a instanceof _f?o.isTest||console.error(a," is GeometryCollection sub class,it Cannot be placed in GeometryCollection"):n.push(a):console.error("The geometry added to collection is invalid. Index: "+i))}return n},i._checkGeo=function(e){return e instanceof _A},i._updateCache=function(){this._clearCache(),this.isEmpty()||this.forEach((function(e){e&&e._updateCache&&e._updateCache()}))},i._removePainter=function(){this._painter&&this._painter.remove(),delete this._painter,this.forEach((function(e){e._removePainter()}))},i._computeCenter=function(e){if(!e||this.isEmpty())return null;for(var n=0,i=0,o=0,s=this.getGeometries(),a=0,h=s.length;a<h;a++)if(s[a]){var l=s[a]._computeCenter(e);l&&(n+=l.x,i+=l.y,o++)}return 0===o?null:new Zh(n/o,i/o)},i._containsPoint=function(e,n){if(this.isEmpty())return!1;delete this._pickGeometryIndex;for(var i=this.getGeometries(),o=0,s=i.length;o<s;o++)if(i[o]._containsPoint(e,n))return this._pickGeometryIndex=o,!0;return!1},i._hitTestTolerance=function(){for(var e=this.getGeometries(),n=0,i=0,o=e.length;i<o;i++){var s=e[i]._hitTestTolerance();n=Math.max(n,s)}return n},i._computeExtent=function(e){return xf.call(this,e,"_computeExtent")},i._computePrjExtent=function(e){return xf.call(this,e,"_computePrjExtent")},i._computeGeodesicLength=function(e){if(!e||this.isEmpty())return 0;for(var n=this.getGeometries(),i=0,o=0,s=n.length;o<s;o++)n[o]&&(i+=n[o]._computeGeodesicLength(e));return i},i._computeGeodesicArea=function(e){if(!e||this.isEmpty())return 0;for(var n=this.getGeometries(),i=0,o=0,s=n.length;o<s;o++)n[o]&&(i+=n[o]._computeGeodesicArea(e));return i},i._exportGeoJSONGeometry=function(){var e=[];if(!this.isEmpty())for(var n=this.getGeometries(),i=0,o=n.length;i<o;i++)n[i]&&e.push(n[i]._exportGeoJSONGeometry());return{type:"GeometryCollection",geometries:e}},i._toJSON=function(e){e=a({},e);var n,i={type:"Feature",geometry:{type:"GeometryCollection",geometries:this.getGeometries().filter((function(e){return e&&e._toJSON})).map((function(e){var n=e._toJSON();return n.subType?n:e._exportGeoJSONGeometry()}))}},o=this.getId();return h(o)||(i.id=o),(h(e.properties)||e.properties)&&(n=this._exportProperties()),i.properties=n,e.feature=i,e},i._clearProjection=function(){if(!this.isEmpty())for(var e=this.getGeometries(),n=0,i=e.length;n<i;n++)e[n]&&e[n]._clearProjection()},i._getConnectPoints=function(){var e=this.getExtent();return[new Zh(e.xmin,e.ymax),new Zh(e.xmax,e.ymin),new Zh(e.xmin,e.ymin),new Zh(e.xmax,e.ymax)]},i._getExternalResources=function(){if(this.isEmpty())return[];for(var e,n,i=this.getGeometries(),o=[],s={},a=0,h=i.length;a<h;a++)if(i[a])for(var l=0,c=(e=vo(i[a]._getInternalSymbol())).length;l<c;l++)s[n=e[l].join()]||(o.push(e[l]),s[n]=1);return o},i.startEdit=function(e){var n=this;if(this.isEmpty())return this;e||(e={}),e.symbol&&(this._originalSymbol=this.getSymbol(),this.setSymbol(e.symbol)),this._draggbleBeforeEdit=this.options.draggable,this.config("draggable",!1),this._recordVisible();for(var i=this.getGeometries(),o=0,s=i.length;o<s;o++)i[o].startEdit(e);this._editing=!0;var a=this.getLayer();return a&&"canvas"===a.options.renderer&&this.hide(),setTimeout((function(){n.fire("editstart")}),1),this},i.endEdit=function(){if(this.isEmpty())return this;this._recoveryVisible();for(var e=this.getGeometries(),n=0,i=e.length;n<i;n++)e[n].endEdit();return this._originalSymbol&&(this.setSymbol(this._originalSymbol),delete this._originalSymbol),this._editing=!1,this.show(),this.config("draggable",this._draggbleBeforeEdit),this.fire("editend"),this},i.isEditing=function(){return!!this._editing},n}(_A);function xf(e,n){if(this.isEmpty())return null;for(var i=new al,o=this.getGeometries(),s=0,a=o.length;s<a;s++)if(o[s]){var h=o[s][n](e);h&&i._combine(h)}return i}_f.registerJSONType("GeometryCollection");var wf=function(e){function n(n,i,o,s){var a;return(a=e.call(this,null,s)||this).GeometryType=n,a.type=i,a._initData(o),a}kt(n,e);var i=n.prototype;return i.getCoordinates=function(){for(var e=[],n=this.getGeometries(),i=0,o=n.length;i<o;i++){var s=n[i];e.push(s.getShell&&"Polygon"!==s.getJSONType()?[s.getShell()]:s.getCoordinates())}return e},i.setCoordinates=function(e){for(var n=[],i=0,o=(e=e||[]).length;i<o;i++){var s=new this.GeometryType(e[i],this.config());n.push(s)}return this.setGeometries(n),this},i._initData=function(e){(e=e||[]).length&&(e[0]instanceof this.GeometryType?this.setGeometries(e):this.setCoordinates(e))},i._checkGeo=function(e){return e instanceof this.GeometryType},i._exportGeoJSONGeometry=function(){var e=this.getCoordinates(),n=Zh.toNumberArrays(e);return{type:this.getType(),coordinates:n}},i._toJSON=function(e){return{feature:this.toGeoJSON(e)}},n}(_f),Cf=function(e){function n(n,i){return e.call(this,pf,"MultiPoint",n,i)||this}return kt(n,e),n.prototype.findClosest=function(e){if(!e)return null;var n=this.getCoordinates(),i=null,o=1/0;return n.forEach((function(n){var s=function(e,n){var i=n.x-e.x,o=n.y-e.y;return Math.sqrt(i*i+o*o)}(n,e);s<o&&(i=n,o=s)})),i},n}(wf);Cf.registerJSONType("MultiPoint");var Pf=function(e){function n(){return e.apply(this,arguments)||this}return kt(n,e),n.prototype.getCenterInExtent=function(e){var n=this.getGeometries(),[i,o,s]=[0,0,0];return n.forEach((function(n){var a=n.getCenterInExtent(e);a&&(i+=a.x*a.count,o+=a.y*a.count,s+=a.count)})),0===s?null:new Zh(i,o)._multi(1/s)},n}(wf),Mf=function(e){function n(n,i){return e.call(this,mf,"MultiLineString",n,i)||this}return kt(n,e),n}(Pf);Mf.registerJSONType("MultiLineString");var Tf=function(e){function n(n,i){return e.call(this,Af,"MultiPolygon",n,i)||this}return kt(n,e),n}(Pf);Tf.registerJSONType("MultiPolygon");var Sf,If={Marker:pf,LineString:mf,Polygon:Af,MultiPoint:Cf,MultiLineString:Mf,MultiPolygon:Tf},Ef="geojson-fetch-worker-page-async",Of=function(e){function n(){return e.call(this,Ef)||this}kt(n,e);var i=n.prototype;return i._sendMsg=function(e,n,i){var o=this;this.send(e,[],(function(s,a){s?i(s):o._pageFeatures(e,a,n,i)}),e.workerId)},i._fetchGeoJSON=function(e,n,i=[],o){var s=a({},n);s.type="fetchdata",s.url=e,this._sendMsg(s,i,o)},i._pageFeatures=function(e,n,i,o){if(i.push(n),0!==n.length){var s=a({},e);s.type="pagefeatures",this._sendMsg(s,i,o)}else o(null,i)},n}(Au);na(Ef,(function(){return"\nfunction (exports) {\n    const resultMap = {};\n\n    function handleResult(msg, postResponse) {\n        const data = msg.data || {};\n        const { taskId } = data;\n        const features = resultMap[taskId];\n        if (!features) {\n            postResponse('not find geojson dataset the taskId:' + taskId);\n            return;\n        }\n        if (features.length === 0) {\n            delete resultMap[taskId];\n            postResponse(null, []);\n            return;\n        }\n        const pageSize = data.pageSize || 2000;\n        const pageFeatures = features.slice(0, pageSize);\n        resultMap[taskId] = features.slice(pageSize, Infinity);\n        postResponse(null, pageFeatures);\n    }\n    //worker init\n    exports.initialize = function () {\n        // console.log(\"geojson fetch init\");\n    };\n    //recive message\n    exports.onmessage = function (msg, postResponse) {\n        const { taskId, type, url } = msg.data || {};\n        if (!taskId) {\n            postResponse('not find task id for get geojson dataset,taskId=' + taskId);\n            return;\n        }\n        if (type === 'fetchdata') {\n            if (!url) {\n                postResponse('url is null,url=' + url);\n                return;\n            }\n            fetch(url).then(res => res.json()).then(geojson => {\n                let features;\n                if (Array.isArray(geojson)) {\n                    features = geojson;\n                } else if (geojson.features) {\n                    features = geojson.features;\n                } else {\n                    features = [geojson];\n                }\n                resultMap[taskId] = features;\n                handleResult(msg, postResponse);\n            }).catch(errror => {\n                postResponse(errror.message);\n            });\n        } else if (type === 'pagefeatures') {\n            handleResult(msg, postResponse);\n        } else {\n            postResponse('not support task type:' + type);\n        }\n    };\n}"}));var Rf={toGeometry:function(e,n){if(f(e)&&(e=ae(e)),Array.isArray(e)){for(var i=[],o=0,s=e.length;o<s;o++){var a=Rf._convert(e[o],n);Array.isArray(a)?he(i,a):i.push(a)}return i}return Rf._convert(e,n)},toGeometryAsync:function(e,n,i=2e3){return f(e)&&(e=ae(e)),new Promise((function(o){var s=[];if(e&&(Array.isArray(e)||Array.isArray(e.features))){var a=l(i)?Math.round(i):2e3,h=e.features||e,c=Math.ceil(h.length/a),A=1;ma({count:c,run:function(){var e=h.slice((A-1)*a,A*a),i=Rf.toGeometry(e,n);return A++,i}}).then((function(e){for(var n=0,i=e.length;n<i;n++){var a=e[n];a&&(Array.isArray(a)?he(s,a):s.push(a))}o(s)}))}else{var f=Rf.toGeometry(e,n);o(f)}}))},_convert:function(e,n){if(!e||h(e.type))return null;var i=e.type;if("Feature"===i){var o=Rf._convert(e.geometry);return o?(o.setId(e.id),o.setProperties(e.properties),n&&n(o),o):null}if("FeatureCollection"===i){var s=e.features;return s?Rf.toGeometry(s,n):null}if(["Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon"].indexOf(i)>=0){var a=new If["Point"===i?"Marker":i](e.coordinates);return n&&n(a),a}if("GeometryCollection"===i){var l=e.geometries;if(!xe(l)){var c=new _f;return n&&n(c),c}for(var A=[],f=l.length,d=0;d<f;d++)A.push(l[d].subType?_A.getJSONClass(l[d].subType).fromJSON(l[d]):Rf._convert(l[d]));var p=new _f(A);return n&&n(p),p}return null},_isGeoJSON:function(e){if(!e)return!1;if(e=e||{},Array.isArray(e)&&e.length)return Rf.isGeoJSON(e[0]);var n=e.type;if(!n)return!1;if(-1===mn.indexOf(n))return!1;var{features:i,geometries:o,geometry:s,coordinates:a}=e;if(a&&Array.isArray(a))return!0;if(Array.isArray(o))return!0;if(Array.isArray(i))return!0;if(s){var h=s.coordinates;if(h&&Array.isArray(h))return!0}return!1},fetch:function(e,n=2e3){return new Promise((function(i,o){if(e&&f(e)){var s=a({pageSize:2e3},{pageSize:n});e=an(e),Sf||(Sf=new Of);var h=Sf.workers.length,l=Math.floor(Math.random()*h);l=Math.min(h-1,l),s.workerId=l,s.taskId=se(),Sf._fetchGeoJSON(e,s,[],(function(e,n){if(e)o(e);else{var s=[];n.forEach((function(e){for(var n=0,i=e.length;n<i;n++)s.push(e[n])})),i({type:"FeatureCollection",features:s})}}))}else o("url is error,It should be string")}))}},Df=function(e){function n(n,i,o){var s;return s=e.call(this,null,o)||this,n&&s.setCoordinates(n),s._radius=i,s}kt(n,e),n.fromJSON=function(e){var i=e.feature,o=new n(e.coordinates,e.radius,e.options);return o.setProperties(i.properties),o};var i=n.prototype;return i.getRadius=function(){return this._radius},i.setRadius=function(e){return this._radius=e,this.onShapeChanged(),this},i.getShell=function(){for(var e,n,i,o=this._getMeasurer(),s=this.getCoordinates(),a=this.options.numberOfShellPoints,h=this.getRadius(),l=[],c=0,A=a-1;c<A;c++){e=360*c/A*Math.PI/180,n=h*Math.cos(e),i=h*Math.sin(e);var f=o.locate(s,n,i);f.z=s.z,l.push(f)}return l.push(l[0]),l},i.getHoles=function(){return[]},i.animateShow=function(){return this.show()},i._containsPoint=function(n,i){var o=this.getMap();if(o.getPitch())return e.prototype._containsPoint.call(this,n,i);var s=o._pointToContainerPoint(this._getCenter2DPoint()),a=this.getSize(),h=this._hitTestTolerance()+(i||0),l=s.add(a.width/2,a.height/2);return Ju(n,s,l,h)},i._computePrjExtent=function(e){var n=this._getMinMax(e);if(!n)return null;var i=this._getPrjCoordinates(),o=n.map((function(n){return e.project(n)})),s=o[1].x-i.x,a=o[3].y-i.y;return new al(i.add(o[0].x-i.x,o[2].y-i.y),i.add(s,a))},i._computeExtent=function(e){var n=this._getMinMax(e);return n?new al(n[0].x,n[2].y,n[1].x,n[3].y,this._getProjection()):null},i._getMinMax=function(e){if(!e||!this._coordinates||h(this._radius))return null;var n=this._radius;return[e.locate(this._coordinates,-n,0),e.locate(this._coordinates,n,0),e.locate(this._coordinates,0,n),e.locate(this._coordinates,0,-n)]},i._computeGeodesicLength=function(){return h(this._radius)?0:2*Math.PI*this._radius},i._computeGeodesicArea=function(){return h(this._radius)?0:Math.PI*Math.pow(this._radius,2)},i._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:Zh.toNumberArrays([this.getShell()])}},i._toJSON=function(e){var n=this.getCenter(),i=a({},e);i.geometry=!1;var o=this.toGeoJSON(i);return o.geometry={type:"Polygon"},{feature:o,subType:"Circle",coordinates:n.toArray(),radius:this.getRadius()}},n}(ff(Af));function kf(e){return e*e*e*e}Df.mergeOptions({numberOfShellPoints:60}),Df.registerJSONType("Circle");var Lf=function(e){function n(n,i,o,s){var a;return a=e.call(this,null,s)||this,n&&a.setCoordinates(n),a.width=i,a.height=o,a}kt(n,e),n.fromJSON=function(e){var i=e.feature,o=new n(e.coordinates,e.width,e.height,e.options);return o.setProperties(i.properties),o};var i=n.prototype;return i.getWidth=function(){return this.width},i.setWidth=function(e){return this.width=e,this.onShapeChanged(),this},i.getHeight=function(){return this.height},i.setHeight=function(e){return this.height=e,this.onShapeChanged(),this},i.getShell=function(){return this.isRotated()?this.getRotatedShell():this._getShell()},i._getShell=function(){var e,n,i,o,s=this._getMeasurer(),a=this.getCoordinates(),h=this.options.numberOfShellPoints-1,l=this.getWidth(),c=this.getHeight(),A=[],f=Math.pow(l/2,2)*Math.pow(c/2,2),d=Math.pow(l/2,2),p=Math.pow(c/2,2),g=[];if(Math.max(l/c,c/l)>2){var{fs:v,sum:w}=function(e){for(var n=[],i=[],o=0;o<e;o++)i.push(kf(o/e));var s=i.map((function(e){return e})).reverse(),a=[];he(a,i,s,i,s);for(var h=0,l=0,c=a.length;l<c;l+=4)n.push(a[l]),h+=a[l];return{fs:n,sum:h}}(h),C=360/w,P=0;c>l&&(P=90);for(var T=0,S=0,I=v.length;S<I;S++)g.push((T+=C*v[S])+P)}else for(var E=0;E<h;E++){g.push(360*E/h)}this.options.debug&&console.log(g);for(var O=0;O<g.length;O++){n=(e=g[O])*Math.PI/180,i=Math.sqrt(f/(d*Math.pow(Math.tan(n),2)+p)),o=Math.sqrt(f/(p*Math.pow(1/Math.tan(n),2)+d)),e>90&&e<270&&(i*=-1),e>180&&e<360&&(o*=-1);var k=s.locate(a,i,o);k.z=a.z,A.push(k)}return A.push(A[0].copy()),A},i._getPrjShell=function(){var n=e.prototype._getPrjShell.call(this);return this._rotatePrjCoordinates(n)},i.getHoles=function(){return[]},i.animateShow=function(){return this.show()},i._containsPoint=function(n,i){var o=this.getMap();if(o.isTransforming())return e.prototype._containsPoint.call(this,n,i);var s=o.getProjection(),a=this._hitTestTolerance()+(i||0),h=s.projectCoords([this._coordinates,o.locate(this._coordinates,this.getWidth()/2,this.getHeight()/2)],this.options.antiMeridian);return Ju(n,o.prjToContainerPoint(h[0]),o.prjToContainerPoint(h[1]),a)},i._computePrjExtent=function(){return this.isRotated()?this._computeRotatedPrjExtent():Df.prototype._computePrjExtent.apply(this,arguments)},i._computeExtent=function(){return Df.prototype._computeExtent.apply(this,arguments)},i._getMinMax=function(e){if(!e||!this._coordinates||h(this.width)||h(this.height))return null;var n=this.getWidth(),i=this.getHeight();return[e.locate(this._coordinates,-n/2,0),e.locate(this._coordinates,n/2,0),e.locate(this._coordinates,0,-i/2),e.locate(this._coordinates,0,i/2)]},i._computeGeodesicLength=function(){return h(this.width)||h(this.height)?0:2*Math.PI*(this.width>this.height?this.width:this.height)/2-4*Math.abs(this.width-this.height)},i._computeGeodesicArea=function(){return h(this.width)||h(this.height)?0:Math.PI*this.width*this.height/4},i._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:Zh.toNumberArrays([this.getShell()])}},i._toJSON=function(e){var n=a({},e),i=this.getCenter();n.geometry=!1;var o=this.toGeoJSON(n);return o.geometry={type:"Polygon"},{feature:o,subType:"Ellipse",coordinates:i.toArray(),width:this.getWidth(),height:this.getHeight()}},n}(ff(Af));Lf.mergeOptions({numberOfShellPoints:81}),Lf.registerJSONType("Ellipse");var Ff=function(e){function n(n,i,o,s){var a;return a=e.call(this,null,s)||this,n&&a.setCoordinates(n),a._width=i,a._height=o,a}kt(n,e),n.fromJSON=function(e){var i=e.feature,o=new n(e.coordinates,e.width,e.height,e.options);return o.setProperties(i.properties),o};var i=n.prototype;return i.getCoordinates=function(){return this._coordinates},i.setCoordinates=function(e){var n=e instanceof Zh?e:new Zh(e);if(this._translateRotatePivot(n),this._coordinates=n,!this._coordinates||!this.getMap())return this.onPositionChanged(),this;var i=this._getProjection();return this._setPrjCoordinates(i.project(this._coordinates)),this},i.getWidth=function(){return this._width},i.setWidth=function(e){return this._width=e,this.onShapeChanged(),this},i.getHeight=function(){return this._height},i.setHeight=function(e){return this._height=e,this.onShapeChanged(),this},i.getShell=function(){return this.isRotated()?this.getRotatedShell():this._getShell()},i._getShell=function(){var e=this._getMeasurer(),n=this._coordinates,i=this.getMap(),o=1,s=-1;if(i){var a=i.getFullExtent();a.left>a.right&&(o=-1),a.bottom>a.top&&(s=1)}var h=[];h.push(n);var l=e.locate(n,o*this._width,0);l.z=n.z,h.push(l);var c=e.locate(n,o*this._width,s*this._height);c.z=n.z,h.push(c);var A=e.locate(n,0,s*this._height);return h.push(A),A.z=n.z,h.push(n),h},i.getHoles=function(){return[]},i.animateShow=function(){return this.show()},i._getPrjCoordinates=function(){var e=this._getProjection();return this._verifyProjection(),!this._pnw&&e&&this._coordinates&&(this._pnw=e.project(this._coordinates)),this._pnw},i._setPrjCoordinates=function(e){this._pnw=e,this.onPositionChanged()},i._getPrjShell=function(){var n=e.prototype._getPrjShell.call(this),i=this._getProjection();if(!i.isSphere())return this._rotatePrjCoordinates(n);for(var o=i.getSphereExtent(),s=o.sx,a=o.sy,h=this._getProjection().getCircum(),l=n[0],c=1,A=n.length;c<A;c++){var f=n[c],d=0,p=0;s*(l.x-f.x)>0&&(d=h.x*s),a*(l.y-f.y)<0&&(p=h.y*a),n[c]._add(d,p)}return this._rotatePrjCoordinates(n)},i._updateCache=function(){this._clearCache();var e=this._getProjection();this._pnw&&e&&(this._coordinates=e.unproject(this._pnw))},i._clearProjection=function(){this._pnw=null,e.prototype._clearProjection.call(this)},i._computeCenter=function(e){return e.locate(this._coordinates,this._width/2,-this._height/2)},i._containsPoint=function(n,i){var o=this.getMap();if(o.isTransforming())return e.prototype._containsPoint.call(this,n,i);var s=h(i)?this._hitTestTolerance():i,a=o._getResolution()*s,l=this._getPrjExtent().expand(a),c=o._containerPointToPrj(n);return l.contains(c)},i._computePrjExtent=function(e){if(this.isRotated())return this._computeRotatedPrjExtent();var n=this._getSouthEast(e);if(!n)return null;var i=e.projectCoords([new Zh(this._coordinates.x,n.y),new Zh(n.x,this._coordinates.y)],this.options.antiMeridian);return new al(i[0],i[1])},i._computeExtent=function(e){var n=this._getSouthEast(e);return n?new al(this._coordinates,n,this._getProjection()):null},i._getSouthEast=function(e){if(!e||!this._coordinates||h(this._width)||h(this._height))return null;var n=this.getWidth(),i=-this.getHeight();if(e.fullExtent){var o=e.fullExtent;n*=o.right>o.left?1:-1,i*=o.top>o.bottom?1:-1}var s=e.locate(this._coordinates,n,0),a=e.locate(this._coordinates,0,i);return s.y=a.y,s},i._computeGeodesicLength=function(){return h(this._width)||h(this._height)?0:2*(this._width+this._height)},i._computeGeodesicArea=function(){return h(this._width)||h(this._height)?0:this._width*this._height},i._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:Zh.toNumberArrays([this.getShell()])}},i._toJSON=function(e){var n=a({},e),i=this.getCoordinates();n.geometry=!1;var o=this.toGeoJSON(n);return o.geometry={type:"Polygon"},{feature:o,subType:"Rectangle",coordinates:i.toArray(),width:this.getWidth(),height:this.getHeight()}},n}(Af);Ff.registerJSONType("Rectangle");var Nf=function(e){function n(n,i,o,s,a){var h;return(h=e.call(this,n,i,a)||this).startAngle=o,h.endAngle=s,h}kt(n,e),n.fromJSON=function(e){var i=e.feature,o=new n(e.coordinates,e.radius,e.startAngle,e.endAngle,e.options);return o.setProperties(i.properties),o};var i=n.prototype;return i.getStartAngle=function(){return this.startAngle},i.setStartAngle=function(e){return this.startAngle=e,this.onShapeChanged(),this},i.getEndAngle=function(){return this.endAngle},i.setEndAngle=function(e){return this.endAngle=e,this.onShapeChanged(),this},i._correctAngles=function(){var e=this.getStartAngle(),n=this.getEndAngle();if(n<e)return console.error("The ending angle should be greater than the starting angle ",e,n),[0,0];return n-e>360?(console.error("The difference between the end angle and the start angle is greater than 360 degrees ",e,n),[0,0]):(e<0&&(e+=360,n+=360),[e,n])},i.getShell=function(){return this.isRotated()?this.getRotatedShell():this._getShell()},i._getShell=function(){for(var e,n,i,[o,s]=this._correctAngles(),a=this._getMeasurer(),h=this.getCoordinates(),l=this.options.numberOfShellPoints-2,c=this.getRadius(),A=[h.copy()],f=s-o,d=0;d<l;d++){e=(f*d/(l-1)+o)*Math.PI/180,n=c*Math.cos(e),i=c*Math.sin(e);var p=a.locate(h,n,i);p.z=h.z,A.push(p)}return A.push(h.copy()),A},i.getRotateOffsetAngle=function(){return 90},i._getPrjShell=function(){var n=e.prototype._getPrjShell.call(this);return this._rotatePrjCoordinates(n)},i._computePrjExtent=function(){return this.isRotated()?this._computeRotatedPrjExtent():Df.prototype._computePrjExtent.apply(this,arguments)},i._containsPoint=function(n,i){var o=this.getMap();if(o.isTransforming())return e.prototype._containsPoint.call(this,n,i);var s=o._pointToContainerPoint(this._getCenter2DPoint()),a=this._hitTestTolerance()+(i||0),h=this.getSize(),l=s,c=n,A=Math.atan2(l.y-c.y,c.x-l.x),f=A<0?360*(A+2*Math.PI)/(2*Math.PI):360*A/(2*Math.PI),[d,p]=this._correctAngles(),g=d%360,v=p%360,w=!1;return w=g>v?!(f>v&&f<g):f>=g&&f<=v,c.distanceTo(l)<=h.width/2+a&&w},i._computeGeodesicLength=function(){if(h(this._radius))return 0;var[e,n]=this._correctAngles();return 2*Math.PI*this._radius*Math.abs(e-n)/360+2*this._radius},i._computeGeodesicArea=function(){if(h(this._radius))return 0;var[e,n]=this._correctAngles();return Math.PI*Math.pow(this._radius,2)*Math.abs(e-n)/360},i._toJSON=function(e){var n=a({},e),i=this.getCenter();n.geometry=!1;var o=this.toGeoJSON(n);return o.geometry={type:"Polygon"},{feature:o,subType:"Sector",coordinates:i.toArray(),radius:this.getRadius(),startAngle:this.getStartAngle(),endAngle:this.getEndAngle()}},n}(Df);Nf.mergeOptions({numberOfShellPoints:60}),Nf.registerJSONType("Sector");var Bf=function(e){function n(){return e.apply(this,arguments)||this}kt(n,e);var i=n.prototype;return i._arc=function(e,n,i){var o=this.options.arcDegree;0===o&&(o=1);for(var s=o*Math.PI/180,a=1,h=n.length;a<h;a++)_h._arcBetween(e,n[a-1],n[a],s),_h._stroke(e,i)},i._quadraticCurve=function(e,n){if(n.length<=2)_h._path(e,n);else{var i,o;for(i=2,o=n.length;i<o;i+=2)e.quadraticCurveTo(n[i-1].x,n[i-1].y,n[i].x,n[i].y);if((i-=1)<o)for(;i<o;i++)e.lineTo(n[i].x,n[i].y)}},i._bezierCurve=function(e,n){if(n.length<=3)_h._path(e,n);else{var i,o;for(i=1,o=n.length;i+2<o;i+=3)e.bezierCurveTo(n[i].x,n[i].y,n[i+1].x,n[i+1].y,n[i+2].x,n[i+2].y);if(i<o)for(;i<o;i++)e.lineTo(n[i].x,n[i].y)}},i._getCurveArrowPoints=function(e,n,i,o,s,a){var h,l=n.length;for(h=a;h<l;h+=a){var c=this._getArrowShape(n[h-1],n[h],i,o,s);c&&e.push(c)}if((h-=a)<l-1)for(h+=1;h<l;h++){var A=this._getArrowShape(n[h-1],n[h],i,o,s);A&&e.push(A)}},n}(mf);Bf.mergeOptions({enableSimplify:!1,enableClip:!1});var Hf=function(e){function n(){return e.apply(this,arguments)||this}kt(n,e);var i=n.prototype;return i._toJSON=function(e){return{feature:this.toGeoJSON(e),subType:"ArcCurve"}},i._paintOn=function(e,n,i){e.beginPath(),this._arc(e,n,i),_h._stroke(e,i),this._paintArrow(e,n,i)},n.fromJSON=function(e){var i=e.feature,o=new n(i.geometry.coordinates,e.options);return o.setProperties(i.properties),o},n}(Bf);Hf.registerJSONType("ArcCurve"),Hf.mergeOptions({arcDegree:90});var jf=function(e){function n(){return e.apply(this,arguments)||this}kt(n,e),n.fromJSON=function(e){var i=e.feature,o=new n(i.geometry.coordinates,e.options);return o.setProperties(i.properties),o};var i=n.prototype;return i._toJSON=function(e){return{feature:this.toGeoJSON(e),subType:"CubicBezierCurve"}},i._paintOn=function(e,n,i){e.beginPath(),e.moveTo(n[0].x,n[0].y),this._bezierCurve(e,n),_h._stroke(e,i),this._paintArrow(e,n,i)},i._getArrowPoints=function(e,n,i,o,s){return this._getCurveArrowPoints(e,n,i,o,s,3)},n}(Bf);jf.registerJSONType("CubicBezierCurve");var Uf=function(e){function n(){return e.apply(this,arguments)||this}kt(n,e),n.fromJSON=function(e){var i=e.feature,o=new n(i.geometry.coordinates,e.options);return o.setProperties(i.properties),o};var i=n.prototype;return i._toJSON=function(e){return{feature:this.toGeoJSON(e),subType:"QuadBezierCurve"}},i._paintOn=function(e,n,i){e.beginPath(),e.moveTo(n[0].x,n[0].y),this._quadraticCurve(e,n,i),_h._stroke(e,i),this._paintArrow(e,n,i)},i._getArrowPoints=function(e,n,i,o,s){return this._getCurveArrowPoints(e,n,i,o,s,2)},n}(Bf);Uf.registerJSONType("QuadBezierCurve");var Gf={textFaceName:"monospace",textSize:12,textLineSpacing:8,textWrapCharacter:"\n",textHorizontalAlignment:"middle",textVerticalAlignment:"middle"},Vf={markerType:"square",markerLineColor:"#000",markerLineWidth:2,markerLineOpacity:1,markerFill:"#fff",markerOpacity:1},Wf=function(e){function n(){return e.apply(this,arguments)||this}kt(n,e);var i=n.prototype;return i.getContent=function(){return this._content},i.setContent=function(e){var n=this._content;return this._content=$n(e),this._refresh(),this._fireEvent("contentchange",{old:n,new:e}),this},i.onAdd=function(){this._refresh()},i.toJSON=function(){var n=e.prototype.toJSON.call(this);return delete n.symbol,n},i.setSymbol=function(n){if(this._refreshing||!n)return e.prototype.setSymbol.call(this,n);var i=this._parseSymbol(n);if(this.setTextStyle){var o=this.getTextStyle()||{};o.symbol=i[0],this.setTextStyle(o)}else this.setTextSymbol&&this.setTextSymbol(i[0]);if(this.setBoxStyle){var s=this.getBoxStyle()||{};s.symbol=i[1],this.setBoxStyle(s)}else this.setBoxSymbol&&this.setBoxSymbol(i[1]);return this},i._parseSymbol=function(e){var n={},i={};for(var o in e)g(e,o)&&(0===o.indexOf("text")?n[o]=e[o]:i[o]=e[o]);return[n,i]},i._getTextSize=function(e){return mi(this._content,e).size},i._getInternalSymbol=function(){return this._symbol},i._getDefaultTextSymbol=function(){return a({},Gf)},i._getDefaultBoxSymbol=function(){return a({},Vf)},i._getDefaultPadding=function(){return[12,8]},n}(pf),Qf=function(e){function n(n,i,o,s,a={}){var l;return(l=e.call(this,i,a)||this)._content=$n(n),l._width=h(o)?100:o,l._height=h(s)?40:s,a.boxSymbol&&l.setBoxSymbol(a.boxSymbol),a.textStyle&&l.setTextStyle(a.textStyle),l._refresh(),l}kt(n,e);var i=n.prototype;return i.getWidth=function(){return this._width},i.setWidth=function(e){return this._width=e,this._refresh(),this},i.getHeight=function(){return this._height},i.setHeight=function(e){return this._height=e,this._refresh(),this},i.getBoxSymbol=function(){return a({},this.options.boxSymbol)},i.setBoxSymbol=function(e){return this.options.boxSymbol=e?a({},e):e,this.getSymbol()&&this._refresh(),this},i.getTextStyle=function(){return this.options.textStyle?a({},this.options.textStyle):null},i.setTextStyle=function(e){return this.options.textStyle=e?a({},e):e,this.getSymbol()&&this._refresh(),this},n.fromJSON=function(e){var i=e.feature,o=new n(e.content,i.geometry.coordinates,e.width,e.height,e.options);return o.setProperties(i.properties),o.setId(i.id),e.symbol&&o.setSymbol(e.symbol),o},i._toJSON=function(e){return{feature:this.toGeoJSON(e),width:this.getWidth(),height:this.getHeight(),subType:"TextBox",content:this._content}},i._refresh=function(){var e,n,i=this.getTextStyle()||{},o=i.padding||[12,8];if(Hr(this._width)){var s=(e=JSON.parse(JSON.stringify(this._width))).stops;if(s)for(var h=0;h<s.length;h++)s[h][1]=s[h][1]-2*o[0]}else e=this._width-2*o[0];if(Hr(this._height)){var l=(n=JSON.parse(JSON.stringify(this._height))).stops;if(l)for(var c=0;c<l.length;c++)l[c][1]=l[c][1]-2*o[1]}else n=this._height-2*o[1];var A=a({},i.symbol||this._getDefaultTextSymbol(),this.options.boxSymbol||this._getDefaultBoxSymbol(),{textName:this._content,markerWidth:this._width,markerHeight:this._height,textHorizontalAlignment:"middle",textVerticalAlignment:"middle",textMaxWidth:e,textMaxHeight:n});i.wrap&&!A.textWrapWidth&&(A.textWrapWidth=e);var f,d=i.horizontalAlignment;if(A.textDx=A.markerDx||0,Hr(this._width)){var p=(f=JSON.parse(JSON.stringify(this._width))).stops;if(p)for(var g=0;g<p.length;g++)p[g][1]=p[g][1]/2-o[0],"left"===d&&(p[g][1]*=-1)}else f=A.markerWidth/2-o[0],"left"===d&&(f*=-1);"left"===d?(A.textHorizontalAlignment="right",A.textDx=f):"right"===d&&(A.textHorizontalAlignment="left",A.textDx=f);var v,w=i.verticalAlignment;if(A.textDy=A.markerDy||0,Hr(this._height)){var C=(v=JSON.parse(JSON.stringify(this._height))).stops;if(C)for(var P=0;P<C.length;P++)C[P][1]=C[P][1]/2-o[1],"top"===w&&(C[P][1]*=-1)}else v=A.markerHeight/2-o[1],"top"===w&&(v*=-1);"top"===w?(A.textVerticalAlignment="bottom",A.textDy=v):"bottom"===w&&(A.textVerticalAlignment="top",A.textDy=v),this._refreshing=!0,this.updateSymbol(A),delete this._refreshing},i.startEdit=function(n){var i=this._getCompiledSymbol();if(Hr(this._width)){var o=i.markerWidth;this._oldWidth=this._width,this.setWidth(o)}if(Hr(this._height)){var s=i.markerHeight;this._oldHeight=this._height,this.setHeight(s)}return e.prototype.startEdit.call(this,n)},i.endEdit=function(){var n=this.getMap(),i=n&&n.getZoom();if(this._oldWidth){for(var o=this._width/Gr(this._oldWidth)(i),s=this._oldWidth.stops,a=0;a<s.length;a++)s[a][1]*=o;this.setWidth(this._oldWidth),delete this._oldWidth}if(this._oldHeight){for(var h=this._height/Gr(this._oldHeight)(i),l=this._oldHeight.stops,c=0;c<l.length;c++)l[c][1]*=h;this.setHeight(this._oldHeight),delete this._oldHeight}return e.prototype.endEdit.call(this)},n}(Wf);Qf.mergeOptions({textStyle:{wrap:!0,padding:[12,8],verticalAlignment:"middle",horizontalAlignment:"middle"},boxSymbol:null}),Qf.registerJSONType("TextBox");var Xf=function(e){function n(n,i,o={}){var s;return s=e.call(this,i,o)||this,o.textSymbol&&s.setTextSymbol(o.textSymbol),o.boxStyle&&s.setBoxStyle(o.boxStyle),s._content=$n(n),s._refresh(),s}kt(n,e);var i=n.prototype;return i.getBoxStyle=function(){return this.options.boxStyle?a({},this.options.boxStyle):null},i.setBoxStyle=function(e){return this.options.boxStyle=e?a({},e):e,this._refresh(),this},i.getTextSymbol=function(){return a({},this._getDefaultTextSymbol(),this.options.textSymbol)},i.setTextSymbol=function(e){return this.options.textSymbol=e?a({},e):e,this._refresh(),this},n.fromJSON=function(e){var i=e.feature,o=new n(e.content,i.geometry.coordinates,e.options);return o.setProperties(i.properties),o.setId(i.id),e.symbol&&o.setSymbol(e.symbol),o},i._canEdit=function(){return!1},i._toJSON=function(e){return{feature:this.toGeoJSON(e),subType:"Label",content:this._content}},i._refresh=function(){var e=a({},this.getTextSymbol(),{textName:this._content}),n=this.getBoxStyle();if(n){a(e,n.symbol);var i=this._getBoxSize(e),o=i[1],s=n.padding||this._getDefaultPadding(),h=i[0];e.markerWidth=h.width,e.markerHeight=h.height;var l=e.textDx||0,c=e.textDy||0,A=ci(o,e.textHorizontalAlignment,e.textVerticalAlignment)._add(l,c),f=n.horizontalAlignment||"middle";e.markerDx=A.x,"left"===f?e.markerDx+=e.markerWidth/2-s[0]:"right"===f?e.markerDx-=e.markerWidth/2-o.width-s[0]:e.markerDx+=o.width/2;var d=n.verticalAlignment||"middle";e.markerDy=A.y,"top"===d?e.markerDy+=e.markerHeight/2-s[1]:"bottom"===d?e.markerDy-=e.markerHeight/2-o.height-s[1]:e.markerDy+=o.height/2}this._refreshing=!0,this.updateSymbol(e),delete this._refreshing},i._getBoxSize=function(e){e.markerType||(e.markerType="square");var n,i,o=this.getBoxStyle(),s=this._getTextSize(e),a=o.padding||this._getDefaultPadding();return n=s.width+2*a[0],i=s.height+2*a[1],o.minWidth&&(!n||n<o.minWidth)&&(n=o.minWidth),o.minHeight&&(!i||i<o.minHeight)&&(i=o.minHeight),[new Cn(n,i),s]},n}(Wf);Xf.mergeOptions({boxStyle:null,textSymbol:null}),Xf.registerJSONType("Label");var Yf=function(e){return function(e){function n(...n){return e.call(this,...n)||this}kt(n,e),n._hasConnectors=function(e){return!h(e.__connectors)&&e.__connectors.length>0},n._getConnectors=function(e){return e.__connectors};var i=n.prototype;return i.getConnectSource=function(){return this._connSource},i.setConnectSource=function(e){var n=this._connTarget;return this.onRemove(),this._connSource=e,this._connTarget=n,this.onAdd(),this},i.getConnectTarget=function(){return this._connTarget},i.setConnectTarget=function(e){var n=this._connSource;return this.onRemove(),this._connSource=n,this._connTarget=e,this._updateCoordinates(),this._registerEvents(),this},i._updateCoordinates=function(){var e=this.getMap();if(!e&&this._connSource&&(e=this._connSource.getMap()),!e&&this._connTarget&&(e=this._connTarget.getMap()),e&&this._connSource&&this._connTarget){for(var n,i,o=this._connSource._getConnectPoints(),s=this._connTarget._getConnectPoints(),a=0,h=this.getCoordinates(),l=0,c=o.length;l<c;l++)for(var A=o[l],f=0,d=s.length;f<d;f++){var p=s[f],g=e.computeLength(A,p);0===l&&0===f?(n=A,i=p,a=g):g<a&&(n=A,i=p)}xe(h)&&h[0].equals(n)&&h[1].equals(i)||this.setCoordinates([n,i])}},i.onAdd=function(){this._registerEvents(),this._updateCoordinates()},i.onRemove=function(){if(this._connSource&&(this._connSource.__connectors&&le(this,this._connSource.__connectors),this._connSource.off("dragging positionchange",this._updateCoordinates,this).off("remove",this.onRemove,this),this._connSource.off("dragstart mousedown mouseover",this._showConnect,this),this._connSource.off("dragend mouseup mouseout",this.hide,this),this._connSource.off("show",this._showConnect,this).off("hide",this.hide,this),delete this._connSource),this._connTarget&&(le(this,this._connTarget.__connectors),this._connTarget.off("dragging positionchange",this._updateCoordinates,this).off("remove",this.onRemove,this),this._connTarget.off("show",this._showConnect,this).off("hide",this.hide,this),delete this._connTarget),!(this._connSource instanceof _A&&this._connTarget instanceof _A)){var e=this.getMap();e&&e.off("movestart moving moveend zoomstart zooming zoomend rotate pitch fovchange spatialreferencechange",this._updateCoordinates,this)}},i._showConnect=function(){this._connSource&&this._connTarget&&this._connSource.isVisible()&&this._connTarget.isVisible()&&(this._updateCoordinates(),this.show())},i._registerEvents=function(){if(this._connSource&&this._connTarget){this._connSource.__connectors||(this._connSource.__connectors=[]),this._connTarget.__connectors||(this._connTarget.__connectors=[]),this._connSource.__connectors.push(this),this._connTarget.__connectors.push(this),this._connSource.on("dragging positionchange",this._updateCoordinates,this).on("remove",this.remove,this),this._connTarget.on("dragging positionchange",this._updateCoordinates,this).on("remove",this.remove,this),this._connSource.on("show",this._showConnect,this).on("hide",this.hide,this),this._connTarget.on("show",this._showConnect,this).on("hide",this.hide,this);var e=this.options.showOn;if(this.hide(),"moving"===e?(this._connSource.on("dragstart",this._showConnect,this).on("dragend",this.hide,this),this._connTarget.on("dragstart",this._showConnect,this).on("dragend",this.hide,this)):"click"===e?(this._connSource.on("mousedown",this._showConnect,this).on("mouseup",this.hide,this),this._connTarget.on("mousedown",this._showConnect,this).on("mouseup",this.hide,this)):"mouseover"===e?(this._connSource.on("mouseover",this._showConnect,this).on("mouseout",this.hide,this),this._connTarget.on("mouseover",this._showConnect,this).on("mouseout",this.hide,this)):this._showConnect(),!(this._connSource instanceof _A&&this._connTarget instanceof _A)){var n=this.getMap();n&&n.on("movestart moving moveend zoomstart zooming zoomend rotate pitch fovchange spatialreferencechange",this._updateCoordinates,this)}}},n}(e)},Kf={showOn:"always"},$f=function(e){function n(n,i,o){var s;return s=e.call(this,null,o)||this,1===arguments.length&&(o=n,n=null,i=null),s._connSource=n,s._connTarget=i,s}return kt(n,e),n}(Yf(mf));$f.mergeOptions(Kf),$f.registerJSONType("ConnectorLine");var ed=function(e){function n(n,i,o){var s;return s=e.call(this,null,o)||this,1===arguments.length&&(o=n,n=null,i=null),s._connSource=n,s._connTarget=i,s}return kt(n,e),n}(Yf(Hf));function nd(e){return e&&e instanceof _A}ed.mergeOptions(Kf),ed.registerJSONType("ArcConnectorLine");var id=[],rd=function(e){function n(n,i,o){var s;i&&!nd(i)&&!Array.isArray(i)&&mn.indexOf(i.type)<0&&(o=i,i=null),(s=e.call(this,n,o)||this)._maxZIndex=0,s._minZIndex=0,s._initCache(),i&&s.addGeometry(i);var a=s.options.style;return a&&s.setStyle(a),s}kt(n,e);var i=n.prototype;return i.getAltitude=function(){return 0},i.getGeometryById=function(e){return h(e)||""===e?null:this._geoMap[e]?this._geoMap[e]:null},i.getGeometries=function(e,n){if(!e)return this._geoList.slice(0);for(var i,o=[],s=0,a=this._geoList.length;s<a;s++)i=this._geoList[s],(n?e.call(n,i):e(i))&&o.push(i);return o},i.getFirstGeometry=function(){return this._geoList.length?this._geoList[0]:null},i.getLastGeometry=function(){var e=this._geoList.length;return 0===e?null:this._geoList[e-1]},i.getCount=function(){return this._geoList.length},i.getExtent=function(){if(0===this.getCount())return null;var e=new al(this.getProjection());return this.forEach((function(n){e._combine(n.getExtent())})),e},i.forEach=function(e,n){for(var i=this._geoList.slice(0),o=0,s=i.length;o<s;o++)n?e.call(n,i[o],o):e(i[o],o);return this},i.filter=function(e,n){var i=[],o=d(e),s=o?e:Qr(e);return this.forEach((function(e){var a=o?e:ao(e);(n?s.call(n,a):s(a))&&i.push(e)}),this),i},i.isEmpty=function(){return!this._geoList.length},i.addGeometry=function(e,n){if(!e)return this;if("FeatureCollection"===e.type)return this.addGeometry(Rf.toGeometry(e),n);if(!Array.isArray(e)){var i=arguments.length,o=arguments[i-1];return e=Array.prototype.slice.call(arguments,0,i-1),n=o,o&&A(o)&&("type"in o||nd(o))&&(e.push(o),n=!1),this.addGeometry(e,n)}if(0===e.length)return this;var s;this._initCache(),n&&(s=new al),this._toSort=this._maxZIndex>0;for(var l=[],c=0,f=e.length;c<f;c++){var p=e[c];if(!p||!Rf._isGeoJSON(p)&&!nd(p))throw new Error("Invalid geometry to add to layer("+this.getId()+") at index:"+c);if(!p.getLayer||p.getLayer()!==this){if(!nd(p)&&(p=_A.fromJSON(p),Array.isArray(p)))for(var g=0,v=p.length;g<v;g++)this._add(p[g],s,c),l.push(p[g]);if(!p)throw new Error("Invalid geometry to add to layer("+this.getId()+") at index:"+c);Array.isArray(p)||(this._add(p,s,c),l.push(p))}}var w=this.getMap();if(w&&(this._getRenderer().onGeometryAdd(l),s&&!h(s.xmin))){var C=s.getCenter(),P=w.getFitZoom(s);if(A(n)){var T=d(n.step)?n.step:function(){};w.animateTo({center:C,zoom:P},a({duration:w.options.zoomAnimationDuration,easing:"out"},n),T)}else!0===n&&w.setCenterAndZoom(C,P)}return this.fire("addgeo",{type:"addgeo",target:this,geometries:e}),this},i.getGeoMinZIndex=function(){return this._minZIndex},i.getGeoMaxZIndex=function(){return this._maxZIndex},i._add=function(e,n,i){this._toSort||(this._toSort=0!==e.getZIndex()),this._updateZIndex(e.getZIndex());var o=e.getId();if(!h(o)){if(!h(this._geoMap[o]))throw new Error("Duplicate geometry id in layer("+this.getId()+"):"+o+", at index:"+i);this._geoMap[o]=e}var s=oe();e._setInternalId(s),this._geoList.push(e),this.onAddGeometry(e),e._bindLayer(this),e.onAdd&&e.onAdd(),n&&n._combine(e.getExtent()),e._fireEvent("add",{layer:this}),this._cookedStyles&&this._styleGeometry(e)},i.removeGeometry=function(e){if(!Array.isArray(e))return this.removeGeometry([e]);for(var n=e.length-1;n>=0;n--)e[n]instanceof _A||(e[n]=this.getGeometryById(e[n])),e[n]&&this===e[n].getLayer()&&e[n].remove();return this.fire("removegeo",{type:"removegeo",target:this,geometries:e}),this},i.clear=function(){this._clearing=!0,this.forEach((function(e){e.remove()})),this._geoMap={};var e=this._geoList;this._geoList=[];var n=this._getRenderer();return n&&(n.onGeometryRemove(e),n.clearImageData&&(n.clearImageData(),delete n._lastGeosToDraw)),this._clearing=!1,this.fire("clear"),this},i.onRemoveGeometry=function(e){if(e&&!this._clearing&&(this===e.getLayer()&&!h(e._getInternalId()))){var n=e.getId();h(n)||delete this._geoMap[n];var i=this._findInList(e);i>=0&&this._geoList.splice(i,1),this._getRenderer()&&this._getRenderer().onGeometryRemove([e])}},i.getStyle=function(){return this.options.style?this.options.style:null},i.setStyle=function(e){return this.options.style=e,e=Lo(e),this._cookedStyles=ho(e),this.forEach((function(e){this._styleGeometry(e)}),this),this.fire("setstyle",{type:"setstyle",target:this,style:e}),this},i._styleGeometry=function(e){if(!this._cookedStyles)return!1;for(var n=ao(e),i=0,o=this._cookedStyles.length;i<o;i++)if(!0===this._cookedStyles[i].filter(n))return e._setExternSymbol(this._cookedStyles[i].symbol),!0;return!1},i.removeStyle=function(){return this.options.style?(delete this.options.style,delete this._cookedStyles,this.forEach((function(e){e._setExternSymbol(null)}),this),this.fire("removestyle"),this):this},i.onAddGeometry=function(e){this.getStyle()&&this._styleGeometry(e)},i.hide=function(){for(var e=0,n=this._geoList.length;e<n;e++)this._geoList[e].onHide();return RA.prototype.hide.call(this)},i._initCache=function(){this._geoList||(this._geoList=[],this._geoMap={})},i._updateZIndex=function(...e){this._maxZIndex=Math.max(this._maxZIndex,Math.max(...e)),this._minZIndex=Math.min(this._minZIndex,Math.min(...e))},i._sortGeometries=function(){var e=this;this._toSort&&(this._maxZIndex=0,this._minZIndex=0,this._geoList.sort((function(n,i){return e._updateZIndex(n.getZIndex(),i.getZIndex()),e._compare(n,i)})),this._toSort=!1)},i._compare=function(e,n){return e.getZIndex()===n.getZIndex()?e._getInternalId()-n._getInternalId():e.getZIndex()-n.getZIndex()},i._findInList=function(e){var n=this._geoList.length;if(0===n)return-1;this._sortGeometries();for(var i,o=0,s=n-1;o<=s;){if(i=Math.floor((o+s)/2),this._geoList[i]===e)return i;this._compare(this._geoList[i],e)>0?s=i-1:o=i+1}return-1},i.onGeometryEvent=function(e){return this._onGeometryEvent(e)},i._onGeometryEvent=function(e){if(e&&e.target){var n=e.type;"idchange"===n?this._onGeometryIdChange(e):"zindexchange"===n?this._onGeometryZIndexChange(e):"positionchange"===n?this._onGeometryPositionChange(e):"shapechange"===n?this._onGeometryShapeChange(e):"symbolchange"===n?this._onGeometrySymbolChange(e):"show"===n?this._onGeometryShow(e):"hide"===n?this._onGeometryHide(e):"propertieschange"===n&&this._onGeometryPropertiesChange(e)}},i._onGeometryIdChange=function(e){if(e.new!==e.old||!this._geoMap[e.old]||this._geoMap[e.old]!==e.target){if(!h(e.new)){if(this._geoMap[e.new])throw new Error("Duplicate geometry id in layer("+this.getId()+"):"+e.new);this._geoMap[e.new]=e.target}h(e.old)||e.new===e.old||delete this._geoMap[e.old]}},i._onGeometryZIndexChange=function(e){e.old!==e.new&&(this._updateZIndex(e.new),this._toSort=!0,this._getRenderer()&&this._getRenderer().onGeometryZIndexChange(e))},i._onGeometryPositionChange=function(e){this._getRenderer()&&this._getRenderer().onGeometryPositionChange(e)},i._onGeometryShapeChange=function(e){this._getRenderer()&&this._getRenderer().onGeometryShapeChange(e)},i._onGeometrySymbolChange=function(e){this._getRenderer()&&this._getRenderer().onGeometrySymbolChange(e)},i._onGeometryShow=function(e){this._getRenderer()&&this._getRenderer().onGeometryShow(e)},i._onGeometryHide=function(e){this._getRenderer()&&this._getRenderer().onGeometryHide(e)},i._onGeometryPropertiesChange=function(e){this._getRenderer()&&this._getRenderer().onGeometryPropertiesChange(e)},i._hasGeoListeners=function(e){if(!e)return!1;Array.isArray(e)||(id[0]=e,e=id);for(var n=this.getGeometries()||[],i=0,o=n.length;i<o;i++){var s=n[i];if(s){if(s.options.cursor)return!0;for(var a=0,h=e.length;a<h;a++){if(s.listens(e[a])>0)return!0}}}return!1},i._getRenderer=function(){return e.prototype._getRenderer.call(this)},n}(RA);rd.mergeOptions({drawImmediate:!1,geometryEvents:!0,geometryEventTolerance:1});var od=new ll,sd={debug:!1,enableSimplify:!0,defaultIconSize:[20,20],cacheVectorOnCanvas:!0,cacheSvgOnCanvas:wt.gecko,enableAltitude:!0,altitudeProperty:"altitude",drawAltitude:!1,sortByDistanceToCamera:!1,roundPoint:!1,altitude:0,clipBBoxBufferSize:3,collision:!1,collisionBufferSize:2,collisionDelay:250,collisionScope:"layer",progressiveRender:!1,progressiveRenderCount:1e3,progressiveRenderDebug:!1},ad=function(e){function n(n,i,o){var s;return(s=e.call(this,n,i,o)||this).isVectorLayer=!0,s}kt(n,e);var i=n.prototype;return i.onConfig=function(n){if(e.prototype.onConfig.call(this,n),!h(n.enableAltitude))for(var i=this.getGeometries()||[],o=0,s=i.length;o<s;o++){var a=i[o];a&&(a._clearAltitudeCache(),a.fire("positionchange"))}if(n.enableAltitude||n.drawAltitude||n.altitudeProperty){var l=this.getRenderer();l&&l.setToRedraw&&l.setToRedraw()}},i.identify=function(e,n){n=n||{};var i=this.getRenderer();e instanceof Zh||(e=new Zh(e));var o=this.getMap().coordToContainerPoint(e);return n.onlyVisible&&i&&i.identifyAtPoint?i.identifyAtPoint(o,n):this._hitGeos(this._geoList,o,n)},i.identifyAtPoint=function(e,n){n=n||{};var i=this.getRenderer();return e instanceof ee||(e=new ee(e)),n.onlyVisible&&i&&i.identifyAtPoint?i.identifyAtPoint(e,n):this._hitGeos(this._geoList,e,n)},i._hitGeos=function(e,n,i={}){if(!e||!e.length)return[];for(var o=[],s=0,a=0,h=e.length;a<h;a++){var c=e[a];c.isPoint&&!0===c._collided||(o[s]=c,s++)}e=o;var A=i.filter,f=[],d=i.tolerance,p=this.getMap(),g=this.getRenderer(),v=g&&g.getImageData&&g.getImageData();if(v){var w=0,C=g.maxTolerance;if(l(C))w=C;else for(var P=e.length-1;P>=0;P--){var T=e[P]._hitTestTolerance()+(d||0);T>w&&(w=T)}var S=p.getDevicePixelRatio();v.r=S;for(var I=!1,E=n.x-w,O=n.y-w,k=-w;k<=w;k++){for(var L=-w;L<=w;L++){var F=Math.round((E+k)*S),N=Math.round((O+L)*S);if(v.data[N*v.width*4+4*F+3]>0){I=!0;break}}if(I)break}if(!I)return f}for(var z=i.onlyVisible,H=e.length-1;H>=0;H--){var j=e[H];if(j&&j.options.interactive&&(z||j.isVisible())){var W=j._getPainter();if(W){var q=W.getRenderBBOX&&W.getRenderBBOX();if(q){var{x:Y,y:J}=n;if(Y<q[0]||J<q[1]||Y>q[2]||J>q[3])continue}if(!(j instanceof mf&&(j._getArrowStyle()||j instanceof Bf))){var $=j.getContainerExtent(od);if(d&&($=$._expand(d)),!$||!$.contains(n))continue}if(j._containsPoint(n,d)&&(!A||A(j))&&(f.push(j),i.count&&f.length>=i.count))break}}}return f},i.getAltitude=function(){return this.options.altitude||0},i.toJSON=function(e){e||(e={clipExtent:null,geometries:null});var n={type:this.getJSONType(),id:this.getId(),options:this.config()};if(h(e.geometries)||e.geometries){var i;if(e.clipExtent){var o=this.getMap(),s=o?o.getProjection():null;i=new al(e.clipExtent,s)}for(var a=[],l=this.getGeometries(),c=0,A=l.length;c<A;c++){var f=l[c],d=f.getExtent();if(d&&(!i||i.intersects(d))){var p=f.toJSON(e.geometries);a.push(p)}}n.geometries=a}return n},i.getRenderer=function(){return e.prototype.getRenderer.call(this)},n.fromJSON=function(e){if(!e||"VectorLayer"!==e.type)return null;for(var i=new n(e.id,e.options),o=e.geometries,s=[],a=0;a<o.length;a++){var h=_A.fromJSON(o[a]);h&&s.push(h)}return i.addGeometry(s),i},n.getPainterClass=function(){return Qc},n.getCollectionPainterClass=function(){return $c},n}(rd);ad.mergeOptions(sd),ad.registerJSONType("VectorLayer");var hd="_map_tool",ld=function(e){function n(){return e.apply(this,arguments)||this}kt(n,e);var i=n.prototype;return i.addTo=function(e){return e?(this._map=e,e[hd]&&e[hd].disable(),this.onAdd&&this.onAdd(),this.enable(),e[hd]=this,this._fireEvent("add"),this):this},i.getMap=function(){return this._map},i.enable=function(){return!this._map||this._enabled||(this._enabled=!0,this._switchEvents("off"),this._registerEvents(),this.onEnable&&this.onEnable(),this._fireEvent("enable")),this},i.disable=function(){return this._enabled&&this._map?(this._enabled=!1,this._switchEvents("off"),this.onDisable&&this.onDisable(),this._fireEvent("disable"),this):this},i.isEnabled=function(){return!!this._enabled},i.remove=function(){return this._map?(this.disable(),this._map&&(delete this._map[hd],delete this._map),this._fireEvent("remove"),this):this},i._registerEvents=function(){this._switchEvents("on")},i._switchEvents=function(e){var n=this.getEvents();n&&this._map[e](n,this)},i._fireEvent=function(e,n){n||(n={}),this.fire(e,n)},n}(Th(Ih)),ud={symbol:{lineColor:"#000",lineWidth:2,lineOpacity:1,polygonFill:"#fff",polygonOpacity:.3},doubleClickZoom:!1,mode:null,once:!1,autoPanAtEdge:!1,ignoreMouseleave:!0,blockGeometryEvents:!1,zIndex:Number.MAX_VALUE,enableAltitude:!0,interactive:!0,transformCoordinate:null},cd={},Ad=function(e){function n(n){var i;return(i=e.call(this,n)||this)._checkMode(),i._events={click:i._clickHandler,"mousemove touchmove":i._mouseMoveHandler,dblclick:i._doubleClickHandler,"mousedown touchstart":i._mouseDownHandler,"mouseup touchend":i._mouseUpHandler,mousemove:i._mouseMoveHandler,mousedown:i._mouseDownHandler,mouseup:i._mouseUpHandler},i}kt(n,e),n.registerMode=function(e,n){cd[e.toLowerCase()]=n},n.getRegisterMode=function(e){return cd[e.toLowerCase()]};var i=n.prototype;return i.getMode=function(){return this.options.mode?this.options.mode.toLowerCase():null},i.setMode=function(e){return this._geometry&&(this._geometry.remove(),delete this._geometry),this._clearStage(),this._switchEvents("off"),this.options.mode=e,this._checkMode(),this.isEnabled()&&(this._switchEvents("on"),this._restoreMapCfg(),this._saveMapCfg()),this},i.getSymbol=function(){var e=this.options.symbol;return ko(e||this.options.symbol)},i.setSymbol=function(e){return e?(this.options.symbol=e,this._geometry&&this._geometry.setSymbol(e),this):this},i.getCurrentGeometry=function(){return this._geometry},i.onAdd=function(){this._checkMode()},i.onEnable=function(){this._saveMapCfg(),this._drawToolLayer=this._getDrawLayer(),this._clearStage(),this._loadResources();var e=this.getMap();return this.options.autoPanAtEdge&&(this._mapAutoPanAtEdge=e.options.autoPanAtEdge,this._mapAutoPanAtEdge||e.config({autoPanAtEdge:!0})),this._geometryEvents=e.options.geometryEvents,this.options.blockGeometryEvents&&e.config("geometryEvents",!1),this},i.onDisable=function(){var e=this.getMap();return this._restoreMapCfg(),this.endDraw({ignoreEndEvent:!0}),this._map&&(e.removeLayer(this._getDrawLayer()),this.options.autoPanAtEdge&&(this._mapAutoPanAtEdge||e.config({autoPanAtEdge:!1}))),this.options.blockGeometryEvents&&e.config("geometryEvents",this._geometryEvents),this},i.undo=function(){var e=this._getRegisterMode();if(!this._shouldRecordHistory(e.action)||!this._historyPointer)return this;var n=this._clickCoords.slice(0,--this._historyPointer);return e.update(this.getMap().getProjection(),n,this._geometry),this},i.redo=function(){var e=this._getRegisterMode();if(!this._shouldRecordHistory(e.action)||h(this._historyPointer)||this._historyPointer===this._clickCoords.length)return this;var n=this._clickCoords.slice(0,++this._historyPointer);return e.update(this.getMap().getProjection(),n,this._geometry),this},i._shouldRecordHistory=function(e){return Array.isArray(e)&&"click"===e[0]&&"mousemove"===e[1]&&"dblclick"===e[2]},i._checkMode=function(){this._getRegisterMode()},i._saveMapCfg=function(){var e=this.getMap();this._mapDoubleClickZoom=e.options.doubleClickZoom,e.config({doubleClickZoom:this.options.doubleClickZoom});for(var n=this._getRegisterMode().action,i=!1,o=0;o<n.length;o++)if(n[o].indexOf("mousedown")>=0||n[o].indexOf("touchstart")>=0){i=!0;break}if(i){var s=this.getMap();this._mapDraggable=s.options.draggable,s.config({draggable:!1})}},i._restoreMapCfg=function(){var e=this.getMap();e.config({doubleClickZoom:this._mapDoubleClickZoom}),h(this._mapDraggable)||e.config("draggable",this._mapDraggable),delete this._mapDraggable,delete this._mapDoubleClickZoom},i._loadResources=function(){var e=vo(this.getSymbol());e.length>0&&this._drawToolLayer._getRenderer().loadResources(e)},i._getProjection=function(){return this._map.getProjection()},i._getRegisterMode=function(){var e=this.getMode(),i=n.getRegisterMode(e);if(!i)throw new Error(e+" is not a valid mode of DrawTool.");return i},i.getEvents=function(){var e=this._getRegisterMode().action,n={};if(Array.isArray(e)){for(var i=0;i<e.length;i++)n[e[i]]=this._events[e[i]];return n}return null},i._mouseDownHandler=function(e){(null==e?void 0:e.coordinate)&&this._createGeometry(e)},i._mouseUpHandler=function(e){(null==e?void 0:e.coordinate)&&this.endDraw(e)},i._clickHandler=function(e){if(null==e?void 0:e.coordinate){if(!this.options.interactive)return this;e.enableAltitude=this.options.enableAltitude;var n=this.getMap(),i=this._getRegisterMode();if(this._clickCoords&&this._clickCoords.length){var o=this._clickCoords.length,s=n._pointToPrj(e.point2d);if(this._clickCoords[o-1].equals(s))return}if(this._geometry){var a=n._pointToPrj(e.point2d);h(this._historyPointer)||(this._clickCoords=this._clickCoords.slice(0,this._historyPointer));var l=this._geometry.snapTo;if(l&&d(l)){var c=this._getSnapResult(l,e.containerPoint);if(a=c.prjCoord,this._clickCoords=this._clickCoords.concat(c.effectedVertex),this._clickCoords[this._clickCoords.length-1].equals(a))return}if(this._clickCoords.push(a),this._historyPointer=this._clickCoords.length,e.drawTool=this,i.update(n.getProjection(),this._clickCoords,this._geometry,e),"point"===this.getMode())return void this.endDraw(e);this._fireEvent(this._clickCoords.length<=1?"drawstart":"drawvertex",e),i.clickLimit&&i.clickLimit===this._historyPointer&&this.endDraw(e)}else this._createGeometry(e)}},i._createGeometry=function(e){var n=this.getMode(),i=this.getMap(),o=this._getRegisterMode(),s=i._pointToPrj(e.point2d),a=this.getSymbol();if(!this._geometry){this._fireEvent("drawprepare",e),this._clickCoords=[s],e.drawTool=this,this._geometry=o.create(this.getMap().getProjection(),this._clickCoords,e),a&&"point"!==n?this._geometry.setSymbol(a):this.options.hasOwnProperty("symbol")&&this._geometry.setSymbol(this.options.symbol),this._addGeometryToStage(this._geometry),this._fireEvent("drawstart",e);var h=this._geometry.snapTo;if(h&&d(h)){var l=this._getSnapResult(h,e.containerPoint),c=this.getMap();if(c&&l)this._clickCoords=[l.prjCoord],o.update(c.getProjection(),this._clickCoords,this._geometry,e)}}"point"===n&&"mousemove"!==e.type&&this.endDraw(e)},i._mouseMoveHandler=function(e){if(null==e?void 0:e.coordinate){if(!this.options.interactive)return this;e.enableAltitude=this.options.enableAltitude;var n=this.getMap();if(n&&!n.isInteracting())if("point"!==this.getMode()||this._geometry){if(this._geometry){var i=this._getMouseContainerPoint(e);if(this._isValidContainerPoint(i)){var o=n._pointToPrj(e.point2d),s=[],a=this._geometry.snapTo;if(a&&d(a)){var h=this._getSnapResult(a,i);o=h.prjCoord,s=h.effectedVertex}var l=n.getProjection();e.drawTool=this;var c=this._getRegisterMode();if(this._shouldRecordHistory(c.action)){var A=this._clickCoords.slice(0,this._historyPointer);if(A&&A.length>0&&o.equals(A[A.length-1]))return;c.update(l,A.concat(s,[o]),this._geometry,e)}else c.update(l,o,this._geometry,e);this._fireEvent("mousemove",e)}}}else this._createGeometry(e)}},i._doubleClickHandler=function(e){if(null==e?void 0:e.coordinate){if(!this.options.interactive)return this;if(e.enableAltitude=this.options.enableAltitude,this._geometry){var n=this._getMouseContainerPoint(e);if(this._isValidContainerPoint(n)){var i=this._getRegisterMode(),o=this._clickCoords;if(o&&!(o.length<2)){var s=this.getMode();if(!(s&&s.indexOf("polygon")>-1&&o.length<3)){for(var a=this.getMap().getProjection(),h=[o[0]],l=1,c=o.length;l<c;l++)o[l].x===o[l-1].x&&o[l].y===o[l-1].y||h.push(o[l]);h.length<2||this._geometry&&this._geometry instanceof Af&&h.length<3||(e.drawTool=this,i.update(a,h,this._geometry,e),this.endDraw(e))}}}}}},i._addGeometryToStage=function(e){this._getDrawLayer().addGeometry(e)},i.endDraw=function(e){if(!this._geometry||this._ending)return this;this._ending=!0;var n=this._geometry;return this._clearStage(),e=e||{},this._geometry=n,e.ignoreEndEvent||this._fireEvent("drawend",e),delete this._geometry,this.options.once&&this.disable(),delete this._ending,delete this._historyPointer,this._vertexes&&(this._vertexes=[]),this},i._clearStage=function(){this._getDrawLayer().clear(),delete this._geometry,delete this._clickCoords},i._getMouseContainerPoint=function(e){var n=this._getRegisterMode().action;return(n[0].indexOf("mousedown")>=0||n[0].indexOf("touchstart")>=0)&&ki(e.domEvent),e.containerPoint},i._isValidContainerPoint=function(e){var n=this._map.getSize();return!(e.x<0||e.y<0)&&!(e.x>n.width||e.y>n.height)},i._getSnapResult=function(e,n){var i=this.getMap(),o=[];if(this.options.edgeAutoComplete){o.push(i.prjToContainerPoint(this._clickCoords[(this._historyPointer||1)-1]));var s=this._clickCoords[(this._historyPointer||1)-2];s&&o.push(i.prjToContainerPoint(s))}var a=e(n,o),h=i._containerPointToPrj(n=(a.effectedVertex?a.point:a)||n);return a.effectedVertex&&(a.effectedVertex=a.effectedVertex.map((function(e){return i._containerPointToPrj(e)}))),{prjCoord:h,effectedVertex:a.effectedVertex||[]}},i._getDrawLayer=function(){var e=An+"drawtool",n=this._map.getLayer(e);return n||(n=new ad(e,{enableSimplify:!1,enableAltitude:this.options.enableAltitude,zIndex:this.options.zIndex}),this._map.addLayer(n)),this._pushLayers(n),n},i._fireEvent=function(e,n){n||(n={}),n=a({},n),this._geometry&&(n.geometry=this._getRegisterMode().generate(this._geometry,{drawTool:this}),n.tempGeometry=this._geometry),ld.prototype._fireEvent.call(this,e,n)},i._pushLayers=function(e){var n=this;return e?(Array.isArray(e)||(e=[e]),this._layers=this._layers||[],e.forEach((function(e){-1===n._layers.indexOf(e)&&n._layers.push(e)})),this):this},i._outLayers=function(e){var n=this;return e?(Array.isArray(e)||(e=[e]),this._layers=this._layers||[],e.forEach((function(e){for(var i=0,o=n._layers.length;i<o;i++)if(e===n._layers[i]){n._layers.splice(i,1);break}})),this):this},i.setLayerZIndex=function(e){return l(e)?(this.options.zIndex=e,this._layers=this._layers||[],this._layers.forEach((function(n){n&&n.setZIndex&&n.setZIndex(e)})),this):this},i.addCoordinate=function(e){if(!this.isEnabled())return this;var n=this.getMap();if(!n)return this;e=new Zh(e);var i=n._parseEventFromCoord(e);return this._clickHandler(i),this},i.getTempGeometry=function(){return this._geometry},n}(ld);Ad.mergeOptions(ud);var fd=function(e){function n(n){var i;return(i=e.call(this,n)||this).drawTool=new Ad({mode:"boxZoom",ignoreMouseleave:!1}),i}kt(n,e);var i=n.prototype;return i.addHooks=function(){this.target.on("_mousedown",this._onMouseDown,this)},i.removeHooks=function(){this.target.off("_mousedown",this._onMouseDown,this),this.drawTool.isEnabled()&&this.drawTool.remove()},i._onMouseDown=function(e){this.target.options.boxZoom&&e.domEvent.shiftKey&&this.drawTool.setSymbol(this.target.options.boxZoomSymbol).on("drawend",this._boxZoom,this).addTo(this.target)},i._boxZoom=function(e){var n=this.target;this.drawTool.remove();var i=e.geometry,o=i.getCenter(),s=i.getSymbol(),a=new al(o,n.locateByPoint(o,s.markerWidth,s.markerHeight),n.getProjection()),h=n.getFitZoom(a);n._animateTo({center:a.getCenter(),zoom:h})},n}(Sh);BA.mergeOptions({boxZoom:!0,boxZoomSymbol:{markerType:"rectangle",markerLineWidth:3,markerLineColor:"#1bbc9b",markerLineDasharray:[10,5],markerFillOpacity:.1,markerFill:"#1bbc9b",markerWidth:1,markerHeight:1}}),BA.addOnLoadHook("addHandler","boxZoom",fd);var dd=30,pd=function(e){function n(){return e.apply(this,arguments)||this}kt(n,e);var i=n.prototype;return i.addHooks=function(){this.target&&this.target.on("_mousemove",this._onMouseMove,this)},i.removeHooks=function(){this.target&&this.target.off("_mousemove",this._onMouseMove,this)},i._onMouseMove=function(e){var n=this.target;if(n.options.autoPanAtEdge){var{containerPoint:i}=e,o=n.getContainerExtent();if(o){var s,{x:a,y:h}=i,{xmax:l,ymax:c}=o;a<dd&&(s=[Math.abs(a-dd),0]),h<dd&&(s=[0,Math.abs(h-dd)]),a+dd>l&&(s=[-Math.abs(a+dd-l),0]),h+dd>c&&(s=[0,-Math.abs(h+dd-c)]),s&&n.panBy(s,{duration:1})}}},n}(Sh);function gd(e,n){var i=e.bearing,o=n.getBearing();return!(o>=0&&i>180)&&!(o<=0&&i<-180)}function md(e,n){var i=e.bearing,o=n.getBearing();o>=0&&i<0&&(e.bearing=180-Math.abs(i)+180),o<=0&&i>0&&(e.bearing=-180-(180-Math.abs(i))),o>=0&&i>0&&(e.bearing=-180-(180-Math.abs(i))),o<=0&&i<0&&(e.bearing=180-Math.abs(i)+180)}function yd(e,n,i){return e*(1-i)+n*i}BA.mergeOptions({autoPanAtEdge:!1}),BA.addOnLoadHook("addHandler","autoPanAtEdge",pd),BA.include({animateTo:function(e,n={},i){var o=this;(e=a({},this.getView(),e)).bearing=e.bearing%360,d(n)&&(i=n,n={}),n.counterclockwise&&md(e,this),gd(e,this)&&this._validateView(e);var s=this.getProjection(),l=this.getView(),c={},A=!0;for(var f in e)if(g(e,f)&&!h(e[f])&&("prjCenter"===f||!h(l[f])))if(A=!1,"center"===f){var p=new Zh(l[f]),v=new Zh(e[f]);p.equals(v)||(c.center=[p,v])}else if("prjCenter"===f){var w=new Zh(this._getPrjCenter()),C=new Zh(e[f]);w.equals(C)||(c.prjCenter=[w,C])}else l[f]!==e[f]&&"around"!==f&&(c[f]=[l[f],e[f]]);if(A)return null;this._animPlayer&&(this._isInternalAnimation?"running"===this._animPlayer.playState&&(this._animPlayer.pause(),this._prevAnimPlayer=this._animPlayer):(delete this._prevAnimPlayer,this._stopAnim(this._animPlayer)));var P=e.around||null,T=this._getRenderer(),S=this._animPlayer=rf.animate(c,{easing:n.easing||"out",duration:n.duration||this.options.zoomAnimationDuration,framer:function(e){T.callInNextFrame(e)},repeat:n.repeat},(function(e){if(o.isRemoved())S.finish();else{if("running"===S.playState){if(e.styles.center)o._setPrjCenter(s.project(e.styles.center)),o.onMoving(o._parseEventFromCoord(o.getCenter()));else if(e.styles.prjCenter){o._setPrjCenter(e.styles.prjCenter),o.onMoving(o._parseEventFromCoord(o.getCenter()))}h(e.styles.zoom)||o.onZooming(e.styles.zoom,P),h(e.styles.pitch)||o._setPitch(e.styles.pitch),h(e.styles.bearing)||o._setBearing(e.styles.bearing),o._fireEvent("animating")}else"paused"===S.playState&&S!==o._mapAnimPlayer||(S._interupted||(c.center?o._setPrjCenter(s.project(c.center[1])):c.prjCenter&&o._setPrjCenter(c.prjCenter[1]),h(c.pitch)||o._setPitch(c.pitch[1]),h(c.bearing)||o._setBearing(c.bearing[1])),o._endAnim(S,c,P,n));i&&i(e)}}),this);return this._startAnim(c,P),S},_animateTo:function(e,n={},i){return this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._isInternalAnimation=!0,this._mapAnimPlayer=this.animateTo(e,n,i),delete this._isInternalAnimation,this._mapAnimPlayer},flyTo:function(e,n={},i){var o=this;(e=a({},this.getView(),e)).bearing=e.bearing%360,n.counterclockwise&&md(e,this),gd(e,this)&&this._validateView(e),this._animPlayer&&(this._isInternalAnimation?"running"===this._animPlayer.playState&&(this._animPlayer.pause(),this._prevAnimPlayer=this._animPlayer):(delete this._prevAnimPlayer,this._stopAnim(this._animPlayer))),d(n)&&(i=n,n={}),n=a({curve:1.42},n);var s=this;function h(e,n){return s.getResolution(n)/s.getResolution(e)}var l=e.around||new ee(this.width/2,this.height/2),c=this.getMinZoom(),A=this.getMaxZoom(),f=this.getProjection(),p=this.getView(),g=p.zoom,v=p.bearing,w=p.pitch,C="zoom"in e?_e(+e.zoom,c,A):g,P="bearing"in e?+e.bearing:v,T="pitch"in e?+e.pitch:w,S=f.project(e.center&&new Zh(e.center)||this.getCenter()),I=h(C,g),E=f.project(this.getCenter()),O=S.sub(E),k=n.curve,L=Math.max(this.width,this.height),F=L/I,N=O.mag();if("minZoom"in n){var z=_e(Math.min(n.minZoom,g,C),c,A),H=L/h(z,g);k=Math.sqrt(H/N*2)}var j=k*k;function W(e){var n=(F*F-L*L+(e?-1:1)*j*j*N*N)/(2*(e?F:L)*j*N);return Math.log(Math.sqrt(n*n+1)-n)}function q(e){return(Math.exp(e)-Math.exp(-e))/2}function Y(e){return(Math.exp(e)+Math.exp(-e))/2}var J=W(0),$=function(e){return Y(J)/Y(J+k*e)},it=function(e){return L*((Y(J)*function(e){return q(e)/Y(e)}(J+k*e)-q(J))/j)/N},rt=(W(1)-J)/k;if(Math.abs(N)<1e-6||!isFinite(rt)){if(Math.abs(L-F)<1e-6)return this.animateTo(e,n,i);var ot=F<L?-1:1;rt=Math.abs(Math.log(F/L))/k,it=function(){return 0},$=function(e){return Math.exp(ot*k*e)}}var st=this._getRenderer(),at=this._animPlayer=rf.animate({k:[0,1]},{easing:n.easing||"out",duration:n.duration||8,framer:function(e){st.callInNextFrame(e)}},(function(s){if(o.isRemoved())at.finish();else{var a=s.styles.k,h=a*rt,c=1/$(h),A={};if(e.center){var f=1===a?S:E.add(O.multi(it(h)));A.prjCenter=[S,f]}if(g!==C){var d=1===a?C:o.getZoomForScale(c,g,!0);A.zoom=[g,d]}if(w!==T){var p=yd(w,T,a);A.pitch=[T,p]}if(v!==P){var I=yd(v,P,a);A.bearing=[P,I]}if("running"===at.playState){if(A.prjCenter)o._setPrjCenter(A.prjCenter[1]),o.onMoving(o._parseEventFromCoord(o.getCenter()));A.zoom&&o.onZooming(A.zoom[1],l),A.pitch&&o._setPitch(A.pitch[1]),A.bearing&&o._setBearing(A.bearing[1]),o._fireEvent("animating")}else"paused"===at.playState&&at!==o._mapAnimPlayer||(at._interupted||(A.prjCenter&&o._setPrjCenter(A.prjCenter[1]),A.pitch&&o._setPitch(A.pitch[1]),A.bearing&&o._setBearing(A.bearing[1])),o._endAnim(at,A,l,n));i&&i(s)}}),{});return this._startAnim({center:e.center,zoom:e.zoom!==g,pitch:T!==w,bearing:P!==v},l),this},isAnimating:function(){return!!this._animPlayer},isRotating:function(){return this.isDragRotating()||!!this._animRotating},_endAnim:function(e,n,i,o){delete this._animRotating;var s,a=e._interupted?"animateinterrupted":"animateend";if(e===this._animPlayer&&delete this._animPlayer,e===this._mapAnimPlayer&&delete this._mapAnimPlayer,n.center)s=e._interupted?this.getCenter():n.center[1],this.onMoveEnd(this._parseEventFromCoord(s));else if(n.prjCenter){var l;l=e._interupted?this._getPrjCenter():n.prjCenter[1];var c=this._parseEventFromCoord(this.getProjection().unproject(l));c.point2d=this._prjToPoint(l),this.onMoveEnd(c)}h(n.zoom)||(e._interupted?this.onZoomEnd(this.getZoom()):o.wheelZoom?this.onZooming(n.zoom[1],i):this.onZoomEnd(n.zoom[1])),a&&this._fireEvent(a),h(n.pitch)||this.getPitch()||this.getRenderer().setToRedraw(),o.wheelZoom||this._resumePrev(e)},_startAnim:function(e,n){this._animPlayer&&((e.center||e.prjCenter)&&this.onMoveStart(),e.zoom&&!this.isZooming()&&this.onZoomStart(e.zoom[1],n),(e.pitch||e.bearing)&&(this._animRotating=!0),this._fireEvent("animatestart"),this._animPlayer.play())},_stopAnim:function(e){e&&(delete this._animRotating,"finished"!==e.playState&&(e._interupted=!0,e.cancel()),e===this._animPlayer&&delete this._animPlayer,e===this._mapAnimPlayer&&delete this._mapAnimPlayer)},_resumePrev:function(e){if(this._prevAnimPlayer){var n=this._prevAnimPlayer;"paused"!==n.playState&&delete this._prevAnimPlayer,e!==n&&(this._animPlayer=n,n.play())}}});var vd=[60,120];function _d(e){e.stopPropagation(),e.preventDefault()}var xd=["dragstart","dragenter","dragend","dragleave","dragover"].join(" ").toString(),bd="mousedown mouseup mouseover mouseout mouseenter mouseleave mousemove click dblclick contextmenu keypress touchstart touchmove touchend drop ";function wd(e,n,i){var o=n[0],s=n[1],a=n[2],h=1/(i[3]*o+i[7]*s+i[11]*a+i[15]);return e[0]=(i[0]*o+i[4]*s+i[8]*a+i[12])*h,e[1]=(i[1]*o+i[5]*s+i[9]*a+i[13])*h,e[2]=(i[2]*o+i[6]*s+i[10]*a+i[14])*h,e}BA.include({_registerDomEvents:function(){var e=this._panels.mapWrapper||this._containerDOM;Si(e,bd,this._handleDOMEvent,this),Si(e,xd,_d,this)},_removeDomEvents:function(){var e=this._panels.mapWrapper||this._containerDOM;Ii(e,bd,this._handleDOMEvent),Ii(e,xd,_d)},_handleDOMEvent:function(e){if(e&&"drop"===e.type){e.stopPropagation(),e.preventDefault();var n=this._parseEvent(e,e.type);return n=a({},n,{dataTransfer:e.dataTransfer}),void this._fireEvent(e.type,n)}var i=this.options.clickTimeThreshold,h=e.type;if(!er(h)||o.isTest||!nr(this,this.options.mousemoveThrottleTime)){var l="mousedown"===h||"touchstart"===h&&(!e.touches||1===e.touches.length);l&&(this._domMouseDownTime=s(),this._domMouseDownView=this.getView());var c="contextmenu"===h&&function(e){if(!e._domMouseDownView)return!0;var n=e.getView(),i=e._domMouseDownView;return n.bearing!==i.bearing||n.pitch!==i.pitch}(this);if("contextmenu"===h){Di(e);var A=this._domMouseDownTime;s()-A<=i&&!c&&this._fireDOMEvent(this,e,"dom:"+e.type)}else this._fireDOMEvent(this,e,"dom:"+e.type);if(!this._ignoreEvent(e)){var f,d=!1;if(l)this._mouseDownTime=s();else if("click"===h||"touchend"===h||"contextmenu"===h){if(!this._mouseDownTime)return;var p=this._mouseDownTime;if(delete this._mouseDownTime,s()-p>i){if("click"===h||"contextmenu"===h)return}else if("contextmenu"===h){if(c)return}else"touchend"===h&&(d=!0)}d&&(this._clickTime&&s()-this._clickTime<=i?(delete this._clickTime,f="dblclick",this._fireDOMEvent(this,e,"dom:dblclick")):(this._clickTime=s(),f="click",this._fireDOMEvent(this,e,"dom:click"))),this._ignoreEvent(e)||(this._fireDOMEvent(this,e,h),f&&this._fireDOMEvent(this,e,f))}}},_ignoreEvent:function(e){if(!e||!this._panels.control)return!1;var n,i=e.srcElement||e.target;if(i)for(;i&&i!==this._containerDOM;){if(i.className&&i.className.indexOf&&(i.className.indexOf("maptalks-control")>=0||i.className.indexOf("maptalks-ui")>=0&&n&&!n.eventsPropagation))return!0;n=i,i=i.parentNode}return!1},_isEventOutMap:function(e){var n=Bi(this._getActualEvent(e),this._containerDOM);return this._isContainerPointOutOfMap(n)},_isContainerPointOutOfMap:function(){var e=[0,0,0],n=[0,0,0],i=new qs(e,n),o=[0,0,0];return function(s){var a=this.getPitch();if(a>vd[0]&&a<vd[1]){if(this.getContainerPointRay(e,n,s,0,.5),i.setFromTo(e,n),!i.intersectGround(o))return!0;if(i.distanceToGround()<=0)return!0}return!1}}(),_wrapTerrainData:function(e){e.containerPoint&&!e.terrain&&(e.terrain=this._queryTerrainInfo(e.containerPoint))},_parseEvent:function(e,n){if(!e)return null;var i={domEvent:e};if("keypress"!==n){var o=this._getActualEvent(e);if(o&&void 0!==o.clientX){var s=Bi(o,this._containerDOM);i=a(i,{containerPoint:s,viewPoint:this.containerPointToViewPoint(s)}),this._isContainerPointOutOfMap(s)||(i=a(i,{coordinate:this.containerPointToCoord(s),point2d:this._containerPointToPoint(s)}))}}return this._wrapTerrainData(i),i},_parseEventFromCoord:function(e){var n=this.coordToContainerPoint(e);return{coordinate:e,containerPoint:n,viewPoint:this.containerPointToViewPoint(n),point2d:this.coordToPoint(e)}},_getActualEvent:function(e){return e.touches&&e.touches.length>0?e.touches[0]:e.changedTouches&&e.changedTouches.length>0?e.changedTouches[0]:e},_fireDOMEvent:function(e,n,i){var o=this;if(!this.isRemoved()){var s=this._parseEvent(n,i);this._wrapTerrainData(s),er(i)?this.getRenderer().callInNextFrame((function(){o._fireEvent(s.domEvent&&s.domEvent._cancelBubble?"_"+i:i,s)})):this._fireEvent(i,s)}},_getEventParams:function(e){var n=this,i={domEvent:e},o=e.touches&&e.touches.length>0?e.touches[0]:e.changedTouches&&e.changedTouches.length>0?e.changedTouches[0]:e;if(o){var s=Bi(o,n.getContainer());i.coordinate=n.containerPointToCoordinate(s),i.containerPoint=s,i.viewPoint=n.containerPointToViewPoint(s),i.point2d=n._containerPointToPoint(s)}return this._wrapTerrainData(i),i}}),BA.addOnLoadHook("_registerDomEvents"),BA.include({isFullScreen:function(){var e=document;return!!(e.webkitIsFullScreen||e.mozFullScreen||e.msFullscreenElement||e.fullscreenElement)},requestFullScreen:function(e){return this._fireEvent("fullscreenstart"),this._requestFullScreen(e||this._containerDOM),this._fireEvent("fullscreenend"),this},cancelFullScreen:function(){return this._cancelFullScreen(),this._fireEvent("cancelfullscreen"),this},_requestFullScreen:function(e){if(e.requestFullscreen)e.requestFullscreen();else if(e.mozRequestFullScreen)e.mozRequestFullScreen();else if(e.webkitRequestFullScreen)e.webkitRequestFullScreen();else if(e.msRequestFullScreen)e.msRequestFullScreen();else{var n="fullscreen=1,status=no,resizable=yes,top=0,left=0,scrollbars=no,titlebar=no,menubar=no,location=no,toolbar=no,z-look=yes,width="+(screen.availWidth-8)+",height="+(screen.availHeight-45);null!==window.open(location.href,"_blank",n)&&(window.opener=null,window.close())}},_cancelFullScreen:function(){var e=document;if(document.exitFullscreen)document.exitFullscreen();else if(e.mozCancelFullScreen)e.mozCancelFullScreen();else if(e.webkitCancelFullScreen)e.webkitCancelFullScreen();else{null!==window.open(location.href,"_blank","fullscreen=no,status=yes,resizable=yes,scrollbars=no,titlebar=no,menubar=yes,location=yes,toolbar=yes,z-look=yes")&&(window.opener=null,window.close())}}}),BA.include({panTo:function(e,n={},i){if(!e)return this;if(d(n)&&(i=n,n={}),e=new Zh(e),void 0===n.animation||n.animation){var o=this.getProjection().project(e);return this._panAnimation(o,n.duration,i)}return this.setCenter(e),this},_panTo:function(e,n={}){return void 0===n.animation||n.animation?this._panAnimation(e,n.duration):(this.onMoveStart(),this._setPrjCenter(e),this.onMoveEnd(this._parseEventFromCoord(this.getCenter())),this)},panBy:function(e,n={},i){if(!e)return this;if(d(n)&&(i=n,n={}),e=new ee(e),this.getContainerExtent().ymin>0&&e.y>30){var o=e.y;e.y=30,e.x=30*e.x/o,console.warn("offset is limited to panBy when pitch is above maxPitch")}if(void 0===n.animation||n.animation){e=e.multi(-1);var s=this._containerPointToPrj(new ee(this.width/2+e.x,this.height/2+e.y));this._panAnimation(s,n.duration,i)}else{this.onMoveStart(),this._offsetCenterByPixel(e);var a=this.containerPointToCoord(new ee(this.width/2,this.height/2));this.onMoveEnd(this._parseEventFromCoord(a))}return this},_panAnimation:function(e,n,i){return this._animateTo({prjCenter:e},{duration:n||this.options.panAnimationDuration},i)}}),BA.include({computeLength:function(e,n){if(!this.getProjection())return null;var i=new Zh(e),o=new Zh(n);return i.equals(o)?0:this.getProjection().measureLength(i,o)},computeGeometryLength:function(e){return e._computeGeodesicLength(this.getProjection())},computeGeometryArea:function(e){return e._computeGeodesicArea(this.getProjection())},identify:function(e,n){var i=new Zh((e=e||{}).coordinate);return this._identify(e,n,(function(n){return n.identify(i,e)}))},identifyAtPoint:function(e,n){var i=e.includeInternals,o=e.tolerance,s=new ee((e=e||{}).containerPoint),a=this.containerPointToCoord(s);return this._identify(e,n,(function(n){var s,l=e.containerPoint;if(i&&!h(n.options.geometryEventTolerance)&&(e.tolerance=e.tolerance||0,e.tolerance+=n.options.geometryEventTolerance),n._hasGeoListeners&&i&&e.eventTypes.indexOf("mousemove")>=0&&!n._hasGeoListeners(e.eventTypes))return[];(s=n.identifyAtPoint?n.identifyAtPoint(l,e):a&&n.identify?n.identify(a,e):[],i&&(h(o)?delete e.tolerance:e.tolerance=o),s&&s.length)||(n.fire("identifyempty",e),n.getLayers&&d(n.getLayers)&&(n.getLayers()||[]).filter((function(e){return e})).forEach((function(n){n.fire("identifyempty",e)})));return s}))},_identify:function(e,n,i){var o=e.layers;if(!xe(o))return this;for(var s=e.eventTypes,a=[],l=0,c=o.length;l<c;l++)f(o[l])?a.push(this.getLayer(o[l])):a.push(o[l]);s&&(a=a.filter((function(e){return!e._hasGeoListeners||e._hasGeoListeners(s)})));for(var A=[],d=a.length-1;d>=0&&!(e.count&&A.length>=e.count);d--){var p=a[d];if(p&&p.getMap()&&(e.includeInvisible||p.isVisible())&&(e.includeInternals||!(p.getId().indexOf(An)>=0))){var g=i(p),v=p.getId();if(g)if(Array.isArray(g)){for(var w=0;w<g.length;w++)g[w]&&!g[w].getLayer&&h(g[w].layer)&&(g[w].layer=v);he(A,g)}else!g.getLayer&&h(g.layer)&&(g.layer=v),A.push(g)}}return n.call(this,A),this}}),BA.include({_zoom:function(e,n){this.options.zoomable&&!this.isZooming()&&(n=this._checkZoomOrigin(n),e=this._checkZoom(e),this.onZoomStart(e,n),this._frameZoom=this.getZoom(),this.onZoomEnd(e,n))},_zoomAnimation:function(e,n,i){this.options.zoomable&&!this.isZooming()&&(e=this._checkZoom(e),this.getZoom()!==e&&(n=this._checkZoomOrigin(n),this._startZoomAnim(e,n,i)))},_checkZoomOrigin:function(e){return(!e||this.options.zoomInCenter||this._isContainerPointOutOfMap(e))&&(e=new ee(this.width/2,this.height/2)),this.options.zoomOrigin&&(e=new ee(this.options.zoomOrigin)),e},_startZoomAnim:function(e,n,i){h(i)&&(i=1);var o=this._getResolution(this._startZoomVal)/this._getResolution(e),s=this.options.zoomAnimationDuration*Math.abs(o-i)/Math.abs(o-1);this._frameZoom=this._startZoomVal,this._animateTo({zoom:e,around:n},{continueOnViewChanged:!0,duration:s})},onZoomStart:function(e,n){this.options.zoomable&&!this.isZooming()&&(this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),delete this.cameraZenithDistance,this._zooming=!0,this._startZoomVal=this.getZoom(),this._startZoomCoord=n&&this._containerPointToPrj(n),this._fireEvent("zoomstart",{from:this._startZoomVal,to:e}))},onZooming:function(e,n,i){if(this.options.zoomable&&this._frameZoom!==e){h(i)&&(i=1),this._zoomTo(e,n);var o=this.getResolution(e),s=this.getResolution(this._startZoomVal)/o/i,a=this._startZoomCoord&&this.prjToContainerPoint(this._startZoomCoord,this._startZoomVal),l=this.getViewPoint();if(!this.isRotating()&&a&&!a.equals(n)&&1!==s){var c=this.getPitch(),A=a._sub(n)._multi(1/(1-s));c&&(A.y/=Math.cos(c*Math.PI/180)),n=n.add(A)}var f=n&&n.x||this.width/2,d=n&&n.y||this.height/2,p={view:[s,0,0,s,(f-l.x)*(1-s),(d-l.y)*(1-s)]},g=this.getDevicePixelRatio();p.container=[s,0,0,s,f*g*(1-s),d*g*(1-s)],this._fireEvent("zooming",{from:this._startZoomVal,to:e,origin:new ee(f,d),matrix:p}),this._frameZoom=e}},onZoomEnd:function(e,n){if(this.options.zoomable){var i=this._startZoomVal;this._zoomTo(e,n),this._zooming=!1,this._getRenderer().onZoomEnd(),this._suppressRecenter||this._recenterOnTerrain(),this._fireEvent("zoomend",{from:i,to:e}),this._verifyExtent(this._getPrjCenter())||this.options.limitExtentOnMaxExtent||this._panTo(this._prjMaxExtent.getCenter())}},_zoomTo:function(e,n){if(this._zoomLevel=e,this._calcMatrices(),n&&this._startZoomCoord){var i=this._containerPointToPoint(n)._sub(this._prjToPoint(this._getPrjCenter()));this._setPrjCoordAtOffsetToCenter(this._startZoomCoord,i)}},_checkZoom:function(e){var n=this.getMaxZoom(),i=this.getMinZoom();return e<i&&(e=i),e>n&&(e=n),e}});var Cd,Pd=Math.PI/180,Md=new Zh(0,0),Td=new ee(0,0),Sd=[0,-1,0],Id=[];function Ed(){return Qo(new Array(16))}BA.include({getFov:function(){return this._fov||(this._fov=.6435011087932844),this._fov/Pd},setFov:function(e){if(this.isZooming())return this;if(e=Math.max(.01,Math.min(60,e)),this._fov===e)return this;var n=this.getFov();return this._fov=e*Pd,this._calcMatrices(),this._renderLayers(),this._fireEvent("fovchange",{from:n,to:this.getFov()}),this},getBearing:function(){return this._angle?-this._angle/Pd:0},setBearing:function(e){var n={bearing:e};return this._validateView(n),this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._setBearing(n.bearing)},_setBearing:function(e){if(wt.ie9)throw new Error("map can't rotate in IE9.");var n=-pe(e,-180,180)*Pd;if(this._angle===n)return this;var i=this.getBearing();return this._fireEvent("rotatestart",{from:i,to:n}),this._angle=n,this._calcMatrices(),this._renderLayers(),this._fireEvent("rotate",{from:i,to:n}),this._fireEvent("rotateend",{from:i,to:n}),this},getPitch:function(){return this._pitch?this._pitch/Math.PI*180:0},setPitch:function(e){var n={pitch:e};return this._validateView(n),this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._setPitch(n.pitch)},_setPitch:function(e){if(wt.ie9)throw new Error("map can't tilt in IE9.");var n=_e(e,0,this.options.maxPitch)*Pd;if(this._pitch===n)return this;var i=this.getPitch();return this._fireEvent("pitchstart",{from:i,to:n}),this._pitch=n,this._calcMatrices(),this._renderLayers(),this._fireEvent("pitch",{from:i,to:n}),this._fireEvent("pitchend",{from:i,to:n}),this},setCameraMovements:function(e,n){var i=this;if(!Array.isArray(e)||!e.length)return this;if(e.forEach((function(e){i._validateView(e)})),this.setView({center:e[0].center,zoom:e[0].zoom,pitch:e[0].pitch,bearing:e[0].bearing}),1===e.length)return this;var o=1,s=function(a){if("finished"===a.state.playState){++o===e.length-1&&(s=null);var h=e[o];h.duration=h.timestamp-e[o-1].timestamp,n&&n.autoRotate&&(h.bearing=function(e,n){var i=w(e[0]),o=w(n[0]),s=w(e[1]),a=w(n[1]),h=Math.sin(o-i)*Math.cos(a),l=Math.cos(s)*Math.sin(a)-Math.sin(s)*Math.cos(a)*Math.cos(o-i);return C(Math.atan2(h,l))}(e[o-1].center,h.center)),i._setCameraMovement(h,s)}};2===e.length&&(s=null);var a=this.getBearing();this._setCameraMovement(Object.assign({bearing:a,duration:e[o].timestamp-e[o-1].timestamp},e[o]),s);return{play:function(){i._animPlayer.play()},pause:function(){i._animPlayer.pause()},cancel:function(){i._animPlayer.cancel()},finish:function(){i._animPlayer.finish()},reverse:function(){i._animPlayer.reverse()}}},_setCameraMovement:function(e,n){this.animateTo({zoom:e.zoom,center:e.center,pitch:e.pitch,bearing:e.bearing},{duration:e.duration,easing:"out"},n)},setCameraOrientation:function(e){var{position:n}=e;this._validateView(e);var{pitch:i,bearing:o}=e;i=i||0,o=o||0;var{zoom:s,cameraToGroundDistance:a}=this.getFitZoomForCamera(n,i),h=Math.sin(i*Pd)*a,l=pe(o,-180,180)*Pd,c=this.getGLRes(),A=new Zh(n[0],n[1]),f=this.coordToPointAtRes(A,c),d=new ee(0,0);d.x=f.x+h*Math.sin(l),d.y=f.y+h*Math.cos(l);var p=this._pointToPrjAtRes(d,this.getGLRes());return this._setPrjCenter(p),this.setView({bearing:o,pitch:i,zoom:s}),this},setCameraPosition:function(e){var n=this.getGLRes(),i=this.coordToPointAtRes(e,n);i.z=this.altitudeToPoint(e.z||0,n);var o=this.getCenter(),s=this.coordToPointAtRes(o,n);s.z=this.altitudeToPoint(o.z,n);var a=Ts([],i.toArray(),s.toArray());Cs(this.cameraUp||[0,0,0],0,0,1),this._pitch=Ls(a,this.cameraUp),Cs(Id,a[0],a[1],0),this._angle=-Ls(Id,Sd),this._zoomLevel=this.getFitZoomForCamera(e,this._pitch).zoom,this._calcMatrices()},getFitZoomForCamera:function(e,n){var i=Array.isArray(e)?e[2]:e.z,o=(this.centerAltitude||0)*this._meterToGLPoint,s=(i*this._meterToGLPoint-o)/Math.cos(n*Pd);return{zoom:this.getFitZoomForAltitude(s+o),cameraToGroundDistance:s}},getFitZoomForAltitude:function(e){for(var n=e*this._getFovRatio()*2/(this.height||1)*this.getGLRes(),i=this._getResolutions(),o=0;o<i.length-1;o++){if(i[o]===n)return o;if(i[o+1]===n)return o+1;if(n<i[o]&&n>i[o+1])return(o=(n-i[o])/(i[o+1]-i[o])+o)-1}return o},isTransforming:function(){return!(!this._pitch&&!this._angle)},getFrustumAltitude:function(){return this._frustumAltitude},_calcFrustumAltitude:function(){var e=90-this.getPitch(),n=this.getFov()/2,i=this.cameraPosition?this.cameraPosition[2]:0;if(n<=e)return i;n=Math.PI*n/180;var o=new ee(this.cameraPosition).distanceTo(new ee(this.cameraLookAt)),s=i*Math.tan(2*n);return i+Math.tan(n)*(o+s)},_pointToContainerPoint:function(e,n,i=0,o){var s=this._getResolution(n);return this._pointAtResToContainerPoint(e,s,i,o)},_pointAtResToContainerPoint:function(e,n,i=0,o){o||(o=new ee(0,0)),e=this._pointAtResToPoint(e,n,o);var s,a=this.isTransforming();return a||i||(s=this._prjToPoint(this._getPrjCenter(),void 0,Md)),this._toContainerPoint(o,a,i,s),o},_pointsAtResToContainerPoints:function(e,n,i=[],o=[]){var s=this.getPitch(),a=this.getBearing(),h=n/this._getResolution();if(0===s&&0===a&&!function(e){if(l(e))return 0!==e;if(Array.isArray(e)&&e.length>0)for(var n=0,i=e.length;n<i;n++)if(l(e[n])&&0!==e[n])return!0;return!1}(i)){var{xmin:c,ymin:A,xmax:f,ymax:d}=this.get2DExtent();if(f>c&&d>A){for(var{width:p,height:g}=this.getSize(),v=(f-c)/p,w=(d-A)/g,C=0,P=e.length;C<P;C++)if(e[C]){var T=o[C];T.x=e[C].x,T.y=e[C].y,T._multi(h),T.x=(T.x-c)*v,T.y=g-(T.y-A)*w}else o[C]=null;return o}}for(var S=Array.isArray(i),I=this.isTransforming(),E=this._prjToPoint(this._getPrjCenter(),void 0,Md),O=0,k=e.length;O<k;O++)if(e[O]){var L=o[O];L.x=e[O].x,L.y=e[O].y,L._multi(h),this._toContainerPoint(L,I,S?i[O]||0:i,E)}else o[O]=null;return o},_toContainerPoint:function(){var e=[0,0,0];return function(n,i,o,s){var a=this.width/2,h=this.height/2;if(i||o){this._altitudeScale||(this._altitudeScale=this.altitudeToPoint(100,this.getGLRes())/100);var l=this._glScale;Cs(e,n.x*l,n.y*l,o*this._altitudeScale);var c=this._projIfBehindCamera(e,this.cameraPosition,this.cameraForward);wd(c,c,this.projViewMatrix),n.x=c[0]*a+a,n.y=-c[1]*h+h}else n._sub(s.x,s.y),n.set(n.x,-n.y),n._add(a,h)}}(),_projIfBehindCamera:function(){var e=new Array(3),n=new Array(3),i=new Array(3);return function(o,s,a){Ts(e,o,s);var h=Os(a,e);return h<=0&&(Rs(n,a,1.01*h),Ps(o,s,Ts(i,e,n))),o}}(),_containerPointToPoint:function(e,n,i,o){var s=this._getResolution(n);return this._containerPointToPointAtRes(e,s,i,o)},_containerPointToPointAtRes:function(){var e=[0,0,0],n=[0,0,0];return function(i,o,s,a){if(this.isTransforming()){this.getContainerPointRay(e,n,i);var h=e[0],l=n[0],c=e[1],A=n[1],f=e[2],d=n[2],p=a?this.altitudeToPoint(a,o)*this._glScale:0,g=f===d?p:(p-f)/(d-f),v=fe(h,l,g),w=fe(c,A,g);return s?(s.x=v,s.y=w):s=new ee(v,w),s._multi(1/this._glScale),this._getResolution()===o?s:this._pointToPointAtRes(s,o,s)}var C=this._prjToPointAtRes(this._getPrjCenter(),o,s),P=this._getResolution()/o;return C._add(P*(i.x-this.width/2),-(P*(i.y-this.height/2)))}}(),getContainerPointRay:function(){var e=[0,0,0],n=[0,0,0,1],i=[0,0,0,1];return function(o,s,a,h=0,l=1){var c=this.width/2||1,A=this.height/2||1;Cs(e,(a.x-c)/c,(A-a.y)/A,0),Cs(n,e[0],e[1],h),Cs(i,e[0],e[1],l),n[3]=i[3]=1,wd(o,n,this.projViewMatrixInverse),wd(s,i,this.projViewMatrixInverse)}}(),_calcMatrices:(Cd=Ed(),function(){delete this._mapRes,delete this._mapGlRes,delete this._mapExtent2D,delete this._mapGlExtent2D;var e=this.getSize(),n=e.width||1,i=e.height||1;this._glScale=this.getGLScale();var o=this._getCameraWorldMatrix(),s=this.getFov()*Math.PI/180,a=this._getCameraFar(s,this.getPitch());this.cameraFar=a,this.cameraNear=this.cameraCenterDistance/20;var h=this.projMatrix||Ed();jo(h,s,n/i,this.cameraNear,a),this.projMatrix=h,this.viewMatrix=Zo(this.viewMatrix||Ed(),o),this.projViewMatrix=qo(this.projViewMatrix||Ed(),h,this.viewMatrix),this._calcCascadeMatrixes(),this.projViewMatrixInverse=qo(this.projViewMatrixInverse||Ed(),o,Zo(Cd,h)),this.domCssMatrix=this._calcDomMatrix(),this._frustumAltitude=this._calcFrustumAltitude(),this._mapRes=this._getResolution(),this._mapGlRes=this.getGLRes(),this._mapExtent2D=this.get2DExtent(),this._mapGlExtent2D=this.get2DExtentAtRes(this._mapGlRes)}),_getCameraFar:function(e,n){var i=this.cameraCenterDistance=ks(this.cameraPosition,this.cameraLookAt),o=i/this._meterToGLPoint;n=(n=Math.min(n,85))*Math.PI/180;var s=o+this.options.cameraFarUndergroundInMeter/Math.cos(n);return Math.max(s*this._meterToGLPoint,5*i)},_calcCascadeMatrixes:function(){var e=Ed();function n(n,i,o){var s=this.width,a=this.height,h=this.getFov()*Math.PI/180,l=this._getCameraFar(h,i),c=this.cameraCenterDistance;return l=c+(l-c)/Math.cos((90-i)*Math.PI/180)*Math.cos((90-n)*Math.PI/180),jo(e,h,s/a,.1,l),qo(o,e,this.viewMatrix)}return function(){var e=this.getPitch(),i=this.options.cascadePitches[0],o=this.options.cascadePitches[1],s=this.cascadeFrustumMatrix0=this.cascadeFrustumMatrix0||Ed(),a=this.cascadeFrustumMatrix1=this.cascadeFrustumMatrix1||Ed();e>i?n.call(this,e,i,s):Xo(this.cascadeFrustumMatrix0,this.projViewMatrix),e>o?n.call(this,e,o,a):Xo(this.cascadeFrustumMatrix1,this.cascadeFrustumMatrix0)}}(),_calcDomMatrix:function(){var e=Ed(),n=Ed(),i=[1,-1,1],o=[0,0,0];return function(){var s=this.width||1,a=this.height||1,h=.5/Math.tan(this._fov/2)*a;return Go(e,this.projMatrix,i),Uo(e,e,Cs(o,0,0,-h)),this._pitch&&Vo(e,e,this._pitch),this._angle&&Wo(e,e,this._angle),Qo(n),Go(n,n,Cs(o,s/2,-a/2,1)),qo(this.domCssMatrix||Ed(),n,e)}}(),_getFovZ:function(e){var n=this.getGLScale(e),i=this._getFovRatio();return n*(this.height||1)/2/i},_getCameraWorldMatrix:function(){var e={};return function(){var n=this.getGLRes();this._meterToGLPoint||(this._meterToGLPoint=this.distanceToPointAtRes(100,0,n).x/100);var i=this._prjToPointAtRes(this._prjCenter,n,Td),o=this.getCenter().z,s=(void 0!==o?o:this.centerAltitude||0)*this._meterToGLPoint;this.cameraLookAt=Cs(this.cameraLookAt||[0,0,0],i.x,i.y,s);var a=this.getPitch()*Pd,h=this.getBearing()*Pd,l=this._getFovZ(),c=(void 0===this.cameraZenithDistance?l:this.cameraZenithDistance)-s,A=c*Math.cos(a),f=Math.sin(a)*c,d=i.x-f*Math.sin(h),p=i.y-f*Math.cos(h);this.cameraPosition=Cs(this.cameraPosition||[0,0,0],d,p,A+s),this.cameraToCenterDistance=l,this.cameraUp=this.cameraUp||[0,0,0],this.cameraUp=this._getCameraUp(this.cameraUp,this.cameraLookAt,this.cameraPosition,a,h);var g=this.cameraWorldMatrix=this.cameraWorldMatrix||Ed();!function(e,n,i,o){var s=[0,0,0],a=[0,0,0],h=[0,0,0];Ts(h,n,i),0===Is(h)&&(h[2]=1),Es(h,h),Ds(s,o,h),0===Is(h)&&(1===Math.abs(o[2])?h[0]+=1e-4:h[2]+=1e-4,Es(h,h),Ds(s,o,h)),Es(s,s),Ds(a,h,s),e[0]=s[0],e[4]=a[0],e[8]=h[0],e[1]=s[1],e[5]=a[1],e[9]=h[1],e[2]=s[2],e[6]=a[2],e[10]=h[2]}(g,this.cameraPosition,this.cameraLookAt,this.cameraUp);var v=this.cameraForward||[0,0,0];return Ts(v,this.cameraLookAt,this.cameraPosition),this.cameraForward=Es(v,v),function(e,n){var i,o=n[0],s=n[4],a=n[8],h=n[1],l=n[5],c=n[9],A=n[2],f=n[6],d=n[10],p=o+l+d;p>0?(i=.5/Math.sqrt(p+1),e.w=.25/i,e.x=(f-c)*i,e.y=(a-A)*i,e.z=(h-s)*i):o>l&&o>d?(i=2*Math.sqrt(1+o-l-d),e.w=(f-c)/i,e.x=.25*i,e.y=(s+h)/i,e.z=(a+A)/i):l>d?(i=2*Math.sqrt(1+l-o-d),e.w=(a-A)/i,e.x=(s+h)/i,e.y=.25*i,e.z=(c+f)/i):(i=2*Math.sqrt(1+d-o-l),e.w=(h-s)/i,e.x=(a+A)/i,e.y=(c+f)/i,e.z=.25*i)}(e,g),function(e,n){var i=e,o=n.x,s=n.y,a=n.z,h=n.w,l=o+o,c=s+s,A=a+a,f=o*l,d=o*c,p=o*A,g=s*c,v=s*A,w=a*A,C=h*l,P=h*c,T=h*A;i[0]=1-(g+w),i[4]=d-T,i[8]=p+P,i[1]=d+T,i[5]=1-(f+w),i[9]=v-C,i[2]=p-P,i[6]=v+C,i[10]=1-(f+g),i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1}(g,e),function(e,n){var i=e;i[12]=n[0],i[13]=n[1],i[14]=n[2]}(g,this.cameraPosition),g}}(),_getCameraUp:function(){var e=[0,0,0],n=[0,0,0],i=[0,0,0];return function(o,s,a,h,l){Cs(i,0,0,1),0===h?Cs(i,Math.sin(l),Math.cos(l),0):h===Math.PI&&Cs(i,-Math.sin(l),-Math.cos(l),0);var c=Ts(e,s,a);Es(c,c);var A=Ds(n,c,i);return Ds(o,A,c)}}(),updateCenterAltitude:function(){this.getRenderer().setToRedraw(),!this.centerAltitude&&this._hasAltitudeLayer()&&(this.centerAltitude=0),this._recenterOnTerrain()},_recenterOnTerrain:function(){if(void 0!==this.centerAltitude&&void 0===this._centerZ){var e=this._queryTerrainByProjCoord(this._prjCenter);h(e)&&this._hasAltitudeLayer()&&(e=this.centerAltitude);var n=e||0,i=this.getPitch()*Pd,o=this.getBearing()*Pd,s=(n-this.centerAltitude)*this._meterToGLPoint,a=this._getFovZ(),l=(void 0===this.cameraZenithDistance?a:this.cameraZenithDistance)-this.centerAltitude*this._meterToGLPoint-s/Math.cos(i),c=this.cameraPosition,A=Math.sin(i)*l,f=Td;f.x=c[0]+A*Math.sin(o),f.y=c[1]+A*Math.cos(o);var d=n*this._meterToGLPoint;this.cameraZenithDistance=(c[2]-d)/Math.cos(i)+d,this.centerAltitude=n;var p=this.pointAtResToCoordinate(f,this.getGLRes(),Md);this._eventSilence=!0,this._suppressRecenter=!0,this.setCenter(p),delete this._suppressRecenter,delete this._eventSilence,h(e)&&delete this.centerAltitude}},_queryTerrainByProjCoord:function(e){for(var n=this._getLayers(),i=0;i<n.length;i++)if(n[i].queryTerrainByProjCoord)return n[i].queryTerrainByProjCoord(e)[0];return 0},_hasAltitudeLayer:function(){for(var e=this._getLayers(),n=0;n<e.length;n++)if(e[n].getTerrainLayer&&e[n].getTerrainLayer())return!0;return!1},_queryTerrainInfo:function(e){for(var n=this._getLayers()||[],i=0;i<n.length;i++){var o=n[i];if(e&&o&&o.queryTerrainAtPoint&&o.getTerrainLayer&&o.getTerrainLayer()){var s=o.queryTerrainAtPoint(e);if(s)return{coordinate:s,altitude:s.z};break}}return null},_query3DTilesInfo:function(e){for(var n=this._getLayers()||[],i=0;i<n.length;i++){var o=n[i];if(e&&o&&o.query3DTilesAtPoint){var s=o.query3DTilesAtPoint(e);if(s)return{coordinate:s,altitude:s.z};break}}return null},queryPrjCoordAtContainerPoint:function(e){var n=this._query3DTilesInfo(e);if(n||(n=this._queryTerrainInfo(e)),n){var i=this.getProjection().project(n.coordinate);return i.z=n.altitude,i}return this._isContainerPointOutOfMap(e)&&(e=new ee(this.width/2,this.height/2)),this._containerPointToPrj(e)},_getFovRatio:function(){var e=this.getFov();return Math.tan(e/2*Pd)},_renderLayers:function(){this.isInteracting()||this._getLayers().forEach((function(e){if(e){var n=e._getRenderer();n&&n.setToRedraw&&n.setToRedraw()}}))}}),BA.include({_onViewChange:function(e){this._viewHistory||(this._viewHistory=[],this._viewHistoryPointer=0);for(var n=this._getCurrentView(),i=this._viewHistory.length-1;i>=0;i--)if($e(e,this._viewHistory[i]))return this._viewHistoryPointer=i,void this._fireViewChange(n,e);this._viewHistoryPointer<this._viewHistory.length-1&&this._viewHistory.splice(this._viewHistoryPointer+1),this._viewHistory.push(e);var o=this.options.viewHistoryCount;o>0&&this._viewHistory.length>o&&this._viewHistory.splice(0,this._viewHistory.length-o),this._viewHistoryPointer=this._viewHistory.length-1,this._fireViewChange(n,e)},zoomToPreviousView:function(e={}){if(!this.hasPreviousView())return null;var n=this._viewHistory[--this._viewHistoryPointer];return this._zoomToView(n,e),n},hasPreviousView:function(){return!(!this._viewHistory||0===this._viewHistoryPointer)},zoomToNextView:function(e={}){if(!this.hasNextView())return null;var n=this._viewHistory[++this._viewHistoryPointer];return this._zoomToView(n,e),n},hasNextView:function(){return!(!this._viewHistory||this._viewHistoryPointer===this._viewHistory.length-1)},_zoomToView:function(e,n){var i=this,o=this.getView();n.animation?this._animateTo(e,{duration:n.duration},(function(n){"finished"===n.state.playState&&i._fireViewChange(o,e)})):(this.setView(e),this._fireViewChange(o,e))},getViewHistory:function(){return this._viewHistory},_fireViewChange:function(e,n){this._fireEvent("viewchange",{old:e,new:n}),this._insertUICollidesQueue()},_getCurrentView:function(){return this._viewHistory?this._viewHistory[this._viewHistoryPointer]:null}}),BA.mergeOptions({viewHistory:!0,viewHistoryCount:10});var Od=new eh;BA.include({getCollisionIndex:function(){return this._collisionIndex||this.createCollisionIndex(),this._collisionIndex||this.createCollisionIndex()},createCollisionIndex:function(){return this.clearCollisionIndex(),this._collisionIndex=new eh,this._collisionIndex},clearCollisionIndex:function(){return this.collisionFrameTime=0,this._collisionIndex&&this._collisionIndex.clear(),this},_insertUICollidesQueue:function(){return this._uiCollidesQueue||(this._uiCollidesQueue=[]),this._uiCollidesQueue.push(1),this},uiCollides:function(){if(!this.uiList||0===this.uiList.length||!this._uiCollidesQueue||0===this._uiCollidesQueue.length)return this;var e=Od;e.clear();for(var n=this.uiList,i=0,o=n.length;i<o;i++){var s=n[i],{collisionBufferSize:a,collision:h}=s.options;if(h){var l=s.getDOM();if(s.isVisible()&&l&&l.getBoundingClientRect){s.bbox||(s.bbox=[0,0,0,0]);var c=l.getBoundingClientRect(),{x:A,y:f}=c,{width:d,height:p}=c;if(0===d||0===p){var g=s.getSize();g&&(d=g.width,p=g.height)}var v=A+d+a,w=f-a,C=f+p+a;s.bbox[0]=A-a,s.bbox[1]=w,s.bbox[2]=v,s.bbox[3]=C,e.collides(s.bbox)?s._collidesEffect(!1):(e.insertBox(s.bbox),s._collidesEffect(!0))}}}return this._uiCollidesQueue=[],this},_addUI:function(e){return this.uiList||(this.uiList=[]),this.uiList.indexOf(e)>-1||(this.uiList.push(e),this.uiList=this.uiList.sort((function(e,n){return n.options.collisionWeight-e.options.collisionWeight}))),this},_removeUI:function(e){if(!this.uiList)return-1;var n=this.uiList.indexOf(e);return n<0||this.uiList.splice(n,1),n}});var Rd,Dd,kd=new Zh(0,0);BA.include({coordinateToPoint:function(e,n,i){var o=this._getResolution(n);return this.coordinateToPointAtRes(e,o,i)},coordinateToPointAtRes:function(){var e=new Zh(0,0);return function(n,i,o){var s=this.getProjection().project(n,e);return this._prjToPointAtRes(s,i,o)}}(),pointToCoordinate:function(){var e=new Zh(0,0);return function(n,i,o){var s=this._pointToPrj(n,i,e);return this.getProjection().unproject(s,o)}}(),pointAtResToCoordinate:function(){var e=new Zh(0,0);return function(n,i,o){var s=this._pointToPrjAtRes(n,i,e);return this.getProjection().unproject(s,o)}}(),coordinateToViewPoint:function(){var e=new Zh(0,0);return function(n,i,o){return this._prjToViewPoint(this.getProjection().project(n,e),i,o)}}(),viewPointToCoordinate:function(){var e=new Zh(0,0);return function(n,i){return this.getProjection().unproject(this._viewPointToPrj(n,e),i)}}(),coordinateToContainerPoint:function(e,n,i){var o=this._getResolution(n);return this.coordinateToContainerPointAtRes(e,o,i)},coordinateToContainerPointAtRes:function(){var e=new Zh(0,0);return function(n,i,o){var s=this.getProjection().project(n,e);return this._prjToContainerPointAtRes(s,i,o)}}(),coordinatesToContainerPoints:function(e,n){var i=this._getResolution(n);return this.coordinatesToContainerPointsAtRes(e,i)},coordinatesToContainerPointsAtRes:function(e,n){for(var i=[],o=this._spatialReference.getTransformation(),s=n/this._getResolution(),a=this.getProjection(),h=new Zh(0,0),l=this.isTransforming(),c=this._prjToPoint(this._getPrjCenter(),void 0,kd),A=0,f=e.length;A<f;A++){var d=a.project(e[A],h),p=o.transform(d,n);p=p._multi(s),this._toContainerPoint(p,l,e[A].z,c),i.push(p)}return i},containerPointToCoordinate:function(){var e=new Zh(0,0);return function(n,i){var o=this._containerPointToPrj(n,e);return this.getProjection().unproject(o,i)}}(),containerToExtent:function(){var e=new ee(0,0),n=new ee(0,0);return function(i){var o=new ll(this._containerPointToPoint(i.getMin(e),void 0,e),this._containerPointToPoint(i.getMax(n),void 0,n));return this._pointToExtent(o)}}(),distanceToPixel:function(){var e=new ee(0,0),n=new ee(0,0);return function(i,o,s){var a=this.getProjection();if(!a)return null;var h=this.getScale()/this.getScale(s),l=this.getCenter(),c=a.locate(l,i,o),A=this.coordToContainerPoint(l,void 0,e),f=this.coordToContainerPoint(c,void 0,n);return f._sub(A)._multi(h)._abs(),new Cn(f.x,f.y)}}(),distanceToPoint:function(e,n,i,o){var s=this._getResolution(i);return this.distanceToPointAtRes(e,n,s,o)},distanceToPointAtRes:function(){var e=new ee(0,0),n=new Zh(0,0);return function(i,o,s,a,h){var l=this.getProjection();if(!l)return null;var c=a||this.getCenter(),A=l.locate(c,i,o,n),f=this.coordToPointAtRes(c,s,e),d=this.coordToPointAtRes(A,s,h);return d._sub(f)._abs(),d}}(),altitudeToPoint:(Rd=new Zh(0,40),Dd=new ee(0,0),function(e=0,n,i){this._altitudeOriginDirty&&(Rd.x=this._originLng,this._altitudeOriginDirty=!1);var o=this.distanceToPointAtRes(e,e,n,i||Rd,Dd);e<0&&o.x>0&&(o.x=-o.x);var s=this.options.heightFactor;return s&&1!==s&&(o.x*=s,o.y*=s),o.x}),pointAtResToAltitude:function(){var e=new Zh(0,40);return function(n=0,i,o){return this.pointAtResToDistance(n,0,i,o||e)}}(),pixelToDistance:function(){var e=new Zh(0,0),n=new Zh(0,0),i=new Zh(0,0),o=new Zh(0,0);return function(s,a){var h=this.getProjection();if(!h)return null;var l=this.getFullExtent(),c=l.top>l.bottom?-1:1,A=e.set(this.width/2,this.height/2),f=n.set(this.width/2+s,this.height/2+c*a),d=this.containerPointToCoord(A,i),p=this.containerPointToCoord(f,o);return h.measureLength(d,p)}}(),pointToDistance:function(e,n,i){var o=this.getResolution(i);return this.pointAtResToDistance(e,n,o)},pointAtResToDistance:function(){var e=new ee(0,0),n=new Zh(0,0),i=new Zh(0,0),o=new Zh(0,0);return function(s,a,h,l){var c=this.getProjection();if(!c)return null;var A=l?c.project(l,n):this._getPrjCenter(),f=this._prjToPointAtRes(A,h,e);f._add(s,a);var d=this.pointAtResToCoord(f,h,i),p=l||c.unproject(A,o);return c.measureLength(p,d)}}(),locateByPoint:function(){var e=new ee(0,0);return function(n,i,o){var s=this.coordToContainerPoint(n,void 0,e);return this.containerPointToCoord(s._add(i,o))}}(),_get2DExtent:function(e,n){var i;if(void 0!==e&&e!==this._zoomLevel||!this._mapExtent2D||(i=this._mapExtent2D),i)return n?(n.set(i.xmin,i.ymin,i.xmax,i.ymax),n):i.copy();var o=this._getResolution(e);return this._get2DExtentAtRes(o,n)},get2DExtent:function(e,n){return this._get2DExtent(e,n)},_get2DExtentAtRes:function(){var e=new ee(0,0);return function(n,i){var o=this;return n===this._mapGlRes&&this._mapGlExtent2D?this._mapGlExtent2D:this.getContainerExtent().convertTo((function(i){return o._containerPointToPointAtRes(i,n,e)}),i)}}(),get2DExtentAtRes:function(e,n){return this._get2DExtentAtRes(e,n)},pointToExtent:function(e){return this._pointToExtent(e)},_pointToExtent:function(){var e=new Zh(0,0),n=new Zh(0,0);return function(i){var o=i.getMin(),s=i.getMax(),a=this.getFullExtent(),[h,l]=!a||a.left<=a.right?[o.x,s.x]:[s.x,o.x],[c,A]=!a||a.top>a.bottom?[s.y,o.y]:[o.y,s.y],f=o.set(h,A),d=s.set(l,c);return new al(this.pointToCoord(f,void 0,e),this.pointToCoord(d,void 0,n),this.getProjection())}}(),getViewPointFrameOffset:function(){var e=new ee(0,0);return function(){if(this.isZooming())return null;var n=this._getPrjCenter();return this._mapViewCoord&&!this._mapViewCoord.equals(n)?this._prjToContainerPoint(this._mapViewCoord)._sub(this._prjToContainerPoint(n,void 0,e)):null}}(),_viewPointToPrj:function(){var e=new ee(0,0);return function(n,i){return this._containerPointToPrj(this.viewPointToContainerPoint(n,e),i)}}(),viewPointToPrj:function(e,n){return this._viewPointToPrj(e,n)},_prjToContainerPoint:function(e,n,i,o){var s=this._getResolution(n);return this._prjToContainerPointAtRes(e,s,i,o)},prjToContainerPoint:function(e,n,i,o){return this._prjToContainerPoint(e,n,i,o)},_prjToContainerPointAtRes:function(){var e=new ee(0,0);return function(n,i,o,s){return this._pointAtResToContainerPoint(this._prjToPointAtRes(n,i,e),i,s||0,o)}}(),prjToContainerPointAtRes:function(e,n,i,o){return this.prjToContainerPointAtRes(e,n,i,o)},_prjToViewPoint:function(){var e=new ee(0,0);return function(n,i,o){var s=this._prjToContainerPoint(n,void 0,e,o);return this.containerPointToViewPoint(s,i)}}(),prjToViewPoint:function(e,n,i){return this._prjToViewPoint(e,n,i)},_viewPointToPoint:function(){var e=new ee(0,0);return function(n,i,o){return this._containerPointToPoint(this.viewPointToContainerPoint(n,e),i,o)}}(),viewPointToPoint:function(e,n,i){return this._viewPointToPoint(e,n,i)},_pointToViewPoint:function(){var e=new Zh(0,0);return function(n,i,o){return this._prjToViewPoint(this._pointToPrj(n,i,e),o)}}(),pointToViewPoint:function(e,n,i){return this._pointToViewPoint(e,n,i)}});var Ld={distancetool:{start:"",units:{mile:" ",feet:" ",kilometer:" ",meter:" "}},areatool:{units:{mile:" ",feet:" ",kilometer:" ",meter:" "}}},Fd={distancetool:{start:"Inicio",units:{mile:" mi",feet:" ft",kilometer:" km",meter:" m"}},areatool:{units:{mile:" mi",feet:" ft",kilometer:" km",meter:" m"}}},Nd={distancetool:{start:"Start",units:{mile:" mi",feet:" ft",kilometer:" km",meter:" m"}},areatool:{units:{mile:" mi",feet:" ft",kilometer:" km",meter:" m"}}},zd=function(e){function n(n){var i;return(i=e.call(this,"Translator: "+n)||this).name="TranslatorError",i}return kt(n,e),n}(Ht(Error)),Bd=function(e){function n(n){var i;return(i=e.call(this)||this).languages={"zh-CN":Ld,"es-MX":Fd,"en-US":Nd},i.setLang(n||"zh-CN"),i}kt(n,e);var i=n.prototype;return i.setLang=function(e){var n=this.languages[e];if(!n)throw new zd("Setted Lang does not exist");this.nodes=n},i._validateNestedProps=function(e){e.forEach((function(e){if(""===e)throw new zd('Any of sides of a dot "." cannot be empty')}))},i.translate=function(e=null){if(null==e)throw new zd("Missing parameter textNode");if("string"!=typeof e)throw new zd("Param passed has to be a String");if(!e.includes("."))return this.nodes[e];var n=e.split(".");if(n.length>3)throw new zd("Translate function can only access through 3 nested properties, trying to access -> "+n.length);this._validateNestedProps(n);try{var i=null;switch(n.length){case 2:i=this.nodes[n[0]][n[1]];break;case 3:i=this.nodes[n[0]][n[1]][n[2]]}return i}catch(e){throw new zd("Unable to find the text translated in lang json"+e.message)}},n}(Ih),Hd=function(e){function n(n){var i;return(i=e.call(this,n)||this).on("enable",i._afterEnable,i).on("disable",i._afterDisable,i),i._measureLayers=[],i.translator=new Bd(i.options.language),i}kt(n,e);var i=n.prototype;return i.clear=function(){if(xe(this._measureLayers))for(var e=0;e<this._measureLayers.length;e++)this._measureLayers[e].remove();return delete this._lastMeasure,delete this._lastVertex,this._outLayers(this._measureLayers),this._measureLayers=[],this},i.getMeasureLayers=function(){return this._measureLayers},i.getLastMeasure=function(){return this._lastMeasure?this._lastMeasure:0},i.undo=function(){e.prototype.undo.call(this);var n=this._historyPointer;if(n!==this._vertexes.length)for(var i=n;i<this._vertexes.length;i++)this._vertexes[i].label&&this._vertexes[i].label.remove(),this._vertexes[i].marker.remove();return this},i.redo=function(){e.prototype.redo.call(this);var n=this._historyPointer-1;return this._vertexes[n]&&(this._vertexes[n].marker.getLayer()||(this._vertexes[n].label&&this._vertexes[n].label.addTo(this._measureMarkerLayer),this._vertexes[n].marker.addTo(this._measureMarkerLayer))),this},i._formatLabelContent=function(e){var n=this.options.formatLabelContent;return n&&d(n)?n.call(this,e)+"":null},i._measure=function(e){var n,i=this.getMap();e instanceof _A?n=i.computeGeometryLength(e):Array.isArray(e)&&(n=i.getProjection().measureLength(e)),this._lastMeasure=n;var o=this._formatLabelContent(n);if(o)return o;var s=[this.translator.translate("distancetool.units.meter"),this.translator.translate("distancetool.units.kilometer"),this.translator.translate("distancetool.units.feet"),this.translator.translate("distancetool.units.mile")],a="",h=this.options.decimalPlaces;return this.options.metric&&(a+=n<1e3?n.toFixed(h)+s[0]:(n/1e3).toFixed(h)+s[1]),this.options.imperial&&(a.length>0&&(a+="\n"),a+=(n*=3.2808399)<5280?n.toFixed(h)+s[2]:(n/5280).toFixed(h)+s[3]),a},i._registerMeasureEvents=function(){this.on("drawstart",this._msOnDrawStart,this).on("drawvertex",this._msOnDrawVertex,this).on("mousemove",this._msOnMouseMove,this).on("drawend",this._msOnDrawEnd,this)},i._afterEnable=function(){this._registerMeasureEvents()},i._afterDisable=function(){this.off("drawstart",this._msOnDrawStart,this).off("drawvertex",this._msOnDrawVertex,this).off("mousemove",this._msOnMouseMove,this).off("drawend",this._msOnDrawEnd,this)},i._msOnDrawStart=function(e){var n=this.getMap(),i=oe(),o="distancetool_"+i,s="distancetool_markers_"+i,a=this.options.zIndex,h=this.options.enableAltitude;n.getLayer(o)?(this._measureLineLayer=n.getLayer(o),this._measureMarkerLayer=n.getLayer(s)):(this._measureLineLayer=new ad(o,{zIndex:a,enableAltitude:h}).addTo(n),this._measureMarkerLayer=new ad(s,{zIndex:a,enableAltitude:h}).addTo(n)),this._measureLayers.push(this._measureLineLayer),this._measureLayers.push(this._measureMarkerLayer),this._pushLayers([this._measureLineLayer,this._measureMarkerLayer]);var l=this._getFirstCoordinate()||e.coordinate,c=new pf(l.copy(),{symbol:this.options.vertexSymbol}),A=this.translator.translate("distancetool.start"),f=new Xf(A,l.copy(),this.options.labelOptions);this._lastVertex=f,this._addVertexMarker(c,f)},i._msOnMouseMove=function(e){var n=this._measure(this._msGetCoordsToMeasure(e));if(!this._tailMarker){var i=ko(this.options.vertexSymbol);i.markerWidth/=2,i.markerHeight/=2,this._tailMarker=new pf(e.coordinate,{symbol:i}).addTo(this._measureMarkerLayer),this._tailLabel=new Xf(n,e.coordinate,this.options.labelOptions).addTo(this._measureMarkerLayer)}var o=this._getLasttCoordinate()||e.coordinate;this._tailMarker.setCoordinates(o.copy()),this._tailLabel.setContent(n),this._tailLabel.setCoordinates(o.copy())},i._msGetCoordsToMeasure=function(e){return e.geometry.getCoordinates().concat([e.coordinate])},i._msOnDrawVertex=function(e){var n=this._getLasttCoordinate()||e.coordinate,i=e.geometry,o=new pf(n.copy(),{symbol:this.options.vertexSymbol}),s=this._measure(i),a=new Xf(s,n.copy(),this.options.labelOptions);this._addVertexMarker(o,a),this._lastVertex=a},i._addVertexMarker=function(e,n){this._vertexes||(this._vertexes=[]),void 0!==this._historyPointer&&this._vertexes.length>this._historyPointer-1&&(this._vertexes.length=this._historyPointer-1),this._vertexes.push({label:n,marker:e}),this._measureMarkerLayer.addGeometry(e),n&&this._measureMarkerLayer.addGeometry(n)},i._msOnDrawEnd=function(e){if(this._clearTailMarker(),e.geometry.getCoordinates().length<2)return this._lastMeasure=0,void this._clearMeasureLayers();var n=this._lastVertex.getSize();n||(n=new Cn(10,10)),this._addClearMarker(this._lastVertex.getCoordinates(),this._lastVertex._getPrjCoordinates(),n.width);var i=e.geometry.copy();i.setCoordinates(e.geometry.getCoordinates()),i.addTo(this._measureLineLayer),this._lastMeasure=i.getLength()},i._addClearMarker=function(e,n,i){var o=this.options.clearButtonSymbol,s={markerDx:(o.markerDx||0)+i,textDx:(o.textDx||0)+i};Array.isArray(o)&&(s=o.map((function(e){return e?{markerDx:(e.markerDx||0)+i,textDx:(e.textDx||0)+i}:null}))),o=ko(o,s);var a=new pf(e,{symbol:o}),h=this._measureLineLayer,l=this._measureMarkerLayer;a.on("click",(function(){return h.remove(),l.remove(),!1}),this),a.addTo(this._measureMarkerLayer)},i._clearTailMarker=function(){this._tailMarker&&(this._tailMarker.remove(),delete this._tailMarker),this._tailLabel&&(this._tailLabel.remove(),delete this._tailLabel)},i._clearMeasureLayers=function(){this._measureLineLayer.remove(),this._measureMarkerLayer.remove()},i._getFirstCoordinate=function(){return this._geometry?(this._geometry.getCoordinates()||[])[0]:null},i._getLasttCoordinate=function(){if(!this._geometry)return null;var e=this._geometry.getCoordinates()||[];return e[e.length-1]},n}(Ad);Hd.mergeOptions({formatLabelContent:null,decimalPlaces:2,mode:"LineString",language:"zh-CN",metric:!0,imperial:!1,symbol:{lineColor:"#000",lineWidth:3,lineOpacity:1},vertexSymbol:{markerType:"ellipse",markerFill:"#fff",markerLineColor:"#000",markerLineWidth:3,markerWidth:11,markerHeight:11},labelOptions:{textSymbol:{textFaceName:"monospace",textLineSpacing:1,textHorizontalAlignment:"right",textDx:15},boxStyle:{padding:[6,2],symbol:{markerType:"square",markerFill:"#fff",markerFillOpacity:.9,markerLineColor:"#b4b3b3"}}},clearButtonSymbol:[{markerType:"square",markerFill:"#fff",markerLineColor:"#b4b3b3",markerLineWidth:2,markerWidth:15,markerHeight:15,markerDx:20},{markerType:"x",markerWidth:10,markerHeight:10,markerDx:20}]});var jd=function(e){function n(n){var i;return(i=e.call(this,n)||this).translator=new Bd(i.options.language),i._measureLayers=[],i}kt(n,e);var i=n.prototype;return i._measure=function(e){var n,i=this.getMap();e instanceof _A?n=i.computeGeometryArea(e):Array.isArray(e)&&(n=i.getProjection().measureArea(e)),this._lastMeasure=n;var o=this._formatLabelContent(n);if(o)return o;var s=[this.translator.translate("areatool.units.meter"),this.translator.translate("areatool.units.kilometer"),this.translator.translate("areatool.units.feet"),this.translator.translate("areatool.units.mile")],a="",h=this.options.decimalPlaces;if(this.options.metric&&(a+=n<1e6?n.toFixed(h)+s[0]:(n/1e6).toFixed(h)+s[1]),this.options.imperial){n*=Math.pow(3.2808399,2),a.length>0&&(a+="\n");var l=27878400;a+=n<l?n.toFixed(h)+s[2]:(n/l).toFixed(h)+s[3]}return a},i._msGetCoordsToMeasure=function(e){return e.geometry.getShell().concat([e.coordinate])},i._msOnDrawVertex=function(e){var n=this._getLasttCoordinate()||e.coordinate,i=new pf(n.copy(),{symbol:this.options.vertexSymbol});this._measure(e.geometry),this._lastVertex=i,this._addVertexMarker(i)},i._msOnDrawEnd=function(e){var n;this._clearTailMarker();var i=this.getMap();if(e.point2d)n=i._pointToPrj(e.point2d);else{var o=e.geometry._getPrjCoordinates()||[];n=(o=o.slice(0,o.length-1))[o.length-1]}if(e.geometry.getShell().length<3)return this._lastMeasure=0,void this._clearMeasureLayers();var s=this._measure(e.geometry),a=this._getLasttCoordinate(),h=new Xf(s,a.copy(),this.options.labelOptions).addTo(this._measureMarkerLayer).getSize();h||(h=new Cn(10,10)),this._addClearMarker(a.copy(),n,h.width);var l=e.geometry.copy();l.setCoordinates(e.geometry.getCoordinates()),l.addTo(this._measureLineLayer),this._lastMeasure=l.getArea()},n}(Hd);function Ud(e,n,i){var o,s,a=Array.isArray(n);if(a||(n=[n]),i&&i.drawTool&&i.drawTool.options&&(s=i.drawTool.options.transformCoordinate),s&&d(s))o=n.map((function(n){return e.unproject(n)})),o=o.map((function(e){return s(e,i)||e}));else{if(!i||!i.target||!i.target._queryTerrainInfo)return o=n.map((function(n){return e.unproject(n)})),a?o:o[0];var h=i.target,l=i.enableAltitude;o=n.map((function(n){if(l){var i=h.prjToContainerPoint(n),o=h._queryTerrainInfo(i);if(o&&o.coordinate)return o.coordinate}return e.unproject(n)}))}return a?o:o[0]}jd.mergeOptions({mode:"Polygon",symbol:{lineColor:"#000000",lineWidth:2,lineOpacity:1,lineDasharray:"",polygonFill:"#ffffff",polygonOpacity:.5},language:"zh-CN"});var Gd={create:function(e,n,i){var o=Ud(e,n[0],i);return new Df(o,0)},update:function(e,n,i,o){var s=i.getMap(),a=Ud(e,Array.isArray(n)?n[n.length-1]:n,o),h=s.computeLength(i.getCenter(),a);i.setRadius(h)},generate:function(e){return e}};Ad.registerMode("circle",a({clickLimit:2,action:["click","mousemove","click"]},Gd)),Ad.registerMode("freeHandCircle",a({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},Gd));var Vd={create:function(e,n,i){var o=Ud(e,n[0],i);return new Lf(o,0,0)},update:function(e,n,i,o){var s=i.getMap(),a=i.getCenter(),h=Ud(e,Array.isArray(n)?n[n.length-1]:n,o),l=s.computeLength(a,new Zh({x:h.x,y:a.y})),c=s.computeLength(a,new Zh({x:a.x,y:h.y}));i.setWidth(2*l),i.setHeight(2*c)},generate:function(e){return e}};Ad.registerMode("ellipse",a({clickLimit:2,action:["click","mousemove","click"]},Vd)),Ad.registerMode("freeHandEllipse",a({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},Vd));var Wd={create:function(e,n){var i=new Af([]);return i._firstClick=n[0],i},update:function(e,n,i,o){var s=i.getMap(),a=o.containerPoint,h=s.prjToContainerPoint(i._firstClick),l=[[h.x,h.y],[a.x,h.y],[a.x,a.y],[h.x,a.y]].map((function(e){return s._containerPointToPrj(new ee(e))})),c=Ud(e,l,o);i.setCoordinates(c)},generate:function(e){return e}};Ad.registerMode("rectangle",a({clickLimit:2,action:["click","mousemove","click"]},Wd)),Ad.registerMode("freeHandRectangle",a({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},Wd)),Ad.registerMode("point",{clickLimit:1,action:["click","mousemove"],create:function(e,n,i){var o=Ud(e,n[0],i);return new pf(o)},generate:function(e){return e},update:function(e,n,i,o){if(Array.isArray(n)&&(n=n[n.length-1]),!n)return i;var s=Ud(e,n,o);return i.setCoordinates(s),i}});var qd={create:function(e,n,i){var o=Ud(e,n,i),s=new mf(o);return s.setCoordinates(o),s},update:function(e,n,i,o){var s,a=i.getSymbol();Array.isArray(n)?s=n:(s=i._drawPrjs||[]).push(n),i._drawPrjs=s;var h=Ud(e,s,o);i.setCoordinates(h);var l=i.getLayer();if(l){var c=l.getGeometryById("polygon");if(!c&&s.length>=3){if(c=new Af([h],{id:"polygon",zIndex:-1}),a){var A=ko(a,{lineOpacity:0});c.setSymbol(A)}c.addTo(l)}c&&c.setCoordinates([h])}},generate:function(e){var n=new Af(e.getCoordinates(),{symbol:e.getSymbol(),properties:e.getProperties()});return n._projCode=e._projCode,n}};Ad.registerMode("polygon",a({action:["click","mousemove","dblclick"]},qd)),Ad.registerMode("freeHandPolygon",a({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},qd));var Zd={create:function(e,n,i){var o=Ud(e,n,i),s=new mf(o);return s.setCoordinates(o),s},update:function(e,n,i,o){var s;Array.isArray(n)?s=n:(s=i._drawPrjs||[]).push(n),i._drawPrjs=s;var a=Ud(e,s,o);i.setCoordinates(a)},generate:function(e){return e}};Ad.registerMode("linestring",a({action:["click","mousemove","dblclick"]},Zd)),Ad.registerMode("freeHandLinestring",a({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},Zd)),Ad.registerMode("arccurve",{action:["click","mousemove","dblclick"],create:function(e,n){var i=n.map((function(n){return e.unproject(n)})),o=new Hf(i);return o._setPrjCoordinates(n),o},update:Zd.update,generate:function(e){return e}}),Ad.registerMode("quadbeziercurve",{action:["click","mousemove","dblclick"],create:function(e,n){var i=n.map((function(n){return e.unproject(n)})),o=new Uf(i);return o._setPrjCoordinates(n),o},update:Zd.update,generate:function(e){return e}}),Ad.registerMode("cubicbeziercurve",{action:["click","mousemove","dblclick"],create:function(e,n){var i=n.map((function(n){return e.unproject(n)})),o=new jf(i);return o._setPrjCoordinates(n),o},update:Zd.update,generate:function(e){return e}}),Ad.registerMode("boxZoom",{action:["mousedown","mousemove","mouseup"],create:function(e,n){var i=e.unproject(n=n[0]),o=new pf(i);return o._firstClick=n,o},update:function(e,n,i,o){var s=i.getMap(),a=s.prjToContainerPoint(i._firstClick),h=o.containerPoint;n=s._containerPointToPrj(new Zh(Math.min(a.x,h.x),Math.min(a.y,h.y)));var l=e.unproject(n);i.setCoordinates(l)._setPrjCoordinates(n),i.updateSymbol({markerWidth:Math.abs(a.x-h.x),markerHeight:Math.abs(a.y-h.y)})},generate:function(e){return e}});var Xd=function(e){function n(n){var i;return(i=e.call(this,n)||this).proxyOptions(),i}kt(n,e);var i=n.prototype;return i._appendCustomClass=function(e){if(!e)return console.warn("dom is null:",e),this;if(this.options.cssName){var n=this.options.cssName;Array.isArray(n)||(n=[n]),n.forEach((function(n){e.classList.add(n)}))}return this},i.onAdd=function(){},i.onRemove=function(){},i.onDomRemove=function(){},i.getEvents=function(){return{}},i.getOwnerEvents=function(){return{}},i.buildOn=function(){return null},i.addTo=function(e){return this._owner=e,this._switchEvents("on"),this.onAdd&&this.onAdd(),this.fire("add"),this},i.getMap=function(){return this._owner?this._owner.getBaseLayer?this._owner:this._owner.getMap():null},i._collides=function(){var e=this.getMap();return e?(e._addUI(this),e._insertUICollidesQueue(),this):this},i._collidesEffect=function(e){var n=this.getDOM();if(!n)return this;if(n.style.visibility=e?"visible":"hidden",!n.classList||!n.classList.add)return this;if(!this.options.collisionFadeIn)return this;var i="mtk-ui-fadein",o=n.classList.contains(i);return e&&!o?n.classList.add(i):!e&&o&&n.classList.remove(i),this},i.show=function(e){var n=this,i=this.getMap();if(!i)return this;this.options.visible=!0,(e=e||this._coordinate||this._owner.getCenter())instanceof Zh||(e=new Zh(e));var o=this.isVisible();this._showBySymbolChange||this.fire("showstart");var s=this._getUIContainer();this._coordinate=e,this._removePrevDOM(),this._mapEventsOn||this._switchMapEvents("on");var a=this.__uiDOM=this.buildOn();a.eventsPropagation=this.options.eventsPropagation,this._observerDomSize(a);var h=this.options.zIndex;if(!a)return this._showBySymbolChange||this.fire("showend"),this._collides(),this.setZIndex(h),this;this._measureSize(a),this._singleton()&&(a._uiComponent=this,i[this._uiDomKey()]=a),this._setPosition(),a.style[wi]=null,s.appendChild(a);var l=this._getAnimation();if(o&&(l.ok=!1),l.ok&&(l.fade&&(a.style.opacity="0"),l.scale)){if(this.getTransformOrigin){var c=this.getTransformOrigin();a.style[bi]=c}a.style[xi]=this._toCSSTranslate(this._pos)+" scale(0)"}this.isSupportZoomFilter()||(a.style.display=""),this.options.eventsToStop&&$i(a,this.options.eventsToStop,ki);var A=l.transition;return l.ok&&A&&(A&&(a.style[wi]=A),l.fade&&(a.style.opacity="1"),l.scale&&(a.style[xi]=this._toCSSTranslate(this._pos)+" scale(1)")),this._showBySymbolChange||this.fire("showend"),this._collides(),clearTimeout(this._autoPanId),this.options.autoPan&&(this._autoPanId=setTimeout((function(){n._autoPan()}),32)),this.setZIndex(h),this},i.hide=function(){var e=this;if(!this.getDOM())return this;this._onDomMouseout&&this._onDomMouseout(),this.options.visible=!1;var n=this._getAnimation(),i=this.getDOM();return this.options.animationOnHide||(n.ok=!1),n.ok?(i.style[wi]=n.transition,setTimeout((function(){i.style.display="none",e.fire("hide")}),this.options.animationDuration)):(i.style.display="none",this.fire("hide")),n.fade&&(i.style.opacity="0"),n.scale&&(i.style[xi]=this._toCSSTranslate(this._pos)+" scale(0)"),this._switchMapEvents("off"),this._collides(),this},i.isVisible=function(){if(!this.options.visible)return!1;var e=this.getDOM();return this.getMap()&&e&&e.parentNode&&"none"!==e.style.display},i.remove=function(){if(delete this._mapEventsOn,!this._owner)return this;var e=this.getMap();return e&&e._removeUI(this),this.hide(),this._switchEvents("off"),this.onRemove&&this.onRemove(),!this._singleton()&&this.__uiDOM&&this._removePrevDOM(),delete this._owner,this.fire("remove"),this._collides(),this},i.getSize=function(){return this._domContentRect&&this._size&&(this._size.width=this._domContentRect.width,this._size.height=this._domContentRect.height),this._size?this._size.copy():null},i.getOwner=function(){return this._owner},i.getDOM=function(){return this.__uiDOM},i.setZIndex=function(e){if(!l(e))return this;var n=this.getDOM();return n?(n.style.zIndex=e+"",e!==this.options.zIndex&&(this.options.zIndex=e),this):this},i._roundPoint=function(e){return this.options.roundPoint&&(e=e._round()),e},i.getPosition=function(){if(!this.getMap())return null;var e=this._roundPoint(this._getViewPoint());if(this.getOffset){var n=this._roundPoint(this.getOffset());n&&e._add(n)}return e},i._getAnimation=function(){for(var e={fade:!1,scale:!1,ok:!1,transition:""},n=this.options.animation?this.options.animation.split(","):[],i=0;i<n.length;i++){var o=Fn(n[i]);"fade"===o?e.fade=!0:"scale"===o&&(e.scale=!0)}var s=null;return e.fade&&(s="opacity "+this.options.animationDuration+"ms"),e.scale&&(s=s?s+",":"",s+=xi+" "+this.options.animationDuration+"ms"),e.transition=s,e.ok=null!==s,e},i._getViewPoint=function(){var e=0,n=this._coordinate||{};if(l(n.z)?e=n.z:this._owner&&this._owner.getAltitude&&(l(e=this._owner.getAltitude()||0)||(e=0)),this._owner.getLayer){var i=this._owner.getLayer();i&&i.isVectorLayer&&(l(e=this._owner._getAltitude()||0)||(e=0))}var o=this._meterToPoint(this._coordinate,e);return this.getMap().coordToViewPoint(this._coordinate,void 0,o)._add(this.options.dx,this.options.dy)},i._meterToPoint=function(e,n){return n},i._autoPan=function(){var e=this.getMap(),n=this.getDOM();if(n&&e&&!e.isMoving()){var i=this._getViewPoint()._round(),o=e.width,s=e.height,a=e.getContainer();if(n&&a&&n.getBoundingClientRect){var h=a.getBoundingClientRect(),l=h.left,c=h.top,A=50,f=n.getBoundingClientRect(),d=0,p=0,{left:g,right:v,top:w,bottom:C}=f,{width:P,height:T}=f;if(g-=l,v-=l,w-=c,C-=c,P>0&&T>0){if(g<A&&(d=A-g),0===d&&v+A>o&&(d=-(v+A-o)),w<A&&(p=A-w),0===p&&C+A>s&&(p=-(C+A-s)),0!==d||0!==p)e.getPitch()>40&&0!==p&&this._coordinate?e.animateTo({center:this._coordinate},{duration:e.options.panAnimationDuration}):e.panBy([Math.ceil(d),Math.ceil(p)]);return}}var S=e.viewPointToContainerPoint(i),I=this.getOffset(),E=S.add(I),O=e.viewPointToPrj(i),k=parseInt(n.clientWidth+""),L=parseInt(n.clientHeight+""),F=0,N=0;if(E.x<0?F=50-E.x:E.x+k>o&&(F=-(E.x+k-o)-50),E.y-L<0?N=Math.abs(E.y-L)+50:E.y+L>s&&(N=s-(E.y+L)-50),k>=o&&(F=o/2-S.x),0!==N||0!==F){var z=S.add(F,N),H=e._containerPointToPoint(z)._sub(e._prjToPoint(e._getPrjCenter())),j=e._pointToPrj(e._prjToPoint(O).sub(H));e._panAnimation(j)}}},i._measureSize=function(e){var n=this._getUIContainer();e.style.position="absolute";var i=e.style.bottom?"bottom":"top";if(e.style.display="",n.appendChild(e),e.getBoundingClientRect){var o=e.getBoundingClientRect();this._size=new Cn(o.width,o.height)}else this._size=new Cn(e.clientWidth,e.clientHeight);return e.style.display="none",e.style.left="0px",e.style[i]="0px",this._size},i._removePrevDOM=function(){this.onDomRemove&&this.onDomRemove();var e=this.options.eventsToStop;if(this._singleton()){var n=this.getMap(),i=this._uiDomKey();if(n[i]){e&&tr(n[i],e,ki);var o=n[i]._uiComponent;o&&o!==this&&o.isVisible()&&o.fire("hide"),Ti(n[i]),o&&!this.hideDom&&o._switchMapEvents("off"),delete n[i]}delete this.__uiDOM}else this.__uiDOM&&(e&&tr(this.__uiDOM,e,ki),Ti(this.__uiDOM),delete this.__uiDOM);this._resizeObserver&&(this._resizeObserver.disconnect(),delete this._resizeObserver,delete this._domContentRect)},i._uiDomKey=function(){return"__ui_"+this._getClassName()},i._singleton=function(){return this.options.single},i._getUIContainer=function(){return this.getMap().getPanels().ui},i._getClassName=function(){return"UIComponent"},i._switchMapEvents=function(e){var n=this.getMap();if(n){this._mapEventsOn="on"===e;var i=this._getDefaultEvents();if(this.getEvents&&a(i,this.getEvents()),i)for(var o in i)i.hasOwnProperty(o)&&n[e](o,i[o],this)}},i._switchEvents=function(e){var n=this._getOwnerEvents();if(this._owner)for(var i in n)n.hasOwnProperty(i)&&this._owner[e](i,n[i],this)},i._getDefaultEvents=function(){return{"zooming rotate pitch":this.onEvent,zoomend:this.onZoomEnd,moving:this.onMoving,moveend:this.onMoving,resize:this.onResize}},i._getOwnerEvents=function(){var e={};return this._owner&&this._owner instanceof _A&&(e.positionchange=this.onGeometryPositionChange,e.symbolchange=this._updatePosition),this.getOwnerEvents&&a(e,this.getOwnerEvents()),e},i.onGeometryPositionChange=function(e){if(this._owner&&this.isVisible()){this._showBySymbolChange=!0;var n=e.target,i=n.getCenter();if(n._getAltitude){var o=n._getAltitude();l(o)&&(i.z=o)}this.show(i),delete this._showBySymbolChange}},i.onMoving=function(){this.isVisible()&&this.getMap().isTransforming()&&this._updatePosition()},i.onEvent=function(){this.isVisible()&&this._updatePosition()},i.onZoomEnd=function(){this.isVisible()&&this._setPosition()},i.onResize=function(){this.isVisible()&&this._setPosition()},i.onDomSizeChange=function(){this.isVisible()&&(this._setPosition(),this._collides())},i._updatePosition=function(){return this.getMap()?(this.getMap()._getRenderer().callInNextFrame(this._setPosition.bind(this)),this):this},i._setPosition=function(){var e=this.getDOM();if(e){e.style[wi]=null;var n=this.getPosition();this._pos=n,e.style[xi]=this._toCSSTranslate(n)+" scale(1)"}},i._toCSSTranslate=function(e){if(!e)return"";if(wt.any3d){var n=this.getMap(),i=n?n.getBearing():0,o=n?n.getPitch():0,s="";return this.options.pitchWithMap&&o&&(s+=" rotateX("+Math.round(o)+"deg)"),this.options.rotateWithMap&&i&&(s+=" rotateZ("+Math.round(-i)+"deg)"),"translate3d("+Math.fround(e.x)+"px,"+Math.fround(e.y)+"px, 0px)"+s}return"translate("+Math.fround(e.x)+"px,"+Math.fround(e.y)+"px)"},i._observerDomSize=function(e){var n=this;return e&&wt.resizeObserver&&!this._resizeObserver?(this._resizeObserver=new ResizeObserver((function(e){if(e.length){var i=e[0].borderBoxSize;n._domContentRect=i&&i.length?{width:i[0].inlineSize,height:i[0].blockSize}:e[0].contentRect}else delete n._domContentRect;n.onDomSizeChange&&n.onDomSizeChange()})),this._resizeObserver.observe(e),this):this},i.isSupportZoomFilter=function(){return!1},i.onConfig=function(){return this._updatePosition(),this},n.isSupport=function(e){return!!(e&&d(e.on)&&d(e.off)&&d(e.getCenter))},i._bindDomEvents=function(e,n){if(e){var i=this._getDomEvents()||{},o="on"===n?$i:tr;for(var s in i)"on"===n&&tr(e,s,i[s]),o(e,s,i[s],this)}},i._getDomEvents=function(){return{mouseover:this._onDomMouseover,mouseout:this._onDomMouseout}},i._configMapPreventWheelScroll=function(e){var n=this.getMap();n&&(this.options.eventsPropagation||(n.options.preventWheelScroll=e))},i._onDomMouseover=function(){this._configMapPreventWheelScroll(!1)},i._onDomMouseout=function(){this._configMapPreventWheelScroll(!0)},n}(Th(Ih));Xd.mergeOptions({eventsPropagation:!1,eventsToStop:null,dx:0,dy:0,autoPan:!1,autoPanDuration:600,single:!0,animation:"scale",animationOnHide:!1,animationDuration:500,pitchWithMap:!1,rotateWithMap:!1,visible:!0,roundPoint:!1,collision:!1,collisionBufferSize:2,collisionWeight:0,collisionFadeIn:!1,zIndex:0});var Jd="mousedown mouseup mouseenter mouseover mouseout mousemove click dblclick contextmenu keypress touchstart touchmove touchend",Kd=function(e){function n(n,i){var o;return(o=e.call(this,i)||this)._markerCoord=new Zh(n),o}kt(n,e);var i=n.prototype;return i._getClassName=function(){return"UIMarker"},i.setCoordinates=function(e){return this._markerCoord=e,this.fire("positionchange"),this.isVisible()&&(this._coordinate=this._markerCoord,this._setPosition(),this._collides()),this},i.getCoordinates=function(){return this._markerCoord},i.getCenter=function(){return this.getCoordinates()},i.getAltitude=function(){var e=this.getCoordinates()||{};return l(e.z)?e.z:this.options.altitude||0},i.setAltitude=function(e){return l(e)&&this._markerCoord&&(this._markerCoord.z=e,this._updatePosition&&(this._updatePosition(),this._collides())),this},i.setContent=function(e){var n=this.options.content;return this.options.content=e,this.fire("contentchange",{old:n,new:e}),this.isVisible()&&this.show(),this},i.getContent=function(){return this.options.content},i.onAdd=function(){if(this._owner&&!this._owner.isMap){var e=this._owner;throw new Error("UIMarker Can only be added to the map, but owner is:"+e.getJSONType&&e.getJSONType())}return this.show(),this},i.show=function(){return e.prototype.show.call(this,this._markerCoord)},i.flash=function(e,n,i,o){return en.call(this,e,n,i,o)},i.buildOn=function(){var e,n=this.getDOM();this._bindDomEvents(n,"off");var i=this.options.content,o=f(i);return o||d(i)?(e=Pi("div"),o?e.innerHTML=this.options.content:i.bind(this)(e)):e=this.options.content,this.options.containerClass&&(e.className=this.options.containerClass),this._registerDOMEvents(e),this._bindDomEvents(e,"on"),this._appendCustomClass(e),e},i.getOffset=function(){var e=this.getSize(),n=-e.width/2,i=-e.height/2,{horizontalAlignment:o,verticalAlignment:s}=this.options;return"left"===o?n=-e.width:"right"===o&&(n=0),"top"===s?i=-e.height:"bottom"===s&&(i=0),new ee(n,i)},i.getTransformOrigin=function(){return"center center"},i.onDomRemove=function(){var e=this.getDOM();this._removeDOMEvents(e)},i.isDragging=function(){return!!this.draggable&&this.draggable.isDragging()},i._registerDOMEvents=function(e){$i(e,Jd,this._onDomEvents,this)},i._onDomEvents=function(e,n){var i=this.getMap()._parseEvent(e,e.type);if("mousedown"===(n=n||e.type)&&(this._mousedownEvent=e),"mouseup"===n&&(this._mouseupEvent=e),("click"!==n||!this._mouseClickPositionIsChange())&&("touchstart"===n&&(this._touchstartTime=s()),this.fire(n,i),"touchend"===n&&wt.touch)){var o=this.getMap().options.clickTimeThreshold||280;s()-this._touchstartTime<o&&this._onDomEvents(e,"click")}},i._removeDOMEvents=function(e){tr(e,Jd,this._onDomEvents)},i._mouseClickPositionIsChange=function(){var{x:e,y:n}=this._mousedownEvent||{},{x:i,y:o}=this._mouseupEvent||{};return e!==i||n!==o},i._getConnectPoints=function(){var e=this.getMap(),n=e.coordToContainerPoint(this.getCoordinates()),i=this.getSize(),o=i.width,s=i.height;return[e.containerPointToCoordinate(n.add(-o/2,0)),e.containerPointToCoordinate(n.add(o/2,0)),e.containerPointToCoordinate(n.add(0,s/2)),e.containerPointToCoordinate(n.add(0,-s/2))]},i._getViewPoint=function(){var e=0;if(this._owner){var n=this.getAltitude();n>0&&(e=this._meterToPoint(this._coordinate,n))}return this.getMap().coordToViewPoint(this._coordinate,void 0,e)._add(this.options.dx,this.options.dy)},i._getDefaultEvents=function(){return a({},e.prototype._getDefaultEvents.call(this),{"zooming zoomend":this.onZoomFilter})},i._setPosition=function(){this.onZoomFilter(),e.prototype._setPosition.call(this)},i.onZoomFilter=function(){var e=this.getDOM();e&&(this.isVisible()||"none"===e.style.display?this.isVisible()&&"none"===e.style.display&&(e.style.display=""):e.style.display="none")},i.isVisible=function(){var e=this.getMap();if(!e)return!1;if(!this.options.visible)return!1;var n=e.getZoom(),{minZoom:i,maxZoom:o}=this.options;return!(!h(i)&&n<i||!h(o)&&n>o)&&(this.getDOM()&&!0)},i.isSupportZoomFilter=function(){return!0},n}(Uh(Xd));Kd.mergeOptions({containerClass:null,eventsPropagation:!0,draggable:!1,single:!1,content:null,altitude:0,minZoom:0,maxZoom:null,horizontalAlignment:"middle",verticalAlignment:"middle"});var $d=wt.touch?"touchstart mousedown":"mousedown",tp=function(e){function n(n){return e.call(this,n)||this}kt(n,e);var i=n.prototype;return i.addHooks=function(){this.target.on($d,this._startDrag,this)},i.removeHooks=function(){this.target.off($d,this._startDrag,this)},i._startDrag=function(e){var n=e.domEvent;n.touches&&n.touches.length>1||2===n.button||this.isDragging()||(this.target.on("click",this._endDrag,this),this._lastCoord=e.coordinate,this._lastPoint=e.containerPoint,this._prepareDragHandler(),this._dragHandler.onMouseDown(e.domEvent),this.target.fire("dragstart",e))},i._prepareDragHandler=function(){this._dragHandler=new qh(this.target.getDOM(),{cancelOn:this._cancelOn.bind(this),ignoreMouseleave:!0}),this._dragHandler.on("mousedown",this._onMouseDown,this),this._dragHandler.on("dragging",this._dragging,this),this._dragHandler.on("mouseup",this._endDrag,this),this._dragHandler.enable()},i._cancelOn=function(e){var n=(e.srcElement||e.target).tagName.toLowerCase();return"button"===n||"input"===n||"select"===n||"option"===n||"textarea"===n},i._onMouseDown=function(e){ki(e.domEvent)},i._dragging=function(e){var n=this.target,i=n.getMap()._parseEvent(e.domEvent),o=i.domEvent;if(!(o.touches&&o.touches.length>1))if(this._isDragging){var s=i.coordinate,a=i.containerPoint;this._lastCoord||(this._lastCoord=s),this._lastPoint||(this._lastPoint=a);var h=s.sub(this._lastCoord),l=a.sub(this._lastPoint);this._lastCoord=s,this._lastPoint=a,this.target.setCoordinates(this.target.getCoordinates().add(h)),i.coordOffset=h,i.pointOffset=l,n.fire("dragging",i)}else this._isDragging=!0},i._endDrag=function(e){var n=this.target,i=n.getMap();if(this._dragHandler&&(n.off("click",this._endDrag,this),this._dragHandler.disable(),delete this._dragHandler),delete this._lastCoord,delete this._lastPoint,this._isDragging=!1,i){var o=i._parseEvent(e.domEvent);n&&n._mouseClickPositionIsChange&&n._mouseClickPositionIsChange()&&n.fire("dragend",o)}},i.isDragging=function(){return!!this._isDragging},n}(Sh);Kd.addInitHook("addHandler","draggable",tp);var ep=/\{ *([\w_]+) *\}/g,np={containerClass:"maptalks-msgBox",autoPan:!0,autoCloseOn:null,autoOpenOn:"click",width:"auto",minHeight:120,custom:!1,title:null,content:null,enableTemplate:!1},ip=new Cn(0,0),rp=function(e){function n(){return e.apply(this,arguments)||this}kt(n,e);var i=n.prototype;return i._getClassName=function(){return"InfoWindow"},i.addTo=function(n){return n instanceof _A&&(n.getInfoWindow()&&n.getInfoWindow()!==this&&n.removeInfoWindow(),n._infoWindow=this),e.prototype.addTo.call(this,n)},i.setContent=function(e){var n=this.options.content;return this.options.content=e,this.fire("contentchange",{old:n,new:e}),this.isVisible()&&this.show(this._coordinate),this},i.getContent=function(){return this.options.content},i.setTitle=function(e){var n=e;return this.options.title=e,this.fire("contentchange",{old:n,new:e}),this.isVisible()&&this.show(this._coordinate),this},i.getTitle=function(){return this.options.title},i.buildOn=function(){var e=this,n=d(this.options.content),i=f(this.options.content);if(this.options.custom){var o,s=this.getDOM();if(this._bindDomEvents(s,"off"),i||n){var a=Pi("div");i?(a.innerHTML=this.options.content,this._replaceTemplate(a)):this.options.content.bind(this)(a),o=a}else this._replaceTemplate(this.options.content),o=this.options.content;return this._bindDomEvents(o,"on"),this._appendCustomClass(o),o}this._bindDomEvents(this.getDOM(),"off");var h=Pi("div");this.options.containerClass&&(h.className=this.options.containerClass);var c=this._getWindowWidth();h.style.width=l(c)?c+"px":"auto",h.style.bottom="0px";var A='<em class="maptalks-ico"></em>';this.options.title&&(A+="<h2>"+this.options.title+"</h2>"),h.innerHTML=A+='<a href="javascript:void(0);" class="maptalks-close"></a><div class="maptalks-msgContent"></div>',this._replaceTemplate(h);var p=h.querySelector(".maptalks-msgContent");return i||n?i?p.innerHTML=this.options.content:this.options.content.bind(this)(p):p.appendChild(this.options.content),this._onCloseBtnClick=function(n){e.options.eventsPropagation||(Di(n),ki(n)),e.hide()},Si(h.querySelector(".maptalks-close"),"click touchend",this._onCloseBtnClick),n||this._replaceTemplate(p),this._bindDomEvents(h,"on"),this._appendCustomClass(h),h},i._replaceTemplate=function(e){var n=this._owner;if(this.options.enableTemplate&&n&&n.getProperties&&e&&e.innerHTML){var i=n.getProperties()||{};if(A(i))e.innerHTML=e.innerHTML.replace(ep,(function(e,n){return i[n]}))}return this},i.getTransformOrigin=function(){return this.getSize().width/2+"px bottom"},i.getOffset=function(){var e=this.getSize(),n=new ee(-e.width/2,0);this.options.custom?n._sub(0,e.height):n._sub(4,12);var i=this.getOwner();if(i instanceof pf||i instanceof Cf){var o,s;if(i instanceof pf)o=i._getPainter(),s=i.getSize();else{var a=i.getGeometries();if(!a||!a.length)return n;o=a[0]._getPainter(),s=a[0].getSize()}if(s||(s=ip),o){var h=o.getFixedExtent();n._add(h.xmax-s.width/2,h.ymin)}else n._add(0,-s.height)}return n},i.show=function(n){return this.getMap()&&this.getMap().options.enableInfoWindow?e.prototype.show.call(this,n):this},i.getEvents=function(){if(!this.options.autoCloseOn)return null;var e={};return e[this.options.autoCloseOn]=this.hide,e},i.getOwnerEvents=function(){var e=this.getOwner();if(!this.options.autoOpenOn||!e)return null;var n={};return n[this.options.autoOpenOn]=this._onAutoOpen,n},i.onRemove=function(){this._onDomMouseout(),this.onDomRemove()},i.onDomRemove=function(){this._onCloseBtnClick&&(Ii(this.getDOM().childNodes[2],"click touchend",this._onCloseBtnClick),delete this._onCloseBtnClick)},i._onAutoOpen=function(e){var n=this,i=this.getOwner();setTimeout((function(){i instanceof pf||i instanceof Xd?n.show(i.getCoordinates()):i instanceof Cf?n.show(i.findClosest(e.coordinate)):i instanceof mf||i instanceof Mf?(n.getMap().getScale()>=8&&(e.coordinate=n._rectifyMouseCoordinte(i,e.coordinate)),n.show(e.coordinate)):n.show(e.coordinate)}),1)},i._rectifyMouseCoordinte=function(e,n){var i=this;return e instanceof mf?this._rectifyLineStringMouseCoordinate(e,n).coordinate:e instanceof Mf?e.getGeometries().map((function(e){return i._rectifyLineStringMouseCoordinate(e,n)})).sort((function(e,n){return e.dis-n.dis}))[0].coordinate:n},i._rectifyLineStringMouseCoordinate=function(e,n){for(var i=this.getMap(),o=e.getCoordinates()||[],s=i.getGLRes(),a=o.map((function(e){var n=i.coordToPointAtRes(e,s);return i._pointAtResToContainerPoint(n,s,e.z||0)})),h=i.coordToContainerPoint(n),l=1/0,c=-1,A=0,f=a.length;A<f;A++){var d=h.distanceTo(a[A]);d<l&&(l=d,c=A)}for(var p=[c-1,c,c+1].filter((function(e){return e>=0&&e<=a.length-1})),g=p.map((function(e){return a[e]})),v=[],{width:w,height:C}=i.getSize(),P=0,T=g.length-1;P<T;P++){var S=P,I=g[P],E=g[P+1];if(I.x===E.x)for(var O=Math.max(0,Math.min(I.y,E.y)),k=Math.min(C,Math.max(I.y,E.y)),L=O;L<=k;L++)v.push({point:new ee(I.x,L),coordinateIndex:S});else for(var F=(E.y-I.y)/(E.x-I.x),N=Math.max(0,Math.min(I.x,E.x)),z=Math.min(w,Math.max(I.x,E.x)),H=N;H<=z;H++){v.push({point:new ee(H,F*(H-I.x)+I.y),coordinateIndex:S})}}for(var j,W=1/0,q=-1,Y=-1,J=0,$=v.length;J<$;J++){var{point:it,coordinateIndex:rt}=v[J],ot=h.distanceTo(it);ot<W&&(W=ot,q=J,Y=rt,j=it)}if(q<0)return{dis:W,coordinate:n};var st=g[Y],at=st.distanceTo(g[Y+1]),ht=j.distanceTo(st)/at,At=p.map((function(e){return o[e]})),ft=At[Y],gt=At[Y+1],vt=ft.x,_t=ft.y,xt=ft.z||0;return{dis:W,coordinate:new Zh(vt+(gt.x-vt)*ht,_t+(gt.y-_t)*ht,xt+((gt.z||0)-xt)*ht)}},i._getWindowWidth=function(){var e=this.options.width;return e||(e=np.width),e},n}(Xd);rp.mergeOptions(np);var op="remove hide shapechange positionchange dragend animatestart",sp=function(e){function n(n,i={}){var o;return(o=e.call(this,i)||this)._content=n,o}kt(n,e);var i=n.prototype;return i._getClassName=function(){return"ToolTip"},i.addTo=function(i){if(n.isSupport(i))return i.on("mousemove",this.onMouseMove,this),i.on("mouseout",this.onMouseOut,this),i.on(op,this.hideDom,this),e.prototype.addTo.call(this,i);throw new Error("Invalid geometry or UIMarker the tooltip is added to.")},i.setStyle=function(e){return this.options.containerClass=e,this},i.getStyle=function(){return this.options.containerClass},i.getContent=function(){return this._content},i.buildOn=function(){var e=Pi("div"),n=this.options||{};n.height&&(e.style.height=n.height+"px"),n.width&&(e.style.width=n.width+"px");var i=n.containerClass||n.cssName;return!i&&n.height&&(e.style.lineHeight=n.height+"px"),d(this._content)?this._content.bind(this)(e):e.innerHTML='<div class="'+i+'">'+this._content+"</div>",this._appendCustomClass(e),e},i.onMouseOut=function(){clearTimeout(this._timeout),this.isVisible()&&this._removePrevDOM(),this._switchMapEvents("off")},i.onMouseMove=function(e){var n=this;clearTimeout(this._timeout);var i=this.getMap();if(i){var o=i.locateByPoint(e.coordinate,-5,25);0===this.options.showTimeout?this.show(o):this._timeout=setTimeout((function(){i&&n.show(o)}),this.options.showTimeout)}},i.onRemove=function(){clearTimeout(this._timeout),this._owner&&(this._owner.off("mousemove",this.onMouseMove,this),this._owner.off("mouseout",this.onMouseOut,this),this._owner.off(op,this.hideDom,this))},i.hideDom=function(){this.hide()},i.onEvent=function(){return e.prototype.onEvent.call(this),this.hideDom(),this},i._getViewPoint=function(){return this.getMap().coordToViewPoint(this._coordinate,void 0,0)._add(this.options.dx,this.options.dy)},n}(Xd);sp.mergeOptions({width:0,height:0,animation:"fade",containerClass:"maptalks-tooltip",showTimeout:400});var ap=function(e){function n(n){return e.call(this,n)||this}kt(n,e);var i=n.prototype;return i._getClassName=function(){return"Menu"},i.addTo=function(e){return e._menu&&e._menu!==this&&e.removeMenu(),e._menu=this,this._owner=e,Xd.prototype.addTo.apply(this,[e])},i.setItems=function(e){return this.options.items=e,this},i.getItems=function(){return this.options.items||[]},i.buildOn=function(){var e;if(this.options.custom)if(f(this.options.items)){var n=Pi("div");n.innerHTML=this.options.items,this._appendCustomClass(n),e=n}else e=this.options.items;else{e=Pi("div"),this.options.containerClass&&Vi(e,this.options.containerClass),e.style.width=this._getMenuWidth()+"px";var i=this._createMenuItemDom();e.appendChild(i),$i(e,"contextmenu",Di),this._appendCustomClass(e)}return e&&(this._bindDomEvents(e,"off"),this._bindDomEvents(e,"on")),e},i.getOffset=function(){if(!this.getMap())return null;var e=this.getMap().getSize(),n=this.getMap().viewPointToContainerPoint(this._getViewPoint()),i=this.getSize(),o=0,s=0;return n.x+i.width>e.width&&(o=-i.width),n.y+i.height>e.height&&(s=-i.height),new ee(o,s)},i.getTransformOrigin=function(){var e=this.getOffset()._multi(-1);return e.x+"px "+e.y+"px"},i.getEvents=function(){return{"_zoomstart _zoomend _movestart _dblclick _click":this._removePrevDOM}},i._createMenuItemDom=function(){var e=this,n=this.getMap(),i=Pi("ul");Vi(i,"maptalks-menu-items");var o,s,a=this.getItems();function h(i){return function(o){var s=n._parseEvent(o,"click");s.target=e,s.owner=e._owner,s.index=i,!1!==this._callback(s)&&(e.hide(),e._owner&&e._owner.fire("closemenu"))}}for(var l=0,c=a.length;l<c;l++){if("-"===(o=a[l])||"_"===o)Vi(s=Pi("li"),"maptalks-menu-splitter");else{s=Pi("li");var A=o.item;d(A)&&(A=A({owner:this._owner,index:l})),s.innerHTML=A,s._callback=o.click,$i(s,"click",h(l))}i.appendChild(s)}var f=this.options.maxHeight||0;return f>0&&Ui(i,"max-height: "+f+"px; overflow-y: auto;"),i},i._getMenuWidth=function(){return this.options.width||160},n}(Xd);ap.mergeOptions({containerClass:"maptalks-menu",animation:null,animationDelay:10,animationOnHide:!1,autoPan:!1,width:160,maxHeight:0,custom:!1,items:[]});var hp={setMenu:function(e){return this._menuOptions=e,this._menu?this._menu.setOptions(e):this.on("contextmenu",this._defaultOpenMenu,this),this},getMenu:function(){return this._menu},openMenu:function(e){var n=this instanceof BA?this:this.getMap();return e||(e=this.getCenter()),this._menu?this._menu.show(e):this._menuOptions&&n&&(this._bindMenu(),this._menu.show(e)),this.fire("openmenu",{coordinate:e}),this},setMenuItems:function(e){return this._menuOptions||(this._menuOptions={}),Array.isArray(e)&&(this._menuOptions.custom=!1),this._menuOptions.items=e,this.setMenu(this._menuOptions),this},getMenuItems:function(){return this._menu?this._menu.getItems():this._menuOptions&&this._menuOptions.items||[]},closeMenu:function(){return this._menu&&this._menu.hide(),this.fire("closemenu",{}),this},removeMenu:function(){return this.off("contextmenu",this._defaultOpenMenu,this),this._unbindMenu(),delete this._menuOptions,this.fire("removemenu",{}),this},_bindMenu:function(){return this._menuOptions?(this._menu=new ap(this._menuOptions),this._menu.addTo(this),this):this},_unbindMenu:function(){return this._menu&&(this.closeMenu(),this._menu.remove(),delete this._menu),this},_defaultOpenMenu:function(e){return this.openMenu(e.coordinate),!1}};BA.include(hp),_A.include(hp);var lp=Object.freeze({__proto__:null,InfoWindow:rp,Menu:ap,Menuable:hp,ToolTip:sp,UIComponent:Xd,UIMarker:Kd}),up=function(e){function n(n){return n&&n.position&&!f(n.position)&&(n.position=a({},n.position)),e.call(this,n)||this}kt(n,e);var i=n.prototype;return i._appendCustomClass=function(e){if(!e)return console.warn("dom is null:",e),this;if(this.options.cssName){var n=this.options.cssName;Array.isArray(n)||(n=[n]),n.forEach((function(n){e.classList.add(n)}))}return this},i.onAdd=function(){},i.onRemove=function(){},i.addTo=function(e){if(this.remove(),!e.options.control)return this;this._map=e;var n=e.getPanels().control;return this.__ctrlContainer=Pi("div"),Ui(this.__ctrlContainer,"position:absolute;overflow:visible;"),this.update(),n.appendChild(this.__ctrlContainer),this.onAdd&&this.onAdd(),this.fire("add",{dom:n}),this},i.update=function(){return this.__ctrlContainer.innerHTML="",this._controlDom=this.buildOn(this.getMap()),this._controlDom&&(this._updatePosition(),this.__ctrlContainer.appendChild(this._controlDom)),this},i.getMap=function(){return this._map},i.getPosition=function(){return a({},this._parse(this.options.position))},i.setPosition=function(e){return this.options.position=f(e)?e:a({},e),this._updatePosition(),this},i.getContainerPoint=function(){var e,n,i=this.getPosition(),o=this.getMap().getSize();return h(i.left)?h(i.right)||(e=o.width-parseInt(i.right+"")):e=parseInt(i.left+""),h(i.top)?h(i.bottom)||(n=o.height-parseInt(i.bottom+"")):n=parseInt(i.top+""),new ee(e,n)},i.getContainer=function(){return this.__ctrlContainer},i.getDOM=function(){return this._controlDom},i.show=function(){return this.__ctrlContainer.style.display="",this},i.hide=function(){return this.__ctrlContainer.style.display="none",this},i.isVisible=function(){return this.__ctrlContainer&&""===this.__ctrlContainer.style.display},i.remove=function(){return this._map?(Ti(this.__ctrlContainer),this.onRemove&&this.onRemove(),delete this._map,delete this.__ctrlContainer,delete this._controlDom,this.fire("remove"),this):this},i._parse=function(e){var i=e;return f(e)&&(i=n.positions[i]),i},i._updatePosition=function(){var e=this.getPosition();for(var n in e||(e={top:20,left:20}),e)if(e.hasOwnProperty(n)){var i=e[n]||0;l(i)&&(i+="px"),this.__ctrlContainer.style[n]=i}this.fire("positionchange",{position:a({},e)})},n}(Th(Ih));up.positions={"top-left":{top:20,left:20},"top-right":{top:20,right:20},"bottom-left":{bottom:20,left:20},"bottom-right":{bottom:20,right:20}},BA.mergeOptions({control:!0}),BA.include({addControl:function(e){return this._containerDOM.getContext||e.addTo(this),this},removeControl:function(e){return e&&e.getMap()===this?(e.remove(),this):this}});var cp="addlayer removelayer setbaselayer baselayerremove",Ap=function(e){function n(){return e.apply(this,arguments)||this}kt(n,e);var i=n.prototype;return i.buildOn=function(){return this._attributionContainer=Pi("div"),this._attributionContainer.className="maptalks-attribution",this._appendCustomClass(this._attributionContainer),this._update(),this._attributionContainer},i.getContent=function(){return this.options.content},i.setContent=function(e){return this.options.content=e,this._update(),this},i.onAdd=function(){this.getMap().on(cp,this._update,this)},i.onRemove=function(){this.getMap().off(cp,this._update,this)},i._updateContent=function(){var e=this._attributionContainer,n=this.options.content||"";return e&&(e.innerHTML="",f(n)?e.innerHTML=n:n instanceof HTMLElement&&e.appendChild(e)),this},i._update=function(){if(this.options.custom)this._updateContent();else{var e=this.getMap();if(e){var n=e._getLayers((function(e){return!!e.options.attribution})).reverse().map((function(e){return e.options.attribution})),i=this.options.content+(n.length>0?" - "+n.join(", "):"");this._attributionContainer.innerHTML='<span style="padding:0px 4px">'+i+"</span>"}}},n}(up);Ap.mergeOptions({position:{bottom:0,left:0},content:'<a href="http://maptalks.org" target="_blank">maptalks</a>',custom:!1}),BA.mergeOptions({attribution:!0}),BA.addOnLoadHook((function(){var e=this.options.attribution||this.options.attributionControl;e&&(this.attributionControl=new Ap(e),this.addControl(this.attributionControl))}));var fp=function(e){function n(){return e.apply(this,arguments)||this}kt(n,e);var i=n.prototype;return i.buildOn=function(e){var n=this._getCompass();return this._appendCustomClass(n),this._compass=n,this._registerDomEvents(),e.on("resize moving moveend zooming zoomend rotate rotateend dragrotating dragrotateend viewchange",this._rotateCompass,this),n},i.onAdd=function(){this._rotateCompass()},i._getCompass=function(){return Pi("div","maptalks-compass")},i._registerDomEvents=function(){$i(this._compass,"click",this._resetView,this)},i._rotateCompass=function(){var e=this.getMap().getBearing().toFixed(1),n=parseFloat(e);n<=180&&(n*=-1),n!==this._bearing&&(this._bearing=n,Ui(this._compass,"transform: rotate("+this._bearing+"deg);"))},i.onRemove=function(){this.getMap().off("resize moving moveend zooming zoomend rotate rotateend dragrotating dragrotateend viewchange",this._rotateCompass,this),delete this._compass,delete this._bearing},i._resetView=function(){this.getMap().animateTo({bearing:0})},n}(up);fp.mergeOptions({position:{top:120,left:20}}),BA.mergeOptions({compassControl:!1}),BA.addOnLoadHook((function(){this.options.compassControl&&(this.compassControl=new fp(this.options.compassControl),this.addControl(this.compassControl))}));var dp=function(e){function n(){return e.apply(this,arguments)||this}kt(n,e);var i=n.prototype;return i.buildOn=function(){var e=this.container=Pi("div",this.options.containerClass),n=this.panel=Pi("div","panel"),i=this.button=Pi("button");return e.appendChild(i),e.appendChild(n),this._appendCustomClass(e),e},i.onAdd=function(){$i(this.button,"mouseover",this._show,this),$i(this.panel,"mouseleave",this._hide,this)},i.onRemove=function(){this.panel&&(tr(this.button,"mouseover",this._show),tr(this.panel,"mouseleave",this._hide),Ti(this.panel),Ti(this.button),delete this.panel,delete this.button,delete this.container)},i._show=function(){Gi(this.container,"shown")||(Vi(this.container,"shown"),this._createPanel())},i._hide=function(e){this.panel.contains(e.toElement||e.relatedTarget)||Wi(this.container,this.options.containerClass)},i._createPanel=function(){this.panel.innerHTML="";var e=Pi("ul");this.panel.appendChild(e),this._renderLayers(this.getMap(),e)},i._renderLayers=function(e,n){var i=this,o=e.getBaseLayer(),s=e.getLayers(),a=s.length;if(o){var h=o.layers||[o],l=Pi("li","group"),c=Pi("ul"),A=Pi("label");A.innerHTML=this.options.baseTitle,l.appendChild(A);for(var f=0,d=h.length;f<d;f++){this._isExcluded(h[f])&&(c.appendChild(this._renderLayer(h[f],!0)),l.appendChild(c),n.appendChild(l))}}if(a){var p=Pi("li","group"),g=Pi("ul"),v=Pi("label"),w=Pi("input");w.type="checkbox",w.checked=!0,v.innerHTML=this.options.overlayTitle,p.appendChild(w),p.appendChild(v);for(var C=function(e){var n=e.target.checked,i=e.target.parentNode;if(i){var o=i.getElementsByTagName("ul")[0];if(o){var s=function(e){var i=e._layer;i&&i[n?"show":"hide"]()},a=function(e){var i=e._layer,o=e.childNodes[0];o&&(o.checked=n),i&&i[n?"show":"hide"]()};s(i),o.childNodes.forEach((function(e){a(e);var n=e.getElementsByTagName("ul")[0];n&&(s(e),n.childNodes.forEach((function(e){a(e)})))}))}}},P=function(){var e=s[T];if(i._isExcluded(e)){if(e.getLayers){var n=Pi("li","group"),o=Pi("ul"),a=Pi("label"),h=Pi("input");a.innerHTML=e.getId(),h.type="checkbox",h.checked=e.isVisible(),h.onchange=C,n.appendChild(h),n.appendChild(a),n.appendChild(o),n._layer=e,g.appendChild(n),(e.getLayers()||[]).forEach((function(e){o.appendChild(i._renderLayer(e,!1,h.checked))}))}else g.appendChild(i._renderLayer(e));e&&!e.isVisible()&&(w.checked=!1)}},T=0;T<a;T++)P();p.appendChild(g),n.appendChild(p),w.onchange=C}},i._isExcluded=function(e){var n=e.getId(),i=this.options.excludeLayers;return!(i.length&&i.indexOf(n)>=0)},i._renderLayer=function(e,n,i=!0){var o=this,s=Pi("li","layer"),a=Pi("label"),h=Pi("input"),l=this.getMap(),c=e.options.visible;e.options.visible=!0;var A=e.isVisible();e.options.visible=c,s.className="layer";var f=h;return n?(f.type="radio",f.name="base"):f.type="checkbox",f.checked=c&&A,i||(f.checked=!1),A||f.setAttribute("disabled","disabled"),f.onchange=function(n){if("radio"===n.target.type){var i=l.getBaseLayer(),s=i.layers;if(s)for(var a=0,h=s.length;a<h;a++){var c=s[a];c[c===e?"show":"hide"]()}else i.isVisible()||i.show();l._fireEvent("setbaselayer")}else e[n.target.checked?"show":"hide"]();o.fire("layerchange",{target:e})},s.appendChild(h),a.innerHTML=e.getId(),s.appendChild(a),s._layer=e,s},n}(up);dp.mergeOptions({position:"top-right",baseTitle:"Base Layers",overlayTitle:"Layers",excludeLayers:[],containerClass:"maptalks-layer-switcher"}),BA.mergeOptions({layerSwitcherControl:!1}),BA.addOnLoadHook((function(){this.options.layerSwitcherControl&&(this.layerSwitcherControl=new dp(this.options.layerSwitcherControl),this.addControl(this.layerSwitcherControl))}));var pp=function(e){function n(){return e.apply(this,arguments)||this}kt(n,e);var i=n.prototype;return i.buildOn=function(){var e=this.options.size;this.options.maximize||(e=[0,0]);var n=Pi("div");this._appendCustomClass(n);var i=this.mapContainer=Pi("div");i.style.width=e[0]+"px",i.style.height=e[1]+"px",i.className=this.options.containerClass;var o=this.button=Pi("div");return o.className=this.options.buttonClass,n.appendChild(i),n.appendChild(o),n},i.onAdd=function(){this.options.maximize&&this._createOverview(),this.getMap().on("resize moving zooming rotate dragrotating viewchange",this._update,this).on("setbaselayer",this._updateBaseLayer,this).on("spatialreferencechange",this._updateSpatialReference,this),$i(this.button,"click",this._onButtonClick,this),this._updateButtonText()},i.onRemove=function(){this.getMap().off("resize moving zooming rotate dragrotating viewchange",this._update,this).off("setbaselayer",this._updateBaseLayer,this).off("spatialreferencechange",this._updateSpatialReference,this),this._overview&&(this._overview.remove(),delete this._overview,delete this._perspective),tr(this.button,"click",this._onButtonClick)},i.maxmize=function(){var e=this.options.size,n=this.mapContainer;return n.style.width=e[0]+"px",n.style.height=e[1]+"px",this._createOverview(),this},i.minimize=function(){this._overview&&this._overview.remove(),delete this._overview,delete this._perspective;var e=this.mapContainer;return e.style.width="0px",e.style.height="0px",this},i.getOverviewMap=function(){return this._overview},i._onButtonClick=function(){this._overview?this.minimize():this.maxmize(),this._updateButtonText()},i._updateButtonText=function(){this.button.innerHTML=this._overview?"-":"+"},i._createOverview=function(){var e=this.getMap(),n=this.mapContainer,i=e.config();a(i,{center:e.getCenter(),zoom:this._getOverviewZoom(),zoomAnimationDuration:150,pitch:0,bearing:0,scrollWheelZoom:!1,checkSize:!1,doubleClickZoom:!1,touchZoom:!1,control:!1,draggable:!1,maxExtent:null}),this._overview=new BA(n,i),this._updateBaseLayer(),this._perspective=new Af(this._getPerspectiveCoords(),{draggable:!0,cursor:"move",symbol:this.options.symbol}).on("dragend",this._onDragEnd,this),new ad("perspective_layer",this._perspective).addTo(this._overview),this.fire("load")},i._getOverviewZoom=function(){var e=this.getMap(),n=e.getZoom(),i=e.getMinZoom(),o=this.options.level;if(o>0){for(var s=o;s>0;s--)if(n-s>=i)return n-s}else for(var a=o;a<0;a++)if(n-a>=i)return n-a;return n},i._onDragEnd=function(){var e=this._perspective.getCenter();this._overview.setCenter(e),this.getMap().panTo(e)},i._getPerspectiveCoords=function(){var e=this.getMap(),n=e.getProjection();return e.getContainerExtent().toArray().map((function(i){if(n){var o=e._containerPointToPrj(i);return e._fixPrjOnWorldWide(o),n.unproject(o)}return e.containerPointToCoordinate(i)}))},i._update=function(){if(this._overview){zi(this._overview.getContainer());var e=this._getPerspectiveCoords();this._perspective.setCoordinates(e),this._overview.setCenterAndZoom(this.getMap().getCenter(),this._getOverviewZoom())}},i._updateSpatialReference=function(){if(this._overview){var e=this.getMap();this._overview.setSpatialReference(e.options.spatialReference)}},i._updateBaseLayer=function(){if(this._overview){var e=this.getMap().getBaseLayer();if(e){var n=e.layers,i=0;if(n)for(var o=0,s=n.length;o<s;o++){if(n[o].isVisible()){i=o;break}}var a=e.toJSON(),h=null;n?(h=a.layers[i].options).visible=!0:h=a.options,this._overview.setMinZoom(h.minZoom||null).setMaxZoom(h.maxZoom||null),delete h.minZoom,delete h.maxZoom,delete a.options.canvas,a.options.visible=!0,a.options.renderer="canvas";var l=RA.fromJSON(a);for(var c in e)d(e[c])&&e.hasOwnProperty(c)&&e[c]!==e.constructor.prototype[c]&&(l[c]=e[c]);this._overview.setBaseLayer(l)}else this._overview.setBaseLayer(null)}},n}(up);pp.mergeOptions({level:4,position:{right:1,bottom:1},size:[300,200],maximize:!0,symbol:{lineWidth:3,lineColor:"#1bbc9b",polygonFill:"#1bbc9b",polygonOpacity:.4},containerClass:"maptalks-overview",buttonClass:"maptalks-overview-button"}),BA.mergeOptions({overviewControl:!1}),BA.addOnLoadHook((function(){this.options.overviewControl&&(this.overviewControl=new pp(this.options.overviewControl),this.addControl(this.overviewControl))}));var gp=function(e){function n(){return e.apply(this,arguments)||this}kt(n,e);var i=n.prototype;return i.buildOn=function(){var e,n=this;if(this.options.custom)f(this.options.content)?((e=Pi("div")).innerHTML=this.options.content,this._appendCustomClass(e)):e=this.options.content;else{if(e=Pi("div","maptalks-panel"),this._appendCustomClass(e),this.options.closeButton){var i=Pi("a","maptalks-close");i.innerText="",i.href="javascript:;",i.onclick=function(){e.style.display="none",n.fire("close")},e.appendChild(i)}var o=Pi("div","maptalks-panel-content");f(this.options.content)?o.innerHTML=this.options.content:o.appendChild(this.options.content),e.appendChild(o)}return this.draggable=new qh(e,{cancelOn:this._cancelOn.bind(this),ignoreMouseleave:!0}),this.draggable.on("dragstart",this._onDragStart,this).on("dragging",this._onDragging,this).on("dragend",this._onDragEnd,this),this.options.draggable&&this.draggable.enable(),e},i.update=function(){return this.draggable&&(this.draggable.disable(),delete this.draggable),up.prototype.update.call(this)},i.setContent=function(e){var n=this.options.content;return this.options.content=e,this.fire("contentchange",{old:n,new:e}),this.isVisible()&&this.update(),this},i.getContent=function(){return this.options.content},i._cancelOn=function(e){var n=(e.srcElement||e.target).tagName.toLowerCase();return"button"===n||"input"===n||"select"===n||"option"===n||"textarea"===n},i._onDragStart=function(e){this._startPos=e.mousePos,this._startPosition=a({},this.getPosition()),this.fire("dragstart",e)},i._onDragging=function(e){var n=e.mousePos.sub(this._startPos),i=this._startPosition,o=this.getPosition();h(o.top)||(o.top=parseInt(i.top)+n.y),h(o.bottom)||(o.bottom=parseInt(i.bottom)-n.y),h(o.left)||(o.left=parseInt(i.left)+n.x),h(o.right)||(o.right=parseInt(i.right)-n.x),this.setPosition(o),this.fire("dragging",e)},i._onDragEnd=function(e){delete this._startPos,delete this._startPosition,this.fire("dragend",e)},i._getConnectPoints=function(){var e=this.getMap(),n=this.getContainerPoint(),i=this.getDOM(),o=parseInt(i.clientWidth+""),s=parseInt(i.clientHeight+"");return[e.containerPointToCoordinate(n.add(o/2,0)),e.containerPointToCoordinate(n.add(o,s/2)),e.containerPointToCoordinate(n.add(o/2,s)),e.containerPointToCoordinate(n.add(0,s/2))]},n}(up);gp.mergeOptions({position:"top-right",draggable:!0,custom:!1,content:"",closeButton:!0});var mp=function(e){function n(){return e.apply(this,arguments)||this}kt(n,e);var i=n.prototype;return i.buildOn=function(){var e=this._getReset();return this._appendCustomClass(e),this._reset=e,this._registerDomEvents(),e},i.onAdd=function(){this._view=this.options.view?this.options.view:this.getMap().getView()},i.setView=function(e){this._view=e},i._getReset=function(){return Pi("div","maptalks-reset")},i._registerDomEvents=function(){$i(this._reset,"click",this._resetView,this)},i.onRemove=function(){delete this._reset,delete this._view},i._resetView=function(){this.getMap().setView(this._view)},n}(up);mp.mergeOptions({position:{top:156,left:20},view:null}),BA.mergeOptions({resetControl:!1}),BA.addOnLoadHook((function(){this.options.resetControl&&(this.resetControl=new mp(this.options.resetControl),this.addControl(this.resetControl))}));var yp="zoomend moving moveend",vp=function(e){function n(){return e.apply(this,arguments)||this}kt(n,e);var i=n.prototype;return i.buildOn=function(e){return this._map=e,this._scaleContainer=Pi("div",this.options.containerClass),this._addScales(),e.on(yp,this._update,this),this._map.isLoaded()&&this._update(),this._appendCustomClass(this._scaleContainer),this._scaleContainer},i.onRemove=function(){this.getMap().off(yp,this._update,this)},i._addScales=function(){var e="border: 2px solid #000000;border-top: none;line-height: 1.1;padding: 0px;color: #000000;font-size: 11px;text-align:center;white-space: nowrap;overflow: hidden;-moz-box-sizing: content-box;box-sizing: content-box;background: #fff; background: rgba(255, 255, 255, 0);";this.options.metric&&(this._mScale=Mi("div",this.options.containerClass?null:e,this._scaleContainer)),this.options.imperial&&(this._iScale=Mi("div",this.options.containerClass?null:e,this._scaleContainer))},i._update=function(){var e=this._map.pixelToDistance(this.options.maxWidth,0);this._updateScales(e)},i._updateScales=function(e){this.options.metric&&e&&this._updateMetric(e),this.options.imperial&&e&&this._updateImperial(e)},i._updateMetric=function(e){var n=this._getRoundNum(e);this._updateScale(this._mScale,n<1e3?n+" m":n/1e3+" km",n/e)},i._updateImperial=function(e){var n,i,o,s=3.2808399*e;s>5280?(i=this._getRoundNum(n=s/5280),this._updateScale(this._iScale,i+" mile",i/n)):(o=this._getRoundNum(s),this._updateScale(this._iScale,o+" feet",o/s))},i._updateScale=function(e,n,i){e.style.width=Math.round(this.options.maxWidth*i)+"px",e.innerHTML=n},i._getRoundNum=function(e){var n=Math.pow(10,(Math.floor(e)+"").length-1),i=e/n;return n*(i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:1)},n}(up);vp.mergeOptions({position:"bottom-left",maxWidth:100,metric:!0,imperial:!1,containerClass:null}),BA.mergeOptions({scaleControl:!1}),BA.addOnLoadHook((function(){this.options.scaleControl&&(this.scaleControl=new vp(this.options.scaleControl),this.addControl(this.scaleControl))}));var _p=function(e){function n(){return e.apply(this,arguments)||this}kt(n,e);var i=n.prototype;return i.buildOn=function(e){this._map=e;var n=Pi("div"),i=Pi("ul","maptalks-toolbar-hx");n.appendChild(i),Vi(n,this.options.vertical?"maptalks-toolbar-vertical":"maptalks-toolbar-horizonal");var o=this;function s(e,n,i,s){var a=o._getItems()[n];return function(o){return ki(o),e({target:a,index:n,childIndex:i,dom:s})}}var a=this.options.items;if(xe(a))for(var h=0,l=a.length;h<l;h++){var c=a[h],A=Pi("li");if(28!==this.options.height&&(A.style.lineHeight=this.options.height+"px"),A.style.height=this.options.height+"px",A.style.cursor="pointer",Xi(c.item)){A.style.textAlign="center";var f=Ji("div",c.item);A.innerHTML='<div style="margin-top:'+(this.options.height-f.height)/2+'px;">'+c.item+"</div>"}else A.innerHTML=c.item;if(c.click&&$i(A,"click",s(c.click,h,null,A)),xe(c.children)){var d=this._createDropMenu(h);A.appendChild(d),A._menu=d,$i(A,"mouseover",(function(){this._menu.style.display=""})),$i(A,"mouseout",(function(){this._menu.style.display="none"}))}i.appendChild(A)}return this._appendCustomClass(n),n},i._createDropMenu=function(e){var n=this;function i(e,i,o){var s=n._getItems()[i].children[o];return function(n){return ki(n),e({target:s,index:i,childIndex:o})}}var o=Pi("div","maptalks-dropMenu"),s=this._getItems(),a=s.length,h=Pi("ul"),l=s[e].children;e===a-1&&l&&(o.style.cssText="right: 0px;",h.style.cssText="right: 0px;position: absolute;",this.options.reverseMenu&&(h.style.bottom="0")),o.appendChild(Pi("em","maptalks-ico"));for(var c=0,A=0,f=l.length;A<f;A++){var d=oi(l[A].item,"12px");d.width>c&&(c=d.width)}for(var p=0,g=l.length;p<g;p++){var v=l[p],w=Pi("li");w.innerHTML='<a href="javascript:;">'+v.item+"</a>",w.style.cursor="pointer",w.style.width=c+24+"px",$i(w.childNodes[0],"click",i(v.click,e,p)),h.appendChild(w)}if(this.options.vertical){var C=c<95?95:c;this.options.reverseMenu?o.style.right=-(C+20+2)+"px":o.style.left=-(C+20+2)+"px"}else this.options.reverseMenu?o.style.bottom="28px":o.style.top="29px";return o.appendChild(h),o.style.display="none",o},i._getItems=function(){return this.options.items||[]},n}(up);_p.mergeOptions({height:28,vertical:!1,position:"top-right",reverseMenu:!1,items:[]});var xp=function(e){function n(){return e.apply(this,arguments)||this}kt(n,e);var i=n.prototype;return i.buildOn=function(e){var n=this.options,i=Pi("div","maptalks-zoom");if(this._appendCustomClass(i),n.zoomLevel){var o=Pi("span","maptalks-zoom-zoomlevel"),s=Pi("span","maptalks-zoom-zoomlevel-text");o.appendChild(s),i.appendChild(o),this._levelDOM=s}var a=Pi("div","maptalks-zoom-slider"),h=Pi("a","maptalks-zoom-zoomin");h.href="javascript:;",a.appendChild(h),this._zoomInButton=h;var l=Pi("a","maptalks-zoom-zoomout");return l.href="javascript:;",a.appendChild(l),this._zoomOutButton=l,i.appendChild(a),e.on("_zoomend _zooming _zoomstart _spatialreferencechange",this._update,this),this._update(),this._registerDomEvents(),i},i.onRemove=function(){this.getMap().off("_zoomend _zooming _zoomstart _spatialreferencechange",this._update,this)},i._update=function(){this._updateText()},i._updateText=function(){if(this._levelDOM){var e=this.getMap().getZoom();c(e)||(e=Math.floor(10*e)/10),this._levelDOM.innerHTML=e+""}},i._registerDomEvents=function(){this._zoomInButton&&$i(this._zoomInButton,"click",this._onZoomInClick,this),this._zoomOutButton&&$i(this._zoomOutButton,"click",this._onZoomOutClick,this)},i._onZoomInClick=function(e){Di(e),this.getMap().zoomIn()},i._onZoomOutClick=function(e){Di(e),this.getMap().zoomOut()},n}(up);xp.mergeOptions({position:"top-left",zoomLevel:!0,seamless:!1}),BA.mergeOptions({zoomControl:!1}),BA.addOnLoadHook((function(){this.options.zoomControl&&(this.zoomControl=new xp(this.options.zoomControl),this.addControl(this.zoomControl))}));var bp=Object.freeze({__proto__:null,Attribution:Ap,Compass:fp,Control:up,LayerSwitcher:dp,Overview:pp,Panel:gp,Reset:mp,Scale:vp,Toolbar:_p,Zoom:xp}),wp=function(){function e(e,n,i,o){Array.isArray(e)?(this.scale={x:e[0],y:e[1]},this.origin={x:e[2],y:e[3]}):(this.scale={x:e,y:n},this.origin={x:i,y:o})}return e.getDefault=function(e){var n=e.code.toLowerCase();return"baidu"===n?"baidu":n==="EPSG:4326".toLowerCase()||n==="EPSG:4490".toLowerCase()?"tms-global-geodetic":"identity"===n?[1,-1,0,0]:"web-mercator"},e}(),Cp=6378137*Math.PI;a(wp,{"web-mercator":new wp([1,-1,-Cp,Cp]),"tms-global-mercator":new wp([1,1,-Cp,-Cp]),"tms-global-geodetic":new wp([1,1,-180,-90]),baidu:new wp([1,1,0,0])});for(var Pp=function(){function e(e,n,i,o){this.map=e,this.tileSize=o,this.fullExtent=i,this.prepareTileInfo(n,i),this._xScale=i.right>=i.left?1:-1,this._yScale=i.top>=i.bottom?1:-1;var s=e.getGLRes();this._pointOrigin=e._prjToPointAtRes(new ee(this.tileSystem.origin),s),this._glRes=s}var n=e.prototype;return n.prepareTileInfo=function(e,n){if(f(e)?e=wp[e.toLowerCase()]:Array.isArray(e)&&(e=new wp(e)),!e)throw new Error("Invalid TileSystem");this.tileSystem=e,this.transformation=new ul([n.right>n.left?1:-1,n.top>n.bottom?-1:1,e.origin.x,e.origin.y])},n._getTileNum=function(e,n){var i=this.tileSystem,o=this.tileSize,s=Math.floor(1e-7*i.scale.x+e.x/(o.width*n)),a=Math.ceil(1e-7*i.scale.y+e.y/(o.height*n));return{x:i.scale.x*s,y:i.scale.y*a}},n.getTileIndex=function(e,n,i){var o=this.tileSystem,s=this.transformation.transform(e,1),a=this._getTileNum(s,n);return o.scale.x<0&&(a.x-=1),o.scale.y>0&&(a.y-=1),this.getNeighorTileIndex(a.x,a.y,0,0,n,i)},n.getNeighorTileIndex=function(e,n,i,o,s,a){var h=this.tileSystem,l=e+h.scale.x*i,c=n-h.scale.y*o,A=!1,f=l,d=c,p=this._getTileFullIndex(s);return a&&(!0!==a&&"x"!==a||(p.xmax===p.xmin?l=p.xmin:l<p.xmin?(l=p.xmax-(p.xmin-l)%(p.xmax-p.xmin))===p.xmax&&(l=p.xmin):l>=p.xmax&&(l=p.xmin+(l-p.xmin)%(p.xmax-p.xmin))),!0!==a&&"y"!==a||(p.ymax===p.ymin?c=p.ymin:c>=p.ymax?c=p.ymin+(c-p.ymin)%(p.ymax-p.ymin):c<p.ymin&&(c=p.ymax-(p.ymin-c)%(p.ymax-p.ymin))===p.ymax&&(c=p.ymin))),(l<p.xmin||l>p.xmax||c>p.ymax||c<p.ymin)&&(A=!0),{x:l,y:c,idx:f,idy:d,out:A}},n._getTileFullIndex=function(e){if(this._tileFullIndex||(this._tileFullIndex={}),this._tileFullIndex[e])return this._tileFullIndex[e];var n=this.fullExtent,i=this.transformation,o=this._getTileNum(i.transform(new Zh(n.left,n.top),1),e),s=this._getTileNum(i.transform(new Zh(n.right,n.bottom),1),e),a=this.tileSystem;return a.scale.x<0&&(o.x-=1,s.x-=1),a.scale.y>0&&(o.y-=1,s.y-=1),this._tileFullIndex[e]=new al(o,s,null),this._tileFullIndex[e]},n.getTilePrjNW=function(e,n,i,o){var s=this.tileSystem,a=this.tileSize,h=s.origin.y+this._yScale*s.scale.y*(n+(1===s.scale.y?1:0))*i*a.height,l=s.origin.x+this._xScale*s.scale.x*(e+(1===s.scale.x?0:1))*i*a.width;return o?(o.set(l,h),o):new Zh(l,h)},n.getTilePointNW=function(e,n,i,o){var s=this._glRes/i,a=this.tileSystem,h=this.tileSize,l=this._pointOrigin.y*s+this._yScale*a.scale.y*(n+(1===a.scale.y?1:0))*h.height,c=this._pointOrigin.x*s+this._xScale*a.scale.x*(e+(1===a.scale.x?0:1))*h.width;return o?(o.set(c,l),o):new ee(c,l)},n.getTilePrjSE=function(e,n,i,o){var s=this.tileSystem,a=this.tileSize,h=s.origin.y+this._yScale*s.scale.y*(n+(1===s.scale.y?0:1))*i*a.height,l=s.origin.x+this._xScale*s.scale.x*(e+(1===s.scale.x?1:0))*i*a.width;return o?(o.set(l,h),o):new Zh(l,h)},n.getTilePointSE=function(e,n,i,o){var s=this._glRes/i,a=this.tileSystem,h=this.tileSize,l=this._pointOrigin.y*s+this._yScale*a.scale.y*(n+(1===a.scale.y?0:1))*h.height,c=this._pointOrigin.x*s+this._xScale*a.scale.x*(e+(1===a.scale.x?1:0))*h.width;return o?(o.set(c,l),o):new ee(c,l)},n.getTilePrjExtent=function(e,n,i){var o=this.getTilePrjNW(e,n,i),s=this.getTilePrjSE(e,n,i);return new al(o,s)},e}(),Mp=[],Tp=0
/*!
  * Contains code from THREE.js
  * MIT License
  * https://github.com/mrdoob/three.js
  */;Tp<6;Tp++)Mp[Tp]=[];var Sp=[];function Ip(e,n,i){!function(e){var n=e,i=n[0],o=n[1],s=n[2],a=n[3],h=n[4],l=n[5],c=n[6],A=n[7],f=n[8],d=n[9],p=n[10],g=n[11],v=n[12],w=n[13],C=n[14],P=n[15];Op(Mp[0],a-i,A-h,g-f,P-v),Op(Mp[1],a+i,A+h,g+f,P+v),Op(Mp[2],a+o,A+l,g+d,P+w),Op(Mp[3],a-o,A-l,g-d,P-w),Op(Mp[4],a-s,A-c,g-p,P-C),Op(Mp[5],a+s,A+c,g+p,P+C)}(e);for(var o=0;o<6;o++){var s=Mp[o];if(Sp[0]=s[0]>0?n[1][0]:n[0][0],Sp[1]=s[1]>0?n[1][1]:n[0][1],Sp[2]=s[2]>0?n[1][2]:n[0][2],Rp(s,Sp)<0)return!1}return!0}var Ep=1/6;function Op(e,n,i,o,s){return e[0]=n*Ep,e[1]=i*Ep,e[2]=o*Ep,e[3]=s*Ep,e}function Rp(e,n){return e[0]*n[0]+e[1]*n[1]+e[2]*n[2]+e[3]}var Dp=new ee(0,0),kp="undefined"!=typeof Set,Lp=function(){function e(){this._table=kp?new Set:{}}var n=e.prototype;return n.add=function(e){kp?this._table.add(e):this._table[e]=!0},n.has=function(e){return kp?this._table.has(e):this._table[e]},n.reset=function(){kp?this._table.clear():this._table={}},e}(),Fp={urlTemplate:null,subdomains:null,errorUrl:null,repeatWorld:!0,background:!0,loadingLimitOnInteracting:3,loadingLimit:0,placeholder:!1,crossOrigin:null,tileSize:[256,256],offset:[0,0],tileSystem:null,fadeAnimation:!n,fadeDuration:1e3/60*10,debug:!1,spatialReference:null,maxCacheSize:256,renderer:wt.webgl?"gl":"canvas",clipByPitch:!0,maxAvailableZoom:null,cascadeTiles:!0,zoomOffset:0,pyramidMode:1,decodeImageInWorker:!1,tileLimitPerFrame:0,tileStackStartDepth:7,tileStackDepth:6,awareOfTerrain:!0,bufferPixel:.5,mipmapTexture:!0,depthMask:!0,currentTilesFirst:!0,forceRenderOnMoving:!0,tileErrorScale:1},Np=/\{ *([\w_]+) *\}/g,zp=new ee(0,0),Bp=new ee(0,0),Hp=new ee(0,0),jp=new ee(0,0),Up=new ee(0,0),Gp=new ee(0,0),Vp=[[0,0,0],[0,0,0]],Wp=[0,0,0],qp=[0,0,0],Zp=[0,0,0],Qp=function(e){function n(n,i){return e.call(this,n,i)||this}kt(n,e),n.fromJSON=function(e){return e&&"TileLayer"===e.type?new n(e.id,e.options):null};var i=n.prototype;return i.forceReload=function(){return this.fire("forcereloadstart"),this.clear(),this._renderer&&this._renderer.setToRedraw(),this.fire("forcereloadend"),this},i.getTileSize=function(e){if(this._tileSize)return this._tileSize;var n=this.options.tileSize;return l(n)&&(n=[n,n]),this._tileSize=new Cn(n),this._tileSize},i.getTiles=function(e,n){var i,o=this;if(this._coordCache={},i=this._isPyramidMode()?this._getPyramidTiles(e,n):this._getCascadeTiles(e,n),!this._maskGeoJSON)return i;var s=0;return(i.tileGrids||[]).forEach((function(e){e.tiles=(e.tiles||[]).filter((function(e){return o._tileInMask(e)})),s+=e.tiles.length;var n=e.tiles.map((function(e){return e.parent}));e.parents=e.parents.filter((function(e){return n.indexOf(e.id)>-1}))})),i.count=s,i},i._isPyramidMode=function(){var e=this.getSpatialReference();return!this._disablePyramid&&!this._hasOwnSR&&this.options.pyramidMode&&e&&e.isPyramid()},i._getTileFullExtent=function(){if(this._tileFullExtent)return this._tileFullExtent;var e=this.getSpatialReference(),n=e.getFullExtent(),i=e.getResolution(0),o=this.getMap();return this._tileFullExtent=n.convertTo((function(e){return o._prjToPointAtRes(e,i,Dp)})),this._tileFullExtent},i._getRootNodes=function(e){var n=this.getMap();if(this._rootNodes){var{tiles:i,mapWidth:o,mapHeight:s}=this._rootNodes;if(n.width!==o||n.height!==s){for(var a=this._getRootError(),h=0;h<i.length;h++)i[h].error=a;this._rootNodes.mapWidth=n.width,this._rootNodes.mapHeight=n.height}for(var l=0;l<i.length;l++)i[l].offset[0]=e[0],i[l].offset[1]=e[1];return this._rootNodes}var c=this.getSpatialReference(),A=c.getResolution(0),f=this._getTileConfig(),d=c.getFullExtent(),{origin:p,scale:g}=f.tileSystem,v=f.getTilePrjExtent(0,0,A),w=v.getWidth(),C=v.getHeight(),P=1e-5,T=Math.abs((p.x-d.left)/w);T=Math.ceil(T-P);var S=Math.abs((d.right-p.x)/w);S=Math.ceil(S-P);var I=Math.ceil(Math.abs(d.top-p.y)/C);I=Math.ceil(I-P);var E=Math.ceil(Math.abs(d.bottom-p.y)/C);if((S+T)*((E=Math.ceil(E-P))+I)>32)return{status:0,error:"Too many root nodes"};for(var O=this._getRootError(),k=[],L=-T;L<S;L++)for(var F=-I;F<E;F++){var N=g.y<0?F:-(F+1);k.push(this.createTileNode(L,N,0,L,N,A,O))}return this._rootNodes={status:1,tiles:k,mapWidth:n.width,mapHeight:n.height},this._getRootNodes(e)},i.createTileNode=function(e,n,i,o,s,a,h,l,c,A){var f=this.getMap(),d=this.options.zoomOffset;c||(c=this._getTileConfig().getTilePrjExtent(e,n,a).convertTo((function(e){return f._prjToPointAtRes(e,a,Dp)})));var p=this._getTileOffset(i),g=this.getTileUrl(e,n,i+d);return{parent:l,layer:this.getId(),x:e,y:n,z:i,idx:o,idy:s,res:a,extent2d:c,id:A||this._getTileId(e,n,i),url:fr(g),offset:p,error:h,children:[]}},i._getRootError=function(){var e=this.getMap(),n=w(e.getFov()),i=e.width/e.height,o=e.cameraPosition[2],s=o*Math.tan(.5*n),a=s*i,h=Math.sqrt(o*o+s*s+a*a);return e._getFovZ(0)*(h/o)*this.getSpatialReference().getResolution(0)/e.getResolution(0)},i._getPyramidTiles=function(e,n){var i=this.getMap();isNaN(+e)&&(e=this._getTileZoom(i.getZoom()));var o,s=this.getSpatialReference(),a=Math.min(e,this.getMaxZoom(),this.getMaxAvailableZoom()||1/0),h=i.projViewMatrix,l=this._getTileFullExtent(),c=this._getTileOffset(0);if(this.options.repeatWorld){var A=i.getContainerExtent(),f=this._convertToExtent2d(A),d=s.getResolution(0)/i.getResolution();if(f.within(l.copy()._scale(d))){var p=this._getRootNodes(c);if(1!==p.status)return console.warn(p.error),this._disablePyramid=!0,this.getTiles(e,n);o=[...p.tiles]}else{var g=i.getPitch(),v=i.options.cascadePitches[1],w=Math.floor(i._getVisualHeight(v)),C=g<=v?A:new ll(0,i.height-w,i.width,i.height);this._visitedTiles=new Lp;var P=this._getTiles(0-this.options.zoomOffset,C,2,n&&n.getRenderer(),!0),T=this._getRootError()*Math.pow(2,this.options.zoomOffset);P.tiles.forEach((function(e){e.error=T})),o=P.tiles}}else{var S=this._getRootNodes(c);if(1!==S.status)return console.warn(S.error),this._disablePyramid=!0,this.getTiles(e,n);o=[...S.tiles]}for(var I=i.getGLRes(),E={0:c},O=new ll,k=[],L=[];o.length>0;){var F=o.pop();F.z!==a?(E[F.z+1]||(E[F.z+1]=this._getTileOffset(F.z+1)),this._splitNode(F,h,o,k,O,a,E[F.z+1],n&&n.getRenderer(),I),this.isParentTile(e,a,F)&&L.push(F)):(O._combine(F.extent2d),k.push(F))}return L.sort(Xp),{tileGrids:[{extent:O,count:k.length,tiles:k,parents:L,offset:[0,0],zoom:e}],count:k.length}},i.isParentTile=function(e,n,i){var o=Math.max(this.getMinZoom(),e-this.options.tileStackStartDepth),s=Math.min(n,o+this.options.tileStackDepth);return i.z>=o&&i.z<s},i._splitNode=function(e,n,i,o,s,a,h,l,c){for(var A=e.z+1,f=this.getSpatialReference(),{idx:d,idy:p}=e,g=l||this.getRenderer(),v=!1,w=[],C=f.getResolution(A)/c,P=0;P<4;P++){var T=P%2,S=P>>1,I=(d<<1)+T,E=(p<<1)+S;e.children||(e.children=[]);var O=e.children[P];O||(O=this._getTileId(I,E,A),e.children[P]=O);var k=g.isTileCachedOrLoading(O),L=k&&k.info;L||(this.tileInfoCache||(this.tileInfoCache=new Oa(4*this.options.maxCacheSize)),(L=this.tileInfoCache.get(O))||(L=this._createChildNode(e,T,S,h,O))),L.error=e.error/2,L.offset[0]=h[0],L.offset[1]=h[1];var F=this._isTileVisible(L,n,C,a,h);if(1===F)v=!0;else{if(-1===F)continue;if(0===F&&A!==a)return o.push(e),void s._combine(e.extent2d)}w.push(L)}A===a?v?i.push(...w):(o.push(e),s._combine(e.extent2d)):i.push(...w)},i._createChildNode=function(e,n,i,o,s){var a,{x:h,y:l,idx:c,idy:A,extent2d:f}=e,d=e.z+1,p=(h<<1)+n,g=(l<<1)+i,v=(c<<1)+n,w=(A<<1)+i,C=f.getWidth()/2*2,P=f.getHeight()/2*2,T=2*f.xmin,S=2*f.ymax,I=2*f.ymin,E=this._getTileConfig().tileSystem.scale.y;if(s=s||this._getTileId(v,w,d),E<0){var O=T+n*C,k=S-i*P;a=new ll(O,k-P,O+C,k)}else{var L=T+n*C,F=I+i*P;a=new ll(L,F,L+C,F+P)}var N=this.createTileNode(p,g,d,v,w,e.res/2,e.error/2,e.id,a,s);return this.tileInfoCache.add(s,N),N},i._isTileVisible=function(e,n,i,o,s){if(0===e.z)return 1;if(!this._isTileInFrustum(e,n,i,s))return-1;var a=this.options.maxError;return h(a)&&(a=1),this._getScreenSpaceError(e,i,o,s)>=a?1:0},i._isTileInFrustum=function(e,n,i,o){if(!this._zScale){var s=this.getMap(),a=s.getGLRes();this._zScale=s.altitudeToPoint(100,a)/100}var h=this.getRenderer(),{xmin:l,ymin:c,xmax:A,ymax:f}=e.extent2d;if(e.offset&&!d(this.options.offset)){var[p,g]=e.offset;l+=p,A+=p,c+=g,f+=g}return Vp[0][0]=(l-o[0])*i,Vp[0][1]=(c-o[1])*i,Vp[0][2]=(e.minAltitude||h&&h.avgMinAltitude||0)*this._zScale,Vp[1][0]=(A-o[0])*i,Vp[1][1]=(f-o[1])*i,Vp[1][2]=(e.maxAltitude||h&&h.avgMaxAltitude||0)*this._zScale,Ip(n,Vp)},i._getScreenSpaceError=function(e,n,i,o){var s=e.error,a=this.getMap(),{xmin:h,ymin:l,xmax:c,ymax:A}=e.extent2d;Wp[0]=(h-o[0])*n,Wp[1]=(l-o[1])*n,qp[0]=(c-o[0])*n,qp[1]=(A-o[1])*n;var f=function(e,n,i){var o=Math.max(e[0]-i[0],0,i[0]-n[0]),s=Math.max(e[1]-i[1],0,i[1]-n[1]),a=Math.max(e[2]-i[2],0,i[2]-n[2]);return Math.sqrt(o*o+s*s+a*a)}(Wp,qp,a.cameraPosition),d=Math.max(Math.abs(f),1e-7),p=Math.abs(e.z-i),g=s*(a.height<1e3||p<=1?1:p<=2?.7:.605)/d*this.options.tileErrorScale;return this.getMap().getPitch()<=60?1.45*g:g},i._getCascadeTiles=function(e,n){var i=this.getMap(),o=i.getPitch(),s=n&&n.getRenderer(),a=i.getContainerExtent(),l=[],c=0,A=this.getMinZoom(),f=i.options.cascadePitches[0],d=i.options.cascadePitches[1],p=Math.floor(i._getVisualHeight(d)),g=h(e)?this._getTileZoom(i.getZoom()):e;if(this._visitedTiles=new Lp,!h(e)||!this.options.cascadeTiles||o<=f||!h(A)&&g<=A){var v=o<=d?a:new ll(0,i.height-p,i.width,i.height),w=this._getTiles(g,v,2,s);return w&&(c+=w.tiles.length,l.push(w)),{tileGrids:l,count:c}}var C=Math.floor(i._getVisualHeight(f)),P=new ll(0,i.height-C,i.width,i.height),T=this._getTiles(g,P,0,s);c+=T?T.tiles.length:0,l.push(T);var S,I,E=P.ymin,O=i.getSpatialReference().getZoomDirection(),k=O;if(o>d){g-k<=A&&(k=0);var L=new ll(0,i.height-p,i.width,E);c+=(S=this._getTiles(g-k,L,1,s))?S.tiles.length:0,E=L.ymin,k+=4*O,l.push(S)}if(g-k>=A){var F=new ll(0,a.ymin,i.width,E);c+=(I=this._getTiles(g-k,F,2,s))?I.tiles.length:0,l.push(I)}return S&&I&&(l[1]=I,l[2]=S),{tileGrids:l,count:c}},i.getTileUrl=function(e,n,i){var o=this.options.urlTemplate,s="";if(this.options.subdomains){var h=this.options.subdomains;if(xe(h)){var l=(e+n)%h.length;l<0&&(l=0),s=h[l]}}if(d(o))return o(e,n,i,s);var c={x:e,y:n,z:i,s};return this.options.token&&(c.token=this.options.token),this.options.customTags&&a(c,this.options.customTags),o.replace(Np,(function(e,n){var i=c[n];if(void 0===i)throw new Error("No value provided for variable "+e);return"function"==typeof i&&(i=i(c)),i}))},i.clear=function(){return this._renderer&&this._renderer.clear(),this.tileInfoCache&&this.tileInfoCache.reset(),this.fire("clear"),this},i.toJSON=function(){return{type:this.getJSONType(),id:this.getId(),options:this.config()}},i.getSpatialReference=function(){var e=this.getMap();if(e&&(!this.options.spatialReference||fA.equals(this.options.spatialReference,e.options.spatialReference)))return e.getSpatialReference();if(this._sr)return this._sr;var n=this.options.spatialReference;if(f(n)&&!(n=fA.getPreset(n)))throw new Error("Unsupported spatial reference: "+this.options.spatialReference+", possible values: "+fA.getAllPresets().join());return this._sr=new fA(n),this._srMinZoom=this._sr.getMinZoom(),this._srMaxZoom=this._sr.getMaxZoom(),this._hasOwnSR=this._sr.toJSON().projection!==e.getSpatialReference().toJSON().projection,this._sr},i.getMinZoom=function(){var e=this.options.minZoom||0;return this.getSpatialReference()!==this.getMap().getSpatialReference()?Math.max(e,this._srMinZoom):e},i.getMaxZoom=function(){return this.getSpatialReference()!==this.getMap().getSpatialReference()?Math.min(e.prototype.getMaxZoom.call(this),this._srMaxZoom):e.prototype.getMaxZoom.call(this)},i._getTileZoom=function(e){if(!this._hasOwnSR){var n=this.getMap().getResolution(e),i=this.getSpatialReference().getResolution(e);e+=Math.log(i/n)*Math.LOG2E}var o=this.getMaxAvailableZoom();return!h(o)&&e>o&&(e=o),c(e)||(e=Math.round(e)),e=Math.max(0,e)},i.getMaxAvailableZoom=function(){var e=this.getSpatialReference();return this.options.maxAvailableZoom||e&&e.getMaxZoom()},i._getTiles=function(e,n,i,o,s){var a=this.getMap(),l=e,c=a.projViewMatrix,A=a.getResolution(e)/a.getResolution(e-1)==.5;i<2&&(0===i&&A&&(l-=1),c=0===i?a.cascadeFrustumMatrix0:1===i?a.cascadeFrustumMatrix1:a.projViewMatrix);var f=l+this.options.zoomOffset,d=this._getTileOffset(l),p=d[0]||d[1],g={zoom:l,extent:null,offset:d,tiles:[]};if(f<0)return g;if(!(a&&this.isVisible()&&a.width&&a.height))return g;if(!s){var v=this.getMinZoom(),w=this.getMaxZoom();if(!h(v)&&l<v||!h(w)&&l>w)return g}var C=this._getTileConfig();if(!C)return g;var P,T={zoom:d},S=this.getSpatialReference().getResolution(l);P=this._hasOwnSR?a.getGLScale(l):S/a.getGLRes();var I=!this._hasOwnSR&&this.options.repeatWorld,E=this._convertToExtent2d(n),O=this._getMask2DExtent();if(O){var k=O.intersection(E);if(!k)return g;n=k.convertTo((function(e){return a._pointToContainerPoint(e,void 0,0,Dp)}))}var L,F=a._containerPointToPrj(n.getCenter(),zp),N=a._prjToPoint(F,l,Bp);L=this._project(p?a._pointToPrj(N._add(d),l,Bp):F,Bp);var z=a.getGLScale()/a.getGLScale(l);Hp.x=E.xmin*z,Hp.y=E.ymax*z,jp.x=E.xmax*z,jp.y=E.ymin*z;for(var H=this._project(a._pointToPrj(Hp._add(d),l,Hp),Hp),j=this._project(a._pointToPrj(jp._add(d),l,jp),jp),W=C.getTileIndex(L,S,I),q=C.getTileIndex(H,S,I),Y=C.getTileIndex(j,S,I),J=Math.ceil(Math.abs(W.idy-q.idy)),$=Math.ceil(Math.abs(W.idx-q.idx)),it=Math.ceil(Math.abs(W.idy-Y.idy)),rt=Math.ceil(Math.abs(W.idx-Y.idx)),ot=(J+it+1)*($+rt+1),st=this.getTileSize(),at=this.getRenderer()||o,ht=this._getTileConfig().tileSystem.scale,At=[],ft=new ll,gt=new ee(0,0),vt=-J;vt<=it;vt++)for(var _t=-$,xt=-1/0,wt=!1;_t>=xt&&_t<=rt;){var Ct=C.getNeighorTileIndex(W.idx,W.idy,_t,vt,S,I);xt===-1/0?_t++:_t--;var Ot=this._getTileId(Ct.idx,Ct.idy,l);if(!(Ct.out||this._visitedTiles&&this._visitedTiles.has(Ot))){var Dt=at&&at.isTileCachedOrLoading(Ot);Dt&&(Dt=Dt.info);var kt=void 0;if(Dt){var{extent2d:Nt}=Dt;gt.set(Nt.xmin,Nt.ymax),kt=gt}else if(this._hasOwnSR){var Bt=C.getTilePrjNW(Ct.x,Ct.y,S);kt=a._prjToPoint(this._unproject(Bt,jp),l)}else kt=C.getTilePointNW(Ct.x,Ct.y,S);var Ht=void 0,Ut=void 0;if(this._hasOwnSR){var Wt=void 0;if(this._hasOwnSR){var Xt=C.getTilePrjSE(Ct.x,Ct.y,S);Wt=a._prjToPoint(this._unproject(Xt,jp),l,jp)}else Wt=C.getTilePointSE(Ct.x,Ct.y,S);Ht=Math.ceil(Math.abs(Wt.x-kt.x)),Ut=Math.ceil(Math.abs(Wt.y-kt.y))}else Ht=st.width,Ut=st.height;var Kt=ht.x*(Ct.idx-Ct.x)*Ht,$t=ht.y*(Ct.idy-Ct.y)*Ut;Dt||!Kt&&!$t||kt._add(Kt,$t);var te=Dt&&Dt.extent2d||new ll(kt.x,kt.y-Ut,kt.x+Ht,kt.y);if(ot<=4||wt||this._isTileInExtent(c,te,d,P)){var ne=this._hasOwnSR?a._getResolution(l):S;this._visitedTiles&&0===i&&this._visitedTiles.add(Ot),A&&0===i?(this._splitTiles(c,At,at,Ct,l+1,ne,te,Kt,$t,T),ft._combine(te)):(Dt?(Dt.offset[0]=d[0],Dt.offset[1]=d[1]):Dt=this.createTileNode(Ct.x,Ct.y,l,Ct.idx,Ct.idy,ne,0,null,te,Ot),At.push(Dt),ft._combine(te)),xt===-1/0?(xt=_t,_t=rt):wt||(wt=!0)}}}if(At.length){var ie=a._containerPointToPoint(n.getCenter(),l,Dp)._add(d),re=new ee(0,0),oe=new ee(0,0);At.sort((function(e,n){return re.set((e.extent2d.xmin+e.extent2d.xmax)/2,(e.extent2d.ymin+e.extent2d.ymax)/2),oe.set((n.extent2d.xmin+n.extent2d.xmax)/2,(n.extent2d.ymin+n.extent2d.ymax)/2),re.distanceTo(ie)-oe.distanceTo(ie)}))}return{offset:d,zoom:e,extent:ft,tiles:At}},i._convertToExtent2d=function(e){var n=this,i=this.getMap();return e.convertTo((function(e){if(e.y>0&&e.y<i.height){var o=(0===e.x?0:1)+e.y;n._coordCache[o]||(n._coordCache[o]=i._containerPointToPoint(e)),n._coordCache[o]}return i._containerPointToPoint(e,void 0,Dp)}))},i._splitTiles=function(e,n,i,o,s,a,h,l,c,A){var f=this._getTileConfig().tileSystem.scale.y,d=this.getMap().getGLScale(s),p=Up.set(2*h.xmin,f<0?2*h.ymax:2*h.ymin),g=h.getWidth(),v=h.getHeight(),w=2*o.idx,C=2*o.idy,P=2*o.x,T=2*o.y,S=this._checkAndAddTile(e,i,w,C,P,T,s,a,0,0,g,v,p,d,A);S&&n.push(S),(S=this._checkAndAddTile(e,i,w,C,P,T,s,a,0,1,g,v,p,d,A))&&n.push(S),(S=this._checkAndAddTile(e,i,w,C,P,T,s,a,1,0,g,v,p,d,A))&&n.push(S),(S=this._checkAndAddTile(e,i,w,C,P,T,s,a,1,1,g,v,p,d,A))&&n.push(S)},i._checkAndAddTile=function(e,n,i,o,s,a,h,l,c,A,f,d,p,g,v){var w=this._getTileId(i+c,o+A,h);if(this._visitedTiles&&this._visitedTiles.has(w))return null;var C=v[h];C||(C=v[h]=this._getTileOffset(h));var P=this._getTileConfig().tileSystem.scale.y,T=new ll(p.x+c*f,p.y+P*A*d,p.x+(c+1)*f,p.y+P*(A+1)*d);if(!this._isSplittedTileInExtent(e,T,C,g))return null;var S=l/2,I=n&&n.isTileCachedOrLoading(w);return I?I.info:this.createTileNode(s+c,a+A,h,i+c,i+a,S,0,null,T,w)},i._getTileOffset=function(...e){var n=this.options.offset;return d(n)&&(n=n.call(this,...e)),l(n)&&(n=[n,n]),n||[0,0]},i.getTileId=function(e,n,i,o){return this._getTileId(e,n,i,o)},i._getTileId=function(e,n,i,o){return(o||this.getId())+"_"+e+"_"+n+"_"+i},i._project=function(e,n){if(this._hasOwnSR){var i=this.getMap().getProjection();return this.getSpatialReference().getProjection().project(i.unproject(e,n),n)}return e},i._unproject=function(e,n){if(this._hasOwnSR){var i=this.getMap(),o=this.getSpatialReference(),s=i.getProjection(),a=o.getProjection();return s.project(a.unproject(e,n),n)}return e},i._initTileConfig=function(){var e=this.getMap(),n=this.getTileSize(),i=this.getSpatialReference(),o=i.getProjection(),s=i.getFullExtent();this._defaultTileConfig=new Pp(e,wp.getDefault(o),s,n),this.options.hasOwnProperty("tileSystem")&&(this._tileConfig=new Pp(e,this.options.tileSystem,s,n)),delete this._rootNodes,delete this._tileFullExtent,delete this._disablePyramid},i._getTileConfig=function(){return this._defaultTileConfig||this._initTileConfig(),this._tileConfig||this._defaultTileConfig},i._bindMap=function(n){return this._onSpatialReferenceChange(),e.prototype._bindMap.apply(this,arguments)},i._isTileInExtent=function(e,n,i,o){var s,a=this.getMap();if(e!==a.projViewMatrix){var h=n.getCenter(Gp)._sub(i[0],i[1])._multi(o);Cs(Zp,h.x,h.y,0);var l=function(e,n,i){var o=n[0],s=n[1],a=n[2],h=i[3]*o+i[7]*s+i[11]*a+i[15];return e[0]=(i[0]*o+i[4]*s+i[8]*a+i[12])/(h=h||1),e[1]=(i[1]*o+i[5]*s+i[9]*a+i[13])/h,e[2]=(i[2]*o+i[6]*s+i[10]*a+i[14])/h,e}(Zp,Zp,a.projViewMatrix);s=l[1]<0?a.projViewMatrix:e}else s=a.projViewMatrix;return Vp[0][0]=(n.xmin-i[0])*o,Vp[0][1]=(n.ymin-i[1])*o,Vp[1][0]=(n.xmax-i[0])*o,Vp[1][1]=(n.ymax-i[1])*o,Ip(s,Vp)},i._isSplittedTileInExtent=function(e,n,i,o){var s=this.getMap();return Vp[0][0]=(n.xmin-i[0])*o,Vp[0][1]=(n.ymin-i[1])*o,Vp[1][0]=(n.xmax-i[0])*o,Vp[1][1]=(n.ymax-i[1])*o,Ip(s.projViewMatrix,Vp)},i.getEvents=function(){return{spatialreferencechange:this._onSpatialReferenceChange}},i._onSpatialReferenceChange=function(){delete this._tileConfig,delete this._defaultTileConfig,delete this._sr,delete this._srMinZoom,delete this._hasOwnSR,delete this._rootNodes,this.tileInfoCache&&this.tileInfoCache.reset();var e=this.getRenderer();e&&e.clear()},i.getPolygonOffsetCount=function(){return 2},i.getPolygonOffset=function(){return this._polygonOffset||0},i.setPolygonOffset=function(e){return this._polygonOffset=e,this},i.getRenderer=function(){return e.prototype.getRenderer.call(this)},i._getTileBBox=function(e){var n=this.getMap();if(n){var i=e.extent2d,o=e.offset||[0,0];if(i){var s=e.res,[a,h]=o,{xmin:l,ymin:c,xmax:A,ymax:f}=i;A-=a,f-=h;var d=new ee(l-=a,c-=h),p=new ee(A,f),g=n.pointAtResToCoordinate(d,s,zp),v=n.pointAtResToCoordinate(p,s,Bp);return[g.x,g.y,v.x,v.y]}}},i._tileInMask=function(e){var n=this.getMask();if(!n)return!0;var i=n.type;if(!i||-1===i.indexOf("Polygon"))return!0;var o=this._maskGeoJSON;if(!o||!o.geometry)return!0;var{coordinates:s,type:a}=o.geometry;if(!s||!a)return!0;if(-1===a.indexOf("Polygon"))return!0;if(!o.bbox){var h=n.getExtent();if(!h)return!0;o.bbox=[h.xmin,h.ymin,h.xmax,h.ymax]}var l=this._getTileBBox(e);return!l||bs(l,this._maskGeoJSON)},n}(RA);function Xp(e,n){return e.z-n.z}Qp.registerJSONType("TileLayer"),Qp.mergeOptions(Fp);var Yp=new Cn(256,256),Jp="show hide remove setzindex forcereloadstart";function Kp(e){return Array.isArray(e)||(e=[e]),e}var $p=function(e){function n(n,i,o){var s;return(s=e.call(this,n,o)||this).layers=i||[],s._checkChildren(),s.layerMap={},s._groupChildren=[],s}kt(n,e),n.fromJSON=function(e){if(!e||"GroupTileLayer"!==e.type)return null;var i=e.layers.map((function(e){return RA.fromJSON(e)}));return new n(e.id,i,e.options)};var i=n.prototype;return i.getLayers=function(){return this.layers},i.addLayer=function(e=[]){var n=this;e=Kp(e);var i=this.layers.length;return e.forEach((function(e){e instanceof Qp&&(-1!==n.layers.indexOf(e)||n.layerMap[e.getId()]||n.layers.push(e))})),i!==this.layers.length&&(this._sortLayers(),this._refresh(),this._renderLayers()),this},i.removeLayer=function(e=[]){var n=this;e=Kp(e);var i=this.layers.length;return e.forEach((function(e){if(e instanceof Qp||(e=n.layerMap[e]),e instanceof Qp){var i=n.layers.indexOf(e);i>=0&&(n.layers.splice(i,1),e._doRemove(),e.off(Jp,n._onLayerShowHide,n))}})),i!==this.layers.length&&(this._refresh(),this._renderLayers()),this},i.clearLayers=function(){var e=this;return this.layers.forEach((function(n){n._doRemove(),n.off(Jp,e._onLayerShowHide,e)})),this.layers=[],this._refresh(),this._renderLayers(),this},i.toJSON=function(){return{type:this.getJSONType(),id:this.getId(),layers:this.layers.map((function(e){return e.toJSON()})),options:this.config()}},i.getTileSize=function(e){var n=this.getLayer(e);return n?n.getTileSize():Yp},i.getTiles=function(e,n){for(var i=this.layers,o=[],s=0,a=0,h=i.length;a<h;a++){var l=i[a];if(l&&l.options.visible&&l.isVisible()&&l.getMap()){var c=l.getTiles(e,n||this);c&&0!==c.count&&(s+=c.count,he(o,c.tileGrids))}}return{count:s,tileGrids:o}},i.onAdd=function(){this._sortLayers(),this._refresh(),e.prototype.onAdd.call(this)},i.onRemove=function(){var n=this;this.layers.forEach((function(e){e._doRemove(),e.off(Jp,n._onLayerShowHide,n)})),this.layerMap={},this._groupChildren=[],e.prototype.onRemove.call(this)},i.getLayer=function(e){return this.getChildLayer(e)},i.getChildLayer=function(e){var n=this.layerMap[e];if(n)return n;for(var i=0;i<this._groupChildren.length;i++){var o=this._groupChildren[i].getChildLayer(e);if(o)return o}return null},i._removeChildTileCache=function(e){if(!e)return this;var n,i=this.getRenderer();if(!i)return this;var o=e.getId(),s=function(){return n&&n.info&&n.info.layer===o};i.tileCache&&i.tileCache.keys().forEach((function(e){n=i.tileCache.get(e),s()&&i.tileCache.remove(e)}));var a=i.tilesInView||{};for(var h in a)n=a[h],s()&&delete a[h];var l=i.tilesLoading||{};for(var c in l)n=l[c],s()&&i.abortTileLoading(n.image,n.info);return this},i._onLayerShowHide=function(e){var{type:n,target:i}=e||{};"remove"===n&&i?(this.layers.splice(this.layers.indexOf(i),1),i._doRemove(),i.off(Jp,this._onLayerShowHide,this),this._refresh()):"setzindex"===n?this._sortLayers():"forcereloadstart"===n&&this._removeChildTileCache(i),this._renderLayers()},i._renderLayers=function(){var e=this.getRenderer();return e&&e.setToRedraw(),this},i._refresh=function(){var e=this,n=this.getMap();return this._groupChildren=[],this.layerMap={},this.layers.forEach((function(i){e.layerMap[i.getId()]=i,i.getChildLayer&&e._groupChildren.push(i),i.getMap()||i._bindMap(n),i.off(Jp,e._onLayerShowHide,e),i.on(Jp,e._onLayerShowHide,e)})),this},i.isVisible=function(){if(!e.prototype.isVisible.call(this))return!1;for(var n=this.layers,i=0,o=n.length;i<o;i++)if(n[i].isVisible())return!0;return!1},i._checkChildren=function(){var e=this,n={};this.layers.forEach((function(i){var o=i.getId();if(n[o])throw new Error("Duplicate child layer id ("+o+") in the GroupTileLayer ("+e.getId()+")");n[o]=1}))},i._sortLayers=function(){this.layers.sort((function(e,n){return e.options.zIndex-n.options.zIndex}))},n}(Qp);$p.registerJSONType("GroupTileLayer"),$p.mergeOptions({urlTemplate:"",maxCacheSize:1024});var tg,eg={urlTemplate:"",crs:null,uppercase:!1,detectRetina:!1},ng={service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},ig=function(e){function n(n,i){var o;return o=e.call(this,n)||this,tg||(tg=a({},o.options)),o.wmsParams=a({},ng),o.setOptions(i),o.setZIndex(i.zIndex),wt.proxy||o._optionsHook(i),o}kt(n,e);var i=n.prototype;return i._optionsHook=function(e={}){for(var n in e)"tileSize"===n&&(this._tileSize=null),n in tg||(this.wmsParams[n]=e[n]);var i=this.getTileSize();return this.wmsParams.width=i.width,this.wmsParams.height=i.height,this._wmsVersion=parseFloat(this.wmsParams.version),this},i.onAdd=function(){var n=this.getMap().getDevicePixelRatio(),i=eg.detectRetina?n:1;this.wmsParams.width*=i,this.wmsParams.height*=i;var o=this.options.crs||this.getMap().getProjection().code;this.wmsParams[this._wmsVersion>=1.3?"crs":"srs"]=o,e.prototype.onAdd.call(this)},i.getTileUrl=function(n,i,o){var s=this.getSpatialReference().getResolution(o),a=this._getTileConfig().getTilePrjExtent(n,i,s),h=a.getMax(),l=a.getMin(),c=(this._wmsVersion>=1.3&&("EPSG:4326"===this.wmsParams.crs||"EPSG:4490"===this.wmsParams.crs)?[l.y,l.x,h.y,h.x]:[l.x,l.y,h.x,h.y]).join(","),A=e.prototype.getTileUrl.call(this,n,i,o);return A+function(e,n,i){var o=[];for(var s in e)o.push(encodeURIComponent(i?s.toUpperCase():s)+"="+encodeURIComponent(e[s]));return(n&&-1!==n.indexOf("?")?"&":"?")+o.join("&")}(this.wmsParams,A,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+c},i.toJSON=function(){return{type:"WMSTileLayer",id:this.getId(),options:this.config()}},n.fromJSON=function(e){return e&&"WMSTileLayer"===e.type?new n(e.id,e.options):null},n}(Qp);ig.registerJSONType("WMSTileLayer"),ig.mergeOptions(eg);var rg=function(e){function n(n,i){var o;return(o=e.call(this,n,i)||this).options.hasOwnProperty("forceRenderOnMoving")||(o.options.forceRenderOnMoving=!1),o}kt(n,e);var i=n.prototype;return i.drawTile=function(){},i.toJSON=function(){return{type:"CanvasTileLayer",id:this.getId(),options:this.config()}},n.fromJSON=function(e){return e&&"CanvasTileLayer"===e.type?new n(e.id,e.options):null},n}(Qp);function og(e,n,i){var o=e.createShader(n);if(e.shaderSource(o,i),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS)){var s=e.getShaderInfoLog(o);throw e.deleteShader(o),new Error("Failed to compile shader: "+s)}return o}function sg(e,n,i){var o=og(e,e.VERTEX_SHADER,n),s=og(e,e.FRAGMENT_SHADER,i);if(!o||!s)return null;var a=e.createProgram();return a?(e.attachShader(a,o),e.attachShader(a,s),e.linkProgram(a),{program:a,vertexShader:o,fragmentShader:s}):null}function ag(e,n,i){if(Array.isArray(i[0])){for(var o=Float32Array.BYTES_PER_ELEMENT,s=0,a=0;a<i.length;a++)s+=i[a][1]||0;for(var h=0,l=0;l<i.length;l++){var c=e.getAttribLocation(n,i[l][0]);if(c<0)throw new Error("Failed to get the storage location of "+i[l][0]);e.vertexAttribPointer(c,i[l][1],e[i[l][2]||"FLOAT"],!1,o*s,o*h),h+=i[l][1]||0,e.enableVertexAttribArray(c)}}else{var A=e.getAttribLocation(n,i[0]);e.vertexAttribPointer(A,i[1],e[i[2]||"FLOAT"],!1,0,0),e.enableVertexAttribArray(A)}}rg.registerJSONType("CanvasTileLayer");var hg={never:512,"<":513,"=":514,"<=":515,">":516,"!=":517,">=":518,always:519};var lg=[1,1,1,1],ug=new Float32Array(8),cg=new Int16Array(8),Ag="\n        attribute vec2 a_position;\n\n        attribute vec2 a_texCoord;\n\n        uniform mat4 u_matrix;\n\n        varying vec2 v_texCoord;\n\n        void main() {\n            gl_Position = u_matrix * vec4(a_position, 0., 1.);\n\n            v_texCoord = a_texCoord;\n        }\n    ",fg="\n        precision mediump float;\n\n        uniform sampler2D u_image;\n\n        uniform float u_opacity;\n        uniform float u_debug_line;\n        uniform vec4 u_base_color;\n        uniform float u_alpha_test;\n        varying vec2 v_texCoord;\n\n        void main() {\n            if (u_debug_line == 1.) {\n                gl_FragColor = vec4(0., 1., 0., 1.);\n            } else {\n                gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;\n            }\n            gl_FragColor *= u_base_color;\n            if (gl_FragColor.a < u_alpha_test) {\n                discard;\n            }\n        }\n    ",dg=["",0],pg=[0,0,0],gg=new Array(16),mg=new ee(20,20),yg=function(e){var i=function(e){function i(){var n;return(n=e.apply(this,arguments)||this)._layerAlt=0,n._layerAltitude=0,n}kt(i,e);var o=i.prototype;return o.drawGLImage=function(e,n,i,o,s,a,c,A,f){this.gl.program!==this.program&&this.useProgram(this.program);var d=this.gl;if(this.loadTexture(e),this.canvas.gl&&this.canvas.gl.wrap){var p=this.layer&&this.layer.options.opacity;h(p)&&(p=1),c*=p}pg[0]=n||0,pg[1]=i||0,pg[2]=0;var g=this.layer;if(g){var{altitude:v}=g.options,w=l(v);if(w||(this._layerAlt=0),this._layerAltitude!==v&&w){var C=g.getMap();if(C){var P=C.altitudeToPoint(v,C.getGLRes());this._layerAltitude=v,this._layerAlt=P}}}pg[2]=this._layerAlt||0;var T=Qo(gg);Uo(T,T,pg),Go(T,T,[a,a,1]),qo(T,this.getMap().projViewMatrix,T),d.uniformMatrix4fv(this.program.u_matrix,!1,T),d.uniform1f(this.program.u_opacity,c),d.uniform1f(this.program.u_debug_line,0),d.uniform4fv(this.program.u_base_color,f||lg),d.uniform1f(this.program.u_alpha_test,this.layer.options.alphaTest||0);var{glBuffer:S}=e;!S||S.width===o&&S.height===s||(this.saveImageBuffer(S),delete e.glBuffer),e.glBuffer?d.bindBuffer(d.ARRAY_BUFFER,S):e.glBuffer=this.bufferTileData(0,0,o,s),dg[0]="a_position",dg[1]=2,dg[2]=e.glBuffer.type,this.enableVertexAttrib(dg),d.bindBuffer(d.ARRAY_BUFFER,this.texBuffer),dg[0]="a_texCoord",dg[1]=2,dg[2]="UNSIGNED_BYTE",this.enableVertexAttrib(dg),d.drawArrays(d.TRIANGLE_STRIP,0,4),A&&this.drawDebug(T,0,0,o,s,A)},o.drawDebug=function(e,n,i,o,s,a){var h=this.gl;h.disable(h.DEPTH_TEST),h.bindBuffer(h.ARRAY_BUFFER,this._debugBuffer),this.enableVertexAttrib(["a_position",2,"FLOAT"]),h.bufferData(h.ARRAY_BUFFER,new Float32Array([n,i,n+o,i,n+o,i-s,n,i-s,n,i]),h.DYNAMIC_DRAW),h.uniformMatrix4fv(this.program.u_matrix,!1,e),h.uniform1f(this.program.u_opacity,1),h.uniform1f(this.program.u_debug_line,1),h.uniform4fv(this.program.u_base_color,lg),h.uniform1f(this.program.u_alpha_test,this.layer.options.alphaTest||0),h.drawArrays(h.LINE_STRIP,0,5);var l=this._debugInfoCanvas;if(!l){var c=this.getMap().getDevicePixelRatio()>1?2:1;(l=this._debugInfoCanvas=document.createElement("canvas")).width=256*c,l.height=32*c;var A=l.getContext("2d");A.font="20px monospace",A.scale(c,c)}var f=l.getContext("2d");f.clearRect(0,0,l.width,l.height),_h.fillText(f,a,mg,this.layer.options.debugOutline),this.loadTexture(l),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,l);var d=n+(o=256),p=i-s+32,g=i-s;h.bufferData(h.ARRAY_BUFFER,this.set8(n,p,n,g,d,p,d,g),h.DYNAMIC_DRAW),h.uniform1f(this.program.u_debug_line,0),h.bindBuffer(h.ARRAY_BUFFER,this.texBuffer),this.enableVertexAttrib(["a_texCoord",2,"UNSIGNED_BYTE"]),h.drawArrays(h.TRIANGLE_STRIP,0,4),h.enable(h.DEPTH_TEST)},o.bufferTileData=function(e,n,i,o,s){var a,h=e,l=e+i,A=n,f=n-o;a=c(h)&&c(l)&&c(A)&&c(f)?this.set8Int(h,A,h,f,l,A,l,f):this.set8(h,A,h,f,l,A,l,f);var d=this.loadImageBuffer(a,s);return d.width=i,d.height=o,d.type=a instanceof Int16Array?"SHORT":"FLOAT",d},o.createCanvas2=function(){this.canvas2=_h.createCanvas(this.canvas.width,this.canvas.height)},o.createGLContext=function(){this.gl=this.canvas.gl&&this.canvas.gl.wrap?this.canvas.gl.wrap():function(e,n){for(var i={alpha:!0,stencil:!0,preserveDrawingBuffer:!0,antialias:!1},o=["webgl","experimental-webgl"],s=null,a=0;a<o.length;++a){try{s=e.getContext(o[a],n||i)}catch(e){}if(s)break}return s}(this.canvas2||this.canvas,this.layer.options.glOptions);var e=this.gl;e.clearColor(0,0,0,0),e.enable(e.DEPTH_TEST),e.enable(e.STENCIL_TEST),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),this.program=this.createProgram(Ag,this.layer.options.fragmentShader||fg),this._debugBuffer=this.createBuffer(),this.useProgram(this.program),this.texBuffer=this.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.texBuffer),this.enableVertexAttrib(["a_texCoord",2,"UNSIGNED_BYTE"]),e.bufferData(e.ARRAY_BUFFER,new Uint8Array([0,0,0,1,1,0,1,1]),e.STATIC_DRAW),this.enableSampler("u_image"),e.activeTexture(e.TEXTURE0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0)},o.resizeGLCanvas=function(){this.gl&&this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.canvas2&&(this.canvas2.width===this.canvas.width&&this.canvas2.height===this.canvas.height||(this.canvas2.width=this.canvas.width,this.canvas2.height=this.canvas.height))},o.clearGLCanvas=function(){this.gl&&(this.gl.clearStencil(255),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT)),this.gl.wrap||this.gl.clear(this.gl.DEPTH_BUFFER_BIT)},o.disposeImage=function(e){e&&(e.texture&&this.saveTexture(e.texture),e.glBuffer&&this.saveImageBuffer(e.glBuffer),delete e.texture,delete e.glBuffer)},o._createTexture=function(e){var n=this.gl,i=this.getTexture()||n.createTexture();n.bindTexture(n.TEXTURE_2D,i),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);var o=this.layer.options.mipmapTexture;return!o||vg(e.width)&&vg(e.height)||(e=function(e){if(vg(e.width)&&vg(e.height))return e;var n=e.width,i=e.height;vg(n)||(n=_g(n));vg(i)||(i=_g(i));var o=document.createElement("canvas");o.width=n,o.height=i;var s=o.getContext("2d");return s.imageSmoothingEnabled=!1,s.drawImage(e,0,0,n,i),o}(e)),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e),o&&n.generateMipmap(n.TEXTURE_2D),i},o.getTexture=function(){this._textures||(this._textures=[]);var e=this._textures;return e&&e.length>0?e.pop():null},o.saveTexture=function(e){this._textures.push(e)},o.loadTexture=function(e){var n=this.getMap(),i=this.gl,o=e.texture;return o||(o=this._createTexture(e),e.texture=o),i.bindTexture(i.TEXTURE_2D,o),this.layer.options.mipmapTexture&&(n.isMoving()&&n.getRenderer().isViewChanged()?i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR_MIPMAP_LINEAR):i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR)),o},o.getImageBuffer=function(){this._imageBuffers||(this._imageBuffers=[]);var e=this._imageBuffers;return e&&e.length>0?e.pop():null},o.saveImageBuffer=function(e){this._imageBuffers||(this._imageBuffers=[]),this._imageBuffers.push(e)},o.loadImageBuffer=function(e,n){var i=this.gl,o=n||this.createImageBuffer();return i.bindBuffer(i.ARRAY_BUFFER,o),i.bufferData(i.ARRAY_BUFFER,e,i.STATIC_DRAW),o},o.createImageBuffer=function(){return this.getImageBuffer()||this.createBuffer()},o.removeGLCanvas=function(){var e=this.gl;if(e){if(this._debugBuffer&&(e.deleteBuffer(this._debugBuffer),delete this._debugBuffer),this._buffers&&(this._buffers.forEach((function(n){e.deleteBuffer(n)})),delete this._buffers),this._textures&&(this._textures.forEach((function(n){return e.deleteTexture(n)})),delete this._textures),this._debugInfoCanvas){var n=this._debugInfoCanvas.texture;n&&e.deleteTexture(n),delete this._debugInfoCanvas.texture,delete this._debugInfoCanvas}var i=e.program;e.deleteShader(i.fragmentShader),e.deleteShader(i.vertexShader),e.deleteProgram(i),delete this.gl,delete this.canvas2}},o.createBuffer=function(){var e=this.gl.createBuffer();if(!e)throw new Error("Failed to create the buffer object");return this._buffers||(this._buffers=[]),this._buffers.push(e),e},o.enableVertexAttrib=function(e){ag(this.gl,this.gl.program,e)},o.createProgram=function(e,n){for(var i=this.gl,{program:o,vertexShader:s,fragmentShader:a}=sg(i,e,n),h=i.getProgramParameter(o,35718),l=[],c=0;c<h;++c){var A=i.getActiveUniform(o,c);l.push(A.name)}return o.vertexShader=s,o.fragmentShader=a,this._initUniforms(o,l),o},o.useProgram=function(e){var n=this.gl;return n.useProgram(e),n.program=e,this},o.enableSampler=function(e,n){var i=this.gl,o=this._getUniform(i.program,e);return n||(n=0),i.uniform1i(o,n),o},o._initUniforms=function(e,i){for(var o=0;o<i.length;o++){var s=i[o],a=i[o],h=s.indexOf("[");h>=0&&(s=s.substring(0,h),n||(a=a.substring(0,h))),e[s]=this._getUniform(e,a)}},o._getUniform=function(e,n){var i=this.gl.getUniformLocation(e,n);if(!i)throw new Error("Failed to get the storage location of "+n);return i},o.set8=function(e,n,i,o,s,a,h,l){var c=ug;return c[0]=e,c[1]=n,c[2]=i,c[3]=o,c[4]=s,c[5]=a,c[6]=h,c[7]=l,c},o.set8Int=function(e,n,i,o,s,a,h,l){var c=cg;return c[0]=e,c[1]=n,c[2]=i,c[3]=o,c[4]=s,c[5]=a,c[6]=h,c[7]=l,c},i}(e);return i};function vg(e){return!(e&e-1)&&0!==e}function _g(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}var xg={renderer:wt.webgl?"gl":"canvas",crossOrigin:null,alphaTest:!1,depthMask:!0,depthFunc:"<="},bg=new ee(0,0),wg=function(e){function n(n,i,o){var s;return!i||Array.isArray(i)||i.url||(o=i,i=null),(s=e.call(this,n,o)||this)._images=i,s}kt(n,e);var i=n.prototype;return i.onAdd=function(){this._prepareImages(this._images)},i.setImages=function(e){return this._images=e,this._prepareImages(e),this},i.getImages=function(){return this._images},i._prepareImages=function(e){e=e||[],Array.isArray(e)||(e=[e]);var n=this.getMap(),i=n.getGLRes();this._imageData=e.map((function(e){var o=new al(e.extent);return a({},e,{extent:o,extent2d:o.convertTo((function(e){return n.coordToPointAtRes(e,i)}))})})),this._images=e;var o=this.getRenderer();o&&o.refreshImages()},i.getRenderer=function(){return e.prototype.getRenderer.call(this)},n}(RA);wg.mergeOptions(xg);var Cg,Pg=[],Mg=function(e){function n(){return e.apply(this,arguments)||this}kt(n,e);var i=n.prototype;return i.isDrawable=function(){return!this.getMap().getPitch()||(console&&console.warn("ImageLayer with canvas renderer can't be pitched, use gl renderer ('renderer' : 'gl') instead."),!1)},i.checkResources=function(){var e=this;if(this._imageLoaded)return Pg;var n=this.layer._imageData.map((function(e){return[e.url,null,null]}));if(this.resources){var i=[],o=new yu;n.forEach((function(n){if(e.resources.isResourceLoaded(n)){var s=e.resources.getImage(n);o.addResource(n,s)}else i.push(n)})),this.resources.forEach((function(n,i){o.isResourceLoaded(n)||e.retireImage(i.image)})),this.resources=o,n=i}return this._imageLoaded=!0,n},i.retireImage=function(e){e.close&&e.close()},i.refreshImages=function(){this._imageLoaded=!1,this.setToRedraw()},i.draw=function(e,n){this.isDrawable()&&(this.prepareCanvas(),this._painted=!1,this._drawImages(e,n),this.completeRender())},i._drawImages=function(e,n){var i=this.layer._imageData,o=this.getMap(),s=o.get2DExtentAtRes(o.getGLRes());if(i&&i.length)for(var a=0;a<i.length;a++){var h=i[a].extent2d,c=this.resources&&this.resources.getImage(i[a].url);if(c&&s.intersects(h)){this._painted=!0;var A=i[a].opacity;l(A)||(A=1),this._drawImage(c,h,A)}}},i._drawImage=function(e,n,i){var o=0,s=this.context;i<1&&(o=s.globalAlpha,s.globalAlpha=i);var a=this.getMap(),h=bg.set(n.xmin,n.ymax),l=a._pointAtResToContainerPoint(h,a.getGLRes()),c=l.x,A=l.y,f=a.getBearing();f&&(s.save(),s.translate(c,A),f&&s.rotate(-f*Math.PI/180),c=A=0);var d=a.getGLScale();s.drawImage(e,c,A,n.getWidth()/d,n.getHeight()/d),f&&s.restore(),o&&(s.globalAlpha=o)},i.drawOnInteracting=function(e,n,i){this.draw()},n}(mu),Tg=function(e){function n(){return e.apply(this,arguments)||this}kt(n,e);var i=n.prototype;return i.drawOnInteracting=function(e,n,i){this.draw(n,i)},i._prepareGLContext=function(){var e=this.gl;e&&(e.disable(e.STENCIL_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.enable(e.DEPTH_TEST),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.depthFunc(function(e){return hg[e]}(this.layer.options.depthFunc)),e.depthMask(!!this.layer.options.depthMask))},i._drawImages=function(n,i){var o=this.gl;if(i&&i.renderTarget){var s=i.renderTarget.fbo;if(s){var a=i.renderTarget.getFramebuffer(s);o.bindFramebuffer(o.FRAMEBUFFER,a)}}(this._prepareGLContext(),e.prototype._drawImages.call(this),i&&i.renderTarget)&&(i.renderTarget.fbo&&o.bindFramebuffer(o.FRAMEBUFFER,null))},i.isDrawable=function(){return!0},i._drawImage=function(e,n,i){this.drawGLImage(e,n.xmin,n.ymax,n.getWidth(),n.getHeight(),1,i)},i.createContext=function(){this.createGLContext()},i.resizeCanvas=function(n){this.canvas&&(e.prototype.resizeCanvas.call(this,n),this.resizeGLCanvas())},i.clearCanvas=function(){this.canvas&&(e.prototype.clearCanvas.call(this),this.clearGLCanvas())},i.retireImage=function(e){e.close&&e.close(),this.disposeImage(e)},i.onRemove=function(){this.removeGLCanvas(),e.prototype.onRemove.call(this)},n}(yg(Mg));wg.registerRenderer("canvas",Mg),wg.registerRenderer("gl",Tg),function(e){e[e.never=0]="never",e[e["<"]=1]="<",e[e["="]=2]="=",e[e["<="]=3]="<=",e[e[" >"]=4]=" >",e[e["!="]=5]="!=",e[e[">="]=6]=">=",e[e.always=7]="always"}(Cg||(Cg={}));var Sg=function(e){function n(){return e.apply(this,arguments)||this}kt(n,e);var i=n.prototype;return i.getPrepareParams=function(){return[]},i.getDrawParams=function(){return[]},i.onCanvasCreate=function(){this.canvas&&this.layer.options.doubleBuffer&&(this.buffer=_h.createCanvas(this.canvas.width,this.canvas.height,this.getMap().CanvasClass))},i.needToRedraw=function(){return!!this.layer.options.animation||!(this.getMap().isInteracting()&&!this.layer.drawOnInteracting)&&e.prototype.needToRedraw.call(this)},i.draw=function(...e){this.prepareCanvas(),this.prepareDrawContext(),this._drawLayer(...e)},i.drawOnInteracting=function(...e){this._drawLayerOnInteracting(...e)},i.getCanvasImage=function(){var n=e.prototype.getCanvasImage.call(this);if(n&&n.image&&this.layer.options.doubleBuffer){var i=n.image;this.buffer.width===i.width&&this.buffer.height===i.height||(this.buffer.width=i.width,this.buffer.height=i.height);var o=this.buffer.getContext("2d"),s=this.layer.doubleBuffer(o,this.context);(void 0===s||s)&&(_h.image(o,i,0,0),n.image=this.buffer)}return n},i.remove=function(){return delete this._drawContext,e.prototype.remove.call(this)},i.onZoomStart=function(n){this.layer.onZoomStart(n),e.prototype.onZoomStart.call(this,n)},i.onZooming=function(n){this.layer.onZooming(n),e.prototype.onZooming.call(this,n)},i.onZoomEnd=function(n){this.layer.onZoomEnd(n),e.prototype.onZoomEnd.call(this,n)},i.onMoveStart=function(n){this.layer.onMoveStart(n),e.prototype.onMoveStart.call(this,n)},i.onMoving=function(n){this.layer.onMoving(n),e.prototype.onMoving.call(this,n)},i.onMoveEnd=function(n){this.layer.onMoveEnd(n),e.prototype.onMoveEnd.call(this,n)},i.onResize=function(n){this.layer.onResize(n),e.prototype.onResize.call(this,n)},i.prepareDrawContext=function(){if(!this._predrawed){var e=Ig(this.getPrepareParams());this._drawContext=this.layer.prepareToDraw(this.context,...e),this._drawContext||(this._drawContext=[]),Array.isArray(this._drawContext)||(this._drawContext=[this._drawContext]),this._predrawed=!0}},i._prepareDrawParams=function(){if(!this.getMap())return null;var e=this.getViewExtent();return e.maskExtent&&!e.extent.intersects(e.maskExtent)?(this.completeRender(),null):[...[this.context,e],...Ig(this.getDrawParams()),...this._drawContext]},i._drawLayer=function(...e){var n=this._prepareDrawParams();n&&(this.layer.draw.apply(this.layer,n.concat(e)),this.completeRender())},i._drawLayerOnInteracting=function(...e){if(this.layer.drawOnInteracting){var n=this._prepareDrawParams();n&&(this.layer.drawOnInteracting(...n,...e),this.completeRender())}},n}(mu);function Ig(e){return e||(e=[]),Array.isArray(e)||(e=[e]),e}var Eg=function(e){function n(){return e.apply(this,arguments)||this}kt(n,e);var i=n.prototype;return i.isCanvasRender=function(){return!0},i.prepareToDraw=function(){},i.draw=function(...e){},i.redraw=function(){return this._getRenderer()&&this._getRenderer().setToRedraw(),this},i.play=function(){return this.config("animation",!0),this},i.pause=function(){return this.config("animation",!1),this},i.isPlaying=function(){return this.options.animation},i.clearCanvas=function(){return this._getRenderer()&&this._getRenderer().clearCanvas(),this},i.requestMapToRender=function(){var e=this._getRenderer();return e&&e.requestMapToRender&&e.requestMapToRender(),this},i.completeRender=function(){return this._getRenderer()&&this._getRenderer().completeRender(),this},i.onCanvasCreate=function(){return this},i.onZoomStart=function(){},i.onZooming=function(){},i.onZoomEnd=function(){},i.onMoveStart=function(){},i.onMoving=function(){},i.onMoveEnd=function(){},i.onResize=function(){},i.doubleBuffer=function(e){return e.clearRect(0,0,e.canvas.width,e.canvas.height),this},i._getRenderer=function(){return e.prototype._getRenderer.call(this)},n}(RA);Eg.mergeOptions({doubleBuffer:!1,animation:!1}),Eg.registerRenderer("canvas",Sg);var Og=new ee(0,0),Rg=function(e){function n(){return e.apply(this,arguments)||this}kt(n,e);var i=n.prototype;return i.getParticles=function(e){},i.draw=function(e,n){var i=this.getParticles(s());if(i&&0!==i.length){var o=this.getMap(),a=n.extent;n.maskExtent&&(a=n.extent.intersection(n.maskExtent)),a=a.convertTo((function(e){return o._pointToContainerPoint(e,void 0,0,Og)}));for(var h=2*Math.PI,l=0,c=i.length;l<c;l++){var A=i[l].point;if(a.contains(A)){var f=i[l].color||this.options.lineColor||"#fff",d=i[l].r;e.fillStyle!==f&&(e.fillStyle=f),d<=2?e.fillRect(A.x-d/2,A.y-d/2,d,d):(e.beginPath(),e.arc(A.x,A.y,d/2,0,h),e.fill())}}this._fillCanvas(e)}else{this._getRenderer()&&(this._getRenderer()._shouldClear=!0)}},i._fillCanvas=function(e){var n=e.globalCompositeOperation;e.globalCompositeOperation="destination-out",e.fillStyle="rgba(0, 0, 0, "+1/(this.options.trail||30)+")",e.fillRect(0,0,e.canvas.width,e.canvas.height),e.globalCompositeOperation=n},n}(Eg);Rg.mergeOptions({animation:!0}),Rg.registerRenderer("canvas",function(e){function n(){return e.apply(this,arguments)||this}kt(n,e);var i=n.prototype;return i.draw=function(){this.canvas&&this.layer.options.animation&&!this._shouldClear||(this.prepareCanvas(),this._shouldClear=!1),this.prepareDrawContext(),this._drawLayer()},i.drawOnInteracting=function(){this.draw(),this._shouldClear=!1},i.onSkipDrawOnInteracting=function(){this._shouldClear=!0},n}(Sg));var Dg,kg,Lg=new yu,Fg=function(e){function n(n,i,o){var s;(s=e.call(this,o)||this).target=n,n.once("remove",s.delete,s);var a=s.options.symbol,l=a.markerLineWidth||1;return s.w=a.markerWidth+l,s.h=a.markerHeight+l,s.opacity=h(a.opacity)?1:a.opacity,s.map=i,s.events=o.events,s._fetchImage(),s.addTo(i),s}kt(n,e);var i=n.prototype;return i.getCursor=function(){return this.options.cursor||"default"},i._fetchImage=function(){var e=this.map,n=this.options.symbol,{markerFile:i}=n;this.url=i||Eo(n);var o=Lg.getImage(this.url);if(!o){var s=this.w,a=this.h;if(i)(o=new Image).onload=function(){var n=e.getRenderer();n&&n.setToRedraw()},o.src=this.url;else{var h=document.createElement("canvas");h.width=s,h.height=a,o=ec(h.getContext("2d"),{x:s/2,y:a/2},n,Lg)}Lg.addResource([this.url,s,a],o)}Lg.login(this.url),this._img=o},i.setContainerPoint=function(e){this._point=e,this._point._sub(this.w/2,this.h/2)},i.getContainerPoint=function(){return this._point.add(this.w/2,this.h/2)},i.offset=function(e){this._point._add(e)},i.render=function(e){if(!this._img)return!1;var n=this.options.symbol,i=n.markerDx||0,o=n.markerDy||0,s=this.map,{x:a,y:h}=this._point,l=this.w,c=this.h;if(a+l>0&&a<s.width&&h+c>0&&h<s.height){var A=s.getDevicePixelRatio();return e.globalAlpha=this.opacity,e.drawImage(this._img,Math.round((a+i)*A),Math.round((h+o)*A),Math.round(l*A),Math.round(c*A)),!0}return!1},i.delete=function(){if(this.map){var e=this.map.getRenderer();e&&e.removeTopElement(this)}Lg.logout(this.url),this._dragger&&(this._dragger.disable(),delete this._dragger),delete this.map},i.hitTest=function(e){var n=this.options.symbol,i=this._point.x+(n.markerDx||0),o=this._point.y+(n.markerDy||0);return e.x>=i&&e.x<=i+this.w&&e.y>=o&&e.y<=o+this.h},i.addTo=function(e){this.map=e,e.getRenderer().addTopElement(this)},i.onEvent=function(e){this.fire(e.type,e)},i.mousedown=function(e){var n=this.options.cursor;n&&e.target.setCursor(n),this.onDragstart(e)},i.onDragstart=function(e){var{containerPoint:n,target:i}=e,o=i.getPanels().mapWrapper||i.getContainer(),s=this._dragger=new qh(o);s.on("dragging",this.onDragging,this).on("mouseup",this.onDragend,this).enable(),s.onMouseDown(e.domEvent),Dg=n.x,kg=n.y,this.fire("dragstart",{containerPoint:n})},i.onDragging=function(e){if(this._dragger){var n=this.map,i=Bi(e.domEvent,n.getContainer()),o={x:i.x-Dg,y:i.y-kg},s=n.containerPointToCoord(new ee(Dg,kg)),a=n.containerPointToCoord(i);Dg=i.x,kg=i.y,this.offset(o),this.fire("dragging",{containerPoint:i,coordOffset:a._sub(s)})}},i.onDragend=function(e){if(this._dragger){var n=this.map;n.resetCursor();var i=Bi(e.domEvent,n.getContainer());this.offset({x:i.x-Dg,y:i.y-kg}),this._dragger.disable(),delete this._dragger,this.fire("dragend",{containerPoint:i})}},i.needCollision=function(){var{target:e}=this;return!this.options.ignoreCollision&&(e&&e.options&&e.options.collision)},i.getRenderBBOX=function(e){var{target:n,map:i}=this;if(!n||!n.options||!i)return null;var o=this.options.symbol,s=o.markerDx||0,a=o.markerDy||0,{x:h,y:l}=this._point,c=this.w,A=this.h;e=e||i.getDevicePixelRatio(),this.bbox=this.bbox||cs();var f=Math.round((h+s)*e),d=Math.round((l+a)*e),p=Math.round(c*e),g=Math.round(A*e);this.bbox[0]=f,this.bbox[1]=d,this.bbox[2]=f+p,this.bbox[3]=d+g;var{options:v}=n;return ys(this.bbox,v.collisionBufferSize||0),this.bbox},i.setZIndex=function(e){this.options.zIndex=e},n}(Th(Ih)),Ng=function(){function e(e,n,i){this.target=e,e.once("remove",this.delete,this),this.map=n,this.options=i,this.addTo(n)}var n=e.prototype;return n.setPoints=function(e){this.points=e;var n=e.map((function(e){return e.x})),i=e.map((function(e){return e.y}));this.xmin=Math.min(...n),this.xmax=Math.max(...n),this.ymin=Math.min(...i),this.ymax=Math.max(...i)},n.hitTest=function(){return!1},n.render=function(e){var n=this.map;if(!(this.xmax<=0||this.xmin>=n.width||this.ymax<=0||this.ymin>=n.height)){var i=n.getDevicePixelRatio();e.lineWidth=1,e.strokeStyle="#000",e.globalAlpha=1,e.beginPath();var o=this.points;e.moveTo(a(o[0].x),a(o[0].y));for(var s=1;s<this.points.length;s++)e.lineTo(a(o[s].x),a(o[s].y));e.closePath(),e.stroke()}function a(e){return Math.round(e)*i+.5}},n.addTo=function(e){this.map=e,e.getRenderer().addTopElement(this)},n.delete=function(){if(this.map){var e=this.map.getRenderer();e&&e.removeTopElement(this)}},e}(),zg=An+"_edit_stage_";function Bg(e,n){return{markerType:e,markerFill:"#fff",markerLineColor:"#000",markerLineWidth:2,markerWidth:10,markerHeight:10,opacity:n}}function Hg(e,n){var i=e.getGLRes(),o=e.coordToPointAtRes(n,i);return e._pointAtResToContainerPoint(o,i,n.z||0)}function jg(e,n,i){var o=e.getMap();if(!n||0===n.z)return o.containerPointToCoord(i);var s=n.z,a=o.getGLRes(),h=o.coordToPointAtRes(n,a),l=o._pointAtResToContainerPoint(h,a,0),c=o._pointAtResToContainerPoint(h,a,s).sub(l),A=i.sub(c),f=o.containerPointToCoord(A);return f.z=0,!e.getGeometries&&e.isPoint&&(f.z=s),f}function Ug(e){var n=this.target,i=this.paramOptions;return n._updating=!0,i.onDown&&(i.onDown.call(n,e.containerPoint,e),n._geometry.fire("handledragstart")),!1}function Gg(e){var n=this.target,i=this.paramOptions;return n._hideContext(),i.onMove&&(i.onMove.call(n,e),n._geometry.fire("handledragging")),!1}function Vg(e){var n=this.target,i=this.paramOptions;return i.onUp&&(i.onUp.call(n,e),n._geometry.fire("handledragend")),n._updating=!1,!1}var Wg={fixAspectRatio:!1,symbol:null,removeVertexOn:"contextmenu",centerHandleSymbol:Bg("ellipse",1),vertexHandleSymbol:Bg("square",1),newVertexHandleSymbol:Bg("square",.4),collision:!1,collisionBufferSize:0,vertexZIndex:0,newVertexZIndex:0},qg=function(e){function n(n,i){var o;return(o=e.call(this,i)||this)._geometry=n,o._geometry?o:Ut(o)}kt(n,e);var i=n.prototype;return i.getMap=function(){return this._geometry.getMap()},i.prepare=function(){var e=this.getMap();e&&(e.on("drawtopstart",this._refresh,this),this.options.symbol&&(this._originalSymbol=this._geometry.getSymbol(),this._geometry.setSymbol(this.options.symbol)),this._prepareEditStageLayer())},i._prepareEditStageLayer=function(){var e=this._geometry.getLayer();if("canvas"===e.options.renderer){var n=this.getMap(),i=oe(),o=zg+i+"_shadow";if(this._shadowLayer=n.getLayer(o),!this._shadowLayer)this._shadowLayer=new(0,e.constructor)(o),n.addLayer(this._shadowLayer)}},i.start=function(){if(this._geometry&&this._geometry.getMap()&&!this._geometry.editing){this.editing=!0,this.prepare();var e,n=this._geometry,i="canvas"===this._geometry.getLayer().options.renderer;this._geometryDraggble=n.options.draggable,i?(n.config("draggable",!1),(e=n.copy()).setSymbol(n._getInternalSymbol()),e.copyEventListeners(n),n._getParent()&&e.copyEventListeners(n._getParent()),e._setEventTarget(n),e.setId(null).config({draggable:!1}),this._shadow=e,n.hide()):n instanceof pf&&n.config("draggable",!0),this._switchGeometryEvents("on"),(n instanceof pf||n instanceof Df||n instanceof Ff||n instanceof Lf)&&this._createOrRefreshOutline(),this._shadowLayer&&this._shadowLayer.bringToFront().addGeometry(e),n instanceof pf?e&&(e.config("draggable",!0),e.on("dragend",this._onMarkerDragEnd,this)):this._createCenterHandle(),n instanceof pf&&!1!==this.options.resize?this.createMarkerEditor():n instanceof Df?this.createCircleEditor():n instanceof Ff||n instanceof Lf?this.createEllipseOrRectEditor():n instanceof Nf||(n instanceof Af||n instanceof mf)&&this.createPolygonEditor()}},i.stop=function(){delete this._history,delete this._historyPointer,delete this._editOutline,this._switchGeometryEvents("off"),this.getMap()?(this._geometry.config("draggable",this._geometryDraggble),this._shadow&&(delete this._shadow,delete this._geometryDraggble,this._geometry.show()),this._shadowLayer&&(this._shadowLayer.remove(),delete this._shadowLayer),this._refreshHooks=[],this.options.symbol&&(this._geometry.setSymbol(this._originalSymbol),delete this._originalSymbol),this.editing=!1,this.fire("remove")):this.fire("remove")},i.isEditing=function(){return!h(this.editing)&&this.editing},i._getGeometryEvents=function(){return{symbolchange:this._onGeoSymbolChange,dragstart:this._onDragStart,dragend:this._onDragEnd,"positionchange shapechange":this._exeAndReset}},i._switchGeometryEvents=function(e){if(this._geometry){var n=this._getGeometryEvents();for(var i in n)this._geometry[e](i,n[i],this)}},i._onGeoSymbolChange=function(e){this._shadow&&this._shadow.setSymbol(e.target._getInternalSymbol())},i._onMarkerDragEnd=function(){this._update("setCoordinates",this._shadow.getCoordinates().toArray())},i._createOrRefreshOutline=function(){var e=this._geometry,n=this._editOutline;n||(this._editOutline=new Ng(this,this.getMap()),this._addRefreshHook(this._createOrRefreshOutline));var i=this._editOutline.points;if(e instanceof pf)this._editOutline.setPoints(e.getContainerExtent().toArray(i));else{var o=e.getShell(),s=e._getEditCenter(),a=cs();ps(o,a);var h=new al(a[0],a[1],a[2],a[3]),l=this.getMap(),c=h.toArray().map((function(e){return e.z=s.z,Hg(l,e)}));this._editOutline.setPoints(c)}return n},i._createCenterHandle=function(){var e,n=this,i=this.getMap(),o=this.options.centerHandleSymbol,s=Hg(i,this._geometry._getEditCenter()),a=this.createHandle(s,{ignoreCollision:!0,symbol:o,cursor:"move",onDown:function(){if(n._shadow){var i=Oo((e=n._shadow.copy())._getInternalSymbol(),.5);e.setSymbol(i).addTo(n._geometry.getLayer())}},onMove:function(i){var o=i.coordOffset;e?e.translate(o):n._geometry.translate(o)},onUp:function(){if(e){var i=e.getFirstCoordinate(),o=n._geometry.getFirstCoordinate(),s=i.sub(o);n._update("translate",s),e.remove()}}});this._addRefreshHook((function(){var e=n._geometry._getEditCenter();a.setContainerPoint(Hg(i,e))}))},i._createHandleInstance=function(e,n){n=n||{};var i=this.getMap(),o=Vr(n.symbol,(function(){return[i.getZoom(),{"{bearing}":i.getBearing(),"{pitch}":i.getPitch(),"{zoom}":i.getZoom()}]})),s=new Fg(this,i,{symbol:o,cursor:n.cursor,events:this.options.removeVertexOn,ignoreCollision:n.ignoreCollision});return s.setContainerPoint(e),s},i.createHandle=function(e,n){n||(n={});var i=this._createHandleInstance(e,n);return i.paramOptions=n,i.on("dragstart",Ug),i.on("dragging",Gg),i.on("dragend",Vg),n.onRefresh&&(i.refresh=n.onRefresh),i},i._createResizeHandles=function(e,n,i){var o=this,s=["nw-resize","n-resize","ne-resize","w-resize","e-resize","sw-resize","s-resize","se-resize"],a=[null,"y",null,"x","x",null,"y",null],h=this._geometry,l=h instanceof pf,c=[];e||(e=[]);var A=this,f=[],d={},p=this.getMap(),g=this.options.vertexHandleSymbol,v=function(){for(var v=function(){if(l){var e=h.getContainerExtent();return[new ee(e.xmin,e.ymin),new ee((e.xmax+e.xmin)/2,e.ymin),new ee(e.xmax,e.ymin),new ee(e.xmin,(e.ymin+e.ymax)/2),new ee(e.xmax,(e.ymin+e.ymax)/2),new ee(e.xmin,e.ymax),new ee((e.xmax+e.xmin)/2,e.ymax),new ee(e.xmax,e.ymax)]}var n=h.getShell(),i=h._getEditCenter(),o=cs();ps(n,o);var s=new al(o[0],o[1],o[2],o[3]);return(c=[new Zh(s.xmin,s.ymax),new Zh((s.xmax+s.xmin)/2,s.ymax),new Zh(s.xmax,s.ymax),new Zh(s.xmin,(s.ymax+s.ymin)/2),new Zh(s.xmax,(s.ymax+s.ymin)/2),new Zh(s.xmin,s.ymin),new Zh((s.xmax+s.xmin)/2,s.ymin),new Zh(s.xmax,s.ymin)]).map((function(e){return e.z=i.z,Hg(p,e)}))}(),w=function(l){if(Array.isArray(e)&&e.some((function(e){return e===l})))return 1;var p,w=v[l],C=c[l];if(f.length<v.length-e.length){var P=o.createHandle(w,{symbol:g,cursor:s[l],axis:a[l],onMove:(p=l,function(e){A._updating=!0,n(e.containerPoint,p),h.fire("resizing")}),onUp:function(){A._updating=!1,i()}});d[l]=f.length,f.push(P),P.coord=C}else f[d[l]].coord=C,f[d[l]].setContainerPoint(w)},C=0;C<v.length;C++)w(C)};return v(),this._addRefreshHook(v),f},i.createMarkerEditor=function(){var e=this,n=this._shadow||this._geometry,i=this.getMap();if(n._canEdit()){this._history||this._recordHistory(v());var o=n._getInternalSymbol(),s=new ee(0,0);l(o.markerDx)&&(s.x=o.markerDx),l(o.markerDy)&&(s.y=o.markerDy);var a=null,h="middle",c="middle";if(Rc.test(o)){var A=o.markerType;"pin"===A||"pie"===A||"bar"===A?(a=[5,6,7],h="bottom"):"rectangle"===A&&(a=[0,1,2,3,5],h="top",c="left")}else(pc.test(o)||Dc.test(o))&&(h="bottom",a=[5,6,7]);var f,d=[2,1,2,0,0,2,1,2];if(this.options.fixAspectRatio){var p=n.getSize();f=p.width/p.height}var g=this._createResizeHandles(a,(function(o,l){if(a&&a.indexOf(l)>=0){var A=i.containerPointToCoordinate(o.sub(s)),p=n.getCoordinates();A.x=p.x,n.setCoordinates(A),e._updateCoordFromShadow(!0),o=g[g.length-1-l].getContainerPoint()}var v=Hg(i,n._getEditCenter()).add(s),w=n._getInternalSymbol(),C=o.sub(v);"bottom"===h&&o.y>v.y&&(C.y=0);var P="middle"===h?2:1,T="left"===c?1:2,S=Math.abs(C.x)*T,I=Math.abs(C.y)*P;f&&(I=(S=Math.max(S,I*f))/f);var E=d[l];n instanceof Qf?((f||0===E||2===E)&&(n.setWidth(S),n!==e._geometry&&e._geometry.setWidth(S)),(f||1===E||2===E)&&(n.setHeight(I),n!==e._geometry&&e._geometry.setHeight(I))):((f||0===E||2===E)&&(w.markerWidth=Math.min(S,e._geometry.options.maxMarkerWidth||1/0)),(f||1===E||2===E)&&(w.markerHeight=Math.min(I,e._geometry.options.maxMarkerHeight||1/0)),n.setSymbol(w),n!==e._geometry&&e._geometry.setSymbol(w))}),(function(){e._update(v())}))}else console&&console.warn("A marker can't be resized with symbol:",n.getSymbol());function v(){var e=[["setCoordinates",n.getCoordinates().toArray()]];return n instanceof Qf?(e.push(["setWidth",n.getWidth()]),e.push(["setHeight",n.getHeight()])):e.push(["setSymbol",n.getSymbol()]),e}},i.createCircleEditor=function(){var e=this,n=this._shadow||this._geometry,i=this.getMap();this._history||this._recordHistory([["setCoordinates",n.getCoordinates().toArray()],["setRadius",n.getRadius()]]),this._createResizeHandles(null,(function(o){var s=n.getCenter(),a=jg(n,s,o),h=new mf([[s.x,s.y],[a.x,s.y]]),l=new mf([[s.x,s.y],[s.x,a.y]]),c=Math.max(i.computeGeometryLength(h),i.computeGeometryLength(l));n.setRadius(c),n!==e._geometry&&e._geometry.setRadius(c)}),(function(){e._update("setRadius",n.getRadius())}))},i.createEllipseOrRectEditor=function(){var e=this,n=[2,1,2,0,0,2,1,2],i=this._shadow||this._geometry;this._history||this._recordHistory(l());var o,s=this.getMap(),a=this._geometry instanceof Ff;this.options.fixAspectRatio&&(o=i.getWidth()/i.getHeight());var h=this._createResizeHandles(null,(function(l,c){var A,f,d,p=a?1:2,g=h[c].getContainerPoint(),v=n[c];if(a){var w=h[7-c],C=w.getContainerPoint(),P=(A=g.sub(C)).abs();f=s.pixelToDistance(P.x,0),d=s.pixelToDistance(0,P.y);var T=i.getSize(),S=i.getCoordinates(),I=i.getWidth(),E=i.getHeight(),O=w.coord,k=jg(i,S,l),L=new mf([[O.x,O.y],[k.x,O.y]]),F=new mf([[O.x,O.y],[O.x,k.y]]);if(f=s.computeGeometryLength(L),d=s.computeGeometryLength(F),0===v)if(o&&(P.y=P.x/o,T.height=Math.abs(P.y),d=f/o),g.y=C.y-T.height/2,k.y=S.y,4===c)k.x=Math.min(k.x,S.x);else{var N=s.locate(S,I,0);k.x=s.locate(new Zh(N.x,k.y),-f,0).x}else if(1===v)o&&(P.x=P.y*o,T.width=Math.abs(P.x),f=d*o),g.x=C.x-T.width/2,k.x=S.x,k.y=Math.max(k.y,O.y);else{if(o&&(f>d*o?(d=f/o,g.y=C.y+P.x*Ae(A.y)/o):(f=d*o,g.x=C.x+P.y*Ae(A.x)*o)),0===c||5===c){var z=s.locate(S,I,0===c?0:-E);k.x=s.locate(new Zh(z.x,k.y),-f,0).x}else k.x=Math.min(k.x,O.x);k.y=Math.max(k.y,O.y)}k.z=S.z,i.setCoordinates(k),e._updateCoordFromShadow(!0)}else{var H=i.getCenter(),j=jg(i,H,l),W=new mf([[H.x,H.y],[j.x,H.y]]),q=new mf([[H.x,H.y],[H.x,j.y]]);f=s.computeGeometryLength(W),d=s.computeGeometryLength(q),o&&(d=(f=Math.max(f,d*o))/o)}(o||0===v||2===v)&&(i.setWidth(f*p),i!==e._geometry&&e._geometry.setWidth(f*p)),(o||1===v||2===v)&&(i.setHeight(d*p),i!==e._geometry&&e._geometry.setHeight(d*p))}),(function(){e._update(l())}));function l(){return[["setCoordinates",i.getCoordinates().toArray()],["setWidth",i.getWidth()],["setHeight",i.getHeight()]]}},i.createPolygonEditor=function(){var e=this.getMap(),n=this._shadow||this._geometry,i=this;this._history||this._recordHistory("setCoordinates",Zh.toNumberArrays(n.getCoordinates()));var o=n instanceof Af?3:2,s="maptalks--editor-vertex-index",{vertexZIndex:a,newVertexZIndex:h}=this.options,c={0:[]},A={0:[]};function f(e,i){if(n instanceof Af){var o=n.getCoordinates();o[i]=e,n.setCoordinates(o)}else n.setCoordinates(e)}function p(e=0){if(n instanceof Af){var i=n.getCoordinates()[e]||[];return i.slice(0,i.length-1)}return n.getCoordinates()}function g(){for(var e in c){for(var n=c[e].length-1;n>=0;n--)c[e][n][s]=n;for(var o=A[e].length-1;o>=0;o--)A[e][o][s]=o}i._updateCoordFromShadow()}function v(a){i._updating=!0;var h=a.target,d=h[s],v=l(h._ringIndex)?h._ringIndex:0,w=p(v);if(w.length<=o)console.warn(" Geometry."+n.type+" Require at least "+o+" vertices,Geometry: ",n);else{if(w.splice(d,1),f(w,v),0===d)A[v][0].delete(),A[v].splice(0,1);else if(d===c[v].length-1){var C=A[v].length;A[v][C-1].delete(),A[v].splice(C-1,1)}else A[v][d-1].delete(),A[v].splice(d-1,1),A[v][d-1].delete(),A[v].splice(d-1,1),A[v].splice(d-1,0,I.call(i,d-1,v));if(c[v].splice(d,1)[0].delete(),v>0){var P=n.getCoordinates(),T=P[v];T&&Array.isArray(T)&&T.length>1&&n!==this._geometry&&n.setCoordinates(P)}g(),i._updating=!1,i._geometry.fire("handleremove",Object.assign({},a,{coordinate:e.containerPointToCoordinate(a.containerPoint),vertex:a.target}))}}function w(e,o,s=0){var a=i._geometry.snapTo;a&&d(a)&&(e=i._geometry.snapTo(e)||e);var h,l=p(s),c=e.sub(P()),f=jg(i._geometry,l[o],c),g=l[o];g.x=f.x,g.y=f.y,n.setCoordinates(n.getCoordinates()),i._updateCoordFromShadow(!0),h=0===o?A[s].length-1:o-1,A[s][o]&&A[s][o].refresh(),A[s][h]&&A[s][h].refresh()}var C=new ee(0,0);function P(){var e=n._getCompiledSymbol();return C.x=e.lineDx||0,C.y=e.lineDy||0,C}function T(n,o=0,h){var l=(h||p(o))[n],c=Hg(e,l)._add(P()),A=i.createHandle(c,{symbol:i.options.vertexHandleSymbol,cursor:"pointer",axis:null,onMove:function(){w(A.getContainerPoint(),A[s],o)},onRefresh:function(n,i){if(l=(i||p(o))[A[s]]){var a=Hg(e,l);A.setContainerPoint(a._add(P()))}},onUp:function(){i._updateCoordFromShadow()},onDown:function(e,n){}});return A[s]=n,A._ringIndex=o,A.on(i.options.removeVertexOn,v),A.setZIndex(a),A}var S=!1;function I(n,o=0,a){var l=a||p(o),d=l[n].add(n+1>=l.length?l[0]:l[n+1]).multi(.5),v=i.createHandle(d,{symbol:i.options.newVertexHandleSymbol,cursor:"pointer",axis:null,onDown:function(e,n){if(!n||!n.domEvent||2!==n.domEvent.button){var a=p(o),h=v[s],l=a[h].add(a[h+1]||a[0]).multi(.5);a.splice(h+1,0,l),f(a,o),v.opacity=1,A[o].splice(h,0,I.call(i,h,o),I.call(i,h+1,o)),S=!0}},onMove:function(){w(v.getContainerPoint(),v[s]+1,o)},onUp:function(e){if(e&&e.domEvent&&2===e.domEvent.button)S=!1;else{var n=v[s];le(v,A[o]),v.delete(),c[o].splice(n,0,T.call(i,n,o)),g(),i._updateCoordFromShadow(),S=!1}},onRefresh:function(n,i){l=i||p(n);var o,a=v[s];if(o=a===l.length-1?0:a+1,l[a]&&l[o]){var h=l[a].add(l[o]).multi(.5),c=Hg(e,h);v.setContainerPoint(c._add(P()))}}});return v[s]=n,v.setZIndex(h),v}if(n instanceof Af)for(var E=n.getHoles().length+1,O=0;O<E;O++){c[O]=[],A[O]=[];for(var k=p(O),L=0,F=k.length;L<F;L++)c[O].push(T.call(this,L,O,k)),L<F-1&&A[O].push(I.call(this,L,O,k));A[O].push(I.call(this,k.length-1,O,k))}else{for(var N=p(0),z=0,H=N.length;z<H;z++)c[0].push(T.call(this,z,0,N)),z<H-1&&A[0].push(I.call(this,z,0,N));A[0].length&&2===n.getCoordinates().length&&(A[0][0].options.symbol.markerDx=12)}var j=e.getRenderer();j&&j.sortTopElements(),this._addRefreshHook((function(){if(!S){for(var e in A)for(var i=p(e),o=A[e].length-1;o>=0;o--)A[e][o].refresh(e,i);for(var s in A[0].length&&n instanceof mf&&(2===n.getCoordinates().length?A[0][0].options.symbol.markerDx=12:n.getCoordinates().length>2&&(A[0][0].options.symbol.markerDx=0)),c)for(var a=p(s),h=c[s].length-1;h>=0;h--)c[s][h].refresh(s,a)}}))},i._refresh=function(){if(this._refreshHooks)for(var e=this._refreshHooks.length-1;e>=0;e--)this._refreshHooks[e].call(this)},i._hideContext=function(){this._geometry&&(this._geometry.closeMenu(),this._geometry.closeInfoWindow())},i._addRefreshHook=function(e){e&&(this._refreshHooks||(this._refreshHooks=[]),this._refreshHooks.push(e))},i._update=function(e,...n){this._exeHistory([e,n]),this._recordHistory(e,...n)},i._updateCoordFromShadow=function(e){var n=(this._shadow||this._geometry).getCoordinates(),i=this._geometry,o=this._updating;this._updating=!0,i.setCoordinates(n),e||this._recordHistory("setCoordinates",Zh.toNumberArrays(i.getCoordinates())),this._updating=o},i._recordHistory=function(e,...n){if(this._history||(this._history=[],this._historyPointer=0),this._history.length){var i=this._history[this._history.length-1];if(i[0]===e&&JSON.stringify(i[1])===JSON.stringify(n))return}this._historyPointer<this._history.length-1&&this._history.splice(this._historyPointer+1),this._history.push([e,n]),this._historyPointer=this._history.length-1,this._geometry.fire("editrecord")},i.cancel=function(){return this._history&&0!==this._historyPointer?(this._historyPointer=0,this._exeAndReset(this._history[0]),this):this},i.undo=function(){if(!this._history||0===this._historyPointer)return this;var e=this._history[--this._historyPointer];return this._exeAndReset(e),this},i.redo=function(){if(!this._history||this._historyPointer===this._history.length-1)return this;var e=this._history[++this._historyPointer];return this._exeAndReset(e),this},i._exeAndReset=function(e){if(!this._updating){this._exeHistory(e);var n=this._history,i=this._historyPointer;this.stop(),this._history=n,this._historyPointer=i,this.start()}},i._onDragStart=function(){this._updating=!0},i._onDragEnd=function(){this._updating=!1},i._exeHistory=function(e){if(Array.isArray(e)){var n=this._updating;this._updating=!0;var i=this._shadow||this._geometry,o=this._geometry;Array.isArray(e[0])?e[0].forEach((function(e){var n=e[0],s=e.slice(1);i[n].call(i,...s),i!==o&&o[n].call(o,...s)})):(i[e[0]].call(i,...e[1]),i!==o&&o[e[0]].call(o,...e[1])),this._updating=n}},n}(Th(Ih));qg.mergeOptions(Wg),Wf.include({startEditText:function(){return this.getMap()?(this._recordVisible(),this.hide(),this.endEditText(),this._prepareEditor(),this._fireEvent("edittextstart"),this):this},endEditText:function(){if(this._textEditor){var e=this._textEditor.innerHTML;e=e.replace(/<p>/gi,"").replace(/<\/p>/gi,"<br/>"),this._textEditor.innerHTML=e;var n=this._textEditor.innerText.replace(/[\r\n]+$/gi,"");this.setContent(n),tr(this._textEditor,"mousedown dblclick",ki),this.getMap().off("mousedown",this.endEditText,this),this._editUIMarker.remove(),delete this._editUIMarker,this._textEditor.onkeyup=null,delete this._textEditor,this._recoveryVisible(),this.show(),this._fireEvent("edittextend")}return this},isEditingText:function(){return!!this._textEditor},getTextEditor:function(){return this._editUIMarker},_prepareEditor:function(){var e=this.getMap(),n=this._createEditor();this._textEditor=n,e.on("mousedown",this.endEditText,this);var i=this._getEditorOffset();this._editUIMarker=new Kd(this.getCoordinates(),{animation:null,content:n,dx:i.dx,dy:i.dy}).addTo(e),this._setCursorToLast(this._textEditor)},_getEditorOffset:function(){var e=this._getInternalSymbol()||{},n=0,i=0,o=e.textHorizontalAlignment;return"middle"===o||h(o)?(n=(e.textDx||0)-2,i=(e.textDy||0)-2):(n=(e.markerDx||0)-2,i=(e.markerDy||0)-2),{dx:n,dy:i}},_createEditor:function(){var e=this.getContent(),n=this.getSize(),i=this._getInternalSymbol()||{},o=n.width,s=i.textFill||"#000000",a=i.textSize||12,h=n.height,l=i.markerLineColor||"#000",c=i.markerFill||"#3398CC",A=i.textLineSpacing||0,f=Pi("div");return f.contentEditable=!0,f.style.cssText="background:"+c+"; border:1px solid "+l+";\n            color:"+s+";font-size:"+a+"px;width:"+(o-2)+"px;height:"+(h-2)+"px;margin: auto;\n            line-height:"+(a+A)+"px;outline: 0; padding:0; margin:0;word-wrap: break-word;\n            overflow: hidden;-webkit-user-modify: read-write-plaintext-only;",f.innerText=e,$i(f,"mousedown dblclick",ki),f.onkeyup=function(e){13===e.keyCode&&(f.style.height=parseInt(f.style.height||0)+a/2+"px")},f},_setCursorToLast:function(e){var n;window.getSelection?(e.focus(),(n=window.getSelection()).selectAllChildren(e),n.collapseToEnd()):document.selection&&((n=document.selection.createRange()).moveToElementText(e),n.collapse(!1),n.select())}}),_A.include({animate:function(e,n,i){var o=this;this._animPlayer&&this._animPlayer.finish(),d(n)&&(i=n),n||(n={});var s,a=this.getMap(),h=this._getProjection(),l=this._prepareAnimationStyles(e),c=n.focus;if(delete this._animationStarted,a){var A=a._getRenderer();n.framer=function(e){A.callInNextFrame(e)}}if(h||!c){var f=rf.animate(l,n,(function(e){if(a&&a.isRemoved())f.finish();else{a&&!o._animationStarted&&c&&a.onMoveStart();var n=e.styles;for(var l in n)if("symbol"!==l&&"translate"!==l&&n.hasOwnProperty(l)){var A="set"+l[0].toUpperCase()+l.slice(1);o[A](n[l])}var d=n.translate;if(d){var p=d;s&&(p=d.sub(s)),s=d,o.translate(p)}var g=n.symbol;if(g){var v=o.getSymbol()||{};o.setSymbol(ko(v,g))}if(a&&c){var w=h.project(o.getCenter());a._setPrjCenter(w);var C=a._parseEventFromCoord(h.unproject(w));"running"!==f.playState?a.onMoveEnd(C):a.onMoving(C)}o._fireAnimateEvent(f.playState),i&&i(e)}}),this);return this._animPlayer=f,this._animPlayer.play()}console.error(lf)},_prepareAnimationStyles:function(e){var n=this._getInternalSymbol(),i={};for(var o in e)if(e.hasOwnProperty(o)){var s=e[o];if("translate"!==o&&"symbol"!==o){var a=this["get"+o[0].toUpperCase()+o.substring(1)]();i[o]=[a,s]}else if("symbol"===o){var h=void 0;if(Array.isArray(e.symbol)){if(!Array.isArray(n))throw new Error("geometry'symbol isn't a composite symbol, while the symbol in styles is.");h=[];for(var l=e.symbol,c=0;c<l.length;c++)if(l[c]){var A={};for(var f in l[c])l[c].hasOwnProperty(f)&&(A[f]=[n[c][f],l[c][f]]);h.push(A)}else h.push(null)}else{if(Array.isArray(n))throw new Error("geometry'symbol is a composite symbol, while the symbol in styles isn't.");for(var d in h={},s)s.hasOwnProperty(d)&&(h[d]=[n[d],s[d]])}i.symbol=h}else"translate"===o&&(i.translate=new Zh(s))}return i},_fireAnimateEvent:function(e){"finished"===e?(delete this._animationStarted,this._fireEvent("animateend")):"running"===e&&(this._animationStarted?this._fireEvent("animating"):(this._fireEvent("animatestart"),this._animationStarted=!0))}});var Zg=An+"_drag_stage",Qg=wt.touch?"touchstart mousedown":"mousedown";function Xg(e,n,i){var o=e._getEditCenter(),s=e.getMap();if(!o||0===o.z)return i||s.containerPointToCoord(n);var a=o.z,h=s.getGLRes(),l=s.coordToPointAtRes(o,h),c=s._pointAtResToContainerPoint(l,h,0),A=s._pointAtResToContainerPoint(l,h,a).sub(c),f=n.sub(A),d=s.containerPointToCoord(f);return d.z=0,!e.getGeometries&&e.isPoint&&(d.z=a),d}var Yg=function(e){function n(n){return e.call(this,n)||this}kt(n,e);var i=n.prototype;return i.addHooks=function(){this.target.on(Qg,this._startDrag,this)},i.removeHooks=function(){this._endDrag(),this.target.off(Qg,this._startDrag,this),delete this.container},i._prepareDragHandler=function(){this._dragHandler=new qh(this.container),this._dragHandler.on("dragging",this._dragging,this).on("mouseup",this._endDrag,this).enable()},i._prepareShadow=function(){var e=this,n=this.target;if("canvas"===n.getLayer().options.renderer&&n.options.dragShadow){this._prepareDragStageLayer(),this._shadow&&this._shadow.remove();var i=this._shadow=n.copy();if(i.getGeometries){var o=i.getGeometries(),s=n.getGeometries();o.forEach((function(n,i){e._updateShadowSymbol(n,s[i])}))}else this._updateShadowSymbol(i,n);i.setId(null),this._prepareShadowConnectors()}},i._updateShadowSymbol=function(e,n){if(e.setSymbol(n._getInternalSymbol()),n.options.dragShadow){var i=Oo(e._getInternalSymbol(),.5);e.setSymbol(i)}},i._prepareShadowConnectors=function(){var e=this.target,n=this._shadow,i=this._dragStageLayer._getRenderer().resources,o=[];if($f._hasConnectors(e))for(var s=$f._getConnectors(e),a=0,h=s.length;a<h;a++){var l=s[a],c=l.config(),A=l._getInternalSymbol();c.symbol=Oo(A,.5);var f=void 0;f=l.getConnectSource()===e?new l.constructor(n,l.getConnectTarget(),c):new l.constructor(l.getConnectSource(),n,c),o.push(f),l.getLayer()&&l.getLayer()._getRenderer()&&i.merge(l.getLayer()._getRenderer().resources)}this._shadowConnectors=o,o.push(n),this._dragStageLayer.bringToFront().addGeometry(o)},i._onTargetUpdated=function(){this._shadow&&this._shadow.setSymbol(this.target._getSymbol())},i._prepareDragStageLayer=function(){var e=this.target.getMap(),n=this.target.getLayer();this._dragStageLayer=e.getLayer(Zg),this._dragStageLayer||(this._dragStageLayer=new ad(Zg,{enableAltitude:n.options.enableAltitude,altitudeProperty:n.options.altitudeProperty}),e.addLayer(this._dragStageLayer));var i=new yu;i.merge(n._getRenderer().resources),this._dragStageLayer._getRenderer().resources=i},i._startDrag=function(e){var n=this.target.getMap();if(n&&(!this.target._getParent()&&!this.isDragging())){var i=e.domEvent;if(!(i.touches&&i.touches.length>1||2===i.button)){this.container=n.getPanels().mapWrapper||n.getContainer(),this.target.on("click",this._endDrag,this);var o=this._correctCoord(e.coordinate);this._lastCoord=Xg(this.target,e.containerPoint,o),this._lastPoint=e.containerPoint,this._prepareDragHandler(),this._dragHandler.onMouseDown(e.domEvent),$i(this.container,"mouseleave",this._endDrag,this),this._startParam=e,this._moved=!1}}},i._dragging=function(e){var n=this.target,i=n.getMap();if(!i._isEventOutMap(e.domEvent)){var o=i._parseEvent(e.domEvent),s=o.domEvent;if(!(s.touches&&s.touches.length>1||i._isContainerPointOutOfMap(o.containerPoint))){if(!this._moved)return this._moved=!0,n.on("symbolchange",this._onTargetUpdated,this),this._isDragging=!0,this._prepareShadow(),this._shadow&&(n.options.dragShadow||n.hide(),this._shadow._fireEvent("dragstart",o)),this.target._fireEvent("dragstart",this._startParam||o),void delete this._startParam;var a=this._shadow||n,h=a.options.dragOnAxis,l=a.options.dragOnScreenAxis,c=o.containerPoint,A=o.coordinate;this._lastPoint=this._lastPoint||c,this._lastCoord=this._lastCoord||A,l?("x"===h?c.y=this._lastPoint.y:"y"===h&&(c.x=this._lastPoint.x),A=i.containerPointToCoord(c)):A=this._correctCoord(A),A=Xg(n,o.containerPoint,A);var f=c.sub(this._lastPoint),d=A.sub(this._lastCoord);l||("x"===h?f.y=d.y=0:"y"===h&&(f.x=d.x=0)),this._lastPoint=c,this._lastCoord=A;var p=!a.getGeometries&&a.isPoint;p?a.setCoordinates(A):a.translate(d),a===n||n.options.dragShadow||(p?n.setCoordinates(A):n.translate(d)),o.coordOffset=d,o.pointOffset=f,a._fireEvent("dragging",o),a!==n&&n._fireEvent("dragging",o)}}},i._endDrag=function(e){if(this._dragHandler&&(this._dragHandler.disable(),delete this._dragHandler),this.container&&tr(this.container,"mouseleave",this._endDrag),this.target){var n=this.target;n.off("click",this._endDrag,this),n.off("symbolchange",this._onTargetUpdated,this),delete this._lastCoord,delete this._lastPoint,this._isDragging=!1;var i=n.getMap();if(this.enabled()&&i){var o=i._parseEvent(e?e.domEvent:null);this._updateTargetAndRemoveShadow(o),this._moved&&n._fireEvent("dragend",o)}}},i.isDragging=function(){return!!this._isDragging},i._updateTargetAndRemoveShadow=function(e){if(this._shadow){var n=this.target,i=n.getMap();n.options.dragShadow||n.show();var o=this._shadow;if(o){if(n.options.dragShadow){var s=o.getFirstCoordinate(),a=n.getFirstCoordinate(),h=s.sub(a);n.translate(h)}o._fireEvent("dragend",e),o.remove(),delete this._shadow}this._shadowConnectors&&(i.getLayer(Zg).removeGeometry(this._shadowConnectors),delete this._shadowConnectors),this._dragStageLayer&&(this._dragStageLayer._getRenderer().resources=new yu,this._dragStageLayer.remove())}},i._correctCoord=function(e){var n=this.target.getMap();if(!n.getPitch())return e;var i=this.target;if(!i.getMinAltitude())return e;var o=(i.getMinAltitude()+i.getMaxAltitude())/2;return n.locateByPoint(e,0,-o)},n}(Sh);_A.mergeOptions({draggable:!1,dragShadow:!0,dragOnAxis:null,dragOnScreenAxis:!1}),_A.addInitHook("addHandler","draggable",Yg),_A.include({isDragging:function(){return this._getParent()?this._getParent().isDragging():!!this.draggable&&this.draggable.isDragging()}}),_A.include({startEdit:function(e){var n=this.getMap();return n&&this.options.editable?(this._editor&&this.endEdit(),this._recordVisible(),this._editor=new qg(this,e),this._editor.start(),this._getParent()||this.fire("editstart"),n.getRenderer().setToRedraw(),this):this},endEdit:function(){if(this._editor){this._editor.stop(),delete this._editor,this._recoveryVisible(),this._getParent()||this.fire("editend");var e=this.getMap();e&&e.getRenderer().setToRedraw()}return this},redoEdit:function(){return this.isEditing()?(this._editor.redo(),this._getParent()||this.fire("redoedit"),this):this},undoEdit:function(){return this.isEditing()?(this._editor.undo(),this._getParent()||this.fire("undoedit"),this):this},cancelEdit:function(){return this.isEditing()?(this._recoveryVisible(),this._editor.cancel(),this._getParent()||this.fire("canceledit"),this):this},isEditing:function(){return!!this._editor&&this._editor.isEditing()}}),_A.include({_onEvent:function(e,n){var i=this.getMap();if(i){var o=n||this._getEventTypeToFire(e);"contextmenu"===o&&this.listens("contextmenu")&&(ki(e),Di(e));var s=i._getEventParams(e);l(this._pickGeometryIndex)&&(s.pickGeometryIndex=this._pickGeometryIndex),this._fireEvent(o,s)}},_getEventTypeToFire:function(e){return e.type}}),_A.include({setInfoWindow:function(e){return this.removeInfoWindow(),e instanceof rp?(this._infoWindow=e,this._infoWinOptions=a({},this._infoWindow.options),this._infoWindow.addTo(this),this):(this._infoWinOptions=a({},e),this._infoWindow?this._infoWindow.setOptions(e):this.getMap()&&this._bindInfoWindow(),this)},getInfoWindow:function(){return this._infoWindow?this._infoWindow:null},openInfoWindow:function(e){return this.getMap()?(e||(e=this.getCenter()),this._infoWindow?this._infoWindow.show(e):this._infoWinOptions&&this.getMap()&&(this._bindInfoWindow(),this._infoWindow.show(e)),this):this},closeInfoWindow:function(){return this._infoWindow&&this._infoWindow.hide(),this},removeInfoWindow:function(){return this._unbindInfoWindow(),delete this._infoWinOptions,delete this._infoWindow,this},_bindInfoWindow:function(){var e=this._infoWinOptions;return e?(this._infoWindow=new rp(e),this._infoWindow.addTo(this),this):this},_unbindInfoWindow:function(){return this._infoWindow&&(this.closeInfoWindow(),this._infoWindow.remove(),delete this._infoWindow),this}}),_A.fromJSON=function(e){if(Array.isArray(e)){for(var n=[],i=0,o=e.length;i<o;i++){var s=_A.fromJSON(e[i]);Array.isArray(e)?n=n.concat(s):n.push(s)}return n}return e&&!e.feature?Rf.toGeometry(e):(e.subType?(a=_A.getJSONClass(e.subType).fromJSON(e),h(e.feature.id)||a.setId(e.feature.id)):(a=Rf.toGeometry(e.feature),e.options&&a.config(e.options)),e.symbol&&a.setSymbol(e.symbol),e.infoWindow&&a.setInfoWindow(e.infoWindow),a);var a};var Jg=new ee(0,0),Kg=new ee(0,0),$g=new ee(0,0),tm=new ee(0,0),em=[],nm=function(e){function n(){return e.call(this,Xs)||this}kt(n,e);var i=n.prototype;return i.checkUrl=function(e){return e&&f(e)?an(e):e},i.fetchImage=function(e,n,i,o){e=this.checkUrl(e),this.send({url:e,fetchOptions:o},em,i,n)},n}(Au),im=function(e){function n(n){var i;(i=e.call(this,n)||this).tilesInView={},i.tilesLoading={},i._parentTiles=[],i._childTiles=[],i._tileQueue=[],i._tileQueueIds=new Set;var o=n.getTileSize().width;return i.tileCache=new Oa(n.options.maxCacheSize*o/512*o/512,(function(e){i.deleteTile(e)})),wt.decodeImageInWorker&&i.layer.options.decodeImageInWorker&&("gl"===n.options.renderer||!wt.safari&&!wt.iosWeixin)&&(i._tileImageWorkerConn=new nm),i._compareTiles=om.bind(i),i}kt(n,e);var i=n.prototype;return i.getCurrentTileZoom=function(){return this._tileZoom},i.draw=function(e,n){var i=this.getMap();if(this.isDrawable()){var o=this.prepareCanvas();if(!o||o.intersects(this.canvasExtent2D)){var s;this._renderTimestamp!==e&&(this._consumeTileQueue(),this._computeAvgTileAltitude(),this._renderTimestamp=e);var a=!1,h=this._frameTiles;if(h&&e===h.timestamp){if(h.empty)return;s=h}else{if(!(s=this._getTilesInCurrentFrame()))return this._frameTiles={empty:!0,timestamp:e},void this.completeRender();a=!0,this._frameTiles=s,this._frameTiles.timestamp=e,s.loadingCount&&this.loadTileQueue(s.tileQueue)}var{tiles:l,childTiles:c,parentTiles:A,placeholders:f,loading:d,loadingCount:p,missedTiles:g,incompleteTiles:v}=s;this._drawTiles(l,A,c,f,n,g,v),p||d||(i.isAnimating()||!this._parentTiles.length&&!this._childTiles.length||(this._parentTiles=[],this._childTiles=[],this.setToRedraw()),this.completeRender()),a&&this.retireTiles()}else this.completeRender()}},i.getTileGridsInCurrentFrame=function(){return this._frameTileGrids},i.getCurrentTimestamp=function(){return this._renderTimestamp||0},i._getTilesInCurrentFrame=function(){var e=this.getMap(),n=this.layer,i=n._isPyramidMode()&&n.options.terrainTileMode,o=n.getTiles();if(this._frameTileGrids=o,!(o=o.tileGrids)||!o.length)return null;var s=o.reduce((function(e,n){return e+(n&&n.tiles&&n.tiles.length||0)}),0);s>=this.tileCache.max/2&&this.tileCache.setMaxSize(2*s+1);var a=0,h=!1,l={},c=[],A=[],f={},d=[],p={},g=[],v={},w={},C=this.markTiles(),P=this._getLoadLimit(),T=o.length,S=void 0===this._tileZoom&&n.options.currentTilesFirst&&!this._terrainHelper;this._tileZoom=o[0].zoom;var I=null,E=null;i&&(I=[],E=new Map);for(var O=0;O<T;O++){var k=o[O],L=k.tiles,F=k.parents||em,N=F.length,z=S?L:F.concat(L),H=void 0;z.length&&(H=this._generatePlaceHolder(z[0].res));for(var j=0,W=z.length;j<W;j++){var q=z[j],Y=q.id,J=!S&&j<N,$=!1,it=c.length;if(this._isLoadingTile(Y))$=h=!0,this.markCurrent(this.tilesLoading[Y],!0);else{var rt=this.getCachedTile(q,J);if(rt)J||(rt.image&&this.isTileFadingIn(rt.image)&&($=h=!0,this.setToRedraw()),this.isTileComplete(rt)?c.push(rt):($=!0,i&&E.set(Y,rt)));else{$=h=!0;var ot=P&&a+C[0]>P;if(!this._tileQueueIds.has(q.id)&&!ot&&(!e.isInteracting()||e.isMoving()||e.isRotating()))a++,w[Y]=q}}if(i&&!J&&(c.length===it?I.push(q):l[q.id]=1),!i&&!J&&$&&!l[Y]){l[Y]=1,H&&!v[Y]&&(q.cache=!1,g.push({image:H,info:q}),v[Y]=1);var st=this._findChildTiles(q);if(st.length&&st.forEach((function(e){p[e.info.id]||(d.push(e),p[e.info.id]=1)})),!st.length||4!==st.length){var at=this._findParentTile(q);if(at){var ht=at.info.id;void 0===f[ht]&&(f[ht]=A.length,A.push(at))}}}}}var At=[];if(i)for(var ft=0;ft<I.length;ft++){var gt=I[ft].info?I[ft].info:I[ft];if(gt.parent&&!l[gt.id]){var{tiles:vt,missedTiles:_t}=this._findChildTiles(gt);vt.length?(he(c,vt),he(At,_t)):E.has(gt.id)?(c.push(E.get(gt.id)),E.delete(gt.id)):(l[gt.id]=1,At.push(gt))}}return this.tileCache.shrink(),{childTiles:d,missedTiles:At,parentTiles:A,tiles:c,incompleteTiles:E&&Array.from(E.values()),placeholders:g,loading:h,loadingCount:a,tileQueue:w}},i.removeTileCache=function(e){delete this.tilesInView[e],this.tileCache.remove(e)},i.isTileCachedOrLoading=function(e){return this.tileCache.get(e)||this.tilesInView[e]||this.tilesLoading[e]},i.isTileCached=function(e){return!(!this.tileCache.get(e)&&!this.tilesInView[e])},i.isTileFadingIn=function(e){return this._getTileFadingOpacity(e)<1},i._drawTiles=function(e,n,i,o,s,a,h){var l=this;n.length&&(n.sort(this._compareTiles),this._parentTiles=n),i.length&&(this._childTiles=i,this._childTiles.sort(this._compareTiles));var c=!0;this.layer.constructor!==Qp&&this.layer.constructor!==ig||(this._renderTimestamp===this.canvas._parentTileTimestamp?c=!1:this.canvas._parentTileTimestamp=this._renderTimestamp);var A="gl"===this.layer.options.renderer&&(!this.isGL||this.isGL()),f={tiles:e,parentTiles:this._parentTiles,childTiles:this._childTiles,parentContext:s};if(this.onDrawTileStart(f,s),c&&1===this.layer.options.opacity){this.layer._silentConfig=!0;var d=this.layer.options.fadeAnimation;this.layer.options.fadeAnimation=!1,A?(this._drawChildTiles(i,s),this._drawParentTiles(this._parentTiles,s)):(this._drawParentTiles(this._parentTiles,s),this._drawChildTiles(i,s)),this.layer.options.fadeAnimation=d,this.layer._silentConfig=!1}this.drawingCurrentTiles=!0,e.sort(this._compareTiles);for(var p=0,g=e.length;p<g;p++)this._drawTileAndCache(e[p],s);if(delete this.drawingCurrentTiles,c&&this.layer.options.opacity<1){this.layer._silentConfig=!0;var v=this.layer.options.fadeAnimation;this.layer.options.fadeAnimation=!1,A?(this._drawChildTiles(i,s),this._drawParentTiles(this._parentTiles,s)):(this._drawParentTiles(this._parentTiles,s),this._drawChildTiles(i,s)),this.layer.options.fadeAnimation=v,this.layer._silentConfig=!1}o.forEach((function(e){return l._drawTile(e.info,e.image,s)})),this.onDrawTileEnd(f,s)},i._drawChildTiles=function(e,n){var i=this;this.drawingChildTiles=!0,e.forEach((function(e){return i._drawTile(e.info,e.image,n)})),delete this.drawingChildTiles},i._drawParentTiles=function(e,n){var i=this;this.drawingParentTiles=!0,this._parentTiles.forEach((function(e){return i._drawTile(e.info,e.image,n)})),delete this.drawingParentTiles},i.onDrawTileStart=function(e,n){},i.onDrawTileEnd=function(e,n){},i._drawTile=function(e,n,i){n&&this.drawTile(e,n,i)},i._drawTileAndCache=function(e,n){this.isValidCachedTile(e)&&(this.tilesInView[e.info.id]=e),this._drawTile(e.info,e.image,n)},i.drawOnInteracting=function(e,n,i){this.draw(n,i)},i.needToRedraw=function(){var n=this.getMap();return!!this._tileQueue.length||(n.getPitch()?e.prototype.needToRedraw.call(this):!(!n.isRotating()&&!n.isZooming())||(n.isMoving()?!!this.layer.options.forceRenderOnMoving:e.prototype.needToRedraw.call(this)))},i.hitDetect=function(){return!1},i._getLoadLimit=function(){return this.getMap().isInteracting()?this.layer.options.loadingLimitOnInteracting:this.layer.options.loadingLimit||0},i.isDrawable=function(){return!this.getMap().getPitch()||(console&&console.warn("TileLayer with canvas renderer can't be pitched, use gl renderer ('renderer' : 'gl') instead."),this.clear(),!1)},i.clear=function(){this.retireTiles(!0),this.tileCache.reset(),this.tilesInView={},this.tilesLoading={},this._tileQueue=[],this._tileQueueIds.clear(),this._parentTiles=[],this._childTiles=[],e.prototype.clear.call(this)},i._isLoadingTile=function(e){return!!this.tilesLoading[e]},i.clipCanvas=function(n){return e.prototype.clipCanvas.call(this,n)},i._clipByPitch=function(e){var n=this.getMap();if(n.getPitch()<=n.options.maxVisualPitch)return!1;if(!this.layer.options.clipByPitch)return!1;var i=n.getContainerExtent(),o=n.getDevicePixelRatio();return e.save(),e.strokeStyle="rgba(0, 0, 0, 0)",e.beginPath(),e.rect(0,Math.ceil(i.ymin)*o,Math.ceil(i.getWidth())*o,Math.ceil(i.getHeight())*o),e.stroke(),e.clip(),!0},i.loadTileQueue=function(e){for(var n in e)if(e.hasOwnProperty(n)){var i=e[n],o=this.loadTile(i);void 0===o.loadTime&&(this.tilesLoading[i.id]={image:o,current:!0,info:i})}},i.loadTile=function(e){var n=this,i={};if(this.loadTileBitmap){this.loadTileBitmap(e.url,e,(function(i){n.onTileLoad(i,e)}),(function(i,o){n.onTileError(o,e,i)}))}else if(this._tileImageWorkerConn&&this.loadTileImage===this.constructor.prototype.loadTileImage)this._fetchImage(i,e);else{var o=this.layer.getTileSize(e.layer);(i=new Image).width=o.width,i.height=o.height,i.onload=this.onTileLoad.bind(this,i,e),i.onerror=this.onTileError.bind(this,i,e),this.loadTileImage(i,e.url)}return i},i._fetchImage=function(e,n){var i=this;if(e instanceof Image)e.src=n.url;else{var{x:o,y:s}=n,a=Math.abs(o+s)%this._tileImageWorkerConn.workers.length;this._tileImageWorkerConn.fetchImage(n.url,a,(function(o,s){o?i.onTileError(e,n,o):sn(s,(function(e){i.onTileLoad(e,n)}))}),this.layer.options.fetchOptions||{referrer:document.location.href,headers:{accept:"image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8"}})}},i.loadTileImage=function(e,n){var i=this.layer.options.crossOrigin;return h(i)||(e.crossOrigin=i),ie(e,[n])},i.abortTileLoading=function(e,n){n&&void 0!==n.id&&this.removeTileLoading(n),e&&e instanceof Image&&(e.onload=rm,e.onerror=rm,e.src=Ke)},i.onTileLoad=function(e,n){this.removeTileLoading(n),this._tileQueue.push({tileInfo:n,tileData:e}),this._tileQueueIds.add(n.id),this.setToRedraw()},i.removeTileLoading=function(e){delete this.tilesLoading[e.id],this.setToRedraw()},i._consumeTileQueue=function(){for(var e=0,n=this.layer.options.tileLimitPerFrame,i=this._tileQueue;i.length&&(n<=0||e<n);){var{tileData:o,tileInfo:s}=i.shift();this._tileQueueIds.has(s.id)&&(this._tileQueueIds.delete(s.id),this.checkTileInQueue(o,s)&&(this.consumeTile(o,s),e++))}},i._computeAvgTileAltitude=function(){var e=0,n=0,i=0;for(var o in this.tilesInView){var s=this.tilesInView[o]&&this.tilesInView[o].info;s&&(e+=s.minAltitude||0,n+=s.maxAltitude||0,i++)}this.avgMinAltitude=e/i,this.avgMaxAltitude=n/i},i.checkTileInQueue=function(e,n){return!0},i.consumeTile=function(e,n){if(this.layer&&this.tilesInView){var i={tile:n,tileImage:e};this.resetTileLoadTime(e=i.tileImage),this.removeTileLoading(n),this._addTileToCache(n,e),this.layer.fire("tileload",i),this.setToRedraw()}},i.resetTileLoadTime=function(e){0!==e.loadTime&&(e.loadTime=s())},i.onTileError=function(e,n,i){if(this.layer){var o=this.layer.options.reloadErrorTileFunction;if(o)o.call(this,this.layer,this,n,e);else{var s=this.layer.options.errorUrl;if(s){if(e instanceof Image&&e.src!==s)return e.src=s,void this.removeTileLoading(n);(e=new Image).src=s}this.abortTileLoading(e,n),e.loadTime=0,this.removeTileLoading(n),this._addTileToCache(n,e),this.setToRedraw(),this.layer.fire("tileerror",{tile:n})}}},i.drawTile=function(e,n,i){if(n&&this.getMap()){var{extent2d:o,offset:s}=e,a=Jg.set(o.xmin-s[0],o.ymax-s[1]),h=e.z,l=e.id,c=this.getMap(),A=c.getZoom(),f=this.context,d=c._pointAtResToContainerPoint(a,e.res,0,Kg),p=c.getBearing(),g=p||A!==h,v=this.getTileOpacity(n,e),w=f.globalAlpha;v<1&&(f.globalAlpha=v),g||d._round();var C=d.x,P=d.y,T=e.extent2d.xmax-e.extent2d.xmin,S=e.extent2d.ymax-e.extent2d.ymin,I=this.layer,E=I?I.options.bufferPixel:0;if(g){f.save(),f.translate(C,P),p&&f.rotate(-p*Math.PI/180),T+=E,S+=E;var O=c._getResolution();if(O!==e.res){var k=e.res/O;f.scale(k,k)}C=P=0}if(_h.image(f,n,C,P,T,S),this.layer.options.debug){var L=this.layer.options.debugOutline;f.save(),f.strokeStyle=L,f.fillStyle=L,f.font="20px monospace";var F=new ee(C,P);_h.rectangle(f,F,{width:T,height:S},1,0),_h.fillText(f,this.getDebugInfo(l),F._add(32,S-14),L),_h.drawCross(f,C+T/2,P+S/2,2,L),f.restore()}g&&f.restore(),f.globalAlpha!==w&&(f.globalAlpha=w),this.setCanvasUpdated()}},i.getDebugInfo=function(e){var n=e.split("_"),i=n.length;return n[i-3]+"/"+n[i-2]+"/"+n[i-1]},i.findChildTiles=function(e){return this._findChildTiles(e)},i._findChildTiles=function(e){var n=this._getLayerOfTile(e.layer),i=n&&n.options.terrainTileMode&&n._isPyramidMode();if(!n||!n.options.background&&!i||e.z>this.layer.getMaxZoom())return em;var o=this.getMap(),s=[];if(n._isPyramidMode()){if(!i){for(var a=this._getLayerOfTile(e.layer),h=2*e.x,l=2*e.y,c=e.z+1,A=[],f=0;f<2;f++)for(var d=0;d<2;d++)A.push(h+f,l+d,c);for(;A.length;){var p=A.pop(),g=A.pop(),v=A.pop(),w=a._getTileId(v,g,p,e.layer),C=p+1<=e.z+2,P=this.tileCache.getAndRemove(w);if(P){if(this.isValidCachedTile(P))s.push(P),this.tileCache.add(w,P);else if(C)for(var T=0;T<2;T++)for(var S=0;S<2;S++)A.push(2*v+T,2*g+S,p+1)}else if(C)for(var I=0;I<2;I++)for(var E=0;E<2;E++)A.push(2*v+I,2*g+E,p+1)}return s}var O;i&&(O=[]);for(var k=2*e.x,L=2*e.y,F=e.z+1,N=[],z=0;z<2;z++)for(var H=0;H<2;H++){var j=n._getTileId(k+z,L+H,F,e.layer),W=this.tileCache.getAndRemove(j);W&&this.isValidCachedTile(W)?(s.push(W),this.tileCache.add(j,W),N.push(null)):N.push(j)}if(s.length<4)for(var q=0,Y=0;Y<2;Y++)for(var J=0;J<2;J++){var $=N[q++];if($){for(var it=k+Y,rt=L+J,ot=F,st=s.length,at=[],ht=0;ht<2;ht++)for(var At=0;At<2;At++){var ft=n._getTileId(2*it+ht,2*rt+At,ot+1,e.layer),gt=this.tileCache.getAndRemove(ft);gt&&this.isValidCachedTile(gt)?(s.push(gt),this.tileCache.add(ft,gt),at.push(null)):at.push(ft)}if(i&&s.length-st<4){var vt=n.tileInfoCache.get($)||n._createChildNode(e,Y,J,[0,0],$);if(s.length-st==0)O.push(vt);else for(var _t=0,xt=0;xt<2;xt++)for(var wt=0;wt<2;wt++){var Ct=at[_t++];if(Ct){var Ot=this.layer.tileInfoCache.get(Ct)||n._createChildNode(vt,xt,wt,[0,0],Ct);O.push(Ot)}}}}}return i?{tiles:s,missedTiles:O}:s}for(var Dt=e.res,kt=e.extent2d.getMin(),Nt=e.extent2d.getMax(),Bt=n._project(o._pointToPrjAtRes(kt,Dt,$g),$g),Ht=n._project(o._pointToPrjAtRes(Nt,Dt,tm),tm),Ut=1;Ut<1;Ut++)this._findChildTilesAt(s,Bt,Ht,n,e.z+Ut);return s},i._findChildTilesAt=function(e,n,i,o,s){var a=o.getId(),h=o.getSpatialReference().getResolution(s);if(h)for(var l,c,A=o._getTileConfig().getTileIndex(n,h),f=o._getTileConfig().getTileIndex(i,h),d=Math.min(A.idx,f.idx),p=Math.max(A.idx,f.idx),g=Math.min(A.idy,f.idy),v=Math.max(A.idy,f.idy),w=d;w<p;w++)for(var C=g;C<v;C++)l=o._getTileId(w,C,s,a),(c=this.tileCache.getAndRemove(l))&&this.isValidCachedTile(c)&&(e.push(c),this.tileCache.add(l,c))},i.findParentTile=function(e,n){return this._findParentTile(e,n)},i._findParentTile=function(e,n){var i=this.getMap(),o=this._getLayerOfTile(e.layer);if(!o||!o.options.background&&!o.options.terrainTileMode)return null;var s=o.getMinZoom(),a=n||e.z-s;if(o._isPyramidMode()){for(var h=e.z-a,l=e.z-1;l>=h;l--){var c=Math.pow(2,e.z-l),A=Math.floor(e.x/c),f=Math.floor(e.y/c),d=void 0;d=l===e.z-1?e.parent:o._getTileId(A,f,l,e.layer);var p=this.tileCache.getAndRemove(d);if(p&&this.isValidCachedTile(p))return this.tileCache.add(d,p),p}return null}for(var g=o.getSpatialReference(),v=g.getZoomDirection(),w=e.res,C=e.extent2d.getCenter(),P=o._project(i._pointToPrjAtRes(C,w)),T=1;T<=a;T++){var S=e.z-v*T,I=g.getResolution(S);if(I){var E=o._getTileConfig().getTileIndex(P,I),O=o._getTileId(E.x,E.y,S,e.layer),k=this.tileCache.getAndRemove(O);if(k)return this.tileCache.add(O,k),k}}return null},i.isValidCachedTile=function(e){return!!e.image},i.isTileComplete=function(e){return!0},i._getLayerOfTile=function(e){return this.layer.getChildLayer?this.layer.getChildLayer(e):this.layer},i.getCachedTile=function(e,n){var i=e.id,o=this.tilesInView,s=this.tileCache.getAndRemove(i);if(s){n||(o[i]=s);var a=this.tilesLoading;if(a&&a[i]){this.markCurrent(a[i],!1);var{image:h,info:l}=a[i];this.abortTileLoading(h,l),delete a[i]}}else s=o[i];return s&&(s.current=!0,this.isValidCachedTile(s)&&this.tileCache.add(i,s)),s},i._addTileToCache=function(e,n){this.isValidCachedTile({info:e,image:n})&&this.tileCache.add(e.id,{image:n,info:e})},i.getTileOpacity=function(e,n){var i=this._getTileFadingOpacity(e);if(this.layer.getChildLayer){var o=this.layer.getLayer(n.layer);o&&(i*=o.options.opacity)}return i},i._getTileFadingOpacity=function(e){return this.layer.options.fadeAnimation&&e.loadTime?Math.min(1,(s()-e.loadTime)/this.layer.options.fadeDuration):1},i.onRemove=function(){this.clear(),delete this.tileCache,delete this._tilePlaceHolder,delete this._tileZoom,e.prototype.onRemove.call(this)},i.markCurrent=function(e,n){e.current=n},i.markTiles=function(){var e=0,n=0;if(this.tilesLoading)for(var i in this.tilesLoading)this.markCurrent(this.tilesLoading[i],!1),e++;if(this.tilesInView)for(var o in this.tilesInView)this.markCurrent(this.tilesInView[o],!1),n++;return[e,n]},i.retireTiles=function(e){for(var n in this.tilesLoading){var i=this.tilesLoading[n];!e&&i.current||(i.image&&this.abortTileLoading(i.image,i.info),this.deleteTile(i),this.removeTileLoading(i.info))}for(var o in this.tilesInView){var s=this.tilesInView[o];s.current||(delete this.tilesInView[o],this.tileCache.has(o)||this.deleteTile(s))}},i.deleteTile=function(e){if(e&&e.image){var n=e.info.id;this._tileQueueIds.has(n)&&this._tileQueueIds.delete(n),e.image.close&&e.image.close(),e.image instanceof Image&&(e.image.onload=null,e.image.onerror=null)}},i._generatePlaceHolder=function(e){var n=this.getMap(),i=this.layer.options.placeholder;if(!i||n.getPitch())return null;var o=this.layer.getTileSize(),s=e/n._getResolution(),a=this._tilePlaceHolder=this._tilePlaceHolder||_h.createCanvas(1,1,n.CanvasClass);return a.width=o.width*s,a.height=o.height*s,d(i)?i(a):function(e){var n=e.getContext("2d"),i=e.width,o=e.height,s=i/16,a=o/16;n.beginPath();for(var h=0;h<16;h++)n.moveTo(0,h*a),n.lineTo(i,h*a),n.moveTo(h*s,0),n.lineTo(h*s,o);n.strokeStyle="rgba(180, 180, 180, 0.1)",n.lineWidth=1,n.stroke(),n.beginPath();for(var l=[[0,0],[i,0],[0,o],[i,o],[0,0],[0,o],[i,0],[i,o],[0,o/2],[i,o/2],[i/2,0],[i/2,o]],c=1;c<l.length;c+=2)n.moveTo(l[c-1][0],l[c-1][1]),n.lineTo(l[c][0],l[c][1]);n.lineWidth=4,n.stroke()}(a),a},i.setTerrainHelper=function(e){this._terrainHelper=e},n}(mu);function rm(){return!1}function om(e,n){return Math.abs(this._tileZoom-e.info.z)-Math.abs(this._tileZoom-n.info.z)}Qp.registerRenderer("canvas",im);var sm=new ee(0,0),am={properties:{}},hm=function(e){function n(){return e.apply(this,arguments)||this}kt(n,e);var i=n.prototype;return i.isDrawable=function(){return!0},i.needToRedraw=function(){var n=this.getMap();return!(!this.isGL()||n.getPitch()||!n.isZooming()||n.isMoving()||n.isRotating())||e.prototype.needToRedraw.call(this)},i.onDrawTileStart=function(e,n){var i=this.gl;if(i.enable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL),i.enable(i.POLYGON_OFFSET_FILL),i.enable(i.STENCIL_TEST),i.stencilOp(i.KEEP,i.KEEP,i.REPLACE),i.depthMask(!!this.layer.options.depthMask),n&&n.renderTarget){var o=n.renderTarget.fbo;if(o){var s=n.renderTarget.getFramebuffer(o);i.bindFramebuffer(i.FRAMEBUFFER,s)}}},i.onDrawTileEnd=function(e,n){var i=this.gl;n&&n.renderTarget&&(n.renderTarget.fbo&&i.bindFramebuffer(i.FRAMEBUFFER,null))},i.drawTile=function(n,i,o){if(!o||!o.sceneFilter||o.sceneFilter(am)){var s=this.getMap();if(n&&s&&i){var a=n._glScale=n._glScale||n.res/s.getGLRes(),h=n.extent2d.xmax-n.extent2d.xmin,l=n.extent2d.ymax-n.extent2d.ymin;if(!1!==n.cache&&this._bindGLBuffer(i,h,l),this.isGL()){var{extent2d:c,offset:A}=n,f=sm.set(c.xmin-A[0],n.extent2d.ymax-A[1]),d=f.x*a,p=f.y*a,g=this.getTileOpacity(i,n),v=null;this.layer.options.debug&&(v=this.getDebugInfo(n.id));var w=this.gl;w.stencilFunc(w.LEQUAL,Math.abs(this.getCurrentTileZoom()-n.z),255);var C=this.layer.getPolygonOffset(),P=this.drawingCurrentTiles?C:C+1;w.polygonOffset(P,P),this.drawGLImage(i,d,p,h,l,a,g,v),this._getTileFadingOpacity(i)<1?this.setToRedraw():this.setCanvasUpdated()}else e.prototype.drawTile.call(this,n,i)}}},i._bindGLBuffer=function(e,n,i){e.glBuffer||(e.glBuffer=this.bufferTileData(0,0,n,i))},i.loadTileImage=function(e,n){var i=this.layer.options.crossOrigin;e.crossOrigin=null!==i?i:"",e.src=n},i.onCanvasCreate=function(){this.canvas.gl&&this.canvas.gl.wrap||this.createCanvas2()},i.createContext=function(){e.prototype.createContext.call(this),this.createGLContext()},i.resizeCanvas=function(n){this.canvas&&(e.prototype.resizeCanvas.call(this,n),this.resizeGLCanvas())},i.clearCanvas=function(){this.canvas&&(e.prototype.clearCanvas.call(this),this.clearGLCanvas())},i.getCanvasImage=function(){if(!this.isGL()||!this.canvas2)return e.prototype.getCanvasImage.call(this);var n=e.prototype.getCanvasImage.call(this);return n&&(n.image=this.canvas2),n},i.isGL=function(){if(this.canvas.gl&&this.canvas.gl.wrap)return!0;var e=this.getMap();return e&&(e.getPitch()||e.getBearing())||this.layer&&!!this.layer.options.fragmentShader},i.deleteTile=function(n){e.prototype.deleteTile.call(this,n),n&&n.image&&this.disposeImage(n.image),delete n.image},i.onRemove=function(){e.prototype.onRemove.call(this),this.removeGLCanvas()},n}(yg(im));function lm(e){var n=this,i=this.layer.getTileSize(),o=this.canvas.constructor,s=this.getMap(),a=s.getDevicePixelRatio(),h=_h.createCanvas(i.width*a,i.height*a,o);h.layer=this.layer;var l=new ee(e.extent2d.xmin,e.extent2d.ymax),c=new al(s.pointToCoordinate(l),s.pointToCoordinate(l.add(i.width,i.height)),s.getProjection());return this.layer.drawTile(h,{url:e.url,point:l,center:s.pointToCoordinate(l.add(i.width/2,i.height/2)),extent:c,z:e.z,x:e.x,y:e.y},(function(i){i?n.onTileError(h,e):n.onTileLoad(h,e)})),h}Qp.registerRenderer("gl",hm);var um=function(e){function n(){return e.apply(this,arguments)||this}return kt(n,e),n.prototype.loadTile=function(...e){return lm.apply(this,e)},n}(im),cm=function(e){function n(){return e.apply(this,arguments)||this}return kt(n,e),n.prototype.loadTile=function(...e){return lm.apply(this,e)},n}(hm);rg.registerRenderer("canvas",um),rg.registerRenderer("gl",cm);var Am="undefined"!=typeof Int8Array?new Int8Array([-1,1,0,-1,-1,0,1,1,0,1,-1,0]):[],fm=function(){function e(e,n,i){this.gl=e,this.quadVertices=n||Am,this.attributes=["a_position",3,dm(n)],this.debug=i}var n=e.prototype;return n.start=function(){var e=this.gl;e.enable(e.STENCIL_TEST),e.stencilMask(255),e.stencilOp(e.KEEP,e.REPLACE,e.REPLACE),e.depthMask(!1),this._save(),this.buffer||(this._createBuffer(),this._createProgram()),e.useProgram(this.program),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),ag(e,this.program,this.attributes),this.transformLoc||(this.transformLoc=e.getUniformLocation(this.program,"transform")),this.colorLoc||(this.colorLoc=e.getUniformLocation(this.program,"color")),this.debug||e.colorMask(!1,!1,!1,!1)},n.end=function(){var e=this.gl;e.depthMask(!0),this._restore(),this.debug||e.colorMask(!0,!0,!0,!0)},n.draw=function(e){var n=this.gl;n.uniformMatrix4fv(this.transformLoc,!1,e),n.uniform3fv(this.colorLoc,[Math.random(),Math.random(),Math.random()]),n.drawArrays(n.TRIANGLE_STRIP,0,4)},n.remove=function(){var e=this.gl;return this.buffer&&e.deleteBuffer(this.buffer),this.program&&(e.deleteShader(this.program.fragmentShader),e.deleteShader(this.program.vertexShader),e.deleteProgram(this.program)),delete this.transformLoc,delete this.gl,this},n.stencilMask=function(e){return this.gl.stencilMask(e),this},n.stencilFunc=function(e,n,i){return this.ref=n,this.gl.stencilFunc(e,n,i),this},n.stencilOp=function(e,n,i){return this.gl.stencilOp(e,n,i),this},n.resetFunc=function(){return this.ref=1,this.gl.stencilFunc(this.gl.ALWAYS,1,255),this},n._save=function(){this._savedProgram=this.gl.program},n._restore=function(){var e=this.gl;e.program=this._savedProgram,e.program&&e.useProgram(e.program)},n._createBuffer=function(){var e=this.gl;if(this.buffer=e.createBuffer(),!this.buffer)throw new Error("Failed to create the buffer object");e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,this.quadVertices,e.STATIC_DRAW)},n._createProgram=function(){var{program:e,vertexShader:n,fragmentShader:i}=sg(this.gl,"\n    attribute vec3 a_position;\n    uniform mat4 transform;\n\n    void main()\n    {\n        gl_Position = transform * vec4(a_position, 1.0);\n    }\n","\n    precision mediump float;\n    uniform vec3 color;\n    void main()\n    {\n        gl_FragColor = vec4(color, 1.0);\n    }\n");e.vertexShader=n,e.fragmentShader=i,this.program=e},e}();function dm(e){return e instanceof Float32Array?"FLOAT":e instanceof Int16Array?"SHORT":e instanceof Uint16Array?"UNSIGNED_SHORT":e instanceof Int8Array?"BYTE":e instanceof Uint8Array||e instanceof Uint8ClampedArray?"UNSIGNED_BYTE":"FLOAT"}var pm=function(e){function n(){return e.apply(this,arguments)||this}kt(n,e);var i=n.prototype;return i.checkResources=function(){var e=this._geosToCheck||[];if(!this._resourceChecked&&this.layer._geoList&&he(e,this.layer._geoList),!xe(e))return[];for(var n=[],i={},o=e.length-1;o>=0;o--){var s=e[o]._getExternalResources();if(s.length)if(this.resources)for(var a=0;a<s.length;a++){var h=s[a][0];this.resources.isResourceLoaded(s[a])||i[h]||(n.push(s[a]),i[h]=1)}else n.push(...s)}return this._resourceChecked=!0,delete this._geosToCheck,n},i.render=function(...n){return this.layer._sortGeometries(),e.prototype.render.apply(this,n)},i._addGeoToCheckRes=function(e){e&&(Array.isArray(e)||(e=[e]),this._geosToCheck||(this._geosToCheck=[]),he(this._geosToCheck,e))},i.onGeometryAdd=function(e){this._addGeoToCheckRes(e),gm(this)},i.onGeometryRemove=function(e){gm(this)},i.onGeometrySymbolChange=function(e){this._addGeoToCheckRes(e.target),gm(this)},i.onGeometryShapeChange=function(e){gm(this)},i.onGeometryPositionChange=function(e){gm(this)},i.onGeometryZIndexChange=function(e){gm(this)},i.onGeometryShow=function(e){gm(this)},i.onGeometryHide=function(e){gm(this)},i.onGeometryPropertiesChange=function(e){gm(this)},n}(mu);function gm(e){e.layer.options.drawImmediate&&e.render(),e.setToRedraw()}var mm=new ll,ym=[],vm=new ll;function _m(e){if(!e)return null;var n=e.getContext("2d");return n.clearRect(0,0,e.width,e.height),n}function xm(e){return e&&e.options.progressiveRender&&e.options.progressiveRenderDebug}var bm=function(e){function n(){return e.apply(this,arguments)||this}kt(n,e);var i=n.prototype;return i.setToRedraw=function(){return e.prototype.setToRedraw.call(this),this._resetProgressiveRender(),this},i._geoIsCollision=function(e,n){if(!e)return!1;if(!e.options.collision)return!1;if(e.isPoint&&e.getContainerExtent){e.bbox||(e.bbox=[0,0,0,0]);var i=this.layer.options.collisionBufferSize,o=e.getContainerExtent();if(!o)return!1;if(e.bbox[0]=o.xmin-i,e.bbox[1]=o.ymin-i,e.bbox[2]=o.xmax+i,e.bbox[3]=o.ymax+i,n.collides(e.bbox))return e._collided=!0,!0;n.insertBox(e.bbox)}return!1},i.getImageData=function(){if(!this._lastRenderTime||s()-this._lastRenderTime<32)return null;if(!this.context||!this.context.canvas)return null;if(!this._imageData){var{width:e,height:n}=this.context.canvas;try{this._imageData=this.context.getImageData(0,0,e,n)}catch(e){console.warn("hit detect failed with tainted canvas, some geometries have external resources in another domain:\n",e)}}return this._imageData},i.clearImageData=function(){this._imageData=null,delete this._imageData,this._lastRenderTime=s()},i.checkResources=function(...n){var i=this,o=e.prototype.checkResources.apply(this,n),s=this.layer.getStyle();return s&&(Array.isArray(s)||(s=[s]),s.forEach((function(e){for(var n=vo(e.symbol,!0),s=0,a=n.length;s<a;s++)i.resources.isResourceLoaded(n[s])||o.push(n[s])}))),o},i.needToRedraw=function(){if(this.isProgressiveRender()&&!this.renderEnd)return!0;var n=this.getMap();return!(!n.isInteracting()||!this.layer.options.enableAltitude)||!(n.isZooming()&&!n.isRotating()&&!n.getPitch()&&!this._hasPoint&&this.layer.constructor===ad)&&e.prototype.needToRedraw.call(this)},i.draw=function(){if(this.getMap()){if(!this.layer.isVisible()||this.layer.isEmpty())return this.clearCanvas(),void this.completeRender();this.prepareCanvas(),this.drawGeos(),this.completeRender()}},i.isBlank=function(){return!!this.context&&(!this.isProgressiveRender()&&!this.context.canvas._drawn)},i.drawOnInteracting=function(){if(this._geosToDraw){this._updateMapStateCache(),this._updateDisplayExtent();var e=this.getMap(),n=this.layer.getCount(),i=this.mapStateCache.resolution;(e.isZooming()&&e.options.seamlessZoom&&void 0!==this._drawnRes&&i>1.5*this._drawnRes&&this._geosToDraw.length<n||e.isMoving()||e.isInteracting())&&(this.prepareToDraw(),this._batchConversionMarkers(this.mapStateCache.glRes),this._onlyHasPoint||this._checkGeos(),this._drawnRes=i),this._sortByDistanceToCamera(e.cameraPosition);var{collision:o,collisionDelay:a}=this.layer.options;if(o){var h=s();this._lastCollisionTime||(this._lastCollisionTime=h),h-this._lastCollisionTime<=a?this._geosToDraw=this._lastGeosToDraw||this._geosToDraw:(this._collidesGeos(),this._lastCollisionTime=h)}for(var l=0,c=this._geosToDraw.length;l<c;l++){var A=this._geosToDraw[l];A._isCheck||A.isVisible()?(A._paint(this._displayExtent),this._geosToDraw[l]._cPoint=void 0,this._geosToDraw[l]._inCurrentView=void 0):(delete A._cPoint,delete A._inCurrentView)}this.clearImageData(),this._lastGeosToDraw=this._geosToDraw,xm(this.layer)&&console.log("progressiveRender on drawOnInteracting page:",this.page)}},i.show=function(...n){this.layer.forEach((function(e){e._repaint()})),e.prototype.show.apply(this,n)},i.forEachGeo=function(e,n){this.layer.forEach(e,n)},i._checkGeos=function(){for(var e=this._getCurrentNeedRenderGeos(),n=0,i=e.length;n<i;n++)this.checkGeo(e[n]);return this},i.drawGeos=function(){this._drawSnapshot(),this._updateMapStateCache(),this._drawnRes=this.mapStateCache.resolution,this._updateDisplayExtent(),this.prepareToDraw(),this._batchConversionMarkers(this.mapStateCache.glRes),this._onlyHasPoint||this._checkGeos(),this._sortByDistanceToCamera(this.getMap().cameraPosition),this._collidesGeos();for(var e=0,n=this._geosToDraw.length;e<n;e++)this._geosToDraw[e]._paint(),this._geosToDraw[e]._cPoint=void 0,this._geosToDraw[e]._inCurrentView=void 0;this.clearImageData(),this._lastGeosToDraw=this._geosToDraw,xm(this.layer)&&console.log("progressiveRender drawGeos page:",this.page),this._snapshot(),this._setDrawGeosDrawTime()},i.prepareToDraw=function(){return this.layer._drawTime=s(),this._hasPoint=!1,this._geosToDraw=[],this},i._setDrawGeosDrawTime=function(){for(var e=s(),n=this.layer._drawTime,i=this.getGeoPainterList(),o=0,a=i.length;o<a;o++){var h=i[o];h&&h._setDrawTime&&h._setDrawTime(n)}return xm(this.layer)&&console.log("_setDrawGeosDrawTime time:",s()-e+"ms"),this},i.checkGeo=function(e){if(e.isPoint&&void 0!==this._onlyHasPoint)(e._inCurrentView||e.hasAltitude())&&(this._hasPoint=!0,e._isCheck=!0,this._geosToDraw.push(e));else if(e._isCheck=!1,e&&e.isVisible()&&e.getMap()&&e.getLayer()&&e.getLayer().isCanvasRender()){var n=e._getPainter(),i=!0;if(e._inCurrentView||!h(e.options.arcDegree)||e.hasAltitude())i=!0;else if(!1===e._inCurrentView)i=!1;else{var o=n.get2DExtent(this.resources,mm);o&&o.intersects(this._displayExtent)||(i=!1)}i&&(n.hasPoint()&&(this._hasPoint=!0),e._isCheck=!0,this._geosToDraw.push(e))}},i._collidesGeos=function(){var e=this._geosToDraw;if(!this.layer.options.collision){for(var n=0,i=e.length;n<i;n++){var o=e[n];o.isPoint&&(o._collided=!1)}return this}var s=this.layer.options.collisionScope,a=this.layer.getCollisionIndex();"layer"===s&&a.clear(),this._geosToDraw=[];for(var h=0,l=e.length;h<l;h++){var c=e[h];c.isPoint&&(c._collided=!1,this._geoIsCollision(c,a))?c._collided=!0:this._geosToDraw.push(e[h])}return this},i.onZoomEnd=function(...n){delete this.canvasExtent2D,e.prototype.onZoomEnd.apply(this,n)},i.onRemove=function(){this.forEachGeo((function(e){e.onHide()})),delete this._geosToDraw,delete this.snapshotCanvas,delete this.pageGeos,delete this.geoPainterList},i.onGeometryPropertiesChange=function(n){n&&this.layer._styleGeometry(n.target),e.prototype.onGeometryPropertiesChange.call(this,n)},i._updateDisplayExtent=function(){var e=this.canvasExtent2D;if(this._maskExtent){if(!this._maskExtent.intersects(e))return void this.completeRender();e=e.intersection(this._maskExtent)}this._displayExtent=e},i.identifyAtPoint=function(e,n={}){var i=this.getGeosForIdentify();return i?this.layer._hitGeos(i,e,n):[]},i._updateMapStateCache=function(){var e=this.getMap(),n=e._pointToContainerPoint(this.middleWest)._add(0,-e.height/2),i=e.getResolution(),o=e.getPitch(),s=e.getBearing(),a=e.getGLScale(),h=e.getGLRes(),l=e.getContainerExtent(),c=e.get2DExtent(),A=e.get2DExtentAtRes(h);return this.mapStateCache={resolution:i,pitch:o,bearing:s,glScale:a,glRes:h,_2DExtent:c,glExtent:A,containerExtent:l,offset:n},this},i._batchConversionMarkers=function(e){if(this._onlyHasPoint=void 0,!this._constructorIsThis())return[];var n=[],i=[],o=[],s={},a=this.layer,h=a.options,l=a.getAltitude?a.getAltitude():0,c=a.isCanvasRender();this._onlyHasPoint=!0;for(var A=0,f=this._getCurrentNeedRenderGeos(),d=0,p=f.length;d<p;d++){var g=f[d];if(g.isPoint){var v=g._painter;v||(v=g._getPainter());var w=v.getRenderPoints("center")[0][0],C=h.enableAltitude?g._getAltitude():l;void 0===s[C]&&(s[C]=v.getAltitude()),n[A]=w,o[A]=s[C],i[A]=g,A++}else this._onlyHasPoint=!1}if(0===A)return[];var P=this.getMap(),T=on(n,"_pt");T=P._pointsAtResToContainerPoints(n,e,o,T);for(var S=P.getContainerExtent(),{xmax:I,ymax:E,xmin:O,ymin:k}=S,L={},F=0,N=i.length;F<N;F++){var z=i[F];if(z._cPoint=T[F],z._cPoint){var{x:H,y:j}=T[F];if(z._inCurrentView=H>=O&&j>=k&&H<=I&&j<=E||z.hasAltitude(),!z._inCurrentView){var W=z.getSymbolHash(),q=void 0;q=W?L[W]=L[W]||z._painter.getFixedExtent():z._painter.getFixedExtent(),vm.set(q.xmin,q.ymin,q.xmax,q.ymax),vm._add(T[F]),z._inCurrentView=vm.intersects(S)}z._inCurrentView&&(z.isVisible()&&c||(z._inCurrentView=!1),this._onlyHasPoint&&z._inCurrentView&&(this._hasPoint=!0,z._isCheck=!0,this._geosToDraw.push(z)))}else z._inCurrentView=!1}return T},i._sortByDistanceToCamera=function(e){if(this.layer.options.sortByDistanceToCamera&&this._geosToDraw.length){var n=this.getMap(),i=n.distanceToPoint(1e3,0,n.getGLScale()).x/1e3,o="center";this._geosToDraw.sort((function(n,s){if(!n.isPoint||!s.isPoint)return 0;var a=n._painter,h=s._painter;if(!a||!h)return 0;var l=a.getRenderPoints(o)[0][0],c=h.getRenderPoints(o)[0][0],A=a.getAltitude()*i,f=h.getAltitude()*i;Cs(ym,l.x,l.y,A);var d=ks(ym,e);return Cs(ym,c.x,c.y,f),ks(ym,e)-d}))}},i._constructorIsThis=function(){return this.constructor===n},i.isProgressiveRender=function(){var e=this.layer;if(!e)return!1;var{progressiveRender:n,collision:i}=e.options||{};return!i&&n},i.getGeosForIdentify=function(){return this.isProgressiveRender()?this.pageGeos||[]:this._geosToDraw||[]},i.getGeoPainterList=function(){if(!this.isProgressiveRender()){for(var e=[],n=this._geosToDraw||[],i=0,o=n.length;i<o;i++)e.push(n[i]._painter);return e}return this.geoPainterList||[]},i._checkSnapshotCanvas=function(){if(!this.isProgressiveRender())return delete this.snapshotCanvas,null;var e=this.canvas;if(!e)return delete this.snapshotCanvas,null;this.snapshotCanvas||(this.snapshotCanvas=_h.createCanvas(1,1));var n=this.snapshotCanvas,{width:i,height:o,style:s}=e;return n.width===i&&n.height===o||(n.width=i,n.height=o),n.style.width===s.width&&n.style.height===s.height||(n.style.width=s.width,n.style.height=s.height),n},i._getCurrentNeedRenderGeos=function(){var e=this.layer._geoList||[];if(!this.isProgressiveRender())return e;var n=this.layer,{progressiveRenderCount:i}=n.options,o=this.page;return e.slice((o-1)*i,o*i)},i._resetProgressiveRender=function(){xm(this.layer)&&console.log("progressiveRender resetProgressiveRender"),this.renderEnd=!1,this.page=1,this.pageGeos=[],this.geoPainterList=[],this.maxTolerance=0,this._clearSnapshotCanvas()},i._clearSnapshotCanvas=function(){var e=this._checkSnapshotCanvas();e&&_m(e)},i._snapshot=function(){for(var e=this.isProgressiveRender(),n=this._geosToDraw||[],i=0,o=n.length;i<o;i++){var a=n[i],h=a._hitTestTolerance()||0;if(this.maxTolerance=Math.max(this.maxTolerance,h),e)this.pageGeos.push(a),this.geoPainterList.push(a._painter)}if(!e)return this;var l=s(),c=this._checkSnapshotCanvas();c&&this.canvas&&_m(c).drawImage(this.canvas,0,0);var A=this.layer,{progressiveRenderCount:f}=A.options,d=Math.ceil((A._geoList||[]).length/f);return this.renderEnd=this.page>=d,this.renderEnd&&this._setDrawGeosDrawTime(),xm(this.layer)&&console.log("snapshot time:",s()-l+"ms"),this.renderEnd||this.page++,this},i._drawSnapshot=function(){if(!this.isProgressiveRender())return this;var{snapshotCanvas:e,context:n}=this;if(!e||!n)return this;var i=this.getMap();if(!i)return this;var o=i.getDevicePixelRatio()||1;return this._canvasContextScale(n,1/o),n.drawImage(e,0,0),this._canvasContextScale(n,o),this},n}(pm);ad.registerRenderer("canvas",bm);var wm=function(e){function n(n){var i;return(i=e.call(this)||this).map=n,i._handlerQueue=[],i._thisDocVisibilitychange=i._onDocVisibilitychange.bind(i),i._thisDocDragStart=i._onDocDragStart.bind(i),i._thisDocDragEnd=i._onDocDragEnd.bind(i),i._thisDocDPRChange=i._onDocDPRChange.bind(i),i}kt(n,e);var i=n.prototype;return i.callInNextFrame=function(e){this._handlerQueue.push(e)},i.executeFrameCallbacks=function(){var e=this._handlerQueue;this._handlerQueue=[];for(var n=0,i=e.length;n<i;n++)e[n]()},i.offsetPlatform=function(e,n){if(!this.map.getPanels().front)return this;if(!n&&0===e.x&&0===e.y)return this;var i=this.map.getPanels(),o=this._frontCount=i.back.layerDOM.childElementCount,s=this._backCount=i.front.layerDOM.childElementCount,a=this._uiCount=i.front.uiDOM.childElementCount;if(o||s||a){var h=this.map.offsetPlatform();h=e?h.add(e)._round():h.round(),s&&Fi(i.back,h),(o||a)&&Fi(i.front,h)}return this},i.domChanged=function(){var e=this.map.getPanels();return!!e.front&&(void 0===this._frontCount||this._frontCount!==e.back.layerDOM.childElementCount||(void 0===this._backCount||this._backCount!==e.front.layerDOM.childElementCount||(void 0===this._uiCount||this._uiCount!==e.front.uiDOM.childElementCount)))},i.resetContainer=function(){if(this.map&&(this.map._resetMapViewPoint(),this.map.getPanels().front)){var e=new ee(0,0);Fi(this.map.getPanels().back,e),Fi(this.map.getPanels().front,e)}},i.onZoomEnd=function(){this.resetContainer()},i.onLoad=function(){this._frameLoop()},i._onDocVisibilitychange=function(){"visible"===document.visibilityState&&this.setToRedraw()},i._getWrapPanel=function(){if(!this.map)return null;var e=this.map.getPanels();return e&&e.mapWrapper},i._onDocDragStart=function(){var e=this._getWrapPanel();e&&(e.style.overflow="visible")},i._onDocDragEnd=function(){var e=this._getWrapPanel();e&&(e.style.overflow="hidden")},i._onDocDPRChange=function(){var e=this.map;e&&e.options&&!e.options.devicePixelRatio&&e.checkSize&&e.getRenderer&&(e.getRenderer()&&e.checkSize(!0))},i._containerIsOffscreen=function(){var e=this.map.getContainer();return!e||!e.style||"none"===e.style.display||Math.min(e.clientWidth,e.clientHeight)<=0},n}(Ih),Cm=new eh,Pm=function(e){function i(n){var i;return(i=e.call(this,n)||this)._containerIsCanvas=!!n.getContainer().getContext,i._registerEvents(),i._loopTime=0,i._resizeEventList=[],i._resizeTime=-1/0,i._frameCycleRenderCount=0,i}kt(i,e);var s=i.prototype;return s.load=function(){this.initContainer()},s.renderFrame=function(e){var n=this.map;if(!n||!n.options.renderable)return!1;if(this._handleResizeEventList(e),n.options.stopRenderOnOffscreen&&this._containerIsOffscreen())return!0;this._updateDomPosition(e),delete this._isViewChanged,n._fireEvent("framestart"),this.updateMapDOM(),n.clearCollisionIndex();var i=this._getAllLayerToRender();return this.drawLayers(i,e),this.drawLayerCanvas(i)&&(this.drawTops(),this._drawCenterCross(),n.options.debugSky&&this._debugSky()),this._needClear=!1,n._fireEvent("frameend"),this._recordView(),this._mapview=this._getMapView(),delete this._spatialRefChanged,this._fireLayerLoadEvents(),this.executeFrameCallbacks(),this._canvasUpdated=!1,n.uiCollides(),!0},s.getFrameTimestamp=function(){return this._frameTimestamp||0},s.updateMapDOM=function(){var e=this.map;if(!e.isZooming()){var n=e.getViewPointFrameOffset();n?e.offsetPlatform(n):this.domChanged()&&this.offsetPlatform(null,!0)}},s._needRedrawAllLayers=function(e){var n=this;if(this.isSpatialReferenceChanged())return!0;var i=[];e.forEach((function(e){if(e&&(e._toRedraw=n._checkLayerRedraw(e))){i.push(e);var o=e.getLayers&&e.getLayers();o&&Array.isArray(o)&&he(i,o)}}));for(var o=0,s=i.length;o<s;o++){var a=i[o],h=a&&a.options;if(h&&h.collision&&"map"===h.collisionScope)return!0}return!1},s.drawLayers=function(e,n){for(var i=this._needRedrawAllLayers(e),o=this.map,s=o.isInteracting(),a=[],h=[],l=o.options.fpsOnInteracting||0,c=0===l?0:1e3/l,A=this.map.options.layerCanvasLimitOnInteracting,f=e.length,d=o.getBaseLayer(),p=0,g=0;g<f;g++){var v=e[g];if(v.isVisible()){var w=v.isCanvasRender();w&&a.push(v.getId());var C=v._getRenderer();if(C){var P=i||v._toRedraw;w&&C.isCanvasUpdated()&&(P||h.push(v.getId()),this.setLayerCanvasUpdated());var T=C.__zoomTransformMatrix;if(delete C.__zoomTransformMatrix,P){if(s&&w){if(A>0&&f-1-g>A&&v!==d){v._getRenderer().clearCanvas();continue}p+=this._drawCanvasLayerOnInteracting(v,p,c,n)}else s&&C.drawOnInteracting?(C.prepareRender&&C.prepareRender(),C.checkAndDraw?C.checkAndDraw(C.drawOnInteracting,this._eventParam,n):C.drawOnInteracting(this._eventParam,n)):(C.render(n),w&&T&&C.isLoadingResource()&&(C.__zoomTransformMatrix=T));w&&(h.push(v.getId()),this.setLayerCanvasUpdated())}else w&&s&&(o.isZooming()&&!o.getPitch()?(C.prepareRender(),C.__zoomTransformMatrix=this._zoomMatrix):(o.getPitch()||o.isRotating())&&C.clearCanvas())}}}var S=this._canvasIds||[],I=this._updatedIds||[];if(this._canvasIds=a,this._updatedIds=h,!this.isLayerCanvasUpdated()){var E="---";S.join(E)===a.join(E)&&I.join(E)===h.join(E)||this.setLayerCanvasUpdated()}},s._checkLayerRedraw=function(e){if(this.isSpatialReferenceChanged())return!0;var n=this.map,i=e._getRenderer();return!!i&&(e.isCanvasRender()?i.testIfNeedRedraw():!(!i.needToRedraw||!i.needToRedraw())||(n.isInteracting()||this.isViewChanged()))},s._drawCanvasLayerOnInteracting=function(e,n,i,o){var s=this.map,a=e._getRenderer(),h=a.getDrawTime(),l=0===i||i>0&&n+h<=i;if(a.mustRenderOnInteracting&&a.mustRenderOnInteracting())a.render(o);else{if(a.drawOnInteracting&&(e===s.getBaseLayer()||l||s.isZooming()&&e.options.forceRenderOnZooming||s.isMoving()&&e.options.forceRenderOnMoving||s.isRotating()&&e.options.forceRenderOnRotating))return a.prepareRender(),a.prepareCanvas(),a.checkAndDraw?a.checkAndDraw(a.drawOnInteracting,this._eventParam,o):a.drawOnInteracting(this._eventParam,o),h;!s.isZooming()||s.getPitch()||s.isRotating()?(s.getPitch()||s.isRotating())&&a.clearCanvas():(a.prepareRender(),a.__zoomTransformMatrix=this._zoomMatrix)}return a.drawOnInteracting&&!l&&a.onSkipDrawOnInteracting(this._eventParam,o),0},s._fireLayerLoadEvents=function(){if(this._updatedIds&&this._updatedIds.length>0){var e=this.map;this._updatedIds.reverse().forEach((function(n){var i=e.getLayer(n);if(i){var o=i._getRenderer();o&&o.isRenderComplete()&&i.fire("layerload")}}))}},s.isLayerCanvasUpdated=function(){return this._canvasUpdated},s.setLayerCanvasUpdated=function(){this._canvasUpdated=!0},s.drawLayerCanvas=function(e){var n=this.map;if(!n)return!1;if(!this.isLayerCanvasUpdated()&&!this.isViewChanged()&&!1===this._needClear)return!1;this.canvas||this.createCanvas(),n._fireEvent("renderstart",{context:this.context}),this._updateCanvasSize()||this.clearCanvas();for(var i,o=n.isInteracting(),s=n.options.layerCanvasLimitOnInteracting,a=e.length,h=[],l=0;l<a;l++){if(e[l].isVisible()&&e[l].isCanvasRender())if(e[l]._getRenderer()){var c=this._getLayerImage(e[l]);c&&c.image&&(e[l]===n.getBaseLayer()?i=[e[l],c]:h.push([e[l],c]))}}var A=this.canvas.width,f=this.canvas.height;i&&(this._drawLayerCanvasImage(i[0],i[1],A,f),this._drawFog()),a=h.length;for(var d=o&&s>=0&&a>s?a-s:0;d<a;d++)this._drawLayerCanvasImage(h[d][0],h[d][1],A,f);return n._fireEvent("renderend",{context:this.context}),!0},s.setToRedraw=function(){var e=this._getAllLayerToRender();this._needClear=!0;for(var n=0,i=e.length;n<i;n++){var o=e[n].getRenderer();o&&o.canvas&&o.setToRedraw&&o.setToRedraw()}},s.updateMapSize=function(e){if(e&&!this._containerIsCanvas){var n=e.width+"px",i=e.height+"px",o=this.map.getPanels();o.mapWrapper.style.width=n,o.mapWrapper.style.height=i,this._updateCanvasSize()}},s.getMainPanel=function(){return this.map?this._containerIsCanvas?this.map.getContainer():this.map.getPanels()?this.map.getPanels().mapWrapper:null:null},s.toDataURL=function(e,n){return this.canvas?this.canvas.toDataURL(e,n):null},s.remove=function(){wt.webgl&&"undefined"!=typeof document&&(Oh.off(Rh,this._thisDocDPRChange,this),Oh.off(Dh,this._thisDocVisibilitychange,this),Oh.off(kh,this._thisDocDragStart,this),Oh.off(Lh,this._thisDocDragEnd,this)),this._resizeInterval&&clearInterval(this._resizeInterval),this._resizeObserver&&this._resizeObserver.disconnect(),delete this.context,delete this.canvas,delete this.map,delete this._spatialRefChanged,this._cancelFrameLoop()},s.hitDetect=function(e){var n=this.map;if(n&&n.options.hitDetect&&!n.isInteracting()){var i=n._getLayers(),o="default",s=n.options.hitDetectLimit||0,a=0;e&&e._round&&e._round();for(var h=i.length-1;h>=0;h--){var l=i[h];if(!(!l.options.hitDetect||l.isEmpty&&l.isEmpty())&&l.options.geometryEvents){var c=l._getRenderer();if(c&&c.hitDetect&&(!c.isBlank||!c.isBlank())){if("default"!==l.options.cursor&&c.hitDetect(e)){o=l.options.cursor||"pointer";break}if(a++,s>0&&a>s)break}}}n._trySetCursor(o)}},s._getLayerImage=function(e){var n=e._getRenderer();return n.getCanvasImage?n.getCanvasImage():null},s.initContainer=function(){var e=this.map.getPanels();function n(n,i,o,s){var a=Pi("div",i);return o&&(a.style.cssText=o),e[n]=a,s||Li(a),a}var i=this.map.getContainer();if(!this._containerIsCanvas){i.innerHTML="";var o="position:absolute;top:0px;left:0px;",s=n("mapWrapper","maptalks-wrapper","position:absolute;overflow:hidden;",!0),a=n("allLayers","maptalks-all-layers",o+"padding:0px;margin:0px;z-index:0;overflow:visible;",!0),h=n("backStatic","maptalks-back-static",o+"z-index:0;",!0),l=n("back","maptalks-back",o+"z-index:1;"),c=n("backLayer","maptalks-back-layer",o),A=n("canvasContainer","maptalks-canvas-layer",o+"border:none;z-index:2;"),f=n("frontStatic","maptalks-front-static",o+"z-index:3;",!0),d=n("front","maptalks-front",o+"z-index:4;",!0),p=n("frontLayer","maptalks-front-layer",o+"z-index:0;"),g=n("ui","maptalks-ui",o+"border:none;z-index:1;",!0),v=n("control","maptalks-control","z-index:1",!0);i.appendChild(s),a.appendChild(h),l.appendChild(c),l.layerDOM=c,a.appendChild(l),a.appendChild(A),d.appendChild(p),d.layerDOM=p,d.uiDOM=g,a.appendChild(f),a.appendChild(d),d.appendChild(g),s.appendChild(a),s.appendChild(v),this.createCanvas(),this.resetContainer();var w=this.map._getContainerDomSize();this.updateMapSize(w)}},s.isViewChanged=function(){if(void 0!==this._isViewChanged)return this._isViewChanged;var e=this._mapview,n=this._getMapView();return this._isViewChanged=!e||!$e(e,n),this._isViewChanged},s._recordView=function(){var e=this.map;!e._onViewChange||e.isInteracting()||e.isAnimating()||$e(e.getView(),e._getCurrentView())||e._onViewChange(e.getView())},s.isSpatialReferenceChanged=function(){return this._spatialRefChanged},s._getMapView=function(){var e=this.map,n=e._getPrjCenter();return{x:n.x,y:n.y,zoom:e.getZoom(),pitch:e.getPitch(),bearing:e.getBearing(),width:e.width,height:e.height}},s._lockFrameRenderEnable=function(){var{maxFPS:e}=this.map.options||{};if(e<=0||o.maxFPS<=e)return!0;var n=Math.ceil(o.maxFPS/e);return this._frameCycleRenderCount>=n},s._frameLoop=function(e){var n=this;this.map?(this._frameCycleRenderCount++,this._lockFrameRenderEnable()?(this._frameTimestamp=e=e||0,this._resizeCount=0,this.renderFrame(e),this._frameCycleRenderCount=0):this.map.options.debug&&console.log("skip frame ing,frameCycleRenderCount:",this._frameCycleRenderCount),this._animationFrame=Kt((function(e){n._frameLoop(e)}))):this._cancelFrameLoop()},s._cancelFrameLoop=function(){this._animationFrame&&$t(this._animationFrame)},s._drawLayerCanvasImage=function(e,n,i,o){var s=this.context,a=n.point.round(),h=this.map.getDevicePixelRatio();1!==h&&a._multi(h);var c=n.image,A=c.width,f=c.height;if(!(a.x+A<=0||a.y+f<=0)){var d=e.options.opacity;if(l(d)||(d=1),!(d<=0)){var p=n.opacity;if(l(p)||(p=1),!(p<=0)){var g=s.globalAlpha;d<1&&(s.globalAlpha*=d),p<1&&(s.globalAlpha*=p),e.options.cssFilter&&(s.filter=e.options.cssFilter);var v=e.getRenderer(),w=v.__zoomTransformMatrix,C=v.clipCanvas(this.context);w&&(s.save(),s.setTransform(...w)),s.drawImage(c,0,0,A,f,a.x,a.y,i,o),w&&s.restore(),C&&s.restore(),"none"!==s.filter&&(s.filter="none"),s.globalAlpha=g}}}},s._drawCenterCross=function(){var e=this.map.options.centerCross;if(e){var n=this.context,i=new ee(this.canvas.width/2,this.canvas.height/2);d(e)?e(n,i):_h.drawCross(this.context,i.x,i.y,2,"#f00")}},s._drawContainerExtent=function(){var{cascadePitches:e}=this.map.options,n=this.map.height-this.map._getVisualHeight(e[0]),i=this.map.height-this.map._getVisualHeight(e[1]),o=this.map.getContainerExtent(),s=this.context;s.beginPath(),s.moveTo(0,o.ymin),s.lineTo(o.xmax,o.ymin),s.stroke(),s.beginPath(),s.moveTo(0,n),s.lineTo(o.xmax,n),s.stroke(),s.beginPath(),s.moveTo(0,i),s.lineTo(o.xmax,i),s.stroke()},s._drawFog=function(){var e=this.map;if(!(e.getPitch()<=e.options.maxVisualPitch)&&e.options.fog){var n=e.getDevicePixelRatio(),i=this.context,o=e.getContainerExtent(),s=(e.height-e._getVisualHeight(75))*n;s<0&&(s=0);var a=o.ymin*n,h=Math.ceil(a-s),l=e.options.fogColor.join(),c=i.createLinearGradient(0,s,0,a+30),A=1-30/(h+30);c.addColorStop(0,"rgba("+l+", 0)"),c.addColorStop(.3,"rgba("+l+", 0.3)"),c.addColorStop(A,"rgba("+l+", 1)"),c.addColorStop(1,"rgba("+l+", 0)"),i.beginPath(),i.fillStyle=c,i.fillRect(0,s,Math.ceil(o.getWidth())*n,Math.ceil(h+30))}},s._debugSky=function(){var e=this.map;if(!e)return this;var n=e.getContainerExtent().ymin;if(n<=0)return this;var i=this.context;return i.strokeStyle="red",i.strokeRect(0,0,e.width,n),this},s._getAllLayerToRender=function(){return this.map._getLayers()},s.clearCanvas=function(){this.canvas&&_h.clearRect(this.context,0,0,this.canvas.width,this.canvas.height)},s._updateCanvasSize=function(){if(!this.canvas||this._containerIsCanvas)return!1;var e=this.map,n=e.getSize(),i=this.canvas,o=e.getDevicePixelRatio(),{width:s,height:a,cssWidth:h,cssHeight:l}=cn(n,o);return!i.style||i.style.width===h&&i.style.height===l||(i.style.width=h,i.style.height=l),(s!==i.width||a!==i.height)&&(i.height=a,i.width=s,this.topLayer.width=i.width,this.topLayer.height=i.height,!0)},s.createCanvas=function(){this.topLayer=Pi("canvas"),this.topCtx=this.topLayer.getContext("2d"),this._containerIsCanvas?this.canvas=this.map.getContainer():(this.canvas=Pi("canvas"),this._updateCanvasSize(),this.map.getPanels().canvasContainer.appendChild(this.canvas)),this.context=this.canvas.getContext("2d")},s._updateDomPosition=function(e){return void 0===this._checkPositionTime&&(this._checkPositionTime=-1/0),Math.abs(e-this._checkPositionTime)>=500&&(zi(this.map.getContainer()),this._checkPositionTime=Math.min(e,this._checkPositionTime)),this},s._handleResizeEventList=function(e){if(!this._resizeEventList)return this;var n=this._resizeEventList.length;return 0===n||this._resizeTime&&e-this._resizeTime<60||(this.map.setContainerDomRect(this._resizeEventList[n-1].contentRect),this._resizeEventList=[],this._checkSize(),this._resizeCount=this._resizeCount||0,this.renderFrame((this._frameTimestamp||0)+ ++this._resizeCount/100),this._resizeTime=e),this},s._checkSize=function(){this.map&&this.map.checkSize()},s._setCheckSizeInterval=function(e){var n=this;wt.resizeObserver?(this._resizeObserver&&this._resizeObserver.disconnect(),this.map&&(this._resizeObserver=new ResizeObserver((function(e){!n.map||n.map.isRemoved()?n._resizeObserver.disconnect():e.length&&(n._resizeEventList=n._resizeEventList||[],n._resizeEventList.push(e[0]))})),this._resizeObserver.observe(this.map.getContainer()))):(clearInterval(this._resizeInterval),this._checkSizeInterval=e,this._resizeInterval=setInterval((function(){!n.map||n.map.isRemoved()?clearInterval(n._resizeInterval):n._checkSize()}),this._checkSizeInterval))},s._registerEvents=function(){var e=this,i=this.map;i.options.checkSize&&!n&&"undefined"!=typeof window&&this._setCheckSizeInterval(i.options.checkSizeInterval),wt.mobile||i.on("_mousemove",this._onMapMouseMove,this),i.on("_dragrotatestart _dragrotating _dragrotateend _movestart _moving _moveend _zoomstart",(function(n){e._eventParam=n})),i.on("_zooming",(function(n){i.getPitch()||(e._zoomMatrix=n.matrix.container),e._eventParam=n})),i.on("_zoomend",(function(n){e._eventParam=n,delete e._zoomMatrix})),i.on("_spatialreferencechange",(function(){e._spatialRefChanged=!0})),wt.webgl&&"undefined"!=typeof document&&(Oh.on(Rh,this._thisDocDPRChange,this),Oh.on(Dh,this._thisDocVisibilitychange,this),Oh.on(kh,this._thisDocDragStart,this),Oh.on(Lh,this._thisDocDragEnd,this))},s._onMapMouseMove=function(e){var n=this,i=this.map;!i.isInteracting()&&i.options.hitDetect&&(this._hitDetectFrame&&$t(this._hitDetectFrame),this._hitDetectFrame=Kt((function(){n.hitDetect(e.containerPoint)})))},s._getCanvasLayers=function(){return this.map._getLayers((function(e){return e.isCanvasRender()}))},s.addTopElement=function(e){this._tops||(this._tops=[]),this._tops.push(e)},s.removeTopElement=function(e){if(this._tops){var n=this._tops.indexOf(e);n>=0&&this._tops.splice(n,1)}},s.getTopElements=function(){return this._tops||[]},s.sortTopElements=function(){this._tops=this._tops.sort((function(e,n){return(n.options.zIndex||0)-(e.options.zIndex||0)}))},s.drawTops=function(){this.topCtx.clearRect(0,0,this.topLayer.width,this.topLayer.height);var e=Cm;e.clear(),this.map.fire("drawtopstart"),this.map.fire("drawtops");for(var n=this.getTopElements(),i=!1,o=this.map.getDevicePixelRatio(),s=[],a=0;a<n.length;a++){var h=n[a];if(h.needCollision&&h.needCollision()){var l=h.getRenderBBOX(o);if(l){if(e.collides(l)){var c=h.target&&h.target._geometry;c&&-1===s.indexOf(c)&&(s.push(c),c.fire("handlecollision"));continue}e.insertBox(l)}}h.render(this.topCtx)&&(i=!0)}i&&this.context.drawImage(this.topLayer,0,0),this.map.fire("drawtopsend")},i}(wm);BA.registerRenderer("canvas",Pm),BA.mergeOptions({fog:!1,fogColor:[233,233,233]});var Mm=Object.freeze({__proto__:null,CanvasLayerRenderer:Sg,CanvasRenderer:mu,CanvasTileLayerCanvasRenderer:um,CanvasTileLayerGLRenderer:cm,ImageGLRenderable:yg,ImageLayerCanvasRenderer:Mg,ImageLayerGLRenderer:Tg,MapCanvasRenderer:Pm,MapRenderer:wm,OverlayLayerCanvasRenderer:pm,QuadStencil:fm,Renderable:au,ResourceCache:yu,TileLayerCanvasRenderer:im,TileLayerGLRenderer:hm,VectorLayerCanvasRenderer:bm}),Tm={_getRenderPoints:function(){return[[this._getCenter2DPoint(this.getMap().getGLRes())],null]}};pf.include(Tm),Lf.include(Tm),Df.include(Tm),Nf.include(Tm),Ff.include({_getRenderPoints:function(e){var n=this.getMap(),i=n.getGLRes();if("vertex"===e){for(var o=this._trimRing(this.getShell()),s=[],a=0,h=o.length;a<h;a++)s.push(n.coordToPointAtRes(o[a],i));return[s,null]}return[[n.coordToPointAtRes(this.getCenter(),i)],null]}});var Sm={_getRenderPoints:function(e){var n,i=this.getMap(),o=i.getGLRes(),s=null;if("point"===e)(n=this._getPath2DPoints(this._getPrjCoordinates(),!1,o))&&n.length>0&&Array.isArray(n[0])&&(n=n[0].concat(n[1]));else if("vertex"===e)if(s=[],(n=this._getPath2DPoints(this._getPrjCoordinates(),!1,o))&&n.length>0&&Array.isArray(n[0])){for(var a=0,h=n.length;a<h;a++)for(var l=0,c=n[a].length;l<c;l++)s.push(0===l?[n[a][l],n[a][l+1]]:[n[a][l-1],n[a][l]]);n=n[0].concat(n[1])}else for(var A=0,f=n.length;A<f;A++)s.push(0===A?[n[A],n[A+1]]:[n[A-1],n[A]]);else if("line"===e){n=[],s=[];var d=this._getPath2DPoints(this._getPrjCoordinates(),!1,o);if(d.length>0&&Array.isArray(d[0]))for(var p,g=1,v=d.length;g<v;g++){p=d[g],this instanceof Af&&p.length>0&&!p[0].equals(p[p.length-1])&&p.push(p[0]);for(var w=1,C=p.length;w<C;w++)n.push(p[w].add(p[w-1])._multi(.5)),s.push([p[w-1],p[w]])}else{this instanceof Af&&d.length>0&&!d[0].equals(d[d.length-1])&&d.push(d[0]);for(var P=1,T=d.length;P<T;P++)n.push(d[P].add(d[P-1])._multi(.5)),s.push([d[P-1],d[P]])}}else if("vertex-first"===e){var S=this._getPrjCoordinates(),I=S.length,E=I?i._prjToPointAtRes(S[0],o):null;n=I?[E]:[],s=I?[[E,S[1]?i._prjToPointAtRes(S[1],o):E]]:[]}else if("vertex-last"===e){var O=this._getPrjCoordinates(),k=O.length,L=k?i._prjToPointAtRes(O[k-1],o):null;n=k?[L]:[];var F=k>1?k-2:k-1;s=k?[[O[F]?i._prjToPointAtRes(O[F],o):L,L]]:[]}else{var N=this.getCenter();if(N){var z=this._getProjection().project(N);n=[i._prjToPointAtRes(z,o)]}else n=[]}return[n,s]}};mf.include(Sm),Af.include(Sm);var Im={within:!1,center:[0,0]};function Em(e){if(e&&e._containerBbox){Im.within=!1;var{minx:n,miny:i,maxx:o,maxy:s}=e._containerBbox,a=Math.abs(o-n),h=Math.abs(s-i);a<=1&&h<=1&&(Im.within=!0,Im.center[0]=(n+o)/2,Im.center[1]=(i+s)/2),delete e._containerBbox}else Im.within=!1;return Im}function Om(){var e=this._getPrjShell(),n=cs();ps(e,n);var[i,o,s,a]=n;return new al(i,o,s,a)}function Rm(){var e=this._getPrjShell();if(!e||!Array.isArray(e))return[];var n=this._getProjection(),i=this.getCoordinates()||{};return e.map((function(e){var o=n.unproject(e);return o.z=i.z||0,o}))}_A.include({_redrawWhenPitch:function(){return!1},_redrawWhenRotate:function(){return!1},_getRenderBBOX:function(e,n){return e.isHitTesting?null:(ds(As),ps(n,As),As)}});var Dm={_redrawWhenPitch:function(){return!0},_redrawWhenRotate:function(){return this instanceof Lf||this instanceof Nf},_computeRotatedPrjExtent:Om,getRotatedShell:Rm,_paintAsPath:function(){if(this.isRotated())return!0;var e=this.getMap();return this._getAltitude()>0||e.getPitch()||this instanceof Lf&&e.getBearing()},_getPaintParams:function(){var e=this.getMap();if(this._paintAsPath())return Af.prototype._getPaintParams.call(this,!0);var n=this._getPrjCoordinates(),i=e._prjToPointAtRes(n,e.getGLRes());return[i,...this._getRenderSize(i)]},_paintOn:function(...e){return this._paintAsPath()?_h.polygon(...e):_h.ellipse(...e)},_getRenderSize:function(e){var n=this.getMap(),i=n.getGLRes(),o=this._getPrjExtent(),s=n._prjToPointAtRes(o.getMin(),i),a=n._prjToPointAtRes(o.getMax(),i);return[Math.abs(a.x-s.x)/2,Math.abs(a.y-e.y),Math.abs(e.y-s.y)]}};Lf.include(Dm),Df.include(Dm),Ff.include({_getPaintParams:function(){var e=this.getMap(),n=this._getPrjShell();return[this._getPath2DPoints(n,!1,e.getGLRes())]},_paintOn:_h.polygon,_computeRotatedPrjExtent:Om,getRotatedShell:Rm});var km={_redrawWhenPitch:function(){return!0},_getPaintParams:function(){if(this._paintAsPath())return Af.prototype._getPaintParams.call(this,!0);var e=this.getMap(),n=e._prjToPointAtRes(this._getPrjCoordinates(),e.getGLRes()),i=this._getRenderSize(n),[o,s]=this._correctAngles();return[n,i[0],[o,s]]},_paintOn:function(...e){if(this._paintAsPath())return _h.polygon(...e);var n=this.getMap().getBearing();return n&&(e[3]=e[3].slice(0),e[3][0]+=n,e[3][1]+=n),_h.sector(...e)}};Nf.include(Dm,km),uf.include({_paintAsPath:function(){return!0}});var Lm={arrowStyles:{classic:[3,4]},_getArrowShape:function(e,n,i,o,s){if(!e||!n||e.equals(n))return null;s||(s=0);var a,h=i*o[1]+s,l=i*o[0]/2+s;(a=n.sub(n.nextCtrlPoint||n.prevCtrlPoint?new ee(n.prevCtrlPoint?n.prevCtrlPoint:n.nextCtrlPoint):e))._unit();var c=n.sub(a.multi(h));a._perp();var A=c.add(a.multi(l));return a._multi(-1),[A,n,c.add(a.multi(l)),A]},_getPaintParams:function(){var e=this._getPrjCoordinates();return[this._getPath2DPoints(e,!1,this.getMap().getGLRes())]},_paintOn:function(e,n,i,o,s,a){var h=Em(this._painter);return h.within?_h.pixelRect(e,h.center,i,o):this.options.smoothness?_h.paintSmoothLine(e,n,i,this.options.smoothness,!1,this._animIdx,this._animTailRatio):(e.lineColorIn=a,_h.path(e,n,i,null,s)),this._paintArrow(e,n,i),this._getRenderBBOX(e,n)},_getArrowPlacement:function(){return this.options.arrowPlacement},_getArrowStyle:function(){var e=this.options.arrowStyle;return e?Array.isArray(e)?e:this.arrowStyles[e]:null},_getArrows:function(e,n,i){var o=this,s=this._getArrowStyle();if(!s||e.length<2)return[];for(var a,h,l=e.length>0&&Array.isArray(e[0])?e:[e],c=this._getArrowPlacement(),A=[],f=function(){if(a&&h){var e=o._getArrowShape(a,h,n,s,i);e&&A.push(e)}},d=l.length-1;d>=0;d--){var p=l[d],g=p.length,v=p[0],w=p[g-1];"vertex-first"===c?(a=v.arrowNextPoint||p[1],h=v):"vertex-last"===c&&(a=w.arrowPrePoint||p[g-2],h=w),f(),"vertex-firstlast"===c&&(a=v.arrowNextPoint||p[1],h=v,f(),a=w.arrowPrePoint||p[g-2],h=w,f()),"point"===c&&this._getArrowPoints(A,p,n,s,i)}return A},_getArrowPoints:function(e,n,i,o,s){for(var a=0,h=n.length-1;a<h;a++){var l=n[a+1],c=this._getArrowShape(l.arrowPrePoint||n[a],l,i,o,s);c&&e.push(c)}},_paintArrow:function(e,n,i){var o=this._getInternalSymbol().lineWidth;(!l(o)||o<3)&&(o=3);var s=this._getArrows(n,o);if(s.length){e.setLineDash&&e.setLineDash([]);for(var a=s.length-1;a>=0;a--)e.fillStyle=e.strokeStyle,_h.polygon(e,s[a],i,i)}}};mf.include(Lm);var Fm={_getPaintParams:function(e){var n=this.getMap().getGLRes(),i=this._getPrjShell(),o=this._getPath2DPoints(i,e,n),s=o.length>0&&Array.isArray(o[0]);s&&(o=[[o[0]],[o[1]]]);var a=this._getPrjHoles(),h=[];if(a&&a.length>0){for(var l=this._simplified,c=0;c<a.length;c++){var A=this._getPath2DPoints(a[c],e,n);Array.isArray(A)&&s?Array.isArray(A[0])?(o[0].push(A[0]),o[1].push(A[1])):o[0].push(A):h.push(A)}l&&(this._simplified=l)}return s||he(o=[o],h),[o]},_paintOn:function(e,n,i,o,s,a){var h=Em(this._painter);return h.within?_h.pixelRect(e,h.center,i,o):(e.lineColorIn=a,_h.polygon(e,n,i,o,s,this.options.smoothness)),this._getRenderBBOX(e,n)}};Af.include(Fm),BA.VERSION="1.0.0-rc.40";var Nm={Actor:Au};"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function zm(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Bm={exports:{}};!function(e,n){e.exports=function(){function e(e,n){this.id=Ot++,this.type=e,this.data=n}function n(e){if(0===e.length)return[];var i=e.charAt(0),o=e.charAt(e.length-1);if(1<e.length&&i===o&&('"'===i||"'"===i))return['"'+e.substr(1,e.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(i=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(e))return n(e.substr(0,i.index)).concat(n(i[1])).concat(n(e.substr(i.index+i[0].length)));if(1===(i=e.split(".")).length)return['"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];for(e=[],o=0;o<i.length;++o)e=e.concat(n(i[o]));return e}function i(e){return"["+n(e).join("][")+"]"}function o(n,i){return"function"==typeof n?new e(0,n):"number"==typeof n||"boolean"==typeof n?new e(5,n):Array.isArray(n)?new e(6,n.map((function(e,n){return o(e)}))):n instanceof e?n:void 0}function s(){var e={"":0},n=[""];return{id:function(i){var o=e[i];return o||(o=e[i]=n.length,n.push(i),o)},str:function(e){return n[e]}}}function a(e,n,i){function o(){var n=window.innerWidth,o=window.innerHeight;e!==document.body&&(n=(o=e.getBoundingClientRect()).right-o.left,o=o.bottom-o.top),a.width=i*n,a.height=i*o,Ct(a.style,{width:n+"px",height:o+"px"})}var s,a=document.createElement("canvas");return Ct(a.style,{border:0,margin:0,padding:0,top:0,left:0}),e.appendChild(a),e===document.body&&(a.style.position="absolute",Ct(e.style,{margin:0,padding:0})),e!==document.body&&"function"==typeof ResizeObserver?(s=new ResizeObserver((function(){setTimeout(o)}))).observe(e):window.addEventListener("resize",o,!1),o(),{canvas:a,onDestroy:function(){s?s.disconnect():window.removeEventListener("resize",o),e.removeChild(a)}}}function h(e,n){function i(i){try{return e.getContext(i,n)}catch(e){return null}}return i("webgl")||i("experimental-webgl")||i("webgl-experimental")}function l(e){return"string"==typeof e?e.split():e}function c(e){return"string"==typeof e?document.querySelector(e):e}function A(e){var n,i,o,s,A=e||{};e={};var f=[],d=[],p="undefined"==typeof window?1:window.devicePixelRatio,g=!1,v=function(e){},w=function(){};if("string"==typeof A?n=document.querySelector(A):"object"==typeof A&&("string"==typeof A.nodeName&&"function"==typeof A.appendChild&&"function"==typeof A.getBoundingClientRect?n=A:"function"==typeof A.drawArrays||"function"==typeof A.drawElements?o=(s=A).canvas:("gl"in A?s=A.gl:"canvas"in A?o=c(A.canvas):"container"in A&&(i=c(A.container)),"attributes"in A&&(e=A.attributes),"extensions"in A&&(f=l(A.extensions)),"optionalExtensions"in A&&(d=l(A.optionalExtensions)),"onDone"in A&&(v=A.onDone),"profile"in A&&(g=!!A.profile),"pixelRatio"in A&&(p=+A.pixelRatio))),n&&("canvas"===n.nodeName.toLowerCase()?o=n:i=n),!s){if(!o){if(!(n=a(i||document.body,v,p)))return null;o=n.canvas,w=n.onDestroy}void 0===e.premultipliedAlpha&&(e.premultipliedAlpha=!0),s=h(o,e)}return s?{gl:s,canvas:o,container:i,extensions:f,optionalExtensions:d,pixelRatio:p,profile:g,onDone:v,onDestroy:w}:(w(),v("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function f(e,n){function i(n){var i;n=n.toLowerCase();try{i=o[n]=e.getExtension(n)}catch(e){}return!!i}for(var o={},s=0;s<n.extensions.length;++s){var a=n.extensions[s];if(!i(a))return n.onDestroy(),n.onDone('"'+a+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return n.optionalExtensions.forEach(i),{extensions:o,restore:function(){Object.keys(o).forEach((function(e){if(o[e]&&!i(e))throw Error("(regl): error restoring extension "+e)}))}}}function d(e,n){for(var i=Array(e),o=0;o<e;++o)i[o]=n(o);return i}function p(e){var n,i;return n=(65535<e)<<4,n|=i=(255<(e>>>=n))<<3,(n|=i=(15<(e>>>=i))<<2)|(i=(3<(e>>>=i))<<1)|e>>>i>>1}function g(){function e(e){t:{for(var n=16;268435456>=n;n*=16)if(e<=n){e=n;break t}e=0}return 0<(n=i[p(e)>>2]).length?n.pop():new ArrayBuffer(e)}function n(e){i[p(e.byteLength)>>2].push(e)}var i=d(8,(function(){return[]}));return{alloc:e,free:n,allocType:function(n,i){var o=null;switch(n){case 5120:o=new Int8Array(e(i),0,i);break;case 5121:o=new Uint8Array(e(i),0,i);break;case 5122:o=new Int16Array(e(2*i),0,i);break;case 5123:o=new Uint16Array(e(2*i),0,i);break;case 5124:o=new Int32Array(e(4*i),0,i);break;case 5125:o=new Uint32Array(e(4*i),0,i);break;case 5126:o=new Float32Array(e(4*i),0,i);break;default:return null}return o.length!==i?o.subarray(0,i):o},freeType:function(e){n(e.buffer)}}}function v(e){return!!e&&"object"==typeof e&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"==typeof e.offset&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||Ut(e.data))}function w(e,n,i,o,s,a){for(var h=0;h<n;++h)for(var l=e[h],c=0;c<i;++c)for(var A=l[c],f=0;f<o;++f)s[a++]=A[f]}function C(e,n,i,o,s){for(var a=1,h=i+1;h<n.length;++h)a*=n[h];var l=n[i];if(4==n.length-i){var c=n[i+1],A=n[i+2];for(n=n[i+3],h=0;h<l;++h)w(e[h],c,A,n,o,s),s+=a}else for(h=0;h<l;++h)C(e[h],n,i+1,o,s),s+=a}function P(e){return 0|Kt[Object.prototype.toString.call(e)]}function T(e,n){for(var i=0;i<n.length;++i)e[i]=n[i]}function S(e,n,i,o,s,a,h){for(var l=0,c=0;c<i;++c)for(var A=0;A<o;++A)e[l++]=n[s*c+a*A+h]}function I(e,n,i,o){function s(n){this.id=c++,this.buffer=e.createBuffer(),this.type=n,this.usage=35044,this.byteLength=0,this.dimension=1,this.dtype=5121,this.persistentData=null,i.profile&&(this.stats={size:0})}function a(n,i,o){n.byteLength=i.byteLength,e.bufferData(n.type,i,o)}function h(e,n,i,o,s,h){if(e.usage=i,Array.isArray(n)){if(e.dtype=o||5126,0<n.length)if(Array.isArray(n[0])){s=ne(n);for(var l=o=1;l<s.length;++l)o*=s[l];e.dimension=o,a(e,n=ee(n,s,e.dtype),i),h?e.persistentData=n:Bt.freeType(n)}else"number"==typeof n[0]?(e.dimension=s,T(s=Bt.allocType(e.dtype,n.length),n),a(e,s,i),h?e.persistentData=s:Bt.freeType(s)):Ut(n[0])&&(e.dimension=n[0].length,e.dtype=o||P(n[0])||5126,a(e,n=ee(n,[n.length,n[0].length],e.dtype),i),h?e.persistentData=n:Bt.freeType(n))}else if(Ut(n))e.dtype=o||P(n),e.dimension=s,a(e,n,i),h&&(e.persistentData=new Uint8Array(new Uint8Array(n.buffer)));else if(v(n)){var c=n.stride,A=(l=n.offset,0),f=0,d=0,p=0;1===(s=n.shape).length?(A=s[0],f=1,d=c[0],p=0):2===s.length&&(A=s[0],f=s[1],d=c[0],p=c[1]),e.dtype=o||P(n.data)||5126,e.dimension=f,S(s=Bt.allocType(e.dtype,A*f),n.data,A,f,d,p,l),a(e,s,i),h?e.persistentData=s:Bt.freeType(s)}else n instanceof ArrayBuffer&&(e.dtype=5121,e.dimension=s,a(e,n,i),h&&(e.persistentData=new Uint8Array(new Uint8Array(n))))}function l(i){n.bufferCount--,o(i),e.deleteBuffer(i.buffer),i.buffer=null,delete A[i.id]}var c=0,A={};s.prototype.bind=function(){e.bindBuffer(this.type,this.buffer)},s.prototype.destroy=function(){l(this)};var f=[];return i.profile&&(n.getTotalBufferSize=function(){var e=0;return Object.keys(A).forEach((function(n){e+=A[n].stats.size})),e}),{create:function(o,a,c,f){function d(n){var o=35044,s=null,a=0,l=0,c=p&&p.dimension||1;return Array.isArray(n)||Ut(n)||v(n)||n instanceof ArrayBuffer?s=n:"number"==typeof n?a=0|n:n&&("data"in n&&(s=n.data),"usage"in n&&(o=te[n.usage]),"type"in n&&(l=$t[n.type]),"dimension"in n&&(c=0|n.dimension),"length"in n&&(a=0|n.length)),p.bind(),s?h(p,s,o,l,c,f):(a&&e.bufferData(p.type,a,o),p.dtype=l||5121,p.usage=o,p.dimension=c,p.byteLength=a),i.profile&&(p.stats.size=p.byteLength*ie[p.dtype]),d}n.bufferCount++;var p=new s(a);return A[p.id]=p,c||d(o),d._reglType="buffer",d._buffer=p,d.subdata=function(n,i){var o,s=0|(i||0);if(p.bind(),Ut(n)||n instanceof ArrayBuffer)e.bufferSubData(p.type,s,n);else if(Array.isArray(n)){if(0<n.length)if("number"==typeof n[0]){var a=Bt.allocType(p.dtype,n.length);T(a,n),e.bufferSubData(p.type,s,a),Bt.freeType(a)}else(Array.isArray(n[0])||Ut(n[0]))&&(o=ne(n),a=ee(n,o,p.dtype),e.bufferSubData(p.type,s,a),Bt.freeType(a))}else if(v(n)){var h=n.stride,l=a=0,c=0,A=0;1===(o=n.shape).length?(a=o[0],l=1,c=h[0],A=0):2===o.length&&(a=o[0],l=o[1],c=h[0],A=h[1]),o=Array.isArray(n.data)?p.dtype:P(n.data),S(o=Bt.allocType(o,a*l),n.data,a,l,c,A,n.offset),e.bufferSubData(p.type,s,o),Bt.freeType(o)}return d},i.profile&&(d.stats=p.stats),d.destroy=function(){l(p)},d},createStream:function(e,n){var i=f.pop();return i||(i=new s(e)),i.bind(),h(i,n,35040,0,1,!1),i},destroyStream:function(e){f.push(e)},clear:function(){Wt(A).forEach(l),f.forEach(l)},getBuffer:function(e){return e&&e._buffer instanceof s?e._buffer:null},restore:function(){Wt(A).forEach((function(n){n.buffer=e.createBuffer(),e.bindBuffer(n.type,n.buffer),e.bufferData(n.type,n.persistentData||n.byteLength,n.usage)}))},_initBuffer:h}}function E(e,n,i,o){function s(e){this.id=c++,l[this.id]=this,this.buffer=e,this.primType=4,this.type=this.vertCount=0}function a(o,s,a,h,l,c,A){var f;if(o.buffer.bind(),s?((f=A)||Ut(s)&&(!v(s)||Ut(s.data))||(f=n.oes_element_index_uint?5125:5123),i._initBuffer(o.buffer,s,a,f,3)):(e.bufferData(34963,c,a),o.buffer.dtype=f||5121,o.buffer.usage=a,o.buffer.dimension=3,o.buffer.byteLength=c),f=A,!A){switch(o.buffer.dtype){case 5121:case 5120:f=5121;break;case 5123:case 5122:f=5123;break;case 5125:case 5124:f=5125}o.buffer.dtype=f}o.type=f,0>(s=l)&&(s=o.buffer.byteLength,5123===f?s>>=1:5125===f&&(s>>=2)),o.vertCount=s,s=h,0>h&&(s=4,1===(h=o.buffer.dimension)&&(s=0),2===h&&(s=1),3===h&&(s=4)),o.primType=s}function h(e){o.elementsCount--,delete l[e.id],e.buffer.destroy(),e.buffer=null}var l={},c=0,A={uint8:5121,uint16:5123};n.oes_element_index_uint&&(A.uint32=5125),s.prototype.bind=function(){this.buffer.bind()};var f=[];return{create:function(e,n){function l(e){if(e)if("number"==typeof e)c(e),f.primType=4,f.vertCount=0|e,f.type=5121;else{var n=null,i=35044,o=-1,s=-1,h=0,d=0;Array.isArray(e)||Ut(e)||v(e)?n=e:("data"in e&&(n=e.data),"usage"in e&&(i=te[e.usage]),"primitive"in e&&(o=re[e.primitive]),"count"in e&&(s=0|e.count),"type"in e&&(d=A[e.type]),"length"in e?h=0|e.length:(h=s,5123===d||5122===d?h*=2:5125!==d&&5124!==d||(h*=4))),a(f,n,i,o,s,h,d)}else c(),f.primType=4,f.vertCount=0,f.type=5121;return l}var c=i.create(null,34963,!0),f=new s(c._buffer);return o.elementsCount++,l(e),l._reglType="elements",l._elements=f,l.subdata=function(e,n){return c.subdata(e,n),l},l.destroy=function(){h(f)},l},createStream:function(e){var n=f.pop();return n||(n=new s(i.create(null,34963,!0,!1)._buffer)),a(n,e,35040,-1,-1,0,0),n},destroyStream:function(e){f.push(e)},getElements:function(e){return"function"==typeof e&&e._elements instanceof s?e._elements:null},clear:function(){Wt(l).forEach(h)}}}function O(e){for(var n=Bt.allocType(5123,e.length),i=0;i<e.length;++i)if(isNaN(e[i]))n[i]=65535;else if(1/0===e[i])n[i]=31744;else if(-1/0===e[i])n[i]=64512;else{oe[0]=e[i];var o=(a=se[0])>>>31<<15,s=(a<<1>>>24)-127,a=a>>13&1023;n[i]=-24>s?o:-14>s?o+(a+1024>>-14-s):15<s?o+31744:o+(s+15<<10)+a}return n}function k(e){return Array.isArray(e)||Ut(e)}function L(e){return"[object "+e+"]"}function F(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function N(e){return!(!Array.isArray(e)||0===e.length||!k(e[0]))}function z(e){return Object.prototype.toString.call(e)}function H(e){if(!e)return!1;var n=z(e);return 0<=xe.indexOf(n)||F(e)||N(e)||v(e)}function j(e,n){36193===e.type?(e.data=O(n),Bt.freeType(n)):e.data=n}function W(e,n,i,o,s,a){if(e=void 0!==we[e]?we[e]:le[e]*be[n],a&&(e*=6),s){for(o=0;1<=i;)o+=e*i*i,i/=2;return o}return e*i*o}function q(e,n,i,o,s,a,h){function l(){this.format=this.internalformat=6408,this.type=5121,this.flipY=this.premultiplyAlpha=this.compressed=!1,this.unpackAlignment=1,this.colorSpace=37444,this.channels=this.height=this.width=0}function c(e,n){e.internalformat=n.internalformat,e.format=n.format,e.type=n.type,e.compressed=n.compressed,e.premultiplyAlpha=n.premultiplyAlpha,e.flipY=n.flipY,e.unpackAlignment=n.unpackAlignment,e.colorSpace=n.colorSpace,e.width=n.width,e.height=n.height,e.channels=n.channels}function A(e,n){if("object"==typeof n&&n){"premultiplyAlpha"in n&&(e.premultiplyAlpha=n.premultiplyAlpha),"flipY"in n&&(e.flipY=n.flipY),"alignment"in n&&(e.unpackAlignment=n.alignment),"colorSpace"in n&&(e.colorSpace=ft[n.colorSpace]),"type"in n&&(e.type=gt[n.type]);var i=e.width,o=e.height,s=e.channels,a=!1;"shape"in n?(i=n.shape[0],o=n.shape[1],3===n.shape.length&&(s=n.shape[2],a=!0)):("radius"in n&&(i=o=n.radius),"width"in n&&(i=n.width),"height"in n&&(o=n.height),"channels"in n&&(s=n.channels,a=!0)),e.width=0|i,e.height=0|o,e.channels=0|s,i=!1,"format"in n&&(o=e.internalformat=vt[i=n.format],e.format=$t[o],i in gt&&!("type"in n)&&(e.type=gt[i]),i in _t&&(e.compressed=!0),i=!0),!a&&i?e.channels=le[e.format]:a&&!i&&e.channels!==he[e.format]&&(e.format=e.internalformat=he[e.channels])}}function f(n){e.pixelStorei(37440,n.flipY),e.pixelStorei(37441,n.premultiplyAlpha),e.pixelStorei(37443,n.colorSpace),e.pixelStorei(3317,n.unpackAlignment)}function d(){l.call(this),this.yOffset=this.xOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function p(e,n){var i=null;if(H(n)?i=n:n&&(A(e,n),"x"in n&&(e.xOffset=0|n.x),"y"in n&&(e.yOffset=0|n.y),H(n.data)&&(i=n.data)),n.copy){var o=s.viewportWidth,a=s.viewportHeight;e.width=e.width||o-e.xOffset,e.height=e.height||a-e.yOffset,e.needsCopy=!0}else if(i){if(Ut(i))e.channels=e.channels||4,e.data=i,"type"in n||5121!==e.type||(e.type=0|Kt[Object.prototype.toString.call(i)]);else if(F(i)){switch(e.channels=e.channels||4,a=(o=i).length,e.type){case 5121:case 5123:case 5125:case 5126:(a=Bt.allocType(e.type,a)).set(o),e.data=a;break;case 36193:e.data=O(o)}e.alignment=1,e.needsFree=!0}else if(v(i)){o=i.data,Array.isArray(o)||5121!==e.type||(e.type=0|Kt[Object.prototype.toString.call(o)]);var h,l,c,f,d=i.stride;3===(a=i.shape).length?(c=a[2],f=d[2]):f=c=1,h=a[0],l=a[1],a=d[0],d=d[1],e.alignment=1,e.width=h,e.height=l,e.channels=c,e.format=e.internalformat=he[c],e.needsFree=!0,h=f,i=i.offset;for(var p=Bt.allocType(36193===e.type?5126:e.type,(c=e.width)*(f=e.height)*(l=e.channels)),g=0,w=0;w<f;++w)for(var C=0;C<c;++C)for(var P=0;P<l;++P)p[g++]=o[a*C+d*w+h*P+i];j(e,p)}else if(z(i)===ue||z(i)===ce||z(i)===Ae)e.element=z(i)===ue||z(i)===ce?i:i.canvas,e.width=e.element.width,e.height=e.element.height,e.channels=4;else if(z(i)===fe)e.element=i,e.width=i.width,e.height=i.height,e.channels=4;else if(z(i)===pe)e.element=i,e.width=i.naturalWidth,e.height=i.naturalHeight,e.channels=4;else if(z(i)===_e)e.element=i,e.width=i.videoWidth,e.height=i.videoHeight,e.channels=4;else if(N(i)){for(o=e.width||i[0].length,a=e.height||i.length,d=e.channels,d=k(i[0][0])?d||i[0][0].length:d||1,h=Xt.shape(i),c=1,f=0;f<h.length;++f)c*=h[f];c=Bt.allocType(36193===e.type?5126:e.type,c),Xt.flatten(i,h,"",c),j(e,c),e.alignment=1,e.width=o,e.height=a,e.channels=d,e.format=e.internalformat=he[d],e.needsFree=!0}}else e.width=e.width||1,e.height=e.height||1,e.channels=e.channels||4}function g(n,i,s,a,h){var l=n.element,c=n.data,A=n.internalformat,d=n.format,p=n.type,g=n.width,v=n.height;f(n),l?e.texSubImage2D(i,h,s,a,d,p,l):n.compressed?e.compressedTexSubImage2D(i,h,s,a,A,g,v,c):n.needsCopy?(o(),e.copyTexSubImage2D(i,h,s,a,n.xOffset,n.yOffset,g,v)):e.texSubImage2D(i,h,s,a,g,v,d,p,c)}function w(){return te.pop()||new d}function C(e){e.needsFree&&Bt.freeType(e.data),d.call(e),te.push(e)}function P(){l.call(this),this.genMipmaps=!1,this.mipmapHint=4352,this.mipmask=0,this.images=Array(16)}function T(e,n,i){var o=e.images[0]=w();e.mipmask=1,o.width=e.width=n,o.height=e.height=i,o.channels=e.channels=4}function S(e,n){var i=null;if(H(n))c(i=e.images[0]=w(),e),p(i,n),e.mipmask=1;else if(A(e,n),Array.isArray(n.mipmap))for(var o=n.mipmap,s=0;s<o.length;++s)c(i=e.images[s]=w(),e),i.width>>=s,i.height>>=s,p(i,o[s]),e.mipmask|=1<<s;else c(i=e.images[0]=w(),e),p(i,n),e.mipmask=1;c(e,e.images[0])}function I(n,i){for(var s=n.images,a=0;a<s.length&&s[a];++a){var h=s[a],l=i,c=a,A=h.element,d=h.data,p=h.internalformat,g=h.format,v=h.type,w=h.width,C=h.height;f(h),A?e.texImage2D(l,c,g,g,v,A):h.compressed?e.compressedTexImage2D(l,c,p,Math.max(1,w),Math.max(1,C),0,d):h.needsCopy?(o(),e.copyTexImage2D(l,c,g,h.xOffset,h.yOffset,w,C,0)):e.texImage2D(l,c,g,w,C,0,g,v,d||null)}}function E(){var e=ee.pop()||new P;l.call(e);for(var n=e.mipmask=0;16>n;++n)e.images[n]=null;return e}function L(e){for(var n=e.images,i=0;i<n.length;++i)n[i]&&C(n[i]),n[i]=null;ee.push(e)}function q(){this.magFilter=this.minFilter=9728,this.wrapT=this.wrapS=33071,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=4352}function Y(e,n){"min"in n&&(e.minFilter=At[n.min],0<=ae.indexOf(e.minFilter)&&!("faces"in n)&&(e.genMipmaps=!0)),"mag"in n&&(e.magFilter=ht[n.mag]);var i=e.wrapS,o=e.wrapT;if("wrap"in n){var s=n.wrap;"string"==typeof s?i=o=at[s]:Array.isArray(s)&&(i=at[s[0]],o=at[s[1]])}else"wrapS"in n&&(i=at[n.wrapS]),"wrapT"in n&&(o=at[n.wrapT]);if(e.wrapS=i,e.wrapT=o,"anisotropic"in n&&(e.anisotropic=n.anisotropic),"mipmap"in n){switch(i=!1,typeof n.mipmap){case"string":e.mipmapHint=st[n.mipmap],i=e.genMipmaps=!0;break;case"boolean":i=e.genMipmaps=n.mipmap;break;case"object":e.genMipmaps=!1,i=!0}!i||"min"in n||(e.minFilter=9984)}}function J(i,o){e.texParameteri(o,10241,i.minFilter),e.texParameteri(o,10240,i.magFilter),e.texParameteri(o,10242,i.wrapS),e.texParameteri(o,10243,i.wrapT),n.ext_texture_filter_anisotropic&&e.texParameteri(o,34046,i.anisotropic),i.genMipmaps&&(e.hint(33170,i.mipmapHint),e.generateMipmap(o))}function $(n){l.call(this),this.mipmask=0,this.internalformat=6408,this.id=ne++,this.refCount=1,this.target=n,this.texture=e.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new q,h.profile&&(this.stats={size:0})}function it(n){e.activeTexture(33984),e.bindTexture(n.target,n.texture)}function rt(){var n=oe[0];n?e.bindTexture(n.target,n.texture):e.bindTexture(3553,null)}function ot(n){var i=n.texture,o=n.unit,s=n.target;0<=o&&(e.activeTexture(33984+o),e.bindTexture(s,null),oe[o]=null),e.deleteTexture(i),n.texture=null,n.params=null,n.pixels=null,n.refCount=0,delete ie[n.id],a.textureCount--}var st={"don't care":4352,"dont care":4352,nice:4354,fast:4353},at={repeat:10497,clamp:33071,mirror:33648},ht={nearest:9728,linear:9729},At=Ct({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987},ht),ft={none:0,browser:37444},gt={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},vt={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},_t={};n.ext_srgb&&(vt.srgb=35904,vt.srgba=35906),n.oes_texture_float&&(gt.float32=gt.float=5126),n.oes_texture_half_float&&(gt.float16=gt["half float"]=36193),n.webgl_depth_texture&&(Ct(vt,{depth:6402,"depth stencil":34041}),Ct(gt,{uint16:5123,uint32:5125,"depth stencil":34042})),n.webgl_compressed_texture_s3tc&&Ct(_t,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779}),n.webgl_compressed_texture_atc&&Ct(_t,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798}),n.webgl_compressed_texture_pvrtc&&Ct(_t,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843}),n.webgl_compressed_texture_etc1&&(_t["rgb etc1"]=36196);var xt=Array.prototype.slice.call(e.getParameter(34467));Object.keys(_t).forEach((function(e){var n=_t[e];0<=xt.indexOf(n)&&(vt[e]=n)}));var wt=Object.keys(vt);i.textureFormats=wt;var Ot=[];Object.keys(vt).forEach((function(e){Ot[vt[e]]=e}));var Dt=[];Object.keys(gt).forEach((function(e){Dt[gt[e]]=e}));var kt=[];Object.keys(ht).forEach((function(e){kt[ht[e]]=e}));var Nt=[];Object.keys(At).forEach((function(e){Nt[At[e]]=e}));var Ht=[];Object.keys(at).forEach((function(e){Ht[at[e]]=e}));var $t=wt.reduce((function(e,i){var o=vt[i];return e[o]=6409===o||6406===o||6409===o||6410===o||6402===o||34041===o||n.ext_srgb&&(35904===o||35906===o)?o:32855===o||0<=i.indexOf("rgba")?6408:6407,e}),{}),te=[],ee=[],ne=0,ie={},re=i.maxTextureUnits,oe=Array(re).map((function(){return null}));return Ct($.prototype,{bind:function(){this.bindCount+=1;var n=this.unit;if(0>n){for(var i=0;i<re;++i){var o=oe[i];if(o){if(0<o.bindCount)continue;o.unit=-1}oe[i]=this,n=i;break}h.profile&&a.maxTextureUnits<n+1&&(a.maxTextureUnits=n+1),this.unit=n,e.activeTexture(33984+n),e.bindTexture(this.target,this.texture)}return n},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&ot(this)}}),h.profile&&(a.getTotalTextureSize=function(){var e=0;return Object.keys(ie).forEach((function(n){e+=ie[n].stats.size})),e}),{create2D:function(n,i){function o(n,i){var a=s.texInfo;q.call(a),a.version=e instanceof WebGL2RenderingContext?2:1;var l=E();return"number"==typeof n?T(l,0|n,"number"==typeof i?0|i:0|n):n?(Y(a,n),S(l,n)):T(l,1,1),a.genMipmaps&&(l.mipmask=(Math.max(l.width,l.height)<<1)-1),s.mipmask=l.mipmask,c(s,l),s.internalformat=l.internalformat,o.width=l.width,o.height=l.height,it(s),I(l,3553),J(a,3553),rt(),L(l),h.profile&&(s.stats.size=W(s.internalformat,s.type,l.width,l.height,a.genMipmaps,!1)),o.format=Ot[s.internalformat],o.type=Dt[s.type],o.mag=kt[a.magFilter],o.min=Nt[a.minFilter],o.wrapS=Ht[a.wrapS],o.wrapT=Ht[a.wrapT],o}var s=new $(3553);return ie[s.id]=s,a.textureCount++,o(n,i),o.subimage=function(e,n,i,a){n|=0,i|=0,a|=0;var h=w();return c(h,s),h.width=0,h.height=0,p(h,e),h.width=h.width||(s.width>>a)-n,h.height=h.height||(s.height>>a)-i,it(s),g(h,3553,n,i,a),rt(),C(h),o},o.resize=function(n,i){var a=0|n,l=0|i||a;if(a===s.width&&l===s.height)return o;o.width=s.width=a,o.height=s.height=l,it(s);for(var c=0;s.mipmask>>c;++c){var A=a>>c,f=l>>c;if(!A||!f)break;e.texImage2D(3553,c,s.format,A,f,0,s.format,s.type,null)}return rt(),h.profile&&(s.stats.size=W(s.internalformat,s.type,a,l,!1,!1)),o},o._reglType="texture2d",o._texture=s,h.profile&&(o.stats=s.stats),o.destroy=function(){s.decRef()},o},createCube:function(n,i,o,s,l,f){function d(e,n,i,o,s,a){var l,f=v.texInfo;for(q.call(f),l=0;6>l;++l)P[l]=E();if("number"!=typeof e&&e){if("object"==typeof e)if(n)S(P[0],e),S(P[1],n),S(P[2],i),S(P[3],o),S(P[4],s),S(P[5],a);else if(Y(f,e),A(v,e),"faces"in e)for(e=e.faces,l=0;6>l;++l)c(P[l],v),S(P[l],e[l]);else for(l=0;6>l;++l)S(P[l],e)}else for(e=0|e||1,l=0;6>l;++l)T(P[l],e,e);for(c(v,P[0]),v.mipmask=f.genMipmaps?(Math.max(P[0].width,P[0].height)<<1)-1:P[0].mipmask,v.internalformat=P[0].internalformat,d.width=P[0].width,d.height=P[0].height,it(v),l=0;6>l;++l)I(P[l],34069+l);for(J(f,34067),rt(),h.profile&&(v.stats.size=W(v.internalformat,v.type,d.width,d.height,f.genMipmaps,!0)),d.format=Ot[v.internalformat],d.type=Dt[v.type],d.mag=kt[f.magFilter],d.min=Nt[f.minFilter],d.wrapS=Ht[f.wrapS],d.wrapT=Ht[f.wrapT],l=0;6>l;++l)L(P[l]);return d}var v=new $(34067);ie[v.id]=v,a.cubeCount++;var P=Array(6);return d(n,i,o,s,l,f),d.subimage=function(e,n,i,o,s){i|=0,o|=0,s|=0;var a=w();return c(a,v),a.width=0,a.height=0,p(a,n),a.width=a.width||(v.width>>s)-i,a.height=a.height||(v.height>>s)-o,it(v),g(a,34069+e,i,o,s),rt(),C(a),d},d.resize=function(n){if((n|=0)!==v.width){d.width=v.width=n,d.height=v.height=n,it(v);for(var i=0;6>i;++i)for(var o=0;v.mipmask>>o;++o)e.texImage2D(34069+i,o,v.format,n>>o,n>>o,0,v.format,v.type,null);return rt(),h.profile&&(v.stats.size=W(v.internalformat,v.type,d.width,d.height,!1,!0)),d}},d._reglType="textureCube",d._texture=v,h.profile&&(d.stats=v.stats),d.destroy=function(){v.decRef()},d},clear:function(){for(var n=0;n<re;++n)e.activeTexture(33984+n),e.bindTexture(3553,null),oe[n]=null;Wt(ie).forEach(ot),a.cubeCount=0,a.textureCount=0},getTexture:function(e){return null},restore:function(){for(var n=0;n<re;++n){var i=oe[n];i&&(i.bindCount=0,i.unit=-1,oe[n]=null)}Wt(ie).forEach((function(n){n.texture=e.createTexture(),e.bindTexture(n.target,n.texture);for(var i=0;32>i;++i)if(n.mipmask&1<<i)if(3553===n.target)e.texImage2D(3553,i,n.internalformat,n.width>>i,n.height>>i,0,n.internalformat,n.type,null);else for(var o=0;6>o;++o)e.texImage2D(34069+o,i,n.internalformat,n.width>>i,n.height>>i,0,n.internalformat,n.type,null);J(n.texInfo,n.target)}))},refresh:function(){for(var n=0;n<re;++n){var i=oe[n];i&&(i.bindCount=0,i.unit=-1,oe[n]=null),e.activeTexture(33984+n),e.bindTexture(3553,null),e.bindTexture(34067,null)}}}}function Y(e,n,i,o,s,a){function h(e,n,i){this.target=e,this.texture=n,this.renderbuffer=i;var o=e=0;n?(e=n.width,o=n.height):i&&(e=i.width,o=i.height),this.width=e,this.height=o}function l(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function c(e,n,i){e&&(e.texture?e.texture._texture.refCount+=1:e.renderbuffer._renderbuffer.refCount+=1)}function A(n,i){i&&(i.texture?e.framebufferTexture2D(36160,n,i.target,i.texture._texture.texture,0):e.framebufferRenderbuffer(36160,n,36161,i.renderbuffer._renderbuffer.renderbuffer))}function f(e){var n=3553,i=null,o=null,s=e;return"object"==typeof e&&(s=e.data,"target"in e&&(n=0|e.target)),"texture2d"===(e=s._reglType)||"textureCube"===e?i=s:"renderbuffer"===e&&(o=s,n=36161),new h(n,i,o)}function d(e,n,i,a,l){return i?((e=o.create2D({width:e,height:n,format:a,type:l}))._texture.refCount=0,new h(3553,e,null)):((e=s.create({width:e,height:n,format:a}))._renderbuffer.refCount=0,new h(36161,null,e))}function p(e){return e&&(e.texture||e.renderbuffer)}function g(e,n,i){e&&(e.texture?e.texture.resize(n,i):e.renderbuffer&&e.renderbuffer.resize(n,i),e.width=n,e.height=i)}function v(){this.id=k++,L[this.id]=this,this.framebuffer=e.createFramebuffer(),this.height=this.width=0,this.colorAttachments=[],this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null}function w(e){e.colorAttachments.forEach(l),l(e.depthAttachment),l(e.stencilAttachment),l(e.depthStencilAttachment)}function C(n){e.deleteFramebuffer(n.framebuffer),n.framebuffer=null,a.framebufferCount--,delete L[n.id]}function P(n,o){var s;e.bindFramebuffer(36160,n.framebuffer);var a=n.colorAttachments;for(s=0;s<a.length;++s)A(36064+s,a[s]);for(s=a.length;s<i.maxColorAttachments;++s)e.framebufferTexture2D(36160,36064+s,3553,null,0);e.framebufferTexture2D(36160,33306,3553,null,0),e.framebufferTexture2D(36160,36096,3553,null,0),e.framebufferTexture2D(36160,36128,3553,null,0),A(36096,n.depthAttachment),A(36128,n.stencilAttachment),A(33306,n.depthStencilAttachment),o||(e.checkFramebufferStatus(36160),e.isContextLost()),e.bindFramebuffer(36160,S.next?S.next.framebuffer:null),S.cur=S.next,o||e.getError()}function T(n,i){function o(e,n){var i,a=0,h=0,l=!0,A=!0;i=null;var g=!0,v="rgba",C="uint8",T=1,S=null,O=null,k=null,L=!1;if("number"==typeof e)a=0|e,h=0|n||a;else if(e){var F=e;"shape"in F?(a=(h=F.shape)[0],h=h[1]):("radius"in F&&(a=h=F.radius),"width"in F&&(a=F.width),"height"in F&&(h=F.height)),("color"in F||"colors"in F)&&(i=F.color||F.colors),i||("colorCount"in F&&(T=0|F.colorCount),"colorTexture"in F&&(g=!!F.colorTexture,v="rgba4"),"colorType"in F&&(C=F.colorType,!g)&&("half float"===C||"float16"===C?v="rgba16f":"float"!==C&&"float32"!==C||(v="rgba32f")),"colorFormat"in F&&(0<=I.indexOf(v=F.colorFormat)?g=!0:0<=E.indexOf(v)&&(g=!1))),("depthTexture"in F||"depthStencilTexture"in F)&&(L=!(!F.depthTexture&&!F.depthStencilTexture)),"depth"in F&&("boolean"==typeof F.depth?l=F.depth:(S=F.depth,A=!1)),"stencil"in F&&("boolean"==typeof F.stencil?A=F.stencil:(O=F.stencil,l=!1)),"depthStencil"in F&&("boolean"==typeof F.depthStencil?l=A=F.depthStencil:(k=F.depthStencil,A=l=!1))}else a=h=1;var N=null,z=null,H=null,j=null;if(Array.isArray(i))N=i.map(f);else if(i)N=[f(i)];else for(N=Array(T),i=0;i<T;++i)N[i]=d(a,h,g,v,C);for(a=a||N[0].width,h=h||N[0].height,S?z=f(S):l&&!A&&(z=d(a,h,L,"depth","uint32")),O?H=f(O):A&&!l&&(H=d(a,h,!1,"stencil","uint8")),k?j=f(k):!S&&!O&&A&&l&&(j=d(a,h,L,"depth stencil","depth stencil")),l=null,i=0;i<N.length;++i)c(N[i]),N[i]&&N[i].texture&&(A=je[N[i].texture._texture.format]*Ge[N[i].texture._texture.type],null===l&&(l=A));return c(z),c(H),c(j),w(s),s.width=a,s.height=h,s.colorAttachments=N,s.depthAttachment=z,s.stencilAttachment=H,s.depthStencilAttachment=j,o.color=N.map(p),o.depth=p(z),o.stencil=p(H),o.depthStencil=p(j),o.width=s.width,o.height=s.height,P(s,F&&F.ignoreStatusCheck),o}var s=new v;return a.framebufferCount++,o(n,i),Ct(o,{resize:function(e,n){var i=Math.max(0|e,1),a=Math.max(0|n||i,1);if(i===s.width&&a===s.height)return o;for(var h=s.colorAttachments,l=0;l<h.length;++l)g(h[l],i,a);return g(s.depthAttachment,i,a),g(s.stencilAttachment,i,a),g(s.depthStencilAttachment,i,a),s.width=o.width=i,s.height=o.height=a,P(s),o},blit:function(n,i,o){e.bindFramebuffer(36008,n._framebuffer.framebuffer),e.bindFramebuffer(36009,s.framebuffer),i||(i=16384),e.blitFramebuffer(0,0,n.width,n.height,0,0,s.width,s.height,i,"linear"===o?9729:9728),e.bindFramebuffer(36008,null),e.bindFramebuffer(36009,null)},_reglType:"framebuffer",_framebuffer:s,destroy:function(){C(s),w(s)},use:function(e){S.setFBO({framebuffer:o},e)}})}var S={cur:null,next:null,dirty:!1,setFBO:null},I=["rgba"],E=["rgba4","rgb565","rgb5 a1"];n.ext_srgb&&E.push("srgba"),n.ext_color_buffer_half_float&&E.push("rgba16f","rgb16f"),n.webgl_color_buffer_float&&E.push("rgba32f");var O=["uint8"];n.oes_texture_half_float&&O.push("half float","float16"),n.oes_texture_float&&O.push("float","float32");var k=0,L={};return Ct(S,{getFramebuffer:function(e){return"function"==typeof e&&"framebuffer"===e._reglType&&(e=e._framebuffer)instanceof v?e:null},create:T,createCube:function(e){function n(e){var s,a={color:null},h=0,l=null;s="rgba";var c="uint8",A=1;if("number"==typeof e?h=0|e:e?("shape"in e?h=e.shape[0]:("radius"in e&&(h=0|e.radius),"width"in e?h=0|e.width:"height"in e&&(h=0|e.height)),("color"in e||"colors"in e)&&(l=e.color||e.colors),l||("colorCount"in e&&(A=0|e.colorCount),"colorType"in e&&(c=e.colorType),"colorFormat"in e&&(s=e.colorFormat)),"depth"in e&&(a.depth=e.depth),"stencil"in e&&(a.stencil=e.stencil),"depthStencil"in e&&(a.depthStencil=e.depthStencil)):h=1,l)if(Array.isArray(l))for(e=[],s=0;s<l.length;++s)e[s]=l[s];else e=[l];else for(e=Array(A),l={radius:h,format:s,type:c},s=0;s<A;++s)e[s]=o.createCube(l);for(a.color=Array(e.length),s=0;s<e.length;++s)A=e[s],h=h||A.width,a.color[s]={target:34069,data:e[s]};for(s=0;6>s;++s){for(A=0;A<e.length;++A)a.color[A].target=34069+s;0<s&&(a.depth=i[0].depth,a.stencil=i[0].stencil,a.depthStencil=i[0].depthStencil),i[s]?i[s](a):i[s]=T(a)}return Ct(n,{width:h,height:h,color:e})}var i=Array(6);return n(e),Ct(n,{faces:i,resize:function(e){var o=0|e;if(o===n.width)return n;var s=n.color;for(e=0;e<s.length;++e)s[e].resize(o);for(e=0;6>e;++e)i[e].resize(o);return n.width=n.height=o,n},_reglType:"framebufferCube",destroy:function(){i.forEach((function(e){e.destroy()}))}})},clear:function(){Wt(L).forEach(C)},restore:function(){S.cur=null,S.next=null,S.dirty=!0,Wt(L).forEach((function(n){n.framebuffer=e.createFramebuffer(),P(n)}))}})}function J(){this.w=this.z=this.y=this.x=this.state=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=5126,this.divisor=this.stride=this.offset=0}function $(e,n,i,o,s,a,h){function l(e){if(e!==P.currentVAO){var i=n.oes_vertex_array_object;i.bindVertexArrayOES(e?e.vao:null),P.currentVAO=e}}function c(i){if(i!==P.currentVAO){if(i)i.bindAttrs();else{for(var o=n.angle_instanced_arrays,s=0;s<g.length;++s){var a=g[s];a.buffer?(e.enableVertexAttribArray(s),a.buffer.bind(),e.vertexAttribPointer(s,a.size,a.type,a.normalized,a.stride,a.offfset),o&&a.divisor&&o.vertexAttribDivisorANGLE(s,a.divisor)):(e.disableVertexAttribArray(s),e.vertexAttrib4f(s,a.x,a.y,a.z,a.w))}e.bindBuffer(34963,h.elements?h.elements.buffer.buffer:null)}P.currentVAO=i}}function A(){Wt(C).forEach((function(e){e.destroy()}))}function f(){this.id=++w,this.attributes=[],this.elements=null,this.ownsElements=!1,this.offset=this.count=0,this.instances=-1,this.primitive=4;var e=n.oes_vertex_array_object;this.vao=e?e.createVertexArrayOES():null,C[this.id]=this,this.buffers=[]}function d(){n.oes_vertex_array_object&&Wt(C).forEach((function(e){e.refresh()}))}var p=i.maxAttributes,g=Array(p);for(i=0;i<p;++i)g[i]=new J;var w=0,C={},P={Record:J,scope:{},state:g,currentVAO:null,targetVAO:null,restore:n.oes_vertex_array_object?d:function(){},createVAO:function(e){function n(e){var o;Array.isArray(e)?(o=e,i.elements&&i.ownsElements&&i.elements.destroy(),i.elements=null,i.ownsElements=!1,i.offset=0,i.count=0,i.instances=-1,i.primitive=4):(e.elements?(o=e.elements,i.ownsElements?("function"==typeof o&&"elements"===o._reglType?i.elements.destroy():i.elements(o),i.ownsElements=!1):a.getElements(e.elements)?(i.elements=e.elements,i.ownsElements=!1):(i.elements=a.create(e.elements),i.ownsElements=!0)):(i.elements=null,i.ownsElements=!1),o=e.attributes,i.offset=0,i.count=-1,i.instances=-1,i.primitive=4,i.elements&&(i.count=i.elements._elements.vertCount,i.primitive=i.elements._elements.primType),"offset"in e&&(i.offset=0|e.offset),"count"in e&&(i.count=0|e.count),"instances"in e&&(i.instances=0|e.instances),"primitive"in e&&(i.primitive=re[e.primitive])),e={};var h=i.attributes;h.length=o.length;for(var l=0;l<o.length;++l){var c,A=o[l],f=h[l]=new J,d=A.data||A;Array.isArray(d)||Ut(d)||v(d)?(i.buffers[l]&&(c=i.buffers[l],Ut(d)&&c._buffer.byteLength>=d.byteLength?c.subdata(d):(c.destroy(),i.buffers[l]=null)),i.buffers[l]||(c=i.buffers[l]=s.create(A,34962,!1,!0)),f.buffer=s.getBuffer(c),f.size=0|f.buffer.dimension,f.normalized=!1,f.type=f.buffer.dtype,f.offset=0,f.stride=0,f.divisor=0,f.state=1,e[l]=1):s.getBuffer(A)?(f.buffer=s.getBuffer(A),f.size=0|f.buffer.dimension,f.normalized=!1,f.type=f.buffer.dtype,f.offset=0,f.stride=0,f.divisor=0,f.state=1):s.getBuffer(A.buffer)?(f.buffer=s.getBuffer(A.buffer),f.size=0|(+A.size||f.buffer.dimension),f.normalized=!!A.normalized||!1,f.type="type"in A?$t[A.type]:f.buffer.dtype,f.offset=0|(A.offset||0),f.stride=0|(A.stride||0),f.divisor=0|(A.divisor||0),f.state=1):"x"in A&&(f.x=+A.x||0,f.y=+A.y||0,f.z=+A.z||0,f.w=+A.w||0,f.state=2)}for(c=0;c<i.buffers.length;++c)!e[c]&&i.buffers[c]&&(i.buffers[c].destroy(),i.buffers[c]=null);return i.refresh(),n}var i=new f;return o.vaoCount+=1,n.destroy=function(){for(var e=0;e<i.buffers.length;++e)i.buffers[e]&&i.buffers[e].destroy();i.buffers.length=0,i.ownsElements&&(i.elements.destroy(),i.elements=null,i.ownsElements=!1),i.destroy()},n._vao=i,n._reglType="vao",n(e)},getVAO:function(e){return"function"==typeof e&&e._vao?e._vao:null},destroyBuffer:function(n){for(var i=0;i<g.length;++i){var o=g[i];o.buffer===n&&(e.disableVertexAttribArray(i),o.buffer=null)}},setVAO:n.oes_vertex_array_object?l:c,clear:n.oes_vertex_array_object?A:function(){}};return f.prototype.bindAttrs=function(){for(var i=n.angle_instanced_arrays,o=this.attributes,s=0;s<o.length;++s){var h=o[s];h.buffer?(e.enableVertexAttribArray(s),e.bindBuffer(34962,h.buffer.buffer),e.vertexAttribPointer(s,h.size,h.type,h.normalized,h.stride,h.offset),i&&h.divisor&&i.vertexAttribDivisorANGLE(s,h.divisor)):(e.disableVertexAttribArray(s),e.vertexAttrib4f(s,h.x,h.y,h.z,h.w))}for(i=o.length;i<p;++i)e.disableVertexAttribArray(i);(i=a.getElements(this.elements))?e.bindBuffer(34963,i.buffer.buffer):e.bindBuffer(34963,null)},f.prototype.refresh=function(){var e=n.oes_vertex_array_object;e&&(e.bindVertexArrayOES(this.vao),this.bindAttrs(),P.currentVAO=null,e.bindVertexArrayOES(null))},f.prototype.destroy=function(){if(this.vao){var e=n.oes_vertex_array_object;this===P.currentVAO&&(P.currentVAO=null,e.bindVertexArrayOES(null)),e.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),C[this.id]&&(delete C[this.id],--o.vaoCount)},P}function it(e,n,i,o){function s(e,n,i,o){this.name=e,this.id=n,this.location=i,this.info=o}function a(e,n){for(var i=0;i<e.length;++i)if(e[i].id===n.id)return void(e[i].location=n.location);e.push(n)}function h(i,o,s){if(!(h=(s=35632===i?A:f)[o])){var a=n.str(o),h=e.createShader(i);e.shaderSource(h,a),e.compileShader(h),s[o]=h}return h}function l(e,n){this.id=g++,this.fragId=e,this.vertId=n,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,o.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function c(i,l,c){var A;A=h(35632,i.fragId);var f=h(35633,i.vertId);if(l=i.program=e.createProgram(),e.attachShader(l,A),e.attachShader(l,f),c)for(A=0;A<c.length;++A)e.bindAttribLocation(l,(f=c[A])[0],f[1]);e.linkProgram(l),f=e.getProgramParameter(l,35718),o.profile&&(i.stats.uniformsCount=f);var d=i.uniforms;for(A=0;A<f;++A)if(c=e.getActiveUniform(l,A)){if(1<c.size)for(var p=0;p<c.size;++p){var g=c.name.replace("[0]","["+p+"]");a(d,new s(g,n.id(g),e.getUniformLocation(l,g),c))}p=c.name,1<c.size&&(p=p.replace("[0]","")),a(d,new s(p,n.id(p),e.getUniformLocation(l,p),c))}for(f=e.getProgramParameter(l,35721),o.profile&&(i.stats.attributesCount=f),i=i.attributes,A=0;A<f;++A)(c=e.getActiveAttrib(l,A))&&a(i,new s(c.name,n.id(c.name),e.getAttribLocation(l,c.name),c))}var A={},f={},d={},p=[],g=0;return o.profile&&(i.getMaxUniformsCount=function(){var e=0;return p.forEach((function(n){n.stats.uniformsCount>e&&(e=n.stats.uniformsCount)})),e},i.getMaxAttributesCount=function(){var e=0;return p.forEach((function(n){n.stats.attributesCount>e&&(e=n.stats.attributesCount)})),e}),{clear:function(){var n=e.deleteShader.bind(e);Wt(A).forEach(n),A={},Wt(f).forEach(n),f={},p.forEach((function(n){e.deleteProgram(n.program)})),p.length=0,d={},i.shaderCount=0},program:function(n,o,s,a){var h=d[o];h||(h=d[o]={});var g=h[n];if(g&&(g.refCount++,!a))return g;var v=new l(o,n);return i.shaderCount++,c(v,s,a),g||(h[n]=v),p.push(v),Ct(v,{destroy:function(){if(v.refCount--,0>=v.refCount){e.deleteProgram(v.program);var n=p.indexOf(v);p.splice(n,1),i.shaderCount--}0>=h[v.vertId].refCount&&(e.deleteShader(f[v.vertId]),delete f[v.vertId],delete d[v.fragId][v.vertId]),Object.keys(d[v.fragId]).length||(e.deleteShader(A[v.fragId]),delete A[v.fragId],delete d[v.fragId])}})},restore:function(){A={},f={};for(var e=0;e<p.length;++e)c(p[e],null,p[e].attributes.map((function(e){return[e.location,e.name]})))},shader:h,frag:-1,vert:-1}}function rt(e,n,i,o,s,a,h){function l(s){var a;a=null===n.next?5121:n.next.colorAttachments[0].texture._texture.type;var h=0,l=0,c=o.framebufferWidth,A=o.framebufferHeight,f=null;return Ut(s)?f=s:s&&(h=0|s.x,l=0|s.y,c=0|(s.width||o.framebufferWidth-h),A=0|(s.height||o.framebufferHeight-l),f=s.data||null),i(),s=c*A*4,f||(5121===a?f=new Uint8Array(s):5126===a&&(f=f||new Float32Array(s))),e.pixelStorei(3333,4),e.readPixels(h,l,c,A,6408,a,f),f}function c(e){var i;return n.setFBO({framebuffer:e.framebuffer},(function(){i=l(e)})),i}return function(e){return e&&"framebuffer"in e?c(e):l(e)}}function ot(e){return Array.prototype.slice.call(e)}function st(e){return ot(e).join("")}function at(){function e(){var e=[],n=[];return Ct((function(){e.push.apply(e,ot(arguments))}),{def:function(){var o="v"+i++;return n.push(o),0<arguments.length&&(e.push(o,"="),e.push.apply(e,ot(arguments)),e.push(";")),o},toString:function(){return st([0<n.length?"var "+n.join(",")+";":"",st(e)])}})}function n(){function n(e,n){o(e,n,"=",i.def(e,n),";")}var i=e(),o=e(),s=i.toString,a=o.toString;return Ct((function(){i.apply(i,ot(arguments))}),{def:i.def,entry:i,exit:o,save:n,set:function(e,o,s){n(e,o),i(e,o,"=",s,";")},toString:function(){return s()+a()}})}var i=0,o=[],s=[],a=e(),h={};return{global:a,link:function(e){for(var n=0;n<s.length;++n)if(s[n]===e)return o[n];return n="g"+i++,o.push(n),s.push(e),n},block:e,proc:function(e,i){function o(){var e="a"+s.length;return s.push(e),e}var s=[];i=i||0;for(var a=0;a<i;++a)o();var l=(a=n()).toString;return h[e]=Ct(a,{arg:o,toString:function(){return st(["function(",s.join(),"){",l(),"}"])}})},scope:n,cond:function(){var e=st(arguments),i=n(),o=n(),s=i.toString,a=o.toString;return Ct(i,{then:function(){return i.apply(i,ot(arguments)),this},else:function(){return o.apply(o,ot(arguments)),this},toString:function(){var n=a();return n&&(n="else{"+n+"}"),st(["if(",e,"){",s(),"}",n])}})},compile:function(){var e=['"use strict";',a,"return {"];Object.keys(h).forEach((function(n){e.push('"',n,'":',h[n].toString(),",")})),e.push("}");var n=st(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,o.concat(n)).apply(null,s)}}}function ht(e){return Array.isArray(e)||Ut(e)||v(e)}function At(e){return e.sort((function(e,n){return"viewport"===e?-1:"viewport"===n?1:e<n?-1:1}))}function ft(e,n,i,o){this.thisDep=e,this.contextDep=n,this.propDep=i,this.append=o}function gt(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function vt(e){return new ft(!1,!1,!1,e)}function _t(e,n){var i=e.type;if(0===i)return new ft(!0,1<=(i=e.data.length),2<=i,n);if(4===i)return new ft((i=e.data).thisDep,i.contextDep,i.propDep,n);if(5===i)return new ft(!1,!1,!1,n);if(6===i){for(var o=i=!1,s=!1,a=0;a<e.data.length;++a){var h=e.data[a];1===h.type?s=!0:2===h.type?o=!0:3===h.type?i=!0:0===h.type?(i=!0,1<=(h=h.data)&&(o=!0),2<=h&&(s=!0)):4===h.type&&(i=i||h.data.thisDep,o=o||h.data.contextDep,s=s||h.data.propDep)}return new ft(i,o,s,n)}return new ft(3===i,2===i,1===i,n)}function xt(e,n,i,o,s,a,h,l,c,A,f,p,g,v,w){function C(e){return e.replace(".","_")}function P(e,n,i){var o=C(e);he.push(e),ae[o]=se[o]=!!i,le[o]=n}function T(e,n,i){var o=C(e);he.push(e),Array.isArray(i)?(se[o]=i.slice(),ae[o]=i.slice()):se[o]=ae[o]=i,ue[o]=n}function S(){var e=at(),i=e.link,o=e.global;e.id=fe++,e.batchId="0";var s=i(ce),a=e.shared={props:"a0"};Object.keys(ce).forEach((function(e){a[e]=o.def(s,".",e)}));var h=e.next={},l=e.current={};Object.keys(ue).forEach((function(e){Array.isArray(se[e])&&(h[e]=o.def(a.next,".",e),l[e]=o.def(a.current,".",e))}));var c=e.constants={};Object.keys(Ae).forEach((function(e){c[e]=o.def(JSON.stringify(Ae[e]))})),e.invoke=function(n,o){switch(o.type){case 0:var s=["this",a.context,a.props,e.batchId];return n.def(i(o.data),".call(",s.slice(0,Math.max(o.data.length+1,4)),")");case 1:return n.def(a.props,o.data);case 2:return n.def(a.context,o.data);case 3:return n.def("this",o.data);case 4:return o.data.append(e,n),o.data.ref;case 5:return o.data.toString();case 6:return o.data.map((function(i){return e.invoke(n,i)}))}},e.attribCache={};var f={};return e.scopeAttrib=function(e){if((e=n.id(e))in f)return f[e];var o=A.scope[e];return o||(o=A.scope[e]=new te),f[e]=i(o)},e}function I(e){var n,i=e.static;if(e=e.dynamic,"profile"in i){var o=!!i.profile;(n=vt((function(e,n){return o}))).enable=o}else if("profile"in e){var s=e.profile;n=_t(s,(function(e,n){return e.invoke(n,s)}))}return n}function E(e,n){var i=e.static,o=e.dynamic;if("framebuffer"in i){var s=i.framebuffer;return s?(s=l.getFramebuffer(s),vt((function(e,n){var i=e.link(s),o=e.shared;return n.set(o.framebuffer,".next",i),n.set(o=o.context,".framebufferWidth",i+".width"),n.set(o,".framebufferHeight",i+".height"),i}))):vt((function(e,n){var i=e.shared;return n.set(i.framebuffer,".next","null"),n.set(i=i.context,".framebufferWidth",i+".drawingBufferWidth"),n.set(i,".framebufferHeight",i+".drawingBufferHeight"),"null"}))}if("framebuffer"in o){var a=o.framebuffer;return _t(a,(function(e,n){var i=e.invoke(n,a),o=e.shared,s=o.framebuffer;return i=n.def(s,".getFramebuffer(",i,")"),n.set(s,".next",i),n.set(o=o.context,".framebufferWidth",i+"?"+i+".width:"+o+".drawingBufferWidth"),n.set(o,".framebufferHeight",i+"?"+i+".height:"+o+".drawingBufferHeight"),i}))}return null}function O(e,n,i){function o(e){if(e in s){var i=s[e];e=!0;var o,h,l=0|i.x,c=0|i.y;return"width"in i?o=0|i.width:e=!1,"height"in i?h=0|i.height:e=!1,new ft(!e&&n&&n.thisDep,!e&&n&&n.contextDep,!e&&n&&n.propDep,(function(e,n){var s=e.shared.context,a=o;"width"in i||(a=n.def(s,".","framebufferWidth","-",l));var A=h;return"height"in i||(A=n.def(s,".","framebufferHeight","-",c)),[l,c,a,A]}))}if(e in a){var A=a[e];return e=_t(A,(function(e,n){var i=e.invoke(n,A),o=e.shared.context,s=n.def(i,".x|0"),a=n.def(i,".y|0");return[s,a,n.def('"width" in ',i,"?",i,".width|0:","(",o,".","framebufferWidth","-",s,")"),i=n.def('"height" in ',i,"?",i,".height|0:","(",o,".","framebufferHeight","-",a,")")]})),n&&(e.thisDep=e.thisDep||n.thisDep,e.contextDep=e.contextDep||n.contextDep,e.propDep=e.propDep||n.propDep),e}return n?new ft(n.thisDep,n.contextDep,n.propDep,(function(e,n){var i=e.shared.context;return[0,0,n.def(i,".","framebufferWidth"),n.def(i,".","framebufferHeight")]})):null}var s=e.static,a=e.dynamic;if(e=o("viewport")){var h=e;e=new ft(e.thisDep,e.contextDep,e.propDep,(function(e,n){var i=h.append(e,n),o=e.shared.context;return n.set(o,".viewportWidth",i[2]),n.set(o,".viewportHeight",i[3]),i}))}return{viewport:e,scissor_box:o("scissor.box")}}function L(e,n){if("string"==typeof(i=e.static).frag&&"string"==typeof i.vert){if(0<Object.keys(n.dynamic).length)return null;var i=n.static,o=Object.keys(i);if(0<o.length&&"number"==typeof i[o[0]]){for(var s=[],a=0;a<o.length;++a)s.push([0|i[o[a]],o[a]]);return s}}return null}function F(e,i,o){function s(e){if(e in a){var i=n.id(a[e]);return(e=vt((function(){return i}))).id=i,e}if(e in h){var o=h[e];return _t(o,(function(e,n){var i=e.invoke(n,o);return n.def(e.shared.strings,".id(",i,")")}))}return null}var a=e.static,h=e.dynamic,l=s("frag"),c=s("vert"),A=null;return gt(l)&&gt(c)?(A=f.program(c.id,l.id,null,o),e=vt((function(e,n){return e.link(A)}))):e=new ft(l&&l.thisDep||c&&c.thisDep,l&&l.contextDep||c&&c.contextDep,l&&l.propDep||c&&c.propDep,(function(e,n){var i,o,s=e.shared.shader;return i=l?l.append(e,n):n.def(s,".","frag"),o=c?c.append(e,n):n.def(s,".","vert"),n.def(s+".program("+o+","+i+")")})),{frag:l,vert:c,progVar:e,program:A}}function N(e,n){function i(e,n){if(e in o){var i=0|o[e];return n?h.offset=i:h.instances=i,vt((function(e,o){return n&&(e.OFFSET=i),i}))}if(e in s){var a=s[e];return _t(a,(function(e,i){var o=e.invoke(i,a);return n&&(e.OFFSET=o),o}))}if(n){if(f)return vt((function(e,n){return e.OFFSET=0}));if(l)return new ft(c.thisDep,c.contextDep,c.propDep,(function(e,n){return n.def(e.shared.vao+".currentVAO?"+e.shared.vao+".currentVAO.offset:0")}))}else if(l)return new ft(c.thisDep,c.contextDep,c.propDep,(function(e,n){return n.def(e.shared.vao+".currentVAO?"+e.shared.vao+".currentVAO.instances:-1")}));return null}var o=e.static,s=e.dynamic,h={},l=!1,c=function(){if("vao"in o){var e=o.vao;return null!==e&&null===A.getVAO(e)&&(e=A.createVAO(e)),l=!0,h.vao=e,vt((function(n){var i=A.getVAO(e);return i?n.link(i):"null"}))}if("vao"in s){l=!0;var n=s.vao;return _t(n,(function(e,i){var o=e.invoke(i,n);return i.def(e.shared.vao+".getVAO("+o+")")}))}return null}(),f=!1,d=function(){if("elements"in o){if(h.elements=n=o.elements,ht(n)){var e=h.elements=a.create(n,!0),n=a.getElements(e);f=!0}else n&&(n=a.getElements(n),f=!0);return e=vt((function(e,i){if(n){var o=e.link(n);return e.ELEMENTS=o}return e.ELEMENTS=null})),e.value=n,e}if("elements"in s){f=!0;var i=s.elements;return _t(i,(function(e,n){var o=(s=e.shared).isBufferArgs,s=s.elements,a=e.invoke(n,i),h=n.def("null");return o=n.def(o,"(",a,")"),a=e.cond(o).then(h,"=",s,".createStream(",a,");").else(h,"=",s,".getElements(",a,");"),n.entry(a),n.exit(e.cond(o).then(s,".destroyStream(",h,");")),e.ELEMENTS=h}))}return l?new ft(c.thisDep,c.contextDep,c.propDep,(function(e,n){return n.def(e.shared.vao+".currentVAO?"+e.shared.elements+".getElements("+e.shared.vao+".currentVAO.elements):null")})):null}(),p=i("offset",!0),g=function(){if("primitive"in o){var e=o.primitive;return h.primitive=e,vt((function(n,i){return re[e]}))}if("primitive"in s){var n=s.primitive;return _t(n,(function(e,i){var o=e.constants.primTypes,s=e.invoke(i,n);return i.def(o,"[",s,"]")}))}return f?gt(d)?vt(d.value?function(e,n){return n.def(e.ELEMENTS,".primType")}:function(){return 4}):new ft(d.thisDep,d.contextDep,d.propDep,(function(e,n){var i=e.ELEMENTS;return n.def(i,"?",i,".primType:",4)})):l?new ft(c.thisDep,c.contextDep,c.propDep,(function(e,n){return n.def(e.shared.vao+".currentVAO?"+e.shared.vao+".currentVAO.primitive:4")})):null}(),v=function(){if("count"in o){var e=0|o.count;return h.count=e,vt((function(){return e}))}if("count"in s){var n=s.count;return _t(n,(function(e,i){return e.invoke(i,n)}))}return f?gt(d)?d?p?new ft(p.thisDep,p.contextDep,p.propDep,(function(e,n){return n.def(e.ELEMENTS,".vertCount-",e.OFFSET)})):vt((function(e,n){return n.def(e.ELEMENTS,".vertCount")})):vt((function(){return-1})):new ft(d.thisDep||p.thisDep,d.contextDep||p.contextDep,d.propDep||p.propDep,(function(e,n){var i=e.ELEMENTS;return e.OFFSET?n.def(i,"?",i,".vertCount-",e.OFFSET,":-1"):n.def(i,"?",i,".vertCount:-1")})):l?new ft(c.thisDep,c.contextDep,c.propDep,(function(e,n){return n.def(e.shared.vao,".currentVAO?",e.shared.vao,".currentVAO.count:-1")})):null}(),w=i("instances",!1);return{elements:d,primitive:g,count:v,instances:w,offset:p,vao:c,vaoActive:l,elementsActive:f,static:h}}function z(e,n){var i=e.static,o=e.dynamic,s={};return he.forEach((function(e){function n(n,h){if(e in i){var l=n(i[e]);s[a]=vt((function(){return l}))}else if(e in o){var c=o[e];s[a]=_t(c,(function(e,n){return h(e,n,e.invoke(n,c))}))}}var a=C(e);switch(e){case"cull.enable":case"blend.enable":case"dither":case"stencil.enable":case"depth.enable":case"scissor.enable":case"polygonOffset.enable":case"sample.alpha":case"sample.enable":case"depth.mask":case"lineWidth":return n((function(e){return e}),(function(e,n,i){return i}));case"depth.func":return n((function(e){return Je[e]}),(function(e,n,i){return n.def(e.constants.compareFuncs,"[",i,"]")}));case"depth.range":return n((function(e){return e}),(function(e,n,i){return[n.def("+",i,"[0]"),n=n.def("+",i,"[1]")]}));case"blend.func":return n((function(e){return[Ye["srcRGB"in e?e.srcRGB:e.src],Ye["dstRGB"in e?e.dstRGB:e.dst],Ye["srcAlpha"in e?e.srcAlpha:e.src],Ye["dstAlpha"in e?e.dstAlpha:e.dst]]}),(function(e,n,i){function o(e,o){return n.def('"',e,o,'" in ',i,"?",i,".",e,o,":",i,".",e)}e=e.constants.blendFuncs;var s=o("src","RGB"),a=o("dst","RGB"),h=(s=n.def(e,"[",s,"]"),n.def(e,"[",o("src","Alpha"),"]"));return[s,a=n.def(e,"[",a,"]"),h,e=n.def(e,"[",o("dst","Alpha"),"]")]}));case"blend.equation":return n((function(e){return"string"==typeof e?[ee[e],ee[e]]:"object"==typeof e?[ee[e.rgb],ee[e.alpha]]:void 0}),(function(e,n,i){var o=e.constants.blendEquations,s=n.def(),a=n.def();return(e=e.cond("typeof ",i,'==="string"')).then(s,"=",a,"=",o,"[",i,"];"),e.else(s,"=",o,"[",i,".rgb];",a,"=",o,"[",i,".alpha];"),n(e),[s,a]}));case"blend.color":return n((function(e){return d(4,(function(n){return+e[n]}))}),(function(e,n,i){return d(4,(function(e){return n.def("+",i,"[",e,"]")}))}));case"stencil.mask":return n((function(e){return 0|e}),(function(e,n,i){return n.def(i,"|0")}));case"stencil.func":return n((function(e){return[Je[e.cmp||"keep"],e.ref||0,"mask"in e?e.mask:-1]}),(function(e,n,i){return[e=n.def('"cmp" in ',i,"?",e.constants.compareFuncs,"[",i,".cmp]",":",7680),n.def(i,".ref|0"),n=n.def('"mask" in ',i,"?",i,".mask|0:-1")]}));case"stencil.opFront":case"stencil.opBack":return n((function(n){return["stencil.opBack"===e?1029:1028,Ke[n.fail||"keep"],Ke[n.zfail||"keep"],Ke[n.zpass||"keep"]]}),(function(n,i,o){function s(e){return i.def('"',e,'" in ',o,"?",a,"[",o,".",e,"]:",7680)}var a=n.constants.stencilOps;return["stencil.opBack"===e?1029:1028,s("fail"),s("zfail"),s("zpass")]}));case"polygonOffset.offset":return n((function(e){return[0|e.factor,0|e.units]}),(function(e,n,i){return[n.def(i,".factor|0"),n=n.def(i,".units|0")]}));case"cull.face":return n((function(e){var n=0;return"front"===e?n=1028:"back"===e&&(n=1029),n}),(function(e,n,i){return n.def(i,'==="front"?',1028,":",1029)}));case"frontFace":return n((function(e){return $e[e]}),(function(e,n,i){return n.def(i+'==="cw"?2304:2305')}));case"colorMask":return n((function(e){return e.map((function(e){return!!e}))}),(function(e,n,i){return d(4,(function(e){return"!!"+i+"["+e+"]"}))}));case"sample.coverage":return n((function(e){return["value"in e?e.value:1,!!e.invert]}),(function(e,n,i){return[n.def('"value" in ',i,"?+",i,".value:1"),n=n.def("!!",i,".invert")]}))}})),s}function H(e,n){var i=e.static,o=e.dynamic,s={};return Object.keys(i).forEach((function(e){var n,o=i[e];if("number"==typeof o||"boolean"==typeof o)n=vt((function(){return o}));else if("function"==typeof o){var a=o._reglType;"texture2d"===a||"textureCube"===a?n=vt((function(e){return e.link(o)})):"framebuffer"!==a&&"framebufferCube"!==a||(n=vt((function(e){return e.link(o.color[0])})))}else k(o)&&(n=vt((function(e){return e.global.def("[",d(o.length,(function(e){return o[e]})),"]")})));n.value=o,s[e]=n})),Object.keys(o).forEach((function(e){var n=o[e];s[e]=_t(n,(function(e,i){return e.invoke(i,n)}))})),s}function j(e,i){var o=e.static,a=e.dynamic,h={};return Object.keys(o).forEach((function(e){var i=o[e],a=n.id(e),l=new te;if(ht(i))l.state=1,l.buffer=s.getBuffer(s.create(i,34962,!1,!0)),l.type=0;else if(A=s.getBuffer(i))l.state=1,l.buffer=A,l.type=0;else if("constant"in i){var c=i.constant;l.buffer="null",l.state=2,"number"==typeof c?l.x=c:qe.forEach((function(e,n){n<c.length&&(l[e]=c[n])}))}else{var A=ht(i.buffer)?s.getBuffer(s.create(i.buffer,34962,!1,!0)):s.getBuffer(i.buffer),f=0|i.offset,d=0|i.stride,p=0|i.size,g=!!i.normalized,v=0;"type"in i&&(v=$t[i.type]),i=0|i.divisor,l.buffer=A,l.state=1,l.size=p,l.normalized=g,l.type=v||A.dtype,l.offset=f,l.stride=d,l.divisor=i}h[e]=vt((function(e,n){var i=e.attribCache;if(a in i)return i[a];var o={isStream:!1};return Object.keys(l).forEach((function(e){o[e]=l[e]})),l.buffer&&(o.buffer=e.link(l.buffer),o.type=o.type||o.buffer+".dtype"),i[a]=o}))})),Object.keys(a).forEach((function(e){var n=a[e];h[e]=_t(n,(function(e,i){function o(e){i(c[e],"=",s,".",e,"|0;")}var s=e.invoke(i,n),a=e.constants,h=(l=e.shared).isBufferArgs,l=l.buffer,c={isStream:i.def(!1)},A=new te;A.state=1,Object.keys(A).forEach((function(e){c[e]=i.def(""+A[e])}));var f=c.buffer,d=c.type;return i("if(",h,"(",s,")){",c.isStream,"=true;",f,"=",l,".createStream(",34962,",",s,");",d,"=",f,".dtype;","}else{",f,"=",l,".getBuffer(",s,");","if(",f,"){",d,"=",f,".dtype;",'}else if("constant" in ',s,"){",c.state,"=",2,";","if(typeof "+s+'.constant === "number"){',c[qe[0]],"=",s,".constant;",qe.slice(1).map((function(e){return c[e]})).join("="),"=0;","}else{",qe.map((function(e,n){return c[e]+"="+s+".constant.length>"+n+"?"+s+".constant["+n+"]:0;"})).join(""),"}}else{","if(",h,"(",s,".buffer)){",f,"=",l,".createStream(",34962,",",s,".buffer);","}else{",f,"=",l,".getBuffer(",s,".buffer);","}",d,'="type" in ',s,"?",a.glTypes,"[",s,".type]:",f,".dtype;",c.normalized,"=!!",s,".normalized;"),o("size"),o("offset"),o("stride"),o("divisor"),i("}}"),i.exit("if(",c.isStream,"){",l,".destroyStream(",f,");","}"),c}))})),h}function W(e){var n=e.static,i=e.dynamic,o={};return Object.keys(n).forEach((function(e){var i=n[e];o[e]=vt((function(e,n){return"number"==typeof i||"boolean"==typeof i?""+i:e.link(i)}))})),Object.keys(i).forEach((function(e){var n=i[e];o[e]=_t(n,(function(e,i){return e.invoke(i,n)}))})),o}function q(e,n,o,s,a){function h(e){var n=c[e];n&&(d[e]=n)}var l=L(e,n),c=O(e,g=E(e)),f=N(e),d=z(e),p=F(e,a,l);h("viewport"),h(C("scissor.box"));var g,v=0<Object.keys(d).length;if((g={framebuffer:g,draw:f,shader:p,state:d,dirty:v,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}}).profile=I(e),g.uniforms=H(o),g.drawVAO=g.scopeVAO=f.vao,!g.drawVAO&&p.program&&!l&&i.angle_instanced_arrays&&f.static.elements){var w=!0;if(e=p.program.attributes.map((function(e){return e=n.static[e],w=w&&!!e,e})),w&&0<e.length){var P=A.getVAO(A.createVAO({attributes:e,elements:f.static.elements}));g.drawVAO=new ft(null,null,null,(function(e,n){return e.link(P)})),g.useVAO=!0}}return l?g.useVAO=!0:g.attributes=j(n),g.context=W(s),g}function Y(e,n,i){var o=e.shared.context,s=e.scope();Object.keys(i).forEach((function(a){n.save(o,"."+a);var h=i[a].append(e,n);Array.isArray(h)?s(o,".",a,"=[",h.join(),"];"):s(o,".",a,"=",h,";")})),n(s)}function J(e,n,i,o){var s,a=(l=e.shared).gl,h=l.framebuffer;ie&&(s=n.def(l.extensions,".webgl_draw_buffers"));var l=(c=e.constants).drawBuffer,c=c.backBuffer;e=i?i.append(e,n):n.def(h,".next"),o||n("if(",e,"!==",h,".cur){"),n("if(",e,"){",a,".bindFramebuffer(",36160,",",e,".framebuffer);"),ie&&n(s,".drawBuffersWEBGL(",l,"[",e,".colorAttachments.length]);"),n("}else{",a,".bindFramebuffer(",36160,",null);"),ie&&n(s,".drawBuffersWEBGL(",c,");"),n("}",h,".cur=",e,";"),o||n("}")}function $(e,n,i){var o=e.shared,s=o.gl,a=e.current,h=e.next,l=o.current,c=o.next,A=e.cond(l,".dirty");he.forEach((function(n){var o,f;if(!((n=C(n))in i.state))if(n in h){o=h[n],f=a[n];var p=d(se[n].length,(function(e){return A.def(o,"[",e,"]")}));A(e.cond(p.map((function(e,n){return e+"!=="+f+"["+n+"]"})).join("||")).then(s,".",ue[n],"(",p,");",p.map((function(e,n){return f+"["+n+"]="+e})).join(";"),";"))}else o=A.def(c,".",n),p=e.cond(o,"!==",l,".",n),A(p),n in le?p(e.cond(o).then(s,".enable(",le[n],");").else(s,".disable(",le[n],");"),l,".",n,"=",o,";"):p(s,".",ue[n],"(",o,");",l,".",n,"=",o,";")})),0===Object.keys(i.state).length&&A(l,".dirty=false;"),n(A)}function it(e,n,i,o){var s=e.shared,a=e.current,h=s.current,l=s.gl;At(Object.keys(i)).forEach((function(s){var c=i[s];if(!o||o(c)){var A=c.append(e,n);if(le[s]){var f=le[s];gt(c)?n(l,A?".enable(":".disable(",f,");"):n(e.cond(A).then(l,".enable(",f,");").else(l,".disable(",f,");")),n(h,".",s,"=",A,";")}else if(k(A)){var d=a[s];n(l,".",ue[s],"(",A,");",A.map((function(e,n){return d+"["+n+"]="+e})).join(";"),";")}else n(l,".",ue[s],"(",A,");",h,".",s,"=",A,";")}}))}function rt(e,n){ne&&(e.instancing=n.def(e.shared.extensions,".angle_instanced_arrays"))}function ot(e,n,i,o,s){function a(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function h(e){e(A=n.def(),"=",a(),";"),"string"==typeof s?e(p,".count+=",s,";"):e(p,".count++;"),v&&(o?e(f=n.def(),"=",w,".getNumPendingQueries();"):e(w,".beginQuery(",p,");"))}function l(e){e(p,".cpuTime+=",a(),"-",A,";"),v&&(o?e(w,".pushScopeStats(",f,",",w,".getNumPendingQueries(),",p,");"):e(w,".endQuery();"))}function c(e){var i=n.def(g,".profile");n(g,".profile=",e,";"),n.exit(g,".profile=",i,";")}var A,f,d=e.shared,p=e.stats,g=d.current,w=d.timer;if(i=i.profile){if(gt(i))return void(i.enable?(h(n),l(n.exit),c("true")):c("false"));c(i=i.append(e,n))}else i=n.def(g,".profile");h(d=e.block()),n("if(",i,"){",d,"}"),l(e=e.block()),n.exit("if(",i,"){",e,"}")}function st(e,n,i,o,s){function a(e){switch(e){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function h(i,o,s){function a(){n(c,".enableVertexAttribArray(",A,");");var i,a=s.type;i=s.size?n.def(s.size,"||",o):o,n(c,".bindBuffer(",34962,",",d,".buffer);",c,".vertexAttribPointer(",[A,i,a,s.normalized,s.stride,s.offset],");",f,".type=",a,";",f,".size=",i,";",g.map((function(e){return f+"."+e+"="+s[e]+";"})).join("")),ne&&n("if(",f,".divisor!==",a=s.divisor,"){",e.instancing,".vertexAttribDivisorANGLE(",[A,a],");",f,".divisor=",a,";}")}function h(){n("if(",f,".buffer){",c,".disableVertexAttribArray(",A,");",f,".buffer=null;","}if(",qe.map((function(e,n){return f+"."+e+"!=="+p[n]})).join("||"),"){",c,".vertexAttrib4f(",A,",",p,");",qe.map((function(e,n){return f+"."+e+"="+p[n]+";"})).join(""),"}")}var c=l.gl,A=n.def(i,".location"),f=n.def(l.attributes,"[",A,"]"),d=s.buffer,p=[s.x,s.y,s.z,s.w],g=["buffer","normalized","offset","stride"];1===(i=s.state)?a():2===i?h():(n("if(",i,"===",1,"){"),a(),n("}else{"),h(),n("}"))}var l=e.shared;o.forEach((function(o){var l,c=o.name,A=i.attributes[c];if(A){if(!s(A))return;l=A.append(e,n)}else{if(!s(tn))return;var f=e.scopeAttrib(c);l={},Object.keys(new te).forEach((function(e){l[e]=n.def(f,".",e)}))}h(e.link(o),a(o.info.type),l)}))}function xt(e,i,o,s,a,h){for(var l,c=e.shared,A=c.gl,f={},p=0;p<s.length;++p){var g=(T=s[p]).name,v=T.info.type,w=o.uniforms[g];if(1<(E=T.info.size)){if(!w)continue;var C=g.replace("[0]","");if(f[C])continue;f[C]=1}var P,T=e.link(T)+".location";if(w){if(!a(w))continue;if(gt(w)){if(g=w.value,35678===v||35680===v)i(A,".uniform1i(",T,",",(v=e.link(g._texture||g.color[0]._texture))+".bind());"),i.exit(v,".unbind();");else if(35674===v||35675===v||35676===v)E=e.global.def("new Float32Array(["+Array.prototype.slice.call(g)+"])"),g=2,35675===v?g=3:35676===v&&(g=4),i(A,".uniformMatrix",g,"fv(",T,",false,",E,");");else{switch(v){case 5126:l="1f";break;case 35664:l="2f";break;case 35665:l="3f";break;case 35666:l="4f";break;case 35670:case 5124:l="1i";break;case 35671:case 35667:l="2i";break;case 35672:case 35668:l="3i";break;case 35673:case 35669:l="4i"}1<E?(l+="v",g=e.global.def("["+Array.prototype.slice.call(g)+"]")):g=k(g)?Array.prototype.slice.call(g):g,i(A,".uniform",l,"(",T,",",g,");")}continue}P=w.append(e,i)}else{if(!a(tn))continue;P=i.def(c.uniforms,"[",n.id(g),"]")}switch(35678===v?i("if(",P,"&&",P,'._reglType==="framebuffer"){',P,"=",P,".color[0];","}"):35680===v&&i("if(",P,"&&",P,'._reglType==="framebufferCube"){',P,"=",P,".color[0];","}"),g=1,v){case 35678:case 35680:v=i.def(P,"._texture"),i(A,".uniform1i(",T,",",v,".bind());"),i.exit(v,".unbind();");continue;case 5124:case 35670:l="1i";break;case 35667:case 35671:l="2i",g=2;break;case 35668:case 35672:l="3i",g=3;break;case 35669:case 35673:l="4i",g=4;break;case 5126:l="1f";break;case 35664:l="2f",g=2;break;case 35665:l="3f",g=3;break;case 35666:l="4f",g=4;break;case 35674:l="Matrix2fv";break;case 35675:l="Matrix3fv";break;case 35676:l="Matrix4fv"}if(-1===l.indexOf("Matrix")&&1<E&&(l+="v",g=1),"M"===l.charAt(0)){i(A,".uniform",l,"(",T,","),T=Math.pow(v-35674+2,2);var S=e.global.def("new Float32Array(",T,")");Array.isArray(P)?i("false,(",d(T,(function(e){return S+"["+e+"]="+P[e]})),",",S,")"):i("false,(Array.isArray(",P,")||",P," instanceof Float32Array)?",P,":(",d(T,(function(e){return S+"["+e+"]="+P+"["+e+"]"})),",",S,")"),i(");")}else{if(1<g){v=[];for(var I=[],E=0;E<g;++E)Array.isArray(P)?I.push(P[E]):I.push(i.def(P+"["+E+"]")),h&&v.push(i.def());h&&i("if(!",e.batchId,"||",v.map((function(e,n){return e+"!=="+I[n]})).join("||"),"){",v.map((function(e,n){return e+"="+I[n]+";"})).join("")),i(A,".uniform",l,"(",T,",",I.join(","),");")}else h&&(v=i.def(),i("if(!",e.batchId,"||",v,"!==",P,"){",v,"=",P,";")),i(A,".uniform",l,"(",T,",",P,");");h&&i("}")}}}function wt(e,n,i,o){function s(s){var a=p[s];return a?a.append(e,a.contextDep&&o.contextDynamic||a.propDep?i:n):n.def(d,".",s)}function a(){function e(){i(c,".drawElementsInstancedANGLE(",[v,C,P,w+"<<(("+P+"-5121)>>1)",l],");")}function n(){i(c,".drawArraysInstancedANGLE(",[v,w,C,l],");")}g&&"null"!==g?T?e():(i("if(",g,"){"),e(),i("}else{"),n(),i("}")):n()}function h(){function e(){i(f+".drawElements("+[v,C,P,w+"<<(("+P+"-5121)>>1)"]+");")}function n(){i(f+".drawArrays("+[v,w,C]+");")}g&&"null"!==g?T?e():(i("if(",g,"){"),e(),i("}else{"),n(),i("}")):n()}var l,c,A=e.shared,f=A.gl,d=A.draw,p=o.draw,g=function(){var s=p.elements,a=n;return s?((s.contextDep&&o.contextDynamic||s.propDep)&&(a=i),s=s.append(e,a),p.elementsActive&&a("if("+s+")"+f+".bindBuffer(34963,"+s+".buffer.buffer);")):(s=a.def(),a(s,"=",d,".","elements",";","if(",s,"){",f,".bindBuffer(",34963,",",s,".buffer.buffer);}","else if(",A.vao,".currentVAO){",s,"=",e.shared.elements+".getElements("+A.vao,".currentVAO.elements);",oe?"":"if("+s+")"+f+".bindBuffer(34963,"+s+".buffer.buffer);","}")),s}(),v=s("primitive"),w=s("offset"),C=function(){var s=p.count,a=n;return s?((s.contextDep&&o.contextDynamic||s.propDep)&&(a=i),s=s.append(e,a)):s=a.def(d,".","count"),s}();if("number"==typeof C){if(0===C)return}else i("if(",C,"){"),i.exit("}");ne&&(l=s("instances"),c=e.instancing);var P=g+".type",T=p.elements&&gt(p.elements)&&!p.vaoActive;ne&&("number"!=typeof l||0<=l)?"string"==typeof l?(i("if(",l,">0){"),a(),i("}else if(",l,"<0){"),h(),i("}")):a():h()}function Ot(e,n,i,o,s){return s=(n=S()).proc("body",s),ne&&(n.instancing=s.def(n.shared.extensions,".angle_instanced_arrays")),e(n,s,i,o),n.compile().body}function kt(e,n,i,o){rt(e,n),i.useVAO?i.drawVAO?n(e.shared.vao,".setVAO(",i.drawVAO.append(e,n),");"):n(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(n(e.shared.vao,".setVAO(null);"),st(e,n,i,o.attributes,(function(){return!0}))),xt(e,n,i,o.uniforms,(function(){return!0}),!1),wt(e,n,n,i)}function Nt(e,n){var i=e.proc("draw",1);rt(e,i),Y(e,i,n.context),J(e,i,n.framebuffer),$(e,i,n),it(e,i,n.state),ot(e,i,n,!1,!0);var o=n.shader.progVar.append(e,i);if(i(e.shared.gl,".useProgram(",o,".program);"),n.shader.program)kt(e,i,n,n.shader.program);else{i(e.shared.vao,".setVAO(null);");var s=e.global.def("{}"),a=i.def(o,".id"),h=i.def(s,"[",a,"]");i(e.cond(h).then(h,".call(this,a0);").else(h,"=",s,"[",a,"]=",e.link((function(i){return Ot(kt,e,n,i,1)})),"(",o,");",h,".call(this,a0);"))}0<Object.keys(n.state).length&&i(e.shared.current,".dirty=true;"),e.shared.vao&&i(e.shared.vao,".setVAO(null);")}function Bt(e,n,i,o){function s(){return!0}e.batchId="a1",rt(e,n),st(e,n,i,o.attributes,s),xt(e,n,i,o.uniforms,s,!1),wt(e,n,n,i)}function Ht(e,n,i,o){function s(e){return e.contextDep&&h||e.propDep}function a(e){return!s(e)}rt(e,n);var h=i.contextDep,l=n.def(),c=n.def();e.shared.props=c,e.batchId=l;var A=e.scope(),f=e.scope();n(A.entry,"for(",l,"=0;",l,"<","a1",";++",l,"){",c,"=","a0","[",l,"];",f,"}",A.exit),i.needsContext&&Y(e,f,i.context),i.needsFramebuffer&&J(e,f,i.framebuffer),it(e,f,i.state,s),i.profile&&s(i.profile)&&ot(e,f,i,!1,!0),o?(i.useVAO?i.drawVAO?s(i.drawVAO)?f(e.shared.vao,".setVAO(",i.drawVAO.append(e,f),");"):A(e.shared.vao,".setVAO(",i.drawVAO.append(e,A),");"):A(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(A(e.shared.vao,".setVAO(null);"),st(e,A,i,o.attributes,a),st(e,f,i,o.attributes,s)),xt(e,A,i,o.uniforms,a,!1),xt(e,f,i,o.uniforms,s,!0),wt(e,A,f,i)):(n=e.global.def("{}"),o=i.shader.progVar.append(e,f),c=f.def(o,".id"),A=f.def(n,"[",c,"]"),f(e.shared.gl,".useProgram(",o,".program);","if(!",A,"){",A,"=",n,"[",c,"]=",e.link((function(n){return Ot(Bt,e,i,n,2)})),"(",o,");}",A,".call(this,a0[",l,"],",l,");"))}function Ut(e,n){function i(e){return e.contextDep&&s||e.propDep}var o=e.proc("batch",2);e.batchId="0",rt(e,o);var s=!1,a=!0;Object.keys(n.context).forEach((function(e){s=s||n.context[e].propDep})),s||(Y(e,o,n.context),a=!1);var h=!1;if((l=n.framebuffer)?(l.propDep?s=h=!0:l.contextDep&&s&&(h=!0),h||J(e,o,l)):J(e,o,null),n.state.viewport&&n.state.viewport.propDep&&(s=!0),$(e,o,n),it(e,o,n.state,(function(e){return!i(e)})),n.profile&&i(n.profile)||ot(e,o,n,!1,"a1"),n.contextDep=s,n.needsContext=a,n.needsFramebuffer=h,(a=n.shader.progVar).contextDep&&s||a.propDep)Ht(e,o,n,null);else if(a=a.append(e,o),o(e.shared.gl,".useProgram(",a,".program);"),n.shader.program)Ht(e,o,n,n.shader.program);else{o(e.shared.vao,".setVAO(null);");var l=e.global.def("{}"),c=(h=o.def(a,".id"),o.def(l,"[",h,"]"));o(e.cond(c).then(c,".call(this,a0,a1);").else(c,"=",l,"[",h,"]=",e.link((function(i){return Ot(Ht,e,n,i,2)})),"(",a,");",c,".call(this,a0,a1);"))}0<Object.keys(n.state).length&&o(e.shared.current,".dirty=true;"),e.shared.vao&&o(e.shared.vao,".setVAO(null);")}function Wt(e,i){function o(n){var o=i.shader[n];o&&s.set(a.shader,"."+n,o.append(e,s))}var s=e.proc("scope",3);e.batchId="a2";var a=e.shared,h=a.current;Y(e,s,i.context),i.framebuffer&&i.framebuffer.append(e,s),At(Object.keys(i.state)).forEach((function(n){var o=i.state[n].append(e,s);k(o)?o.forEach((function(i,o){s.set(e.next[n],"["+o+"]",i)})):s.set(a.next,"."+n,o)})),ot(e,s,i,!0,!0),["elements","offset","count","instances","primitive"].forEach((function(n){var o=i.draw[n];o&&s.set(a.draw,"."+n,""+o.append(e,s))})),Object.keys(i.uniforms).forEach((function(o){var h=i.uniforms[o].append(e,s);Array.isArray(h)&&(h="["+h.join()+"]"),s.set(a.uniforms,"["+n.id(o)+"]",h)})),Object.keys(i.attributes).forEach((function(n){var o=i.attributes[n].append(e,s),a=e.scopeAttrib(n);Object.keys(new te).forEach((function(e){s.set(a,"."+e,o[e])}))})),i.scopeVAO&&s.set(a.vao,".targetVAO",i.scopeVAO.append(e,s)),o("vert"),o("frag"),0<Object.keys(i.state).length&&(s(h,".dirty=true;"),s.exit(h,".dirty=true;")),s("a1(",e.shared.context,",a0,",e.batchId,");")}function Xt(e){if("object"==typeof e&&!k(e)){for(var n=Object.keys(e),i=0;i<n.length;++i)if(Dt.isDynamic(e[n[i]]))return!0;return!1}}function Kt(e,n,i){function o(e,n){h.forEach((function(i){var o=s[i];Dt.isDynamic(o)&&(o=e.invoke(n,o),n(f,".",i,"=",o,";"))}))}var s=n.static[i];if(s&&Xt(s)){var a=e.global,h=Object.keys(s),l=!1,c=!1,A=!1,f=e.global.def("{}");h.forEach((function(n){var i=s[n];if(Dt.isDynamic(i))"function"==typeof i&&(i=s[n]=Dt.unbox(i)),n=_t(i,null),l=l||n.thisDep,A=A||n.propDep,c=c||n.contextDep;else{switch(a(f,".",n,"="),typeof i){case"number":a(i);break;case"string":a('"',i,'"');break;case"object":Array.isArray(i)&&a("[",i.join(),"]");break;default:a(e.link(i))}a(";")}})),n.dynamic[i]=new Dt.DynamicVariable(4,{thisDep:l,contextDep:c,propDep:A,ref:f,append:o}),delete n.static[i]}}var te=A.Record,ee={add:32774,subtract:32778,"reverse subtract":32779};i.ext_blend_minmax&&(ee.min=32775,ee.max=32776);var ne=i.angle_instanced_arrays,ie=i.webgl_draw_buffers,oe=i.oes_vertex_array_object,se={dirty:!0,profile:w.profile},ae={},he=[],le={},ue={};P("dither",3024),P("blend.enable",3042),T("blend.color","blendColor",[0,0,0,0]),T("blend.equation","blendEquationSeparate",[32774,32774]),T("blend.func","blendFuncSeparate",[1,0,1,0]),P("depth.enable",2929,!0),T("depth.func","depthFunc",513),T("depth.range","depthRange",[0,1]),T("depth.mask","depthMask",!0),T("colorMask","colorMask",[!0,!0,!0,!0]),P("cull.enable",2884),T("cull.face","cullFace",1029),T("frontFace","frontFace",2305),T("lineWidth","lineWidth",1),P("polygonOffset.enable",32823),T("polygonOffset.offset","polygonOffset",[0,0]),P("sample.alpha",32926),P("sample.enable",32928),T("sample.coverage","sampleCoverage",[1,!1]),P("stencil.enable",2960),T("stencil.mask","stencilMask",-1),T("stencil.func","stencilFunc",[519,0,-1]),T("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]),T("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]),P("scissor.enable",3089),T("scissor.box","scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),T("viewport","viewport",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var ce={gl:e,context:g,strings:n,next:ae,current:se,draw:p,elements:a,buffer:s,shader:f,attributes:A.state,vao:A,uniforms:c,framebuffer:l,extensions:i,timer:v,isBufferArgs:ht},Ae={primTypes:re,compareFuncs:Je,blendFuncs:Ye,blendEquations:ee,stencilOps:Ke,glTypes:$t,orientationType:$e};ie&&(Ae.backBuffer=[1029],Ae.drawBuffer=d(o.maxDrawbuffers,(function(e){return 0===e?[0]:d(e,(function(e){return 36064+e}))})));var fe=0;return{next:ae,current:se,procs:function(){var e=S(),n=e.proc("poll"),s=e.proc("refresh"),a=e.block();n(a),s(a);var h,l=e.shared,c=l.gl,A=l.next,f=l.current;a(f,".dirty=false;"),J(e,n),J(e,s,null,!0),ne&&(h=e.link(ne)),i.oes_vertex_array_object&&s(e.link(i.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var p=0;p<o.maxAttributes;++p){var g=s.def(l.attributes,"[",p,"]"),v=e.cond(g,".buffer");v.then(c,".enableVertexAttribArray(",p,");",c,".bindBuffer(",34962,",",g,".buffer.buffer);",c,".vertexAttribPointer(",p,",",g,".size,",g,".type,",g,".normalized,",g,".stride,",g,".offset);").else(c,".disableVertexAttribArray(",p,");",c,".vertexAttrib4f(",p,",",g,".x,",g,".y,",g,".z,",g,".w);",g,".buffer=null;"),s(v),ne&&s(h,".vertexAttribDivisorANGLE(",p,",",g,".divisor);")}return s(e.shared.vao,".currentVAO=null;",e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"),Object.keys(le).forEach((function(i){var o=le[i],h=a.def(A,".",i),l=e.block();l("if(",h,"){",c,".enable(",o,")}else{",c,".disable(",o,")}",f,".",i,"=",h,";"),s(l),n("if(",h,"!==",f,".",i,"){",l,"}")})),Object.keys(ue).forEach((function(i){var o,h,l=ue[i],p=se[i],g=e.block();g(c,".",l,"("),k(p)?(l=p.length,o=e.global.def(A,".",i),h=e.global.def(f,".",i),g(d(l,(function(e){return o+"["+e+"]"})),");",d(l,(function(e){return h+"["+e+"]="+o+"["+e+"];"})).join("")),n("if(",d(l,(function(e){return o+"["+e+"]!=="+h+"["+e+"]"})).join("||"),"){",g,"}")):(o=a.def(A,".",i),h=a.def(f,".",i),g(o,");",f,".",i,"=",o,";"),n("if(",o,"!==",h,"){",g,"}")),s(g)})),e.compile()}(),compile:function(e,n,i,o,s){var a=S();a.stats=a.link(s),Object.keys(n.static).forEach((function(e){Kt(a,n,e)})),Ze.forEach((function(n){Kt(a,e,n)}));var h=q(e,n,i,o,a);return Nt(a,h),Wt(a,h),Ut(a,h),Ct(a.compile(),{destroy:function(){h.shader.program.destroy()}})}}}function wt(e,n){for(var i=0;i<e.length;++i)if(e[i]===n)return i;return-1}var Ct=function(e,n){for(var i=Object.keys(n),o=0;o<i.length;++o)e[i[o]]=n[i[o]];return e},Ot=0,Dt={DynamicVariable:e,define:function(n,o){return new e(n,i(o+""))},isDynamic:function(n){return"function"==typeof n&&!n._reglType||n instanceof e},unbox:o,accessor:i},kt={next:"function"==typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:"function"==typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout},Nt="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date},Bt=g();Bt.zero=g();var Ht=function(e,n){var i=1;n.ext_texture_filter_anisotropic&&(i=e.getParameter(34047));var o=1,s=1;n.webgl_draw_buffers&&(o=e.getParameter(34852),s=e.getParameter(36063));var a=!!n.oes_texture_float;if(a){a=e.createTexture(),e.bindTexture(3553,a),e.texImage2D(3553,0,6408,1,1,0,6408,5126,null);var h=e.createFramebuffer();if(e.bindFramebuffer(36160,h),e.framebufferTexture2D(36160,36064,3553,a,0),e.bindTexture(3553,null),36053!==e.checkFramebufferStatus(36160))a=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(16384);var l=Bt.allocType(5126,4);e.readPixels(0,0,1,1,6408,5126,l),e.getError()?a=!1:(e.deleteFramebuffer(h),e.deleteTexture(a),a=1===l[0]),Bt.freeType(l)}}return l=!0,"undefined"!=typeof navigator&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))||(l=e.createTexture(),h=Bt.allocType(5121,36),e.activeTexture(33984),e.bindTexture(34067,l),e.texImage2D(34069,0,6408,3,3,0,6408,5121,h),Bt.freeType(h),e.bindTexture(34067,null),e.deleteTexture(l),l=!e.getError()),{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(n).filter((function(e){return!!n[e]})),maxAnisotropic:i,maxDrawbuffers:o,maxColorAttachments:s,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938),readFloat:a,npotTextureCube:l}},Ut=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},Wt=function(e){return Object.keys(e).map((function(n){return e[n]}))},Xt={shape:function(e){for(var n=[];e.length;e=e[0])n.push(e.length);return n},flatten:function(e,n,i,o){var s=1;if(n.length)for(var a=0;a<n.length;++a)s*=n[a];else s=0;switch(i=o||Bt.allocType(i,s),n.length){case 0:break;case 1:for(o=n[0],n=0;n<o;++n)i[n]=e[n];break;case 2:for(o=n[0],n=n[1],a=s=0;a<o;++a)for(var h=e[a],l=0;l<n;++l)i[s++]=h[l];break;case 3:w(e,n[0],n[1],n[2],i,0);break;default:C(e,n,0,i,0)}return i}},Kt={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},$t={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},te={dynamic:35048,stream:35040,static:35044},ee=Xt.flatten,ne=Xt.shape,ie=[];ie[5120]=1,ie[5122]=2,ie[5124]=4,ie[5121]=1,ie[5123]=2,ie[5125]=4,ie[5126]=4;var re={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},oe=new Float32Array(1),se=new Uint32Array(oe.buffer),ae=[9984,9986,9985,9987],he=[0,6409,6410,6407,6408],le={};le[6409]=le[6406]=le[6402]=1,le[34041]=le[6410]=2,le[6407]=le[35904]=3,le[6408]=le[35906]=4;var ue=L("HTMLCanvasElement"),ce=L("OffscreenCanvas"),Ae=L("CanvasRenderingContext2D"),fe=L("ImageBitmap"),pe=L("HTMLImageElement"),_e=L("HTMLVideoElement"),xe=Object.keys(Kt).concat([ue,ce,Ae,fe,pe,_e]),be=[];be[5121]=1,be[5126]=4,be[36193]=2,be[5123]=2,be[5125]=4;var we=[];we[32854]=2,we[32855]=2,we[36194]=2,we[34041]=4,we[33776]=.5,we[33777]=.5,we[33778]=1,we[33779]=1,we[35986]=.5,we[35987]=1,we[34798]=1,we[35840]=.5,we[35841]=.25,we[35842]=.5,we[35843]=.25,we[36196]=.5;var ke=[];ke[32854]=2,ke[32855]=2,ke[36194]=2,ke[33189]=2,ke[36168]=1,ke[34041]=4,ke[35056]=4,ke[35907]=4,ke[34836]=16,ke[34842]=8,ke[34843]=6;var Ne=function(e,n,i,o,s){function a(e){this.id=A++,this.refCount=1,this.renderbuffer=e,this.format=32854,this.height=this.width=0,s.profile&&(this.stats={size:0})}function h(n){var i=n.renderbuffer;e.bindRenderbuffer(36161,null),e.deleteRenderbuffer(i),n.renderbuffer=null,n.refCount=0,delete f[n.id],o.renderbufferCount--}var l={rgba4:32854,rgba8:32856,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041,"depth24 stencil8":35056};n.ext_srgb&&(l.srgba=35907),n.ext_color_buffer_half_float&&(l.rgba16f=34842,l.rgb16f=34843),n.webgl_color_buffer_float&&(l.rgba32f=34836);var c=[];Object.keys(l).forEach((function(e){c[l[e]]=e}));var A=0,f={};return a.prototype.decRef=function(){0>=--this.refCount&&h(this)},s.profile&&(o.getTotalRenderbufferSize=function(){var e=0;return Object.keys(f).forEach((function(n){e+=f[n].stats.size})),e}),{create:function(n,i){function h(n,i){var o=0,a=0,f=32854,d=0;if("object"==typeof n&&n?("shape"in n?(o=0|(a=n.shape)[0],a=0|a[1]):("radius"in n&&(o=a=0|n.radius),"width"in n&&(o=0|n.width),"height"in n&&(a=0|n.height)),"format"in n&&(f=l[n.format]),"samples"in n&&(d=n.samples)):"number"==typeof n?(o=0|n,a="number"==typeof i?0|i:o):n||(o=a=1),o!==A.width||a!==A.height||f!==A.format)return h.width=A.width=o,h.height=A.height=a,h.samples=d,A.format=f,A.samples=d,e.bindRenderbuffer(36161,A.renderbuffer),d&&e.renderbufferStorageMultisample?e.renderbufferStorageMultisample(36161,d,f,o,a):e.renderbufferStorage(36161,f,o,a),s.profile&&(A.stats.size=ke[A.format]*A.width*A.height),h.format=c[A.format],h}var A=new a(e.createRenderbuffer());return f[A.id]=A,o.renderbufferCount++,h(n,i),h.resize=function(n,i){var o=0|n,a=0|i||o;if(o===A.width&&a===A.height)return h;h.width=A.width=o,h.height=A.height=a;var l=h.samples;return e.bindRenderbuffer(36161,A.renderbuffer),l&&e.renderbufferStorageMultisample?e.renderbufferStorageMultisample(36161,l,A.format,o,a):e.renderbufferStorage(36161,A.format,o,a),s.profile&&(A.stats.size=ke[A.format]*A.width*A.height),h},h._reglType="renderbuffer",h._renderbuffer=A,s.profile&&(h.stats=A.stats),h.destroy=function(){A.decRef()},h},clear:function(){Wt(f).forEach(h)},restore:function(){Wt(f).forEach((function(n){n.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,n.renderbuffer),n.samples&&e.renderbufferStorageMultisample?e.renderbufferStorageMultisample(36161,n.samples,n.format,n.width,n.height):e.renderbufferStorage(36161,n.format,n.width,n.height)})),e.bindRenderbuffer(36161,null)}}},je=[];je[6408]=4,je[6407]=3;var Ge=[];Ge[5121]=1,Ge[5126]=4,Ge[36193]=2;var qe=["x","y","z","w"],Ze="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),Ye={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Je={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Ke={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},$e={cw:2304,ccw:2305},tn=new ft(!1,!1,!1,(function(){})),en=function(e,n){function i(){this.endQueryIndex=this.startQueryIndex=-1,this.sum=0,this.stats=null}function o(e,n,o){var s=h.pop()||new i;s.startQueryIndex=e,s.endQueryIndex=n,s.sum=0,s.stats=o,l.push(s)}if(!n.ext_disjoint_timer_query)return null;var s=[],a=[],h=[],l=[],c=[],A=[];return{beginQuery:function(e){var i=s.pop()||n.ext_disjoint_timer_query.createQueryEXT();n.ext_disjoint_timer_query.beginQueryEXT(35007,i),a.push(i),o(a.length-1,a.length,e)},endQuery:function(){n.ext_disjoint_timer_query.endQueryEXT(35007)},pushScopeStats:o,update:function(){var e,i;if(0!==(e=a.length)){A.length=Math.max(A.length,e+1),c.length=Math.max(c.length,e+1),c[0]=0;var o=A[0]=0;for(i=e=0;i<a.length;++i)n.ext_disjoint_timer_query.getQueryObjectEXT(f=a[i],34919)?(o+=n.ext_disjoint_timer_query.getQueryObjectEXT(f,34918),s.push(f)):a[e++]=f,c[i+1]=o,A[i+1]=e;for(a.length=e,i=e=0;i<l.length;++i){var f,d=(o=l[i]).startQueryIndex;o.sum+=c[f=o.endQueryIndex]-c[d],(f=A[f])===(d=A[d])?(o.stats.gpuTime+=o.sum/1e6,h.push(o)):(o.startQueryIndex=d,o.endQueryIndex=f,l[e++]=o)}l.length=e}},getNumPendingQueries:function(){return a.length},clear:function(){s.push.apply(s,a);for(var e=0;e<s.length;e++)n.ext_disjoint_timer_query.deleteQueryEXT(s[e]);a.length=0,s.length=0},restore:function(){a.length=0,s.length=0}}};return function(e){function n(){if(0===_t.length)L&&L.update(),Wt=null;else{Wt=kt.next(n),g();for(var e=_t.length-1;0<=e;--e){var i=_t[e];i&&i(z,null,0)}C.flush(),L&&L.update()}}function i(){!Wt&&0<_t.length&&(Wt=kt.next(n))}function o(){Wt&&(kt.cancel(n),Wt=null)}function a(e){e.preventDefault(),o(),Ot.forEach((function(e){e()}))}function h(e){C.getError(),T.restore(),st.restore(),W.restore(),at.restore(),ht.restore(),At.restore(),ot.restore(),L&&L.restore(),ft.procs.refresh(),i(),Bt.forEach((function(e){e()}))}function l(e){function n(e,n){var i={},o={};return Object.keys(e).forEach((function(s){var a=e[s];if(Dt.isDynamic(a))o[s]=Dt.unbox(a,s);else{if(n&&Array.isArray(a))for(var h=0;h<a.length;++h)if(Dt.isDynamic(a[h]))return void(o[s]=Dt.unbox(a,s));i[s]=a}})),{dynamic:o,static:i}}function i(e){for(;d.length<e;)d.push(null);return d}var o=n(e.context||{},!0),s=n(e.uniforms||{},!0),a=n(e.attributes||{},!1);e=n(function(e){function n(e){if(e in i){var n=i[e];delete i[e],Object.keys(n).forEach((function(o){i[e+"."+o]=n[o]}))}}var i=Ct({},e);return delete i.uniforms,delete i.attributes,delete i.context,delete i.vao,"stencil"in i&&i.stencil.op&&(i.stencil.opBack=i.stencil.opFront=i.stencil.op,delete i.stencil.op),n("blend"),n("depth"),n("cull"),n("stencil"),n("polygonOffset"),n("scissor"),n("sample"),"vao"in e&&(i.vao=e.vao),i}(e),!1);var h={gpuTime:0,cpuTime:0,count:0},l=ft.compile(e,a,s,o,h),c=l.draw,A=l.batch,f=l.scope,d=[];return Ct((function(e,n){var o;if("function"==typeof e)return f.call(this,null,e,0);if("function"==typeof n)if("number"==typeof e)for(o=0;o<e;++o)f.call(this,null,n,o);else{if(!Array.isArray(e))return f.call(this,e,n,0);for(o=0;o<e.length;++o)f.call(this,e[o],n,o)}else if("number"==typeof e){if(0<e)return A.call(this,i(0|e),0|e)}else{if(!Array.isArray(e))return c.call(this,e);if(e.length)return A.call(this,e,e.length)}}),{stats:h,destroy:function(){l.destroy()}})}function c(e,n){var i=0;ft.procs.poll();var o=n.color;o&&(C.clearColor(+o[0]||0,+o[1]||0,+o[2]||0,+o[3]||0),i|=16384),"depth"in n&&(C.clearDepth(+n.depth),i|=256),"stencil"in n&&(C.clearStencil(0|n.stencil),i|=1024),C.clear(i)}function d(e){return _t.push(e),i(),{cancel:function(){function n(){var e=wt(_t,n);_t[e]=_t[_t.length-1],--_t.length,0>=_t.length&&o()}var i=wt(_t,e);_t[i]=n}}}function p(){var e=gt.viewport,n=gt.scissor_box;e[0]=e[1]=n[0]=n[1]=0,z.viewportWidth=z.framebufferWidth=z.drawingBufferWidth=e[2]=n[2]=C.drawingBufferWidth,z.viewportHeight=z.framebufferHeight=z.drawingBufferHeight=e[3]=n[3]=C.drawingBufferHeight}function g(){z.tick+=1,z.time=w(),p(),ft.procs.poll()}function v(){at.refresh(),p(),ft.procs.refresh(),L&&L.update()}function w(){return(Nt()-F)/1e3}if(!(e=A(e)))return null;var C=e.gl,P=C.getContextAttributes();C.isContextLost();var T=f(C,e);if(!T)return null;var S=s(),O={vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},k=T.extensions,L=en(C,k),F=Nt(),N=C.drawingBufferHeight,z={tick:0,time:0,viewportWidth:H=C.drawingBufferWidth,viewportHeight:N,framebufferWidth:H,framebufferHeight:N,drawingBufferWidth:H,drawingBufferHeight:N,pixelRatio:e.pixelRatio},H={elements:null,primitive:4,count:-1,offset:0,instances:-1},j=Ht(C,k),W=I(C,O,e,(function(e){return ot.destroyBuffer(e)})),J=E(C,k,W,O),ot=$(C,k,j,O,W,J,H),st=it(C,S,O,e),at=q(C,k,j,(function(){ft.procs.poll()}),z,O,e),ht=Ne(C,k,j,O,e),At=Y(C,k,j,at,ht,O),ft=xt(C,S,k,j,W,J,at,At,{},ot,st,H,z,L,e),gt=(S=rt(C,At,ft.procs.poll,z),ft.next),vt=C.canvas,_t=[],Ot=[],Bt=[],Ut=[e.onDestroy],Wt=null;vt&&(vt.addEventListener("webglcontextlost",a,!1),vt.addEventListener("webglcontextrestored",h,!1));var Xt=At.setFBO=l({framebuffer:Dt.define.call(null,1,"framebuffer")});return v(),P=Ct(l,{clear:function(e){if("framebuffer"in e)if(e.framebuffer&&"framebufferCube"===e.framebuffer_reglType)for(var n=0;6>n;++n)Xt(Ct({framebuffer:e.framebuffer.faces[n]},e),c);else Xt(e,c);else c(null,e)},prop:Dt.define.bind(null,1),context:Dt.define.bind(null,2),this:Dt.define.bind(null,3),draw:l({}),buffer:function(e){return W.create(e,34962,!1,!1)},elements:function(e){return J.create(e,!1)},texture:at.create2D,cube:at.createCube,renderbuffer:ht.create,framebuffer:At.create,framebufferCube:At.createCube,vao:ot.createVAO,attributes:P,frame:d,on:function(e,n){var i;switch(e){case"frame":return d(n);case"lost":i=Ot;break;case"restore":i=Bt;break;case"destroy":i=Ut}return i.push(n),{cancel:function(){for(var e=0;e<i.length;++e)if(i[e]===n){i[e]=i[i.length-1],i.pop();break}}}},limits:j,hasExtension:function(e){return 0<=j.extensions.indexOf(e.toLowerCase())},read:S,destroy:function(){_t.length=0,o(),vt&&(vt.removeEventListener("webglcontextlost",a),vt.removeEventListener("webglcontextrestored",h)),st.clear(),At.clear(),ht.clear(),ot.clear(),at.clear(),J.clear(),W.clear(),L&&L.clear(),Ut.forEach((function(e){e()}))},_gl:C,_refresh:v,poll:function(){g(),L&&L.update()},now:w,stats:O,blit:At.blit}),e.onDone(null,P),P}}()}(Bm);var Hm=Bm.exports,jm=zm(Hm),Um="undefined"!=typeof Float32Array?Float32Array:Array;function Gm(e,n,i){var o=n[0],s=n[1],a=n[2],h=n[3],l=n[4],c=n[5],A=n[6],f=n[7],d=n[8],p=n[9],g=n[10],v=n[11],w=n[12],C=n[13],P=n[14],T=n[15],S=i[0],I=i[1],E=i[2],O=i[3];return e[0]=S*o+I*l+E*d+O*w,e[1]=S*s+I*c+E*p+O*C,e[2]=S*a+I*A+E*g+O*P,e[3]=S*h+I*f+E*v+O*T,e[4]=(S=i[4])*o+(I=i[5])*l+(E=i[6])*d+(O=i[7])*w,e[5]=S*s+I*c+E*p+O*C,e[6]=S*a+I*A+E*g+O*P,e[7]=S*h+I*f+E*v+O*T,e[8]=(S=i[8])*o+(I=i[9])*l+(E=i[10])*d+(O=i[11])*w,e[9]=S*s+I*c+E*p+O*C,e[10]=S*a+I*A+E*g+O*P,e[11]=S*h+I*f+E*v+O*T,e[12]=(S=i[12])*o+(I=i[13])*l+(E=i[14])*d+(O=i[15])*w,e[13]=S*s+I*c+E*p+O*C,e[14]=S*a+I*A+E*g+O*P,e[15]=S*h+I*f+E*v+O*T,e}function Vm(){var e=new Um(3);return Um!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Wm(e,n,i){var o=new Um(3);return o[0]=e,o[1]=n,o[2]=i,o}function qm(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function Zm(e,n,i,o){return e[0]=n,e[1]=i,e[2]=o,e}function Qm(e,n,i){return e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e}function Xm(e,n,i){return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e}function Ym(e,n,i,o,s){return e[0]=n,e[1]=i,e[2]=o,e[3]=s,e}function Jm(e,n,i){var o=n[0],s=n[1],a=n[2],h=n[3];return e[0]=i[0]*o+i[4]*s+i[8]*a+i[12]*h,e[1]=i[1]*o+i[5]*s+i[9]*a+i[13]*h,e[2]=i[2]*o+i[6]*s+i[10]*a+i[14]*h,e[3]=i[3]*o+i[7]*s+i[11]*a+i[15]*h,e}function Km(){var e=new Um(4);return Um!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}Math.hypot||(Math.hypot=function(){for(var e=0,n=arguments.length;n--;)e+=arguments[n]*arguments[n];return Math.sqrt(e)}),Vm(),function(){var e;e=new Um(4),Um!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}();var $m,ty=function(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e};Vm(),Wm(1,0,0),Wm(0,1,0),Km(),Km(),$m=new Um(9),Um!=Float32Array&&($m[1]=0,$m[2]=0,$m[3]=0,$m[5]=0,$m[6]=0,$m[7]=0),$m[0]=1,$m[4]=1,$m[8]=1;let ey=0;function ny(e){return null==e}function iy(e){return!ny(e)}function ry(e){return!ny(e)&&("string"==typeof e||null!==e.constructor&&e.constructor===String)}function oy(e){for(let n=1;n<arguments.length;n++){const i=arguments[n];for(const n in i)e[n]=i[n]}return e}function sy(e){switch(e){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array}throw new Error("unsupported bufferView's component type: "+e)}function ay(e){return 0===e.indexOf("data:")&&e.indexOf("base64,")>0}function hy(e){const n=function(e){return"undefined"!=typeof self?self.atob(e):window.atob(e)}(e.substring(e.indexOf(",")+1)),i=n.length,o=new Uint8Array(i);for(let e=0;e<i;e++)o[e]=n.charCodeAt(e);return o.buffer}const ly=[],uy=[],cy=[],Ay=[0,0,0],fy=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}([]),dy=[1,1,1];function py(e,n,i,o,s,a,h){const l=sy(h),c=l.BYTES_PER_ELEMENT;if((0===s||s===o*c)&&a%c==0){const s=new l(n,a,i*o);return e.set(s),e}0===s&&(s=o*c);const A=new Uint8Array(o*c);for(let h=0;h<i;h++){let i=null;const f=new Uint8Array(n,s*h+a,o*c);A.set(f),i=new l(A.buffer,0,o);for(let n=0;n<o;n++)e[h*o+n]=i[n]}return e}const gy="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;function my(e,n,i){const o=new Uint8Array(e,n,i);return gy.decode(o)}const yy={get:function(e,n={},i){n||(n={});const o=new AbortController,s=o.signal,a=oy({},n);a.signal=s,a.method||(a.method="GET"),a.referrerPolicy=a.referrerPolicy||"origin","undefined"==typeof window||a.referrer||(a.referrer=window.location.href),i&&(e=i(e));const h=fetch(e,a).then((e=>{const i=this._parseResponse(e,n.responseType);return i.message?i:i.then((i=>"arraybuffer"===n.responseType?{data:i,cacheControl:e.headers.get("Cache-Control"),expires:e.headers.get("Expires"),contentType:e.headers.get("Content-Type")}:i)).catch((e=>{if(!e.code||e.code!==DOMException.ABORT_ERR)throw e}))})).catch((e=>{if(!e.code||e.code!==DOMException.ABORT_ERR)throw e}));return h.xhr=o,h},_parseResponse:(e,n)=>200!==e.status?{status:e.status,statusText:e.statusText,message:`incorrect http request with status code(${e.status}): ${e.statusText}`}:"arraybuffer"===n?e.arrayBuffer():"json"===n?e.json():e.text(),getArrayBuffer:(e,n={},i)=>(n||(n={}),n.responseType="arraybuffer",yy.get(e,n,i)),getJSON:function(e,n={},i){return n&&n.jsonp?yy.jsonp(e):((n=n||{}).responseType="json",yy.get(e,n,i))},jsonp:function(e){const n="_maptalks_jsonp_"+ey++;e.match(/\?/)?e+="&callback="+n:e+="?callback="+n;let i=document.createElement("script");return i.type="text/javascript",i.src=e,new Promise((e=>{window[n]=function(o){document.getElementsByTagName("head")[0].removeChild(i),i=null,delete window[n],e(o)},document.getElementsByTagName("head")[0].appendChild(i)}))}};let vy=class M{constructor(e,n,i,o,s){this._requestImage=e,this.decoders=n,this._supportedFormats=i,this.images={},this._imgRequests={},this._fetchOptions=o||{},this._urlModifier=s}requestImageFromBufferURI(e,n,i){if(this.buffers[e.id]){const o=this._createDataView(n,this.buffers[e.id]);return this.getImageByBuffer(o,i)}if(this._imgRequests[e.id])return this._imgRequests[e.id].then((()=>{const o=this._createDataView(n,this.buffers[e.id]);return this.getImageByBuffer(o,i)}));if(ay(e.uri)){const o=this.buffers[e.id]=hy(e.uri),s=this._createDataView(n,o);return this.getImageByBuffer(s,i)}let o;const s=e.uri.indexOf("blob:")>=0;return o=e.uri.indexOf("://")>0||s?e.uri:this.rootPath+"/"+e.uri,this._imgRequests[e.id]=yy.getArrayBuffer(o,this._fetchOptions,this._urlModifier).then((o=>{const s=this.buffers[e.id]=o.data,a=this._createDataView(n,s);return this.getImageByBuffer(a,i)}))}getImageByBuffer(e,n){if(this.images[n.id])return Promise.resolve(this.images[n.id]);const i=this.decoders;return i[n.mimeType]?i[n.mimeType](e,{supportedFormats:this._supportedFormats}):"image/crn"===n.mimeType||"image/ktx2"===n.mimeType||"image/cttf"===n.mimeType?(console.warn("missing transcoder for "+n.mimeType,", visit https://maptalks.com/docs/transcoders for details"),Promise.resolve(null)):this._getImageInfo(n.id,e)}requestExternalImage(e){if(this.images[e.id])return Promise.resolve(this.images[e.id]);const n=0===e.uri.indexOf("data:image/")?e.uri:this.rootPath+"/"+e.uri;return this._imgRequests[e.id]?this._imgRequests[e.id].then((()=>this.images[e.id])):this._imgRequests[e.id]=this._getImageInfo(e.id,n)}_getImageInfo(e,n){return new Promise(((i,o)=>{let s=n;this._urlModifier&&(s=this._urlModifier(n)),this._requestImage(s,this._fetchOptions,((s,a)=>{s?o(s):(URL.revokeObjectURL(n),this.images[e]=a,i(this.images[e]))}))}))}};const _y=["SCALAR",1,"VEC2",2,"VEC3",3,"VEC4",4,"MAT2",4,"MAT3",9,"MAT4",16],xy=[];let by=class V{constructor(e,n,i,o,s){this.rootPath=e,this.gltf=n,this._enableInterleave=!1,this.glbBuffer=i,this.buffers={},this.requests={},this.accessors={},this._compareAccessor(),this._fetchOptions=o,this._urlModifier=s}_requestData(e,n){const i=this.gltf,o=i.accessors[n];if(void 0===o.bufferView)return this.accessors[o.id]=this._toBufferData(e,n,null,0),Promise.resolve(this.accessors[o.id]);if(o&&this.accessors[o.id])return Promise.resolve(this.accessors[o.id]);return this._requestBufferOfBufferView(i.bufferViews[o.bufferView]).then((i=>{const{buffer:s,byteOffset:a}=i;return this.accessors[o.id]=this._toBufferData(e,n,s,a)}))}_requestBufferOfBufferView(e){const n=this.gltf.buffers[e.buffer];if(this.buffers[n.id]){return Promise.resolve({buffer:this.buffers[n.id],byteOffset:0})}if(this.requests[n.id])return this.requests[n.id].then((()=>Promise.resolve({buffer:this.buffers[n.id],byteOffset:0})));if("binary_glTF"!==e.buffer&&"KHR_binary_glTF"!==e.buffer&&n.uri){if(ay(n.uri)){const e=this.buffers[n.id]=hy(n.uri);return Promise.resolve({buffer:e,byteOffset:0})}let e;const i=n.uri.indexOf("blob:")>=0;return e=n.uri.indexOf("://")>0||i?n.uri:this.rootPath+"/"+n.uri,this.requests[n.id]=yy.getArrayBuffer(e,this._fetchOptions,!i&&this._urlModifier).then((o=>(i&&URL.revokeObjectURL(e),{buffer:this.buffers[n.id]=o.data,byteOffset:0})))}return Promise.resolve({buffer:this.glbBuffer.buffer,byteOffset:this.glbBuffer.byteOffset})}_toBufferData(e,n,i,o=0){const s=this.gltf,a=s.accessors[n],h=void 0!==a.bufferView?s.bufferViews[a.bufferView]:{},l=(h.byteOffset||0)+o,c=this._getTypeItemSize(a.type),A=sy(a.componentType),f=h.byteStride||0,d={array:void 0,name:e,accessorName:n,byteLength:a.count*c*A.BYTES_PER_ELEMENT,componentType:a.componentType,count:a.count,type:a.type,itemSize:c,max:a.max,min:a.min,extensions:a.extensions};if(a.min&&(d.min=a.min),a.max&&(d.max=a.max),i)if(this._enableInterleave)d.byteStride=f,d.byteOffset=l+(a.byteOffset||0),!f||f===c*A.BYTES_PER_ELEMENT||"indices"===e||"input"===e||"output"===e||e.indexOf("morph")>=0?(d.array=this._typedArray(i,a.count,c,l+(a.byteOffset||0),A),d.array.buffer.byteLength===d.byteLength&&(d.byteOffset=0)):d.array=new Uint8Array(i,l,h.byteLength);else if(a.interleaved){d.byteStride=0,d.byteOffset=0;const e=new A(a.count*c);if(d.array=py(e,i,a.count,c,f,l+(a.byteOffset||0),a.componentType),d.extensions&&d.extensions.WEB3D_quantized_attributes&&c>2){const e=new Float32Array(d.array.length),{decodeMatrix:n}=d.extensions.WEB3D_quantized_attributes;for(let i=0;i<d.array.length;i+=c){xy[0]=d.array[i],xy[1]=d.array[i+1],xy[2]=d.array[i+2],xy[3]=1;const o=Jm(xy,xy,n);e[i]=o[0],e[i+1]=o[1],e[i+2]=o[2]}d.componentType=5126,d.array=e}}else d.byteStride=0,d.array=this._typedArray(i,a.count,c,l+(a.byteOffset||0),A),d.byteOffset=d.array.byteOffset;else{d.array=new A(a.count);const e=d.min||d.max;e&&(d.array[0]=e[0],d.array[1]=e[1],d.array[2]=e[2])}return d}_compareAccessor(){const e=this.gltf.accessors;if(Array.isArray(e))for(let n=0;n<e.length;n++)for(let i=0;i<e.length;i++)n!==i&&e[n].bufferView===e[i].bufferView&&(e[n].interleaved=e[i].interleaved=!0);else for(const n in e)for(const i in e)n!==i&&e[n].bufferView===e[i].bufferView&&(e[n].interleaved=e[i].interleaved=!0)}_typedArray(e,n,i,o,s){return o%s.BYTES_PER_ELEMENT!=0&&(e=e.slice(o,o+n*i*s.BYTES_PER_ELEMENT),o=0),new s(e,o,i*n)}_getTypeItemSize(e){const n=_y.indexOf(e);return _y[n+1]}requestKHRTechniquesWebgl(e){const{shaders:n}=e,i=n.map((e=>{if(void 0!==e.bufferView){const n=this.gltf.bufferViews[e.bufferView],{byteLength:i}=n;return this._requestBufferOfBufferView(n).then((o=>{const{buffer:s,byteOffset:a}=o,h=my(s,a+(n.byteOffset||0),i);return e.content=h,e}))}if(e.uri){if(ay(e.uri)){const n=hy(e.uri),i=my(n,0,n.byteLength);return e.content=i,Promise.resolve(e)}return yy.get(this.rootPath+"/"+e.uri,this._fetchOptions,this._urlModifier).then((n=>(e.content=n,e)))}return Promise.resolve(e)}));return Promise.all(i).then((()=>e))}},wy=class D extends vy{constructor(e,n,i,o,s,a,h,l){super(o,s,a,h,l),this.rootPath=e,this.gltf=n,this.requests={},this.buffers={},this.glbBuffer=i,this.accessor=new by(e,n,i,h,l)}iterate(e,n){const i=this.gltf[n];if(!i)return;let o=0;for(const n in i)e(n,i[n],o++)}createNode(e){const n={};if(iy(e.name)&&(n.name=e.name),iy(e.children)&&(n.children=e.children),iy(e.jointName)&&(n.jointName=e.jointName),iy(e.matrix)&&(n.matrix=e.matrix),iy(e.rotation)&&(n.rotation=e.rotation),iy(e.scale)&&(n.scale=e.scale),iy(e.translation)&&(n.translation=e.translation),iy(e.extras)&&(n.extras=e.extras),iy(e.meshes)&&(n.mesh=e.meshes[0]),n.translation||n.rotation||n.scale){const e=function(e,n){if(n.matrix)return n.matrix;if(n.translation||n.scale||n.rotation){const i=function(e,n){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}(ly,n.translation||Ay),o=function(e,n){var i=n[0],o=n[1],s=n[2],a=n[3],h=i+i,l=o+o,c=s+s,A=i*h,f=o*h,d=o*l,p=s*h,g=s*l,v=s*c,w=a*h,C=a*l,P=a*c;return e[0]=1-d-v,e[1]=f+P,e[2]=p-C,e[3]=0,e[4]=f-P,e[5]=1-A-v,e[6]=g+w,e[7]=0,e[8]=p+C,e[9]=g-w,e[10]=1-A-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}(uy,n.rotation||fy),s=function(e,n){return e[0]=n[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=n[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}(cy,n.scale||dy);return Gm(s,o,s),Gm(e,i,s)}return function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}(e)}([],n);delete n.translation,delete n.rotation,delete n.scale,n.matrix=e}return n}_loadMaterials(e){const n={};for(const i in e){const o=e[i];let s,a;o.instanceTechnique&&o.instanceTechnique.values?(s=o.instanceTechnique,a=s.values.diffuse):(s=o,a=s.values.tex||s.values.diffuseTex||s.values.diffuse);const h={baseColorTexture:{index:a}};o.name&&(h.name=o.name),o.extensions&&(h.extensions=o.extensions),o.extras&&(h.extras=o.extras),n[i]=h}return n}_loadImage(e){if(e.bufferView||e.extensions&&(e.extensions.KHR_binary_glTF||e.extensions.binary_glTF)){const n=e.bufferView?e:e.extensions.KHR_binary_glTF||e.extensions.binary_glTF;e.extensions&&(e.mimeType=n.mimeType,e.width=n.width,e.height=n.height);const i=this.gltf.bufferViews[n.bufferView],o=this.buffers[n.bufferView]=new Uint8Array(this.glbBuffer.buffer,(i.byteOffset||0)+this.glbBuffer.byteOffset,i.byteLength);return this.getImageByBuffer(o,e)}return this.requestExternalImage(e)}_getTexture(e){const n=this.gltf.textures[e];if(!n)return null;const i=this.gltf.images[n.source];return this._loadImage(i).then((e=>({image:{array:e.data,width:e.width,height:e.height,index:n.source,mimeType:i.mimeType,name:i.name,extras:i.extras},sampler:this.gltf.samplers[n.sampler]})))}getBaseColorTexture(e){const n=this.gltf.materials[e];let i,o;if(n.instanceTechnique&&n.instanceTechnique.values?(i=n.instanceTechnique,o=i.values.diffuse):(i=n,o=i.values.tex||i.values.diffuseTex||i.values.diffuse),void 0===o||void 0===this.gltf.textures)return null;const s=this.gltf.textures[o];if(!s)return null;return{format:s.format||6408,internalFormat:s.internalFormat||6408,type:s.type||5121,sampler:this.gltf.samplers[s.sampler],source:this.gltf.images[s.source]}}getMaterial(){return null}getAnimations(){return null}};const Cy=9729;let Py=class U extends vy{constructor(e,n,i,o,s,a,h,l){super(o,s,a,h,l),this.rootPath=e,this.gltf=n,this.glbBuffer=i,this.buffers={},this.requests={},this.accessor=new by(e,n,i,h,l)}iterate(e,n){const i=this.gltf[n];if(i)for(let n=0;n<i.length;n++)e(n,i[n],n)}createNode(e){const n={};return oy(n,e),!iy(e.weights)&&this.gltf.meshes&&iy(n.mesh)?n.weights=this.gltf.meshes[n.mesh].weights:e.weights&&(n.weights=e.weights),n}_getTexture(e){const n=this.gltf.textures[e];if(!n)return null;let i=n.source;if(n.extensions&&n.extensions.EXT_texture_webp&&(i=n.extensions.EXT_texture_webp.source),!iy(i))return null;const o=this.gltf.images[i];return this._loadImage(o).then((e=>{if(!e)return null;const i={image:{array:e.data,mipmap:e.mipmap,width:e.width,height:e.height,index:n.source,mimeType:o.mimeType,name:o.name,extensions:o.extensions,extras:o.extras}};oy(i,n);const s=iy(n.sampler)?this.gltf.samplers[n.sampler]:void 0;if(s&&(i.sampler=s,i.sampler.magFilter=s.magFilter||Cy,i.sampler.minFilter=s.minFilter||9987,i.sampler.wrapS=s.wrapS||10497,i.sampler.wrapT=s.wrapT||10497),"image/ktx2"===i.image.mimeType&&!i.image.mipmap&&i.sampler&&i.sampler.minFilter!==Cy&&9728!==i.sampler.minFilter){const e=i.sampler.minFilter;i.sampler.minFilter=9984===e||9986===e?9728:Cy}return e.format&&(i.format=e.format),i}))}_loadImage(e){if(!iy(e.bufferView))return this.requestExternalImage(e);{const n=this.gltf.bufferViews[e.bufferView],i=this.gltf.buffers[n.buffer];if(i.uri)return this.requestImageFromBufferURI(i,n,e);if(this.glbBuffer)return this._requestFromGlbBuffer(n,e)}return null}_requestFromGlbBuffer(e,n){const i=this._createDataView(e,this.glbBuffer.buffer,this.glbBuffer.byteOffset);return this.getImageByBuffer(i,n)}_createDataView(e,n,i){i=i||0;return new Uint8Array(n,(e.byteOffset||0)+i,e.byteLength)}_transformArrayBufferToBase64(e,n){const i=new Array(e.byteLength);for(let n=0;n<e.byteLength;n++)i[n]=String.fromCharCode(e[n]);i.join("");const o="data:"+(n=n||"image/png")+";base64,"+function(e){return"undefined"!=typeof self?self.btoa(e):window.btoa(e)}(unescape(encodeURIComponent(i)));return o}getAnimations(e){const n=[];return e.forEach((e=>{n.push(this.getSamplers(e.samplers))})),Promise.all(n).then((n=>{for(let i=0;i<n.length;i++)e[i].samplers=n[i];return e}))}getSamplers(e){const n=[];for(let i=0;i<e.length;i++)(iy(e[i].input)||iy(e[i].output))&&(n.push(this.accessor._requestData("input",e[i].input)),n.push(this.accessor._requestData("output",e[i].output)));return Promise.all(n).then((n=>{for(let i=0;i<n.length/2;i++)e[i].input=n[2*i],e[i].output=n[2*i+1],e[i].interpolation||(e[i].interpolation="LINEAR");return e}))}};const My="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;let Ty=class X{static read(e,n=0,i=0){i||(i=e.byteLength);const o=new DataView(e,n,i),s=o.getUint32(4,!0);if(1===s)return X.readV1(o,n);if(2===s)return X.readV2(e,n);throw new Error("Unsupported glb version : "+s)}static readV1(e,n){const i=e.getUint32(8,!0),o=e.getUint32(12,!0);if(i!==e.byteLength)throw new Error("Length in GLB header is inconsistent with glb's byte length.");const s=Sy(e.buffer,20+n,o);return{json:JSON.parse(s),glbBuffer:{byteOffset:20+n+o,buffer:e.buffer,byteLength:i}}}static readV2(e,n){let i,o,s;const a=new DataView(e,n+12);let h=0;for(;h+8<a.byteLength;){const l=a.getUint32(h,!0);h+=4;const c=a.getUint32(h,!0);if(h+=4,1313821514===c)i=Sy(e,n+12+h,l);else if(5130562===c){s=n+12+h,o=l;break}h+=l}return{json:JSON.parse(i),glbBuffer:{byteOffset:s,buffer:e,byteLength:o}}}};function Sy(e,n,i){if(My){const o=new Uint8Array(e,n,i);return My.decode(o)}return function(e){const n=e.length;let i="";for(let o=0;o<n;){let s=e[o++];if(128&s){let i=Iy[s>>3&7];if(!(64&s)||!i||o+i>n)return null;for(s&=63>>i;i>0;i-=1){const n=e[o++];if(128!=(192&n))return null;s=s<<6|63&n}}i+=String.fromCharCode(s)}return i}(new Uint8Array(e,n,i))}const Iy=[1,1,1,1,2,2,3,0],Ey=[0,0,0],Oy=[0,0,0,1],Ry=[1,1,1],Dy={TRANSLATION:[0,0,0],ROTATION:[0,0,0,1],SCALE:[1,1,1]},ky={PREVIOUS:null,NEXT:null,PREINDEX:null,NEXTINDEX:null,INTERPOLATION:null},Ly={_getTRSW(e,n,i,o,s,a,h,l){const c=iy(e)?n.animations:[n.animations[0]],A={};for(let n=0;n<c.length;n++){const f=c[n],d=f.name||n;if(iy(e)&&d!==e)continue;const p=f.channelsMap[i];if(p)for(let e=0;e<p.length;e++){const n=p[e];"translation"===n.target.path?(this._getAnimateData(s,f.samplers[n.sampler],o,1),A.translation=qm(Ey,s)):"rotation"===n.target.path?(this._getQuaternion(a,f.samplers[n.sampler],o,1),A.rotation=ty(Oy,a)):"scale"===n.target.path?(this._getAnimateData(h,f.samplers[n.sampler],o,1),A.scale=qm(Ry,h)):"weights"===n.target.path&&l&&(this._getAnimateData(l,f.samplers[n.sampler],o,l.length),A.weights=l)}}return A},_getAnimateData(e,n,i,o){switch(n.interpolation){case"LINEAR":{const s=this._getPreNext(ky,n,i,1*o);s&&(e=function(e,n,i,o){for(let s=0;s<e.length;s++)e[s]=n[s]+o*(i[s]-n[s]);return e}(e,s.PREVIOUS,s.NEXT,s.INTERPOLATION));break}case"STEP":{const s=this._getPreNext(ky,n,i,1*o);s&&(e=function(e,n){for(let i=0;i<e.length;i++)e[i]=n[i];return e}(e,...s.PREVIOUS));break}case"CUBICSPLINE":{const s=this._getPreNext(ky,n,i,3*o);s&&(e=this._getCubicSpline(e,s,n.input.array,3*o));break}}return e},_getQuaternion(e,n,i){switch(n.interpolation){case"LINEAR":{const o=this._getPreNext(ky,n,i,1);o&&function(e,n,i,o){var s,a,h,l,c,A=n[0],f=n[1],d=n[2],p=n[3],g=i[0],v=i[1],w=i[2],C=i[3];(a=A*g+f*v+d*w+p*C)<0&&(a=-a,g=-g,v=-v,w=-w,C=-C),1-a>1e-6?(s=Math.acos(a),h=Math.sin(s),l=Math.sin((1-o)*s)/h,c=Math.sin(o*s)/h):(l=1-o,c=o),e[0]=l*A+c*g,e[1]=l*f+c*v,e[2]=l*d+c*w,e[3]=l*p+c*C}(e,o.PREVIOUS,o.NEXT,o.INTERPOLATION);break}case"STEP":{const o=this._getPreNext(ky,n,i,1);o&&(e=Ym(e,...o.PREVIOUS));break}case"CUBICSPLINE":{const o=this._getPreNext(ky,n,i,3);if(o){for(let e=0;e<o.PREVIOUS.length;e++)o.PREVIOUS[e]=Math.acos(o.PREVIOUS[e]),o.NEXT[e]=Math.acos(o.NEXT[e]);e=this._getCubicSpline(e,o,n.input.array,3);for(let n=0;n<e.length;n++)e[n]=Math.cos(e[n])}break}}return e},_search(e,n){const i=e.length;let o,s,a,h=0,l=i-1,c=Math.floor((h+l)/2);for(;h<=i-1&&l>=0;){if(h===l)return null;if(e[c]<=n&&n<=e[c+1]){const i=e[c];return o=c,s=c+1,a=(n-i)/(e[c+1]-i),{preIndx:o,nextIndex:s,interpolation:a}}n<e[c]?(l=c,c=Math.floor((h+l)/2)):e[c+1]<n&&(h=c,c=Math.floor((h+l)/2))}return null},_getPreNext(e,n,i,o){const s=n.input.array,a=n.output.array,h=n.output.itemSize;(i<s[0]||i>s[s.length-1])&&(i=Math.max(s[0],Math.min(s[s.length-1],i))),i===s[s.length-1]&&(i=s[0]);const l=this._search(s,i);if(!l||!l.nextIndex)return null;const{preIndx:c,nextIndex:A,interpolation:f}=l;e.PREINDEX=c,e.NEXTINDEX=A,e.INTERPOLATION=f;const d=h*o;return e.PREVIOUS=a.subarray(e.PREINDEX*d,(e.PREINDEX+1)*d),e.NEXT=a.subarray(e.NEXTINDEX*d,(e.NEXTINDEX+1)*d),e},_getCubicSpline(e,n,i,o){const s=n.INTERPOLATION,a=i[n.PREINDEX],h=i[n.NEXTINDEX];for(let i=0;i<3;i++){const l=n.PREVIOUS[o+i],c=(h-a)*n.PREVIOUS[2*o+i],A=n.NEXT[3+i],f=(h-a)*n.NEXT[i],d=(2*Math.pow(s,3)-3*Math.pow(s,2)+1)*l+(Math.pow(s,3)-2*Math.pow(s,2)+s)*c+(2*-Math.pow(s,3)+3*Math.pow(s,2))*A+(Math.pow(s,3)-Math.pow(s,2))*f;e[i]=d}return e},getAnimationClip(e,n,i,o){const s=e.nodes[n]&&e.nodes[n].weights;return Zm(Ey,...Dy.TRANSLATION),Ym(Oy,...Dy.ROTATION),Zm(Ry,...Dy.SCALE),this._getTRSW(o,e,n,i,Ey,Oy,Ry,s)},getTimeSpan(e){if(!e.animations)return null;if(e.timeSpan)return e.timeSpan;const n=e.animations;return e.timeSpan={},n.forEach(((n,i)=>{let o=-1/0,s=1/0;const a=n.channels;for(let e=0;e<a.length;e++){const i=n.samplers[a[e].sampler].input.array;i[i.length-1]>o&&(o=i[i.length-1]),i[0]<s&&(s=i[0])}e.timeSpan[n.name||i]={max:o,min:s}})),e.timeSpan},getTimeSpanByName(e,n){const i=this.getTimeSpan(e);return i?iy(n)?i[n]:i[Object.keys(i)[0]]:null}};let Fy=!1;if("undefined"!=typeof OffscreenCanvas){let e;try{e=new OffscreenCanvas(2,2).getContext("2d")}catch(Hst){}e&&"undefined"!=typeof createImageBitmap&&(Fy=!0)}const Ny="undefined"==typeof document?null:document.createElement("canvas");let zy=class Z{constructor(e,n,i){if(this.options=i||{},this.options.decoders||(this.options.decoders={}),this._fetchOptions=this.options.fetchOptions||{},n.buffer instanceof ArrayBuffer){const{json:i,glbBuffer:o}=Ty.read(n.buffer,n.byteOffset,n.byteLength);this._init(e,i,o)}else this._init(e,n);this._accessor=new by(this.rootPath,this.gltf,this.glbBuffer,this._fetchOptions,this.options.urlModifier),this._checkExtensions()}_checkExtensions(){const e=this.gltf.extensionsRequired;if(e){if(e.indexOf("KHR_draco_mesh_compression")>=0&&!this.options.decoders.draco)throw new Error("KHR_draco_mesh_compression is required but @maptalks/transcoders.draco is not loaded");if(e.indexOf("KHR_texture_basisu")>=0&&!this.options.decoders["image/ktx2"])throw new Error("KHR_texture_basisu is required but @maptalks/transcoders.ktx2 is not loaded");if(e.indexOf("EXT_meshopt_compression")>=0)throw new Error("EXT_meshopt_compression extension is not supported yet.")}}_loadExtensions(){const e=this.gltf.extensions;return e&&e.KHR_techniques_webgl?this._accessor.requestKHRTechniquesWebgl(e.KHR_techniques_webgl).then((n=>(e.KHR_techniques_webgl=n,e))):Promise.resolve(e)}load(e){const n=this._loadScene(e=e||{}),i=this._loadAnimations(),o=this._loadTextures(),s=this._loadExtensions();return Promise.all([n,i,o,s]).then((e=>(e[0].animations=e[1],e[0].textures=e[2],e[0].extensions=e[3],e[0].transferables=this.transferables||[],this.createChannelsMap(e[0]),e[0])))}createChannelsMap(e){const n=e.animations;if(n)for(let e=0;e<n.length;e++){const i=n[e];i.channelsMap={};for(let e=0;e<i.channels.length;e++){const n=i.channels[e];i.channelsMap[n.target.node]||(i.channelsMap[n.target.node]=[]),i.channelsMap[n.target.node].push(n)}}}getExternalResources(){const e=[];if(this.gltf){const{buffers:n,images:i}=this.gltf;for(let i=0;i<n.length;i++)n[i].uri&&n[i].uri.indexOf("data:application/octet-stream;base64")<0&&e.push({type:"buffer",uri:n[i].uri});for(let n=0;n<i.length;n++)i[n].uri&&i[n].uri.indexOf("data:image/")<0&&e.push({type:"image",uri:i[n].uri})}return e}static getAnimationClip(e,n,i,o){return Ly.getAnimationClip(e,n,i,o)}static getAnimationTimeSpan(e,n){return Ly.getTimeSpanByName(e,n)}static getTypedArrayCtor(e){return sy(e)}static readInterleavedArray(e,n,i,o,s,a,h){return py(e,n,i,o,s,a,h)}_init(e,n,i){this.gltf=n,this.glbBuffer=i,this.version=n.asset?+n.asset.version:1,this.rootPath=e,this.buffers={},this.requests={},this.options.requestImage=Fy?Wy.bind(this):this.options.requestImage||By,this.options.transferable&&(this.transferables=[]),2===this.version?(this.adapter=new Py(e,n,i,this.options.requestImage,this.options.decoders||{},this.options.supportedFormats||{},this._fetchOptions,this.options.urlModifier),this.adapter.iterate(((e,n,i)=>{n.id="buffer_"+i}),"buffers"),this.adapter.iterate(((e,n,i)=>{n.id="image_"+i}),"images"),this.adapter.iterate(((e,n,i)=>{n.id="accessor_"+i}),"accessors")):(this.adapter=new wy(e,n,i,this.options.requestImage,this.options.decoders||{},this.options.supportedFormats||{},this._fetchOptions,this.options.urlModifier),this.adapter.iterate(((e,n,i)=>{n.id="accessor_"+i}),"accessors"),this.adapter.iterate(((e,n,i)=>{n.id="image_"+i}),"images"))}_parseNodes(e,n){if(e.children&&e.children.length>0){if(!("number"==typeof(i=e.children[0])&&isFinite(i)||ry(e.children[0])))return e;const o=e.children.map((e=>{const i=n[e];return i.nodeIndex=e,this._parseNodes(i,n)}));e.children=o}var i;return e}_loadScene(e){return this._loadNodes(e).then((e=>{const n=this.scenes=[];let i;for(const n in e)e[n]=this._parseNodes(e[n],e),e[n].nodeIndex=Number(n)?Number(n):n;this.adapter.iterate(((o,s,a)=>{const h={};s.name&&(h.name=s.name),s.nodes&&(h.nodes=s.nodes.map((n=>e[n]))),this.gltf.scene===o&&(i=a),n.push(h)}),"scenes");const o={textures:this.gltf.textures,asset:this.gltf.asset,scene:i,scenes:n,nodes:e,meshes:this.meshes,materials:this.gltf.materials,skins:this.skins,extensionsRequired:this.gltf.extensionsRequired,extensionsUsed:this.gltf.extensionsUsed};if(this.gltf.extensions&&(o.extensions=this.gltf.extensions),1===this.version){const e=this.adapter._loadMaterials(this.gltf.materials);o.materials=e}return delete this.gltf.buffers,o.json=this.gltf,o}))}_loadNodes(e){return this._loadMeshes(e).then((()=>{const e=this.nodes={};return this.adapter.iterate(((n,i)=>{const o=this.adapter.createNode(i,this.meshes,this.skins);e[n]=o}),"nodes"),e}))}_loadSkins(){this.skins=[];const e=[];return this.adapter.iterate(((n,i,o)=>{e.push(this._loadSkin(i).then((e=>{e.index=o,this.skins.push(e)})))}),"skins"),e}_loadSkin(e){return this.adapter.accessor._requestData("inverseBindMatrices",e.inverseBindMatrices).then((n=>(e.inverseBindMatrices=n,n&&n.buffer&&this.transferables&&this.transferables.indexOf(n.buffer)<0&&this.transferables.push(n.buffer),e)))}_loadAnimations(){const e=this.gltf.animations;return iy(e)?this.adapter.getAnimations(e):null}_loadMeshes(e){this.meshes={};let n=[];return this.adapter.iterate(((i,o,s)=>{n.push(this._loadMesh(o,e).then((e=>{e.index=s,this.meshes[i]=e})))}),"meshes"),n=n.concat(this._loadSkins()),Promise.all(n)}_loadMesh(e,n){const i=e.primitives.map((e=>this._loadPrimitive(e,n))).filter((e=>!!e));return Promise.all(i).then((n=>{const i={};return oy(i,e),i.primitives=n,i}))}_loadTextures(){const e=this.gltf.textures;if(!e)return null;const n=[];for(const i in e)n.push(this.adapter._getTexture(i));return Promise.all(n).then((n=>{if(this.transferables)for(let e=0;e<n.length;e++){const i=n[e]&&n[e].image.array;if(i){let e;e=i instanceof ImageBitmap?i:i.buffer,e&&this.transferables.indexOf(e)<0&&this.transferables.push(e)}}if(!Array.isArray(e)){const i={},o=Object.keys(e);for(let e=0;e<n.length;e++)n[e]&&(i[o[e]]=n[e]);return i}return n}))}_loadPrimitive(e,n){let i;const o=[],s=e.extensions;if(iy(e.targets))for(let n=0;n<e.targets.length;n++){const i=e.targets[n];for(const e in i){const s=this.adapter.accessor._requestData(`morphTargets_${e}_${n}`,i[e]);s&&o.push(s)}}if(s&&s.KHR_draco_mesh_compression){if(!this.options.decoders.draco&&(!this.gltf.extensionsRequired||!this.gltf.extensionsRequired.indexOf("KHR_draco_mesh_compression")<0))return null;const e=this.options.decoders.draco,{bufferView:a,attributes:h}=s.KHR_draco_mesh_compression,l=this.gltf.bufferViews[a],c=this._accessor._requestBufferOfBufferView(l).then((i=>{const{buffer:o,byteOffset:s}=i;let{byteOffset:a}=l;a||(a=0);const c=new DataView(o,s+a,l.byteLength);return e(c,{attributes:h,useUniqueIDs:!1,skipAttributeTransform:n.skipAttributeTransform}).then((e=>{const n=Object.values(e.attributes);return e.indices&&n.push(e.indices),n}))}));o.push(c),i=Promise.all(o)}else{const n=e.attributes;for(const e in n){const i=this.adapter.accessor._requestData(e,n[e]);i&&o.push(i)}if(iy(e.indices)){const n=this.adapter.accessor._requestData("indices",e.indices);n&&o.push(n)}i=Promise.all(o)}return i.then((n=>{if(s&&s.KHR_draco_mesh_compression){const i=e.targets?e.targets.length:0;n[i]=n[i].concat(n.slice(0,i)),n=n[i]}let i,o;const a={attributes:n.reduce(((e,n)=>{if("indices"===n.name)i=n;else if(n.name.indexOf("morphTargets_")>-1)o=o||{},o[n.name.slice(13)]=n;else{if(!("POSITION"!==n.name||n.min&&n.max)){const e=[1/0,1/0,1/0],i=[-1/0,-1/0,-1/0],{itemSize:o,array:s}=n,a=s.length/o;for(let n=0;n<a;n++)for(let a=0;a<o;a++){const h=n*o+a;s[h]<e[a]&&(e[a]=s[h]),s[h]>i[a]&&(i[a]=s[h])}if(n.quantization){const o=n.quantization,s=o.range/(1<<o.quantizationBits),a=o.minValues;Xm(e,e,s),Qm(e,e,a),Xm(i,i,s),Qm(i,i,a)}n.min=e,n.max=i}e[n.name]=n}return this.transferables&&n.array.buffer&&this.transferables.indexOf(n.array.buffer)<0&&this.transferables.push(n.array.buffer),e}),{}),material:e.material};return i&&(a.indices=i),o&&(a.morphTargets=o),a.mode=iy(e.mode)?e.mode:4,iy(e.extras)&&(a.extras=e.extras),a}))}};function By(e,n,i){const o=new Image;o.crossOrigin="",o.onload=()=>{if(!Ny)return void i(new Error("There is no canvas to draw image!"));Ny.width=o.width,Ny.height=o.height;const e=Ny.getContext("2d",{willReadFrequently:!0});e.drawImage(o,0,0,o.width,o.height);const n=e.getImageData(0,0,o.width,o.height),s={width:o.width,height:o.height,data:new Uint8Array(n.data)};i(null,s)},o.onerror=function(e){i(e)},o.src=e}const Hy=[],jy=[],Uy=30;let Gy,Vy;function Wy(e,n,i){Gy||(Gy=new OffscreenCanvas(2,2),Vy=Gy.getContext("2d",{willReadFrequently:!0}));let o=null;if(ry(e))this.options.urlModifier&&(e=this.options.urlModifier(e)),Hy.push([e,n,i,this]),qy();else{const n=new Blob([e]);o=createImageBitmap(n),o.then(Zy.bind(this)).then((e=>{i(null,e)})).catch((e=>{console.warn(e),i(e)}))}}function qy(){if(!Hy.length||jy.length>Uy)return;const e=Hy.shift(),[n,i,o,s]=e;jy.push(e),fetch(n,i).then((e=>e.arrayBuffer())).then((e=>{const n=new Blob([new Uint8Array(e)]);return createImageBitmap(n)})).then(Zy.bind(s)).then((n=>{o.call(s,null,n);const i=jy.indexOf(e);jy.splice(i,1),qy()})).catch((n=>{console.warn(n),o.call(s,n);const i=jy.indexOf(e);jy.splice(i,1),qy()}))}function Zy(e){let{width:n,height:i}=e;Qy(n)||(n=Xy(n)),Qy(i)||(i=Xy(i));const o=this.options.maxTextureSize;o&&(n=Math.min(o,n),i=Math.min(o,i)),Gy.width=n,Gy.height=i,Vy.drawImage(e,0,0,n,i),e.close();const s=Vy.getImageData(0,0,n,i);return{width:n,height:i,data:new Uint8Array(s.data)}}function Qy(e){return!(e&e-1)&&0!==e}function Xy(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}var Yy=1e-6,Jy="undefined"!=typeof Float32Array?Float32Array:Array,Ky=Math.random;var $y=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,n=arguments.length;n--;)e+=arguments[n]*arguments[n];return Math.sqrt(e)});var tv=Object.freeze({__proto__:null,get ARRAY_TYPE(){return Jy},EPSILON:Yy,RANDOM:Ky,equals:function(e,n){return Math.abs(e-n)<=Yy*Math.max(1,Math.abs(e),Math.abs(n))},setMatrixArrayType:function(e){Jy=e},toRadian:function(e){return e*$y}});function ev(e,n,i,o,s){return e[0]=n,e[1]=i,e[2]=o,e[3]=s,e}function nv(e,n,i){var o=n[0],s=n[1],a=n[2],h=n[3],l=i[0],c=i[1],A=i[2],f=i[3];return e[0]=o*l+a*c,e[1]=s*l+h*c,e[2]=o*A+a*f,e[3]=s*A+h*f,e}function iv(e,n){var i=Math.sin(n),o=Math.cos(n);return e[0]=o,e[1]=i,e[2]=-i,e[3]=o,e}function rv(e,n,i){return e[0]=n[0]-i[0],e[1]=n[1]-i[1],e[2]=n[2]-i[2],e[3]=n[3]-i[3],e}var ov=Object.freeze({__proto__:null,LDU:function(e,n,i,o){return e[2]=o[2]/o[0],i[0]=o[0],i[1]=o[1],i[3]=o[3]-e[2]*i[1],[e,n,i]},add:function(e,n,i){return e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e[3]=n[3]+i[3],e},adjoint:function(e,n){var i=n[0];return e[0]=n[3],e[1]=-n[1],e[2]=-n[2],e[3]=i,e},clone:function(e){var n=new Jy(4);return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n},copy:function(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e},create:function(){var e=new Jy(4);return Jy!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},determinant:function(e){return e[0]*e[3]-e[2]*e[1]},equals:function(e,n){var i=e[0],o=e[1],s=e[2],a=e[3],h=n[0],l=n[1],c=n[2],A=n[3];return Math.abs(i-h)<=Yy*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(o-l)<=Yy*Math.max(1,Math.abs(o),Math.abs(l))&&Math.abs(s-c)<=Yy*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(a-A)<=Yy*Math.max(1,Math.abs(a),Math.abs(A))},exactEquals:function(e,n){return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]&&e[3]===n[3]},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3])},fromRotation:iv,fromScaling:function(e,n){return e[0]=n[0],e[1]=0,e[2]=0,e[3]=n[1],e},fromValues:function(e,n,i,o){var s=new Jy(4);return s[0]=e,s[1]=n,s[2]=i,s[3]=o,s},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},invert:function(e,n){var i=n[0],o=n[1],s=n[2],a=n[3],h=i*a-s*o;return h?(e[0]=a*(h=1/h),e[1]=-o*h,e[2]=-s*h,e[3]=i*h,e):null},mul:nv,multiply:nv,multiplyScalar:function(e,n,i){return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=n[3]*i,e},multiplyScalarAndAdd:function(e,n,i,o){return e[0]=n[0]+i[0]*o,e[1]=n[1]+i[1]*o,e[2]=n[2]+i[2]*o,e[3]=n[3]+i[3]*o,e},rotate:function(e,n,i){var o=n[0],s=n[1],a=n[2],h=n[3],l=Math.sin(i),c=Math.cos(i);return e[0]=o*c+a*l,e[1]=s*c+h*l,e[2]=o*-l+a*c,e[3]=s*-l+h*c,e},scale:function(e,n,i){var o=n[1],s=n[2],a=n[3],h=i[0],l=i[1];return e[0]=n[0]*h,e[1]=o*h,e[2]=s*l,e[3]=a*l,e},set:ev,str:function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},sub:rv,subtract:rv,transpose:function(e,n){if(e===n){var i=n[1];e[1]=n[2],e[2]=i}else e[0]=n[0],e[1]=n[2],e[2]=n[1],e[3]=n[3];return e}});function sv(e,n,i){var o=n[0],s=n[1],a=n[2],h=n[3],l=n[4],c=n[5],A=i[0],f=i[1],d=i[2],p=i[3],g=i[4],v=i[5];return e[0]=o*A+a*f,e[1]=s*A+h*f,e[2]=o*d+a*p,e[3]=s*d+h*p,e[4]=o*g+a*v+l,e[5]=s*g+h*v+c,e}function av(e,n,i){return e[0]=n[0]-i[0],e[1]=n[1]-i[1],e[2]=n[2]-i[2],e[3]=n[3]-i[3],e[4]=n[4]-i[4],e[5]=n[5]-i[5],e}var hv=Object.freeze({__proto__:null,add:function(e,n,i){return e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e[3]=n[3]+i[3],e[4]=n[4]+i[4],e[5]=n[5]+i[5],e},clone:function(e){var n=new Jy(6);return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n},copy:function(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e},create:function(){var e=new Jy(6);return Jy!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e},determinant:function(e){return e[0]*e[3]-e[1]*e[2]},equals:function(e,n){var i=e[0],o=e[1],s=e[2],a=e[3],h=e[4],l=e[5],c=n[0],A=n[1],f=n[2],d=n[3],p=n[4],g=n[5];return Math.abs(i-c)<=Yy*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(o-A)<=Yy*Math.max(1,Math.abs(o),Math.abs(A))&&Math.abs(s-f)<=Yy*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(a-d)<=Yy*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(h-p)<=Yy*Math.max(1,Math.abs(h),Math.abs(p))&&Math.abs(l-g)<=Yy*Math.max(1,Math.abs(l),Math.abs(g))},exactEquals:function(e,n){return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]&&e[3]===n[3]&&e[4]===n[4]&&e[5]===n[5]},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)},fromRotation:function(e,n){var i=Math.sin(n),o=Math.cos(n);return e[0]=o,e[1]=i,e[2]=-i,e[3]=o,e[4]=0,e[5]=0,e},fromScaling:function(e,n){return e[0]=n[0],e[1]=0,e[2]=0,e[3]=n[1],e[4]=0,e[5]=0,e},fromTranslation:function(e,n){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=n[0],e[5]=n[1],e},fromValues:function(e,n,i,o,s,a){var h=new Jy(6);return h[0]=e,h[1]=n,h[2]=i,h[3]=o,h[4]=s,h[5]=a,h},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},invert:function(e,n){var i=n[0],o=n[1],s=n[2],a=n[3],h=n[4],l=n[5],c=i*a-o*s;return c?(e[0]=a*(c=1/c),e[1]=-o*c,e[2]=-s*c,e[3]=i*c,e[4]=(s*l-a*h)*c,e[5]=(o*h-i*l)*c,e):null},mul:sv,multiply:sv,multiplyScalar:function(e,n,i){return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=n[3]*i,e[4]=n[4]*i,e[5]=n[5]*i,e},multiplyScalarAndAdd:function(e,n,i,o){return e[0]=n[0]+i[0]*o,e[1]=n[1]+i[1]*o,e[2]=n[2]+i[2]*o,e[3]=n[3]+i[3]*o,e[4]=n[4]+i[4]*o,e[5]=n[5]+i[5]*o,e},rotate:function(e,n,i){var o=n[0],s=n[1],a=n[2],h=n[3],l=n[4],c=n[5],A=Math.sin(i),f=Math.cos(i);return e[0]=o*f+a*A,e[1]=s*f+h*A,e[2]=o*-A+a*f,e[3]=s*-A+h*f,e[4]=l,e[5]=c,e},scale:function(e,n,i){var o=n[1],s=n[2],a=n[3],h=n[4],l=n[5],c=i[0],A=i[1];return e[0]=n[0]*c,e[1]=o*c,e[2]=s*A,e[3]=a*A,e[4]=h,e[5]=l,e},set:function(e,n,i,o,s,a,h){return e[0]=n,e[1]=i,e[2]=o,e[3]=s,e[4]=a,e[5]=h,e},str:function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},sub:av,subtract:av,translate:function(e,n,i){var o=n[0],s=n[1],a=n[2],h=n[3],l=n[4],c=n[5],A=i[0],f=i[1];return e[0]=o,e[1]=s,e[2]=a,e[3]=h,e[4]=o*A+a*f+l,e[5]=s*A+h*f+c,e}});function lv(){var e=new Jy(9);return Jy!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function uv(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[4],e[4]=n[5],e[5]=n[6],e[6]=n[8],e[7]=n[9],e[8]=n[10],e}function cv(e,n,i,o,s,a,h,l,c,A){return e[0]=n,e[1]=i,e[2]=o,e[3]=s,e[4]=a,e[5]=h,e[6]=l,e[7]=c,e[8]=A,e}function Av(e,n){if(e===n){var i=n[1],o=n[2],s=n[5];e[1]=n[3],e[2]=n[6],e[3]=i,e[5]=n[7],e[6]=o,e[7]=s}else e[0]=n[0],e[1]=n[3],e[2]=n[6],e[3]=n[1],e[4]=n[4],e[5]=n[7],e[6]=n[2],e[7]=n[5],e[8]=n[8];return e}function fv(e,n){var i=n[0],o=n[1],s=n[2],a=n[3],h=n[4],l=n[5],c=n[6],A=n[7],f=n[8],d=f*h-l*A,p=-f*a+l*c,g=A*a-h*c,v=i*d+o*p+s*g;return v?(e[0]=d*(v=1/v),e[1]=(-f*o+s*A)*v,e[2]=(l*o-s*h)*v,e[3]=p*v,e[4]=(f*i-s*c)*v,e[5]=(-l*i+s*a)*v,e[6]=g*v,e[7]=(-A*i+o*c)*v,e[8]=(h*i-o*a)*v,e):null}function dv(e,n,i){var o=n[0],s=n[1],a=n[2],h=n[3],l=n[4],c=n[5],A=n[6],f=n[7],d=n[8],p=i[0],g=i[1],v=i[2],w=i[3],C=i[4],P=i[5],T=i[6],S=i[7],I=i[8];return e[0]=p*o+g*h+v*A,e[1]=p*s+g*l+v*f,e[2]=p*a+g*c+v*d,e[3]=w*o+C*h+P*A,e[4]=w*s+C*l+P*f,e[5]=w*a+C*c+P*d,e[6]=T*o+S*h+I*A,e[7]=T*s+S*l+I*f,e[8]=T*a+S*c+I*d,e}function pv(e,n){var i=Math.sin(n),o=Math.cos(n);return e[0]=o,e[1]=i,e[2]=0,e[3]=-i,e[4]=o,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function gv(e,n){var i=n[0],o=n[1],s=n[2],a=n[3],h=i+i,l=o+o,c=s+s,A=i*h,f=o*h,d=o*l,p=s*h,g=s*l,v=s*c,w=a*h,C=a*l,P=a*c;return e[0]=1-d-v,e[3]=f-P,e[6]=p+C,e[1]=f+P,e[4]=1-A-v,e[7]=g-w,e[2]=p-C,e[5]=g+w,e[8]=1-A-d,e}function mv(e,n,i){return e[0]=n[0]-i[0],e[1]=n[1]-i[1],e[2]=n[2]-i[2],e[3]=n[3]-i[3],e[4]=n[4]-i[4],e[5]=n[5]-i[5],e[6]=n[6]-i[6],e[7]=n[7]-i[7],e[8]=n[8]-i[8],e}var yv=Object.freeze({__proto__:null,add:function(e,n,i){return e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e[3]=n[3]+i[3],e[4]=n[4]+i[4],e[5]=n[5]+i[5],e[6]=n[6]+i[6],e[7]=n[7]+i[7],e[8]=n[8]+i[8],e},adjoint:function(e,n){var i=n[0],o=n[1],s=n[2],a=n[3],h=n[4],l=n[5],c=n[6],A=n[7],f=n[8];return e[0]=h*f-l*A,e[1]=s*A-o*f,e[2]=o*l-s*h,e[3]=l*c-a*f,e[4]=i*f-s*c,e[5]=s*a-i*l,e[6]=a*A-h*c,e[7]=o*c-i*A,e[8]=i*h-o*a,e},clone:function(e){var n=new Jy(9);return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n},copy:function(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e},create:lv,determinant:function(e){var n=e[3],i=e[4],o=e[5],s=e[6],a=e[7],h=e[8];return e[0]*(h*i-o*a)+e[1]*(-h*n+o*s)+e[2]*(a*n-i*s)},equals:function(e,n){var i=e[0],o=e[1],s=e[2],a=e[3],h=e[4],l=e[5],c=e[6],A=e[7],f=e[8],d=n[0],p=n[1],g=n[2],v=n[3],w=n[4],C=n[5],P=n[6],T=n[7],S=n[8];return Math.abs(i-d)<=Yy*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(o-p)<=Yy*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(s-g)<=Yy*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(a-v)<=Yy*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(h-w)<=Yy*Math.max(1,Math.abs(h),Math.abs(w))&&Math.abs(l-C)<=Yy*Math.max(1,Math.abs(l),Math.abs(C))&&Math.abs(c-P)<=Yy*Math.max(1,Math.abs(c),Math.abs(P))&&Math.abs(A-T)<=Yy*Math.max(1,Math.abs(A),Math.abs(T))&&Math.abs(f-S)<=Yy*Math.max(1,Math.abs(f),Math.abs(S))},exactEquals:function(e,n){return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]&&e[3]===n[3]&&e[4]===n[4]&&e[5]===n[5]&&e[6]===n[6]&&e[7]===n[7]&&e[8]===n[8]},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},fromMat2d:function(e,n){return e[0]=n[0],e[1]=n[1],e[2]=0,e[3]=n[2],e[4]=n[3],e[5]=0,e[6]=n[4],e[7]=n[5],e[8]=1,e},fromMat4:uv,fromQuat:gv,fromRotation:pv,fromScaling:function(e,n){return e[0]=n[0],e[1]=0,e[2]=0,e[3]=0,e[4]=n[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromTranslation:function(e,n){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=n[0],e[7]=n[1],e[8]=1,e},fromValues:function(e,n,i,o,s,a,h,l,c){var A=new Jy(9);return A[0]=e,A[1]=n,A[2]=i,A[3]=o,A[4]=s,A[5]=a,A[6]=h,A[7]=l,A[8]=c,A},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},invert:fv,mul:dv,multiply:dv,multiplyScalar:function(e,n,i){return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=n[3]*i,e[4]=n[4]*i,e[5]=n[5]*i,e[6]=n[6]*i,e[7]=n[7]*i,e[8]=n[8]*i,e},multiplyScalarAndAdd:function(e,n,i,o){return e[0]=n[0]+i[0]*o,e[1]=n[1]+i[1]*o,e[2]=n[2]+i[2]*o,e[3]=n[3]+i[3]*o,e[4]=n[4]+i[4]*o,e[5]=n[5]+i[5]*o,e[6]=n[6]+i[6]*o,e[7]=n[7]+i[7]*o,e[8]=n[8]+i[8]*o,e},normalFromMat4:function(e,n){var i=n[0],o=n[1],s=n[2],a=n[3],h=n[4],l=n[5],c=n[6],A=n[7],f=n[8],d=n[9],p=n[10],g=n[11],v=n[12],w=n[13],C=n[14],P=n[15],T=i*l-o*h,S=i*c-s*h,I=i*A-a*h,E=o*c-s*l,O=o*A-a*l,k=s*A-a*c,L=f*w-d*v,F=f*C-p*v,N=f*P-g*v,z=d*C-p*w,H=d*P-g*w,j=p*P-g*C,W=T*j-S*H+I*z+E*N-O*F+k*L;return W?(e[0]=(l*j-c*H+A*z)*(W=1/W),e[1]=(c*N-h*j-A*F)*W,e[2]=(h*H-l*N+A*L)*W,e[3]=(s*H-o*j-a*z)*W,e[4]=(i*j-s*N+a*F)*W,e[5]=(o*N-i*H-a*L)*W,e[6]=(w*k-C*O+P*E)*W,e[7]=(C*I-v*k-P*S)*W,e[8]=(v*O-w*I+P*T)*W,e):null},projection:function(e,n,i){return e[0]=2/n,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/i,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},rotate:function(e,n,i){var o=n[0],s=n[1],a=n[2],h=n[3],l=n[4],c=n[5],A=n[6],f=n[7],d=n[8],p=Math.sin(i),g=Math.cos(i);return e[0]=g*o+p*h,e[1]=g*s+p*l,e[2]=g*a+p*c,e[3]=g*h-p*o,e[4]=g*l-p*s,e[5]=g*c-p*a,e[6]=A,e[7]=f,e[8]=d,e},scale:function(e,n,i){var o=i[0],s=i[1];return e[0]=o*n[0],e[1]=o*n[1],e[2]=o*n[2],e[3]=s*n[3],e[4]=s*n[4],e[5]=s*n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e},set:cv,str:function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},sub:mv,subtract:mv,translate:function(e,n,i){var o=n[0],s=n[1],a=n[2],h=n[3],l=n[4],c=n[5],A=n[6],f=n[7],d=n[8],p=i[0],g=i[1];return e[0]=o,e[1]=s,e[2]=a,e[3]=h,e[4]=l,e[5]=c,e[6]=p*o+g*h+A,e[7]=p*s+g*l+f,e[8]=p*a+g*c+d,e},transpose:Av});function vv(){var e=new Jy(16);return Jy!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function _v(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e}function xv(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function bv(e,n){if(e===n){var i=n[1],o=n[2],s=n[3],a=n[6],h=n[7],l=n[11];e[1]=n[4],e[2]=n[8],e[3]=n[12],e[4]=i,e[6]=n[9],e[7]=n[13],e[8]=o,e[9]=a,e[11]=n[14],e[12]=s,e[13]=h,e[14]=l}else e[0]=n[0],e[1]=n[4],e[2]=n[8],e[3]=n[12],e[4]=n[1],e[5]=n[5],e[6]=n[9],e[7]=n[13],e[8]=n[2],e[9]=n[6],e[10]=n[10],e[11]=n[14],e[12]=n[3],e[13]=n[7],e[14]=n[11],e[15]=n[15];return e}function wv(e,n){var i=n[0],o=n[1],s=n[2],a=n[3],h=n[4],l=n[5],c=n[6],A=n[7],f=n[8],d=n[9],p=n[10],g=n[11],v=n[12],w=n[13],C=n[14],P=n[15],T=i*l-o*h,S=i*c-s*h,I=i*A-a*h,E=o*c-s*l,O=o*A-a*l,k=s*A-a*c,L=f*w-d*v,F=f*C-p*v,N=f*P-g*v,z=d*C-p*w,H=d*P-g*w,j=p*P-g*C,W=T*j-S*H+I*z+E*N-O*F+k*L;return W?(e[0]=(l*j-c*H+A*z)*(W=1/W),e[1]=(s*H-o*j-a*z)*W,e[2]=(w*k-C*O+P*E)*W,e[3]=(p*O-d*k-g*E)*W,e[4]=(c*N-h*j-A*F)*W,e[5]=(i*j-s*N+a*F)*W,e[6]=(C*I-v*k-P*S)*W,e[7]=(f*k-p*I+g*S)*W,e[8]=(h*H-l*N+A*L)*W,e[9]=(o*N-i*H-a*L)*W,e[10]=(v*O-w*I+P*T)*W,e[11]=(d*I-f*O-g*T)*W,e[12]=(l*F-h*z-c*L)*W,e[13]=(i*z-o*F+s*L)*W,e[14]=(w*S-v*E-C*T)*W,e[15]=(f*E-d*S+p*T)*W,e):null}function Cv(e,n,i){var o=n[0],s=n[1],a=n[2],h=n[3],l=n[4],c=n[5],A=n[6],f=n[7],d=n[8],p=n[9],g=n[10],v=n[11],w=n[12],C=n[13],P=n[14],T=n[15],S=i[0],I=i[1],E=i[2],O=i[3];return e[0]=S*o+I*l+E*d+O*w,e[1]=S*s+I*c+E*p+O*C,e[2]=S*a+I*A+E*g+O*P,e[3]=S*h+I*f+E*v+O*T,e[4]=(S=i[4])*o+(I=i[5])*l+(E=i[6])*d+(O=i[7])*w,e[5]=S*s+I*c+E*p+O*C,e[6]=S*a+I*A+E*g+O*P,e[7]=S*h+I*f+E*v+O*T,e[8]=(S=i[8])*o+(I=i[9])*l+(E=i[10])*d+(O=i[11])*w,e[9]=S*s+I*c+E*p+O*C,e[10]=S*a+I*A+E*g+O*P,e[11]=S*h+I*f+E*v+O*T,e[12]=(S=i[12])*o+(I=i[13])*l+(E=i[14])*d+(O=i[15])*w,e[13]=S*s+I*c+E*p+O*C,e[14]=S*a+I*A+E*g+O*P,e[15]=S*h+I*f+E*v+O*T,e}function Pv(e,n,i){var o,s,a,h,l,c,A,f,d,p,g,v,w=i[0],C=i[1],P=i[2];return n===e?(e[12]=n[0]*w+n[4]*C+n[8]*P+n[12],e[13]=n[1]*w+n[5]*C+n[9]*P+n[13],e[14]=n[2]*w+n[6]*C+n[10]*P+n[14],e[15]=n[3]*w+n[7]*C+n[11]*P+n[15]):(s=n[1],a=n[2],h=n[3],l=n[4],c=n[5],A=n[6],f=n[7],d=n[8],p=n[9],g=n[10],v=n[11],e[0]=o=n[0],e[1]=s,e[2]=a,e[3]=h,e[4]=l,e[5]=c,e[6]=A,e[7]=f,e[8]=d,e[9]=p,e[10]=g,e[11]=v,e[12]=o*w+l*C+d*P+n[12],e[13]=s*w+c*C+p*P+n[13],e[14]=a*w+A*C+g*P+n[14],e[15]=h*w+f*C+v*P+n[15]),e}function Mv(e,n,i){var o=i[0],s=i[1],a=i[2];return e[0]=n[0]*o,e[1]=n[1]*o,e[2]=n[2]*o,e[3]=n[3]*o,e[4]=n[4]*s,e[5]=n[5]*s,e[6]=n[6]*s,e[7]=n[7]*s,e[8]=n[8]*a,e[9]=n[9]*a,e[10]=n[10]*a,e[11]=n[11]*a,e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e}function Tv(e,n,i,o){var s,a,h,l,c,A,f,d,p,g,v,w,C,P,T,S,I,E,O,k,L,F,N,z,H=o[0],j=o[1],W=o[2],q=Math.hypot(H,j,W);return q<Yy?null:(H*=q=1/q,j*=q,W*=q,s=Math.sin(i),a=Math.cos(i),c=n[1],A=n[2],f=n[3],p=n[5],g=n[6],v=n[7],C=n[9],P=n[10],T=n[11],O=H*j*(h=1-a)-W*s,k=j*j*h+a,L=W*j*h+H*s,F=H*W*h+j*s,N=j*W*h-H*s,z=W*W*h+a,e[0]=(l=n[0])*(S=H*H*h+a)+(d=n[4])*(I=j*H*h+W*s)+(w=n[8])*(E=W*H*h-j*s),e[1]=c*S+p*I+C*E,e[2]=A*S+g*I+P*E,e[3]=f*S+v*I+T*E,e[4]=l*O+d*k+w*L,e[5]=c*O+p*k+C*L,e[6]=A*O+g*k+P*L,e[7]=f*O+v*k+T*L,e[8]=l*F+d*N+w*z,e[9]=c*F+p*N+C*z,e[10]=A*F+g*N+P*z,e[11]=f*F+v*N+T*z,n!==e&&(e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e)}function Sv(e,n,i){var o=Math.sin(i),s=Math.cos(i),a=n[4],h=n[5],l=n[6],c=n[7],A=n[8],f=n[9],d=n[10],p=n[11];return n!==e&&(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e[4]=a*s+A*o,e[5]=h*s+f*o,e[6]=l*s+d*o,e[7]=c*s+p*o,e[8]=A*s-a*o,e[9]=f*s-h*o,e[10]=d*s-l*o,e[11]=p*s-c*o,e}function Iv(e,n,i){var o=Math.sin(i),s=Math.cos(i),a=n[0],h=n[1],l=n[2],c=n[3],A=n[8],f=n[9],d=n[10],p=n[11];return n!==e&&(e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e[0]=a*s-A*o,e[1]=h*s-f*o,e[2]=l*s-d*o,e[3]=c*s-p*o,e[8]=a*o+A*s,e[9]=h*o+f*s,e[10]=l*o+d*s,e[11]=c*o+p*s,e}function Ev(e,n,i){var o=Math.sin(i),s=Math.cos(i),a=n[0],h=n[1],l=n[2],c=n[3],A=n[4],f=n[5],d=n[6],p=n[7];return n!==e&&(e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e[0]=a*s+A*o,e[1]=h*s+f*o,e[2]=l*s+d*o,e[3]=c*s+p*o,e[4]=A*s-a*o,e[5]=f*s-h*o,e[6]=d*s-l*o,e[7]=p*s-c*o,e}function Ov(e,n){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function Rv(e,n){return e[0]=n[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=n[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Dv(e,n,i){var o,s,a,h=i[0],l=i[1],c=i[2],A=Math.hypot(h,l,c);return A<Yy?null:(h*=A=1/A,l*=A,c*=A,o=Math.sin(n),s=Math.cos(n),e[0]=h*h*(a=1-s)+s,e[1]=l*h*a+c*o,e[2]=c*h*a-l*o,e[3]=0,e[4]=h*l*a-c*o,e[5]=l*l*a+s,e[6]=c*l*a+h*o,e[7]=0,e[8]=h*c*a+l*o,e[9]=l*c*a-h*o,e[10]=c*c*a+s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function kv(e,n,i){var o=n[0],s=n[1],a=n[2],h=n[3],l=o+o,c=s+s,A=a+a,f=o*l,d=o*c,p=o*A,g=s*c,v=s*A,w=a*A,C=h*l,P=h*c,T=h*A;return e[0]=1-(g+w),e[1]=d+T,e[2]=p-P,e[3]=0,e[4]=d-T,e[5]=1-(f+w),e[6]=v+C,e[7]=0,e[8]=p+P,e[9]=v-C,e[10]=1-(f+g),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function Lv(e,n){return e[0]=n[12],e[1]=n[13],e[2]=n[14],e}function Fv(e,n){var i=n[4],o=n[5],s=n[6],a=n[8],h=n[9],l=n[10];return e[0]=Math.hypot(n[0],n[1],n[2]),e[1]=Math.hypot(i,o,s),e[2]=Math.hypot(a,h,l),e}function Nv(e,n){var i=new Jy(3);Fv(i,n);var o=1/i[0],s=1/i[1],a=1/i[2],h=n[0]*o,l=n[1]*s,c=n[2]*a,A=n[4]*o,f=n[5]*s,d=n[6]*a,p=n[8]*o,g=n[9]*s,v=n[10]*a,w=h+f+v,C=0;return w>0?(C=2*Math.sqrt(w+1),e[3]=.25*C,e[0]=(d-g)/C,e[1]=(p-c)/C,e[2]=(l-A)/C):h>f&&h>v?(C=2*Math.sqrt(1+h-f-v),e[3]=(d-g)/C,e[0]=.25*C,e[1]=(l+A)/C,e[2]=(p+c)/C):f>v?(C=2*Math.sqrt(1+f-h-v),e[3]=(p-c)/C,e[0]=(l+A)/C,e[1]=.25*C,e[2]=(d+g)/C):(C=2*Math.sqrt(1+v-h-f),e[3]=(l-A)/C,e[0]=(p+c)/C,e[1]=(d+g)/C,e[2]=.25*C),e}function zv(e,n,i,o){var s=n[0],a=n[1],h=n[2],l=n[3],c=s+s,A=a+a,f=h+h,d=s*c,p=s*A,g=s*f,v=a*A,w=a*f,C=h*f,P=l*c,T=l*A,S=l*f,I=o[0],E=o[1],O=o[2];return e[0]=(1-(v+C))*I,e[1]=(p+S)*I,e[2]=(g-T)*I,e[3]=0,e[4]=(p-S)*E,e[5]=(1-(d+C))*E,e[6]=(w+P)*E,e[7]=0,e[8]=(g+T)*O,e[9]=(w-P)*O,e[10]=(1-(d+v))*O,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function Bv(e,n){var i=n[0],o=n[1],s=n[2],a=n[3],h=i+i,l=o+o,c=s+s,A=i*h,f=o*h,d=o*l,p=s*h,g=s*l,v=s*c,w=a*h,C=a*l,P=a*c;return e[0]=1-d-v,e[1]=f+P,e[2]=p-C,e[3]=0,e[4]=f-P,e[5]=1-A-v,e[6]=g+w,e[7]=0,e[8]=p+C,e[9]=g-w,e[10]=1-A-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Hv(e,n,i,o,s){var a,h=1/Math.tan(n/2);return e[0]=h/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=h,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=s&&s!==1/0?(e[10]=(s+o)*(a=1/(o-s)),e[14]=2*s*o*a):(e[10]=-1,e[14]=-2*o),e}var jv=Hv;function Uv(e,n,i,o,s,a,h){var l=1/(n-i),c=1/(o-s),A=1/(a-h);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*A,e[11]=0,e[12]=(n+i)*l,e[13]=(s+o)*c,e[14]=(h+a)*A,e[15]=1,e}var Gv=Uv;function Vv(e,n,i,o){var s,a,h,l,c,A,f,d,p,g,v=n[0],w=n[1],C=n[2],P=o[0],T=o[1],S=o[2],I=i[0],E=i[1],O=i[2];return Math.abs(v-I)<Yy&&Math.abs(w-E)<Yy&&Math.abs(C-O)<Yy?xv(e):(f=v-I,d=w-E,p=C-O,s=T*(p*=g=1/Math.hypot(f,d,p))-S*(d*=g),a=S*(f*=g)-P*p,h=P*d-T*f,(g=Math.hypot(s,a,h))?(s*=g=1/g,a*=g,h*=g):(s=0,a=0,h=0),l=d*h-p*a,c=p*s-f*h,A=f*a-d*s,(g=Math.hypot(l,c,A))?(l*=g=1/g,c*=g,A*=g):(l=0,c=0,A=0),e[0]=s,e[1]=l,e[2]=f,e[3]=0,e[4]=a,e[5]=c,e[6]=d,e[7]=0,e[8]=h,e[9]=A,e[10]=p,e[11]=0,e[12]=-(s*v+a*w+h*C),e[13]=-(l*v+c*w+A*C),e[14]=-(f*v+d*w+p*C),e[15]=1,e)}function Wv(e,n,i){return e[0]=n[0]-i[0],e[1]=n[1]-i[1],e[2]=n[2]-i[2],e[3]=n[3]-i[3],e[4]=n[4]-i[4],e[5]=n[5]-i[5],e[6]=n[6]-i[6],e[7]=n[7]-i[7],e[8]=n[8]-i[8],e[9]=n[9]-i[9],e[10]=n[10]-i[10],e[11]=n[11]-i[11],e[12]=n[12]-i[12],e[13]=n[13]-i[13],e[14]=n[14]-i[14],e[15]=n[15]-i[15],e}function qv(e,n){return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]&&e[3]===n[3]&&e[4]===n[4]&&e[5]===n[5]&&e[6]===n[6]&&e[7]===n[7]&&e[8]===n[8]&&e[9]===n[9]&&e[10]===n[10]&&e[11]===n[11]&&e[12]===n[12]&&e[13]===n[13]&&e[14]===n[14]&&e[15]===n[15]}var Zv=Cv,Qv=Object.freeze({__proto__:null,add:function(e,n,i){return e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e[3]=n[3]+i[3],e[4]=n[4]+i[4],e[5]=n[5]+i[5],e[6]=n[6]+i[6],e[7]=n[7]+i[7],e[8]=n[8]+i[8],e[9]=n[9]+i[9],e[10]=n[10]+i[10],e[11]=n[11]+i[11],e[12]=n[12]+i[12],e[13]=n[13]+i[13],e[14]=n[14]+i[14],e[15]=n[15]+i[15],e},adjoint:function(e,n){var i=n[0],o=n[1],s=n[2],a=n[3],h=n[4],l=n[5],c=n[6],A=n[7],f=n[8],d=n[9],p=n[10],g=n[11],v=n[12],w=n[13],C=n[14],P=n[15];return e[0]=l*(p*P-g*C)-d*(c*P-A*C)+w*(c*g-A*p),e[1]=-(o*(p*P-g*C)-d*(s*P-a*C)+w*(s*g-a*p)),e[2]=o*(c*P-A*C)-l*(s*P-a*C)+w*(s*A-a*c),e[3]=-(o*(c*g-A*p)-l*(s*g-a*p)+d*(s*A-a*c)),e[4]=-(h*(p*P-g*C)-f*(c*P-A*C)+v*(c*g-A*p)),e[5]=i*(p*P-g*C)-f*(s*P-a*C)+v*(s*g-a*p),e[6]=-(i*(c*P-A*C)-h*(s*P-a*C)+v*(s*A-a*c)),e[7]=i*(c*g-A*p)-h*(s*g-a*p)+f*(s*A-a*c),e[8]=h*(d*P-g*w)-f*(l*P-A*w)+v*(l*g-A*d),e[9]=-(i*(d*P-g*w)-f*(o*P-a*w)+v*(o*g-a*d)),e[10]=i*(l*P-A*w)-h*(o*P-a*w)+v*(o*A-a*l),e[11]=-(i*(l*g-A*d)-h*(o*g-a*d)+f*(o*A-a*l)),e[12]=-(h*(d*C-p*w)-f*(l*C-c*w)+v*(l*p-c*d)),e[13]=i*(d*C-p*w)-f*(o*C-s*w)+v*(o*p-s*d),e[14]=-(i*(l*C-c*w)-h*(o*C-s*w)+v*(o*c-s*l)),e[15]=i*(l*p-c*d)-h*(o*p-s*d)+f*(o*c-s*l),e},clone:function(e){var n=new Jy(16);return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},copy:_v,create:vv,determinant:function(e){var n=e[0],i=e[1],o=e[2],s=e[3],a=e[4],h=e[5],l=e[6],c=e[7],A=e[8],f=e[9],d=e[10],p=e[11],g=e[12],v=e[13],w=e[14],C=e[15];return(n*h-i*a)*(d*C-p*w)-(n*l-o*a)*(f*C-p*v)+(n*c-s*a)*(f*w-d*v)+(i*l-o*h)*(A*C-p*g)-(i*c-s*h)*(A*w-d*g)+(o*c-s*l)*(A*v-f*g)},equals:function(e,n){var i=e[0],o=e[1],s=e[2],a=e[3],h=e[4],l=e[5],c=e[6],A=e[7],f=e[8],d=e[9],p=e[10],g=e[11],v=e[12],w=e[13],C=e[14],P=e[15],T=n[0],S=n[1],I=n[2],E=n[3],O=n[4],k=n[5],L=n[6],F=n[7],N=n[8],z=n[9],H=n[10],j=n[11],W=n[12],q=n[13],Y=n[14],J=n[15];return Math.abs(i-T)<=Yy*Math.max(1,Math.abs(i),Math.abs(T))&&Math.abs(o-S)<=Yy*Math.max(1,Math.abs(o),Math.abs(S))&&Math.abs(s-I)<=Yy*Math.max(1,Math.abs(s),Math.abs(I))&&Math.abs(a-E)<=Yy*Math.max(1,Math.abs(a),Math.abs(E))&&Math.abs(h-O)<=Yy*Math.max(1,Math.abs(h),Math.abs(O))&&Math.abs(l-k)<=Yy*Math.max(1,Math.abs(l),Math.abs(k))&&Math.abs(c-L)<=Yy*Math.max(1,Math.abs(c),Math.abs(L))&&Math.abs(A-F)<=Yy*Math.max(1,Math.abs(A),Math.abs(F))&&Math.abs(f-N)<=Yy*Math.max(1,Math.abs(f),Math.abs(N))&&Math.abs(d-z)<=Yy*Math.max(1,Math.abs(d),Math.abs(z))&&Math.abs(p-H)<=Yy*Math.max(1,Math.abs(p),Math.abs(H))&&Math.abs(g-j)<=Yy*Math.max(1,Math.abs(g),Math.abs(j))&&Math.abs(v-W)<=Yy*Math.max(1,Math.abs(v),Math.abs(W))&&Math.abs(w-q)<=Yy*Math.max(1,Math.abs(w),Math.abs(q))&&Math.abs(C-Y)<=Yy*Math.max(1,Math.abs(C),Math.abs(Y))&&Math.abs(P-J)<=Yy*Math.max(1,Math.abs(P),Math.abs(J))},exactEquals:qv,frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},fromQuat:Bv,fromQuat2:function(e,n){var i=new Jy(3),o=-n[0],s=-n[1],a=-n[2],h=n[3],l=n[4],c=n[5],A=n[6],f=n[7],d=o*o+s*s+a*a+h*h;return d>0?(i[0]=2*(l*h+f*o+c*a-A*s)/d,i[1]=2*(c*h+f*s+A*o-l*a)/d,i[2]=2*(A*h+f*a+l*s-c*o)/d):(i[0]=2*(l*h+f*o+c*a-A*s),i[1]=2*(c*h+f*s+A*o-l*a),i[2]=2*(A*h+f*a+l*s-c*o)),kv(e,n,i),e},fromRotation:Dv,fromRotationTranslation:kv,fromRotationTranslationScale:zv,fromRotationTranslationScaleOrigin:function(e,n,i,o,s){var a=n[0],h=n[1],l=n[2],c=n[3],A=a+a,f=h+h,d=l+l,p=a*A,g=a*f,v=a*d,w=h*f,C=h*d,P=l*d,T=c*A,S=c*f,I=c*d,E=o[0],O=o[1],k=o[2],L=s[0],F=s[1],N=s[2],z=(1-(w+P))*E,H=(g+I)*E,j=(v-S)*E,W=(g-I)*O,q=(1-(p+P))*O,Y=(C+T)*O,J=(v+S)*k,$=(C-T)*k,it=(1-(p+w))*k;return e[0]=z,e[1]=H,e[2]=j,e[3]=0,e[4]=W,e[5]=q,e[6]=Y,e[7]=0,e[8]=J,e[9]=$,e[10]=it,e[11]=0,e[12]=i[0]+L-(z*L+W*F+J*N),e[13]=i[1]+F-(H*L+q*F+$*N),e[14]=i[2]+N-(j*L+Y*F+it*N),e[15]=1,e},fromScaling:Rv,fromTranslation:Ov,fromValues:function(e,n,i,o,s,a,h,l,c,A,f,d,p,g,v,w){var C=new Jy(16);return C[0]=e,C[1]=n,C[2]=i,C[3]=o,C[4]=s,C[5]=a,C[6]=h,C[7]=l,C[8]=c,C[9]=A,C[10]=f,C[11]=d,C[12]=p,C[13]=g,C[14]=v,C[15]=w,C},fromXRotation:function(e,n){var i=Math.sin(n),o=Math.cos(n);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=i,e[7]=0,e[8]=0,e[9]=-i,e[10]=o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromYRotation:function(e,n){var i=Math.sin(n),o=Math.cos(n);return e[0]=o,e[1]=0,e[2]=-i,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=i,e[9]=0,e[10]=o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromZRotation:function(e,n){var i=Math.sin(n),o=Math.cos(n);return e[0]=o,e[1]=i,e[2]=0,e[3]=0,e[4]=-i,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},frustum:function(e,n,i,o,s,a,h){var l=1/(i-n),c=1/(s-o),A=1/(a-h);return e[0]=2*a*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*c,e[6]=0,e[7]=0,e[8]=(i+n)*l,e[9]=(s+o)*c,e[10]=(h+a)*A,e[11]=-1,e[12]=0,e[13]=0,e[14]=h*a*2*A,e[15]=0,e},getRotation:Nv,getScaling:Fv,getTranslation:Lv,identity:xv,invert:wv,lookAt:Vv,mul:Zv,multiply:Cv,multiplyScalar:function(e,n,i){return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=n[3]*i,e[4]=n[4]*i,e[5]=n[5]*i,e[6]=n[6]*i,e[7]=n[7]*i,e[8]=n[8]*i,e[9]=n[9]*i,e[10]=n[10]*i,e[11]=n[11]*i,e[12]=n[12]*i,e[13]=n[13]*i,e[14]=n[14]*i,e[15]=n[15]*i,e},multiplyScalarAndAdd:function(e,n,i,o){return e[0]=n[0]+i[0]*o,e[1]=n[1]+i[1]*o,e[2]=n[2]+i[2]*o,e[3]=n[3]+i[3]*o,e[4]=n[4]+i[4]*o,e[5]=n[5]+i[5]*o,e[6]=n[6]+i[6]*o,e[7]=n[7]+i[7]*o,e[8]=n[8]+i[8]*o,e[9]=n[9]+i[9]*o,e[10]=n[10]+i[10]*o,e[11]=n[11]+i[11]*o,e[12]=n[12]+i[12]*o,e[13]=n[13]+i[13]*o,e[14]=n[14]+i[14]*o,e[15]=n[15]+i[15]*o,e},ortho:Gv,orthoNO:Uv,orthoZO:function(e,n,i,o,s,a,h){var l=1/(n-i),c=1/(o-s),A=1/(a-h);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=A,e[11]=0,e[12]=(n+i)*l,e[13]=(s+o)*c,e[14]=a*A,e[15]=1,e},perspective:jv,perspectiveFromFieldOfView:function(e,n,i,o){var s=Math.tan(n.upDegrees*Math.PI/180),a=Math.tan(n.downDegrees*Math.PI/180),h=Math.tan(n.leftDegrees*Math.PI/180),l=Math.tan(n.rightDegrees*Math.PI/180),c=2/(h+l),A=2/(s+a);return e[0]=c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=A,e[6]=0,e[7]=0,e[8]=-(h-l)*c*.5,e[9]=(s-a)*A*.5,e[10]=o/(i-o),e[11]=-1,e[12]=0,e[13]=0,e[14]=o*i/(i-o),e[15]=0,e},perspectiveNO:Hv,perspectiveZO:function(e,n,i,o,s){var a,h=1/Math.tan(n/2);return e[0]=h/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=h,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=s&&s!==1/0?(e[10]=s*(a=1/(o-s)),e[14]=s*o*a):(e[10]=-1,e[14]=-o),e},rotate:Tv,rotateX:Sv,rotateY:Iv,rotateZ:Ev,scale:Mv,set:function(e,n,i,o,s,a,h,l,c,A,f,d,p,g,v,w,C){return e[0]=n,e[1]=i,e[2]=o,e[3]=s,e[4]=a,e[5]=h,e[6]=l,e[7]=c,e[8]=A,e[9]=f,e[10]=d,e[11]=p,e[12]=g,e[13]=v,e[14]=w,e[15]=C,e},str:function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},sub:Wv,subtract:Wv,targetTo:function(e,n,i,o){var s=n[0],a=n[1],h=n[2],l=o[0],c=o[1],A=o[2],f=s-i[0],d=a-i[1],p=h-i[2],g=f*f+d*d+p*p;g>0&&(f*=g=1/Math.sqrt(g),d*=g,p*=g);var v=c*p-A*d,w=A*f-l*p,C=l*d-c*f;return(g=v*v+w*w+C*C)>0&&(v*=g=1/Math.sqrt(g),w*=g,C*=g),e[0]=v,e[1]=w,e[2]=C,e[3]=0,e[4]=d*C-p*w,e[5]=p*v-f*C,e[6]=f*w-d*v,e[7]=0,e[8]=f,e[9]=d,e[10]=p,e[11]=0,e[12]=s,e[13]=a,e[14]=h,e[15]=1,e},translate:Pv,transpose:bv});function Xv(){var e=new Jy(3);return Jy!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Yv(e){return Math.hypot(e[0],e[1],e[2])}function Jv(e,n,i){var o=new Jy(3);return o[0]=e,o[1]=n,o[2]=i,o}function Kv(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function $v(e,n,i,o){return e[0]=n,e[1]=i,e[2]=o,e}function t_(e,n,i){return e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e}function e_(e,n,i){return e[0]=n[0]-i[0],e[1]=n[1]-i[1],e[2]=n[2]-i[2],e}function n_(e,n,i){return e[0]=n[0]*i[0],e[1]=n[1]*i[1],e[2]=n[2]*i[2],e}function i_(e,n,i){return e[0]=n[0]/i[0],e[1]=n[1]/i[1],e[2]=n[2]/i[2],e}function r_(e,n,i){return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e}function o_(e,n,i,o){return e[0]=n[0]+i[0]*o,e[1]=n[1]+i[1]*o,e[2]=n[2]+i[2]*o,e}function s_(e,n){return Math.hypot(n[0]-e[0],n[1]-e[1],n[2]-e[2])}function a_(e,n){var i=n[0]-e[0],o=n[1]-e[1],s=n[2]-e[2];return i*i+o*o+s*s}function h_(e){var n=e[0],i=e[1],o=e[2];return n*n+i*i+o*o}function l_(e,n){var i=n[0],o=n[1],s=n[2],a=i*i+o*o+s*s;return a>0&&(a=1/Math.sqrt(a)),e[0]=n[0]*a,e[1]=n[1]*a,e[2]=n[2]*a,e}function u_(e,n){return e[0]*n[0]+e[1]*n[1]+e[2]*n[2]}function c_(e,n,i){var o=n[0],s=n[1],a=n[2],h=i[0],l=i[1],c=i[2];return e[0]=s*c-a*l,e[1]=a*h-o*c,e[2]=o*l-s*h,e}function A_(e,n,i){var o=n[0],s=n[1],a=n[2],h=i[3]*o+i[7]*s+i[11]*a+i[15];return e[0]=(i[0]*o+i[4]*s+i[8]*a+i[12])/(h=h||1),e[1]=(i[1]*o+i[5]*s+i[9]*a+i[13])/h,e[2]=(i[2]*o+i[6]*s+i[10]*a+i[14])/h,e}function f_(e,n){var i=e[0],o=e[1],s=e[2],a=n[0],h=n[1],l=n[2],c=Math.sqrt(i*i+o*o+s*s)*Math.sqrt(a*a+h*h+l*l),A=c&&u_(e,n)/c;return Math.acos(Math.min(Math.max(A,-1),1))}function d_(e,n){return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}function p_(e,n){var i=e[0],o=e[1],s=e[2],a=n[0],h=n[1],l=n[2];return Math.abs(i-a)<=Yy*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(o-h)<=Yy*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(s-l)<=Yy*Math.max(1,Math.abs(s),Math.abs(l))}var g_,m_=e_,y_=n_,v_=i_,__=s_,x_=a_,b_=Yv,w_=h_,C_=(g_=Xv(),function(e,n,i,o,s,a){var h,l;for(n||(n=3),i||(i=0),l=o?Math.min(o*n+i,e.length):e.length,h=i;h<l;h+=n)g_[0]=e[h],g_[1]=e[h+1],g_[2]=e[h+2],s(g_,g_,a),e[h]=g_[0],e[h+1]=g_[1],e[h+2]=g_[2];return e}),P_=Object.freeze({__proto__:null,add:t_,angle:f_,bezier:function(e,n,i,o,s,a){var h=1-a,l=h*h,c=a*a,A=l*h,f=3*a*l,d=3*c*h,p=c*a;return e[0]=n[0]*A+i[0]*f+o[0]*d+s[0]*p,e[1]=n[1]*A+i[1]*f+o[1]*d+s[1]*p,e[2]=n[2]*A+i[2]*f+o[2]*d+s[2]*p,e},ceil:function(e,n){return e[0]=Math.ceil(n[0]),e[1]=Math.ceil(n[1]),e[2]=Math.ceil(n[2]),e},clone:function(e){var n=new Jy(3);return n[0]=e[0],n[1]=e[1],n[2]=e[2],n},copy:Kv,create:Xv,cross:c_,dist:__,distance:s_,div:v_,divide:i_,dot:u_,equals:p_,exactEquals:d_,floor:function(e,n){return e[0]=Math.floor(n[0]),e[1]=Math.floor(n[1]),e[2]=Math.floor(n[2]),e},forEach:C_,fromValues:Jv,hermite:function(e,n,i,o,s,a){var h=a*a,l=h*(2*a-3)+1,c=h*(a-2)+a,A=h*(a-1),f=h*(3-2*a);return e[0]=n[0]*l+i[0]*c+o[0]*A+s[0]*f,e[1]=n[1]*l+i[1]*c+o[1]*A+s[1]*f,e[2]=n[2]*l+i[2]*c+o[2]*A+s[2]*f,e},inverse:function(e,n){return e[0]=1/n[0],e[1]=1/n[1],e[2]=1/n[2],e},len:b_,length:Yv,lerp:function(e,n,i,o){var s=n[0],a=n[1],h=n[2];return e[0]=s+o*(i[0]-s),e[1]=a+o*(i[1]-a),e[2]=h+o*(i[2]-h),e},max:function(e,n,i){return e[0]=Math.max(n[0],i[0]),e[1]=Math.max(n[1],i[1]),e[2]=Math.max(n[2],i[2]),e},min:function(e,n,i){return e[0]=Math.min(n[0],i[0]),e[1]=Math.min(n[1],i[1]),e[2]=Math.min(n[2],i[2]),e},mul:y_,multiply:n_,negate:function(e,n){return e[0]=-n[0],e[1]=-n[1],e[2]=-n[2],e},normalize:l_,random:function(e,n){n=n||1;var i=2*Ky()*Math.PI,o=2*Ky()-1,s=Math.sqrt(1-o*o)*n;return e[0]=Math.cos(i)*s,e[1]=Math.sin(i)*s,e[2]=o*n,e},rotateX:function(e,n,i,o){var s=[],a=[];return s[0]=n[0]-i[0],s[1]=n[1]-i[1],s[2]=n[2]-i[2],a[0]=s[0],a[1]=s[1]*Math.cos(o)-s[2]*Math.sin(o),a[2]=s[1]*Math.sin(o)+s[2]*Math.cos(o),e[0]=a[0]+i[0],e[1]=a[1]+i[1],e[2]=a[2]+i[2],e},rotateY:function(e,n,i,o){var s=[],a=[];return s[0]=n[0]-i[0],s[1]=n[1]-i[1],s[2]=n[2]-i[2],a[0]=s[2]*Math.sin(o)+s[0]*Math.cos(o),a[1]=s[1],a[2]=s[2]*Math.cos(o)-s[0]*Math.sin(o),e[0]=a[0]+i[0],e[1]=a[1]+i[1],e[2]=a[2]+i[2],e},rotateZ:function(e,n,i,o){var s=[],a=[];return s[0]=n[0]-i[0],s[1]=n[1]-i[1],s[2]=n[2]-i[2],a[0]=s[0]*Math.cos(o)-s[1]*Math.sin(o),a[1]=s[0]*Math.sin(o)+s[1]*Math.cos(o),a[2]=s[2],e[0]=a[0]+i[0],e[1]=a[1]+i[1],e[2]=a[2]+i[2],e},round:function(e,n){return e[0]=Math.round(n[0]),e[1]=Math.round(n[1]),e[2]=Math.round(n[2]),e},scale:r_,scaleAndAdd:o_,set:$v,sqrDist:x_,sqrLen:w_,squaredDistance:a_,squaredLength:h_,str:function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},sub:m_,subtract:e_,transformMat3:function(e,n,i){var o=n[0],s=n[1],a=n[2];return e[0]=o*i[0]+s*i[3]+a*i[6],e[1]=o*i[1]+s*i[4]+a*i[7],e[2]=o*i[2]+s*i[5]+a*i[8],e},transformMat4:A_,transformQuat:function(e,n,i){var o=i[0],s=i[1],a=i[2],h=n[0],l=n[1],c=n[2],A=s*c-a*l,f=a*h-o*c,d=o*l-s*h,p=s*d-a*f,g=a*A-o*d,v=o*f-s*A,w=2*i[3];return f*=w,d*=w,g*=2,v*=2,e[0]=h+(A*=w)+(p*=2),e[1]=l+f+g,e[2]=c+d+v,e},zero:function(e){return e[0]=0,e[1]=0,e[2]=0,e}});function M_(){var e=new Jy(4);return Jy!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function T_(e){var n=new Jy(4);return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n}function S_(e,n,i,o){var s=new Jy(4);return s[0]=e,s[1]=n,s[2]=i,s[3]=o,s}function I_(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e}function E_(e,n,i,o,s){return e[0]=n,e[1]=i,e[2]=o,e[3]=s,e}function O_(e,n,i){return e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e[3]=n[3]+i[3],e}function R_(e,n,i){return e[0]=n[0]-i[0],e[1]=n[1]-i[1],e[2]=n[2]-i[2],e[3]=n[3]-i[3],e}function D_(e,n,i){return e[0]=n[0]*i[0],e[1]=n[1]*i[1],e[2]=n[2]*i[2],e[3]=n[3]*i[3],e}function k_(e,n,i){return e[0]=n[0]/i[0],e[1]=n[1]/i[1],e[2]=n[2]/i[2],e[3]=n[3]/i[3],e}function L_(e,n,i){return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=n[3]*i,e}function F_(e,n){return Math.hypot(n[0]-e[0],n[1]-e[1],n[2]-e[2],n[3]-e[3])}function N_(e,n){var i=n[0]-e[0],o=n[1]-e[1],s=n[2]-e[2],a=n[3]-e[3];return i*i+o*o+s*s+a*a}function z_(e){return Math.hypot(e[0],e[1],e[2],e[3])}function B_(e){var n=e[0],i=e[1],o=e[2],s=e[3];return n*n+i*i+o*o+s*s}function H_(e,n){var i=n[0],o=n[1],s=n[2],a=n[3],h=i*i+o*o+s*s+a*a;return h>0&&(h=1/Math.sqrt(h)),e[0]=i*h,e[1]=o*h,e[2]=s*h,e[3]=a*h,e}function j_(e,n){return e[0]*n[0]+e[1]*n[1]+e[2]*n[2]+e[3]*n[3]}function U_(e,n,i,o){var s=n[0],a=n[1],h=n[2],l=n[3];return e[0]=s+o*(i[0]-s),e[1]=a+o*(i[1]-a),e[2]=h+o*(i[2]-h),e[3]=l+o*(i[3]-l),e}function G_(e,n,i){var o=n[0],s=n[1],a=n[2],h=n[3];return e[0]=i[0]*o+i[4]*s+i[8]*a+i[12]*h,e[1]=i[1]*o+i[5]*s+i[9]*a+i[13]*h,e[2]=i[2]*o+i[6]*s+i[10]*a+i[14]*h,e[3]=i[3]*o+i[7]*s+i[11]*a+i[15]*h,e}function V_(e,n){return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]&&e[3]===n[3]}function W_(e,n){var i=e[0],o=e[1],s=e[2],a=e[3],h=n[0],l=n[1],c=n[2],A=n[3];return Math.abs(i-h)<=Yy*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(o-l)<=Yy*Math.max(1,Math.abs(o),Math.abs(l))&&Math.abs(s-c)<=Yy*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(a-A)<=Yy*Math.max(1,Math.abs(a),Math.abs(A))}var q_=R_,Z_=D_,Q_=k_,X_=F_,Y_=N_,J_=z_,K_=B_,$_=function(){var e=M_();return function(n,i,o,s,a,h){var l,c;for(i||(i=4),o||(o=0),c=s?Math.min(s*i+o,n.length):n.length,l=o;l<c;l+=i)e[0]=n[l],e[1]=n[l+1],e[2]=n[l+2],e[3]=n[l+3],a(e,e,h),n[l]=e[0],n[l+1]=e[1],n[l+2]=e[2],n[l+3]=e[3];return n}}(),tx=Object.freeze({__proto__:null,add:O_,ceil:function(e,n){return e[0]=Math.ceil(n[0]),e[1]=Math.ceil(n[1]),e[2]=Math.ceil(n[2]),e[3]=Math.ceil(n[3]),e},clone:T_,copy:I_,create:M_,cross:function(e,n,i,o){var s=i[0]*o[1]-i[1]*o[0],a=i[0]*o[2]-i[2]*o[0],h=i[0]*o[3]-i[3]*o[0],l=i[1]*o[2]-i[2]*o[1],c=i[1]*o[3]-i[3]*o[1],A=i[2]*o[3]-i[3]*o[2],f=n[0],d=n[1],p=n[2],g=n[3];return e[0]=d*A-p*c+g*l,e[1]=-f*A+p*h-g*a,e[2]=f*c-d*h+g*s,e[3]=-f*l+d*a-p*s,e},dist:X_,distance:F_,div:Q_,divide:k_,dot:j_,equals:W_,exactEquals:V_,floor:function(e,n){return e[0]=Math.floor(n[0]),e[1]=Math.floor(n[1]),e[2]=Math.floor(n[2]),e[3]=Math.floor(n[3]),e},forEach:$_,fromValues:S_,inverse:function(e,n){return e[0]=1/n[0],e[1]=1/n[1],e[2]=1/n[2],e[3]=1/n[3],e},len:J_,length:z_,lerp:U_,max:function(e,n,i){return e[0]=Math.max(n[0],i[0]),e[1]=Math.max(n[1],i[1]),e[2]=Math.max(n[2],i[2]),e[3]=Math.max(n[3],i[3]),e},min:function(e,n,i){return e[0]=Math.min(n[0],i[0]),e[1]=Math.min(n[1],i[1]),e[2]=Math.min(n[2],i[2]),e[3]=Math.min(n[3],i[3]),e},mul:Z_,multiply:D_,negate:function(e,n){return e[0]=-n[0],e[1]=-n[1],e[2]=-n[2],e[3]=-n[3],e},normalize:H_,random:function(e,n){var i,o,s,a,h,l;n=n||1;do{h=(i=2*Ky()-1)*i+(o=2*Ky()-1)*o}while(h>=1);do{l=(s=2*Ky()-1)*s+(a=2*Ky()-1)*a}while(l>=1);var c=Math.sqrt((1-h)/l);return e[0]=n*i,e[1]=n*o,e[2]=n*s*c,e[3]=n*a*c,e},round:function(e,n){return e[0]=Math.round(n[0]),e[1]=Math.round(n[1]),e[2]=Math.round(n[2]),e[3]=Math.round(n[3]),e},scale:L_,scaleAndAdd:function(e,n,i,o){return e[0]=n[0]+i[0]*o,e[1]=n[1]+i[1]*o,e[2]=n[2]+i[2]*o,e[3]=n[3]+i[3]*o,e},set:E_,sqrDist:Y_,sqrLen:K_,squaredDistance:N_,squaredLength:B_,str:function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},sub:q_,subtract:R_,transformMat4:G_,transformQuat:function(e,n,i){var o=n[0],s=n[1],a=n[2],h=i[0],l=i[1],c=i[2],A=i[3],f=A*o+l*a-c*s,d=A*s+c*o-h*a,p=A*a+h*s-l*o,g=-h*o-l*s-c*a;return e[0]=f*A+g*-h+d*-c-p*-l,e[1]=d*A+g*-l+p*-h-f*-c,e[2]=p*A+g*-c+f*-l-d*-h,e[3]=n[3],e},zero:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}});function ex(){var e=new Jy(4);return Jy!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function nx(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function ix(e,n,i){i*=.5;var o=Math.sin(i);return e[0]=o*n[0],e[1]=o*n[1],e[2]=o*n[2],e[3]=Math.cos(i),e}function rx(e,n,i){var o=n[0],s=n[1],a=n[2],h=n[3],l=i[0],c=i[1],A=i[2],f=i[3];return e[0]=o*f+h*l+s*A-a*c,e[1]=s*f+h*c+a*l-o*A,e[2]=a*f+h*A+o*c-s*l,e[3]=h*f-o*l-s*c-a*A,e}function ox(e,n,i){i*=.5;var o=n[0],s=n[1],a=n[2],h=n[3],l=Math.sin(i),c=Math.cos(i);return e[0]=o*c+h*l,e[1]=s*c+a*l,e[2]=a*c-s*l,e[3]=h*c-o*l,e}function sx(e,n,i){i*=.5;var o=n[0],s=n[1],a=n[2],h=n[3],l=Math.sin(i),c=Math.cos(i);return e[0]=o*c-a*l,e[1]=s*c+h*l,e[2]=a*c+o*l,e[3]=h*c-s*l,e}function ax(e,n,i){i*=.5;var o=n[0],s=n[1],a=n[2],h=n[3],l=Math.sin(i),c=Math.cos(i);return e[0]=o*c+s*l,e[1]=s*c-o*l,e[2]=a*c+h*l,e[3]=h*c-a*l,e}function hx(e,n){var i=n[0],o=n[1],s=n[2],a=n[3],h=Math.sqrt(i*i+o*o+s*s),l=Math.exp(a),c=h>0?l*Math.sin(h)/h:0;return e[0]=i*c,e[1]=o*c,e[2]=s*c,e[3]=l*Math.cos(h),e}function lx(e,n){var i=n[0],o=n[1],s=n[2],a=n[3],h=Math.sqrt(i*i+o*o+s*s),l=h>0?Math.atan2(h,a)/h:0;return e[0]=i*l,e[1]=o*l,e[2]=s*l,e[3]=.5*Math.log(i*i+o*o+s*s+a*a),e}function ux(e,n,i,o){var s,a,h,l,c,A=n[0],f=n[1],d=n[2],p=n[3],g=i[0],v=i[1],w=i[2],C=i[3];return(a=A*g+f*v+d*w+p*C)<0&&(a=-a,g=-g,v=-v,w=-w,C=-C),1-a>Yy?(s=Math.acos(a),h=Math.sin(s),l=Math.sin((1-o)*s)/h,c=Math.sin(o*s)/h):(l=1-o,c=o),e[0]=l*A+c*g,e[1]=l*f+c*v,e[2]=l*d+c*w,e[3]=l*p+c*C,e}function cx(e,n){var i,o=n[0]+n[4]+n[8];if(o>0)i=Math.sqrt(o+1),e[3]=.5*i,e[0]=(n[5]-n[7])*(i=.5/i),e[1]=(n[6]-n[2])*i,e[2]=(n[1]-n[3])*i;else{var s=0;n[4]>n[0]&&(s=1),n[8]>n[3*s+s]&&(s=2);var a=(s+1)%3,h=(s+2)%3;i=Math.sqrt(n[3*s+s]-n[3*a+a]-n[3*h+h]+1),e[s]=.5*i,e[3]=(n[3*a+h]-n[3*h+a])*(i=.5/i),e[a]=(n[3*a+s]+n[3*s+a])*i,e[h]=(n[3*h+s]+n[3*s+h])*i}return e}function Ax(e,n,i,o){var s=.5*Math.PI/180;n*=s,i*=s,o*=s;var a=Math.sin(n),h=Math.cos(n),l=Math.sin(i),c=Math.cos(i),A=Math.sin(o),f=Math.cos(o);return e[0]=a*c*f-h*l*A,e[1]=h*l*f+a*c*A,e[2]=h*c*A-a*l*f,e[3]=h*c*f+a*l*A,e}var fx,dx,px,gx,mx,yx,vx=T_,_x=S_,xx=I_,bx=E_,wx=O_,Cx=rx,Px=L_,Mx=j_,Tx=U_,Sx=z_,Ix=Sx,Ex=B_,Ox=Ex,Rx=H_,Dx=V_,kx=W_,Lx=(fx=Xv(),dx=Jv(1,0,0),px=Jv(0,1,0),function(e,n,i){var o=u_(n,i);return o<-.999999?(c_(fx,dx,n),b_(fx)<1e-6&&c_(fx,px,n),l_(fx,fx),ix(e,fx,Math.PI),e):o>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(c_(fx,n,i),e[0]=fx[0],e[1]=fx[1],e[2]=fx[2],e[3]=1+o,Rx(e,e))}),Fx=(gx=ex(),mx=ex(),function(e,n,i,o,s,a){return ux(gx,n,s,a),ux(mx,i,o,a),ux(e,gx,mx,2*a*(1-a)),e}),Nx=(yx=lv(),function(e,n,i,o){return yx[0]=i[0],yx[3]=i[1],yx[6]=i[2],yx[1]=o[0],yx[4]=o[1],yx[7]=o[2],yx[2]=-n[0],yx[5]=-n[1],yx[8]=-n[2],Rx(e,cx(e,yx))}),zx=Object.freeze({__proto__:null,add:wx,calculateW:function(e,n){var i=n[0],o=n[1],s=n[2];return e[0]=i,e[1]=o,e[2]=s,e[3]=Math.sqrt(Math.abs(1-i*i-o*o-s*s)),e},clone:vx,conjugate:function(e,n){return e[0]=-n[0],e[1]=-n[1],e[2]=-n[2],e[3]=n[3],e},copy:xx,create:ex,dot:Mx,equals:kx,exactEquals:Dx,exp:hx,fromEuler:Ax,fromMat3:cx,fromValues:_x,getAngle:function(e,n){var i=Mx(e,n);return Math.acos(2*i*i-1)},getAxisAngle:function(e,n){var i=2*Math.acos(n[3]),o=Math.sin(i/2);return o>Yy?(e[0]=n[0]/o,e[1]=n[1]/o,e[2]=n[2]/o):(e[0]=1,e[1]=0,e[2]=0),i},identity:nx,invert:function(e,n){var i=n[0],o=n[1],s=n[2],a=n[3],h=i*i+o*o+s*s+a*a,l=h?1/h:0;return e[0]=-i*l,e[1]=-o*l,e[2]=-s*l,e[3]=a*l,e},len:Ix,length:Sx,lerp:Tx,ln:lx,mul:Cx,multiply:rx,normalize:Rx,pow:function(e,n,i){return lx(e,n),Px(e,e,i),hx(e,e),e},random:function(e){var n=Ky(),i=Ky(),o=Ky(),s=Math.sqrt(1-n),a=Math.sqrt(n);return e[0]=s*Math.sin(2*Math.PI*i),e[1]=s*Math.cos(2*Math.PI*i),e[2]=a*Math.sin(2*Math.PI*o),e[3]=a*Math.cos(2*Math.PI*o),e},rotateX:ox,rotateY:sx,rotateZ:ax,rotationTo:Lx,scale:Px,set:bx,setAxes:Nx,setAxisAngle:ix,slerp:ux,sqlerp:Fx,sqrLen:Ox,squaredLength:Ex,str:function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}});function Bx(e,n,i){var o=.5*i[0],s=.5*i[1],a=.5*i[2],h=n[0],l=n[1],c=n[2],A=n[3];return e[0]=h,e[1]=l,e[2]=c,e[3]=A,e[4]=o*A+s*c-a*l,e[5]=s*A+a*h-o*c,e[6]=a*A+o*l-s*h,e[7]=-o*h-s*l-a*c,e}function Hx(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e}function jx(e,n,i){var o=n[0],s=n[1],a=n[2],h=n[3],l=i[4],c=i[5],A=i[6],f=i[7],d=n[4],p=n[5],g=n[6],v=n[7],w=i[0],C=i[1],P=i[2],T=i[3];return e[0]=o*T+h*w+s*P-a*C,e[1]=s*T+h*C+a*w-o*P,e[2]=a*T+h*P+o*C-s*w,e[3]=h*T-o*w-s*C-a*P,e[4]=o*f+h*l+s*A-a*c+d*T+v*w+p*P-g*C,e[5]=s*f+h*c+a*l-o*A+p*T+v*C+g*w-d*P,e[6]=a*f+h*A+o*c-s*l+g*T+v*P+d*C-p*w,e[7]=h*f-o*l-s*c-a*A+v*T-d*w-p*C-g*P,e}var Ux=Mx;var Gx=Ex;var Vx=Object.freeze({__proto__:null,add:function(e,n,i){return e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e[3]=n[3]+i[3],e[4]=n[4]+i[4],e[5]=n[5]+i[5],e[6]=n[6]+i[6],e[7]=n[7]+i[7],e},clone:function(e){var n=new Jy(8);return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n},conjugate:function(e,n){return e[0]=-n[0],e[1]=-n[1],e[2]=-n[2],e[3]=n[3],e[4]=-n[4],e[5]=-n[5],e[6]=-n[6],e[7]=n[7],e},copy:Hx,create:function(){var e=new Jy(8);return Jy!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e},dot:Ux,equals:function(e,n){var i=e[0],o=e[1],s=e[2],a=e[3],h=e[4],l=e[5],c=e[6],A=e[7],f=n[0],d=n[1],p=n[2],g=n[3],v=n[4],w=n[5],C=n[6],P=n[7];return Math.abs(i-f)<=Yy*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(o-d)<=Yy*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(s-p)<=Yy*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(a-g)<=Yy*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(h-v)<=Yy*Math.max(1,Math.abs(h),Math.abs(v))&&Math.abs(l-w)<=Yy*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(c-C)<=Yy*Math.max(1,Math.abs(c),Math.abs(C))&&Math.abs(A-P)<=Yy*Math.max(1,Math.abs(A),Math.abs(P))},exactEquals:function(e,n){return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]&&e[3]===n[3]&&e[4]===n[4]&&e[5]===n[5]&&e[6]===n[6]&&e[7]===n[7]},fromMat4:function(e,n){var i=ex();Nv(i,n);var o=new Jy(3);return Lv(o,n),Bx(e,i,o),e},fromRotation:function(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},fromRotationTranslation:Bx,fromRotationTranslationValues:function(e,n,i,o,s,a,h){var l=new Jy(8);l[0]=e,l[1]=n,l[2]=i,l[3]=o;var c=.5*s,A=.5*a,f=.5*h;return l[4]=c*o+A*i-f*n,l[5]=A*o+f*e-c*i,l[6]=f*o+c*n-A*e,l[7]=-c*e-A*n-f*i,l},fromTranslation:function(e,n){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*n[0],e[5]=.5*n[1],e[6]=.5*n[2],e[7]=0,e},fromValues:function(e,n,i,o,s,a,h,l){var c=new Jy(8);return c[0]=e,c[1]=n,c[2]=i,c[3]=o,c[4]=s,c[5]=a,c[6]=h,c[7]=l,c},getDual:function(e,n){return e[0]=n[4],e[1]=n[5],e[2]=n[6],e[3]=n[7],e},getReal:xx,getTranslation:function(e,n){var i=n[4],o=n[5],s=n[6],a=n[7],h=-n[0],l=-n[1],c=-n[2],A=n[3];return e[0]=2*(i*A+a*h+o*c-s*l),e[1]=2*(o*A+a*l+s*h-i*c),e[2]=2*(s*A+a*c+i*l-o*h),e},identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},invert:function(e,n){var i=Gx(n);return e[0]=-n[0]/i,e[1]=-n[1]/i,e[2]=-n[2]/i,e[3]=n[3]/i,e[4]=-n[4]/i,e[5]=-n[5]/i,e[6]=-n[6]/i,e[7]=n[7]/i,e},len:Sx,length:Sx,lerp:function(e,n,i,o){var s=1-o;return Ux(n,i)<0&&(o=-o),e[0]=n[0]*s+i[0]*o,e[1]=n[1]*s+i[1]*o,e[2]=n[2]*s+i[2]*o,e[3]=n[3]*s+i[3]*o,e[4]=n[4]*s+i[4]*o,e[5]=n[5]*s+i[5]*o,e[6]=n[6]*s+i[6]*o,e[7]=n[7]*s+i[7]*o,e},mul:jx,multiply:jx,normalize:function(e,n){var i=Gx(n);if(i>0){i=Math.sqrt(i);var o=n[0]/i,s=n[1]/i,a=n[2]/i,h=n[3]/i,l=n[4],c=n[5],A=n[6],f=n[7],d=o*l+s*c+a*A+h*f;e[0]=o,e[1]=s,e[2]=a,e[3]=h,e[4]=(l-o*d)/i,e[5]=(c-s*d)/i,e[6]=(A-a*d)/i,e[7]=(f-h*d)/i}return e},rotateAroundAxis:function(e,n,i,o){if(Math.abs(o)<Yy)return Hx(e,n);var s=Math.hypot(i[0],i[1],i[2]);o*=.5;var a=Math.sin(o),h=a*i[0]/s,l=a*i[1]/s,c=a*i[2]/s,A=Math.cos(o),f=n[0],d=n[1],p=n[2],g=n[3];e[0]=f*A+g*h+d*c-p*l,e[1]=d*A+g*l+p*h-f*c,e[2]=p*A+g*c+f*l-d*h,e[3]=g*A-f*h-d*l-p*c;var v=n[4],w=n[5],C=n[6],P=n[7];return e[4]=v*A+P*h+w*c-C*l,e[5]=w*A+P*l+C*h-v*c,e[6]=C*A+P*c+v*l-w*h,e[7]=P*A-v*h-w*l-C*c,e},rotateByQuatAppend:function(e,n,i){var o=i[0],s=i[1],a=i[2],h=i[3],l=n[0],c=n[1],A=n[2],f=n[3];return e[0]=l*h+f*o+c*a-A*s,e[1]=c*h+f*s+A*o-l*a,e[2]=A*h+f*a+l*s-c*o,e[3]=f*h-l*o-c*s-A*a,e[4]=(l=n[4])*h+(f=n[7])*o+(c=n[5])*a-(A=n[6])*s,e[5]=c*h+f*s+A*o-l*a,e[6]=A*h+f*a+l*s-c*o,e[7]=f*h-l*o-c*s-A*a,e},rotateByQuatPrepend:function(e,n,i){var o=n[0],s=n[1],a=n[2],h=n[3],l=i[0],c=i[1],A=i[2],f=i[3];return e[0]=o*f+h*l+s*A-a*c,e[1]=s*f+h*c+a*l-o*A,e[2]=a*f+h*A+o*c-s*l,e[3]=h*f-o*l-s*c-a*A,e[4]=o*(f=i[7])+h*(l=i[4])+s*(A=i[6])-a*(c=i[5]),e[5]=s*f+h*c+a*l-o*A,e[6]=a*f+h*A+o*c-s*l,e[7]=h*f-o*l-s*c-a*A,e},rotateX:function(e,n,i){var o=-n[0],s=-n[1],a=-n[2],h=n[3],l=n[4],c=n[5],A=n[6],f=n[7],d=l*h+f*o+c*a-A*s,p=c*h+f*s+A*o-l*a,g=A*h+f*a+l*s-c*o,v=f*h-l*o-c*s-A*a;return ox(e,n,i),e[4]=d*(h=e[3])+v*(o=e[0])+p*(a=e[2])-g*(s=e[1]),e[5]=p*h+v*s+g*o-d*a,e[6]=g*h+v*a+d*s-p*o,e[7]=v*h-d*o-p*s-g*a,e},rotateY:function(e,n,i){var o=-n[0],s=-n[1],a=-n[2],h=n[3],l=n[4],c=n[5],A=n[6],f=n[7],d=l*h+f*o+c*a-A*s,p=c*h+f*s+A*o-l*a,g=A*h+f*a+l*s-c*o,v=f*h-l*o-c*s-A*a;return sx(e,n,i),e[4]=d*(h=e[3])+v*(o=e[0])+p*(a=e[2])-g*(s=e[1]),e[5]=p*h+v*s+g*o-d*a,e[6]=g*h+v*a+d*s-p*o,e[7]=v*h-d*o-p*s-g*a,e},rotateZ:function(e,n,i){var o=-n[0],s=-n[1],a=-n[2],h=n[3],l=n[4],c=n[5],A=n[6],f=n[7],d=l*h+f*o+c*a-A*s,p=c*h+f*s+A*o-l*a,g=A*h+f*a+l*s-c*o,v=f*h-l*o-c*s-A*a;return ax(e,n,i),e[4]=d*(h=e[3])+v*(o=e[0])+p*(a=e[2])-g*(s=e[1]),e[5]=p*h+v*s+g*o-d*a,e[6]=g*h+v*a+d*s-p*o,e[7]=v*h-d*o-p*s-g*a,e},scale:function(e,n,i){return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=n[3]*i,e[4]=n[4]*i,e[5]=n[5]*i,e[6]=n[6]*i,e[7]=n[7]*i,e},set:function(e,n,i,o,s,a,h,l,c){return e[0]=n,e[1]=i,e[2]=o,e[3]=s,e[4]=a,e[5]=h,e[6]=l,e[7]=c,e},setDual:function(e,n){return e[4]=n[0],e[5]=n[1],e[6]=n[2],e[7]=n[3],e},setReal:xx,sqrLen:Gx,squaredLength:Gx,str:function(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"},translate:function(e,n,i){var o=n[0],s=n[1],a=n[2],h=n[3],l=.5*i[0],c=.5*i[1],A=.5*i[2],f=n[4],d=n[5],p=n[6],g=n[7];return e[0]=o,e[1]=s,e[2]=a,e[3]=h,e[4]=h*l+s*A-a*c+f,e[5]=h*c+a*l-o*A+d,e[6]=h*A+o*c-s*l+p,e[7]=-o*l-s*c-a*A+g,e}});function Wx(){var e=new Jy(2);return Jy!=Float32Array&&(e[0]=0,e[1]=0),e}function qx(e,n){return e[0]=n[0],e[1]=n[1],e}function Zx(e,n,i){return e[0]=n,e[1]=i,e}function Qx(e,n,i){return e[0]=n[0]+i[0],e[1]=n[1]+i[1],e}function Xx(e,n,i){return e[0]=n[0]-i[0],e[1]=n[1]-i[1],e}function Yx(e,n,i){return e[0]=n[0]*i[0],e[1]=n[1]*i[1],e}function Jx(e,n,i){return e[0]=n[0]/i[0],e[1]=n[1]/i[1],e}function Kx(e,n,i){return e[0]=n[0]*i,e[1]=n[1]*i,e}function $x(e,n){return Math.hypot(n[0]-e[0],n[1]-e[1])}function tb(e,n){var i=n[0]-e[0],o=n[1]-e[1];return i*i+o*o}function eb(e){return Math.hypot(e[0],e[1])}function nb(e){var n=e[0],i=e[1];return n*n+i*i}function ib(e,n){return e[0]*n[0]+e[1]*n[1]}function rb(e,n,i){var o=n[0],s=n[1];return e[0]=i[0]*o+i[2]*s,e[1]=i[1]*o+i[3]*s,e}function ob(e,n,i,o){var s=n[0]-i[0],a=n[1]-i[1],h=Math.sin(o),l=Math.cos(o);return e[0]=s*l-a*h+i[0],e[1]=s*h+a*l+i[1],e}function sb(e,n){return e[0]===n[0]&&e[1]===n[1]}var ab=eb,hb=Xx,lb=Yx,ub=Jx,cb=$x,Ab=tb,fb=nb,db=function(){var e=Wx();return function(n,i,o,s,a,h){var l,c;for(i||(i=2),o||(o=0),c=s?Math.min(s*i+o,n.length):n.length,l=o;l<c;l+=i)e[0]=n[l],e[1]=n[l+1],a(e,e,h),n[l]=e[0],n[l+1]=e[1];return n}}(),pb=Object.freeze({__proto__:null,add:Qx,angle:function(e,n){var i=e[0],o=e[1],s=n[0],a=n[1],h=Math.sqrt(i*i+o*o)*Math.sqrt(s*s+a*a);return Math.acos(Math.min(Math.max(h&&(i*s+o*a)/h,-1),1))},ceil:function(e,n){return e[0]=Math.ceil(n[0]),e[1]=Math.ceil(n[1]),e},clone:function(e){var n=new Jy(2);return n[0]=e[0],n[1]=e[1],n},copy:qx,create:Wx,cross:function(e,n,i){var o=n[0]*i[1]-n[1]*i[0];return e[0]=e[1]=0,e[2]=o,e},dist:cb,distance:$x,div:ub,divide:Jx,dot:ib,equals:function(e,n){var i=e[0],o=e[1],s=n[0],a=n[1];return Math.abs(i-s)<=Yy*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(o-a)<=Yy*Math.max(1,Math.abs(o),Math.abs(a))},exactEquals:sb,floor:function(e,n){return e[0]=Math.floor(n[0]),e[1]=Math.floor(n[1]),e},forEach:db,fromValues:function(e,n){var i=new Jy(2);return i[0]=e,i[1]=n,i},inverse:function(e,n){return e[0]=1/n[0],e[1]=1/n[1],e},len:ab,length:eb,lerp:function(e,n,i,o){var s=n[0],a=n[1];return e[0]=s+o*(i[0]-s),e[1]=a+o*(i[1]-a),e},max:function(e,n,i){return e[0]=Math.max(n[0],i[0]),e[1]=Math.max(n[1],i[1]),e},min:function(e,n,i){return e[0]=Math.min(n[0],i[0]),e[1]=Math.min(n[1],i[1]),e},mul:lb,multiply:Yx,negate:function(e,n){return e[0]=-n[0],e[1]=-n[1],e},normalize:function(e,n){var i=n[0],o=n[1],s=i*i+o*o;return s>0&&(s=1/Math.sqrt(s)),e[0]=n[0]*s,e[1]=n[1]*s,e},random:function(e,n){n=n||1;var i=2*Ky()*Math.PI;return e[0]=Math.cos(i)*n,e[1]=Math.sin(i)*n,e},rotate:ob,round:function(e,n){return e[0]=Math.round(n[0]),e[1]=Math.round(n[1]),e},scale:Kx,scaleAndAdd:function(e,n,i,o){return e[0]=n[0]+i[0]*o,e[1]=n[1]+i[1]*o,e},set:Zx,sqrDist:Ab,sqrLen:fb,squaredDistance:tb,squaredLength:nb,str:function(e){return"vec2("+e[0]+", "+e[1]+")"},sub:hb,subtract:Xx,transformMat2:rb,transformMat2d:function(e,n,i){var o=n[0],s=n[1];return e[0]=i[0]*o+i[2]*s+i[4],e[1]=i[1]*o+i[3]*s+i[5],e},transformMat3:function(e,n,i){var o=n[0],s=n[1];return e[0]=i[0]*o+i[3]*s+i[6],e[1]=i[1]*o+i[4]*s+i[7],e},transformMat4:function(e,n,i){var o=n[0],s=n[1];return e[0]=i[0]*o+i[4]*s+i[12],e[1]=i[1]*o+i[5]*s+i[13],e},zero:function(e){return e[0]=0,e[1]=0,e}}),gb="undefined"!=typeof Float32Array?Float32Array:Array;function mb(){var e=new gb(3);return gb!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function yb(e,n,i){var o=new gb(3);return o[0]=e,o[1]=n,o[2]=i,o}function vb(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function _b(e,n,i,o){return e[0]=n,e[1]=i,e[2]=o,e}function xb(e,n,i){return e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e}function bb(e,n){var i=n[0],o=n[1],s=n[2],a=i*i+o*o+s*s;return a>0&&(a=1/Math.sqrt(a),e[0]=n[0]*a,e[1]=n[1]*a,e[2]=n[2]*a),e}function wb(e,n){return e[0]*n[0]+e[1]*n[1]+e[2]*n[2]}function Cb(e,n,i){var o=n[0],s=n[1],a=n[2],h=i[0],l=i[1],c=i[2];return e[0]=s*c-a*l,e[1]=a*h-o*c,e[2]=o*l-s*h,e}var Pb=function(e,n,i){return e[0]=n[0]-i[0],e[1]=n[1]-i[1],e[2]=n[2]-i[2],e};function Mb(){var e=new gb(4);return gb!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Tb(e,n){var i=n[0]+n[4]+n[8],o=void 0;if(i>0)o=Math.sqrt(i+1),e[3]=.5*o,e[0]=(n[5]-n[7])*(o=.5/o),e[1]=(n[6]-n[2])*o,e[2]=(n[1]-n[3])*o;else{var s=0;n[4]>n[0]&&(s=1),n[8]>n[3*s+s]&&(s=2);var a=(s+1)%3,h=(s+2)%3;o=Math.sqrt(n[3*s+s]-n[3*a+a]-n[3*h+h]+1),e[s]=.5*o,e[3]=(n[3*a+h]-n[3*h+a])*(o=.5/o),e[a]=(n[3*a+s]+n[3*s+a])*o,e[h]=(n[3*h+s]+n[3*s+h])*o}return e}!function(){var e=mb()}(),function(){var e,n=(e=new gb(4),gb!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e)}();var Sb=function(e,n,i){return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=n[3]*i,e},Ib=function(e,n){var i=n[0],o=n[1],s=n[2],a=n[3],h=i*i+o*o+s*s+a*a;return h>0&&(h=1/Math.sqrt(h),e[0]=i*h,e[1]=o*h,e[2]=s*h,e[3]=a*h),e};!function(){var e=mb(),n=yb(1,0,0),i=yb(0,1,0)}(),function(){var e=Mb(),n=Mb()}(),function(){var e,n=(e=new gb(9),gb!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e)}();
/*!
   * Contains code from google filament
   * https://github.com/google/filament/
   * License Apache-2.0
   */
const Eb=8,Ob=[],Rb=[],Db=[],kb=[];function Lb(e,n,i){const o=Cb(Rb,n,i);e=Tb(e,function(e,n,i,o,s,a,h,l,c,A){return e[0]=n,e[1]=i,e[2]=o,e[3]=s,e[4]=a,e[5]=h,e[6]=l,e[7]=c,e[8]=A,e}(Ob,i[0],i[1],i[2],...o,...n)),e=function(e){return e[3]<0?Sb(e,e,-1):e}(e=Ib(e,e));const s=1/((1<<2*Eb-1)-1);if(e[3]<s){e[3]=s;const n=Math.sqrt(1-s*s);e[0]*=n,e[1]*=n,e[2]*=n}const a=i[3]>0?Cb(Db,i,n):Cb(Db,n,i);return wb(Cb(kb,i,n),a)<0&&Sb(e,e,-1),e}const Fb=[];function Nb(e,n,i){const o=i||[];o.setLength&&o.setLength(e.length);const s=Fb;s.length<e.length/3&&(s.length=e.length/3),s.fill(0,0,e.length/3);const a=void 0===n.length?n:n.length;for(let i=0;i<a/3;i++)void 0===n.length?Wb(e,3*i,3*i+1,3*i+2,o,s):Wb(e,n[3*i],n[3*i+1],n[3*i+2],o,s);const h=o.getLength?o.getLength():o.length;for(let e=0;e<h;e+=3){const n=s[e/3];0!==n?(o[e]/=n,o[e+1]/=n,o[e+2]/=n):(o[e]=0,o[e+1]=0,o[e+2]=0)}return o}const zb=[],Bb=[],Hb=[],jb=[],Ub=[],Gb=[],Vb=[];function Wb(e,n,i,o,s,a){_b(jb,e[3*n],e[3*n+1],e[3*n+2]),_b(Ub,e[3*i],e[3*i+1],e[3*i+2]),_b(Gb,e[3*o],e[3*o+1],e[3*o+2]);const h=Pb(zb,Gb,Ub),l=Pb(Bb,jb,Ub),c=Cb(Hb,h,l);bb(Vb,c),s[3*n]=s[3*n]||0,s[3*i]=s[3*i]||0,s[3*o]=s[3*o]||0,s[3*n+1]=s[3*n+1]||0,s[3*i+1]=s[3*i+1]||0,s[3*o+1]=s[3*o+1]||0,s[3*n+2]=s[3*n+2]||0,s[3*i+2]=s[3*i+2]||0,s[3*o+2]=s[3*o+2]||0,s[3*n]+=Vb[0],s[3*i]+=Vb[0],s[3*o]+=Vb[0],s[3*n+1]+=Vb[1],s[3*i+1]+=Vb[1],s[3*o+1]+=Vb[1],s[3*n+2]+=Vb[2],s[3*i+2]+=Vb[2],s[3*o+2]+=Vb[2],a[n]+=1,a[i]+=1,a[o]+=1}
/*!
   * Contains code from THREE.JS
   * https://github.com/mrdoob/three.js/
   * License MIT
   *
   * Generate tangents per vertex.
   */function qb(e,n,i,o,s){const a=(e.getLength?e.getLength():e.length)/3,h=s||new Array(4*a),l=[],c=[];for(let e=0;e<a;e++)l[e]=[0,0,0],c[e]=[0,0,0];const A=[0,0,0],f=[0,0,0],d=[0,0,0],p=[0,0],g=[0,0],v=[0,0],w=[0,0,0],C=[0,0,0];function P(n,o,s){Zb(A,e,3*n),Zb(f,e,3*o),Zb(d,e,3*s),Qb(p,i,2*n),Qb(g,i,2*o),Qb(v,i,2*s);const a=f[0]-A[0],h=d[0]-A[0],P=f[1]-A[1],T=d[1]-A[1],S=f[2]-A[2],I=d[2]-A[2],E=g[0]-p[0],O=v[0]-p[0],k=g[1]-p[1],L=v[1]-p[1],F=1/(E*L-O*k);_b(w,(L*a-k*h)*F,(L*P-k*T)*F,(L*S-k*I)*F),_b(C,(E*h-O*a)*F,(E*T-O*P)*F,(E*I-O*S)*F),xb(l[n],l[n],w),xb(l[o],l[o],w),xb(l[s],l[s],w),xb(c[n],c[n],C),xb(c[o],c[o],C),xb(c[s],c[s],C)}for(let e=0,n=o.length;e<n;e+=3)P(o[e+0],o[e+1],o[e+2]);const T=[],S=[],I=[],E=[];let O,k,L;function F(e){Zb(I,n,3*e),vb(E,I),k=l[e],vb(T,k),Pb(T,T,function(e,n,i){return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e}(I,I,wb(I,k))),bb(T,T),Cb(S,E,k),L=wb(S,c[e]),O=L<0?-1:1,h[4*e]=T[0],h[4*e+1]=T[1],h[4*e+2]=T[2],h[4*e+3]=O}for(let e=0,n=o.length;e<n;e+=3)F(o[e+0]),F(o[e+1]),F(o[e+2]);return h}function Zb(e,n,i){return e[0]=n[i],e[1]=n[i+1],e[2]=n[i+2],e}function Qb(e,n,i){return e[0]=n[i],e[1]=n[i+1],e}
/*!
   * @maptalks/reshader.gl v0.101.1
   * LICENSE : UNLICENSED
   * (c) 2016-2024 maptalks.com
   */function Xb(e){return!Yb(e)&&("string"==typeof e||null!==e.constructor&&e.constructor===String)}function Yb(e){return null==e}function Jb(e){return!Yb(e)}function Kb(e){return!Yb(e)&&("function"==typeof e||null!==e.constructor&&e.constructor===Function)}function $b(e,...n){return Object.assign(e,...n),e}function tw(e,...n){for(let i=0;i<n.length;i++){const o=n[i];for(const n in o)null!=o[n]&&(e[n]=o[n])}return e}function ew(e){return"number"==typeof e&&!isNaN(e)}function nw(e,n,i){return e*(1-i)+n*i}function iw(e){return Array.isArray(e)||e instanceof Uint8Array||e instanceof Int8Array||e instanceof Uint16Array||e instanceof Int16Array||e instanceof Uint32Array||e instanceof Int32Array||e instanceof Uint8ClampedArray||e instanceof Float32Array||e instanceof Float64Array}function rw(e){return(e=Math.abs(e))<128?Int8Array:e<32768?Int16Array:Float32Array}function ow(e,n,i){return Math.min(i,Math.max(n,e))}function sw(e){return e&&e.hasExtension("oes_vertex_array_object")}function aw(e,n){return Object.prototype.hasOwnProperty.call(e,n)}function hw(e){if(e.data){if(e.data.BYTES_PER_ELEMENT)return e.data.length*e.data.BYTES_PER_ELEMENT;if(e.data.length)return 4*e.data.length}else{if(e.BYTES_PER_ELEMENT)return e.length*e.BYTES_PER_ELEMENT;if(e.length)return 4*e.length;if(e.buffer&&e.buffer.destroy)return e.buffer._buffer.byteLength}return 0}function lw(e){return e.width*e.height*cw(e.format)*uw(e.type)*("textureCube"===e._reglType?6:1)}function uw(e){return"uint8"===e?1:"uint16"===e||"float16"===e||"half float"===e?2:"uint32"===e||"float"===e||"float32"===e?4:0}function cw(e){return"depth"===e||"alpha"===e||"luminance"===e?1:"luminance alpha"===e||"depth stencil"===e?2:"srgba"===e||"rgb5 a1"===e||"rgba"===e.substring(0,4)?4:"srgb"===e||"rgb"===e.substring(0,3)?3:1}function Aw(e){if(!e.componentType)return!1;const n=zy.getTypedArrayCtor(e.componentType);return e.byteStride>0&&e.byteStride!==e.itemSize*n.BYTES_PER_ELEMENT}function fw(e){return e&&(e.stride>0||Aw(e))}function dw(e){let n=0;const i=e&&e.length||0;if(!i)return n;let o;for(let s=0;s<i;s++)o=e.charCodeAt(s),n=(n<<5)-n+o,n|=0;return n}function pw(e){return!(e&e-1)&&0!==e}function gw(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function mw(e,n,i){if(iw(e))return pw(n)&&pw(i)?e:function(e,n,i){let o=n,s=i;pw(n)||(o=gw(n)),pw(i)||(s=gw(i));const a=new ImageData(new Uint8ClampedArray(e),n,i),h=document.createElement("canvas");h.width=n,h.height=i,h.getContext("2d").putImageData(a,0,0);const l=document.createElement("canvas");l.width=o,l.height=s,l.getContext("2d").drawImage(h,0,0,n,i,0,0,s,s),console.warn(`Texture's size is not power of two, resize from (${n}, ${i}) to (${o}, ${s})`);let c=document.getElementById("_debug_resize_canvas");return c||(c=document.createElement("canvas"),c.id="_debug_resize_canvas",document.body.appendChild(c)),c.width=o,c.height=s,c.getContext("2d").drawImage(l,0,0),l}(e,n,i);if(pw(e.width)&&pw(e.height))return e;i=e.height,pw(n=e.width)||(n=gw(n)),pw(i)||(i=gw(i));const o=document.createElement("canvas");o.width=n,o.height=i,o.getContext("2d").drawImage(e,0,0,n,i);const s=e.src,a=s.lastIndexOf("/")+1,h=s.substring(a);return console.warn(`Texture(${h})'s size is not power of two, resize from (${e.width}, ${e.height}) to (${n}, ${i})`),o}function yw(e){return e._gl instanceof WebGL2RenderingContext}var vw=Object.freeze({__proto__:null,clamp:ow,defined:Jb,extend:$b,extendWithoutNil:tw,getBufferSize:hw,getPosArrayType:rw,getSupportedFormats:function(e){return{etc:!!e.getExtension("WEBGL_compressed_texture_etc"),etc1:!!e.getExtension("WEBGL_compressed_texture_etc1"),s3tc:!!e.getExtension("WEBGL_compressed_texture_s3tc"),pvrtc:!!e.getExtension("WEBGL_compressed_texture_pvrtc"),astc:!!e.getExtension("WEBGL_compressed_texture_astc"),bc7:!!e.getExtension("EXT_texture_compression_bptc")}},getTexMemorySize:lw,getTextureByteWidth:uw,getTextureChannels:cw,hasOwn:aw,hashCode:dw,interpolate:nw,isArray:iw,isFunction:Kb,isInStride:Aw,isInterleaved:fw,isNil:Yb,isNumber:ew,isPowerOfTwo:pw,isString:Xb,isSupportVAO:sw,lerp:function(e,n,i,o){for(let s=0;s<e.length;s++)e[s]=n[s]+o*(i[s]-n[s]);return e},log2:function(e){return Math.log2(e)},normalize:function(e,n){let i=0;for(let e=0,o=n.length;e<o;e++)i+=n[e];for(let o=0,s=n.length;o<s;o++)e[o]=n[o]/i;return e},resizeToPowerOfTwo:mw,set:function(e,n){for(let i=0;i<e.length;i++)e[i]=n[i];return e},supportNPOT:yw});function _w(e){return class extends e{on(e,n){return this._events||(this._events={type:[n]}),this._events[e]=this._events[e]||[],this._events[e].push(n),this}once(e,n){return this.on(e,this._wrapOnce(e,n))}off(e,n){return this._events&&this._events[e]?(this._events[e].splice(this._events[e].indexOf(n),1),this):this}fire(e,n={}){if(!this._events||!this._events[e])return this;n.target||(n.target=this);const i=this._events[e].slice(0);for(const e of i)e(n);return this}_wrapOnce(e,n){const i=this;let o=!1;return function s(a){o||(o=!0,n(a),i.off(e,s))}}}}const xw="__reshader_disposed";var bw=Object.freeze({__proto__:null,KEY_DISPOSED:xw,WEBGL_EXTENSIONS:["ANGLE_instanced_arrays","OES_element_index_uint","OES_standard_derivatives"],WEBGL_OPTIONAL_EXTENSIONS:["OES_vertex_array_object","OES_texture_half_float","OES_texture_half_float_linear","OES_texture_float","OES_texture_float_linear","WEBGL_depth_texture","EXT_shader_texture_lod","EXT_texture_filter_anisotropic"]});const ww="_reshader_refCount";let Cw=class U{},Pw=class G extends(_w(Cw)){constructor(e,n){if(super(),Kb(e)){this._texture=e,e=this.config={};for(const n in this._texture)aw(this._texture,n)&&(Kb(this._texture[n])||(e[n]=this._texture[n]))}else if(this.config=e||{},this.resLoader=n,(e.url||e.promise)&&!e.data){this._loading=!0;const i=this;let o;if(e.promise)o=e.promise;else{let i;i=e.arrayBuffer?n.getArrayBuffer:n.get,o=i.call(n,e.url)}e.data=n.getDefaultTexture(e.url),this.promise=o,o.then((e=>(delete this.promise,i._loading=!1,i.config?(i.onLoad(e),Array.isArray(e)||(e=[e]),i.fire("complete",{target:this,resources:e}),e):e))).catch((e=>{console.error("error when loading texture image.",e),i.fire("error",{target:this,error:e})}))}}onLoad(e){}isReady(){return!this._loading}set(e,n){return this.config[e]=n,this.dirty=!0,this}get(e){return this.config[e]}createREGLTexture(e){return null}getREGLTexture(e){return this._texture||(this._texture=this.createREGLTexture(e),this.config.persistent||(this.config.data&&(this.config.data instanceof ImageBitmap||(this.config.data=[])),this.config.image&&(this.config.image.array=[]),this.config.mipmap&&delete this.config.mipmap)),this.dirty&&this._updateREGL(),this._texture}getMemorySize(){if(!this.config)return 0;const{width:e,height:n,type:i,format:o}=this.config;return e*n*uw(i||"uint8")*cw(o||"rgba")}_updateREGL(){this._texture&&!this._texture[xw]&&this._texture(this.config),this.dirty=!1}dispose(){this.config&&this.config.url&&(URL.revokeObjectURL(this.config.url),this.resLoader.disposeRes(this.config.url)),this.config&&this.config.data instanceof ImageBitmap&&(this.config.data.close(),this.config.data=[]),this._texture&&!this._texture[xw]&&(this._texture[ww]&&this._texture[ww]--,this._texture[ww]||(this._texture.destroy(),this._texture[xw]=!0,delete this._texture)),delete this.resLoader,delete this._regl;const e=this.config&&this.config.url;delete this.config,e&&this.fire("disposed",{target:this,url:e})}_needPowerOf2(e){if(yw(e))return!1;const n=this.config;return n.wrap&&"clamp"!==n.wrap||n.wrapS&&"clamp"!==n.wrapS||n.wrapT&&"clamp"!==n.wrapT||n.min&&"nearest"!==n.min&&"linear"!==n.min}};const Mw=xv([]),Tw=xv([]);let Sw=class X{constructor(e,n){this.min=e||[1/0,1/0,1/0],this.max=n||[-1/0,-1/0,-1/0],this.updateVertex()}static copy(e,n){Kv(e.min,n.min),Kv(e.max,n.max);for(let i=0;i<n.vertex.length;i++)Kv(e.vertex[i],n.vertex[i]);return e}combine(e){if(!e)return this;let n,i;return Array.isArray(e)?(n=e[0],i=e[1]):(n=e.min,i=e.max),n[0]<this.min[0]&&(this.min[0]=n[0],this._dirty=!0),n[1]<this.min[1]&&(this.min[1]=n[1],this._dirty=!0),n[2]<this.min[2]&&(this.min[2]=n[2],this._dirty=!0),i[0]>this.max[0]&&(this.max[0]=i[0],this._dirty=!0),i[1]>this.max[1]&&(this.max[1]=i[1],this._dirty=!0),i[2]>this.max[2]&&(this.max[2]=i[2],this._dirty=!0),this}dirty(){return this._dirty=!0,this}getCenter(){return this.center||(this.center=[0,0,0],this._dirty=!0),this._dirty&&(t_(this.center,this.min,this.max),r_(this.center,this.center,.5)),this._dirty=!1,this.center}containPoint(e){const n=this.min,i=this.max;return n[0]<=e[0]&&n[1]<=e[1]&&n[2]<=e[2]&&i[0]>=e[0]&&i[1]>=e[1]&&i[2]>=e[2]}isFinite(){const e=this.min,n=this.max;return isFinite(e[0])&&isFinite(e[1])&&isFinite(e[2])&&isFinite(n[0])&&isFinite(n[1])&&isFinite(n[2])}updateVertex(){if(!this.vertex){this.vertex=[];for(let e=0;e<8;e++)this.vertex.push([0,0,0])}return this.vertex[0][0]=this.min[0],this.vertex[0][1]=this.min[1],this.vertex[0][2]=this.min[2],this.vertex[1][0]=this.min[0],this.vertex[1][1]=this.min[1],this.vertex[1][2]=this.max[2],this.vertex[2][0]=this.min[0],this.vertex[2][1]=this.max[1],this.vertex[2][2]=this.max[2],this.vertex[3][0]=this.min[0],this.vertex[3][1]=this.max[1],this.vertex[3][2]=this.min[2],this.vertex[4][0]=this.max[0],this.vertex[4][1]=this.min[1],this.vertex[4][2]=this.min[2],this.vertex[5][0]=this.max[0],this.vertex[5][1]=this.min[1],this.vertex[5][2]=this.max[2],this.vertex[6][0]=this.max[0],this.vertex[6][1]=this.max[1],this.vertex[6][2]=this.max[2],this.vertex[7][0]=this.max[0],this.vertex[7][1]=this.max[1],this.vertex[7][2]=this.min[2],this.vertex}copy(e){return e?X.copy(e,this):new X(this.min.slice(),this.max.slice())}equals(e){if(!p_(this.min,e.min)||!p_(this.max,e.max))return!1;const n=e.vertex;for(let e=0;e<this.vertex.length;e++)if(!p_(n[e],this.vertex[e]))return!1;return!0}transform(e,n){if(e=e||Tw,(n=n||Tw)[1]||n[2]||n[4]||n[6]||n[8]||n[9]){const i=this.vertex,o=Cv(Mw,n,e);for(let e=0;e<i.length;e++)A_(this.vertex[e],this.vertex[e],o);const s=this.vertex.map((e=>e[0])),a=this.vertex.map((e=>e[1])),h=this.vertex.map((e=>e[2])),l=Math.min(...s),c=Math.max(...s),A=Math.min(...a),f=Math.max(...a),d=Math.min(...h),p=Math.max(...h);$v(this.min,l,A,d),$v(this.max,c,f,p)}else{const i=Cv(Mw,n,e);A_(this.min,this.min,i),A_(this.max,this.max,i)}return this}};const Iw=[],Ew={5120:"int8",5122:"int16",5124:"int32",5121:"uint8",5123:"uint16",5125:"uint32",5126:"float"},Ow={5120:1,5122:2,5124:4,5121:1,5123:2,5125:4,5126:4},Rw={positionSize:3,primitive:"triangles",positionAttribute:"aPosition",normalAttribute:"aNormal",uv0Attribute:"aTexCoord",uv1Attribute:"aTexCoord1",color0Attribute:"aColor0",tangentAttribute:"aTangent",pickingIdAttribute:"aPickingId",textureCoordMatrixAttribute:"aTextureCoordMatrix"};let Dw=1;const kw="_reshader_refCount";let Lw=class Q{constructor(e,n,i,o){this._version=0,this.data=e,this.elements=n,this.desc=$b({},Rw,o);const s=this._getPosAttritute();this.data[this.desc.positionAttribute]=s,i||(this.elements?i=Fw(this.elements):s&&s.length?i=s.length/this.desc.positionSize:s&&s.interleavedArray?i=s.interleavedArray.length/this.desc.positionSize:s&&s.array&&(i=s.array.length/this.desc.positionSize)),this.count=i,this.elements||(this.elements=i),this.properties={},this._buffers={},this._vao={},this.getVertexCount(),this._prepareData(!0),this.updateBoundingBox()}set version(e){throw new Error("Geometry.version is read only.")}get version(){return this._version}_getPosAttritute(){return this.data[this.desc.positionAttribute]}_prepareData(e){if(!this.data)return;const n=this._buffers||{};for(const i in this.data){const o=this.data[i];if(o)if(o.buffer&&o.buffer.destroy){const n=o.buffer;n[kw]||(n[kw]=0),e&&n[kw]++}else if(o&&o.array)if(Aw(o)){let e=o.array.buffer.__id;e||(e=o.array.buffer.__id=Dw++),this.data[i]={buffer:e,offset:o.byteOffset,stride:o.byteStride,type:Ew[o.componentType],size:o.itemSize,count:o.count,componentType:o.componentType},n[e]||(n[e]={data:o.array.buffer})}else this.data[i]=o.array}this._buffers=n;const i=this.elements;i&&i.array&&(this.elements=i.array)}getAttrData(e){const n=e.key,i=!this._reglData||!this._reglData[n];if(this._reglData||(this._reglData={}),i){const e=this._reglData[n]={},i=this.data,{positionAttribute:o,normalAttribute:s,uv0Attribute:a,uv1Attribute:h,tangentAttribute:l,color0Attribute:c,pickingIdAttribute:A,textureCoordMatrixAttribute:f}=this.desc;$b(e,this.data),e.aPosition=i[o],i[s]&&(e.aNormal=i[s]),i[a]&&(e.aTexCoord=i[a]),i[h]&&(e.aTexCoord1=i[h]),i[l]&&(e.aTangent=i[l]),i[c]&&(e.aColor0=i[c]),i[A]&&(e.aPickingId=i[A]),i[f]&&(e.aTextureCoordMatrix=i[f])}return this._reglData[n]}getREGLData(e,n,i){this.getAttrData(n);const o=!this._reglData||!this._reglData[n.key];if(sw(e)&&!i){const i=n&&n.key||"default";if(!this._vao[i]||o||this._vao[i].dirty){const o=this._reglData[n.key],s=this._vertexCount,a=[];for(let e=0;e<n.length;e++){const i=n[e].name,h=o[i]&&o[i].buffer;if(h&&h.destroy)a.push(void 0!==o[i].stride?o[i]:h);else{const e=o[i];if(!e){a.push(this.desc.fillEmptyDataInMissingAttribute?new Uint8Array(4*s):Iw);continue}const n=(e.data&&iw(e.data)?e.data.length:e.length)/s;e.data?(e.dimension=n,a.push(e)):a.push({data:e,dimension:n})}}const h={attributes:a,primitive:this.getPrimitive()};if(this.elements&&!ew(this.elements))if(this.elements.destroy)h.elements=this.elements;else{h.elements={primitive:this.getPrimitive(),data:this.elements};const e=this.getElementsType(this.elements);e&&(h.elements.type=e)}this._vao[i]?this._vao[i].vao(h):this._vao[i]={vao:e.vao(h)}}return delete this._vao[i].dirty,this._vao[i]}return this._reglData[n.key]}_isAttrChanged(e){if(e===this._activeAttributes)return!1;if(e.length!==this._activeAttributes.length)return!0;for(let n=0;n<e.length;n++)if(e[n]!==this._activeAttributes[n])return!0;return!1}generateBuffers(e){const n=this._buffers;for(const i in n)n[i].buffer||(n[i].buffer=e.buffer(n[i].data)),delete n[i].data;const i=this.desc.positionAttribute,o=this.desc.altitudeAttribute,s=this.data,a=this._vertexCount,h={};for(const l in s)if(s[l]){if(void 0===s[l].buffer||s[l].buffer instanceof ArrayBuffer){const n=s[l].data?s[l]:{data:s[l]};n.dimension=(s[l].data?s[l].data:s[l]).length/a;const c=e.buffer(n);c[kw]=1,h[l]={buffer:c},l!==i&&l!==o||(h[l].array=s[l])}else s[l].buffer.destroy?h[l]=s[l]:n[s[l].buffer]&&(h[l]=$b({},s[l]),h[l].buffer=n[s[l].buffer].buffer);(this.desc.static||l!==i)&&delete s[l].array}if(this.data=h,delete this._reglData,this.elements&&!ew(this.elements)){const n={primitive:this.getPrimitive(),data:this.elements},i=this.getElementsType(this.elements);if(i&&(n.type=i),!this.desc.static&&!this.elements.destroy){const e=this.elements;this.indices=new Uint16Array(e.length);for(let n=0;n<e.length;n++)this.indices[n]=e[n]}this.elements=this.elements.destroy?this.elements:e.elements(n);const o=this.elements;o[kw]||(o[kw]=0),o[kw]++}}getVertexCount(){const{positionAttribute:e,positionSize:n,color0Attribute:i}=this.desc;let o=this.data[e];o.data&&(o=o.data),o.array&&(o=o.array),iw(o)?this._vertexCount=Math.ceil(o.length/n):o&&void 0!==o.count&&(this._vertexCount=o.count);const s=i;if(this.data[s]){const e=this.data[s].data||this.data[s].array||this.data[s];Array.isArray(e)?this._color0Size=e.length/this._vertexCount:e&&e.count?this._color0Size=e.count/this._vertexCount:this.data[s].buffer&&this.data[s].buffer.destroy&&(this._color0Size=this.data[s].buffer._buffer.dimension)}return this._vertexCount}getColor0Size(){return this._color0Size||0}addBuffer(e,n){return this._buffers[e]={data:n},delete this._reglData,this._deleteVAO(),this}updateBuffer(e,n){if(!this._buffers[e])throw new Error(`invalid buffer ${e} in geometry`);return this._buffers[e].buffer?this._buffers[e].buffer.subdata(n):this._buffers[e].data=n,delete this._reglData,this._deleteVAO(),this}deleteData(e){const n=this.data[e];return n?(this._incrVersion(),n.buffer&&n.buffer.destroy&&n.buffer.destroy(),delete this.data[e],delete this._reglData,this._markVAODirty(!1),this):this}updateData(e,n){const i=this.data[e];if(!i)return this;let o;return this._incrVersion(),this.data[e]=n,i.buffer&&i.buffer.destroy&&(o=i),e===this.desc.positionAttribute&&this.updateBoundingBox(),this.getVertexCount(),o&&(o.buffer(n),this.data[e]=o),this._prepareData(!1),this.desc.positionAttribute===e&&(this._posDirty=!0),delete this._reglData,this}updateSubData(e,n,i){const o=this.data[e];if(!o)return this;let s;if(this._incrVersion(),o.buffer&&o.buffer.destroy&&(s=o),e===this.desc.positionAttribute&&this._updateSubBoundingBox(n),s){const e=Ow[s.buffer._buffer.dtype];if(n.BYTES_PER_ELEMENT!==e){const i=function(e,n){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Uint8ClampedArray?1===n?Uint8Array:2===n?Uint16Array:Uint32Array:e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array?1===n?Int8Array:2===n?Int16Array:Int32Array:e instanceof Float32Array||e instanceof Float64Array?4===n?Float32Array:Float64Array:null}(n,e);n=new i(n)}s.buffer.subdata(n,i*e)}else{const o=this.data[e].data?this.data[e].data:this.data[e];for(let e=0;e<n.length;e++)o[i+e]=n[e]}return this._prepareData(!1),this.desc.positionAttribute===e&&(this._posDirty=!0),delete this._reglData,this}getPrimitive(){return this.desc.primitive}getElements(){return this.elements}setElements(e,n){if(!e)throw new Error("elements data is invalid");this._incrVersion();const i=this.elements;return this.count=void 0===n?Fw(e):n,this.elements=e&&e.destroy?e:i.destroy?i(e):e,this._markVAODirty(!0),this}deleteElements(){return this.elements&&0!==this.elements.length?(this._incrVersion(),this.elements&&this.elements.destroy&&!this.elements[xw]&&(this.elements.destroy(),this.elements[xw]=1),this.elements=[],this._markVAODirty(!0),this):this}_markVAODirty(e){if(this._vao){for(const n in this._vao)e?this._vao[n].vao.destroy():this._vao[n].dirty=!0;e&&(this._vao={})}}setDrawCount(e){return this._incrVersion(),this.count1=e,this}getDrawCount(){return this.count1>=0?this.count1:this.count}setDrawOffset(e){return this._incrVersion(),this.offset=e,this}getDrawOffset(){return this.offset||0}dispose(){if(this._deleteVAO(),this._forEachBuffer((e=>{if(!e[xw]){let n=e[kw];n&&n--,n<=0?(e[xw]=!0,e.destroy()):e[kw]=n}})),this.properties){const e=this.properties.oldElementsBeforeHighlight;e&&!e[xw]&&e.destroy&&(e.destroy(),e[xw]=!0),delete this.properties.oldElementsBeforeHighlight,delete this.properties.hasInvisible}this.data={},this._buffers={},delete this._reglData,this.count=0,this.elements=[],delete this._tempPosArray,this._disposed=!0}isDisposed(){return!!this._disposed}updateBoundingBox(){let e=this.boundingBox;e||(e=this.boundingBox=new Sw);let n,i,o=this.data[this.desc.positionAttribute];if(iw(o)||(o.data?o=o.data:fw(o)?o=this._getAttributeData(this.desc.positionAttribute):o.array&&(n=o.min,i=o.max,o=o.array)),o&&o.length){const s=e.min,a=e.max;if(n&&i)$v(s,...n),$v(a,...i);else{$v(s,o[0],o[1],o[2]),$v(a,o[0],o[1],o[2]);for(let e=3;e<o.length;){const n=o[e++],i=o[e++],h=o[e++];n<s[0]&&(s[0]=n),i<s[1]&&(s[1]=i),h<s[2]&&(s[2]=h),n>a[0]&&(a[0]=n),i>a[1]&&(a[1]=i),h>a[2]&&(a[2]=h)}}e.updateVertex(),e.dirty()}}_updateSubBoundingBox(e){const n=this.boundingBox,i=n.min,o=n.max,s=this.desc.positionSize;for(let n=0;n<e.length;){const a=e[n++],h=e[n++];let l=0;3===s&&(l=e[n++]),a<i[0]&&(i[0]=a),h<i[1]&&(i[1]=h),l<i[2]&&(i[2]=l),a>o[0]&&(o[0]=a),h>o[1]&&(o[1]=h),l>o[2]&&(o[2]=l)}n.updateVertex(),n.dirty()}_getAttributeData(e){const n=this.data[e]&&this.data[e].array?this.data[e].array:this.data[e],i=n.buffer;if(fw(n)){const o=this._buffers[i]?this._buffers[i].data:n.array,{count:s,size:a,stride:h,offset:l,componentType:c}=n,A=zy.getTypedArrayCtor(c);if((0===h||h===a*A.BYTES_PER_ELEMENT)&&l%A.BYTES_PER_ELEMENT==0)return new A(o,l,s*a);if(e===this.desc.positionAttribute)return!this._tempPosArray||this._tempPosArray&&this._tempPosArray.length<a*s?(this._tempPosArray=new A(a*s),zy.readInterleavedArray(this._tempPosArray,o,s,a,h,l,c)):this._posDirty?(this._posDirty=!1,zy.readInterleavedArray(this._tempPosArray,o,s,a,h,l,c)):this._tempPosArray;{const e=new A(a*s);return zy.readInterleavedArray(e,o,s,a,h,l,c)}}return n}createTangent(e="aTangent"){this._incrVersion();const{normalAttribute:n,positionAttribute:i,uv0Attribute:o}=this.desc,s=this._getAttributeData(n),a=qb(this._getAttributeData(i),s,this.data[o],this.elements),h=this.data[e]=new Float32Array(a.length),l=[0,0,0,0],c=[0,0,0],A=[0,0,0,0];for(let e=0;e<a.length;e+=4){const n=e/4*3;$v(c,s[n],s[n+1],s[n+2]),E_(l,a[e],a[e+1],a[e+2],a[e+3]),Lb(A,c,l),I_(h.subarray(e,e+4),A)}delete this._reglData}createNormal(e="aNormal"){this._incrVersion();const n=this._getAttributeData(this.desc.positionAttribute);this.data[e]=Nb(n.array||n,this.elements),delete this._reglData}createBarycentric(e="aBarycentric"){if("triangles"!==this.desc.primitive)throw new Error("Primitive must be triangles to create bary centric data");this._incrVersion();const n=new Uint8Array(3*this._vertexCount);for(let e=0,i=this.elements.length;e<i;)for(let i=0;i<3;i++)n[3*this.elements[e++]+i]=1;this.data[e]=n,delete this._reglData}buildUniqueVertex(){this._incrVersion();const e=this.data,n=this.elements;if(!iw(n))throw new Error("elements must be array to build unique vertex.");const i=Object.keys(e),o={};let s=e[this.desc.positionAttribute];if(s=s.length?s:s.array,!iw(s))throw new Error(this.desc.positionAttribute+" must be array to build unique vertex.");const a=this._vertexCount,h=n.length;for(let n=0;n<i.length;n++){const s=i[n],l=iw(e[s])?e[s]:e[s].array,c=l.length/a;if(!iw(l))throw new Error(s+" must be array to build unique vertex.");o[s]=l,e[s]=new l.constructor(h*c)}let l=0;for(let s=0;s<h;s++){const h=n[s];for(let n=0;n<i.length;n++){const s=i[n],c=e[s],A=o[s].length/a;for(let e=0;e<A;e++)c[l*A+e]=o[s][h*A+e]}n[s]=l++}s=this.data[this.desc.positionAttribute],this._vertexCount=Math.ceil(s.length/this.desc.positionSize),delete this._reglData}getMemorySize(){let e=0;for(const n in this.data)aw(this.data,n)&&(e+=hw(this.data[n]));if(this.elements){const n=this.elements;n.destroy?e+=n._elements.buffer.byteLength:n.BYTES_PER_ELEMENT?e+=n.length*n.BYTES_PER_ELEMENT:n.length&&(e+=4*n.length)}return e}_deleteVAO(){for(const e in this._vao)this._vao[e].vao.destroy();this._vao={}}_forEachBuffer(e){this.elements&&this.elements.destroy&&e(this.elements);for(const n in this.data)aw(this.data,n)&&this.data[n]&&this.data[n].buffer&&this.data[n].buffer.destroy&&e(this.data[n].buffer);for(const n in this._buffers)aw(this._buffers,n)&&this._buffers[n]&&this._buffers[n].buffer&&this._buffers[n].buffer.destroy&&e(this._buffers[n].buffer)}getElementsType(e){return e instanceof Uint8Array?"uint8":e instanceof Uint16Array?"uint16":e instanceof Uint32Array?"uint32":void 0}_incrVersion(){this._version++}};function Fw(e){if(ew(e))return e;if(void 0!==e.count)return e.count;if(e.destroy)return e._elements.vertCount;if(void 0!==e.length)return e.length;if(e.data)return e.data.length;throw new Error("invalid elements length")}const Nw=["points","lines","line strip","line loop","triangles","triangle strip","triangle fan"];function zw(e){return Nw[e]}const Bw={5121:"uint8",5123:"uint16",5125:"uint32",5126:"float",36193:"half float"};function Hw(e){return Bw[e]}const jw={6406:"alpha",6407:"rgb",6408:"rgba",6409:"luminance",6410:"luminance alpha",33776:"rgb s3tc dxt1",33777:"rgba s3tc dxt1",33778:"rgba s3tc dxt3",33779:"rgba s3tc dxt5",35840:"rgb pvrtc 4bppv1",35841:"rgb pvrtc 2bppv1",35842:"rgba pvrtc 4bppv1",35843:"rgba pvrtc 2bppv1",35986:"rgb atc",35987:"rgba atc explicit alpha",34798:"rgba atc interpolated alpha",36196:"rgb etc1"};function Uw(e){return jw[e]}const Gw={9729:"linear",9728:"nearest"};function Vw(e){return Gw[e]}const Ww={9729:"linear",9728:"nearest",9984:"nearest mipmap nearest",9985:"linear mipmap nearest",9986:"nearest mipmap linear",9987:"linear mipmap linear"};function qw(e){return Ww[e]}const Zw={10497:"repeat",33071:"clamp",33648:"mirror"};function Qw(e){return Zw[e]}const Xw="__reshader_webgl_buffer",Yw="__reshader_webgl_tex";function Jw(e,n,i){let o;if(iw(n)?n.buffer&&void 0!==n.byteOffset&&(o=n):n.array&&n.array.buffer&&void 0!==n.array.byteOffset&&(o=n.array),!o)return null;const s=o.buffer,a=o.byteOffset;s[Xw]||(s[Xw]={});let h=s[Xw][a];if(!h){const n={};i&&$b(n,i),n.data=o,h=e.buffer(n),s[Xw][a]=h}return h}function Kw(e,n){const i=n.data;if(!i||!i.buffer)return e.texture(n);const o=i.buffer,s=i.byteOffset;o[Yw]||(o[Yw]={});let a=o[Yw][s];return a||(a=e.texture(n),o[Yw][s]=a),a}var $w=Object.freeze({__proto__:null,getMaterialFormat:Uw,getMaterialType:Hw,getPrimitive:zw,getTextureMagFilter:Vw,getTextureMinFilter:qw,getTextureWrap:Qw,getUniqueREGLBuffer:Jw,getUniqueTexture:Kw});const tC=[0,0,0],eC=[0,0,0],nC=[0,0,0],iC=[],rC=[],oC=[],sC=["a","b","c"];let aC=class Te extends Lw{constructor(e,n,i,o){super(e,n,i,{primitive:zw(1),positionAttribute:o.positionAttribute})}_getPosAttritute(){const e=this.data[this.desc.positionAttribute];if(!e.length)return[];const n=Math.pow(10,4),i=Math.cos(Math.PI/180*.8),o=this.elements,s=e.length?e:e.array,a=o.length?o?o.length:s.length/3:o,h=[0,0,0],l=new Array(3),c={},A=[],f=new hC;for(let e=0;e<a;e+=3){o.length?(h[0]=o[e],h[1]=o[e+1],h[2]=o[e+2]):(h[0]=e,h[1]=e+1,h[2]=e+2),f.a=lC(iC,s,h[0]),f.b=lC(rC,s,h[1]),f.c=lC(oC,s,h[2]);const a=f.getNormal(),d=f.a,p=f.b,g=f.c;if(l[0]=`${Math.round(d[0]*n)},${Math.round(d[1]*n)},${Math.round(d[2]*n)}`,l[1]=`${Math.round(p[0]*n)},${Math.round(p[1]*n)},${Math.round(p[2]*n)}`,l[2]=`${Math.round(g[0]*n)},${Math.round(g[1]*n)},${Math.round(g[2]*n)}`,l[0]!==l[1]&&l[1]!==l[2]&&l[2]!==l[0])for(let e=0;e<3;e++)this._calEdgeData(e,h,f,c,l,i,a,A)}for(const e in c)if(c[e]){const{index0:n,index1:i}=c[e];A.push(s[3*n],s[3*n+1],s[3*n+2]),A.push(s[3*i],s[3*i+1],s[3*i+2])}return this.elements=this._createElements(A),A}_calEdgeData(e,n,i,o,s,a,h,l){const c=(e+1)%3,A=s[e],f=s[c],d=i[sC[e]],p=i[sC[c]],g=`${A}_${f}`,v=`${f}_${A}`;v in o&&o[v]?(u_(h,o[v].normal)<=a&&(l.push(d[0],d[1],d[2]),l.push(p[0],p[1],p[2])),o[v]=null):g in o||(o[g]={index0:n[e],index1:n[c],normal:Kv([0,0,0],h)})}_createElements(e){const n=[],i=e.length/3;for(let e=0;e<i;e++)n.push(e);return n}},hC=class Me{constructor(e=[0,0,0],n=[0,0,0],i=[0,0,0]){this.a=e,this.b=n,this.c=i}getNormal(){const e=m_(tC,this.a,this.b),n=m_(eC,this.a,this.c);c_(nC,e,n);const i=Yv(nC);return $v(nC,nC[0]/i,nC[1]/i,nC[2]/i)}};function lC(e,n,i){return $v(e,n[3*i],n[3*i+1],n[3*i+2])}let uC=class Ce{},cC=class Ee extends(_w(uC)){constructor(e={},n){super(),this._version=0,this._propVerion=0,this.uniforms=tw({},n||{},e);for(const n in e){const i=Object.getOwnPropertyDescriptor(e,n).get;i&&Object.defineProperty(this.uniforms,n,{get:i})}this.unlit=!1,this._reglUniforms={},this.refCount=0,this._bindedOnTextureComplete=(...e)=>this._onTextureComplete.call(this,...e),this._genUniformKeys(),this._checkTextures()}set version(e){throw new Error("Material.version is read only.")}get version(){return this._version}get propVersion(){return this._propVerion}set doubleSided(e){this.uniforms.doubleSided=e}get doubleSided(){return!!this.uniforms.doubleSided}isReady(){return this._loadingCount<=0}set(e,n){const i=Yb(this.uniforms[e])&&!Yb(n)||!Yb(this.uniforms[e])&&Yb(n);if(this.uniforms[e]&&this.isTexture(e)&&this.uniforms[e].dispose(),Yb(n))Yb(this.uniforms[e])||delete this.uniforms[e];else if(this.uniforms[e]=n,this._reglUniforms){const i=Object.getOwnPropertyDescriptor(this._reglUniforms,e);i&&!i.get&&(this._propVerion++,this._reglUniforms[e]=n)}return this.isTexture(e)&&this._checkTextures(),i&&(this._genUniformKeys(),this._incrVersion()),this}setFunctionUniform(e,n){return this._genUniformKeys(),this._incrVersion(),Object.defineProperty(this.uniforms,e,{enumerable:!0,get:n}),this}hasFunctionUniform(e){return!!this.uniforms&&Object.prototype.hasOwnProperty.call(this.uniforms,e)}get(e){return this.uniforms[e]}isDirty(){return this._uniformVer!==this.version}appendDefines(e,n){const i=this.uniforms;return i?(i.jointTexture&&(e.HAS_SKIN=1),i.morphWeights1&&(e.HAS_MORPH=1),(i.khr_offset||i.khr_rotation||i.khr_scale)&&(e.HAS_KHR_TEXTURE_TRANSFORM=1),e):e}hasSkinAnimation(){return!!(this.uniforms&&this.uniforms.jointTexture&&this.uniforms.skinAnimation)}getUniforms(e){if(this._reglUniforms&&!this.isDirty())return this._reglUniforms;const n=this.uniforms,i={};for(const o in n)this.isTexture(o)?Object.defineProperty(i,o,{enumerable:!0,configurable:!0,get:function(){return n[o].getREGLTexture(e)}}):Object.getOwnPropertyDescriptor(n,o).get?Object.defineProperty(i,o,{enumerable:!0,configurable:!0,get:function(){return n[o]}}):i[o]=n[o];return this._reglUniforms=i,this._uniformVer=this.version,i}isTexture(e){return this.uniforms[e]instanceof Pw}dispose(){for(const e in this.uniforms){const n=this.uniforms[e];n&&(n.dispose?n.dispose():n.destroy&&!n[xw]&&(n.destroy(),n[xw]=!0))}delete this.uniforms,delete this._reglUniforms,delete this._bindedOnTextureComplete,this._disposed=!0}isDisposed(){return!!this._disposed}_checkTextures(){this._loadingCount=0;for(const e in this.uniforms)if(this.isTexture(e)){const n=this.uniforms[e];n.isReady()||(this._loadingCount++,n.on("complete",this._bindedOnTextureComplete))}}_onTextureComplete(){this._loadingCount--,this._incrVersion(),this._loadingCount<=0&&(this._disposed||this.fire("complete"))}getUniformKeys(){return this._uniformKeys}_genUniformKeys(){const e=[];for(const n in this.uniforms)aw(this.uniforms,n)&&!Yb(this.uniforms[n])&&e.push(n);this._uniformKeys=e.join()}_incrVersion(){this._version++}getMemorySize(){const e=this.uniforms;let n=0;for(const i in e)this.isTexture(i)?n+=e[i].getMemorySize():this.uniforms[i]&&this.uniforms[i].destroy&&(n+=lw(this.uniforms[i]));return n}};const AC={time:0,seeThrough:!0,thickness:.03,fill:[1,.5137254902,.98,1],stroke:[.7019607843,.9333333333,.2274509804,1],dashEnabled:!1,dashAnimate:!1,dashRepeats:1,dashLength:.8,dashOverlap:!0,insideAltColor:!1,squeeze:!1,squeezeMin:.5,squeezeMax:1,dualStroke:!1,secondThickness:.05,opacity:1,noiseEnable:!1};const fC={baseColorFactor:[1,1,1,1],materialShininess:32,environmentExposure:1,specularStrength:32,opacity:1,extrusionOpacity:0,extrusionOpacityRange:[0,1.8],baseColorTexture:null,normalTexture:null,emissiveTexture:null,occlusionTexture:null,uvScale:[1,1],uvOffset:[0,0],alphaTest:0};let dC=class De extends cC{constructor(e){super(e,fC)}static convertFrom(e){const n={};for(const i in fC)n[i]=e.get(i);return new De(n)}appendDefines(e,n){super.appendDefines(e,n);const i=this.uniforms;return i.extrusionOpacity&&(e.HAS_EXTRUSION_OPACITY=1),n.data[n.desc.colorAttribute]&&(e.HAS_COLOR=1),n.data[n.desc.color0Attribute]&&(e.HAS_COLOR0=1,e.COLOR0_SIZE=n.getColor0Size()),n.data[n.desc.tangentAttribute]?e.HAS_TANGENT=1:n.data[n.desc.normalAttribute]&&(e.HAS_NORMAL=1),n.data[n.desc.uv0Attribute]?(i.baseColorTexture&&(e.HAS_BASECOLOR_MAP=1),i.occlusionTexture&&n.data[n.desc.uv1Attribute]&&(e.HAS_AO_MAP=1),i.emissiveTexture&&(e.HAS_EMISSIVE_MAP=1),i.normalTexture&&(e.HAS_NORMAL_MAP=1),(e.HAS_BASECOLOR_MAP||e.HAS_AO_MAP||e.HAS_EMISSIVE_MAP||e.HAS_NORMAL_MAP)&&(e.HAS_MAP=1),e):e}};const pC={baseColorFactor:[1,1,1,1],uvScale:[1,1],uvOffset:[0,0],opacity:1,envMapExposure:128,emissiveFactor:[.1,.1,.1],specularFactor:[0,0,0],envRotationSin:0,envRotationCos:1,reflectivity:.01,themingColor:[0,0,0,0],exposureBias:.6};let gC=class He extends cC{constructor(e){super(e,pC)}appendDefines(e,n){super.appendDefines(e,n);const i=this.uniforms;return i.extrusionOpacity&&(e.HAS_EXTRUSION_OPACITY=1),n.data[n.desc.colorAttribute]&&(e.HAS_COLOR=1),n.data[n.desc.color0Attribute]&&(e.HAS_COLOR0=1,e.COLOR0_SIZE=n.getColor0Size()),n.data[n.desc.uv0Attribute]?(i.baseColorTexture&&(e.HAS_BASECOLOR_MAP=1),i.occlusionTexture&&n.data[n.desc.uv1Attribute]&&(e.HAS_AO_MAP=1),i.emissiveTexture&&(e.HAS_EMISSIVE_MAP=1),i.normalTexture&&(e.HAS_NORMAL_MAP=1),(e.HAS_BASECOLOR_MAP||e.HAS_AO_MAP||e.HAS_EMISSIVE_MAP||e.HAS_NORMAL_MAP)&&(e.HAS_MAP=1),e.ALPHATEST=.01,e.GAMMA_INPUT=1,e.GAMMA_FACTOR=1,e.TONEMAP_OUTPUT=1,e.ENVMAP_MODE_REFLECTION=1,e.ENV_RGBM=1,e.IRR_RGBM=1,e):e}};const mC={diffuseFactor:[1,1,1,1],specularFactor:[1,1,1],glossinessFactor:1,diffuseTexture:null,specularGlossinessTexture:null,normalTexture:null,emissiveTexture:null,occlusionTexture:null};function yC(e){return class extends e{constructor(...e){let n=e[0];n=$b({},mC,n||{}),super(n,e)}appendDefines(e,n){if(super.appendDefines(e,n),e.SHADING_MODEL_SPECULAR_GLOSSINESS=1,!n.data[n.desc.uv0Attribute])return e;const i=this.uniforms;return i.diffuseTexture&&(e.HAS_DIFFUSE_MAP=1),i.specularGlossinessTexture&&(e.HAS_SPECULARGLOSSINESS_MAP=1),(e.HAS_SPECULARGLOSSINESS_MAP||e.HAS_DIFFUSE_MAP)&&(e.HAS_MAP=1),e}}}let vC=class Le extends(yC(dC)){};const _C=new Array(16);let xC=0,bC=class Be{constructor(e,n,i={}){this._version=0,this._geometry=e,this._material=n,this.transparent=!!i.transparent,this.bloom=!!i.bloom,this.ssr=!!i.ssr,this._castShadow=Yb(i.castShadow)||i.castShadow,this.needUpdateShadow=!1,this.picking=!!i.picking,this.disableVAO=!!i.disableVAO,this.uniforms={},this._localTransform=xv(new Array(16)),this._positionMatrix=xv(new Array(16)),this.properties={},this._dirtyUniforms=!0,this._dirtyGeometry=!0,Object.defineProperty(this,"uuid",{value:xC++}),xC>Number.MAX_VALUE-10&&(xC=0)}set material(e){this._material!==e&&this.setMaterial(e)}get material(){return this._material}set version(e){throw new Error("Mesh.version is read only.")}get version(){return this._version}get geometry(){return this._geometry}set geometry(e){this._geometry!==e&&(this._incrVersion(),this._dirtyGeometry=!0),this._geometry=e}set localTransform(e){this._prevTMat||(this._prevTMat=new Array(16)),Array.isArray(e)&&!qv(this._prevTMat,e)&&(this._incrVersion(),this._prevTMat=_v(this._prevTMat,e)),this._localTransform=e}get localTransform(){return Kb(this._localTransform)?this._localTransform():this._localTransform}set positionMatrix(e){this._prevPMat||(this._prevPMat=new Array(16)),Array.isArray(e)&&!qv(this._prevPMat,e)&&(this._incrVersion(),this._prevPMat=_v(this._prevPMat,e)),this._positionMatrix=e}get positionMatrix(){return Kb(this._positionMatrix)?this._positionMatrix():this._positionMatrix}get config(){return this._options||(this._options={}),this._options.transparent=this.transparent,this._options.castShadow=this.castShadow,this._options.bloom=this.bloom,this._options.ssr=this.ssr,this._options.picking=this.picking,this._options}get defines(){return this._getDefines()}set defines(e){this.setDefines(e)}get castShadow(){return this._castShadow&&(!this.material||!this.material.unlit)}set castShadow(e){this._castShadow=e}setMaterial(e){return this._material=e,this._dirtyUniforms=!0,delete this._materialVer,this.dirtyDefines=!0,this}setParent(e){return this.parent=e,this}setLocalTransform(e){return this.localTransform=e,this}setPositionMatrix(e){this.positionMatrix=e}setUniform(e,n){return this._updateUniformState(e),this.uniforms[e]=n,this}setFunctionUniform(e,n){return this._updateUniformState(e),Object.defineProperty(this.uniforms,e,{enumerable:!0,get:n}),this}hasFunctionUniform(e){return!!this.uniforms&&Object.prototype.hasOwnProperty.call(this.uniforms,e)}_updateUniformState(e){void 0===this.uniforms[e]?this._dirtyUniforms=!0:(this._dirtyProps=this._dirtyProps||[],this._dirtyProps.push(e))}getUniform(e){return this.uniforms[e]}getDefines(){const e={};return $b(e,this._getDefines()),this._material&&this._geometry&&this._material.appendDefines(e,this._geometry),e}_getDefines(){this._defines||(this._defines={});const e=this._geometry,n=e.data[e.desc.positionAttribute],i=e.data[e.desc.uv0Attribute],o=e.data[e.desc.normalAttribute];return n&&n.quantization&&(this._defines.HAS_DRACO_POSITION=1),i&&i.quantization&&(this._defines.HAS_DRACO_TEXCOORD=1),o&&o.quantization&&(this._defines.HAS_DRACO_NORMAL=1),this._defines}setDefines(e){const n=this._bakDefines;return this._defines=e,this.dirtyDefines=this.dirtyDefines||!!n!=!!e||!function(e,n){if(!e&&!n)return!0;const i=Object.getOwnPropertyNames(e),o=Object.getOwnPropertyNames(n);if(i.length!==o.length)return!1;for(let o=0;o<i.length;o++)if(e[i[o]]!==n[i[o]])return!1;return!0}(n,e),this.dirtyDefines&&(this._bakDefines=$b({},e)),this}hasSkinAnimation(){return this._material&&this._material.hasSkinAnimation()}_getDefinesKey(){return this.dirtyDefines=!1,this._createDefinesKey(this.getDefines())}getCommandKey(e){if(!this._commandKey||this.dirtyDefines||this._material&&this._materialKeys!==this._material.getUniformKeys()){let e=this._getDefinesKey();e+="_"+(ew(this.getElements())?"count":"elements"),e+="_"+ +!!this.disableVAO,this._material&&(e+="_"+ +!!this._material.doubleSided),this._commandKey=e,this._material&&(this._materialKeys=this._material.getUniformKeys())}return this._commandKey}getUniforms(e){if(this._dirtyUniforms||this._dirtyGeometry||this._material&&this._materialVer!==this._material.version){this._uniformDescriptors=new Set,this._realUniforms={},this._prepareUniformsForDraco();const n=this.uniforms;for(const e in this.uniforms)aw(this.uniforms,e)&&(Object.getOwnPropertyDescriptor(n,e).get?(this._uniformDescriptors.add(e),Object.defineProperty(this._realUniforms,e,{enumerable:!0,configurable:!0,get:function(){return n[e]}})):this._realUniforms[e]=n[e]);if(this._material){const n=this._material.getUniforms(e);for(const e in n)aw(n,e)&&!aw(this._realUniforms,e)&&(Object.getOwnPropertyDescriptor(n,e).get?(this._uniformDescriptors.add(e),Object.defineProperty(this._realUniforms,e,{enumerable:!0,configurable:!0,get:function(){return n[e]}})):void 0===this._realUniforms[e]&&(this._realUniforms[e]=n[e]))}this._dirtyUniforms=!1,this._dirtyGeometry=!1,this._materialVer=this._material&&this._material.version,this._materialPropVer=this._material&&this._material.propVersion,this._dirtyProps=null}else if(this._dirtyProps||this._material&&this._material.propVersion!==this._materialPropVer){if(this._dirtyProps)for(const e of this._dirtyProps)this._realUniforms[e]=this.uniforms[e];if(this._material&&this._material.propVersion!==this._materialPropVer){const n=this._material.getUniforms(e);for(const e in n)aw(n,e)&&!this._uniformDescriptors.has(e)&&(Object.getOwnPropertyDescriptor(n,e).get||this._realUniforms[e]===n[e]||(this._realUniforms[e]=n[e]));this._materialPropVer=this._material.propVersion}this._dirtyProps=null}return this._realUniforms.modelMatrix=this.localTransform,this._realUniforms.positionMatrix=this.positionMatrix,this._realUniforms}_prepareUniformsForDraco(){const e=this._geometry,n=e.data[e.desc.positionAttribute],i=e.data[e.desc.uv0Attribute],o=e.data[e.desc.normalAttribute];if(n&&n.quantization){const e=n.quantization,i=e.range/(1<<e.quantizationBits);this._realUniforms.minValues_pos=e.minValues,this._realUniforms.gltf_u_dec_position_normConstant=i}if(i&&i.quantization){const e=i.quantization;this._realUniforms.minValues_tex=e.minValues,this._realUniforms.gltf_u_dec_texcoord_0_normConstant=e.range/(1<<e.quantizationBits)}o&&o.quantization&&(this._realUniforms.gltf_u_dec_normal_rangeConstant=(1<<o.quantization.quantizationBits)-1)}getMaterial(){return this._material}getElements(){return this._geometry.getElements()}_getREGLAttrData(e,n){return this._geometry.getREGLData(e,n,this.disableVAO)}getREGLProps(e,n){const i=this.getUniforms(e);return $b(i,this._getREGLAttrData(e,n)),sw(e)&&!this.disableVAO||(i.elements=this._geometry.getElements()),i.meshProperties=this.properties,i.geometryProperties=this._geometry.properties,i.meshConfig=this.config,i.count=this._geometry.getDrawCount(),i.offset=this._geometry.getDrawOffset(),i.primitive=this._geometry.getPrimitive(),i}dispose(){return delete this._geometry,delete this._material,this.uniforms=null,this}isValid(){return this._geometry&&!this._geometry.isDisposed()&&(!this._material||!this._material.isDisposed())}getBoundingBox(){return this._geometry?(this._bbox||this.updateBoundingBox(),Cv(_C,this.localTransform,this.positionMatrix),qv(_C,this._currentTransform)&&this._geometry.boundingBox.equals(this._geoBox)||this.updateBoundingBox(),this._bboxArr):null}updateBoundingBox(){const e=this._geometry.boundingBox;this._bbox||(this._bbox=new Sw),this._bboxArr||(this._bboxArr=[[0,0,0],[0,0,0]]),this._geoBox||(this._geoBox=new Sw),Sw.copy(this._bbox,e),this._bbox.updateVertex(),"InstancedMesh"===this.constructor.name?(this._bbox.transform(this.localTransform,this.positionMatrix),this._currentTransform=Cv(this._currentTransform||new Array(16),this.positionMatrix,this.localTransform)):(this._bbox.transform(this.positionMatrix,this.localTransform),this._currentTransform=Cv(this._currentTransform||new Array(16),this.localTransform,this.positionMatrix)),Sw.copy(this._geoBox,e),Kv(this._bboxArr[0],this._bbox.min),Kv(this._bboxArr[1],this._bbox.max)}_createDefinesKey(e){const n=[];for(const i in e)n.push(i,e[i]);return n.join(",")}_incrVersion(){this._version++}getMemorySize(){return(this.geometry&&this.geometry.getMemorySize()||0)+(this.material&&this.material.getMemorySize()||0)}getWorldTransform(){const e=this.parent;return e?Cv(new Array(16),e.getWorldTransform(),this.localTransform):this.localTransform}},wC=class Ue extends bC{constructor(e,n,i,o,s={}){super(i,o,s),this._instanceCount=n,this.instancedData=e||{},this._checkInstancedProp(),this._vao={}}get instanceCount(){return this._instanceCount}set instanceCount(e){this._incrVersion(),this._instanceCount=e}getMemorySize(){return super.getMemorySize()+this._getInstanceMemorySize()}_getInstanceMemorySize(){let e=0;for(const n in this.instancedData)aw(this.instancedData,n)&&(e+=hw(this.instancedData[n]));return e}_checkInstancedProp(){for(const e in this.instancedData)if(this.geometry.data[e])throw new Error(`Duplicate attribute ${e} defined in geometry and instanced data`)}_getREGLAttrData(e,n){const i=this.geometry.getAttrData(n);if(sw(e)){const o=n.key;if(!this._vao[o]||this._vao[o].dirty){const s=n.map((e=>e.name)),a=[];for(let e=0;e<s.length;e++){const n=i[s[e]];a.push(n&&n.buffer||this.instancedData[s[e]])}const h={attributes:a,primitive:this.geometry.getPrimitive()};this._vao[o]?this._vao[o].vao(h):this._vao[o]={vao:e.vao(h)},delete this._vao[o].dirty}return this._vao[o]}return i}getDefines(){const e=super.getDefines();return e.HAS_INSTANCE=1,e}getCommandKey(e){return"i_"+super.getCommandKey(e)}updateInstancedData(e,n){const i=this.instancedData[e];if(!i)return this;if(this._incrVersion(),this.instancedData[e]=n,i.buffer&&i.buffer.destroy&&i.buffer.destroy(),this._vao)for(const e in this._vao)this._vao[e].dirty=!0;return this}generateInstancedBuffers(e){const n=this.instancedData,i={};for(const o in n){if(!n[o])continue;const s=n[o];void 0!==s.buffer&&s.buffer.destroy?(i[o]=s,i[o].divisor&&(i[o].divisor=1)):i[o]=n[o].destroy?{buffer:n[o],divisor:1}:{buffer:e.buffer({data:n[o],dimension:n[o].length/this._instanceCount}),divisor:1}}return this.instancedData=i,this}getREGLProps(e,n){const i=super.getREGLProps(e,n);return sw(e)||$b(i,this.instancedData),i.elements=this.geometry.getElements(),i.instances=this._instanceCount,i}disposeInstancedData(){const e=this.instancedData;if(e)for(const n in e){if(!e[n])continue;const i=e[n].destroy?e[n]:e[n].buffer;i.destroy&&!i[xw]&&(i[xw]=1,i.destroy())}this.instancedData={};for(const e in this._vao)this._vao[e].vao.destroy();this._vao={}}};const CC={};let PC=class Ve{constructor(e){this.regl=e}render(e,n,i,o){e.setUniforms(n||CC),e.setFramebuffer(o);let s=0;if(i){const{opaques:n,transparents:o}=i.getSortedMeshes();s+=e.draw(this.regl,n),s+=e.draw(this.regl,o)}else s+=e.draw(this.regl);return s}clear(e){this.regl.clear(e)}};const MC={getArrayBuffer:(e,n)=>MC.get(e,{responseType:"arraybuffer"},n),get:function(e,n,i){const o=MC._getClient(i);if(o.open("GET",e,!0),n){for(const e in n.headers)o.setRequestHeader(e,n.headers[e]);o.withCredentials="include"===n.credentials,n.responseType&&(o.responseType=n.responseType)}return o.send(null),o},_wrapCallback:function(e,n){return function(){4===e.readyState&&(200===e.status?"arraybuffer"===e.responseType?0===e.response.byteLength?n(new Error("http status 200 returned without content.")):n(null,{data:e.response,cacheControl:e.getResponseHeader("Cache-Control"),expires:e.getResponseHeader("Expires"),contentType:e.getResponseHeader("Content-Type")}):n(null,e.responseText):n(new Error(e.statusText+","+e.status)))}},_getClient:function(e){let n;try{n=new XMLHttpRequest}catch(e){try{n=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{n=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}}return n.onreadystatechange=MC._wrapCallback(n,e),n}};let TC=class Xe{constructor(e,n){this.defaultTexture=e,this.defaultCubeTexture=new Array(6),this.urlModifier=n,this.resources={}}setURLModifier(e){this.urlModifier=e}get(e){return Array.isArray(e)?this._loadImages(e):this._loadImage(e)}getArrayBuffer(e){if(Array.isArray(e)){const n=e.map((e=>this.getArrayBuffer(e)));return Promise.all(n)}return new Promise(((n,i)=>{let o=e;this.urlModifier&&(o=this.urlModifier(e)),MC.getArrayBuffer(o,((o,s)=>{o?i(o):n({url:e,data:s})}))}))}disposeRes(e){return Array.isArray(e)?e.forEach((e=>this._disposeOne(e))):this._disposeOne(e),this}isLoading(){return this._count&&this._count>0}getDefaultTexture(e){return Array.isArray(e)?this._getBlankTextures(e.length):this.defaultTexture}_disposeOne(e){const n=this.resources;n[e]&&(n[e].count--,n[e].count<=0&&delete n[e])}_loadImage(e){const n=this.resources;return n[e]?Promise.resolve({url:e,data:n[e].image}):new Promise(((i,o)=>{const s=new Image;s.crossOrigin="anonymous",s.onload=function(){n[e]={image:s,count:1},i({url:e,data:s})},s.onerror=function(e){o(e)},s.onabort=function(){o(`image(${e}) loading aborted.`)},s.src=this.urlModifier?this.urlModifier(e):e}))}_loadImages(e){const n=e.map((e=>this._loadImage(e)));return Promise.all(n)}_getBlankTextures(e){const n=new Array(e);for(let e=0;e<6;e++)n.push(this.defaultTexture);return n}},SC=class We extends(_w(TC)){};const IC=[0,0,0],EC=[0,0,0];let OC,RC=0;function DC(e,n){return A_(IC,e.geometry.boundingBox.getCenter(),e.localTransform),A_(EC,n.geometry.boundingBox.getCenter(),n.localTransform),__(EC,OC)-__(IC,OC)}let kC=class Qe{constructor(e){this._id=RC++,this.sortedMeshes={},this.setMeshes(e),this.dirty()}setMeshes(e){if(this.clear(),!e||Array.isArray(e)&&!e.length||e===this.meshes)return this;e=Array.isArray(e)?e:[e],this.meshes=[];for(let n=0;n<e.length;n++){const i=e[n];i&&(i._scenes=i._scenes||{},i._scenes[this._id]=1,this.meshes.push(i))}return this.dirty(),this}addMesh(e){if(!e||Array.isArray(e)&&!e.length)return this;if(Array.isArray(e))e.forEach((e=>{const n=e._scenes=e._scenes||{};n[this._id]||(n[this._id]=1,this.meshes.push(e),this.dirty())}));else{const n=e._scenes=e._scenes||{};n[this._id]||(n[this._id]=1,this.meshes.push(e),this.dirty())}return this}removeMesh(e){if(!e||Array.isArray(e)&&!e.length)return this;if(Array.isArray(e)){let n=!1;for(let i=0;i<e.length;i++){const o=e[i]._scenes;o&&o[this._id]&&(n=!0,this.dirty(),delete o[this._id])}n&&(this.meshes=this.meshes.filter((n=>e.indexOf(n)<0)))}else{const n=e._scenes;if(!n||!n[this._id])return this;const i=this.meshes.indexOf(e);i>=0&&this.meshes.splice(i,1),delete n[this._id],this.dirty()}return this}getMeshes(){return this.meshes||[]}clear(){if(this.meshes)for(let e=0;e<this.meshes.length;e++)delete this.meshes[e]._scenes[this._id];return this.meshes=[],this.sortedMeshes.opaques=[],this.sortedMeshes.transparents=[],this}dirty(){return this._dirty=!0,this}sortMeshes(e){const n=this.meshes;this.sortFunction&&n.sort(this.sortFunction);let i=this.sortedMeshes.transparents;if(this._dirty){const e=this.sortedMeshes.opaques=[];i=this.sortedMeshes.transparents=[];for(let o=0,s=n.length;o<s;o++)n[o].transparent?i.push(n[o]):e.push(n[o])}e&&i.length>1&&(OC=e,i.sort(DC)),this._dirty=!1}getSortedMeshes(){return this._dirty&&this.sortMeshes(),this.sortedMeshes||{}}};const LC=String.fromCharCode,FC=8,NC=32767;function zC(e,n,i,o){if(e[3]>0){const s=Math.pow(2,e[3]-128-8+o);n[i+0]=e[0]*s,n[i+1]=e[1]*s,n[i+2]=e[2]*s}else n[i+0]=0,n[i+1]=0,n[i+2]=0;return n[i+3]=1,n}function BC(e,n,i,o){let s=0,a=0,h=o;for(;h>0;)if(e[a][0]=n[i++],e[a][1]=n[i++],e[a][2]=n[i++],e[a][3]=n[i++],1===e[a][0]&&1===e[a][1]&&1===e[a][2]){for(let n=e[a][3]<<s>>>0;n>0;n--)(c=e[a])[0]=(l=e[a-1])[0],c[1]=l[1],c[2]=l[2],c[3]=l[3],a++,h--;s+=8}else a++,h--,s=0;var l,c;return i}function HC(e,n,i,o){if(o<FC|o>NC)return BC(e,n,i,o);let s=n[i++];if(2!==s)return BC(e,n,i-1,o);if(e[0][1]=n[i++],e[0][2]=n[i++],s=n[i++],(e[0][2]<<8>>>0|s)>>>0!==o)return null;for(let s=0;s<4;s++)for(let a=0;a<o;){let o=n[i++];if(o>128){o=(127&o)>>>0;const h=n[i++];for(;o--;)e[a++][s]=h}else for(;o--;)e[a++][s]=n[i++]}return i}function jC(e,n=0){const i=new Uint8Array(e),o=i.length;if("#?"!==function(e,n,i){let o="";for(let n=0;n<2;n++)o+=LC(e[n]);return o}(i))return null;for(var s=2;s<o&&("\n"!==LC(i[s])||"\n"!==LC(i[s+1]));s++);if(s>=o)return null;s+=2;let a="";for(;s<o;s++){const e=LC(i[s]);if("\n"===e)break;a+=e}const h=a.split(" "),l=parseInt(h[1]),c=parseInt(h[3]);if(!c||!l)return null;let A=s+1;const f=[];for(let e=0;e<c;e++){f[e]=[];for(let n=0;n<4;n++)f[e][n]=0}const d=new Float32Array(c*l*4);let p=0;for(let e=0;e<l;e++){if(A=HC(f,i,A,c),!A)return null;for(let e=0;e<c;e++)zC(f[e],d,p,n),p+=4}return{width:c,height:l,pixels:d}}const UC=function(){const e=new ArrayBuffer(4),n=new Float32Array(e),i=new Uint32Array(e),o=new Uint32Array(512),s=new Uint32Array(512);for(let e=0;e<256;++e){const n=e-127;n<-27?(o[e]=0,o[256|e]=32768,s[e]=24,s[256|e]=24):n<-14?(o[e]=1024>>-n-14,o[256|e]=1024>>-n-14|32768,s[e]=-n-1,s[256|e]=-n-1):n<=15?(o[e]=n+15<<10,o[256|e]=n+15<<10|32768,s[e]=13,s[256|e]=13):n<128?(o[e]=31744,o[256|e]=64512,s[e]=24,s[256|e]=24):(o[e]=31744,o[256|e]=64512,s[e]=13,s[256|e]=13)}const a=new Uint32Array(2048),h=new Uint32Array(64),l=new Uint32Array(64);for(let e=1;e<1024;++e){let n=e<<13,i=0;for(;!(8388608&n);)n<<=1,i-=8388608;n&=-8388609,i+=947912704,a[e]=n|i}for(let e=1024;e<2048;++e)a[e]=939524096+(e-1024<<13);for(let e=1;e<31;++e)h[e]=e<<23;h[31]=1199570944,h[32]=2147483648;for(let e=33;e<63;++e)h[e]=2147483648+(e-32<<23);h[63]=3347054592;for(let e=1;e<64;++e)32!==e&&(l[e]=1024);return{floatView:n,uint32View:i,baseTable:o,shiftTable:s,mantissaTable:a,exponentTable:h,offsetTable:l}}();const GC=function(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=ow(e,-65504,65504),UC.floatView[0]=e;const n=UC.uint32View[0],i=n>>23&511;return UC.baseTable[i]+((8388607&n)>>UC.shiftTable[i])};let VC=class fn extends Pw{onLoad({data:e}){const n=this.config;if(n){if(n.hdr){if(!(e=jC(e.data,0)))throw new Error("Invalid hdr data"+(n.url?":"+n.url:""));{const i=new Uint16Array(e.pixels.length);for(let n=0;n<e.pixels.length;n++)i[n]=Math.min(GC(e.pixels[n]),65504);n.data=i,n.type="float16",n.colorSpace="browser",n.min="linear",n.mag="linear"}}else n.data=e;n.width=n.width||e.width,n.height=n.height||e.height,this._regl&&this._checkNPOT(this._regl),this._updateREGL()}}createREGLTexture(e){return this._regl=e,this._checkNPOT(e),e.texture(this.config)}_checkNPOT(e){const n=this.config;if(n.data&&this._needPowerOf2(e)&&(n.data instanceof Image?(n.data=mw(n.data),n.width=n.data.width,n.height=n.data.height):n.hdr||!iw(n.data)||pw(n.width)&&pw(n.height)||(n.data=mw(n.data,n.width,n.height),n.width=n.data.width,n.height=n.data.height)),iw(this.config.data)||iw(this.config.mipmap)){const n=Kw(e,this.config);return n[ww]||(n[ww]=0),n[ww]++,n}}},WC=class dn extends Lw{constructor(e){super({aPosition:new(rw(e=e||0))([-1,-1,e,1,-1,e,-1,1,e,1,1,e]),aNormal:new Int8Array([0,0,1,0,0,1,0,0,1,0,0,1])},new Uint16Array([0,1,3,3,2,0]))}};const qC={vsm_shadow_vert:"\nuniform mat4 shadow_lightProjViewModelMatrix;\nvarying vec4 shadow_vLightSpacePos;\nvoid shadow_computeShadowPars(vec4 position) {\n    shadow_vLightSpacePos = shadow_lightProjViewModelMatrix * position;\n}",vsm_shadow_frag:"\nuniform sampler2D shadow_shadowMap;\nuniform float shadow_opacity;\nuniform vec3 shadow_color;\n#if defined(USE_ESM)\n    uniform float esm_shadow_threshold;\n#endif\nvarying vec4 shadow_vLightSpacePos;\n#ifdef PACK_FLOAT\n    #include <common_pack_float>\n#endif\n#if defined(USE_ESM)\nfloat esm(vec3 projCoords, vec4 shadowTexel) {\n    float compare = projCoords.z;\n    float c = 120.0;\n    #ifdef PACK_FLOAT\n        float depth = common_decodeDepth(shadowTexel);\n        if (depth >= 1.0 - 1E-6 || compare <= depth) {\n            return 1.0;\n        }\n    #else\n        float depth = shadowTexel.r;\n    #endif\n    depth = exp(-c * min(compare - depth, 0.05));\n    return clamp(depth, esm_shadow_threshold, 1.0);\n}\n#endif\n#if defined(USE_VSM)\nfloat vsm_shadow_chebyshevUpperBound(vec3 projCoords, vec4 shadowTexel){\n    vec2 moments = shadowTexel.rg;\n    float distance = projCoords.z;\n    if (distance >= 1.0 || distance <= moments.x)\n        return 1.0 ;\n    float variance = moments.y - (moments.x * moments.x);\n    variance = max(variance, 0.00002);\n    float d = distance - moments.x;\n    float p_max = variance / (variance + d * d);\n    return p_max;\n}\n#endif\nfloat shadow_computeShadow_coeff(sampler2D shadowMap, vec3 projCoords) {\n    vec2 uv = projCoords.xy;\n    vec4 shadowTexel = texture2D(shadowMap, uv);\n    #if defined(USE_ESM)\n        float esm_coeff = esm(projCoords, shadowTexel);\n        float coeff = esm_coeff * esm_coeff;\n    #endif\n    #if defined(USE_VSM)\n        float vsm_coeff = vsm_shadow_chebyshevUpperBound(projCoords, shadowTexel);\n        float coeff = vsm_coeff;\n    #endif\n    return 1.0 - (1.0 - coeff) * shadow_opacity;\n}\nfloat shadow_computeShadow() {\n    vec3 projCoords = shadow_vLightSpacePos.xyz / shadow_vLightSpacePos.w;\n    projCoords = projCoords * 0.5 + 0.5;\n    if(projCoords.z >= 1.0 || projCoords.x < 0.0 || projCoords.x > 1.0 || projCoords.y < 0.0 || projCoords.y > 1.0) return 1.0;\n    return shadow_computeShadow_coeff(shadow_shadowMap, projCoords);\n}\nvec3 shadow_blend(vec3 color, float coeff) {\n    color = color * coeff + shadow_color * shadow_opacity * (1.0 - coeff);\n    return color;\n}",fbo_picking_vert:"\n#ifdef ENABLE_PICKING\n#if HAS_PICKING_ID == 1\nattribute float aPickingId;\n#elif HAS_PICKING_ID == 2\nuniform float uPickingId;\n#endif\nvarying float vPickingId;\nvarying float vFbo_picking_viewZ;\nvarying float vFbo_picking_visible;\n#endif\nvarying float vFbo_picking_fragDepth;\nvoid fbo_picking_setData(float viewPosZ, bool visible) {\n    #ifdef ENABLE_PICKING\n    #if HAS_PICKING_ID == 1\n       vPickingId = aPickingId;\n    #elif HAS_PICKING_ID == 2\n        vPickingId = uPickingId;\n    #endif\n        vFbo_picking_viewZ = viewPosZ;\n    #endif\n    vFbo_picking_visible = visible ? 1.0 : 0.0;\n    vFbo_picking_fragDepth = viewPosZ + 1.0;\n}",common_pack_float:"const float COMMON_FLOAT_MAX =  1.70141184e38;\nconst float COMMON_FLOAT_MIN = 1.17549435e-38;\nfloat common_packFloat(vec4 val){\n    vec4 scl = floor(255.0 * val + 0.5);\n    float sgn = (scl.a < 128.0) ? 1.0 : -1.0;\n    float exn = mod(scl.a * 2.0, 256.0) + floor(scl.b / 128.0) - 127.0;\n    float man = 1.0 +\n        (scl.r / 8388608.0) +\n        (scl.g / 32768.0) +\n        mod(scl.b, 128.0) / 128.0;\n    return sgn * man * pow(2.0, exn);\n}\nvec4 common_unpackFloat(highp float v) {\n    highp float av = abs(v);\n    if(av < COMMON_FLOAT_MIN) {\n        return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > COMMON_FLOAT_MAX) {\n        return vec4(127.0, 128.0, 0.0, 0.0) / 255.0;\n    } else if(v < -COMMON_FLOAT_MAX) {\n        return vec4(255.0, 128.0, 0.0, 0.0) / 255.0;\n    }\n    highp vec4 c = vec4(0,0,0,0);\n    highp float e = floor(log2(av));\n    highp float m = av * pow(2.0, -e) - 1.0;\n    c[1] = floor(128.0 * m);\n    m -= c[1] / 128.0;\n    c[2] = floor(32768.0 * m);\n    m -= c[2] / 32768.0;\n    c[3] = floor(8388608.0 * m);\n    highp float ebias = e + 127.0;\n    c[0] = floor(ebias / 2.0);\n    ebias -= c[0] * 2.0;\n    c[1] += floor(ebias) * 128.0;\n    c[0] += 128.0 * step(0.0, -v);\n    return c / 255.0;\n}\nvec4 common_encodeDepth(const in float depth) {\n    float alpha = 1.0;\n    vec4 pack = vec4(0.0);\n    pack.a = alpha;\n    const vec3 code = vec3(1.0, 255.0, 65025.0);\n    pack.rgb = vec3(code * depth);\n    pack.gb = fract(pack.gb);\n    pack.rg -= pack.gb * (1.0 / 256.0);\n    pack.b -= mod(pack.b, 4.0 / 255.0);\n    return pack;\n}\nfloat common_decodeDepth(const in vec4 pack) {\n    return pack.r + pack.g / 255.0;\n}",invert_matrix:"mat4 invert_matrix(mat4 matrix) {\n    #if __VERSION__ == 300\n        return inverse(matrix);\n    #else\n        vec4 vector1 = matrix[0], vector2 = matrix[1], vector3 = matrix[2], vector4 = matrix[3];\n        float a00 = vector1.x, a01 = vector1.y, a02 = vector1.z, a03 = vector1.w;\n        float a10 = vector2.x, a11 = vector2.y, a12 = vector2.z, a13 = vector2.w;\n        float a20 = vector3.x, a21 = vector3.y, a22 = vector3.z, a23 = vector3.w;\n        float a30 = vector4.x, a31 = vector4.y, a32 = vector4.z, a33 = vector4.w;\n        float b00 = a00 * a11 - a01 * a10;\n        float b01 = a00 * a12 - a02 * a10;\n        float b02 = a00 * a13 - a03 * a10;\n        float b03 = a01 * a12 - a02 * a11;\n        float b04 = a01 * a13 - a03 * a11;\n        float b05 = a02 * a13 - a03 * a12;\n        float b06 = a20 * a31 - a21 * a30;\n        float b07 = a20 * a32 - a22 * a30;\n        float b08 = a20 * a33 - a23 * a30;\n        float b09 = a21 * a32 - a22 * a31;\n        float b10 = a21 * a33 - a23 * a31;\n        float b11 = a22 * a33 - a23 * a32;\n        float det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n        det = 1.0 / det;\n        mat4 m = mat4(\n            (a11 * b11 - a12 * b10 + a13 * b09) * det,\n            (a02 * b10 - a01 * b11 - a03 * b09) * det,\n            (a31 * b05 - a32 * b04 + a33 * b03) * det,\n            (a22 * b04 - a21 * b05 - a23 * b03) * det,\n            (a12 * b08 - a10 * b11 - a13 * b07) * det,\n            (a00 * b11 - a02 * b08 + a03 * b07) * det,\n            (a32 * b02 - a30 * b05 - a33 * b01) * det,\n            (a20 * b05 - a22 * b02 + a23 * b01) * det,\n            (a10 * b10 - a11 * b08 + a13 * b06) * det,\n            (a01 * b08 - a00 * b10 - a03 * b06) * det,\n            (a30 * b04 - a31 * b02 + a33 * b00) * det,\n            (a21 * b02 - a20 * b04 - a23 * b00) * det,\n            (a11 * b07 - a10 * b09 - a12 * b06) * det,\n            (a00 * b09 - a01 * b07 + a02 * b06) * det,\n            (a31 * b01 - a30 * b03 - a32 * b00) * det,\n            (a20 * b03 - a21 * b01 + a22 * b00) * det\n        );\n        return m;\n    #endif\n}\nmat4 transpose_matrix(mat4 matrix) {\n    #if __VERSION__ == 300\n        return transpose(matrix);\n    #else\n        vec4 vector1 = matrix[0], vector2 = matrix[1], vector3 = matrix[2], vector4 = matrix[3];\n        float a01 = vector1.y, a02 = vector1.z, a03 = vector1.w;\n        float a12 = vector2.z, a13 = vector2.w;\n        float a23 = vector3.w;\n        mat4 m = mat4(\n            vector1.x,\n            vector2.x,\n            vector3.x,\n            vector4.x,\n            a01,\n            vector2.y,\n            vector3.y,\n            vector4.y,\n            a02,\n            a12,\n            vector3.z,\n            vector4.z,\n            a03,\n            a13,\n            a23,\n            vector4.w\n        );\n        return m;\n    #endif\n}",get_output:"#include <invert_matrix>\n#include <draco_decode_vert>\n#ifdef HAS_INSTANCE\n    #include <instance_vert>\n    #ifdef HAS_INSTANCE_COLOR\n        varying vec4 vInstanceColor;\n    #endif\n#endif\n#ifdef HAS_SKIN\n    uniform int skinAnimation;\n    #include <skin_vert>\n#endif\n#include <mask_vert>\n#ifdef HAS_MORPH\n    attribute vec3 POSITION0;\n    attribute vec3 POSITION1;\n    attribute vec3 POSITION2;\n    attribute vec3 POSITION3;\n    attribute vec3 POSITION4;\n    attribute vec3 POSITION5;\n    attribute vec3 POSITION6;\n    attribute vec3 POSITION7;\n    #ifdef HAS_MORPHNORMALS\n        attribute vec3 NORMAL0;\n        attribute vec3 NORMAL1;\n        attribute vec3 NORMAL2;\n        attribute vec3 NORMAL3;\n    #endif\n    uniform vec4 morphWeights1;\n    uniform vec4 morphWeights2;\n#endif\n#ifdef HAS_TERRAIN_ALTITUDE\nattribute float aTerrainAltitude;\n#endif\nmat4 getPositionMatrix() {\n    mat4 worldMatrix;\n    #ifdef HAS_INSTANCE\n        #ifdef HAS_INSTANCE_COLOR\n            vInstanceColor = instance_getInstanceColor();\n        #endif\n        mat4 attributeMatrix = instance_getAttributeMatrix();\n        #ifdef HAS_SKIN\n            if (skinAnimation == 1) {\n                worldMatrix = attributeMatrix * positionMatrix * skin_getSkinMatrix();\n            } else {\n                worldMatrix = attributeMatrix * positionMatrix;\n            }\n        #else\n            worldMatrix = attributeMatrix * positionMatrix;\n        #endif\n    #else\n        #ifdef HAS_SKIN\n            if (skinAnimation == 1) {\n                worldMatrix = skin_getSkinMatrix() * positionMatrix;\n            } else {\n                worldMatrix = positionMatrix;\n            }\n        #else\n            worldMatrix = positionMatrix;\n        #endif\n    #endif\n    return worldMatrix;\n}\n#ifdef HAS_MIN_ALTITUDE\nuniform float minAltitude;\n#endif\nvec4 getPosition(vec3 aPosition) {\n    vec3 position = decode_getPosition(aPosition);\n    #ifdef HAS_MORPH\n        vec4 POSITION = vec4(position + morphWeights1[0] * POSITION0 + morphWeights1[1] * POSITION1 + morphWeights1[2] * POSITION2 + morphWeights1[3] * POSITION3\n        + morphWeights2[0] * POSITION4 + morphWeights2[1] * POSITION5 + morphWeights2[2] * POSITION6 + morphWeights2[3] * POSITION7\n        , 1.0);\n    #else\n        vec4 POSITION = vec4(position, 1.0);\n    #endif\n    #ifdef HAS_TERRAIN_ALTITUDE\n        POSITION.z += aTerrainAltitude * 100.0;\n    #endif\n    #ifdef HAS_MIN_ALTITUDE\n        POSITION.z += minAltitude * 100.0;\n    #endif\n    return POSITION;\n}\nvec3 appendMorphNormal(vec3 NORMAL) {\n    #ifdef HAS_MORPHNORMALS\n        vec3 normal = NORMAL + morphWeights1[0] * NORMAL0 + morphWeights1[1] * NORMAL1 + morphWeights1[2] * NORMAL2 + morphWeights1[3] * NORMAL3;\n    #else\n        vec3 normal = NORMAL;\n    #endif\n    return normal;\n}",instance_vert:"attribute vec4 instance_vectorA;\nattribute vec4 instance_vectorB;\nattribute vec4 instance_vectorC;\n#ifdef HAS_INSTANCE_TERRAIN_ALTITUDE\nattribute float aTerrainAltitude;\nuniform float terrainAltitudeScale;\n#endif\nmat4 instance_getAttributeMatrix() {\n    mat4 mat =  mat4(\n        instance_vectorA.x, instance_vectorB.x, instance_vectorC.x, 0.0,\n        instance_vectorA.y, instance_vectorB.y, instance_vectorC.y, 0.0,\n        instance_vectorA.z, instance_vectorB.z, instance_vectorC.z, 0.0,\n        instance_vectorA.w, instance_vectorB.w, instance_vectorC.w, 1.0\n    );\n    #ifdef HAS_INSTANCE_TERRAIN_ALTITUDE\n        mat4 terrainMat = mat4(\n            1., 0., 0., 0.,\n            0., 1., 0., 0.,\n            0., 0., 1., 0.,\n            0., 0., aTerrainAltitude * terrainAltitudeScale, 1.\n        );\n        mat = terrainMat * mat;\n    #endif\n    return mat;\n}\n#ifdef HAS_INSTANCE_HIGHLIGHT\n    attribute vec4 highlight_color;\n#endif\n#ifdef HAS_INSTANCE_COLOR\n   \n    attribute vec4 instance_color;\n    vec4 instance_getInstanceColor() {\n        vec4 color = instance_color;\n        #ifdef HAS_INSTANCE_HIGHLIGHT\n            color = instance_color * highlight_color;\n        #endif\n        return color;\n    }\n#endif",skin_vert:"attribute vec4 WEIGHTS_0;\nattribute vec4 JOINTS_0;\nuniform sampler2D jointTexture;\nuniform vec2 jointTextureSize;\nuniform float numJoints;\n#define ROW0_U ((0.5 + 0.0) / 4.)\n#define ROW1_U ((0.5 + 1.0) / 4.)\n#define ROW2_U ((0.5 + 2.0) / 4.)\n#define ROW3_U ((0.5 + 3.0) / 4.)\nmat4 skin_getBoneMatrix(float jointNdx) {\n    float v = (jointNdx + 0.5) / numJoints;\n    return mat4(\n        texture2D(jointTexture, vec2(ROW0_U, v)),\n        texture2D(jointTexture, vec2(ROW1_U, v)),\n        texture2D(jointTexture, vec2(ROW2_U, v)),\n        texture2D(jointTexture, vec2(ROW3_U, v)));\n}\nmat4 skin_getSkinMatrix() {\n        mat4 skinMatrix = skin_getBoneMatrix(JOINTS_0[0]) * WEIGHTS_0[0] +\n                        skin_getBoneMatrix(JOINTS_0[1]) * WEIGHTS_0[1] +\n                        skin_getBoneMatrix(JOINTS_0[2]) * WEIGHTS_0[2] +\n                        skin_getBoneMatrix(JOINTS_0[3]) * WEIGHTS_0[3];\n        return skinMatrix;\n}",heatmap_render_vert:"#ifdef HAS_HEATMAP\nvarying vec2 heatmap_vTexCoord;\nvoid heatmap_compute(mat4 matrix, vec3 position) {\n    vec4 pos = matrix * vec4(position.xy, 0., 1.);\n    heatmap_vTexCoord = (1. + pos.xy / pos.w) / 2.;\n}\n#endif",heatmap_render_frag:"#ifdef HAS_HEATMAP\nuniform sampler2D heatmap_inputTexture;\nuniform sampler2D heatmap_colorRamp;\nuniform float heatmap_heatmapOpacity;\nvarying vec2 heatmap_vTexCoord;\nvec4 heatmap_getColor(vec4 color) {\n    float t = texture2D(heatmap_inputTexture, heatmap_vTexCoord).r;\n    vec4 heatmapColor = texture2D(heatmap_colorRamp, vec2(t, 0.5)) * heatmap_heatmapOpacity;\n    return color * (1.0 - heatmapColor.a) + heatmapColor * heatmapColor.a;\n}\n#endif",line_extrusion_vert:"#ifdef IS_LINE_EXTRUSION\n    #define ALTITUDE_SCALE 32767.0;\n    #define EXTRUDE_SCALE 63.0;\n    attribute vec2 aExtrude;\n    #ifdef HAS_LINE_WIDTH\n        attribute float aLineWidth;\n    #else\n        uniform float lineWidth;\n    #endif\n    #ifdef HAS_LINE_HEIGHT\n        attribute float aLineHeight;\n    #else\n        uniform float lineHeight;\n    #endif\n    uniform float linePixelScale;\n    vec3 getLineExtrudePosition(vec3 position) {\n        #ifdef HAS_LINE_WIDTH\n            float lineWidth = aLineWidth / 2.0;\n        #endif\n        #ifdef HAS_LINE_HEIGHT\n            float lineHeight = aLineHeight / 10.0;\n        #endif\n        float halfwidth = lineWidth / 2.0;\n        float outset = halfwidth;\n        vec2 dist = outset * aExtrude / EXTRUDE_SCALE;\n        position.z *= lineHeight / ALTITUDE_SCALE;\n        return position + vec3(dist, 0.0) * linePixelScale;\n    }\n#endif",gl2_vert:"#if __VERSION__ == 300\n    #define texture2D texture\n    #define varying out\n    #define attribute in\n#endif",gl2_frag:"#if __VERSION__ == 300\n    #define varying in\n    #define gl_FragDepthEXT gl_FragDepth\n    #define texture2D texture\n    #define textureCube texture\n    #define texture2DProj textureProj\n    #define texture2DLodEXT textureLod\n    #define texture2DProjLodEXT textureProjLod\n    #define textureCubeLodEXT textureLod\n    #define texture2DGradEXT textureGrad\n    #define texture2DProjGradEXT textureProjGrad\n    #define textureCubeGradEXT textureGrad\n    #define texture2D texture\n    out vec4 glFragColor;\n#else\n    vec4 glFragColor;\n#endif",hsv_frag:"\nconst mediump vec4 HSV_K0 = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nconst mediump vec4 HSV_K1 = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nconst mediump float HSV_E = 1.0e-10;\nvec3 hsv_rgb2hsv(vec3 c) {\n    vec4 K = HSV_K0;\n    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n    float d = q.x - min(q.w, q.y);\n    float e = HSV_E;\n    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\nvec3 hsv_hsv2rgb(vec3 c) {\n    vec4 K = HSV_K1;\n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec4 hsv_apply(vec4 c, vec3 hsvOffset) {\n    vec3 hsv = hsv_rgb2hsv(c.rgb);\n    hsv += hsv * hsvOffset;\n    hsv = clamp(hsv, 0.0, 1.0);\n    return vec4(hsv_hsv2rgb(hsv), c.a);\n}\nvec3 hsv_apply(vec3 c, vec3 hsvOffset) {\n    vec3 hsv = hsv_rgb2hsv(c.rgb);\n    hsv += hsv * hsvOffset;\n    hsv = clamp(hsv, 0.0, 1.0);\n    return hsv_hsv2rgb(hsv);\n}\nmat4 contrastMatrix(float contrast)\n{\n    float t = (1.0 - contrast) / 2.0;\n    return mat4(\n        contrast, 0., 0., 0.,\n        0., contrast, 0., 0.,\n        0., 0., contrast, 0.,\n        t, t, t, 1\n    );\n}",snow_frag:"#ifdef HAS_SNOW\n    float lerp(float a, float b, float w) {\n        return a + w * (b - a);\n    }\n    vec3 snow(vec4 sceneColor, vec3 normalColor, float height) {\n        float snowIntense = normalColor.b;\n        vec3 fixedC = vec3(1.0, 1.0, 1.0);\n        if (height < 1.0) {\n            float r = lerp(0.5, fixedC.x, snowIntense);\n            float g = lerp(0.5, fixedC.y, snowIntense);\n            float b = lerp(0.5, fixedC.z, snowIntense);\n            return vec3(r, g, b);\n        } else {\n            float r = lerp(sceneColor.r, fixedC.x, snowIntense);\n            float g = lerp(sceneColor.g, fixedC.y, snowIntense);\n            float b = lerp(sceneColor.b, fixedC.z, snowIntense);\n            return vec3(r, g, b);\n        }\n    }\n#endif",draco_decode_vert:"#if defined(HAS_TANGENT)\n    attribute vec4 aTangent;\n#elif defined(HAS_NORMAL)\n    #ifdef HAS_DRACO_NORMAL\n        attribute vec2 aNormal;\n        uniform float gltf_u_dec_normal_rangeConstant;\n    #else\n        attribute vec3 aNormal;\n    #endif\n#endif\n#ifdef HAS_DRACO_POSITION\n    uniform float gltf_u_dec_position_normConstant;\n    uniform vec3 minValues_pos;\n    vec3 decodeDracoPosition(vec3 aPosition) {\n        return minValues_pos + aPosition * gltf_u_dec_position_normConstant;\n    }\n#endif\n#ifdef HAS_DRACO_TEXCOORD\n    uniform vec2 minValues_tex;\n    uniform float gltf_u_dec_texcoord_0_normConstant;\n    vec2 decodeDracoTexcoord(vec2 aTexCoord) {\n        return minValues_tex + aTexCoord * gltf_u_dec_texcoord_0_normConstant;\n    }\n#endif\n#ifdef HAS_WEB3D_quantized_attributes_TEXCOORD\n    uniform mat3 decodeMatrix;\n#endif\n#ifdef HAS_DRACO_NORMAL\n    float czm_signNotZero(float value) {\n        return value >= 0.0 ? 1.0 : -1.0;\n    }\n    vec2 czm_signNotZero(vec2 value) {\n        return vec2(czm_signNotZero(value.x), czm_signNotZero(value.y));\n    }\n    vec3 decodeDracoNormal(vec2 encoded, float range)\n    {\n        if (encoded.x == 0.0 && encoded.y == 0.0) {\n            return vec3(0.0, 0.0, 0.0);\n        }\n        encoded = encoded / range * 2.0 - 1.0;\n        vec3 v = vec3(encoded.x, encoded.y, 1.0 - abs(encoded.x) - abs(encoded.y));\n        if (v.z < 0.0) {\n            v.xy = (1.0 - abs(v.yx)) * czm_signNotZero(v.xy);\n        }\n        return normalize(v);\n    }\n    vec3 decode_getNormal(vec2 aNormal) {\n        return decodeDracoNormal(aNormal, gltf_u_dec_normal_rangeConstant).zxy;\n    }\n#endif\n#ifdef HAS_COMPRESSED_INT16\n    #ifdef HAS_COMPRESSED_INT16_POSITION\n      uniform vec2 compressedPositionRange;\n    #endif\n    #ifdef HAS_COMPRESSED_INT16_TEXCOORD_0\n      uniform vec2 compressedTexcoordRange_0;\n    #endif\n    #ifdef HAS_COMPRESSED_INT16_TEXCOORD_1\n      uniform vec2 compressedTexcoordRange_1;\n    #endif\n    #ifdef HAS_COMPRESSED_INT16_NORMAL\n      uniform vec2 compressedNormalRange;\n    #endif\n    #ifdef HAS_COMPRESSED_INT16_RATIO\n      uniform float compressed_ratio;\n    #endif\n    float int16ToFloat32(float value, vec2 range) {\n        float v = (value >= 32768.0) ? -(65536.0 - value) / 32768.0 : value / 32767.0;\n        return (v + 1.0) * (range.y - range.x) / 2.0 + range.x;\n    }\n#endif\nvec3 decode_getPosition(vec3 aPosition) {\n    vec3 position = aPosition;\n    #if defined(HAS_COMPRESSED_INT16) && defined(HAS_COMPRESSED_INT16_POSITION)\n        float x = int16ToFloat32(aPosition.x, compressedPositionRange);\n        float y = int16ToFloat32(aPosition.y, compressedPositionRange);\n        float z = int16ToFloat32(aPosition.z, compressedPositionRange);\n        #ifdef HAS_COMPRESSED_INT16_RATIO\n          position = vec3(x / compressed_ratio, y / compressed_ratio, z);\n        #else\n          position = vec3(x, y, z);\n        #endif\n    #endif\n    #ifdef HAS_DRACO_POSITION\n        return decodeDracoPosition(position);\n    #else\n        return position;\n    #endif\n}\nvec2 decode_getTexcoord(vec2 aTexCoord) {\n    vec2 texcoord = aTexCoord;\n    #if defined(HAS_COMPRESSED_INT16) && (defined(HAS_COMPRESSED_INT16_TEXCOORD_0) || defined(HAS_COMPRESSED_INT16_TEXCOORD_1))\n        float x = int16ToFloat32(aTexCoord.x, compressedTexcoordRange_0);\n        float y = int16ToFloat32(aTexCoord.y, compressedTexcoordRange_0);\n        texcoord = vec2(x, y);\n    #endif\n    #ifdef HAS_DRACO_TEXCOORD\n        return decodeDracoTexcoord(texcoord);\n    #elif defined(HAS_WEB3D_quantized_attributes_TEXCOORD)\n        vec3 web3dTexcoord = decodeMatrix * vec3(texcoord, 1.0);\n        return vec2(web3dTexcoord.x, web3dTexcoord.y);\n    #else\n        return texcoord;\n    #endif\n}\nvec3 decode_getNormal(vec3 aNormal) {\n    #ifdef HAS_COMPRESSED_INT16_NORMAL\n        aNormal.x = int16ToFloat32(aNormal.x, compressedNormalRange);\n        aNormal.y = int16ToFloat32(aNormal.y, compressedNormalRange);\n        aNormal.z = int16ToFloat32(aNormal.z, compressedNormalRange);\n    #endif\n    return aNormal;\n}",highlight_vert:"#if defined(HAS_HIGHLIGHT_COLOR)\n    attribute vec4 aHighlightColor;\n    varying vec4 vHighlightColor;\n#endif\n#if defined(HAS_HIGHLIGHT_OPACITY)\n    attribute float aHighlightOpacity;\n    varying float vHighlightOpacity;\n#endif\nvoid highlight_setVarying() {\n    #if defined(HAS_HIGHLIGHT_COLOR)\n        vHighlightColor = aHighlightColor / 255.0;\n    #endif\n    #if defined(HAS_HIGHLIGHT_OPACITY)\n        vHighlightOpacity = aHighlightOpacity / 255.0;\n    #endif\n}",highlight_frag:"#if defined(HAS_HIGHLIGHT_COLOR)\n\tvarying vec4 vHighlightColor;\n#endif\n#if defined(HAS_HIGHLIGHT_OPACITY)\n    varying float vHighlightOpacity;\n#endif\nvec4 highlight_blendColor(vec4 color) {\n\tvec4 outColor;\n\t#if defined(HAS_HIGHLIGHT_COLOR)\n\t\tcolor.rgb = color.rgb * (1.0 - vHighlightColor.a) + vHighlightColor.rgb * vHighlightColor.a;\n\t\t#ifndef HAS_HIGHLIGHT_COLOR_POINT\n        \tcolor.a = color.a * (1.0 - vHighlightColor.a) + vHighlightColor.a;\n        #endif\n        outColor = color;\n\t#else\n\t\toutColor = color;\n\t#endif\n\t#if defined(HAS_HIGHLIGHT_OPACITY)\n\t\toutColor *= vHighlightOpacity;\n\t#endif\n\treturn outColor;\n}",mask_vert:"#ifdef HAS_MASK_EXTENT\n    uniform vec4 mask_extent;\n    uniform sampler2D mask_colorExtent;\n    uniform sampler2D mask_modeExtent;\n    uniform float mask_maskMode;\n    uniform float mask_hasFlatOut;\n    uniform mat4 viewMatrix;\n    uniform float mask_heightRatio;\n    uniform float mask_heightOffset;\n    varying vec4 vWorldPosition;\n    varying vec2 vUVInExtent;\n    varying float vHeightRatio;\n    varying float vHeightOffset;\n    const float CLIPINSIDE_MODE = 0.2;\n    const float FLATINSIDE_MODE = 0.3;\n    const float FLATOUTSIDE_MODE = 0.4;\n    const float ELEVATE_MODE = 0.7;\n    float random (vec2 st) {\n        return fract(sin(dot(st.xy,vec2(12.9898,78.233)))*43758.5453123) * 0.1;\n    }\n    bool isInExtent(vec4 color) {\n        return length(color.rgb) > 0.0;\n    }\n    float getFlatHeight(float maskMode, float flatHeight, float height) {\n      if (maskMode <= ELEVATE_MODE && maskMode > 0.6) {\n          return flatHeight + height;\n      } else {\n        return flatHeight;\n      }\n    }\n    vec4 getNoErrorPosition(vec4 position, vec4 wPosition) {\n      vec4 realPos = modelViewMatrix * position;      vec4 pos = viewMatrix * wPosition;      vec4 tempPos = viewMatrix * modelMatrix * position;      float deltaX = realPos.x - tempPos.x;\n      float deltaY = realPos.y - tempPos.y;\n      float deltaZ = realPos.z - tempPos.z;\n      pos.x = pos.x + deltaX;\n      pos.y = pos.y + deltaY;\n      pos.z = pos.z + deltaZ;\n      return pos;\n    }\n    vec4 getMaskPosition(vec4 position, mat4 modelMatrix) {\n        vWorldPosition = modelMatrix * position;\n        float w = mask_extent.z - mask_extent.x;\n        float h = mask_extent.y - mask_extent.w;\n        vec2 uvInExtent = vec2((vWorldPosition.x - mask_extent.x) / abs(w), 1.0 - (vWorldPosition.y - mask_extent.w) / h);\n        vec4 extentColor = texture2D(mask_colorExtent, uvInExtent);\n        vec3 maskOptionColor = texture2D(mask_modeExtent, uvInExtent).rgb;\n        float maskMode = maskOptionColor.r;\n        float flatHeight = maskOptionColor.g / mask_heightRatio + mask_heightOffset;\n        float height = getFlatHeight(maskMode, flatHeight, vWorldPosition.z);\n        vec4 wPosition = vec4(vWorldPosition.x, vWorldPosition.y, height, vWorldPosition.w);\n        vUVInExtent = uvInExtent;\n        vHeightRatio = mask_heightRatio;\n        vHeightOffset = mask_heightOffset;\n        if (maskMode <= FLATOUTSIDE_MODE && maskMode > FLATINSIDE_MODE) {\n            return modelViewMatrix * position;;\n        } else if (mask_hasFlatOut == 1.0) {\n            return getNoErrorPosition(position, wPosition);\n        }\n        if (isInExtent(extentColor) == true && maskMode <= FLATINSIDE_MODE && maskMode > CLIPINSIDE_MODE) {\n            return getNoErrorPosition(position, wPosition);\n        } if (isInExtent(extentColor) == true && maskMode <= ELEVATE_MODE && maskMode > 0.6) {\n            return getNoErrorPosition(position, wPosition);\n        } else {\n            return modelViewMatrix * position;\n        }\n    }\n#endif",mask_frag:"#ifdef HAS_MASK_EXTENT\n    uniform sampler2D mask_colorExtent;\n    uniform sampler2D mask_modeExtent;\n    uniform float mask_hasClipOut;\n    varying float vHeightRatio;\n    varying float vHeightOffset;\n    varying vec2 vUVInExtent;\n    varying vec4 vWorldPosition;\n    const float CLIPINSIDE_MODE = 0.1;\n    const float CLIPOUTSIDE_MODE = 0.2;\n    const float FLATINSIDE_MODE = 0.3;\n    const float FLATOUTSIDE_MODE = 0.4;\n    const float COLOR_MODE = 0.5;\n    const float VIDEO_MODE = 0.6;\n    bool isInExtent(vec4 color) {\n        return length(color.rgb) > 0.0;\n    }\n    vec4 setMask(vec4 glFragColor) {\n        vec4 extentColor = texture2D(mask_colorExtent, vUVInExtent);\n        vec4 modeColor = texture2D(mask_modeExtent, vUVInExtent);\n        float maskMode = modeColor.r;\n        float minHeight = modeColor.b / vHeightRatio + vHeightOffset;\n        float maxHeight = modeColor.a / vHeightRatio + vHeightOffset;\n        if (maskMode > CLIPINSIDE_MODE && maskMode <= CLIPOUTSIDE_MODE) {\n            if (minHeight == 0.0 && maxHeight == 0.0) {\n                return glFragColor;\n            } else if (vWorldPosition.z >= minHeight && vWorldPosition.z <= maxHeight) {\n                return glFragColor;\n            } else {\n              discard;\n            }\n        } else if (mask_hasClipOut == 1.0) {\n            discard;\n        }\n        if (isInExtent(extentColor) == true && maskMode <= CLIPINSIDE_MODE && maskMode > 0.0) {\n            if (minHeight == 0.0 && maxHeight == 0.0) {\n                discard;\n            } else if (vWorldPosition.z >= minHeight && vWorldPosition.z <= maxHeight) {\n                discard;\n            } else {\n              return glFragColor;\n            }\n        } else if (isInExtent(extentColor) == true && maskMode <= VIDEO_MODE && maskMode > FLATOUTSIDE_MODE) {\n            if (minHeight == 0.0 && maxHeight == 0.0) {\n                glFragColor = vec4(mix(extentColor.rgb, glFragColor.rgb, 1.0 - extentColor.a), glFragColor.a);\n            } else if (vWorldPosition.z >= minHeight && vWorldPosition.z <= maxHeight) {\n                glFragColor = vec4(mix(extentColor.rgb, glFragColor.rgb, 1.0 - extentColor.a), glFragColor.a);\n            }\n        }\n        return glFragColor;\n    }\n#endif",computeTexcoord_frag:"#ifdef HAS_KHR_TEXTURE_TRANSFORM\n    uniform vec2 khr_offset;\n    uniform float khr_rotation;\n    uniform vec2 khr_scale;\n    vec2 khr_tex_transformTexCoord(vec2 texCoords, vec2 offset, float rotation, vec2 scale) {\n        rotation = -rotation;\n        mat3 transform = mat3(\n        cos(rotation) * scale.x, sin(rotation) * scale.x, 0.0, -sin(rotation) * scale.y, cos(rotation) * scale.y, 0.0, offset.x, offset.y, 1.0);\n        vec2 transformedTexCoords = (transform * vec3(fract(texCoords), 1.0)).xy;\n        return transformedTexCoords;\n    }\n#endif\nvarying highp vec2 vTexCoord;\n#ifdef HAS_I3S_UVREGION\n    varying vec4 vUvRegion;\n#endif\nvec2 computeTexCoord(vec2 texCoord) {\n    #ifdef HAS_I3S_UVREGION\n        vec2 atlasScale = vUvRegion.zw - vUvRegion.xy;\n        vec2 uvAtlas = fract(texCoord) * atlasScale + vUvRegion.xy;\n        return uvAtlas;\n    #elif defined(HAS_KHR_TEXTURE_TRANSFORM)\n        return khr_tex_transformTexCoord(texCoord, khr_offset, khr_rotation, khr_scale);\n    #else\n        return texCoord;\n    #endif\n}",terrain_normal_frag:"#ifdef HAS_TERRAIN_NORMAL\n    uniform sampler2D terrainHeightTexture;\n    uniform vec2 terrainHeightMapResolution;\n    uniform vec2 terrainResolution;\n    uniform float terrainHeightScale;\n    uniform float terrainTileResolution;\n    uniform vec4 terrainUnpackFactors;\n    float getHeight(vec2 uv) {\n        vec4 color = texture2D(terrainHeightTexture, uv) * 255.0;\n        color.a = -1.0;\n        return dot(color, terrainUnpackFactors) / 4.0;\n    }\n    vec3 convertTerrainHeightToNormalMap(vec2 uv) {\n        uv.y = 1.0 - uv.y;\n        vec2 epsilon = 1.0 / terrainHeightMapResolution;\n        float a = getHeight(uv + vec2(-epsilon.x, -epsilon.y));\n        float b = getHeight(uv + vec2(0, -epsilon.y));\n        float c = getHeight(uv + vec2(epsilon.x, -epsilon.y));\n        float d = getHeight(uv + vec2(-epsilon.x, 0));\n        float e = getHeight(uv + vec2(epsilon.x, 0));\n        float f = getHeight(uv + vec2(-epsilon.x, epsilon.y));\n        float g = getHeight(uv + vec2(0, epsilon.y));\n        float h = getHeight(uv + vec2(epsilon.x, epsilon.y));\n        vec2 dxy = vec2(\n            (c + e + e + h) - (a + d + d + f),\n            (f + g + g + h) - (a + b + b + c)\n        );\n        return normalize(vec3(dxy / epsilon, terrainResolution ));\n    }\n#endif",vertex_color_vert:"#ifdef HAS_VERTEX_COLOR\nattribute float aVertexColorType;\nuniform vec4 vertexColorsOfType[VERTEX_TYPES_COUNT];\nvarying vec4 vertexColor_color;\nvoid vertexColor_update() {\n    vertexColor_color = vertexColorsOfType[int(aVertexColorType)];\n}\n#endif",vertex_color_frag:"#ifdef HAS_VERTEX_COLOR\nvarying vec4 vertexColor_color;\nvec4 vertexColor_get() {\n\treturn vertexColor_color;\n}\n#endif",excavate_vert:"#ifdef HAS_EXCAVATE_ANALYSIS\n  uniform vec4 excavateExtent;\n  varying vec2 vCoordinateTexcoord;\n  varying float vHeight;\n  float getWorldHeight() {\n    vec4 wPosition = modelMatrix * getPosition(aPosition);\n    return wPosition.z;\n  }\n  vec2 getCoordinateTexcoord() {\n    mat4 localPositionMatrix = getPositionMatrix();\n    vec4 wPosition = modelMatrix * localPositionMatrix * getPosition(aPosition);\n    float x = (wPosition.x - excavateExtent.x) / (excavateExtent.z - excavateExtent.x);\n    float y = (wPosition.y - excavateExtent.y) / (excavateExtent.w - excavateExtent.y);\n    return vec2(x, y);\n  }\n#endif",excavate_frag:"#ifdef HAS_EXCAVATE_ANALYSIS\n  uniform sampler2D heightmap;\n  uniform float excavateHeight;\n  varying vec2 vCoordinateTexcoord;\n  varying float vHeight;\n  const vec2 range = vec2(-100.0, 1000.0);\n  float decodeHeight(const in vec4 pack) {\n      return pack.r + pack.g / 255.0;\n  }\n  vec4 excavateColor(vec4 fragColor) {\n      float samplerHeight = decodeHeight(texture2D(heightmap, vCoordinateTexcoord));\n      float realHeight = samplerHeight * (range.y - range.x) + range.x;\n      if(realHeight < range.x || realHeight > range.y) {\n          realHeight = 0.0;\n      }\n      if(vHeight > realHeight) {\n          discard;\n      }\n      return fragColor;\n  }\n#endif",srgb_frag:"vec3 linearTosRGB(const in vec3 color) {\n    return vec3( color.r < 0.0031308 ? color.r * 12.92 : 1.055 * pow(color.r, 1.0/2.4) - 0.055, color.g < 0.0031308 ? color.g * 12.92 : 1.055 * pow(color.g, 1.0/2.4) - 0.055, color.b < 0.0031308 ? color.b * 12.92 : 1.055 * pow(color.b, 1.0/2.4) - 0.055);\n}\nvec3 sRGBToLinear(const in vec3 color) {\n    return vec3( color.r < 0.04045 ? color.r * (1.0 / 12.92) : pow((color.r + 0.055) * (1.0 / 1.055), 2.4), color.g < 0.04045 ? color.g * (1.0 / 12.92) : pow((color.g + 0.055) * (1.0 / 1.055), 2.4), color.b < 0.04045 ? color.b * (1.0 / 12.92) : pow((color.b + 0.055) * (1.0 / 1.055), 2.4));\n}"};var ZC={register(e,n){if(qC[e])throw new Error(`Key of ${e} is already registered in ShaderLib.`);qC[e]=n},compile:e=>XC(e)};const QC=/^[ \t]*#include +<([\w\d.]+)>/gm;function XC(e){return e.replace(QC,YC)}function YC(e,n){const i=qC[n];if(!i)throw new Error("Can not resolve #include <"+n+">");return XC(i)}let JC=0;const KC={};let $C=class yn{constructor({vert:e,frag:n,uniforms:i,defines:o,extraCommandProps:s}){this.vert=e,this.frag=n;const a=JC++;Object.defineProperty(this,"uid",{enumerable:!0,configurable:!1,get:()=>a}),this.shaderDefines=o&&$b({},o)||{},i=this.uniforms=(i||[]).slice(),this.contextDesc={};for(let e=0,n=i.length;e<n;e++){const n=i[e];if(Xb(n))if(n.indexOf("[")>0){const{name:e,len:i}=tP(n);this.contextDesc[e]={name:e,type:"array",length:i}}else this.contextDesc[n]=null;else if(n.name.indexOf("[")>0){const{name:e,len:i}=tP(n.name);this.contextDesc[e]={name:e,type:"array",length:i,fn:n.fn}}else this.contextDesc[n.name]=n}this.extraCommandProps=s&&$b({},s)||{},this.commands={},this._compileSource()}set shaderDefines(e){this._shaderDefines=e,this.dkey=Object.keys(this._shaderDefines).join()}get shaderDefines(){return this._shaderDefines||{}}setDefines(e){this.shaderDefines=e}setFramebuffer(e){return this.context.framebuffer=e,this}appendDescUniforms(e,n){const i=n,o=this.contextDesc;for(const s in o)if(o[s])if("array"===o[s].type){const a=s,h=o[s].length;let l=n[s];if(o[s].fn&&(l=o[s].fn(null,n)),!l)continue;if(l.length!==h)throw new Error(`${a} uniform's length is not ${h}`);i[a]=i[a]||{};for(let n=0;n<h;n++)i[a][`${n}`]=l[n].getREGLTexture?l[n].getREGLTexture(e):l[n]}else"function"===o[s].type&&(Object.getOwnPropertyDescriptor(i,s)||Object.defineProperty(i,s,{configurable:!1,enumerable:!0,get:function(){return o[s].fn(null,n)}}));return i}setUniforms(e){if(e.modelMatrix||e.positionMatrix)throw new Error("modelMatrix or positionMatrix is reserved uniform name for Mesh, please change to another name");return this.contextKeys=e?Object.keys(e).join():null,this.context=e,this}getVersion(e,n){return"#version"===n.substring(0,8)?"":0===e.limits.version.indexOf("WebGL 2.0")&&300===this.version?"#version 300 es\n":"#version 100\n"}getActiveVars(e,n,i,o){const s=o;if(KC[s])return KC[s];const a=e._gl,h=a.createProgram(),l=a.createShader(35633);a.shaderSource(l,n),a.compileShader(l);const c=a.createShader(35632);a.shaderSource(c,i),a.compileShader(c),a.attachShader(h,c),a.attachShader(h,l),a.linkProgram(h);const A=a.getProgramParameter(h,35721),f=[];for(let e=0;e<A;++e){const n=a.getActiveAttrib(h,e);n&&f.push({name:n.name,type:n.type})}const d=a.getProgramParameter(h,35718),p=[];for(let e=0;e<d;++e){const n=a.getActiveUniform(h,e);let i=n.name;n.name.indexOf("[")>0&&(i=i.replace("[0]","")),p.push(i)}return a.deleteProgram(h),a.deleteShader(l),a.deleteShader(c),KC[s]={activeUniforms:p,activeAttributes:f},KC[s]}createREGLCommand(e,n,i,o,s,a={}){const h=sw(e)&&!s,l=$b({},this.shaderDefines||{},n||{}),c=this._insertDefines(this.vert,l),A=this.getVersion(e,c)+c,f=this._insertDefines(this.frag,l),d=this.getVersion(e,f)+f,p=dw(A)+"_"+dw(d),{activeAttributes:g,activeUniforms:v}=this.getActiveVars(e,A,d,p),w={};g.forEach(((n,i)=>{const o=n.name;w[o]=h?i:e.prop(o)}));const C={};v.forEach((n=>{C[n]=e.prop(n)}));const P=this.contextDesc;for(const n in P)if(P[n]&&"function"===P[n].type)C[n]=P[n].fn;else if(P[n]&&"array"===P[n].type){const i=P[n].name,o=P[n].length;for(let n=0;n<o;n++){const o=`${i}[${n}]`;C[o]=e.prop(o)}}else C[n]=e.prop(n);const T={vert:A,frag:d,uniforms:C,attributes:w};h&&(T.vao=e.prop("vao")),h&&!o||!i||ew(i)||(T.elements=e.prop("elements")),T.count=e.prop("count"),T.offset=e.prop("offset"),T.primitive=e.prop("primitive"),T.framebuffer=e.prop("framebuffer"),o&&(T.instances=e.prop("instances")),$b(T,this.extraCommandProps,a);const S=e(T);return g.key=g.map((e=>e.name)).join(),S.activeAttributes=g,S}dispose(){for(const e in this.commands){const n=this.commands[e];n&&n.destroy&&!n[xw]&&(n[xw]=!0,n.destroy())}this.commands={},delete this.vert,delete this.frag}_insertDefines(e,n){const i=[];for(const e in n)aw(n,e)&&!Kb(n[e])&&i.push(`#define ${e} ${n[e]}\n`);return i.join("")+e}_compileSource(){this.vert=ZC.compile(this.vert),this.frag=ZC.compile(this.frag)}};function tP(e){const n=e.indexOf("["),i=e.indexOf("]");return{name:e.substring(0,n),len:+e.substring(n+1,i)}}let eP=class Sn extends $C{draw(e,n){if(!n||!n.length)return 0;const i=[];let o,s=0;for(let a=0,h=n.length;a<h;a++){if(!n[a].isValid()){a===h-1&&o&&i.length&&o(i);continue}if(!n[a].geometry.getDrawCount()||!this._runFilter(n[a])){a===h-1&&o&&i.length&&o(i);continue}const l=this.getMeshCommand(e,n[a]);i.length&&o!==l&&(o(i),i.length=0);const c=n[a].getREGLProps(e,l.activeAttributes);this._ensureContextDefines(c),c.shaderContext=this.context,this.appendDescUniforms(e,c),i.push(c),s++,a<h-1?o=l:a===h-1&&l(i)}return s}_ensureContextDefines(e){if(this.context&&(e.contextKeys||(e.contextKeys={}),e.contextKeys[this.uid]!==this.contextKeys)){for(const n in this.context)"framebuffer"===n||Object.getOwnPropertyDescriptor(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:function(){return this.shaderContext[n]}});Object.getOwnPropertyDescriptor(e,"framebuffer")||Object.defineProperty(e,"framebuffer",{configurable:!1,enumerable:!0,get:function(){return this.targetFramebuffer||this.shaderContext&&this.shaderContext.framebuffer}}),e.contextKeys[this.uid]=this.contextKeys}}_runFilter(e){const n=this.filter;if(!n)return!0;if(Array.isArray(n)){for(let i=0;i<n.length;i++)if(!n[i](e))return!1;return!0}return n(e)}getMeshCommand(e,n){this._cmdKeys||(this._cmdKeys={});const i=this.dkey||"default";let o=this._cmdKeys[i];o||(o=this._cmdKeys[i]={});const s=n.getCommandKey(e);o[s]||(o[s]=i+"_"+n.getCommandKey(e));const a=o[s];let h=this.commands[a];if(!h){const i=n.getDefines(),o=n.getMaterial(),s={};o&&o.doubleSided&&this.extraCommandProps&&(s.cull={enable:!1}),h=this.commands[a]=this.createREGLCommand(e,i,n.getElements(),n instanceof wC,n.disableVAO,s)}return h}},nP=class Mn extends eP{constructor(e={}){const n=[],i=[],o=e.uniforms,s=[{name:"modelNormalMatrix",type:"function",fn:function(e,i){return uv(n,i.modelMatrix)}},{name:"modelViewMatrix",type:"function",fn:function(e,n){return Cv(i,n.viewMatrix,n.modelMatrix)}}];o&&s.push(...o),super({vert:e.vert||"#include <gl2_vert>\nattribute vec3 aPosition;\n#include <line_extrusion_vert>\n#ifdef HAS_MAP\nuniform vec2 uvScale;\nuniform vec2 uvOffset;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\n#ifdef HAS_I3S_UVREGION\nattribute vec4 uvRegion;\nvarying vec4 vUvRegion;\n#endif\n#if defined(HAS_AO_MAP)\nattribute vec2 aTexCoord1;\nvarying vec2 vTexCoord1;\n#endif\n#endif\n#if defined(HAS_COLOR)\nattribute vec4 aColor;\n#elif defined(HAS_COLOR0)\n#if COLOR0_SIZE == 3\nattribute vec3 aColor0;\n#else\nattribute vec4 aColor0;\n#endif\nvarying vec4 vColor;\n#endif\nvarying vec3 vFragPos;\nvarying vec3 vNormal;\nuniform mat4 projMatrix;\nuniform mat3 modelNormalMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 positionMatrix;\nuniform vec2 halton;\nuniform vec2 outSize;\nuniform mat4 projViewMatrix;\n#include <highlight_vert>\n#include <get_output>\n#include <heatmap_render_vert>\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_vert>\n#endif\n#ifdef HAS_EXTRUSION_OPACITY\nattribute float aExtrusionOpacity;\nvarying float vExtrusionOpacity;\n#endif\n#if defined(HAS_TANGENT)\nvarying vec4 vTangent;\n#endif\nvoid c(const highp vec4 q, out highp vec3 d) {\n  d = vec3(.0, .0, 1.) + vec3(2., -2., -2.) * q.x * q.zwx + vec3(2., 2., -2.) * q.y * q.wzy;\n}\nvoid c(const highp vec4 q, out highp vec3 d, out highp vec3 t) {\n  c(q, d);\n  t = vec3(1., .0, .0) + vec3(-2., 2., -2.) * q.y * q.yxw + vec3(-2., 2., 2.) * q.z * q.zwx;\n}\nvoid main() {\n  \n#ifdef IS_LINE_EXTRUSION\nvec4 e = getPosition(getLineExtrudePosition(aPosition));\n#else\nvec4 e = getPosition(aPosition);\n#endif\nmat4 f = getPositionMatrix();\n  vFragPos = vec3(modelMatrix * f * e);\n#if defined(HAS_NORMAL) || defined(HAS_TANGENT)\nmat3 h = modelNormalMatrix * mat3(f);\n  vec3 i;\n#if defined(HAS_TANGENT)\nvec3 t;\n  c(aTangent, i, t);\n  vTangent = vec4(h * t, aTangent.w);\n#else\ni = decode_getNormal(aNormal);\n#endif\nvec3 j = appendMorphNormal(i);\n  vNormal = normalize(h * j);\n#else\nvNormal = vec3(.0);\n#endif\nmat4 k = projMatrix;\n  k[2].xy += halton.xy / outSize.xy;\n#ifdef HAS_MASK_EXTENT\ngl_Position = k * getMaskPosition(f * e, modelMatrix);\n#else\ngl_Position = k * modelViewMatrix * f * e;\n#endif\n#ifdef HAS_MAP\nvec2 l = decode_getTexcoord(aTexCoord);\n  vTexCoord = l * uvScale + uvOffset;\n#endif\n#ifdef HAS_AO_MAP\nvec2 m = decode_getTexcoord(aTexCoord1);\n  vTexCoord1 = m * uvScale + uvOffset;\n#endif\n#ifdef HAS_EXTRUSION_OPACITY\nvExtrusionOpacity = aExtrusionOpacity;\n#endif\n#if defined(HAS_COLOR)\nvColor = aColor / 255.;\n#elif defined(HAS_COLOR0)\n#if COLOR0_SIZE == 3\nvColor = vec4(aColor0 / 255., 1.);\n#else\nvColor = aColor0 / 255.;\n#endif\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nshadow_computeShadowPars(f * e);\n#endif\n#ifdef HAS_HEATMAP\nheatmap_compute(projMatrix * modelViewMatrix * f, e);\n#endif\n#ifdef HAS_I3S_UVREGION\nvUvRegion = uvRegion / 65535.;\n#endif\nhighlight_setVarying();\n}",frag:e.frag||"precision mediump float;\n#include <gl2_frag>\nuniform vec4 baseColorFactor;\nuniform float materialShininess;\nuniform float environmentExposure;\nuniform float specularStrength;\nuniform vec3 light0_viewDirection;\nuniform vec3 ambientColor;\nuniform vec4 light0_diffuse;\nuniform vec3 lightSpecular;\nuniform vec3 cameraPosition;\nuniform float alphaTest;\n#ifdef HAS_TOON\nuniform float toons;\nuniform float specularToons;\n#endif\n#ifdef HAS_TANGENT\nvarying vec4 vTangent;\n#endif\n#ifdef HAS_MAP\n#include <computeTexcoord_frag>\n#endif\nvarying vec3 vNormal;\nvarying vec3 vFragPos;\n#ifdef HAS_INSTANCE_COLOR\nvarying vec4 vInstanceColor;\n#endif\n#ifdef HAS_BASECOLOR_MAP\nuniform sampler2D baseColorTexture;\n#endif\n#ifdef HAS_EXTRUSION_OPACITY\nuniform vec2 extrusionOpacityRange;\nvarying float vExtrusionOpacity;\n#endif\n#if defined(HAS_COLOR) || defined(HAS_COLOR0)\nvarying vec4 vColor;\n#elif defined(IS_LINE_EXTRUSION)\nuniform vec4 lineColor;\n#else\nuniform vec4 polygonFill;\n#endif\n#ifdef HAS_LAYER_OPACITY\nuniform float layerOpacity;\n#endif\n#ifdef IS_LINE_EXTRUSION\nuniform float lineOpacity;\n#else\nuniform float polygonOpacity;\n#endif\n#ifdef HAS_AO_MAP\nuniform sampler2D occlusionTexture;\nvarying vec2 vTexCoord1;\n#endif\n#ifdef HAS_NORMAL_MAP\nuniform sampler2D normalTexture;\n#endif\n#ifdef HAS_EMISSIVE_MAP\nuniform sampler2D emissiveTexture;\n#endif\n#ifdef SHADING_MODEL_SPECULAR_GLOSSINESS\nuniform vec4 diffuseFactor;\nuniform vec3 specularFactor;\n#ifdef HAS_DIFFUSE_MAP\nuniform sampler2D diffuseTexture;\n#endif\n#ifdef HAS_SPECULARGLOSSINESS_MAP\nuniform sampler2D specularGlossinessTexture;\n#endif\n#endif\n#include <heatmap_render_frag>\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_frag>\n#endif\n#include <highlight_frag>\n#include <mask_frag>\nvec3 c() {\n  \n#if defined(HAS_NORMAL_MAP)\nvec3 d = normalize(vNormal);\n  vec3 e = texture2D(normalTexture, computeTexCoord(vTexCoord)).xyz * 2. - 1.;\n#if defined(HAS_TANGENT)\nvec3 t = normalize(vTangent.xyz);\n  vec3 b = normalize(cross(d, t) * sign(vTangent.w));\n  mat3 f = mat3(t, b, d);\n  return normalize(f * e);\n#else\nreturn normalize(e);\n#endif\n#else\nreturn normalize(vNormal);\n#endif\n}\nvec4 h(const in vec4 i) {\n  return vec4(i.r < .0031308 ? i.r * 12.92 : 1.055 * pow(i.r, 1. / 2.4) - .055, i.g < .0031308 ? i.g * 12.92 : 1.055 * pow(i.g, 1. / 2.4) - .055, i.b < .0031308 ? i.b * 12.92 : 1.055 * pow(i.b, 1. / 2.4) - .055, i.a);\n}\nvec4 j() {\n  \n#if defined(HAS_BASECOLOR_MAP)\nreturn texture2D(baseColorTexture, computeTexCoord(vTexCoord));\n#elif defined(HAS_DIFFUSE_MAP)\nreturn texture2D(diffuseTexture, computeTexCoord(vTexCoord));\n#elif defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\nreturn diffuseFactor;\n#else\nreturn baseColorFactor;\n#endif\n}\nvec3 k() {\n  \n#if defined(HAS_SPECULARGLOSSINESS_MAP)\nreturn texture2D(specularGlossinessTexture, computeTexCoord(vTexCoord)).rgb;\n#elif defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\nreturn specularFactor;\n#else\nreturn vec3(1.);\n#endif\n}\nvoid main() {\n  vec4 l = j();\n  vec3 m = environmentExposure * ambientColor * l.rgb;\n#ifdef HAS_INSTANCE_COLOR\nm *= vInstanceColor.rgb;\n#endif\nvec3 o = c();\n  vec3 u = normalize(-light0_viewDirection);\n  float v = max(dot(o, u), .0);\n#ifdef HAS_TOON\nfloat A = floor(v * toons);\n  v = A / toons;\n#endif\nvec3 B = light0_diffuse.rgb * v * l.rgb;\n#if defined(HAS_COLOR) || defined(HAS_COLOR0)\nvec3 i = vColor.rgb;\n#elif defined(IS_LINE_EXTRUSION)\nvec3 i = lineColor.rgb;\n#else\nvec3 i = polygonFill.rgb;\n#endif\n#ifdef HAS_INSTANCE_COLOR\ni *= vInstanceColor.rgb;\n#endif\nm *= i.rgb;\n  B *= i.rgb;\n  vec3 C = normalize(cameraPosition - vFragPos);\n  vec3 D = normalize(u + C);\n  float E = pow(max(dot(o, D), .0), materialShininess);\n#ifdef HAS_TOON\nfloat F = floor(E * specularToons);\n  E = F / specularToons;\n#endif\nvec3 G = specularStrength * lightSpecular * E * k();\n#ifdef HAS_OCCLUSION_MAP\nfloat H = texture2D(occlusionTexture, computeTexCoord(vTexCoord1)).r;\n  m *= H;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nfloat I = shadow_computeShadow();\n  B = shadow_blend(B, I).rgb;\n  G = shadow_blend(G, I).rgb;\n  m = shadow_blend(m, I).rgb;\n#endif\nvec3 J = m + B + G;\n#ifdef HAS_EMISSIVE_MAP\nvec3 K = texture2D(emissiveTexture, computeTexCoord(vTexCoord)).rgb;\n  J += K;\n#endif\n#ifdef IS_LINE_EXTRUSION\nglFragColor = vec4(J, lineOpacity * l.a);\n#else\nglFragColor = vec4(J, polygonOpacity * l.a);\n#endif\n#if defined(HAS_COLOR) || defined(HAS_COLOR0)\nfloat L = vColor.a;\n#elif defined(IS_LINE_EXTRUSION)\nfloat L = lineColor.a;\n#else\nfloat L = polygonFill.a;\n#endif\nglFragColor *= L;\n#ifdef HAS_EXTRUSION_OPACITY\nfloat M = extrusionOpacityRange.x;\n  float N = extrusionOpacityRange.y;\n  float O = M + vExtrusionOpacity * (N - M);\n  O = clamp(O, .0, 1.);\n  glFragColor *= O;\n#endif\nif(glFragColor.a < alphaTest) {\n    discard;\n  }\n#ifdef HAS_HEATMAP\nglFragColor = heatmap_getColor(glFragColor);\n#endif\nglFragColor = highlight_blendColor(glFragColor);\n#ifdef HAS_LAYER_OPACITY\nglFragColor *= layerOpacity;\n#endif\n#ifdef HAS_MASK_EXTENT\nglFragColor = setMask(glFragColor);\n#endif\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:s,defines:e.defines||{},extraCommandProps:e.extraCommandProps||{}}),this.version=300}getGeometryDefines(e){const n={};return e.data[e.desc.tangentAttribute]?n.HAS_TANGENT=1:e.data[e.desc.normalAttribute]&&(n.HAS_NORMAL=1),n}};var iP="#if __VERSION__ == 300\n#define attribute in\n#define varying out\n#endif\nattribute vec2 aPosition;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\nvoid main() {\n  gl_Position = vec4(aPosition, 0., 1.);\n  vTexCoord = aTexCoord;\n}";const rP=new Int8Array([-1,1,-1,-1,1,1,1,1,-1,-1,1,-1]),oP=new Uint8Array([0,1,0,0,1,1,1,1,0,0,1,0]);let sP=class Pn extends eP{constructor(e){e.vert=e.vert||iP,e.extraCommandProps=e.extraCommandProps||{},e.extraCommandProps.depth||(e.extraCommandProps.depth={enable:!1,mask:!1}),e.extraCommandProps.stencil||(e.extraCommandProps.stencil={enable:!1}),super(e)}draw(e){return this._quadMesh||this._createQuadMesh(e),super.draw(e,this._quadMesh)}getMeshCommand(e){const n=this.dkey||"";return this.commands[n+"_quad"]||(this.commands[n+"_quad"]=this.createREGLCommand(e,null,this._quadMesh[0].getElements())),this.commands[n+"_quad"]}_createQuadMesh(e){const n=new Lw({aPosition:rP,aTexCoord:oP},null,rP.length/2,{positionSize:2,primitive:"triangles"});n.generateBuffers(e),this._quadMesh=[new bC(n)]}dispose(){if(this._quadMesh){const e=this._quadMesh[0];e.geometry.dispose(),e.dispose()}return delete this._quadMesh,super.dispose()}},aP=class In extends sP{constructor(){super({vert:iP,frag:"#define SHADER_NAME FXAA\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#define FXAA_SPAN_MAX     8.0\nprecision mediump float;\nvarying vec2 vTexCoord;\nuniform float enableFXAA;\nuniform float enableToneMapping;\nuniform float enableSharpen;\nuniform vec2 resolution;\nuniform sampler2D textureSource;\n#ifdef HAS_NOAA_TEX\nuniform sampler2D noAaTextureSource;\n#endif\n#ifdef HAS_POINT_TEX\nuniform sampler2D pointTextureSource;\n#endif\n#ifdef HAS_TAA_TEX\nuniform sampler2D taaTextureSource;\n#ifdef HAS_FXAA_TEX\nuniform sampler2D fxaaTextureSource;\n#endif\n#endif\nuniform float pixelRatio;\nuniform float sharpFactor;\n#ifdef HAS_OUTLINE_TEX\nuniform sampler2D textureOutline;\nuniform float enableOutline;\nuniform float highlightFactor;\nuniform float outlineFactor;\nuniform float outlineWidth;\nuniform vec3 outlineColor;\n#endif\nvec2 c;\nvec4 d(vec2 e) {\n  \n#ifdef HAS_TAA_TEX\nvec4 f = texture2D(textureSource, e);\n  vec4 taa = texture2D(taaTextureSource, e);\n#ifdef HAS_FXAA_TEX\nvec4 h = texture2D(fxaaTextureSource, e);\n#else\nvec4 h = vec4(.0);\n#endif\nvec4 i = taa + f * (1. - taa.a);\n  return h + i * (1. - h.a);\n#else\nreturn texture2D(textureSource, e);\n#endif\n}\nvec4 j(vec2 k) {\n  vec4 l;\n  mediump vec2 m = vec2(1. / resolution.x, 1. / resolution.y);\n  vec3 n = d((k + vec2(-1., -1.)) * m).xyz;\n  vec3 o = d((k + vec2(1., -1.)) * m).xyz;\n  vec3 u = d((k + vec2(-1., 1.)) * m).xyz;\n  vec3 v = d((k + vec2(1.)) * m).xyz;\n  vec4 A = d(k * m);\n  vec3 B = A.xyz;\n  vec3 C = vec3(.299, .587, .114);\n  float D = dot(n, C);\n  float E = dot(o, C);\n  float F = dot(u, C);\n  float G = dot(v, C);\n  float H = dot(B, C);\n  float I = min(H, min(min(D, E), min(F, G)));\n  float J = max(H, max(max(D, E), max(F, G)));\n  mediump vec2 K;\n  K.x = -((D + E) - (F + G));\n  K.y = (D + F) - (E + G);\n  float L = max((D + E + F + G) * (.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n  float M = 1. / (min(abs(K.x), abs(K.y)) + L);\n  K = min(vec2(FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), K * M)) * m;\n  vec4 N = .5 * (d(k * m + K * (1. / 3. - .5)) + d(k * m + K * (2. / 3. - .5)));\n  vec4 O = N * .5 + .25 * (d(k * m + K * -.5) + d(k * m + K * .5));\n  float P = dot(O.xyz, C);\n  if(P < I || P > J)\n    l = N;\n  else\n    l = O;\n  return l;\n}\nvec3 Q(const in vec3 l, const float R) {\n  vec2 S = pixelRatio / resolution.xy;\n  float T = .0;\n  vec4 n = texture2D(textureSource, c + S * vec2(-1., -1.));\n  n.rgb = mix(vec3(.0), n.rgb, sign(n.a));\n  T += mix(.0, 1., sign(n.a));\n  vec4 v = texture2D(textureSource, c + S * vec2(1.));\n  v.rgb = mix(vec3(.0), v.rgb, sign(v.a));\n  T += mix(.0, 1., sign(v.a));\n  vec4 o = texture2D(textureSource, c + S * vec2(1., -1.));\n  o.rgb = mix(vec3(.0), o.rgb, sign(o.a));\n  T += mix(.0, 1., sign(o.a));\n  vec4 u = texture2D(textureSource, c + S * vec2(-1., 1.));\n  u.rgb = mix(vec3(.0), u.rgb, sign(u.a));\n  T += mix(.0, 1., sign(u.a));\n  return l + R * (T * l - n.rgb - o.rgb - u.rgb - v.rgb);\n}\nvec4 U(const in vec4 l) {\n  return vec4(Q(l.rgb, sharpFactor), l.a);\n}\nvec3 V(const vec3 x) {\n  const float a = 2.51;\n  const float b = .03;\n  const float W = 2.43;\n  const float X = .59;\n  const float Y = .14;\n  return (x * (a * x + b)) / (x * (W * x + X) + Y);\n}\nvec3 Z(vec3 l) {\n  l = l / (l + vec3(1.));\n  return l = pow(l, vec3(1. / 2.2));\n}\n#ifdef HAS_OUTLINE_TEX\nvec4 ba() {\n  float bb = 2.;\n  float bc = 1.;\n  float bd = pixelRatio / resolution[0] * outlineWidth;\n  float be = pixelRatio / resolution[1] * outlineWidth;\n  vec4 bf = (texture2D(textureOutline, c + vec2(bd, be)));\n  vec4 bg = (texture2D(textureOutline, c + vec2(bd, .0)));\n  vec4 bh = (texture2D(textureOutline, c + vec2(bd, -be)));\n  vec4 bi = (texture2D(textureOutline, c + vec2(.0, -be)));\n  vec4 bj = (texture2D(textureOutline, c + vec2(-bd, -be)));\n  vec4 bk = (texture2D(textureOutline, c + vec2(-bd, .0)));\n  vec4 bl = (texture2D(textureOutline, c + vec2(-bd, be)));\n  vec4 bm = (texture2D(textureOutline, c + vec2(.0, be)));\n  vec4 bn = -bb * bk + bb * bg + -bc * bl + bc * bf + -bc * bj + bc * bh;\n  vec4 bo = -bb * bi + bb * bm + -bc * bj + bc * bl + -bc * bh + bc * bf;\n  float bp = sqrt(dot(bo, bo) + dot(bn, bn));\n  bool bq = bp < 1. / 65025.;\n  vec3 br = (texture2D(textureOutline, c)).r * outlineColor;\n  if(br == vec3(.0) || (highlightFactor == .0 && bq)) {\n    return vec4(.0);\n  }\n  float bs = bq ? highlightFactor : min(1., sqrt(bp) * outlineFactor);\n  return bs * vec4(br, 1.);\n}\nvec4 bt(const in vec4 l) {\n  vec4 ba = ba();\n  return ba + vec4(l) * (1. - ba.a);\n}\n#endif\nvoid main() {\n  c = vTexCoord;\n  vec4 l;\n  if(enableFXAA == 1.) {\n    l = j(c * resolution);\n  } else {\n    l = d(vTexCoord);\n  }\n  if(enableSharpen == 1.) {\n    l = U(l);\n  }\n#if defined(HAS_NOAA_TEX) || defined(HAS_POINT_TEX)\nvec4 bu = vec4(.0);\n  vec4 bv = vec4(.0);\n#ifdef HAS_POINT_TEX\nbu = texture2D(pointTextureSource, vTexCoord);\n#endif\n#ifdef HAS_NOAA_TEX\nbv = texture2D(noAaTextureSource, vTexCoord);\n#endif\nvec4 bw = bu + bv * (1. - bu.a);\n  l = bw + l * (1. - bw.a);\n#endif\nif(enableToneMapping == 1.) {\n    l.rgb = Z(l.rgb);\n  }\n#ifdef HAS_OUTLINE_TEX\nl = bt(l);\n#endif\ngl_FragColor = l;\n}",extraCommandProps:{viewport:{x:0,y:0,width:(e,n)=>n.resolution[0],height:(e,n)=>n.resolution[1]}}})}getMeshCommand(e,n){const i=this.dkey||"";return this.commands[i+"_fxaa"]||(this.commands[i+"_fxaa"]=this.createREGLCommand(e,null,n.getElements())),this.commands[i+"_fxaa"]}},hP=class Rn extends sP{constructor(){super({vert:iP,frag:"precision mediump float;\nvarying vec2 vTexCoord;\nuniform vec2 resolution;\nuniform sampler2D textureSource;\nuniform float enableVignette;\nuniform float enableGrain;\nuniform float enableLut;\nuniform float timeGrain;\nuniform float grainFactor;\nuniform vec2 lensRadius;\nuniform float frameMod;\nuniform sampler2D lookupTable;\nfloat c(const in vec2 d) {\n  vec3 e = fract(vec3(d.xyx) * .1031);\n  e += dot(e, e.yzx + 19.19);\n  return fract((e.x + e.y) * e.z);\n}\nfloat f() {\n  float h = c(gl_FragCoord.xy + 1000.0 * fract(timeGrain));\n  float i = h * 2. - 1.;\n  h = i * inversesqrt(abs(i));\n  h = max(-1., h);\n  h = h - sign(i) + .5;\n  return (h + .5) * .5;\n}\nvec4 j(const in vec4 k) {\n  float l = f();\n  return vec4(mix(k.rgb, k.rgb * (k.rgb + (1. - k.rgb) * 2. * l), grainFactor), k.a);\n}\nfloat m(const in float k) {\n  return k < .0031308 ? k * 12.92 : 1.055 * pow(k, 1. / 2.4) - .055;\n}\nvec3 m(const in vec3 k) {\n  return vec3(k.r < .0031308 ? k.r * 12.92 : 1.055 * pow(k.r, 1. / 2.4) - .055, k.g < .0031308 ? k.g * 12.92 : 1.055 * pow(k.g, 1. / 2.4) - .055, k.b < .0031308 ? k.b * 12.92 : 1.055 * pow(k.b, 1. / 2.4) - .055);\n}\nvec4 m(const in vec4 k) {\n  return vec4(k.r < .0031308 ? k.r * 12.92 : 1.055 * pow(k.r, 1. / 2.4) - .055, k.g < .0031308 ? k.g * 12.92 : 1.055 * pow(k.g, 1. / 2.4) - .055, k.b < .0031308 ? k.b * 12.92 : 1.055 * pow(k.b, 1. / 2.4) - .055, k.a);\n}\nfloat n(const in float k) {\n  return k < .04045 ? k * (1. / 12.92) : pow((k + .055) * (1. / 1.055), 2.4);\n}\nvec3 n(const in vec3 k) {\n  return vec3(k.r < .04045 ? k.r * (1. / 12.92) : pow((k.r + .055) * (1. / 1.055), 2.4), k.g < .04045 ? k.g * (1. / 12.92) : pow((k.g + .055) * (1. / 1.055), 2.4), k.b < .04045 ? k.b * (1. / 12.92) : pow((k.b + .055) * (1. / 1.055), 2.4));\n}\nvec4 n(const in vec4 k) {\n  return vec4(k.r < .04045 ? k.r * (1. / 12.92) : pow((k.r + .055) * (1. / 1.055), 2.4), k.g < .04045 ? k.g * (1. / 12.92) : pow((k.g + .055) * (1. / 1.055), 2.4), k.b < .04045 ? k.b * (1. / 12.92) : pow((k.b + .055) * (1. / 1.055), 2.4), k.a);\n}\nfloat o(const in vec2 d, const in float u) {\n  vec3 v = vec3(.06711056, .00583715, 52.9829189);\n  return fract(v.z * fract(dot(d.xy + u * vec2(47., 17.) * .695, v.xy)));\n}\nfloat A() {\n  vec2 B = lensRadius;\n  B.y = min(B.y, B.x - 1e-4);\n  float C = o(gl_FragCoord.xy, frameMod);\n  C = (B.x - B.y) * (B.x + B.y) * .07 * (C - .5);\n  return smoothstep(B.x, B.y, C + distance(vTexCoord, vec2(.5)));\n}\nvec4 D(const in vec4 k) {\n  float l = A();\n  return vec4(m(n(k.rgb) * l), clamp(k.a + (1. - l), .0, 1.));\n}\nvec4 E(in vec4 F, in sampler2D G) {\n  mediump float H = F.b * 63.;\n  mediump vec2 I;\n  I.y = floor(floor(H) / 8.);\n  I.x = floor(H) - I.y * 8.;\n  mediump vec2 J;\n  J.y = floor(ceil(H) / 8.);\n  J.x = ceil(H) - J.y * 8.;\n  highp vec2 K;\n  K.x = I.x * .125 + .5 / 512. + (.125 - 1. / 512.) * F.r;\n  K.y = I.y * .125 + .5 / 512. + (.125 - 1. / 512.) * F.g;\n#ifdef LUT_FLIP_Y\nK.y = 1. - K.y;\n#endif\nhighp vec2 L;\n  L.x = J.x * .125 + .5 / 512. + (.125 - 1. / 512.) * F.r;\n  L.y = J.y * .125 + .5 / 512. + (.125 - 1. / 512.) * F.g;\n#ifdef LUT_FLIP_Y\nL.y = 1. - L.y;\n#endif\nlowp vec4 M = texture2D(G, K);\n  lowp vec4 N = texture2D(G, L);\n  lowp vec4 O = mix(M, N, fract(H));\n  return O;\n}\nvoid main() {\n  vec4 k = texture2D(textureSource, vTexCoord);\n  if(enableLut == 1.) {\n    k = E(k, lookupTable);\n  }\n  if(enableVignette == 1.) {\n    k = D(k);\n  }\n  if(enableGrain == 1.) {\n    k = j(k);\n  }\n  gl_FragColor = k;\n}",extraCommandProps:{viewport:{x:0,y:0,width:(e,n)=>n.resolution[0],height:(e,n)=>n.resolution[1]}}})}getMeshCommand(e,n){return this.commands.postprocess||(this.commands.postprocess=this.createREGLCommand(e,null,n.getElements())),this.commands.postprocess}};const lP=[[.263385,-.0252475],[-.38545,.054485],[-.139795,-.5379925],[-.2793775,.6875475],[.7139025,.4710925],[.90044,-.16422],[.4481775,-.82799],[-.9253375,-.2910625],[.3468025,1.02292],[-1.13742,.33522],[-.7676225,-.9123175],[-.2005775,-1.1774125],[-.926525,.96876],[1.12909,-.7500325],[.9603,1.14625]],uP=lP.length,cP=[0,0];for(let e=0;e<lP.length;e++)cP[0]+=lP[e][0],cP[1]+=lP[e][1];cP[0]/=uP,cP[1]/=uP;let AP=class Ln{constructor(e){this._frameNum=0,this._ratio=e||.05,this._avg=[cP[0]*this._ratio,cP[1]*this._ratio]}getRatio(){return this._ratio}setRatio(e){this._ratio!==e&&(this._ratio=e,this.reset()),this._avg=[cP[0]*this._ratio,cP[1]*this._ratio]}getAverage(){return this._avg}reset(){this._frameNum=0}getJitter(e){const n=this._frameNum%uP,i=this._ratio;return Zx(e,lP[n][0]*i,lP[n][1]*i),e}frame(){this._frameNum++,this._frameNum%uP==0&&(this._frameNum=0)}getSampleCount(){return uP}},fP=class kn{constructor(e,n,i=5){this._regl=e,this._renderer=new PC(e),this._inputRGBM=n,this._level=i}render(e,n){this._initShaders(),this._createTextures(e),this._blur(e,n||0);const i={blurTex0:this._blur01Tex,blurTex1:this._blur11Tex,blurTex2:this._blur21Tex,blurTex3:this._blur31Tex,blurTex4:this._blur41Tex};return this._level>5&&(i.blurTex5=this._blur51Tex,i.blurTex6=this._blur61Tex),i}_blur(e,n){let i=this._blurUniforms;i||(i=this._blurUniforms={rgbmRange:7,blurDir:[0,0],outSize:[0,0],pixelRatio:[1,1],outputSize:[0,0]}),Zx(i.outSize,e.width,e.height),this._blurOnce(this._blur0Shader,e,this._blur00FBO,this._blur01FBO,.5,n),this._blurOnce(this._blur1Shader,this._blur01FBO.color[0],this._blur10FBO,this._blur11FBO,.5),this._blurOnce(this._blur2Shader,this._blur11FBO.color[0],this._blur20FBO,this._blur21FBO,.5),this._blurOnce(this._blur3Shader,this._blur21FBO.color[0],this._blur30FBO,this._blur31FBO,.5),this._blurOnce(this._blur4Shader,this._blur31FBO.color[0],this._blur40FBO,this._blur41FBO,.5),this._level>5&&(this._blurOnce(this._blur5Shader,this._blur41FBO.color[0],this._blur50FBO,this._blur51FBO,.5),this._blurOnce(this._blur6Shader,this._blur51FBO.color[0],this._blur60FBO,this._blur51FBO,.5))}_blurOnce(e,n,i,o,s,a){const h=Math.ceil(s*n.width),l=Math.ceil(s*n.height);i.width===h&&i.height===l||i.resize(h,l),o.width===h&&o.height===l||o.resize(h,l);const c=this._blurUniforms;c.luminThreshold=a,c.TextureBlurInput=n,c.inputRGBM=+this._inputRGBM,Zx(c.blurDir,0,1),Zx(c.outputSize,i.width,i.height),this._renderer.render(e,c,null,i),c.luminThreshold=0,c.inputRGBM=1,Zx(c.blurDir,1,0),c.TextureBlurInput=i.color[0],this._renderer.render(e,c,null,o)}dispose(){this._blur0Shader&&(this._blur0Shader.dispose(),delete this._blur0Shader,this._blur1Shader.dispose(),this._blur2Shader.dispose(),this._blur3Shader.dispose(),this._blur4Shader.dispose(),this._blur5Shader&&(this._blur5Shader.dispose(),this._blur6Shader.dispose(),delete this._blur5Shader)),this._blur00Tex&&(delete this._blur00Tex,this._blur00FBO.destroy(),this._blur01FBO.destroy(),this._blur10FBO.destroy(),this._blur11FBO.destroy(),this._blur20FBO.destroy(),this._blur21FBO.destroy(),this._blur30FBO.destroy(),this._blur31FBO.destroy(),this._blur40FBO.destroy(),this._blur41FBO.destroy(),this._blur50FBO&&(this._blur50FBO.destroy(),this._blur51FBO.destroy(),this._blur60FBO.destroy(),this._blur61FBO.destroy()))}_createTextures(e){if(this._blur00Tex)return;let n=e.width,i=e.height;this._blur00Tex=this._createColorTex(e,n,i),this._blur00FBO=this._createBlurFBO(this._blur00Tex),this._blur01Tex=this._createColorTex(e),this._blur01FBO=this._createBlurFBO(this._blur01Tex),n=Math.ceil(n/2),i=Math.ceil(i/2),this._blur10Tex=this._createColorTex(e,n,i),this._blur10FBO=this._createBlurFBO(this._blur10Tex),this._blur11Tex=this._createColorTex(e,n,i),this._blur11FBO=this._createBlurFBO(this._blur11Tex),n=Math.ceil(n/2),i=Math.ceil(i/2),this._blur20Tex=this._createColorTex(e,n,i),this._blur20FBO=this._createBlurFBO(this._blur20Tex),this._blur21Tex=this._createColorTex(e,n,i),this._blur21FBO=this._createBlurFBO(this._blur21Tex),n=Math.ceil(n/2),i=Math.ceil(i/2),this._blur30Tex=this._createColorTex(e,n,i),this._blur30FBO=this._createBlurFBO(this._blur30Tex),this._blur31Tex=this._createColorTex(e,n,i),this._blur31FBO=this._createBlurFBO(this._blur31Tex),n=Math.ceil(n/2),i=Math.ceil(i/2),this._blur40Tex=this._createColorTex(e,n,i),this._blur40FBO=this._createBlurFBO(this._blur40Tex),this._blur41Tex=this._createColorTex(e,n,i),this._blur41FBO=this._createBlurFBO(this._blur41Tex),this._level>5&&(n=Math.ceil(n/2),i=Math.ceil(i/2),this._blur50Tex=this._createColorTex(e,n,i),this._blur50FBO=this._createBlurFBO(this._blur50Tex),this._blur51Tex=this._createColorTex(e,n,i),this._blur51FBO=this._createBlurFBO(this._blur51Tex),n=Math.ceil(n/2),i=Math.ceil(i/2),this._blur60Tex=this._createColorTex(e,n,i),this._blur60FBO=this._createBlurFBO(this._blur60Tex),this._blur61Tex=this._createColorTex(e,n,i),this._blur61FBO=this._createBlurFBO(this._blur61Tex))}_createColorTex(e,n,i){return this._regl.texture({min:"linear",mag:"linear",type:"uint8",width:n||e.width,height:i||e.height})}_createBlurFBO(e){return this._regl.framebuffer({width:e.width,height:e.height,colors:[e],depth:!1,stencil:!1})}_initShaders(){if(!this._blur0Shader){const e={vert:iP,extraCommandProps:{viewport:{x:0,y:0,width:(e,n)=>n.outputSize[0],height:(e,n)=>n.outputSize[1]}},frag:"#version 100\nprecision highp float;\nuniform float rgbmRange;\nuniform sampler2D TextureBlurInput;\nuniform sampler2D TextureInput;\nuniform vec2 blurDir;\nuniform vec2 pixelRatio;\nuniform vec2 outputSize;\nuniform float inputRGBM;\nuniform float luminThreshold;\n#define SHADER_NAME GAUSSIAN_BLUR0\nconst vec3 c = vec3(.2126, .7152, .0722);\nfloat d(const in vec3 e) {\n  return dot(e, c);\n}\nvec4 f(vec4 e) {\n  float h = max(sign(d(e.rgb) - luminThreshold), .0);\n  return e * h;\n}\nvec2 i;\nvec4 j(const in vec3 e, const in float k) {\n  vec4 l;\n  vec3 m = e / k;\n  l.a = clamp(max(max(m.r, m.g), max(m.b, 1e-6)), .0, 1.);\n  l.a = ceil(l.a * 255.) / 255.;\n  l.rgb = m / l.a;\n  return l;\n}\nvec3 n(const in vec4 e, const in float k) {\n  if(inputRGBM == .0)\n    return e.rgb;\n  return k * e.rgb * e.a;\n}\nvec4 o() {\n  vec3 u = .375 * (f(vec4(n(texture2D(TextureBlurInput, i.xy), rgbmRange), 1.))).rgb;\n  vec2 v;\n  vec2 A = pixelRatio.xy * blurDir.xy / outputSize.xy;\n  v = A * 1.2;\n  u += .3125 * (f(vec4(n(texture2D(TextureBlurInput, i.xy + v.xy), rgbmRange), 1.))).rgb;\n  u += .3125 * (f(vec4(n(texture2D(TextureBlurInput, i.xy - v.xy), rgbmRange), 1.))).rgb;\n  return vec4(u, 1.);\n}\nvoid main(void) {\n  i = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = o();\n  e = j(e.rgb, rgbmRange);\n  gl_FragColor = e;\n}"};this._blur0Shader=new sP(e),e.frag="#version 100\nprecision highp float;\nuniform float rgbmRange;\nuniform sampler2D TextureBlurInput;\nuniform sampler2D TextureInput;\nuniform vec2 blurDir;\nuniform vec2 pixelRatio;\nuniform vec2 outputSize;\n#define SHADER_NAME GAUSSIAN_BLUR1\nvec2 c;\nvec4 d(const in vec3 e, const in float f) {\n  if(f <= .0)\n    return vec4(e, 1.);\n  vec4 h;\n  vec3 i = e / f;\n  h.a = clamp(max(max(i.r, i.g), max(i.b, 1e-6)), .0, 1.);\n  h.a = ceil(h.a * 255.) / 255.;\n  h.rgb = i / h.a;\n  return h;\n}\nvec3 j(const in vec4 e, const in float f) {\n  if(f <= .0)\n    return e.rgb;\n  return f * e.rgb * e.a;\n}\nvec4 k() {\n  vec3 l = .3125 * (vec4(j(texture2D(TextureBlurInput, c.xy), rgbmRange), 1.)).rgb;\n  vec2 m;\n  vec2 n = pixelRatio.xy * blurDir.xy / outputSize.xy;\n  m = n * 1.2857142857142858;\n  l += .328125 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .328125 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  return vec4(l, 1.);\n}\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = k();\n  e = d(e.rgb, rgbmRange);\n  gl_FragColor = e;\n}",this._blur1Shader=new sP(e),e.frag="#version 100\nprecision highp float;\nuniform float rgbmRange;\nuniform sampler2D TextureBlurInput;\nuniform sampler2D TextureInput;\nuniform vec2 blurDir;\nuniform vec2 pixelRatio;\nuniform vec2 outputSize;\n#define SHADER_NAME GAUSSIAN_BLUR2\nvec2 c;\nvec4 d(const in vec3 e, const in float f) {\n  if(f <= .0)\n    return vec4(e, 1.);\n  vec4 h;\n  vec3 i = e / f;\n  h.a = clamp(max(max(i.r, i.g), max(i.b, 1e-6)), .0, 1.);\n  h.a = ceil(h.a * 255.) / 255.;\n  h.rgb = i / h.a;\n  return h;\n}\nvec3 j(const in vec4 e, const in float f) {\n  if(f <= .0)\n    return e.rgb;\n  return f * e.rgb * e.a;\n}\nvec4 k() {\n  vec3 l = .2734375 * (vec4(j(texture2D(TextureBlurInput, c.xy), rgbmRange), 1.)).rgb;\n  vec2 m;\n  vec2 n = pixelRatio.xy * blurDir.xy / outputSize.xy;\n  m = n * 1.3333333333333333;\n  l += .328125 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .328125 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 3.111111111111111;\n  l += .03515625 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .03515625 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  return vec4(l, 1.);\n}\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = k();\n  e = d(e.rgb, rgbmRange);\n  gl_FragColor = e;\n}",this._blur2Shader=new sP(e),e.frag="#version 100\nprecision highp float;\nuniform float rgbmRange;\nuniform sampler2D TextureBlurInput;\nuniform sampler2D TextureInput;\nuniform vec2 blurDir;\nuniform vec2 pixelRatio;\nuniform vec2 outputSize;\n#define SHADER_NAME GAUSSIAN_BLUR3\nvec2 c;\nvec4 d(const in vec3 e, const in float f) {\n  if(f <= .0)\n    return vec4(e, 1.);\n  vec4 h;\n  vec3 i = e / f;\n  h.a = clamp(max(max(i.r, i.g), max(i.b, 1e-6)), .0, 1.);\n  h.a = ceil(h.a * 255.) / 255.;\n  h.rgb = i / h.a;\n  return h;\n}\nvec3 j(const in vec4 e, const in float f) {\n  if(f <= .0)\n    return e.rgb;\n  return f * e.rgb * e.a;\n}\nvec4 k() {\n  vec3 l = .24609375 * (vec4(j(texture2D(TextureBlurInput, c.xy), rgbmRange), 1.)).rgb;\n  vec2 m;\n  vec2 n = pixelRatio.xy * blurDir.xy / outputSize.xy;\n  m = n * 1.3636363636363635;\n  l += .322265625 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .322265625 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 3.1818181818181817;\n  l += .0537109375 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .0537109375 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  return vec4(l, 1.);\n}\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = k();\n  e = d(e.rgb, rgbmRange);\n  gl_FragColor = e;\n}",this._blur3Shader=new sP(e),e.frag="#version 100\nprecision highp float;\nuniform float rgbmRange;\nuniform sampler2D TextureBlurInput;\nuniform sampler2D TextureInput;\nuniform vec2 blurDir;\nuniform vec2 pixelRatio;\nuniform vec2 outputSize;\n#define SHADER_NAME GAUSSIAN_BLUR4\nvec2 c;\nvec4 d(const in vec3 e, const in float f) {\n  if(f <= .0)\n    return vec4(e, 1.);\n  vec4 h;\n  vec3 i = e / f;\n  h.a = clamp(max(max(i.r, i.g), max(i.b, 1e-6)), .0, 1.);\n  h.a = ceil(h.a * 255.) / 255.;\n  h.rgb = i / h.a;\n  return h;\n}\nvec3 j(const in vec4 e, const in float f) {\n  if(f <= .0)\n    return e.rgb;\n  return f * e.rgb * e.a;\n}\nvec4 k() {\n  vec3 l = .2255859375 * (vec4(j(texture2D(TextureBlurInput, c.xy), rgbmRange), 1.)).rgb;\n  vec2 m;\n  vec2 n = pixelRatio.xy * blurDir.xy / outputSize.xy;\n  m = n * 1.3846153846153846;\n  l += .314208984375 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .314208984375 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 3.230769230769231;\n  l += .06982421875 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .06982421875 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 5.076923076923077;\n  l += .003173828125 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .003173828125 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  return vec4(l, 1.);\n}\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = k();\n  e = d(e.rgb, rgbmRange);\n  gl_FragColor = e;\n}",this._blur4Shader=new sP(e),this._level>5&&(e.frag="precision highp float;\nuniform float rgbmRange;\nuniform sampler2D TextureBlurInput;\nuniform sampler2D TextureInput;\nuniform vec2 blurDir;\nuniform vec2 outSize;\nuniform vec2 pixelRatio;\nuniform vec2 outputSize;\n#define SHADER_NAME GAUSSIAN_BLUR5\nvec2 c;\nvec4 d(const in vec3 e, const in float f) {\n  if(f <= .0)\n    return vec4(e, 1.);\n  vec4 h;\n  vec3 i = e / f;\n  h.a = clamp(max(max(i.r, i.g), max(i.b, 1e-6)), .0, 1.);\n  h.a = ceil(h.a * 255.) / 255.;\n  h.rgb = i / h.a;\n  return h;\n}\nvec3 j(const in vec4 e, const in float f) {\n  if(f <= .0)\n    return e.rgb;\n  return f * e.rgb * e.a;\n}\nvec4 k() {\n  vec3 l = .20947265625 * (vec4(j(texture2D(TextureBlurInput, c.xy), rgbmRange), 1.)).rgb;\n  vec2 m;\n  vec2 n = pixelRatio.xy * blurDir.xy / outputSize.xy;\n  n *= outSize.y * .00075;\n  m = n * 1.4;\n  l += .30548095703125 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .30548095703125 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 3.2666666666666666;\n  l += .08331298828125 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .08331298828125 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 5.133333333333334;\n  l += .00640869140625 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .00640869140625 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  return vec4(l, 1.);\n}\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = k();\n  e = d(e.rgb, rgbmRange);\n  gl_FragColor = e;\n}",this._blur5Shader=new sP(e),e.frag="#version 100\nprecision highp float;\nuniform float rgbmRange;\nuniform sampler2D TextureBlurInput;\nuniform sampler2D TextureInput;\nuniform vec2 blurDir;\nuniform vec2 outSize;\nuniform vec2 pixelRatio;\nuniform vec2 outputSize;\n#define SHADER_NAME GAUSSIAN_BLUR6\nvec2 c;\nvec4 d(const in vec3 e, const in float f) {\n  if(f <= .0)\n    return vec4(e, 1.);\n  vec4 h;\n  vec3 i = e / f;\n  h.a = clamp(max(max(i.r, i.g), max(i.b, 1e-6)), .0, 1.);\n  h.a = ceil(h.a * 255.) / 255.;\n  h.rgb = i / h.a;\n  return h;\n}\nvec3 j(const in vec4 e, const in float f) {\n  if(f <= .0)\n    return e.rgb;\n  return f * e.rgb * e.a;\n}\nvec4 k() {\n  vec3 l = .196380615234375 * (vec4(j(texture2D(TextureBlurInput, c.xy), rgbmRange), 1.)).rgb;\n  vec2 m;\n  vec2 n = pixelRatio.xy * blurDir.xy / outputSize.xy;\n  n *= outSize.y * .00075;\n  m = n * 1.411764705882353;\n  l += .2967529296875 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .2967529296875 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 3.2941176470588234;\n  l += .09442138671875 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .09442138671875 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 5.176470588235294;\n  l += .0103759765625 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .0103759765625 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  return vec4(l, 1.);\n}\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = k();\n  e = d(e.rgb, rgbmRange);\n  gl_FragColor = e;\n}",this._blur6Shader=new sP(e))}}},dP=class zn{constructor(e){this._regl=e,this._renderer=new PC(e)}render(e,n,i,o,s,a,h,l,c){this._initShaders(),this._createTextures(e);const A=this._blurPass.render(n,i);return this._combine(e,A,n,o,s,a,h,l,c)}_combine(e,n,i,o,s,a,h,l,c){c||this._combineTex.width===e.width&&this._combineTex.height===e.height||this._combineFBO.resize(e.width,e.height);let A=this._combineUniforms;const{blurTex0:f,blurTex1:d,blurTex2:p,blurTex3:g,blurTex4:v}=n;A||(A=this._combineUniforms={bloomFactor:0,bloomRadius:0,rgbmRange:7,TextureBloomBlur1:f,TextureBloomBlur2:d,TextureBloomBlur3:p,TextureBloomBlur4:g,TextureBloomBlur5:v,TextureInput:null,TextureSource:null,outputSize:[0,0]}),A.noAaTextureSource=a,A.pointTextureSource=h,A.enableAA=l,A.bloomFactor=o,A.bloomRadius=s,A.TextureInput=i,A.TextureSource=e,Zx(A.outputSize,e.width,e.height);const w={};return a?w.HAS_NOAA_TEX=1:delete w.HAS_NOAA_TEX,h?w.HAS_POINT_TEX=1:delete w.HAS_POINT_TEX,this._combineShader.setDefines(w),this._renderer.render(this._combineShader,A,null,c?null:this._combineFBO),c?null:this._combineTex}dispose(){this._combineFBO&&(this._combineFBO.destroy(),delete this._combineFBO),this._blurPass&&(this._blurPass.dispose(),delete this._blurPass),delete this._uniforms}_createTextures(e){this._combineTex||(this._combineTex=this._createColorTex(e,e.width,e.height,"uint8"),this._combineFBO=this._createBlurFBO(this._combineTex))}_createColorTex(e,n,i,o){return this._renderer.regl.texture({min:"linear",mag:"linear",type:o,width:n||e.width,height:i||e.height})}_createBlurFBO(e){return this._renderer.regl.framebuffer({width:e.width,height:e.height,colors:[e],depth:!1,stencil:!1})}_initShaders(){if(!this._combineShader){const e={x:0,y:0,width:(e,n)=>n.outputSize[0],height:(e,n)=>n.outputSize[1]};this._blurPass=new fP(this._regl,!1),this._combineShader=new sP({vert:iP,frag:"#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#define FXAA_SPAN_MAX     8.0\nprecision highp float;\nuniform float bloomFactor;\nuniform float bloomRadius;\nuniform float rgbmRange;\nuniform sampler2D TextureBloomBlur1;\nuniform sampler2D TextureBloomBlur2;\nuniform sampler2D TextureBloomBlur3;\nuniform sampler2D TextureBloomBlur4;\nuniform sampler2D TextureBloomBlur5;\nuniform sampler2D TextureInput;\nuniform sampler2D TextureSource;\n#ifdef HAS_NOAA_TEX\nuniform sampler2D noAaTextureSource;\n#endif\n#ifdef HAS_POINT_TEX\nuniform sampler2D pointTextureSource;\n#endif\nuniform float enableAA;\nuniform vec2 outputSize;\n#define SHADER_NAME bloomCombine\nvec2 c;\nvec3 d(const in vec3 e) {\n  return vec3(e.r < .0031308 ? e.r * 12.92 : 1.055 * pow(e.r, 1. / 2.4) - .055, e.g < .0031308 ? e.g * 12.92 : 1.055 * pow(e.g, 1. / 2.4) - .055, e.b < .0031308 ? e.b * 12.92 : 1.055 * pow(e.b, 1. / 2.4) - .055);\n}\nvec3 f(const in vec4 e, const in float h) {\n  if(h <= .0)\n    return e.rgb;\n  return h * e.rgb * e.a;\n}\nfloat i(const float j, const float k) {\n  return mix(j, k * 2. - j, bloomRadius);\n}\nvec4 l(sampler2D m, vec2 n) {\n  vec4 e;\n  mediump vec2 o = vec2(1. / outputSize.x, 1. / outputSize.y);\n  vec3 u = texture2D(m, (n + vec2(-1., -1.)) * o).xyz;\n  vec3 v = texture2D(m, (n + vec2(1., -1.)) * o).xyz;\n  vec3 A = texture2D(m, (n + vec2(-1., 1.)) * o).xyz;\n  vec3 B = texture2D(m, (n + vec2(1.)) * o).xyz;\n  vec4 C = texture2D(m, n * o);\n  vec3 D = C.xyz;\n  vec3 E = vec3(.299, .587, .114);\n  float F = dot(u, E);\n  float G = dot(v, E);\n  float H = dot(A, E);\n  float I = dot(B, E);\n  float J = dot(D, E);\n  float K = min(J, min(min(F, G), min(H, I)));\n  float L = max(J, max(max(F, G), max(H, I)));\n  mediump vec2 M;\n  M.x = -((F + G) - (H + I));\n  M.y = (F + H) - (G + I);\n  float N = max((F + G + H + I) * (.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n  float O = 1. / (min(abs(M.x), abs(M.y)) + N);\n  M = min(vec2(FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), M * O)) * o;\n  vec4 P = .5 * (texture2D(m, n * o + M * (1. / 3. - .5)) + texture2D(m, n * o + M * (2. / 3. - .5)));\n  vec4 Q = P * .5 + .25 * (texture2D(m, n * o + M * -.5) + texture2D(m, n * o + M * .5));\n  float R = dot(Q.xyz, E);\n  if(R < K || R > L)\n    e = P;\n  else\n    e = Q;\n  return e;\n}\nvec4 S() {\n  vec3 T = vec3(.0);\n  const float U = .6;\n  const float V = 1.1;\n  const float W = .9;\n  const float X = .6;\n  const float Y = .3;\n  const float Z = .1;\n  T += (vec4(f(texture2D(TextureBloomBlur1, c), rgbmRange), 1.)).rgb * i(V, U);\n  T += (vec4(f(texture2D(TextureBloomBlur2, c), rgbmRange), 1.)).rgb * i(W, U);\n  T += (vec4(f(texture2D(TextureBloomBlur3, c), rgbmRange), 1.)).rgb * i(X, U);\n  T += (vec4(f(texture2D(TextureBloomBlur4, c), rgbmRange), 1.)).rgb * i(Y, U);\n  T += (vec4(f(texture2D(TextureBloomBlur5, c), rgbmRange), 1.)).rgb * i(Z, U);\n  vec4 ba;\n  if(enableAA == 1.) {\n    ba = l(TextureInput, gl_FragCoord.xy);\n  } else {\n    ba = texture2D(TextureInput, c);\n  }\n  ba.rgb = mix(vec3(.0), ba.rgb, sign(ba.a));\n  vec4 bb = texture2D(TextureSource, c);\n#ifdef HAS_NOAA_TEX\nvec4 bc = texture2D(noAaTextureSource, c);\n  bb = bc + bb * (1. - bc.a);\n#endif\nvec4 bd = vec4(.0);\n#ifdef HAS_POINT_TEX\nbd = texture2D(pointTextureSource, c);\n#endif\nfloat be = sqrt((T.r + T.g + T.b) / 3.);\n  vec4 bf = vec4(d(T * bloomFactor), be);\n  return bd + (ba + bb * (1. - ba.a)) * (1. - bd.a) + bf;\n}\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = S();\n  gl_FragColor = e;\n}",extraCommandProps:{viewport:e}})}}},pP=class Bn extends sP{constructor(){const e=[];super({vert:iP,frag:"precision highp float;\n#include <gl2_frag>\n#define SHADER_NAME COPY_DEPTH\nuniform sampler2D TextureDepth;\nuniform vec2 textureSize;\n#include <common_pack_float>\nvoid main(void) {\n  vec2 c = gl_FragCoord.xy / textureSize.xy;\n  float d = texture2D(TextureDepth, c).r;\n  glFragColor = common_encodeDepth(d);\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:[{name:"textureSize",type:"function",fn:(n,i)=>(e[0]=i.TextureDepth.width,e[1]=i.TextureDepth.height,e)}],extraCommandProps:{viewport:{x:0,y:0,width:(e,n)=>n.TextureDepth.width,height:(e,n)=>n.TextureDepth.height}}}),this.version=300}getMeshCommand(e,n){return this.commands.copy_depth||(this.commands.copy_depth=this.createREGLCommand(e,null,n.getElements())),this.commands.copy_depth}},gP=class Un{static getUniformDeclares(){const e=[[0,0,0,0],[0,0,0,0]],n=new Array(16);return[{name:"invProjMatrix",type:"function",fn:(e,i)=>wv(n,i.projMatrix)},{name:"outputFovInfo",type:"array",length:2,fn:function(n,i){const o=Math.tan(.5*i.fov),s=i.outSize[0]/i.outSize[1]*o;return E_(e[0],s,o,s,-o),E_(e[1],-s,o,-s,-o),e}},{name:"reprojViewProjMatrix",type:"function",fn:(e,n)=>Cv([],n.prevProjViewMatrix,n.cameraWorldMatrix)}]}static getDefines(){return{HAS_SSR:1}}constructor(e){this._regl=e,this._renderer=new PC(e),this._inputRGBM=0}setup(e){this._initShaders(),this._createTextures(e)}getSSRUniforms(e,n,i){if(!this._depthCopy)return null;const o=this._depthCopy;return{TextureDepth:o,TextureReflected:this.getMipmapTexture(),ssrFactor:n||1,ssrQuality:i||2,outSize:[o.width,o.height],fov:e.getFov()*Math.PI/180,prevProjViewMatrix:this._projViewMatrix||e.projViewMatrix,cameraWorldMatrix:e.cameraWorldMatrix}}genMipMap(e,n,i){return this.setup(e),this._mipmap(e),this.copyDepthTex(n),this._projViewMatrix||(this._projViewMatrix=[]),_v(this._projViewMatrix,i),delete this._depthCopied,this._outputTex}getPrevProjViewMatrix(){return this._projViewMatrix}copyDepthTex(e){return this._depthCopied?null:(this.setup(e),this._depthCopy?e.width===this._depthCopy.width&&e.height===this._depthCopy.height||this._depthCopyFBO.resize(e.width,e.height):(this._depthCopy=this._regl.texture({min:"nearest",mag:"nearest",mipmap:!1,type:"uint8",width:e.width,height:e.height}),this._depthCopyFBO=this._regl.framebuffer({width:e.width,height:e.height,colors:[this._depthCopy],colorFormat:"rgba"})),this._renderer.render(this._copyDepthShader,{TextureDepth:e},null,this._depthCopyFBO),this._depthCopied=!0,this._depthCopy)}_mipmap(e){const n=this._targetFBO,i=Math.ceil(.5*e.width),o=Math.ceil(.5*e.height);n.width===i&&n.height===o||n.resize(i,o);let s=this._blurUniforms;s||(s=this._blurUniforms={rgbmRange:7,outputSize:[0,0]}),s.TextureInput=e,s.inputRGBM=+this._inputRGBM,Zx(s.outputSize,n.width,n.height),this._renderer.render(this._ssrQuadShader,s,null,n)}getMipmapTexture(){return this._outputTex||(this._outputTex=this._renderer.regl.texture({type:"uint8",width:2,height:2})),this._outputTex}dispose(){this._copyDepthShader&&(this._ssrQuadShader.dispose(),this._copyDepthShader.dispose(),this._targetFBO.destroy(),delete this._copyDepthShader),this._depthCopy&&(this._depthCopyFBO.destroy(),delete this._depthCopy,delete this._depthCopyFBO)}_initShaders(){this._copyDepthShader||(this._copyDepthShader=new pP,this._ssrQuadShader=new sP({vert:iP,frag:"#version 100\nprecision mediump float;\nuniform sampler2D TextureInput;\nuniform vec2 outputSize;\n#define SHADER_NAME QUAD\nvec2 c;\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 d = texture2D(TextureInput, c.xy);\n  gl_FragColor = d;\n}",extraCommandProps:{viewport:{x:0,y:0,width:(e,n)=>n.outputSize[0],height:(e,n)=>n.outputSize[1]}}}))}_createTextures(e){if(!this._targetFBO){const n=this._regl;this._outputTex&&this._outputTex.destroy(),this._outputTex=n.texture({min:"linear",mag:"linear",type:"uint8",width:e.width,height:e.height}),this._targetFBO=n.framebuffer({width:e.width,height:e.height,colors:[this._outputTex],depth:!1,stencil:!1})}}},mP=class Gn extends eP{constructor(e){const n=[];super({vert:"#define SHADER_NAME HEATMAP\nuniform mat4 projViewModelMatrix;\nuniform float extrudeScale;\nuniform float heatmapIntensity;\nattribute vec3 aPosition;\nvarying vec2 vExtrude;\n#ifdef HAS_HEAT_WEIGHT\nattribute highp float aWeight;\nvarying highp float weight;\n#else\nuniform highp float heatmapWeight;\n#endif\nuniform mediump float heatmapRadius;\nconst highp float c = 1. / 255. / 16.;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n  \n#ifdef HAS_HEAT_WEIGHT\nhighp float d = aWeight / 255.;\n  weight = d;\n#else\nhighp float d = heatmapWeight;\n#endif\nmediump float e = heatmapRadius;\n  vec2 f = vec2(mod(aPosition.xy, 2.) * 2. - 1.);\n  float h = sqrt(-2. * log(c / d / heatmapIntensity / GAUSS_COEF)) / 3.;\n  vExtrude = h * f;\n  vec2 i = vExtrude * e * extrudeScale;\n  vec4 j = vec4(floor(aPosition.xy * .5) + i, aPosition.z, 1);\n  gl_Position = projViewModelMatrix * j;\n}",frag:"#define SHADER_NAME HEATMAP\nprecision mediump float;\nuniform highp float heatmapIntensity;\nvarying vec2 vExtrude;\n#ifdef HAS_HEAT_WEIGHT\nvarying highp float weight;\n#else\nuniform highp float heatmapWeight;\n#endif\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n  \n#ifdef HAS_HEAT_WEIGHT\nhighp float c = weight;\n#else\nhighp float c = heatmapWeight;\n#endif\nfloat d = -.5 * 3. * 3. * dot(vExtrude, vExtrude);\n  float e = c * heatmapIntensity * GAUSS_COEF * exp(d);\n  gl_FragColor = vec4(e, 1., 1., 1.);\n}",uniforms:[{name:"extrudeScale",type:"function",fn:function(e,n){return n.resolution/n.dataResolution*n.tileRatio}},{name:"projViewModelMatrix",type:"function",fn:function(e,i){return Cv(n,i.projViewMatrix,i.modelMatrix)}}],extraCommandProps:$b({},e&&e.extraCommandProps||{},{blend:{enable:!0,func:{src:"one",dst:"one"},equation:"add"}})})}};var yP=[-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,-1,1,-1,1,1,1,1,1,1,1,1,1,-1,1,-1,-1,-1,-1,1,-1,1,1,1,1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,1,-1,1,1,1,1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,1,-1,1],vP="#define SHADER_NAME SKYBOX\n#if __VERSION__ == 100\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod : enable\n#define textureCubeLod(tex, uv, lod) textureCubeLodEXT(tex, uv, lod)\n#else\n#define textureCubeLod(tex, uv, lod) textureCube(tex, uv, lod)\n#endif\n#else\n#define textureCubeLod(tex, uv, lod) textureLod(tex, uv, lod)\n#endif\nprecision highp float;\n#define saturate(x)        clamp(x, 0.0, 1.0)\n#include <gl2_frag>\n#include <hsv_frag>\nuniform vec3 hsv;\nvarying vec3 vWorldPos;\n#ifdef USE_AMBIENT\nuniform vec3 diffuseSPH[9];\n#else\nuniform samplerCube cubeMap;\nuniform float bias;\nuniform float size;\n#endif\nuniform float environmentExposure;\nuniform float backgroundIntensity;\nvec4 c(const in samplerCube d, const in vec3 e, const in float f, const in float h) {\n  vec3 i = e;\n  return textureCubeLod(d, i, h);\n}\nvec3 j(const in vec3 k, const in vec3 l[9]) {\n  float x = k.x;\n  float y = k.y;\n  float z = k.z;\n  vec3 m = (l[0] + l[1] * x + l[2] * y + l[3] * z + l[4] * z * x + l[5] * y * z + l[6] * y * x + l[7] * (3. * z * z - 1.) + l[8] * (x * x - y * y));\n  return max(m, vec3(.0));\n}\nfloat n(const in vec2 o) {\n  vec3 u = fract(vec3(o.xyx) * .1031);\n  u += dot(u, u.yzx + 19.19);\n  return fract((u.x + u.y) * u.z);\n}\n#if defined(TONE_MAPPING)\nconst float v = 1.;\nvec3 A(vec3 B) {\n  vec3 a = B * (B + .0245786) - .000090537;\n  vec3 b = B * (.983729 * B + .4329510) + .238081;\n  return a / b;\n}\nvec3 C(vec3 D) {\n  const mat3 E = mat3(vec3(.59719, .07600, .02840), vec3(.35458, .90834, .13383), vec3(.04823, .01566, .83777));\n  const mat3 F = mat3(vec3(1.60475, -.10208, -.00327), vec3(-.53108, 1.10813, -.07276), vec3(-.07367, -.00605, 1.07602));\n  D *= v / .6;\n  D = E * D;\n  D = A(D);\n  D = F * D;\n  return saturate(D);\n}\nvec3 G(vec3 D) {\n  return C(D);\n}\nvec4 H(in vec4 I) {\n  return vec4(mix(pow(I.rgb, vec3(.41666)) * 1.055 - vec3(.055), I.rgb * 12.92, vec3(lessThanEqual(I.rgb, vec3(.0031308)))), I.a);\n}\nvec4 J(vec4 I) {\n  return (H(I));\n}\n#endif\nvoid main() {\n  vec4 K;\n#ifdef USE_AMBIENT\nvec3 k = normalize(vWorldPos + mix(-.5 / 255., .5 / 255., n(gl_FragCoord.xy)) * 2.);\n  K = vec4(j(k, diffuseSPH), 1.);\n#else\nK = c(cubeMap, vWorldPos, size, bias);\n#endif\nK.rgb *= environmentExposure;\n  K.rgb *= backgroundIntensity;\n  glFragColor = K;\n  if(length(hsv) > .0) {\n    glFragColor.rgb = hsv_apply(clamp(glFragColor.rgb, .0, 1.), hsv);\n  }\n#if defined(TONE_MAPPING)\nglFragColor.rgb = G(glFragColor.rgb);\n  glFragColor = J(glFragColor);\n#endif\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}";let _P=class Xn extends eP{constructor(){super({vert:"#include <gl2_vert>\nattribute vec3 aPosition;\nuniform mat4 projMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 transformMatrix;\nvarying vec3 vWorldPos;\nvoid main() {\n  vWorldPos = aPosition;\n  mat4 c = mat4(mat3(viewMatrix) * transformMatrix);\n  vec4 d = projMatrix * c * vec4(vWorldPos, 1.);\n  gl_Position = d.xyww;\n}",frag:vP,extraCommandProps:{depth:{enable:!0,range:[1,1],func:"lequal"},viewport:{x:0,y:0,width:(e,n)=>n.resolution[0],height:(e,n)=>n.resolution[1]}}}),this.version=300}setMode(e,n){const i={};return e&&(i.TONE_MAPPING=1),0===n&&(i.USE_AMBIENT=1),this._skyboxMesh?this._skyboxMesh[0].setDefines(i):this._meshDefines=i,this}draw(e){return this._skyboxMesh||this._createSkyboxMesh(e),super.draw(e,this._skyboxMesh)}_createSkyboxMesh(e){const n=new Lw({aPosition:new Int8Array(yP)},null,yP.length/3);n.generateBuffers(e),this._skyboxMesh=[new bC(n)],this._meshDefines&&(this._skyboxMesh[0].setDefines(this._meshDefines),delete this._meshDefines)}dispose(){if(this._skyboxMesh){const e=this._skyboxMesh[0];e.geometry.dispose(),e.dispose()}return delete this._skyboxMesh,super.dispose()}},xP=class Wn extends eP{constructor(e,n){const i={blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"},viewport:e};n&&n.extraCommandProps&&$b(i,n.extraCommandProps);const o=[];super({vert:"#define SHADER_NAME HEATMAP_DISPLAY\nuniform mat4 projViewModelMatrix;\nattribute vec3 aPosition;\nvoid main() {\n  gl_Position = projViewModelMatrix * vec4(aPosition, 1.);\n}",frag:"#define SHADER_NAME HEATMAP_DISPLAY\nprecision mediump float;\nuniform sampler2D inputTexture;\nuniform sampler2D colorRamp;\nuniform vec2 textureOutputSize;\nuniform float heatmapOpacity;\nvoid main() {\n  vec2 c = gl_FragCoord.xy / textureOutputSize.xy;\n  float t = texture2D(inputTexture, c).r;\n  vec4 d = texture2D(colorRamp, vec2(t, .5));\n  gl_FragColor = d * heatmapOpacity;\n}",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(e,n){return Cv(o,n.projViewMatrix,n.modelMatrix)}}],extraCommandProps:i})}},bP=class Kn extends sP{constructor(){super({vert:iP,frag:"precision highp float;\nuniform sampler2D texture;\nuniform vec2 size;\nuniform float enableSharpen;\nuniform float sharpFactor;\nuniform float pixelRatio;\nvec2 c;\nvec3 d(const in vec3 e, const float f) {\n  vec2 h = pixelRatio / size.xy;\n  float i = .0;\n  vec4 j = texture2D(texture, c + h * vec2(-1., -1.));\n  j.rgb = mix(vec3(.0), j.rgb, sign(j.a));\n  i += mix(.0, 1., sign(j.a));\n  vec4 k = texture2D(texture, c + h * vec2(1.));\n  k.rgb = mix(vec3(.0), k.rgb, sign(k.a));\n  i += mix(.0, 1., sign(k.a));\n  vec4 l = texture2D(texture, c + h * vec2(1., -1.));\n  l.rgb = mix(vec3(.0), l.rgb, sign(l.a));\n  i += mix(.0, 1., sign(l.a));\n  vec4 m = texture2D(texture, c + h * vec2(-1., 1.));\n  m.rgb = mix(vec3(.0), m.rgb, sign(m.a));\n  i += mix(.0, 1., sign(m.a));\n  return e + f * (i * e - j.rgb - l.rgb - m.rgb - k.rgb);\n}\nvoid main() {\n  c = gl_FragCoord.xy / size;\n  vec4 e = texture2D(texture, c);\n  if(enableSharpen == 1.) {\n    e.rgb = d(e.rgb, sharpFactor);\n  }\n  gl_FragColor = e;\n}",extraCommandProps:{viewport:{x:0,y:0,width:(e,n)=>n.size[0],height:(e,n)=>n.size[1]}}})}getMeshCommand(e,n){return this.commands.copy||(this.commands.copy=this.createREGLCommand(e,null,n.getElements())),this.commands.copy}},wP=class Jn extends eP{constructor(e={}){const n=[],i=e.uniforms,o=[{name:"modelViewMatrix",type:"function",fn:function(e,i){return Cv(n,i.viewMatrix,i.modelMatrix)}}];i&&o.push(...i),super({vert:"attribute vec3 aPosition;\nuniform mat4 projMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 positionMatrix;\nuniform mat4 modelViewMatrix;\n#include <get_output>\nvoid main() {\n  vec4 c = getPosition(aPosition);\n  mat4 d = getPositionMatrix();\n  gl_Position = projMatrix * modelViewMatrix * d * c;\n}",frag:"precision mediump float;\nuniform vec4 lineColor;\nuniform float lineOpacity;\nvoid main() {\n  gl_FragColor = lineColor;\n  gl_FragColor.a *= lineOpacity;\n}",uniforms:o,defines:e.defines||{},extraCommandProps:e.extraCommandProps||{}})}};const CP=[],PP=[];const MP=[];let TP=class et{constructor(e,n,i){this._regl=e,this._layer=i,this._viewport=n,this._init()}_init(){this._shader=new eP({vert:"attribute vec3 aPosition;\nuniform mat4 projMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 positionMatrix;\nvarying vec4 vWorldPosition;\n#include <get_output>\nvoid main() {\n  vec4 c = getPosition(aPosition);\n  mat4 d = getPositionMatrix();\n  vec4 e = modelMatrix * d * c;\n  gl_Position = projMatrix * modelViewMatrix * d * c;\n  vWorldPosition = e;\n}",frag:"precision mediump float;\nvarying vec4 vWorldPosition;\nuniform vec2 fogDist;\nuniform vec3 cameraPosition;\nuniform float rainDepth;\nvoid main() {\n  vec3 c = vec3(vWorldPosition[0] - cameraPosition[0], vWorldPosition[1] - cameraPosition[1], vWorldPosition[2] - cameraPosition[2]);\n  float d = length(c);\n  float e = clamp(1. - (d - fogDist.x) / (fogDist.y - fogDist.x), .0, 1.);\n  if(vWorldPosition[2] < rainDepth) {\n    gl_FragColor = vec4(e, .0, .0, 1.);\n  } else {\n    gl_FragColor = vec4(e, 1., .0, 1.);\n  }\n}",uniforms:[{name:"modelViewMatrix",type:"function",fn:function(e,n){return Cv(MP,n.viewMatrix,n.modelMatrix)}}],extraCommandProps:{viewport:this._viewport}});const e=this._layer.getRenderer().createFBOInfo();this._fbo=this._regl.framebuffer(e),this._scene=new kC,this.renderer=new PC(this._regl)}render(e,n){return this._resize(),this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this._fbo}),this._scene.setMeshes(e),this.renderer.render(this._shader,{projMatrix:n.projMatrix,viewMatrix:n.viewMatrix,cameraPosition:n.cameraPosition,fogDist:n.fogDist,rainDepth:n.rainDepth},this._scene,this._fbo),this._fbo}dispose(){this._fbo&&this._fbo.destroy(),this._shader&&this._shader.dispose()}_resize(){const e=Kb(this._viewport.width.data)?this._viewport.width.data():this._viewport.width,n=Kb(this._viewport.height.data)?this._viewport.height.data():this._viewport.height;!this._fbo||this._fbo.width===e&&this._fbo.height===n||this._fbo.resize(e,n)}},SP=class nt extends sP{constructor(){super({vert:iP,frag:"#if __VERSION__ == 100\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n#endif\nprecision mediump float;\n#include <gl2_frag>\nvarying vec2 vTexCoord;\n#ifdef HAS_RAIN\nuniform sampler2D ripplesMap;\n#endif\n#ifdef HAS_SNOW\nuniform sampler2D normalMap;\n#endif\n#ifdef HAS_FOG\nuniform vec3 fogColor;\n#endif\nuniform sampler2D sceneMap;\nuniform sampler2D mixFactorMap;\nuniform float time;\nuniform vec2 resolution;\nuniform float snowIntensity;\nfloat c(float a, float b, float w) {\n  return a + w * (b - a);\n}\n#define HASHSCALE1 .1031\n#define HASHSCALE3 vec3(.1031, .1030, .0973)\n#define HASHSCALE4 vec3(.1031, .1030, .0973, .1099)\nfloat d = .5;\nfloat e = .2;\nfloat f = .5;\nfloat h = 20.;\nfloat i(float p) {\n  vec3 j = fract(vec3(p) * HASHSCALE1);\n  j += dot(j, j.yzx + 19.19);\n  return fract((j.x + j.y) * j.z);\n}\nvec2 k(vec2 p) {\n  vec3 j = fract(vec3(p.xyx) * HASHSCALE3);\n  j += dot(j, j.yzx + 19.19);\n  return fract((j.xx + j.yz) * j.zy);\n}\nvec2 l(vec2 m) {\n  float x = fract(sin(dot(m.xy, vec2(122.9898, 783.233))) * 43758.5453);\n  float y = fract(sin(dot(m.xy, vec2(457.6537, 537.2793))) * 37573.5913);\n  return vec2(x, y);\n}\nvec3 n(vec2 o, float u) {\n  vec3 v = vec3(.0);\n  o = o * (2. + u);\n  float A = e * snowIntensity;\n  float B = o.y * (((i(u) * 2. - 1.) * .5 + 1.) * A);\n  float C = (f * time);\n  o += vec2(B, C);\n  vec2 D = k(floor(o) + 31.1759 * u);\n  o = fract(o);\n  o -= (D * 2. - 1.) * .35;\n  o -= .5;\n  float r = length(o);\n  float E = .05 * (1. + .3 * sin(time * d));\n  float F = smoothstep(E, -E, r);\n  vec3 G = vec3(F) * D.x;\n  return G;\n}\nvec3 H() {\n  vec3 v = vec3(0);\n  vec2 o = gl_FragCoord.xy / resolution.xy;\n  o *= vec2(resolution.x / resolution.y, 1.);\n  float I = h * snowIntensity;\n  for(float J = 0.; J < I; J++) {\n    v += n(o, J);\n  }\n  return v;\n}\nvec3 K(vec4 L, vec4 M, float N) {\n  float O = M.b;\n  vec3 P = vec3(1.);\n  if(N < 1.) {\n    float r = c(.5, P.x, O);\n    float g = c(.5, P.y, O);\n    float b = c(.5, P.z, O);\n    return vec3(r, g, b);\n  } else {\n    float r = c(L.r, P.x, O);\n    float g = c(L.g, P.y, O);\n    float b = c(L.b, P.z, O);\n    return vec3(r, g, b);\n  }\n}\nvoid main() {\n  vec4 L = texture2D(sceneMap, vTexCoord);\n  glFragColor = L;\n  vec4 Q = texture2D(mixFactorMap, vTexCoord);\n#ifdef HAS_RAIN\nvec4 R = texture2D(ripplesMap, vTexCoord);\n  if(Q.g < 1.) {\n    L = mix(L, R, .4);\n  }\n  glFragColor = L;\n#endif\n#ifdef HAS_SNOW\nvec3 S = H();\n  glFragColor = vec4(L.rgb + S, L.a);\n#endif\n#ifdef HAS_FOG\nfloat T = Q.r;\n  vec3 U = mix(fogColor, glFragColor.rgb, T);\n  glFragColor = vec4(U, L.a);\n#endif\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",extraCommandProps:{viewport:{x:0,y:0,width:(e,n)=>n.resolution[0],height:(e,n)=>n.resolution[1]}}})}};const IP=[],EP=[.03,.03,.03],OP=[],RP=[],DP=[],kP=kv([],Ax([],90,0,0),[0,0,0]);let LP=class ct{constructor(e,n){this._regl=e,this._viewport=n,this._init()}_init(){this._shader=new eP({vert:"#include <gl2_vert>\nattribute vec3 aPosition;\nattribute vec3 aNormal;\nattribute vec2 aTexCoord;\nuniform mat4 projMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 positionMatrix;\nvarying vec2 vTexCoord;\n#include <get_output>\nvoid main() {\n  vec4 c = getPosition(aPosition);\n  mat4 d = getPositionMatrix();\n  gl_Position = projMatrix * modelViewMatrix * d * c;\n  vTexCoord = aTexCoord;\n}",frag:"#if __VERSION__ == 100\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n#endif\nprecision mediump float;\n#include <gl2_frag>\nvarying vec2 vTexCoord;\nuniform float rippleRadius;\nuniform float density;\nuniform float time;\nvec3 c(vec2 p) {\n  vec3 q = vec3(dot(p, vec2(127.1, 311.7)), dot(p, vec2(269.5, 183.3)), dot(p, vec2(419.2, 371.9)));\n  return fract(sin(q) * 43758.5453);\n}\nfloat d(in vec2 x) {\n  vec2 e = x * density / 4000.0;\n  vec2 p = floor(e);\n  vec2 f = fract(e);\n  float h = .0;\n  for(int i = -4; i <= 4; i++)\n    for(int k = -4; k <= 4; k++) {\n      vec2 g = vec2(float(k), float(i));\n      vec3 l = c(p + g);\n      vec2 r = g - f + l.xy;\n      float m = sqrt(dot(r, r));\n      float n = max(mix(smoothstep(.99, .999, max(cos(m - time * 2. + (l.x + l.y) * 5.), 0.)), 0., m), 0.);\n      h += n;\n    }\n  return h;\n}\nvoid main() {\n  vec2 u = vTexCoord;\n  float A = 24. / (rippleRadius * .01);\n  float f = d(A * u) * smoothstep(.0, .4, sin(u.x * 3.151592) * sin(u.y * 3.141592));\n  vec3 B = vec3(-dFdx(f), -dFdy(f), -dFdy(f));\n  glFragColor = vec4(B, 1.);\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:[{name:"modelViewMatrix",type:"function",fn:function(e,n){return Cv(IP,n.viewMatrix,n.modelMatrix)}}],extraCommandProps:{viewport:this._viewport}}),this._shader.version=300,this._fbo=this._regl.framebuffer({color:this._regl.texture({width:this._viewport.width(),height:this._viewport.height(),wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this._scene=new kC,this.renderer=new PC(this._regl)}_transformRipples(e){const n=e.coordinateToPointAtRes(e.getCenter(),e.getGLRes()),i=e.getGLScale()/e.getGLScale(this._fixZoom),o=$v(RP,i,i,i),s=n_(o,EP,o),a=xv(DP);zv(a,Ax(OP,0,0,0),[n.x,n.y,0],s),Cv(a,a,kP),this._mesh.setLocalTransform(a)}_createRipplesMask(e){this._fixZoom=e.getZoom();const n=800*Math.pow(2,16.685648411389433-this._fixZoom),i={};i.POSITION=[-n,0,-n,n,0,-n,-n,0,n,n,0,n],i.NORMAL=[0,1,0,0,1,0,0,1,0,0,1,0],i.TEXCOORD_0=[0,0,1,0,0,1,1,1];const o=new Lw(i,[3,1,0,0,2,3],0,{positionAttribute:"POSITION",normalAttribute:"NORMAL",uv0Attribute:"TEXCOORD_0"});o.generateBuffers(this._regl);const s=new cC;return new bC(o,s)}render(e,n){return this._resize(),this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this._fbo}),this._mesh=this._mesh||this._createRipplesMask(e),this._scene.setMeshes(this._mesh),this._transformRipples(e),this.renderer.render(this._shader,{projMatrix:n.projMatrix,viewMatrix:n.viewMatrix,time:n.time,rippleRadius:n.rippleRadius,density:n.density},this._scene,this._fbo),this._fbo}dispose(){this._fbo&&this._fbo.destroy(),this._shader&&this._shader.dispose()}_resize(){const e=Kb(this._viewport.width.data)?this._viewport.width.data():this._viewport.width,n=Kb(this._viewport.height.data)?this._viewport.height.data():this._viewport.height;!this._fbo||this._fbo.width===e&&this._fbo.height===n||this._fbo.resize(e,n)}};var FP="attribute vec3 aPosition;\nuniform mat4 positionMatrix;\nuniform mat4 projViewModelMatrix;\n#ifdef HAS_VIDEO\nattribute vec2 aTexCoord;\nvarying vec2 uv;\n#endif\n#include <get_output>\nvoid main() {\n  mat4 c = getPositionMatrix();\n  vec4 d = c * getPosition(aPosition);\n  gl_Position = projViewModelMatrix * d;\n#ifdef HAS_VIDEO\nuv = aTexCoord;\n#endif\n}";const NP=[0,0,0,1];let zP=class dt{constructor(e,n){this.regl=e,this._viewport=n,this.renderer=new PC(e),this._init()}_init(){this._maskColorFbo=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this._maskModeFbo=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"nearest",min:"nearest"}),depth:!0});const e=[{name:"projViewModelMatrix",type:"function",fn:(e,n)=>Cv([],n.projViewMatrix,n.modelMatrix)}];this._maskColorShader=new eP({vert:FP,frag:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec4 maskColor;\n#ifdef HAS_VIDEO\nuniform sampler2D maskTexture;\nvarying vec2 uv;\n#endif\nvoid main() {\n  \n#ifdef HAS_VIDEO\ngl_FragColor = texture2D(maskTexture, uv);\n  gl_FragColor.a = maskColor.a;\n#else\ngl_FragColor = maskColor;\n#endif\n}",uniforms:e,extraCommandProps:{viewport:this._viewport}}),this._maskModeShader=new eP({vert:FP,frag:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform float maskMode;\n#ifdef HAS_MASK_FLAT\nuniform float flatHeight;\n#endif\n#ifdef HAS_MASK_COLOR\nuniform vec2 heightRange;\n#endif\nvoid main() {\n  \n#if defined(HAS_MASK_FLAT)\ngl_FragColor = vec4(maskMode, flatHeight, .0, 1.);\n#elif defined(HAS_MASK_COLOR)\ngl_FragColor = vec4(maskMode, .0, heightRange.x, heightRange.y);\n#else\ngl_FragColor = vec4(maskMode, .0, .0, .0);\n#endif\n}",uniforms:e,extraCommandProps:{viewport:this._viewport}}),this._scene=new kC}render(e,n){this._resize(),this.renderer.clear({color:NP,depth:1,framebuffer:this._maskColorFbo}),this.renderer.clear({color:NP,depth:1,framebuffer:this._maskModeFbo}),this._scene.setMeshes(e);const i={projViewMatrix:n};return this.renderer.render(this._maskColorShader,i,this._scene,this._maskColorFbo),this.renderer.render(this._maskModeShader,i,this._scene,this._maskModeFbo),{colorExtent:this._maskColorFbo,modeExtent:this._maskModeFbo}}_resize(){const e=Kb(this._viewport.width)?this._viewport.width():this._viewport.width.data(),n=Kb(this._viewport.height)?this._viewport.height():this._viewport.height.data();!this._maskColorFbo||this._maskColorFbo.width===e&&this._maskColorFbo.height===n||(this._maskColorFbo.resize(e,n),this._maskModeFbo.resize(e,n))}dispose(){this._maskColorFbo&&(this._maskColorFbo.destroy(),delete this._maskColorFbo),this._maskModeFbo&&(this._maskModeFbo.destroy(),delete this._maskModeFbo),this._maskColorShader&&(this._maskColorShader.dispose(),delete this._maskColorShader),this._maskModeShader&&(this._maskModeShader.dispose(),delete this._maskModeShader)}};const BP=[],HP={width:4,type:"float"};let jP=class mt{constructor(e,n,i){this._regl=e,this.joints=n,this.inverseBindMatrices=[],this.jointMatrices=[],this.jointData=new Float32Array(16*n.length);for(let e=0;e<n.length;++e)this.inverseBindMatrices.push(new Float32Array(i.buffer,i.byteOffset+16*Float32Array.BYTES_PER_ELEMENT*e,16)),this.jointMatrices.push(new Float32Array(this.jointData.buffer,16*Float32Array.BYTES_PER_ELEMENT*e,16));this.jointTextureSize=[4,6]}update(e,n,i){wv(BP,e);for(let e=0;e<this.joints.length;++e){const i=this.jointMatrices[e];Cv(i,BP,n[this.joints[e].nodeIndex]),Cv(i,i,this.inverseBindMatrices[e])}HP.height=this.joints.length,HP.data=this.jointData;const o=HP;return i?i(o):i=this._regl.texture(o),i}};const UP=[0,0,0],GP=[0,0,0,1],VP=[1,1,1],WP=[];let qP=class pt{constructor(e=[0,0,0],n=[0,0,0,1],i=[1,1,1]){this.translation=e,this.rotation=n,this.scale=i}getMatrix(){return zv(WP,this.rotation,this.translation,this.scale)}decompose(e){Lv(this.translation,e),Nv(this.rotation,e),Fv(this.scale,e)}update(e){e&&(e.translation&&!p_(e.translation,UP)&&Kv(this.translation,e.translation),e.rotation&&!kx(e.rotation,GP)&&xx(this.rotation,e.rotation),e.scale&&!p_(e.scale,VP)&&Kv(this.scale,e.scale))}},ZP=class bt{constructor(e){this._init(e)}_init(e){this.bbox=e.bbox,this.geometry=e.geometry,this.nodeMatrix=e.nodeMatrix,this.materialInfo=e.materialInfo,this.extraInfo=e.extraInfo,this.animationMatrix=e.animationMatrix,this.morphWeights=e.morphWeights,this.skin=e.skin,this.nodeIndex=e.nodeIndex}copyEdgeGeometry(){this.copyGeometry||(this.copyGeometry=this._copyEdgeGeometry(this.geometry))}createCopyBarycentric(){this.copyGeometry&&!this.copyGeometry.data.aBarycentric&&(this.copyGeometry.buildUniqueVertex(),this.copyGeometry.createBarycentric("aBarycentric"))}_copyEdgeGeometry(e){const n=e.data,i=e.indices||e.elements,o={};for(const i in n)if(i===e.desc.positionAttribute)if(iw(n[i]))o[i]=n[i].slice();else if(n[i].buffer&&n[i].buffer.destroy)o[i]={buffer:n[i].buffer},iw(n[i].array)&&(o[i].array=n[i].array.slice());else{const n=e._getAttributeData(i);o[i]=i!==e.desc.positionAttribute?n:n.slice()}const s=void 0!==i.length?i.slice():i,a=JSON.parse(JSON.stringify(e.desc)),h=new aC(o,s,0,a);return h.properties=e.properties,h}},QP=0;const XP=[];let YP=class St{constructor(e,n){this.gltf=e,this.regl=n,this.geometries=[],n&&(this._emptyTexture=n.texture({width:2,height:2}))}getMeshesInfo(){return this.gltf?(this.geometries.length||(this._createTextures(this.gltf.textures),this._createSkins(this.gltf.skins),this.gltf.scenes[0].nodes.forEach((e=>{this._parserNode(e,this.geometries)})),this._checkBaseColorFactor()),this.geometries):null}getGLTFBBox(){if(!this.gltf)return null;const e=this.geometries;if(!e||!e.length)return null;const n=[1/0,1/0,1/0],i=[-1/0,-1/0,-1/0];for(let o=0;o<e.length;o++){const s=e[o].bbox,a=s.min,h=s.max;a[0]<n[0]&&(n[0]=a[0]),a[1]<n[1]&&(n[1]=a[1]),a[2]<n[2]&&(n[2]=a[2]),h[0]>i[0]&&(i[0]=h[0]),h[1]>i[1]&&(i[1]=h[1]),h[2]>i[2]&&(i[2]=h[2])}return{min:n,max:i}}_createSkins(e){if(e){this._skinMap={};for(let n=0;n<e.length;n++){const i=e[n];i.joints=i.joints.map((e=>this.gltf.nodes[e])),this._skinMap[n]=new jP(this.regl,i.joints,i.inverseBindMatrices.array),delete i.inverseBindMatrices}}}_createTextures(e){if(e){this._textureMap={};for(let n=0;n<e.length;n++){const i=e[n];this._textureMap[n]||(this._textureMap[n]=this._toTexture(i),delete i.image)}}}_checkBaseColorFactor(){if(!this._checkBaseColorFactorAlpha())for(let e=0;e<this.geometries.length;e++){const n=this.geometries[e].materialInfo.baseColorFactor;n&&0===n[3]&&(n[3]=1)}}_checkBaseColorFactorAlpha(){for(let e=0;e<this.geometries.length;e++){const n=this.geometries[e].materialInfo.baseColorFactor;if(n&&n[3]>0)return!0}return!1}dispose(){this._emptyTexture&&this._emptyTexture.destroy();const e=this.getMeshesInfo();if(e){e.forEach((e=>{e.geometry.dispose();for(const n in e.materialInfo){const i=e.materialInfo[n];i&&i.destroy&&!i[xw]&&i.destroy()}}));for(const e in this._textureMap){const n=this._textureMap[e];n&&n.destroy&&!n[xw]&&n.destroy()}delete this.gltf}}updateAnimation(e,n,i,o,s,a,h,l){const c=this.gltf;if(!c)return;if(QP=c.animations?zy.getAnimationTimeSpan(c,o):null,!QP)return;e-=s;let A=0;A=n||!n&&this._isFirstLoop(e,i,o,s)?e*i*.001%(QP.max-QP.min)+QP.min:e*i*.001+QP.min,c.scenes[0].nodes.forEach((e=>{this._updateNodeMatrix(o,A,e,null,a,l)}));for(const e in this.gltf.nodes){const n=this.gltf.nodes[e],i=a[n.nodeIndex];if(n.skin&&i){const e=n.skin.update(i,a,h[n.nodeIndex]&&h[n.nodeIndex].jointTexture);h[n.nodeIndex]||(h[n.nodeIndex]={jointTextureSize:n.skin.jointTextureSize,numJoints:n.skin.joints.length}),h[n.nodeIndex].jointTexture=e}}}_isFirstLoop(e,n,i,o){const s=this.gltf;return!o||!s||(QP=s.animations?zy.getAnimationTimeSpan(s,i):null,e*n*.001/(QP.max-QP.min)<1)}hasSkinAnimation(){return!!this._isAnimation}_updateNodeMatrix(e,n,i,o,s,a){i.trs&&(a?a.indexOf(Number(i.nodeIndex))>-1&&this._updateNodeTRS(i,n,e):this._updateNodeTRS(i,n,e)),s[i.nodeIndex]=o?Cv(s[i.nodeIndex]||[],o,i.matrix||i.trs.getMatrix()):_v(s[i.nodeIndex]||[],i.matrix||i.trs.getMatrix()),i.children&&i.children.forEach((o=>{this._updateNodeMatrix(e,n,o,s[i.nodeIndex],s,a)}))}_updateNodeTRS(e,n,i){const o=zy.getAnimationClip(this.gltf,Number(e.nodeIndex),n,i);o.weights&&this._updateMorph(e,o.weights),e.trs.update(o)}_updateMorph(e,n){const i=n.length;if(!e.influencesList){e.influencesList=[];for(let n=0;n<i;n++)e.influencesList[n]=[n,0]}const o=e.influencesList;for(let e=0;e<o.length;e++){const i=o[e];i[0]=e,i[1]=n[e]}o.sort(KP);const s=[];for(let e=0;e<8;e++)s[e]=[e,0];for(let e=0;e<8;e++)e<i&&o[e][1]?(s[e][0]=o[e][0],s[e][1]=o[e][1]):(s[e][0]=Number.MAX_SAFE_INTEGER,s[e][1]=0);s.sort(JP),e.geometries.forEach((e=>{const n=e.properties.morphTargets;for(let i=0;i<8;i++){const o=s[i],a=o[0],h=o[1];a!==Number.MAX_SAFE_INTEGER&&h?(e.updateData("POSITION"+i,n["POSITION_"+a].array),e.properties.morphWeights[i]=h):e.properties.morphWeights[i]=0}}))}_parserNode(e,n,i){if(e.isParsed)return;e.nodeMatrix=e.nodeMatrix||xv([]),e.localMatrix=e.localMatrix||xv([]),e.matrix?(e.trs=new qP,e.trs.decompose(e.matrix)):e.trs=new qP(e.translation,e.rotation,e.scale),e.localMatrix=e.trs.getMatrix(),i?Cv(e.nodeMatrix,i,e.matrix||e.localMatrix):_v(e.nodeMatrix,e.matrix||e.localMatrix);const o=e.nodeMatrix;if(e.children)for(let i=0;i<e.children.length;i++)this._parserNode(e.children[i],n,o);if(Jb(e.skin)){this._isAnimation=!0;const n=e.skin;e.trs=new qP,e.skin=this._skinMap[n]}Jb(e.mesh)&&(e.mesh=this.gltf.meshes[e.mesh],e.mesh.node=e,e.geometries=e.geometries||[],e.mesh.primitives.forEach((i=>{const s=this._createMaterialInfo(i.material),a=function(e,n,i){const o=e.attributes,s=o.COLOR_0;if(s&&s.array instanceof Float32Array){const e=new Uint8Array(s.array.length);for(let n=0;n<e.length;n++)e[n]=Math.round(255*s.array[n]);s.array=e}else if(s&&(s.array instanceof Uint16Array||s.array instanceof Int16Array||s.array instanceof Uint32Array||s.array instanceof Int32Array)){const e=new Uint8Array(s.array);s.array=e}i&&o.TEXCOORD_0&&!o.TEXCOORD_0&&(o.TEXCOORD_1=o.TEXCOORD_0);const a={};for(const e in o)a[e]=$b({},o[e]),n&&(a[e].buffer=Jw(n,o[e],{dimension:o[e].itemSize}));if(e.morphTargets){const e=fw(a.POSITION)?a.POSITION.itemSize*a.POSITION.count:a.POSITION.array.length;for(let n=0;n<8;n++)a[`POSITION${n}`]||(a[`POSITION${n}`]=new Float32Array(e).fill(0));for(let e=0;e<4;e++)a[`NORMAL${e}`]||(a[`NORMAL${e}`]=new Float32Array(a.NORMAL.array?a.NORMAL.array.length:a.NORMAL.length).fill(0))}let h=e.indices;h&&void 0===h.bufferView&&h.array&&(h=h.array);const l=new Lw(a,h,0,{primitive:ew(e.mode)?zw(e.mode):e.mode,positionAttribute:"POSITION",normalAttribute:"NORMAL",uv0Attribute:"TEXCOORD_0",uv1Attribute:"TEXCOORD_1",color0Attribute:"COLOR_0"});return e.morphTargets&&(l.properties.morphWeights=[]),e.mode>3&&!l.data.NORMAL&&l.createNormal("NORMAL"),l}(i,this.regl,s.occlusionTexture);a.properties.morphTargets=i.morphTargets,e.geometries.push(a);let h=a.boundingBox.copy();h=h.transform(xv(XP),o);const l={geometry:a,bbox:h,nodeMatrix:o,materialInfo:s,extraInfo:this._createExtralInfo(i.material),animationMatrix:e.trs.getMatrix(),morphWeights:e.weights,nodeIndex:e.nodeIndex};e.skin&&(l.skin={jointTextureSize:[4,6],numJoints:e.skin.joints.length,jointTexture:e.skin.jointTexture});const c=new ZP(l);n.push(c)}))),e.isParsed=!0}_createMaterialInfo(e){const n={};if(this.gltf.materials&&this.gltf.materials[e]){const i=this.gltf.materials[e],o=i.pbrMetallicRoughness;if(o){const e=o.metallicRoughnessTexture,i=o.baseColorTexture;i&&(n.baseColorTexture=this._getTexture(i),i.KHR_texture_transform&&(n.khr_offset=i.KHR_texture_transform.offset||[0,0],n.khr_rotation=i.KHR_texture_transform.rotation||0,n.khr_scale=i.KHR_texture_transform.scale||[1,1])),o.baseColorFactor&&(n.baseColorFactor=o.baseColorFactor),e?n.metallicRoughnessTexture=this._getTexture(e):(n.metallicFactor=Jb(o.metallicFactor)?o.metallicFactor:1,n.roughnessFactor=Jb(o.roughnessFactor)?o.roughnessFactor:1)}const s=i.extensions;if(s&&s.KHR_materials_pbrSpecularGlossiness){const e=s.KHR_materials_pbrSpecularGlossiness;n.name="pbrSpecularGlossiness";for(const i in e)n[i]=Jb(e[i].index)?this._getTexture(e[i]):e[i]}i.normalTexture&&(n.normalTexture=this._getTexture(i.normalTexture)),i.occlusionTexture&&(n.occlusionTexture=this._getTexture(i.occlusionTexture)),i.emissiveTexture&&(n.emissiveTexture=this._getTexture(i.emissiveTexture)),i.emissiveFactor&&(n.emissiveFactor=i.emissiveFactor),n.alphaCutoff=i.alphaCutoff||.5,n.doubleSided=i.doubleSided,n.alphaMode=i.alphaMode||"OPAQUE"}return n}_createExtralInfo(e){const n={};if(this.gltf.materials&&this.gltf.materials[e]){const i=this.gltf.materials[e];n.doubleSided=i.doubleSided,n.alphaMode=i.alphaMode||"OPAQUE"}return n}_getTexture(e){const n=e.extensions,i=e.index;if(!Jb(i))return null;n&&n.KHR_texture_transform&&(e.KHR_texture_transform=n.KHR_texture_transform);const o=this._textureMap[i];return o.texInfo=e,o}_toTexture(e){if(!e)return this._emptyTexture;const n=e.sampler||{};return new VC({width:e.image.width,height:e.image.height,data:e.image.array,mag:Vw(n.magFilter)||"linear",min:qw(n.minFilter)||"linear mipmap linear",wrapS:Qw(n.wrapS)||"repeat",wrapT:Qw(n.wrapT)||"repeat"})}};function JP(e,n){return e[0]-n[0]}function KP(e,n){return Math.abs(n[1])-Math.abs(e[1])}function $P(e,n){const{fetchOptions:i,gltfLoaderOptions:o,urlModifier:s}=n,a=o||{};a.urlModifier=s;const h=e.lastIndexOf("/"),l=e.slice(0,h),c=e.slice(e.lastIndexOf(".")).toLowerCase();return".gltf"===c?yy.getJSON(e,i,s).then((e=>eM(l,e,a))):".glb"===c?yy.getArrayBuffer(e,i,s).then((e=>eM(l,{buffer:e.data,byteOffset:0},a))):null}function tM(e,n){return new YP(e,n)}function eM(e,n,i){return new zy(e,n,i).load()}var nM=Object.freeze({__proto__:null,exportGLTFPack:tM,load:$P,loadGLTF:eM});const iM=[-1,0,-1,1,0,-1,-1,0,1,1,0,1],rM=[3,1,0,0,2,3],oM=[0,0,1,0,0,1,1,1],sM={vertices:[-.8111000061035156,2.0102999210357666,-.8111000061035156,0,.010300000198185444,-0,-.8111000061035156,2.0102999210357666,.8111000061035156,-.8111000061035156,2.0102999210357666,.8111000061035156,0,.010300000198185444,-0,.8111000061035156,2.0102999210357666,.8111000061035156,.8111000061035156,2.0102999210357666,.8111000061035156,0,.010300000198185444,-0,.8111000061035156,2.0102999210357666,-.8111000061035156,.8111000061035156,2.0102999210357666,-.8111000061035156,0,.010300000198185444,-0,-.8111000061035156,2.0102999210357666,-.8111000061035156,.8111000061035156,2.0102999210357666,-.8111000061035156,-.8111000061035156,2.0102999210357666,-.8111000061035156,0,2.9419000148773193,-0,.8111000061035156,2.0102999210357666,.8111000061035156,.8111000061035156,2.0102999210357666,-.8111000061035156,0,2.9419000148773193,-0,-.8111000061035156,2.0102999210357666,-.8111000061035156,-.8111000061035156,2.0102999210357666,.8111000061035156,0,2.9419000148773193,-0,-.8111000061035156,2.0102999210357666,.8111000061035156,.8111000061035156,2.0102999210357666,.8111000061035156,0,2.9419000148773193,-0],normals:[-.9267006516456604,-.3758002817630768,-0,-.9267006516456604,-.3758002817630768,-0,-.9267006516456604,-.3758002817630768,-0,0,-.3758002817630768,.9267006516456604,0,-.3758002817630768,.9267006516456604,0,-.3758002817630768,.9267006516456604,.9267006516456604,-.3758002817630768,-0,.9267006516456604,-.3758002817630768,-0,.9267006516456604,-.3758002817630768,-0,0,-.3758002817630768,-.9267006516456604,0,-.3758002817630768,-.9267006516456604,0,-.3758002817630768,-.9267006516456604,0,.656676173210144,-.7541726231575012,0,.656676173210144,-.7541726231575012,0,.656676173210144,-.7541726231575012,.7541726231575012,.656676173210144,-0,.7541726231575012,.656676173210144,-0,.7541726231575012,.656676173210144,-0,-.7541726231575012,.656676173210144,-0,-.7541726231575012,.656676173210144,-0,-.7541726231575012,.656676173210144,-0,0,.656676173210144,.7541726231575012,0,.656676173210144,.7541726231575012,0,.656676173210144,.7541726231575012],indices:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]},aM=["cube","plane","pyramid"],hM={cube:{meshes:[{primitives:[{attributes:{POSITION:{array:new Int8Array([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1])},NORMAL:{array:new Int8Array([0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1])},TEXCOORD_0:{array:new Int8Array([0,0,1,0,0,1,1,1,0,0,1,0,0,1,1,1,0,0,1,0,0,1,1,1,0,0,1,0,0,1,1,1,0,0,1,0,0,1,1,1,0,0,1,0,0,1,1,1])}},indices:new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),mode:4}]}],scenes:[{nodes:[{mesh:0,scale:[60,60,60]}]}]},"plane-cube":{meshes:[{primitives:[{attributes:{POSITION:{array:new Int8Array(iM)},TEXCOORD_0:{array:new Int8Array(oM)}},indices:new Uint16Array(rM),mode:4}]}],scenes:[{nodes:[{mesh:0,scale:[60,60,60],translation:[0,-60,0]},{mesh:0,scale:[60,60,60],translation:[0,60,0]},{mesh:0,scale:[60,60,60],translation:[60,0,0],rotation:[0,0,.7071067811865475,.7071067811865476]},{mesh:0,scale:[60,60,60],translation:[-60,0,0],rotation:[0,0,.7071067811865475,.7071067811865476]},{mesh:0,scale:[60,60,60],translation:[0,0,60],rotation:[.7071067811865475,0,0,.7071067811865476]},{mesh:0,scale:[60,60,60],translation:[0,0,-60],rotation:[.7071067811865475,0,0,.7071067811865476]}]}]},plane:{meshes:[{primitives:[{attributes:{POSITION:{array:new Int8Array(iM)},NORMAL:{array:new Int8Array([0,1,0,0,1,0,0,1,0,0,1,0])},TEXCOORD_0:{array:new Int8Array(oM)}},indices:new Uint16Array(rM),mode:4}]}],scenes:[{nodes:[{mesh:0,scale:[60,60,60]}]}]},pyramid:{meshes:[{primitives:[{attributes:{POSITION:{array:new Float32Array(sM.vertices)},NORMAL:{array:new Float32Array(sM.normals)},TEXCOORD_0:{array:new Float32Array(sM.uv)}},indices:new Uint16Array(sM.indices),mode:4}]}],scenes:[{nodes:[{mesh:0,scale:[60,60,60]}]}]}};let lM=class Lt{constructor(e,n){this.regl=e,this.resourceMap={},this.options=n||{}}getGLTF(e){return this.resourceMap[e]}loginGLTF(e,n){if(this.resourceMap[e])this.resourceMap[e].refCount+=1;else{if(hM[e]){const n=function(e){let n=null;return hM[e]&&(n={meshes:hM[e].meshes},n.scenes=JSON.parse(JSON.stringify(hM[e].scenes))),n}(e);this.resourceMap[e]=this._exportGLTFResource(n,e,!1)}else this.resourceMap[e]=n?n(e).then((n=>(this.resourceMap[e]=this._exportGLTFResource(n,e),this.resourceMap[e]))):this._loadGLTFModel(e);this.resourceMap[e].refCount=1}}logoutGLTF(e){if(this.resourceMap[e]&&(this.resourceMap[e].refCount-=1,this.resourceMap[e].refCount<1)){const n=this.resourceMap[e].resources;if(n)for(let e=0;e<n.length;e++)n[e].geometry.dispose(),n[e].copyGeometry&&n[e].copyGeometry.dispose(),n[e].material&&n[e].material.dispose();this.resourceMap[e].gltfPack&&this.resourceMap[e].gltfPack.dispose(),delete this.resourceMap[e]}}isSimpleModel(e){return hM[e]}addSimpleModel(e,n){!function(e,n){"string"==typeof e&&aM.indexOf(e)<0&&(hM[e]=n)}(e,n)}removeSimpleModel(e){delete hM[e]}_exportGLTFResource(e,n,i=!0){if(!e)return null;const o=tM(e,i?this.regl:null),s=o.getMeshesInfo();return{bbox:o.getGLTFBBox(),gltfPack:o,resources:s,json:e.json,refCount:this.resourceMap[n]?this.resourceMap[n].refCount:0}}fetchGLTF(e){return $P(e,this.options).then((e=>e))}_loadGLTFModel(e){return this.fetchGLTF(e).then((n=>(this.resourceMap[e]=this._exportGLTFResource(n,e),this.resourceMap[e])))}};const uM=function(){const e=[0,0,0],n=90*Math.PI/180,i=[0,0,0,0],o=new Array(16);return function(s,a,h,l,c,A){const f=[Vv([],e,[1,0,0],A&&A[0]||[0,-1,0]),Vv([],e,[-1,0,0],A&&A[1]||[0,-1,0]),Vv([],e,[0,1,0],A&&A[2]||[0,0,1]),Vv([],e,[0,-1,0],A&&A[3]||[0,0,-1]),Vv([],e,[0,0,1],A&&A[4]||[0,-1,0]),Vv([],e,[0,0,-1],A&&A[5]||[0,-1,0])],d={context:{viewMatrix:function(e,n,i){return f[i]},projMatrix:jv(o,n,1,.5,1.1)}};return a&&(d.framebuffer=a.faces?function(e,n,i){return a.faces[i]}:a),s(d)(6,((e,n,o)=>{const A={color:i,depth:1};a&&(A.framebuffer=a.faces?a.faces[o]:a),s.clear(A),h(l),c&&c()})),a}}();var cM={vertices:[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1],textures:[1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]},AM="#define SHADER_NAME CUBE_MAP\nattribute vec3 aPosition;\nvarying vec3 vWorldPos;\nuniform mat4 projMatrix;\nuniform mat4 viewMatrix;\nvoid main() {\n  vWorldPos = aPosition;\n  gl_Position = projMatrix * viewMatrix * vec4(vWorldPos, 1.);\n}";
/*!
   * from claygl
   * https://github.com/pissang/claygl/
   * License: BSD-2-Clause
   */function fM(e,n){const i=e[0],o=e[1],s=e[2];return 0===n?1:1===n?i:2===n?o:3===n?s:4===n?i*s:5===n?o*s:6===n?i*o:7===n?3*s*s-1:i*i-o*o}const dM={px:[2,1,0,-1,-1,1],nx:[2,1,0,1,-1,-1],py:[0,2,1,1,-1,-1],ny:[0,2,1,1,1,1],pz:[0,1,2,-1,-1,-1],nz:[0,1,2,1,-1,1]},pM=["px","nx","py","ny","pz","nz"],gM=ZC.compile(vP);function mM(e,n,i,o,s=1,a=!1){const h=e({frag:(a?"#define ENCODE_RGBM\n":"")+"#define SHADER_NAME CUBEMAP\nprecision highp float;\nuniform samplerCube cubeMap;\nuniform float exposure;\nvarying vec3 vWorldPos;\n#ifdef ENCODE_RGBM\nvec4 c(const in vec3 d, const in float e) {\n  if(e <= .0)\n    return vec4(d, 1.);\n  vec4 f;\n  vec3 h = d / e;\n  f.a = clamp(max(max(h.r, h.g), max(h.b, 1e-6)), .0, 1.);\n  f.a = ceil(f.a * 255.) / 255.;\n  f.rgb = h / f.a;\n  return f;\n}\n#endif\nvoid main() {\n  vec4 i = textureCube(cubeMap, vWorldPos);\n  i.rgb *= exposure;\n#ifdef ENCODE_RGBM\ni = c(i.rgb, 7.);\n#endif\n#if __VERSION__ == 100\ngl_FragColor = i;\n#endif\n}",vert:AM,attributes:{aPosition:cM.vertices},uniforms:{projMatrix:e.context("projMatrix"),viewMatrix:e.context("viewMatrix"),cubeMap:n,exposure:s},elements:cM.indices}),l=[],c=e.texture({radius:i,min:"linear",mag:"linear",type:o?"float":"uint8",format:"rgba"}),A=e.framebuffer({radius:i,color:c});return uM(e,A,h,{size:i},(function(){const n=e.read();if(o){const e=new Uint16Array(n.length);for(let i=0;i<n.length;i++)e[i]=Math.min(GC(n[i]),65504);l.push(e)}else l.push(n)})),h.destroy(),A.destroy(),l}const yM=new Int8Array([-1,1,0,-1,-1,0,1,1,0,1,-1,0]),vM=new Int8Array([0,1,0,0,1,1,1,0]);function _M(e,n,i,o){n=n||256;const s=xM(i=i||1024,o=o||256),a=e.texture({data:s,width:o,height:i,min:"nearest",mag:"nearest"}),h=e.buffer(yM),l=e.buffer(vM),c=e.framebuffer({radius:n,colorType:"uint8",colorFormat:"rgba",min:"linear",mag:"linear"}),A=e({frag:"precision highp float;\nvarying vec2 vTexCoords;\nuniform sampler2D distributionMap;\nconst float c = 3.14159265359;\nvec4 d(float a, float b) {\n  a *= 65535.;\n  b *= 65535.;\n  vec4 rgba;\n  rgba[0] = mod(a, 255.);\n  rgba[1] = (a - rgba[0]) / 65280.0;\n  rgba[2] = mod(b, 255.);\n  rgba[3] = (b - rgba[2]) / 65280.0;\n  return rgba;\n}\nvec3 e(float f, vec3 h, float i) {\n  vec4 j = texture2D(distributionMap, vec2(i, f));\n  vec3 k = j.xyz;\n  float l = sign(j.w - .5);\n  float m = sign(j.w - clamp(l, .0, 1.) * 200.0 / 255. - .15);\n  k.x *= l;\n  k.y *= m;\n  vec3 n = abs(h.z) < .999 ? vec3(.0, .0, 1.) : vec3(1., .0, .0);\n  vec3 o = normalize(cross(n, h));\n  vec3 u = cross(h, o);\n  vec3 v = o * k.x + u * k.y + h * k.z;\n  return normalize(v);\n}\nfloat A(float B, float i) {\n  float a = i;\n  float C = (a * a) / 2.;\n  float D = B;\n  float E = B * (1. - C) + C;\n  return D / E;\n}\nfloat F(float B, float G, float i) {\n  float I = A(B, i);\n  float J = A(G, i);\n  return J * I;\n}\nvec2 K(float B, float i) {\n  vec3 L;\n  L.x = sqrt(1. - B * B);\n  L.y = .0;\n  L.z = B;\n  float M = .0;\n  float O = .0;\n  vec3 h = vec3(.0, .0, 1.);\n  const int P = 1024;\n  for(int Q = 0; Q < P; ++Q) {\n    vec3 k = e(float(Q) / float(P), h, i);\n    vec3 R = normalize(2. * dot(L, k) * k - L);\n    float G = max(R.z, .0);\n    float S = max(k.z, .0);\n    float T = max(dot(L, k), .0);\n    float B = max(dot(h, L), .0);\n    if(G > .0) {\n      float U = F(B, G, i);\n      float W = (U * T) / (S * B);\n      float X = pow(1. - T, 5.);\n      M += (1. - X) * W;\n      O += X * W;\n    }\n  }\n  M /= float(P);\n  O /= float(P);\n  return vec2(M, O);\n}\nvoid main() {\n  vec2 Y = K(vTexCoords.x, vTexCoords.y);\n  gl_FragColor = d(Y.x, Y.y);\n}",vert:"attribute vec3 aPosition;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoords;\nvoid main() {\n  vTexCoords = aTexCoord;\n  gl_Position = vec4(aPosition, 1.);\n}",attributes:{aPosition:{buffer:h},aTexCoord:{buffer:l}},uniforms:{distributionMap:a},framebuffer:c,viewport:{x:0,y:0,width:n,height:n},count:yM.length/3,primitive:"triangle strip"});return A(),A.destroy(),h.destroy(),l.destroy(),a.destroy(),c}function xM(e,n){const i=new Float32Array(e*n*4);for(let o=0;o<e;o++){const{x:s,y:a}=bM(o,e);for(let e=0;e<n;e++){const h=e/n,l=h*h,c=2*Math.PI*s,A=Math.sqrt((1-a)/(1+(l*l-1)*a)),f=Math.sqrt(1-A*A),d=4*(o*n+e),p=f*Math.cos(c),g=f*Math.sin(c);i[d]=Math.abs(255*p),i[d+1]=Math.abs(255*g),i[d+2]=255*A,i[d+3]=(p>0?200:0)+(g>0?55:0)}}return i}function bM(e,n){let i=(e<<16|e>>>16)>>>0;return i=((1431655765&i)<<1|(2863311530&i)>>>1)>>>0,i=((858993459&i)<<2|(3435973836&i)>>>2)>>>0,i=((252645135&i)<<4|(4042322160&i)>>>4)>>>0,i=(((16711935&i)<<8|(4278255360&i)>>>8)>>>0)/4294967296,{x:e/n,y:i}}function wM(e){return e._gl instanceof WebGL2RenderingContext||e.hasExtension("OES_texture_half_float")}var CM=Object.freeze({__proto__:null,createIBLMaps:function(e,n={}){const i=n.envTexture,o=n.envCubeSize||512,s=n.sampleSize||1024,a=n.roughnessLevels||256,h=n.prefilterCubeSize||256;let l,c=!1;if(Array.isArray(i)){const n=e.cube({flipY:!0,faces:i});l=function(e,n,i){const o=e({frag:gM,vert:AM,attributes:{aPosition:cM.vertices},uniforms:{hsv:[0,0,0],projMatrix:e.context("projMatrix"),viewMatrix:e.context("viewMatrix"),cubeMap:n,bias:0,size:n.width,environmentExposure:1,backgroundIntensity:1},elements:cM.indices}),s=e.cube({width:i,height:i,min:"linear",mag:"linear",format:"rgba"}),a=e.framebufferCube({radius:i,color:s});return uM(e,a,o,{size:i},null,[[0,0,-1],[0,0,-1],[0,0,1],[0,0,1],[0,-1,0],[0,-1,0]]),o.destroy(),a}(e,n,o),n.destroy()}else l=function(e,n,i){if(!wM(e))throw new Error("HDR is not supported for lack of support for float 16 texture");i=i||512;const o=e({frag:"precision highp float;\n#define PI 3.1415926\nvarying vec3 vWorldPos;\nuniform sampler2D equirectangularMap;\nconst vec2 c = vec2(.1591, .3183);\nvec2 d(vec3 e) {\n  vec2 f = vec2(atan(e.y, e.x), asin(e.z));\n  f *= c;\n  f += .5;\n  return f;\n}\nvoid main() {\n  vec2 f = d(normalize(vWorldPos));\n  vec4 h = texture2D(equirectangularMap, f);\n  gl_FragColor = vec4(h.rgb, 1.);\n}",vert:AM,attributes:{aPosition:cM.vertices},uniforms:{projMatrix:e.context("projMatrix"),viewMatrix:e.context("viewMatrix"),equirectangularMap:n},elements:cM.indices}),s=e.cube({width:i,height:i,min:"linear mipmap linear",mag:"linear",type:"float16",format:"rgba"}),a=e.framebufferCube({radius:i,color:s});return uM(e,a,o),o.destroy(),a}(e,i,o),c=!0;const{prefilterMap:A,prefilterMipmap:f}=function(e,n,i,o,s,a){const h=function(e,n,i,o,s,a){const h=xM(o=o||1024,s=s||256),l=e.texture({data:h,width:s,height:o,min:"nearest",mag:"nearest"}),c=e({frag:"#define SHADER_NAME PBR_prefilter\nprecision highp float;\nvarying vec3 vWorldPos;\nuniform samplerCube environmentMap;\nuniform sampler2D distributionMap;\nuniform float roughness;\nuniform float resolution;\nconst float c = 3.14159265359;\nfloat d(vec3 e, vec3 f, float h) {\n  float a = h * h;\n  float i = a * a;\n  float j = max(dot(e, f), .0);\n  float k = j * j;\n  float l = i;\n  float m = (k * (i - 1.) + 1.);\n  m = c * m * m;\n  return l / m;\n}\nvec3 n(float o, vec3 e, float h) {\n  vec4 u = texture2D(distributionMap, vec2(h, o));\n  vec3 f = u.xyz;\n  float v = sign(u.w - .5);\n  float A = sign(u.w - 200.0 / 255. * clamp(v, .0, 1.) - .15);\n  f.x *= v;\n  f.y *= A;\n  vec3 B = abs(e.z) < .999 ? vec3(.0, .0, 1.) : vec3(1., .0, .0);\n  vec3 C = normalize(cross(B, e));\n  vec3 D = cross(e, C);\n  vec3 E = C * f.x + D * f.y + e * f.z;\n  return normalize(E);\n}\nvoid main() {\n  vec3 e = normalize(vWorldPos);\n  vec3 F = e;\n  vec3 G = F;\n  const int I = 1024;\n  vec3 J = vec3(.0);\n  float K = .0;\n  for(int L = 0; L < I; ++L) {\n    vec3 f = n(float(L) / float(I), e, roughness);\n    vec3 M = normalize(2. * dot(G, f) * f - G);\n    float O = max(dot(e, M), .0);\n    if(O > .0) {\n      J += textureCube(environmentMap, M).rgb * O;\n      K += O;\n    }\n  }\n  J = J / K;\n  gl_FragColor = vec4(J, 1.);\n}",vert:AM,attributes:{aPosition:cM.vertices},uniforms:{projMatrix:e.context("projMatrix"),viewMatrix:e.context("viewMatrix"),environmentMap:n,distributionMap:l,roughness:e.prop("roughness"),resolution:i},elements:cM.indices,viewport:{x:0,y:0,width:e.prop("size"),height:e.prop("size")}});let A=i;const f=e.texture({radius:i,min:"linear",mag:"linear",type:a?"float":"uint8"}),d=e.framebuffer({radius:i,color:f}),p=Math.log(A)/Math.log(2),g=[];for(let n=0;n<=p;n++){let i=0;uM(e,d,c,{roughness:n/(p-1),size:A},(function(){const n=e.read({framebuffer:d});let o=n;if(a){o=new Uint16Array(n.length);for(let e=0;e<n.length;e++)o[e]=Math.min(GC(n[e]),65504)}g[i]||(g[i]={mipmap:[]}),g[i].mipmap.push(o),i++})),A/=2,d.resize(A)}return l.destroy(),d.destroy(),c.destroy(),g}(e,n,i,o,s,a);return{prefilterMap:e.cube({radius:i,min:"linear",mag:"linear",type:a?"float16":"uint8",faces:h,format:"rgba"}),prefilterMipmap:h}}(e,l,h,s,a,c);let d;if(!n.ignoreSH){const i=h;d=function(e,n,i){const o=new Array(9),s=[],a=[],h=[];for(let l=0;l<9;l++){const c=[0,0,0];for(let o=0;o<pM.length;o++){const A=e[o],f=[0,0,0];let d=0,p=0;const g=dM[pM[o]];for(let e=0;e<i;e++)for(let o=0;o<n;o++){s[0]=o/(n-1)*2-1,s[1]=e/(i-1)*2-1,s[2]=-1,l_(s,s),h[0]=s[g[0]]*g[3],h[1]=s[g[1]]*g[4],h[2]=s[g[2]]*g[5],a[0]=A[p++]/255,a[1]=A[p++]/255,a[2]=A[p++]/255;const c=A[p++]/255*7;a[0]*=c,a[1]*=c,a[2]*=c,o_(f,f,a,fM(h,l)*-s[2]),d+=-s[2]}o_(c,c,f,1/d)}o[l]=r_(c,c,1/6)}return o}(mM(e,A,i,!1,n.environmentExposure,!0),i,i);const o=[];for(let e=0;e<d.length;e++)o.push(...d[e]);d=o}const p={envMap:l,isHDR:c,prefilterMap:A};return d&&(p.sh=d),"array"===n.format&&(p.envMap={width:l.width,height:l.height,faces:mM(e,l,o,c)},p.prefilterMap={width:A.width,height:A.height,faces:f},l.destroy(),A.destroy()),p},generateDFGLUT:_M,supportFloat16:wM});const PM={uvScale:[1,1],uvOffset:[0,0],uvRotation:0,textureOrigin:null,textureWidth:null,baseColorFactor:[1,1,1,1],emissiveFactor:[0,0,0],baseColorIntensity:1,emitColorFactor:1,occlusionFactor:1,roughnessFactor:.4,metallicFactor:0,normalMapFactor:1,specularF0:.5,emitMultiplicative:1,normalMapFlipY:0,outputSRGB:1,baseColorTexture:null,normalTexture:null,occlusionTexture:null,metallicRoughnessTexture:null,emissiveTexture:null,uvOrigin:[0,0],noiseTexture:null,specularAAVariance:20,specularAAThreshold:20,hsv:[0,0,0],contrast:1,bumpTexture:null,bumpScale:.05,bumpMinLayers:5,bumpMaxLayers:20,alphaTest:0};let MM=class or extends cC{constructor(e){const n=$b({},PM);(e.metallicRoughnessTexture||e.metallicRoughnessTexture)&&(n.roughnessFactor=1,n.metallicFactor=1),super(e,n)}appendDefines(e,n){super.appendDefines(e,n);const i=this.uniforms;if(i.GAMMA_CORRECT_INPUT&&(e.GAMMA_CORRECT_INPUT=1),n.data[n.desc.colorAttribute]&&(e.HAS_COLOR=1),n.data[n.desc.color0Attribute]&&(e.HAS_COLOR0=1,e.COLOR0_SIZE=n.getColor0Size()),n.data[n.desc.tangentAttribute]?e.HAS_TANGENT=1:n.data[n.desc.normalAttribute]&&(e.HAS_NORMAL=1),n.data.aVertexColorType&&(e.HAS_VERTEX_COLOR=1),!n.data[n.desc.uv0Attribute])return e;i.baseColorTexture&&(e.HAS_ALBEDO_MAP=1),i.metallicRoughnessTexture&&(e.HAS_METALLICROUGHNESS_MAP=1),i.occlusionTexture&&n.data[n.desc.uv1Attribute]&&(e.HAS_AO_MAP=1),i.emissiveTexture&&(e.HAS_EMISSIVE_MAP=1),i.normalTexture&&(e.HAS_NORMAL_MAP=1),i.bumpTexture&&(e.HAS_BUMP_MAP=1),i.skinTexture&&(e.HAS_SKIN_MAP=1),(e.HAS_ALBEDO_MAP||e.HAS_METALLICROUGHNESS_MAP||e.HAS_AO_MAP||e.HAS_EMISSIVE_MAP||e.HAS_NORMAL_MAP||e.HAS_BUMP_MAP||e.HAS_SKIN_MAP)&&(e.HAS_MAP=1),i.noiseTexture&&(e.HAS_RANDOM_TEX=1),n.data[n.desc.tangentAttribute]?e.HAS_TANGENT=1:n.data[n.desc.normalAttribute]&&(e.HAS_NORMAL=1);const o=i.alphaMode&&i.alphaMode.toUpperCase();return"MASK"===o?e.ALPHA_MODE=1:"OPAQUE"===o&&(e.ALPHA_MODE=2),e}},TM=class ar extends(yC(MM)){};function SM(e,n,i){if(i.ambientUpdate){const{iblTexes:o}=e,s=i.target;o?(OM(o),e.iblTexes=EM(n,s)):e.iblTexes=EM(n,s),s.getRenderer().setToRedraw()}}const IM=[0,0];function EM(e,n){const i=n.getLightManager(),o=i&&i.getAmbientResource();if(!o)return null;const s=o.isHDR;return{prefilterMap:e.cube({width:o.prefilterMap.width,height:o.prefilterMap.height,faces:o.prefilterMap.faces,min:"linear",mag:"linear",format:"rgba",type:s?"float16":"uint8"}),envMap:e.cube({width:o.envMap.width,height:o.envMap.height,faces:o.envMap.faces,min:"linear",mag:"linear",format:"rgba",type:s?"float16":"uint8"}),sh:o.sh}}function OM(e){for(const n in e)e[n]&&e[n].destroy&&e[n].destroy(),delete e[n]}var RM=Object.freeze({__proto__:null,createIBLTextures:EM,disposeIBLTextures:OM,getIBLResOnCanvas:function(e){const{dfgLUT:n,iblTexes:i}=e;return{dfgLUT:n,iblTexes:i}},getPBRUniforms:function(e,n,i,o,s){const a=e.viewMatrix,h=e.projMatrix,l=e.cameraPosition,c=e.getRenderer().canvas,A=function(e,n){const i=e.getLightManager(),o=i&&i.getAmbientResource(),s=i&&i.getAmbientLight()||{},a=i&&i.getDirectionalLight()||{};let h;if(o){const e=n.prefilterMap.width,i=Math.log(e)/Math.log(2);h={prefilterMap:n.prefilterMap,diffuseSPH:n.sh,prefilterMiplevel:[i,i],prefilterSize:[e,e],hdrHSV:s.hsv||[0,0,0]}}else h={ambientColor:s.color||[.2,.2,.2]};return h.environmentExposure=ew(s.exposure)?s.exposure:1,h.environmentOrientation=s.orientation||0,h.light0_diffuse=[...a.color||[1,1,1],1],h.light0_viewDirection=a.direction||[1,1,-1],h}(e,n),f=$b({viewMatrix:a,projMatrix:h,projViewMatrix:e.projViewMatrix,cameraPosition:l,outSize:[c.width,c.height],cameraNearFar:[e.cameraNear,e.cameraFar]},A);return f.brdfLUT=i,o&&o.renderUniforms&&$b(f,o.renderUniforms),f.halton=s||IM,f},isSupported:function(e){return e.hasExtension("EXT_shader_texture_lod")},loginIBLResOnCanvas:function(e,n,i){if(!e.dfgLUT&&(e.dfgLUT=_M(n),e.dfgLUT.mtkRefCount=0,i)){const o=(...i)=>SM.call(this,e,n,...i);i.on("updatelights",o),e._iblResListener=o}e.dfgLUT.mtkRefCount++;const o=i.getLightManager();return o&&o.getAmbientResource()?(e.iblTexes||(e.iblTexes=EM(n,i)),{dfgLUT:e.dfgLUT,iblTexes:e.iblTexes}):{dfgLUT:e.dfgLUT,iblTexes:null}},logoutIBLResOnCanvas:function(e,n){let i=!1;e.dfgLUT&&(e.dfgLUT.mtkRefCount--,e.dfgLUT.mtkRefCount<=0)&&(i=!0,n&&n.off("updatelights",e._iblResListener),e.dfgLUT.destroy(),delete e.dfgLUT),e.iblTexes&&i&&(OM(e.iblTexes),delete e.iblTexes)}});let DM=class ur extends eP{constructor(e){super({vert:"attribute vec3 aPosition;\nuniform mat4 lightProjViewModelMatrix;\nuniform mat4 positionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 modelMatrix;\n#include <line_extrusion_vert>\n#include <get_output>\nvarying vec4 vPosition;\nvoid main() {\n  mat4 c = getPositionMatrix();\n#ifdef IS_LINE_EXTRUSION\nvec3 d = getLineExtrudePosition(aPosition);\n  vec4 e = getPosition(d);\n#else\nvec4 e = getPosition(aPosition);\n#endif\ngl_Position = lightProjViewModelMatrix * c * e;\n  vPosition = gl_Position;\n}",frag:"#define SHADER_NAME vsm_mapping\n#ifdef USE_VSM\n#extension GL_OES_standard_derivatives : enable\n#endif\nprecision highp float;\nvarying vec4 vPosition;\n#ifdef PACK_FLOAT\n#include <common_pack_float>\n#endif\nvoid main() {\n  \n#if defined(USE_VSM)\nfloat c = vPosition.z / vPosition.w;\n  c = c * .5 + .5;\n  float d = c;\n  float e = c * c;\n  float f = dFdx(c);\n  float h = dFdy(c);\n  e += .25 * (f * f + h * h);\n  gl_FragColor = vec4(d, e, c, .0);\n#endif\n#if defined(USE_ESM)\n#ifdef PACK_FLOAT\ngl_FragColor = common_encodeDepth(gl_FragCoord.z);\n#else\ngl_FragColor = vec4(gl_FragCoord.z, .0, .0, 1.);\n#endif\n#endif\n}",uniforms:[{name:"lightProjViewModelMatrix",type:"function",fn:function(e,n){return Cv([],n.lightProjViewMatrix,n.modelMatrix)}}],extraCommandProps:{},defines:e})}filter(e){return e.castShadow}},kM=class hr extends sP{constructor({blurOffset:e}){super({vert:iP,frag:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D textureSource;\nuniform vec2 resolution;\n#include <common_pack_float>\nvoid main() {\n  float c = .0;\n  float d = .0;\n  for(int x = -BOXBLUR_OFFSET; x <= BOXBLUR_OFFSET; ++x)\n    for(int y = -BOXBLUR_OFFSET; y <= BOXBLUR_OFFSET; ++y) {\n      vec2 e = vTexCoord.st + vec2(float(x) / resolution.x, float(y) / resolution.y);\n      e = clamp(e, .0, 1.);\n      float f = common_decodeDepth(texture2D(textureSource, e));\n      float s = max(.0, sign(1. - f));\n      d += sign(f) * s;\n      c += f;\n    }\n  float h = c / max(1., d);\n  gl_FragColor = common_encodeDepth(h);\n}",defines:{BOXBLUR_OFFSET:e||2}}),this._blurOffset=e||2}getMeshCommand(e,n){const i="box_shadow_blur_"+this._blurOffset;return this.commands[i]||(this.commands[i]=this.createREGLCommand(e,null,n.getElements())),this.commands[i]}},LM=null,FM=null,NM=class _r{constructor(e,{width:n,height:i,blurOffset:o,defines:s}){this.renderer=e,this.width=n||512,this.height=i||512,this.blurOffset=Yb(o)?2:o,this._init(s)}render(e,{cameraProjViewMatrix:n,lightDir:i,farPlane:o,cameraLookAt:s}){return{lightProjViewMatrix:this._renderShadow(e,n,i,o,s),shadowMap:this.blurTex||this.depthTex,depthFBO:this.depthFBO,blurFBO:this.blurFBO}}resize(e,n){return this.depthTex&&(this.depthTex.resize(e,n),this.depthFBO.resize(e,n)),this.width=e,this.blurFBO&&(this.blurTex.resize(e,n),this.blurFBO.resize(e,n)),this.height=n,this}_renderShadow(e,n,i,o,s){const a=this.renderer,h=LM(n);if(o)for(let e=4;e<8;e++)h[e]=o[e-4];const l=FM(s,h,i);return a.clear({color:[1,0,0,1],depth:1,framebuffer:this.depthFBO}),a.render(this.shadowMapShader,{lightProjViewMatrix:l},e,this.depthFBO),this.blurFBO&&(this.boxBlurShader||(this.boxBlurShader=new kM({blurOffset:this.blurOffset})),a.clear({color:[1,0,0,1],depth:1,framebuffer:this.blurFBO}),a.render(this.boxBlurShader,{resolution:[this.depthTex.width,this.depthTex.height],textureSource:this.depthTex},null,this.blurFBO)),l}_init(e){const n=this.renderer.regl,i="uint8",o=this.width,s=this.height;this.depthTex=n.texture({width:o,height:s,format:"rgb",type:i,min:"nearest",mag:"nearest"}),this.shadowMapShader=new DM(e),this.shadowMapShader.filter=e=>e.castShadow,this.depthFBO=n.framebuffer({color:this.depthTex}),this.blurOffset<=0||(this.blurTex=n.texture({width:o,height:s,format:"rgb",type:i,min:"linear",mag:"linear"}),this.blurFBO=n.framebuffer({color:this.blurTex}))}dispose(){this.depthTex&&(this.depthTex.destroy(),this.depthFBO.destroy(),delete this.depthTex,delete this.depthFBO),this.blurTex&&(this.blurTex.destroy(),this.blurFBO.destroy(),delete this.blurTex,delete this.blurFBO),this.shadowMapShader&&(this.shadowMapShader.dispose(),delete this.shadowMapShader),this.boxBlurShader&&(this.boxBlurShader.dispose(),delete this.boxBlurShader)}};LM=function(){const e=[[-1,-1,-1,1],[1,-1,-1,1],[1,1,-1,1],[-1,1,-1,1],[-1,-1,1,1],[1,-1,1,1],[1,1,1,1],[-1,1,1,1]],n=new Array(16);return function(i){wv(n,i);const o=[];for(let i=0;i<e.length;i++){const s=G_([],e[i],n);L_(s,s,1/s[3]),o.push(s)}return o}}(),FM=function(){let e=new Array(4);const n=new Array(3),i=[0,0,0,0],o=[0,1,0],s=new Array(3);let a=new Array(16),h=new Array(16);const l=new Array(16),c=[1,1,1],A=[0,0,0];return function(f,d,p){E_(i,...f,1),r_(n,p,-1),a=Vv(a,t_(s,i,l_(s,n)),i,o),G_(e,d[0],a);let g=e[2],v=e[2],w=e[0],C=e[0],P=e[1],T=e[1];for(let n=1;n<8;n++)e=G_(e,d[n],a),e[2]>v&&(v=e[2]),e[2]<g&&(g=e[2]),e[0]>C&&(C=e[0]),e[0]<w&&(w=e[0]),e[1]>T&&(T=e[1]),e[1]<P&&(P=e[1]);h=Gv(h,-1,1,-1,1,-v,-g);const S=c[0]=2/(C-w),I=c[1]=-2/(T-P);A[0]=-.5*(w+C)*S,A[1]=-.5*(P+T)*I,xv(l),Pv(l,l,A),Mv(l,l,c);const E=Cv(h,l,h);return Cv(new Array(16),E,a)}}();let zM=class gr extends eP{constructor(e){super({vert:"#define SHADER_NAME SHADOW_DISPLAY\nattribute vec3 aPosition;\nuniform mat4 projMatrix;\nuniform mat4 modelViewMatrix;\nuniform vec2 halton;\nuniform vec2 globalTexSize;\nvarying vec4 vPosition;\n#include <vsm_shadow_vert>\nvoid main() {\n  vec4 c = vec4(aPosition, 1.);\n  vec4 d = modelViewMatrix * c;\n  mat4 e = projMatrix;\n  e[2].xy += halton.xy / globalTexSize.xy;\n  gl_Position = e * d;\n  vPosition = gl_Position;\n  shadow_computeShadowPars(c);\n}",frag:"#define SHADER_NAME SHADOW_DISPLAY\nprecision mediump float;\nuniform vec3 color;\n#include <vsm_shadow_frag>\nvoid main() {\n  float c = shadow_computeShadow();\n  float d = 1. - c;\n  gl_FragColor = vec4(color * d, d);\n}",uniforms:[{name:"modelViewMatrix",type:"function",fn:function(e,n){const i=[];return Cv(i,n.viewMatrix,n.modelMatrix),i}}],defines:e||{USE_ESM:1},extraCommandProps:{depth:{enable:!0,mask:!1},viewport:{x:0,y:0,width:(e,n)=>n.globalTexSize[0],height:(e,n)=>n.globalTexSize[1]}}})}getMeshCommand(e,n){return this.commands.shadow_display||(this.commands.shadow_display=this.createREGLCommand(e,null,n.getElements())),this.commands.shadow_display}};function BM(e){return 256*e[2]*256+256*e[1]+e[0]}const HM=new Uint8Array(4),jM=new Float32Array(HM.buffer);let UM,GM;const VM=[1,1],WM="\n    vec3 unpack(highp float f) {\n        highp vec3 color;\n        color.b = floor(f / 65536.0);\n        color.g = floor((f - color.b * 65536.0) / 256.0);\n        color.r = f - floor(color.b * 65536.0) - floor(color.g * 256.0);\n        // now we have a vec3 with the 3 components in range [0..255]. Let's normalize it!\n        return color / 255.0;\n    }\n",qM=`\n    precision highp float;\n\n    varying float vPickingId;\n    varying float vFbo_picking_visible;\n\n    uniform float fbo_picking_meshId;\n\n    ${WM}\n\n    void main() {\n        if (vFbo_picking_visible == 0.0) {\n            discard;\n            return;\n        }\n        gl_FragColor = vec4(unpack(vPickingId), fbo_picking_meshId / 255.0);\n    }\n`,ZM=`\n    precision highp float;\n\n    uniform int fbo_picking_meshId;\n    varying float vFbo_picking_visible;\n\n    ${WM}\n\n    void main() {\n        if (vFbo_picking_visible == 0.0) {\n            discard;\n            return;\n        }\n        gl_FragColor = vec4(unpack(float(fbo_picking_meshId)), 1.0);\n        // gl_FragColor = vec4(unpack(float(35)), 1.0);\n    }\n`,QM=`\n    precision highp float;\n\n    varying float vPickingId;\n    varying float vFbo_picking_visible;\n\n    ${WM}\n\n    void main() {\n        if (vFbo_picking_visible == 0.0) {\n            discard;\n            return;\n        }\n        gl_FragColor = vec4(unpack(vPickingId), 1.0);\n    }\n`;let XM=class Er{constructor(e,{vert:n,uniforms:i,defines:o,extraCommandProps:s},a,h){this._renderer=e,this._fbo=a,this._map=h,this._clearFbo(a),this._vert=n,this._uniforms=i,this._defines=o,this._extraCommandProps=$b({},s),delete this._extraCommandProps.blend,delete this._extraCommandProps.stencil,this._currentMeshes=[],this._init()}_init(){const e=[];this._uniforms&&e.push(...this._uniforms);const n={ENABLE_PICKING:1,HAS_PICKING_ID:1};if(this._defines)for(const e in this._defines)n[e]=this._defines[e];const i=this._vert,o=this._extraCommandProps;this._shader0=new eP({vert:i,frag:qM,uniforms:e,defines:n,extraCommandProps:o}),this._shader2=new eP({vert:i,frag:QM,uniforms:e,defines:n,extraCommandProps:o});const s={ENABLE_PICKING:1,HAS_PICKING_ID:1};if(this._defines)for(const e in this._defines)s[e]=this._defines[e];this._shader1=new eP({vert:i,frag:ZM,uniforms:e,defines:s,extraCommandProps:o}),this._depthShader=new eP({vert:i,frag:"\n    #ifdef GL_ES\n        precision highp float;\n    #endif\n    #if __VERSION__ == 100 && defined(GL_EXT_frag_depth)\n        #extension GL_EXT_frag_depth : enable\n    #endif\n    #include <gl2_frag>\n    #include <common_pack_float>\n    varying float vFbo_picking_viewZ;\n    uniform float logDepthBufFC;\n    varying float vFbo_picking_fragDepth;\n\n    const float PackUpscale = 256. / 255.;\n    const float UnpackDownscale = 255. / 256.;\n    const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\n    const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\n    const float ShiftRight8 = 1. / 256.;\n    vec4 packDepthToRGBA(const in float v ) {\n        vec4 r = vec4(fract(v * PackFactors), v);\n        r.yzw -= r.xyz * ShiftRight8;\n        return r * PackUpscale;\n    }\n\n    void main() {\n        float fragDepth = vFbo_picking_fragDepth > 1.0 ? vFbo_picking_fragDepth : vFbo_picking_viewZ + 1.0;\n        #if __VERSION__ == 300 || __VERSION__ == 100 && defined(GL_EXT_frag_depth)\n            gl_FragDepthEXT = log2(fragDepth) * logDepthBufFC * 0.5;\n        #endif\n        vec4 depthColor = packDepthToRGBA(fragDepth - 1.0);\n        glFragColor = common_unpackFloat(dot(depthColor, UnpackFactors));\n        #if __VERSION__ == 100\n            gl_FragColor = glFragColor;\n        #endif\n    }\n",uniforms:e,defines:s,extraCommandProps:o}),this._scene=new kC,this._scene1=new kC}filter(){return!0}render(e,n,i=!1){if(!e||!e.length)return this;const o=this._fbo;i&&this.clear(),e=e.filter((e=>e&&e.isValid&&e.isValid())),this._scene.setMeshes(e);const s=this._getShader(e,i);s.filter=this.filter,this._currentShader&&s!==this._currentShader&&this.clear(),this._currentShader=s,e.forEach(((e,n)=>{e.setUniform("fbo_picking_meshId",n+this._currentMeshes.length)}));for(let n=0;n<e.length;n++)this._currentMeshes.push(e[n]);return this._renderer.render(s,n,this._scene,o),this}pickAll(e,n,i,o,s){i=JM(i);const{meshIds:a,pickingIds:h,coords:l,points:c}=this._pick(e,n,i,o,s),A=[];if(h&&a){const e={};for(let n=0;n<a.length;n++){const i=`${h[n]}_${a[n]}`;null==a[n]||null==h[n]||e[i]||(e[i]=!0,A.push({meshId:a[n],pickingId:h[n],point:c[n]||null,coordinate:l[n]||null}))}}return A}pick(e,n,i,o,s={}){i=JM(i);const{meshIds:a,pickingIds:h,width:l,coords:c,points:A}=this._pick(e,n,i,o,s);if(h&&a){const e=[];for(let n=0;n<=i[0];n++)e.push(n),n>0&&e.push(-n);for(let n=0;n<e.length;n++)for(let o=0;o<e.length;o++){const s=(e[o]+i[1])*l+(e[n]+i[0]);if(null!=a[s])return{meshId:a[s],pickingId:h[s],point:A[s]||null,coordinate:c[s]||null}}}return{pickingId:null,meshId:null,point:null}}_pick(e,n,i,o,s={}){const a=this._currentShader,h=this._currentMeshes;if(!a||!h||!h.length)return{pickingId:null,meshId:null,point:null};e=Math.round(e),n=Math.round(n);const l=this._fbo;if(e<=2||e>=l.width-2||n<=2||n>=l.height-2)return{pickingId:null,meshId:null,point:null};const{px:c,py:A,width:f,height:d}=this._getParams(e,n,i,l),p=new Uint8Array(4*f*d),g=this._renderer.regl.read({data:p,x:c,y:A,framebuffer:l,width:f,height:d}),v=[];let w=[];for(let e=0;e<g.length;e+=4){const{pickingId:n,meshId:i}=this._packData(g.subarray(e,e+4),a);v.push(i),w.push(n)}const C={},P=v.filter((e=>null!=e&&!C[e]&&(C[e]=1,!0))).map((e=>h[e]));let T;for(let e=0;e<P.length;e++)if(P[e]&&P[e].geometry){T=P[e];break}if(!T)return{pickingId:null,meshId:null,point:null};const S=T.geometry.desc.pickingIdAttribute;v.length&&a===this._shader1&&(void 0!==T.getUniform("uPickingId")||T.geometry.data[S])&&(w=this._getPickingId(c,A,f,d,p,P,o));const I=[],E=[];if(v.length&&s.returnPoint){const{viewMatrix:i,projMatrix:a}=s,h=this._pickDepth(c,A,f,d,p,P,o);for(let o=0;o<h.length;o++)if(h[o]&&null!=v[o]){const s=this._getWorldPos(e,n,h[o],i,a),l=this._convertPickPoint(s);I.push(s),E.push(l)}else I.push(null),E.push(null)}return{meshIds:v,pickingIds:w,coords:E,points:I,width:f,height:d}}_convertPickPoint(e){const n=this._map;if(!n)return null;const i=n.getGLRes();if(!UM){const e=n.getCenter();GM=new e.constructor(0,0,0);const i=n.coordToPoint(e);UM=new i.constructor(0,0)}UM.set(e[0],e[1]);const o=n.pointAtResToCoord(UM,i,GM),s=n.pointAtResToAltitude(e[2],i);return[o.x,o.y,s]}clear(){return this._fbo&&this._clearFbo(this._fbo),this._currentMeshes=[],delete this._currentShader,this}getMeshAt(e){return this._currentMeshes?this._currentMeshes[e]:null}getRenderedMeshes(){return this._currentMeshes}dispose(){this.clear(),this._shader0&&this._shader0.dispose(),this._shader1&&this._shader1.dispose(),this._shader2&&this._shader2.dispose(),this._scene&&this._scene.clear(),this._scene1&&this._scene1.clear()}_getWorldPos(e,n,i,o,s){const a=this._fbo,h=[],l=a.width/2||1,c=a.height/2||1,A=[(e-l)/l,(c-n)/c,0,1],f=[(e-l)/l,(c-n)/c,1,1],d=wv(h,s),p=[],g=[];YM(p,A,d),YM(g,f,d);const v=-p[2],w=(i-v)/(-g[2]-v),C=wv(h,Cv(h,s,o)),P=YM(A,A,C),T=YM(f,f,C);return[nw(P[0],T[0],w),nw(P[1],T[1],w),nw(P[2],T[2],w)]}_getPickingId(e,n,i,o,s,a,h){const l=this._renderer.regl,c=this._getFBO1();this._clearFbo(c),this._scene1.setMeshes(a),this._renderer.render(this._shader2,h,this._scene1,c);const A=l.read({data:s,x:e,y:n,framebuffer:c,width:i,height:o}),f=[];for(let e=0;e<A.length;e+=4)f.push(BM(A.subarray(e,e+4)));return f}_pickDepth(e,n,i,o,s,a,h){const l=this._renderer.regl,c=this._getFBO1();this._scene1.setMeshes(a),this._clearFbo(c),h.logDepthBufFC=2/(Math.log(this._map.cameraFar+1)/Math.LN2),this._renderer.render(this._depthShader,h,this._scene1,c);const A=l.read({data:s,x:e,y:n,framebuffer:c,width:i,height:o}),f=[];for(let e=0;e<A.length;e+=4)f.push((d=A.subarray(e,e+4),HM[0]=d[3],HM[1]=d[2],HM[2]=d[1],HM[3]=d[0],jM[0]));var d;return f}_packData(e,n){if(255===e[0]&&255===e[1]&&255===e[2]&&255===e[3])return{meshId:null,pickingId:null};let i=null,o=null;return n===this._shader1?o=BM(e):n===this._shader0?(o=e[3],i=BM(e)):(o=null,i=BM(e)),{meshId:o,pickingId:i}}_clearFbo(e){this._renderer.regl.clear({color:[1,1,1,1],depth:1,stencil:0,framebuffer:e})}_getShader(e,n){return n&&e.length<256?this._shader0:this._shader1}_getFBO1(){const e=this._renderer.regl,n=this._fbo;return this._fbo1?this._fbo1.width===n.width&&this._fbo1.height===n.height||this._fbo1.resize(n.width,n.height):this._fbo1=e.framebuffer(n.width,n.height),this._fbo1}_getParams(e,n,i,o){const s=i[0],a=i[1];n=o.height-n;let h=2*s+1,l=2*a+1;const c=(e-=s)+h,A=(n-=a)+l;return c>o.width&&(h-=c-o.width),A>o.height&&(l-=A-o.height),{px:e=e<0?0:e,py:n=n<0?0:n,width:h,height:l}}getPickingVert(){return this._vert}getUniformDeclares(){return this._uniforms}};function YM(e,n,i){const o=n[0],s=n[1],a=n[2],h=1/(i[3]*o+i[7]*s+i[11]*a+i[15]);return e[0]=(i[0]*o+i[4]*s+i[8]*a+i[12])*h,e[1]=(i[1]*o+i[5]*s+i[9]*a+i[13])*h,e[2]=(i[2]*o+i[6]*s+i[10]*a+i[14])*h,e}function JM(e){return ew(e)&&(VM[0]=VM[1]=e,e=VM),e}const KM=e=>e&&e.geometry&&void 0===e.geometry.properties.shaderHash,$M=[],tT=[],eT=[{name:"modelViewMatrix",type:"function",fn:(e,n)=>Cv($M,n.viewMatrix,n.modelMatrix)},{name:"modelViewProjMatrix",type:"function",fn:(e,n)=>{const i=Cv($M,n.viewMatrix,n.modelMatrix);return Cv($M,n.projMatrix,i)}},{name:"modelMatrixInverse",type:"function",fn:(e,n)=>wv($M,n.modelMatrix)},{name:"projMatrixInverse",type:"function",fn:(e,n)=>wv($M,n.projMatrix)},{name:"modelViewMatrixInverse",type:"function",fn:(e,n)=>(Cv($M,n.viewMatrix,n.modelMatrix),wv($M,$M))},{name:"modelViewProjMatrixInverse",type:"function",fn:(e,n)=>{const i=Cv($M,n.viewMatrix,n.modelMatrix);return Cv($M,n.projMatrix,i),wv($M,$M)}},{name:"modelInverseTransposeMatrix",type:"function",fn:(e,n)=>{const i=uv(tT,n.modelMatrix),o=Av(i,i);return fv(o,o)}},{name:"modelViewInverseTransposeMatrix",type:"function",fn:(e,n)=>{const i=Cv($M,n.viewMatrix,n.modelMatrix),o=uv(tT,i),s=Av(o,o);return fv(s,s)}}],nT={LOCAL:"positionMatrix",MODEL:"modelMatrix",VIEW:"viewMatrix",PROJECTION:"projMatrix",MODELVIEW:"modelViewMatrix",MODELVIEWPROJECTION:"modelViewProjMatrix",MODELINVERSE:"modelMatrixInverse",VIEWINVERSE:"viewMatrixInverse",PROJECTIONINVERSE:"projMatrixInverse",MODELVIEWINVERSE:"modelViewMatrixInverse",MODELVIEWPROJECTIONINVERSE:"modelViewProjMatrixInverse",MODELINVERSETRANSPOSE:"modelInverseTransposeMatrix",MODELVIEWINVERSETRANSPOSE:"modelViewInverseTransposeMatrix",VIEWPORT:"viewport",JOINTMATRIX:"jointMatrix",ALPHACUTOFF:"alphaCutoff"};let iT=class Nr{constructor(e,n,i){this._regl=e,this._khrShaders={},this._commandProps=n,this._resLoader=i}getExcludeFilter(){return KM}forEachShader(e){for(const n in this._khrShaders){const i=this._khrShaders[n];e(i.shader,i.filter,i.uniformSemantics)}}createMesh(e,n,i,o){const s=n.extensions.KHR_techniques_webgl,a=n.materials[e.material].extensions.KHR_techniques_webgl,{technique:h,values:l}=a,c=s.techniques[h],A=s.programs[c.program],f=s.shaders[A.vertexShader],d=s.shaders[A.fragmentShader];d.content=function(e){return e&&e.indexOf("precision")<0?"precision mediump float;\n"+e:e}(d.content);const p=dw(f.content)+"-"+dw(d.content);this._khrShaders[p]||(this._khrShaders[p]=this._createTechniqueShader(p,s,h,this._commandProps,o));const{attributeSemantics:g}=this._khrShaders[p],v=this._createGeometry(e,g,i,p),w=$b({},l);for(const e in l)c.uniforms[e]&&35678===c.uniforms[e].type&&(w[e]=this._getTexture(n.textures[l[e].index]));return{geometry:v,material:new cC(w)}}_createGeometry(e,n,i,o){const s=e.attributes,a="COLOR_0";if(s[a]){const e=s[a].array||s[a];if(e instanceof Float32Array){const n=new Uint8Array(e.length);for(let i=0;i<n.length;i++)n[i]=Math.round(255*e[i]);s[a].array?(s[a].array=n,s[a].componentType=5121):s[a]=n}}const h={};for(const e in s){const i=Jw(this._regl,s[e],{dimension:s[e].itemSize}),o=n[e]||e;h[o]={buffer:i},s[e].quantization&&(h[o].quantization=s[e].quantization),o===n.POSITION&&(h[o].array=s[e].array)}const l=new Lw(h,e.indices.array?e.indices.array:e.indices,0,{positionAttribute:n.POSITION,normalAttribute:n.NORMAL,uv0Attribute:n.TEXCOORD_0,uv1Attribute:n.TEXCOORD_1,color0Attribute:n.COLOR_0,tangentAttribute:n.TANGENT,textureCoordMatrixAttribute:n.TextureCoordMatrix,primitive:void 0===e.mode?"triangles":zw(e.mode)});l.generateBuffers(this._regl,{excludeElementsInVAO:i}),l.properties.shaderHash=o;const c=l.data[l.desc.positionAttribute];return c&&c.array&&delete c.array,l}_getTexture(e){const n={type:e.type?Hw(e.type):"uint8",format:e.format?Uw(e.format):"rgba",flipY:!!e.flipY},i=e.image;i.array?n.data=i.array:i.mipmap&&(n.mipmap=i.mipmap),n.width=i.width,n.height=i.height;const o=e.sampler||e.texture.sampler;return o&&(o.magFilter&&(n.mag=Vw(o.magFilter)),o.minFilter&&(n.min=qw(o.minFilter)),o.wrapS&&(n.wrapS=Qw(o.wrapS)),o.wrapT&&(n.wrapT=Qw(o.wrapT))),new VC(n,this._resLoader)}_createTechniqueShader(e,n,i,o,s){const{techniques:a,programs:h,shaders:l}=n,c=a[i],A=h[c.program],f=l[A.vertexShader].content,d=l[A.fragmentShader].content,p={};for(const e in c.uniforms){const n=c.uniforms[e];n.semantic&&(p[n.semantic]=e)}const g=eT.slice();for(const e in p)g.push({name:p[e],type:"function",fn:(n,i)=>i[nT[e]]});const v=new eP({vert:f,frag:d,uniforms:g,extraCommandProps:o});s&&(v.version=300);const w={};for(const e in c.attributes)w[c.attributes[e].semantic]=e;return{shader:v,filter:n=>n&&n.geometry&&n.geometry.properties.shaderHash===e,uniformSemantics:p,attributeSemantics:w}}dispose(){for(const e in this._khrShaders){const{shader:n}=this._khrShaders[e];n.dispose()}this._khrShaders={}}};var rT={exports:{}};function oT(e,n,i){i=i||2;var o,s,a,h,l,c,A,f=n&&n.length,d=f?n[0]*i:e.length,p=sT(e,0,d,i,!0),g=[];if(!p||p.next===p.prev)return g;if(f&&(p=function(e,n,i,o){var s,a,h,l=[];for(s=0,a=n.length;s<a;s++)(h=sT(e,n[s]*o,s<a-1?n[s+1]*o:e.length,o,!1))===h.next&&(h.steiner=!0),l.push(mT(h));for(l.sort(fT),s=0;s<l.length;s++)i=dT(l[s],i);return i}(e,n,p,i)),e.length>80*i){o=a=e[0],s=h=e[1];for(var v=i;v<d;v+=i)(l=e[v])<o&&(o=l),(c=e[v+1])<s&&(s=c),l>a&&(a=l),c>h&&(h=c);A=0!==(A=Math.max(a-o,h-s))?32767/A:0}return hT(p,g,i,o,s,A,0),g}function sT(e,n,i,o,s){var a,h;if(s===ET(e,n,i,o)>0)for(a=n;a<i;a+=o)h=TT(a,e[a],e[a+1],h);else for(a=i-o;a>=n;a-=o)h=TT(a,e[a],e[a+1],h);return h&&xT(h,h.next)&&(ST(h),h=h.next),h}function aT(e,n){if(!e)return e;n||(n=e);var i,o=e;do{if(i=!1,o.steiner||!xT(o,o.next)&&0!==_T(o.prev,o,o.next))o=o.next;else{if(ST(o),(o=n=o.prev)===o.next)break;i=!0}}while(i||o!==n);return n}function hT(e,n,i,o,s,a,h){if(e){!h&&a&&function(e,n,i,o){var s=e;do{0===s.z&&(s.z=gT(s.x,s.y,n,i,o)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next}while(s!==e);s.prevZ.nextZ=null,s.prevZ=null,function(e){var n,i,o,s,a,h,l,c,A=1;do{for(i=e,e=null,a=null,h=0;i;){for(h++,o=i,l=0,n=0;n<A&&(l++,o=o.nextZ);n++);for(c=A;l>0||c>0&&o;)0!==l&&(0===c||!o||i.z<=o.z)?(s=i,i=i.nextZ,l--):(s=o,o=o.nextZ,c--),a?a.nextZ=s:e=s,s.prevZ=a,a=s;i=o}a.nextZ=null,A*=2}while(h>1)}(s)}(e,o,s,a);for(var l,c,A=e;e.prev!==e.next;)if(l=e.prev,c=e.next,a?uT(e,o,s,a):lT(e))n.push(l.i/i|0),n.push(e.i/i|0),n.push(c.i/i|0),ST(e),e=c.next,A=c.next;else if((e=c)===A){h?1===h?hT(e=cT(aT(e),n,i),n,i,o,s,a,2):2===h&&AT(e,n,i,o,s,a):hT(aT(e),n,i,o,s,a,1);break}}}function lT(e){var n=e.prev,i=e,o=e.next;if(_T(n,i,o)>=0)return!1;for(var s=n.x,a=i.x,h=o.x,l=n.y,c=i.y,A=o.y,f=s<a?s<h?s:h:a<h?a:h,d=l<c?l<A?l:A:c<A?c:A,p=s>a?s>h?s:h:a>h?a:h,g=l>c?l>A?l:A:c>A?c:A,v=o.next;v!==n;){if(v.x>=f&&v.x<=p&&v.y>=d&&v.y<=g&&yT(s,l,a,c,h,A,v.x,v.y)&&_T(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function uT(e,n,i,o){var s=e.prev,a=e,h=e.next;if(_T(s,a,h)>=0)return!1;for(var l=s.x,c=a.x,A=h.x,f=s.y,d=a.y,p=h.y,g=l<c?l<A?l:A:c<A?c:A,v=f<d?f<p?f:p:d<p?d:p,w=l>c?l>A?l:A:c>A?c:A,C=f>d?f>p?f:p:d>p?d:p,P=gT(g,v,n,i,o),T=gT(w,C,n,i,o),S=e.prevZ,I=e.nextZ;S&&S.z>=P&&I&&I.z<=T;){if(S.x>=g&&S.x<=w&&S.y>=v&&S.y<=C&&S!==s&&S!==h&&yT(l,f,c,d,A,p,S.x,S.y)&&_T(S.prev,S,S.next)>=0)return!1;if(S=S.prevZ,I.x>=g&&I.x<=w&&I.y>=v&&I.y<=C&&I!==s&&I!==h&&yT(l,f,c,d,A,p,I.x,I.y)&&_T(I.prev,I,I.next)>=0)return!1;I=I.nextZ}for(;S&&S.z>=P;){if(S.x>=g&&S.x<=w&&S.y>=v&&S.y<=C&&S!==s&&S!==h&&yT(l,f,c,d,A,p,S.x,S.y)&&_T(S.prev,S,S.next)>=0)return!1;S=S.prevZ}for(;I&&I.z<=T;){if(I.x>=g&&I.x<=w&&I.y>=v&&I.y<=C&&I!==s&&I!==h&&yT(l,f,c,d,A,p,I.x,I.y)&&_T(I.prev,I,I.next)>=0)return!1;I=I.nextZ}return!0}function cT(e,n,i){var o=e;do{var s=o.prev,a=o.next.next;!xT(s,a)&&bT(s,o,o.next,a)&&PT(s,a)&&PT(a,s)&&(n.push(s.i/i|0),n.push(o.i/i|0),n.push(a.i/i|0),ST(o),ST(o.next),o=e=a),o=o.next}while(o!==e);return aT(o)}function AT(e,n,i,o,s,a){var h=e;do{for(var l=h.next.next;l!==h.prev;){if(h.i!==l.i&&vT(h,l)){var c=MT(h,l);return h=aT(h,h.next),c=aT(c,c.next),hT(h,n,i,o,s,a,0),void hT(c,n,i,o,s,a,0)}l=l.next}h=h.next}while(h!==e)}function fT(e,n){return e.x-n.x}function dT(e,n){var i=function(e,n){var i,o=n,s=e.x,a=e.y,h=-1/0;do{if(a<=o.y&&a>=o.next.y&&o.next.y!==o.y){var l=o.x+(a-o.y)*(o.next.x-o.x)/(o.next.y-o.y);if(l<=s&&l>h&&(h=l,i=o.x<o.next.x?o:o.next,l===s))return i}o=o.next}while(o!==n);if(!i)return null;var c,A=i,f=i.x,d=i.y,p=1/0;o=i;do{s>=o.x&&o.x>=f&&s!==o.x&&yT(a<d?s:h,a,f,d,a<d?h:s,a,o.x,o.y)&&(c=Math.abs(a-o.y)/(s-o.x),PT(o,e)&&(c<p||c===p&&(o.x>i.x||o.x===i.x&&pT(i,o)))&&(i=o,p=c)),o=o.next}while(o!==A);return i}(e,n);if(!i)return n;var o=MT(i,e);return aT(o,o.next),aT(i,i.next)}function pT(e,n){return _T(e.prev,e,n.prev)<0&&_T(n.next,e,e.next)<0}function gT(e,n,i,o,s){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*s|0)|e<<8))|e<<4))|e<<2))|e<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-o)*s|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function mT(e){var n=e,i=e;do{(n.x<i.x||n.x===i.x&&n.y<i.y)&&(i=n),n=n.next}while(n!==e);return i}function yT(e,n,i,o,s,a,h,l){return(s-h)*(n-l)>=(e-h)*(a-l)&&(e-h)*(o-l)>=(i-h)*(n-l)&&(i-h)*(a-l)>=(s-h)*(o-l)}function vT(e,n){return e.next.i!==n.i&&e.prev.i!==n.i&&!function(e,n){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==n.i&&i.next.i!==n.i&&bT(i,i.next,e,n))return!0;i=i.next}while(i!==e);return!1}(e,n)&&(PT(e,n)&&PT(n,e)&&function(e,n){var i=e,o=!1,s=(e.x+n.x)/2,a=(e.y+n.y)/2;do{i.y>a!=i.next.y>a&&i.next.y!==i.y&&s<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(o=!o),i=i.next}while(i!==e);return o}(e,n)&&(_T(e.prev,e,n.prev)||_T(e,n.prev,n))||xT(e,n)&&_T(e.prev,e,e.next)>0&&_T(n.prev,n,n.next)>0)}function _T(e,n,i){return(n.y-e.y)*(i.x-n.x)-(n.x-e.x)*(i.y-n.y)}function xT(e,n){return e.x===n.x&&e.y===n.y}function bT(e,n,i,o){var s=CT(_T(e,n,i)),a=CT(_T(e,n,o)),h=CT(_T(i,o,e)),l=CT(_T(i,o,n));return s!==a&&h!==l||!(0!==s||!wT(e,i,n))||!(0!==a||!wT(e,o,n))||!(0!==h||!wT(i,e,o))||!(0!==l||!wT(i,n,o))}function wT(e,n,i){return n.x<=Math.max(e.x,i.x)&&n.x>=Math.min(e.x,i.x)&&n.y<=Math.max(e.y,i.y)&&n.y>=Math.min(e.y,i.y)}function CT(e){return e>0?1:e<0?-1:0}function PT(e,n){return _T(e.prev,e,e.next)<0?_T(e,n,e.next)>=0&&_T(e,e.prev,n)>=0:_T(e,n,e.prev)<0||_T(e,e.next,n)<0}function MT(e,n){var i=new IT(e.i,e.x,e.y),o=new IT(n.i,n.x,n.y),s=e.next,a=n.prev;return e.next=n,n.prev=e,i.next=s,s.prev=i,o.next=i,i.prev=o,a.next=o,o.prev=a,o}function TT(e,n,i,o){var s=new IT(e,n,i);return o?(s.next=o.next,s.prev=o,o.next.prev=s,o.next=s):(s.prev=s,s.next=s),s}function ST(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function IT(e,n,i){this.i=e,this.x=n,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ET(e,n,i,o){for(var s=0,a=n,h=i-o;a<i;a+=o)s+=(e[h]-e[a])*(e[a+1]+e[h+1]),h=a;return s}rT.exports=oT,rT.exports.default=oT,oT.deviation=function(e,n,i,o){var s=n&&n.length,a=Math.abs(ET(e,0,s?n[0]*i:e.length,i));if(s)for(var h=0,l=n.length;h<l;h++)a-=Math.abs(ET(e,n[h]*i,h<l-1?n[h+1]*i:e.length,i));var c=0;for(h=0;h<o.length;h+=3){var A=o[h]*i,f=o[h+1]*i,d=o[h+2]*i;c+=Math.abs((e[A]-e[d])*(e[f+1]-e[A+1])-(e[A]-e[f])*(e[d+1]-e[A+1]))}return 0===a&&0===c?0:Math.abs((c-a)/a)},oT.flatten=function(e){for(var n=e[0][0].length,i={vertices:[],holes:[],dimensions:n},o=0,s=0;s<e.length;s++){for(var a=0;a<e[s].length;a++)for(var h=0;h<n;h++)i.vertices.push(e[s][a][h]);s>0&&i.holes.push(o+=e[s-1].length)}return i};var OT=function(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}(rT.exports);const RT={parseHDR:jC},DT={PBRHelper:CM,StandardMaterial:MM,StandardSpecularGlossinessMaterial:TM,StandardShader:class extends eP{constructor(e={}){let n=e.extraCommandProps||{};const i=e.uniforms;n=$b({},n);const o=e.defines||{},s=[],a=[],h=[],l=[],c=[],A=[{name:"modelNormalMatrix",type:"function",fn:(e,n)=>uv(s,n.modelMatrix)},{name:"modelViewNormalMatrix",type:"function",fn:(e,n)=>{const i=Cv(a,n.viewMatrix,n.modelMatrix),o=wv(i,i),s=bv(o,o);return uv(h,s)}},{name:"modelViewMatrix",type:"function",fn:(e,n)=>Cv(l,n.viewMatrix,n.modelMatrix)},{name:"environmentTransform",type:"function",fn:(e,n)=>pv(c,Math.PI*(n.environmentOrientation||0)/180)}];i&&A.push(...i),super({vert:e.vert||"#include <gl2_vert>\n#define SHADER_NAME PBR\nprecision highp float;\nattribute vec3 aPosition;\n#if defined(HAS_MAP)\nattribute vec2 aTexCoord;\nuniform vec2 uvOrigin;\nuniform vec2 uvScale;\nuniform vec2 uvOffset;\nuniform float uvRotation;\n#ifdef HAS_I3S_UVREGION\nattribute vec4 uvRegion;\nvarying vec4 vUvRegion;\n#endif\n#if defined(HAS_AO_MAP)\nattribute vec2 aTexCoord1;\nvarying vec2 vTexCoord1;\n#endif\n#endif\nvec3 c;\nvec3 d;\nvec4 e;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 positionMatrix;\nuniform mat4 projMatrix;\nuniform mediump vec3 cameraPosition;\nuniform mat3 modelNormalMatrix;\n#ifdef HAS_SSR\nuniform mat3 modelViewNormalMatrix;\nvarying vec3 vViewNormal;\n#ifdef HAS_TANGENT\nvarying vec4 vViewTangent;\n#endif\n#endif\nvarying vec3 vModelNormal;\nvarying vec4 vViewVertex;\n#if defined(HAS_TANGENT)\nvarying vec4 vModelTangent;\nvarying vec3 vModelBiTangent;\n#endif\nvarying vec3 vModelVertex;\n#if defined(HAS_MAP)\nvarying vec2 vTexCoord;\n#endif\n#if defined(HAS_COLOR)\nattribute vec4 aColor;\nvarying vec4 vColor;\n#endif\n#ifdef HAS_OPACITY\nattribute float aOpacity;\n#endif\nvarying float vOpacity;\n#include <highlight_vert>\n#if defined(HAS_COLOR0)\n#if COLOR0_SIZE == 3\nattribute vec3 aColor0;\nvarying vec3 vColor0;\n#else\nattribute vec4 aColor0;\nvarying vec4 vColor0;\n#endif\n#endif\n#include <line_extrusion_vert>\n#include <get_output>\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_vert>\n#endif\n#include <heatmap_render_vert>\n#include <vertex_color_vert>\n#if defined(HAS_BUMP_MAP) && defined(HAS_TANGENT)\nvarying vec3 vTangentViewPos;\nvarying vec3 vTangentFragPos;\n#if __VERSION__ == 100\nmat3 f(in mat3 h) {\n  vec3 i = h[0];\n  vec3 j = h[1];\n  vec3 k = h[2];\n  return mat3(vec3(i.x, j.x, k.x), vec3(i.y, j.y, k.y), vec3(i.z, j.z, k.z));\n}\n#else\nmat3 f(in mat3 h) {\n  return transpose(h);\n}\n#endif\n#endif\nvoid l(const highp vec4 q, out highp vec3 m) {\n  m = vec3(.0, .0, 1.) + vec3(2., -2., -2.) * q.x * q.zwx + vec3(2., 2., -2.) * q.y * q.wzy;\n}\nvoid l(const highp vec4 q, out highp vec3 m, out highp vec3 t) {\n  l(q, m);\n  t = vec3(1., .0, .0) + vec3(-2., 2., -2.) * q.y * q.yxw + vec3(-2., 2., 2.) * q.z * q.zwx;\n}\nconst float o = .5;\nvec2 u(vec2 v, float A) {\n  return vec2(cos(A) * (v.x - o) + sin(A) * (v.y - o) + o, cos(A) * (v.y - o) - sin(A) * (v.x - o) + o);\n}\n#if defined(HAS_MAP)\nvec2 B(vec2 v) {\n  vec2 C = decode_getTexcoord(v);\n#ifdef HAS_RANDOM_TEX\nvec2 D = uvOrigin;\n  vec2 E = C * uvScale + uvOffset;\n  return mod(D, 1.) + E;\n#else\nvec2 D = uvOrigin;\n  vec2 E = C * uvScale;\n  if(uvRotation != .0) {\n    D = u(D, uvRotation);\n    E = u(E, uvRotation);\n  }\n  return mod(D, 1.) + E + uvOffset;\n#endif\n}\n#endif\n#ifdef PICKING_MODE\n#include <fbo_picking_vert>\n#endif\n#include <excavate_vert>\nvoid main() {\n  mat4 F = getPositionMatrix();\n#ifdef IS_LINE_EXTRUSION\nvec3 G = getLineExtrudePosition(aPosition);\n  vec4 H = getPosition(G);\n#else\nvec4 H = getPosition(aPosition);\n#endif\nvModelVertex = (modelMatrix * H).xyz;\n  vec4 I = F * H;\n  vec4 J = modelViewMatrix * I;\n  vViewVertex = J;\n#ifdef HAS_MASK_EXTENT\ngl_Position = projMatrix * getMaskPosition(I, modelMatrix);\n#else\ngl_Position = projMatrix * J;\n#endif\n#ifdef PICKING_MODE\nfloat K = 1.;\n#if defined(HAS_COLOR)\nK *= aColor.a;\n#endif\n#if defined(HAS_COLOR0) && COLOR0_SIZE == 4\nK *= aColor0.a;\n#endif\nfbo_picking_setData(gl_Position.w, K != .0);\n#else\n#if defined(HAS_MAP)\nvTexCoord = B(aTexCoord);\n#ifdef HAS_AO_MAP\nvTexCoord1 = B(aTexCoord1);\n#endif\n#ifdef HAS_I3S_UVREGION\nvUvRegion = uvRegion / 65535.;\n#endif\n#endif\n#if defined(HAS_TANGENT) || defined(HAS_NORMAL)\nmat3 L = mat3(F);\n  mat3 M = modelNormalMatrix * L;\n#if defined(HAS_TANGENT)\nvec3 t;\n  l(aTangent, d, t);\n  vModelTangent = vec4(M * t, aTangent.w);\n#else\nd = decode_getNormal(aNormal);\n#endif\nvec3 N = d;\n  vModelNormal = M * N;\n#else\nd = vec3(.0);\n  vModelNormal = vec3(.0);\n#endif\n#if defined(HAS_TANGENT)\nvModelBiTangent = cross(vModelNormal, vModelTangent.xyz) * sign(aTangent.w);\n#endif\n#ifdef HAS_SSR\nmat3 O = modelViewNormalMatrix * L;\n  vViewNormal = O * d;\n#if defined(HAS_TANGENT)\nvec4 P = vec4(t, aTangent.w);\n  vViewTangent = vec4(O * P.xyz, P.w);\n#endif\n#endif\n#if defined(HAS_COLOR)\nvColor = aColor / 255.;\n#endif\n#ifdef HAS_OPACITY\nvOpacity = aOpacity / 255.;\n#else\nvOpacity = 1.;\n#endif\nhighlight_setVarying();\n#if defined(HAS_COLOR0)\nvColor0 = aColor0 / 255.;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nshadow_computeShadowPars(I);\n#endif\n#ifdef HAS_HEATMAP\nheatmap_compute(projMatrix * modelViewMatrix * F, H);\n#endif\n#if defined(HAS_BUMP_MAP) && defined(HAS_TANGENT)\nmat3 Q = f(mat3(vModelTangent.xyz, vModelBiTangent, vModelNormal));\n  vTangentViewPos = Q * cameraPosition;\n  vTangentFragPos = Q * vModelVertex;\n#endif\n#ifdef HAS_VERTEX_COLOR\nvertexColor_update();\n#endif\n#ifdef HAS_EXCAVATE_ANALYSIS\nvCoordinateTexcoord = getCoordinateTexcoord();\n  vHeight = getWorldHeight();\n#endif\n#endif\n}",frag:e.frag||"#define PI 3.141593\n#define RECIPROCAL_PI 1.0\n#if __VERSION__ == 100\n#if defined(GL_EXT_shader_texture_lod)\n#extension GL_EXT_shader_texture_lod : enable\n#define textureCubeLod(tex, uv, lod) textureCubeLodEXT(tex, uv, lod)\n#else\n#define textureCubeLod(tex, uv, lod) textureCube(tex, uv, lod)\n#endif\n#if defined(GL_OES_standard_derivatives)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#else\n#define textureCubeLod(tex, uv, lod) textureLod(tex, uv, lod)\n#endif\n#define saturate(x)        clamp(x, 0.0, 1.0)\nprecision mediump float;\n#include <gl2_frag>\n#include <hsv_frag>\n#include <srgb_frag>\nuniform vec3 hsv;\nuniform float contrast;\nstruct MaterialUniforms {\n  vec2 roughnessMetalness;\n  vec3 albedo;\n  float alpha;\n  vec3 normal;\n  vec3 emit;\n  float ao;\n  vec3 specularColor;\n  float glossiness;\n  vec4 skinColor;\n} c;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_frag>\n#endif\nuniform vec3 cameraPosition;\nuniform float alphaTest;\n#if defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\nuniform vec4 diffuseFactor;\nuniform vec3 specularFactor;\nuniform float glossinessFactor;\n#if defined(HAS_DIFFUSE_MAP)\nuniform sampler2D diffuseTexture;\n#endif\n#if defined(HAS_SPECULARGLOSSINESS_MAP)\nuniform sampler2D specularGlossinessTexture;\n#endif\n#endif\nuniform vec3 emissiveFactor;\nuniform vec4 baseColorFactor;\nuniform float baseColorIntensity;\nuniform float emitColorFactor;\nuniform float occlusionFactor;\nuniform float environmentExposure;\nuniform float roughnessFactor;\nuniform float metallicFactor;\nuniform float normalMapFactor;\nuniform float specularF0;\nuniform int emitMultiplicative;\nuniform int normalMapFlipY;\nuniform int outputSRGB;\nuniform mat3 environmentTransform;\n#if defined(HAS_ALBEDO_MAP)\nuniform sampler2D baseColorTexture;\n#endif\n#if defined(HAS_METALLICROUGHNESS_MAP)\nuniform sampler2D metallicRoughnessTexture;\n#endif\n#if defined(HAS_EMISSIVE_MAP)\nuniform sampler2D emissiveTexture;\n#endif\n#if defined(HAS_AO_MAP)\nuniform sampler2D occlusionTexture;\nvarying vec2 vTexCoord1;\n#endif\n#if defined(HAS_NORMAL_MAP) && defined(HAS_TANGENT)\nuniform sampler2D normalTexture;\n#endif\n#if defined(HAS_SKIN_MAP)\nuniform sampler2D skinTexture;\n#endif\n#if defined(ALPHA_MODE) && ALPHA_MODE == 1\nuniform float alphaCutoff;\n#endif\n#ifdef HAS_RANDOM_TEX\nuniform highp vec2 uvOrigin;\nuniform sampler2D noiseTexture;\n#endif\nuniform sampler2D brdfLUT;\n#if defined(HAS_IBL_LIGHTING)\nuniform vec3 hdrHSV;\nuniform samplerCube prefilterMap;\nuniform vec3 diffuseSPH[9];\nuniform vec2 prefilterMiplevel;\nuniform vec2 prefilterSize;\n#else\nuniform vec3 ambientColor;\n#endif\nuniform vec2 cameraNearFar;\nuniform vec3 light0_viewDirection;\nuniform vec4 light0_diffuse;\n#ifdef HAS_SSR\nvarying vec3 vViewNormal;\n#if defined(HAS_TANGENT)\nvarying vec4 vViewTangent;\n#endif\n#endif\nvarying vec3 vModelVertex;\nvarying vec4 vViewVertex;\n#if defined(HAS_MAP)\n#include <computeTexcoord_frag>\n#endif\nvarying vec3 vModelNormal;\n#if defined(HAS_TANGENT)\nvarying vec4 vModelTangent;\nvarying vec3 vModelBiTangent;\n#endif\n#if defined(HAS_COLOR0)\n#if COLOR0_SIZE == 3\nvarying vec3 vColor0;\n#else\nvarying vec4 vColor0;\n#endif\n#endif\n#if defined(HAS_COLOR)\nvarying vec4 vColor;\n#elif defined(IS_LINE_EXTRUSION)\nuniform vec4 lineColor;\n#else\nuniform vec4 polygonFill;\n#endif\n#ifdef HAS_LAYER_OPACITY\nuniform float layerOpacity;\n#endif\nvarying float vOpacity;\n#ifdef HAS_INSTANCE_COLOR\nvarying vec4 vInstanceColor;\n#endif\n#ifdef IS_LINE_EXTRUSION\nuniform float lineOpacity;\n#else\nuniform float polygonOpacity;\n#endif\n#ifdef HAS_PATTERN\nuniform sampler2D linePatternFile;\nuniform vec2 atlasSize;\nuniform float flipY;\nuniform float currentTime;\nuniform float animSpeedScale;\n#ifdef HAS_PATTERN_ANIM\nvarying float vLinePatternAnimSpeed;\n#else\nuniform float linePatternAnimSpeed;\n#endif\n#ifdef HAS_PATTERN_GAP\nvarying float vLinePatternGap;\n#else\nuniform float linePatternGap;\n#endif\nuniform vec4 linePatternGapColor;\nuniform vec2 uvScale;\nvarying float vPatternHeight;\nvarying float vLinesofar;\nvarying vec4 vTexInfo;\nvarying float vNormalY;\nvec2 d(vec2 e) {\n  vec2 f = mod(e, 1.);\n  vec2 h = vTexInfo.xy;\n  vec2 i = vTexInfo.zw;\n  return (h + f * i) / atlasSize;\n}\n#endif\n#include <heatmap_render_frag>\n#include <snow_frag>\n#include <mask_frag>\n#include <terrain_normal_frag>\n#include <vertex_color_frag>\n#include <excavate_frag>\n#ifdef HAS_RANDOM_TEX\nconst float j = .5;\nvec2 k(vec2 f, float l) {\n  return vec2(cos(l) * (f.x - j) + sin(l) * (f.y - j) + j, cos(l) * (f.y - j) - sin(l) * (f.x - j) + j);\n}\nfloat m(vec3 n) {\n  return n.x + n.y + n.z;\n}\n#endif\nvec4 o(sampler2D u, in vec2 f) {\n  \n#ifdef HAS_RANDOM_TEX\nhighp vec2 A = uvOrigin;\n  highp vec2 B = f + A - mod(A, 1.);\n  float C = texture2D(noiseTexture, .005 * B).x;\n  vec2 D = dFdx(B);\n  vec2 E = dFdx(B);\n  float F = C * 8.;\n  float G = fract(F);\n#if 1\nfloat H = floor(F);\n  float I = H + 1.;\n#else\nfloat H = floor(F + .5);\n  float I = floor(F);\n  G = min(G, 1. - G) * 2.;\n#endif\nvec2 J = sin(vec2(3., 7.) * H);\n  vec2 K = sin(vec2(3., 7.) * I);\n  float L = .5;\n  vec4 M = texture2DGradEXT(u, f + L * J, D, E);\n  vec4 N = texture2DGradEXT(u, f + L * K, D, E);\n  return mix(M, N, smoothstep(.2, .8, G - .1 * m(M.xyz - N.xyz)));\n#else\nreturn texture2D(u, f);\n#endif\n}\n#if defined(HAS_BUMP_MAP) && defined(HAS_TANGENT)\nuniform sampler2D bumpTexture;\nuniform float bumpScale;\nuniform float bumpMaxLayers;\nuniform float bumpMinLayers;\nvec2 O(vec2 f, vec3 P) {\n  float Q = mix(bumpMaxLayers, bumpMinLayers, abs(dot(vec3(.0, .0, 1.), P)));\n  float R = 1. / Q;\n  float S = .0;\n  vec2 T = P.xy * bumpScale / (P.z * Q);\n  vec2 U = f;\n  float V = o(bumpTexture, U).r;\n  for(int W = 0; W < 30; W++) {\n    S += R;\n    U -= T;\n    V = o(bumpTexture, U).r;\n    if(V < S) {\n      break;\n    }\n  }\n  vec2 X = U + T;\n  float Y = V - S;\n  float Z = o(bumpTexture, X).r - S + R;\n  return mix(U, X, Y / (Y - Z));\n}\nvarying vec3 vTangentViewPos;\nvarying vec3 vTangentFragPos;\n#endif\n#define SHADER_NAME PBR\nvec3 ba() {\n  return c.albedo;\n}\nfloat bb() {\n  return c.alpha;\n}\nfloat bc() {\n  return c.roughnessMetalness.y;\n}\nfloat bd() {\n  \n#if defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\nreturn 1. - c.glossiness;\n#else\nreturn c.roughnessMetalness.x;\n#endif\n}\nvec3 be() {\n  return c.emit;\n}\nvec4 bf() {\n  return c.skinColor;\n}\nvec3 bg() {\n  return c.normal;\n}\nfloat bh() {\n  return c.ao;\n}\nfloat bi(const in vec4 bj) {\n  return bj.r + bj.g / 255.;\n}\nvec3 bk(const in float bl, in vec3 bm, const in vec3 t, const in vec3 b, in vec3 bn) {\n  bm.xy = bl * bm.xy;\n  mat3 bo = mat3(t, b, bn);\n  return normalize(bo * bm);\n}\nfloat bp(const float bq, const vec3 bm, const vec3 br) {\n  float bs = clamp(dot(bm, br), 0., 1.);\n  float a = bq * bq;\n  float bt = a * a;\n  float bu = (bs * bt - bs) * bs + 1.;\n  return bt / (PI * bu * bu);\n}\nvec3 bv(const vec3 bw, const float bx, const in vec3 by, const in vec3 br) {\n  float bz = clamp(dot(by, br), 0., 1.);\n  bz = pow(1. - bz, 5.);\n  return bx * bz + (1. - bz) * bw;\n}\nfloat bA(const in vec3 bm, const in vec3 bB, const in float bq, const float bC) {\n  float bD = clamp(dot(bm, bB), 0., 1.);\n  float a = bq * bq;\n  float bE = bD * (bC * (1. - a) + a);\n  float bF = bC * (bD * (1. - a) + a);\n  return .5 / (bF + bE);\n}\nvec3 bG(const float bq, const vec3 bm, const vec3 bB, const vec3 by, const vec3 bH, const float bC, const float bx) {\n  vec3 br = normalize(bB + by);\n  float bI = bp(bq, bm, br);\n  float bJ = bA(bm, bB, bq, bC);\n  vec3 bK = bv(bH, bx, by, br);\n  return (bI * bJ * PI) * bK;\n}\nvec3 bL(const in vec3 bM) {\n  return RECIPROCAL_PI * bM;\n}\nvoid bN(const in vec3 bm, const in vec3 bB, const in float bC, const in float bq, const in vec3 bO, const in vec3 bH, const in vec3 bP, const in vec3 by, const in float bx, out vec3 bQ, out vec3 bR) {\n  if(bC <= .0) {\n    bR = bQ = vec3(.0);\n    return;\n  }\n  vec3 a = bC * bP;\n  vec3 bS = bG(bq, bm, bB, by, bH, bC, bx);\n  bR = a * bS;\n  bQ = a * bL(bO);\n}\n#if defined(HAS_IBL_LIGHTING)\nvec3 bT(const in vec3 bm) {\n  vec3 bn = environmentTransform * bm;\n  float x = bn.x;\n  float y = bn.y;\n  float z = bn.z;\n  vec3 bU = (diffuseSPH[0] + diffuseSPH[1] * x + diffuseSPH[2] * y + diffuseSPH[3] * z + diffuseSPH[4] * z * x + diffuseSPH[5] * y * z + diffuseSPH[6] * y * x + diffuseSPH[7] * (3. * z * z - 1.) + diffuseSPH[8] * (x * x - y * y));\n  if(length(hdrHSV) > .0) {\n    bU = hsv_apply(bU, hdrHSV);\n  }\n  return max(bU, vec3(.0));\n}\nvec3 bV(const in float bq, const in vec3 bW) {\n  vec3 bX = bW;\n  float bY = prefilterMiplevel.x;\n  float bZ = min(bY, bq * prefilterMiplevel.y);\n  vec3 ca = textureCubeLod(prefilterMap, bX, bZ).rgb;\n  if(length(hdrHSV) > .0) {\n    return hsv_apply(ca, hdrHSV);\n  } else {\n    return ca;\n  }\n}\nvec3 cb(const in vec3 cc, const in vec3 bB, const in float bq, const in vec3 cd, const in vec3 bO) {\n  float ce = 1. - bq;\n  vec3 bW = mix(cc, reflect(-bB, cc), ce * (sqrt(ce) + bq));\n  float bl = clamp(1. + dot(bW, cd), .0, 1.);\n  vec3 cf = bV(bq, environmentTransform * bW) * bl * bl;\n  return cf;\n}\n#else\nvec3 cb(const in vec3 bm, const in vec3 cg, const in float bq, const in vec3 cd, const in vec3 bO) {\n  return ambientColor * bL(bO);\n}\n#endif\nvec3 ch(const in vec3 ci, const in float bq, const in float bD, const in float bx) {\n  vec4 rgba = texture2D(brdfLUT, vec2(bD, bq)) * vec4(255., 65280.0, 255., 65280.0);\n  float b = (rgba[3] + rgba[2]);\n  float a = (rgba[1] + rgba[0]);\n  return (ci * a + b * bx) / 65535.;\n}\nvec3 cj(const in vec3 bm, const in vec3 cg, const in float bD, const in float bq, const in vec3 bH, const in vec3 cd, const in float bx, const in vec3 bO) {\n  return cb(bm, cg, bq, cd, bO) * ch(bH, bq, bD, bx);\n}\nfloat ck(const in float cl, const in float bD) {\n  float bu = bD + cl;\n  return clamp(bu * bu - 1. + cl, .0, 1.);\n}\nvoid cm() {\n  \n#ifdef HAS_MAP\nvec2 f = computeTexCoord(vTexCoord);\n#endif\n#ifdef HAS_UV_FLIP\nf.y = 1. - f.y;\n#endif\n#if defined(HAS_BUMP_MAP) && defined(HAS_TANGENT)\nf = O(f, normalize(vTangentViewPos - vTangentFragPos));\n#endif\nc.albedo = baseColorIntensity * baseColorFactor.rgb;\n  c.alpha = baseColorFactor.a * vOpacity;\n#if defined(HAS_PATTERN)\nfloat cn = vLinesofar;\n  vec2 i = vTexInfo.zw;\n#ifdef HAS_PATTERN_GAP\nfloat co = vLinePatternGap;\n#else\nfloat co = linePatternGap;\n#endif\n#ifdef HAS_PATTERN_ANIM\nfloat cp = vLinePatternAnimSpeed;\n#else\nfloat cp = linePatternAnimSpeed;\n#endif\nfloat cq = ceil(i.x * vPatternHeight / i.y);\n  float cr = cq * (1. + co);\n  cp /= animSpeedScale;\n  cn += mod(currentTime * -cp * .2, cr);\n  float cs = mod(cn / cr, 1.);\n  float ct = mod(flipY * vNormalY, 1.);\n  vec2 f = d(vec2(cs * (1. + co) * uvScale[0], ct * uvScale[1]));\n  vec4 cu = texture2D(linePatternFile, f);\n  float cv = clamp(sign(1. / (1. + co) - cs) + .000001, .0, 1.);\n  cu = mix(linePatternGapColor, cu, cv);\n#ifdef IS_SQUARE_TUBE\nfloat n = clamp(sign(abs(vNormalY) - .999999), .0, 1.);\n  cu = mix(cu, vec4(1.), n);\n#endif\nc.albedo *= cu.rgb;\n  c.alpha *= cu.a;\n#endif\n#if defined(HAS_ALBEDO_MAP)\nvec4 cw = o(baseColorTexture, f);\n  c.albedo *= sRGBToLinear(cw.rgb);\n  c.alpha *= cw.a;\n#endif\n#if defined(HAS_SKIN_MAP)\nvec4 cx = o(skinTexture, f);\n  c.skinColor = cx;\n#endif\n#if defined(HAS_COLOR0)\nc.albedo *= vColor0.rgb;\n#if COLOR0_SIZE == 4\nc.alpha *= vColor0.a;\n#endif\n#endif\n#if defined(HAS_COLOR)\nc.albedo *= vColor.rgb;\n  c.alpha *= vColor.a;\n#elif defined(IS_LINE_EXTRUSION)\nc.albedo *= lineColor.rgb;\n  c.alpha *= lineColor.a;\n#else\nc.albedo *= polygonFill.rgb;\n  c.alpha *= polygonFill.a;\n#endif\n#if defined(HAS_INSTANCE_COLOR)\nc.albedo *= vInstanceColor.rgb;\n  c.alpha *= vInstanceColor.a;\n#endif\n#if defined(IS_LINE_EXTRUSION)\nc.alpha *= lineOpacity;\n#else\nc.alpha *= polygonOpacity;\n#endif\n#if defined(HAS_METALLICROUGHNESS_MAP)\nc.roughnessMetalness = o(metallicRoughnessTexture, f).gb * vec2(roughnessFactor, metallicFactor);\n#else\nc.roughnessMetalness = vec2(roughnessFactor, metallicFactor);\n#endif\nc.emit = emissiveFactor;\n#if defined(HAS_EMISSIVE_MAP)\nif(emitMultiplicative == 1) {\n    c.emit *= sRGBToLinear(o(emissiveTexture, f).rgb);\n  } else {\n    c.emit += sRGBToLinear(o(emissiveTexture, f).rgb);\n  }\n#endif\nc.emit *= emitColorFactor;\n#if defined(HAS_AO_MAP)\nvec2 cy = computeTexCoord(vTexCoord1);\n  c.ao = o(occlusionTexture, cy).r;\n#else\nc.ao = 1.;\n#endif\nc.ao *= occlusionFactor;\n#if defined(HAS_NORMAL_MAP) && defined(HAS_TANGENT)\nvec3 cz = o(normalTexture, f).xyz * 2. - 1.;\n  cz.y = normalMapFlipY == 1 ? -cz.y : cz.y;\n  c.normal = cz;\n#else\nc.normal = normalize(vModelNormal);\n#endif\n#if defined(HAS_TERRAIN_NORMAL) && defined(HAS_TANGENT)\nvec3 cz = convertTerrainHeightToNormalMap(f);\n  cz.y = normalMapFlipY == 1 ? -cz.y : cz.y;\n  c.normal = cz;\n#endif\n#if defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\nc.albedo *= diffuseFactor.rgb;\n  c.alpha *= diffuseFactor.a;\n#if defined(HAS_DIFFUSE_MAP)\nvec4 cA = o(diffuseTexture, f);\n  c.albedo *= sRGBToLinear(cA.rgb);\n  c.alpha *= cA.a;\n#endif\nc.specularColor = specularFactor;\n  c.glossiness = glossinessFactor;\n#if defined(HAS_SPECULARGLOSSINESS_MAP)\nvec4 cB = o(specularGlossinessTexture, f);\n  c.specularColor *= sRGBToLinear(cB.rgb);\n  c.glossiness *= cB.a;\n#endif\n#endif\n}\nvec3 cC(const vec3 x) {\n  const float a = 2.51;\n  const float b = .03;\n  const float cD = 2.43;\n  const float bu = .59;\n  const float cE = .14;\n  return (x * (a * x + b)) / (x * (cD * x + bu) + cE);\n}\nvec3 cF(vec3 cG) {\n  cG = cC(cG);\n  return cG = pow(cG, vec3(1. / 2.2));\n}\nuniform float specularAAVariance;\nuniform float specularAAThreshold;\nfloat cH(float bq, const vec3 cI) {\n  \n#if defined(GL_OES_standard_derivatives) || __VERSION__ == 300\nvec3 cJ = dFdx(cI);\n  vec3 cK = dFdy(cI);\n  float cL = specularAAVariance * (dot(cJ, cJ) + dot(cK, cK));\n  float cM = min(2. * cL, specularAAThreshold);\n  float cN = saturate(bq * bq + cM);\n  return sqrt(cN);\n#else\nreturn bq;\n#endif\n}\n#ifdef HAS_SSR\nuniform sampler2D TextureDepth;\nuniform highp vec2 outSize;\nuniform float ssrFactor;\nuniform float ssrQuality;\nuniform sampler2D TextureReflected;\nuniform highp mat4 projMatrix;\nuniform mat4 invProjMatrix;\nuniform vec4 outputFovInfo[2];\nuniform mat4 reprojViewProjMatrix;\nvec3 cO(const in mat4 cP, const in vec3 cQ) {\n  vec4 cR = cP * vec4(cQ, 1.);\n  return vec3(.5 + .5 * cR.xy / cR.w, cR.w);\n}\nvec3 cS(const in float cT, const in vec2 f) {\n  return texture2D(TextureReflected, f).rgb;\n}\nfloat cU(float cV) {\n  highp mat4 cP = projMatrix;\n  highp float z = cV * 2. - 1.;\n  return -cP[3].z / (z + cP[2].z);\n}\nfloat cW(const vec2 f) {\n  float cV = bi(texture2D(TextureDepth, f));\n  return cV;\n}\nfloat cX(const in vec2 cY, const in float cZ) {\n  vec3 da = vec3(.06711056, .00583715, 52.9829189);\n  return fract(da.z * fract(dot(cY.xy + cZ * vec2(47., 17.) * .695, da.xy))) * .5;\n}\nvec3 db(const in float cZ, const in vec3 dc, const in vec3 dd, const in vec3 de, const in vec3 cg, const in float df) {\n  vec2 dg;\n  dg.x = cX(gl_FragCoord.yx, cZ);\n  dg.y = fract(dg.x * 52.9829189);\n  dg.y = mix(dg.y, 1., .7);\n  float dh = 2. * 3.14159 * dg.x;\n  float di = pow(max(dg.y, .000001), df / (2. - df));\n  float dj = sqrt(1. - di * di);\n  vec3 dk = vec3(dj * cos(dh), dj * sin(dh), di);\n  dk = dk.x * dc + dk.y * dd + dk.z * de;\n  return normalize((2. * dot(cg, dk)) * dk - cg);\n}\nfloat dl(const in float cZ) {\n  return (cX(gl_FragCoord.xy, cZ) - .5);\n}\nvec3 dm(const in vec3 dn, const in float dp, const in vec3 dq) {\n  vec3 dr = cO(projMatrix, vViewVertex.xyz + dq * dp);\n  dr.z = 1. / dr.z;\n  dr -= dn;\n  float ds = min(1., .99 * (1. - dn.x) / max(1e-5, dr.x));\n  float dt = min(1., .99 * (1. - dn.y) / max(1e-5, dr.y));\n  float dw = min(1., .99 * dn.x / max(1e-5, -dr.x));\n  float dx = min(1., .99 * dn.y / max(1e-5, -dr.y));\n  return dr * min(ds, dt) * min(dw, dx);\n}\nfloat dy(const in vec3 dn, const in vec3 dr, inout float dz, inout float dA) {\n  float dB = (dA + dz) * .5;\n  vec3 dC = dn + dr * dB;\n  float z = cW(dC.xy);\n  float cV = cU(z);\n  float dD = -1. / dC.z;\n  dz = cV > dD ? dz : dB;\n  dA = cV > dD ? dB : dA;\n  return dB;\n}\nvec4 dE(const in vec3 dn, const in float dp, in float dF, const in vec3 dq, const in float bq, const in float cZ) {\n  int dG = 20;\n  float dH = 1. / float(dG);\n  dF *= dH;\n  vec3 dr = dm(dn, dp, dq);\n  float dI = dH;\n  vec3 dJ = vec3(.0, dI, 1.);\n  vec3 dC;\n  float z, cV, dD, dK, dL, dM;\n  bool dN;\n  float dO = 1.;\n  float dB;\n  for(int W = 0; W < dG; W++) {\n    dC = dn + dr * dJ.y;\n    z = cW(dC.xy);\n    cV = cU(z);\n    dD = -1. / dC.z;\n    float dP = clamp(sign(.999 - z), .0, 1.);\n    dK = dP * (dD - cV);\n    dK *= clamp(sign(abs(dK) - dp * dH * dH), .0, 1.);\n    dN = abs(dK + dF) < dF;\n    dL = clamp(dJ.x / (dJ.x - dK), .0, 1.);\n    dM = dN ? dJ.y + dL * dH - dH : 1.;\n    dJ.z = min(dJ.z, dM);\n    dJ.x = dK;\n    if(dN) {\n      float dz = dJ.y - dH;\n      float dA = dJ.y;\n      dB = dy(dn, dr, dz, dA);\n      dB = dy(dn, dr, dz, dA);\n      dB = dy(dn, dr, dz, dA);\n      dO = dB;\n      break;\n    }\n    dJ.y += dH;\n  }\n  return vec4(dn + dr * dO, 1. - dO);\n}\nvec4 dQ(in vec4 dR, const in float dS, const in vec3 dT, const in vec3 dU, const in float bq) {\n  vec4 dV = mix(outputFovInfo[0], outputFovInfo[1], dR.x);\n  dR.xyz = vec3(mix(dV.xy, dV.zw, dR.y), 1.) * -1. / dR.z;\n  dR.xyz = (reprojViewProjMatrix * vec4(dR.xyz, 1.)).xyw;\n  dR.xy /= dR.z;\n  float dW = clamp(6. - 6. * max(abs(dR.x), abs(dR.y)), .0, 1.);\n  dR.xy = .5 + .5 * dR.xy;\n  vec3 dX = dU * cS(bq * (1. - dR.w), dR.xy);\n  return vec4(mix(dT, dX, dS * dW), 1.);\n}\nvec3 ssr(const in vec3 dT, const in vec3 dU, const in float bq, const in vec3 bm, const in vec3 cg) {\n  float dY = .0;\n  vec4 bU = vec4(.0);\n  float df = bq * bq;\n  df = df * df;\n  vec3 dZ = abs(bm.z) < .999 ? vec3(.0, .0, 1.) : vec3(1., .0, .0);\n  vec3 dc = normalize(cross(dZ, bm));\n  vec3 dd = cross(bm, dc);\n  float dS = ssrFactor * clamp(-4. * dot(cg, bm) + 3.8, .0, 1.);\n  dS *= clamp(4.7 - bq * 5., .0, 1.);\n  vec3 dn = cO(projMatrix, vViewVertex.xyz);\n  dn.z = 1. / dn.z;\n  vec3 dq = db(dY, dc, dd, bm, cg, df);\n  float dp = mix(cameraNearFar.y + vViewVertex.z, -vViewVertex.z - cameraNearFar.x, dq.z * .5 + .5);\n  float dF = .5 * dp;\n  vec4 dR;\n  if(dot(dq, bm) > .001 && dS > .0) {\n    dR = dE(dn, dp, dF, dq, bq, dY);\n    if(dR.w > .0)\n      bU += dQ(dR, dS, dT, dU, bq);\n    \n  }\n  return bU.w > .0 ? bU.rgb / bU.w : dT;\n}\n#endif\n#include <highlight_frag>\nvec4 ea(in vec4 eb) {\n  return vec4(mix(pow(eb.rgb, vec3(.41666)) * 1.055 - vec3(.055), eb.rgb * 12.92, vec3(lessThanEqual(eb.rgb, vec3(.0031308)))), eb.a);\n}\nvec4 ec(vec4 eb) {\n  return (ea(eb));\n}\nvoid main() {\n  cm();\n  vec3 cg = normalize(cameraPosition - vModelVertex.xyz);\n#if defined(HAS_DOUBLE_SIDE)\nvec3 cd = gl_FrontFacing ? normalize(vModelNormal) : -normalize(vModelNormal);\n#else\nvec3 cd = normalize(vModelNormal);\n#endif\n#if defined(HAS_TANGENT)\nvec4 ed;\n  ed = vModelTangent;\n#if defined(HAS_DOUBLE_SIDE)\ned.xyz = gl_FrontFacing ? normalize(ed.xyz) : -normalize(ed.xyz);\n#else\ned.xyz = normalize(ed.xyz);\n#endif\nvec3 ee = normalize(vModelBiTangent);\n#endif\nfloat bw = .08 * specularF0;\n  float ef = bc();\n  vec3 bO = ba();\n#if defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\nvec3 eg = c.specularColor;\n#else\nvec3 eg = mix(vec3(bw), bO, ef);\n#endif\nbO *= 1. - ef;\n  float eh = clamp(50.0 * eg.g, .0, 1.);\n  float ei = bd();\n  if(specularAAVariance > .0) {\n    ei = cH(ei, cd);\n  }\n  vec3 ej = be();\n  vec3 ek = bg();\n  vec3 el = vec3(ek);\n#if defined(HAS_TANGENT) && (defined(HAS_NORMAL_MAP) || defined(HAS_TERRAIN_NORMAL))\nel = bk(normalMapFactor, el, ed.xyz, ee, cd);\n#endif\nvec3 cA = vec3(.0);\n  vec3 bH = vec3(.0);\n#if defined(HAS_IBL_LIGHTING)\ncA = bO * bT(el) * .5;\n#else\ncA = bO * ambientColor;\n#endif\nfloat bD = dot(el, cg);\n  bH = cj(el, cg, bD, ei, eg, cd, eh, bO);\n  float em;\n  float en = 1.;\n  float eo = bh();\n  cA *= environmentExposure * eo;\n#ifdef HAS_IBL_LIGHTING\nen = ck(eo, bD);\n#endif\n#ifdef HAS_SSR\nvec3 ep = normalize(gl_FrontFacing ? vViewNormal : -vViewNormal);\n  vec3 eq = ep;\n#if defined(HAS_TANGENT) && (defined(HAS_NORMAL_MAP) || defined(HAS_TERRAIN_NORMAL))\nvec4 er;\n  er = vViewTangent;\n  er = gl_FrontFacing ? er : -er;\n  er.xyz = normalize(er.xyz);\n  vec3 es = normalize(cross(ep, er.xyz)) * er.w;\n  eq = bk(normalMapFactor, ek, er.xyz, es, ep);\n#endif\nbH = ssr(bH, eg * en, ei, eq, -normalize(vViewVertex.xyz));\n#endif\nbH *= environmentExposure * en;\n  vec3 et, eu;\n  vec3 ev = vModelNormal;\n  vec3 ew = -light0_viewDirection;\n  float ex = saturate(dot(ew, el));\n  bN(el, cg, ex, max(.045, ei), bO, eg, light0_diffuse.rgb, ew, eh, eu, et);\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nfloat ey = shadow_computeShadow();\n  eu = shadow_blend(eu, ey).rgb;\n  et = shadow_blend(et, ey).rgb;\n#endif\ncA += eu;\n  bH += et;\n  cA += ej;\n  vec3 ez = bH + cA;\n  if(outputSRGB == 1)\n    ez = linearTosRGB(ez);\n  \n#ifdef HAS_SKIN_MAP\nvec4 eA = bf();\n  ez.rgb = ez.rgb * (1. - eA.a) + eA.rgb * eA.a;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nez.rgb = shadow_blend(ez.rgb, ey).rgb;\n#endif\n#endif\nfloat eB = bb();\n#if defined(ALPHA_MODE)\n#if ALPHA_MODE == 1\nif(eB < alphaCutoff) {\n    discard;\n  } else {\n    eB = 1.;\n  }\n#else\neB = 1.;\n#endif\n#endif\nglFragColor = vec4(ez * eB, eB);\n  if(glFragColor.a < alphaTest) {\n    discard;\n  }\n#ifdef HAS_VERTEX_COLOR\nglFragColor *= vertexColor_get();\n#endif\n#ifdef HAS_EXCAVATE_ANALYSIS\nglFragColor = excavateColor(glFragColor);\n#endif\n#ifdef HAS_HEATMAP\nglFragColor = heatmap_getColor(glFragColor);\n#endif\n#ifdef HAS_SNOW\nglFragColor.rgb = snow(glFragColor, bg(), 1.);\n#endif\nif(contrast != 1.) {\n    glFragColor = contrastMatrix(contrast) * glFragColor;\n  }\n  if(length(hsv) > .0) {\n    glFragColor = hsv_apply(glFragColor, hsv);\n  }\n#ifdef OUTPUT_NORMAL\nglFragColor = vec4(cd, 1.);\n#endif\nglFragColor = highlight_blendColor(glFragColor);\n#ifdef HAS_LAYER_OPACITY\nglFragColor *= layerOpacity;\n#endif\n#ifdef HAS_MASK_EXTENT\nglFragColor = setMask(glFragColor);\n#endif\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:A,extraCommandProps:n,defines:o}),this.version=300}getGeometryDefines(e){const n={};return e.data[e.desc.tangentAttribute]?n.HAS_TANGENT=1:e.data[e.desc.normalAttribute]&&(n.HAS_NORMAL=1),e.data[e.desc.colorAttribute]&&(n.HAS_COLOR=1),e.data[e.desc.color0Attribute]&&(n.HAS_COLOR0=1,n.COLOR0_SIZE=e.getColor0Size()),n}},StandardDepthShader:class extends eP{constructor(e={}){const n=[];super({vert:"#define SHADER_NAME depth_vert\nprecision highp float;\nattribute vec3 aPosition;\n#include <line_extrusion_vert>\nuniform mat4 modelViewMatrix;\nuniform mat4 positionMatrix;\nuniform mat4 projMatrix;\nuniform vec2 outSize;\nuniform vec2 halton;\n#include <get_output>\nvoid main() {\n  mat4 c = getPositionMatrix();\n#ifdef IS_LINE_EXTRUSION\nvec4 d = getPosition(getLineExtrudePosition(aPosition));\n#else\nvec4 d = getPosition(aPosition);\n#endif\nvec4 e = modelViewMatrix * c * d;\n  mat4 f = projMatrix;\n  f[2].xy += halton.xy / outSize.xy;\n  gl_Position = f * e;\n}",frag:"#define SHADER_NAME depth_frag\nprecision highp float;\nvoid main() {\n  gl_FragColor = vec4(1., .0, .0, 1.);\n}",uniforms:[{name:"modelViewMatrix",type:"function",fn:(e,i)=>Cv(n,i.viewMatrix,i.modelMatrix)}],extraCommandProps:e.extraCommandProps,defines:e.defines})}},PBRUtils:RM};var kT=Object.freeze({__proto__:null,AbstractTexture:Pw,BloomPass:dP,BoundingBox:Sw,BoxBlurShader:class Dn extends sP{constructor({blurOffset:e}){super({vert:iP,frag:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D textureSource;\nuniform vec2 resolution;\nuniform float ignoreTransparent;\nvoid main() {\n  vec4 c = vec4(.0);\n  float d = .0;\n  for(int x = -BOXBLUR_OFFSET; x <= BOXBLUR_OFFSET; ++x)\n    for(int y = -BOXBLUR_OFFSET; y <= BOXBLUR_OFFSET; ++y) {\n      vec2 e = vTexCoord.st + vec2(float(x) / resolution.x, float(y) / resolution.y);\n      e = clamp(e, .0, 1.);\n      vec4 f = texture2D(textureSource, e);\n      float h;\n      if(ignoreTransparent == 1.) {\n        h = sign(f.a);\n      } else {\n        h = 1.;\n      }\n      d += h;\n      c += h * f;\n    }\n  gl_FragColor = c / max(d, 1.) * clamp(sign(d - 1.), .0, 1.);\n}",defines:{BOXBLUR_OFFSET:e||2},extraCommandProps:{viewport:{x:0,y:0,width:(e,n)=>n.resolution[0],height:(e,n)=>n.resolution[1]}}}),this._blurOffset=e||2}getMeshCommand(e,n){const i="box_blur_"+this._blurOffset;return this.commands[i]||(this.commands[i]=this.createREGLCommand(e,null,n.getElements())),this.commands[i]}},Constants:bw,CopyShader:bP,EdgeGeometry:aC,EdgeShader:wP,ExtentPass:zP,FBORayPicking:XM,FogPass:TP,FogShader:SP,FxaaShader:aP,GLTFHelper:nM,GLTFManager:lM,Geometry:Lw,HDR:RT,HeatmapDisplayShader:xP,HeatmapShader:mP,InstancedMesh:wC,Jitter:AP,KHRTechniquesWebglManager:iT,Material:cC,Mesh:bC,MeshShader:eP,PhongMaterial:dC,PhongShader:nP,PhongSpecularGlossinessMaterial:vC,Plane:WC,PointLineShader:class On extends eP{constructor(e={}){const n=[];super({vert:"attribute vec3 aPosition;\n#ifdef HAS_COLOR0\nattribute vec4 aColor0;\nvarying vec4 vColor;\n#endif\nuniform mat4 modelMatrix;\nuniform mat4 projMatrix;\nuniform mat4 positionMatrix;\nuniform mat4 projViewModelMatrix;\nuniform float pointSize;\n#if defined(HAS_MAP)\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\n#endif\n#include <get_output>\n#include <heatmap_render_vert>\n#ifdef HAS_FLOODANALYSE\nvarying float vHeight;\n#endif\nvoid main() {\n  vec4 c = getPosition(aPosition);\n  mat4 d = getPositionMatrix();\n  gl_PointSize = pointSize;\n#ifdef HAS_MASK_EXTENT\ngl_Position = projMatrix * getMaskPosition(d * c, modelMatrix);\n#else\ngl_Position = projViewModelMatrix * d * c;\n#endif\n#ifdef HAS_COLOR0\nvColor = aColor0 / 255.;\n#endif\n#ifdef HAS_MAP\nvTexCoord = aTexCoord;\n#endif\n#ifdef HAS_HEATMAP\nheatmap_compute(projMatrix * modelViewMatrix * d, c);\n#endif\n}",frag:"precision mediump float;\n#include <gl2_frag>\n#if defined(HAS_COLOR0)\nvarying vec4 vColor;\n#endif\n#include <heatmap_render_frag>\nuniform vec4 baseColorFactor;\n#if defined(HAS_MAP)\n#if defined(HAS_ALBEDO_MAP)\nuniform sampler2D baseColorTexture;\n#endif\n#if defined(HAS_DIFFUSE_MAP)\nuniform sampler2D diffuseTexture;\n#endif\nvarying vec2 vTexCoord;\n#endif\n#include <mask_frag>\nvoid main() {\n  \n#ifdef HAS_COLOR0\nglFragColor = vColor * baseColorFactor;\n#else\nglFragColor = vec4(1.) * baseColorFactor;\n#endif\n#ifdef HAS_MAP\n#ifdef HAS_ALBEDO_MAP\nglFragColor *= texture2D(baseColorTexture, vTexCoord);\n#endif\n#ifdef HAS_DIFFUSE_MAP\nglFragColor *= texture2D(diffuseTexture, vTexCoord);\n#endif\n#endif\n#ifdef HAS_HEATMAP\nglFragColor = heatmap_getColor(glFragColor);\n#endif\n#ifdef HAS_MASK_EXTENT\nglFragColor = setMask(glFragColor);\n#endif\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(e,i)=>Cv(n,i.projViewMatrix,i.modelMatrix)}],defines:e.defines||{},extraCommandProps:e.extraCommandProps||{}})}},PostProcessShader:hP,QuadShader:sP,REGLHelper:$w,RainRipplesPass:LP,Renderer:PC,ResourceLoader:SC,Scene:kC,Shader:$C,ShaderLib:ZC,ShadowDisplayShader:zM,ShadowMapShader:DM,ShadowPass:NM,SkyboxShader:_P,SsrPass:gP,StandardLiteMaterial:gC,StandardLiteShader:class Qn extends eP{constructor(e={}){const n=[],i=e.uniforms,o=[{name:"viewMatrixInverse",type:"function",fn:(e,n)=>wv(CP,n.viewMatrix)},{name:"modelViewMatrix",type:"function",fn:function(e,i){return Cv(n,i.viewMatrix,i.modelMatrix)}},{name:"environmentTransform",type:"function",fn:(e,n)=>pv(PP,Math.PI*(n.environmentOrientation||0)/180)}];i&&o.push(...i),super({vert:"precision mediump float;\n#include <gl2_vert>\nattribute vec3 aPosition;\n#include <line_extrusion_vert>\n#ifdef HAS_MAP\nuniform vec2 uvScale;\nuniform vec2 uvOffset;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\n#ifdef HAS_I3S_UVREGION\nattribute vec4 uvRegion;\nvarying vec4 vUvRegion;\n#endif\n#endif\n#if defined(HAS_COLOR)\nattribute vec4 aColor;\n#elif defined(HAS_COLOR0)\n#if COLOR0_SIZE == 3\nattribute vec3 aColor0;\n#else\nattribute vec4 aColor0;\n#endif\nvarying vec4 vColor;\n#endif\nuniform mat4 projMatrix;\nuniform mat3 modelNormalMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 positionMatrix;\nuniform vec2 halton;\nuniform vec2 outSize;\nuniform mat4 projViewMatrix;\n#include <get_output>\n#include <heatmap_render_vert>\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_vert>\n#endif\nvarying vec3 vViewPosition;\nvoid main() {\n  \n#ifdef IS_LINE_EXTRUSION\nvec4 c = getPosition(getLineExtrudePosition(aPosition));\n#else\nvec4 c = getPosition(aPosition);\n#endif\nmat4 d = getPositionMatrix();\n  mat4 e = projMatrix;\n  e[2].xy += halton.xy / outSize.xy;\n#ifdef HAS_MASK_EXTENT\ngl_Position = e * getMaskPosition(d * c, modelMatrix);\n#else\ngl_Position = e * modelViewMatrix * d * c;\n#endif\nvec4 f = modelViewMatrix * d * c;\n  vViewPosition = -f.xyz;\n#ifdef HAS_MAP\nvec2 h = decode_getTexcoord(aTexCoord);\n  vTexCoord = h * uvScale + uvOffset;\n#endif\n#if defined(HAS_COLOR)\nvColor = aColor / 255.;\n#elif defined(HAS_COLOR0)\n#if COLOR0_SIZE == 3\nvColor = vec4(aColor0 / 255., 1.);\n#else\nvColor = aColor0 / 255.;\n#endif\n#endif\n}",frag:"#if __VERSION__ == 100\n#if defined(GL_EXT_shader_texture_lod)\n#extension GL_EXT_shader_texture_lod : enable\n#define textureCubeLod(tex, uv, lod) textureCubeLodEXT(tex, uv, lod)\n#else\n#define textureCubeLod(tex, uv, lod) textureCube(tex, uv, lod)\n#endif\n#if defined(GL_OES_standard_derivatives)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#else\n#define textureCubeLod(tex, uv, lod) textureLod(tex, uv, lod)\n#endif\n#define saturate(x)        clamp(x, 0.0, 1.0)\nprecision mediump float;\n#include <gl2_frag>\n#include <hsv_frag>\nuniform vec3 hsv;\n#define GET_BASEMAP(UV) (texture2D(baseColorTexture, (UV)))\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\nuniform vec3 cameraPosition;\n#if defined(HAS_IBL_LIGHTING)\nuniform mat4 viewMatrixInverse;\n#endif\nuniform vec4 baseColorFactor;\nuniform vec3 emissiveFactor;\nuniform vec3 specularFactor;\nuniform float opacity;\nuniform float envRotationSin;\nuniform float envRotationCos;\nuniform float rgbmRange;\n#if defined(HAS_MAP)\n#include <computeTexcoord_frag>\n#endif\n#ifdef HAS_BASECOLOR_MAP\nuniform sampler2D baseColorTexture;\n#endif\n#ifdef HAS_NORMAL_MAP\nuniform sampler2D normalTexture;\nvec3 c(vec3 d, vec3 e) {\n  vec3 f = dFdx(d.xyz);\n  vec3 h = dFdy(d.xyz);\n  vec3 i = normalize(f - h);\n  vec3 j = normalize(-f + h);\n  vec3 k = normalize(e);\n  vec3 l = texture2D(normalTexture, computeTexCoord(vTexCoord)).rgb * 2. - 1.;\n  mat3 m = mat3(i, j, k);\n  return normalize(m * l);\n}\n#endif\n#ifdef HAS_EMISSIVE_MAP\nuniform sampler2D emissiveTexture;\n#endif\n#ifdef SHADING_MODEL_SPECULAR_GLOSSINESS\nuniform vec4 diffuseFactor;\n#ifdef HAS_DIFFUSE_MAP\nuniform sampler2D diffuseTexture;\n#endif\n#ifdef HAS_SPECULARGLOSSINESS_MAP\nuniform sampler2D specularGlossinessTexture;\n#endif\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_frag>\n#endif\n#if defined(HAS_COLOR) || defined(HAS_COLOR0)\nvarying vec4 vColor;\n#endif\n#ifdef GAMMA_INPUT\nvec3 n(vec3 o) {\n  return o * o;\n}\nfloat n(float o) {\n  return o * o;\n}\n#else\nvec3 n(vec3 o) {\n  return o;\n}\nfloat n(float o) {\n  return o;\n}\n#endif\nvec3 u() {\n  \n#ifdef SHADING_MODEL_SPECULAR_GLOSSINESS\n#ifdef HAS_SPECULARGLOSSINESS_MAP\nreturn texture2D(specularGlossinessTexture, computeTexCoord(vTexCoord)).rgb;\n#else\nreturn specularFactor;\n#endif\n#else\nreturn specularFactor;\n#endif\n}\nvec3 v() {\n  \n#ifdef HAS_EMISSIVE_MAP\nreturn texture2D(emissiveTexture, computeTexCoord(vTexCoord)).rgb;\n#else\nreturn emissiveFactor;\n#endif\n}\n#if defined(TONEMAP_OUTPUT)\n#if TONEMAP_OUTPUT > 0\nuniform float exposureBias;\nfloat A(vec3 rgb) {\n  return dot(rgb, vec3(.299, .587, .114));\n}\nfloat B(vec3 rgb) {\n  return dot(rgb, vec3(.212671, .715160, .072169));\n}\nvec3 C(vec3 xyz) {\n  vec3 D = vec3(3.240479, -1.53715, -.498535);\n  vec3 E = vec3(-.969256, 1.875992, .041556);\n  vec3 F = vec3(.055648, -.204043, 1.057311);\n  vec3 rgb;\n  rgb.b = dot(xyz, F);\n  rgb.g = dot(xyz, E);\n  rgb.r = dot(xyz, D);\n  return rgb;\n}\nvec3 H(vec3 rgb) {\n  vec3 I = vec3(.412453, .35758, .180423);\n  vec3 J = vec3(.212671, .71516, .0721688);\n  vec3 K = vec3(.0193338, .119194, .950227);\n  vec3 xyz;\n  xyz.x = dot(rgb, I);\n  xyz.y = dot(rgb, J);\n  xyz.z = dot(rgb, K);\n  return xyz;\n}\nvec3 L(vec3 xyz) {\n  float M = xyz.x + xyz.y + xyz.z;\n  M = 1. / M;\n  vec3 O;\n  O.z = xyz.y;\n  O.x = xyz.x * M;\n  O.y = xyz.y * M;\n  return O;\n}\nvec3 P(vec3 O) {\n  float x = O.x;\n  float y = O.y;\n  float J = O.z;\n  vec3 xyz;\n  xyz.y = J;\n  xyz.x = x * (J / y);\n  xyz.z = (1. - x - y) * (J / y);\n  return xyz;\n}\nfloat Q(float x) {\n  float U = pow(x, 1.60525727);\n  float V = ((1.05542877 * 4.68037409) * U) / (4.68037409 * U + 1.);\n  return clamp(V, .0, 1.);\n}\nconst float W = 1. / .18;\nfloat ba(float x) {\n  x *= W;\n  const float bb = .2;\n  const float F = .34;\n  const float bc = .002;\n  const float bd = 1.68;\n  const float be = .0005;\n  const float bf = .252;\n  const float bg = 1. / .833837;\n  return ((x * (bb * x + bc * F) + bd * be) / (x * (bb * x + F) + bd * bf) - be / bf) * bg;\n}\nvec3 bh(vec3 x) {\n  x *= W;\n  const float bb = .27;\n  const float F = .29;\n  const float bc = .052;\n  const float bd = .2;\n  const float bf = .18;\n  const float bg = 1. / .897105;\n  return ((x * (bb * x + bc * F)) / (x * (bb * x + F) + bd * bf)) * bg;\n}\nvec3 bi(vec3 x) {\n  vec3 bj = x.rgb;\n  bj = min(bj, vec3(3.));\n  float bk = B(bj);\n  if(bk > .0) {\n    float bl = Q(bk);\n    bj = bj * (bl / bk);\n    bj = clamp(bj, vec3(.0), vec3(1.));\n  }\n  float bm = 1. / 2.2;\n  bj = pow(bj, vec3(bm));\n  return bj;\n}\n#endif\n#endif\n#if defined(IRR_RGBM) || defined(ENV_RGBM) || defined(ENV_GAMMA) || defined(IRR_GAMMA)\nuniform float envMapExposure;\n#endif\nuniform vec4 themingColor;\nuniform mat3 environmentTransform;\nvec3 bn(vec3 bo, vec3 bp) {\n  \n#if defined(HAS_SHADOWMAP)\nfloat bq = dot(shadowLightDir, bp);\n  float br = (bq + 1.) / 2.;\n  br = min(1., br * 1.5);\n  float bs = 1.;\n  vec3 bt = bo * min(bs, br);\n  return bt;\n#else\nreturn bo;\n#endif\n}\n#ifdef HAS_IBL_LIGHTING\nuniform float reflectivity;\nuniform vec3 hdrHSV;\nuniform samplerCube prefilterMap;\nuniform vec3 diffuseSPH[9];\nuniform vec2 prefilterMiplevel;\nuniform vec2 prefilterSize;\n#else\nuniform vec3 ambientColor;\n#endif\n#if defined(HAS_IBL_LIGHTING)\nvec3 bu(const in vec3 bv) {\n  vec3 bw = environmentTransform * bv;\n  float x = bw.x;\n  float y = bw.y;\n  float z = bw.z;\n  vec3 bt = (diffuseSPH[0] + diffuseSPH[1] * x + diffuseSPH[2] * y + diffuseSPH[3] * z + diffuseSPH[4] * z * x + diffuseSPH[5] * y * z + diffuseSPH[6] * y * x + diffuseSPH[7] * (3. * z * z - 1.) + diffuseSPH[8] * (x * x - y * y));\n  if(length(hdrHSV) > .0) {\n    bt = hsv_apply(bt, hdrHSV);\n  }\n  return max(bt, vec3(.0));\n}\nvec3 bx(const in vec4 by, const in float bz) {\n  if(bz <= .0)\n    return by.rgb;\n  return bz * by.rgb * by.a;\n}\nfloat bA(const in float bB) {\n  return bB;\n}\nvec3 bC(const in float bD, const in vec3 D) {\n  vec3 bE = D;\n  float bF = prefilterMiplevel.x;\n  float bG = min(bF, bA(bD) * prefilterMiplevel.y);\n  vec3 bH = bx(textureCubeLod(prefilterMap, bE, bG), rgbmRange);\n  if(length(hdrHSV) > .0) {\n    return hsv_apply(bH, hdrHSV);\n  } else {\n    return bH;\n  }\n}\nvec3 bI(const in vec3 k, const in vec3 D, const in float bJ) {\n  float bK = 1. - bJ;\n  float bL = bK * (sqrt(bK) + bJ);\n  return mix(k, D, bL);\n}\nvec3 bM(const in vec3 bv, const in vec3 bN, const in float bO, const in vec3 bP) {\n  vec3 D = reflect(-bN, bv);\n  D = bI(bv, D, bO);\n  vec3 bQ = bC(bO, environmentTransform * D);\n  float bR = clamp(1. + dot(D, bP), .0, 1.);\n  bQ *= bR * bR;\n  return bQ;\n}\n#else\nvec3 bM(const in vec3 bv, const in vec3 bN, const in float bO, const in vec3 bP) {\n  return ambientColor;\n}\n#endif\nvarying highp vec3 vViewPosition;\nvec3 bS(vec3 bT, float bU) {\n  float bV = max(1. - bU, .0);\n  return bT + (1. - bT) * pow(bV, 5.);\n}\nfloat bW(float bT, float bU) {\n  float bV = max(1. - bU, .0);\n  return bT + (1. - bT) * pow(bV, 5.);\n}\nvec3 bX(const in vec3 by) {\n  return vec3(by.r < .0031308 ? by.r * 12.92 : 1.055 * pow(by.r, 1. / 2.4) - .055, by.g < .0031308 ? by.g * 12.92 : 1.055 * pow(by.g, 1. / 2.4) - .055, by.b < .0031308 ? by.b * 12.92 : 1.055 * pow(by.b, 1. / 2.4) - .055);\n}\nvoid main() {\n  glFragColor = vec4(vec3(1.), opacity);\n#ifdef HAS_BASECOLOR_MAP\nvec4 bY = GET_BASEMAP(computeTexCoord(vTexCoord));\n#ifdef GAMMA_INPUT\nbY.xyz *= bY.xyz;\n#endif\nglFragColor = glFragColor * bY;\n#endif\n#ifdef ALPHATEST\nif(glFragColor.a < ALPHATEST)\n    discard;\n  \n#endif\nfloat bZ = 1.;\n  vec3 ca = dFdx(vViewPosition);\n  vec3 cb = dFdy(vViewPosition);\n  vec3 bv = normalize(cross(ca, cb));\n  vec3 cc;\n  if(projMatrix[3][3] == .0) {\n    cc = normalize(vViewPosition);\n  } else {\n    cc = vec3(.0, .0, 1.);\n  }\n  bv = faceforward(bv, -cc, bv);\n  vec3 cd = bv;\n#ifdef HAS_NORMAL_MAP\nbv = c(-vViewPosition, bv);\n#endif\nvec3 ce = vec3(.0);\n  vec3 cf = vec3(.0);\n#ifdef HAS_IBL_LIGHTING\nvec3 bp = mat3(viewMatrixInverse) * bv;\n  vec3 cg = glFragColor.rgb * bu(bp) * .5;\n  cg = bn(cg, bp);\n  ce += n(baseColorFactor.rgb) * cg;\n#endif\nvec3 ch = v();\n#ifdef METAL\nglFragColor.xyz = glFragColor.xyz * (n(ch) + ce + n(baseColorFactor.rgb) + cf);\n#else\nglFragColor.xyz = glFragColor.xyz * (n(ch) + ce + n(baseColorFactor.rgb)) + cf;\n#endif\nvec3 ci;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nfloat cj = shadow_computeShadow();\n  ci = shadow_blend(ci, cj).rgb;\n#endif\n#ifdef HAS_COLOR\nglFragColor = glFragColor * vColor;\n#endif\nglFragColor.rgb += ci;\n  glFragColor.rgb = bX(glFragColor.rgb);\n#if defined(HAS_IBL_LIGHTING)\nvec3 ck;\n#if defined(HAS_NORMAL_MAP)\n#ifdef ENVMAP_MODE_REFLECTION\nck = reflect(-cc, bv);\n#else\nck = refract(-cc, bv, 1.);\n#endif\n#else\nck = reflect(-cc, bv);\n#endif\nck = mat3(viewMatrixInverse) * ck;\n  float cl = 1.;\n  vec3 cm;\n#ifdef HAS_IBL_LIGHTING\ncm = vec3(.0);\n#elif\ncm = ambientColor;\n#endif\ncm *= cl;\n  float bV = dot(cc, bv);\n  if(bV < -1e-2 || reflectivity == .0)\n    bV = 1.;\n  else\n    bV = max(1e-6, bV);\n  vec3 cn;\n  vec3 co = u();\n#ifdef METAL\ncn = n(co);\n#else\ncn = bS(n(co), bV) * (1. - envRotationSin);\n  glFragColor.a = mix(glFragColor.a, bW(glFragColor.a, bV), reflectivity) * envRotationCos;\n  float cp = pow(1. - bV * .5, 5.);\n  float cq = (28. / 23.) * (1. - cp) * (1. - cp);\n  glFragColor.rgb *= cq * (1. - n(co));\n#endif\nglFragColor.rgb += cm.rgb * bZ * cn.rgb;\n#endif\n#if defined(TONEMAP_OUTPUT)\n#if TONEMAP_OUTPUT == 1\nglFragColor.rgb = bi(exposureBias * glFragColor.rgb);\n#elif TONEMAP_OUTPUT == 2\nglFragColor.rgb = bh(exposureBias * glFragColor.rgb);\n#endif\n#endif\nglFragColor.rgb = mix(glFragColor.rgb, themingColor.rgb, themingColor.a);\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:o,defines:e.defines||{},extraCommandProps:e.extraCommandProps||{}}),this.version=300}},Texture2D:VC,Util:vw,WaterShader:class qn extends eP{constructor(e={}){super({vert:"precision highp float;\nprecision highp sampler2D;\nconst float c = 3.141592653589793;\nuniform mat4 projMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 modelMatrix;\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\nattribute vec3 aNormal;\nvarying vec2 vuv;\nvarying vec3 vpos;\nvarying vec3 vnormal;\nvarying mat3 vtbnMatrix;\nvec4 d(mat4 e, mat4 f, vec3 h) {\n  return e * modelMatrix * f * vec4(h, 1.);\n}\nvec3 i(in vec3 h, in vec3 j) {\n  return normalize(h + j);\n}\nmat3 k(in vec3 l) {\n  vec3 t = normalize(cross(vec3(.0, .0, 1.), l));\n  vec3 b = normalize(cross(l, t));\n  return mat3(t, b, l);\n}\nvoid m() {\n  \n}\nvoid main(void) {\n  vuv = aTexCoord;\n  vpos = (modelMatrix * vec4(aPosition, 1.)).xyz;\n  vnormal = aNormal;\n  vtbnMatrix = k(vnormal);\n  gl_Position = d(projMatrix, viewMatrix, vpos);\n  m();\n}",frag:"precision highp float;\nprecision highp sampler2D;\nuniform sampler2D texWaveNormal;\nuniform sampler2D texWavePerturbation;\nuniform vec3 octaveTextureRepeat;\nuniform vec4 waveParams;\nuniform vec2 waveDirection;\nuniform vec4 waterColor;\nuniform vec3 lightingDirection;\nuniform vec3 lightingIntensity;\nuniform vec3 camPos;\nuniform float timeElapsed;\nvarying vec2 vuv;\nvarying vec3 vpos;\nvarying vec3 vnormal;\nvarying mat3 vtbnMatrix;\nconst vec2 c = vec2(6. / 25., 5. / 24.);\nvec2 d(sampler2D e, vec2 f) {\n  return 2. * texture2D(e, f).rg - 1.;\n}\nfloat h(vec2 f) {\n  return texture2D(texWavePerturbation, f).b;\n}\nvec3 i(sampler2D e, vec2 f) {\n  return 2. * texture2D(e, f).rgb - 1.;\n}\nfloat j(vec2 f, float k) {\n  return fract(k);\n}\nfloat l(vec2 f, float k) {\n  float m = j(f, k);\n  return 1. - abs(1. - 2. * m);\n}\nvec3 n(sampler2D o, vec2 f, float k, float u) {\n  float v = waveParams[2];\n  float A = waveParams[3];\n  vec2 B = d(o, f) * v;\n  float m = j(f, k + u);\n  float C = l(f, k + u);\n  vec2 D = f;\n  D -= B * (m + A);\n  D += u;\n  D += (k - m) * c;\n  return vec3(D, C);\n}\nconst float E = .3737;\nconst float F = 7.77;\nvec3 G(sampler2D H, sampler2D I, vec2 f, vec2 J, float k) {\n  float K = waveParams[0];\n  vec2 L = k * -J;\n  float M = h(f * E) * F;\n  vec3 N = n(I, f + L, k + M, .0);\n  vec3 O = n(I, f + L, k + M, .5);\n  vec3 P = i(H, N.xy) * N.z;\n  vec3 Q = i(H, O.xy) * O.z;\n  vec3 R = normalize(P + Q);\n  R.xy *= K;\n  R.z = sqrt(1. - dot(R.xy, R.xy));\n  return R;\n}\nvec3 S(vec2 f, float k) {\n  float T = waveParams[1];\n  return G(texWaveNormal, texWavePerturbation, f * T, waveDirection, k);\n}\nconst float U = 3.141592653589793;\nconst float V = 1. / U;\nconst float W = .3183098861837907;\nconst float X = 1.570796326794897;\nstruct PBRShadingWater {\n  float NdotL;\n  float NdotV;\n  float NdotH;\n  float VdotH;\n  float LdotH;\n  float VdotN;\n};\nfloat Y = 2.2;\nvec3 Z(float ba, vec3 bb, float bc) {\n  return bb + (bc - bb) * pow(1. - ba, 5.);\n}\nfloat bd(float be, float bf) {\n  float bg = bf * bf;\n  float bh = be * be;\n  float bi = pow((bh * (bg - 1.) + 1.), Y) * U;\n  return bg / bi;\n}\nfloat bj(float bk) {\n  return .25 / (bk * bk);\n}\nvec3 bl(in PBRShadingWater bm, float bf, vec3 bn, float bo) {\n  vec3 bp = Z(bm.VdotH, bn, bo);\n  float bq = bd(bm.NdotH, bf);\n  float br = bj(bm.LdotH);\n  return (bq * br) * bp;\n}\nvec3 bs(const vec3 x) {\n  return (x * (2.51 * x + .03)) / (x * (2.43 * x + .59) + .14);\n}\nconst float bt = 2.2;\nconst float bu = .4545454545;\nvec4 bv(vec4 bw) {\n  return vec4(pow(bw.rgb, vec3(bu)), bw.w);\n}\nvec3 bx(vec3 bw) {\n  return pow(bw, vec3(bt));\n}\nconst vec3 by = vec3(.02, 1., 5.);\nconst vec2 bz = vec2(.02, .1);\nconst float bf = .06;\nconst vec3 bA = vec3(0, .6, .9);\nconst vec3 bB = vec3(.72, .92, 1.);\nPBRShadingWater bC;\nvec3 bD(in float bE, in vec3 bF, in vec3 bG) {\n  float bH = pow((1. - bE), by[2]);\n  return mix(bG, bF, bH);\n}\nvec3 bI(in vec3 bJ, in vec3 bK, in vec3 bL, vec3 bw, in vec3 bM, in vec3 bN, in float bO) {\n  vec3 bP = bx(bw);\n  vec3 bQ = normalize(bL + bK);\n  bC.NdotL = clamp(dot(bJ, bL), .0, 1.);\n  bC.NdotV = clamp(dot(bJ, bK), .001, 1.);\n  bC.VdotN = clamp(dot(bK, bJ), .001, 1.);\n  bC.NdotH = clamp(dot(bJ, bQ), .0, 1.);\n  bC.VdotH = clamp(dot(bK, bQ), .0, 1.);\n  bC.LdotH = clamp(dot(bL, bQ), .0, 1.);\n  float bR = max(dot(bN, bK), .0);\n  vec3 bS = bx(bB);\n  vec3 bT = bx(bA);\n  vec3 bB = bD(bR, bS, bT);\n  float bU = max(dot(bN, bL), .0);\n  bB *= .1 + bU * .9;\n  float bV = clamp(bO, .8, 1.);\n  vec3 bW = Z(bC.VdotN, vec3(by[0]), by[1]) * bB * bV;\n  vec3 bX = bP * mix(bB, bU * bM * V, 2. / 3.) * bV;\n  vec3 bY = vec3(.0);\n  if(bR > .0 && bU > .0) {\n    vec3 bZ = bl(bC, bf, vec3(bz[0]), bz[1]);\n    vec3 ca = bM * V * bO;\n    bY = bC.NdotL * ca * bZ;\n  }\n  return bs(bW + bX + bY);\n}\nvoid main() {\n  vec3 bN = vnormal;\n  vec3 cb = S(vuv, timeElapsed);\n  vec3 bJ = normalize(vtbnMatrix * cb);\n  vec3 bK = -normalize(vpos - camPos);\n  vec3 bL = normalize(-lightingDirection);\n  float bO = 1.;\n  vec4 cc = vec4(bI(bJ, bK, bL, waterColor.rgb, lightingIntensity, bN, bO), waterColor.w);\n  gl_FragColor = bv(cc);\n}",defines:e.defines||{},extraCommandProps:e.extraCommandProps||{}})}},WireFrameMaterial:class Pe extends cC{constructor(e){super(e,AC)}},WireframeShader:class Tn extends eP{constructor(e={}){let n=e.extraCommandProps||{};const i=[];n=$b({},n,{blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"},sample:{alpha:!0}}),super({vert:"#include <gl2_vert>\nattribute vec3 aPosition;\nattribute vec3 aBarycentric;\nvarying vec3 vBarycentric;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projMatrix;\nuniform mat4 positionMatrix;\nvarying vec3 vPosition;\n#include <get_output>\nvoid main() {\n  mat4 c = getPositionMatrix();\n  vec4 d = getPosition(aPosition);\n#ifdef HAS_MASK_EXTENT\ngl_Position = projMatrix * getMaskPosition(c * d, modelMatrix);\n#else\ngl_Position = projMatrix * modelViewMatrix * c * d;\n#endif\nvBarycentric = aBarycentric;\n  vPosition = aPosition;\n}",frag:"#if __VERSION__ == 100\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n#endif\nprecision mediump float;\n#include <gl2_frag>\nvarying vec3 vBarycentric;\nuniform float time;\nuniform float thickness;\nuniform float secondThickness;\nuniform float dashRepeats;\nuniform float dashLength;\nuniform bool dashOverlap;\nuniform bool dashEnabled;\nuniform bool dashAnimate;\nuniform bool seeThrough;\nuniform bool insideAltColor;\nuniform bool dualStroke;\nuniform bool squeeze;\nuniform float squeezeMin;\nuniform float squeezeMax;\nuniform vec4 stroke;\nuniform vec4 fill;\nuniform float opacity;\nuniform bool noiseEnable;\nvarying vec3 vPosition;\n#ifdef HAS_INSTANCE\nvarying vec4 vInstanceColor;\n#endif\n#include <mask_frag>\n#define F4 0.309016994374947451\n#define halfDist 0.5\nvec4 c(vec4 x) {\n  return x - floor(x * (1. / 289.)) * 289.;\n}\nfloat c(float x) {\n  return x - floor(x * (1. / 289.)) * 289.;\n}\nvec4 d(vec4 x) {\n  return c((x * 34. + 1.) * x);\n}\nfloat d(float x) {\n  return c((x * 34. + 1.) * x);\n}\nvec4 e(vec4 r) {\n  return 1.79284291400159 - .85373472095314 * r;\n}\nfloat e(float r) {\n  return 1.79284291400159 - .85373472095314 * r;\n}\nvec4 f(float h, vec4 i) {\n  const vec4 k = vec4(1., 1., 1., -1.);\n  vec4 p, s;\n  p.xyz = floor(fract(vec3(h) * i.xyz) * 7.) * i.z - 1.;\n  p.w = 1.5 - dot(abs(p.xyz), k.xyz);\n  s = vec4(lessThan(p, vec4(.0)));\n  p.xyz = p.xyz + (s.xyz * 2. - 1.) * s.www;\n  return p;\n}\nfloat l(vec4 m) {\n  const vec4 n = vec4(.138196601125011, .276393202250021, .414589803375032, -.447213595499958);\n  vec4 o = floor(m + dot(m, vec4(F4)));\n  vec4 u = m - o + dot(o, n.xxxx);\n  vec4 A;\n  vec3 B = step(u.yzw, u.xxx);\n  vec3 D = step(u.zww, u.yyz);\n  A.x = B.x + B.y + B.z;\n  A.yzw = 1. - B;\n  A.y += D.x + D.y;\n  A.zw += 1. - D.xy;\n  A.z += D.z;\n  A.w += 1. - D.z;\n  vec4 E = clamp(A, .0, 1.);\n  vec4 F = clamp(A - 1., .0, 1.);\n  vec4 G = clamp(A - 2., .0, 1.);\n  vec4 H = u - G + n.xxxx;\n  vec4 I = u - F + n.yyyy;\n  vec4 J = u - E + n.zzzz;\n  vec4 K = u + n.wwww;\n  o = c(o);\n  float L = d(d(d(d(o.w) + o.z) + o.y) + o.x);\n  vec4 M = d(d(d(d(o.w + vec4(G.w, F.w, E.w, 1.)) + o.z + vec4(G.z, F.z, E.z, 1.)) + o.y + vec4(G.y, F.y, E.y, 1.)) + o.x + vec4(G.x, F.x, E.x, 1.));\n  vec4 i = vec4(1. / 294., 1. / 49., 1. / 7., .0);\n  vec4 N = f(L, i);\n  vec4 O = f(M.x, i);\n  vec4 P = f(M.y, i);\n  vec4 Q = f(M.z, i);\n  vec4 R = f(M.w, i);\n  vec4 S = e(vec4(dot(N, N), dot(O, O), dot(P, P), dot(Q, Q)));\n  N *= S.x;\n  O *= S.y;\n  P *= S.z;\n  Q *= S.w;\n  R *= e(dot(R, R));\n  vec3 T = max(.6 - vec3(dot(u, u), dot(H, H), dot(I, I)), .0);\n  vec2 U = max(.6 - vec2(dot(J, J), dot(K, K)), .0);\n  T = T * T;\n  U = U * U;\n  return 49. * (dot(T * T, vec3(dot(N, u), dot(O, H), dot(P, I))) + dot(U * U, vec2(dot(Q, J), dot(R, K))));\n}\nconst float V = 3.14159265359;\nfloat W(float X, float Y) {\n  float Z = fwidth(Y) * halfDist;\n  return smoothstep(X - Z, X + Z, Y);\n}\nvec4 ba(vec3 bb) {\n  float bc = min(min(bb.x, bb.y), bb.z);\n  float bd = .0;\n  if(noiseEnable)\n    bd += l(vec4(vPosition.xyz * 80.0, time * halfDist)) * .12;\n  bc += bd;\n  float be = max(bb.x, bb.y);\n  if(bb.y < bb.x && bb.y < bb.z) {\n    be = 1. - be;\n  }\n  float bf = thickness;\n  if(squeeze) {\n    bf *= mix(squeezeMin, squeezeMax, (1. - sin(be * V)));\n  }\n  if(dashEnabled) {\n    float bg = 1. / dashRepeats * dashLength / 2.;\n    if(!dashOverlap) {\n      bg += 1. / dashRepeats / 2.;\n    }\n    if(dashAnimate) {\n      bg += time * .22;\n    }\n    float bh = fract((be + bg) * dashRepeats);\n    bf *= 1. - W(dashLength, bh);\n  }\n  float bi = 1. - W(bf, bc);\n#ifdef HAS_INSTANCE\nvec4 bj = vInstanceColor;\n#else\nvec4 bj = stroke;\n#endif\nvec4 bk = vec4(.0);\n  if(seeThrough) {\n    bk = vec4(bj.xyz, bi);\n    if(insideAltColor && !gl_FrontFacing) {\n      bk.rgb = fill.xyz;\n    }\n  } else {\n    vec3 bl = mix(fill.xyz, bj.xyz, bi);\n    bk.a = fill.a;\n    if(dualStroke) {\n      float bm = 1. - W(secondThickness, bc);\n      vec3 bn = mix(fill.xyz, stroke.xyz, abs(bm - bi));\n      bk.rgb = bn;\n    } else {\n      bk.rgb = bl;\n    }\n  }\n  return bk;\n}\nvoid main() {\n  glFragColor = ba(vBarycentric);\n  glFragColor *= halfDist + opacity;\n#ifdef HAS_MASK_EXTENT\nglFragColor = setMask(glFragColor);\n#endif\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:[{name:"modelViewMatrix",type:"function",fn:(e,n)=>Cv(i,n.viewMatrix,n.modelMatrix)}],extraCommandProps:n}),this.version=300}},earcut:OT,glMatrix:tv,mat2:ov,mat2d:hv,mat3:yv,mat4:Qv,pbr:DT,quat:zx,quat2:Vx,vec2:pb,vec3:P_,vec4:tx}),LT=Array.isArray,FT=Object.keys,NT=Object.prototype.hasOwnProperty,zT=function e(n,i){if(n===i)return!0;if(n&&i&&"object"==typeof n&&"object"==typeof i){var o,s,a,h=LT(n),l=LT(i);if(h&&l){if((s=n.length)!=i.length)return!1;for(o=s;0!=o--;)if(!e(n[o],i[o]))return!1;return!0}if(h!=l)return!1;var c=n instanceof Date,A=i instanceof Date;if(c!=A)return!1;if(c&&A)return n.getTime()==i.getTime();var f=n instanceof RegExp,d=i instanceof RegExp;if(f!=d)return!1;if(f&&d)return n.toString()==i.toString();var p=FT(n);if((s=p.length)!==FT(i).length)return!1;for(o=s;0!=o--;)if(!NT.call(i,p[o]))return!1;for(o=s;0!=o--;)if(!e(n[a=p[o]],i[a]))return!1;return!0}return n!=n&&i!=i},BT=zm(zT);
/*!
   * @maptalks/fusiongl v0.7.2
   * LICENSE : UNLICENSED
   * (c) 2016-2024 maptalks.com
   */
function HT(e){for(let n=1;n<arguments.length;n++){const i=arguments[n];for(const n in i)e[n]=i[n]}return e}function jT(e,...n){for(let i=0;i<n.length;i++)HT(e,n[i])}class DrawBuffersExt{constructor(e){this.context=e,this.COLOR_ATTACHMENT0_WEBGL=36064,this.COLOR_ATTACHMENT1_WEBGL=36065,this.COLOR_ATTACHMENT2_WEBGL=36066,this.COLOR_ATTACHMENT3_WEBGL=36067,this.COLOR_ATTACHMENT4_WEBGL=36068,this.COLOR_ATTACHMENT5_WEBGL=36069,this.COLOR_ATTACHMENT6_WEBGL=36070,this.COLOR_ATTACHMENT7_WEBGL=36071,this.COLOR_ATTACHMENT8_WEBGL=36072,this.COLOR_ATTACHMENT9_WEBGL=36073,this.COLOR_ATTACHMENT10_WEBGL=577040,this.COLOR_ATTACHMENT11_WEBGL=577041,this.COLOR_ATTACHMENT12_WEBGL=577042,this.COLOR_ATTACHMENT13_WEBGL=577043,this.COLOR_ATTACHMENT14_WEBGL=577044,this.COLOR_ATTACHMENT15_WEBGL=577045,this.DRAW_BUFFER0_WEBGL=34853,this.DRAW_BUFFER1_WEBGL=34854,this.DRAW_BUFFER2_WEBGL=34855,this.DRAW_BUFFER3_WEBGL=34856,this.DRAW_BUFFER4_WEBGL=34857,this.DRAW_BUFFER5_WEBGL=34858,this.DRAW_BUFFER6_WEBGL=34859,this.DRAW_BUFFER7_WEBGL=34860,this.DRAW_BUFFER8_WEBGL=34861,this.DRAW_BUFFER9_WEBGL=34862,this.DRAW_BUFFER10_WEBGL=34863,this.DRAW_BUFFER11_WEBGL=34864,this.DRAW_BUFFER12_WEBGL=34865,this.DRAW_BUFFER13_WEBGL=34866,this.DRAW_BUFFER14_WEBGL=34867,this.DRAW_BUFFER15_WEBGL=34868,this.MAX_COLOR_ATTACHMENTS_WEBGL=36063,this.MAX_DRAW_BUFFERS_WEBGL=2178}drawBuffersWEBGL(){return this.context.drawBuffers.apply(this.context,arguments)}}class VertexArrayObjectExt{constructor(e){this.context=e,this.VERTEX_ARRAY_BINDING_OES=34229}createVertexArrayOES(){return this.context.createVertexArray()}deleteVertexArrayOES(){return this.context.deleteVertexArray.apply(this.context,arguments)}isVertexArrayOES(){return this.context.isVertexArray.apply(this.context,arguments)}bindVertexArrayOES(){return this.context.bindVertexArray.apply(this.context,arguments)}}class AngleInstancedArrayExt{constructor(e){this.context=e,this.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070}drawArraysInstancedANGLE(){return this.context.drawArraysInstanced.apply(this.context,arguments)}drawElementsInstancedANGLE(){return this.context.drawElementsInstanced.apply(this.context,arguments)}vertexAttribDivisorANGLE(){return this.context.vertexAttribDivisor.apply(this.context,arguments)}}const UT={webgl_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},oes_element_index_uint:{},oes_texture_float:{},oes_texture_half_float:{HALF_FLOAT_OES:36193},ext_color_buffer_float:{},oes_standard_derivatives:{},ext_frag_depth:{},ext_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},ext_shader_texture_lod:{}},GT={has(e,n){const i=e.t;return!(!i&&!e.i.getExtension(n))&&(n=n.toLowerCase(),i&&UT[n]||"webgl_draw_buffers"===n||"oes_vertex_array_object"===n||"angle_instanced_arrays"===n)},mock:(e,n)=>(n=n.toLowerCase(),UT[n]?e.t?("oes_texture_float"!==n&&"oes_texture_half_float"!==n||e.i.getExtension("EXT_color_buffer_float"),UT[n]):e.i.getExtension(n):"webgl_draw_buffers"===n?new DrawBuffersExt(e):"oes_vertex_array_object"===n?new VertexArrayObjectExt(e):"angle_instanced_arrays"===n?new AngleInstancedArrayExt(e):null),getInternalFormat:(e,n,i)=>6402===n?33190:34041===n?35056:36193===i&&n===e.RGBA?34842:36193===i&&n===e.RGB?34843:i===e.FLOAT&&n===e.RGBA?34836:i===e.FLOAT&&n===e.RGB?34837:n,getTextureType:(e,n)=>36193===n?e.HALF_FLOAT:n};let VT=1,WT=class WebGL2RenderingContext{constructor(e){this.uid=VT++,this.states=function(e){return{scissor:[0,0,e.canvas.width,e.canvas.height],viewport:[0,0,e.canvas.width,e.canvas.height],blendColor:[0,0,0,0],blendEquationSeparate:[e.FUNC_ADD,e.FUNC_ADD],blendFuncSeparate:[e.ONE,e.ZERO,e.ONE,e.ZERO],clearColor:[0,0,0,0],clearDepth:[1],clearStencil:[0],colorMask:[!0,!0,!0,!0],cullFace:[e.BACK],depthFunc:[e.LESS],depthMask:[!0],depthRange:[0,1],capabilities:{3042:!1,2884:!1,2929:!1,3024:!1,32823:!1,32926:!1,32928:!1,3089:!1,2960:!1},frontFace:[e.CCW],hint:{33170:[e.DONT_CARE],35723:[e.DONT_CARE]},lineWidth:[1],pixelStorei:{3333:[4],3317:[4],37440:[!1],37441:[!1],37443:[e.BROWSER_DEFAULT_WEBGL]},polygonOffset:[0,0],sampleCoverage:[1,!1],stencilFuncSeparate:{1028:[e.ALWAYS,0,4294967295],1029:[e.ALWAYS,0,4294967295]},stencilMaskSeparate:{1028:[4294967295],1029:[4294967295]},stencilOpSeparate:{1028:[e.KEEP,e.KEEP,e.KEEP],1029:[e.KEEP,e.KEEP,e.KEEP]},program:null,framebuffer:{36160:null,36008:null,36009:null},renderbuffer:{36161:null},textures:{active:-1,units:function(){const n=[],i=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);for(let e=0;e<i;e++)n.push({3553:null,34067:null});return n[-1]={3553:null,34067:null},n}()},attributes:{},arrayBuffer:null,elementArrayBuffer:null}}(e),this.i=e,this.i._fusiongl_drawCalls=0,this.t=void 0!==window.WebGL2RenderingContext&&this.i instanceof window.WebGL2RenderingContext;const n=Object.getPrototypeOf(this);Object.setPrototypeOf(n,this.t?window.WebGL2RenderingContext.prototype:WebGLRenderingContext.prototype),this.s=e.getParameter(e.MAX_VERTEX_ATTRIBS)}get canvas(){return this.i.canvas}get drawingBufferWidth(){return this.i.drawingBufferWidth}get drawingBufferHeight(){return this.i.drawingBufferHeight}get drawingBufferColorSpace(){return this.i.drawingBufferColorSpace}set drawingBufferColorSpace(e){this.i.drawingBufferColorSpace=e}get gl(){return this.i}get buffersOES(){return this.h||(this.h=this.i.getExtension("WEBGL_draw_buffers")),this.h}get vaoOES(){return this.u||(this.u=this.i.getExtension("OES_vertex_array_object")),this.u}get angleOES(){return this.o||(this.o=this.i.getExtension("ANGLE_instanced_arrays")),this.o}get standOES(){return this.l||(this.l=this.i.getExtension("OES_standard_derivatives")),this.l}attachShader(e,n){return this.i.attachShader(e,n)}shaderSource(e,n){return this.i.shaderSource(e,n)}compileShader(e){return this.i.compileShader(e)}createShader(e){return this.i.createShader(e)}createProgram(){return this.i.createProgram()}deleteProgram(e){return this.states.program===e&&(this.states.program=null),this.i.deleteProgram(e)}deleteShader(e){return this.i.deleteShader(e)}detachShader(e,n){return this.i.detachShader(e,n)}getAttachedShaders(e){return this.i.getAttachedShaders(e)}linkProgram(e){return this.i.linkProgram(e)}makeXRCompatible(){return this.i.makeXRCompatible()}getShaderParameter(e,n){return this.i.getShaderParameter(e,n)}getShaderPrecisionFormat(e,n){return this.i.getShaderPrecisionFormat(e,n)}getShaderInfoLog(e){return this.i.getShaderInfoLog(e)}getShaderSource(e){return this.i.getShaderSource(e)}getProgramInfoLog(e){return this.i.getProgramInfoLog(e)}getProgramParameter(e,n){return this.i.getProgramParameter(e,n)}getError(){return this.i.getError()}getContextAttributes(){return this.i.getContextAttributes()}getExtension(e){return GT.has(this,e)?GT.mock(this,e):this.i.getExtension(e)}getSupportedExtensions(){return this.i.getSupportedExtensions()}getParameter(e){return this.i.getParameter(e)}isEnabled(e){return this.i.isEnabled(e)}isProgram(e){return this.i.isProgram(e)}isShader(e){return this.i.isShader(e)}validateProgram(e){return this.i.validateProgram(e)}clear(e){return this.m(),this.i.clear(e)}drawArrays(e,n,i){return this.m(),this.g(),this.i.drawArrays(e,n,i)}drawElements(e,n,i,o){return this.m(),this.g(),this.i.drawElements(e,n,i,o)}drawBuffers(e){return this.m(),this.g(),this.t?this.i.drawBuffers(e):this.buffersOES.drawBuffersWEBGL(e)}g(){this.i._fusiongl_drawCalls++}resetDrawCalls(){this.i._fusiongl_drawCalls=0}getDrawCalls(){return this.i._fusiongl_drawCalls}v(){const e=this.i,n=e.getParameter(e.CURRENT_PROGRAM),i=e.getProgramParameter(n,e.ACTIVE_ATTRIBUTES),o=[];for(let n=0;n<i;n++)o.push(e.getVertexAttrib(n,e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING));this._={buffers:o,elements:e.getParameter(e.ELEMENT_ARRAY_BUFFER_BINDING),framebuffer:e.getParameter(e.FRAMEBUFFER_BINDING)},window.DEBUGGING&&(console.log(this.uid,this._),console.log(this.uid,this.states.attributes),console.log(this.states.attributes[0].buffer===this._.buffers[0]),console.log(this.states.attributes[1].buffer===this._.buffers[1]),console.log(this.states.attributes[2].buffer===this._.buffers[2]))}finish(){return this.i.finish()}flush(){return this.m(),this.i.flush()}commit(){return this.m(),this.i.commit()}isContextLost(){return this.i.isContextLost()}getFragDataLocation(e,n){return this.i.getFragDataLocation(e,n)}createSampler(){return this.i.createSampler()}deleteSampler(){return this.i.deleteSampler()}bindSampler(){return this.i.bindSampler()}isSampler(){return this.i.isSampler()}getSamplerParameter(){return this.i.getSamplerParameter()}isQuery(e){return this.i.beginQuery(e)}beginQuery(e,n){return this.i.beginQuery(e,n)}deleteQuery(e){return this.i.query(e)}isTransformFeedback(e){return this.i.isTransformFeedback(e)}beginTransformFeedback(e){return this.i.beginTransformFeedback(e)}deleteTransformFeedback(e){return this.i.deleteTransformFeedback(e)}pauseTransformFeedback(){return this.i.pauseTransformFeedback()}resumeTransformFeedback(){return this.i.resumeTransformFeedback()}transformFeedbackVaryings(e,n,i){return this.i.transformFeedbackVaryings(e,n,i)}bindBufferBase(e,n,i){return this.i.bbindBufferBase(e,n,i)}bindBufferRange(e,n,i,o,s){return this.i.bindBufferRange(e,n,i,o,s)}bindTransformFeedback(e,n){return this.i.bindTransformFeedback(e,n)}fenceSync(e,n){return this.i.fenceSync(e,n)}isSync(e){return this.i.isSync(e)}deleteSync(e){return this.i.deleteSync(e)}clientWaitSync(e,n,i){return this.i.clientWaitSync(e,n,i)}waitSync(e,n,i){return this.i.waitSync(e,n,i)}getSyncParameter(e,n){return this.i.getSyncParameter(e,n)}getIndexedParameter(e,n){return this.i.getIndexedParameter(e,n)}};jT(WT.prototype,{bufferData(...e){return this.m(),this.i.bufferData(...e)},bufferSubData(...e){return this.m(),this.i.bufferSubData(...e)},createBuffer(){return this.i.createBuffer()},deleteBuffer(e){const n=this.states;n.arrayBuffer===e?n.arrayBuffer=null:n.elementArrayBuffer===e&&(n.elementArrayBuffer=null);const i=n.attributes;for(const n in i)i[n].buffer===e&&(i[n].buffer=null);return this.i.deleteBuffer(e)},getBufferParameter(e,n){return this.m(),this.i.getBufferParameter(e,n)},isBuffer(e){return this.i.isBuffer(e)},copyBufferSubData(e,n,i,o,s){return this.i.isBuffer(e,n,i,o,s)},readBuffer(e){return this.i.readBuffer(e)}}),jT(WT.prototype,{checkFramebufferStatus(e){return this.i.checkFramebufferStatus(e)},createFramebuffer(){return this.i.createFramebuffer()},deleteFramebuffer(e){const n=this.states.framebuffer;for(const i in n)n[i]===e&&(n[i]=null);return this.i.deleteFramebuffer(e)},framebufferRenderbuffer(e,n,i,o){return this.m(),this.i.framebufferRenderbuffer(e,n,i,o)},framebufferTexture2D(e,n,i,o,s){return this.m(),this.i.framebufferTexture2D(e,n,i,o,s)},getFramebufferAttachmentParameter(e,n,i){return this.m(),this.i.getFramebufferAttachmentParameter(e,n,i)},isFramebuffer(e){return this.i.isFramebuffer(e)},readPixels(e,n,i,o,s,a,h){return this.m(),this.i.readPixels(e,n,i,o,s,a,h)},blitFramebuffer(e,n,i,o,s,a,h,l,c,A){return this.m(),this.i.blitFramebuffer(e,n,i,o,s,a,h,l,c,A)}}),jT(WT.prototype,{createRenderbuffer(){return this.i.createRenderbuffer()},deleteRenderbuffer(e){const n=this.states.renderbuffer;for(const i in n)n[i]===e&&(n[i]=null);return this.i.deleteRenderbuffer(e)},getRenderbufferParameter(e,n){return this.m(),this.i.getRenderbufferParameter(e,n)},isRenderbuffer(e){return this.i.isRenderbuffer(e)},renderbufferStorage(e,n,i,o){return this.m(),this.i.renderbufferStorage(e,n,i,o)},renderbufferStorageMultisample(e,n,i,o,s){return this.m(),this.i.renderbufferStorageMultisample(e,n,i,o,s)}}),jT(WT.prototype,{scissor(e,n,i,o){this.m();const s=this.states.scissor;s[0]===e&&s[1]===n&&s[2]===i&&s[3]===o||(s[0]=e,s[1]=n,s[2]=i,s[3]=o,this.i.scissor(e,n,i,o))},viewport(e,n,i,o){this.m();const s=this.states.viewport;s[0]===e&&s[1]===n&&s[2]===i&&s[3]===o||(s[0]=e,s[1]=n,s[2]=i,s[3]=o,this.i.viewport(e,n,i,o))},blendColor(e,n,i,o){this.m();const s=this.states.blendColor;s[0]===e&&s[1]===n&&s[2]===i&&s[3]===o||(s[0]=e,s[1]=n,s[2]=i,s[3]=o,this.i.blendColor(e,n,i,o))},blendEquation(e){this.m();const n=this.states.blendEquationSeparate;n[0]===e&&n[1]===e||(n[0]=e,n[1]=e,this.i.blendEquation(e))},blendEquationSeparate(e,n){this.m();const i=this.states.blendEquationSeparate;i[0]===e&&i[1]===n||(i[0]=e,i[1]=n,this.i.blendEquationSeparate(e,n))},blendFunc(e,n){this.m();const i=this.states.blendFuncSeparate;i[0]===e&&i[2]===e&&i[1]===n&&i[3]===n||(i[0]=e,i[1]=n,i[2]=e,i[3]=n,this.i.blendFunc(e,n))},blendFuncSeparate(e,n,i,o){this.m();const s=this.states.blendFuncSeparate;s[0]===e&&s[1]===n&&s[2]===i&&s[3]===o||(s[0]=e,s[1]=n,s[2]=i,s[3]=o,this.i.blendFuncSeparate(e,n,i,o))},clearColor(e,n,i,o){this.m();const s=this.states.clearColor;s[0]===e&&s[1]===n&&s[2]===i&&s[3]===o||(s[0]=e,s[1]=n,s[2]=i,s[3]=o,this.i.clearColor(e,n,i,o))},clearDepth(e){this.m();const n=this.states.clearDepth;n[0]!==e&&(n[0]=e,this.i.clearDepth(e))},clearStencil(e){this.m();const n=this.states.clearStencil;n[0]!==e&&(n[0]=e,this.i.clearStencil(e))},colorMask(e,n,i,o){this.m();const s=this.states.colorMask;s[0]===e&&s[1]===n&&s[2]===i&&s[3]===o||(s[0]=e,s[1]=n,s[2]=i,s[3]=o,this.i.colorMask(e,n,i,o))},cullFace(e){this.m();const n=this.states.cullFace;n[0]!==e&&(n[0]=e,this.i.cullFace(e))},depthFunc(e){this.m();const n=this.states.depthFunc;n[0]!==e&&(n[0]=e,this.i.depthFunc(e))},depthMask(e){this.m();const n=this.states.depthMask;n[0]!==e&&(n[0]=e,this.i.depthMask(e))},depthRange(e,n){this.m();const i=this.states.depthRange;i[0]===e&&i[1]===n||(i[0]=e,i[1]=n,this.i.depthRange(e,n))},disable(e){this.m();const n=this.states.capabilities;n[e]&&(n[e]=!1,this.i.disable(e))},enable(e){this.m();const n=this.states.capabilities;n[e]||(n[e]=!0,this.i.enable(e))},frontFace(e){this.m();const n=this.states.frontFace;n[0]!==e&&(n[0]=e,this.i.frontFace(e))},hint(e,n){this.m();const i=this.states.hint;i[e][0]!==n&&(i[e][0]=n,this.i.hint(e,n))},lineWidth(e){this.m();const n=this.states.lineWidth;n[0]!==e&&(n[0]=e,this.i.lineWidth(e))},pixelStorei(e,n){this.m();const i=this.states.pixelStorei;i[e]!==n&&(i[e]&&(i[e][0]=n),this.i.pixelStorei(e,n))},polygonOffset(e,n){this.m();const i=this.states.polygonOffset;i[0]===e&&i[1]===n||(i[0]=e,i[1]=n,this.i.polygonOffset(e,n))},sampleCoverage(e,n){this.m();const i=this.states.sampleCoverage;i[0]===e&&i[1]===n||(i[0]=e,i[1]=n,this.i.sampleCoverage(e,n))},stencilFunc(e,n,i){this.m();const o=this.states.stencilFuncSeparate,s=this.i;o[s.FRONT][0]===e&&o[s.FRONT][1]===n&&o[s.FRONT][2]===i&&o[s.BACK][0]===e&&o[s.BACK][1]===n&&o[s.BACK][2]===i||(o[s.FRONT][0]=o[s.BACK][0]=e,o[s.FRONT][1]=o[s.BACK][1]=n,o[s.FRONT][2]=o[s.BACK][2]=i,this.i.stencilFunc(e,n,i))},stencilFuncSeparate(e,n,i,o){if(this.m(),e===this.i.FRONT_AND_BACK)return void this.stencilFunc(n,i,o);const s=this.states.stencilFuncSeparate;s[e][0]===n&&s[e][1]===i&&s[e][2]===o||(s[e][0]=n,s[e][1]=i,s[e][2]=o,this.i.stencilFuncSeparate(e,n,i,o))},stencilMask(e){this.m();const n=this.i,i=this.states.stencilMaskSeparate;i[n.FRONT][0]===e&&i[n.BACK][0]===e||(i[n.FRONT][0]=e,i[n.BACK][0]=e,this.i.stencilMask(e))},stencilMaskSeparate(e,n){if(this.m(),e===this.i.FRONT_AND_BACK)return void this.stencilMask(n);const i=this.states.stencilMaskSeparate;i[e][0]!==n&&(i[e][0]=n,this.i.stencilMaskSeparate(e,n))},stencilOp(e,n,i){this.m();const o=this.states.stencilOpSeparate,s=this.i;o[s.FRONT][0]===e&&o[s.FRONT][1]===n&&o[s.FRONT][2]===i&&o[s.BACK][0]===e&&o[s.BACK][1]===n&&o[s.BACK][2]===i||(o[s.FRONT][0]=o[s.BACK][0]=e,o[s.FRONT][1]=o[s.BACK][1]=n,o[s.FRONT][2]=o[s.BACK][2]=i,this.i.stencilOp(e,n,i))},stencilOpSeparate(e,n,i,o){if(this.m(),e===this.i.FRONT_AND_BACK)return void this.stencilOp(n,i,o);const s=this.states.stencilOpSeparate;s[e][0]===n&&s[e][1]===i&&s[e][2]===o||(s[e][0]=n,s[e][1]=i,s[e][2]=o,this.i.stencilOpSeparate(e,n,i,o))},bindFramebuffer(e,n){this.m();const i=this.states.framebuffer;i[e]!==n&&(i[e]=n,this.i.bindFramebuffer(e,n))},bindRenderbuffer(e,n){this.m();const i=this.states.renderbuffer;i[e]!==n&&(i[e]=n,this.i.bindRenderbuffer(e,n))},bindTexture(e,n){this.m();const i=this.states.textures;i.units[-1!==i.active?i.active-33984:-1][e]=n,this.i.bindTexture(e,n)},activeTexture(e){this.m();const n=this.i,i=this.states.textures,o=i.active;i.active=e,this.activeUnit!==e&&(n.activeTexture(e),this.activeUnit=e),-1===o&&(i.units[e-33984][n.TEXTURE_2D]=i.units[-1][n.TEXTURE_2D],i.units[e-33984][n.TEXTURE_CUBE_MAP]=i.units[-1][n.TEXTURE_CUBE_MAP],i.units[-1][n.TEXTURE_2D]=null,i.units[-1][n.TEXTURE_CUBE_MAP]=null)},useProgram(e){this.m();const n=this.states;n.program!==e&&(this.states.activeAttribType=0,n.program=e,void 0===e.fid&&(e.fid=0),this.S(),this.i.useProgram(e))},S(){const e=this.states.program;if(!e)return;const n=e.cachedUniforms=e.cachedUniforms||{};for(const e in n)Array.isArray(n[e])?n[e].fill(null):n[e]=null},bindBuffer(e,n){this.m();const i=this.i,o=this.states;e===i.ELEMENT_ARRAY_BUFFER?o.elementArrayBuffer=n:o.arrayBuffer=n,i.bindBuffer(e,n)},bindVertexArray(e){this.m(),this.states.activeAttribType=1;const n=this.i,i=this.states;i.vao!==e&&(i.vao=e,this.t?n.bindVertexArray(e):this.vaoOES.bindVertexArrayOES(e))},vertexAttribPointer(e,n,i,o,s,a){this.m(),this.states.attributes[e]||(this.states.attributes[e]={enable:!0});const h=this.states.attributes[e];return h.buffer=this.states.arrayBuffer,h.args?(h.args[0]=e,h.args[1]=n,h.args[2]=i,h.args[3]=o,h.args[4]=s,h.args[5]=a):h.args=[e,n,i,o,s,a],this.i.vertexAttribPointer(e,n,i,o,s,a)},vertexAttribDivisor(e,n){return this.m(),this.states.attributes[e].divisor=n,this.t?this.i.vertexAttribDivisor(e,n):this.angleOES.vertexAttribDivisorANGLE(e,n)}},{m(){const e=this.i;if(e.A!==this)if(e.A){this.p(e.A.states),e.A=this}else e.A=this},p(e){if(!e)return;delete this.activeUnit;const n=this.states,i=this.i;let o=0;for(const s in n)if("capabilities"!==s&&"textures"!==s&&"attributes"!==s&&"arrayBuffer"!==s&&"elementArrayBuffer"!==s&&"vao"!==s)if("program"===s)n.program!==e.program&&(i.useProgram(n.program),n.program&&(o=i.getProgramParameter(n.program,i.ACTIVE_ATTRIBUTES)));else if("framebuffer"===s)for(const o in n[s])n[s][o]!==e[s][o]&&i.bindFramebuffer(+o,n[s][o]);else if("renderbuffer"===s)for(const o in n[s])n[s][o]!==e[s][o]&&i.bindRenderbuffer(+o,n[s][o]);else if(!BT(n[s],e[s]))if(Array.isArray(e[s]))i[s](...n[s]);else if(e[s])for(const o in n[s])BT(n[s][o],e[s][o])||i[s](+o,...n[s][o]);this.S();for(const o in n.capabilities)n.capabilities[o]!==e.capabilities[o]&&i[n.capabilities[o]?"enable":"disable"](+o);const s=n.textures,a=s.units,h=e.textures.units,l=s.active-i.TEXTURE0;for(let e=0;e<a.length;e++)e===l||a[e][i.TEXTURE_2D]===h[e][i.TEXTURE_2D]&&a[e][i.TEXTURE_CUBE_MAP]===h[e][i.TEXTURE_CUBE_MAP]||(i.activeTexture(i.TEXTURE0+e),i.bindTexture(i.TEXTURE_2D,a[e][i.TEXTURE_2D]),i.bindTexture(i.TEXTURE_CUBE_MAP,a[e][i.TEXTURE_CUBE_MAP]));if(s.active>-1){const e=a[l];e[i.TEXTURE_2D]===h[l][i.TEXTURE_2D]&&e[i.TEXTURE_CUBE_MAP]===h[l][i.TEXTURE_CUBE_MAP]||(i.activeTexture(s.active),i.bindTexture(i.TEXTURE_2D,e[i.TEXTURE_2D]),i.bindTexture(i.TEXTURE_CUBE_MAP,e[i.TEXTURE_CUBE_MAP]))}this.t?i.bindVertexArray(null):this.u&&this.u.bindVertexArrayOES(null);const c=this.s;if(this.t||this.angleOES)for(let e=0;e<c;e++)this.t?i.vertexAttribDivisor(e,0):this.angleOES.vertexAttribDivisorANGLE(e,0);i.bindBuffer(i.ARRAY_BUFFER,n.arrayBuffer),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,n.elementArrayBuffer),1===n.activeAttribType?this.N(n,i):this.F(n,i,o)},N(e,n){const i=e.vao;i&&(this.t?n.bindVertexArray(i||null):this.u&&this.u.bindVertexArrayOES(i||null))},F(e,n,i){const o=this.s,s=e.attributes;let a=0;for(let e=0;e<o;e++){const o=s[e];if(a<i&&o){if(o.buffer){if(n.bindBuffer(n.ARRAY_BUFFER,o.buffer),n.vertexAttribPointer(...o.args),o.divisor&&(this.t?n.vertexAttribDivisor(e,o.divisor):this.angleOES.vertexAttribDivisorANGLE(e,o.divisor)),o.enable){n.enableVertexAttribArray(e),a++;continue}n.disableVertexAttribArray(e)}n.disableVertexAttribArray(e)}else n.disableVertexAttribArray(e)}}}),jT(WT.prototype,{compressedTexImage2D(e,n,i,o,s,a,h){return this.m(),this.i.compressedTexImage2D(e,n,i,o,s,a,h)},copyTexImage2D(e,n,i,o,s,a,h,l){return this.m(),this.i.copyTexImage2D(e,n,i,o,s,a,h,l)},copyTexSubImage2D(e,n,i,o,s,a,h,l){return this.m(),this.i.copyTexSubImage2D(e,n,i,o,s,a,h,l)},createTexture(){return this.i.createTexture()},deleteTexture(e){const n=this.states.textures.units;for(let i=0;i<n.length;i++)for(const o in n[i])n[i][o]===e&&(n[i][o]=null);return this.i.deleteTexture(e)},generateMipmap(e){return this.m(),this.i.generateMipmap(e)},getTexParameter(e,n){return this.m(),this.i.getTexParameter(e,n)},isTexture(e){return this.i.isTexture(e)},texImage2D(...e){if(this.m(),this.t){const n=e[e.length-2],i=GT.getInternalFormat(this.i,e[2],n);i!==e[2]&&(e[2]=i);const o=GT.getTextureType(this.i,n);o!==n&&(e[e.length-2]=o)}return this.i.texImage2D(...e)},texSubImage2D(...e){if(this.m(),this.t){const n=e[e.length-2],i=GT.getTextureType(this.i,n);i!==n&&(e[e.length-2]=i)}return this.i.texSubImage2D(...e)},texParameterf(e,n,i){return this.m(),this.i.texParameterf(e,n,i)},texParameteri(e,n,i){return this.m(),this.i.texParameteri(e,n,i)},texStorage2D(e,n,i,o,s){return this.m(),this.i.texStorage2D(e,n,i,o,s)},texImage3D(e,n,i,o,s,a,h,l,c,A){return this.m(),this.i.texImage3D(e,n,i,o,s,a,h,l,c,A)},texStorage3D(e,n,i,o,s,a){return this.m(),this.i.texStorage3D(e,n,i,o,s,a)},texSubImage3D(e,n,i,o,s,a,h,l,c,A,f){return this.m(),this.i.texSubImage3D(e,n,i,o,s,a,h,l,c,A,f)},copyTexSubImage3D(e,n,i,o,s,a,h,l,c){return this.m(),this.i.copyTexSubImage3D(e,n,i,o,s,a,h,l,c)},compressedTexSubImage3D(e,n,i,o,s,a,h,l,c,A,f){return this.m(),this.i.compressedTexSubImage3D(e,n,i,o,s,a,h,l,c,A,f)}});const qT=[];function ZT(e,n){const i=n.length;for(let o=0;o<i;o++)e[o]=n[o];return e}jT(WT.prototype,{bindAttribLocation(e,n,i){return this.i.bindAttribLocation(e,n,i)},enableVertexAttribArray(e){return this.m(),this.states.attributes[e]||(this.states.attributes[e]={}),this.states.attributes[e].enable=!0,this.i.enableVertexAttribArray(e)},disableVertexAttribArray(e){return this.m(),this.states.attributes[e]||(this.states.attributes[e]={}),this.states.attributes[e].enable=!1,this.i.disableVertexAttribArray(e)},getActiveAttrib(e,n){return this.i.getActiveAttrib(e,n)},getActiveUniform(e,n){return this.i.getActiveUniform(e,n)},getAttribLocation(e,n){return this.i.getAttribLocation(e,n)},getUniformLocation(e,n){return this.i.getUniformLocation(e,n)},getVertexAttrib(e,n){return this.m(),this.i.getVertexAttrib(e,n)},getVertexAttribOffset(e,n){return this.m(),this.i.getVertexAttribOffset(e,n)},uniformBlockBinding(e,n,i){return this.m(),this.i.uniformBlockBinding(e,n,i)},L(e,...n){const i=this.states.program;if(!i)return!1;let o=e.fid;void 0===o&&(o=e.fid=i.fid++);const s=i.cachedUniforms[o];return!!function(e,n){if(!e)return!1;const i=n.length;for(let o=0;o<i;o++)if(e[o]&&void 0!==e[o].length){const i=e[o].length;for(let s=0;s<i;s++)if(e[o][s]!==n[o][s])return!1}else if(e[o]!==n[o])return!1;return!0}(s,n)||(i.cachedUniforms[o]=function(e,n){e=e||new Array(n.length);const i=n.length;for(let o=0;o<i;o++)e[o]=void 0!==n[o].length?ZT(e[o]||[],n[o]):n[o];return e}(s,n),!1)},uniformMatrix2fv(e,n,i){this.L(e,n,i)||(this.m(),this.i.uniformMatrix2fv(e,n,i))},uniformMatrix3fv(e,n,i){this.L(e,n,i)||(this.m(),this.i.uniformMatrix3fv(e,n,i))},uniformMatrix4fv(e,n,i){i=this.B(i),this.L(e,n,i)||this.i.uniformMatrix4fv(e,n,i)},B:e=>e?(qT[0]=isNaN(e[0])?-1e30:e[0],qT[1]=isNaN(e[1])?-1e30:e[1],qT[2]=isNaN(e[2])?-1e30:e[2],qT[3]=isNaN(e[3])?-1e30:e[3],qT[4]=isNaN(e[4])?-1e30:e[4],qT[5]=isNaN(e[5])?-1e30:e[5],qT[6]=isNaN(e[6])?-1e30:e[6],qT[7]=isNaN(e[7])?-1e30:e[7],qT[8]=isNaN(e[8])?-1e30:e[8],qT[9]=isNaN(e[9])?-1e30:e[9],qT[10]=isNaN(e[10])?-1e30:e[10],qT[11]=isNaN(e[11])?-1e30:e[11],qT[12]=isNaN(e[12])?-1e30:e[12],qT[13]=isNaN(e[13])?-1e30:e[13],qT[14]=isNaN(e[14])?-1e30:e[14],qT[15]=isNaN(e[15])?-1e30:e[15],qT):e,uniform1f(e,n){return this.m(),this.i.uniform1f(e,n)},uniform1i(e,n){return this.m(),this.i.uniform1i(e,n)},uniform2f(e,n,i){return this.m(),this.i.uniform2f(e,n,i)},uniform2i(e,n,i){return this.m(),this.i.uniform2i(e,n,i)},uniform3f(e,n,i,o){return this.m(),this.i.uniform3f(e,n,i,o)},uniform3i(e,n,i,o){return this.m(),this.i.uniform3i(e,n,i,o)},uniform4f(e,n,i,o,s){return this.m(),this.i.uniform4f(e,n,i,o,s)},uniform4i(e,n,i,o,s){return this.m(),this.i.uniform4i(e,n,i,o,s)},uniform1ui(e,n){return this.m(),this.i.uniform1ui(e,n)},uniform2ui(e,n,i){return this.m(),this.i.uniform2ui(e,n,i)},uniform3ui(e,n,i,o){return this.m(),this.i.uniform3ui(e,n,i,o)},uniform4ui(e,n,i,o,s){return this.m(),this.i.uniform4ui(e,n,i,o,s)},uniform1fv(e,n,i,o){this.m(),void 0!==o?this.i.uniform1fv(e,n,i,o):void 0!==i?this.i.uniform1fv(e,n,i):this.i.uniform1fv(e,n)},uniform2fv(e,n,i,o){this.m(),void 0!==o?this.i.uniform2fv(e,n,i,o):void 0!==i?this.i.uniform2fv(e,n,i):this.i.uniform2fv(e,n)},uniform3fv(e,n,i,o){this.m(),void 0!==o?this.i.uniform3fv(e,n,i,o):void 0!==i?this.i.uniform3fv(e,n,i):this.i.uniform3fv(e,n)},uniform4fv(e,n,i,o){this.m(),void 0!==o?this.i.uniform4fv(e,n,i,o):void 0!==i?this.i.uniform4fv(e,n,i):this.i.uniform4fv(e,n)},uniform1iv(e,n,i,o){this.m(),void 0!==o?this.i.uniform1iv(e,n,i,o):void 0!==i?this.i.uniform1iv(e,n,i):this.i.uniform1iv(e,n)},uniform2iv(e,n,i,o){this.m(),void 0!==o?this.i.uniform2iv(e,n,i,o):void 0!==i?this.i.uniform2iv(e,n,i):this.i.uniform2iv(e,n)},uniform3iv(e,n,i,o){this.m(),void 0!==o?this.i.uniform3iv(e,n,i,o):void 0!==i?this.i.uniform3iv(e,n,i):this.i.uniform3iv(e,n)},uniform4iv(e,n,i,o){this.m(),void 0!==o?this.i.uniform4iv(e,n,i,o):void 0!==i?this.i.uniform4iv(e,n,i):this.i.uniform4iv(e,n)},uniform1uiv(e,n,i,o){this.m(),void 0!==o?this.i.uniform1uiv(e,n,i,o):void 0!==i?this.i.uniform1uiv(e,n,i):this.i.uniform1uiv(e,n)},uniform2uiv(e,n,i,o){this.m(),void 0!==o?this.i.uniform2uiv(e,n,i,o):void 0!==i?this.i.uniform2uiv(e,n,i):this.i.uniform2uiv(e,n)},uniform3uiv(e,n,i,o){this.m(),void 0!==o?this.i.uniform3uiv(e,n,i,o):void 0!==i?this.i.uniform3uiv(e,n,i):this.i.uniform3uiv(e,n)},uniform4uiv(e,n,i,o){this.m(),void 0!==o?this.i.uniform4uiv(e,n,i,o):void 0!==i?this.i.uniform4uiv(e,n,i):this.i.uniform4uiv(e,n)},vertexAttrib1f(e,n){return this.m(),this.i.vertexAttrib1f(e,n)},vertexAttrib2f(e,n,i){return this.m(),this.i.vertexAttrib2f(e,n,i)},vertexAttrib3f(e,n,i,o){return this.m(),this.i.vertexAttrib3f(e,n,i,o)},vertexAttrib4f(e,n,i,o,s){return this.m(),this.i.vertexAttrib4f(e,n,i,o,s)},vertexAttrib1fv(e,n){return this.m(),this.i.vertexAttrib1fv(e,n)},vertexAttrib2fv(e,n){return this.m(),this.i.vertexAttrib2fv(e,n)},vertexAttrib3fv(e,n){return this.m(),this.i.vertexAttrib3fv(e,n)},vertexAttrib4fv(e,n){return this.m(),this.i.vertexAttrib4fv(e,n)},vertexAttribI4i(e,n,i,o,s){return this.m(),this.i.vertexAttribI4i(e,n,i,o,s)},vertexAttribI4ui(e,n,i,o,s){return this.m(),this.i.vertexAttribI4ui(e,n,i,o,s)},vertexAttribI4iv(e,n){return this.m(),this.i.vertexAttribI4iv(e,n)},vertexAttribI4uiv(e,n){return this.m(),this.i.vertexAttribI4uiv(e,n)}}),jT(WT.prototype,{createVertexArray(){return this.t?this.i.createVertexArray():this.vaoOES.createVertexArrayOES()},deleteVertexArray(e){const n=this.states;return n.vao===e&&(n.vao=null),this.t?this.i.deleteVertexArray(e):this.vaoOES.deleteVertexArrayOES(e)},isVertexArray(e){return this.t?this.i.isVertexArray(e):this.vaoOES.isVertexArrayOES(e)}}),jT(WT.prototype,{drawArraysInstanced(e,n,i,o){return this.m(),this.g(),this.t?this.i.drawArraysInstanced(e,n,i,o):this.angleOES.drawArraysInstancedANGLE(e,n,i,o)},drawElementsInstanced(e,n,i,o,s){return this.m(),this.g(),this.t?this.i.drawElementsInstanced(e,n,i,o,s):this.angleOES.drawElementsInstancedANGLE(e,n,i,o,s)}});
/*!
   * @maptalks/gl v0.102.1
   * LICENSE : UNLICENSED
   * (c) 2016-2024 maptalks.com
   */
/*!
   * @maptalks/gltf-loader v0.98.4
   * LICENSE : UNLICENSED
   * (c) 2016-2024 maptalks.org
   */
var QT="undefined"!=typeof Float32Array?Float32Array:Array;function XT(e,n,i){var o=n[0],s=n[1],a=n[2],h=n[3],l=n[4],c=n[5],A=n[6],f=n[7],d=n[8],p=n[9],g=n[10],v=n[11],w=n[12],C=n[13],P=n[14],T=n[15],S=i[0],I=i[1],E=i[2],O=i[3];return e[0]=S*o+I*l+E*d+O*w,e[1]=S*s+I*c+E*p+O*C,e[2]=S*a+I*A+E*g+O*P,e[3]=S*h+I*f+E*v+O*T,e[4]=(S=i[4])*o+(I=i[5])*l+(E=i[6])*d+(O=i[7])*w,e[5]=S*s+I*c+E*p+O*C,e[6]=S*a+I*A+E*g+O*P,e[7]=S*h+I*f+E*v+O*T,e[8]=(S=i[8])*o+(I=i[9])*l+(E=i[10])*d+(O=i[11])*w,e[9]=S*s+I*c+E*p+O*C,e[10]=S*a+I*A+E*g+O*P,e[11]=S*h+I*f+E*v+O*T,e[12]=(S=i[12])*o+(I=i[13])*l+(E=i[14])*d+(O=i[15])*w,e[13]=S*s+I*c+E*p+O*C,e[14]=S*a+I*A+E*g+O*P,e[15]=S*h+I*f+E*v+O*T,e}function YT(){var e=new QT(3);return QT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function JT(e,n,i){var o=new QT(3);return o[0]=e,o[1]=n,o[2]=i,o}function KT(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function $T(e,n,i,o){return e[0]=n,e[1]=i,e[2]=o,e}function tS(e,n,i){return e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e}function eS(e,n,i){return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e}function nS(e,n,i,o,s){return e[0]=n,e[1]=i,e[2]=o,e[3]=s,e}function iS(e,n,i){var o=n[0],s=n[1],a=n[2],h=n[3];return e[0]=i[0]*o+i[4]*s+i[8]*a+i[12]*h,e[1]=i[1]*o+i[5]*s+i[9]*a+i[13]*h,e[2]=i[2]*o+i[6]*s+i[10]*a+i[14]*h,e[3]=i[3]*o+i[7]*s+i[11]*a+i[15]*h,e}function rS(){var e=new QT(4);return QT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}Math.hypot||(Math.hypot=function(){for(var e=0,n=arguments.length;n--;)e+=arguments[n]*arguments[n];return Math.sqrt(e)}),YT(),function(){var e;e=new QT(4),QT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}();var oS,sS=function(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e};YT(),JT(1,0,0),JT(0,1,0),rS(),rS(),oS=new QT(9),QT!=Float32Array&&(oS[1]=0,oS[2]=0,oS[3]=0,oS[5]=0,oS[6]=0,oS[7]=0),oS[0]=1,oS[4]=1,oS[8]=1;let aS=0;function hS(e){return null==e}function lS(e){return!hS(e)}function uS(e){return!hS(e)&&("string"==typeof e||null!==e.constructor&&e.constructor===String)}function cS(e){for(let n=1;n<arguments.length;n++){const i=arguments[n];for(const n in i)e[n]=i[n]}return e}function AS(e){switch(e){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array}throw new Error("unsupported bufferView's component type: "+e)}function fS(e){return 0===e.indexOf("data:")&&e.indexOf("base64,")>0}function dS(e){const n=function(e){return"undefined"!=typeof self?self.atob(e):window.atob(e)}(e.substring(e.indexOf(",")+1)),i=n.length,o=new Uint8Array(i);for(let e=0;e<i;e++)o[e]=n.charCodeAt(e);return o.buffer}const pS=[],gS=[],mS=[],yS=[0,0,0],vS=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}([]),_S=[1,1,1];function xS(e,n,i,o,s,a,h){const l=AS(h),c=l.BYTES_PER_ELEMENT;if((0===s||s===o*c)&&a%c==0){const s=new l(n,a,i*o);return e.set(s),e}0===s&&(s=o*c);const A=new Uint8Array(o*c);for(let h=0;h<i;h++){let i=null;const f=new Uint8Array(n,s*h+a,o*c);A.set(f),i=new l(A.buffer,0,o);for(let n=0;n<o;n++)e[h*o+n]=i[n]}return e}const bS="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;function wS(e,n,i){const o=new Uint8Array(e,n,i);return bS.decode(o)}const CS={get:function(e,n={},i){n||(n={});const o=new AbortController,s=o.signal,a=cS({},n);a.signal=s,a.method||(a.method="GET"),a.referrerPolicy=a.referrerPolicy||"origin","undefined"==typeof window||a.referrer||(a.referrer=window.location.href),i&&(e=i(e));const h=fetch(e,a).then((e=>{const i=this._parseResponse(e,n.responseType);return i.message?i:i.then((i=>"arraybuffer"===n.responseType?{data:i,cacheControl:e.headers.get("Cache-Control"),expires:e.headers.get("Expires"),contentType:e.headers.get("Content-Type")}:i)).catch((e=>{if(!e.code||e.code!==DOMException.ABORT_ERR)throw e}))})).catch((e=>{if(!e.code||e.code!==DOMException.ABORT_ERR)throw e}));return h.xhr=o,h},_parseResponse:(e,n)=>200!==e.status?{status:e.status,statusText:e.statusText,message:`incorrect http request with status code(${e.status}): ${e.statusText}`}:"arraybuffer"===n?e.arrayBuffer():"json"===n?e.json():e.text(),getArrayBuffer:(e,n={},i)=>(n||(n={}),n.responseType="arraybuffer",CS.get(e,n,i)),getJSON:function(e,n={},i){return n&&n.jsonp?CS.jsonp(e):((n=n||{}).responseType="json",CS.get(e,n,i))},jsonp:function(e){const n="_maptalks_jsonp_"+aS++;e.match(/\?/)?e+="&callback="+n:e+="?callback="+n;let i=document.createElement("script");return i.type="text/javascript",i.src=e,new Promise((e=>{window[n]=function(o){document.getElementsByTagName("head")[0].removeChild(i),i=null,delete window[n],e(o)},document.getElementsByTagName("head")[0].appendChild(i)}))}};let PS=class M{constructor(e,n,i,o,s){this._requestImage=e,this.decoders=n,this._supportedFormats=i,this.images={},this._imgRequests={},this._fetchOptions=o||{},this._urlModifier=s}requestImageFromBufferURI(e,n,i){if(this.buffers[e.id]){const o=this._createDataView(n,this.buffers[e.id]);return this.getImageByBuffer(o,i)}if(this._imgRequests[e.id])return this._imgRequests[e.id].then((()=>{const o=this._createDataView(n,this.buffers[e.id]);return this.getImageByBuffer(o,i)}));if(fS(e.uri)){const o=this.buffers[e.id]=dS(e.uri),s=this._createDataView(n,o);return this.getImageByBuffer(s,i)}let o;const s=e.uri.indexOf("blob:")>=0;return o=e.uri.indexOf("://")>0||s?e.uri:this.rootPath+"/"+e.uri,this._imgRequests[e.id]=CS.getArrayBuffer(o,this._fetchOptions,this._urlModifier).then((o=>{const s=this.buffers[e.id]=o.data,a=this._createDataView(n,s);return this.getImageByBuffer(a,i)}))}getImageByBuffer(e,n){if(this.images[n.id])return Promise.resolve(this.images[n.id]);const i=this.decoders;return i[n.mimeType]?i[n.mimeType](e,{supportedFormats:this._supportedFormats}):"image/crn"===n.mimeType||"image/ktx2"===n.mimeType||"image/cttf"===n.mimeType?(console.warn("missing transcoder for "+n.mimeType,", visit https://maptalks.com/docs/transcoders for details"),Promise.resolve(null)):this._getImageInfo(n.id,e)}requestExternalImage(e){if(this.images[e.id])return Promise.resolve(this.images[e.id]);const n=0===e.uri.indexOf("data:image/")?e.uri:this.rootPath+"/"+e.uri;return this._imgRequests[e.id]?this._imgRequests[e.id].then((()=>this.images[e.id])):this._imgRequests[e.id]=this._getImageInfo(e.id,n)}_getImageInfo(e,n){return new Promise(((i,o)=>{let s=n;this._urlModifier&&(s=this._urlModifier(n)),this._requestImage(s,this._fetchOptions,((s,a)=>{s?o(s):(URL.revokeObjectURL(n),this.images[e]=a,i(this.images[e]))}))}))}};const MS=["SCALAR",1,"VEC2",2,"VEC3",3,"VEC4",4,"MAT2",4,"MAT3",9,"MAT4",16],TS=[];let SS=class V{constructor(e,n,i,o,s){this.rootPath=e,this.gltf=n,this._enableInterleave=!1,this.glbBuffer=i,this.buffers={},this.requests={},this.accessors={},this._compareAccessor(),this._fetchOptions=o,this._urlModifier=s}_requestData(e,n){const i=this.gltf,o=i.accessors[n];if(void 0===o.bufferView)return this.accessors[o.id]=this._toBufferData(e,n,null,0),Promise.resolve(this.accessors[o.id]);if(o&&this.accessors[o.id])return Promise.resolve(this.accessors[o.id]);return this._requestBufferOfBufferView(i.bufferViews[o.bufferView]).then((i=>{const{buffer:s,byteOffset:a}=i;return this.accessors[o.id]=this._toBufferData(e,n,s,a)}))}_requestBufferOfBufferView(e){const n=this.gltf.buffers[e.buffer];if(this.buffers[n.id]){return Promise.resolve({buffer:this.buffers[n.id],byteOffset:0})}if(this.requests[n.id])return this.requests[n.id].then((()=>Promise.resolve({buffer:this.buffers[n.id],byteOffset:0})));if("binary_glTF"!==e.buffer&&"KHR_binary_glTF"!==e.buffer&&n.uri){if(fS(n.uri)){const e=this.buffers[n.id]=dS(n.uri);return Promise.resolve({buffer:e,byteOffset:0})}let e;const i=n.uri.indexOf("blob:")>=0;return e=n.uri.indexOf("://")>0||i?n.uri:this.rootPath+"/"+n.uri,this.requests[n.id]=CS.getArrayBuffer(e,this._fetchOptions,!i&&this._urlModifier).then((o=>(i&&URL.revokeObjectURL(e),{buffer:this.buffers[n.id]=o.data,byteOffset:0})))}return Promise.resolve({buffer:this.glbBuffer.buffer,byteOffset:this.glbBuffer.byteOffset})}_toBufferData(e,n,i,o=0){const s=this.gltf,a=s.accessors[n],h=void 0!==a.bufferView?s.bufferViews[a.bufferView]:{},l=(h.byteOffset||0)+o,c=this._getTypeItemSize(a.type),A=AS(a.componentType),f=h.byteStride||0,d={array:void 0,name:e,accessorName:n,byteLength:a.count*c*A.BYTES_PER_ELEMENT,componentType:a.componentType,count:a.count,type:a.type,itemSize:c,max:a.max,min:a.min,extensions:a.extensions};if(a.min&&(d.min=a.min),a.max&&(d.max=a.max),i)if(this._enableInterleave)d.byteStride=f,d.byteOffset=l+(a.byteOffset||0),!f||f===c*A.BYTES_PER_ELEMENT||"indices"===e||"input"===e||"output"===e||e.indexOf("morph")>=0?(d.array=this._typedArray(i,a.count,c,l+(a.byteOffset||0),A),d.array.buffer.byteLength===d.byteLength&&(d.byteOffset=0)):d.array=new Uint8Array(i,l,h.byteLength);else if(a.interleaved){d.byteStride=0,d.byteOffset=0;const e=new A(a.count*c);if(d.array=xS(e,i,a.count,c,f,l+(a.byteOffset||0),a.componentType),d.extensions&&d.extensions.WEB3D_quantized_attributes&&c>2){const e=new Float32Array(d.array.length),{decodeMatrix:n}=d.extensions.WEB3D_quantized_attributes;for(let i=0;i<d.array.length;i+=c){TS[0]=d.array[i],TS[1]=d.array[i+1],TS[2]=d.array[i+2],TS[3]=1;const o=iS(TS,TS,n);e[i]=o[0],e[i+1]=o[1],e[i+2]=o[2]}d.componentType=5126,d.array=e}}else d.byteStride=0,d.array=this._typedArray(i,a.count,c,l+(a.byteOffset||0),A),d.byteOffset=d.array.byteOffset;else{d.array=new A(a.count);const e=d.min||d.max;e&&(d.array[0]=e[0],d.array[1]=e[1],d.array[2]=e[2])}return d}_compareAccessor(){const e=this.gltf.accessors;if(Array.isArray(e))for(let n=0;n<e.length;n++)for(let i=0;i<e.length;i++)n!==i&&e[n].bufferView===e[i].bufferView&&(e[n].interleaved=e[i].interleaved=!0);else for(const n in e)for(const i in e)n!==i&&e[n].bufferView===e[i].bufferView&&(e[n].interleaved=e[i].interleaved=!0)}_typedArray(e,n,i,o,s){return o%s.BYTES_PER_ELEMENT!=0&&(e=e.slice(o,o+n*i*s.BYTES_PER_ELEMENT),o=0),new s(e,o,i*n)}_getTypeItemSize(e){const n=MS.indexOf(e);return MS[n+1]}requestKHRTechniquesWebgl(e){const{shaders:n}=e,i=n.map((e=>{if(void 0!==e.bufferView){const n=this.gltf.bufferViews[e.bufferView],{byteLength:i}=n;return this._requestBufferOfBufferView(n).then((o=>{const{buffer:s,byteOffset:a}=o,h=wS(s,a+(n.byteOffset||0),i);return e.content=h,e}))}if(e.uri){if(fS(e.uri)){const n=dS(e.uri),i=wS(n,0,n.byteLength);return e.content=i,Promise.resolve(e)}return CS.get(this.rootPath+"/"+e.uri,this._fetchOptions,this._urlModifier).then((n=>(e.content=n,e)))}return Promise.resolve(e)}));return Promise.all(i).then((()=>e))}},IS=class D extends PS{constructor(e,n,i,o,s,a,h,l){super(o,s,a,h,l),this.rootPath=e,this.gltf=n,this.requests={},this.buffers={},this.glbBuffer=i,this.accessor=new SS(e,n,i,h,l)}iterate(e,n){const i=this.gltf[n];if(!i)return;let o=0;for(const n in i)e(n,i[n],o++)}createNode(e){const n={};if(lS(e.name)&&(n.name=e.name),lS(e.children)&&(n.children=e.children),lS(e.jointName)&&(n.jointName=e.jointName),lS(e.matrix)&&(n.matrix=e.matrix),lS(e.rotation)&&(n.rotation=e.rotation),lS(e.scale)&&(n.scale=e.scale),lS(e.translation)&&(n.translation=e.translation),lS(e.extras)&&(n.extras=e.extras),lS(e.meshes)&&(n.mesh=e.meshes[0]),n.translation||n.rotation||n.scale){const e=function(e,n){if(n.matrix)return n.matrix;if(n.translation||n.scale||n.rotation){const i=function(e,n){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}(pS,n.translation||yS),o=function(e,n){var i=n[0],o=n[1],s=n[2],a=n[3],h=i+i,l=o+o,c=s+s,A=i*h,f=o*h,d=o*l,p=s*h,g=s*l,v=s*c,w=a*h,C=a*l,P=a*c;return e[0]=1-d-v,e[1]=f+P,e[2]=p-C,e[3]=0,e[4]=f-P,e[5]=1-A-v,e[6]=g+w,e[7]=0,e[8]=p+C,e[9]=g-w,e[10]=1-A-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}(gS,n.rotation||vS),s=function(e,n){return e[0]=n[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=n[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}(mS,n.scale||_S);return XT(s,o,s),XT(e,i,s)}return function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}(e)}([],n);delete n.translation,delete n.rotation,delete n.scale,n.matrix=e}return n}_loadMaterials(e){const n={};for(const i in e){const o=e[i];let s,a;o.instanceTechnique&&o.instanceTechnique.values?(s=o.instanceTechnique,a=s.values.diffuse):(s=o,a=s.values.tex||s.values.diffuseTex||s.values.diffuse);const h={baseColorTexture:{index:a}};o.name&&(h.name=o.name),o.extensions&&(h.extensions=o.extensions),o.extras&&(h.extras=o.extras),n[i]=h}return n}_loadImage(e){if(e.bufferView||e.extensions&&(e.extensions.KHR_binary_glTF||e.extensions.binary_glTF)){const n=e.bufferView?e:e.extensions.KHR_binary_glTF||e.extensions.binary_glTF;e.extensions&&(e.mimeType=n.mimeType,e.width=n.width,e.height=n.height);const i=this.gltf.bufferViews[n.bufferView],o=this.buffers[n.bufferView]=new Uint8Array(this.glbBuffer.buffer,(i.byteOffset||0)+this.glbBuffer.byteOffset,i.byteLength);return this.getImageByBuffer(o,e)}return this.requestExternalImage(e)}_getTexture(e){const n=this.gltf.textures[e];if(!n)return null;const i=this.gltf.images[n.source];return this._loadImage(i).then((e=>({image:{array:e.data,width:e.width,height:e.height,index:n.source,mimeType:i.mimeType,name:i.name,extras:i.extras},sampler:this.gltf.samplers[n.sampler]})))}getBaseColorTexture(e){const n=this.gltf.materials[e];let i,o;if(n.instanceTechnique&&n.instanceTechnique.values?(i=n.instanceTechnique,o=i.values.diffuse):(i=n,o=i.values.tex||i.values.diffuseTex||i.values.diffuse),void 0===o||void 0===this.gltf.textures)return null;const s=this.gltf.textures[o];if(!s)return null;return{format:s.format||6408,internalFormat:s.internalFormat||6408,type:s.type||5121,sampler:this.gltf.samplers[s.sampler],source:this.gltf.images[s.source]}}getMaterial(){return null}getAnimations(){return null}};const ES=9729;let OS=class U extends PS{constructor(e,n,i,o,s,a,h,l){super(o,s,a,h,l),this.rootPath=e,this.gltf=n,this.glbBuffer=i,this.buffers={},this.requests={},this.accessor=new SS(e,n,i,h,l)}iterate(e,n){const i=this.gltf[n];if(i)for(let n=0;n<i.length;n++)e(n,i[n],n)}createNode(e){const n={};return cS(n,e),!lS(e.weights)&&this.gltf.meshes&&lS(n.mesh)?n.weights=this.gltf.meshes[n.mesh].weights:e.weights&&(n.weights=e.weights),n}_getTexture(e){const n=this.gltf.textures[e];if(!n)return null;let i=n.source;if(n.extensions&&n.extensions.EXT_texture_webp&&(i=n.extensions.EXT_texture_webp.source),!lS(i))return null;const o=this.gltf.images[i];return this._loadImage(o).then((e=>{if(!e)return null;const i={image:{array:e.data,mipmap:e.mipmap,width:e.width,height:e.height,index:n.source,mimeType:o.mimeType,name:o.name,extensions:o.extensions,extras:o.extras}};cS(i,n);const s=lS(n.sampler)?this.gltf.samplers[n.sampler]:void 0;if(s&&(i.sampler=s,i.sampler.magFilter=s.magFilter||ES,i.sampler.minFilter=s.minFilter||9987,i.sampler.wrapS=s.wrapS||10497,i.sampler.wrapT=s.wrapT||10497),"image/ktx2"===i.image.mimeType&&!i.image.mipmap&&i.sampler&&i.sampler.minFilter!==ES&&9728!==i.sampler.minFilter){const e=i.sampler.minFilter;i.sampler.minFilter=9984===e||9986===e?9728:ES}return e.format&&(i.format=e.format),i}))}_loadImage(e){if(!lS(e.bufferView))return this.requestExternalImage(e);{const n=this.gltf.bufferViews[e.bufferView],i=this.gltf.buffers[n.buffer];if(i.uri)return this.requestImageFromBufferURI(i,n,e);if(this.glbBuffer)return this._requestFromGlbBuffer(n,e)}return null}_requestFromGlbBuffer(e,n){const i=this._createDataView(e,this.glbBuffer.buffer,this.glbBuffer.byteOffset);return this.getImageByBuffer(i,n)}_createDataView(e,n,i){i=i||0;return new Uint8Array(n,(e.byteOffset||0)+i,e.byteLength)}_transformArrayBufferToBase64(e,n){const i=new Array(e.byteLength);for(let n=0;n<e.byteLength;n++)i[n]=String.fromCharCode(e[n]);i.join("");const o="data:"+(n=n||"image/png")+";base64,"+function(e){return"undefined"!=typeof self?self.btoa(e):window.btoa(e)}(unescape(encodeURIComponent(i)));return o}getAnimations(e){const n=[];return e.forEach((e=>{n.push(this.getSamplers(e.samplers))})),Promise.all(n).then((n=>{for(let i=0;i<n.length;i++)e[i].samplers=n[i];return e}))}getSamplers(e){const n=[];for(let i=0;i<e.length;i++)(lS(e[i].input)||lS(e[i].output))&&(n.push(this.accessor._requestData("input",e[i].input)),n.push(this.accessor._requestData("output",e[i].output)));return Promise.all(n).then((n=>{for(let i=0;i<n.length/2;i++)e[i].input=n[2*i],e[i].output=n[2*i+1],e[i].interpolation||(e[i].interpolation="LINEAR");return e}))}};const RS="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;let DS=class X{static read(e,n=0,i=0){i||(i=e.byteLength);const o=new DataView(e,n,i),s=o.getUint32(4,!0);if(1===s)return X.readV1(o,n);if(2===s)return X.readV2(e,n);throw new Error("Unsupported glb version : "+s)}static readV1(e,n){const i=e.getUint32(8,!0),o=e.getUint32(12,!0);if(i!==e.byteLength)throw new Error("Length in GLB header is inconsistent with glb's byte length.");const s=kS(e.buffer,20+n,o);return{json:JSON.parse(s),glbBuffer:{byteOffset:20+n+o,buffer:e.buffer,byteLength:i}}}static readV2(e,n){let i,o,s;const a=new DataView(e,n+12);let h=0;for(;h+8<a.byteLength;){const l=a.getUint32(h,!0);h+=4;const c=a.getUint32(h,!0);if(h+=4,1313821514===c)i=kS(e,n+12+h,l);else if(5130562===c){s=n+12+h,o=l;break}h+=l}return{json:JSON.parse(i),glbBuffer:{byteOffset:s,buffer:e,byteLength:o}}}};function kS(e,n,i){if(RS){const o=new Uint8Array(e,n,i);return RS.decode(o)}return function(e){const n=e.length;let i="";for(let o=0;o<n;){let s=e[o++];if(128&s){let i=LS[s>>3&7];if(!(64&s)||!i||o+i>n)return null;for(s&=63>>i;i>0;i-=1){const n=e[o++];if(128!=(192&n))return null;s=s<<6|63&n}}i+=String.fromCharCode(s)}return i}(new Uint8Array(e,n,i))}const LS=[1,1,1,1,2,2,3,0],FS=[0,0,0],NS=[0,0,0,1],zS=[1,1,1],BS={TRANSLATION:[0,0,0],ROTATION:[0,0,0,1],SCALE:[1,1,1]},HS={PREVIOUS:null,NEXT:null,PREINDEX:null,NEXTINDEX:null,INTERPOLATION:null},jS={_getTRSW(e,n,i,o,s,a,h,l){const c=lS(e)?n.animations:[n.animations[0]],A={};for(let n=0;n<c.length;n++){const f=c[n],d=f.name||n;if(lS(e)&&d!==e)continue;const p=f.channelsMap[i];if(p)for(let e=0;e<p.length;e++){const n=p[e];"translation"===n.target.path?(this._getAnimateData(s,f.samplers[n.sampler],o,1),A.translation=KT(FS,s)):"rotation"===n.target.path?(this._getQuaternion(a,f.samplers[n.sampler],o,1),A.rotation=sS(NS,a)):"scale"===n.target.path?(this._getAnimateData(h,f.samplers[n.sampler],o,1),A.scale=KT(zS,h)):"weights"===n.target.path&&l&&(this._getAnimateData(l,f.samplers[n.sampler],o,l.length),A.weights=l)}}return A},_getAnimateData(e,n,i,o){switch(n.interpolation){case"LINEAR":{const s=this._getPreNext(HS,n,i,1*o);s&&(e=function(e,n,i,o){for(let s=0;s<e.length;s++)e[s]=n[s]+o*(i[s]-n[s]);return e}(e,s.PREVIOUS,s.NEXT,s.INTERPOLATION));break}case"STEP":{const s=this._getPreNext(HS,n,i,1*o);s&&(e=function(e,n){for(let i=0;i<e.length;i++)e[i]=n[i];return e}(e,...s.PREVIOUS));break}case"CUBICSPLINE":{const s=this._getPreNext(HS,n,i,3*o);s&&(e=this._getCubicSpline(e,s,n.input.array,3*o));break}}return e},_getQuaternion(e,n,i){switch(n.interpolation){case"LINEAR":{const o=this._getPreNext(HS,n,i,1);o&&function(e,n,i,o){var s,a,h,l,c,A=n[0],f=n[1],d=n[2],p=n[3],g=i[0],v=i[1],w=i[2],C=i[3];(a=A*g+f*v+d*w+p*C)<0&&(a=-a,g=-g,v=-v,w=-w,C=-C),1-a>1e-6?(s=Math.acos(a),h=Math.sin(s),l=Math.sin((1-o)*s)/h,c=Math.sin(o*s)/h):(l=1-o,c=o),e[0]=l*A+c*g,e[1]=l*f+c*v,e[2]=l*d+c*w,e[3]=l*p+c*C}(e,o.PREVIOUS,o.NEXT,o.INTERPOLATION);break}case"STEP":{const o=this._getPreNext(HS,n,i,1);o&&(e=nS(e,...o.PREVIOUS));break}case"CUBICSPLINE":{const o=this._getPreNext(HS,n,i,3);if(o){for(let e=0;e<o.PREVIOUS.length;e++)o.PREVIOUS[e]=Math.acos(o.PREVIOUS[e]),o.NEXT[e]=Math.acos(o.NEXT[e]);e=this._getCubicSpline(e,o,n.input.array,3);for(let n=0;n<e.length;n++)e[n]=Math.cos(e[n])}break}}return e},_search(e,n){const i=e.length;let o,s,a,h=0,l=i-1,c=Math.floor((h+l)/2);for(;h<=i-1&&l>=0;){if(h===l)return null;if(e[c]<=n&&n<=e[c+1]){const i=e[c];return o=c,s=c+1,a=(n-i)/(e[c+1]-i),{preIndx:o,nextIndex:s,interpolation:a}}n<e[c]?(l=c,c=Math.floor((h+l)/2)):e[c+1]<n&&(h=c,c=Math.floor((h+l)/2))}return null},_getPreNext(e,n,i,o){const s=n.input.array,a=n.output.array,h=n.output.itemSize;(i<s[0]||i>s[s.length-1])&&(i=Math.max(s[0],Math.min(s[s.length-1],i))),i===s[s.length-1]&&(i=s[0]);const l=this._search(s,i);if(!l||!l.nextIndex)return null;const{preIndx:c,nextIndex:A,interpolation:f}=l;e.PREINDEX=c,e.NEXTINDEX=A,e.INTERPOLATION=f;const d=h*o;return e.PREVIOUS=a.subarray(e.PREINDEX*d,(e.PREINDEX+1)*d),e.NEXT=a.subarray(e.NEXTINDEX*d,(e.NEXTINDEX+1)*d),e},_getCubicSpline(e,n,i,o){const s=n.INTERPOLATION,a=i[n.PREINDEX],h=i[n.NEXTINDEX];for(let i=0;i<3;i++){const l=n.PREVIOUS[o+i],c=(h-a)*n.PREVIOUS[2*o+i],A=n.NEXT[3+i],f=(h-a)*n.NEXT[i],d=(2*Math.pow(s,3)-3*Math.pow(s,2)+1)*l+(Math.pow(s,3)-2*Math.pow(s,2)+s)*c+(2*-Math.pow(s,3)+3*Math.pow(s,2))*A+(Math.pow(s,3)-Math.pow(s,2))*f;e[i]=d}return e},getAnimationClip(e,n,i,o){const s=e.nodes[n]&&e.nodes[n].weights;return $T(FS,...BS.TRANSLATION),nS(NS,...BS.ROTATION),$T(zS,...BS.SCALE),this._getTRSW(o,e,n,i,FS,NS,zS,s)},getTimeSpan(e){if(!e.animations)return null;if(e.timeSpan)return e.timeSpan;const n=e.animations;return e.timeSpan={},n.forEach(((n,i)=>{let o=-1/0,s=1/0;const a=n.channels;for(let e=0;e<a.length;e++){const i=n.samplers[a[e].sampler].input.array;i[i.length-1]>o&&(o=i[i.length-1]),i[0]<s&&(s=i[0])}e.timeSpan[n.name||i]={max:o,min:s}})),e.timeSpan},getTimeSpanByName(e,n){const i=this.getTimeSpan(e);return i?lS(n)?i[n]:i[Object.keys(i)[0]]:null}};let US=!1;if("undefined"!=typeof OffscreenCanvas){let e;try{e=new OffscreenCanvas(2,2).getContext("2d")}catch(Hst){}e&&"undefined"!=typeof createImageBitmap&&(US=!0)}const GS="undefined"==typeof document?null:document.createElement("canvas");function VS(e,n,i){const o=new Image;o.crossOrigin="",o.onload=()=>{if(!GS)return void i(new Error("There is no canvas to draw image!"));GS.width=o.width,GS.height=o.height;const e=GS.getContext("2d",{willReadFrequently:!0});e.drawImage(o,0,0,o.width,o.height);const n=e.getImageData(0,0,o.width,o.height),s={width:o.width,height:o.height,data:new Uint8Array(n.data)};i(null,s)},o.onerror=function(e){i(e)},o.src=e}const WS=[],qS=[],ZS=30;let QS,XS;function YS(e,n,i){QS||(QS=new OffscreenCanvas(2,2),XS=QS.getContext("2d",{willReadFrequently:!0}));let o=null;if(uS(e))this.options.urlModifier&&(e=this.options.urlModifier(e)),WS.push([e,n,i,this]),JS();else{const n=new Blob([e]);o=createImageBitmap(n),o.then(KS.bind(this)).then((e=>{i(null,e)})).catch((e=>{console.warn(e),i(e)}))}}function JS(){if(!WS.length||qS.length>ZS)return;const e=WS.shift(),[n,i,o,s]=e;qS.push(e),fetch(n,i).then((e=>e.arrayBuffer())).then((e=>{const n=new Blob([new Uint8Array(e)]);return createImageBitmap(n)})).then(KS.bind(s)).then((n=>{o.call(s,null,n);const i=qS.indexOf(e);qS.splice(i,1),JS()})).catch((n=>{console.warn(n),o.call(s,n);const i=qS.indexOf(e);qS.splice(i,1),JS()}))}function KS(e){let{width:n,height:i}=e;$S(n)||(n=tI(n)),$S(i)||(i=tI(i));const o=this.options.maxTextureSize;o&&(n=Math.min(o,n),i=Math.min(o,i)),QS.width=n,QS.height=i,XS.drawImage(e,0,0,n,i),e.close();const s=XS.getImageData(0,0,n,i);return{width:n,height:i,data:new Uint8Array(s.data)}}function $S(e){return!(e&e-1)&&0!==e}function tI(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}var eI=Object.freeze({__proto__:null,Ajax:CS,GLTFLoader:class Z{constructor(e,n,i){if(this.options=i||{},this.options.decoders||(this.options.decoders={}),this._fetchOptions=this.options.fetchOptions||{},n.buffer instanceof ArrayBuffer){const{json:i,glbBuffer:o}=DS.read(n.buffer,n.byteOffset,n.byteLength);this._init(e,i,o)}else this._init(e,n);this._accessor=new SS(this.rootPath,this.gltf,this.glbBuffer,this._fetchOptions,this.options.urlModifier),this._checkExtensions()}_checkExtensions(){const e=this.gltf.extensionsRequired;if(e){if(e.indexOf("KHR_draco_mesh_compression")>=0&&!this.options.decoders.draco)throw new Error("KHR_draco_mesh_compression is required but @maptalks/transcoders.draco is not loaded");if(e.indexOf("KHR_texture_basisu")>=0&&!this.options.decoders["image/ktx2"])throw new Error("KHR_texture_basisu is required but @maptalks/transcoders.ktx2 is not loaded");if(e.indexOf("EXT_meshopt_compression")>=0)throw new Error("EXT_meshopt_compression extension is not supported yet.")}}_loadExtensions(){const e=this.gltf.extensions;return e&&e.KHR_techniques_webgl?this._accessor.requestKHRTechniquesWebgl(e.KHR_techniques_webgl).then((n=>(e.KHR_techniques_webgl=n,e))):Promise.resolve(e)}load(e){const n=this._loadScene(e=e||{}),i=this._loadAnimations(),o=this._loadTextures(),s=this._loadExtensions();return Promise.all([n,i,o,s]).then((e=>(e[0].animations=e[1],e[0].textures=e[2],e[0].extensions=e[3],e[0].transferables=this.transferables||[],this.createChannelsMap(e[0]),e[0])))}createChannelsMap(e){const n=e.animations;if(n)for(let e=0;e<n.length;e++){const i=n[e];i.channelsMap={};for(let e=0;e<i.channels.length;e++){const n=i.channels[e];i.channelsMap[n.target.node]||(i.channelsMap[n.target.node]=[]),i.channelsMap[n.target.node].push(n)}}}getExternalResources(){const e=[];if(this.gltf){const{buffers:n,images:i}=this.gltf;for(let i=0;i<n.length;i++)n[i].uri&&n[i].uri.indexOf("data:application/octet-stream;base64")<0&&e.push({type:"buffer",uri:n[i].uri});for(let n=0;n<i.length;n++)i[n].uri&&i[n].uri.indexOf("data:image/")<0&&e.push({type:"image",uri:i[n].uri})}return e}static getAnimationClip(e,n,i,o){return jS.getAnimationClip(e,n,i,o)}static getAnimationTimeSpan(e,n){return jS.getTimeSpanByName(e,n)}static getTypedArrayCtor(e){return AS(e)}static readInterleavedArray(e,n,i,o,s,a,h){return xS(e,n,i,o,s,a,h)}_init(e,n,i){this.gltf=n,this.glbBuffer=i,this.version=n.asset?+n.asset.version:1,this.rootPath=e,this.buffers={},this.requests={},this.options.requestImage=US?YS.bind(this):this.options.requestImage||VS,this.options.transferable&&(this.transferables=[]),2===this.version?(this.adapter=new OS(e,n,i,this.options.requestImage,this.options.decoders||{},this.options.supportedFormats||{},this._fetchOptions,this.options.urlModifier),this.adapter.iterate(((e,n,i)=>{n.id="buffer_"+i}),"buffers"),this.adapter.iterate(((e,n,i)=>{n.id="image_"+i}),"images"),this.adapter.iterate(((e,n,i)=>{n.id="accessor_"+i}),"accessors")):(this.adapter=new IS(e,n,i,this.options.requestImage,this.options.decoders||{},this.options.supportedFormats||{},this._fetchOptions,this.options.urlModifier),this.adapter.iterate(((e,n,i)=>{n.id="accessor_"+i}),"accessors"),this.adapter.iterate(((e,n,i)=>{n.id="image_"+i}),"images"))}_parseNodes(e,n){if(e.children&&e.children.length>0){if(!("number"==typeof(i=e.children[0])&&isFinite(i)||uS(e.children[0])))return e;const o=e.children.map((e=>{const i=n[e];return i.nodeIndex=e,this._parseNodes(i,n)}));e.children=o}var i;return e}_loadScene(e){return this._loadNodes(e).then((e=>{const n=this.scenes=[];let i;for(const n in e)e[n]=this._parseNodes(e[n],e),e[n].nodeIndex=Number(n)?Number(n):n;this.adapter.iterate(((o,s,a)=>{const h={};s.name&&(h.name=s.name),s.nodes&&(h.nodes=s.nodes.map((n=>e[n]))),this.gltf.scene===o&&(i=a),n.push(h)}),"scenes");const o={textures:this.gltf.textures,asset:this.gltf.asset,scene:i,scenes:n,nodes:e,meshes:this.meshes,materials:this.gltf.materials,skins:this.skins,extensionsRequired:this.gltf.extensionsRequired,extensionsUsed:this.gltf.extensionsUsed};if(this.gltf.extensions&&(o.extensions=this.gltf.extensions),1===this.version){const e=this.adapter._loadMaterials(this.gltf.materials);o.materials=e}return delete this.gltf.buffers,o.json=this.gltf,o}))}_loadNodes(e){return this._loadMeshes(e).then((()=>{const e=this.nodes={};return this.adapter.iterate(((n,i)=>{const o=this.adapter.createNode(i,this.meshes,this.skins);e[n]=o}),"nodes"),e}))}_loadSkins(){this.skins=[];const e=[];return this.adapter.iterate(((n,i,o)=>{e.push(this._loadSkin(i).then((e=>{e.index=o,this.skins.push(e)})))}),"skins"),e}_loadSkin(e){return this.adapter.accessor._requestData("inverseBindMatrices",e.inverseBindMatrices).then((n=>(e.inverseBindMatrices=n,n&&n.buffer&&this.transferables&&this.transferables.indexOf(n.buffer)<0&&this.transferables.push(n.buffer),e)))}_loadAnimations(){const e=this.gltf.animations;return lS(e)?this.adapter.getAnimations(e):null}_loadMeshes(e){this.meshes={};let n=[];return this.adapter.iterate(((i,o,s)=>{n.push(this._loadMesh(o,e).then((e=>{e.index=s,this.meshes[i]=e})))}),"meshes"),n=n.concat(this._loadSkins()),Promise.all(n)}_loadMesh(e,n){const i=e.primitives.map((e=>this._loadPrimitive(e,n))).filter((e=>!!e));return Promise.all(i).then((n=>{const i={};return cS(i,e),i.primitives=n,i}))}_loadTextures(){const e=this.gltf.textures;if(!e)return null;const n=[];for(const i in e)n.push(this.adapter._getTexture(i));return Promise.all(n).then((n=>{if(this.transferables)for(let e=0;e<n.length;e++){const i=n[e]&&n[e].image.array;if(i){let e;e=i instanceof ImageBitmap?i:i.buffer,e&&this.transferables.indexOf(e)<0&&this.transferables.push(e)}}if(!Array.isArray(e)){const i={},o=Object.keys(e);for(let e=0;e<n.length;e++)n[e]&&(i[o[e]]=n[e]);return i}return n}))}_loadPrimitive(e,n){let i;const o=[],s=e.extensions;if(lS(e.targets))for(let n=0;n<e.targets.length;n++){const i=e.targets[n];for(const e in i){const s=this.adapter.accessor._requestData(`morphTargets_${e}_${n}`,i[e]);s&&o.push(s)}}if(s&&s.KHR_draco_mesh_compression){if(!this.options.decoders.draco&&(!this.gltf.extensionsRequired||!this.gltf.extensionsRequired.indexOf("KHR_draco_mesh_compression")<0))return null;const e=this.options.decoders.draco,{bufferView:a,attributes:h}=s.KHR_draco_mesh_compression,l=this.gltf.bufferViews[a],c=this._accessor._requestBufferOfBufferView(l).then((i=>{const{buffer:o,byteOffset:s}=i;let{byteOffset:a}=l;a||(a=0);const c=new DataView(o,s+a,l.byteLength);return e(c,{attributes:h,useUniqueIDs:!1,skipAttributeTransform:n.skipAttributeTransform}).then((e=>{const n=Object.values(e.attributes);return e.indices&&n.push(e.indices),n}))}));o.push(c),i=Promise.all(o)}else{const n=e.attributes;for(const e in n){const i=this.adapter.accessor._requestData(e,n[e]);i&&o.push(i)}if(lS(e.indices)){const n=this.adapter.accessor._requestData("indices",e.indices);n&&o.push(n)}i=Promise.all(o)}return i.then((n=>{if(s&&s.KHR_draco_mesh_compression){const i=e.targets?e.targets.length:0;n[i]=n[i].concat(n.slice(0,i)),n=n[i]}let i,o;const a={attributes:n.reduce(((e,n)=>{if("indices"===n.name)i=n;else if(n.name.indexOf("morphTargets_")>-1)o=o||{},o[n.name.slice(13)]=n;else{if(!("POSITION"!==n.name||n.min&&n.max)){const e=[1/0,1/0,1/0],i=[-1/0,-1/0,-1/0],{itemSize:o,array:s}=n,a=s.length/o;for(let n=0;n<a;n++)for(let a=0;a<o;a++){const h=n*o+a;s[h]<e[a]&&(e[a]=s[h]),s[h]>i[a]&&(i[a]=s[h])}if(n.quantization){const o=n.quantization,s=o.range/(1<<o.quantizationBits),a=o.minValues;eS(e,e,s),tS(e,e,a),eS(i,i,s),tS(i,i,a)}n.min=e,n.max=i}e[n.name]=n}return this.transferables&&n.array.buffer&&this.transferables.indexOf(n.array.buffer)<0&&this.transferables.push(n.array.buffer),e}),{}),material:e.material};return i&&(a.indices=i),o&&(a.morphTargets=o),a.mode=lS(e.mode)?e.mode:4,lS(e.extras)&&(a.extras=e.extras),a}))}}});function nI(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var iI={exports:{}},rI={exports:{}},oI=function(e){return!(!e||"string"==typeof e)&&(e instanceof Array||Array.isArray(e)||e.length>=0&&(e.splice instanceof Function||Object.getOwnPropertyDescriptor(e,e.length-1)&&"String"!==e.constructor.name))},sI=Array.prototype.concat,aI=Array.prototype.slice,hI=rI.exports=function(e){for(var n=[],i=0,o=e.length;i<o;i++){var s=e[i];oI(s)?n=sI.call(n,aI.call(s)):n.push(s)}return n};hI.wrap=function(e){return function(){return e(hI(arguments))}};var lI={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},uI=rI.exports,cI=Object.hasOwnProperty,AI=Object.create(null);for(var fI in lI)cI.call(lI,fI)&&(AI[lI[fI]]=fI);var dI=iI.exports={to:{},get:{}};function pI(e,n,i){return Math.min(Math.max(n,e),i)}function gI(e){var n=Math.round(e).toString(16).toUpperCase();return n.length<2?"0"+n:n}dI.get=function(e){var n,i;switch(e.substring(0,3).toLowerCase()){case"hsl":n=dI.get.hsl(e),i="hsl";break;case"hwb":n=dI.get.hwb(e),i="hwb";break;default:n=dI.get.rgb(e),i="rgb"}return n?{model:i,value:n}:null},dI.get.rgb=function(e){if(!e)return null;var n,i,o,s=[0,0,0,1];if(n=e.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(o=n[2],n=n[1],i=0;i<3;i++){var a=2*i;s[i]=parseInt(n.slice(a,a+2),16)}o&&(s[3]=parseInt(o,16)/255)}else if(n=e.match(/^#([a-f0-9]{3,4})$/i)){for(o=(n=n[1])[3],i=0;i<3;i++)s[i]=parseInt(n[i]+n[i],16);o&&(s[3]=parseInt(o+o,16)/255)}else if(n=e.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(i=0;i<3;i++)s[i]=parseInt(n[i+1],0);n[4]&&(s[3]=n[5]?.01*parseFloat(n[4]):parseFloat(n[4]))}else{if(!(n=e.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(n=e.match(/^(\w+)$/))?"transparent"===n[1]?[0,0,0,0]:cI.call(lI,n[1])?((s=lI[n[1]])[3]=1,s):null:null;for(i=0;i<3;i++)s[i]=Math.round(2.55*parseFloat(n[i+1]));n[4]&&(s[3]=n[5]?.01*parseFloat(n[4]):parseFloat(n[4]))}for(i=0;i<3;i++)s[i]=pI(s[i],0,255);return s[3]=pI(s[3],0,1),s},dI.get.hsl=function(e){if(!e)return null;var n=e.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(n){var i=parseFloat(n[4]);return[(parseFloat(n[1])%360+360)%360,pI(parseFloat(n[2]),0,100),pI(parseFloat(n[3]),0,100),pI(isNaN(i)?1:i,0,1)]}return null},dI.get.hwb=function(e){if(!e)return null;var n=e.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(n){var i=parseFloat(n[4]);return[(parseFloat(n[1])%360+360)%360,pI(parseFloat(n[2]),0,100),pI(parseFloat(n[3]),0,100),pI(isNaN(i)?1:i,0,1)]}return null},dI.to.hex=function(){var e=uI(arguments);return"#"+gI(e[0])+gI(e[1])+gI(e[2])+(e[3]<1?gI(Math.round(255*e[3])):"")},dI.to.rgb=function(){var e=uI(arguments);return e.length<4||1===e[3]?"rgb("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+")":"rgba("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+", "+e[3]+")"},dI.to.rgb.percent=function(){var e=uI(arguments),n=Math.round(e[0]/255*100),i=Math.round(e[1]/255*100),o=Math.round(e[2]/255*100);return e.length<4||1===e[3]?"rgb("+n+"%, "+i+"%, "+o+"%)":"rgba("+n+"%, "+i+"%, "+o+"%, "+e[3]+")"},dI.to.hsl=function(){var e=uI(arguments);return e.length<4||1===e[3]?"hsl("+e[0]+", "+e[1]+"%, "+e[2]+"%)":"hsla("+e[0]+", "+e[1]+"%, "+e[2]+"%, "+e[3]+")"},dI.to.hwb=function(){var e=uI(arguments),n="";return e.length>=4&&1!==e[3]&&(n=", "+e[3]),"hwb("+e[0]+", "+e[1]+"%, "+e[2]+"%"+n+")"},dI.to.keyword=function(e){return AI[e.slice(0,3)]};var mI=iI.exports,yI={exports:{}},vI={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},_I={};for(var xI in vI)vI.hasOwnProperty(xI)&&(_I[vI[xI]]=xI);var bI=yI.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var wI in bI)if(bI.hasOwnProperty(wI)){if(!("channels"in bI[wI]))throw new Error("missing channels property: "+wI);if(!("labels"in bI[wI]))throw new Error("missing channel labels property: "+wI);if(bI[wI].labels.length!==bI[wI].channels)throw new Error("channel and label counts mismatch: "+wI);var CI=bI[wI].channels,PI=bI[wI].labels;delete bI[wI].channels,delete bI[wI].labels,Object.defineProperty(bI[wI],"channels",{value:CI}),Object.defineProperty(bI[wI],"labels",{value:PI})}function MI(e,n){return Math.pow(e[0]-n[0],2)+Math.pow(e[1]-n[1],2)+Math.pow(e[2]-n[2],2)}bI.rgb.hsl=function(e){var n,i,o=e[0]/255,s=e[1]/255,a=e[2]/255,h=Math.min(o,s,a),l=Math.max(o,s,a),c=l-h;return l===h?n=0:o===l?n=(s-a)/c:s===l?n=2+(a-o)/c:a===l&&(n=4+(o-s)/c),(n=Math.min(60*n,360))<0&&(n+=360),i=(h+l)/2,[n,100*(l===h?0:i<=.5?c/(l+h):c/(2-l-h)),100*i]},bI.rgb.hsv=function(e){var n,i,o,s,a,h=e[0]/255,l=e[1]/255,c=e[2]/255,A=Math.max(h,l,c),f=A-Math.min(h,l,c),d=function(e){return(A-e)/6/f+.5};return 0===f?s=a=0:(a=f/A,n=d(h),i=d(l),o=d(c),h===A?s=o-i:l===A?s=1/3+n-o:c===A&&(s=2/3+i-n),s<0?s+=1:s>1&&(s-=1)),[360*s,100*a,100*A]},bI.rgb.hwb=function(e){var n=e[0],i=e[1],o=e[2];return[bI.rgb.hsl(e)[0],100*(1/255*Math.min(n,Math.min(i,o))),100*(o=1-1/255*Math.max(n,Math.max(i,o)))]},bI.rgb.cmyk=function(e){var n,i=e[0]/255,o=e[1]/255,s=e[2]/255;return[100*((1-i-(n=Math.min(1-i,1-o,1-s)))/(1-n)||0),100*((1-o-n)/(1-n)||0),100*((1-s-n)/(1-n)||0),100*n]},bI.rgb.keyword=function(e){var n=_I[e];if(n)return n;var i,o=1/0;for(var s in vI)if(vI.hasOwnProperty(s)){var a=MI(e,vI[s]);a<o&&(o=a,i=s)}return i},bI.keyword.rgb=function(e){return vI[e]},bI.rgb.xyz=function(e){var n=e[0]/255,i=e[1]/255,o=e[2]/255;return[100*(.4124*(n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92)+.3576*(i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92)+.1805*(o=o>.04045?Math.pow((o+.055)/1.055,2.4):o/12.92)),100*(.2126*n+.7152*i+.0722*o),100*(.0193*n+.1192*i+.9505*o)]},bI.rgb.lab=function(e){var n=bI.rgb.xyz(e),i=n[0],o=n[1],s=n[2];return o/=100,s/=108.883,i=(i/=95.047)>.008856?Math.pow(i,1/3):7.787*i+16/116,[116*(o=o>.008856?Math.pow(o,1/3):7.787*o+16/116)-16,500*(i-o),200*(o-(s=s>.008856?Math.pow(s,1/3):7.787*s+16/116))]},bI.hsl.rgb=function(e){var n,i,o,s,a,h=e[0]/360,l=e[1]/100,c=e[2]/100;if(0===l)return[a=255*c,a,a];n=2*c-(i=c<.5?c*(1+l):c+l-c*l),s=[0,0,0];for(var A=0;A<3;A++)(o=h+1/3*-(A-1))<0&&o++,o>1&&o--,s[A]=255*(a=6*o<1?n+6*(i-n)*o:2*o<1?i:3*o<2?n+(i-n)*(2/3-o)*6:n);return s},bI.hsl.hsv=function(e){var n=e[0],i=e[1]/100,o=e[2]/100,s=i,a=Math.max(o,.01);return i*=(o*=2)<=1?o:2-o,s*=a<=1?a:2-a,[n,100*(0===o?2*s/(a+s):2*i/(o+i)),100*((o+i)/2)]},bI.hsv.rgb=function(e){var n=e[0]/60,i=e[1]/100,o=e[2]/100,s=Math.floor(n)%6,a=n-Math.floor(n),h=255*o*(1-i),l=255*o*(1-i*a),c=255*o*(1-i*(1-a));switch(o*=255,s){case 0:return[o,c,h];case 1:return[l,o,h];case 2:return[h,o,c];case 3:return[h,l,o];case 4:return[c,h,o];case 5:return[o,h,l]}},bI.hsv.hsl=function(e){var n,i,o,s=e[0],a=e[1]/100,h=e[2]/100,l=Math.max(h,.01);return o=(2-a)*h,i=a*l,[s,100*(i=(i/=(n=(2-a)*l)<=1?n:2-n)||0),100*(o/=2)]},bI.hwb.rgb=function(e){var n,i,o,s,a,h,l,c=e[0]/360,A=e[1]/100,f=e[2]/100,d=A+f;switch(d>1&&(A/=d,f/=d),o=6*c-(n=Math.floor(6*c)),1&n&&(o=1-o),s=A+o*((i=1-f)-A),n){default:case 6:case 0:a=i,h=s,l=A;break;case 1:a=s,h=i,l=A;break;case 2:a=A,h=i,l=s;break;case 3:a=A,h=s,l=i;break;case 4:a=s,h=A,l=i;break;case 5:a=i,h=A,l=s}return[255*a,255*h,255*l]},bI.cmyk.rgb=function(e){var n=e[1]/100,i=e[2]/100,o=e[3]/100;return[255*(1-Math.min(1,e[0]/100*(1-o)+o)),255*(1-Math.min(1,n*(1-o)+o)),255*(1-Math.min(1,i*(1-o)+o))]},bI.xyz.rgb=function(e){var n,i,o,s=e[0]/100,a=e[1]/100,h=e[2]/100;return i=-.9689*s+1.8758*a+.0415*h,o=.0557*s+-.204*a+1.057*h,n=(n=3.2406*s+-1.5372*a+-.4986*h)>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,i=i>.0031308?1.055*Math.pow(i,1/2.4)-.055:12.92*i,o=o>.0031308?1.055*Math.pow(o,1/2.4)-.055:12.92*o,[255*(n=Math.min(Math.max(0,n),1)),255*(i=Math.min(Math.max(0,i),1)),255*(o=Math.min(Math.max(0,o),1))]},bI.xyz.lab=function(e){var n=e[0],i=e[1],o=e[2];return i/=100,o/=108.883,n=(n/=95.047)>.008856?Math.pow(n,1/3):7.787*n+16/116,[116*(i=i>.008856?Math.pow(i,1/3):7.787*i+16/116)-16,500*(n-i),200*(i-(o=o>.008856?Math.pow(o,1/3):7.787*o+16/116))]},bI.lab.xyz=function(e){var n,i,o;n=e[1]/500+(i=(e[0]+16)/116),o=i-e[2]/200;var s=Math.pow(i,3),a=Math.pow(n,3),h=Math.pow(o,3);return i=s>.008856?s:(i-16/116)/7.787,n=a>.008856?a:(n-16/116)/7.787,o=h>.008856?h:(o-16/116)/7.787,[n*=95.047,i*=100,o*=108.883]},bI.lab.lch=function(e){var n,i=e[0],o=e[1],s=e[2];return(n=360*Math.atan2(s,o)/2/Math.PI)<0&&(n+=360),[i,Math.sqrt(o*o+s*s),n]},bI.lch.lab=function(e){var n,i=e[1];return n=e[2]/360*2*Math.PI,[e[0],i*Math.cos(n),i*Math.sin(n)]},bI.rgb.ansi16=function(e){var n=e[0],i=e[1],o=e[2],s=1 in arguments?arguments[1]:bI.rgb.hsv(e)[2];if(0===(s=Math.round(s/50)))return 30;var a=30+(Math.round(o/255)<<2|Math.round(i/255)<<1|Math.round(n/255));return 2===s&&(a+=60),a},bI.hsv.ansi16=function(e){return bI.rgb.ansi16(bI.hsv.rgb(e),e[2])},bI.rgb.ansi256=function(e){var n=e[0],i=e[1],o=e[2];return n===i&&i===o?n<8?16:n>248?231:Math.round((n-8)/247*24)+232:16+36*Math.round(n/255*5)+6*Math.round(i/255*5)+Math.round(o/255*5)},bI.ansi16.rgb=function(e){var n=e%10;if(0===n||7===n)return e>50&&(n+=3.5),[n=n/10.5*255,n,n];var i=.5*(1+~~(e>50));return[(1&n)*i*255,(n>>1&1)*i*255,(n>>2&1)*i*255]},bI.ansi256.rgb=function(e){if(e>=232){var n=10*(e-232)+8;return[n,n,n]}var i;return e-=16,[Math.floor(e/36)/5*255,Math.floor((i=e%36)/6)/5*255,i%6/5*255]},bI.rgb.hex=function(e){var n=(((255&Math.round(e[0]))<<16)+((255&Math.round(e[1]))<<8)+(255&Math.round(e[2]))).toString(16).toUpperCase();return"000000".substring(n.length)+n},bI.hex.rgb=function(e){var n=e.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!n)return[0,0,0];var i=n[0];3===n[0].length&&(i=i.split("").map((function(e){return e+e})).join(""));var o=parseInt(i,16);return[o>>16&255,o>>8&255,255&o]},bI.rgb.hcg=function(e){var n,i=e[0]/255,o=e[1]/255,s=e[2]/255,a=Math.max(Math.max(i,o),s),h=Math.min(Math.min(i,o),s),l=a-h;return n=l<=0?0:a===i?(o-s)/l%6:a===o?2+(s-i)/l:4+(i-o)/l+4,n/=6,[360*(n%=1),100*l,100*(l<1?h/(1-l):0)]},bI.hsl.hcg=function(e){var n=e[1]/100,i=e[2]/100,o=1,s=0;return(o=i<.5?2*n*i:2*n*(1-i))<1&&(s=(i-.5*o)/(1-o)),[e[0],100*o,100*s]},bI.hsv.hcg=function(e){var n=e[2]/100,i=e[1]/100*n,o=0;return i<1&&(o=(n-i)/(1-i)),[e[0],100*i,100*o]},bI.hcg.rgb=function(e){var n=e[1]/100,i=e[2]/100;if(0===n)return[255*i,255*i,255*i];var o,s=[0,0,0],a=e[0]/360%1*6,h=a%1,l=1-h;switch(Math.floor(a)){case 0:s[0]=1,s[1]=h,s[2]=0;break;case 1:s[0]=l,s[1]=1,s[2]=0;break;case 2:s[0]=0,s[1]=1,s[2]=h;break;case 3:s[0]=0,s[1]=l,s[2]=1;break;case 4:s[0]=h,s[1]=0,s[2]=1;break;default:s[0]=1,s[1]=0,s[2]=l}return[255*(n*s[0]+(o=(1-n)*i)),255*(n*s[1]+o),255*(n*s[2]+o)]},bI.hcg.hsv=function(e){var n=e[1]/100,i=n+e[2]/100*(1-n),o=0;return i>0&&(o=n/i),[e[0],100*o,100*i]},bI.hcg.hsl=function(e){var n=e[1]/100,i=e[2]/100*(1-n)+.5*n,o=0;return i>0&&i<.5?o=n/(2*i):i>=.5&&i<1&&(o=n/(2*(1-i))),[e[0],100*o,100*i]},bI.hcg.hwb=function(e){var n=e[1]/100,i=n+e[2]/100*(1-n);return[e[0],100*(i-n),100*(1-i)]},bI.hwb.hcg=function(e){var n=1-e[2]/100,i=n-e[1]/100,o=0;return i<1&&(o=(n-i)/(1-i)),[e[0],100*i,100*o]},bI.apple.rgb=function(e){return[e[0]/65535*255,e[1]/65535*255,e[2]/65535*255]},bI.rgb.apple=function(e){return[e[0]/255*65535,e[1]/255*65535,e[2]/255*65535]},bI.gray.rgb=function(e){return[e[0]/100*255,e[0]/100*255,e[0]/100*255]},bI.gray.hsl=bI.gray.hsv=function(e){return[0,0,e[0]]},bI.gray.hwb=function(e){return[0,100,e[0]]},bI.gray.cmyk=function(e){return[0,0,0,e[0]]},bI.gray.lab=function(e){return[e[0],0,0]},bI.gray.hex=function(e){var n=255&Math.round(e[0]/100*255),i=((n<<16)+(n<<8)+n).toString(16).toUpperCase();return"000000".substring(i.length)+i},bI.rgb.gray=function(e){return[(e[0]+e[1]+e[2])/3/255*100]};var TI=yI.exports,SI=TI;function II(e){var n=function(){for(var e={},n=Object.keys(SI),i=n.length,o=0;o<i;o++)e[n[o]]={distance:-1,parent:null};return e}(),i=[e];for(n[e].distance=0;i.length;)for(var o=i.pop(),s=Object.keys(SI[o]),a=s.length,h=0;h<a;h++){var l=s[h],c=n[l];-1===c.distance&&(c.distance=n[o].distance+1,c.parent=o,i.unshift(l))}return n}function EI(e,n){return function(i){return n(e(i))}}function OI(e,n){for(var i=[n[e].parent,e],o=SI[n[e].parent][e],s=n[e].parent;n[s].parent;)i.unshift(n[s].parent),o=EI(SI[n[s].parent][s],o),s=n[s].parent;return o.conversion=i,o}var RI=TI,DI=function(e){for(var n=II(e),i={},o=Object.keys(n),s=o.length,a=0;a<s;a++){var h=o[a];null!==n[h].parent&&(i[h]=OI(h,n))}return i},kI={};Object.keys(RI).forEach((function(e){kI[e]={},Object.defineProperty(kI[e],"channels",{value:RI[e].channels}),Object.defineProperty(kI[e],"labels",{value:RI[e].labels});var n=DI(e);Object.keys(n).forEach((function(i){var o=n[i];kI[e][i]=function(e){var n=function(n){if(null==n)return n;arguments.length>1&&(n=Array.prototype.slice.call(arguments));var i=e(n);if("object"==typeof i)for(var o=i.length,s=0;s<o;s++)i[s]=Math.round(i[s]);return i};return"conversion"in e&&(n.conversion=e.conversion),n}(o),kI[e][i].raw=function(e){var n=function(n){return null==n?n:(arguments.length>1&&(n=Array.prototype.slice.call(arguments)),e(n))};return"conversion"in e&&(n.conversion=e.conversion),n}(o)}))}));var LI=mI,FI=kI,NI=[].slice,zI=["keyword","gray","hex"],BI={};Object.keys(FI).forEach((function(e){BI[NI.call(FI[e].labels).sort().join("")]=e}));var HI={};function jI(e,n){if(!(this instanceof jI))return new jI(e,n);if(n&&n in zI&&(n=null),n&&!(n in FI))throw new Error("Unknown model: "+n);var i,o;if(null==e)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(e instanceof jI)this.model=e.model,this.color=e.color.slice(),this.valpha=e.valpha;else if("string"==typeof e){var s=LI.get(e);if(null===s)throw new Error("Unable to parse color from string: "+e);this.model=s.model,this.color=s.value.slice(0,o=FI[this.model].channels),this.valpha="number"==typeof s.value[o]?s.value[o]:1}else if(e.length){this.model=n||"rgb";var a=NI.call(e,0,o=FI[this.model].channels);this.color=VI(a,o),this.valpha="number"==typeof e[o]?e[o]:1}else if("number"==typeof e)e&=16777215,this.model="rgb",this.color=[e>>16&255,e>>8&255,255&e],this.valpha=1;else{this.valpha=1;var h=Object.keys(e);"alpha"in e&&(h.splice(h.indexOf("alpha"),1),this.valpha="number"==typeof e.alpha?e.alpha:0);var l=h.sort().join("");if(!(l in BI))throw new Error("Unable to parse color from object: "+JSON.stringify(e));this.model=BI[l];var c=FI[this.model].labels,A=[];for(i=0;i<c.length;i++)A.push(e[c[i]]);this.color=VI(A)}if(HI[this.model])for(o=FI[this.model].channels,i=0;i<o;i++){var f=HI[this.model][i];f&&(this.color[i]=f(this.color[i]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}function UI(e,n,i){return(e=Array.isArray(e)?e:[e]).forEach((function(e){(HI[e]||(HI[e]=[]))[n]=i})),e=e[0],function(o){var s;return arguments.length?(i&&(o=i(o)),(s=this[e]()).color[n]=o,s):(s=this[e]().color[n],i&&(s=i(s)),s)}}function GI(e){return function(n){return Math.max(0,Math.min(e,n))}}function VI(e,n){for(var i=0;i<n;i++)"number"!=typeof e[i]&&(e[i]=0);return e}jI.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(e){var n=this.model in LI.to?this:this.rgb(),i=1===(n=n.round("number"==typeof e?e:1)).valpha?n.color:n.color.concat(this.valpha);return LI.to[n.model](i)},percentString:function(e){var n=this.rgb().round("number"==typeof e?e:1),i=1===n.valpha?n.color:n.color.concat(this.valpha);return LI.to.rgb.percent(i)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var e={},n=FI[this.model].channels,i=FI[this.model].labels,o=0;o<n;o++)e[i[o]]=this.color[o];return 1!==this.valpha&&(e.alpha=this.valpha),e},unitArray:function(){var e=this.rgb().color;return e[0]/=255,e[1]/=255,e[2]/=255,1!==this.valpha&&e.push(this.valpha),e},unitObject:function(){var e=this.rgb().object();return e.r/=255,e.g/=255,e.b/=255,1!==this.valpha&&(e.alpha=this.valpha),e},round:function(e){return e=Math.max(e||0,0),new jI(this.color.map(function(e){return function(n){return function(e,n){return Number(e.toFixed(n))}(n,e)}}(e)).concat(this.valpha),this.model)},alpha:function(e){return arguments.length?new jI(this.color.concat(Math.max(0,Math.min(1,e))),this.model):this.valpha},red:UI("rgb",0,GI(255)),green:UI("rgb",1,GI(255)),blue:UI("rgb",2,GI(255)),hue:UI(["hsl","hsv","hsl","hwb","hcg"],0,(function(e){return(e%360+360)%360})),saturationl:UI("hsl",1,GI(100)),lightness:UI("hsl",2,GI(100)),saturationv:UI("hsv",1,GI(100)),value:UI("hsv",2,GI(100)),chroma:UI("hcg",1,GI(100)),gray:UI("hcg",2,GI(100)),white:UI("hwb",1,GI(100)),wblack:UI("hwb",2,GI(100)),cyan:UI("cmyk",0,GI(100)),magenta:UI("cmyk",1,GI(100)),yellow:UI("cmyk",2,GI(100)),black:UI("cmyk",3,GI(100)),x:UI("xyz",0,GI(100)),y:UI("xyz",1,GI(100)),z:UI("xyz",2,GI(100)),l:UI("lab",0,GI(100)),a:UI("lab",1),b:UI("lab",2),keyword:function(e){return arguments.length?new jI(e):FI[this.model].keyword(this.color)},hex:function(e){return arguments.length?new jI(e):LI.to.hex(this.rgb().round().color)},rgbNumber:function(){var e=this.rgb().color;return(255&e[0])<<16|(255&e[1])<<8|255&e[2]},luminosity:function(){for(var e=this.rgb().color,n=[],i=0;i<e.length;i++){var o=e[i]/255;n[i]=o<=.03928?o/12.92:Math.pow((o+.055)/1.055,2.4)}return.2126*n[0]+.7152*n[1]+.0722*n[2]},contrast:function(e){var n=this.luminosity(),i=e.luminosity();return n>i?(n+.05)/(i+.05):(i+.05)/(n+.05)},level:function(e){var n=this.contrast(e);return n>=7.1?"AAA":n>=4.5?"AA":""},isDark:function(){var e=this.rgb().color;return(299*e[0]+587*e[1]+114*e[2])/1e3<128},isLight:function(){return!this.isDark()},negate:function(){for(var e=this.rgb(),n=0;n<3;n++)e.color[n]=255-e.color[n];return e},lighten:function(e){var n=this.hsl();return n.color[2]+=n.color[2]*e,n},darken:function(e){var n=this.hsl();return n.color[2]-=n.color[2]*e,n},saturate:function(e){var n=this.hsl();return n.color[1]+=n.color[1]*e,n},desaturate:function(e){var n=this.hsl();return n.color[1]-=n.color[1]*e,n},whiten:function(e){var n=this.hwb();return n.color[1]+=n.color[1]*e,n},blacken:function(e){var n=this.hwb();return n.color[2]+=n.color[2]*e,n},grayscale:function(){var e=this.rgb().color,n=.3*e[0]+.59*e[1]+.11*e[2];return jI.rgb(n,n,n)},fade:function(e){return this.alpha(this.valpha-this.valpha*e)},opaquer:function(e){return this.alpha(this.valpha+this.valpha*e)},rotate:function(e){var n=this.hsl(),i=n.color[0];return n.color[0]=i=(i=(i+e)%360)<0?360+i:i,n},mix:function(e,n){if(!e||!e.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof e);var i=e.rgb(),o=this.rgb(),s=void 0===n?.5:n,a=2*s-1,h=i.alpha()-o.alpha(),l=((a*h==-1?a:(a+h)/(1+a*h))+1)/2,c=1-l;return jI.rgb(l*i.red()+c*o.red(),l*i.green()+c*o.green(),l*i.blue()+c*o.blue(),i.alpha()*s+o.alpha()*(1-s))}},Object.keys(FI).forEach((function(e){if(-1===zI.indexOf(e)){var n=FI[e].channels;jI.prototype[e]=function(){if(this.model===e)return new jI(this);if(arguments.length)return new jI(arguments,e);var i,o="number"==typeof arguments[n]?n:this.valpha;return new jI((i=FI[this.model][e].raw(this.color),Array.isArray(i)?i:[i]).concat(o),e)},jI[e]=function(i){return"number"==typeof i&&(i=VI(NI.call(arguments),n)),new jI(i,e)}}}));var WI=nI(jI);const qI="function"==typeof Object.assign,ZI=[];function QI(e){if(qI)Object.assign.apply(Object,arguments);else for(let n=1;n<arguments.length;n++){const i=arguments[n];for(const n in i)e[n]=i[n]}return e}function XI(e){return null==e}function YI(e){return"number"==typeof e&&!isNaN(e)}const JI=[];function KI(e,n){const i=n._get2DExtentAtRes(n.getGLRes()),o=i.getWidth(),s=i.getHeight(),a=e;xv(a);const h=Kv(ZI,n.cameraLookAt);return h[2]=0,Pv(a,a,h),Mv(a,a,$v(JI,o,s,1)),a}function $I(e,n){return Object.prototype.hasOwnProperty.call(e,n)}function tE(e){for(let n=1;n<arguments.length;n++){const i=arguments[n];if(i)for(let n=0,o=i.length;n<o;n++)e.push(i[n])}return e.length}const eE={};function nE(e,n){if(!Array.isArray(n)){n=eE[n]=eE[n]||WI(n).array()}for(let i=0;i<n.length;i++)e[i]=n[i];return 3===n.length&&(e[3]=1),e}function iE(e,n){if(Array.isArray(n))for(let i=0;i<n.length;i++)e[i]=255*n[i];else{n=eE[n]=eE[n]||WI(n).array();for(let i=0;i<n.length;i++)e[i]=n[i]}return 3===e.length&&e.push(255),e}function rE(e,n,i=0){if(!(e&&n instanceof Zh))return null;const o=e.coordinateToPointAtRes(n,e.getGLRes());return[o.x,o.y,i]}const oE=[0,0],sE=[0,0,0];let aE;class ShadowProcess{static getUniformDeclares(){const e=[],n=[];return n.push({name:"shadow_lightProjViewModelMatrix",type:"function",fn:function(n,i){return Cv(e,i.shadow_lightProjViewMatrix,i.modelMatrix)}}),n}constructor(e,n){this.renderer=new PC(e),this._esmShadowThreshold=.3,this._layer=n,this._init()}resize(){const e=this.canvas;e.width=this._layer.getRenderer().canvas.width,e.height=this._layer.getRenderer().canvas.height}_init(){const e=(this._layer._getSceneConfig()||{}).shadow||{},n=this._getShadowRes(),i=this.getDefines();this._shadowPass=new NM(this.renderer,{width:n,height:n,blurOffset:e.blurOffset,defines:i}),this._shadowDisplayShader=new zM(i),this._createGround()}_getShadowRes(){let e=2048;const n=((this._layer._getSceneConfig()||{}).shadow||{}).quality;return"medium"===n?e=1024:"low"===n&&(e=512),e}getDefines(){return{HAS_SHADOWING:1,PACK_FLOAT:1,USE_ESM:1}}render(e,n,i,o,s,a,h,l,c,A){this._transformGround();const f=this._layer.getMap(),d=this._getShadowRes();let p,g;if(A||d!==this._shadowPass.width||this._shadowChanged(f,h,!!e)){d!==this._shadowPass.width&&this._shadowPass.resize(d,d),this._tempMat0=this._tempMat0||[],this._tempMat1=this._tempMat1||[];const o=Cv(this._tempMat0,n,i),s=l_(this._tempMat1,a);aE||(aE=f.getContainerExtent());let l=f.height;f.getPitch()>62&&(l=f._getVisualHeight(62));const c=aE.set(0,f.height-l,f.width,f.height).convertTo((e=>f._containerPointToPointAtRes(e,f.getGLRes()))),A=c.toArray();e&&h.addMesh(this._ground);const v=A.map((e=>[e.x,e.y,0,1])),{lightProjViewMatrix:w,shadowMap:C,blurFBO:P}=this._shadowPass.render(h,{cameraProjViewMatrix:o,lightDir:s,farPlane:v,cameraLookAt:f.cameraLookAt});p=this._lightProjViewMatrix=w,g=this._shadowMap=C,this._blurFBO=P,this._renderedShadows=h.getMeshes().reduce(((e,n)=>(n.castShadow&&n.geometry&&(e[n.uuid]={v0:n.version,v1:n.geometry.version}),e)),{}),this._renderedView={count:h.getMeshes().length-+!!e,displayShadow:!!e},this._updated=!0}else p=this._lightProjViewMatrix,g=this._shadowMap,this._updated=!1;this._projMatrix=n,this._viewMatrix=i,XI(s)&&(s=1),e&&h.getMeshes().length&&this.displayShadow(o,s,l,c);return{shadow_lightProjViewMatrix:p,shadow_shadowMap:g,shadow_opacity:s,shadow_color:o||sE,esm_shadow_threshold:this._esmShadowThreshold}}displayShadow(e,n,i,o){const s=this._lightProjViewMatrix,a=this._ground,h=this._groundLightProjViewModelMatrix||[],l=this._layer.getRenderer().canvas,c=this._texSize=this._texSize||[];c[0]=l.width,c[1]=l.height,this.renderer.render(this._shadowDisplayShader,{halton:i||oE,globalTexSize:c,projMatrix:this._projMatrix,viewMatrix:this._viewMatrix,shadow_lightProjViewModelMatrix:Cv(h,s,a.localTransform),shadow_shadowMap:this._shadowMap,esm_shadow_threshold:this._esmShadowThreshold,shadow_opacity:n,color:e||sE},this._groundScene,o)}dispose(){this._shadowPass.dispose(),this._shadowDisplayShader.dispose(),this._ground&&(this._ground.geometry.dispose(),this._ground.dispose()),delete this.renderer}isUpdated(){return!1!==this._updated}_shadowChanged(e,n,i){if(!this._renderedShadows)return!0;const o=this._renderedView;if(n.getMeshes().length!==o.count||i!==o.displayShadow)return!0;const s=n.getMeshes();for(let e=0;e<s.length;e++){const n=this._renderedShadows[s[e].uuid];if(s[e].castShadow&&(s[e].hasSkinAnimation()||!n||n.v0!==s[e].version||n.v1!==s[e].geometry.version))return!0}return!1}_createGround(){const e=new WC;e.generateBuffers(this.renderer.regl),this._ground=new bC(e),this._groundScene=new kC([this._ground])}_transformGround(){const e=this._layer.getMap(),n=KI(this._ground.localTransform,e);this._ground.setLocalTransform(n)}}const hE=[0,0],lE=new Zh(0,0),uE=new Zh(0,0),cE=[],AE=[],fE=[];function dE(e,n,i,o){const s=e.getGLRes(),a=e.distanceToPointAtRes(n,n,s,i?lE:null,uE);return o?a.y:a.x}const{getIBLResOnCanvas:pE,logoutIBLResOnCanvas:gE,getPBRUniforms:mE,loginIBLResOnCanvas:yE}=DT.PBRUtils,vE=[0,0],_E=[1,1],xE=[],bE=[],wE=[],CE=[],PE=[];class GroundPainter{static getGroundTransform(e,n){return KI(e,n)}constructor(e,n){this._regl=e,this.renderer=new PC(e),this._layer=n,this._loader=new SC,this._bindOnMaterialComplete=(...e)=>this._onMaterialComplete.call(this,...e),this._init();const i=this.getMap().getRenderer().canvas;yE(i,e,this.getMap())}needToRedraw(){const e=this._getUVOffsetAnim();return e&&(e[0]||e[1])}getMap(){return this._layer&&this._layer.getMap()}getSymbol(){const e=this._layer.getGroundConfig();return e&&e.symbol}isEnable(){const e=this._layer.getGroundConfig();return e&&e.enable}paint(e){if(!this.isEnable())return!1;const n=this._getShader();if(this._isInSSRPhase(e)&&n===this._fillShader)return!1;const i=this._getGroundDefines(e);i&&this._ground.setDefines(i),this._ground.material!==this.material&&this._ground.setMaterial(this.material);const o=this._layer.getGroundConfig();this._ground.ssr=(o&&o.symbol).ssr?1:0,this._transformGround();const s=this._getUniformValues(e);s.offsetFactor=e.offsetFactor,s.offsetUnits=e.offsetUnits;const a=e&&e.renderTarget&&e.renderTarget.fbo;return n===this._fillShader?(this.renderer.render(n,s,this._groundScene,a),this._layer.getRenderer().setCanvasUpdated(),!0):(n.filter=e.sceneFilter,this.renderer.render(n,s,this._groundScene,a),this._layer.getRenderer().setCanvasUpdated(),!0)}_isInSSRPhase(e){return!(!this._layer.getRenderer().isEnableSSR||!this._layer.getRenderer().isEnableSSR())&&!(!e||!e.ssr)}update(){const e=this._layer.getGroundConfig();if(!e)return;const n=e&&e.symbol,i=e.urlModifier;if(n){this._polygonFill=this._parseColor(n.polygonFill||[1,1,1,1]),this._polygonOpacity=void 0===n.polygonOpacity?1:n.polygonOpacity;const e=n.polygonPatternFile;if(e){if(!this._polygonPatternFile||this._polygonPatternFile._pattern_src!==e){const n=new Image;n.onload=()=>{this._polygonPatternFile&&this._polygonPatternFile.destroy(),this._polygonPatternFile=this._createPatternTexture(n),this._polygonPatternFile._pattern_src=e,this.setToRedraw()},n.src=i&&i(e)||e}}else this._polygonPatternFile&&(this._polygonPatternFile.destroy(),delete this._polygonPatternFile)}else this._polygonFill=[1,1,1,1],this._polygonOpacity=1,this._polygonPatternFile&&(this._polygonPatternFile.destroy(),delete this._polygonPatternFile);this._updateMaterial()}setToRedraw(){const e=this._layer.getRenderer();e&&e.setToRedraw()}dispose(){this.material&&(this.material.dispose(),delete this.material),this._ground&&(this._ground.geometry.dispose(),this._ground.material&&this._ground.material.dispose(),this._ground.dispose(),delete this._ground),this._polygonPatternFile&&(this._polygonPatternFile.destroy(),delete this._polygonPatternFile),this._fillShader&&(this._fillShader.dispose(),delete this._fillShader),this._standardShader&&(this._standardShader.dispose(),delete this._standardShader),this._disposeIblTextures()}_getShader(){const e=this._layer.getGroundConfig();if(!e||!e.renderPlugin)return this._fillShader;const n=e.renderPlugin.type;if("lit"===n)return this._standardShader;if("fill"===n)return this._fillShader;throw new Error("unsupported render plugin of "+n+" for layer ground")}_getUniformValues(e){const n=this._getCommonUniforms(e);n.polygonFill=this._polygonFill,n.polygonOpacity=this._polygonOpacity;return this._getShader()===this._fillShader&&this._polygonPatternFile&&(n.polygonPatternFile=this._polygonPatternFile),n}_getCommonUniforms(e){let n;if("lit"===this._layer.getGroundConfig().renderPlugin.type){const i=this.getMap().getRenderer().canvas,{iblTexes:o,dfgLUT:s}=pE(i);n=mE(this.getMap(),o,s,e&&e.ssr,e&&e.jitter)}else{n={projViewMatrix:this.getMap().projViewMatrix}}return this._setIncludeUniformValues(n,e),n}_setIncludeUniformValues(e,n){const i=n&&n.includes;if(i)for(const o in i)i[o]&&n[o].renderUniforms&&QI(e,n[o].renderUniforms)}_disposeIblTextures(){const e=this.getMap().getRenderer().canvas;gE(e,this.getMap())}_init(){const e=this._getExtraCommandProps(),n=ShadowProcess.getUniformDeclares(),i=[];n.push({name:"projViewModelMatrix",type:"function",fn:function(e,n){return Cv(i,n.projViewMatrix,n.modelMatrix)}}),this._fillShader=new eP({vert:"attribute vec3 aPosition;\nuniform mat4 projViewModelMatrix;\nuniform mat4 modelMatrix;\n#ifdef HAS_PATTERN\n    attribute vec2 aTexCoord;\n    uniform vec2 uvScale;\n    uniform vec2 uvOffset;\n    varying vec2 vTexCoord;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n    #include <vsm_shadow_vert>\n#endif\nvoid main () {\n    #ifdef HAS_PATTERN\n        vTexCoord = aTexCoord * uvScale + uvOffset;\n    #endif\n    vec3 position = vec3(aPosition);\n    gl_Position = projViewModelMatrix * vec4(position, 1.0);\n    #if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n        shadow_computeShadowPars(vec4(position, 1.0));\n    #endif\n}",frag:"precision mediump float;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n    #include <vsm_shadow_frag>\n#endif\n#ifdef HAS_PATTERN\n    uniform sampler2D polygonPatternFile;\n    varying vec2 vTexCoord;\n#endif\nuniform vec4 polygonFill;\nuniform float polygonOpacity;\nvoid main() {\n    #ifdef HAS_PATTERN\n        vec4 color = texture2D(polygonPatternFile, vTexCoord);\n    #else\n        vec4 color = polygonFill;\n    #endif\n    gl_FragColor = color * polygonOpacity;\n    #if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n        float shadowCoeff = shadow_computeShadow();\n        gl_FragColor.rgb = shadow_blend(gl_FragColor.rgb, shadowCoeff);\n    #endif\n}",uniforms:n,extraCommandProps:e});const o=ShadowProcess.getUniformDeclares();o.push(...gP.getUniformDeclares()),this._standardShader=new DT.StandardShader({uniforms:o,extraCommandProps:e}),this._createGround(),this.update()}_getExtraCommandProps(){const e=[0,1],n=this._layer.getRenderer().canvas;return{viewport:{x:0,y:0,width:()=>n.width,height:()=>n.height},cull:{enable:!0},depth:{enable:!0,mask:()=>{const e=this._layer.getGroundConfig();return e.depth||void 0===e.depth},range:()=>{const n=this._layer.getGroundConfig(),i=n&&n.renderPlugin.sceneConfig;return i&&i.depthRange||e},func:"<="},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"},polygonOffset:{enable:!0,offset:{factor:(e,n)=>n.offsetFactor,units:(e,n)=>n.offsetUnits}}}}_hasIBL(){const e=this.getMap().getLightManager();return!!(e&&e.getAmbientResource())}_createGround(){const e=new WC;e.data.aTexCoord=new Uint8Array([0,0,1,0,0,1,1,1]),e.createTangent(),e.generateBuffers(this.renderer.regl),this._ground=new bC(e,null,{castShadow:!1});const n=this._standardShader.getGeometryDefines(e);this._ground.setDefines(n),this._groundScene=new kC([this._ground])}_transformGround(){const e=this.getMap(),n=GroundPainter.getGroundTransform(this._ground.localTransform,e);this._ground.setLocalTransform(n);const i=e.getGLRes(),o=e._get2DExtentAtRes(i),s=o.getWidth(),a=o.getHeight(),h=e.cameraLookAt,l=h[0]-s,c=h[1]-a,A=this._polygonPatternFile?this._polygonPatternFile.width/this._polygonPatternFile.height:1,f=this.getSymbol(),d=this.material?this.material.get("textureOrigin"):f.polygonPatternFileOrigin,p=!!(this.material?this.material.get("uvOffsetInMeter"):f.uvOffsetInMeter),g=(this.material?this.material.get("uvOffset"):f.uvOffset)||vE,v=this.material&&this.material.get("uvScale")||_E,w=this.material?this.material.get("textureWidth"):f.polygonPatternFileWidth,C=this.material?w*(v[1]/v[0]):f.polygonPatternFileHeight,P=this._getUVOffsetAnim(),[T,S,I,E,O]=function(e,n,i,o,s,a,h,l,c,A,f){const d=e.getGLRes();o&&(lE.set(o[0],o[1]),e.coordToPointAtRes(lE,d,uE),n-=uE.x,i-=uE.y);const p=o?lE:null;A=qx(AE,A);const g=!c&&A||hE;let v=c&&A||hE;v=qx(cE,v),v[0]&&(v[0]=dE(e,v[0],p)),v[1]&&(v[1]=dE(e,v[1],p,1));let w=.5;s&&(w=dE(e,s,p));let C=w/h;if(a&&(C=dE(e,a,p,1)),f&&(f[0]||f[1])){const n=performance.now()/1e3;let i=f[0],o=f[1];c&&(i=-dE(e,f[0],p),o=-dE(e,f[1],p,1)),f[0]&&(c?v[0]=n*i:g[0]=n*i),f[1]&&(c?v[1]=n*o:g[1]=n*o)}const P=(n+v[0])/(w/l[0]),T=(i-v[1])/(C/l[1]);return fE[0]=w/l[0],fE[1]=C/l[1],fE[2]=P,fE[3]=T,fE[4]=g,fE}(e,l,c,d,w,C,A,v,p,g,P),k=2*o.getWidth()/T,L=2*o.getHeight()/S;if(!this.material)return this._ground.setUniform("uvScale",Zx(xE,k,L)),void this._ground.setUniform("uvOffset",Zx(bE,I%1+O[0],E%1+O[1]));this._ground.setUniform("uvScale",Zx(PE,k,L)),this._ground.setUniform("uvOffset",Zx(wE,I%1+O[0],E%1+O[1])),this._ground.setUniform("uvOrigin",Zx(CE,I-I%1,E-E%1)),this._ground.setUniform("uvRotation",0)}_getGroundDefines(e){let n=!1;const i=this._ground.defines,o=this._layer._getSceneConfig&&this._layer._getSceneConfig(),s=this._layer.getGroundConfig();function a(e,o){e?i[o]||(i[o]=1,n=!0):i[o]&&(delete i[o],n=!0)}a(this._hasIBL(),"HAS_IBL_LIGHTING");a(e&&e.ssr&&s&&s.symbol&&s.symbol.ssr,"HAS_SSR");const h=e&&o&&o.shadow&&o.shadow.enable;a(h,"HAS_SHADOWING"),a(h,"USE_ESM");return a(!!this._polygonPatternFile,"HAS_PATTERN"),n?i:null}_updateMaterial(){const e=this.getSymbol()&&this.getSymbol().material;if(!e)return;const n={};let i=!1;const o=this._layer.getGroundConfig();this._loader.setURLModifier(o.urlModifier);for(const o in e)if($I(e,o))if(o.indexOf("Texture")>0){let s=e[o];if(!s)continue;s="string"==typeof s?{url:s,wrap:"repeat"}:s,s.flipY=!0,s.min="linear mipmap linear",s.mag="linear",s.flipY=!0,n[o]=new VC(s,this._loader),i=!0}else n[o]=e[o];this.material?(this._loadingMaterial=new DT.StandardMaterial(n),this._loadingMaterial.isReady()?this._onMaterialComplete():this._loadingMaterial.once("complete",this._bindOnMaterialComplete)):(this.material=new DT.StandardMaterial(n),this.material.once("complete",this._bindOnMaterialComplete,this)),i||this._onMaterialComplete()}_onMaterialComplete(){this._loadingMaterial&&(this.material.dispose(),this.material=this._loadingMaterial,delete this._loadingMaterial),this.setToRedraw(!0)}_createPatternTexture(e){e=vw.resizeToPowerOfTwo(e);return this._regl.texture({width:e.width,height:e.height,data:e,mag:"linear",min:"linear mipmap linear",flipY:!0,wrap:"repeat"})}_parseColor(e){return nE([],e)}_getUVOffsetAnim(){return this.material&&this.material.get("uvOffsetAnim")}getRenderMeshes(){return this._groundScene.getMeshes()}}const{createIBLTextures:ME,disposeIBLTextures:TE}=DT.PBRUtils,SE=[0,0,0],IE=[],EE=[];class EnvironmentPainter{constructor(e,n){this._maxLevel=4,this._regl=e,this.renderer=new PC(e),this._layer=n,this._init(),this._updateMode()}paint(e){if(!this.isEnable()||!this._resource)return;const n=this._getUniformValues(e);this.renderer.render(this._shader,n,null,e&&e.renderTarget&&e.renderTarget.fbo)}update(){const e=this.getMap();if(!e||!this.isEnable())return;const n=e.getLightManager(),i=n&&n.getAmbientResource();i!==this._resource&&this._iblTexes&&(TE(this._iblTexes),delete this._iblTexes),this._resource=i,this._updateMode()}dispose(){this._shader.dispose(),TE(this._iblTexes),delete this._shader,delete this._iblTexes,delete this._resource}getMap(){return this._layer.getMap()}_updateMode(){if(!this._resource)return;const e=this._layer._getSceneConfig().environment||{};this._shader.setMode(e.toneMapping,e.mode?1:0)}isEnable(){const e=this._layer._getSceneConfig();return this._hasIBL()&&e&&e.environment&&e.environment.enable}_hasIBL(){const e=this.getMap().getLightManager();return!!(e&&e.getAmbientResource())}_getUniformValues(){const e=this.getMap(),n=this.getMap().getLightManager(),i=n&&n.getAmbientLight();let o=this._iblTexes;o||(o=this._iblTexes=ME(this._regl,e));const s=this._layer.getRenderer().canvas,a=this._layer._getSceneConfig().environment||{},h=a.level||0,l=o.prefilterMap.width,c=this._transform=this._transform||[],A=a.brightness||0,f=a.intensity||1;return Kv(IE,i&&i.hsv||SE),A&&(IE[2]+=A),EE[0]=s.width,EE[1]=s.height,{cubeMap:o.prefilterMap,bias:h,size:l/Math.pow(2,Math.max(0,h-1)),environmentExposure:YI(i&&i.exposure)?i.exposure:1,backgroundIntensity:f,diffuseSPH:o.sh,viewMatrix:e.viewMatrix,projMatrix:e.projMatrix,resolution:EE,hsv:IE,transformMatrix:pv(c,i&&Math.PI/180*-i.orientation||0)}}_init(){const e=this.getMap();if(e.on("updatelights",this.update,this),this._shader=new _P,e.options.lights){const e=this.getMap().getLightManager().getAmbientResource();this._resource=e}}}const OE=[],RE=[.03,.03,.03],DE=[],kE=[],LE=[],FE=[1,1,1],NE=[-1200,-1200,0],zE=[1200,1200,1e3],BE={min:[],max:[]},HE=kv([],Ax([],90,0,0),[0,0,0]);class RainPainer{constructor(e,n){this._regl=e,this.renderer=new PC(e),this._layer=n,this._timer=new Clock,this._init()}getMap(){return this._layer&&this._layer.getMap()}_init(){const e=this._layer.getRenderer().canvas;this._shader=new eP({vert:"attribute vec3 aPosition;\nattribute vec3 aNormal;\nattribute vec2 aTexCoord;\nuniform mat4 projMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 positionMatrix;\nuniform vec3 cameraPosition;\nuniform float top;\nuniform float bottom;\nuniform float time;\nvarying vec2 vTexCoord;\n#include <get_output>\nfloat angle(float x, float y){\n    return atan(y, x);\n}\nvec2 getFoot(vec2 camera, vec2 normal, vec2 pos) {\n    vec2 position = vec2(0.0, 0.0);\n    float distanceLen = distance(pos, normal);\n    float a = angle(camera.x - normal.x, camera.y - normal.y);\n    pos.x > normal.x ? a -= 0.785 : a += 0.785;\n    position.x = cos(a) * distanceLen;\n    position.y = sin(a) * distanceLen;\n    return position + normal;\n    return position;\n}\nvoid main()\n{\n    vec4 localPosition = getPosition(aPosition);\n    mat4 localPositionMatrix = getPositionMatrix();\n    vec2 foot = getFoot(vec2(cameraPosition.x, cameraPosition.z), vec2(aNormal.x, aNormal.z), vec2(localPosition.x, localPosition.z));\n    float height = top - bottom;\n    float y = aNormal.y - bottom - height * time;\n    y = y + (y < 0.0 ? height : 0.0);\n    float ratio = (1.0 - y / height) * (1.0 - y / height);\n    y = height * (1.0 - ratio);\n    y += bottom;\n    y += aPosition.y - aNormal.y;\n    localPosition = vec4( foot.x, y, foot.y , 1.0);\n    gl_Position = projMatrix * modelViewMatrix * localPositionMatrix * localPosition;\n    vTexCoord = aTexCoord;\n}",frag:"precision mediump float;\nvarying vec2 vTexCoord;\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D rainMap;\nvoid main() {\n    vec4 rainColor = texture2D(rainMap, vTexCoord);\n    vec4 diffuseColor = vec4(diffuse, opacity);\n    diffuseColor *= rainColor;\n    gl_FragColor = diffuseColor;\n}",uniforms:[{name:"modelViewMatrix",type:"function",fn:function(e,n){return Cv(OE,n.viewMatrix,n.modelMatrix)}}],extraCommandProps:{viewport:{x:0,y:0,width:()=>e.width,height:()=>e.height},depth:{enable:!0,mask:!1,func:"less",range:[0,1]},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}}),this._createScene()}_createScene(){const e=this._regl.texture({width:2,height:2});if(this._mesh=this._createRain(),!this._mesh)return;this._scene=new kC(this._mesh);const n=this._getRainConfig();n.rainTexture?this._creatRainTexture(n.rainTexture).then((e=>{this._mesh.material.set("rainMap",e)})):(this._mesh.material.set("rainMap",e),console.warn("should set rain texture."))}_createRain(){const e=this.getMap(),n=this._getRainConfig();if(!n)return null;this._fixZoom=e.getZoom();const i=this._getFixExtent(),o=this._rainDensity=n.density,s=this._rainWidth=n.rainWidth||1,a=this._rainHeight=n.rainHeight||1,h=[],l=[],c=[],A=[];for(let e=0;e<o;e++){const n={};n.x=Math.random()*(i.max[0]-i.min[0])+i.min[0],n.y=Math.random()*(i.max[2]-i.min[2])+i.min[2],n.z=Math.random()*(i.max[1]-i.min[1])+i.min[1];const o=(i.max[2]-i.min[2])/37.5*a,f=o/3*s;h.push(n.x+f,n.y+o,n.z,n.x-f,n.y+o,n.z,n.x-f,n.y,n.z,n.x+f,n.y,n.z),l.push(n.x,n.y-o/2,n.z,n.x,n.y-o/2,n.z,n.x,n.y-o/2,n.z,n.x,n.y-o/2,n.z),c.push(1,1,0,1,0,0,1,0),A.push(4*e+0,4*e+1,4*e+2,4*e+0,4*e+2,4*e+3)}const f={};f.POSITION=h,f.NORMAL=l,f.TEXCOORD_0=c;const d=new Lw(f,A,0,{primitive:"triangles",positionAttribute:"POSITION",normalAttribute:"NORMAL",uv0Attribute:"TEXCOORD_0"});d.generateBuffers(this.renderer.regl);const p=new cC({rainMap:this._regl.texture({width:2,height:2}),diffuse:n.color||[1,1,1],opacity:n.opacity||1}),g=new bC(d,p);return g.setUniform("top",i.max[2]),g.setUniform("bottom",i.min[2]),this._transformRain(g),g.transparent=!0,g}_creatRainTexture(e){const n=new Image;return n.src=this._rainTexture=e,new Promise(((e,i)=>{n.onload=()=>{const i=this._regl.texture({mag:"linear",min:"linear mipmap nearest",wrapS:"clamp",wrapT:"clamp",data:n});e(i)},n.onerror=e=>{i(e)}}))}paint(e){if(!this._scene)return;const n=this._getRainConfig(),i={},o=this.getMap();i.projMatrix=o.projMatrix,i.viewMatrix=o.viewMatrix,i.cameraPosition=o.cameraPosition;const s=n.speed||1,a=this._timer.getElapsedTime()/(2/s)%1;i.time=a,this._mesh.material.set("diffuse",n.color||FE),this._mesh.material.set("opacity",n.opacity||1),this._transformRain(this._mesh);this.renderer.render(this._shader,i,this._scene,e&&e.renderTarget&&e.renderTarget.fbo),this._layer.getRenderer().setCanvasUpdated()}_transformRain(e){const n=this.getMap(),i=n.coordinateToPointAtRes(n.getCenter(),n.getGLRes()),o=n.getGLScale()/n.getGLScale(this._fixZoom),s=$v(kE,o,o,o),a=n_(s,RE,s),h=xv(LE),l=this._getRainConfig(),c=n.getBearing();zv(h,Ax(DE,l.windDirectionX||0,l.windDirectionY||0,90-c),[i.x,i.y,0],a),Cv(h,h,HE),e.setLocalTransform(h)}setToRedraw(){const e=this._layer.getRenderer();e&&e.setToRedraw()}update(){const e=this._getRainConfig();if(e){if(this._mesh||this._createScene(),e.density!==this._rainDensity||e.rainWidth!==this._rainWidth||e.rainHeight!==this._rainHeight){const e=this._mesh.material.get("rainMap");this._mesh.geometry.dispose(),this._mesh.dispose(),this._scene.clear(),this._mesh=this._createRain(),this._mesh.material.set("rainMap",e),this._scene.setMeshes(this._mesh)}e.rainTexture!==this._rainTexture&&this._creatRainTexture(e.rainTexture).then((e=>{this._mesh.material.set("rainMap",e)}))}}dispose(){this._mesh&&(this._mesh.geometry.dispose(),this._mesh.material&&this._mesh.material.dispose(),this._mesh.dispose(),delete this._mesh),this._shader&&(this._shader.dispose(),delete this._shader)}isEnable(){const e=this._getRainConfig();return e&&e.enable}_getRainConfig(){const e=this._layer.getWeatherConfig();return e&&e.rain}_getFixExtent(){const e=16.685648411389433-this.getMap().getZoom();return r_(BE.min,NE,Math.pow(2,e)),r_(BE.max,zE,Math.pow(2,e)),BE}}class Clock{constructor(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const n=("undefined"==typeof performance?Date:performance).now();e=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=e}return 0}}const jE=[],UE=[.03,.03,.03],GE=[],VE=[],WE=[],qE=kv([],Ax([],90,0,0),[0,0,0]);class SnowPainter{constructor(e,n){this._regl=e,this._layer=n,this._init()}_init(){const e=this._layer.getRenderer().canvas;this._shader=new eP({vert:"#include <gl2_vert>\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\nuniform mat4 projMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 positionMatrix;\n#include <get_output>\nvoid main()\n{\n    mat4 localPositionMatrix = getPositionMatrix();\n    vec4 localPosition = getPosition(aPosition);\n    gl_Position = projMatrix * modelViewMatrix * localPositionMatrix * localPosition;\n    vTexCoord = aTexCoord;\n}",frag:"#if __VERSION__ == 100\n  #ifdef GL_OES_standard_derivatives\n    #extension GL_OES_standard_derivatives : enable\n  #endif\n#endif\nprecision mediump float;\n#include <gl2_frag>\nprecision mediump float;\nuniform sampler2D perlinTexture;\nvarying vec2 vTexCoord;\nfloat lerp(float a, float b, float w) {\n    return a + w * (b - a);\n}\nvoid main() {\n    float snowIntense = texture2D(perlinTexture, vTexCoord).r;\n    vec3 fixedC = vec3(1.0, 1.0, 1.0);\n    float r = lerp(0.5, fixedC.x, snowIntense);\n    float g = lerp(0.5, fixedC.y, snowIntense);\n    float b = lerp(0.5, fixedC.z, snowIntense);\n    glFragColor = vec4(r, g, b, 1.0);\n    #if __VERSION__ == 100\n        gl_FragColor = glFragColor;\n    #endif\n}",uniforms:[{name:"modelViewMatrix",type:"function",fn:function(e,n){return Cv(jE,n.viewMatrix,n.modelMatrix)}}],extraCommandProps:{viewport:{x:0,y:0,width:()=>e.width,height:()=>e.height}}}),this._shader.version=300,this._scene=new kC,this._groundMask=this._createGroundMask(),this._scene.setMeshes(this._groundMask),this.renderer=new PC(this._regl);const n=this._getSnowConfig();n&&(n.snowGroundTexture?this._createSnowTexture(n.snowGroundTexture):(this._groundNormal=this._regl.texture({width:2,height:2}),console.warn("should set snow ground texture.")))}render(e){this._groundNormal&&this._groundMask.material.set("perlinTexture",this._groundNormal);const n=this._layer.getMap();this._transformMask(n);this.renderer.render(this._shader,{projMatrix:n.projMatrix,viewMatrix:n.viewMatrix,cameraPosition:n.cameraPosition},this._scene,e&&e.renderTarget&&e.renderTarget.fbo),this._layer.getRenderer().setCanvasUpdated()}_transformMask(e){const n=e.coordinateToPointAtRes(e.getCenter(),e.getGLRes()),i=e.getGLScale()/e.getGLScale(this._fixZoom),o=$v(VE,i,i,i),s=n_(o,UE,o),a=xv(WE);zv(a,Ax(GE,0,0,0),[n.x,n.y,.005],s),Cv(a,a,qE),this._groundMask.setLocalTransform(a)}_createSnowTexture(e){const n=new Image;n.onload=()=>{this._groundNormal=this._regl.texture({mag:"linear",min:"linear mipmap nearest",wrapS:"repeat",wrapT:"repeat",data:n})},n.onerror=e=>{console.log(e)},n.src=this._snowGroundTexture=e}_createGroundMask(){const e=this._layer.getMap();this._fixZoom=e.getZoom();const n=16e3*Math.pow(2,16.685648411389433-this._fixZoom),i={};i.POSITION=[-n,0,-n,n,0,-n,-n,0,n,n,0,n],i.NORMAL=[0,1,0,0,1,0,0,1,0,0,1,0],i.TEXCOORD_0=[0,0,1,0,0,1,1,1];const o=new Lw(i,[3,1,0,0,2,3],0,{positionAttribute:"POSITION",normalAttribute:"NORMAL",uv0Attribute:"TEXCOORD_0"});o.generateBuffers(this._regl);const s=new cC({perlinTexture:this._regl.texture({with:2,height:2})});return new bC(o,s)}getMeshes(){return this._groundMask}dispose(){this._groundMask&&(this._groundMask.geometry.dispose(),this._groundMask.material&&this._groundMask.material.dispose(),this._groundMask.dispose(),delete this._groundMask),this._shader&&(this._shader.dispose(),delete this._shader)}update(){const e=this._getSnowConfig();e&&e.snowGroundTexture===!this._snowGroundTexture&&this._createSnowTexture(e.snowGroundTexture)}isEnable(){const e=this._getSnowConfig();return e&&e.enable}_getSnowConfig(){const e=this._layer.getWeatherConfig();return e&&e.snow}}const ZE=[];class WeatherPainter{constructor(e,n,i){this._regl=e,this._layer=n,this._config=i,this._init()}_init(){this.renderer=new PC(this._regl);const e=this._layer.getRenderer(),n=this._viewport={x:0,y:0,width:()=>e.canvas?e.canvas.width:1,height:()=>e.canvas?e.canvas.height:1};this._width=n.width,this._height=n.height,this._fbo=this._regl.framebuffer({color:this._regl.texture({width:e.canvas?e.canvas.width:1,height:e.canvas?e.canvas.height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this.EMPTY_TEXTURE=this._regl.texture({with:2,height:2}),this._rainPainter=new RainPainer(this._regl,this._layer),this._rainRipplesPass=new LP(this._regl,n),this._snowPainter=new SnowPainter(this._regl,this._layer),this._fogPass=new TP(this._regl,n,this._layer),this._weatherShader=new SP,this._weatherShader.version=300}getMap(){return this._layer&&this._layer.getMap()}renderScene(e){this.renderSnowMask(e),this.renderRain(e)}renderRain(e){this.isEnableRain()&&this._rainPainter.paint(e)}renderSnowMask(e){if(!this.isEnableSnow()||!this._showSnowGround())return;const n=this.getMap();this._snowPainter.render(e,n)}paint(e,n){if(!n||!n.length)return e;this._resize();const i=this._layer.getWeatherConfig(),o={};if(this.isEnableRain()?(o.ripplesMap=this._renderRainRipples(),this._weatherShader.shaderDefines.HAS_RAIN=1):delete this._weatherShader.shaderDefines.HAS_RAIN,this.isEnableSnow()?(this._weatherShader.shaderDefines.HAS_SNOW=1,o.snowIntensity=vw.isNumber(i.snow.snowIntensity)?i.snow.snowIntensity:.5,n.forEach((e=>{e.defines.HAS_SNOW=1}))):(delete this._weatherShader.shaderDefines.HAS_SNOW,n.forEach((e=>{delete e.defines.HAS_SNOW}))),this.isEnableFog()){o.fogColor=i.fog.color||[.9,.9,.9],this._weatherShader.shaderDefines.HAS_FOG=1}else delete this._weatherShader.shaderDefines.HAS_FOG;return this._weatherShader.setDefines(this._weatherShader.shaderDefines),o.mixFactorMap=this._renderMixFactor(n)||this.EMPTY_TEXTURE,o.sceneMap=e,o.time=this._getTimeSpan()/1e3,o.resolution=Zx(ZE,this._fbo.width,this._fbo.height),this.renderer.render(this._weatherShader,o,null,this._fbo),this._renderMeshes=n,this._fbo}_renderMixFactor(e){const n={},i=this.getMap(),o=i.getZoom(),s=Math.pow(2,16.685648411389433-o),a=this._layer.getWeatherConfig(),h=a.fog;if(!h||!h.enable)return null;const l=h.start||.1,c=h.end||100;n.projMatrix=i.projMatrix,n.viewMatrix=i.viewMatrix,n.cameraPosition=i.cameraPosition,n.fogDist=[l*s,c*s],n.rainDepth=i.altitudeToPoint(a.rain&&a.rain.rainDepth||.1,i.getGLRes());const A=this._fogPass.render(e,n);return this._layer.getRenderer()._getFBOColor(A)}_renderRainRipples(){const e=this.getMap(),n=this._layer.getWeatherConfig(),i=n.rain.rippleRadius||24,o={};o.projMatrix=e.projMatrix,o.viewMatrix=e.viewMatrix,o.time=this._getTimeSpan()/1e3,o.rippleRadius=i,o.density=n.rain.density||2e3;return this._rainRipplesPass.render(e,o)}_getTimeSpan(){if(!this._layer)return 0;if(void 0===this._currentFrameTime&&(this._currentFrameTime=0),this.isPlaying()){const e=this._layer.getRenderer();this._currentFrameTime=e.getFrameTime()}return this._currentFrameTime}isEnable(){const e=this._layer.getWeatherConfig();return e&&e.enable}isEnableRain(){const e=this._layer.getWeatherConfig();return e&&e.enable&&e.rain&&e.rain.enable}isEnableFog(){const e=this._layer.getWeatherConfig();return e&&e.enable&&e.fog&&e.fog.enable}isEnableSnow(){const e=this._layer.getWeatherConfig();return e&&e.enable&&e.snow&&e.snow.enable}_showSnowGround(){const e=this._layer.getWeatherConfig();return this.isEnableSnow()&&!1===e.snow.showGround}isPlaying(){const e=this._layer.getWeatherConfig();return!!e&&!1!==e.playing}_hasWeather(){return this.isEnableRain()||this.isEnableFog()||this.isEnableSnow()}update(){!this.isEnable()&&this._renderMeshes&&this._renderMeshes.forEach((e=>{delete e.defines.HAS_SNOW,delete e.defines.HAS_RAIN,delete e.defines.HAS_FOG})),this.isEnableRain()&&(this._rainPainter=this._rainPainter||new RainPainer(this._regl,this._layer),this._rainPainter.update()),this.isEnableSnow()&&(this._snowPainter=this._snowPainter||new SnowPainter(this._regl,this._layer),this._snowPainter.update())}getShadowMeshes(){return this._snowPainter.getMeshes()}_resize(){const e=this._width(),n=this._height();!this._fbo||this._fbo.width===e&&this._fbo.height===n||this._fbo.resize(e,n)}dispose(){this._fbo&&this._fbo.destroy(),this._weatherShader&&(this._weatherShader.dispose(),delete this._weatherShader),this._rainPainter&&(this._rainPainter.dispose(),delete this._rainPainter),this._snowPainter&&(this._snowPainter.dispose(),delete this._snowPainter)}}const QE=[],XE=e=>!!e.bloom,YE=e=>!!e.ssr;class PostProcess{constructor(e,n){this._regl=e,this._layer=n,this._renderer=new PC(e),this._fxaaShader=new aP,this._copyShader=new bP,this._ssrPass=new gP(this._regl)}setContextIncludes(){}bloom(e,n,i,o,s,a,h){this._bloomPass||(this._bloomPass=new dP(this._regl));const l=this._layer.getRenderer()._getFBOColor(this._bloomFBO);return this._bloomPass.render(e,l,o,s,a,n,i,h)}drawBloom(e){const n=this._layer.getRenderer(),i=this._regl,o=this._bloomFBO;if(o){const{width:n,height:s}=e;o.width===n&&o.height===s||o.resize(n,s),i.clear({color:[0,0,0,0],framebuffer:o})}else{const n=this._createFBOInfo(e);this._bloomFBO=i.framebuffer(n)}const s=n.getFrameTime(),a=n.getFrameEvent(),h=n.getFrameContext(),l=h.renderMode,c=h.sceneFilter,A=h.renderTarget;h.isPostProcess=!0,h.renderMode="default",h.sceneFilter=XE,h.renderTarget={fbo:this._bloomFBO,getFramebuffer:JE,getDepthTexture:KE};const f=n.glCtx;return f.resetDrawCalls(),n.forEachRenderer(a?e=>{n.clearStencil(e,o),e.drawOnInteracting(a,s,h)}:e=>{n.clearStencil(e,o),e.draw(s,h)}),delete h.isPostProcess,h.renderMode=l,h.sceneFilter=c,h.renderTarget=A,f.getDrawCalls()}genSsrMipmap(e,n){const i=this._layer.getMap().projViewMatrix;this._ssrPass.genMipMap(e,n,i)}getPrevSsrProjViewMatrix(){return this._ssrPass&&this._ssrPass.getPrevProjViewMatrix()}drawSSR(e,n,i){i&&this._ssrPass.copyDepthTex(e);const o=this._layer.getRenderer(),s=o.getFrameTime(),a=o.getFrameEvent(),h=o.getFrameContext();h.isPostProcess=!0,h.ssr=this.getSSRContext();const l=h.renderMode,c=h.sceneFilter;h.renderMode="default",h.sceneFilter=YE,h.renderTarget.fbo=n;const A=o.glCtx;let f=!1;o.forEachRenderer(a?e=>{o.clearStencil(e,n),f||(A.resetDrawCalls(),f=!0),e.drawOnInteracting(a,s,h)}:e=>{o.clearStencil(e,n),f||(A.resetDrawCalls(),f=!0),e.draw(s,h)});const d=o.drawGround();return delete h.ssr,delete h.isPostProcess,h.renderMode=l,h.sceneFilter=c,this._ssrPainted=A.getDrawCalls()>0,d}getSSRUniforms(){const e=this._layer._getSceneConfig(),n=e&&e.postProcess,i=this._layer.getMap();return this._ssrPass.getSSRUniforms(i,n.ssr.factor,n.ssr.quality)}getSSRContext(){const e=this._layer._getSceneConfig(),n=e&&e.postProcess,i=this._layer.getMap(),o=this._ssrPass.getSSRUniforms(i,n.ssr.factor,n.ssr.quality);if(!o)return null;return{renderUniforms:o,defines:{HAS_SSR:1}}}fxaa(e,n,i,o,s,a,h,l,c,A,f,d){!e||e.width===n.fbo&&e.height===n.height||e.resize(n.width,n.height);const p={};l?p.HAS_OUTLINE_TEX=1:delete p.HAS_OUTLINE_TEX,this._fxaaShader.setDefines(p),this._renderer.render(this._fxaaShader,{textureSource:n,resolution:Zx(QE,n.width,n.height),enableFXAA:i,enableToneMapping:o,enableSharpen:s,pixelRatio:a,sharpFactor:h,textureOutline:l,highlightFactor:c,outlineFactor:A,outlineWidth:f,outlineColor:d},null,e)}renderFBOToScreen(e,n,i,o){this._copyFBOSize||(this._copyFBOSize=[]),this._copyFBOSize[0]=e.width,this._copyFBOSize[1]=e.height;const s=this._layer.getRenderer();this._renderer.render(this._copyShader,{texture:e.color&&s._getFBOColor(e)||e,size:this._copyFBOSize,enableSharpen:+!!n,sharpFactor:i,pixelRatio:o})}postprocess(e,n,i){this._postProcessShader||(this._postProcessShader=new hP);const o=this._layer&&this._layer.getRenderer(),s=i||o._getFBOColor(e);return n.resolution=Zx(QE,s.width,s.height),n.textureSource=s,n.timeGrain=performance.now(),this._renderer.render(this._postProcessShader,n),this._target}dispose(){this._bloomFBO&&(this._bloomFBO.destroy(),delete this._bloomFBO),this._bloomPass&&(this._bloomPass.dispose(),delete this._bloomPass),this._postProcessShader&&(this._postProcessShader.dispose(),delete this._postProcessShader),this._fxaaShader&&(this._fxaaShader.dispose(),delete this._fxaaShader),this._copyShader&&(this._copyShader.dispose(),delete this._copyShader)}_createFBOInfo(e,n){const{width:i,height:o}=this._layer.getRenderer().canvas,s=this._regl;let a;a=this._layer.getRenderer()._isUseMultiSample()?s.renderbuffer({width:i,height:o,samples:this._layer.options.multiSamples,format:"rgba8"}):s.texture({min:"nearest",mag:"nearest",format:n||"rgba",width:i,height:o});const h={width:i,height:o,colors:[a]};return e&&(h.depthStencil=e),h}}function JE(e){return e._framebuffer.framebuffer}function KE(e){return e.depthStencil._texture.texture}class AnalysisShader extends sP{constructor(e){super({vert:"#if __VERSION__ == 300\n\t#define attribute in\n\t#define varying out\n#endif\nattribute vec2 aPosition;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\nvoid main()\n{\n  gl_Position = vec4(aPosition, 0., 1.);\n  vTexCoord = aTexCoord;\n}",frag:"#if __VERSION__ == 100\n  #ifdef GL_OES_standard_derivatives\n    #extension GL_OES_standard_derivatives : enable\n  #endif\n#endif\nprecision mediump float;\n#include <gl2_frag>\nvarying vec2 vTexCoord;\n#ifdef HAS_FLOODANALYSE\n    uniform vec3 flood_waterColor;\n    uniform float flood_waterOpacity;\n    uniform sampler2D floodMap;\n#endif\n#ifdef HAS_SKYLINE\n    uniform sampler2D skylineMap;\n#endif\n#ifdef HAS_VIEWSHED\n    uniform vec4 viewshed_visibleColor;\n    uniform vec4 viewshed_invisibleColor;\n    uniform sampler2D viewshedMap;\n#endif\n#ifdef HAS_INSIGHT\n    uniform vec4 insight_visibleColor;\n    uniform vec4 insight_invisibleColor;\n    uniform sampler2D insightMap;\n#endif\n#ifdef HAS_CUT\n    uniform sampler2D meshesMap;\n    uniform sampler2D invisibleMap;\n#endif\n#ifdef HAS_EXCAVATE\n    uniform sampler2D excavateMap;\n#endif\n#ifdef HAS_CROSSCUT\n    uniform sampler2D crosscutMap;\n    uniform vec4 cutLineColor;\n#endif\n#ifdef HAS_HEIGHTLIMIT\n    uniform vec3 limitColor;\n    uniform sampler2D heightLimitMap;\n#endif\nuniform sampler2D sceneMap;\nvoid main() {\n    vec4 sceneColor = texture2D(sceneMap, vTexCoord);\n    glFragColor = sceneColor;\n    #ifdef HAS_VIEWSHED\n        vec4 viewshedColor = texture2D(viewshedMap, vTexCoord);\n        if (viewshedColor.r > 0.99) {\n            glFragColor = vec4(mix(viewshed_invisibleColor.rgb, sceneColor.rgb, viewshed_invisibleColor.a), sceneColor.a);\n        } else if (viewshedColor.g > 0.99) {\n            glFragColor = vec4(mix(viewshed_visibleColor.rgb, sceneColor.rgb, viewshed_visibleColor.a), sceneColor.a);\n        } else if (viewshedColor.a < 0.01) {\n            glFragColor = vec4(viewshedColor.rgb, 1.0);\n        }\n    #endif\n    #ifdef HAS_FLOODANALYSE\n        vec4 floodColor = texture2D(floodMap, vTexCoord);\n        if (floodColor.r > 0.0) {\n            glFragColor = vec4(mix(glFragColor.rgb, flood_waterColor, flood_waterOpacity), glFragColor.a);\n        }\n    #endif\n    #ifdef HAS_SKYLINE\n        vec4 skylineColor = texture2D(skylineMap, vTexCoord);\n        if (skylineColor.r > 0.0 || skylineColor.g > 0.0 || skylineColor.b > 0.0) {\n            glFragColor = skylineColor;\n        }\n    #endif\n    #ifdef HAS_INSIGHT\n        vec4 insightColor = texture2D(insightMap, vTexCoord);\n        if (insightColor.g > 0.0) {\n            glFragColor = insight_visibleColor;\n        } else if (insightColor.r > 0.0) {\n            glFragColor = insight_invisibleColor;\n        }\n    #endif\n    #ifdef HAS_CUT\n        vec4 cutColor = texture2D(invisibleMap, vTexCoord);\n        vec4 meshesMapColor = texture2D(meshesMap, vTexCoord);\n        if (cutColor.r == 1.0 && cutColor.g == 0.0 && cutColor.b == 0.0) {\n            glFragColor = meshesMapColor;\n        } else if (cutColor.r == 0.0 && cutColor.g == 1.0 && cutColor.b == 0.0) {\n            glFragColor = meshesMapColor;\n        } else if (cutColor.r == 0.0 && cutColor.g == 0.0 && cutColor.b == 1.0) {\n          glFragColor = sceneColor;\n        }\n    #endif\n    #ifdef HAS_EXCAVATE\n        vec4 excavateColor = texture2D(excavateMap, vTexCoord);\n        if (excavateColor.r == 1.0 && excavateColor.g == 0.0 && excavateColor.b == 0.0) {\n          glFragColor = sceneColor;\n        }  else {\n          glFragColor = excavateColor;\n        }\n    #endif\n    #ifdef HAS_CROSSCUT\n        vec4 crosscutColor = texture2D(crosscutMap, vTexCoord);\n        if (crosscutColor.r > 0.0) {\n            glFragColor = vec4(mix(cutLineColor.rgb, glFragColor.rgb, 0.99), glFragColor.a);\n        }\n    #endif\n    #ifdef HAS_HEIGHTLIMIT\n        vec4 heightLimitColor = texture2D(heightLimitMap, vTexCoord);\n        if (heightLimitColor.r > 0.0) {\n            glFragColor = vec4(mix(limitColor, glFragColor.rgb, 0.6), glFragColor.a);\n        }\n    #endif\n    #if __VERSION__ == 100\n        gl_FragColor = glFragColor;\n    #endif\n}",extraCommandProps:{viewport:e,cull:{enable:!0},blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"},equation:"add"}}})}}class AnalysisPainter{constructor(e,n,i){this._regl=e,this._layer=n,this._config=i,this._init()}_init(){this.renderer=new PC(this._regl);const e=this._layer.getRenderer(),n=this._viewport={x:0,y:0,width:()=>e.canvas?e.canvas.width:1,height:()=>e.canvas?e.canvas.height:1};this._fbo=this._regl.framebuffer({color:this._regl.texture({width:e.canvas?e.canvas.width:1,height:e.canvas?e.canvas.height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this._shader=new AnalysisShader(n)}getMap(){return this._layer&&this._layer.getMap()}paint(e,n){if(!n&&n.length)return e;this._resize();const i={},o=this._layer._analysisTaskList;if(!this._hasAnalysis())return e;this._regl.clear({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this._fbo}),delete this._shader.shaderDefines.HAS_FLOODANALYSE,delete this._shader.shaderDefines.HAS_VIEWSHED,delete this._shader.shaderDefines.HAS_SKYLINE,delete this._shader.shaderDefines.HAS_INSIGHT,delete this._shader.shaderDefines.HAS_CUT,delete this._shader.shaderDefines.HAS_CROSSCUT,delete this._shader.shaderDefines.HAS_HEIGHTLIMIT;for(let e=0;e<o.length;e++){const s=o[e];if(!s.isEnable())continue;const a=s.getDefines();QI(this._shader.shaderDefines,a);const h=this.getMap(),l=h.width,c=h.height,A=this._getToAnalysisMeshes(n,s.getExcludeLayers()),f=s.renderAnalysis(A,l,c);f&&QI(i,f)}return i.sceneMap=e,this._shader.setDefines(this._shader.shaderDefines),this.renderer.render(this._shader,i,null,this._fbo),this._fbo}_getToAnalysisMeshes(e,n){let i=[];for(let o=0;o<e.length;o++){if(n.indexOf(e[o].getId())>-1)continue;const s=e[o].getRenderer();if(s&&s.getAnalysisMeshes){const e=s.getAnalysisMeshes();e.forEach((e=>{e.setUniform("useAnalysis",1)})),i=i.concat(e)}}return i}_resize(){const e=Yo.isFunction(this._viewport.width.data)?this._viewport.width.data():this._viewport.width,n=Yo.isFunction(this._viewport.height.data)?this._viewport.height.data():this._viewport.height;!this._fbo||this._fbo.width===e&&this._fbo.height===n||this._fbo.resize(e,n)}_hasAnalysis(){const e=this._layer&&this._layer._analysisTaskList;if(!e)return!1;for(let n=0;n<e.length;n++)if(e[n].isEnable())return!0;return!1}}const $E=[0,0,0,0],tO=[1,1,-1],eO=[0,0],nO=e=>!e.bloom&&!e.ssr,iO=e=>!e.bloom,rO=e=>!e.ssr;function oO(e){return"number"==typeof e&&!isNaN(e)}function sO(e){return e._framebuffer.framebuffer}function aO(e){return e.depthStencil._texture.texture}function hO(e,n,i){return null==e[n]?i:e[n]}class TerrainWorkerConnection extends Nm.Actor{constructor(e){super("@maptalks/terrain"),this.mapId=e}checkUrl(e){return e&&Yo.isString(e)?Yo.getAbsoluteURL(e):e}fetchTerrain(e,n,i){e=this.checkUrl(e);const o={actorId:this.actorId,mapId:this.mapId,command:"fetchTerrain",params:{url:e,origin:location.origin,terrainWidth:n.terrainWidth,type:n.type,accessToken:n.accessToken,cesiumIonTokenURL:n.cesiumIonTokenURL,error:n.error,colors:n.colors,tileSize:n.tileSize}};this.send(o,null,((e,n)=>{e?i(e):i(e,n)}))}abortTerrain(e,n){this.broadcast({actorId:this.actorId,mapId:this.mapId,command:"abortTerrain",params:{url:e}},null,n)}addLayer(e,n,i){this.broadcast({actorId:this.actorId,mapId:this.mapId,layerId:e,command:"addLayer",params:{}},null,i)}createTerrainMesh(e,n){this.send({actorId:this.actorId,command:"createTerrainMesh",params:e},[e.terrainHeights.data.buffer],((e,i)=>{e?n(e):n(e,i)}))}removeLayer(e,n,i){this.broadcast({mapId:this.mapId,layerId:e,command:"removeLayer"},null,i)}}class Martini{constructor(e=257){this.gridSize=e;const n=e-1;if(n&n-1)throw new Error(`Expected grid size to be 2^n+1, got ${e}.`);this.numTriangles=n*n*2-2,this.numParentTriangles=this.numTriangles-n*n,this.indices=new Uint32Array(this.gridSize*this.gridSize),this.coords=new Uint16Array(4*this.numTriangles);for(let e=0;e<this.numTriangles;e++){let i=e+2,o=0,s=0,a=0,h=0,l=0,c=0;for(1&i?a=h=l=n:o=s=c=n;(i>>=1)>1;){const e=o+a>>1,n=s+h>>1;1&i?(a=o,h=s,o=l,s=c):(o=a,s=h,a=l,h=c),l=e,c=n}const A=4*e;this.coords[A+0]=o,this.coords[A+1]=s,this.coords[A+2]=a,this.coords[A+3]=h}}createTile(e){return new Tile(e,this)}}class Tile{constructor(e,n){const i=n.gridSize;if(e.length!==i*i)throw new Error(`Expected terrain data of length ${i*i} (${i} x ${i}), got ${e.length}.`);this.terrain=e,this.martini=n,this.errors=new Float32Array(e.length),this.update()}update(){const{numTriangles:e,numParentTriangles:n,coords:i,gridSize:o}=this.martini,{terrain:s,errors:a}=this;for(let h=e-1;h>=0;h--){const e=4*h,l=i[e+0],c=i[e+1],A=i[e+2],f=i[e+3],d=l+A>>1,p=c+f>>1,g=d+p-c,v=p+l-d,w=p*o+d,C=Math.abs((s[c*o+l]+s[f*o+A])/2-s[w]);if(a[w]=Math.max(a[w],C),h<n){a[w]=Math.max(a[w],a[(c+v>>1)*o+(l+g>>1)],a[(f+v>>1)*o+(A+g>>1)])}}}getMesh(e=0){const{gridSize:n,indices:i}=this.martini,{errors:o}=this;let s=0,a=0;const h=n-1;function l(h,c,A,f,d,p){const g=h+A>>1,v=c+f>>1;Math.abs(h-d)+Math.abs(c-p)>1&&o[v*n+g]>e?(l(d,p,h,c,g,v),l(A,f,d,p,g,v)):(i[c*n+h]=i[c*n+h]||++s,i[f*n+A]=i[f*n+A]||++s,i[p*n+d]=i[p*n+d]||++s,a++)}i.fill(0),l(0,0,h,h,h,0),l(h,h,0,0,0,h);const c=new Uint16Array(2*s),A=new Uint32Array(3*a);let f=0;function d(s,a,h,l,p,g){const v=s+h>>1,w=a+l>>1;if(Math.abs(s-p)+Math.abs(a-g)>1&&o[w*n+v]>e)d(p,g,s,a,v,w),d(h,l,p,g,v,w);else{const e=i[a*n+s]-1,o=i[l*n+h]-1,d=i[g*n+p]-1;c[2*e]=s,c[2*e+1]=a,c[2*o]=h,c[2*o+1]=l,c[2*d]=p,c[2*d+1]=g,A[f++]=e,A[f++]=o,A[f++]=d}}return d(0,0,h,h,h,0),d(h,h,0,0,0,h),{vertices:c,triangles:A}}getMeshWithSkirts(e=0,n){const{gridSize:i,indices:o}=this.martini,{errors:s}=this;let a=0,h=0;const l=i-1;let c,A,f=0;const d=[],p=[],g=[],v=[];function w(n,C,P,T,S,I){const E=n+P>>1,O=C+T>>1;Math.abs(n-S)+Math.abs(C-I)>1&&s[O*i+E]>e?(w(S,I,n,C,E,O),w(P,T,S,I,E,O)):(c=C*i+n,A=T*i+P,f=I*i+S,0===o[c]&&(0===n?d.push(a):n===l&&p.push(a),0===C?g.push(a):C===l&&v.push(a),o[c]=++a),0===o[A]&&(0===P?d.push(a):P===l&&p.push(a),0===T?g.push(a):T===l&&v.push(a),o[A]=++a),0===o[f]&&(0===S?d.push(a):S===l&&p.push(a),0===I?g.push(a):I===l&&v.push(a),o[f]=++a),h++)}let C;o.fill(0),w(0,0,l,l,l,0),w(l,l,0,0,0,l),C=n?2*(a+3*d.length-2+3*p.length-2+3*g.length-2+3*v.length-2):2*(a+d.length+p.length+g.length+v.length);const P=3*(h+2*(d.length-1)+2*(p.length-1)+2*(g.length-1)+2*(v.length-1)),T=new Uint16Array(C),S=new Uint32Array(P);let I=0;function E(n,a,h,l,c,A){const f=n+h>>1,d=a+l>>1;if(Math.abs(n-c)+Math.abs(a-A)>1&&s[d*i+f]>e)E(c,A,n,a,f,d),E(h,l,c,A,f,d);else{const e=o[a*i+n]-1,s=o[l*i+h]-1,f=o[A*i+c]-1;T[2*e]=n,T[2*e+1]=a,T[2*s]=h,T[2*s+1]=l,T[2*f]=c,T[2*f+1]=A,S[I++]=e,S[I++]=s,S[I++]=f}}E(0,0,l,l,l,0),E(l,l,0,0,0,l),d.sort(((e,n)=>T[2*e+1]-T[2*n+1])),p.sort(((e,n)=>T[2*n+1]-T[2*e+1])),g.sort(((e,n)=>T[2*n]-T[2*e])),v.sort(((e,n)=>T[2*e]-T[2*n]));let O,k,L,F,N=2*a,z=0;function H(e){z=e.length;for(let i=0;i<z-1;i++)O=e[i],k=e[i+1],L=N/2,F=(N+(n?6:2))/2,T[N++]=2*O,T[N++]=2*O+1,n&&(T[N++]=2*O,T[N++]=2*O+1,T[N++]=2*k,T[N++]=2*k+1),n?(S[I++]=L+1,S[I++]=L,S[I++]=L+2,S[I++]=L,S[I++]=F,S[I++]=L+2):(S[I++]=O,S[I++]=L,S[I++]=k,S[I++]=L,S[I++]=F,S[I++]=k);T[N++]=2*e[z-1],T[N++]=2*e[z-1]+1}H(d);const j=N;H(p);const W=N;H(g);const q=N;H(v);return{vertices:T,triangles:S,numVerticesWithoutSkirts:a,numTrianglesWithoutSkirts:h,leftSkirtIndex:j,rightSkirtIndex:W,bottomSkirtIndex:q,topSkirtIndex:N}}}const lO={};function uO(e,n,i,o){let s=lO[i];s||(s=lO[i]=new Martini(i));const a=s.createTile(n).getMeshWithSkirts(e,!0),{triangles:h,vertices:l,leftSkirtIndex:c,rightSkirtIndex:A,bottomSkirtIndex:f,topSkirtIndex:d}=a;let{numVerticesWithoutSkirts:p,numTrianglesWithoutSkirts:g}=a;p||(p=l.legnth/3,g=h.length/3);const v=l.length/2,w=new Float32Array(3*v),C=new Float32Array(2*v);let P=1/0,T=-1/0;const S=i-1;for(let e=0;e<v;e++){const o=l[2*e],s=l[2*e+1];if(e>=p){const n=o/2*3;let i,s=.001;(e-(e<c/2?p:e<A/2?c/2:e<f/2?A/2:f/2))%3==0?(i=0,s=0):i=w[n+2];w[3*e]=w[n],w[3*e+1]=w[n+1],w[3*e+2]=i,C[2*e]=w[n]/S+s,C[2*e+1]=-w[n+1]/S+s}else w[3*e]=1*o,w[3*e+1]=1*-s,w[3*e+2]=n[s*i+o],C[2*e]=o/S,C[2*e+1]=s/S;const a=w[w.length-1];a<P&&(P=a),a>T&&(T=a)}return{positions:w,texcoords:C,triangles:h,leftSkirtIndex:c,rightSkirtIndex:A,bottomSkirtIndex:f,topSkirtIndex:d,numTrianglesWithoutSkirts:g,numVerticesWithoutSkirts:p,minHeight:P,maxHeight:T,terrainWidth:i}}function cO(e,n,i,o,s,a,h,l,c){const A={};for(let f=0;f<c;f++)A[f+""]=fO(e,n,i,o,s,a,h,l,f);return A}const AO=[];function fO(e,n,i,o,s,a,h,l,c){if((o-=c)<=0)return AO;const A=e.getTileSize().width,f=e._getTileOffset(o,s),d=a[0]-f[0],p=f[1]-a[1],g=e._getTileConfig(),v=e.getSpatialReference().getResolution(o),w=g.tileSystem.scale.y,C=1e-7;let P=0,T=0,S=l/=Math.pow(2,c),I=l;if(d<0?S+=Math.ceil(-d/A-C):d>0&&(P-=Math.ceil(d/A-C)),p>0?T-=Math.ceil(p/A-C):p<0&&(I+=Math.ceil(-p/A-C)),0===P&&0===T&&S<=1&&I<=1){const s=Math.floor(n*l);let a=Math.floor(i*l);const c=a;return w!==h&&(a=gO(g,a,v)),[{x:s,y:a,skinY:c,z:o,offset:f,tileSize:A,id:e._getTileId(s,a,o)}]}const E=[];for(let s=P;s<S;s++)for(let a=T;a<I;a++){const c=n*l+s;let d=i*l+a;const p=d;w!==h&&(d=gO(g,d,v)),E.push({x:c,y:d,skinY:p,z:o,offset:f,tileSize:A,id:e._getTileId(c,d,o)})}return E}function dO(e,n,i,o){let s=e/i*o/n;return s<1?(s=1/s,s=1/Math.round(s)):s=Math.round(s),s}function pO(e,n,i){const o=e.getResolution(n),s=n-Math.log(i/o)*Math.LOG2E;return{zoom:s,res:e.getResolution(s)}}function gO(e,n,i){const o=e.fullExtent,s=e.tileSize.width,a=Math.max(o.top,o.bottom),h=Math.min(o.top,o.bottom);return Math.ceil(a/s/i)-1-Math.floor(h/s/i)-n}function mO(e,n){const i=n*n,o=0!==e?new Float32Array(i):new Uint8Array(i);return o.fill(e),{data:o,width:n,height:n,max:e,min:e}}new ee(0,0);const yO=mO(0,5),vO=uO(1,yO.data,yO.width);function _O(e,n,i){const o=i&&i.includes;if(o)for(const s in o)o[s]&&(i[s].uniformDeclares&&n.push(...i[s].uniformDeclares),i[s].defines&&QI(e,i[s].defines))}function xO(e,n){const i=n&&n.includes;if(i)for(const o in i)i[o]&&n[o].renderUniforms&&QI(e,n[o].renderUniforms)}vO.empty=!0;var bO=Object.freeze({__proto__:null,fillIncludes:_O,setIncludeUniformValues:xO});const wO=[],CO=[];class TerrainPainter{constructor(e){this.layer=e,this.regl=e.getRenderer().regl,this.renderer=new PC(this.regl),this._leafScene=new kC;const n=new Uint8Array(16);n.fill(255),this._emptyTileTexture=this.regl.texture({width:2,height:2,data:n}),this._resLoader=new SC(this._emptyTileTexture),this._createEmptyTerrainGeo()}setToRedraw(){this.layer.getRenderer().setToRedraw()}getMap(){return this.layer.getMap()}startFrame(e){e&&e.states&&e.states.includesChanged&&(this.shader.dispose(),delete this.shader),this.shader||this.initShader(e),this._leafScene.clear()}createTerrainMesh(e,n){const{mesh:i,image:o}=n;let s=n.terrainMesh;const{positions:a,texcoords:h,triangles:l,empty:c}=i;if(s&&s.geometry!==this._emptyTerrainGeometry)s.geometry.updateData("aPosition",a),s.geometry.updateData("aTexCoord",h),s.geometry.setElements(l);else{const e=c?this._emptyTerrainGeometry:new Lw({aPosition:a,aTexCoord:h},l,0);s?s.geometry=e:(s=new bC(e,null,{disableVAO:!0}),e.generateBuffers(this.regl))}if(!s.uniforms.skin){const e=this.getEmptyTexture();s.setUniform("skin",e)}return s.setUniform("heightTexture",o),this.prepareMesh(s,e,n),s}_updateMaskDefines(e){const n=this.layer.getRenderer();n&&n.updateMaskDefines(e)}_getPositionMatrix(e){const n=this._getPointZ(100)/100,i=xv(e);return Mv(i,i,[1,1,n]),i}_getLocalTransform(e,n,i){const o=this.getMap(),s=this.layer.getTileSize().width,a=n.res/o.getGLRes(),h=s/(i-1),{extent2d:l,offset:c}=n;$v(wO,(l.xmin-c[0])*a,(n.extent2d.ymax-c[1])*a,0);const A=xv(e);return Pv(A,A,wO),$v(CO,a*h,a*h,1),Mv(A,A,CO),A}prepareMesh(e,n,i){if(!e.isValid())return;const{mesh:o}=i;this._updateMaskDefines(e);const{triangles:s,numTrianglesWithoutSkirts:a,terrainWidth:h}=o;e.localTransform=this._getLocalTransform(e.localTransform||[],n,h),e.positionMatrix=this._getPositionMatrix(e.positionMatrix||[]),e.properties.skirtOffset=3*a,e.properties.skirtCount=s.length-3*a,e.properties.z=n.z,e.properties.minHeight=o.minHeight,e.properties.maxHeight=o.maxHeight,e.properties.terrainWidth=h,e.castShadow=!1,$I(e.uniforms,"minAltitude")||Object.defineProperty(e.uniforms,"minAltitude",{enumerable:!0,get:()=>i.minAltitude||0})}addTerrainImage(e,n){const i=n.terrainMesh;i&&i.geometry&&n.skin&&(i.setUniform("skin",n.skin.color[0]),i.setUniform("polygonOpacity",1),this._leafScene.addMesh(i))}endFrame(e){this.updateIBLDefines(this.shader);let n=0;const i=this.getUniformValues(),o=this._getRenderFBO(e);return this.shader.filter=e&&e.sceneFilter,xO(i,e),n+=this.renderer.render(this.shader,i,this._leafScene,o),n}delete(){this.shader&&(this.shader.dispose(),delete this.shader),this._emptyTileTexture&&(this._emptyTileTexture.destroy(),delete this._emptyTileTexture),this._emptyTerrainGeometry&&(this._emptyTerrainGeometry.dispose(),delete this._emptyTerrainGeometry)}deleteMesh(e){if(!e)return;const n=e.geometry;e.dispose(),n!==this._emptyTerrainGeometry&&n.dispose()}initShader(e){const n=[],i=[],o={},s=[];_O(o,s,e),this.shader=new eP({vert:"#define SHADER_NAME TERRAIN_MESH\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\nuniform float minAltitude;\nuniform mat4 projViewModelMatrix;\nuniform mat4 projMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 positionMatrix;\nuniform float heightScale;\nvarying vec2 vUv;\n#include <mask_vert>\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n    #include <vsm_shadow_vert>\n#endif\nvoid main() {\n    vec4 position = vec4(aPosition.xy, (aPosition.z + minAltitude) * heightScale, 1.0);\n    position = positionMatrix * position;\n    #ifdef HAS_MASK_EXTENT\n        gl_Position = projMatrix * getMaskPosition(position, modelMatrix);\n    #else\n        gl_Position = projViewModelMatrix * position;\n    #endif\n    vUv = aTexCoord;\n    #if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n        shadow_computeShadowPars(position);\n    #endif\n}",frag:"#define SHADER_NAME TERRAIN_MESH\nprecision mediump float;\nuniform sampler2D skin;\nuniform float polygonOpacity;\nvarying vec2 vUv;\n#include <mask_frag>\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n    #include <vsm_shadow_frag>\n#endif\nvoid main() {\n    vec2 uv = vec2(vUv);\n    uv.y = 1.0 - uv.y;\n    vec4 color = texture2D(skin, uv);\n    #if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n        float shadowCoeff = shadow_computeShadow();\n        color.rgb = shadow_blend(color.rgb, shadowCoeff).rgb;\n    #endif\n    gl_FragColor = color * polygonOpacity;\n    #ifdef HAS_MASK_EXTENT\n      gl_FragColor = setMask(gl_FragColor);\n    #endif\n}",uniforms:s.concat([{name:"modelViewMatrix",type:"function",fn:function(e,n){return Cv(i,n.viewMatrix,n.modelMatrix)}},{name:"projViewModelMatrix",type:"function",fn:function(e,i){return Cv(n,i.projViewMatrix,i.modelMatrix)}}]),defines:o,extraCommandProps:this.getExtraCommandProps()})}getExtraCommandProps(){const e=this.layer.getRenderer().canvas;return{viewport:{x:0,y:0,width:()=>e?e.width:1,height:()=>e?e.height:1},stencil:{enable:!1},cull:{enable:!0,face:"back"},depth:{enable:!0,mask:()=>!!this.layer.options.depthMask,func:this.layer.options.depthFunc||"<="},blend:{enable:!0,func:{src:this.layer.options.blendSrc,dst:this.layer.options.blendDst},equation:"add"}}}_getRenderFBO(e){return e&&e.renderTarget&&e.renderTarget.fbo}getUniformValues(){const e=this.getMap(),n=e.projViewMatrix,i=this.layer.getRenderer().getMaskUniforms(),o={viewMatrix:e.viewMatrix,projMatrix:e.projMatrix,projViewMatrix:n,heightScale:1};return QI(o,i),o}_getPointZ(e){const n=this.layer.getMap();if(!n)return null;return n.altitudeToPoint(e,n.getGLRes())}getEmptyTexture(){return this._emptyTileTexture}hasIBL(){const e=this.getMap().getLightManager();return!!(e&&e.getAmbientResource())}updateIBLDefines(e){const n=e.shaderDefines;let i=!1;this.hasIBL()?n[["HAS_IBL_LIGHTING"]]||(n.HAS_IBL_LIGHTING=1,i=!0):n[["HAS_IBL_LIGHTING"]]&&(delete n.HAS_IBL_LIGHTING,i=!0),i&&(e.shaderDefines=n)}_createEmptyTerrainGeo(){const e=vO,{positions:n,texcoords:i,triangles:o}=e;this._emptyTerrainGeometry=new Lw({aPosition:n,aTexCoord:i},o,0),this._emptyTerrainGeometry.generateBuffers(this.regl)}}const{getIBLResOnCanvas:PO,getPBRUniforms:MO,loginIBLResOnCanvas:TO,logoutIBLResOnCanvas:SO}=DT.PBRUtils,IO={baseColorFactor:[1,1,1,1],emissiveFactor:[0,0,0],baseColorIntensity:1,emitColorFactor:1,roughnessFactor:1,metallicFactor:0,emitMultiplicative:1,outputSRGB:1,hsv:[0,0,0],contrast:1,alphaTest:0};class TerrainLitPainter extends TerrainPainter{constructor(...e){super(...e),this.createIBLTextures(),this._matVer=0}updateMaterial(e,n){this._matVer=n,this._material=this._material||{},QI(this._material,e),this.setToRedraw()}setMaterial(e,n){this._matVer=n,this._material=QI({},IO,e),this.setToRedraw()}createIBLTextures(){const e=this.getMap().getRenderer().canvas;TO(e,this.regl,this.getMap()),this.layer.fire("iblupdated")}disposeIBLTextures(){const e=this.getMap().getRenderer().canvas;SO(e,this.getMap())}createTerrainMesh(e,n){const{mesh:i,image:o}=n,{positions:s,texcoords:a,triangles:h,leftSkirtIndex:l,rightSkirtIndex:c,bottomSkirtIndex:A,numVerticesWithoutSkirts:f}=i,d=new Int8Array(s.length);for(let e=2;e<d.length;e+=3)e<3*f?d[e]=1:e<l/2*3?d[e-2]=-1:e<c/2*3?d[e-2]=1:d[e-1]=e<A/2*3?-1:1;const p=new Lw({aPosition:s,aTexCoord:a,aNormal:d},h,0);let g;p.createTangent(),delete p.data.aNormal,p.generateBuffers(this.regl),g=o?this.regl.texture({width:o.width,height:o.height,data:o,min:"linear",mag:"linear"}):this.getEmptyTexture();const v=this.getEmptyTexture(),w=QI({},IO,this.layer.options.material||{});w.skinTexture=v,w.terrainHeightTexture=g;const C=new DT.StandardMaterial(w),P=new bC(p,C);P.properties.matVer=this._matVer;const T=P.defines;return T.HAS_UV_FLIP=1,T.HAS_TERRAIN_NORMAL=1,T.HAS_MAP=1,P.defines=T,P.setUniform("terrainTileResolution",e.res),this.prepareMesh(P,e,n),P}addTerrainImage(e,n){const i=n.terrainMesh;if(i){if(this._material&&i.properties.matVer!==this._matVer){for(const e in this._material)i.material.set(e,this._material[e]);i.properties.matVer=this._matVer}n.skin&&i.material.set("skinTexture",n.skin),i.setUniform("polygonOpacity",1),this._leafScene.addMesh(i)}}getUniformValues(){const e=this.getMap(),n=e.getRenderer().canvas,{iblTexes:i,dfgLUT:o}=PO(n),s=MO(e,i,o),a=this.layer.getTileSize().width,h=this.layer.getRenderer().getMaskUniforms(),l=this._getPointZ(100)/100;return QI(s,{viewMatrix:e.viewMatrix,projMatrix:e.projMatrix,projViewMatrix:e.projViewMatrix,outSize:[n.width,n.height],polygonFill:[1,1,1,1],terrainHeightMapResolution:[a,a],terrainResolution:[n.width,n.height],terrainHeightScale:l,terrainUnpackFactors:[6553.6,25.6,.1,1e4]}),QI(s,h),s}initShader(e){const n={},i=[];_O(n,i,e),this.shader=new DT.StandardShader({uniforms:i,defines:n,extraCommandProps:this.getExtraCommandProps()})}delete(){return this.disposeIBLTextures(),super.delete()}}function EO(e,n,i,o){const s=OO.call(this,i,o);this._projViewMatrix=n;const{colorExtent:a,modeExtent:h}=this._extentPass.render(s,n);this._maskUniforms=this._maskUniforms||{},this._maskUniforms.mask_colorExtent=a,this._maskUniforms.mask_extent=e,this._maskUniforms.mask_modeExtent=h,this._maskUniforms.mask_hasFlatOut=DO.call(this,"flat-outside"),this._maskUniforms.mask_hasClipOut=DO.call(this,"clip-outside"),this._maskUniforms.mask_hasVideo=DO.call(this,"video"),this._maskUniforms.mask_heightRatio=i,this._maskUniforms.mask_heightOffset=o,this.setToRedraw()}function OO(e,n){const i=[],o=this.layer.getMasks();for(let s=0;s<o.length;s++){const a=o[s].getMesh(this.regl,e,n);a&&i.push(a)}return i}function RO(){if(!this._extentPass||!this._maskUniforms)return;const e=OO.call(this,this._maskUniforms.mask_heightRatio,this._maskUniforms.mask_heightOffset);this._extentPass.render(e,this._projViewMatrix);const n=this.layer.getMasks();for(let e=0;e<n.length;e++)"video"===n[e].getMode()&&n[e]._update()}function DO(e){const n=this.layer.getMasks();for(let i=0;i<n.length;i++)if(n[i].getMode()===e)return 1;return 0}function kO(){const e=this.layer.getMasks();if(!e)return!1;for(let n=0;n<e.length;n++)if("video"===e[n].getMode()&&e[n]._needUpdate())return!0;return!1}function LO(e){return class extends e{setMask(e,n,i,o){this.viewport||(this.viewport={x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1}),this._extentPass?EO.call(this,e,n,i,o):this.regl?(this._extentPass=new zP(this.regl,this.viewport),EO.call(this,e,n,i,o)):this.layer.once("contextcreate",(()=>{this._extentPass=new zP(this.regl,this.viewport),EO.call(this,e,n,i,o)}),this)}needToRedraw(){return!!super.needToRedraw()||!!kO.call(this)}getMaskUniforms(){return kO.call(this)&&RO.call(this),this.layer.updateMaskExtent(),this._maskUniforms}getMaskDefines(){return this._maskDefines||(this._maskDefines={}),this._maskUniforms&&this._maskUniforms.mask_colorExtent?this._maskDefines.HAS_MASK_EXTENT=1:delete this._maskDefines.HAS_MASK_EXTENT,this._maskDefines}updateMaskDefines(e){const n=e.getDefines();delete n.HAS_MASK_EXTENT;QI(n,this.getMaskDefines()),e.setDefines(n)}_clearMask(){this._deleteMaskUniforms(),this._extentPass&&(this._extentPass.dispose(),delete this._extentPass),this.setToRedraw()}_deleteMaskUniforms(){delete this._maskUniforms}}}class LRUPool{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){if(this.data){const e=this.data.values();for(const n of e)this.onRemove(n)}return this.data=new Map,this}clear(){this.reset(),delete this.onRemove}add(e,n){return n?(this.has(e)?(this.data.delete(e),this.data.set(e,n)):this.data.set(e,n),this):this}keys(){const e=new Array(this.data.size);let n=0;const i=this.data.keys();for(const o of i)e[n++]=o;return e}has(e){return this.data.has(e)}getAndRemove(e){if(!this.has(e))return null;const n=this.data.get(e);return this.data.delete(e),n}get(e){if(!this.has(e))return null;return this.data.get(e)}pop(){if(this.data.size<this.max)return null;const e=this.data.keys().next();return this.data.get(e.value).current?(this.max+=Math.ceil(this.max/2),null):this.getAndRemove(e.value)}remove(e){if(!this.has(e))return this;const n=this.data.get(e);return this.data.delete(e),this.onRemove(n),this}resetCurrent(e){this.data&&this.data.forEach((n=>{n.current=e}))}}const FO=new ee(0,0),NO=new ee(0,0),zO=new ll(0,0,0,0),BO=new ee(0,0),HO=new ee(20,20),jO={color:[0,0,0,0],depth:1,stencil:0};class TerrainLayerRenderer extends(LO(Mm.TileLayerCanvasRenderer)){isDrawable(){return!0}getTempTileOnLoading(e,n){if(n.image&&!n.image.reset)return n;const i=this._createTerrainFromParent(e);return i.temp=!0,n.image||(n.image=i),delete n.image.reset,n.current=!0,n.info=e,QI(n.image,i),this._createMesh(n.image,e),n}_resetTerrainImage(e,n,i){n.reset=!0,delete n.data,delete n.loadTime,delete n.rendered,delete n.minAltitude;const o=e.id+"-temp",s=n.skinImages;if(s)for(let e=0;e<s.length;e++){const n=s[e];if(n){for(let e=0;e<n.length;e++){const s=n[e];s&&(s.refs.delete(o),s.refs.size||i.push(s))}delete n.currentSkins,delete n.tileIds}}delete n.sourceZoom,delete n.skinImages,delete n.skinStatus,delete n.skinTileIds,n.debugTexture&&(n.debugTexture.destroy(),delete n.debugTexture)}_createTerrainFromParent(e,n){for(n=n||this.findParentTile(e);n&&n.image&&(-1===n.image.sourceZoom||n.image.originalError);)n=this.findParentTile(n.info);const i=(n&&n.info||e).res,o=this.getMap().pointAtResToDistance(1,1,i),s=n&&n.image&&n.image.data&&this._clipParentTerrain(n,e),a=s&&-1!==n.image.sourceZoom?n.info.z:-1;if(!s||s.width<=1){const i=this._findTileMinAltitude(e,n);return{data:mO(i||0,5),minAltitude:i,mesh:vO,sourceZoom:a}}return{data:s,mesh:uO(o,s.data,s.width),sourceZoom:a}}_findTileMinAltitude(e,n){if(n&&n.minAltitude)return n.minAltitude;const{idx:i,idy:o,z:s}=e;for(let e=-1;e<=1;e++)for(let n=-1;n<=1;n++){if(0===e&&0===n)continue;const a=this.layer.getTileId(i+e,o+n,s),h=this.layer.tileInfoCache.get(a);if(h&&h.minAltitude)return h.minAltitude}return 0}consumeTile(e,n){if(e.empty&&!e.mesh){const i=this.findParentTile(n);if(!i||i.image&&i.image.empty){e.mesh=vO;const i=this._findTileMinAltitude(n);e.data=mO(i||0,5),e.minAltitude=i,e.sourceZoom=-1}else e=this._createTerrainFromParent(n,i)}this._createMesh(e,n),super.consumeTile(e,n),this._recenterMapOnTerrain(n)}_createMesh(e,n){if(e&&e.mesh){e.terrainMesh=this._painter.createTerrainMesh(n,e),n.minAltitude=e.data.min,n.maxAltitude=e.data.max,delete e.mesh;const i=this.layer.tileInfoCache;if(i&&n.parent&&!e.empty&&!e.temp){const e=i.get(n.parent);if(e){const{minAltitude:i,maxAltitude:o}=n;(void 0===e.minAltitude||e.minAltitude>i)&&(e.minAltitude=i),(void 0===e.maxAltitude||e.maxAltitude<o)&&(e.maxAltitude=o)}}}}_recenterMapOnTerrain(e){const n=this.getMap();if(n.updateCenterAltitude&&void 0===n.centerAltitude&&e.z===this.getCurrentTileZoom()){const i=n._getPrjCenter(),o=n._prjToPointAtRes(i,e.res,BO);e.extent2d.contains(o)&&n.updateCenterAltitude()}}draw(e,n){this._createPainter(),this._painter.startFrame(n),super.draw(e,n),this._endFrame(n)}drawTile(e,n){const i=this.getMap();if(!e||!i||!n)return;if(!this.drawingCurrentTiles&&!this.drawingChildTiles)return;let o=this.drawingCurrentTiles?this.getTileOpacity(n):1;o*=this.layer.options.opacity||1,this._painter.addTerrainImage(e,n,o)}_drawTiles(e,n,i,o,s,a){const h=[];tE(e,this._getTempTilesForMissed(a,h)),this._newTerrainTileCounter=0;const l=this.layer.getSkinCount(),c=new Set;for(let n=0;n<l;n++)this._renderChildTerrainSkin(n,e,c,h);for(let n=0;n<e.length;n++)this._renderTerrainMeshSkin(e[n].info,e[n].image);for(let e=0;e<h.length;e++)h[e]&&h[e].texture&&!h[e].refs.size&&(this._skinImageCache.delete(h[e].tile.id),this._deleteSkinImage(h[e]));return this._clearCachdeSkinImages(),super._drawTiles(...arguments)}_getTempTilesForMissed(e,n){const i=[];let o=this._tempTilesPool;o||(o=this._tempTilesPool=new LRUPool(this.layer.options.tempTileCacheSize,(e=>{const{info:n,image:i}=e;this._deleteTerrainImage(n,i)}))),o.resetCurrent(!1);for(let s=0;s<e.length;s++){const a=e[s];let h;o.has(a.id)?h=o.getAndRemove(a.id):(h=o.pop(),h?h.image&&(this._resetTerrainImage(h.info,h.image,n),h.image.temp=!0):h={info:a}),h.current=!0,o.add(a.id,h),i.push(h)}for(let n=0;n<e.length;n++)this.getTempTileOnLoading(e[n],i[n]);return i}_clearCachdeSkinImages(){if(!this._skinImageCache)return;const e=this.getCurrentTimestamp();if(this._clearSkinImageTimestamp&&e-this._clearSkinImageTimestamp<1e3)return;const n=new Set;for(const e of this.tileCache.data.values())this._collectSkinImages(e,n);for(const e in this.tilesInView){this._collectSkinImages(this.tilesInView[e],n)}if(this._tempTilesPool)for(const e of this._tempTilesPool.data.values())this._collectSkinImages(e,n);n.size&&(this._skinImageCache.forEach(((e,i)=>{n.has(i)||(console.log("deleted:",i),this._deleteSkinImage(this._skinImageCache.get(i)),this._skinImageCache.delete(i))})),this._clearSkinImageTimestamp=e)}_collectSkinImages(e,n){const i=e.image&&e.image.skinImages;if(i&&i.length)for(let e=0;e<i.length;e++){const o=i[e]&&i.currentSkins;if(o)for(const e of o)n.add(e)}}_renderChildTerrainSkin(e,n,i,o){const s=this.layer.getSkinLayer(e).getRenderer();if(!s)return;const a=[];for(let s=0;s<n.length;s++){const{info:h,image:l}=n[s];if(this._prepareChildTerrainSkin(e,h,l,o)){const o=n[s].image.skinImages[e];for(let e=0;e<o.length;e++){const n=o[e].tile.info.id;i.has(n)||(a.push(o[e]),i.add(n))}}}s.renderTerrainSkin(this.regl,this.layer,a)}_prepareChildTerrainSkin(e,n,i,o){const s=this.getMap();if(delete i.path,!n||!s||!i)return!1;if(!i.terrainMesh)return!1;const a=this.layer.getSkinLayer(e),h=a.getRenderer();if(!h)return!1;i.skinImages||(i.skinImages=[]),i.skinStatus||(i.skinStatus=[]),i.skinTileIds||(i.skinTileIds=[]);const l=h.isAnimating&&h.isAnimating(),c=i.skinStatus[e],A=h.needToRefreshTerrainTileOnZooming&&h.needToRefreshTerrainTileOnZooming(),f=l||A&&i.renderedZoom!==s.getZoom();if(c&&!f)return!1;const d=a.getSpatialReference(),{x:p,y:g,z:v,res:w,offset:C}=n;let P=n.nw;P||(P=n.nw=this.getMap().pointAtResToCoord(n.extent2d.getMin(FO),n.res));const T=this.layer.getTileSize().width,{res:S,zoom:I}=pO(d,v,w),E=dO(S,a.getTileSize().width,w,T);let O=i.skinTileIds[e];if(!O){const n=this.layer._getTileConfig().tileSystem.scale.y;O=i.skinTileIds[e]=cO(a,p,g,I,P,C,n,E,UO)}const k=O[0];let L=!0;const F=[];for(let e=0;e<k.length;e++){const n=h.getCachedTile(k[e],!1);if(n)F.push(n);else{L=!1;const n=h.findParentTile(k[e]);n&&F.push(n)}}const N=i.skinImages[e]||[];N.currentSkins=N.currentSkins||new Set;const z=new Set;let H=!1;for(let e=0;e<N.length;e++){if(!N[e].tile){H=!0;continue}z.add(N[e].tile.info.id)}if(!F.length)return N.currentSkins.clear(),i.skinImages[e]=[],!1;const j=F.length?F.map((e=>e.info.id)).join():F[0].info.id;if(!f&&!H&&N.tileIds===j)return!1;N.tileIds=j;let W=!1;N.currentSkins.clear(),N.length=0;const q=N.currentSkins;let Y=n.id;i.temp&&(Y+="-temp");for(let e=0;e<F.length;e++){const n=F[e].info.id;q.add(n);let i=this._getCachedSkinImage(n);i&&((J=i)&&J.texture)||(i={tile:QI({},F[e]),layer:a,refs:new Set,texture:h.createTerrainTexture(this.regl)},this._saveCachedSkinImage(n,i)),i.refs.add(Y),N.push(i),W=!0}var J;return this._clearPrevSkinImages(n,i,z,q,o),W&&this._newTerrainTileCounter++,i.skinImages[e]=N,a.fire("renderterrainskin",{tile:n,skinTiles:F}),L&&(i.skinStatus[e]=1),!0}_clearPrevSkinImages(e,n,i,o,s){if(!i.size)return;let a=e.id;n.temp&&(a+="-temp");for(const e of i)if(!o||!o.has(e)){const n=this._getCachedSkinImage(e);this._deleteCachedSkinImage(n,a,s)}}_getCachedSkinImage(e){return this._skinImageCache||(this._skinImageCache=new Map),this._skinImageCache.get(e)}_saveCachedSkinImage(e,n){this._skinImageCache.set(e,n)}_renderTerrainMeshSkin(e,n){const i=this.getMap();if(!e||!i||!n)return;const o=n.skinImages,s=this._needRefreshTerrainSkins(n.renderedZoom);if(n.rendered&&!s)return;n.skin?(jO.framebuffer=n.skin,this.regl.clear(jO)):n.skin=this._createTerrainTexture(e,n),this._initSkinShader();const a=this.layer.options.debug,h=[],l=a&&[],c=this.layer.getTileSize().width;if(o)for(let n=0;n<o.length;n++){const i=o[n];for(let n=0;n<i.length;n++){const{tile:o,texture:s,layer:a}=i[n];if((o.info.offset[0]||o.info.offset[1])&&e.skinTileIds){const n=e.skinTileIds[a.getId()];for(let e=0;e<n.length;e++)if(o.info.x===n[e].x&&o.info.y===n[e].y){o.info.offset=n[e].offset;break}}const l=VO(e,o,c),A=i[n].skinMesh||new bC(this._skinGeometry);A.setUniform("skinTexture",s);const f=a.getOpacity();A.setUniform("opacity",XI(f)?1:f),A.setUniform("skinDim",l),A.setUniform("tileSize",c),A.setUniform("x",e.x),A.setUniform("y",e.y),i[n].skinMesh=A,h.push(A)}}if(a){const i=n.skinDebugMesh||new bC(this._skinGeometry);i.setUniform("tileSize",c);const o=n.debugTexture||this._createDebugTexture(e,c);n.debugTexture=o,n.skinDebugMesh=i,i.setUniform("opacity",1),i.setUniform("skinTexture",o),i.setUniform("skinDim",[0,0,1]),i.setUniform("tileSize",c),l.push(i)}if(h.length){this._skinScene.setMeshes(h);try{this.renderer.render(this._skinShader,null,this._skinScene,n.skin)}catch(e){throw console.error(n),e}}l&&l.length&&this.layer.options.debug&&(this._skinScene.setMeshes(l),this.renderer.render(this._skinShader,null,this._skinScene,n.skin)),n.rendered=this._isSkinReady(n),n.renderedZoom=i.getZoom()}_createDebugTexture(e,n){n*=2;const{x:i,y:o,z:s}=e,a=`terrain:${i}/${o}/${s}`,h=document.createElement("canvas");h.width=n,h.height=n;const l=h.getContext("2d");l.font="20px monospace";const c=this.layer.options.debugOutline;return l.fillStyle=c,l.strokeStyle=c,l.fillText(a,20,n-40),l.beginPath(),l.lineWidth=4,l.moveTo(0,0),l.lineTo(n,0),l.lineTo(n,n),l.lineTo(0,n),l.lineTo(0,0),l.stroke(),this.regl.texture({data:h,flipY:!0,mag:"linear",min:"linear"})}_createTerrainTexture(e){const n=this.layer.getTileSize().width,i=2*n,o=2*n,s=this.regl,a=e.colorsTexture;let h;h=a&&a instanceof Uint8Array?s.texture({data:a,min:"linear",mag:"linear",type:"uint8",width:i,height:o,flipY:!0}):s.texture({min:"linear",mag:"linear",type:"uint8",width:i,height:o,flipY:!0});const l=s.framebuffer({width:i,height:o,colors:[h],colorFormat:"rgba",ignoreStatusCheck:!0,depthStencil:!1,depth:!1,stencil:!1});return l.colorTex=h,l}_endFrame(e){this._painter.endFrame(e)&&!Object.keys(this.tilesLoading).length&&this.layer.fire("terrainreadyandrender")}_clipParentTerrain(e,n){const{image:i,info:o}=e,s=i.data,a=s.width,{extent2d:h,res:l}=o,{extent2d:c,res:A}=n,f=h.getWidth(),d=h.getHeight();let p=(c.xmin*A/l-h.xmin)/f*(a-1),g=(h.ymax-c.ymax*A/l)/d*(a-1);let v=Math.round((c.xmax*A/l-h.xmin)/f*(a-1)-p);const w=Math.log2(v);v=Math.pow(2,Math.round(w))+1,p=Math.floor(p),g=Math.floor(g);const C=new Float32Array(v*v);let P=1/0,T=-1/0;for(let e=0;e<v;e++)for(let n=0;n<v;n++){let i=e+p,o=n+g;i>a-1?i=a-1:i<0&&(i=0),o>a-1?o=a-1:o<0&&(o=0);const h=s.data[i+o*a];C[e+n*v]=h,h<P&&(P=h),h>T&&(T=h)}return{width:v,height:v,data:C,min:P,max:T}}getTileOpacity(e){return this._isSkinReady(e)?super.getTileOpacity(e):(this.resetTileLoadTime(e),0)}_isSkinReady(e){const n=this.layer.getSkinCount();if(!n)return!0;if(!e.skinStatus)return!1;for(let i=0;i<n;i++)if(!e.skinStatus[i])return!1;return!0}_needRefreshTerrainSkins(e){const n=this.getMap().getZoom(),i=this.layer.getSkinLayers();for(let o=0;o<i.length;o++){const s=i[o]&&i[o].getRenderer();if(s){if(s.isAnimating&&s.isAnimating())return!0;if(s.needToRefreshTerrainTileOnZooming&&s.needToRefreshTerrainTileOnZooming()&&e!==n)return!0}}return!1}isValidCachedTile(e){return e.image&&!e.image.temp&&(!e.image.skinStatus||this._isSkinReady(e.image))}isTileComplete(e){return e.image&&!e.image.temp&&this._isSkinReady(e.image)}_getTerrainWidth(){const e=this.layer.options;return XI(e.terrainWidth)?e.tileSize+1:e.terrainWidth}_getParentTileRequest(e,n){const i=this.layer.options.maxAvailableZoom-this.layer.options.zoomOffset,o=Math.pow(2,e.z-i),s=Math.floor(e.x/o),a=Math.floor(e.y/o),h=Math.floor(e.idx/o),l=Math.floor(e.idy/o),c=WO(s,a);this._parentRequests||(this._parentRequests={});const A=!this._parentRequests[c];return A&&n&&(this._parentRequests[c]=new Set,this._parentRequests[c].url=this.layer.getTileUrl(s,a,i+this.layer.options.zoomOffset)),{x:s,y:a,idx:h,idy:l,requests:this._parentRequests[c],isFirst:A,key:c}}loadTile(e){const n=this.layer,i=this._getTerrainWidth(),o=n.getSpatialReference().getResolution(e.z);let s=this.getMap().pointAtResToDistance(1,1,o);const a=n.options.maxAvailableZoom&&n.options.maxAvailableZoom-(n.options.zoomOffset||0);if(a&&e.z>a){const i=this._createTerrainFromParent(e);if(-1!==i.sourceZoom)return this.onTileLoad(i,e),i;{const{requests:o,isFirst:h,x:l,y:c,idx:A,idy:f}=this._getParentTileRequest(e,!0);if(o.add(e),!h)return i;const d=e.z-a;s*=Math.pow(2,d);const p=[l,c,a,A,f,e.res*Math.pow(2,d),e.error*Math.pow(2,d)];e=n.createTileNode?n.createTileNode(...p):n._createTileNode(...p)}}const h=e.url,l={},c=n.options,A=n.getTileSize();return this.workerConn.fetchTerrain(h,{terrainWidth:i,type:c.type,accessToken:c.accessToken,cesiumIonTokenURL:c.cesiumIonTokenURL,error:s,colors:c.colors,tileSize:A?[A.width,A.height]:[256,256]},((n,i)=>{if(this._parentRequests){const n=WO(e.x,e.y),i=this._parentRequests[n];if(i&&i.size){this.tileCache.add(e.id,{info:e,image:l});for(const e of i)this.removeTileLoading(e)}delete this._parentRequests[n]}if(n){if(n.canceled)return;return console.warn(n),void this.onTileError(l,e)}Yo.extend(l,i),function(e,n=1){if(XI(n)||!e||!e.mesh||1===n)return;const i=e.mesh.positions;if(i)for(let e=0,o=i.length;e<o;e+=3)i[e+2]*=n}(l,this.layer.options.exaggeration),e.colorsTexture=l.colorsTexture,this.onTileLoad(l,e)})),l}deleteTile(e){if(!e||!e.image)return;super.deleteTile(e);const{info:n,image:i}=e;i.temp||(delete n.skinTileIds,this._deleteTerrainImage(e.info,i))}_deleteTerrainImage(e,n){const i=n.skin;i&&(i.destroy(),i.colorTex.destroy(),delete i.colorTex),n.debugTexture&&(n.debugTexture.destroy(),delete n.debugTexture,n.skinDebugMesh.dispose(),delete n.skinDebugMesh);const o=n.skinImages;if(o&&o.length){let i=e.id;n.temp&&(i+="-temp");for(let e=0;e<o.length;e++){const n=o[e];if(n){for(let e=0;e<n.length;e++){if(!n[e]||!n[e].tile)continue;const o=this._skinImageCache&&this._skinImageCache.get(n[e].tile.info.id);o&&this._deleteCachedSkinImage(o,i)}n.length=0}}}n.terrainMesh&&this._painter.deleteMesh(n.terrainMesh),n.image&&n.image.close&&n.image.close(),delete n.skinImages,delete n.skin,delete n.skinStatus,delete n.skinTileIds,delete n.terrainMesh,delete n.image,delete n.data,delete n.mesh,delete n.rendered}_deleteCachedSkinImage(e,n,i){e&&(e.refs.delete(n),e.refs.size||(i?i.push(e):this._deleteSkinImage(e)))}_deleteSkinImage(e){if(!e||!e.tile)return;const n=e.tile.info.id,i=e.layer.getRenderer();delete e.canvas,delete e.layer,e.refs.clear(),e.texture&&(i?i.deleteTerrainTexture(e.texture):e.texture.destroy&&e.texture.destroy(),delete e.texture),e.skinMesh&&(e.skinMesh.dispose(),delete e.skinMesh),i&&(i.removeTileCache&&i.removeTileCache(n),i.deleteTile&&i.constructor.prototype.deleteTile.call(i,e.tile)),delete e.tile,this._skinImageCache.delete(n)}_clearSkinImageCache(){if(!this._skinImageCache)return;const e=this._skinImageCache.keys();for(const n of e){const e=this._getCachedSkinImage(n);this._deleteSkinImage(e)}this._skinImageCache.clear()}abortTileLoading(e,n){const i=this.layer,o=i.options.maxAvailableZoom&&i.options.maxAvailableZoom-i.options.zoomOffset;if(n)if(o&&n.z>o){const{requests:e,key:i}=this._getParentTileRequest(n);e&&e.size&&(e.delete(n),e.size||(delete this._parentRequests[i],this.workerConn&&this.workerConn.abortTerrain(e.url)))}else n&&n.url&&this.workerConn&&this.workerConn.abortTerrain(n.url);super.abortTileLoading(e,n)}onTileError(e,n){super.onTileError(e,n)}_getTerrainTileAtPrjCoord(e){const n=this.getCurrentTileZoom(),i=this.layer.getSpatialReference().getResolution(n),o=this.layer._getTileConfig().getTileIndex(e,i,this.layer.options.repeatWorld);return o.z=n,o}_queryTerrain(e,n,i,o,s){const a=this.layer.getMinZoom(),h=this._findTerrainData(n,i.x,i.y,i.z,a);if(h&&h.image&&h.image.data){const n=h.info.extent2d,a=h.info.res/s,l=n.ymax*a-o.y,c=this._queryAltitudeInHeights(h.image.data,(o.x-n.xmin*a)/(n.getWidth()*a),l/(n.getHeight()*a));e[0]=c,e[1]=null===c?0:+(h.info.z===i.z)}else e[0]=null,e[1]=0;return e}_findTerrainData(e,n,i,o,s){e||(e=this.layer._getTileId(n,i,o));const a=this.tilesInView[e]||this.tileCache.get(e);return!a&&o-1>=s?this._findTerrainData(null,Math.floor(n/2),Math.floor(i/2),o-1,s):a}_queryAltitudeInHeights(e,n,i){const{width:o,height:s,data:a}=e,h=Math.floor((o-1)*n),l=Math.floor((s-1)*i)*o+h;return void 0===a[l]?null:a[l]}_queryTileAltitude(e,n,i){e||(e={tiles:{},dirty:!0,complete:!1});const o=this.layer,s=this.getCurrentTileZoom(),a=o.getSpatialReference().getResolution(s),{xmin:h,ymin:l,xmax:c,ymax:A}=n,f=o._getTileConfig();FO.set(h,l)._multi(i);const d=f._getTileNum(FO,i,!0);NO.set(c,A)._multi(i);const p=f._getTileNum(NO,i,!0),g=Math.min(d.x,p.x),v=Math.max(d.x,p.x),w=Math.min(d.y,p.y),C=Math.max(d.y,p.y),P=i/a;FO.set(h,l)._multi(P),NO.set(c,A)._multi(P);const T=zO.set(FO.x,FO.y,NO.x,NO.y),S=o.getTileSize().width+1;T._expand(T.getWidth()/S),e.array=e.array||new Float32Array(S*S);const I=e.tiles;e.complete=!0,e.array.fill(0);for(let n=g;n<=v;n++)for(let i=w;i<=C;i++){const o=this.layer._getTileId(n,i,s);if(I[o])continue;const a=this.tileCache.get(o);a?(this._fillAltitudeData(e.array,a,T,S),e.dirty=!0,I[o]=1):(e.dirty=e.dirty||void 0!==e.tiles[o],e.tiles[o]&&delete e.tiles[o],e.complete=!1)}return e}_fillAltitudeData(e,n,i,o){const s=n.info.extent2d,a=s.intersection(i),{xmin:h,ymin:l,xmax:c,ymax:A}=a,{data:f}=n.image,d=f.width,p=i.getWidth()/o,g=Math.floor((h-i.xmin)/p),v=Math.floor((l-i.ymin)/p),w=Math.floor((c-i.xmin)/p)-g,C=Math.floor((A-i.ymin)/p)-v,P=s.getWidth()/d,T=Math.floor((h-s.xmin)/P),S=Math.floor((l-s.ymin)/P),I=Math.floor(p/P);for(let n=0;n<=w;n++)for(let i=0;i<=C;i++){const s=n+g+(v+i)*o;let a=0;for(let e=0;e<I;e++)for(let o=0;o<I;o++){const s=(T+Math.floor(n*I))*d+e+S+Math.floor(i*I)+o;a+=f.data[s]}e[s]=a/Math.max(I,1)}return e}clear(){return this.clearTempResources(),super.clear()}clearTempResources(){this._tempTilesPool&&(this._tempTilesPool.reset(),delete this._tempTilesPool),this._skinImageCache&&this._clearSkinImageCache()}onAdd(){super.onAdd(),this.prepareWorker()}onRemove(){this.workerConn&&(this.workerConn.removeLayer(this.layer.getId(),(e=>{if(e)throw e})),this.workerConn.remove(),delete this.workerConn),this.clearTempResources(),this._skinShader&&(this._skinShader.dispose(),delete this._skinShader),this._skinGeometry&&(this._skinGeometry.dispose(),delete this._skinGeometry),delete this._parentRequests,super.onRemove(),this._painter&&(this._painter.delete(),delete this._painter)}prepareWorker(){const e=this.layer.getMap();this.workerConn||(this.workerConn=new TerrainWorkerConnection(e.id));const n=this.workerConn;if(!n.isActive())return;const i=this.layer.options||{},o=this.layer.getId();n.addLayer(o,i,(e=>{if(e)throw e;this.layer&&(this.ready=!0,this.setToRedraw(),this.layer.fire("workerready"))}))}createContext(){this.canvas.gl&&this.canvas.gl.wrap?(this.gl=this.canvas.gl.wrap(),this.regl=this.canvas.gl.regl):this._createREGLContext(),this.renderer=new PC(this.regl),this.layer.fire("contextcreate",{regl:this.regl})}_createPainter(){const e=this._painter;"lit"===this.layer.options.shader||"pbr"===this.layer.options.shader?(e&&e.constructor===TerrainPainter||!e)&&(e&&(e.delete(),this.clear(),this.setToRedraw()),this._painter=new TerrainLitPainter(this.layer),this.layer.fire("paintercreated")):(e&&e.constructor===TerrainLitPainter||!e)&&(e&&(e.delete(),this.clear(),this.setToRedraw()),this._painter=new TerrainPainter(this.layer),this.layer.fire("paintercreated"))}_createREGLContext(){const e=this.layer,n=e.options.glOptions||{alpha:!0,depth:!0,antialias:this.layer.options.antialias};n.preserveDrawingBuffer=!0,n.stencil=!0,this.glOptions=n,this.gl=this.gl||this._createGLContext(this.canvas,n),this.regl=Hm.createREGL({gl:this.gl,attributes:n,extensions:["OES_element_index_uint"],optionalExtensions:e.options.glExtensions})}_createGLContext(e,n){const i=["webgl","experimental-webgl"];let o=null;for(let s=0;s<i.length;++s){try{o=e.getContext(i[s],n)}catch(e){}if(o)break}return o}resizeCanvas(e){this.canvas&&super.resizeCanvas(e)}clearCanvas(){this.canvas&&super.clearCanvas()}_initSkinShader(){if(this._skinShader)return;const e=this.layer.getTileSize().width;this._skinShader=new eP({vert:"#define SHADER_NAME TERRAIN_SKIN\nattribute vec2 aPosition;\nvoid main() {\n    gl_Position = vec4(aPosition, 0.0, 1.0);\n}",frag:"#define SHADER_NAME TERRAIN_SKIN\nprecision mediump float;\nuniform float tileSize;\nuniform sampler2D skinTexture;\nuniform vec3 skinDim;\nuniform float opacity;\nvoid main() {\n    vec2 fragCoord = gl_FragCoord.xy / 2.0;\n    vec2 resolution = vec2(tileSize);\n    vec2 uv = (fragCoord - skinDim.xy) /  (resolution * skinDim.z);\n    if (uv.x >= 0.0 && uv.x <= 1.0 && uv.y >= 0.0 && uv.y <= 1.0) {\n        gl_FragColor = texture2D(skinTexture, uv) * opacity;\n    } else {\n        gl_FragColor = vec4(0.0);\n    }\n}",extraCommandProps:{cull:{enable:!1},viewport:{x:0,y:0,width:2*e,height:2*e},depth:{enable:!1},stencil:{enable:!1},blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"}}});const n=new Int8Array([-1,-1,1,1,-1,1,1,1,-1,-1,1,-1]);this._skinGeometry=this._skinGeometry||new Lw({aPosition:n},0,6,{positionSize:2}),this._skinGeometry.generateBuffers(this.regl),this._skinScene=this._skinScene||new kC}updateMaterial(e){this._painter&&e&&this._painter.updateMaterial&&(void 0===this._matVer&&(this._matVer=1),this._painter.updateMaterial(e,this._matVer++))}setMaterial(e){this._painter&&e&&this._painter.setMaterial&&(void 0===this._matVer&&(this._matVer=1),this._painter.setMaterial(e,this._matVer++))}getAnalysisMeshes(){return this._painter&&this._painter._leafScene?this._painter._leafScene.getMeshes():[]}}const UO=1;function GO(e,n,i,o,s,a,h,l,c=0){e.font="20px monospace",e.fillStyle=i,HO.y=l-30,e.globalAlpha=1,e.fillText(n,HO.x+s,HO.y+a+c),e.globalAlpha=.6,e.strokeStyle=i,e.lineWidth=o,e.beginPath(),e.moveTo(s,a),e.lineTo(s+h,a),e.lineTo(s+h,a+l),e.lineTo(s,a+l),e.lineTo(s,a),e.stroke(),e.globalAlpha=1}function VO(e,n,i){const{res:o,extent2d:s,offset:a}=e,{info:h}=n,l=h.res/o,c=h.offset;return[h.extent2d.xmin*l-s.xmin+(a[0]-c[0]),-(s.ymin-h.extent2d.ymin*l+(c[1]-a[1])),l*h.tileSize/i]}function WO(e,n){return e+"-"+n}Mm.TileLayerCanvasRenderer.include({renderTerrainSkin(e,n,i){const o=this.layer.getTileSize().width,s=n.options.debug;for(let e=0;e<i.length;e++){const{tile:n,texture:a}=i[e];if(!n.image)continue;const h=document.createElement("canvas");i[e].canvas=h,h.width=o,h.height=o;const l=h.getContext("2d");if(l.drawImage(n.image,0,0),s){const{x:e,y:i,z:s}=n.info;GO(l,`${e}/${i}/${s}`,"yellow",1,0,0,o,o,-18)}a({data:h,width:o,height:o,flipY:!0,min:"linear mipmap linear",mag:"linear"})}},createTerrainTexture(e){const n=this.layer.getTileSize().width;return e.texture({width:n,height:n,flipY:!0,min:"linear mipmap linear",mag:"linear",depthStencil:!1,depth:!1,stencil:!1})},deleteTerrainTexture(e){e.destroy()}});const qO={"clip-inside":.1,"clip-outside":.2,"flat-inside":.3,"flat-outside":.4,color:.5,video:.6,elevate:.7},ZO=[],QO=[1,1,1],XO={polygonFill:[255,0,0],polygonOpacity:.8},YO=new Zh(0,0),JO=new Zh(0,0),KO=[],$O=new Zh(0,0),tR=new ee(0,0),eR=new ee(0,0),nR=new ee(0,0);class Mask extends Af{getMode(){return this._mode}remove(){const e=this.getLayer();return e?(e.removeMask(this),this._dispose(),super.remove(),this):this}getMesh(e,n,i){return this.isVisible()?(this._mesh||(this._mesh=this._createMesh(e,n,i)),this._updateUniforms(this._mesh,n,i),this._mesh):null}_createGeometry(e){const n=this.getMap(),i=this.toGeoJSON(),o=OT.flatten(i.geometry.coordinates),s=o.dimensions;for(let e=0;e<o.vertices.length;e+=s){$O.x=o.vertices[e],$O.y=o.vertices[e+1];const i=rE(n,$O);o.vertices[e]=i[0],o.vertices[e+1]=i[1]}const a=rE(n,this.getCenter()),h=[],l="video"===this.getMode()?4:o.vertices.length/s;for(let e=0;e<l;e++)h.push(o.vertices[e*s]-a[0]),h.push(o.vertices[e*s+1]-a[1]),h.push(0);const c=OT(h,o.holes,3),A=new Lw({POSITION:h,TEXCOORD:this._createTexcoords(o.vertices,s)},c,0,{positionAttribute:"POSITION",uv0Attribute:"TEXCOORD"});return A.generateBuffers(e),A}_createTexcoords(e,n){const i=[0,0,1,0,1,1,0,1];if(this.hasHoles()){const o=e.length/n*2;for(let e=i.length/2-1;e<o;e+=2)i[e]=i[e+1]=0}return i}clearMesh(){this._dispose(),delete this._mesh,this.maskGeoJSON&&(this.maskGeoJSON=null)}_getMaskMode(){return qO[this._mode]}_getMaskColor(){const e=this.getSymbol(),{polygonFill:n,polygonOpacity:i}=e||XO,o=nE([],n);return o[0]/=255,o[1]/=255,o[2]/=255,o[3]=YI(i)?i:XO.polygonOpacity,o}_altitudeToPoint(e=0){const n=this.getMap(),i=n.getGLRes();return n.altitudeToPoint(e,i)}_setLocalTransform(e){const n=rE(this.getMap(),this.getCenter()),i=zv(e.localTransform,nx(ZO),n,QO);e.localTransform=i}_dispose(){this._mesh&&(this._mesh.material&&this._mesh.material.dispose(),this._mesh.geometry&&this._mesh.geometry.dispose(),this._mesh.dispose(),delete this._mesh)}containsPoint(e){const n=this.getExtent();if($O.set(e[0],e[1]),!n||!n.contains($O))return!1;const i=this.getHoles();for(let n=0;n<i.length;n++)if(this._contains(i[n],e))return!1;const o=this.getShell();return this._contains(o,e)}_contains(e,n){const i=this._calArea(e);let o=0;for(let i=0;i<e.length;i++){YO.x=e[i].x,YO.y=e[i].y;const s=i+1>=e.length?0:i+1;JO.x=e[s].x,JO.y=e[s].y,$O.x=n[0],$O.y=n[1],KO[0]=$O,KO[1]=YO,KO[2]=JO;o+=this._calArea(KO)}return!(Math.abs(o-i)>1e-8)}_calArea(e){const n=this.getMap();let i=0;const o=n.getGLRes(),s=n.coordToPointAtRes(e[0],o,tR);for(let c=1;c<e.length-1;c++){const A=n.coordToPointAtRes(e[c],o,eR),f=n.coordToPointAtRes(e[c+1],o,nR);i+=Math.abs(((h=A).x-(a=s).x)*((l=f).y-a.y)-(h.y-a.y)*(l.x-a.x))/2}var a,h,l;return i}}const iR=["shapechange","heightrangechange","flatheightchange"],rR=new Zh(0,0),oR=[0,0,0],sR=[0,0,0];function aR(){return this._maskList?(this._maskList.forEach((e=>{e.remove()})),this._maskList=[],this.updateMaskExtent("shapechange"),this):this}function hR(e){const n=this.getMap(),i=n.getView(),o=n.getFitZoom(e),s=e.getCenter();n.setView({center:s,zoom:o,pitch:0,bearing:0});const a=n.getExtent(),h=_v([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n.projViewMatrix);return n.setView(i),{mapExtent:a,projViewMatrix:h}}function lR(){for(let e=0;e<this._maskList.length;e++)if(this._maskList[e].isVisible())return!0;return!1}function uR(e){return class MaskLayerMixin extends e{removeMask(e){if(!this._maskList)return this;if(!e)return aR.call(this),this;const n=Array.isArray(e)?e:[e];for(let e=0;e<n.length;e++){const i=this._maskList.indexOf(n[e]);i>-1&&this._maskList.splice(i,1)}return this.updateMaskExtent("shapechange"),this.fire("removemask",{masks:e}),this}setMask(e){return this.removeMask(null),this._maskList||(this._maskList=[]),Array.isArray(e)?e.forEach((e=>{this._maskList.push(e)})):this._maskList.push(e),this._maskList.forEach((e=>{e._bindLayer(this),e._updateCoordinates&&e._updateCoordinates()})),this.updateMaskExtent("shapechange"),this.fire("setmask",{masks:e}),this}onAdd(){super.onAdd(),this.updateMaskExtent("shapechange")}getMasks(){return this._maskList||[]}onGeometryEvent(e){if(!e||!e.target)return;const n=e.type;"shapechange"===n&&e.target instanceof Mask&&e.target.clearMesh(),e.target instanceof Mask&&iR.indexOf(n)>-1&&this.updateMaskExtent(n),super.onGeometryEvent&&super.onGeometryEvent(e)}identifyMask(e,n){if(!this.getMap())return[];if(!this._maskList||!this._maskList.length)return[];const i=QI({},n);i.excludeMasks=!0;const o=this.identifyAtPoint(e,i),s=o.length&&o[0].coordinate;if(s){const e=this._maskList;if(!e)return[];const n=[];for(let i=0;i<e.length;i++){const o=e[i].getMode();!e[i].containsPoint(s)||"color"!==o&&"video"!==o||n.push(e[i])}return n}return[]}remove(){this._maskList&&this._maskList.length&&this._maskList.forEach((e=>{e.remove()})),super.remove()}updateMask(e){const n=this.getMap(),{projViewMatrix:i,mapExtent:o}=hR.call(this,e);rR.x=o.xmin,rR.y=o.ymin;const s=cR(oR,rR,n);rR.x=o.xmax,rR.y=o.ymax;const a=cR(sR,rR,n);return{projViewMatrix:i,extentInWorld:[s[0],s[1],a[0],a[1]]}}updateMaskExtent(e){if(!this._maskList)return;if(!this.getMap())return;const n=this.getRenderer();if(n&&!this._maskList.length)return void n._clearMask();if(n&&!lR.call(this))return n._deleteMaskUniforms(),void n.setToRedraw();const i=this.getMaskExtent();if(!i)return;const{extent:o,ratio:s,minHeight:a}=i;if(e||!this._maskProjViewMatrix||!this._maskExtentInWorld){const{projViewMatrix:e,extentInWorld:n}=this.updateMask(o);this._maskProjViewMatrix=e,this._maskExtentInWorld=n}n?n.setMask(this._maskExtentInWorld,this._maskProjViewMatrix,s,a):this.once("renderercreate",(e=>{e.renderer.setMask(this._maskExtentInWorld,this._maskProjViewMatrix,s,a)}))}getMaskExtent(){let e=1/0,n=1/0,i=-1/0,o=-1/0,s=-1/0,a=1/0,h=!1;const l=this.getMap().getExtent();for(let c=0;c<this._maskList.length;c++){const A=this._maskList[c];if(!A.isVisible())continue;const f=A.getExtent();if(f&&l.intersects(f)&&(h=!0,f.xmin<e&&(e=f.xmin),f.ymin<n&&(n=f.ymin),f.xmax>i&&(i=f.xmax),f.ymax>o&&(o=f.ymax),A._getHeightRange)){const e=A._getHeightRange();e[0]<a&&(a=e[0]),e[1]>s&&(s=e[1])}}if(!h)return null;const{ratio:c,minHeight:A}=function(e,n){const i=e===1/0?0:e,o=Math.abs((n===-1/0?0:n)-i);return 0===o?{ratio:1,minHeight:0}:{ratio:Math.pow(o,-1),minHeight:i}}(a,s);return{extent:new al(e,n,i,o),ratio:c,minHeight:A}}}}function cR(e,n,i,o=0){if(!(i&&n instanceof Zh))return null;const s=i.coordinateToPointAtRes(n,i.getGLRes());return e[0]=s.x,e[1]=s.y,e[2]=o,e}const AR=new Zh(0,0),fR=new Zh(0,0),dR=new ee(0,0),pR=[],gR={tileGrids:[],count:0},mR="01",yR="1";class TerrainLayer extends(uR(Qp)){constructor(e,n){n&&!n.tileSystem&&("cesium"===n.type||"cesium-ion"===n.type?n.tileSystem=[1,1,-180,-90]:"tianditu"===n.type&&(n.tileSystem=[1,-1,-180,90])),super(e,n)}getTileUrl(e,n,i){let o=super.getTileUrl(e,n,i);return"mapbox"===this.options.type&&this.options.requireSkuToken&&(this._skuToken||(this._skuToken=this._createSkuToken()),o.indexOf("?")>-1?o+="&sku="+this._skuToken:o+="?sku="+this._skuToken),o}getMaxAvailableZoom(){return this.getSpatialReference().getMaxZoom()}_createSkuToken(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return[yR,mR,e].join("")}setSkinLayers(e){this._skinLayers=e;const n=this.getRenderer();n&&(n.clear(),n.setToRedraw())}getSkinTiles(e){const n=this.getRenderer();if(!n)return gR;const i=n.getTileGridsInCurrentFrame().tileGrids[0];if(!i)return gR;const o=e.getId(),s=this._getTileConfig().tileSystem.scale,a=e.getTileSize().width,h=i.tiles;if(!h.length)return gR;const l=this.getMap(),c=i.parents||pR,A=c.length,f=c.concat(h),d=e.getSpatialReference(),p=h[0].extent2d.getWidth(),g=s.x,v=s.y,w=[],C=[],P=new Set,T=this._getTileConfig().tileSystem.scale.y;for(let n=0;n<f.length;n++){const i=f[n],{res:s}=i;let h=i.nw;h||(h=i.nw=l.pointAtResToCoord(i.extent2d.getMin(dR),i.res));const{res:c,zoom:S}=pO(d,i.z,s),I=c/s,E=dO(c,a,s,p),{extent2d:O,offset:k}=i,L=E*i.x,F=E*i.y;if(i.skinTileIds||(i.skinTileIds={}),!i.skinTileIds[o]){const n=new Set,s=[],l=fO(e,i.x,i.y,S,h,k,v,E,0);for(let i=0;i<l.length;i++){const o=l[i];if(n.has(o.id))continue;o.idx=o.x,o.idy=o.y,o.res=c,o.url=e.getTileUrl(o.x,o.y,o.z+e.options.zoomOffset);const h=v*(o.skinY-F)*a,A=O.xmin*I+g*(o.x-L)*a,f=O.ymax*I+h,d=O.ymin*I+h;o.extent2d=T>0?new ll(A,d,A+a,d+a):new ll(A,f-a,A+a,f),n.add(o.id),s.push(o)}i.skinTileIds[o]=s}const N=i.skinTileIds[o];for(let e=0;e<N.length;e++)P.has(N[e].id)||(n<A?w.push(N[e]):C.push(N[e]),P.add(N[e].id))}return{tileGrids:[{extent:i.extent,tiles:C,parents:w,count:C.length}],count:C.length}}getSkinLayer(e){return this.getSkinLayers()[e]}getSkinLayers(){return this._skinLayers||pR}getSkinCount(){return this._skinLayers&&this._skinLayers.length||0}queryTerrainByProjCoord(e,n){n=n||[];const i=this.getRenderer();if(!i)return n[0]=null,n[1]=0,n;const o=this.getMap(),s=i._getTerrainTileAtPrjCoord(e);if(!s)return n[0]=null,n[1]=0,n;const a=o._prjToPointAtRes(e,1,dR);return i._queryTerrain(n,s.id,s,a,1)}queryTileTerrainByProjCoord(e,n,i,o){o=o||[];const s=this.getRenderer();if(!s)return o[0]=null,o[1]=0,o;const a=this.getMap()._prjToPointAtRes(e,1,dR);return s._queryTerrain(o,n,i,a,1)}queryTileTerrainByPointAtRes(e,n,i,o,s){s=s||[];const a=this.getRenderer();return a?a._queryTerrain(s,i,o,e,n):(s[0]=null,s[1]=0,s)}queryTerrain(e,n){n=n||[];if(!this.getRenderer())return n[0]=null,n[1]=0,n;const i=this.getMap().getProjection().project(e,AR);return this.queryTerrainByProjCoord(i,n)}queryTileMesh(e,n){const i=this.getRenderer();i&&i._queryTileMesh(e,n)}getTerrainTiles(e){const{x:n,y:i,z:o,res:s,offset:a}=e,h=e.extent2d.getWidth(),l=this._getTileConfig(),c=this.getSpatialReference(),{res:A,zoom:f}=pO(c,o,s),d=this.getTileSize().width,p=dO(A,d,s,h);let g=e.nw;g||(g=e.nw=this.getMap().pointAtResToCoord(e.extent2d.getMin(dR),e.res));const v=cO(this,n,i,f,g,a,l.tileSystem.scale.y,p,1)[0];for(let e=0;e<v.length;e++){const{x:n,y:i}=v[e],o=l.getTilePointNW(n,i,A,dR);v[e].res=A,v[e].extent2d=new ll(o.x,o.y,o.x+d,o.y-d)}return v}isTerrainTileLoaded(e){const n=this.getRenderer();return!!n&&n.isTileCached(e)}updateMaterial(e){if(!e)return;this.options.material||(this.options.material={}),QI(this.options.material,e);const n=this.getRenderer();n&&n.updateMaterial(e)}setMaterial(e){if(!e)return;this.options.material=e;const n=this.getRenderer();n&&n.setMaterial(e)}_createTileNode(e,n,i,o,s,a,h,l,c,A){const f=this.getMap(),d=this.options.zoomOffset;if(!c){c=this._getTileConfig().getTilePrjExtent(e,n,a).convertTo((e=>f._prjToPointAtRes(e,a,fR)))}const p=this._getTileOffset(i);return{parent:l,layer:this.getId(),x:e,y:n,z:i,idx:o,idy:s,res:a,extent2d:c,id:A||this._getTileId(e,n,i),url:this.getTileUrl(e,n,i+d),offset:p,error:h,children:[]}}}TerrainLayer.mergeOptions({forceRenderOnMoving:!0,forceRenderOnZooming:!0,forceRenderOnRotating:!0,fadeAnimation:!1,fadeDuration:1e3/60*15,tileLimitPerFrame:2,newTerrainTileRenderLimitPerFrameOnInteracting:1,opacity:1,renderer:"gl",pyramidMode:1,tileSize:256,terrainWidth:65,backZoomOffset:0,depthMask:!0,blendSrc:"one",blendDst:"one minus src alpha",requireSkuToken:!0,cesiumIonTokenURL:"https://api.cesium.com/v1/assets/1/endpoint?access_token=",tileRetryCount:0,shader:"default",terrainTileMode:!0,tempTileCacheSize:64,tileStackStartDepth:7,tileStackDepth:6,currentTilesFirst:!1,exaggeration:1,colors:[]}),TerrainLayer.registerJSONType("TerrainLayer"),TerrainLayer.registerRenderer("gl",TerrainLayerRenderer);const vR=[],_R=[],xR=[],bR=[],wR=new ee(0,0),CR=[],PR=[],MR=[],TR=[],SR=[],IR=[],ER=[],OR=[],RR=[];class RayCaster{constructor(e,n,i=!0){this._from=e,this._to=n,this._isLngLat=i}setFromPoint(e){this._from=Array.isArray(e)?new Zh(e):e}setToPoint(e){this._to=Array.isArray(e)?new Zh(e):e}test(e,n,i={}){const o=i.count||0,s=[];let a=this._from,h=this._to;this._isLngLat&&(a=kR(n,this._from.x,this._from.y,this._from.z),h=kR(n,this._to.x,this._to.y,this._to.z));const l=new Qs.Ray(a,h);for(let i=0;i<e.length;i++){const a=e[i];if(!this._checkBBox(a.getBoundingBox(),l))continue;const h=a.localTransform,c=a.geometry,A=c.data[c.desc.positionAttribute].array,f=c.data[c.desc.altitudeAttribute]&&c.data[c.desc.altitudeAttribute].array||CR,d=c.indices;if(!(A&&A.length&&d&&d.length))continue;const p=Cv(TR,h,a.positionMatrix),g=this._testMesh(a,l,n,A,f,d,c.desc.positionSize,p,o);if(g){if(s.push({mesh:a,coordinates:g}),0!==o&&s.length>=o)break}}return s}_testMesh(e,n,i,o,s,a,h,l,c){const A=[];for(let f=0;f<a.length&&!(f>e.properties.skirtOffset);f+=3){const e=a[f],d=a[f+1],p=a[f+2],g=$v(SR,o[e*h],o[e*h+1],o[e*h+2]),v=this._toWorldPosition(_R,i,g,s[e]/100,l),w=$v(IR,o[d*h],o[d*h+1],o[d*h+2]),C=this._toWorldPosition(xR,i,w,s[d]/100,l),P=$v(ER,o[p*h],o[p*h+1],o[p*h+2]),T=this._toWorldPosition(bR,i,P,s[p]/100,l),S=$v(vR,v,C,T),I=m_(PR,v,C),E=m_(MR,v,T),O=this._testIntersection(OR,S,n);if(O){const n=i.pointAtResToAltitude(O[2],i.getGLRes());wR.x=O[0],wR.y=O[1];const o=i.pointAtResToCoordinate(wR,i.getGLRes());if(o.z=n,A.push({coordinate:o,indices:[e,d,p],normal:c_([],I,E)}),0!==c&&A.length>=c)break}}return A.length?A:null}_toWorldPosition(e,n,i,o,s){let a;return Yo.isNumber(o)?(a=n.altitudeToPoint(o,n.getGLRes()),E_(e,i[0],i[1],0,1),G_(e,e,s),e[2]=a):(E_(e,i[0],i[1],i[2],1),G_(e,e,s)),e}_testIntersection(e,n,i){return i.intersectTriangle(n[0],n[1],n[2],!0,e)}_checkBBox(e,n){return!!e&&n.intersectBox(e,RR)}}const DR=new Zh(0,0);function kR(e,n,i,o){if(!e)return null;DR.set(n,i);const s=e.coordinateToPointAtRes(DR,e.getGLRes()),a=e.altitudeToPoint(o||0,e.getGLRes());return[s.x,s.y,a]}const LR=()=>{},FR=new Zh(0,0),NR=[0,0,0],zR=[0,0,0],BR=[0,0,0];class GroupGLLayer extends RA{static fromJSON(e){if(!e||"GroupGLLayer"!==e.type)return null;const n=e.layers.map((e=>RA.fromJSON(e)));return new GroupGLLayer(e.id,n,e.options)}constructor(e,n,i){super(e,i),this.layers=n&&n.slice()||[],this.layers.forEach((e=>{if(e.getMap())throw new Error(`layer(${e.getId()} is already added on map`)})),this._checkChildren(),this.sortLayersByZIndex(),this._layerMap={}}sortLayersByZIndex(){if(this.layers&&this.layers.length){for(let e=0,n=this.layers.length;e<n;e++)this.layers[e].__group_gl_order=e;this.layers.sort(jR)}}setSceneConfig(e){this.options.sceneConfig=e;const n=this.getRenderer();return n&&n.updateSceneConfig(),this}getSceneConfig(){return JSON.parse(JSON.stringify(this._getSceneConfig()))}_getSceneConfig(){return this.options.sceneConfig||{}}getGroundConfig(){return this._getSceneConfig().ground}getWeatherConfig(){return this._getSceneConfig().weather}addLayer(e,n){if(e.getMap())throw new Error(`layer(${e.getId()}) is already added on map`);if("gl"!==e.options.renderer)throw new Error(`layer(${e.getId()})'s renderer is canvas, not supported to be added to GroupGLLayer`);void 0===n?this.layers.push(e):this.layers.splice(n,0,e),this._checkChildren(),this.sortLayersByZIndex();const i=this.getRenderer();return i?(this._prepareLayer(e),this._updateTerrainSkinLayers(),i.setToRedraw(),this):this}removeLayer(e){Yo.isString(e)&&(e=this.getChildLayer(e));const n=this.layers.indexOf(e);if(n<0)return this;const i=e.getRenderer();i&&i.setTerrainHelper&&i.setTerrainHelper(null),e._doRemove(),this._unbindChildListeners(e),delete this._layerMap[e.getId()],this.layers.splice(n,1);const o=this.getRenderer();return o?(this._updateTerrainSkinLayers(),o.setToRedraw(),this):this}clearLayers(){const e=this.getLayers();for(let n=0;n<e.length;n++)e[n]&&e[n].remove();return this}_updatePolygonOffset(){let e=0;for(let n=0;n<this.layers.length;n++){const i=this.layers[n];i.setPolygonOffset&&i.getPolygonOffsetCount&&(e+=i.getPolygonOffsetCount())}let n=0;for(let i=this.layers.length-1;i>=0;i--){const o=this.layers[i];o.setPolygonOffset&&o.getPolygonOffsetCount&&(o.setPolygonOffset(n,e),n+=o.getPolygonOffsetCount())}this._polygonOffset=n}getPolygonOffsetCount(){return this._polygonOffset}getLayers(){return this.layers.slice()}_getLayers(){return this.layers}toJSON(){const e=[];if(this.layers)for(let n=0;n<this.layers.length;n++){const i=this.layers[n];i&&(i&&i.toJSON&&e.push(i.toJSON()))}return{type:this.getJSONType(),id:this.getId(),layers:e,options:this.config()}}onLoadEnd(){this.layers.forEach((e=>{this._prepareLayer(e)})),this.options.terrain&&this._initTerrainLayer(),super.onLoadEnd()}_prepareLayer(e){const n=this.getMap();this._layerMap[e.getId()]=e,e._canvas=this.getRenderer().canvas,e._bindMap(n),e.once("renderercreate",this._onChildRendererCreate,this),e.remove=()=>(this.removeLayer(e),e.constructor.prototype.remove.call(e),delete e.remove,this),e.load(),this._bindChildListeners(e)}onRemove(){this._removeTerrainLayer(),this.layers.forEach((e=>{this._resetSkinLayer(e),e._doRemove(),this._unbindChildListeners(e)})),this._layerMap={},this.clearAnalysis(),super.onRemove()}getChildLayer(e){return this._layerMap[e]||null}getLayer(e){return this.getChildLayer(e)}_bindChildListeners(e){e.on("show hide",this._onLayerShowHide,this),e.on("idchange",this._onLayerIDChange,this)}_unbindChildListeners(e){e.off("show hide",this._onLayerShowHide,this),e.off("idchange",this._onLayerIDChange,this)}_onLayerShowHide(){const e=this.getRenderer();e&&e.setToRedraw()}_onLayerIDChange(e){const n=e.new,i=e.old,o=this.getLayer(i);delete this._layerMap[i],this._layerMap[n]=o}_onChildRendererCreate(e){e.renderer.clearCanvas=HR}_checkChildren(){const e={};this.layers.forEach((n=>{const i=n.getId();if(e[i])throw new Error(`Duplicate child layer id (${i}) in the GroupGLLayer (${this.getId()})`);e[i]=1}))}addAnalysis(e){this._analysisTaskList=this._analysisTaskList||[],this._analysisTaskList.push(e);const n=this.getRenderer();n&&n.setToRedraw()}removeAnalysis(e){if(this._analysisTaskList){const n=this._analysisTaskList.indexOf(e);n>-1&&(this._analysisTaskList.splice(n,1),e.remove())}const n=this.getRenderer();n&&n.setToRedraw()}clearAnalysis(){this._analysisTaskList&&(this._analysisTaskList.forEach((e=>{e.remove()})),this._analysisTaskList=[]);const e=this.getRenderer();e&&e.setToRedraw()}identify(e,n){const i=this.getMap(),o=this.getRenderer();if(!i||!o)return[];const s=i.coordToContainerPoint(new Zh(e));return this.identifyAtPoint(s,n)}identifyAtPoint(e,n={}){const i=n.includeInternals,o=this.getLayers(),s=n&&n.childLayers||o,a=this.getMap();if(!a)return[];const h=XI(n.count)?1:n.count;let l=[];for(let a=s.length-1;a>=0;a--){const h=s[a];if(o.indexOf(h)<0||!h.identifyAtPoint)continue;const c=h.options.geometryEvents;if(i&&(void 0===c||!1===c||0===c))continue;if(h.isGeometryListening&&i&&n.eventTypes.indexOf("mousemove")>=0&&!h.isGeometryListening(n.eventTypes))continue;const A=h.identifyAtPoint(e,n);if(!A||!A.length)continue;const f=h.getId();for(let e=0;e<A.length;e++)A[e]&&(A[e].layer=f);l.push(...A)}if(n.orderByCamera){const e=a.cameraPosition;l.sort(((n,i)=>i.point?n.point?__(n.point,e)-__(i.point,e):1:-1))}return h&&(l=l.slice(0,h)),l}getTerrain(){return this.options.terrain}setTerrain(e){return this.options.terrain=e,this.getRenderer()?(this._initTerrainLayer(),this.getMap().updateCenterAltitude(),this):this}removeTerrain(){return this.setTerrain(null)}updateTerrainMaterial(e){this._terrainLayer&&e&&(this.options.terrain.material?QI(this.options.terrain.material,e):this.options.terrain.material=e,this._terrainLayer.updateMaterial(e))}_initTerrainLayer(){const e=this.getRenderer();e&&e.setToRedraw();const n=this.options.terrain;if(this._terrainLayer){const e=this._terrainLayer,i=e.options;if(n&&i.urlTemplate===n.urlTemplate&&i.spatialReference===n.spatialReference){for(const i in n)"material"===i?e.setMaterial(n[i]):"urlTemplate"!==i&&"spatialReference"!==i&&e.config(i,n[i]);return this}this._removeTerrainLayer()}if(this._resetTerrainSkinLayers(),!n)return this;this._terrainLayer=new TerrainLayer("__terrain_in_group",n),this._updateTerrainSkinLayers();const i=this._terrainLayer;i.on("tileload",this._onTerrainTileLoad,this),this._prepareLayer(i);const o=n.masks;return o&&o.length?i.setMask(o):i.removeMask(),this.fire("terrainlayercreated"),this}queryTerrain(e,n){return this._terrainLayer?this._terrainLayer.queryTerrain(e,n):(n&&(n[0]=null,n[1]=0),[null,0])}queryTerrainAtPoint(e){if(!this._terrainLayer)return null;const n=this._terrainLayer.getRenderer().getAnalysisMeshes();return this._queryRayCast(e,n)}query3DTilesAtPoint(e){const n=this._getLayers().filter((e=>e&&e.isGeo3DTilesLayer));if(!n.length)return null;for(let i=0;i<n.length;i++){if(!n[i].getRenderer())continue;const o=n[i].identifyAtPoint(e);if(o.length)return new Zh(o[0].coordinate)}return null}_queryRayCast(e,n){const i=this.getMap(),o=i.getGLRes();i.getContainerPointRay(zR,BR,e);const s=new RayCaster(zR,BR,!1).test(n,i,{count:1}),a=[];s.forEach((e=>{e.coordinates.forEach((e=>{a.push(e.coordinate)}))}));const h=i.pointAtResToCoordinate(new ee(zR[0],zR[1]),o,FR);h.z=zR[2]/i.altitudeToPoint(1,o);const l=$v(NR,h.x,h.y,h.z);return a.sort(((e,n)=>__(e.toArray(),l)-__(n.toArray(),l))),a[0]}queryTerrainByProjCoord(e,n){return this._terrainLayer?this._terrainLayer.queryTerrainByProjCoord(e,n):(n&&(n[0]=null,n[1]=0),[null,0])}_updateTerrainSkinLayers(){if(!this._terrainLayer)return;const e=this.layers,n=[];for(let i=0;i<e.length;i++){if(!e[i])continue;const o=e[i],s=o.getRenderer();if(s.renderTerrainSkin){if(s.deleteTile===LR){n.push(e[i]);continue}o.getTiles=()=>this._terrainLayer&&this._terrainLayer.getSkinTiles(o),s.drawTile=s.drawTileOnTerrain?(...e)=>s.drawTileOnTerrain(...e):LR,s.deleteTile=LR,n.push(e[i])}s.setTerrainHelper&&s.setTerrainHelper(this._terrainLayer)}this._terrainLayer.setSkinLayers(n)}_resetSkinLayer(e){if(!function(e){if(!e)return!1;const n=e.getRenderer();if(!n)return!1;return!!n.renderTerrainSkin}(e))return;const n=e.getRenderer();n&&(n.setTerrainHelper&&n.setTerrainHelper(null),n.clear&&n.clear(),delete n.drawTile,delete n.deleteTile),delete e.getTiles}_resetTerrainSkinLayers(){const e=this.layers;for(let n=0;n<e.length;n++)e[n]&&this._resetSkinLayer(e[n])}_onTerrainTileLoad(){const e=this.getRenderer();e&&e.setToRedraw()}_removeTerrainLayer(){if(this._terrainLayer){const e=this._terrainLayer;e.off("tileload",this._onTerrainTileLoad,this),this._unbindChildListeners(e),this._terrainLayer._doRemove(),delete this._terrainLayer,this.fire("terrainlayerremoved")}}getTerrainLayer(){return this._terrainLayer}_bindMap(...e){if(this.options.single){const n=e[0].getLayers();for(let e=0;e<n.length;e++)if(n[e]instanceof GroupGLLayer)throw new Error("Only one GroupGLLayer is allowed in a map instance. Set options.single to false if you want to add two or more GroupGLLayers.")}return super._bindMap(...e)}fire(...e){if("layerload"===e[0]){const e=this._getLayers();for(const n of e){const e=n.getRenderer();e&&e.isRenderComplete()&&n.fire("layerload")}}super.fire(...e)}}function HR(){}function jR(e,n){const i=e.getZIndex()-n.getZIndex();return 0===i?e.__group_gl_order-n.__group_gl_order:i}var UR;GroupGLLayer.mergeOptions({renderer:"gl",antialias:!0,extensions:[],single:!0,onlyWebGL1:!1,optionalExtensions:["ANGLE_instanced_arrays","OES_element_index_uint","OES_standard_derivatives","OES_vertex_array_object","OES_texture_half_float","OES_texture_half_float_linear","OES_texture_float","OES_texture_float_linear","WEBGL_depth_texture","EXT_shader_texture_lod","EXT_frag_depth","EXT_texture_filter_anisotropic","WEBGL_compressed_texture_astc","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb"],forceRenderOnZooming:!0,forceRenderOnMoving:!0,forceRenderOnRotating:!0,viewMoveThreshold:100,geometryEvents:!0,multiSamples:4,forceRedrawPerFrame:!1}),GroupGLLayer.registerJSONType("GroupGLLayer"),GroupGLLayer.registerRenderer("gl",class GroupGLLayerRenderer extends Mm.CanvasRenderer{setToRedraw(){this.setRetireFrames(),super.setToRedraw()}onAdd(){super.onAdd(),this.prepareCanvas()}updateSceneConfig(){this._groundPainter&&this._groundPainter.update(),this._envPainter&&this._envPainter.update(),this._weatherPainter&&this._weatherPainter.update(),this.setToRedraw()}render(...e){this.getMap()&&this.layer.isVisible()&&(this.forEachRenderer((e=>{e._replacedDrawFn||(e.draw=this._buildDrawFn(e.draw),e.drawOnInteracting=this._buildDrawOnInteractingFn(e.drawOnInteracting),e.setToRedraw=this._buildSetToRedrawFn(e.setToRedraw),e._replacedDrawFn=!0)})),this.prepareRender(),this.prepareCanvas(),this.layer._updatePolygonOffset(),this._toRedraw=!1,this._renderChildLayers("render",e),this._renderOutlines(),this._postProcess())}prepareCanvas(){super.prepareCanvas(),this.forEachRenderer((e=>{e.prepareCanvas()}))}drawOnInteracting(...e){this.getMap()&&this.layer.isVisible()&&(this.layer._updatePolygonOffset(),this._toRedraw=!1,this._renderChildLayers("drawOnInteracting",e),this._renderOutlines(),this._postProcess())}_renderChildLayers(e,n){this._renderMode="default";const i=this.hasRenderTarget(),o=this._getDrawContext(n);if(i&&(this._drawContext.renderTarget=this._getFramebufferTarget()),this._envPainter.paint(o),this.drawGround(!0),!i)return void this._renderInMode("default",null,e,n,!0);const s=this.glCtx,a=this.layer._getSceneConfig(),h=a&&a.postProcess,l=this.isSSROn();o.jitter=eO;const c=this.layer.getGroundConfig();o.hasSSRGround=!!(l&&c&&c.enable&&c.symbol&&c.symbol.ssr),s.resetDrawCalls(),this._renderInMode("default",this._targetFBO,e,n),l&&this._postProcessor.drawSSR(this._blitDepthTex(),this._targetFBO);h.bloom&&h.bloom.enable&&(this._bloomPainted=this._postProcessor.drawBloom(this._depthTex)),2===l&&this._postProcessor.drawSSR(this._blitDepthTex(),this._targetFBO,!0),s.resetDrawCalls(),this._weatherPainter.renderScene(o),this._pointDrawCount=s.getDrawCalls()}_renderInMode(e,n,i,o,s){this._renderMode=e;const a=this._getDrawContext(o);a.renderMode=this._renderMode,a.renderTarget&&(a.renderTarget.fbo=n),s&&(a.isFinalRender=!0),this.forEachRenderer(((e,s)=>{s.isVisible()&&(this.clearStencil(e,n),e[i].apply(e,o))}))}_getDrawContext(e){let n=e[0];return oO(n)||(n=e[1]),n!==this._contextFrameTime&&(this.forEachRenderer(((e,n)=>{n.isVisible()&&e.needRetireFrames&&e.needRetireFrames()&&this.setRetireFrames()})),this._drawContext=this._prepareDrawContext(n),this._contextFrameTime=n,this._frameEvent=oO(e[0])?null:e[0]),this._drawContext}_renderOutlines(){if(!this.isEnableOutline())return;const e=this._getOutlineFBO(),n=this.glCtx;n.resetDrawCalls(),this.forEachRenderer(((n,i)=>{i.isVisible()&&n.drawOutline&&n.drawOutline(e)})),this._outlineCounts=n.getDrawCalls()}_getOutlineFBO(){const{width:e,height:n}=this.canvas;let i=this._outlineFBO;if(i)e===i.width&&n===i.height||i.resize(e,n);else{const o=this.regl.texture({width:e,height:n,format:"rgba4"});i=this._outlineFBO=this.regl.framebuffer({width:e,height:n,colors:[o],depth:!1,stencil:!1})}return i}_getFBOColor(e){if(this._isUseMultiSample()){const n=this._getBlitFBO(e);return n.width!==e.width||n.height!==e.height?n.resize(e.width,e.height):this.regl.clear({color:[0,0,0,0],fbo:n}),n.blit(e),n.color[0]}return e.color[0]}_blitDepthTex(){if(this._depthTex.subimage)return this._depthTex;const{width:e,height:n}=this._depthTex;if(!this._blitDepthFBO){const i=this.regl,o=i.texture({min:"nearest",mag:"nearest",mipmap:!1,type:"depth stencil",width:e,height:n,format:"depth stencil"}),s=i.renderbuffer({width:e,height:n,format:"rgba4"});this._blitDepthFBO=i.framebuffer({depthStencil:o,colors:[s],colorFormat:"rgba4",width:e,height:n})}return this._blitDepthFBO.width===e&&this._blitDepthFBO.height===n||this._blitDepthFBO.resize(e,n),this.regl.clear({color:[0,0,0,0],depth:1,fbo:this._blitDepthFBO}),this._blitDepthFBO.blit(this._targetFBO,256,"nearest"),this._blitDepthFBO.depthStencil}_getBlitFBO(e){if(this._blitFBOs||(this._blitFBOs=[]),!e._blitFBO){const n=this._createSimpleFBOInfo(!0,e.width,e.height),i=this.regl.framebuffer(n);this._blitFBOs.push(i),e._blitFBO=i}return e._blitFBO}_isUseMultiSample(){return 0===this.regl.limits.version.indexOf("WebGL 2.0")&&this.layer.options.antialias}hasRenderTarget(){const e=this.layer._getSceneConfig(),n=e&&e.postProcess;return!(!n||!n.enable)}testIfNeedRedraw(){if(this.layer.options.forceRedrawPerFrame)return!0;if(this._toRedraw)return this._toRedraw=!1,!0;if(this.getMap().isInteracting()&&(this._groundPainter&&this._groundPainter.isEnable()||this._envPainter&&this._envPainter.isEnable()))return!0;if(this._weatherPainter&&this._weatherPainter.isEnable())return!0;const e=this.layer.getTerrainLayer();if(e){const n=e.getRenderer();if(n&&n.testIfNeedRedraw())return this._needUpdateSSR=!0,!0}const n=this._getLayers();for(const e of n){if(!e||!e.isVisible())continue;const n=e.getRenderer();if(n&&n.testIfNeedRedraw())return this._needUpdateSSR=!0,!0}return!1}isRenderComplete(){const e=this._getLayers();for(const n of e){const e=n.getRenderer();if(e&&!e.isRenderComplete())return!1}return!0}mustRenderOnInteracting(){const e=this._getLayers();for(const n of e){const e=n.getRenderer();if(e&&e.mustRenderOnInteracting())return!0}return!1}isCanvasUpdated(){if(super.isCanvasUpdated())return!0;const e=this._getLayers();for(const n of e){const e=n.getRenderer();if(e&&e.isCanvasUpdated())return!0}return!1}isBlank(){if(this._groundPainter&&this._groundPainter.isEnable())return!1;if(this._envPainter&&this._envPainter.isEnable())return!1;const e=this.layer.getTerrainLayer();if(e){const n=e.getRenderer();if(n&&!n.isBlank())return!1}const n=this._getLayers();for(const e of n){const n=e.getRenderer();if(n&&!n.isBlank())return!1}return!0}createContext(){const e=this.layer,n=e.options.glOptions||{alpha:!0,depth:!0,stencil:!0};n.preserveDrawingBuffer=!0,n.antialias=!!e.options.antialias,this.glOptions=n;const i=this.gl=function(e,n,i){const o=i?["webgl","experimental-webgl"]:["webgl2","webgl","experimental-webgl"];let s=null;for(let i=0;i<o.length;++i){try{s=e.getContext(o[i],n)}catch(e){}if(s)break}return s||console.error("Browser doesn't support WebGL."),s}(this.canvas,n,e.options.onlyWebGL1);this._initGL(i),i.wrap=()=>new WT(this.gl),this.glCtx=i.wrap(),this.canvas.gl=this.gl,this.reglGL=i.wrap(),this.regl=jm({gl:this.reglGL,attributes:n,extensions:e.options.extensions,optionalExtensions:e.options.optionalExtensions}),this.gl.regl=this.regl,this._jitter=[0,0],this._groundPainter=new GroundPainter(this.regl,this.layer),this._envPainter=new EnvironmentPainter(this.regl,this.layer);const o=this.layer.getWeatherConfig();this._weatherPainter=new WeatherPainter(this.regl,e,o),this._analysisPainter=new AnalysisPainter(this.regl,e);const s=this.layer._getSceneConfig()||{},a=s&&s.postProcess;this._jitGetter=new AP(a&&a.antialias&&a.antialias.jitterRatio||.2),this._postProcessor=new PostProcess(this.regl,this.layer,this._jitGetter),this._shadowProcess=new ShadowProcess(this.regl,this.layer)}_initGL(){const e=this.layer,n=this.gl,i=e.options.extensions;i&&i.forEach((e=>{n.getExtension(e)}));const o=e.options.optionalExtensions;o&&o.forEach((e=>{n.getExtension(e)})),this.gl.clearColor(0,0,0,0)}clearCanvas(){super.clearCanvas(),this._clearFramebuffers()}_clearFramebuffers(){const e=this.regl;this._targetFBO&&e.clear({color:$E,depth:1,stencil:255,framebuffer:this._targetFBO}),this._outlineFBO&&e.clear({color:$E,framebuffer:this._outlineFBO}),e.clear({color:$E,depth:1,stencil:255})}resizeCanvas(){const e=this.canvas.width,n=this.canvas.height;!this._targetFBO||this._targetFBO.width===e&&this._targetFBO.height===n||(super.resizeCanvas(),this._targetFBO.resize(e,n),this._clearFramebuffers(),this.forEachRenderer((e=>{e.canvas&&e.resizeCanvas()})))}getCanvasImage(){return this.forEachRenderer((e=>{e.getCanvasImage()})),super.getCanvasImage()}_getLayers(){return this.layer._getLayers()}forEachRenderer(e){const n=this._getLayers();for(const i of n){if(!i.isVisible()||!i.options.beneathTerrain)continue;const n=i.getRenderer();n&&e(n,i)}const i=this.layer.getTerrainLayer();if(i){const n=i.getRenderer();n&&e(n,i)}for(const i of n){if(!i.isVisible()||i.options.beneathTerrain)continue;const n=i.getRenderer();n&&e(n,i)}}clearStencil(e,n){const i={stencil:e.getStencilValue?e.getStencilValue():255};n&&(i.framebuffer=n),this.regl.clear(i)}onRemove(){this.canvas.pickingFBO&&this.canvas.pickingFBO.destroy&&this.canvas.pickingFBO.destroy(),this._destroyFramebuffers(),this._groundPainter&&(this._groundPainter.dispose(),delete this._groundPainter),this._envPainter&&(this._envPainter.dispose(),delete this._envPainter),this._shadowProcess&&(this._shadowProcess.dispose(),delete this._shadowProcess),this._postProcessor&&(this._postProcessor.dispose(),delete this._postProcessor),this._outlineFBO&&(this._outlineFBO.destroy(),delete this._outlineFBO),this._weatherPainter&&(this._weatherPainter.dispose(),delete this._weatherPainter),super.onRemove()}_destroyFramebuffers(){if(this._targetFBO&&(this._targetFBO.destroy(),delete this._targetFBO,this._postFBO&&(this._postFBO.destroy(),delete this._postFBO),this._blitDepthFBO&&(this._blitDepthFBO.destroy(),delete this._blitDepthFBO),this._blitFBOs)){for(let e=0;e<this._blitFBOs.length;e++)this._blitFBOs[e]&&this._blitFBOs[e].destroy();delete this._blitFBOs}}setRetireFrames(){this._needRetireFrames=!0}getFrameTime(){return this._contextFrameTime}getFrameEvent(){return this._frameEvent}getFrameContext(){return this._drawContext}drawGround(e){const n=this.layer.getGroundConfig();if(!n||!n.enable)return!1;if(!this._groundPainter)return!1;const i=this.getFrameContext(),o=i.jitter;i.jitter=eO;const s=this.layer.getPolygonOffsetCount();let a;i.offsetFactor=s+1,i.offsetUnits=s+1,e&&(a=i.sceneFilter,delete i.sceneFilter);const h=this._groundPainter.paint(i);return this._groundPainter.needToRedraw()&&this.setToRedraw(),a&&(i.sceneFilter=a),i.jitter=o,h}_buildDrawFn(e){const n=this;return function(i,o){return(o=o||n._drawContext)&&o.renderTarget&&(o.renderTarget.getFramebuffer=sO,o.renderTarget.getDepthTexture=aO),e.call(this,i,o)}}_buildDrawOnInteractingFn(e){const n=this;return function(i,o,s){return(s=s||n._drawContext)&&s.renderTarget&&(s.renderTarget.getFramebuffer=sO,s.renderTarget.getDepthTexture=aO),e.call(this,i,o,s)}}_buildSetToRedrawFn(e){return function(...n){return e.apply(this,n)}}isEnableSSR(){const e=this.layer._getSceneConfig(),n=e&&e.postProcess;return n&&n.enable&&n.ssr&&n.ssr.enable}isSSROn(){const e=this.isEnableSSR(),n=this.getMap();if(!e||n.getPitch()<=-.001)return 0;const i=n.projViewMatrix,o=this._postProcessor.getPrevSsrProjViewMatrix();return o&&qv(o,i)?1:2}isEnableTAA(){return!1}isEnableSSAO(){return!1}isEnableOutline(){const e=this.layer._getSceneConfig(),n=e&&e.postProcess;return n&&n.enable&&n.outline&&n.outline.enable}isEnableWeather(){const e=this.layer._getSceneConfig(),n=e&&e.weather;return n&&n.enable}_getViewStates(){const e=this.layer.getMap();if(!this._renderedView){this._renderedView={center:e.getCenter(),bearing:e.getBearing(),pitch:e.getPitch(),res:e.getResolution()};let n=!1;if(e.options.lights){const i=e.getLightManager().getDirectionalLight().direction||tO;this._renderedView.lightDirection=Kv([],i),n=!0}return{viewChanged:!0,lightDirectionChanged:n}}const n=e.getResolution()/this._renderedView.res,i=e.coordToContainerPoint(this._renderedView.center),o=this.layer.options.viewMoveThreshold,s=i._sub(e.width/2,e.height/2).mag()>o||n<.95||n>1.05;let a=!1;if(e.options.lights){const n=e.getLightManager().getDirectionalLight().direction||tO;a=!p_(this._renderedView.lightDirection,n),a&&(this._renderedView.lightDirection=Kv([],n))}return s&&(this._renderedView.center=e.getCenter(),this._renderedView.bearing=e.getBearing(),this._renderedView.pitch=e.getPitch(),this._renderedView.res=e.getResolution()),{viewChanged:s,lightDirectionChanged:a}}_prepareDrawContext(e){const n=this.layer._getSceneConfig(),i=n&&n.postProcess,o=n&&n.weather,s={timestamp:e,renderMode:this._renderMode||"default",includes:{},states:this._getViewStates(),testSceneFilter:e=>!s.sceneFilter||s.sceneFilter(e),isFinalRender:!1,weather:{fog:o&&o.fog}},a=this._jitGetter;a&&a.setRatio(i&&i.antialias&&i.antialias.jitterRatio||.2);const h=this.isSSROn();let l;if(i&&i.enable){if(this.isEnableTAA()){(this.getMap().isInteracting()||this._needRetireFrames)&&a.reset(),a.getJitter(this._jitter),a.frame()}else Zx(this._jitter,0,0);s.jitter=this._jitter;const e=i.bloom&&i.bloom.enable;e&&h?(s.bloom=1,s.sceneFilter=nO):e?(s.bloom=1,s.sceneFilter=iO):h&&(s.sceneFilter=rO),l=this._getFramebufferTarget(),l&&(s.renderTarget=l)}else this._destroyFramebuffers();return"noAa"!==this._renderMode&&(this._shadowContext=this._prepareShadowContext(s),this._shadowContext&&(s.includes.shadow=1),this._includesState=this._updateIncludesState(s)),this._shadowContext&&(s.shadow=this._shadowContext,s.includes.shadow=1),s.states.includesChanged=this._includesState,i&&i.enable&&this._postProcessor&&this._postProcessor.setContextIncludes(s),s}_renderAnalysis(e){const n=this._getLayers().filter((e=>e.isVisible()));return this.layer.getTerrainLayer()&&n.push(this.layer.getTerrainLayer()),this._analysisPainter.paint(e,n)}_updateIncludesState(e){let n=!1;const i=Object.keys(e.includes),o=this._prevIncludeKeys;if(o){const e=i.filter((e=>-1===o.indexOf(e))).concat(o.filter((e=>-1===i.indexOf(e))));e.length&&(n=e.reduce(((e,n)=>(e[n]=1,e)),{}))}return this._prevIncludeKeys=i,n}_prepareShadowContext(e){const n=this.layer._getSceneConfig();if(!n||!n.shadow||!n.shadow.enable)return this._shadowProcess&&(this._shadowProcess.dispose(),delete this._shadowProcess),null;this._shadowProcess||(this._shadowProcess=new ShadowProcess(this.regl,this.layer));const i={config:n.shadow,defines:this._shadowProcess.getDefines(),uniformDeclares:ShadowProcess.getUniformDeclares()};return i.renderUniforms=this._renderShadow(e),i}_renderShadow(e){const n=e.renderTarget&&e.renderTarget.fbo,i=this.layer._getSceneConfig(),o=[];let s=e.states.lightDirectionChanged||e.states.viewChanged;this.forEachRenderer(((e,n)=>{if(!e.getShadowMeshes||!n.isVisible())return;const i=e.getShadowMeshes();if(Array.isArray(i))for(let e=0;e<i.length;e++)i[e]&&(i[e].needUpdateShadow&&(s=!0,i[e].needUpdateShadow=!1),i[e].hasFunctionUniform&&(i[e].hasFunctionUniform("minAltitude")||i[e].setFunctionUniform("minAltitude",(()=>n&&n.options.altitude||0)),o.push(i[e])))})),this._shadowScene||(this._shadowScene=new kC),this._shadowScene.setMeshes(o);const a=this.getMap(),h=i.shadow,l=a.getLightManager(),c=l&&l.getDirectionalLight().direction||tO;return this._shadowProcess.render(!i.ground||!i.ground.enable,a.projMatrix,a.viewMatrix,h.color,h.opacity,c,this._shadowScene,this._jitter,n,s)}_renderWeather(e){let n=[];if(this.forEachRenderer(((e,i)=>{if(!e.getAnalysisMeshes||!i.isVisible())return;const o=e.getAnalysisMeshes();n=n.concat(o)})),this._groundPainter){const e=this._groundPainter.getRenderMeshes();n=n.concat(e)}const i=this.layer.getWeatherConfig();return this._weatherPainter.paint(e,n,i)}getGroundMesh(){if(this._groundPainter){return this._groundPainter.getRenderMeshes()}return[]}_getFramebufferTarget(){const e=this.layer._getSceneConfig();if(!this._targetFBO){const n=this.regl;let i=this._depthTex;(!i||!i._texture||i._texture.refCount<=0)&&(i=null);const o=this.createFBOInfo(e&&e.postProcess,i);this._depthTex=o.depth||o.depthStencil,this._targetFBO=n.framebuffer(o),this._clearFramebuffers()}return{fbo:this._targetFBO}}_createSimpleFBOInfo(e,n,i){n=n||this.canvas.width,i=i||this.canvas.height;const o=this.regl,s=this._isUseMultiSample();let a;if(!e&&s)a=o.renderbuffer({width:n,height:i,samples:this.layer.options.multiSamples,format:"rgba8"});else{a=o.texture({min:"nearest",mag:"nearest",type:"uint8",width:n,height:i})}return{width:n,height:i,colors:[a],colorFormat:s?"rgba8":"rgba"}}createFBOInfo(e,n){let{width:i,height:o}=this.canvas;i=i||1,o=o||1;const s=this.regl,a=this._createSimpleFBOInfo(),h=this._isUseMultiSample(),l=s.hasExtension("WEBGL_depth_texture");if(h){const e=n||s.renderbuffer({width:i,height:o,format:"depth24 stencil8",samples:this.layer.options.multiSamples});a.depthStencil=e}else if(l){const e=n||s.texture({min:"nearest",mag:"nearest",mipmap:!1,type:"depth stencil",width:i,height:o,format:"depth stencil"});a.depthStencil=e}else{const e=n||s.renderbuffer({width:i,height:o,format:"depth stencil"});a.depthStencil=e}return a}_postProcess(){if(!this._targetFBO)return void(this._needRetireFrames=!1);const e=this.layer._getSceneConfig(),n=e&&e.postProcess;if(!n||!n.enable){if(this.isEnableWeather())throw new Error("you must enable the post process to turn on weather");return}this.layer.fire("postprocessstart");const i=this.layer.getMap();let o=n.sharpen&&n.sharpen.factor;o||0===o||(o=.2);let s=0,a=.2,h=.3,l=1,c=[1,1,0];n.outline&&(s=+!!n.outline.enable,a=hO(n.outline,"highlightFactor",a),h=hO(n.outline,"outlineFactor",h),l=hO(n.outline,"outlineWidth",l),c=hO(n.outline,"outlineColor",c));const A=n.ssr&&n.ssr.enable,f=n.bloom&&n.bloom.enable,d=this._analysisPainter._hasAnalysis(),p=this._weatherPainter._hasWeather(),g=f||A||d||p;let v=this._postFBO;if(g){if(!v){const e=this._createSimpleFBOInfo();this._isUseMultiSample()&&(e.depthStencil=this.regl.renderbuffer({width:this.canvas.width,height:this.canvas.height,samples:this.layer.options.multiSamples,format:"depth24 stencil8"})),v=this._postFBO=this.regl.framebuffer(e)}const{width:e,height:n}=this.canvas;v.width===e&&v.height===n||v.resize(e,n)}else v=null,this._postFBO&&(this._postFBO.destroy(),delete this._postFBO);let w=this._getFBOColor(this._targetFBO);if(this._postProcessor.fxaa(v,w,0,+!(!n.toneMapping||!n.toneMapping.enable),+!(g||!n.sharpen||!n.sharpen.enable),i.getDevicePixelRatio(),o,s&&this._outlineCounts>0&&this._getOutlineFBO(),a,h,l,c),v&&(w=this._getFBOColor(v)),f&&this._bloomPainted){const e=n.bloom,i=+e.threshold||0,o=hO(e,"factor",1),s=hO(e,"radius",1);w=this._postProcessor.bloom(w,null,null,i,o,s,0)}if(A&&(this._postProcessor.genSsrMipmap(w,this._blitDepthTex()),this._needUpdateSSR)){const e=this._needRetireFrames;this.setToRedraw(),this._needRetireFrames=e,this._needUpdateSSR=!1}this._analysisPainter&&(w=this._renderAnalysis(w)),this.isEnableWeather()&&(w=this._renderWeather(w)),g&&this._postProcessor.renderFBOToScreen(w,+!(!n.sharpen||!n.sharpen.enable),o,i.getDevicePixelRatio()),this.layer.fire("postprocessend")}}),GroupGLLayer.registerRenderer("canvas",null),function(e){e[e.AMBIENT=0]="AMBIENT",e[e.REALISTIC=1]="REALISTIC"}(UR||(UR={}));class LightManager{constructor(e){this._map=e,this._loader=new SC}getDirectionalLight(){return this._config&&this._config.directional||{}}getAmbientLight(){return this._config&&this._config.ambient||{}}getAmbientResource(){return this._iblMaps}setConfig(e){const n=this._config;this._urlModifier=e.urlModifier,this._config=JSON.parse(JSON.stringify(e));let i=!1;if(e&&e.ambient&&e.ambient.resource){if(!(n&&n.ambient&&function(e,n){if(!e.resource)return!1;if(e.resource.url!==n.resource.url)return!1;return!0}(n.ambient,e.ambient)))return void this._initAmbientResources();this._iblMaps&&(e.ambient.prefilterCubeSize!==n.ambient&&n.ambient.prefilterCubeSize&&this._onHDRLoaded(),i=!0,e.ambient.resource.sh&&(this._iblMaps.sh=e.ambient.resource.sh))}else this._disposeCubeLight(),i=n&&n.ambient&&n.ambient.resource;this._map.fire("updatelights",{ambientUpdate:i})}_tryToGetREGLContext(e){const n=e.getLayers();for(let e=0;e<n.length;e++){const i=n[e]&&n[e].getRenderer();if(i&&i.regl)return i.regl}const i=document.createElement("canvas"),o=jm({canvas:i,attributes:{depth:!1,stencil:!1,alpha:!1}});return o._temp=!0,o}_initAmbientResources(){const e=this._config.ambient.resource,n=e&&e.url;if(!n)return;const i=[];let o=0,s=0;const a=()=>{s++,s>=o&&this._onSkyboxLoaded(i)},h=function(){throw new Error(`skybox image with url(${this.src}) failed to load, please check the image's url.`)},l=this._urlModifier;if(n.top||n.nx){const{front:e,back:s,right:c,left:A,top:f,bottom:d}=n,{nx:p,ny:g,px:v,py:w,nz:C,pz:P}=n;let T;T=e?[A,c,s,e,f,d]:[p,v,C,P,w,g],o=T.length;for(let e=0;e<o;e++){const n=new Image;n.onload=a,n.onerror=h,n.src=l&&l(T[e])||T[e],i[e]=n}}else{const n={url:e.url,arrayBuffer:!0,hdr:!0,flipY:!0};this._loader.setURLModifier(l),this._hdr=new VC(n,this._loader),this._hdr.once("complete",(()=>{this._onHDRLoaded()})),this._hdr.once("error",(()=>{this._onHDRError()}))}}dispose(){this._disposeCubeLight()}_onHDRLoaded(){this._hdr&&(this._iblMaps=this._createIBLMaps(this._hdr),this._map.fire("updatelights",{ambientUpdate:!0}))}_onHDRError(){this._map.fire("hdrerror")}_onSkyboxLoaded(e){this._iblMaps=this._createIBLMaps(e),this._map.fire("updatelights",{ambientUpdate:!0})}_createIBLMaps(e){const n=this._config.ambient.resource,i=n.prefilterCubeSize||512,o=this._tryToGetREGLContext(this._map),s=DT.PBRHelper.createIBLMaps(o,{envTexture:Array.isArray(e)?e:e.getREGLTexture(o),ignoreSH:!!n.sh,envCubeSize:i,prefilterCubeSize:i,environmentExposure:this._config.ambient.exposure,format:"array"});if(n.sh&&(s.sh=n.sh,Array.isArray(s.sh[0]))){const e=s.sh,n=[];for(let i=0;i<e.length;i++)n.push(...e[i]);s.sh=n}return o._temp&&(delete this._hdr,o.destroy()),s}_disposeCubeLight(){this._hdr&&(this._hdr.dispose(),delete this._hdr),delete this._iblMaps}}let GR,VR,WR,qR,ZR;BA.include({setLights(e){return this.options.lights=e,this._initLightManager(),this},getLights(){return this.options.lights},_initLightManager(){this._lightManager||(this._lightManager=new LightManager(this)),this._lightManager.setConfig(this.getLights())},getLightManager(){return this._lightManager?this._lightManager:null}}),BA.addOnLoadHook((function(){this.options.lights&&this._initLightManager()}));const QR={color:[0,0,0,0]},XR={enable:!1};BA.include({setPostProcessConfig(e){return this.options.postProcessConfig=e,this},getPostProcessConfig(){return this.options.postProcessConfig}});const YR=Mm.MapCanvasRenderer.prototype.drawLayerCanvas;Mm.MapCanvasRenderer.prototype.drawLayerCanvas=function(){const e=YR.apply(this,arguments);return e&&function(e,n){const i=e.map.getPostProcessConfig();if(!i||!i.enable)return;GR||(o=n.width,s=n.height,GR=document.createElement("canvas",o,s),VR=jm({canvas:GR,attributes:{depth:!1,stencil:!1,alpha:!0,antialias:!1,premultipliedAlpha:!1}}),WR=VR.texture({mag:"linear",min:"linear",mipmap:!1,flipY:!0,width:o,height:s}),qR=VR.texture());var o,s;GR.width===n.width&&GR.height===n.height||(GR.width=n.width,GR.height=n.height);VR.clear(QR);const a=i.filmicGrain||XR;void 0===a.enable&&(a.enable=!0);const h=i.vignette||XR;void 0===h.enable&&(h.enable=!0);const l=i.colorLUT||XR;void 0===l.enable&&(l.enable=!0);e._postProcessContext||(e._postProcessContext={});const c=e._postProcessContext;if(l.enable){const n=l.lut;if(!c.lutTexture||c.lutTexture.url!==n){const i=new Image;i.onload=function(){const o={data:i,min:"linear",mag:"linear"},s=c.lutTexture?c.lutTexture.texture(o):VR.texture(o);c.lutTexture={url:n,texture:s},e.setLayerCanvasUpdated()},i.src=n}}const A={enableGrain:+!!a.enable,grainFactor:void 0===a.factor?.15:a.factor,timeGrain:performance.now(),enableVignette:+!!h.enable,lensRadius:h.lensRadius||[.8,.25],frameMod:1,enableLut:+!!l.enable,lookupTable:c.lutTexture?c.lutTexture.texture:qR};ZR||(ZR=new PostProcess(VR));ZR.postprocess(null,A,WR({width:GR.width,height:GR.height,data:n,flipY:!0,mag:"linear",min:"linear",mipmap:!1})),a.enable&&e.setLayerCanvasUpdated();e.context.drawImage(GR,0,0,GR.width,GR.height)}(this,this.canvas),e};const JR=Mm.MapCanvasRenderer.prototype.renderFrame;Mm.MapCanvasRenderer.prototype.renderFrame=function(){const e=JR.apply(this,arguments),n=this.map.getPostProcessConfig(),i=n&&n.filmicGrain;return!i||void 0!==i.enable&&!0!==i.enable||this.setLayerCanvasUpdated(),e};const KR=[];function $R(e){e.properties.showOnlyTimestamp&&(delete e.properties.showOnlyTimestamp,eD(e))}function tD(e,n){const i=e.geometry.properties;i.oldElementsBeforeHighlight||(i.oldElementsBeforeHighlight=e.geometry.elements),i.elements&&(i.oldElementsArrBeforeHighlight||(i.oldElementsArrBeforeHighlight=i.elements),i.elements=n)}function eD(e){const n=e.geometry.properties.oldElementsBeforeHighlight;n&&e.geometry.elements!==n&&(e.geometry.deleteElements(),e.geometry.setElements(e.geometry.properties.oldElementsBeforeHighlight),e.geometry.properties.oldElementsArrBeforeHighlight&&(e.geometry.properties.elements=e.geometry.properties.oldElementsArrBeforeHighlight,delete e.geometry.properties.oldElementsArrBeforeHighlight),delete e.geometry.properties.hasInvisible,delete e.geometry.properties.oldElementsBeforeHighlight)}function nD(e){if(!e.properties.highlightTimestamp)return;const n=e.defines;delete n.HAS_HIGHLIGHT_COLOR,delete n.HAS_HIGHLIGHT_OPACITY,e.setDefines(n),delete e.properties.highlightTimestamp,eD(e),iD(e)}function iD(e){if(!e)return;const{hlBloomMesh:n}=e.properties;if(n){const i=n.geometry;i.elements&&i.elements.destroy&&i.deleteElements(),n.dispose(),delete e.properties.hlBloomMesh}}var rD=Object.freeze({__proto__:null,clearHighlight:nD,clearShowOnly:$R,deleteHighlightBloomMesh:iD,highlightMesh:function(e,n,i,o,s){const{highlightTimestamp:a}=n.properties;if(!i)return void(a&&nD(n));if(o===a)return;const h=n.geometry.getVertexCount();let{aHighlightColor:l,aHighlightOpacity:c}=n.geometry.properties;l&&l.fill(0),c&&c.fill(255);let A=!1,f=!1;const d=i.keys();let p=null,g=null;for(const e of d)if(s.has(e)){const n=i.get(e),{color:o,bloom:a,visible:d}=n;let v,{opacity:w}=n;if(o&&(A||(l||(l=new Uint8Array(4*h)),A=!0),v=iE(KR,o)),w=XI(w)?1:w,w<1&&(f||(c||(c=new Uint8Array(h),c.fill(255)),f=!0)),!1===d&&(g||(g=new Set),g.add(e)),v||w<1||a){const n=s.get(e);if(n)for(let e=0;e<n.length;e++){const i=n[e];v&&E_(l.subarray(4*i,4*i+4),...v),w<1&&(c[i]=255*w),a&&(p||(p=[]),p.push(i))}}}const v=n.defines;if(A?(n.geometry.data.aHighlightColor?n.geometry.updateData("aHighlightColor",l):(n.geometry.data.aHighlightColor=l,n.geometry.generateBuffers(e)),n.geometry.properties.aHighlightColor=l,v.HAS_HIGHLIGHT_COLOR=1):v.HAS_HIGHLIGHT_COLOR&&(n.geometry.updateData("aHighlightColor",l),delete v.HAS_HIGHLIGHT_COLOR),f?(n.geometry.data.aHighlightOpacity?n.geometry.updateData("aHighlightOpacity",c):(n.geometry.data.aHighlightOpacity=c,n.geometry.generateBuffers(e)),n.geometry.properties.aHighlightOpacity=c,v.HAS_HIGHLIGHT_OPACITY=1):v.HAS_HIGHLIGHT_OPACITY&&(n.geometry.updateData("aHighlightOpacity",c),delete v.HAS_HIGHLIGHT_OPACITY),g&&g.size>0){let i=[];s.forEach(((e,n)=>{g.has(n)||tE(i,e)})),n.geometry.properties.hasInvisible=!0,tD(n,i);const o={data:i,primitive:n.geometry.getPrimitive()};n.geometry.elements!==n.geometry.properties.oldElementsBeforeHighlight&&n.geometry.elements.destroy&&n.geometry.deleteElements(),i=e.elements(o),n.geometry.setElements(i),n.geometry.generateBuffers(e)}else n.geometry.properties.hasInvisible&&eD(n);n.setDefines(v),n.properties.highlightTimestamp=o;let w=n.properties.hlBloomMesh;if(p&&p.length){if(w){const e=_v(w.localTransform,n.localTransform),i=_v(w.positionMatrix,n.positionMatrix);w.setLocalTransform(e),w.setPositionMatrix(i),n.properties.hlBloomMesh.geometry.setElements(p)}else{const i=new Lw(n.geometry.data,p,0,n.geometry.desc);i.generateBuffers(e);w=new bC(i,n.material,n.config);const o=n.uniforms;for(const e in o)Object.defineProperty(w.uniforms,e,{enumerable:!0,get:function(){return n.getUniform(e)}});const s=QI({},n.defines);s.HAS_BLOOM=1;const a=_v([],n.localTransform),h=_v([],n.positionMatrix);w.setLocalTransform(a),w.setPositionMatrix(h),QI(w.properties,n.properties),QI(i.properties,n.geometry.properties),w.setDefines(s),w.bloom=1}n.properties.hlBloomMesh=w}else w&&iD(n)},showOnly:function(e,n,i,o,s){const{showOnlyTimestamp:a}=n.properties;if(!i)return void(a&&$R(n));if(o===a)return;n.properties.showOnlyTimestamp=o;const h=i.keys(),l=[];for(const e of h){if(!s.has(e))continue;const n=s.get(e);n&&tE(l,n)}tD(n,l),n.geometry.elements!==n.geometry.properties.oldElementsBeforeHighlight&&n.geometry.elements.destroy&&n.geometry.deleteElements();const c={data:l,primitive:n.geometry.getPrimitive()};n.geometry.setElements(e.elements(c)),n.geometry.generateBuffers(e)}});const oD=[0,0,0,0];class HeatmapProcess{constructor(e,n,i,o,s,a){this.renderer=new PC(e),this.sceneConfig=n,this._layer=i,this._colorStops=o,this._stencil=s,this._polygonOffset=a||{factor:0,units:0},this._init(),this._outputSize=[]}render(e,n,i){this._check();const o=this._layer.getMap();this.renderer.regl.clear({color:oD,depth:1,stencil:255,framebuffer:this._heatmapFBO}),this.renderer.render(this._heatmapShader,n,e,this._heatmapFBO);const s=this._layer.getRenderer().canvas;this._outputSize[0]=s.width,this._outputSize[1]=s.height;const a=QI({colorRamp:this._colorRampTex,inputTexture:this._heatmapFBO,projViewMatrix:o.projViewMatrix,textureOutputSize:this._outputSize},n);return this._transformGround(),this.renderer.render(this._displayShader,a,this._groundScene,i)}dispose(){this._heatmapShader&&(this._heatmapShader.dispose(),delete this._heatmapShader),this._displayShader&&(this._displayShader.dispose(),delete this._displayShader),this._ground&&(this._ground.geometry.dispose(),this._ground.dispose(),delete this._ground,delete this._groundScene),this._heatmapFBO&&(this._heatmapFBO.destroy(),delete this._heatmapFBO)}_createColorRamp(){const e=this._colorStops;let n=this._rampCanvas,i=this._rampCtx;i?i.clearRect(0,0,256,1):(n=this._rampCanvas=document.createElement("canvas"),n.width=256,n.height=1,i=this._rampCtx=n.getContext("2d"));const o=i.createLinearGradient(0,0,256,1);for(let n=0;n<e.length;n++)o.addColorStop(e[n][0],e[n][1]);i.fillStyle=o,i.fillRect(0,0,256,1),this._colorRampTex&&this._colorRampTex.destroy();this._colorRampTex=this.renderer.regl.texture({width:256,height:1,data:n,min:"linear",mag:"linear",premultiplyAlpha:!0})}_check(){const e=this._layer.getRenderer().canvas,n=Math.ceil(e.width/4),i=Math.ceil(e.height/4),o=this._heatmapFBO;o.width===n&&o.height===i||o.resize(n,i)}_init(){this._createColorRamp(),this._createShader(),this._createHeatmapTex(),this._createGround()}_createGround(){const e=new WC;e.generateBuffers(this.renderer.regl),this._ground=new bC(e),this._groundScene=new kC([this._ground])}_transformGround(){const e=this._layer.getMap(),n=GroundPainter.getGroundTransform(this._ground.localTransform,e);this._ground.setLocalTransform(n)}_createHeatmapTex(){const e=this._layer.getRenderer().canvas,n=this.renderer.regl,i=n.hasExtension("OES_texture_half_float")?"half float":"float",o=Math.ceil(e.width/4),s=Math.ceil(e.height/4),a=n.texture({width:o,height:s,type:i,min:"linear",mag:"linear",format:"rgba"});this._heatmapFBO=n.framebuffer({width:o,height:s,color:[a]})}_createShader(){const e=this._layer.getRenderer().canvas,n=this.sceneConfig.depthRange,i={viewport:{x:0,y:0,width:()=>e?Math.ceil(e.width/4):1,height:()=>e?Math.ceil(e.height/4):1},depth:{enable:!0,func:"always"}};this._stencil&&(i.stencil=this._stencil),this._heatmapShader=new mP({extraCommandProps:i}),this._displayShader=new xP({x:0,y:0,width:()=>e?e.width:1,height:()=>e?e.height:1},{extraCommandProps:{stencil:{enable:!1},depth:{enable:!0,range:n||[0,1],func:"<="},polygonOffset:{enable:!0,offset:this._polygonOffset},scissor:{enable:!1}}})}}class ClipMask extends Mask{constructor(e,n){super(e,n)}_createMesh(e){const n=this._createGeometry(e),i=new bC(n);return this._setDefines(i),this._setLocalTransform(i),i}_updateUniforms(e,n,i){const o=this._getMaskMode();e.setUniform("maskMode",o);const s=this._getMaskColor();if(e.setUniform("maskColor",s),YI(n)){const o=this._getHeightRange();o[0]=(o[0]-i)*n,o[1]=(o[1]-i)*n,e.setUniform("heightRange",o)}}setHeightRange(e){this.options.heightRange=e,this._fireEvent("heightrangechange")}getHeightRange(){return this.options.heightRange}_getHeightRange(){const e=[0,0];return this.options.heightRange&&(e[0]=this._altitudeToPoint(this.options.heightRange[0]),e[1]=this._altitudeToPoint(this.options.heightRange[1])),e}_setDefines(e){const n=e.getDefines();n.HAS_MASK_COLOR=1,e.setDefines(n)}}class ClipInsideMask extends ClipMask{constructor(e,n){super(e,n),this._mode="clip-inside"}}class ClipOutsideMask extends ClipMask{constructor(e,n){super(e,n),this._mode="clip-outside"}}class FlatMask extends Mask{constructor(e,n){super(e,n)}setFlatheight(e){this.options.flatHeight=e,this._fireEvent("flatheightchange")}_createMesh(e){const n=this._createGeometry(e),i=new bC(n);return this._setDefines(i),this._setLocalTransform(i),i}_updateUniforms(e){const n=this._getMaskMode();e.setUniform("maskMode",n);const i=this._getMaskColor();e.setUniform("maskColor",i);const o=this._altitudeToPoint(this.options.flatHeight||0);e.setUniform("flatHeight",o)}_setDefines(e){const n=e.getDefines();n.HAS_MASK_FLAT=1,e.setDefines(n)}_getHeightRange(){const e=[0,this.options.flatHeight];return e[1]=this._altitudeToPoint(e[1]),e}}let sD=class FlatInsideMask extends FlatMask{constructor(e,n){super(e,n),this._mode="flat-inside"}};class FlatInsideMask extends FlatMask{constructor(e,n){super(e,n),this._mode="flat-outside"}}class ColorMask extends Mask{constructor(e,n){super(e,n),this._mode="color"}setHeightRange(e){this.options.heightRange=e,this._fireEvent("heightrangechange")}_createMesh(e){const n=this._createGeometry(e),i=new bC(n);return this._setDefines(i),this._setLocalTransform(i),i}_updateUniforms(e,n,i){const o=this._getMaskMode();e.setUniform("maskMode",o);const s=this._getMaskColor();if(e.setUniform("maskColor",s),YI(n)){const o=this._getHeightRange();o[0]=(o[0]-i)*n,o[1]=(o[1]-i)*n,e.setUniform("heightRange",o)}}_setDefines(e){const n=e.getDefines();n.HAS_MASK_COLOR=1,e.setDefines(n)}_getHeightRange(){const e=[0,0];return this.options.heightRange&&(e[0]=this._altitudeToPoint(this.options.heightRange[0]),e[1]=this._altitudeToPoint(this.options.heightRange[1])),e}}class VideoMask extends Mask{constructor(e,n){super(e,n),this._mode="video"}play(){this._video&&this._video.play()}pause(){this._video&&this._video.pause()}setAudio(e){this._video&&(this.video.muted=e)}setUrl(e){this.options.url=e,this._createVideo(e)}getState(){return this._videoState}_createMesh(e){const n=this._createGeometry(e),i=new bC(n),o=this._createVideoTexture(e);return i.material=new cC({maskTexture:o}),this._setDefines(i),this._setLocalTransform(i),i}_updateUniforms(e){const n=this._getMaskMode();e.setUniform("maskMode",n);const i=this._getMaskColor();e.setUniform("maskColor",i)}_setDefines(e){const n=e.getDefines();n.HAS_VIDEO=1,e.setDefines(n)}_createVideoTexture(e){this._createVideo();return e.texture()}_createVideo(){this._videoState="stop";const e=this.options.url;let n=document.getElementById(this.options.elementId);if(e&&(n=document.createElement("video"),n.src=e),!n)throw new Error("there is no element or url setting for video mask");n.autoplay=this.options.autoplay||!0,n.loop=this.options.loop||!0,n.muted=this.options.muted||!0,n.play(),n.addEventListener("playing",(()=>{this._videoState="playing"})),n.addEventListener("pause",(()=>{this._videoState="pause"})),this._video=n}_update(){const e=this._mesh;if(e&&e.material){const n=e.material.get("maskTexture");n&&this._video&&this._needUpdate()&&n(this._video)}}_needUpdate(){return"playing"===this._videoState}}class ElevateMask extends FlatMask{constructor(e,n){super(e,n),this.setElevation(n.elevation),this._mode="elevate"}setElevation(e){this.options.elevation=e,this.setFlatheight(this.options.elevation)}}const aD=new ee(0,0),hD=new ee(0,0),lD=new ee(0,0),uD=new ee(0,0);class BoxClipMask extends ClipMask{constructor(e,n){super([],n),this._position=e}setPosition(e){this._position=e,this._updateCoordinates()}getPosition(){return this._position}setWidth(e){this.options.width=e,this._updateCoordinates()}setLength(e){this.options.length=e,this._updateCoordinates()}setHeight(e){this.options.height=e,this._updateCoordinates()}setRotation(e){this.options.rotation=e,this._updateCoordinates()}_updateCoordinates(){const e=this.getLayer();if(!e)return;const n=e.getMap();if(n){const{length:e,width:i,height:o}=this.options,s=this._position,a=this.options.rotation||0,{coordinates:h,heightRange:l}=this._generateCoordinates(n,s,e,i,o,a);this.setCoordinates(h),this.setHeightRange(l)}}_generateCoordinates(e,n,i,o,s,a){const h=e.getGLRes(),l=e.distanceToPointAtRes(o/2,0,h,aD),c=e.distanceToPointAtRes(0,i/2,h,hD),A=e.coordinateToPointAtRes(n,h,lD),f=A.x-l.x,d=A.x+l.x,p=A.y+c.y,g=A.y-c.y,v=this._rotatePoint([[f,p],[d,p],[d,g],[f,g]],A,a);uD.set(v[0][0],v[0][1]);const w=e.pointAtResToCoordinate(uD,h);uD.set(v[1][0],v[1][1]);const C=e.pointAtResToCoordinate(uD,h);uD.set(v[2][0],v[2][1]);const P=e.pointAtResToCoordinate(uD,h);uD.set(v[3][0],v[3][1]);const T=e.pointAtResToCoordinate(uD,h),S=n.z-s/2;return{coordinates:[[w.x,w.y,S],[C.x,C.y,S],[P.x,P.y,S],[T.x,T.y,S],[w.x,w.y,S]],heightRange:[S,n.z+s/2]}}_rotatePoint(e,n,i){for(let o=0;o<e.length;o++)ob(e[o],e[o],[n.x,n.y],i*Math.PI/180);return e}}class BoxInsideClipper extends BoxClipMask{constructor(e,n){super(e,n),this._mode="clip-inside"}}class BoxOutsideClipper extends BoxClipMask{constructor(e,n){super(e,n),this._mode="clip-outside"}}"undefined"!=typeof window&&window.maptalks&&(window.maptalks.GroupGLLayer=GroupGLLayer,window.maptalks.ClipInsideMask=ClipInsideMask,window.maptalks.ClipOutsideMask=ClipOutsideMask,window.maptalks.FlatInsideMask=sD,window.maptalks.FlatOutsideMask=FlatInsideMask,window.maptalks.ElevateMask=ElevateMask,window.maptalks.ColorMask=ColorMask,window.maptalks.VideoMask=VideoMask,window.maptalks.BoxInsideClipMask=BoxInsideClipper,window.maptalks.BoxOutsideClipMask=BoxOutsideClipper,window.maptalks.RayCaster=RayCaster);const cD=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")},AD=cD(),fD=AD.gl_trans__coders=AD.gl_trans__coders||{};fD.inject=function(e){const n=e.toString(),i=n.indexOf("{")+1,o=n.substring(0,i),s=AD.gl_trans__coders=AD.gl_trans__coders||{};let a=`${o}\n    const _____getGlobal = ${cD.toString()};\n    const g___lobals = _____getGlobal()\n    const tran_____scoders = g___lobals['gl_trans__coders'] = g___lobals['gl_trans__coders'] || {};`;for(const e in s)"inject"!==e&&"getTranscoder"!==e&&"registerTranscoder"!==e&&(a+='tran_____scoders["'+e+'"] ='+s[e].toString()+"\n;");return a+="\n"+n.substring(o.length),a},fD.registerTranscoder=function(e,n){fD[e]=n},fD.getTranscoder=function(e){return fD[e]};const dD="${";let pD;na("@maptalks/terrain",`function(e){\n/*!\n     * @maptalks/gltf-loader v0.98.4\n     * LICENSE : UNLICENSED\n     * (c) 2016-2024 maptalks.org\n     */\nvar n,t,r="undefined"!=typeof Float32Array?Float32Array:Array;function o(){var e=new r(3);return r!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function i(e,n,t){var o=new r(3);return o[0]=e,o[1]=n,o[2]=t,o}function a(){var e=new r(4);return r!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}Math.hypot||(Math.hypot=function(){for(var e=0,n=arguments.length;n--;)e+=arguments[n]*arguments[n];return Math.sqrt(e)}),o(),n=new r(4),r!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),o(),i(1,0,0),i(0,1,0),a(),a(),t=new r(9),r!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1;let s=0;!function(e){e[0]=0,e[1]=0,e[2]=0,e[3]=1}([]),"undefined"!=typeof TextDecoder&&new TextDecoder("utf-8");const c={get:function(e,n={},t){n||(n={});const r=new AbortController,o=r.signal,i=function(e){for(let n=1;n<arguments.length;n++){const t=arguments[n];for(const n in t)e[n]=t[n]}return e}({},n);i.signal=o,i.method||(i.method="GET"),i.referrerPolicy=i.referrerPolicy||"origin","undefined"==typeof window||i.referrer||(i.referrer=window.location.href),t&&(e=t(e));const a=fetch(e,i).then((e=>{const t=this._(e,n.responseType);return t.message?t:t.then((t=>"arraybuffer"===n.responseType?{data:t,cacheControl:e.headers.get("Cache-Control"),expires:e.headers.get("Expires"),contentType:e.headers.get("Content-Type")}:t)).catch((e=>{if(!e.code||e.code!==DOMException.ABORT_ERR)throw e}))})).catch((e=>{if(!e.code||e.code!==DOMException.ABORT_ERR)throw e}));return a.xhr=r,a},_:(e,n)=>200!==e.status?{status:e.status,statusText:e.statusText,message:\`incorrect http request with status code(${dD}e.status}): ${dD}e.statusText}\`}:"arraybuffer"===n?e.arrayBuffer():"json"===n?e.json():e.text(),getArrayBuffer:(e,n={},t)=>(n||(n={}),n.responseType="arraybuffer",c.get(e,n,t)),getJSON:function(e,n={},t){return n&&n.jsonp?c.jsonp(e):((n=n||{}).responseType="json",c.get(e,n,t))},jsonp:function(e){const n="_maptalks_jsonp_"+s++;e.match(/\\?/)?e+="&callback="+n:e+="?callback="+n;let t=document.createElement("script");return t.type="text/javascript",t.src=e,new Promise((e=>{window[n]=function(r){document.getElementsByTagName("head")[0].removeChild(t),t=null,delete window[n],e(r)},document.getElementsByTagName("head")[0].appendChild(t)}))}};if("undefined"!=typeof TextDecoder&&new TextDecoder("utf-8"),"undefined"!=typeof OffscreenCanvas){let e;try{e=new OffscreenCanvas(2,2).getContext("2d")}catch(r){}}"undefined"!=typeof document&&document.createElement("canvas"),function(){function e(e){throw e}var n=void 0,t=!0,r=this;function o(e,t){var o,i=e.split("."),a=r;!(i[0]in a)&&a.execScript&&a.execScript("var "+i[0]);for(;i.length&&(o=i.shift());)i.length||t===n?a=a[o]?a[o]:a[o]={}:a[o]=t}var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function a(n,t){this.index="number"==typeof t?t:0,this.i=0,this.buffer=n instanceof(i?Uint8Array:Array)?n:new(i?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&e(Error("invalid index")),this.buffer.length<=this.index&&this.f()}a.prototype.f=function(){var e,n=this.buffer,t=n.length,r=new(i?Uint8Array:Array)(t<<1);if(i)r.set(n);else for(e=0;e<t;++e)r[e]=n[e];return this.buffer=r},a.prototype.d=function(e,n,t){var r,o=this.buffer,i=this.index,a=this.i,s=o[i];if(t&&1<n&&(e=8<n?(d[255&e]<<24|d[e>>>8&255]<<16|d[e>>>16&255]<<8|d[e>>>24&255])>>32-n:d[e]>>8-n),8>n+a)s=s<<n|e,a+=n;else for(r=0;r<n;++r)s=s<<1|e>>n-r-1&1,8==++a&&(a=0,o[i++]=d[s],s=0,i===o.length&&(o=this.f()));o[i]=s,this.buffer=o,this.i=a,this.index=i},a.prototype.finish=function(){var e,n=this.buffer,t=this.index;return 0<this.i&&(n[t]<<=8-this.i,n[t]=d[n[t]],t++),i?e=n.subarray(0,t):(n.length=t,e=n),e};var s,c=new(i?Uint8Array:Array)(256);for(s=0;256>s;++s){for(var f=h=s,l=7,h=h>>>1;h;h>>>=1)f<<=1,f|=1&h,--l;c[s]=(f<<l&255)>>>0}var d=c;function u(e){this.buffer=new(i?Uint16Array:Array)(2*e),this.length=0}function v(e){var n,t,r,o,a,s,c,f,l,h,d=e.length,u=0,v=Number.POSITIVE_INFINITY;for(f=0;f<d;++f)e[f]>u&&(u=e[f]),e[f]<v&&(v=e[f]);for(n=1<<u,t=new(i?Uint32Array:Array)(n),r=1,o=0,a=2;r<=u;){for(f=0;f<d;++f)if(e[f]===r){for(s=0,c=o,l=0;l<r;++l)s=s<<1|1&c,c>>=1;for(h=r<<16|f,l=s;l<n;l+=a)t[l]=h;++o}++r,o<<=1,a<<=1}return[t,u,v]}function _(e,n){this.h=g,this.w=0,this.input=i&&e instanceof Array?new Uint8Array(e):e,this.b=0,n&&(n.lazy&&(this.w=n.lazy),"number"==typeof n.compressionType&&(this.h=n.compressionType),n.outputBuffer&&(this.a=i&&n.outputBuffer instanceof Array?new Uint8Array(n.outputBuffer):n.outputBuffer),"number"==typeof n.outputIndex&&(this.b=n.outputIndex)),this.a||(this.a=new(i?Uint8Array:Array)(32768))}u.prototype.getParent=function(e){return 2*((e-2)/4|0)},u.prototype.push=function(e,n){var t,r,o,i=this.buffer;for(t=this.length,i[this.length++]=n,i[this.length++]=e;0<t&&(r=this.getParent(t),i[t]>i[r]);)o=i[t],i[t]=i[r],i[r]=o,o=i[t+1],i[t+1]=i[r+1],i[r+1]=o,t=r;return this.length},u.prototype.pop=function(){var e,n,t,r,o,i=this.buffer;for(n=i[0],e=i[1],this.length-=2,i[0]=i[this.length],i[1]=i[this.length+1],o=0;!((r=2*o+2)>=this.length)&&(r+2<this.length&&i[r+2]>i[r]&&(r+=2),i[r]>i[o]);)t=i[o],i[o]=i[r],i[r]=t,t=i[o+1],i[o+1]=i[r+1],i[r+1]=t,o=r;return{index:e,value:n,length:this.length}};var m,g=2,x={NONE:0,r:1,k:g,N:3},p=[];for(m=0;288>m;m++)switch(t){case 143>=m:p.push([m+48,8]);break;case 255>=m:p.push([m-144+400,9]);break;case 279>=m:p.push([m-256+0,7]);break;case 287>=m:p.push([m-280+192,8]);break;default:e("invalid literal: "+m)}function A(e,n){this.length=e,this.G=n}_.prototype.j=function(){var r,o,s,c,f=this.input;switch(this.h){case 0:for(s=0,c=f.length;s<c;){var l,h,d,u=o=i?f.subarray(s,s+65535):f.slice(s,s+65535),v=(s+=o.length)===c,_=n,m=n,x=this.a,A=this.b;if(i){for(x=new Uint8Array(this.a.buffer);x.length<=A+u.length+5;)x=new Uint8Array(x.length<<1);x.set(this.a)}if(l=v?1:0,x[A++]=0|l,d=65536+~(h=u.length)&65535,x[A++]=255&h,x[A++]=h>>>8&255,x[A++]=255&d,x[A++]=d>>>8&255,i)x.set(u,A),A+=u.length,x=x.subarray(0,A);else{for(_=0,m=u.length;_<m;++_)x[A++]=u[_];x.length=A}this.b=A,this.a=x}break;case 1:var y=new a(i?new Uint8Array(this.a.buffer):this.a,this.b);y.d(1,1,t),y.d(1,2,t);var b,E,O,S=w(this,f);for(b=0,E=S.length;b<E;b++)if(O=S[b],a.prototype.d.apply(y,p[O]),256<O)y.d(S[++b],S[++b],t),y.d(S[++b],5),y.d(S[++b],S[++b],t);else if(256===O)break;this.a=y.finish(),this.b=this.a.length;break;case g:var C,M,H,k,N,P,D,R,U,L,F,z,W,G,V,j=new a(i?new Uint8Array(this.a.buffer):this.a,this.b),X=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],K=Array(19);for(C=g,j.d(1,1,t),j.d(C,2,t),M=w(this,f),D=T(P=I(this.L,15)),U=T(R=I(this.K,7)),H=286;257<H&&0===P[H-1];H--);for(k=30;1<k&&0===R[k-1];k--);var B,q,Z,Y,J,$,Q=H,ee=k,ne=new(i?Uint32Array:Array)(Q+ee),te=new(i?Uint32Array:Array)(316),re=new(i?Uint8Array:Array)(19);for(B=q=0;B<Q;B++)ne[q++]=P[B];for(B=0;B<ee;B++)ne[q++]=R[B];if(!i)for(B=0,Y=re.length;B<Y;++B)re[B]=0;for(B=J=0,Y=ne.length;B<Y;B+=q){for(q=1;B+q<Y&&ne[B+q]===ne[B];++q);if(Z=q,0===ne[B])if(3>Z)for(;0<Z--;)te[J++]=0,re[0]++;else for(;0<Z;)($=138>Z?Z:138)>Z-3&&$<Z&&($=Z-3),10>=$?(te[J++]=17,te[J++]=$-3,re[17]++):(te[J++]=18,te[J++]=$-11,re[18]++),Z-=$;else if(te[J++]=ne[B],re[ne[B]]++,3>--Z)for(;0<Z--;)te[J++]=ne[B],re[ne[B]]++;else for(;0<Z;)($=6>Z?Z:6)>Z-3&&$<Z&&($=Z-3),te[J++]=16,te[J++]=$-3,re[16]++,Z-=$}for(r=i?te.subarray(0,J):te.slice(0,J),L=I(re,7),G=0;19>G;G++)K[G]=L[X[G]];for(N=19;4<N&&0===K[N-1];N--);for(F=T(L),j.d(H-257,5,t),j.d(k-1,5,t),j.d(N-4,4,t),G=0;G<N;G++)j.d(K[G],3,t);for(G=0,V=r.length;G<V;G++)if(z=r[G],j.d(F[z],L[z],t),16<=z){switch(G++,z){case 16:W=2;break;case 17:W=3;break;case 18:W=7;break;default:e("invalid code: "+z)}j.d(r[G],W,t)}var oe,ie,ae,se,ce,fe,le,he,de=[D,P],ue=[U,R];for(ce=de[0],fe=de[1],le=ue[0],he=ue[1],oe=0,ie=M.length;oe<ie;++oe)if(ae=M[oe],j.d(ce[ae],fe[ae],t),256<ae)j.d(M[++oe],M[++oe],t),se=M[++oe],j.d(le[se],he[se],t),j.d(M[++oe],M[++oe],t);else if(256===ae)break;this.a=j.finish(),this.b=this.a.length;break;default:e("invalid compression type")}return this.a};var y=function(){function n(n){switch(t){case 3===n:return[257,n-3,0];case 4===n:return[258,n-4,0];case 5===n:return[259,n-5,0];case 6===n:return[260,n-6,0];case 7===n:return[261,n-7,0];case 8===n:return[262,n-8,0];case 9===n:return[263,n-9,0];case 10===n:return[264,n-10,0];case 12>=n:return[265,n-11,1];case 14>=n:return[266,n-13,1];case 16>=n:return[267,n-15,1];case 18>=n:return[268,n-17,1];case 22>=n:return[269,n-19,2];case 26>=n:return[270,n-23,2];case 30>=n:return[271,n-27,2];case 34>=n:return[272,n-31,2];case 42>=n:return[273,n-35,3];case 50>=n:return[274,n-43,3];case 58>=n:return[275,n-51,3];case 66>=n:return[276,n-59,3];case 82>=n:return[277,n-67,4];case 98>=n:return[278,n-83,4];case 114>=n:return[279,n-99,4];case 130>=n:return[280,n-115,4];case 162>=n:return[281,n-131,5];case 194>=n:return[282,n-163,5];case 226>=n:return[283,n-195,5];case 257>=n:return[284,n-227,5];case 258===n:return[285,n-258,0];default:e("invalid length: "+n)}}var r,o,i=[];for(r=3;258>=r;r++)o=n(r),i[r]=o[2]<<24|o[1]<<16|o[0];return i}(),b=i?new Uint32Array(y):y;function w(r,o){function a(n,r){var o,i,a,s,c=n.G,f=[],l=0;switch(o=b[n.length],f[l++]=65535&o,f[l++]=o>>16&255,f[l++]=o>>24,t){case 1===c:i=[0,c-1,0];break;case 2===c:i=[1,c-2,0];break;case 3===c:i=[2,c-3,0];break;case 4===c:i=[3,c-4,0];break;case 6>=c:i=[4,c-5,1];break;case 8>=c:i=[5,c-7,1];break;case 12>=c:i=[6,c-9,2];break;case 16>=c:i=[7,c-13,2];break;case 24>=c:i=[8,c-17,3];break;case 32>=c:i=[9,c-25,3];break;case 48>=c:i=[10,c-33,4];break;case 64>=c:i=[11,c-49,4];break;case 96>=c:i=[12,c-65,5];break;case 128>=c:i=[13,c-97,5];break;case 192>=c:i=[14,c-129,6];break;case 256>=c:i=[15,c-193,6];break;case 384>=c:i=[16,c-257,7];break;case 512>=c:i=[17,c-385,7];break;case 768>=c:i=[18,c-513,8];break;case 1024>=c:i=[19,c-769,8];break;case 1536>=c:i=[20,c-1025,9];break;case 2048>=c:i=[21,c-1537,9];break;case 3072>=c:i=[22,c-2049,10];break;case 4096>=c:i=[23,c-3073,10];break;case 6144>=c:i=[24,c-4097,11];break;case 8192>=c:i=[25,c-6145,11];break;case 12288>=c:i=[26,c-8193,12];break;case 16384>=c:i=[27,c-12289,12];break;case 24576>=c:i=[28,c-16385,13];break;case 32768>=c:i=[29,c-24577,13];break;default:e("invalid distance")}for(o=i,f[l++]=o[0],f[l++]=o[1],f[l++]=o[2],a=0,s=f.length;a<s;++a)g[x++]=f[a];A[f[0]]++,y[f[3]]++,p=n.length+r-1,v=null}var s,c,f,l,h,d,u,v,_,m={},g=i?new Uint16Array(2*o.length):[],x=0,p=0,A=new(i?Uint32Array:Array)(286),y=new(i?Uint32Array:Array)(30),w=r.w;if(!i){for(f=0;285>=f;)A[f++]=0;for(f=0;29>=f;)y[f++]=0}for(A[256]=1,s=0,c=o.length;s<c;++s){for(f=h=0,l=3;f<l&&s+f!==c;++f)h=h<<8|o[s+f];if(m[h]===n&&(m[h]=[]),d=m[h],!(0<p--)){for(;0<d.length&&32768<s-d[0];)d.shift();if(s+3>=c){for(v&&a(v,-1),f=0,l=c-s;f<l;++f)_=o[s+f],g[x++]=_,++A[_];break}0<d.length?(u=E(o,s,d),v?v.length<u.length?(_=o[s-1],g[x++]=_,++A[_],a(u,0)):a(v,-1):u.length<w?v=u:a(u,0)):v?a(v,-1):(_=o[s],g[x++]=_,++A[_])}d.push(s)}return g[x++]=256,A[256]++,r.L=A,r.K=y,i?g.subarray(0,x):g}function E(e,n,t){var r,o,i,a,s,c,f=0,l=e.length;a=0,c=t.length;e:for(;a<c;a++){if(r=t[c-a-1],i=3,3<f){for(s=f;3<s;s--)if(e[r+s-1]!==e[n+s-1])continue e;i=f}for(;258>i&&n+i<l&&e[r+i]===e[n+i];)++i;if(i>f&&(o=r,f=i),258===i)break}return new A(f,n-o)}function I(e,n){var t,r,o,a,s,c=e.length,f=new u(572),l=new(i?Uint8Array:Array)(c);if(!i)for(a=0;a<c;a++)l[a]=0;for(a=0;a<c;++a)0<e[a]&&f.push(a,e[a]);if(t=Array(f.length/2),r=new(i?Uint32Array:Array)(f.length/2),1===t.length)return l[f.pop().index]=1,l;for(a=0,s=f.length/2;a<s;++a)t[a]=f.pop(),r[a]=t[a].value;for(o=function(e,n,t){function r(e){var t=v[e][_[e]];t===n?(r(e+1),r(e+1)):--d[t],++_[e]}var o,a,s,c,f,l=new(i?Uint16Array:Array)(t),h=new(i?Uint8Array:Array)(t),d=new(i?Uint8Array:Array)(n),u=Array(t),v=Array(t),_=Array(t),m=(1<<t)-n,g=1<<t-1;for(l[t-1]=n,a=0;a<t;++a)m<g?h[a]=0:(h[a]=1,m-=g),m<<=1,l[t-2-a]=(l[t-1-a]/2|0)+n;for(l[0]=h[0],u[0]=Array(l[0]),v[0]=Array(l[0]),a=1;a<t;++a)l[a]>2*l[a-1]+h[a]&&(l[a]=2*l[a-1]+h[a]),u[a]=Array(l[a]),v[a]=Array(l[a]);for(o=0;o<n;++o)d[o]=t;for(s=0;s<l[t-1];++s)u[t-1][s]=e[s],v[t-1][s]=s;for(o=0;o<t;++o)_[o]=0;for(1===h[t-1]&&(--d[0],++_[t-1]),a=t-2;0<=a;--a){for(c=o=0,f=_[a+1],s=0;s<l[a];s++)(c=u[a+1][f]+u[a+1][f+1])>e[o]?(u[a][s]=c,v[a][s]=n,f+=2):(u[a][s]=e[o],v[a][s]=o,++o);_[a]=0,1===h[a]&&r(a)}return d}(r,r.length,n),a=0,s=t.length;a<s;++a)l[t[a].index]=o[a];return l}function T(e){var n,t,r,o,a=new(i?Uint16Array:Array)(e.length),s=[],c=[],f=0;for(n=0,t=e.length;n<t;n++)s[e[n]]=1+(0|s[e[n]]);for(n=1,t=16;n<=t;n++)c[n]=f,f+=0|s[n],f<<=1;for(n=0,t=e.length;n<t;n++)for(f=c[e[n]],c[e[n]]+=1,r=a[n]=0,o=e[n];r<o;r++)a[n]=a[n]<<1|1&f,f>>>=1;return a}function O(n,t){switch(this.l=[],this.m=32768,this.e=this.g=this.c=this.q=0,this.input=i?new Uint8Array(n):n,this.s=!1,this.n=C,this.B=!1,!t&&(t={})||(t.index&&(this.c=t.index),t.bufferSize&&(this.m=t.bufferSize),t.bufferType&&(this.n=t.bufferType),t.resize&&(this.B=t.resize)),this.n){case S:this.b=32768,this.a=new(i?Uint8Array:Array)(32768+this.m+258);break;case C:this.b=0,this.a=new(i?Uint8Array:Array)(this.m),this.f=this.J,this.t=this.H,this.o=this.I;break;default:e(Error("invalid inflate mode"))}}var S=0,C=1,M={D:S,C:C};O.prototype.p=function(){for(;!this.s;){var r=Z(this,3);switch(1&r&&(this.s=t),r>>>=1){case 0:var o=this.input,a=this.c,s=this.a,c=this.b,f=o.length,l=n,h=s.length,d=n;switch(this.e=this.g=0,a+1>=f&&e(Error("invalid uncompressed block header: LEN")),l=o[a++]|o[a++]<<8,a+1>=f&&e(Error("invalid uncompressed block header: NLEN")),l===~(o[a++]|o[a++]<<8)&&e(Error("invalid uncompressed block header: length verify")),a+l>o.length&&e(Error("input buffer is broken")),this.n){case S:for(;c+l>s.length;){if(l-=d=h-c,i)s.set(o.subarray(a,a+d),c),c+=d,a+=d;else for(;d--;)s[c++]=o[a++];this.b=c,s=this.f(),c=this.b}break;case C:for(;c+l>s.length;)s=this.f({v:2});break;default:e(Error("invalid inflate mode"))}if(i)s.set(o.subarray(a,a+l),c),c+=l,a+=l;else for(;l--;)s[c++]=o[a++];this.c=a,this.b=c,this.a=s;break;case 1:this.o(K,q);break;case 2:var u,_,m,g,x=Z(this,5)+257,p=Z(this,5)+1,A=Z(this,4)+4,y=new(i?Uint8Array:Array)(P.length),b=n,w=n,E=n,I=n,T=n;for(T=0;T<A;++T)y[P[T]]=Z(this,3);if(!i)for(T=A,A=y.length;T<A;++T)y[P[T]]=0;for(u=v(y),b=new(i?Uint8Array:Array)(x+p),T=0,g=x+p;T<g;)switch(w=Y(this,u),w){case 16:for(I=3+Z(this,2);I--;)b[T++]=E;break;case 17:for(I=3+Z(this,3);I--;)b[T++]=0;E=0;break;case 18:for(I=11+Z(this,7);I--;)b[T++]=0;E=0;break;default:E=b[T++]=w}_=v(i?b.subarray(0,x):b.slice(0,x)),m=v(i?b.subarray(x):b.slice(x)),this.o(_,m);break;default:e(Error("unknown BTYPE: "+r))}}return this.t()};var H,k,N=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],P=i?new Uint16Array(N):N,D=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],R=i?new Uint16Array(D):D,U=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],L=i?new Uint8Array(U):U,F=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],z=i?new Uint16Array(F):F,W=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],G=i?new Uint8Array(W):W,V=new(i?Uint8Array:Array)(288);for(H=0,k=V.length;H<k;++H)V[H]=143>=H?8:255>=H?9:279>=H?7:8;var j,X,K=v(V),B=new(i?Uint8Array:Array)(30);for(j=0,X=B.length;j<X;++j)B[j]=5;var q=v(B);function Z(n,t){for(var r,o=n.g,i=n.e,a=n.input,s=n.c,c=a.length;i<t;)s>=c&&e(Error("input buffer is broken")),o|=a[s++]<<i,i+=8;return r=o&(1<<t)-1,n.g=o>>>t,n.e=i-t,n.c=s,r}function Y(n,t){for(var r,o,i=n.g,a=n.e,s=n.input,c=n.c,f=s.length,l=t[0],h=t[1];a<h&&!(c>=f);)i|=s[c++]<<a,a+=8;return(o=(r=l[i&(1<<h)-1])>>>16)>a&&e(Error("invalid code length: "+o)),n.g=i>>o,n.e=a-o,n.c=c,65535&r}function J(e){if("string"==typeof e){var n,t,r=e.split("");for(n=0,t=r.length;n<t;n++)r[n]=(255&r[n].charCodeAt(0))>>>0;e=r}for(var o,i=1,a=0,s=e.length,c=0;0<s;){s-=o=1024<s?1024:s;do{a+=i+=e[c++]}while(--o);i%=65521,a%=65521}return(a<<16|i)>>>0}function $(n,t){var r,o;if(this.input=n,this.c=0,!t&&(t={})||(t.index&&(this.c=t.index),t.verify&&(this.M=t.verify)),r=n[this.c++],o=n[this.c++],(15&r)===Q)this.method=Q;else e(Error("unsupported compression method"));0!=((r<<8)+o)%31&&e(Error("invalid fcheck flag:"+((r<<8)+o)%31)),32&o&&e(Error("fdict flag is not supported")),this.A=new O(n,{index:this.c,bufferSize:t.bufferSize,bufferType:t.bufferType,resize:t.resize})}O.prototype.o=function(e,n){var t=this.a,r=this.b;this.u=e;for(var o,i,a,s,c=t.length-258;256!==(o=Y(this,e));)if(256>o)r>=c&&(this.b=r,t=this.f(),r=this.b),t[r++]=o;else for(s=R[i=o-257],0<L[i]&&(s+=Z(this,L[i])),o=Y(this,n),a=z[o],0<G[o]&&(a+=Z(this,G[o])),r>=c&&(this.b=r,t=this.f(),r=this.b);s--;)t[r]=t[r++-a];for(;8<=this.e;)this.e-=8,this.c--;this.b=r},O.prototype.I=function(e,n){var t=this.a,r=this.b;this.u=e;for(var o,i,a,s,c=t.length;256!==(o=Y(this,e));)if(256>o)r>=c&&(c=(t=this.f()).length),t[r++]=o;else for(s=R[i=o-257],0<L[i]&&(s+=Z(this,L[i])),o=Y(this,n),a=z[o],0<G[o]&&(a+=Z(this,G[o])),r+s>c&&(c=(t=this.f()).length);s--;)t[r]=t[r++-a];for(;8<=this.e;)this.e-=8,this.c--;this.b=r},O.prototype.f=function(){var e,n,t=new(i?Uint8Array:Array)(this.b-32768),r=this.b-32768,o=this.a;if(i)t.set(o.subarray(32768,t.length));else for(e=0,n=t.length;e<n;++e)t[e]=o[e+32768];if(this.l.push(t),this.q+=t.length,i)o.set(o.subarray(r,r+32768));else for(e=0;32768>e;++e)o[e]=o[r+e];return this.b=32768,o},O.prototype.J=function(e){var n,t,r,o=this.input.length/this.c+1|0,a=this.input,s=this.a;return e&&("number"==typeof e.v&&(o=e.v),"number"==typeof e.F&&(o+=e.F)),2>o?t=(r=(a.length-this.c)/this.u[2]/2*258|0)<s.length?s.length+r:s.length<<1:t=s.length*o,i?(n=new Uint8Array(t)).set(s):n=s,this.a=n},O.prototype.t=function(){var e,n,t,r,o,a=0,s=this.a,c=this.l,f=new(i?Uint8Array:Array)(this.q+(this.b-32768));if(0===c.length)return i?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(n=0,t=c.length;n<t;++n)for(r=0,o=(e=c[n]).length;r<o;++r)f[a++]=e[r];for(n=32768,t=this.b;n<t;++n)f[a++]=s[n];return this.l=[],this.buffer=f},O.prototype.H=function(){var e,n=this.b;return i?this.B?(e=new Uint8Array(n)).set(this.a.subarray(0,n)):e=this.a.subarray(0,n):(this.a.length>n&&(this.a.length=n),e=this.a),this.buffer=e},$.prototype.p=function(){var n,t=this.input;return n=this.A.p(),this.c=this.A.c,this.M&&((t[this.c++]<<24|t[this.c++]<<16|t[this.c++]<<8|t[this.c++])>>>0!==J(n)&&e(Error("invalid adler-32 checksum"))),n};var Q=8;function ee(e,n){this.input=e,this.a=new(i?Uint8Array:Array)(32768),this.h=ne.k;var t,r={};for(t in!n&&(n={})||"number"!=typeof n.compressionType||(this.h=n.compressionType),n)r[t]=n[t];r.outputBuffer=this.a,this.z=new _(this.input,r)}var ne=x;function te(e,n){var t,r,i,a;if(Object.keys)t=Object.keys(n);else for(r in t=[],i=0,n)t[i++]=r;for(i=0,a=t.length;i<a;++i)o(e+"."+(r=t[i]),n[r])}ee.prototype.j=function(){var n,t,r,o,a,s,c,f=0;if(c=this.a,(n=Q)===Q)t=Math.LOG2E*Math.log(32768)-8;else e(Error("invalid compression method"));if(r=t<<4|n,c[f++]=r,n===Q)switch(this.h){case ne.NONE:a=0;break;case ne.r:a=1;break;case ne.k:a=2;break;default:e(Error("unsupported compression type"))}else e(Error("invalid compression method"));return o=a<<6,c[f++]=o|31-(256*r+o)%31,s=J(this.input),this.z.b=f,f=(c=this.z.j()).length,i&&((c=new Uint8Array(c.buffer)).length<=f+4&&(this.a=new Uint8Array(c.length+4),this.a.set(c),c=this.a),c=c.subarray(0,f+4)),c[f++]=s>>24&255,c[f++]=s>>16&255,c[f++]=s>>8&255,c[f++]=255&s,c},o("Zlib.Inflate",$),o("Zlib.Inflate.prototype.decompress",$.prototype.p),te("Zlib.Inflate.BufferType",{ADAPTIVE:M.C,BLOCK:M.D}),o("Zlib.Deflate",ee),o("Zlib.Deflate.compress",(function(e,n){return new ee(e,n).j()})),o("Zlib.Deflate.prototype.compress",ee.prototype.j),te("Zlib.Deflate.CompressionType",{NONE:ne.NONE,FIXED:ne.r,DYNAMIC:ne.k})}.call(self);var f="undefined"!=typeof Float32Array?Float32Array:Array;function l(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}Math.hypot||(Math.hypot=function(){for(var e=0,n=arguments.length;n--;)e+=arguments[n]*arguments[n];return Math.sqrt(e)});function h(){var e=new f(3);return f!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function d(e,n,t){var r=new f(3);return r[0]=e,r[1]=n,r[2]=t,r}function u(e,n){var t=n[0],r=n[1],o=n[2],i=t*t+r*r+o*o;return i>0&&(i=1/Math.sqrt(i)),e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e}function v(e,n,t){var r=n[0],o=n[1],i=n[2],a=t[0],s=t[1],c=t[2];return e[0]=o*c-i*s,e[1]=i*a-r*c,e[2]=r*s-o*a,e}var _=function(e,n,t){return e[0]=n[0]-t[0],e[1]=n[1]-t[1],e[2]=n[2]-t[2],e};function m(){var e=new f(4);return f!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}h(),function(){var e,n=(e=new f(4),f!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e)}();var g;function x(e,n,t){return e[0]=n,e[1]=t,e}h(),d(1,0,0),d(0,1,0),m(),m(),g=new f(9),f!=Float32Array&&(g[1]=0,g[2]=0,g[3]=0,g[5]=0,g[6]=0,g[7]=0),g[0]=1,g[4]=1,g[8]=1,function(){var e=function(){var e=new f(2);return f!=Float32Array&&(e[0]=0,e[1]=0),e}()}(),\n/*!\n     * @maptalks/reshader.gl v0.101.1\n     * LICENSE : UNLICENSED\n     * (c) 2016-2024 maptalks.com\n     */\nl([]),l([]),new Array(16),function(){const e=new ArrayBuffer(4),n=new Float32Array(e),t=new Uint32Array(e),r=new Uint32Array(512),o=new Uint32Array(512);for(let e=0;e<256;++e){const n=e-127;n<-27?(r[e]=0,r[256|e]=32768,o[e]=24,o[256|e]=24):n<-14?(r[e]=1024>>-n-14,r[256|e]=1024>>-n-14|32768,o[e]=-n-1,o[256|e]=-n-1):n<=15?(r[e]=n+15<<10,r[256|e]=n+15<<10|32768,o[e]=13,o[256|e]=13):n<128?(r[e]=31744,r[256|e]=64512,o[e]=24,o[256|e]=24):(r[e]=31744,r[256|e]=64512,o[e]=13,o[256|e]=13)}const i=new Uint32Array(2048),a=new Uint32Array(64),s=new Uint32Array(64);for(let e=1;e<1024;++e){let n=e<<13,t=0;for(;!(8388608&n);)n<<=1,t-=8388608;n&=-8388609,t+=947912704,i[e]=n|t}for(let e=1024;e<2048;++e)i[e]=939524096+(e-1024<<13);for(let e=1;e<31;++e)a[e]=e<<23;a[31]=1199570944,a[32]=2147483648;for(let e=33;e<63;++e)a[e]=2147483648+(e-32<<23);a[63]=3347054592;for(let e=1;e<64;++e)32!==e&&(s[e]=1024)}();const p={vsm_shadow_vert:"\\nuniform mat4 shadow_lightProjViewModelMatrix;\\nvarying vec4 shadow_vLightSpacePos;\\nvoid shadow_computeShadowPars(vec4 position) {\\n    shadow_vLightSpacePos = shadow_lightProjViewModelMatrix * position;\\n}",vsm_shadow_frag:"\\nuniform sampler2D shadow_shadowMap;\\nuniform float shadow_opacity;\\nuniform vec3 shadow_color;\\n#if defined(USE_ESM)\\n    uniform float esm_shadow_threshold;\\n#endif\\nvarying vec4 shadow_vLightSpacePos;\\n#ifdef PACK_FLOAT\\n    #include <common_pack_float>\\n#endif\\n#if defined(USE_ESM)\\nfloat esm(vec3 projCoords, vec4 shadowTexel) {\\n    float compare = projCoords.z;\\n    float c = 120.0;\\n    #ifdef PACK_FLOAT\\n        float depth = common_decodeDepth(shadowTexel);\\n        if (depth >= 1.0 - 1E-6 || compare <= depth) {\\n            return 1.0;\\n        }\\n    #else\\n        float depth = shadowTexel.r;\\n    #endif\\n    depth = exp(-c * min(compare - depth, 0.05));\\n    return clamp(depth, esm_shadow_threshold, 1.0);\\n}\\n#endif\\n#if defined(USE_VSM)\\nfloat vsm_shadow_chebyshevUpperBound(vec3 projCoords, vec4 shadowTexel){\\n    vec2 moments = shadowTexel.rg;\\n    float distance = projCoords.z;\\n    if (distance >= 1.0 || distance <= moments.x)\\n        return 1.0 ;\\n    float variance = moments.y - (moments.x * moments.x);\\n    variance = max(variance, 0.00002);\\n    float d = distance - moments.x;\\n    float p_max = variance / (variance + d * d);\\n    return p_max;\\n}\\n#endif\\nfloat shadow_computeShadow_coeff(sampler2D shadowMap, vec3 projCoords) {\\n    vec2 uv = projCoords.xy;\\n    vec4 shadowTexel = texture2D(shadowMap, uv);\\n    #if defined(USE_ESM)\\n        float esm_coeff = esm(projCoords, shadowTexel);\\n        float coeff = esm_coeff * esm_coeff;\\n    #endif\\n    #if defined(USE_VSM)\\n        float vsm_coeff = vsm_shadow_chebyshevUpperBound(projCoords, shadowTexel);\\n        float coeff = vsm_coeff;\\n    #endif\\n    return 1.0 - (1.0 - coeff) * shadow_opacity;\\n}\\nfloat shadow_computeShadow() {\\n    vec3 projCoords = shadow_vLightSpacePos.xyz / shadow_vLightSpacePos.w;\\n    projCoords = projCoords * 0.5 + 0.5;\\n    if(projCoords.z >= 1.0 || projCoords.x < 0.0 || projCoords.x > 1.0 || projCoords.y < 0.0 || projCoords.y > 1.0) return 1.0;\\n    return shadow_computeShadow_coeff(shadow_shadowMap, projCoords);\\n}\\nvec3 shadow_blend(vec3 color, float coeff) {\\n    color = color * coeff + shadow_color * shadow_opacity * (1.0 - coeff);\\n    return color;\\n}",fbo_picking_vert:"\\n#ifdef ENABLE_PICKING\\n#if HAS_PICKING_ID == 1\\nattribute float aPickingId;\\n#elif HAS_PICKING_ID == 2\\nuniform float uPickingId;\\n#endif\\nvarying float vPickingId;\\nvarying float vFbo_picking_viewZ;\\nvarying float vFbo_picking_visible;\\n#endif\\nvarying float vFbo_picking_fragDepth;\\nvoid fbo_picking_setData(float viewPosZ, bool visible) {\\n    #ifdef ENABLE_PICKING\\n    #if HAS_PICKING_ID == 1\\n       vPickingId = aPickingId;\\n    #elif HAS_PICKING_ID == 2\\n        vPickingId = uPickingId;\\n    #endif\\n        vFbo_picking_viewZ = viewPosZ;\\n    #endif\\n    vFbo_picking_visible = visible ? 1.0 : 0.0;\\n    vFbo_picking_fragDepth = viewPosZ + 1.0;\\n}",common_pack_float:"const float COMMON_FLOAT_MAX =  1.70141184e38;\\nconst float COMMON_FLOAT_MIN = 1.17549435e-38;\\nfloat common_packFloat(vec4 val){\\n    vec4 scl = floor(255.0 * val + 0.5);\\n    float sgn = (scl.a < 128.0) ? 1.0 : -1.0;\\n    float exn = mod(scl.a * 2.0, 256.0) + floor(scl.b / 128.0) - 127.0;\\n    float man = 1.0 +\\n        (scl.r / 8388608.0) +\\n        (scl.g / 32768.0) +\\n        mod(scl.b, 128.0) / 128.0;\\n    return sgn * man * pow(2.0, exn);\\n}\\nvec4 common_unpackFloat(highp float v) {\\n    highp float av = abs(v);\\n    if(av < COMMON_FLOAT_MIN) {\\n        return vec4(0.0, 0.0, 0.0, 0.0);\\n    } else if(v > COMMON_FLOAT_MAX) {\\n        return vec4(127.0, 128.0, 0.0, 0.0) / 255.0;\\n    } else if(v < -COMMON_FLOAT_MAX) {\\n        return vec4(255.0, 128.0, 0.0, 0.0) / 255.0;\\n    }\\n    highp vec4 c = vec4(0,0,0,0);\\n    highp float e = floor(log2(av));\\n    highp float m = av * pow(2.0, -e) - 1.0;\\n    c[1] = floor(128.0 * m);\\n    m -= c[1] / 128.0;\\n    c[2] = floor(32768.0 * m);\\n    m -= c[2] / 32768.0;\\n    c[3] = floor(8388608.0 * m);\\n    highp float ebias = e + 127.0;\\n    c[0] = floor(ebias / 2.0);\\n    ebias -= c[0] * 2.0;\\n    c[1] += floor(ebias) * 128.0;\\n    c[0] += 128.0 * step(0.0, -v);\\n    return c / 255.0;\\n}\\nvec4 common_encodeDepth(const in float depth) {\\n    float alpha = 1.0;\\n    vec4 pack = vec4(0.0);\\n    pack.a = alpha;\\n    const vec3 code = vec3(1.0, 255.0, 65025.0);\\n    pack.rgb = vec3(code * depth);\\n    pack.gb = fract(pack.gb);\\n    pack.rg -= pack.gb * (1.0 / 256.0);\\n    pack.b -= mod(pack.b, 4.0 / 255.0);\\n    return pack;\\n}\\nfloat common_decodeDepth(const in vec4 pack) {\\n    return pack.r + pack.g / 255.0;\\n}",invert_matrix:"mat4 invert_matrix(mat4 matrix) {\\n    #if __VERSION__ == 300\\n        return inverse(matrix);\\n    #else\\n        vec4 vector1 = matrix[0], vector2 = matrix[1], vector3 = matrix[2], vector4 = matrix[3];\\n        float a00 = vector1.x, a01 = vector1.y, a02 = vector1.z, a03 = vector1.w;\\n        float a10 = vector2.x, a11 = vector2.y, a12 = vector2.z, a13 = vector2.w;\\n        float a20 = vector3.x, a21 = vector3.y, a22 = vector3.z, a23 = vector3.w;\\n        float a30 = vector4.x, a31 = vector4.y, a32 = vector4.z, a33 = vector4.w;\\n        float b00 = a00 * a11 - a01 * a10;\\n        float b01 = a00 * a12 - a02 * a10;\\n        float b02 = a00 * a13 - a03 * a10;\\n        float b03 = a01 * a12 - a02 * a11;\\n        float b04 = a01 * a13 - a03 * a11;\\n        float b05 = a02 * a13 - a03 * a12;\\n        float b06 = a20 * a31 - a21 * a30;\\n        float b07 = a20 * a32 - a22 * a30;\\n        float b08 = a20 * a33 - a23 * a30;\\n        float b09 = a21 * a32 - a22 * a31;\\n        float b10 = a21 * a33 - a23 * a31;\\n        float b11 = a22 * a33 - a23 * a32;\\n        float det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\\n        det = 1.0 / det;\\n        mat4 m = mat4(\\n            (a11 * b11 - a12 * b10 + a13 * b09) * det,\\n            (a02 * b10 - a01 * b11 - a03 * b09) * det,\\n            (a31 * b05 - a32 * b04 + a33 * b03) * det,\\n            (a22 * b04 - a21 * b05 - a23 * b03) * det,\\n            (a12 * b08 - a10 * b11 - a13 * b07) * det,\\n            (a00 * b11 - a02 * b08 + a03 * b07) * det,\\n            (a32 * b02 - a30 * b05 - a33 * b01) * det,\\n            (a20 * b05 - a22 * b02 + a23 * b01) * det,\\n            (a10 * b10 - a11 * b08 + a13 * b06) * det,\\n            (a01 * b08 - a00 * b10 - a03 * b06) * det,\\n            (a30 * b04 - a31 * b02 + a33 * b00) * det,\\n            (a21 * b02 - a20 * b04 - a23 * b00) * det,\\n            (a11 * b07 - a10 * b09 - a12 * b06) * det,\\n            (a00 * b09 - a01 * b07 + a02 * b06) * det,\\n            (a31 * b01 - a30 * b03 - a32 * b00) * det,\\n            (a20 * b03 - a21 * b01 + a22 * b00) * det\\n        );\\n        return m;\\n    #endif\\n}\\nmat4 transpose_matrix(mat4 matrix) {\\n    #if __VERSION__ == 300\\n        return transpose(matrix);\\n    #else\\n        vec4 vector1 = matrix[0], vector2 = matrix[1], vector3 = matrix[2], vector4 = matrix[3];\\n        float a01 = vector1.y, a02 = vector1.z, a03 = vector1.w;\\n        float a12 = vector2.z, a13 = vector2.w;\\n        float a23 = vector3.w;\\n        mat4 m = mat4(\\n            vector1.x,\\n            vector2.x,\\n            vector3.x,\\n            vector4.x,\\n            a01,\\n            vector2.y,\\n            vector3.y,\\n            vector4.y,\\n            a02,\\n            a12,\\n            vector3.z,\\n            vector4.z,\\n            a03,\\n            a13,\\n            a23,\\n            vector4.w\\n        );\\n        return m;\\n    #endif\\n}",get_output:"#include <invert_matrix>\\n#include <draco_decode_vert>\\n#ifdef HAS_INSTANCE\\n    #include <instance_vert>\\n    #ifdef HAS_INSTANCE_COLOR\\n        varying vec4 vInstanceColor;\\n    #endif\\n#endif\\n#ifdef HAS_SKIN\\n    uniform int skinAnimation;\\n    #include <skin_vert>\\n#endif\\n#include <mask_vert>\\n#ifdef HAS_MORPH\\n    attribute vec3 POSITION0;\\n    attribute vec3 POSITION1;\\n    attribute vec3 POSITION2;\\n    attribute vec3 POSITION3;\\n    attribute vec3 POSITION4;\\n    attribute vec3 POSITION5;\\n    attribute vec3 POSITION6;\\n    attribute vec3 POSITION7;\\n    #ifdef HAS_MORPHNORMALS\\n        attribute vec3 NORMAL0;\\n        attribute vec3 NORMAL1;\\n        attribute vec3 NORMAL2;\\n        attribute vec3 NORMAL3;\\n    #endif\\n    uniform vec4 morphWeights1;\\n    uniform vec4 morphWeights2;\\n#endif\\n#ifdef HAS_TERRAIN_ALTITUDE\\nattribute float aTerrainAltitude;\\n#endif\\nmat4 getPositionMatrix() {\\n    mat4 worldMatrix;\\n    #ifdef HAS_INSTANCE\\n        #ifdef HAS_INSTANCE_COLOR\\n            vInstanceColor = instance_getInstanceColor();\\n        #endif\\n        mat4 attributeMatrix = instance_getAttributeMatrix();\\n        #ifdef HAS_SKIN\\n            if (skinAnimation == 1) {\\n                worldMatrix = attributeMatrix * positionMatrix * skin_getSkinMatrix();\\n            } else {\\n                worldMatrix = attributeMatrix * positionMatrix;\\n            }\\n        #else\\n            worldMatrix = attributeMatrix * positionMatrix;\\n        #endif\\n    #else\\n        #ifdef HAS_SKIN\\n            if (skinAnimation == 1) {\\n                worldMatrix = skin_getSkinMatrix() * positionMatrix;\\n            } else {\\n                worldMatrix = positionMatrix;\\n            }\\n        #else\\n            worldMatrix = positionMatrix;\\n        #endif\\n    #endif\\n    return worldMatrix;\\n}\\n#ifdef HAS_MIN_ALTITUDE\\nuniform float minAltitude;\\n#endif\\nvec4 getPosition(vec3 aPosition) {\\n    vec3 position = decode_getPosition(aPosition);\\n    #ifdef HAS_MORPH\\n        vec4 POSITION = vec4(position + morphWeights1[0] * POSITION0 + morphWeights1[1] * POSITION1 + morphWeights1[2] * POSITION2 + morphWeights1[3] * POSITION3\\n        + morphWeights2[0] * POSITION4 + morphWeights2[1] * POSITION5 + morphWeights2[2] * POSITION6 + morphWeights2[3] * POSITION7\\n        , 1.0);\\n    #else\\n        vec4 POSITION = vec4(position, 1.0);\\n    #endif\\n    #ifdef HAS_TERRAIN_ALTITUDE\\n        POSITION.z += aTerrainAltitude * 100.0;\\n    #endif\\n    #ifdef HAS_MIN_ALTITUDE\\n        POSITION.z += minAltitude * 100.0;\\n    #endif\\n    return POSITION;\\n}\\nvec3 appendMorphNormal(vec3 NORMAL) {\\n    #ifdef HAS_MORPHNORMALS\\n        vec3 normal = NORMAL + morphWeights1[0] * NORMAL0 + morphWeights1[1] * NORMAL1 + morphWeights1[2] * NORMAL2 + morphWeights1[3] * NORMAL3;\\n    #else\\n        vec3 normal = NORMAL;\\n    #endif\\n    return normal;\\n}",instance_vert:"attribute vec4 instance_vectorA;\\nattribute vec4 instance_vectorB;\\nattribute vec4 instance_vectorC;\\n#ifdef HAS_INSTANCE_TERRAIN_ALTITUDE\\nattribute float aTerrainAltitude;\\nuniform float terrainAltitudeScale;\\n#endif\\nmat4 instance_getAttributeMatrix() {\\n    mat4 mat =  mat4(\\n        instance_vectorA.x, instance_vectorB.x, instance_vectorC.x, 0.0,\\n        instance_vectorA.y, instance_vectorB.y, instance_vectorC.y, 0.0,\\n        instance_vectorA.z, instance_vectorB.z, instance_vectorC.z, 0.0,\\n        instance_vectorA.w, instance_vectorB.w, instance_vectorC.w, 1.0\\n    );\\n    #ifdef HAS_INSTANCE_TERRAIN_ALTITUDE\\n        mat4 terrainMat = mat4(\\n            1., 0., 0., 0.,\\n            0., 1., 0., 0.,\\n            0., 0., 1., 0.,\\n            0., 0., aTerrainAltitude * terrainAltitudeScale, 1.\\n        );\\n        mat = terrainMat * mat;\\n    #endif\\n    return mat;\\n}\\n#ifdef HAS_INSTANCE_HIGHLIGHT\\n    attribute vec4 highlight_color;\\n#endif\\n#ifdef HAS_INSTANCE_COLOR\\n   \\n    attribute vec4 instance_color;\\n    vec4 instance_getInstanceColor() {\\n        vec4 color = instance_color;\\n        #ifdef HAS_INSTANCE_HIGHLIGHT\\n            color = instance_color * highlight_color;\\n        #endif\\n        return color;\\n    }\\n#endif",skin_vert:"attribute vec4 WEIGHTS_0;\\nattribute vec4 JOINTS_0;\\nuniform sampler2D jointTexture;\\nuniform vec2 jointTextureSize;\\nuniform float numJoints;\\n#define ROW0_U ((0.5 + 0.0) / 4.)\\n#define ROW1_U ((0.5 + 1.0) / 4.)\\n#define ROW2_U ((0.5 + 2.0) / 4.)\\n#define ROW3_U ((0.5 + 3.0) / 4.)\\nmat4 skin_getBoneMatrix(float jointNdx) {\\n    float v = (jointNdx + 0.5) / numJoints;\\n    return mat4(\\n        texture2D(jointTexture, vec2(ROW0_U, v)),\\n        texture2D(jointTexture, vec2(ROW1_U, v)),\\n        texture2D(jointTexture, vec2(ROW2_U, v)),\\n        texture2D(jointTexture, vec2(ROW3_U, v)));\\n}\\nmat4 skin_getSkinMatrix() {\\n        mat4 skinMatrix = skin_getBoneMatrix(JOINTS_0[0]) * WEIGHTS_0[0] +\\n                        skin_getBoneMatrix(JOINTS_0[1]) * WEIGHTS_0[1] +\\n                        skin_getBoneMatrix(JOINTS_0[2]) * WEIGHTS_0[2] +\\n                        skin_getBoneMatrix(JOINTS_0[3]) * WEIGHTS_0[3];\\n        return skinMatrix;\\n}",heatmap_render_vert:"#ifdef HAS_HEATMAP\\nvarying vec2 heatmap_vTexCoord;\\nvoid heatmap_compute(mat4 matrix, vec3 position) {\\n    vec4 pos = matrix * vec4(position.xy, 0., 1.);\\n    heatmap_vTexCoord = (1. + pos.xy / pos.w) / 2.;\\n}\\n#endif",heatmap_render_frag:"#ifdef HAS_HEATMAP\\nuniform sampler2D heatmap_inputTexture;\\nuniform sampler2D heatmap_colorRamp;\\nuniform float heatmap_heatmapOpacity;\\nvarying vec2 heatmap_vTexCoord;\\nvec4 heatmap_getColor(vec4 color) {\\n    float t = texture2D(heatmap_inputTexture, heatmap_vTexCoord).r;\\n    vec4 heatmapColor = texture2D(heatmap_colorRamp, vec2(t, 0.5)) * heatmap_heatmapOpacity;\\n    return color * (1.0 - heatmapColor.a) + heatmapColor * heatmapColor.a;\\n}\\n#endif",line_extrusion_vert:"#ifdef IS_LINE_EXTRUSION\\n    #define ALTITUDE_SCALE 32767.0;\\n    #define EXTRUDE_SCALE 63.0;\\n    attribute vec2 aExtrude;\\n    #ifdef HAS_LINE_WIDTH\\n        attribute float aLineWidth;\\n    #else\\n        uniform float lineWidth;\\n    #endif\\n    #ifdef HAS_LINE_HEIGHT\\n        attribute float aLineHeight;\\n    #else\\n        uniform float lineHeight;\\n    #endif\\n    uniform float linePixelScale;\\n    vec3 getLineExtrudePosition(vec3 position) {\\n        #ifdef HAS_LINE_WIDTH\\n            float lineWidth = aLineWidth / 2.0;\\n        #endif\\n        #ifdef HAS_LINE_HEIGHT\\n            float lineHeight = aLineHeight / 10.0;\\n        #endif\\n        float halfwidth = lineWidth / 2.0;\\n        float outset = halfwidth;\\n        vec2 dist = outset * aExtrude / EXTRUDE_SCALE;\\n        position.z *= lineHeight / ALTITUDE_SCALE;\\n        return position + vec3(dist, 0.0) * linePixelScale;\\n    }\\n#endif",gl2_vert:"#if __VERSION__ == 300\\n    #define texture2D texture\\n    #define varying out\\n    #define attribute in\\n#endif",gl2_frag:"#if __VERSION__ == 300\\n    #define varying in\\n    #define gl_FragDepthEXT gl_FragDepth\\n    #define texture2D texture\\n    #define textureCube texture\\n    #define texture2DProj textureProj\\n    #define texture2DLodEXT textureLod\\n    #define texture2DProjLodEXT textureProjLod\\n    #define textureCubeLodEXT textureLod\\n    #define texture2DGradEXT textureGrad\\n    #define texture2DProjGradEXT textureProjGrad\\n    #define textureCubeGradEXT textureGrad\\n    #define texture2D texture\\n    out vec4 glFragColor;\\n#else\\n    vec4 glFragColor;\\n#endif",hsv_frag:"\\nconst mediump vec4 HSV_K0 = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\\nconst mediump vec4 HSV_K1 = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\\nconst mediump float HSV_E = 1.0e-10;\\nvec3 hsv_rgb2hsv(vec3 c) {\\n    vec4 K = HSV_K0;\\n    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\\n    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\\n    float d = q.x - min(q.w, q.y);\\n    float e = HSV_E;\\n    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\\n}\\nvec3 hsv_hsv2rgb(vec3 c) {\\n    vec4 K = HSV_K1;\\n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\\n}\\nvec4 hsv_apply(vec4 c, vec3 hsvOffset) {\\n    vec3 hsv = hsv_rgb2hsv(c.rgb);\\n    hsv += hsv * hsvOffset;\\n    hsv = clamp(hsv, 0.0, 1.0);\\n    return vec4(hsv_hsv2rgb(hsv), c.a);\\n}\\nvec3 hsv_apply(vec3 c, vec3 hsvOffset) {\\n    vec3 hsv = hsv_rgb2hsv(c.rgb);\\n    hsv += hsv * hsvOffset;\\n    hsv = clamp(hsv, 0.0, 1.0);\\n    return hsv_hsv2rgb(hsv);\\n}\\nmat4 contrastMatrix(float contrast)\\n{\\n    float t = (1.0 - contrast) / 2.0;\\n    return mat4(\\n        contrast, 0., 0., 0.,\\n        0., contrast, 0., 0.,\\n        0., 0., contrast, 0.,\\n        t, t, t, 1\\n    );\\n}",snow_frag:"#ifdef HAS_SNOW\\n    float lerp(float a, float b, float w) {\\n        return a + w * (b - a);\\n    }\\n    vec3 snow(vec4 sceneColor, vec3 normalColor, float height) {\\n        float snowIntense = normalColor.b;\\n        vec3 fixedC = vec3(1.0, 1.0, 1.0);\\n        if (height < 1.0) {\\n            float r = lerp(0.5, fixedC.x, snowIntense);\\n            float g = lerp(0.5, fixedC.y, snowIntense);\\n            float b = lerp(0.5, fixedC.z, snowIntense);\\n            return vec3(r, g, b);\\n        } else {\\n            float r = lerp(sceneColor.r, fixedC.x, snowIntense);\\n            float g = lerp(sceneColor.g, fixedC.y, snowIntense);\\n            float b = lerp(sceneColor.b, fixedC.z, snowIntense);\\n            return vec3(r, g, b);\\n        }\\n    }\\n#endif",draco_decode_vert:"#if defined(HAS_TANGENT)\\n    attribute vec4 aTangent;\\n#elif defined(HAS_NORMAL)\\n    #ifdef HAS_DRACO_NORMAL\\n        attribute vec2 aNormal;\\n        uniform float gltf_u_dec_normal_rangeConstant;\\n    #else\\n        attribute vec3 aNormal;\\n    #endif\\n#endif\\n#ifdef HAS_DRACO_POSITION\\n    uniform float gltf_u_dec_position_normConstant;\\n    uniform vec3 minValues_pos;\\n    vec3 decodeDracoPosition(vec3 aPosition) {\\n        return minValues_pos + aPosition * gltf_u_dec_position_normConstant;\\n    }\\n#endif\\n#ifdef HAS_DRACO_TEXCOORD\\n    uniform vec2 minValues_tex;\\n    uniform float gltf_u_dec_texcoord_0_normConstant;\\n    vec2 decodeDracoTexcoord(vec2 aTexCoord) {\\n        return minValues_tex + aTexCoord * gltf_u_dec_texcoord_0_normConstant;\\n    }\\n#endif\\n#ifdef HAS_WEB3D_quantized_attributes_TEXCOORD\\n    uniform mat3 decodeMatrix;\\n#endif\\n#ifdef HAS_DRACO_NORMAL\\n    float czm_signNotZero(float value) {\\n        return value >= 0.0 ? 1.0 : -1.0;\\n    }\\n    vec2 czm_signNotZero(vec2 value) {\\n        return vec2(czm_signNotZero(value.x), czm_signNotZero(value.y));\\n    }\\n    vec3 decodeDracoNormal(vec2 encoded, float range)\\n    {\\n        if (encoded.x == 0.0 && encoded.y == 0.0) {\\n            return vec3(0.0, 0.0, 0.0);\\n        }\\n        encoded = encoded / range * 2.0 - 1.0;\\n        vec3 v = vec3(encoded.x, encoded.y, 1.0 - abs(encoded.x) - abs(encoded.y));\\n        if (v.z < 0.0) {\\n            v.xy = (1.0 - abs(v.yx)) * czm_signNotZero(v.xy);\\n        }\\n        return normalize(v);\\n    }\\n    vec3 decode_getNormal(vec2 aNormal) {\\n        return decodeDracoNormal(aNormal, gltf_u_dec_normal_rangeConstant).zxy;\\n    }\\n#endif\\n#ifdef HAS_COMPRESSED_INT16\\n    #ifdef HAS_COMPRESSED_INT16_POSITION\\n      uniform vec2 compressedPositionRange;\\n    #endif\\n    #ifdef HAS_COMPRESSED_INT16_TEXCOORD_0\\n      uniform vec2 compressedTexcoordRange_0;\\n    #endif\\n    #ifdef HAS_COMPRESSED_INT16_TEXCOORD_1\\n      uniform vec2 compressedTexcoordRange_1;\\n    #endif\\n    #ifdef HAS_COMPRESSED_INT16_NORMAL\\n      uniform vec2 compressedNormalRange;\\n    #endif\\n    #ifdef HAS_COMPRESSED_INT16_RATIO\\n      uniform float compressed_ratio;\\n    #endif\\n    float int16ToFloat32(float value, vec2 range) {\\n        float v = (value >= 32768.0) ? -(65536.0 - value) / 32768.0 : value / 32767.0;\\n        return (v + 1.0) * (range.y - range.x) / 2.0 + range.x;\\n    }\\n#endif\\nvec3 decode_getPosition(vec3 aPosition) {\\n    vec3 position = aPosition;\\n    #if defined(HAS_COMPRESSED_INT16) && defined(HAS_COMPRESSED_INT16_POSITION)\\n        float x = int16ToFloat32(aPosition.x, compressedPositionRange);\\n        float y = int16ToFloat32(aPosition.y, compressedPositionRange);\\n        float z = int16ToFloat32(aPosition.z, compressedPositionRange);\\n        #ifdef HAS_COMPRESSED_INT16_RATIO\\n          position = vec3(x / compressed_ratio, y / compressed_ratio, z);\\n        #else\\n          position = vec3(x, y, z);\\n        #endif\\n    #endif\\n    #ifdef HAS_DRACO_POSITION\\n        return decodeDracoPosition(position);\\n    #else\\n        return position;\\n    #endif\\n}\\nvec2 decode_getTexcoord(vec2 aTexCoord) {\\n    vec2 texcoord = aTexCoord;\\n    #if defined(HAS_COMPRESSED_INT16) && (defined(HAS_COMPRESSED_INT16_TEXCOORD_0) || defined(HAS_COMPRESSED_INT16_TEXCOORD_1))\\n        float x = int16ToFloat32(aTexCoord.x, compressedTexcoordRange_0);\\n        float y = int16ToFloat32(aTexCoord.y, compressedTexcoordRange_0);\\n        texcoord = vec2(x, y);\\n    #endif\\n    #ifdef HAS_DRACO_TEXCOORD\\n        return decodeDracoTexcoord(texcoord);\\n    #elif defined(HAS_WEB3D_quantized_attributes_TEXCOORD)\\n        vec3 web3dTexcoord = decodeMatrix * vec3(texcoord, 1.0);\\n        return vec2(web3dTexcoord.x, web3dTexcoord.y);\\n    #else\\n        return texcoord;\\n    #endif\\n}\\nvec3 decode_getNormal(vec3 aNormal) {\\n    #ifdef HAS_COMPRESSED_INT16_NORMAL\\n        aNormal.x = int16ToFloat32(aNormal.x, compressedNormalRange);\\n        aNormal.y = int16ToFloat32(aNormal.y, compressedNormalRange);\\n        aNormal.z = int16ToFloat32(aNormal.z, compressedNormalRange);\\n    #endif\\n    return aNormal;\\n}",highlight_vert:"#if defined(HAS_HIGHLIGHT_COLOR)\\n    attribute vec4 aHighlightColor;\\n    varying vec4 vHighlightColor;\\n#endif\\n#if defined(HAS_HIGHLIGHT_OPACITY)\\n    attribute float aHighlightOpacity;\\n    varying float vHighlightOpacity;\\n#endif\\nvoid highlight_setVarying() {\\n    #if defined(HAS_HIGHLIGHT_COLOR)\\n        vHighlightColor = aHighlightColor / 255.0;\\n    #endif\\n    #if defined(HAS_HIGHLIGHT_OPACITY)\\n        vHighlightOpacity = aHighlightOpacity / 255.0;\\n    #endif\\n}",highlight_frag:"#if defined(HAS_HIGHLIGHT_COLOR)\\n\\tvarying vec4 vHighlightColor;\\n#endif\\n#if defined(HAS_HIGHLIGHT_OPACITY)\\n    varying float vHighlightOpacity;\\n#endif\\nvec4 highlight_blendColor(vec4 color) {\\n\\tvec4 outColor;\\n\\t#if defined(HAS_HIGHLIGHT_COLOR)\\n\\t\\tcolor.rgb = color.rgb * (1.0 - vHighlightColor.a) + vHighlightColor.rgb * vHighlightColor.a;\\n\\t\\t#ifndef HAS_HIGHLIGHT_COLOR_POINT\\n        \\tcolor.a = color.a * (1.0 - vHighlightColor.a) + vHighlightColor.a;\\n        #endif\\n        outColor = color;\\n\\t#else\\n\\t\\toutColor = color;\\n\\t#endif\\n\\t#if defined(HAS_HIGHLIGHT_OPACITY)\\n\\t\\toutColor *= vHighlightOpacity;\\n\\t#endif\\n\\treturn outColor;\\n}",mask_vert:"#ifdef HAS_MASK_EXTENT\\n    uniform vec4 mask_extent;\\n    uniform sampler2D mask_colorExtent;\\n    uniform sampler2D mask_modeExtent;\\n    uniform float mask_maskMode;\\n    uniform float mask_hasFlatOut;\\n    uniform mat4 viewMatrix;\\n    uniform float mask_heightRatio;\\n    uniform float mask_heightOffset;\\n    varying vec4 vWorldPosition;\\n    varying vec2 vUVInExtent;\\n    varying float vHeightRatio;\\n    varying float vHeightOffset;\\n    const float CLIPINSIDE_MODE = 0.2;\\n    const float FLATINSIDE_MODE = 0.3;\\n    const float FLATOUTSIDE_MODE = 0.4;\\n    const float ELEVATE_MODE = 0.7;\\n    float random (vec2 st) {\\n        return fract(sin(dot(st.xy,vec2(12.9898,78.233)))*43758.5453123) * 0.1;\\n    }\\n    bool isInExtent(vec4 color) {\\n        return length(color.rgb) > 0.0;\\n    }\\n    float getFlatHeight(float maskMode, float flatHeight, float height) {\\n      if (maskMode <= ELEVATE_MODE && maskMode > 0.6) {\\n          return flatHeight + height;\\n      } else {\\n        return flatHeight;\\n      }\\n    }\\n    vec4 getNoErrorPosition(vec4 position, vec4 wPosition) {\\n      vec4 realPos = modelViewMatrix * position;      vec4 pos = viewMatrix * wPosition;      vec4 tempPos = viewMatrix * modelMatrix * position;      float deltaX = realPos.x - tempPos.x;\\n      float deltaY = realPos.y - tempPos.y;\\n      float deltaZ = realPos.z - tempPos.z;\\n      pos.x = pos.x + deltaX;\\n      pos.y = pos.y + deltaY;\\n      pos.z = pos.z + deltaZ;\\n      return pos;\\n    }\\n    vec4 getMaskPosition(vec4 position, mat4 modelMatrix) {\\n        vWorldPosition = modelMatrix * position;\\n        float w = mask_extent.z - mask_extent.x;\\n        float h = mask_extent.y - mask_extent.w;\\n        vec2 uvInExtent = vec2((vWorldPosition.x - mask_extent.x) / abs(w), 1.0 - (vWorldPosition.y - mask_extent.w) / h);\\n        vec4 extentColor = texture2D(mask_colorExtent, uvInExtent);\\n        vec3 maskOptionColor = texture2D(mask_modeExtent, uvInExtent).rgb;\\n        float maskMode = maskOptionColor.r;\\n        float flatHeight = maskOptionColor.g / mask_heightRatio + mask_heightOffset;\\n        float height = getFlatHeight(maskMode, flatHeight, vWorldPosition.z);\\n        vec4 wPosition = vec4(vWorldPosition.x, vWorldPosition.y, height, vWorldPosition.w);\\n        vUVInExtent = uvInExtent;\\n        vHeightRatio = mask_heightRatio;\\n        vHeightOffset = mask_heightOffset;\\n        if (maskMode <= FLATOUTSIDE_MODE && maskMode > FLATINSIDE_MODE) {\\n            return modelViewMatrix * position;;\\n        } else if (mask_hasFlatOut == 1.0) {\\n            return getNoErrorPosition(position, wPosition);\\n        }\\n        if (isInExtent(extentColor) == true && maskMode <= FLATINSIDE_MODE && maskMode > CLIPINSIDE_MODE) {\\n            return getNoErrorPosition(position, wPosition);\\n        } if (isInExtent(extentColor) == true && maskMode <= ELEVATE_MODE && maskMode > 0.6) {\\n            return getNoErrorPosition(position, wPosition);\\n        } else {\\n            return modelViewMatrix * position;\\n        }\\n    }\\n#endif",mask_frag:"#ifdef HAS_MASK_EXTENT\\n    uniform sampler2D mask_colorExtent;\\n    uniform sampler2D mask_modeExtent;\\n    uniform float mask_hasClipOut;\\n    varying float vHeightRatio;\\n    varying float vHeightOffset;\\n    varying vec2 vUVInExtent;\\n    varying vec4 vWorldPosition;\\n    const float CLIPINSIDE_MODE = 0.1;\\n    const float CLIPOUTSIDE_MODE = 0.2;\\n    const float FLATINSIDE_MODE = 0.3;\\n    const float FLATOUTSIDE_MODE = 0.4;\\n    const float COLOR_MODE = 0.5;\\n    const float VIDEO_MODE = 0.6;\\n    bool isInExtent(vec4 color) {\\n        return length(color.rgb) > 0.0;\\n    }\\n    vec4 setMask(vec4 glFragColor) {\\n        vec4 extentColor = texture2D(mask_colorExtent, vUVInExtent);\\n        vec4 modeColor = texture2D(mask_modeExtent, vUVInExtent);\\n        float maskMode = modeColor.r;\\n        float minHeight = modeColor.b / vHeightRatio + vHeightOffset;\\n        float maxHeight = modeColor.a / vHeightRatio + vHeightOffset;\\n        if (maskMode > CLIPINSIDE_MODE && maskMode <= CLIPOUTSIDE_MODE) {\\n            if (minHeight == 0.0 && maxHeight == 0.0) {\\n                return glFragColor;\\n            } else if (vWorldPosition.z >= minHeight && vWorldPosition.z <= maxHeight) {\\n                return glFragColor;\\n            } else {\\n              discard;\\n            }\\n        } else if (mask_hasClipOut == 1.0) {\\n            discard;\\n        }\\n        if (isInExtent(extentColor) == true && maskMode <= CLIPINSIDE_MODE && maskMode > 0.0) {\\n            if (minHeight == 0.0 && maxHeight == 0.0) {\\n                discard;\\n            } else if (vWorldPosition.z >= minHeight && vWorldPosition.z <= maxHeight) {\\n                discard;\\n            } else {\\n              return glFragColor;\\n            }\\n        } else if (isInExtent(extentColor) == true && maskMode <= VIDEO_MODE && maskMode > FLATOUTSIDE_MODE) {\\n            if (minHeight == 0.0 && maxHeight == 0.0) {\\n                glFragColor = vec4(mix(extentColor.rgb, glFragColor.rgb, 1.0 - extentColor.a), glFragColor.a);\\n            } else if (vWorldPosition.z >= minHeight && vWorldPosition.z <= maxHeight) {\\n                glFragColor = vec4(mix(extentColor.rgb, glFragColor.rgb, 1.0 - extentColor.a), glFragColor.a);\\n            }\\n        }\\n        return glFragColor;\\n    }\\n#endif",computeTexcoord_frag:"#ifdef HAS_KHR_TEXTURE_TRANSFORM\\n    uniform vec2 khr_offset;\\n    uniform float khr_rotation;\\n    uniform vec2 khr_scale;\\n    vec2 khr_tex_transformTexCoord(vec2 texCoords, vec2 offset, float rotation, vec2 scale) {\\n        rotation = -rotation;\\n        mat3 transform = mat3(\\n        cos(rotation) * scale.x, sin(rotation) * scale.x, 0.0, -sin(rotation) * scale.y, cos(rotation) * scale.y, 0.0, offset.x, offset.y, 1.0);\\n        vec2 transformedTexCoords = (transform * vec3(fract(texCoords), 1.0)).xy;\\n        return transformedTexCoords;\\n    }\\n#endif\\nvarying highp vec2 vTexCoord;\\n#ifdef HAS_I3S_UVREGION\\n    varying vec4 vUvRegion;\\n#endif\\nvec2 computeTexCoord(vec2 texCoord) {\\n    #ifdef HAS_I3S_UVREGION\\n        vec2 atlasScale = vUvRegion.zw - vUvRegion.xy;\\n        vec2 uvAtlas = fract(texCoord) * atlasScale + vUvRegion.xy;\\n        return uvAtlas;\\n    #elif defined(HAS_KHR_TEXTURE_TRANSFORM)\\n        return khr_tex_transformTexCoord(texCoord, khr_offset, khr_rotation, khr_scale);\\n    #else\\n        return texCoord;\\n    #endif\\n}",terrain_normal_frag:"#ifdef HAS_TERRAIN_NORMAL\\n    uniform sampler2D terrainHeightTexture;\\n    uniform vec2 terrainHeightMapResolution;\\n    uniform vec2 terrainResolution;\\n    uniform float terrainHeightScale;\\n    uniform float terrainTileResolution;\\n    uniform vec4 terrainUnpackFactors;\\n    float getHeight(vec2 uv) {\\n        vec4 color = texture2D(terrainHeightTexture, uv) * 255.0;\\n        color.a = -1.0;\\n        return dot(color, terrainUnpackFactors) / 4.0;\\n    }\\n    vec3 convertTerrainHeightToNormalMap(vec2 uv) {\\n        uv.y = 1.0 - uv.y;\\n        vec2 epsilon = 1.0 / terrainHeightMapResolution;\\n        float a = getHeight(uv + vec2(-epsilon.x, -epsilon.y));\\n        float b = getHeight(uv + vec2(0, -epsilon.y));\\n        float c = getHeight(uv + vec2(epsilon.x, -epsilon.y));\\n        float d = getHeight(uv + vec2(-epsilon.x, 0));\\n        float e = getHeight(uv + vec2(epsilon.x, 0));\\n        float f = getHeight(uv + vec2(-epsilon.x, epsilon.y));\\n        float g = getHeight(uv + vec2(0, epsilon.y));\\n        float h = getHeight(uv + vec2(epsilon.x, epsilon.y));\\n        vec2 dxy = vec2(\\n            (c + e + e + h) - (a + d + d + f),\\n            (f + g + g + h) - (a + b + b + c)\\n        );\\n        return normalize(vec3(dxy / epsilon, terrainResolution ));\\n    }\\n#endif",vertex_color_vert:"#ifdef HAS_VERTEX_COLOR\\nattribute float aVertexColorType;\\nuniform vec4 vertexColorsOfType[VERTEX_TYPES_COUNT];\\nvarying vec4 vertexColor_color;\\nvoid vertexColor_update() {\\n    vertexColor_color = vertexColorsOfType[int(aVertexColorType)];\\n}\\n#endif",vertex_color_frag:"#ifdef HAS_VERTEX_COLOR\\nvarying vec4 vertexColor_color;\\nvec4 vertexColor_get() {\\n\\treturn vertexColor_color;\\n}\\n#endif",excavate_vert:"#ifdef HAS_EXCAVATE_ANALYSIS\\n  uniform vec4 excavateExtent;\\n  varying vec2 vCoordinateTexcoord;\\n  varying float vHeight;\\n  float getWorldHeight() {\\n    vec4 wPosition = modelMatrix * getPosition(aPosition);\\n    return wPosition.z;\\n  }\\n  vec2 getCoordinateTexcoord() {\\n    mat4 localPositionMatrix = getPositionMatrix();\\n    vec4 wPosition = modelMatrix * localPositionMatrix * getPosition(aPosition);\\n    float x = (wPosition.x - excavateExtent.x) / (excavateExtent.z - excavateExtent.x);\\n    float y = (wPosition.y - excavateExtent.y) / (excavateExtent.w - excavateExtent.y);\\n    return vec2(x, y);\\n  }\\n#endif",excavate_frag:"#ifdef HAS_EXCAVATE_ANALYSIS\\n  uniform sampler2D heightmap;\\n  uniform float excavateHeight;\\n  varying vec2 vCoordinateTexcoord;\\n  varying float vHeight;\\n  const vec2 range = vec2(-100.0, 1000.0);\\n  float decodeHeight(const in vec4 pack) {\\n      return pack.r + pack.g / 255.0;\\n  }\\n  vec4 excavateColor(vec4 fragColor) {\\n      float samplerHeight = decodeHeight(texture2D(heightmap, vCoordinateTexcoord));\\n      float realHeight = samplerHeight * (range.y - range.x) + range.x;\\n      if(realHeight < range.x || realHeight > range.y) {\\n          realHeight = 0.0;\\n      }\\n      if(vHeight > realHeight) {\\n          discard;\\n      }\\n      return fragColor;\\n  }\\n#endif",srgb_frag:"vec3 linearTosRGB(const in vec3 color) {\\n    return vec3( color.r < 0.0031308 ? color.r * 12.92 : 1.055 * pow(color.r, 1.0/2.4) - 0.055, color.g < 0.0031308 ? color.g * 12.92 : 1.055 * pow(color.g, 1.0/2.4) - 0.055, color.b < 0.0031308 ? color.b * 12.92 : 1.055 * pow(color.b, 1.0/2.4) - 0.055);\\n}\\nvec3 sRGBToLinear(const in vec3 color) {\\n    return vec3( color.r < 0.04045 ? color.r * (1.0 / 12.92) : pow((color.r + 0.055) * (1.0 / 1.055), 2.4), color.g < 0.04045 ? color.g * (1.0 / 12.92) : pow((color.g + 0.055) * (1.0 / 1.055), 2.4), color.b < 0.04045 ? color.b * (1.0 / 12.92) : pow((color.b + 0.055) * (1.0 / 1.055), 2.4));\\n}"};var A={register(e,n){if(p[e])throw new Error(\`Key of ${dD}e} is already registered in ShaderLib.\`);p[e]=n},compile:e=>b(e)};const y=/^[ \\t]*#include +<([\\w\\d.]+)>/gm;function b(e){return e.replace(y,w)}function w(e,n){const t=p[n];if(!t)throw new Error("Can not resolve #include <"+n+">");return b(t)}const E=[[.263385,-.0252475],[-.38545,.054485],[-.139795,-.5379925],[-.2793775,.6875475],[.7139025,.4710925],[.90044,-.16422],[.4481775,-.82799],[-.9253375,-.2910625],[.3468025,1.02292],[-1.13742,.33522],[-.7676225,-.9123175],[-.2005775,-1.1774125],[-.926525,.96876],[1.12909,-.7500325],[.9603,1.14625]],I=E.length,T=[0,0];for(let e=0;e<E.length;e++)T[0]+=E[e][0],T[1]+=E[e][1];T[0]/=I,T[1]/=I;!function(e,n,t){var r=n[0],o=n[1],i=n[2],a=n[3],s=r+r,c=o+o,f=i+i,l=r*s,h=r*c,d=r*f,u=o*c,v=o*f,_=i*f,m=a*s,g=a*c,x=a*f;e[0]=1-(u+_),e[1]=h+x,e[2]=d-g,e[3]=0,e[4]=h-x,e[5]=1-(l+_),e[6]=v+m,e[7]=0,e[8]=d+g,e[9]=v-m,e[10]=1-(l+u),e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1}([],function(e,n,t,r){var o=.5*Math.PI/180;n*=o,t*=o,r*=o;var i=Math.sin(n),a=Math.cos(n),s=Math.sin(t),c=Math.cos(t),f=Math.sin(r),l=Math.cos(r);return e[0]=i*c*l-a*s*f,e[1]=a*s*l+i*c*f,e[2]=a*c*f-i*s*l,e[3]=a*c*l+i*s*f,e}([],90,0,0),[0,0,0]),function(){const e=[0,0,0],n=90*Math.PI/180,t=[0,0,0,0],r=new Array(16)}(),A.compile("#define SHADER_NAME SKYBOX\\n#if __VERSION__ == 100\\n#ifdef GL_EXT_shader_texture_lod\\n#extension GL_EXT_shader_texture_lod : enable\\n#define textureCubeLod(tex, uv, lod) textureCubeLodEXT(tex, uv, lod)\\n#else\\n#define textureCubeLod(tex, uv, lod) textureCube(tex, uv, lod)\\n#endif\\n#else\\n#define textureCubeLod(tex, uv, lod) textureLod(tex, uv, lod)\\n#endif\\nprecision highp float;\\n#define saturate(x)        clamp(x, 0.0, 1.0)\\n#include <gl2_frag>\\n#include <hsv_frag>\\nuniform vec3 hsv;\\nvarying vec3 vWorldPos;\\n#ifdef USE_AMBIENT\\nuniform vec3 diffuseSPH[9];\\n#else\\nuniform samplerCube cubeMap;\\nuniform float bias;\\nuniform float size;\\n#endif\\nuniform float environmentExposure;\\nuniform float backgroundIntensity;\\nvec4 c(const in samplerCube d, const in vec3 e, const in float f, const in float h) {\\n  vec3 i = e;\\n  return textureCubeLod(d, i, h);\\n}\\nvec3 j(const in vec3 k, const in vec3 l[9]) {\\n  float x = k.x;\\n  float y = k.y;\\n  float z = k.z;\\n  vec3 m = (l[0] + l[1] * x + l[2] * y + l[3] * z + l[4] * z * x + l[5] * y * z + l[6] * y * x + l[7] * (3. * z * z - 1.) + l[8] * (x * x - y * y));\\n  return max(m, vec3(.0));\\n}\\nfloat n(const in vec2 o) {\\n  vec3 u = fract(vec3(o.xyx) * .1031);\\n  u += dot(u, u.yzx + 19.19);\\n  return fract((u.x + u.y) * u.z);\\n}\\n#if defined(TONE_MAPPING)\\nconst float v = 1.;\\nvec3 A(vec3 B) {\\n  vec3 a = B * (B + .0245786) - .000090537;\\n  vec3 b = B * (.983729 * B + .4329510) + .238081;\\n  return a / b;\\n}\\nvec3 C(vec3 D) {\\n  const mat3 E = mat3(vec3(.59719, .07600, .02840), vec3(.35458, .90834, .13383), vec3(.04823, .01566, .83777));\\n  const mat3 F = mat3(vec3(1.60475, -.10208, -.00327), vec3(-.53108, 1.10813, -.07276), vec3(-.07367, -.00605, 1.07602));\\n  D *= v / .6;\\n  D = E * D;\\n  D = A(D);\\n  D = F * D;\\n  return saturate(D);\\n}\\nvec3 G(vec3 D) {\\n  return C(D);\\n}\\nvec4 H(in vec4 I) {\\n  return vec4(mix(pow(I.rgb, vec3(.41666)) * 1.055 - vec3(.055), I.rgb * 12.92, vec3(lessThanEqual(I.rgb, vec3(.0031308)))), I.a);\\n}\\nvec4 J(vec4 I) {\\n  return (H(I));\\n}\\n#endif\\nvoid main() {\\n  vec4 K;\\n#ifdef USE_AMBIENT\\nvec3 k = normalize(vWorldPos + mix(-.5 / 255., .5 / 255., n(gl_FragCoord.xy)) * 2.);\\n  K = vec4(j(k, diffuseSPH), 1.);\\n#else\\nK = c(cubeMap, vWorldPos, size, bias);\\n#endif\\nK.rgb *= environmentExposure;\\n  K.rgb *= backgroundIntensity;\\n  glFragColor = K;\\n  if(length(hsv) > .0) {\\n    glFragColor.rgb = hsv_apply(clamp(glFragColor.rgb, .0, 1.), hsv);\\n  }\\n#if defined(TONE_MAPPING)\\nglFragColor.rgb = G(glFragColor.rgb);\\n  glFragColor = J(glFragColor);\\n#endif\\n#if __VERSION__ == 100\\ngl_FragColor = glFragColor;\\n#endif\\n}"),function(){const e=[[-1,-1,-1,1],[1,-1,-1,1],[1,1,-1,1],[-1,1,-1,1],[-1,-1,1,1],[1,-1,1,1],[1,1,1,1],[-1,1,1,1]],n=new Array(16)}(),function(){let e=new Array(4);const n=new Array(3),t=[0,0,0,0],r=[0,1,0],o=new Array(3);let i=new Array(16),a=new Array(16);const s=new Array(16),c=[1,1,1],f=[0,0,0]}();const O=new Uint8Array(4);new Float32Array(O.buffer);var S={exports:{}};function C(e,n,t){t=t||2;var r,o,i,a,s,c,f,l=n&&n.length,h=l?n[0]*t:e.length,d=M(e,0,h,t,!0),u=[];if(!d||d.next===d.prev)return u;if(l&&(d=function(e,n,t,r){var o,i,a,s=[];for(o=0,i=n.length;o<i;o++)(a=M(e,n[o]*r,o<i-1?n[o+1]*r:e.length,r,!1))===a.next&&(a.steiner=!0),s.push(W(a));for(s.sort(U),o=0;o<s.length;o++)t=L(s[o],t);return t}(e,n,d,t)),e.length>80*t){r=i=e[0],o=a=e[1];for(var v=t;v<h;v+=t)(s=e[v])<r&&(r=s),(c=e[v+1])<o&&(o=c),s>i&&(i=s),c>a&&(a=c);f=0!==(f=Math.max(i-r,a-o))?32767/f:0}return k(d,u,t,r,o,f,0),u}function M(e,n,t,r,o){var i,a;if(o===ee(e,n,t,r)>0)for(i=n;i<t;i+=r)a=J(i,e[i],e[i+1],a);else for(i=t-r;i>=n;i-=r)a=J(i,e[i],e[i+1],a);return a&&X(a,a.next)&&($(a),a=a.next),a}function H(e,n){if(!e)return e;n||(n=e);var t,r=e;do{if(t=!1,r.steiner||!X(r,r.next)&&0!==j(r.prev,r,r.next))r=r.next;else{if($(r),(r=n=r.prev)===r.next)break;t=!0}}while(t||r!==n);return n}function k(e,n,t,r,o,i,a){if(e){!a&&i&&function(e,n,t,r){var o=e;do{0===o.z&&(o.z=z(o.x,o.y,n,t,r)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==e);o.prevZ.nextZ=null,o.prevZ=null,function(e){var n,t,r,o,i,a,s,c,f=1;do{for(t=e,e=null,i=null,a=0;t;){for(a++,r=t,s=0,n=0;n<f&&(s++,r=r.nextZ);n++);for(c=f;s>0||c>0&&r;)0!==s&&(0===c||!r||t.z<=r.z)?(o=t,t=t.nextZ,s--):(o=r,r=r.nextZ,c--),i?i.nextZ=o:e=o,o.prevZ=i,i=o;t=r}i.nextZ=null,f*=2}while(a>1)}(o)}(e,r,o,i);for(var s,c,f=e;e.prev!==e.next;)if(s=e.prev,c=e.next,i?P(e,r,o,i):N(e))n.push(s.i/t|0),n.push(e.i/t|0),n.push(c.i/t|0),$(e),e=c.next,f=c.next;else if((e=c)===f){a?1===a?k(e=D(H(e),n,t),n,t,r,o,i,2):2===a&&R(e,n,t,r,o,i):k(H(e),n,t,r,o,i,1);break}}}function N(e){var n=e.prev,t=e,r=e.next;if(j(n,t,r)>=0)return!1;for(var o=n.x,i=t.x,a=r.x,s=n.y,c=t.y,f=r.y,l=o<i?o<a?o:a:i<a?i:a,h=s<c?s<f?s:f:c<f?c:f,d=o>i?o>a?o:a:i>a?i:a,u=s>c?s>f?s:f:c>f?c:f,v=r.next;v!==n;){if(v.x>=l&&v.x<=d&&v.y>=h&&v.y<=u&&G(o,s,i,c,a,f,v.x,v.y)&&j(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function P(e,n,t,r){var o=e.prev,i=e,a=e.next;if(j(o,i,a)>=0)return!1;for(var s=o.x,c=i.x,f=a.x,l=o.y,h=i.y,d=a.y,u=s<c?s<f?s:f:c<f?c:f,v=l<h?l<d?l:d:h<d?h:d,_=s>c?s>f?s:f:c>f?c:f,m=l>h?l>d?l:d:h>d?h:d,g=z(u,v,n,t,r),x=z(_,m,n,t,r),p=e.prevZ,A=e.nextZ;p&&p.z>=g&&A&&A.z<=x;){if(p.x>=u&&p.x<=_&&p.y>=v&&p.y<=m&&p!==o&&p!==a&&G(s,l,c,h,f,d,p.x,p.y)&&j(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,A.x>=u&&A.x<=_&&A.y>=v&&A.y<=m&&A!==o&&A!==a&&G(s,l,c,h,f,d,A.x,A.y)&&j(A.prev,A,A.next)>=0)return!1;A=A.nextZ}for(;p&&p.z>=g;){if(p.x>=u&&p.x<=_&&p.y>=v&&p.y<=m&&p!==o&&p!==a&&G(s,l,c,h,f,d,p.x,p.y)&&j(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;A&&A.z<=x;){if(A.x>=u&&A.x<=_&&A.y>=v&&A.y<=m&&A!==o&&A!==a&&G(s,l,c,h,f,d,A.x,A.y)&&j(A.prev,A,A.next)>=0)return!1;A=A.nextZ}return!0}function D(e,n,t){var r=e;do{var o=r.prev,i=r.next.next;!X(o,i)&&K(o,r,r.next,i)&&Z(o,i)&&Z(i,o)&&(n.push(o.i/t|0),n.push(r.i/t|0),n.push(i.i/t|0),$(r),$(r.next),r=e=i),r=r.next}while(r!==e);return H(r)}function R(e,n,t,r,o,i){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&V(a,s)){var c=Y(a,s);return a=H(a,a.next),c=H(c,c.next),k(a,n,t,r,o,i,0),void k(c,n,t,r,o,i,0)}s=s.next}a=a.next}while(a!==e)}function U(e,n){return e.x-n.x}function L(e,n){var t=function(e,n){var t,r=n,o=e.x,i=e.y,a=-1/0;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var s=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=o&&s>a&&(a=s,t=r.x<r.next.x?r:r.next,s===o))return t}r=r.next}while(r!==n);if(!t)return null;var c,f=t,l=t.x,h=t.y,d=1/0;r=t;do{o>=r.x&&r.x>=l&&o!==r.x&&G(i<h?o:a,i,l,h,i<h?a:o,i,r.x,r.y)&&(c=Math.abs(i-r.y)/(o-r.x),Z(r,e)&&(c<d||c===d&&(r.x>t.x||r.x===t.x&&F(t,r)))&&(t=r,d=c)),r=r.next}while(r!==f);return t}(e,n);if(!t)return n;var r=Y(t,e);return H(r,r.next),H(t,t.next)}function F(e,n){return j(e.prev,e,n.prev)<0&&j(n.next,e,e.next)<0}function z(e,n,t,r,o){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-t)*o|0)|e<<8))|e<<4))|e<<2))|e<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*o|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function W(e){var n=e,t=e;do{(n.x<t.x||n.x===t.x&&n.y<t.y)&&(t=n),n=n.next}while(n!==e);return t}function G(e,n,t,r,o,i,a,s){return(o-a)*(n-s)>=(e-a)*(i-s)&&(e-a)*(r-s)>=(t-a)*(n-s)&&(t-a)*(i-s)>=(o-a)*(r-s)}function V(e,n){return e.next.i!==n.i&&e.prev.i!==n.i&&!function(e,n){var t=e;do{if(t.i!==e.i&&t.next.i!==e.i&&t.i!==n.i&&t.next.i!==n.i&&K(t,t.next,e,n))return!0;t=t.next}while(t!==e);return!1}(e,n)&&(Z(e,n)&&Z(n,e)&&function(e,n){var t=e,r=!1,o=(e.x+n.x)/2,i=(e.y+n.y)/2;do{t.y>i!=t.next.y>i&&t.next.y!==t.y&&o<(t.next.x-t.x)*(i-t.y)/(t.next.y-t.y)+t.x&&(r=!r),t=t.next}while(t!==e);return r}(e,n)&&(j(e.prev,e,n.prev)||j(e,n.prev,n))||X(e,n)&&j(e.prev,e,e.next)>0&&j(n.prev,n,n.next)>0)}function j(e,n,t){return(n.y-e.y)*(t.x-n.x)-(n.x-e.x)*(t.y-n.y)}function X(e,n){return e.x===n.x&&e.y===n.y}function K(e,n,t,r){var o=q(j(e,n,t)),i=q(j(e,n,r)),a=q(j(t,r,e)),s=q(j(t,r,n));return o!==i&&a!==s||!(0!==o||!B(e,t,n))||!(0!==i||!B(e,r,n))||!(0!==a||!B(t,e,r))||!(0!==s||!B(t,n,r))}function B(e,n,t){return n.x<=Math.max(e.x,t.x)&&n.x>=Math.min(e.x,t.x)&&n.y<=Math.max(e.y,t.y)&&n.y>=Math.min(e.y,t.y)}function q(e){return e>0?1:e<0?-1:0}function Z(e,n){return j(e.prev,e,e.next)<0?j(e,n,e.next)>=0&&j(e,e.prev,n)>=0:j(e,n,e.prev)<0||j(e,e.next,n)<0}function Y(e,n){var t=new Q(e.i,e.x,e.y),r=new Q(n.i,n.x,n.y),o=e.next,i=n.prev;return e.next=n,n.prev=e,t.next=o,o.prev=t,r.next=t,t.prev=r,i.next=r,r.prev=i,r}function J(e,n,t,r){var o=new Q(e,n,t);return r?(o.next=r.next,o.prev=r,r.next.prev=o,r.next=o):(o.prev=o,o.next=o),o}function $(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Q(e,n,t){this.i=e,this.x=n,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ee(e,n,t,r){for(var o=0,i=n,a=t-r;i<t;i+=r)o+=(e[a]-e[i])*(e[i+1]+e[a+1]),a=i;return o}S.exports=C,S.exports.default=C,C.deviation=function(e,n,t,r){var o=n&&n.length,i=Math.abs(ee(e,0,o?n[0]*t:e.length,t));if(o)for(var a=0,s=n.length;a<s;a++)i-=Math.abs(ee(e,n[a]*t,a<s-1?n[a+1]*t:e.length,t));var c=0;for(a=0;a<r.length;a+=3){var f=r[a]*t,l=r[a+1]*t,h=r[a+2]*t;c+=Math.abs((e[f]-e[h])*(e[l+1]-e[f+1])-(e[f]-e[l])*(e[h+1]-e[f+1]))}return 0===i&&0===c?0:Math.abs((c-i)/i)},C.flatten=function(e){for(var n=e[0][0].length,t={vertices:[],holes:[],dimensions:n},r=0,o=0;o<e.length;o++){for(var i=0;i<e[o].length;i++)for(var a=0;a<n;a++)t.vertices.push(e[o][i][a]);o>0&&t.holes.push(r+=e[o-1].length)}return t},function(e){e&&e.T&&Object.prototype.hasOwnProperty.call(e,"default")&&e.default}(S.exports);class ne{constructor(e=257){this.gridSize=e;const n=e-1;if(n&n-1)throw new Error(\`Expected grid size to be 2^n+1, got ${dD}e}.\`);this.numTriangles=n*n*2-2,this.numParentTriangles=this.numTriangles-n*n,this.indices=new Uint32Array(this.gridSize*this.gridSize),this.coords=new Uint16Array(4*this.numTriangles);for(let e=0;e<this.numTriangles;e++){let t=e+2,r=0,o=0,i=0,a=0,s=0,c=0;for(1&t?i=a=s=n:r=o=c=n;(t>>=1)>1;){const e=r+i>>1,n=o+a>>1;1&t?(i=r,a=o,r=s,o=c):(r=i,o=a,i=s,a=c),s=e,c=n}const f=4*e;this.coords[f+0]=r,this.coords[f+1]=o,this.coords[f+2]=i,this.coords[f+3]=a}}createTile(e){return new te(e,this)}}class te{constructor(e,n){const t=n.gridSize;if(e.length!==t*t)throw new Error(\`Expected terrain data of length ${dD}t*t} (${dD}t} x ${dD}t}), got ${dD}e.length}.\`);this.terrain=e,this.martini=n,this.errors=new Float32Array(e.length),this.update()}update(){const{numTriangles:e,numParentTriangles:n,coords:t,gridSize:r}=this.martini,{terrain:o,errors:i}=this;for(let a=e-1;a>=0;a--){const e=4*a,s=t[e+0],c=t[e+1],f=t[e+2],l=t[e+3],h=s+f>>1,d=c+l>>1,u=h+d-c,v=d+s-h,_=(o[c*r+s]+o[l*r+f])/2,m=d*r+h,g=Math.abs(_-o[m]);if(i[m]=Math.max(i[m],g),a<n){const e=(c+v>>1)*r+(s+u>>1),n=(l+v>>1)*r+(f+u>>1);i[m]=Math.max(i[m],i[e],i[n])}}}getMesh(e=0){const{gridSize:n,indices:t}=this.martini,{errors:r}=this;let o=0,i=0;const a=n-1;function s(a,c,f,l,h,d){const u=a+f>>1,v=c+l>>1;Math.abs(a-h)+Math.abs(c-d)>1&&r[v*n+u]>e?(s(h,d,a,c,u,v),s(f,l,h,d,u,v)):(t[c*n+a]=t[c*n+a]||++o,t[l*n+f]=t[l*n+f]||++o,t[d*n+h]=t[d*n+h]||++o,i++)}t.fill(0),s(0,0,a,a,a,0),s(a,a,0,0,0,a);const c=new Uint16Array(2*o),f=new Uint32Array(3*i);let l=0;function h(o,i,a,s,d,u){const v=o+a>>1,_=i+s>>1;if(Math.abs(o-d)+Math.abs(i-u)>1&&r[_*n+v]>e)h(d,u,o,i,v,_),h(a,s,d,u,v,_);else{const e=t[i*n+o]-1,r=t[s*n+a]-1,h=t[u*n+d]-1;c[2*e]=o,c[2*e+1]=i,c[2*r]=a,c[2*r+1]=s,c[2*h]=d,c[2*h+1]=u,f[l++]=e,f[l++]=r,f[l++]=h}}return h(0,0,a,a,a,0),h(a,a,0,0,0,a),{vertices:c,triangles:f}}getMeshWithSkirts(e=0,n){const{gridSize:t,indices:r}=this.martini,{errors:o}=this;let i=0,a=0;const s=t-1;let c,f,l=0;const h=[],d=[],u=[],v=[];function _(n,m,g,x,p,A){const y=n+g>>1,b=m+x>>1;Math.abs(n-p)+Math.abs(m-A)>1&&o[b*t+y]>e?(_(p,A,n,m,y,b),_(g,x,p,A,y,b)):(c=m*t+n,f=x*t+g,l=A*t+p,0===r[c]&&(0===n?h.push(i):n===s&&d.push(i),0===m?u.push(i):m===s&&v.push(i),r[c]=++i),0===r[f]&&(0===g?h.push(i):g===s&&d.push(i),0===x?u.push(i):x===s&&v.push(i),r[f]=++i),0===r[l]&&(0===p?h.push(i):p===s&&d.push(i),0===A?u.push(i):A===s&&v.push(i),r[l]=++i),a++)}let m;r.fill(0),_(0,0,s,s,s,0),_(s,s,0,0,0,s),m=n?2*(i+3*h.length-2+3*d.length-2+3*u.length-2+3*v.length-2):2*(i+h.length+d.length+u.length+v.length);const g=3*(a+2*(h.length-1)+2*(d.length-1)+2*(u.length-1)+2*(v.length-1)),x=new Uint16Array(m),p=new Uint32Array(g);let A=0;function y(n,i,a,s,c,f){const l=n+a>>1,h=i+s>>1;if(Math.abs(n-c)+Math.abs(i-f)>1&&o[h*t+l]>e)y(c,f,n,i,l,h),y(a,s,c,f,l,h);else{const e=r[i*t+n]-1,o=r[s*t+a]-1,l=r[f*t+c]-1;x[2*e]=n,x[2*e+1]=i,x[2*o]=a,x[2*o+1]=s,x[2*l]=c,x[2*l+1]=f,p[A++]=e,p[A++]=o,p[A++]=l}}y(0,0,s,s,s,0),y(s,s,0,0,0,s),h.sort(((e,n)=>x[2*e+1]-x[2*n+1])),d.sort(((e,n)=>x[2*n+1]-x[2*e+1])),u.sort(((e,n)=>x[2*n]-x[2*e])),v.sort(((e,n)=>x[2*e]-x[2*n]));let b,w,E,I,T=2*i,O=0;function S(e){O=e.length;for(let t=0;t<O-1;t++)b=e[t],w=e[t+1],E=T/2,I=(T+(n?6:2))/2,x[T++]=2*b,x[T++]=2*b+1,n&&(x[T++]=2*b,x[T++]=2*b+1,x[T++]=2*w,x[T++]=2*w+1),n?(p[A++]=E+1,p[A++]=E,p[A++]=E+2,p[A++]=E,p[A++]=I,p[A++]=E+2):(p[A++]=b,p[A++]=E,p[A++]=w,p[A++]=E,p[A++]=I,p[A++]=w);x[T++]=2*e[O-1],x[T++]=2*e[O-1]+1}S(h);const C=T;S(d);const M=T;S(u);const H=T;S(v);return{vertices:x,triangles:p,numVerticesWithoutSkirts:i,numTrianglesWithoutSkirts:a,leftSkirtIndex:C,rightSkirtIndex:M,bottomSkirtIndex:H,topSkirtIndex:T}}}const re={};let oe;const ie={width:100,height:10};let ae,se=!1;try{const e=new OffscreenCanvas(1,1);e.getContext("2d").fillText("hello",0,0),se=!0}catch(e){se=!1}function ce(){if(!oe){const{width:e,height:n}=ie;se?oe=new OffscreenCanvas(e,n):(oe=document.createElement("canvas"),oe.width=e,oe.height=n)}return oe}class fe{constructor(e,n={}){if(!Array.isArray(e))return void console.error("colors is not array");if(e.length<2)return void console.error("colors.length should >1");this.colors=e;let t=1/0,r=-1/0;for(let n=0,o=e.length;n<o;n++){const o=e[n][0];t=Math.min(o,t),r=Math.max(o,r)}this.min=t,this.max=r,this.valueOffset=this.max-this.min,this.options=Object.assign({},ie,n),this.O()}getImageData(){return this.imgData}O(){const e=ce(),{width:n,height:t}=this.options;e.width=n,e.height=t;const r=e.getContext("2d");r.clearRect(0,0,e.width,e.height);const o=r.createLinearGradient(0,0,e.width,0),{colors:i,valueOffset:a}=this;for(let e=0,n=i.length;e<n;e++){const[n,t]=i[e],r=(n-this.min)/a;o.addColorStop(r,t)}r.fillStyle=o,r.fillRect(0,0,e.width,e.height),this.imgData=r.getImageData(0,0,e.width,e.height)}getColor(e){e=Math.max(this.min,e);const n=((e=Math.min(e,this.max))-this.min)/this.valueOffset;let t=Math.round(n*this.imgData.width);t=Math.min(t,this.imgData.width-1);const r=4*t;return[this.imgData.data[r],this.imgData.data[r+1],this.imgData.data[r+2],this.imgData.data[r+3]]}}let le=null,he=null;const de=[0,0,0],ue=[256,256];function ve(){try{le||(le=new OffscreenCanvas(1,1))}catch(e){console.error(e)}}const _e={},me={},ge={width:64,height:64,elementsPerHeight:3,heightOffset:-1e3,exaggeration:1,heightScale:.001,elementMultiplier:256,stride:4,skirtHeight:.002,skirtOffset:.01},xe={cesium_request_token:{Accept:"application/json,*/*;q=0.01","Accept-Encoding":"gzip, deflate, br"},tianditu:{"Accept-Encoding":"gzip, deflate, br"},cesium:{"Accept-Encoding":"gzip, deflate, br",Accept:"application/vnd.quantized-mesh,application/octet-stream;q=0.9,*/*;q=0.01"},mapbox:{Accept:"image/webp,*/*"}};xe["cesium-ion"]=xe.cesium;const pe=32767;let Ae=null,ye=null;function be(e,n){const t=function(e){if(e.length<1e3)return null;const n=new Zlib.Inflate(e);return n?n.decompress():null}(new Uint8Array(e));if(!t)throw new Error((r=new Uint8Array(e),we.decode(r)));var r;const o=function(e){const n=e,t=ge.width,r=ge.height,o=new Uint8Array(t*r*ge.stride);let i,a,s,c,f;for(let e=0;e<r;e++)for(let l=0;l<t;l++){c=parseInt(149*e/(r-1)),f=parseInt(149*l/(t-1)),a=2*(150*c+f),i=n[a]+256*n[a+1],(i>1e4||i<-2e3)&&(i=0),s=4*(e*t+l);const h=(i+1e3)/ge.heightScale,d=ge.elementMultiplier;o[s]=h/(d*d),o[s+1]=(h-o[s]*d*d)/d,o[s+2]=h-o[s]*d*d-o[s+1]*d,o[s+3]=255}return o}(t),i=function(e,n){const t=n,r=n,o=t+1,i=r+1,a=ge.elementsPerHeight,s=ge.heightOffset,c=ge.heightScale,f=ge.elementMultiplier,l=ge.skirtHeight,h=new Float32Array(o*i);let d=0,u=1/0,v=-1/0;for(let n=0;n<o;n++){const o=n>=r?r-1:n;for(let n=0;n<i;n++){let r=0;const i=o*(4*t)+4*(n>=t?t-1:n);for(let n=0;n<a;n++)r=r*f+e[i+n];r=1*(r*c+s),r-=l,h[d]=r,r<u&&(u=r),r>v&&(v=r),d++}}return{data:h,min:u,max:v}}(o,n-1);return i.width=i.height=n,i}const we=new TextDecoder("utf-8");function Ee(e){return e>>1^-(1&e)}const Ie=[];function Te(e){let n=0;const t=3*Float64Array.BYTES_PER_ELEMENT,r=3*Uint16Array.BYTES_PER_ELEMENT;let o=Uint16Array.BYTES_PER_ELEMENT;const i=new DataView(e);n+=t;const a=i.getFloat32(n,!0);n+=Float32Array.BYTES_PER_ELEMENT;const s=i.getFloat32(n,!0);n+=Float32Array.BYTES_PER_ELEMENT,n+=t;const c=i.getFloat64(n,!0);n+=Float64Array.BYTES_PER_ELEMENT,n+=t;const f=i.getUint32(n,!0);n+=Uint32Array.BYTES_PER_ELEMENT;const l=new Uint16Array(e,n,3*f);n+=f*r,f>65536&&(o=Uint32Array.BYTES_PER_ELEMENT);!function(e,n,t){const r=e.length;let o=0,i=0,a=0;for(let s=0;s<r;++s)o+=Ee(e[s]),i+=Ee(n[s]),e[s]=o,n[s]=i,t&&(a+=Ee(t[s]),t[s]=a)}(l.subarray(0,f),l.subarray(f,2*f),l.subarray(2*f,3*f)),n%o!=0&&(n+=o-n%o);const h=i.getUint32(n,!0);n+=Uint32Array.BYTES_PER_ELEMENT;const d=f>65536?new Uint32Array(e,n,3*h):new Uint16Array(e,n,3*h);let u=0;const v=d.length;for(let e=0;e<v;++e){const n=d[e];d[e]=u-n,0===n&&++u}const _={minimumHeight:a,maximumHeight:s,quantizedVertices:l,indices:d}.quantizedVertices,m=_.length/3,g=_.subarray(0,m),x=_.subarray(m,2*m),p=_.subarray(2*m,3*m),A=Ie;for(let e=0;e<m;++e){const n=g[e],t=x[e],r=n/pe,o=t/pe,i=(y=a,b=s,(1-(w=p[e]/pe))*y+w*b);A[3*e]=r,A[3*e+1]=1-o,A[3*e+2]=i}var y,b,w;return{positions:A,radius:c,min:a,max:s,indices:d}}const Oe=[],Se=[],Ce=[],Me=[],He=[];class ke{constructor(e,n,t,r,o){this.p0=[],this.p1=[],this.p2=[],this.normal=[],this.min=[],this.max=[],this.set(e,n,t,r,o)}set(e,n,t,r,o){this.radius=o;let i=3*n,a=3*n+1,s=3*n+2;this.p0[0]=e[i]*o,this.p0[1]=e[a]*o,this.p0[2]=e[s],i=3*t,a=3*t+1,s=3*t+2,this.p1[0]=e[i]*o,this.p1[1]=e[a]*o,this.p1[2]=e[s],i=3*r,a=3*r+1,s=3*r+2,this.p2[0]=e[i]*o,this.p2[1]=e[a]*o,this.p2[2]=e[s],this.min[0]=Math.min(this.p0[0],this.p1[0],this.p2[0]),this.min[1]=Math.min(this.p0[1],this.p1[1],this.p2[1]),this.max[0]=Math.max(this.p0[0],this.p1[0],this.p2[0]),this.max[1]=Math.max(this.p0[1],this.p1[1],this.p2[1]);const c=_(Oe,this.p1,this.p0),f=_(Se,this.p2,this.p1);this.normal=u(this.normal,v(this.normal,c,f))}contains(e,n){if(e<this.min[0]||e>this.max[0]||n<this.min[1]||n>this.max[1])return!1;x(Ce,this.p0[0],this.p0[1]),x(Me,this.p1[0],this.p1[1]),x(He,this.p2[0],this.p2[1]);const t=Re(Ce[0],Ce[1],Me[0],Me[1],He[0],He[1]);return Re(e,n,Ce[0],Ce[1],He[0],He[1])+Re(e,n,Ce[0],Ce[1],Me[0],Me[1])+Re(e,n,Me[0],Me[1],He[0],He[1])-t<=1e-4}getHeight(e,n){const t=this.normal;return this.p0[2]-((e-this.p0[0])*t[0]+(n-this.p0[1])*t[1])/t[2]}}let Ne=null;function Pe(e,n,t){if(Ne&&Ne.contains(n,t))return Ne.getHeight(n,t);for(let r=0;r<e.length;r++)if(e[r].contains(n,t))return Ne=e[r],e[r].getHeight(n,t);return 0}const De=[];function Re(e,n,t,r,o,i){return.5*Math.abs(e*r+t*i+o*n-e*i-t*n-o*r)}function Ue(e,n,t,r,o,i){"cesium-ion"===t&&(n.Authorization="Bearer "+Ae),function(e,n,t){const r={method:"GET",referrer:t,headers:n},o=c.getArrayBuffer(e,r),i=o.xhr;return me[e]=i,o.then((n=>(delete me[e],n)))}(e,n,origin).then((e=>{if(!e||e.message)i(e?{empty:!0,originalError:e}:{error:{canceled:!0}});else{const n=e.data;let a=null;if("tianditu"===t){const e=be(n,r);Fe(o,e,r,null,!0,i)}else if("cesium-ion"===t||"cesium"===t){a=Te(n);const e=function(e,n){const{positions:t,min:r,max:o,indices:i,radius:a}=e,s=[];let c=0;for(let e=0;e<i.length;e+=3){let n=De[c];n?n.set(t,i[e],i[e+1],i[e+2],2*a):n=De[c]=new ke(t,i[e],i[e+1],i[e+2],2*a),c++,s.push(n)}const f=new Float32Array(n*n);c=0;for(let e=0;e<n;e++)for(let t=0;t<n;t++)f[c++]=Pe(s,t/n*a*2,e/n*a*2);return{data:f,min:r,max:o,width:n,height:n}}(a,r);Fe(o,e,r,null,!0,i)}else"mapbox"===t&&(a=function(e){const n=new self.Blob([new Uint8Array(e)]);return self.createImageBitmap(n)}(n),a.then((e=>{const n=function(e){const{width:n,height:t}=e;le||(le=new OffscreenCanvas(1,1),he=le.getContext("2d",{willReadFrequently:!0}));return le.width=n,le.height=t,he.drawImage(e,0,0,n,t),he.getImageData(0,0,n,t)}(e),t=function(e,n){const{data:t,width:r}=e;let o=1/0,i=-1/0;const a=new Float32Array(n*n),s=Math.round(r/n);for(let e=0;e<n;e++)for(let c=0;c<n;c++){const f=e+c*n;let l=0,h=0;const d=e,u=c;for(let e=0;e<s;e++)for(let n=0;n<s;n++){let o=d*s+e,i=u*s+n;i>r-1&&(i=r-1),o>r-1&&(o=r-1);const a=o+i*r,c=t[4*a],f=t[4*a+1],v=t[4*a+2];0===t[4*a+3]?h+=1:l+=.1*(256*c*256+256*f+v)-1e4}l/=s*s-h||1,l>i&&(i=l),l<o&&(o=l),a[f]=l}return{data:a,width:n,height:n,min:o,max:i}}(n,r);Fe(o,t,r,e,!0,i)})))}})).catch((n=>{delete me[e],i({empty:!0,originalError:n})}))}function Le(e,n){const t=Math.floor(10*(e+1e4)),r=t>>16,o=t>>8&255,i=255&t;return n?(n[0]=r,n[1]=o,n[2]=i,n):[r,o,i]}function Fe(e,n,t,r,o,i){const a=function(e,n,t,r){let o=re[t];o||(o=re[t]=new ne(t));const i=o.createTile(n).getMeshWithSkirts(e,!0),{triangles:a,vertices:s,leftSkirtIndex:c,rightSkirtIndex:f,bottomSkirtIndex:l,topSkirtIndex:h}=i;let{numVerticesWithoutSkirts:d,numTrianglesWithoutSkirts:u}=i;d||(d=s.legnth/3,u=a.length/3);const v=s.length/2,_=new Float32Array(3*v),m=new Float32Array(2*v);let g=1/0,x=-1/0;const p=t-1;for(let e=0;e<v;e++){const r=s[2*e],o=s[2*e+1];if(e>=d){const n=r/2*3;let t,o=.001;(e-(e<c/2?d:e<f/2?c/2:e<l/2?f/2:l/2))%3==0?(t=0,o=0):t=_[n+2],_[3*e]=_[n],_[3*e+1]=_[n+1],_[3*e+2]=t,m[2*e]=_[n]/p+o,m[2*e+1]=-_[n+1]/p+o}else _[3*e]=1*r,_[3*e+1]=1*-o,_[3*e+2]=n[o*t+r],m[2*e]=r/p,m[2*e+1]=o/p;const i=_[_.length-1];i<g&&(g=i),i>x&&(x=i)}return{positions:_,texcoords:m,triangles:a,leftSkirtIndex:c,rightSkirtIndex:f,bottomSkirtIndex:l,topSkirtIndex:h,numTrianglesWithoutSkirts:u,numVerticesWithoutSkirts:d,minHeight:g,maxHeight:x,terrainWidth:t}}(e,n.data,t),s=[a.positions.buffer,a.texcoords.buffer,a.triangles.buffer];r||(r=function(e){if(ve(),!le)return;const{width:n,height:t,data:r}=e;if(n&&t&&r)try{let e=le.getContext("2d",{willReadFrequently:!0});const o=e.createImageData(n,t);for(let e=0,n=r.length;e<n;e++){const n=r[e],[t,i,a]=Le(n,de),s=4*e;o.data[s]=t,o.data[s+1]=i,o.data[s+2]=a,o.data[s+3]=255}return le.width=n,le.height=t,e=le.getContext("2d",{willReadFrequently:!0}),ze(e),e.putImageData(o,0,0),le.transferToImageBitmap()}catch(e){console.log(e)}}(n)),r&&s.push(r);const c={mesh:a};c.image=r,c.data=n,s.push(n.data.buffer),i(c,s)}function ze(e){const n=e.canvas,{width:t,height:r}=n;e.clearRect(0,0,t,r)}function We(e,n,t){if(!n||!Array.isArray(n)||n.length<2)return;if(!e||!e.image)return null;let{width:r,height:o}=e.image;(t=t||ue)[0]===r&&t[1]===o||(r=t[0],o=t[1]),r*=2,o*=2;try{if(ve(),!le)return;const t=le;t.width=r,t.height=o;const i=t.getContext("2d",{willReadFrequently:!0});ze(i),i.drawImage(e.image,0,0,r,o);const a=i.getImageData(0,0,r,o);return function(e,n){const t=JSON.stringify(n);_e[t]||(_e[t]=new fe(n));const r=_e[t],o=e.data;for(let e=0,n=o.length;e<n;e+=4){const n=o[e],t=o[e+1],i=o[e+2];let a=0;0!==o[e+3]&&(a=.1*(256*n*256+256*t+i)-1e4,a=Math.max(a,0));const[s,c,f]=r.getColor(a);o[e]=s,o[e+1]=c,o[e+2]=f,o[e+3]=255}}(a,n),new Uint8Array(a.data)}catch(e){console.error(e)}}e.initialize=function(){},e.onmessage=function(e,n){const t=e.data;if("addLayer"===t.command||"removeLayer"===t.command)ae=e.workerId,self.postMessage({type:"<response>",actorId:t.actorId,workerId:ae,params:"ok",callback:e.callback});else if("fetchTerrain"===t.command){const e=(t.params||{}).colors,r=(t.params||{}).tileSize;!function(e,n){const{url:t,origin:r,type:o,accessToken:i,terrainWidth:a,error:s}=e,c=e.headers||xe[o];if("tianditu"===o)Ue(t,c,o,a,s,n);else if("cesium-ion"===o){const f=e.cesiumIonTokenURL+i;Ae?Ue(t,c,o,a,s,n):(ye||(ye=fetch(f,{responseType:"json",method:"GET",referrer:r,headers:{Accept:"application/json,*/*;q=0.01","Accept-Encoding":"gzip, deflate, br"}}).then((e=>e.json())).then((e=>{Ae=e.accessToken,ye=null}))),ye.then((()=>{Ue(t,c,o,a,s,n)})))}else("cesium"===o||"mapbox"===o)&&Ue(t,c,o,a,s,n)}(t.params,((t,o)=>{const i=We(t,e,r);i&&(t.colorsTexture=i,(o=o||[]).push(i.buffer)),n(t.error,t,o)}))}else"abortTerrain"===t.command&&(r=t.params.url,me[r]&&(me[r].abort(),delete me[r]));var r}}`),"undefined"!=typeof console&&console.log("@maptalks/gl v0.102.1");const gD={width:100,height:10};let mD=!1;try{const e=new OffscreenCanvas(1,1);e.getContext("2d").fillText("hello",0,0),mD=!0}catch(e){mD=!1}let yD=class ColorIn{constructor(e,n={}){if(!Array.isArray(e))return void console.error("colors is not array");if(e.length<2)return void console.error("colors.length should >1");this.colors=e;let i=1/0,o=-1/0;for(let n=0,s=e.length;n<s;n++){const s=e[n][0];i=Math.min(s,i),o=Math.max(s,o)}this.min=i,this.max=o,this.valueOffset=this.max-this.min,this.options=Object.assign({},gD,n),this._initImgData()}getImageData(){return this.imgData}_initImgData(){const e=function(){if(!pD){const{width:e,height:n}=gD;mD?pD=new OffscreenCanvas(e,n):(pD=document.createElement("canvas"),pD.width=e,pD.height=n)}return pD}(),{width:n,height:i}=this.options;e.width=n,e.height=i;const o=e.getContext("2d");o.clearRect(0,0,e.width,e.height);const s=o.createLinearGradient(0,0,e.width,0),{colors:a,valueOffset:h}=this;for(let e=0,n=a.length;e<n;e++){const[n,i]=a[e];s.addColorStop((n-this.min)/h,i)}o.fillStyle=s,o.fillRect(0,0,e.width,e.height),this.imgData=o.getImageData(0,0,e.width,e.height)}getColor(e){e=Math.max(this.min,e),e=Math.min(e,this.max);let n=Math.round((e-this.min)/this.valueOffset*this.imgData.width);n=Math.min(n,this.imgData.width-1);const i=4*n;return[this.imgData.data[i],this.imgData.data[i+1],this.imgData.data[i+2],this.imgData.data[i+3]]}};var vD;function _D(e,n){var i,o,s;if(ED(e)){var a,h=e.stops&&"object"==typeof e.stops[0][0],l=h||!(h||void 0!==e.property),c=e.type||n||"exponential";if("exponential"===c)a=wD;else if("interval"===c)a=bD;else if("categorical"===c)a=xD;else if("identity"===c)a=MD;else if("color-interpolate"===c)a=PD;else{if("calculate-expression"!==c)throw new Error('Unknown function type "'+c+'"');a=TD}if(h){var A={},f=[];for(let n=0;n<e.stops.length;n++){var d=e.stops[n];void 0===A[d[0].zoom]&&(A[d[0].zoom]={zoom:d[0].zoom,type:e.type,property:e.property,default:e.default,stops:[]}),A[d[0].zoom].stops.push([d[0].value,d[1]])}for(let e in A)f.push([A[e].zoom,_D(A[e])]);i=function(n,i){const o=wD({stops:f,base:e.base},n)(n,i);return"function"==typeof o?o(n,i):o},o=!1,s=!1}else l?(i=function(n){const i=a(e,n);return"function"==typeof i?i(n):i},o=!0,s=!1):(i=function(n,i){const o=a(e,i?i[e.property]:null);return"function"==typeof o?o(n,i):o},o=!1,s=!0)}else i=function(){return e},o=!0,s=!0;return i.isZoomConstant=s,i.isFeatureConstant=o,i}function xD(e,n){for(let i=0;i<e.stops.length;i++)if(n===e.stops[i][0])return e.stops[i][1];return e.default}function bD(e,n){for(var i=0;i<e.stops.length&&!(n<e.stops[i][0]);i++);return e.stops[Math.max(i-1,0)][1]}function wD(e,n){for(var i=void 0!==e.base?e.base:1,o=0;!(o>=e.stops.length||n<=e.stops[o][0]);)o++;return 0===o?e.stops[o][1]:o===e.stops.length?e.stops[o-1][1]:SD(n,i,e.stops[o-1][0],e.stops[o][0],e.stops[o-1][1],e.stops[o][1])}"function"==typeof Map&&(vD=new Map);const CD={width:100,height:1};function PD(e,n){const i=e.stops;if(i&&i.length>1){let e;if(vD){const n=JSON.stringify(i);if(!vD.has(n)){const e=new yD(i,CD);vD.set(n,e)}e=vD.get(n)}else e=new yD(i,CD);const[o,s,a,h]=e.getColor(n);return[o/255,s/255,a/255,h/255]}return i&&1===i.length?i[0][1]:null}function MD(e,n){return function(e,n,i){return void 0!==e?e:void 0!==n?n:null}(n,e.default)}function TD(e,n){const i=String(e.property),o=e.expression,s=n;function a(n){return null==n||""===n||isNaN(n)?e.default:n}if(null==n||""===n||isNaN(n)||n<0)return a(e.default);{const n=function e(n,i,o){const s=Number(o),a=String(i);return Array.isArray(n)?n.map((n=>e(n,a,s))):n===a?s:n}(o,i,s);return a(function n(i){if(!Array.isArray(i)){if("number"==typeof i)return i;throw new Error("Invalid expression format")}{const o=i[0];if(!["+","-","*","/"].includes(o))throw new Error(`Unknown operator: ${o}`);const s=i.slice(1).map((e=>n(e)));switch(o){case"+":return s.reduce(((e,n)=>e+n),0);case"-":return s.reduce(((e,n)=>e-n));case"*":return s.reduce(((e,n)=>e*n),1);case"/":return s.some((e=>0===e))?e.default:s.reduce(((e,n)=>e/n));default:throw new Error(`Unsupported operator: ${o}`)}}}(n))}}function SD(e,n,i,o,s,a){return"function"==typeof s?function(){var h=s.apply(void 0,arguments),l=a.apply(void 0,arguments);return SD(e,n,i,o,h,l)}:s.length?function(e,n,i,o,s,a){var h=[];for(let l=0;l<s.length;l++)h[l]=ID(e,n,i,o,s[l],a[l]);return h}(e,n,i,o,s,a):ID(e,n,i,o,s,a)}function ID(e,n,i,o,s,a){var h,l=o-i,c=e-i;return s*(1-(h=1===n?c/l:(Math.pow(n,c)-1)/(Math.pow(n,l)-1)))+a*h}function ED(e){return e&&"object"==typeof e&&(e.stops||e.property&&"identity"===e.type||e.expression&&"calculate-expression"===e.type)}function OD(e){for(const n in e)if(ED(e[n]))return!0;return!1}function RD(e){return LD(e,"exponential")}function DD(e){return LD(e,"interval")}function kD(e,n){if(!e)return null;var i=!1;if(Array.isArray(e)){var o,s=[];for(let a=0;a<e.length;a++)(o=kD(e[a],n))?(s.push(o),i=!0):s.push(e[a]);return i?s:e}var a,h={__fn_types_loaded:!0},l=[];for(a in e)e.hasOwnProperty(a)&&l.push(a);const c=function(e){Object.defineProperty(h,e,{get:function(){return this["__fn_"+e]||(this["__fn_"+e]=RD(this["_"+e])),this["__fn_"+e].apply(this,n())},set:function(n){this["_"+e]=n},configurable:!0,enumerable:!0})};for(let n=0,o=l.length;n<o;n++)ED(e[a=l[n]])?(i=!0,h["_"+a]=e[a],c(a)):h[a]=e[a];return i?h:e}function LD(e,n){if(!ED(e))return function(){return e};let i=!0,o=!0;const s=(e=JSON.parse(JSON.stringify(e))).stops;if(s)for(let e=0;e<s.length;e++)if(ED(s[e][1])){const a=LD(s[e][1],n);i=i&&a.isZoomConstant,o=o&&a.isFeatureConstant,s[e]=[s[e][0],a]}const a=_D(e,n);return a.isZoomConstant=i&&a.isZoomConstant,a.isFeatureConstant=o&&a.isFeatureConstant,a}var FD={exports:{}},ND={exports:{}},zD=function(e){return!(!e||"string"==typeof e)&&(e instanceof Array||Array.isArray(e)||e.length>=0&&(e.splice instanceof Function||Object.getOwnPropertyDescriptor(e,e.length-1)&&"String"!==e.constructor.name))},BD=Array.prototype.concat,HD=Array.prototype.slice,jD=ND.exports=function(e){for(var n=[],i=0,o=e.length;i<o;i++){var s=e[i];zD(s)?n=BD.call(n,HD.call(s)):n.push(s)}return n};jD.wrap=function(e){return function(){return e(jD(arguments))}};var UD={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},GD=ND.exports,VD=Object.hasOwnProperty,WD=Object.create(null);for(var qD in UD)VD.call(UD,qD)&&(WD[UD[qD]]=qD);var ZD=FD.exports={to:{},get:{}};function QD(e,n,i){return Math.min(Math.max(n,e),i)}function XD(e){var n=Math.round(e).toString(16).toUpperCase();return n.length<2?"0"+n:n}ZD.get=function(e){var n,i;switch(e.substring(0,3).toLowerCase()){case"hsl":n=ZD.get.hsl(e),i="hsl";break;case"hwb":n=ZD.get.hwb(e),i="hwb";break;default:n=ZD.get.rgb(e),i="rgb"}return n?{model:i,value:n}:null},ZD.get.rgb=function(e){if(!e)return null;var n,i,o,s=[0,0,0,1];if(n=e.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(o=n[2],n=n[1],i=0;i<3;i++){var a=2*i;s[i]=parseInt(n.slice(a,a+2),16)}o&&(s[3]=parseInt(o,16)/255)}else if(n=e.match(/^#([a-f0-9]{3,4})$/i)){for(o=(n=n[1])[3],i=0;i<3;i++)s[i]=parseInt(n[i]+n[i],16);o&&(s[3]=parseInt(o+o,16)/255)}else if(n=e.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(i=0;i<3;i++)s[i]=parseInt(n[i+1],0);n[4]&&(s[3]=n[5]?.01*parseFloat(n[4]):parseFloat(n[4]))}else{if(!(n=e.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(n=e.match(/^(\w+)$/))?"transparent"===n[1]?[0,0,0,0]:VD.call(UD,n[1])?((s=UD[n[1]])[3]=1,s):null:null;for(i=0;i<3;i++)s[i]=Math.round(2.55*parseFloat(n[i+1]));n[4]&&(s[3]=n[5]?.01*parseFloat(n[4]):parseFloat(n[4]))}for(i=0;i<3;i++)s[i]=QD(s[i],0,255);return s[3]=QD(s[3],0,1),s},ZD.get.hsl=function(e){if(!e)return null;var n=e.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(n){var i=parseFloat(n[4]);return[(parseFloat(n[1])%360+360)%360,QD(parseFloat(n[2]),0,100),QD(parseFloat(n[3]),0,100),QD(isNaN(i)?1:i,0,1)]}return null},ZD.get.hwb=function(e){if(!e)return null;var n=e.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(n){var i=parseFloat(n[4]);return[(parseFloat(n[1])%360+360)%360,QD(parseFloat(n[2]),0,100),QD(parseFloat(n[3]),0,100),QD(isNaN(i)?1:i,0,1)]}return null},ZD.to.hex=function(){var e=GD(arguments);return"#"+XD(e[0])+XD(e[1])+XD(e[2])+(e[3]<1?XD(Math.round(255*e[3])):"")},ZD.to.rgb=function(){var e=GD(arguments);return e.length<4||1===e[3]?"rgb("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+")":"rgba("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+", "+e[3]+")"},ZD.to.rgb.percent=function(){var e=GD(arguments),n=Math.round(e[0]/255*100),i=Math.round(e[1]/255*100),o=Math.round(e[2]/255*100);return e.length<4||1===e[3]?"rgb("+n+"%, "+i+"%, "+o+"%)":"rgba("+n+"%, "+i+"%, "+o+"%, "+e[3]+")"},ZD.to.hsl=function(){var e=GD(arguments);return e.length<4||1===e[3]?"hsl("+e[0]+", "+e[1]+"%, "+e[2]+"%)":"hsla("+e[0]+", "+e[1]+"%, "+e[2]+"%, "+e[3]+")"},ZD.to.hwb=function(){var e=GD(arguments),n="";return e.length>=4&&1!==e[3]&&(n=", "+e[3]),"hwb("+e[0]+", "+e[1]+"%, "+e[2]+"%"+n+")"},ZD.to.keyword=function(e){return WD[e.slice(0,3)]};var YD=FD.exports,JD={exports:{}},KD={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},$D={};for(var tk in KD)KD.hasOwnProperty(tk)&&($D[KD[tk]]=tk);var ek=JD.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var nk in ek)if(ek.hasOwnProperty(nk)){if(!("channels"in ek[nk]))throw new Error("missing channels property: "+nk);if(!("labels"in ek[nk]))throw new Error("missing channel labels property: "+nk);if(ek[nk].labels.length!==ek[nk].channels)throw new Error("channel and label counts mismatch: "+nk);var ik=ek[nk].channels,rk=ek[nk].labels;delete ek[nk].channels,delete ek[nk].labels,Object.defineProperty(ek[nk],"channels",{value:ik}),Object.defineProperty(ek[nk],"labels",{value:rk})}function ok(e,n){return Math.pow(e[0]-n[0],2)+Math.pow(e[1]-n[1],2)+Math.pow(e[2]-n[2],2)}ek.rgb.hsl=function(e){var n,i,o=e[0]/255,s=e[1]/255,a=e[2]/255,h=Math.min(o,s,a),l=Math.max(o,s,a),c=l-h;return l===h?n=0:o===l?n=(s-a)/c:s===l?n=2+(a-o)/c:a===l&&(n=4+(o-s)/c),(n=Math.min(60*n,360))<0&&(n+=360),i=(h+l)/2,[n,100*(l===h?0:i<=.5?c/(l+h):c/(2-l-h)),100*i]},ek.rgb.hsv=function(e){var n,i,o,s,a,h=e[0]/255,l=e[1]/255,c=e[2]/255,A=Math.max(h,l,c),f=A-Math.min(h,l,c),d=function(e){return(A-e)/6/f+.5};return 0===f?s=a=0:(a=f/A,n=d(h),i=d(l),o=d(c),h===A?s=o-i:l===A?s=1/3+n-o:c===A&&(s=2/3+i-n),s<0?s+=1:s>1&&(s-=1)),[360*s,100*a,100*A]},ek.rgb.hwb=function(e){var n=e[0],i=e[1],o=e[2];return[ek.rgb.hsl(e)[0],100*(1/255*Math.min(n,Math.min(i,o))),100*(o=1-1/255*Math.max(n,Math.max(i,o)))]},ek.rgb.cmyk=function(e){var n,i=e[0]/255,o=e[1]/255,s=e[2]/255;return[100*((1-i-(n=Math.min(1-i,1-o,1-s)))/(1-n)||0),100*((1-o-n)/(1-n)||0),100*((1-s-n)/(1-n)||0),100*n]},ek.rgb.keyword=function(e){var n=$D[e];if(n)return n;var i,o=1/0;for(var s in KD)if(KD.hasOwnProperty(s)){var a=ok(e,KD[s]);a<o&&(o=a,i=s)}return i},ek.keyword.rgb=function(e){return KD[e]},ek.rgb.xyz=function(e){var n=e[0]/255,i=e[1]/255,o=e[2]/255;return[100*(.4124*(n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92)+.3576*(i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92)+.1805*(o=o>.04045?Math.pow((o+.055)/1.055,2.4):o/12.92)),100*(.2126*n+.7152*i+.0722*o),100*(.0193*n+.1192*i+.9505*o)]},ek.rgb.lab=function(e){var n=ek.rgb.xyz(e),i=n[0],o=n[1],s=n[2];return o/=100,s/=108.883,i=(i/=95.047)>.008856?Math.pow(i,1/3):7.787*i+16/116,[116*(o=o>.008856?Math.pow(o,1/3):7.787*o+16/116)-16,500*(i-o),200*(o-(s=s>.008856?Math.pow(s,1/3):7.787*s+16/116))]},ek.hsl.rgb=function(e){var n,i,o,s,a,h=e[0]/360,l=e[1]/100,c=e[2]/100;if(0===l)return[a=255*c,a,a];n=2*c-(i=c<.5?c*(1+l):c+l-c*l),s=[0,0,0];for(var A=0;A<3;A++)(o=h+1/3*-(A-1))<0&&o++,o>1&&o--,s[A]=255*(a=6*o<1?n+6*(i-n)*o:2*o<1?i:3*o<2?n+(i-n)*(2/3-o)*6:n);return s},ek.hsl.hsv=function(e){var n=e[0],i=e[1]/100,o=e[2]/100,s=i,a=Math.max(o,.01);return i*=(o*=2)<=1?o:2-o,s*=a<=1?a:2-a,[n,100*(0===o?2*s/(a+s):2*i/(o+i)),100*((o+i)/2)]},ek.hsv.rgb=function(e){var n=e[0]/60,i=e[1]/100,o=e[2]/100,s=Math.floor(n)%6,a=n-Math.floor(n),h=255*o*(1-i),l=255*o*(1-i*a),c=255*o*(1-i*(1-a));switch(o*=255,s){case 0:return[o,c,h];case 1:return[l,o,h];case 2:return[h,o,c];case 3:return[h,l,o];case 4:return[c,h,o];case 5:return[o,h,l]}},ek.hsv.hsl=function(e){var n,i,o,s=e[0],a=e[1]/100,h=e[2]/100,l=Math.max(h,.01);return o=(2-a)*h,i=a*l,[s,100*(i=(i/=(n=(2-a)*l)<=1?n:2-n)||0),100*(o/=2)]},ek.hwb.rgb=function(e){var n,i,o,s,a,h,l,c=e[0]/360,A=e[1]/100,f=e[2]/100,d=A+f;switch(d>1&&(A/=d,f/=d),o=6*c-(n=Math.floor(6*c)),1&n&&(o=1-o),s=A+o*((i=1-f)-A),n){default:case 6:case 0:a=i,h=s,l=A;break;case 1:a=s,h=i,l=A;break;case 2:a=A,h=i,l=s;break;case 3:a=A,h=s,l=i;break;case 4:a=s,h=A,l=i;break;case 5:a=i,h=A,l=s}return[255*a,255*h,255*l]},ek.cmyk.rgb=function(e){var n=e[1]/100,i=e[2]/100,o=e[3]/100;return[255*(1-Math.min(1,e[0]/100*(1-o)+o)),255*(1-Math.min(1,n*(1-o)+o)),255*(1-Math.min(1,i*(1-o)+o))]},ek.xyz.rgb=function(e){var n,i,o,s=e[0]/100,a=e[1]/100,h=e[2]/100;return i=-.9689*s+1.8758*a+.0415*h,o=.0557*s+-.204*a+1.057*h,n=(n=3.2406*s+-1.5372*a+-.4986*h)>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,i=i>.0031308?1.055*Math.pow(i,1/2.4)-.055:12.92*i,o=o>.0031308?1.055*Math.pow(o,1/2.4)-.055:12.92*o,[255*(n=Math.min(Math.max(0,n),1)),255*(i=Math.min(Math.max(0,i),1)),255*(o=Math.min(Math.max(0,o),1))]},ek.xyz.lab=function(e){var n=e[0],i=e[1],o=e[2];return i/=100,o/=108.883,n=(n/=95.047)>.008856?Math.pow(n,1/3):7.787*n+16/116,[116*(i=i>.008856?Math.pow(i,1/3):7.787*i+16/116)-16,500*(n-i),200*(i-(o=o>.008856?Math.pow(o,1/3):7.787*o+16/116))]},ek.lab.xyz=function(e){var n,i,o;n=e[1]/500+(i=(e[0]+16)/116),o=i-e[2]/200;var s=Math.pow(i,3),a=Math.pow(n,3),h=Math.pow(o,3);return i=s>.008856?s:(i-16/116)/7.787,n=a>.008856?a:(n-16/116)/7.787,o=h>.008856?h:(o-16/116)/7.787,[n*=95.047,i*=100,o*=108.883]},ek.lab.lch=function(e){var n,i=e[0],o=e[1],s=e[2];return(n=360*Math.atan2(s,o)/2/Math.PI)<0&&(n+=360),[i,Math.sqrt(o*o+s*s),n]},ek.lch.lab=function(e){var n,i=e[1];return n=e[2]/360*2*Math.PI,[e[0],i*Math.cos(n),i*Math.sin(n)]},ek.rgb.ansi16=function(e){var n=e[0],i=e[1],o=e[2],s=1 in arguments?arguments[1]:ek.rgb.hsv(e)[2];if(0===(s=Math.round(s/50)))return 30;var a=30+(Math.round(o/255)<<2|Math.round(i/255)<<1|Math.round(n/255));return 2===s&&(a+=60),a},ek.hsv.ansi16=function(e){return ek.rgb.ansi16(ek.hsv.rgb(e),e[2])},ek.rgb.ansi256=function(e){var n=e[0],i=e[1],o=e[2];return n===i&&i===o?n<8?16:n>248?231:Math.round((n-8)/247*24)+232:16+36*Math.round(n/255*5)+6*Math.round(i/255*5)+Math.round(o/255*5)},ek.ansi16.rgb=function(e){var n=e%10;if(0===n||7===n)return e>50&&(n+=3.5),[n=n/10.5*255,n,n];var i=.5*(1+~~(e>50));return[(1&n)*i*255,(n>>1&1)*i*255,(n>>2&1)*i*255]},ek.ansi256.rgb=function(e){if(e>=232){var n=10*(e-232)+8;return[n,n,n]}var i;return e-=16,[Math.floor(e/36)/5*255,Math.floor((i=e%36)/6)/5*255,i%6/5*255]},ek.rgb.hex=function(e){var n=(((255&Math.round(e[0]))<<16)+((255&Math.round(e[1]))<<8)+(255&Math.round(e[2]))).toString(16).toUpperCase();return"000000".substring(n.length)+n},ek.hex.rgb=function(e){var n=e.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!n)return[0,0,0];var i=n[0];3===n[0].length&&(i=i.split("").map((function(e){return e+e})).join(""));var o=parseInt(i,16);return[o>>16&255,o>>8&255,255&o]},ek.rgb.hcg=function(e){var n,i=e[0]/255,o=e[1]/255,s=e[2]/255,a=Math.max(Math.max(i,o),s),h=Math.min(Math.min(i,o),s),l=a-h;return n=l<=0?0:a===i?(o-s)/l%6:a===o?2+(s-i)/l:4+(i-o)/l+4,n/=6,[360*(n%=1),100*l,100*(l<1?h/(1-l):0)]},ek.hsl.hcg=function(e){var n=e[1]/100,i=e[2]/100,o=1,s=0;return(o=i<.5?2*n*i:2*n*(1-i))<1&&(s=(i-.5*o)/(1-o)),[e[0],100*o,100*s]},ek.hsv.hcg=function(e){var n=e[2]/100,i=e[1]/100*n,o=0;return i<1&&(o=(n-i)/(1-i)),[e[0],100*i,100*o]},ek.hcg.rgb=function(e){var n=e[1]/100,i=e[2]/100;if(0===n)return[255*i,255*i,255*i];var o,s=[0,0,0],a=e[0]/360%1*6,h=a%1,l=1-h;switch(Math.floor(a)){case 0:s[0]=1,s[1]=h,s[2]=0;break;case 1:s[0]=l,s[1]=1,s[2]=0;break;case 2:s[0]=0,s[1]=1,s[2]=h;break;case 3:s[0]=0,s[1]=l,s[2]=1;break;case 4:s[0]=h,s[1]=0,s[2]=1;break;default:s[0]=1,s[1]=0,s[2]=l}return[255*(n*s[0]+(o=(1-n)*i)),255*(n*s[1]+o),255*(n*s[2]+o)]},ek.hcg.hsv=function(e){var n=e[1]/100,i=n+e[2]/100*(1-n),o=0;return i>0&&(o=n/i),[e[0],100*o,100*i]},ek.hcg.hsl=function(e){var n=e[1]/100,i=e[2]/100*(1-n)+.5*n,o=0;return i>0&&i<.5?o=n/(2*i):i>=.5&&i<1&&(o=n/(2*(1-i))),[e[0],100*o,100*i]},ek.hcg.hwb=function(e){var n=e[1]/100,i=n+e[2]/100*(1-n);return[e[0],100*(i-n),100*(1-i)]},ek.hwb.hcg=function(e){var n=1-e[2]/100,i=n-e[1]/100,o=0;return i<1&&(o=(n-i)/(1-i)),[e[0],100*i,100*o]},ek.apple.rgb=function(e){return[e[0]/65535*255,e[1]/65535*255,e[2]/65535*255]},ek.rgb.apple=function(e){return[e[0]/255*65535,e[1]/255*65535,e[2]/255*65535]},ek.gray.rgb=function(e){return[e[0]/100*255,e[0]/100*255,e[0]/100*255]},ek.gray.hsl=ek.gray.hsv=function(e){return[0,0,e[0]]},ek.gray.hwb=function(e){return[0,100,e[0]]},ek.gray.cmyk=function(e){return[0,0,0,e[0]]},ek.gray.lab=function(e){return[e[0],0,0]},ek.gray.hex=function(e){var n=255&Math.round(e[0]/100*255),i=((n<<16)+(n<<8)+n).toString(16).toUpperCase();return"000000".substring(i.length)+i},ek.rgb.gray=function(e){return[(e[0]+e[1]+e[2])/3/255*100]};var sk=JD.exports,ak=sk;function hk(e){var n=function(){for(var e={},n=Object.keys(ak),i=n.length,o=0;o<i;o++)e[n[o]]={distance:-1,parent:null};return e}(),i=[e];for(n[e].distance=0;i.length;)for(var o=i.pop(),s=Object.keys(ak[o]),a=s.length,h=0;h<a;h++){var l=s[h],c=n[l];-1===c.distance&&(c.distance=n[o].distance+1,c.parent=o,i.unshift(l))}return n}function lk(e,n){return function(i){return n(e(i))}}function uk(e,n){for(var i=[n[e].parent,e],o=ak[n[e].parent][e],s=n[e].parent;n[s].parent;)i.unshift(n[s].parent),o=lk(ak[n[s].parent][s],o),s=n[s].parent;return o.conversion=i,o}var ck=sk,Ak=function(e){for(var n=hk(e),i={},o=Object.keys(n),s=o.length,a=0;a<s;a++){var h=o[a];null!==n[h].parent&&(i[h]=uk(h,n))}return i},fk={};Object.keys(ck).forEach((function(e){fk[e]={},Object.defineProperty(fk[e],"channels",{value:ck[e].channels}),Object.defineProperty(fk[e],"labels",{value:ck[e].labels});var n=Ak(e);Object.keys(n).forEach((function(i){var o=n[i];fk[e][i]=function(e){var n=function(n){if(null==n)return n;arguments.length>1&&(n=Array.prototype.slice.call(arguments));var i=e(n);if("object"==typeof i)for(var o=i.length,s=0;s<o;s++)i[s]=Math.round(i[s]);return i};return"conversion"in e&&(n.conversion=e.conversion),n}(o),fk[e][i].raw=function(e){var n=function(n){return null==n?n:(arguments.length>1&&(n=Array.prototype.slice.call(arguments)),e(n))};return"conversion"in e&&(n.conversion=e.conversion),n}(o)}))}));var dk=YD,pk=fk,gk=[].slice,mk=["keyword","gray","hex"],yk={};Object.keys(pk).forEach((function(e){yk[gk.call(pk[e].labels).sort().join("")]=e}));var vk={};function _k(e,n){if(!(this instanceof _k))return new _k(e,n);if(n&&n in mk&&(n=null),n&&!(n in pk))throw new Error("Unknown model: "+n);var i,o;if(null==e)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(e instanceof _k)this.model=e.model,this.color=e.color.slice(),this.valpha=e.valpha;else if("string"==typeof e){var s=dk.get(e);if(null===s)throw new Error("Unable to parse color from string: "+e);this.model=s.model,this.color=s.value.slice(0,o=pk[this.model].channels),this.valpha="number"==typeof s.value[o]?s.value[o]:1}else if(e.length){this.model=n||"rgb";var a=gk.call(e,0,o=pk[this.model].channels);this.color=wk(a,o),this.valpha="number"==typeof e[o]?e[o]:1}else if("number"==typeof e)e&=16777215,this.model="rgb",this.color=[e>>16&255,e>>8&255,255&e],this.valpha=1;else{this.valpha=1;var h=Object.keys(e);"alpha"in e&&(h.splice(h.indexOf("alpha"),1),this.valpha="number"==typeof e.alpha?e.alpha:0);var l=h.sort().join("");if(!(l in yk))throw new Error("Unable to parse color from object: "+JSON.stringify(e));this.model=yk[l];var c=pk[this.model].labels,A=[];for(i=0;i<c.length;i++)A.push(e[c[i]]);this.color=wk(A)}if(vk[this.model])for(o=pk[this.model].channels,i=0;i<o;i++){var f=vk[this.model][i];f&&(this.color[i]=f(this.color[i]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}function xk(e,n,i){return(e=Array.isArray(e)?e:[e]).forEach((function(e){(vk[e]||(vk[e]=[]))[n]=i})),e=e[0],function(o){var s;return arguments.length?(i&&(o=i(o)),(s=this[e]()).color[n]=o,s):(s=this[e]().color[n],i&&(s=i(s)),s)}}function bk(e){return function(n){return Math.max(0,Math.min(e,n))}}function wk(e,n){for(var i=0;i<n;i++)"number"!=typeof e[i]&&(e[i]=0);return e}_k.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(e){var n=this.model in dk.to?this:this.rgb(),i=1===(n=n.round("number"==typeof e?e:1)).valpha?n.color:n.color.concat(this.valpha);return dk.to[n.model](i)},percentString:function(e){var n=this.rgb().round("number"==typeof e?e:1),i=1===n.valpha?n.color:n.color.concat(this.valpha);return dk.to.rgb.percent(i)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var e={},n=pk[this.model].channels,i=pk[this.model].labels,o=0;o<n;o++)e[i[o]]=this.color[o];return 1!==this.valpha&&(e.alpha=this.valpha),e},unitArray:function(){var e=this.rgb().color;return e[0]/=255,e[1]/=255,e[2]/=255,1!==this.valpha&&e.push(this.valpha),e},unitObject:function(){var e=this.rgb().object();return e.r/=255,e.g/=255,e.b/=255,1!==this.valpha&&(e.alpha=this.valpha),e},round:function(e){return e=Math.max(e||0,0),new _k(this.color.map(function(e){return function(n){return function(e,n){return Number(e.toFixed(n))}(n,e)}}(e)).concat(this.valpha),this.model)},alpha:function(e){return arguments.length?new _k(this.color.concat(Math.max(0,Math.min(1,e))),this.model):this.valpha},red:xk("rgb",0,bk(255)),green:xk("rgb",1,bk(255)),blue:xk("rgb",2,bk(255)),hue:xk(["hsl","hsv","hsl","hwb","hcg"],0,(function(e){return(e%360+360)%360})),saturationl:xk("hsl",1,bk(100)),lightness:xk("hsl",2,bk(100)),saturationv:xk("hsv",1,bk(100)),value:xk("hsv",2,bk(100)),chroma:xk("hcg",1,bk(100)),gray:xk("hcg",2,bk(100)),white:xk("hwb",1,bk(100)),wblack:xk("hwb",2,bk(100)),cyan:xk("cmyk",0,bk(100)),magenta:xk("cmyk",1,bk(100)),yellow:xk("cmyk",2,bk(100)),black:xk("cmyk",3,bk(100)),x:xk("xyz",0,bk(100)),y:xk("xyz",1,bk(100)),z:xk("xyz",2,bk(100)),l:xk("lab",0,bk(100)),a:xk("lab",1),b:xk("lab",2),keyword:function(e){return arguments.length?new _k(e):pk[this.model].keyword(this.color)},hex:function(e){return arguments.length?new _k(e):dk.to.hex(this.rgb().round().color)},rgbNumber:function(){var e=this.rgb().color;return(255&e[0])<<16|(255&e[1])<<8|255&e[2]},luminosity:function(){for(var e=this.rgb().color,n=[],i=0;i<e.length;i++){var o=e[i]/255;n[i]=o<=.03928?o/12.92:Math.pow((o+.055)/1.055,2.4)}return.2126*n[0]+.7152*n[1]+.0722*n[2]},contrast:function(e){var n=this.luminosity(),i=e.luminosity();return n>i?(n+.05)/(i+.05):(i+.05)/(n+.05)},level:function(e){var n=this.contrast(e);return n>=7.1?"AAA":n>=4.5?"AA":""},isDark:function(){var e=this.rgb().color;return(299*e[0]+587*e[1]+114*e[2])/1e3<128},isLight:function(){return!this.isDark()},negate:function(){for(var e=this.rgb(),n=0;n<3;n++)e.color[n]=255-e.color[n];return e},lighten:function(e){var n=this.hsl();return n.color[2]+=n.color[2]*e,n},darken:function(e){var n=this.hsl();return n.color[2]-=n.color[2]*e,n},saturate:function(e){var n=this.hsl();return n.color[1]+=n.color[1]*e,n},desaturate:function(e){var n=this.hsl();return n.color[1]-=n.color[1]*e,n},whiten:function(e){var n=this.hwb();return n.color[1]+=n.color[1]*e,n},blacken:function(e){var n=this.hwb();return n.color[2]+=n.color[2]*e,n},grayscale:function(){var e=this.rgb().color,n=.3*e[0]+.59*e[1]+.11*e[2];return _k.rgb(n,n,n)},fade:function(e){return this.alpha(this.valpha-this.valpha*e)},opaquer:function(e){return this.alpha(this.valpha+this.valpha*e)},rotate:function(e){var n=this.hsl(),i=n.color[0];return n.color[0]=i=(i=(i+e)%360)<0?360+i:i,n},mix:function(e,n){if(!e||!e.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof e);var i=e.rgb(),o=this.rgb(),s=void 0===n?.5:n,a=2*s-1,h=i.alpha()-o.alpha(),l=((a*h==-1?a:(a+h)/(1+a*h))+1)/2,c=1-l;return _k.rgb(l*i.red()+c*o.red(),l*i.green()+c*o.green(),l*i.blue()+c*o.blue(),i.alpha()*s+o.alpha()*(1-s))}},Object.keys(pk).forEach((function(e){if(-1===mk.indexOf(e)){var n=pk[e].channels;_k.prototype[e]=function(){if(this.model===e)return new _k(this);if(arguments.length)return new _k(arguments,e);var i,o="number"==typeof arguments[n]?n:this.valpha;return new _k((i=pk[this.model][e].raw(this.color),Array.isArray(i)?i:[i]).concat(o),e)},_k[e]=function(i){return"number"==typeof i&&(i=wk(gk.call(arguments),n)),new _k(i,e)}}}));var Ck=zm(_k);
/*!
      Feature Filter by

      (c) mapbox 2016 and maptalks 2018
      www.mapbox.com | www.maptalks.org
      License: MIT, header required.
  */
const Pk=["Unknown","Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"];function Mk(e){return new Function("f",`var p = (f && f.properties || {}); return ${Sk(e)}`)}function Tk(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":case"!has":return 2===e.length&&("string"==typeof e[1]||e[1].property&&e[1].op);case"in":case"!in":return e.length>=2&&("string"==typeof e[1]||e[1].property&&e[1].op);case"==":case"!=":case">":case">=":case"<":case"<=":return 3===e.length&&("string"==typeof e[1]||e[1].property&&e[1].op);case"none":case"any":case"all":for(const n of e.slice(1))if(!Tk(n)&&"boolean"!=typeof n)return!1;return!0;case"contains":return!0;default:return!1}}function Sk(e){if(!e)return"true";const n=e[0];if(e.length<=1)return"any"===n?"false":"true";const i="=="===n?Ek(e[1],e[2],"===",!1):"!="===n?Ek(e[1],e[2],"!==",!1):"<"===n||">"===n||"<="===n||">="===n?Ek(e[1],e[2],n,!0):"any"===n?Rk(e.slice(1),"||"):"all"===n?Rk(e.slice(1),"&&"):"none"===n?Lk(Rk(e.slice(1),"||")):"in"===n?Dk(e[1],e.slice(2)):"!in"===n?Lk(Dk(e[1],e.slice(2))):"has"===n?kk(e[1]):"!has"===n?Lk(kk(e[1])):"contains"===n?function(e,n,i){const o=Ik(e);return void 0!==i?`(${o} + '').indexOf("${n}") === ${i}`:`(${o} + '').indexOf("${n}") >= 0`}(e[1],e[2],e[3]):"true";return`(${i})`}function Ik(e){return"$"===e[0]?"f."+e.substring(1):"p["+JSON.stringify(e)+"]"}function Ek(e,n,i,o){if("object"==typeof(s=e)&&s&&e.op)return function(e,n,i,o){const s=e.property,a=e.op;let h=Ik(s);return"length"!==a?(console.error(`not support ${a} op`),"false"):(h=`((${h}+='').length)`,Ok(h,s,n,i,o))}(e,n,i,o);var s;return Ok(Ik(e),e,n,i,o)}function Ok(e,n,i,o,s){const a="$type"===n?Pk.indexOf(i):JSON.stringify(i);return(s?`typeof ${e}=== typeof ${a}&&`:"")+e+o+a}function Rk(e,n){return e.map(Sk).join(n)}function Dk(e,n){"$type"===e&&(n=n.map((e=>Pk.indexOf(e))));const i=JSON.stringify(n.sort(Fk)),o=Ik(e);return n.length<=200?`${i}.indexOf(${o}) !== -1`:`function(v, a, i, j) {\n        while (i <= j) { var m = (i + j) >> 1;\n            if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;\n        }\n    return false; }(${o}, ${i},0,${n.length-1})`}function kk(e){return"$id"===e?'"id" in f':`${JSON.stringify(e)} in p`}function Lk(e){return`!(${e})`}function Fk(e,n){return e<n?-1:e>n?1:0}function Nk(e){if(!Array.isArray(e))return Nk([e]);const n=[];for(let i=0;i<e.length;i++){let o;o=!0===e[i].filter?function(){return!0}:Mk(e[i].filter),n.push(zk({},e[i],{filter:o}))}return n}function zk(e){for(let n=1;n<arguments.length;n++){const i=arguments[n];for(const n in i)e[n]=i[n]}return e}var Bk={exports:{}};!function(e,n){e.exports=function(){function e(e,i,s,a,h){n(e,i,s||0,a||e.length-1,h||o)}function n(e,o,s,a,h){for(;a>s;){if(a-s>600){var l=a-s+1,c=o-s+1,A=Math.log(l),f=.5*Math.exp(2*A/3),d=.5*Math.sqrt(A*f*(l-f)/l)*(c-l/2<0?-1:1);n(e,o,Math.max(s,Math.floor(o-c*f/l+d)),Math.min(a,Math.floor(o+(l-c)*f/l+d)),h)}var p=e[o],g=s,v=a;for(i(e,s,o),h(e[a],p)>0&&i(e,s,a);g<v;){for(i(e,g,v),g++,v--;h(e[g],p)<0;)g++;for(;h(e[v],p)>0;)v--}0===h(e[s],p)?i(e,s,v):i(e,++v,a),v<=o&&(s=v+1),o<=v&&(a=v-1)}}function i(e,n,i){var o=e[n];e[n]=e[i],e[i]=o}function o(e,n){return e<n?-1:e>n?1:0}return e}()}(Bk);var Hk=zm(Bk.exports),jk={exports:{}};function Uk(e,n,i){i=i||2;var o,s,a,h,l,c,A,f=n&&n.length,d=f?n[0]*i:e.length,p=Gk(e,0,d,i,!0),g=[];if(!p||p.next===p.prev)return g;if(f&&(p=function(e,n,i,o){var s,a,h,l=[];for(s=0,a=n.length;s<a;s++)(h=Gk(e,n[s]*o,s<a-1?n[s+1]*o:e.length,o,!1))===h.next&&(h.steiner=!0),l.push(tL(h));for(l.sort(Yk),s=0;s<l.length;s++)i=Jk(l[s],i);return i}(e,n,p,i)),e.length>80*i){o=a=e[0],s=h=e[1];for(var v=i;v<d;v+=i)(l=e[v])<o&&(o=l),(c=e[v+1])<s&&(s=c),l>a&&(a=l),c>h&&(h=c);A=0!==(A=Math.max(a-o,h-s))?32767/A:0}return Wk(p,g,i,o,s,A,0),g}function Gk(e,n,i,o,s){var a,h;if(s===fL(e,n,i,o)>0)for(a=n;a<i;a+=o)h=uL(a,e[a],e[a+1],h);else for(a=i-o;a>=n;a-=o)h=uL(a,e[a],e[a+1],h);return h&&rL(h,h.next)&&(cL(h),h=h.next),h}function Vk(e,n){if(!e)return e;n||(n=e);var i,o=e;do{if(i=!1,o.steiner||!rL(o,o.next)&&0!==iL(o.prev,o,o.next))o=o.next;else{if(cL(o),(o=n=o.prev)===o.next)break;i=!0}}while(i||o!==n);return n}function Wk(e,n,i,o,s,a,h){if(e){!h&&a&&function(e,n,i,o){var s=e;do{0===s.z&&(s.z=$k(s.x,s.y,n,i,o)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next}while(s!==e);s.prevZ.nextZ=null,s.prevZ=null,function(e){var n,i,o,s,a,h,l,c,A=1;do{for(i=e,e=null,a=null,h=0;i;){for(h++,o=i,l=0,n=0;n<A&&(l++,o=o.nextZ);n++);for(c=A;l>0||c>0&&o;)0!==l&&(0===c||!o||i.z<=o.z)?(s=i,i=i.nextZ,l--):(s=o,o=o.nextZ,c--),a?a.nextZ=s:e=s,s.prevZ=a,a=s;i=o}a.nextZ=null,A*=2}while(h>1)}(s)}(e,o,s,a);for(var l,c,A=e;e.prev!==e.next;)if(l=e.prev,c=e.next,a?Zk(e,o,s,a):qk(e))n.push(l.i/i|0),n.push(e.i/i|0),n.push(c.i/i|0),cL(e),e=c.next,A=c.next;else if((e=c)===A){h?1===h?Wk(e=Qk(Vk(e),n,i),n,i,o,s,a,2):2===h&&Xk(e,n,i,o,s,a):Wk(Vk(e),n,i,o,s,a,1);break}}}function qk(e){var n=e.prev,i=e,o=e.next;if(iL(n,i,o)>=0)return!1;for(var s=n.x,a=i.x,h=o.x,l=n.y,c=i.y,A=o.y,f=s<a?s<h?s:h:a<h?a:h,d=l<c?l<A?l:A:c<A?c:A,p=s>a?s>h?s:h:a>h?a:h,g=l>c?l>A?l:A:c>A?c:A,v=o.next;v!==n;){if(v.x>=f&&v.x<=p&&v.y>=d&&v.y<=g&&eL(s,l,a,c,h,A,v.x,v.y)&&iL(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function Zk(e,n,i,o){var s=e.prev,a=e,h=e.next;if(iL(s,a,h)>=0)return!1;for(var l=s.x,c=a.x,A=h.x,f=s.y,d=a.y,p=h.y,g=l<c?l<A?l:A:c<A?c:A,v=f<d?f<p?f:p:d<p?d:p,w=l>c?l>A?l:A:c>A?c:A,C=f>d?f>p?f:p:d>p?d:p,P=$k(g,v,n,i,o),T=$k(w,C,n,i,o),S=e.prevZ,I=e.nextZ;S&&S.z>=P&&I&&I.z<=T;){if(S.x>=g&&S.x<=w&&S.y>=v&&S.y<=C&&S!==s&&S!==h&&eL(l,f,c,d,A,p,S.x,S.y)&&iL(S.prev,S,S.next)>=0)return!1;if(S=S.prevZ,I.x>=g&&I.x<=w&&I.y>=v&&I.y<=C&&I!==s&&I!==h&&eL(l,f,c,d,A,p,I.x,I.y)&&iL(I.prev,I,I.next)>=0)return!1;I=I.nextZ}for(;S&&S.z>=P;){if(S.x>=g&&S.x<=w&&S.y>=v&&S.y<=C&&S!==s&&S!==h&&eL(l,f,c,d,A,p,S.x,S.y)&&iL(S.prev,S,S.next)>=0)return!1;S=S.prevZ}for(;I&&I.z<=T;){if(I.x>=g&&I.x<=w&&I.y>=v&&I.y<=C&&I!==s&&I!==h&&eL(l,f,c,d,A,p,I.x,I.y)&&iL(I.prev,I,I.next)>=0)return!1;I=I.nextZ}return!0}function Qk(e,n,i){var o=e;do{var s=o.prev,a=o.next.next;!rL(s,a)&&oL(s,o,o.next,a)&&hL(s,a)&&hL(a,s)&&(n.push(s.i/i|0),n.push(o.i/i|0),n.push(a.i/i|0),cL(o),cL(o.next),o=e=a),o=o.next}while(o!==e);return Vk(o)}function Xk(e,n,i,o,s,a){var h=e;do{for(var l=h.next.next;l!==h.prev;){if(h.i!==l.i&&nL(h,l)){var c=lL(h,l);return h=Vk(h,h.next),c=Vk(c,c.next),Wk(h,n,i,o,s,a,0),void Wk(c,n,i,o,s,a,0)}l=l.next}h=h.next}while(h!==e)}function Yk(e,n){return e.x-n.x}function Jk(e,n){var i=function(e,n){var i,o=n,s=e.x,a=e.y,h=-1/0;do{if(a<=o.y&&a>=o.next.y&&o.next.y!==o.y){var l=o.x+(a-o.y)*(o.next.x-o.x)/(o.next.y-o.y);if(l<=s&&l>h&&(h=l,i=o.x<o.next.x?o:o.next,l===s))return i}o=o.next}while(o!==n);if(!i)return null;var c,A=i,f=i.x,d=i.y,p=1/0;o=i;do{s>=o.x&&o.x>=f&&s!==o.x&&eL(a<d?s:h,a,f,d,a<d?h:s,a,o.x,o.y)&&(c=Math.abs(a-o.y)/(s-o.x),hL(o,e)&&(c<p||c===p&&(o.x>i.x||o.x===i.x&&Kk(i,o)))&&(i=o,p=c)),o=o.next}while(o!==A);return i}(e,n);if(!i)return n;var o=lL(i,e);return Vk(o,o.next),Vk(i,i.next)}function Kk(e,n){return iL(e.prev,e,n.prev)<0&&iL(n.next,e,e.next)<0}function $k(e,n,i,o,s){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*s|0)|e<<8))|e<<4))|e<<2))|e<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-o)*s|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function tL(e){var n=e,i=e;do{(n.x<i.x||n.x===i.x&&n.y<i.y)&&(i=n),n=n.next}while(n!==e);return i}function eL(e,n,i,o,s,a,h,l){return(s-h)*(n-l)>=(e-h)*(a-l)&&(e-h)*(o-l)>=(i-h)*(n-l)&&(i-h)*(a-l)>=(s-h)*(o-l)}function nL(e,n){return e.next.i!==n.i&&e.prev.i!==n.i&&!function(e,n){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==n.i&&i.next.i!==n.i&&oL(i,i.next,e,n))return!0;i=i.next}while(i!==e);return!1}(e,n)&&(hL(e,n)&&hL(n,e)&&function(e,n){var i=e,o=!1,s=(e.x+n.x)/2,a=(e.y+n.y)/2;do{i.y>a!=i.next.y>a&&i.next.y!==i.y&&s<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(o=!o),i=i.next}while(i!==e);return o}(e,n)&&(iL(e.prev,e,n.prev)||iL(e,n.prev,n))||rL(e,n)&&iL(e.prev,e,e.next)>0&&iL(n.prev,n,n.next)>0)}function iL(e,n,i){return(n.y-e.y)*(i.x-n.x)-(n.x-e.x)*(i.y-n.y)}function rL(e,n){return e.x===n.x&&e.y===n.y}function oL(e,n,i,o){var s=aL(iL(e,n,i)),a=aL(iL(e,n,o)),h=aL(iL(i,o,e)),l=aL(iL(i,o,n));return s!==a&&h!==l||(!(0!==s||!sL(e,i,n))||(!(0!==a||!sL(e,o,n))||(!(0!==h||!sL(i,e,o))||!(0!==l||!sL(i,n,o)))))}function sL(e,n,i){return n.x<=Math.max(e.x,i.x)&&n.x>=Math.min(e.x,i.x)&&n.y<=Math.max(e.y,i.y)&&n.y>=Math.min(e.y,i.y)}function aL(e){return e>0?1:e<0?-1:0}function hL(e,n){return iL(e.prev,e,e.next)<0?iL(e,n,e.next)>=0&&iL(e,e.prev,n)>=0:iL(e,n,e.prev)<0||iL(e,e.next,n)<0}function lL(e,n){var i=new AL(e.i,e.x,e.y),o=new AL(n.i,n.x,n.y),s=e.next,a=n.prev;return e.next=n,n.prev=e,i.next=s,s.prev=i,o.next=i,i.prev=o,a.next=o,o.prev=a,o}function uL(e,n,i,o){var s=new AL(e,n,i);return o?(s.next=o.next,s.prev=o,o.next.prev=s,o.next=s):(s.prev=s,s.next=s),s}function cL(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function AL(e,n,i){this.i=e,this.x=n,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function fL(e,n,i,o){for(var s=0,a=n,h=i-o;a<i;a+=o)s+=(e[h]-e[a])*(e[a+1]+e[h+1]),h=a;return s}jk.exports=Uk,jk.exports.default=Uk,Uk.deviation=function(e,n,i,o){var s=n&&n.length,a=Math.abs(fL(e,0,s?n[0]*i:e.length,i));if(s)for(var h=0,l=n.length;h<l;h++){a-=Math.abs(fL(e,n[h]*i,h<l-1?n[h+1]*i:e.length,i))}var c=0;for(h=0;h<o.length;h+=3){var A=o[h]*i,f=o[h+1]*i,d=o[h+2]*i;c+=Math.abs((e[A]-e[d])*(e[f+1]-e[A+1])-(e[A]-e[f])*(e[d+1]-e[A+1]))}return 0===a&&0===c?0:Math.abs((c-a)/a)},Uk.flatten=function(e){for(var n=e[0][0].length,i={vertices:[],holes:[],dimensions:n},o=0,s=0;s<e.length;s++){for(var a=0;a<e[s].length;a++)for(var h=0;h<n;h++)i.vertices.push(e[s][a][h]);s>0&&i.holes.push(o+=e[s-1].length)}return i};var dL=zm(jk.exports),pL=Math.pow,gL=Math.sqrt,mL=Math.sin,yL=Math.cos,vL=Math.PI,_L=1.70158,xL=1.525*_L,bL=_L+1,wL=2*vL/3,CL=2*vL/4.5;function PL(e){var n=7.5625,i=2.75;return e<1/i?n*e*e:e<2/i?n*(e-=1.5/i)*e+.75:e<2.5/i?n*(e-=2.25/i)*e+.9375:n*(e-=2.625/i)*e+.984375}function ML(e,n){switch(e=e.toLowerCase()){case"swing":return function(e){return TL(e)}(n);case"easeinquad":return TL(n);case"easeoutquad":return function(e){return 1-(1-e)*(1-e)}(n);case"easeinoutquad":return function(e){return e<.5?2*e*e:1-pL(-2*e+2,2)/2}(n);case"easeincubic":return function(e){return e*e*e}(n);case"easeoutcubic":return function(e){return 1-pL(1-e,3)}(n);case"easeinoutcubic":return function(e){return e<.5?4*e*e*e:1-pL(-2*e+2,3)/2}(n);case"easeinquart":return function(e){return e*e*e*e}(n);case"easeoutquart":return function(e){return 1-pL(1-e,4)}(n);case"easeinoutquart":return function(e){return e<.5?8*e*e*e*e:1-pL(-2*e+2,4)/2}(n);case"easeinquint":return function(e){return e*e*e*e*e}(n);case"easeoutquint":return function(e){return 1-pL(1-e,5)}(n);case"easeinoutquint":return function(e){return e<.5?16*e*e*e*e*e:1-pL(-2*e+2,5)/2}(n);case"easeinsine":return function(e){return 1-yL(e*vL/2)}(n);case"easeoutsine":return function(e){return mL(e*vL/2)}(n);case"easeinoutsine":return function(e){return-(yL(vL*e)-1)/2}(n);case"easeinexpo":return function(e){return 0===e?0:pL(2,10*e-10)}(n);case"easeoutexpo":return function(e){return 1===e?1:1-pL(2,-10*e)}(n);case"easeinoutexpo":return function(e){return 0===e?0:1===e?1:e<.5?pL(2,20*e-10)/2:(2-pL(2,-20*e+10))/2}(n);case"easeincirc":return function(e){return 1-gL(1-pL(e,2))}(n);case"easeoutcirc":return function(e){return gL(1-pL(e-1,2))}(n);case"easeinoutcirc":return function(e){return e<.5?(1-gL(1-pL(2*e,2)))/2:(gL(1-pL(-2*e+2,2))+1)/2}(n);case"easeinelastic":return function(e){return 0===e?0:1===e?1:-pL(2,10*e-10)*mL((10*e-10.75)*wL)}(n);case"easeoutelastic":return function(e){return 0===e?0:1===e?1:pL(2,-10*e)*mL((10*e-.75)*wL)+1}(n);case"easeinoutelastic":return function(e){return 0===e?0:1===e?1:e<.5?-pL(2,20*e-10)*mL((20*e-11.125)*CL)/2:pL(2,-20*e+10)*mL((20*e-11.125)*CL)/2+1}(n);case"easeinback":return function(e){return bL*e*e*e-_L*e*e}(n);case"easeoutback":return function(e){return 1+bL*pL(e-1,3)+_L*pL(e-1,2)}(n);case"easeinoutback":return function(e){return e<.5?pL(2*e,2)*(2*(xL+1)*e-xL)/2:(pL(2*e-2,2)*((xL+1)*(2*e-2)+xL)+2)/2}(n);case"easeinbounce":return function(e){return 1-PL(1-e)}(n);case"easeoutbounce":return function(e){return PL(e)}(n);case"easeinoutbounce":return function(e){return e<.5?(1-PL(1-2*e))/2:(1+PL(2*e-1))/2}(n)}throw new Error("Unsupported easing function:"+e)}function TL(e){return e*e}function SL(){}const IL=SL.prototype;IL.getType=function(){return Object.getPrototypeOf(this).constructor.type},IL.isVisible=function(){throw new Error("to be implemented.")},IL.prepareRender=function(){throw new Error("to be implemented.")},IL.updateCollision=function(){throw new Error("to be implemented.")},IL.supportRenderMode=function(){throw new Error("to be implemented.")},IL.startFrame=function(){throw new Error("to be implemented.")},IL.endFrame=function(){throw new Error("to be implemented.")},IL.paintTile=function(){throw new Error("to be implemented.")},IL.getShadowMeshes=function(){throw new Error("to be implemented.")},IL.updateSceneConfig=function(){throw new Error("to be implemented.")},IL.updateDataConfig=function(){throw new Error("to be implemented.")},IL.updateSymbol=function(){throw new Error("to be implemented.")},IL.pick=function(){throw new Error("to be implemented.")},IL.resize=function(){throw new Error("to be implemented.")},IL.deleteTile=function(){throw new Error("to be implemented.")},IL.remove=function(){throw new Error("to be implemented.")},IL.needToRedraw=function(){throw new Error("to be implemented.")},IL.needToRetireFrames=function(){throw new Error("to be implemented.")},IL.outline=function(){throw new Error("to be implemented.")},IL.outlineAll=function(){throw new Error("to be implemented.")},IL.needPolygonOffset=function(){throw new Error("to be implemented.")},IL.constructor=SL;const EL=Object.prototype.hasOwnProperty;function OL(e){e.registerPlugin(this)}function RL(e,n,i,o,s){DL(e,n,i||0,o||e.length-1,s||LL)}function DL(e,n,i,o,s){for(;o>i;){if(o-i>600){var a=o-i+1,h=n-i+1,l=Math.log(a),c=.5*Math.exp(2*l/3),A=.5*Math.sqrt(l*c*(a-c)/a)*(h-a/2<0?-1:1);DL(e,n,Math.max(i,Math.floor(n-h*c/a+A)),Math.min(o,Math.floor(n+(a-h)*c/a+A)),s)}var f=e[n],d=i,p=o;for(kL(e,i,n),s(e[o],f)>0&&kL(e,i,o);d<p;){for(kL(e,d,p),d++,p--;s(e[d],f)<0;)d++;for(;s(e[p],f)>0;)p--}0===s(e[i],f)?kL(e,i,p):kL(e,++p,o),p<=n&&(i=p+1),n<=p&&(o=p-1)}}function kL(e,n,i){var o=e[n];e[n]=e[i],e[i]=o}function LL(e,n){return e<n?-1:e>n?1:0}SL.extend=function(e,n){const i=function(){this.init&&this.init()},o=Object.create(IL);o.constructor=i,i.prototype=o,i.type=e;for(const e in n)EL.call(n,e)&&(i.prototype[e]=n[e]);return i.registerAt=OL.bind(i),i};class RBush{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}all(){return this._all(this.data,[])}search(e){let n=this.data;const i=[];if(!ZL(e,n))return i;const o=this.toBBox,s=[];for(;n;){for(let a=0;a<n.children.length;a++){const h=n.children[a],l=n.leaf?o(h):h;ZL(e,l)&&(n.leaf?i.push(h):qL(e,l)?this._all(h,i):s.push(h))}n=s.pop()}return i}collides(e){let n=this.data;if(!ZL(e,n))return!1;const i=[];for(;n;){for(let o=0;o<n.children.length;o++){const s=n.children[o],a=n.leaf?this.toBBox(s):s;if(ZL(e,a)){if(n.leaf||qL(e,a))return!0;i.push(s)}}n=i.pop()}return!1}load(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(let n=0;n<e.length;n++)this.insert(e[n]);return this}let n=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){const e=this.data;this.data=n,n=e}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=QL([]),this}remove(e,n){if(!e)return this;let i=this.data;const o=this.toBBox(e),s=[],a=[];let h,l,c;for(;i||s.length;){if(i||(i=s.pop(),l=s[s.length-1],h=a.pop(),c=!0),i.leaf){const o=FL(e,i.children,n);if(-1!==o)return i.children.splice(o,1),s.push(i),this._condense(s),this}c||i.leaf||!qL(i,o)?l?(h++,i=l.children[h],c=!1):i=null:(s.push(i),a.push(h),h=0,l=i,i=i.children[0])}return this}toBBox(e){return e}compareMinX(e,n){return e.minX-n.minX}compareMinY(e,n){return e.minY-n.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,n){const i=[];for(;e;)e.leaf?n.push(...e.children):i.push(...e.children),e=i.pop();return n}_build(e,n,i,o){const s=i-n+1;let a,h=this._maxEntries;if(s<=h)return a=QL(e.slice(n,i+1)),NL(a,this.toBBox),a;o||(o=Math.ceil(Math.log(s)/Math.log(h)),h=Math.ceil(s/Math.pow(h,o-1))),a=QL([]),a.leaf=!1,a.height=o;const l=Math.ceil(s/h),c=l*Math.ceil(Math.sqrt(h));XL(e,n,i,c,this.compareMinX);for(let s=n;s<=i;s+=c){const n=Math.min(s+c-1,i);XL(e,s,n,l,this.compareMinY);for(let i=s;i<=n;i+=l){const s=Math.min(i+l-1,n);a.children.push(this._build(e,i,s,o-1))}}return NL(a,this.toBBox),a}_chooseSubtree(e,n,i,o){for(;o.push(n),!n.leaf&&o.length-1!==i;){let i,o=1/0,s=1/0;for(let a=0;a<n.children.length;a++){const h=n.children[a],l=UL(h),c=VL(e,h)-l;c<s?(s=c,o=l<o?l:o,i=h):c===s&&l<o&&(o=l,i=h)}n=i||n.children[0]}return n}_insert(e,n,i){const o=i?e:this.toBBox(e),s=[],a=this._chooseSubtree(o,this.data,n,s);for(a.children.push(e),BL(a,o);n>=0&&s[n].children.length>this._maxEntries;)this._split(s,n),n--;this._adjustParentBBoxes(o,s,n)}_split(e,n){const i=e[n],o=i.children.length,s=this._minEntries;this._chooseSplitAxis(i,s,o);const a=this._chooseSplitIndex(i,s,o),h=QL(i.children.splice(a,i.children.length-a));h.height=i.height,h.leaf=i.leaf,NL(i,this.toBBox),NL(h,this.toBBox),n?e[n-1].children.push(h):this._splitRoot(i,h)}_splitRoot(e,n){this.data=QL([e,n]),this.data.height=e.height+1,this.data.leaf=!1,NL(this.data,this.toBBox)}_chooseSplitIndex(e,n,i){let o,s=1/0,a=1/0;for(let h=n;h<=i-n;h++){const n=zL(e,0,h,this.toBBox),l=zL(e,h,i,this.toBBox),c=WL(n,l),A=UL(n)+UL(l);c<s?(s=c,o=h,a=A<a?A:a):c===s&&A<a&&(a=A,o=h)}return o||i-n}_chooseSplitAxis(e,n,i){const o=e.leaf?this.compareMinX:HL,s=e.leaf?this.compareMinY:jL;this._allDistMargin(e,n,i,o)<this._allDistMargin(e,n,i,s)&&e.children.sort(o)}_allDistMargin(e,n,i,o){e.children.sort(o);const s=this.toBBox,a=zL(e,0,n,s),h=zL(e,i-n,i,s);let l=GL(a)+GL(h);for(let o=n;o<i-n;o++){const n=e.children[o];BL(a,e.leaf?s(n):n),l+=GL(a)}for(let o=i-n-1;o>=n;o--){const n=e.children[o];BL(h,e.leaf?s(n):n),l+=GL(h)}return l}_adjustParentBBoxes(e,n,i){for(let o=i;o>=0;o--)BL(n[o],e)}_condense(e){for(let n,i=e.length-1;i>=0;i--)0===e[i].children.length?i>0?(n=e[i-1].children,n.splice(n.indexOf(e[i]),1)):this.clear():NL(e[i],this.toBBox)}}function FL(e,n,i){if(!i)return n.indexOf(e);for(let o=0;o<n.length;o++)if(i(e,n[o]))return o;return-1}function NL(e,n){zL(e,0,e.children.length,n,e)}function zL(e,n,i,o,s){s||(s=QL(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(let a=n;a<i;a++){const n=e.children[a];BL(s,e.leaf?o(n):n)}return s}function BL(e,n){return e.minX=Math.min(e.minX,n.minX),e.minY=Math.min(e.minY,n.minY),e.maxX=Math.max(e.maxX,n.maxX),e.maxY=Math.max(e.maxY,n.maxY),e}function HL(e,n){return e.minX-n.minX}function jL(e,n){return e.minY-n.minY}function UL(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function GL(e){return e.maxX-e.minX+(e.maxY-e.minY)}function VL(e,n){return(Math.max(n.maxX,e.maxX)-Math.min(n.minX,e.minX))*(Math.max(n.maxY,e.maxY)-Math.min(n.minY,e.minY))}function WL(e,n){const i=Math.max(e.minX,n.minX),o=Math.max(e.minY,n.minY),s=Math.min(e.maxX,n.maxX),a=Math.min(e.maxY,n.maxY);return Math.max(0,s-i)*Math.max(0,a-o)}function qL(e,n){return e.minX<=n.minX&&e.minY<=n.minY&&n.maxX<=e.maxX&&n.maxY<=e.maxY}function ZL(e,n){return n.minX<=e.maxX&&n.minY<=e.maxY&&n.maxX>=e.minX&&n.maxY>=e.minY}function QL(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function XL(e,n,i,o,s){const a=[n,i];for(;a.length;){if((i=a.pop())-(n=a.pop())<=o)continue;const h=n+Math.ceil((i-n)/o/2)*o;RL(e,h,n,i,s),a.push(n,h,h,i)}}
/*!
   * @maptalks/vt v0.101.1
   * LICENSE : undefined
   * (c) 2016-2024 maptalks.org
   */const YL="${",JL=`function(t){let n;const e={width:100,height:10};let r=!1;try{const t=new OffscreenCanvas(1,1);t.getContext("2d").fillText("hello",0,0),r=!0}catch(t){r=!1}function i(){if(!n){const{width:t,height:i}=e;r?n=new OffscreenCanvas(t,i):(n=document.createElement("canvas"),n.width=t,n.height=i)}return n}class s{constructor(t,n={}){if(!Array.isArray(t))return void console.error("colors is not array");if(t.length<2)return void console.error("colors.length should >1");this.colors=t;let r=1/0,i=-1/0;for(let n=0,e=t.length;n<e;n++){const e=t[n][0];r=Math.min(e,r),i=Math.max(e,i)}this.min=r,this.max=i,this.valueOffset=this.max-this.min,this.options=Object.assign({},e,n),this.t()}getImageData(){return this.imgData}t(){const t=i(),{width:n,height:e}=this.options;t.width=n,t.height=e;const r=t.getContext("2d");r.clearRect(0,0,t.width,t.height);const s=r.createLinearGradient(0,0,t.width,0),{colors:o,valueOffset:a}=this;for(let t=0,n=o.length;t<n;t++){const[n,e]=o[t],r=(n-this.min)/a;s.addColorStop(r,e)}r.fillStyle=s,r.fillRect(0,0,t.width,t.height),this.imgData=r.getImageData(0,0,t.width,t.height)}getColor(t){t=Math.max(this.min,t);const n=((t=Math.min(t,this.max))-this.min)/this.valueOffset;let e=Math.round(n*this.imgData.width);e=Math.min(e,this.imgData.width-1);const r=4*e;return[this.imgData.data[r],this.imgData.data[r+1],this.imgData.data[r+2],this.imgData.data[r+3]]}}var o;function a(t,n){var e,r,i;if(g(t)){var s,o=t.stops&&"object"==typeof t.stops[0][0],c=o||void 0!==t.property,y=o||!c,m=t.type||n||"exponential";if("exponential"===m)s=h;else if("interval"===m)s=l;else if("categorical"===m)s=u;else if("identity"===m)s=d;else if("color-interpolate"===m)s=f;else{if("calculate-expression"!==m)throw new Error('Unknown function type "'+m+'"');s=p}if(o){var v={},b=[];for(let n=0;n<t.stops.length;n++){var w=t.stops[n];void 0===v[w[0].zoom]&&(v[w[0].zoom]={zoom:w[0].zoom,type:t.type,property:t.property,default:t.default,stops:[]}),v[w[0].zoom].stops.push([w[0].value,w[1]])}for(let t in v)b.push([v[t].zoom,a(v[t])]);e=function(n,e){const r=h({stops:b,base:t.base},n)(n,e);return"function"==typeof r?r(n,e):r},r=!1,i=!1}else y?(e=function(n){const e=s(t,n);return"function"==typeof e?e(n):e},r=!0,i=!1):(e=function(n,e){const r=s(t,e?e[t.property]:null);return"function"==typeof r?r(n,e):r},r=!1,i=!0)}else e=function(){return t},r=!0,i=!0;return e.isZoomConstant=i,e.isFeatureConstant=r,e}function u(t,n){for(let e=0;e<t.stops.length;e++)if(n===t.stops[e][0])return t.stops[e][1];return t.default}function l(t,n){for(var e=0;e<t.stops.length&&!(n<t.stops[e][0]);e++);return t.stops[Math.max(e-1,0)][1]}function h(t,n){for(var e=void 0!==t.base?t.base:1,r=0;!(r>=t.stops.length||n<=t.stops[r][0]);)r++;return 0===r?t.stops[r][1]:r===t.stops.length?t.stops[r-1][1]:y(n,e,t.stops[r-1][0],t.stops[r][0],t.stops[r-1][1],t.stops[r][1])}"function"==typeof Map&&(o=new Map);const c={width:100,height:1};function f(t,n){const e=t.stops;if(e&&e.length>1){let t;if(o){const n=JSON.stringify(e);if(!o.has(n)){const t=new s(e,c);o.set(n,t)}t=o.get(n)}else t=new s(e,c);const[r,i,a,u]=t.getColor(n);return[r/255,i/255,a/255,u/255]}return e&&1===e.length?e[0][1]:null}function d(t,n){return e=n,r=t.default,void 0!==e?e:void 0!==r?r:null;var e,r}function p(t,n){const e=String(t.property),r=t.expression,i=n;function s(n){return null==n||""===n||isNaN(n)?t.default:n}if(null==n||""===n||isNaN(n)||n<0)return s(t.default);{const n=function t(n,e,r){const i=Number(r),s=String(e);return Array.isArray(n)?n.map((n=>t(n,s,i))):n===s?i:n}(r,e,i);return s(function n(e){if(!Array.isArray(e)){if("number"==typeof e)return e;throw new Error("Invalid expression format")}{const r=e[0];if(!["+","-","*","/"].includes(r))throw new Error(\`Unknown operator: ${YL}r}\`);const i=e.slice(1).map((t=>n(t)));switch(r){case"+":return i.reduce(((t,n)=>t+n),0);case"-":return i.reduce(((t,n)=>t-n));case"*":return i.reduce(((t,n)=>t*n),1);case"/":return i.some((t=>0===t))?t.default:i.reduce(((t,n)=>t/n));default:throw new Error(\`Unsupported operator: ${YL}r}\`)}}}(n))}}function y(t,n,e,r,i,s){return"function"==typeof i?function(){var o=i.apply(void 0,arguments),a=s.apply(void 0,arguments);return y(t,n,e,r,o,a)}:i.length?function(t,n,e,r,i,s){var o=[];for(let a=0;a<i.length;a++)o[a]=m(t,n,e,r,i[a],s[a]);return o}(t,n,e,r,i,s):m(t,n,e,r,i,s)}function m(t,n,e,r,i,s){var o,a=r-e,u=t-e;return i*(1-(o=1===n?u/a:(Math.pow(n,u)-1)/(Math.pow(n,a)-1)))+s*o}function g(t){return t&&"object"==typeof t&&(t.stops||t.property&&"identity"===t.type||t.expression&&"calculate-expression"===t.type)}function v(t){return M(t,"exponential")}function b(t){return M(t,"interval")}function w(t,n){if(!t)return null;var e=!1;if(Array.isArray(t)){var r,i=[];for(let s=0;s<t.length;s++)(r=w(t[s],n))?(i.push(r),e=!0):i.push(t[s]);return e?i:t}var s,o={__fn_types_loaded:!0},a=[];for(s in t)t.hasOwnProperty(s)&&a.push(s);const u=function(t){Object.defineProperty(o,t,{get:function(){return this["__fn_"+t]||(this["__fn_"+t]=v(this["_"+t])),this["__fn_"+t].apply(this,n())},set:function(n){this["_"+t]=n},configurable:!0,enumerable:!0})};for(let n=0,r=a.length;n<r;n++)g(t[s=a[n]])?(e=!0,o["_"+s]=t[s],u(s)):o[s]=t[s];return e?o:t}function M(t,n){if(!g(t))return function(){return t};let e=!0,r=!0;const i=(t=JSON.parse(JSON.stringify(t))).stops;if(i)for(let t=0;t<i.length;t++)if(g(i[t][1])){const s=M(i[t][1],n);e=e&&s.isZoomConstant,r=r&&s.isFeatureConstant,i[t]=[i[t][0],s]}const s=a(t,n);return s.isZoomConstant=e&&s.isZoomConstant,s.isFeatureConstant=r&&s.isFeatureConstant,s}let x=0;const F="function"==typeof Object.assign;function k(t,...n){if(F)return Object.assign(t,...n),t;for(let e=0;e<n.length;e++){const r=n[e];for(const n in r)t[n]=r[n]}return t}function A(t){return!O(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}function P(t){return"number"==typeof t&&!isNaN(t)}function S(t){return!O(t)&&("function"==typeof t||null!==t.constructor&&t.constructor===Function)}function _(t){return!Array.isArray(t)&&"object"==typeof t&&!!t}function O(t){return null==t}function C(t){return g(t)&&t.property}const E="function"==typeof fetch&&"function"==typeof AbortController,$={jsonp:function(t,n){const e="_maptalks_jsonp_"+x++;t.match(/\\?/)?t+="&callback="+e:t+="?callback="+e;let r=document.createElement("script");return r.type="text/javascript",r.src=t,window[e]=function(t){n(null,t),document.getElementsByTagName("head")[0].removeChild(r),r=null,delete window[e]},document.getElementsByTagName("head")[0].appendChild(r),this},get:function(t,n,e){if(S(n)){const t=e;e=n,n=t}(n=n||{}).method&&(n.method=n.method.toUpperCase());const r="POST"===n.method;if(E){const r=new AbortController,i=n;i.signal=r.signal,i.referrerPolicy=i.referrerPolicy||"origin",i.method=i.method||"GET";const s=new Request(t,i);return n.returnJSON&&s.headers.set("Accept","application/json"),fetch(s).then((r=>{const i=this.o(r,n.returnJSON,n.responseType);i.message?(i.url=t,e(i)):i.then((t=>{"arraybuffer"===n.responseType?e(null,{data:t,cacheControl:r.headers.get("Cache-Control"),expires:r.headers.get("Expires"),contentType:r.headers.get("Content-Type")}):e(null,t)})).catch((n=>{n.code&&n.code===DOMException.ABORT_ERR||(console.error("Fetch error:",t,n),e(n))}))})).catch((n=>{n.code&&n.code===DOMException.ABORT_ERR||(console.error("Fetch error:",t,n),e(n))})),r}{const i=$.u(e);if(i.open(n.method||"GET",t,!0),n){for(const t in n.headers)i.setRequestHeader(t,n.headers[t]);i.withCredentials="include"===n.credentials,n.responseType&&(i.responseType=n.responseType)}return i.send(r?n.body:null),i}},o:(t,n,e)=>200!==t.status?{status:t.status,statusText:t.statusText,message:\`incorrect http request with status code(${YL}t.status}): ${YL}t.statusText}\`}:"arraybuffer"===e?t.arrayBuffer():n?t.json():t.text(),m:function(t,n){return function(){if(4===t.readyState)if(200===t.status)if("arraybuffer"===t.responseType){0===t.response.byteLength?n({status:200,statusText:t.statusText,message:"http status 200 returned without content."}):n(null,{data:t.response,cacheControl:t.getResponseHeader("Cache-Control"),expires:t.getResponseHeader("Expires"),contentType:t.getResponseHeader("Content-Type")})}else n(null,t.responseText);else n({status:t.status,statusText:t.statusText,message:\`incorrect http request with status code(${YL}t.status}): ${YL}t.statusText}\`})}},u:function(t){let n;try{n=new XMLHttpRequest}catch(t){try{n=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{n=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}}return n.onreadystatechange=$.m(n,t),n},getArrayBuffer(t,n,e){if(S(n)){const t=e;e=n,n=t}return n||(n={}),n.responseType="arraybuffer",$.get(t,n,e)}};function I(t,n,e,r,i=3){let s=r;const o=e-n>>1;let a,u=e-n;const l=t[n],h=t[n+1],c=t[e],f=t[e+1];for(let r=n+i;r<e;r+=i){const n=z(t[r],t[r+1],l,h,c,f);if(n>s)a=r,s=n;else if(n===s){const t=Math.abs(r-o);t<u&&(a=r,u=t)}}s>r&&(a-n>i&&I(t,n,a,r,i),t[a+2]=s,e-a>i&&I(t,a,e,r,i))}function z(t,n,e,r,i,s){let o=i-e,a=s-r;if(0!==o||0!==a){const u=((t-e)*o+(n-r)*a)/(o*o+a*a);u>1?(e=i,r=s):u>0&&(e+=o*u,r+=a*u)}return o=t-e,a=n-r,o*o+a*a}function D(t,n,e,r,i,s){const o={id:null==t?null:t,type:n,geometry:e,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};i&&(o.layer=i);return function(t,n){const e=t.geometry,r=t.type;if("Point"===r||"MultiPoint"===r||"LineString"===r)T(t,e,n);else if("Polygon"===r)T(t,e[0],n);else if("MultiLineString"===r)for(const r of e)T(t,r,n);else if("MultiPolygon"===r)for(const r of e)T(t,r[0],n)}(o,s?4:3),o}function T(t,n,e){for(let r=0;r<n.length;r+=e)t.minX=Math.min(t.minX,n[r]),t.minY=Math.min(t.minY,n[r+1]),t.maxX=Math.max(t.maxX,n[r]),t.maxY=Math.max(t.maxY,n[r+1])}function U(t,n,e,r){if(r.layer=n,"FeatureCollection"===e.type)for(let n=0;n<e.features.length;n++)j(t,e.features[n],r,n);else"Feature"===e.type?j(t,e,r):j(t,{geometry:e},r)}function j(t,n,e,r){if(!n.geometry)return;const i=n.geometry.coordinates,s=n.geometry.type,o=Math.pow(e.tolerance/((1<<e.maxZoom)*e.extent),2);let a=[],u=n.id;if(e.promoteId?u=n.properties[e.promoteId]:e.generateId&&(u=r||0),"Point"===s)N(i,a,e);else if("MultiPoint"===s)for(const t of i)N(t,a,e);else if("LineString"===s)L(i,a,o,!1,e);else if("MultiLineString"===s){if(e.lineMetrics){for(const r of i)a=[],L(r,a,o,!1,e),t.push(D(u,"LineString",a,n.properties,e.layer,e.hasAltitude));return}H(i,a,o,!1,e)}else if("Polygon"===s)H(i,a,o,!0,e);else{if("MultiPolygon"!==s){if("GeometryCollection"===s){for(const i of n.geometry.geometries)j(t,{id:u,geometry:i,properties:n.properties},e,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const t of i){const n=[];H(t,n,o,!0,e),a.push(n)}}t.push(D(u,s,a,n.properties,e.layer,e.hasAltitude))}function N(t,n,e){n.push(R(t[0]),V(t[1],e.projection),0),e.hasAltitude&&(t.length>2?n.push(t[2]):n.push(0))}function L(t,n,e,r,i){let s,o,a=0;for(let e=0;e<t.length;e++){const u=R(t[e][0]),l=V(t[e][1],i.projection);n.push(u,l,0),i.hasAltitude&&(t[e].length>2?n.push(t[e][2]):n.push(0)),e>0&&(a+=r?(s*l-u*o)/2:Math.sqrt(Math.pow(u-s,2)+Math.pow(l-o,2))),s=u,o=l}const u=i.hasAltitude?4:3,l=n.length-u;n[2]=1,I(n,0,l,e,u),n[l+2]=1,n.size=Math.abs(a),n.start=0,n.end=n.size}function H(t,n,e,r,i){for(let s=0;s<t.length;s++){const o=[];L(t[s],o,e,r,i),n.push(o)}}function R(t){return t/360+.5}function V(t,n){if("EPSG:4326"===n)return(90-t)/360;const e=Math.sin(t*Math.PI/180),r=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return r<0?0:r>1?1:r}function q(t,n,e,r,i,s,o,a){if(r/=n,s>=(e/=n)&&o<r)return t;if(o<e||s>=r)return null;const u=[];for(const n of t){const t=n.geometry;let s=n.type;const o=0===i?n.minX:n.minY,l=0===i?n.maxX:n.maxY;if(o>=e&&l<r){u.push(n);continue}if(l<e||o>=r)continue;let h=[];if("Point"===s||"MultiPoint"===s)G(t,h,e,r,i,a.hasAltitude);else if("LineString"===s)J(t,h,e,r,i,!1,a.lineMetrics,a.hasAltitude);else if("MultiLineString"===s)B(t,h,e,r,i,!1,a.hasAltitude);else if("Polygon"===s)B(t,h,e,r,i,!0,a.hasAltitude);else if("MultiPolygon"===s)for(const n of t){const t=[];B(n,t,e,r,i,!0,a.hasAltitude),t.length&&h.push(t)}if(h.length){if(a.lineMetrics&&"LineString"===s){for(const t of h)u.push(D(n.id,s,t,n.tags,n.layer,a.hasAltitude));continue}"LineString"!==s&&"MultiLineString"!==s||(1===h.length?(s="LineString",h=h[0]):s="MultiLineString"),"Point"!==s&&"MultiPoint"!==s||(s=3===h.length?"Point":"MultiPoint"),u.push(D(n.id,s,h,n.tags,n.layer,a.hasAltitude))}}return u.length?u:null}function G(t,n,e,r,i,s){const o=s?4:3;for(let a=0;a<t.length;a+=o){const o=t[a+i];o>=e&&o<=r&&(X(n,t[a],t[a+1],t[a+2]),s&&n.push(t[a+3]))}}function J(t,n,e,r,i,s,o,a){let u=W(t);const l=0===i?Y:K;let h,c,f=t.start;const d=a?4:3,p=s?t.length:t.length-d;for(let y=0;y<p;y+=d){const m=t[y],g=t[y+1],v=t[y+2];let b,w,M,x;s&&y===p-d?(b=t[0],w=t[1]):(b=t[y+d],w=t[y+d+1]),a&&(M=t[y+3],x=s&&y===p-d?t[3]:t[y+d+3]);const F=0===i?m:g,k=0===i?b:w;let A=!1;o&&(h=Math.sqrt(Math.pow(m-b,2)+Math.pow(g-w,2))),F<e?k>e&&(c=l(u,m,g,b,w,e),a&&u.push(Z(M,x,c)),o&&(u.start=f+h*c)):F>r?k<r&&(c=l(u,m,g,b,w,r),a&&u.push(Z(M,x,c)),o&&(u.start=f+h*c)):(X(u,m,g,v),a&&u.push(M)),k<e&&F>=e&&(c=l(u,m,g,b,w,e),a&&u.push(Z(M,x,c)),A=!0),k>r&&F<=r&&(c=l(u,m,g,b,w,r),a&&u.push(Z(M,x,c)),A=!0),!s&&A&&(o&&(u.end=f+h*c),n.push(u),u=W(t)),o&&(f+=h)}let y=t.length-d;if(!s){const n=t[y],s=t[y+1],o=t[y+2],l=0===i?n:s;if(l>=e&&l<=r&&X(u,n,s,o),l>=e&&l<=r&&a){const n=t[y+3];u.push(n)}}y=u.length-d,s&&y>=d&&(u[y]!==u[0]||u[y+1]!==u[1])&&(X(u,u[0],u[1],u[2]),a&&u.push(u[3])),u.length&&n.push(u)}function W(t){const n=[];return n.size=t.size,n.start=t.start,n.end=t.end,n}function B(t,n,e,r,i,s,o){for(const a of t)J(a,n,e,r,i,s,!1,o)}function X(t,n,e,r){t.push(n,e,r)}function Y(t,n,e,r,i,s){const o=(s-n)/(r-n);return X(t,s,e+(i-e)*o,1),o}function K(t,n,e,r,i,s){const o=(s-e)/(i-e);return X(t,n+(r-n)*o,s,1),o}function Z(t,n,e){return t+(n-t)*e}function Q(t,n,e){const r=[];for(let i=0;i<t.length;i++){const s=t[i],o=s.type;let a;if("Point"===o||"MultiPoint"===o||"LineString"===o)a=tt(s.geometry,n,e);else if("MultiLineString"===o||"Polygon"===o){a=[];for(const t of s.geometry)a.push(tt(t,n,e))}else if("MultiPolygon"===o){a=[];for(const t of s.geometry){const r=[];for(const i of t)r.push(tt(i,n,e));a.push(r)}}r.push(D(s.id,o,a,s.tags,s.layer,e))}return r}function tt(t,n,e){const r=[];r.size=t.size,void 0!==t.start&&(r.start=t.start,r.end=t.end);const i=e?4:3;for(let s=0;s<t.length;s+=i)r.push(t[s]+n,t[s+1],t[s+2]),e&&r.push(t[s+3]);return r}function nt(t,n,e){if(t.transformed)return t;const r=1<<t.z,i=t.x,s=t.y,o=e?3:2;for(const a of t.features){const t=a.geometry,u=a.type;if(a.geometry=[],1===u)for(let u=0;u<t.length;u+=o)a.geometry.push(et(t[u],t[u+1],n,r,i,s)),e&&a.geometry[a.geometry.length-1].push(t[u+2]);else for(let u=0;u<t.length;u++){const l=[];for(let a=0;a<t[u].length;a+=o)l.push(et(t[u][a],t[u][a+1],n,r,i,s)),e&&l[l.length-1].push(t[u][a+2]);a.geometry.push(l)}}return t.transformed=!0,t}function et(t,n,e,r,i,s){return[Math.round(e*(t*r-i)),Math.round(e*(n*r-s))]}function rt(t,n,e,r,i){const s=n===i.maxZoom?0:i.tolerance/((1<<n)*i.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:t.length,source:null,x:e,y:r,z:n,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const n of t)it(o,n,s,i);return o}function it(t,n,e,r){const i=n.geometry,s=n.type,o=[],a=r.hasAltitude?4:3;if(t.minX=Math.min(t.minX,n.minX),t.minY=Math.min(t.minY,n.minY),t.maxX=Math.max(t.maxX,n.maxX),t.maxY=Math.max(t.maxY,n.maxY),"Point"===s||"MultiPoint"===s)for(let n=0;n<i.length;n+=a)o.push(i[n],i[n+1]),r.hasAltitude&&o.push(i[n+3]),t.numPoints++,t.numSimplified++;else if("LineString"===s)ot(o,i,t,e,!1,!1,r);else if("MultiLineString"===s||"Polygon"===s)for(let n=0;n<i.length;n++)ot(o,i[n],t,e,"Polygon"===s,0===n,r);else if("MultiPolygon"===s)for(let n=0;n<i.length;n++){const s=i[n];for(let n=0;n<s.length;n++)ot(o,s[n],t,e,!0,0===n,r)}if(o.length){let e=n.tags||null;if("LineString"===s&&r.lineMetrics){e={};for(const t in n.tags)e[t]=n.tags[t];e.mapbox_clip_start=i.start/i.size,e.mapbox_clip_end=i.end/i.size}const a={geometry:o,type:"Polygon"===s||"MultiPolygon"===s?3:"LineString"===s||"MultiLineString"===s?2:1,tags:e};n.layer&&(a.layer=n.layer),null!==n.id&&(a.id=n.id),t.features.push(a)}}function st(t,n,e){return 0===t[n+2]&&t[n+3]>0&&e}function ot(t,n,e,r,i,s,o){const a=r*r,{hasAltitude:u,disableFilter:l}=o,h=u?4:3;if(!l&&r>0&&n.size<(i?a:r))return void(e.numPoints+=n.length/h);const c=[];for(let t=0;t<n.length;t+=h)(0===r||n[t+2]>a||st(n,t,u))&&(e.numSimplified++,c.push(n[t],n[t+1]),u&&c.push(n[t+3])),e.numPoints++;i&&function(t,n,e){const r=e?3:2;let i=0;for(let n=0,e=t.length,s=e-r;n<e;s=n,n+=r)i+=(t[n]-t[s])*(t[n+1]+t[s+1]);if(i>0===n){const n=r,i=r-1,s=r-2;for(let o=0,a=t.length;o<a/2;o+=r){const r=t[o],u=t[o+1];let l;e&&(l=t[o+2]),t[o]=t[a-n-o],t[o+1]=t[a-i-o],e&&(t[o+2]=t[a-s-o]),t[a-n-o]=r,t[a-i-o]=u,e&&(t[a-s-o]=l)}}}(c,s,u),t.push(c)}$.getJSON=function(t,n,e){if(S(n)){const t=e;e=n,n=t}const r=function(t,n){const r="string"==typeof n?JSON.parse(n):n||null;e(t,r)};return n&&n.jsonp?$.jsonp(t,r):((n=n||{}).returnJSON=!0,$.get(t,n,r))};const at={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,hasAltitude:!1,disableFilter:!1,debug:0};class ut{constructor(t,n){const e=(n=this.options=function(t,n){for(const e in n)t[e]=n[e];return t}(Object.create(at),n)).debug;if(e&&console.time("preprocess data"),n.maxZoom<0||n.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(n.promoteId&&n.generateId)throw new Error("promoteId and generateId cannot be used together.");let r=function(t,n){const e=[];if(Array.isArray(t)){for(let r=0;r<t.length;r++)U(e,t[r].layer,t[r].data,n);return e}if("FeatureCollection"===t.type)for(let r=0;r<t.features.length;r++)j(e,t.features[r],n,r);else"Feature"===t.type?j(e,t,n):j(e,{geometry:t},n);return e}(t,n);this.tiles={},this.tileCoords=[],e&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",n.indexMaxZoom,n.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),r=function(t,n){const e=n.buffer/n.extent;let r=t;const i=q(t,1,-1-e,e,0,-1,2,n),s=q(t,1,1-e,2+e,0,-1,2,n);return(i||s)&&(r=q(t,1,-e,1+e,0,-1,2,n)||[],i&&(r=Q(i,1,n.hasAltitude).concat(r)),s&&(r=r.concat(Q(s,-1,n.hasAltitude)))),r}(r,n),r.length&&this.splitTile(r,0,0,0),e&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(t,n,e,r,i,s,o){const a=[t,n,e,r],u=this.options,l=u.debug;for(;a.length;){r=a.pop(),e=a.pop(),n=a.pop(),t=a.pop();const h=1<<n,c=lt(n,e,r);let f=this.tiles[c];if(!f&&(l>1&&console.time("creation"),f=this.tiles[c]=rt(t,n,e,r,u),this.tileCoords.push({z:n,x:e,y:r}),l)){l>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",n,e,r,f.numFeatures,f.numPoints,f.numSimplified),console.timeEnd("creation"));const t=\`z${YL}n}\`;this.stats[t]=(this.stats[t]||0)+1,this.total++}if(f.source=t,null==i){if(n===u.indexMaxZoom||f.numPoints<=u.indexMaxPoints)continue}else{if(n===u.maxZoom||n===i)continue;if(null!=i){const t=i-n;if(e!==s>>t||r!==o>>t)continue}}if(f.source=null,0===t.length)continue;l>1&&console.time("clipping");const d=.5*u.buffer/u.extent,p=.5-d,y=.5+d,m=1+d;let g=null,v=null,b=null,w=null,M=q(t,h,e-d,e+y,0,f.minX,f.maxX,u),x=q(t,h,e+p,e+m,0,f.minX,f.maxX,u);t=null,M&&(g=q(M,h,r-d,r+y,1,f.minY,f.maxY,u),v=q(M,h,r+p,r+m,1,f.minY,f.maxY,u),M=null),x&&(b=q(x,h,r-d,r+y,1,f.minY,f.maxY,u),w=q(x,h,r+p,r+m,1,f.minY,f.maxY,u),x=null),l>1&&console.timeEnd("clipping"),a.push(g||[],n+1,2*e,2*r),a.push(v||[],n+1,2*e,2*r+1),a.push(b||[],n+1,2*e+1,2*r),a.push(w||[],n+1,2*e+1,2*r+1)}}getTile(t,n,e){t=+t,n=+n,e=+e;const r=this.options,{extent:i,debug:s}=r,{hasAltitude:o,wrapX:a}=r;if(t<0||t>24)return null;if(a){const e=1<<t;n=n+e&e-1}const u=lt(t,n,e);if(this.tiles[u])return nt(this.tiles[u],i,o);s>1&&console.log("drilling down to z%d-%d-%d",t,n,e);let l,h=t,c=n,f=e;for(;!l&&h>0;)h--,c>>=1,f>>=1,l=this.tiles[lt(h,c,f)];return l&&l.source?(s>1&&(console.log("found parent tile z%d-%d-%d",h,c,f),console.time("drilling down")),this.splitTile(l.source,h,c,f,t,n,e),s>1&&console.timeEnd("drilling down"),this.tiles[u]?nt(this.tiles[u],i,o):null):null}}function lt(t,n,e){return 32*((1<<t)*e+n)+t}function ht(t,n,e,r,i,s,o){const a=e&&Array.isArray(e[0]);for(let u=0,l=e.length;u<l;u++){t[n]=(a?e[u][0]:e[u].x)*r,t[n+1]=(a?e[u][1]:e[u].y)*r,o!==Float32Array&&(t[n]=Math.round(t[n]),t[n+1]=Math.round(t[n+1]));let h=i||0;Array.isArray(i)&&(h=i[u]),h=h?Math.round(r*h):0,t[n+2]=h,n+=3,s&&0!==u&&u!==l-1&&(t[n]=t[n-3],t[n+1]=t[n-2],t[n+2]=t[n-1],n+=3)}return t.trySetLength&&t.trySetLength(n),n}function ct(t,n,e,r){const i=t[3*n],s=t[3*n+1],o=t[3*e],a=t[3*e+1];return i===o&&(i<0||i>r)||s===a&&(s<0||s>r)}var ft="undefined"!=typeof Float32Array?Float32Array:Array;function dt(t,n,e,r){return t[0]=n,t[1]=e,t[2]=r,t}function pt(t,n){var e=n[0],r=n[1],i=n[2],s=e*e+r*r+i*i;return s>0&&(s=1/Math.sqrt(s)),t[0]=n[0]*s,t[1]=n[1]*s,t[2]=n[2]*s,t}function yt(t,n,e){var r=n[0],i=n[1],s=n[2],o=e[0],a=e[1],u=e[2];return t[0]=i*u-s*a,t[1]=s*o-r*u,t[2]=r*a-i*o,t}function mt(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t}function gt(t,n,e,r,i){return t[0]=n,t[1]=e,t[2]=r,t[3]=i,t}function vt(t,n,e){return t[0]=n[0]/e[0],t[1]=n[1]/e[1],t[2]=n[2]/e[2],t[3]=n[3]/e[3],t}function bt(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t[3]=n[3]*e,t}function wt(t,n,e){return t[0]=n,t[1]=e,t}function Mt(t,n){var e=n[0]-t[0],r=n[1]-t[1];return Math.hypot(e,r)}Math.hypot||(Math.hypot=function(){for(var t=0,n=arguments.length;n--;)t+=arguments[n]*arguments[n];return Math.sqrt(t)}),function(){var t,n=(t=new ft(3),ft!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t)}(),function(){var t,n=(t=new ft(4),ft!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();var xt=function(t){var n=t[0],e=t[1];return Math.hypot(n,e)};!function(){var t,n=(t=new ft(2),ft!=Float32Array&&(t[0]=0,t[1]=0),t)}();const Ft=Math.PI/180,kt=6378137*Math.PI/180,At=85.0511287798;function Pt(t,n,e){if("EPSG:3857"===e)return function(t,n){const e=At,r=n[0],i=Math.max(Math.min(e,n[1]),-e);let s;s=0===i?0:Math.log(Math.tan((90+i)*Ft/2))/Ft;return t[0]=r*kt,t[1]=s*kt,t}(t,n);if("EPSG:4326"===e||"EPSG:4490"===e||"identity"===e)return St(t,n);if("baidu"===e)return St(t,n);throw new Error("unsupported projection:"+e)}function St(t,n){return t[0]=n[0],t[1]=n[1],t}function _t(t,n,e,r,i,s,o,a,u,l,h,c,f,d,p){0===t?function(t,n,e,r,i,s,o,a,u,l){const h=1/(100*s[0]),c=1/(100*s[1]),f=l&&l[0]||0,d=l&&l[1]||0,p=[0,0];for(let i=t;i<n;i+=3){const t=i/3*2,n=r[i]-f,s=r[i+1]-d;e[t]=p[0]+n/o*h/a,e[t+1]=p[1]-s/o*c/u}}(n,e,r,i,0,o,a,u,l,p):1===t&&function(t,n,e,r,i,s,o,a,u,l,h){if(!t)return;let c,f,d,p;0===t[4]?(c=t[0],f=t[1],d=t[2],p=t[3]):(c=t[1],f=t[2],d=t[3],p=t[0]);const y=Mt(c,f),m=Mt(f,d),g=[],v=[],b=[];for(let t=n;t<e;t+=3){const n=t/3*2;wt(g,(s.x/u+i[t]/o)*a,s.y/u*a+(h?i[t+1]:-i[t+1])/o*a),"EPSG:4326"!==l&&"EPSG:4490"!==l||Pt(g,g,"EPSG:3857"),Ot(v,g,c,f),Ot(b,g,p,c),r[n]=Mt(c,v)/y,r[n+1]=Mt(c,b)/m}}(h,n,e,r,i,s,a,c,f,d,!!p)}function Ot(t,n,e,r){const i=e[0]-r[0],s=e[1]-r[1];let o=(n[0]-e[0])*(e[0]-r[0])+(n[1]-e[1])*(e[1]-r[1]);return o/=i*i+s*s,t[0]=e[0]+o*i,t[1]=e[1]+o*s,t}function Ct(t,n,e,r,i){const s=3*n[e-1],o=3*n[e-1]+1,a=t[s],u=t[o];return l=r,h=i,c=a,f=u,Math.sqrt((c-l)*(c-l)+(f-h)*(f-h));var l,h,c,f}"undefined"!=typeof undefinedThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof undefined?global:"undefined"!=typeof self&&self;function Et(t){return t&&t.M&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var $t={exports:{}};function It(t,n,e){e=e||2;var r,i,s,o,a,u,l,h=n&&n.length,c=h?n[0]*e:t.length,f=zt(t,0,c,e,!0),d=[];if(!f||f.next===f.prev)return d;if(h&&(f=function(t,n,e,r){var i,s,o,a=[];for(i=0,s=n.length;i<s;i++)(o=zt(t,n[i]*r,i<s-1?n[i+1]*r:t.length,r,!1))===o.next&&(o.steiner=!0),a.push(Gt(o));for(a.sort(Ht),i=0;i<a.length;i++)e=Rt(a[i],e);return e}(t,n,f,e)),t.length>80*e){r=s=t[0],i=o=t[1];for(var p=e;p<c;p+=e)(a=t[p])<r&&(r=a),(u=t[p+1])<i&&(i=u),a>s&&(s=a),u>o&&(o=u);l=0!==(l=Math.max(s-r,o-i))?32767/l:0}return Tt(f,d,e,r,i,l,0),d}function zt(t,n,e,r,i){var s,o;if(i===sn(t,n,e,r)>0)for(s=n;s<e;s+=r)o=nn(s,t[s],t[s+1],o);else for(s=e-r;s>=n;s-=r)o=nn(s,t[s],t[s+1],o);return o&&Xt(o,o.next)&&(en(o),o=o.next),o}function Dt(t,n){if(!t)return t;n||(n=t);var e,r=t;do{if(e=!1,r.steiner||!Xt(r,r.next)&&0!==Bt(r.prev,r,r.next))r=r.next;else{if(en(r),(r=n=r.prev)===r.next)break;e=!0}}while(e||r!==n);return n}function Tt(t,n,e,r,i,s,o){if(t){!o&&s&&function(t,n,e,r){var i=t;do{0===i.z&&(i.z=qt(i.x,i.y,n,e,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var n,e,r,i,s,o,a,u,l=1;do{for(e=t,t=null,s=null,o=0;e;){for(o++,r=e,a=0,n=0;n<l&&(a++,r=r.nextZ);n++);for(u=l;a>0||u>0&&r;)0!==a&&(0===u||!r||e.z<=r.z)?(i=e,e=e.nextZ,a--):(i=r,r=r.nextZ,u--),s?s.nextZ=i:t=i,i.prevZ=s,s=i;e=r}s.nextZ=null,l*=2}while(o>1)}(i)}(t,r,i,s);for(var a,u,l=t;t.prev!==t.next;)if(a=t.prev,u=t.next,s?jt(t,r,i,s):Ut(t))n.push(a.i/e|0),n.push(t.i/e|0),n.push(u.i/e|0),en(t),t=u.next,l=u.next;else if((t=u)===l){o?1===o?Tt(t=Nt(Dt(t),n,e),n,e,r,i,s,2):2===o&&Lt(t,n,e,r,i,s):Tt(Dt(t),n,e,r,i,s,1);break}}}function Ut(t){var n=t.prev,e=t,r=t.next;if(Bt(n,e,r)>=0)return!1;for(var i=n.x,s=e.x,o=r.x,a=n.y,u=e.y,l=r.y,h=i<s?i<o?i:o:s<o?s:o,c=a<u?a<l?a:l:u<l?u:l,f=i>s?i>o?i:o:s>o?s:o,d=a>u?a>l?a:l:u>l?u:l,p=r.next;p!==n;){if(p.x>=h&&p.x<=f&&p.y>=c&&p.y<=d&&Jt(i,a,s,u,o,l,p.x,p.y)&&Bt(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function jt(t,n,e,r){var i=t.prev,s=t,o=t.next;if(Bt(i,s,o)>=0)return!1;for(var a=i.x,u=s.x,l=o.x,h=i.y,c=s.y,f=o.y,d=a<u?a<l?a:l:u<l?u:l,p=h<c?h<f?h:f:c<f?c:f,y=a>u?a>l?a:l:u>l?u:l,m=h>c?h>f?h:f:c>f?c:f,g=qt(d,p,n,e,r),v=qt(y,m,n,e,r),b=t.prevZ,w=t.nextZ;b&&b.z>=g&&w&&w.z<=v;){if(b.x>=d&&b.x<=y&&b.y>=p&&b.y<=m&&b!==i&&b!==o&&Jt(a,h,u,c,l,f,b.x,b.y)&&Bt(b.prev,b,b.next)>=0)return!1;if(b=b.prevZ,w.x>=d&&w.x<=y&&w.y>=p&&w.y<=m&&w!==i&&w!==o&&Jt(a,h,u,c,l,f,w.x,w.y)&&Bt(w.prev,w,w.next)>=0)return!1;w=w.nextZ}for(;b&&b.z>=g;){if(b.x>=d&&b.x<=y&&b.y>=p&&b.y<=m&&b!==i&&b!==o&&Jt(a,h,u,c,l,f,b.x,b.y)&&Bt(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;w&&w.z<=v;){if(w.x>=d&&w.x<=y&&w.y>=p&&w.y<=m&&w!==i&&w!==o&&Jt(a,h,u,c,l,f,w.x,w.y)&&Bt(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function Nt(t,n,e){var r=t;do{var i=r.prev,s=r.next.next;!Xt(i,s)&&Yt(i,r,r.next,s)&&Qt(i,s)&&Qt(s,i)&&(n.push(i.i/e|0),n.push(r.i/e|0),n.push(s.i/e|0),en(r),en(r.next),r=t=s),r=r.next}while(r!==t);return Dt(r)}function Lt(t,n,e,r,i,s){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&Wt(o,a)){var u=tn(o,a);return o=Dt(o,o.next),u=Dt(u,u.next),Tt(o,n,e,r,i,s,0),void Tt(u,n,e,r,i,s,0)}a=a.next}o=o.next}while(o!==t)}function Ht(t,n){return t.x-n.x}function Rt(t,n){var e=function(t,n){var e,r=n,i=t.x,s=t.y,o=-1/0;do{if(s<=r.y&&s>=r.next.y&&r.next.y!==r.y){var a=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=i&&a>o&&(o=a,e=r.x<r.next.x?r:r.next,a===i))return e}r=r.next}while(r!==n);if(!e)return null;var u,l=e,h=e.x,c=e.y,f=1/0;r=e;do{i>=r.x&&r.x>=h&&i!==r.x&&Jt(s<c?i:o,s,h,c,s<c?o:i,s,r.x,r.y)&&(u=Math.abs(s-r.y)/(i-r.x),Qt(r,t)&&(u<f||u===f&&(r.x>e.x||r.x===e.x&&Vt(e,r)))&&(e=r,f=u)),r=r.next}while(r!==l);return e}(t,n);if(!e)return n;var r=tn(e,t);return Dt(r,r.next),Dt(e,e.next)}function Vt(t,n){return Bt(t.prev,t,n.prev)<0&&Bt(n.next,t,t.next)<0}function qt(t,n,e,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-e)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*i|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function Gt(t){var n=t,e=t;do{(n.x<e.x||n.x===e.x&&n.y<e.y)&&(e=n),n=n.next}while(n!==t);return e}function Jt(t,n,e,r,i,s,o,a){return(i-o)*(n-a)>=(t-o)*(s-a)&&(t-o)*(r-a)>=(e-o)*(n-a)&&(e-o)*(s-a)>=(i-o)*(r-a)}function Wt(t,n){return t.next.i!==n.i&&t.prev.i!==n.i&&!function(t,n){var e=t;do{if(e.i!==t.i&&e.next.i!==t.i&&e.i!==n.i&&e.next.i!==n.i&&Yt(e,e.next,t,n))return!0;e=e.next}while(e!==t);return!1}(t,n)&&(Qt(t,n)&&Qt(n,t)&&function(t,n){var e=t,r=!1,i=(t.x+n.x)/2,s=(t.y+n.y)/2;do{e.y>s!=e.next.y>s&&e.next.y!==e.y&&i<(e.next.x-e.x)*(s-e.y)/(e.next.y-e.y)+e.x&&(r=!r),e=e.next}while(e!==t);return r}(t,n)&&(Bt(t.prev,t,n.prev)||Bt(t,n.prev,n))||Xt(t,n)&&Bt(t.prev,t,t.next)>0&&Bt(n.prev,n,n.next)>0)}function Bt(t,n,e){return(n.y-t.y)*(e.x-n.x)-(n.x-t.x)*(e.y-n.y)}function Xt(t,n){return t.x===n.x&&t.y===n.y}function Yt(t,n,e,r){var i=Zt(Bt(t,n,e)),s=Zt(Bt(t,n,r)),o=Zt(Bt(e,r,t)),a=Zt(Bt(e,r,n));return i!==s&&o!==a||(!(0!==i||!Kt(t,e,n))||(!(0!==s||!Kt(t,r,n))||(!(0!==o||!Kt(e,t,r))||!(0!==a||!Kt(e,n,r)))))}function Kt(t,n,e){return n.x<=Math.max(t.x,e.x)&&n.x>=Math.min(t.x,e.x)&&n.y<=Math.max(t.y,e.y)&&n.y>=Math.min(t.y,e.y)}function Zt(t){return t>0?1:t<0?-1:0}function Qt(t,n){return Bt(t.prev,t,t.next)<0?Bt(t,n,t.next)>=0&&Bt(t,t.prev,n)>=0:Bt(t,n,t.prev)<0||Bt(t,t.next,n)<0}function tn(t,n){var e=new rn(t.i,t.x,t.y),r=new rn(n.i,n.x,n.y),i=t.next,s=n.prev;return t.next=n,n.prev=t,e.next=i,i.prev=e,r.next=e,e.prev=r,s.next=r,r.prev=s,r}function nn(t,n,e,r){var i=new rn(t,n,e);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function en(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function rn(t,n,e){this.i=t,this.x=n,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function sn(t,n,e,r){for(var i=0,s=n,o=e-r;s<e;s+=r)i+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return i}$t.exports=It,$t.exports.default=It,It.deviation=function(t,n,e,r){var i=n&&n.length,s=i?n[0]*e:t.length,o=Math.abs(sn(t,0,s,e));if(i)for(var a=0,u=n.length;a<u;a++){var l=n[a]*e,h=a<u-1?n[a+1]*e:t.length;o-=Math.abs(sn(t,l,h,e))}var c=0;for(a=0;a<r.length;a+=3){var f=r[a]*e,d=r[a+1]*e,p=r[a+2]*e;c+=Math.abs((t[f]-t[p])*(t[d+1]-t[f+1])-(t[f]-t[d])*(t[p+1]-t[f+1]))}return 0===o&&0===c?0:Math.abs((c-o)/o)},It.flatten=function(t){for(var n=t[0][0].length,e={vertices:[],holes:[],dimensions:n},r=0,i=0;i<t.length;i++){for(var s=0;s<t[i].length;s++)for(var o=0;o<n;o++)e.vertices.push(t[i][s][o]);i>0&&(r+=t[i-1].length,e.holes.push(r))}return e};var on=Et($t.exports),an=un;function un(t,n){this.x=t,this.y=n}un.prototype={clone:function(){return new un(this.x,this.y)},add:function(t){return this.clone().F(t)},sub:function(t){return this.clone().k(t)},multByPoint:function(t){return this.clone().A(t)},divByPoint:function(t){return this.clone().P(t)},mult:function(t){return this.clone().S(t)},div:function(t){return this.clone().O(t)},rotate:function(t){return this.clone().C(t)},rotateAround:function(t,n){return this.clone().I(t,n)},matMult:function(t){return this.clone().D(t)},unit:function(){return this.clone().T()},perp:function(){return this.clone().U()},round:function(){return this.clone().j()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var n=t.x-this.x,e=t.y-this.y;return n*n+e*e},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,n){return Math.atan2(this.x*n-this.y*t,this.x*t+this.y*n)},D:function(t){var n=t[0]*this.x+t[1]*this.y,e=t[2]*this.x+t[3]*this.y;return this.x=n,this.y=e,this},F:function(t){return this.x+=t.x,this.y+=t.y,this},k:function(t){return this.x-=t.x,this.y-=t.y,this},S:function(t){return this.x*=t,this.y*=t,this},O:function(t){return this.x/=t,this.y/=t,this},A:function(t){return this.x*=t.x,this.y*=t.y,this},P:function(t){return this.x/=t.x,this.y/=t.y,this},T:function(){return this.O(this.mag()),this},U:function(){var t=this.y;return this.y=this.x,this.x=-t,this},C:function(t){var n=Math.cos(t),e=Math.sin(t),r=n*this.x-e*this.y,i=e*this.x+n*this.y;return this.x=r,this.y=i,this},I:function(t,n){var e=Math.cos(t),r=Math.sin(t),i=n.x+e*(this.x-n.x)-r*(this.y-n.y),s=n.y+r*(this.x-n.x)+e*(this.y-n.y);return this.x=i,this.y=s,this},j:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},un.convert=function(t){return t instanceof un?t:Array.isArray(t)?new un(t[0],t[1]):t};var ln=Et(an);const hn={Point:1,LineString:2,Polygon:3,MultiPoint:4,MultiLineString:5,MultiPolygon:6};function cn(t,n={}){var e=[];if("FeatureCollection"===t.type)for(var r=0;r<t.features.length;r++)fn(e,t.features[r],n,r);else"Feature"===t.type?fn(e,t,n):fn(e,{geometry:t},n);return e}function fn(t,n,e,r){if(n.geometry&&n.geometry.geometry){var i=n.geometry.coordinates,s=n.geometry.type,o=[],a=n.id;if(e.promoteId?a=n.properties[e.promoteId]:e.generateId&&(a=r||0),"Point"===s)dn(i,o);else if("MultiPoint"===s)for(var u=0;u<i.length;u++)dn(i[u],o);else if("LineString"===s)yn([i],o);else if("MultiLineString"===s){if(e.lineMetrics){for(u=0;u<i.length;u++)o=[],pn(i[u],o),t.push(mn(a,"LineString",o,n.properties));return}yn(i,o)}else if("Polygon"===s)yn(i,o);else{if("MultiPolygon"!==s){if("GeometryCollection"===s){for(u=0;u<n.geometry.geometries.length;u++)fn(t,{id:a,geometry:n.geometry.geometries[u],properties:n.properties},e,r);return}return void console.warn(\`Input data type(${YL}s}) is not a valid GeoJSON geometry type.\`)}for(u=0;u<i.length;u++){var l=[];yn(i[u],l),o.push(l)}}t.push(mn(a,s,o,n.properties))}}function dn(t,n){const e=new ln(t[0],t[1]);e.z=100*(t[2]||0),n.push([e])}function pn(t,n){for(let e=0;e<t.length;e++){const r=t[e][0],i=t[e][1],s=new ln(r,i);s.z=100*(t[e][2]||0),n.push(s)}}function yn(t,n,e,r){for(var i=0;i<t.length;i++){var s=[];pn(t[i],s),n.push(s)}}function mn(t,n,e,r){return{id:void 0===t?null:t,type:hn[n],geometry:e,properties:r}}function gn(t,n,e){e=e||{},this.w=t||64,this.h=n||64,this.autoResize=!!e.autoResize,this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0}function vn(t,n,e){this.x=0,this.y=t,this.w=this.free=n,this.h=e}function bn(t,n,e,r,i,s,o){this.id=t,this.x=n,this.y=e,this.w=r,this.h=i,this.maxw=s||r,this.maxh=o||i,this.refcount=0}\n/*!\n     * Codes from mapbox-gl-js\n     * github.com/mapbox/mapbox-gl-js\n     * MIT License\n     */function wn(t,{width:n,height:e},r,i){if(i){if(i.length!==n*e*r)throw new RangeError("mismatched image size")}else i=new Uint8Array(n*e*r);return t.width=n,t.height=e,t.data=i,t}function Mn(t,{width:n,height:e},r){if(n===t.width&&e===t.height)return;const i=wn({},{width:n,height:e},r);xn(t,i,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,n),height:Math.min(t.height,e)},r),t.width=n,t.height=e,t.data=i.data}function xn(t,n,e,r,i,s){if(0===i.width||0===i.height)return n;if(i.width>t.width||i.height>t.height||e.x>t.width-i.width||e.y>t.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>n.width||i.height>n.height||r.x>n.width-i.width||r.y>n.height-i.height)throw new RangeError("out of range destination coordinates for image copy");const o=t.data,a=n.data;if(o===a)return n;for(let u=0;u<i.height;u++){const l=((e.y+u)*t.width+e.x)*s,h=((r.y+u)*n.width+r.x)*s;for(let t=0;t<i.width*s;t++)a[h+t]=o[l+t]}return n}gn.prototype.pack=function(t,n){t=[].concat(t),n=n||{};for(var e,r,i,s,o=[],a=0;a<t.length;a++)if(e=t[a].w||t[a].width,r=t[a].h||t[a].height,i=t[a].id,e&&r){if(!(s=this.packOne(e,r,i)))continue;n.inPlace&&(t[a].x=s.x,t[a].y=s.y,t[a].id=s.id),o.push(s)}return this.shrink(),o},gn.prototype.packOne=function(t,n,e){var r,i,s,o,a,u,l,h,c={freebin:-1,shelf:-1,waste:1/0},f=0;if("string"==typeof e||"number"==typeof e){if(r=this.getBin(e))return this.ref(r),r;"number"==typeof e&&(this.maxId=Math.max(e,this.maxId))}else e=++this.maxId;for(o=0;o<this.freebins.length;o++){if(n===(r=this.freebins[o]).maxh&&t===r.maxw)return this.allocFreebin(o,t,n,e);n>r.maxh||t>r.maxw||n<=r.maxh&&t<=r.maxw&&(s=r.maxw*r.maxh-t*n)<c.waste&&(c.waste=s,c.freebin=o)}for(o=0;o<this.shelves.length;o++)if(f+=(i=this.shelves[o]).h,!(t>i.free)){if(n===i.h)return this.allocShelf(o,t,n,e);n>i.h||n<i.h&&(s=(i.h-n)*t)<c.waste&&(c.freebin=-1,c.waste=s,c.shelf=o)}return-1!==c.freebin?this.allocFreebin(c.freebin,t,n,e):-1!==c.shelf?this.allocShelf(c.shelf,t,n,e):n<=this.h-f&&t<=this.w?(i=new vn(f,this.w,n),this.allocShelf(this.shelves.push(i)-1,t,n,e)):this.autoResize?(a=u=this.h,((l=h=this.w)<=a||t>l)&&(h=2*Math.max(t,l)),(a<l||n>a)&&(u=2*Math.max(n,a)),this.resize(h,u),this.packOne(t,n,e)):null},gn.prototype.allocFreebin=function(t,n,e,r){var i=this.freebins.splice(t,1)[0];return i.id=r,i.w=n,i.h=e,i.refcount=0,this.bins[r]=i,this.ref(i),i},gn.prototype.allocShelf=function(t,n,e,r){var i=this.shelves[t].alloc(n,e,r);return this.bins[r]=i,this.ref(i),i},gn.prototype.shrink=function(){if(this.shelves.length>0){for(var t=0,n=0,e=0;e<this.shelves.length;e++){var r=this.shelves[e];n+=r.h,t=Math.max(r.w-r.free,t)}this.resize(t,n)}},gn.prototype.getBin=function(t){return this.bins[t]},gn.prototype.ref=function(t){if(1==++t.refcount){var n=t.h;this.stats[n]=1+(0|this.stats[n])}return t.refcount},gn.prototype.unref=function(t){return 0===t.refcount?0:(0==--t.refcount&&(this.stats[t.h]--,delete this.bins[t.id],this.freebins.push(t)),t.refcount)},gn.prototype.clear=function(){this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0},gn.prototype.resize=function(t,n){this.w=t,this.h=n;for(var e=0;e<this.shelves.length;e++)this.shelves[e].resize(t);return!0},vn.prototype.alloc=function(t,n,e){if(t>this.free||n>this.h)return null;var r=this.x;return this.x+=t,this.free-=t,new bn(e,r,this.y,t,n,t,this.h)},vn.prototype.resize=function(t){return this.free+=t-this.w,this.w=t,!0};class Fn{constructor(t,n){wn(this,t,1,n)}resize(t){Mn(this,t,1)}clone(){return new Fn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,e,r,i){xn(t,n,e,r,i,1)}}class kn{constructor(t,n){wn(this,t,4,n)}resize(t){Mn(this,t,4)}clone(){return new kn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,e,r,i){xn(t,n,e,r,i,4)}}function An(t){let n=0;for(let e,r,i=0,s=t.length,o=s-1;i<s;o=i++)if(e=t[i],r=t[o],void 0!==e.x){if(e.z||r.z)return 1;n+=(r.x-e.x)*(e.y+r.y)}else{if(e[2]||r[2])return 1;n+=(r[0]-e[0])*(e[1]+r[1])}return n}function Pn(t,n,e,r,i){const s=t[n*r],o=t[n*r+1],a=t[e*r],u=t[e*r+1];return s===a&&(s<0||s>i)&&o!==u||o===u&&(o<0||o>i)&&s!==a}function Sn(t,n,e){let r=e;return n&&t&&(r=+t[n]),isNaN(r)&&(r=e||0),100*r}function _n(t,n,e,r,i,s,o){n||0===n||(n=1);const a=Sn(t.properties,e,r),u=a*n;let l=(s?100*s:0)||a;return i?l=Sn(t.properties,i,s):o&&(l=a-Sn(t.properties,o,s)),l*=n,{altitude:u,height:l}}function On(t,n){return n<1/0&&(t.x<0||t.x>n||t.y<0||t.y>n)}function Cn(t){return null==t}function En(t,n,e){if(t===e||t===n)return t;const r=e-n;return((t-n)%r+r)%r+n}function $n(t,n){if(!n)return null;const e=new Map;for(let r=0;r<n.length;r++){const i=n[r],s=t[i];let o=e.get(s);o||(o=[],e.set(s,o)),o.push(i)}return e}function In(t){return!(t&t-1)&&0!==t}\n/*!\n     * Codes from mapbox-gl-js\n     * github.com/mapbox/mapbox-gl-js\n     * MIT License\n     */class zn{constructor(t,n,{pixelRatio:e}){this.paddedRect=t,this.pixelRatio=e||1,this.padding=n}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.pixelRatio,(this.paddedRect.h-2*this.padding)/this.pixelRatio]}}class Dn{constructor(t){this.glyphMap=t,this.build()}build(){const t=this.glyphMap,n=Object.keys(t).length,e={},r=new gn(0,0,{autoResize:!0}),i=[],s=n>1?1:0;for(const n in t){const r=t[n],o={x:0,y:0,w:r.data.width+2*s,h:r.data.height+2*s};i.push(o),e[n]=new zn(o,s,r)}if(r.pack(i,{inPlace:!0}),!In(r.w)||!In(r.h)){const t=Tn(r.w),n=Tn(r.h);r.resize(t,n)}const o=new kn({width:r.w,height:r.h});for(const n in t){const r=t[n],i=e[n].paddedRect;kn.copy(r.data,o,{x:0,y:0},{x:i.x+s,y:i.y+s},r.data)}this.image=o,this.positions=e}}function Tn(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}\n/*!\n     * Codes from mapbox-gl-js\n     * github.com/mapbox/mapbox-gl-js\n     * MIT License\n     * TODO potpack\n     */class Un{constructor(t){this.glyphMap=t,this.build()}build(){const t=this.glyphMap,n={},e=new gn(0,0,{autoResize:!0}),r=[];for(const e in t){const i=t[e],s=n[e]={};for(const t in i){const n=i[+t];if(!n||0===n.bitmap.width||0===n.bitmap.height)continue;const e={x:0,y:0,w:n.bitmap.width+2,h:n.bitmap.height+2};r.push(e),s[t]={rect:e,metrics:n.metrics}}}e.pack(r,{inPlace:!0});const i=new Fn({width:e.w,height:e.h});for(const e in t){const r=t[e];for(const t in r){const s=r[+t];if(!s||0===s.bitmap.width||0===s.bitmap.height)continue;const o=n[e][t].rect;Fn.copy(s.bitmap,i,{x:0,y:0},{x:o.x+1,y:o.y+1},s.bitmap)}}this.image=i,this.positions=n}}function jn(t){return t<65536?Uint16Array:Uint32Array}function Nn(t){return(t=Math.abs(t))<128?Int8Array:t<32768?Int16Array:(Math.pow(2,24),Float32Array)}function Ln(t){return t<256?Uint8Array:t<65536?Uint16Array:Float32Array}function Hn(t,n){const e=t.getLength?t.getLength():t.length;if(t instanceof n)return t.slice(0,e);const r=new n(e);t=t.L||t;for(let n=0;n<e;n++)r[n]=t[n]||0;return r}function Rn(t){const n=t.type,e=[];if(1===n||4===n)for(let n=0;n<t.geometry.length;n++)dn(t.geometry[n],e);else if(2===n)yn(t.geometry,e);else if(3===n)yn(t.geometry,e);else if(5===n)yn(t.geometry,e);else if(6===n)for(let n=0;n<t.geometry.length;n++){const r=[];yn(t.geometry[n],r),e.push(r)}return t.geometry=e,t}var Vn={exports:{}},qn={exports:{}},Gn=function(t){return!(!t||"string"==typeof t)&&(t instanceof Array||Array.isArray(t)||t.length>=0&&(t.splice instanceof Function||Object.getOwnPropertyDescriptor(t,t.length-1)&&"String"!==t.constructor.name))},Jn=Array.prototype.concat,Wn=Array.prototype.slice,Bn=qn.exports=function(t){for(var n=[],e=0,r=t.length;e<r;e++){var i=t[e];Gn(i)?n=Jn.call(n,Wn.call(i)):n.push(i)}return n};Bn.wrap=function(t){return function(){return t(Bn(arguments))}};var Xn=qn.exports,Yn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},Kn=Xn,Zn=Object.hasOwnProperty,Qn=Object.create(null);for(var te in Yn)Zn.call(Yn,te)&&(Qn[Yn[te]]=te);var ne=Vn.exports={to:{},get:{}};function ee(t,n,e){return Math.min(Math.max(n,t),e)}function re(t){var n=Math.round(t).toString(16).toUpperCase();return n.length<2?"0"+n:n}ne.get=function(t){var n,e;switch(t.substring(0,3).toLowerCase()){case"hsl":n=ne.get.hsl(t),e="hsl";break;case"hwb":n=ne.get.hwb(t),e="hwb";break;default:n=ne.get.rgb(t),e="rgb"}return n?{model:e,value:n}:null},ne.get.rgb=function(t){if(!t)return null;var n,e,r,i=[0,0,0,1];if(n=t.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(r=n[2],n=n[1],e=0;e<3;e++){var s=2*e;i[e]=parseInt(n.slice(s,s+2),16)}r&&(i[3]=parseInt(r,16)/255)}else if(n=t.match(/^#([a-f0-9]{3,4})$/i)){for(r=(n=n[1])[3],e=0;e<3;e++)i[e]=parseInt(n[e]+n[e],16);r&&(i[3]=parseInt(r+r,16)/255)}else if(n=t.match(/^rgba?\\(\\s*([+-]?\\d+)(?=[\\s,])\\s*(?:,\\s*)?([+-]?\\d+)(?=[\\s,])\\s*(?:,\\s*)?([+-]?\\d+)\\s*(?:[,|\\/]\\s*([+-]?[\\d\\.]+)(%?)\\s*)?\\)$/)){for(e=0;e<3;e++)i[e]=parseInt(n[e+1],0);n[4]&&(n[5]?i[3]=.01*parseFloat(n[4]):i[3]=parseFloat(n[4]))}else{if(!(n=t.match(/^rgba?\\(\\s*([+-]?[\\d\\.]+)\\%\\s*,?\\s*([+-]?[\\d\\.]+)\\%\\s*,?\\s*([+-]?[\\d\\.]+)\\%\\s*(?:[,|\\/]\\s*([+-]?[\\d\\.]+)(%?)\\s*)?\\)$/)))return(n=t.match(/^(\\w+)$/))?"transparent"===n[1]?[0,0,0,0]:Zn.call(Yn,n[1])?((i=Yn[n[1]])[3]=1,i):null:null;for(e=0;e<3;e++)i[e]=Math.round(2.55*parseFloat(n[e+1]));n[4]&&(n[5]?i[3]=.01*parseFloat(n[4]):i[3]=parseFloat(n[4]))}for(e=0;e<3;e++)i[e]=ee(i[e],0,255);return i[3]=ee(i[3],0,1),i},ne.get.hsl=function(t){if(!t)return null;var n=t.match(/^hsla?\\(\\s*([+-]?(?:\\d{0,3}\\.)?\\d+)(?:deg)?\\s*,?\\s*([+-]?[\\d\\.]+)%\\s*,?\\s*([+-]?[\\d\\.]+)%\\s*(?:[,|\\/]\\s*([+-]?(?=\\.\\d|\\d)(?:0|[1-9]\\d*)?(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)\\s*)?\\)$/);if(n){var e=parseFloat(n[4]);return[(parseFloat(n[1])%360+360)%360,ee(parseFloat(n[2]),0,100),ee(parseFloat(n[3]),0,100),ee(isNaN(e)?1:e,0,1)]}return null},ne.get.hwb=function(t){if(!t)return null;var n=t.match(/^hwb\\(\\s*([+-]?\\d{0,3}(?:\\.\\d+)?)(?:deg)?\\s*,\\s*([+-]?[\\d\\.]+)%\\s*,\\s*([+-]?[\\d\\.]+)%\\s*(?:,\\s*([+-]?(?=\\.\\d|\\d)(?:0|[1-9]\\d*)?(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)\\s*)?\\)$/);if(n){var e=parseFloat(n[4]);return[(parseFloat(n[1])%360+360)%360,ee(parseFloat(n[2]),0,100),ee(parseFloat(n[3]),0,100),ee(isNaN(e)?1:e,0,1)]}return null},ne.to.hex=function(){var t=Kn(arguments);return"#"+re(t[0])+re(t[1])+re(t[2])+(t[3]<1?re(Math.round(255*t[3])):"")},ne.to.rgb=function(){var t=Kn(arguments);return t.length<4||1===t[3]?"rgb("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+")":"rgba("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+", "+t[3]+")"},ne.to.rgb.percent=function(){var t=Kn(arguments),n=Math.round(t[0]/255*100),e=Math.round(t[1]/255*100),r=Math.round(t[2]/255*100);return t.length<4||1===t[3]?"rgb("+n+"%, "+e+"%, "+r+"%)":"rgba("+n+"%, "+e+"%, "+r+"%, "+t[3]+")"},ne.to.hsl=function(){var t=Kn(arguments);return t.length<4||1===t[3]?"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)":"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+t[3]+")"},ne.to.hwb=function(){var t=Kn(arguments),n="";return t.length>=4&&1!==t[3]&&(n=", "+t[3]),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+n+")"},ne.to.keyword=function(t){return Qn[t.slice(0,3)]};var ie=Vn.exports,se={exports:{}},oe={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},ae={};for(var ue in oe)oe.hasOwnProperty(ue)&&(ae[oe[ue]]=ue);var le=se.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var he in le)if(le.hasOwnProperty(he)){if(!("channels"in le[he]))throw new Error("missing channels property: "+he);if(!("labels"in le[he]))throw new Error("missing channel labels property: "+he);if(le[he].labels.length!==le[he].channels)throw new Error("channel and label counts mismatch: "+he);var ce=le[he].channels,fe=le[he].labels;delete le[he].channels,delete le[he].labels,Object.defineProperty(le[he],"channels",{value:ce}),Object.defineProperty(le[he],"labels",{value:fe})}le.rgb.hsl=function(t){var n,e,r=t[0]/255,i=t[1]/255,s=t[2]/255,o=Math.min(r,i,s),a=Math.max(r,i,s),u=a-o;return a===o?n=0:r===a?n=(i-s)/u:i===a?n=2+(s-r)/u:s===a&&(n=4+(r-i)/u),(n=Math.min(60*n,360))<0&&(n+=360),e=(o+a)/2,[n,100*(a===o?0:e<=.5?u/(a+o):u/(2-a-o)),100*e]},le.rgb.hsv=function(t){var n,e,r,i,s,o=t[0]/255,a=t[1]/255,u=t[2]/255,l=Math.max(o,a,u),h=l-Math.min(o,a,u),c=function(t){return(l-t)/6/h+.5};return 0===h?i=s=0:(s=h/l,n=c(o),e=c(a),r=c(u),o===l?i=r-e:a===l?i=1/3+n-r:u===l&&(i=2/3+e-n),i<0?i+=1:i>1&&(i-=1)),[360*i,100*s,100*l]},le.rgb.hwb=function(t){var n=t[0],e=t[1],r=t[2];return[le.rgb.hsl(t)[0],100*(1/255*Math.min(n,Math.min(e,r))),100*(r=1-1/255*Math.max(n,Math.max(e,r)))]},le.rgb.cmyk=function(t){var n,e=t[0]/255,r=t[1]/255,i=t[2]/255;return[100*((1-e-(n=Math.min(1-e,1-r,1-i)))/(1-n)||0),100*((1-r-n)/(1-n)||0),100*((1-i-n)/(1-n)||0),100*n]},le.rgb.keyword=function(t){var n=ae[t];if(n)return n;var e,r,i,s=1/0;for(var o in oe)if(oe.hasOwnProperty(o)){var a=oe[o],u=(r=t,i=a,Math.pow(r[0]-i[0],2)+Math.pow(r[1]-i[1],2)+Math.pow(r[2]-i[2],2));u<s&&(s=u,e=o)}return e},le.keyword.rgb=function(t){return oe[t]},le.rgb.xyz=function(t){var n=t[0]/255,e=t[1]/255,r=t[2]/255;return[100*(.4124*(n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92)+.3576*(e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92)+.1805*(r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92)),100*(.2126*n+.7152*e+.0722*r),100*(.0193*n+.1192*e+.9505*r)]},le.rgb.lab=function(t){var n=le.rgb.xyz(t),e=n[0],r=n[1],i=n[2];return r/=100,i/=108.883,e=(e/=95.047)>.008856?Math.pow(e,1/3):7.787*e+16/116,[116*(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116)-16,500*(e-r),200*(r-(i=i>.008856?Math.pow(i,1/3):7.787*i+16/116))]},le.hsl.rgb=function(t){var n,e,r,i,s,o=t[0]/360,a=t[1]/100,u=t[2]/100;if(0===a)return[s=255*u,s,s];n=2*u-(e=u<.5?u*(1+a):u+a-u*a),i=[0,0,0];for(var l=0;l<3;l++)(r=o+1/3*-(l-1))<0&&r++,r>1&&r--,s=6*r<1?n+6*(e-n)*r:2*r<1?e:3*r<2?n+(e-n)*(2/3-r)*6:n,i[l]=255*s;return i},le.hsl.hsv=function(t){var n=t[0],e=t[1]/100,r=t[2]/100,i=e,s=Math.max(r,.01);return e*=(r*=2)<=1?r:2-r,i*=s<=1?s:2-s,[n,100*(0===r?2*i/(s+i):2*e/(r+e)),100*((r+e)/2)]},le.hsv.rgb=function(t){var n=t[0]/60,e=t[1]/100,r=t[2]/100,i=Math.floor(n)%6,s=n-Math.floor(n),o=255*r*(1-e),a=255*r*(1-e*s),u=255*r*(1-e*(1-s));switch(r*=255,i){case 0:return[r,u,o];case 1:return[a,r,o];case 2:return[o,r,u];case 3:return[o,a,r];case 4:return[u,o,r];case 5:return[r,o,a]}},le.hsv.hsl=function(t){var n,e,r,i=t[0],s=t[1]/100,o=t[2]/100,a=Math.max(o,.01);return r=(2-s)*o,e=s*a,[i,100*(e=(e/=(n=(2-s)*a)<=1?n:2-n)||0),100*(r/=2)]},le.hwb.rgb=function(t){var n,e,r,i,s,o,a,u=t[0]/360,l=t[1]/100,h=t[2]/100,c=l+h;switch(c>1&&(l/=c,h/=c),r=6*u-(n=Math.floor(6*u)),1&n&&(r=1-r),i=l+r*((e=1-h)-l),n){default:case 6:case 0:s=e,o=i,a=l;break;case 1:s=i,o=e,a=l;break;case 2:s=l,o=e,a=i;break;case 3:s=l,o=i,a=e;break;case 4:s=i,o=l,a=e;break;case 5:s=e,o=l,a=i}return[255*s,255*o,255*a]},le.cmyk.rgb=function(t){var n=t[0]/100,e=t[1]/100,r=t[2]/100,i=t[3]/100;return[255*(1-Math.min(1,n*(1-i)+i)),255*(1-Math.min(1,e*(1-i)+i)),255*(1-Math.min(1,r*(1-i)+i))]},le.xyz.rgb=function(t){var n,e,r,i=t[0]/100,s=t[1]/100,o=t[2]/100;return e=-.9689*i+1.8758*s+.0415*o,r=.0557*i+-.204*s+1.057*o,n=(n=3.2406*i+-1.5372*s+-.4986*o)>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,e=e>.0031308?1.055*Math.pow(e,1/2.4)-.055:12.92*e,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:12.92*r,[255*(n=Math.min(Math.max(0,n),1)),255*(e=Math.min(Math.max(0,e),1)),255*(r=Math.min(Math.max(0,r),1))]},le.xyz.lab=function(t){var n=t[0],e=t[1],r=t[2];return e/=100,r/=108.883,n=(n/=95.047)>.008856?Math.pow(n,1/3):7.787*n+16/116,[116*(e=e>.008856?Math.pow(e,1/3):7.787*e+16/116)-16,500*(n-e),200*(e-(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116))]},le.lab.xyz=function(t){var n,e,r,i=t[0];n=t[1]/500+(e=(i+16)/116),r=e-t[2]/200;var s=Math.pow(e,3),o=Math.pow(n,3),a=Math.pow(r,3);return e=s>.008856?s:(e-16/116)/7.787,n=o>.008856?o:(n-16/116)/7.787,r=a>.008856?a:(r-16/116)/7.787,[n*=95.047,e*=100,r*=108.883]},le.lab.lch=function(t){var n,e=t[0],r=t[1],i=t[2];return(n=360*Math.atan2(i,r)/2/Math.PI)<0&&(n+=360),[e,Math.sqrt(r*r+i*i),n]},le.lch.lab=function(t){var n,e=t[0],r=t[1];return n=t[2]/360*2*Math.PI,[e,r*Math.cos(n),r*Math.sin(n)]},le.rgb.ansi16=function(t){var n=t[0],e=t[1],r=t[2],i=1 in arguments?arguments[1]:le.rgb.hsv(t)[2];if(0===(i=Math.round(i/50)))return 30;var s=30+(Math.round(r/255)<<2|Math.round(e/255)<<1|Math.round(n/255));return 2===i&&(s+=60),s},le.hsv.ansi16=function(t){return le.rgb.ansi16(le.hsv.rgb(t),t[2])},le.rgb.ansi256=function(t){var n=t[0],e=t[1],r=t[2];return n===e&&e===r?n<8?16:n>248?231:Math.round((n-8)/247*24)+232:16+36*Math.round(n/255*5)+6*Math.round(e/255*5)+Math.round(r/255*5)},le.ansi16.rgb=function(t){var n=t%10;if(0===n||7===n)return t>50&&(n+=3.5),[n=n/10.5*255,n,n];var e=.5*(1+~~(t>50));return[(1&n)*e*255,(n>>1&1)*e*255,(n>>2&1)*e*255]},le.ansi256.rgb=function(t){if(t>=232){var n=10*(t-232)+8;return[n,n,n]}var e;return t-=16,[Math.floor(t/36)/5*255,Math.floor((e=t%36)/6)/5*255,e%6/5*255]},le.rgb.hex=function(t){var n=(((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2]))).toString(16).toUpperCase();return"000000".substring(n.length)+n},le.hex.rgb=function(t){var n=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!n)return[0,0,0];var e=n[0];3===n[0].length&&(e=e.split("").map((function(t){return t+t})).join(""));var r=parseInt(e,16);return[r>>16&255,r>>8&255,255&r]},le.rgb.hcg=function(t){var n,e=t[0]/255,r=t[1]/255,i=t[2]/255,s=Math.max(Math.max(e,r),i),o=Math.min(Math.min(e,r),i),a=s-o;return n=a<=0?0:s===e?(r-i)/a%6:s===r?2+(i-e)/a:4+(e-r)/a+4,n/=6,[360*(n%=1),100*a,100*(a<1?o/(1-a):0)]},le.hsl.hcg=function(t){var n=t[1]/100,e=t[2]/100,r=1,i=0;return(r=e<.5?2*n*e:2*n*(1-e))<1&&(i=(e-.5*r)/(1-r)),[t[0],100*r,100*i]},le.hsv.hcg=function(t){var n=t[1]/100,e=t[2]/100,r=n*e,i=0;return r<1&&(i=(e-r)/(1-r)),[t[0],100*r,100*i]},le.hcg.rgb=function(t){var n=t[0]/360,e=t[1]/100,r=t[2]/100;if(0===e)return[255*r,255*r,255*r];var i,s=[0,0,0],o=n%1*6,a=o%1,u=1-a;switch(Math.floor(o)){case 0:s[0]=1,s[1]=a,s[2]=0;break;case 1:s[0]=u,s[1]=1,s[2]=0;break;case 2:s[0]=0,s[1]=1,s[2]=a;break;case 3:s[0]=0,s[1]=u,s[2]=1;break;case 4:s[0]=a,s[1]=0,s[2]=1;break;default:s[0]=1,s[1]=0,s[2]=u}return i=(1-e)*r,[255*(e*s[0]+i),255*(e*s[1]+i),255*(e*s[2]+i)]},le.hcg.hsv=function(t){var n=t[1]/100,e=n+t[2]/100*(1-n),r=0;return e>0&&(r=n/e),[t[0],100*r,100*e]},le.hcg.hsl=function(t){var n=t[1]/100,e=t[2]/100*(1-n)+.5*n,r=0;return e>0&&e<.5?r=n/(2*e):e>=.5&&e<1&&(r=n/(2*(1-e))),[t[0],100*r,100*e]},le.hcg.hwb=function(t){var n=t[1]/100,e=n+t[2]/100*(1-n);return[t[0],100*(e-n),100*(1-e)]},le.hwb.hcg=function(t){var n=t[1]/100,e=1-t[2]/100,r=e-n,i=0;return r<1&&(i=(e-r)/(1-r)),[t[0],100*r,100*i]},le.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},le.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},le.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},le.gray.hsl=le.gray.hsv=function(t){return[0,0,t[0]]},le.gray.hwb=function(t){return[0,100,t[0]]},le.gray.cmyk=function(t){return[0,0,0,t[0]]},le.gray.lab=function(t){return[t[0],0,0]},le.gray.hex=function(t){var n=255&Math.round(t[0]/100*255),e=((n<<16)+(n<<8)+n).toString(16).toUpperCase();return"000000".substring(e.length)+e},le.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]};var de=se.exports,pe=de;function ye(t){var n=function(){for(var t={},n=Object.keys(pe),e=n.length,r=0;r<e;r++)t[n[r]]={distance:-1,parent:null};return t}(),e=[t];for(n[t].distance=0;e.length;)for(var r=e.pop(),i=Object.keys(pe[r]),s=i.length,o=0;o<s;o++){var a=i[o],u=n[a];-1===u.distance&&(u.distance=n[r].distance+1,u.parent=r,e.unshift(a))}return n}function me(t,n){return function(e){return n(t(e))}}function ge(t,n){for(var e=[n[t].parent,t],r=pe[n[t].parent][t],i=n[t].parent;n[i].parent;)e.unshift(n[i].parent),r=me(pe[n[i].parent][i],r),i=n[i].parent;return r.conversion=e,r}var ve=de,be=function(t){for(var n=ye(t),e={},r=Object.keys(n),i=r.length,s=0;s<i;s++){var o=r[s];null!==n[o].parent&&(e[o]=ge(o,n))}return e},we={};Object.keys(ve).forEach((function(t){we[t]={},Object.defineProperty(we[t],"channels",{value:ve[t].channels}),Object.defineProperty(we[t],"labels",{value:ve[t].labels});var n=be(t);Object.keys(n).forEach((function(e){var r=n[e];we[t][e]=function(t){var n=function(n){if(null==n)return n;arguments.length>1&&(n=Array.prototype.slice.call(arguments));var e=t(n);if("object"==typeof e)for(var r=e.length,i=0;i<r;i++)e[i]=Math.round(e[i]);return e};return"conversion"in t&&(n.conversion=t.conversion),n}(r),we[t][e].raw=function(t){var n=function(n){return null==n?n:(arguments.length>1&&(n=Array.prototype.slice.call(arguments)),t(n))};return"conversion"in t&&(n.conversion=t.conversion),n}(r)}))}));var Me=ie,xe=we,Fe=[].slice,ke=["keyword","gray","hex"],Ae={};Object.keys(xe).forEach((function(t){Ae[Fe.call(xe[t].labels).sort().join("")]=t}));var Pe={};function Se(t,n){if(!(this instanceof Se))return new Se(t,n);if(n&&n in ke&&(n=null),n&&!(n in xe))throw new Error("Unknown model: "+n);var e,r;if(null==t)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(t instanceof Se)this.model=t.model,this.color=t.color.slice(),this.valpha=t.valpha;else if("string"==typeof t){var i=Me.get(t);if(null===i)throw new Error("Unable to parse color from string: "+t);this.model=i.model,r=xe[this.model].channels,this.color=i.value.slice(0,r),this.valpha="number"==typeof i.value[r]?i.value[r]:1}else if(t.length){this.model=n||"rgb",r=xe[this.model].channels;var s=Fe.call(t,0,r);this.color=Ce(s,r),this.valpha="number"==typeof t[r]?t[r]:1}else if("number"==typeof t)t&=16777215,this.model="rgb",this.color=[t>>16&255,t>>8&255,255&t],this.valpha=1;else{this.valpha=1;var o=Object.keys(t);"alpha"in t&&(o.splice(o.indexOf("alpha"),1),this.valpha="number"==typeof t.alpha?t.alpha:0);var a=o.sort().join("");if(!(a in Ae))throw new Error("Unable to parse color from object: "+JSON.stringify(t));this.model=Ae[a];var u=xe[this.model].labels,l=[];for(e=0;e<u.length;e++)l.push(t[u[e]]);this.color=Ce(l)}if(Pe[this.model])for(r=xe[this.model].channels,e=0;e<r;e++){var h=Pe[this.model][e];h&&(this.color[e]=h(this.color[e]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}function _e(t,n,e){return(t=Array.isArray(t)?t:[t]).forEach((function(t){(Pe[t]||(Pe[t]=[]))[n]=e})),t=t[0],function(r){var i;return arguments.length?(e&&(r=e(r)),(i=this[t]()).color[n]=r,i):(i=this[t]().color[n],e&&(i=e(i)),i)}}function Oe(t){return function(n){return Math.max(0,Math.min(t,n))}}function Ce(t,n){for(var e=0;e<n;e++)"number"!=typeof t[e]&&(t[e]=0);return t}Se.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(t){var n=this.model in Me.to?this:this.rgb(),e=1===(n=n.round("number"==typeof t?t:1)).valpha?n.color:n.color.concat(this.valpha);return Me.to[n.model](e)},percentString:function(t){var n=this.rgb().round("number"==typeof t?t:1),e=1===n.valpha?n.color:n.color.concat(this.valpha);return Me.to.rgb.percent(e)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var t={},n=xe[this.model].channels,e=xe[this.model].labels,r=0;r<n;r++)t[e[r]]=this.color[r];return 1!==this.valpha&&(t.alpha=this.valpha),t},unitArray:function(){var t=this.rgb().color;return t[0]/=255,t[1]/=255,t[2]/=255,1!==this.valpha&&t.push(this.valpha),t},unitObject:function(){var t=this.rgb().object();return t.r/=255,t.g/=255,t.b/=255,1!==this.valpha&&(t.alpha=this.valpha),t},round:function(t){return t=Math.max(t||0,0),new Se(this.color.map(function(t){return function(n){return function(t,n){return Number(t.toFixed(n))}(n,t)}}(t)).concat(this.valpha),this.model)},alpha:function(t){return arguments.length?new Se(this.color.concat(Math.max(0,Math.min(1,t))),this.model):this.valpha},red:_e("rgb",0,Oe(255)),green:_e("rgb",1,Oe(255)),blue:_e("rgb",2,Oe(255)),hue:_e(["hsl","hsv","hsl","hwb","hcg"],0,(function(t){return(t%360+360)%360})),saturationl:_e("hsl",1,Oe(100)),lightness:_e("hsl",2,Oe(100)),saturationv:_e("hsv",1,Oe(100)),value:_e("hsv",2,Oe(100)),chroma:_e("hcg",1,Oe(100)),gray:_e("hcg",2,Oe(100)),white:_e("hwb",1,Oe(100)),wblack:_e("hwb",2,Oe(100)),cyan:_e("cmyk",0,Oe(100)),magenta:_e("cmyk",1,Oe(100)),yellow:_e("cmyk",2,Oe(100)),black:_e("cmyk",3,Oe(100)),x:_e("xyz",0,Oe(100)),y:_e("xyz",1,Oe(100)),z:_e("xyz",2,Oe(100)),l:_e("lab",0,Oe(100)),a:_e("lab",1),b:_e("lab",2),keyword:function(t){return arguments.length?new Se(t):xe[this.model].keyword(this.color)},hex:function(t){return arguments.length?new Se(t):Me.to.hex(this.rgb().round().color)},rgbNumber:function(){var t=this.rgb().color;return(255&t[0])<<16|(255&t[1])<<8|255&t[2]},luminosity:function(){for(var t=this.rgb().color,n=[],e=0;e<t.length;e++){var r=t[e]/255;n[e]=r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4)}return.2126*n[0]+.7152*n[1]+.0722*n[2]},contrast:function(t){var n=this.luminosity(),e=t.luminosity();return n>e?(n+.05)/(e+.05):(e+.05)/(n+.05)},level:function(t){var n=this.contrast(t);return n>=7.1?"AAA":n>=4.5?"AA":""},isDark:function(){var t=this.rgb().color;return(299*t[0]+587*t[1]+114*t[2])/1e3<128},isLight:function(){return!this.isDark()},negate:function(){for(var t=this.rgb(),n=0;n<3;n++)t.color[n]=255-t.color[n];return t},lighten:function(t){var n=this.hsl();return n.color[2]+=n.color[2]*t,n},darken:function(t){var n=this.hsl();return n.color[2]-=n.color[2]*t,n},saturate:function(t){var n=this.hsl();return n.color[1]+=n.color[1]*t,n},desaturate:function(t){var n=this.hsl();return n.color[1]-=n.color[1]*t,n},whiten:function(t){var n=this.hwb();return n.color[1]+=n.color[1]*t,n},blacken:function(t){var n=this.hwb();return n.color[2]+=n.color[2]*t,n},grayscale:function(){var t=this.rgb().color,n=.3*t[0]+.59*t[1]+.11*t[2];return Se.rgb(n,n,n)},fade:function(t){return this.alpha(this.valpha-this.valpha*t)},opaquer:function(t){return this.alpha(this.valpha+this.valpha*t)},rotate:function(t){var n=this.hsl(),e=n.color[0];return e=(e=(e+t)%360)<0?360+e:e,n.color[0]=e,n},mix:function(t,n){if(!t||!t.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof t);var e=t.rgb(),r=this.rgb(),i=void 0===n?.5:n,s=2*i-1,o=e.alpha()-r.alpha(),a=((s*o==-1?s:(s+o)/(1+s*o))+1)/2,u=1-a;return Se.rgb(a*e.red()+u*r.red(),a*e.green()+u*r.green(),a*e.blue()+u*r.blue(),e.alpha()*i+r.alpha()*(1-i))}},Object.keys(xe).forEach((function(t){if(-1===ke.indexOf(t)){var n=xe[t].channels;Se.prototype[t]=function(){if(this.model===t)return new Se(this);if(arguments.length)return new Se(arguments,t);var e,r="number"==typeof arguments[n]?n:this.valpha;return new Se((e=xe[this.model][t].raw(this.color),Array.isArray(e)?e:[e]).concat(r),t)},Se[t]=function(e){return"number"==typeof e&&(e=Ce(Fe.call(arguments),n)),new Se(e,t)}}}));var Ee=Et(Se);function $e(t){for(let n=1;n<arguments.length;n++){const e=arguments[n];for(const n in e)t[n]=e[n]}return t}function Ie(t){return null==t}function ze(t){return"number"==typeof t&&!isNaN(t)}function De(t){return"object"==typeof t&&!!t}function Te(t){return!Ie(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}const Ue=Object.prototype.hasOwnProperty;function je(t,n){return Ue.call(t,n)}function Ne(t){return t&&g(t)&&t.property}const Le={};function He(t,n){if(!Array.isArray(n)){if(n&&void 0!==n.r&&void 0!==n.g&&void 0!==n.b)return t[0]=255*n.r,t[1]=255*n.g,t[2]=255*n.b,void 0!==n.a?t[3]=255*n.a:t[3]=255,t;const e=n;n=Le[e]=Le[e]||Ee(n).unitArray()}for(let e=0;e<n.length;e++)t[e]=255*n[e];return 3===n.length&&(t[3]=255),t}const Re={textFill:1,textSize:1,textOpacity:1,textDx:1,textDy:1,markerWidth:1,markerHeight:1,markerOpacity:1,markerDx:1,markerDy:1,lineWidth:1,lineColor:1,lineOpacity:1,polygonFill:1,polygonOpacity:1,polygonPatternFileWidth:1,polygonPatternFileOrigin:1,rotationX:1,rotationY:1,rotationZ:1,scaleX:1,scaleY:1,scaleZ:1,translationX:1,translationY:1,translationZ:1},Ve={textName:1,markerTextFitPadding:1,markerTextFit:1,lineGradientProperty:1};class qe{constructor(t,n,e,r){this.feature=t,this.symbol=n,this.fnTypes=e,this.options=r}getPolygonResource(){let t=this.symbol.polygonPatternFile;const{polygonPatternFileFn:n}=this.fnTypes,e=n;return this.H(t,e)}getLineResource(){let t=this.symbol.linePatternFile;const{linePatternFileFn:n}=this.fnTypes,e=n;return this.H(t,e)}H(t,n){if(n){const e=this.feature.properties;t=n(this.options.zoom,e)}return t}}\n/*!\n        Feature Filter by\n\n        (c) mapbox 2016 and maptalks 2018\n        www.mapbox.com | www.maptalks.org\n        License: MIT, header required.\n    */\nconst Ge=["Unknown","Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"];function Je(t){return new Function("f",\`var p = (f && f.properties || {}); return ${YL}Be(t)}\`)}function We(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":case"!has":return 2===t.length&&("string"==typeof t[1]||t[1].property&&t[1].op);case"in":case"!in":return t.length>=2&&("string"==typeof t[1]||t[1].property&&t[1].op);case"==":case"!=":case">":case">=":case"<":case"<=":return 3===t.length&&("string"==typeof t[1]||t[1].property&&t[1].op);case"none":case"any":case"all":for(const n of t.slice(1))if(!We(n)&&"boolean"!=typeof n)return!1;return!0;case"contains":return!0;default:return!1}}function Be(t){if(!t)return"true";const n=t[0];if(t.length<=1)return"any"===n?"false":"true";return\`(${YL}"=="===n?Ye(t[1],t[2],"===",!1):"!="===n?Ye(t[1],t[2],"!==",!1):"<"===n||">"===n||"<="===n||">="===n?Ye(t[1],t[2],n,!0):"any"===n?Ze(t.slice(1),"||"):"all"===n?Ze(t.slice(1),"&&"):"none"===n?nr(Ze(t.slice(1),"||")):"in"===n?Qe(t[1],t.slice(2)):"!in"===n?nr(Qe(t[1],t.slice(2))):"has"===n?tr(t[1]):"!has"===n?nr(tr(t[1])):"contains"===n?function(t,n,e){const r=Xe(t);return void 0!==e?\`(${YL}r} + '').indexOf("${YL}n}") === ${YL}e}\`:\`(${YL}r} + '').indexOf("${YL}n}") >= 0\`}(t[1],t[2],t[3]):"true"})\`}function Xe(t){return"$"===t[0]?"f."+t.substring(1):"p["+JSON.stringify(t)+"]"}function Ye(t,n,e,r){if("object"==typeof(i=t)&&i&&t.op)return function(t,n,e,r){const i=t.property,s=t.op;let o=Xe(i);return"length"!==s?(console.error(\`not support ${YL}s} op\`),"false"):(o=\`((${YL}o}+='').length)\`,Ke(o,i,n,e,r))}(t,n,e,r);var i;return Ke(Xe(t),t,n,e,r)}function Ke(t,n,e,r,i){const s="$type"===n?Ge.indexOf(e):JSON.stringify(e);return(i?\`typeof ${YL}t}=== typeof ${YL}s}&&\`:"")+t+r+s}function Ze(t,n){return t.map(Be).join(n)}function Qe(t,n){"$type"===t&&(n=n.map((t=>Ge.indexOf(t))));const e=JSON.stringify(n.sort(er)),r=Xe(t);return n.length<=200?\`${YL}e}.indexOf(${YL}r}) !== -1\`:\`function(v, a, i, j) {\\n        while (i <= j) { var m = (i + j) >> 1;\\n            if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;\\n        }\\n    return false; }(${YL}r}, ${YL}e},0,${YL}n.length-1})\`}function tr(t){return"$id"===t?'"id" in f':\`${YL}JSON.stringify(t)} in p\`}function nr(t){return\`!(${YL}t})\`}function er(t,n){return t<n?-1:t>n?1:0}\n/*!\n     * a compact version of mapbox-gl-style-spec\n     * based on mapbox-gl-style-spec@13.28.0\n     * https://github.com/mapbox/mapbox-gl-js/tree/main/src/style-spec\n     * LICENSE : ISC\n     */var rr="undefined"!=typeof undefinedThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof undefined?global:"undefined"!=typeof self?self:{},ir={exports:{}};function sr(t,...n){for(const e of n)for(const n in e)t[n]=e[n];return t}\n/*! https://mths.be/punycode v1.3.2 by @mathias */\n!function(t,n){!function(e){var r=n&&!n.nodeType&&n,i=t&&!t.nodeType&&t,s="object"==typeof rr&&rr;s.global!==s&&s.window!==s&&s.self!==s||(e=s);var o,a,u=2147483647,l=36,h=1,c=26,f=38,d=700,p=72,y=128,m="-",g=/^xn--/,v=/[^\\x20-\\x7E]/,b=/[\\x2E\\u3002\\uFF0E\\uFF61]/g,w={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},M=l-h,x=Math.floor,F=String.fromCharCode;function k(t){throw RangeError(w[t])}function A(t,n){for(var e=t.length,r=[];e--;)r[e]=n(t[e]);return r}function P(t,n){var e=t.split("@"),r="";return e.length>1&&(r=e[0]+"@",t=e[1]),r+A((t=t.replace(b,".")).split("."),n).join(".")}function S(t){for(var n,e,r=[],i=0,s=t.length;i<s;)(n=t.charCodeAt(i++))>=55296&&n<=56319&&i<s?56320==(64512&(e=t.charCodeAt(i++)))?r.push(((1023&n)<<10)+(1023&e)+65536):(r.push(n),i--):r.push(n);return r}function _(t){return A(t,(function(t){var n="";return t>65535&&(n+=F((t-=65536)>>>10&1023|55296),t=56320|1023&t),n+=F(t)})).join("")}function O(t,n){return t+22+75*(t<26)-((0!=n)<<5)}function C(t,n,e){var r=0;for(t=e?x(t/d):t>>1,t+=x(t/n);t>M*c>>1;r+=l)t=x(t/M);return x(r+(M+1)*t/(t+f))}function E(t){var n,e,r,i,s,o,a,f,d,g,v,b=[],w=t.length,M=0,F=y,A=p;for((e=t.lastIndexOf(m))<0&&(e=0),r=0;r<e;++r)t.charCodeAt(r)>=128&&k("not-basic"),b.push(t.charCodeAt(r));for(i=e>0?e+1:0;i<w;){for(s=M,o=1,a=l;i>=w&&k("invalid-input"),((f=(v=t.charCodeAt(i++))-48<10?v-22:v-65<26?v-65:v-97<26?v-97:l)>=l||f>x((u-M)/o))&&k("overflow"),M+=f*o,!(f<(d=a<=A?h:a>=A+c?c:a-A));a+=l)o>x(u/(g=l-d))&&k("overflow"),o*=g;A=C(M-s,n=b.length+1,0==s),x(M/n)>u-F&&k("overflow"),F+=x(M/n),M%=n,b.splice(M++,0,F)}return _(b)}function $(t){var n,e,r,i,s,o,a,f,d,g,v,b,w,M,A,P=[];for(b=(t=S(t)).length,n=y,e=0,s=p,o=0;o<b;++o)(v=t[o])<128&&P.push(F(v));for(r=i=P.length,i&&P.push(m);r<b;){for(a=u,o=0;o<b;++o)(v=t[o])>=n&&v<a&&(a=v);for(a-n>x((u-e)/(w=r+1))&&k("overflow"),e+=(a-n)*w,n=a,o=0;o<b;++o)if((v=t[o])<n&&++e>u&&k("overflow"),v==n){for(f=e,d=l;!(f<(g=d<=s?h:d>=s+c?c:d-s));d+=l)A=f-g,M=l-g,P.push(F(O(g+A%M,0))),f=x(A/M);P.push(F(O(f,0))),s=C(e,w,r==i),e=0,++r}++e,++n}return P.join("")}if(o={version:"1.3.2",ucs2:{decode:S,encode:_},decode:E,encode:$,toASCII:function(t){return P(t,(function(t){return v.test(t)?"xn--"+$(t):t}))},toUnicode:function(t){return P(t,(function(t){return g.test(t)?E(t.slice(4).toLowerCase()):t}))}},r&&i)if(t.exports==r)i.exports=o;else for(a in o)o.hasOwnProperty(a)&&(r[a]=o[a]);else e.punycode=o}(rr)}(ir,ir.exports);class or extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}var ar=or;class ur{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[t,e]of n)this.bindings[t]=e}concat(t){return new ur(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(\`${YL}t} not found in scope.\`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var lr=ur;const hr={kind:"null"},cr={kind:"number"},fr={kind:"string"},dr={kind:"boolean"},pr={kind:"color"},yr={kind:"object"},mr={kind:"value"},gr={kind:"collator"},vr={kind:"formatted"},br={kind:"resolvedImage"};function wr(t,n){return{kind:"array",itemType:t,N:n}}function Mr(t){if("array"===t.kind){const n=Mr(t.itemType);return"number"==typeof t.N?\`array<${YL}n}, ${YL}t.N}>\`:"value"===t.itemType.kind?"array":\`array<${YL}n}>\`}return t.kind}const xr=[hr,cr,fr,dr,pr,vr,yr,wr(mr),br];function Fr(t,n){if("error"===n.kind)return null;if("array"===t.kind){if("array"===n.kind&&(0===n.N&&"value"===n.itemType.kind||!Fr(t.itemType,n.itemType))&&("number"!=typeof t.N||t.N===n.N))return null}else{if(t.kind===n.kind)return null;if("value"===t.kind)for(const t of xr)if(!Fr(t,n))return null}return\`Expected ${YL}Mr(t)} but found ${YL}Mr(n)} instead.\`}function kr(t,n){return n.some((n=>n.kind===t.kind))}function Ar(t,n){return n.some((n=>"null"===n?null===t:"array"===n?Array.isArray(t):"object"===n?t&&!Array.isArray(t)&&"object"==typeof t:n===typeof t))}var Pr,Sr={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function _r(t){return(t=Math.round(t))<0?0:t>255?255:t}function Or(t){return t<0?0:t>1?1:t}function Cr(t){return"%"===t[t.length-1]?_r(parseFloat(t)/100*255):_r(parseInt(t))}function Er(t){return"%"===t[t.length-1]?Or(parseFloat(t)/100):Or(parseFloat(t))}function $r(t,n,e){return e<0?e+=1:e>1&&(e-=1),6*e<1?t+(n-t)*e*6:2*e<1?n:3*e<2?t+(n-t)*(2/3-e)*6:t}try{Pr={}.parseCSSColor=function(t){var n,e=t.replace(/ /g,"").toLowerCase();if(e in Sr)return Sr[e].slice();if("#"===e[0])return 4===e.length?(n=parseInt(e.substr(1),16))>=0&&n<=4095?[(3840&n)>>4|(3840&n)>>8,240&n|(240&n)>>4,15&n|(15&n)<<4,1]:null:7===e.length&&(n=parseInt(e.substr(1),16))>=0&&n<=16777215?[(16711680&n)>>16,(65280&n)>>8,255&n,1]:null;var r=e.indexOf("("),i=e.indexOf(")");if(-1!==r&&i+1===e.length){var s=e.substr(0,r),o=e.substr(r+1,i-(r+1)).split(","),a=1;switch(s){case"rgba":if(4!==o.length)return null;a=Er(o.pop());case"rgb":return 3!==o.length?null:[Cr(o[0]),Cr(o[1]),Cr(o[2]),a];case"hsla":if(4!==o.length)return null;a=Er(o.pop());case"hsl":if(3!==o.length)return null;var u=(parseFloat(o[0])%360+360)%360/360,l=Er(o[1]),h=Er(o[2]),c=h<=.5?h*(l+1):h+l-h*l,f=2*h-c;return[_r(255*$r(f,c,u+1/3)),_r(255*$r(f,c,u)),_r(255*$r(f,c,u-1/3)),a];default:return null}}return null}}catch(t){}class Ir{constructor(t,n,e,r=1){this.r=t,this.g=n,this.b=e,this.a=r}static parse(t){if(!t)return;if(t instanceof Ir)return t;if("string"!=typeof t)return;const n=Pr(t);return n?new Ir(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[t,n,e,r]=this.toArray();return\`rgba(${YL}Math.round(t)},${YL}Math.round(n)},${YL}Math.round(e)},${YL}r})\`}toArray(){const{r:t,g:n,b:e,a:r}=this;return 0===r?[0,0,0,0]:[255*t/r,255*n/r,255*e/r,r]}toArray01(){const{r:t,g:n,b:e,a:r}=this;return 0===r?[0,0,0,0]:[t/r,n/r,e/r,r]}toArray01PremultipliedAlpha(){const{r:t,g:n,b:e,a:r}=this;return[t,n,e,r]}}Ir.black=new Ir(0,0,0,1),Ir.white=new Ir(1,1,1,1),Ir.transparent=new Ir(0,0,0,0),Ir.red=new Ir(1,0,0,1),Ir.blue=new Ir(0,0,1,1);var zr=Ir;class Dr{constructor(t,n,e){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=e,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Tr{constructor(t,n,e,r,i){this.text=t.normalize?t.normalize():t,this.image=n,this.scale=e,this.fontStack=r,this.textColor=i}}class Ur{constructor(t){this.sections=t}static fromString(t){return new Ur([new Tr(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((t=>0!==t.text.length||t.image&&0!==t.image.name.length))}static factory(t){return t instanceof Ur?t:Ur.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map((t=>t.text)).join("")}serialize(){const t=["format"];for(const n of this.sections){if(n.image){t.push(["image",n.image.name]);continue}t.push(n.text);const e={};n.fontStack&&(e["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(e["font-scale"]=n.scale),n.textColor&&(e["text-color"]=["rgba"].concat(n.textColor.toArray())),t.push(e)}return t}}class jr{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new jr({name:t,available:!1}):null}serialize(){return["image",this.name]}}function Nr(t,n,e,r){if(!("number"==typeof t&&t>=0&&t<=255&&"number"==typeof n&&n>=0&&n<=255&&"number"==typeof e&&e>=0&&e<=255)){return\`Invalid rgba value [${YL}("number"==typeof r?[t,n,e,r]:[t,n,e]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.\`}return void 0===r||"number"==typeof r&&r>=0&&r<=1?null:\`Invalid rgba value [${YL}[t,n,e,r].join(", ")}]: 'a' must be between 0 and 1.\`}function Lr(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof zr)return!0;if(t instanceof Dr)return!0;if(t instanceof Ur)return!0;if(t instanceof jr)return!0;if(Array.isArray(t)){for(const n of t)if(!Lr(n))return!1;return!0}if("object"==typeof t){for(const n in t)if(!Lr(t[n]))return!1;return!0}return!1}function Hr(t){if(null===t)return hr;if("string"==typeof t)return fr;if("boolean"==typeof t)return dr;if("number"==typeof t)return cr;if(t instanceof zr)return pr;if(t instanceof Dr)return gr;if(t instanceof Ur)return vr;if(t instanceof jr)return br;if(Array.isArray(t)){const n=t.length;let e;for(const n of t){const t=Hr(n);if(e){if(e===t)continue;e=mr;break}e=t}return wr(e||mr,n)}return yr}function Rr(t){const n=typeof t;return null===t?"":"string"===n||"number"===n||"boolean"===n?String(t):t instanceof zr||t instanceof Ur||t instanceof jr?t.toString():JSON.stringify(t)}class Vr{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(2!==t.length)return n.error(\`'literal' expression requires exactly one argument, but found ${YL}t.length-1} instead.\`);if(!Lr(t[1]))return n.error("invalid value");const e=t[1];let r=Hr(e);const i=n.expectedType;return"array"!==r.kind||0!==r.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(r=i),new Vr(r,e)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof zr?["rgba"].concat(this.value.toArray()):this.value instanceof Ur?this.value.serialize():this.value}}var qr=Vr;var Gr=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const Jr={string:fr,number:cr,boolean:dr,object:yr};class Wr{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let e,r=1;const i=t[0];if("array"===i){let i,s;if(t.length>2){const e=t[1];if("string"!=typeof e||!(e in Jr)||"object"===e)return n.error('The item type argument of "array" must be one of string, number, boolean',1);i=Jr[e],r++}else i=mr;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);s=t[2],r++}e=wr(i,s)}else e=Jr[i];const s=[];for(;r<t.length;r++){const e=n.parse(t[r],r,mr);if(!e)return null;s.push(e)}return new Wr(e,s)}evaluate(t){for(let n=0;n<this.args.length;n++){const e=this.args[n].evaluate(t);if(!Fr(this.type,Hr(e)))return e;if(n===this.args.length-1)throw new Gr(\`Expected value to be of type ${YL}Mr(this.type)}, but found ${YL}Mr(Hr(e))} instead.\`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){const t=this.type,n=[t.kind];if("array"===t.kind){const e=t.itemType;if("string"===e.kind||"number"===e.kind||"boolean"===e.kind){n.push(e.kind);const r=t.N;("number"==typeof r||this.args.length>1)&&n.push(r)}}return n.concat(this.args.map((t=>t.serialize())))}}var Br=Wr;class Xr{constructor(t){this.type=vr,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const e=t[1];if(!Array.isArray(e)&&"object"==typeof e)return n.error("First argument must be an image or text section.");const r=[];let i=!1;for(let e=1;e<=t.length-1;++e){const s=t[e];if(i&&"object"==typeof s&&!Array.isArray(s)){i=!1;let t=null;if(s["font-scale"]&&(t=n.parse(s["font-scale"],1,cr),!t))return null;let e=null;if(s["text-font"]&&(e=n.parse(s["text-font"],1,wr(fr)),!e))return null;let o=null;if(s["text-color"]&&(o=n.parse(s["text-color"],1,pr),!o))return null;const a=r[r.length-1];a.scale=t,a.font=e,a.textColor=o}else{const s=n.parse(t[e],1,mr);if(!s)return null;const o=s.type.kind;if("string"!==o&&"value"!==o&&"null"!==o&&"resolvedImage"!==o)return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");i=!0,r.push({content:s,scale:null,font:null,textColor:null})}}return new Xr(r)}evaluate(t){return new Ur(this.sections.map((n=>{const e=n.content.evaluate(t);return Hr(e)===br?new Tr("",e,null,null,null):new Tr(Rr(e),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null)})))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const n of this.sections){t.push(n.content.serialize());const e={};n.scale&&(e["font-scale"]=n.scale.serialize()),n.font&&(e["text-font"]=n.font.serialize()),n.textColor&&(e["text-color"]=n.textColor.serialize()),t.push(e)}return t}}class Yr{constructor(t){this.type=br,this.input=t}static parse(t,n){if(2!==t.length)return n.error("Expected two arguments.");const e=n.parse(t[1],1,fr);return e?new Yr(e):n.error("No image name provided.")}evaluate(t){const n=this.input.evaluate(t),e=jr.fromString(n);return e&&t.availableImages&&(e.available=t.availableImages.indexOf(n)>-1),e}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Kr={"to-boolean":dr,"to-color":pr,"to-number":cr,"to-string":fr};class Zr{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const e=t[0];if(("to-boolean"===e||"to-string"===e)&&2!==t.length)return n.error("Expected one argument.");const r=Kr[e],i=[];for(let e=1;e<t.length;e++){const r=n.parse(t[e],e,mr);if(!r)return null;i.push(r)}return new Zr(r,i)}evaluate(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){let n,e;for(const r of this.args){if(n=r.evaluate(t),e=null,n instanceof zr)return n;if("string"==typeof n){const e=t.parseColor(n);if(e)return e}else if(Array.isArray(n)&&(e=n.length<3||n.length>4?\`Invalid rbga value ${YL}JSON.stringify(n)}: expected an array containing either three or four numeric values.\`:Nr(n[0],n[1],n[2],n[3]),!e))return new zr(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Gr(e||\`Could not parse color from value '${YL}"string"==typeof n?n:String(JSON.stringify(n))}'\`)}if("number"===this.type.kind){let n=null;for(const e of this.args){if(n=e.evaluate(t),null===n)return 0;const r=Number(n);if(!isNaN(r))return r}throw new Gr(\`Could not convert ${YL}JSON.stringify(n)} to number.\`)}return"formatted"===this.type.kind?Ur.fromString(Rr(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?jr.fromString(Rr(this.args[0].evaluate(t))):Rr(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new Xr([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Yr(this.args[0]).serialize();const t=[\`to-${YL}this.type.kind}\`];return this.eachChild((n=>{t.push(n.serialize())})),t}}var Qr=Zr;const ti=["Unknown","Point","LineString","Polygon"];var ni=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this.R={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?ti[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:e,y:r}=this.featureTileCoord,i=e*n-t[0],s=r*n-t[1];return this.featureDistanceData.bearing[0]*i+this.featureDistanceData.bearing[1]*s}return 0}parseColor(t){let n=this.R[t];return n||(n=this.R[t]=zr.parse(t)),n}};class ei{constructor(t,n,e,r){this.name=t,this.type=n,this.V=e,this.args=r}evaluate(t){return this.V(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((t=>t.serialize())))}static parse(t,n){const e=t[0],r=ei.definitions[e];if(!r)return n.error(\`Unknown expression "${YL}e}". If you wanted a literal array, use ["literal", [...]].\`,0);const i=Array.isArray(r)?r[0]:r.type,s=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,o=s.filter((([n])=>!Array.isArray(n)||n.length===t.length-1));let a=null;for(const[r,s]of o){a=new Ci(n.registry,n.path,null,n.scope);const o=[];let u=!1;for(let n=1;n<t.length;n++){const e=t[n],i=Array.isArray(r)?r[n-1]:r.type,s=a.parse(e,1+o.length,i);if(!s){u=!0;break}o.push(s)}if(!u)if(Array.isArray(r)&&r.length!==o.length)a.error(\`Expected ${YL}r.length} arguments, but found ${YL}o.length} instead.\`);else{for(let t=0;t<o.length;t++){const n=Array.isArray(r)?r[t]:r.type,e=o[t];a.concat(t+1).checkSubtype(n,e.type)}if(0===a.errors.length)return new ei(e,i,s,o)}}if(1===o.length)n.errors.push(...a.errors);else{const e=(o.length?o:s).map((([t])=>{return n=t,Array.isArray(n)?\`(${YL}n.map(Mr).join(", ")})\`:\`(${YL}Mr(n.type)}...)\`;var n})).join(" | "),r=[];for(let e=1;e<t.length;e++){const i=n.parse(t[e],1+r.length);if(!i)return null;r.push(Mr(i.type))}n.error(\`Expected arguments of type ${YL}e}, but found (${YL}r.join(", ")}) instead.\`)}return null}static register(t,n){ei.definitions=n;for(const e in n)t[e]=ei}}var ri=ei;class ii{constructor(t,n,e){this.type=gr,this.locale=e,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(2!==t.length)return n.error("Expected one argument.");const e=t[1];if("object"!=typeof e||Array.isArray(e))return n.error("Collator options argument must be an object.");const r=n.parse(void 0!==e["case-sensitive"]&&e["case-sensitive"],1,dr);if(!r)return null;const i=n.parse(void 0!==e["diacritic-sensitive"]&&e["diacritic-sensitive"],1,dr);if(!i)return null;let s=null;return e.locale&&(s=n.parse(e.locale,1,fr),!s)?null:new ii(r,i,s)}evaluate(t){return new Dr(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}const si=8192;function oi(t,n){t[0]=Math.min(t[0],n[0]),t[1]=Math.min(t[1],n[1]),t[2]=Math.max(t[2],n[0]),t[3]=Math.max(t[3],n[1])}function ai(t,n){return!(t[0]<=n[0])&&(!(t[2]>=n[2])&&(!(t[1]<=n[1])&&!(t[3]>=n[3])))}function ui(t,n){const e=(180+t[0])/360;const r=(i=t[1],(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360);var i;const s=Math.pow(2,n.z);return[Math.round(e*s*si),Math.round(r*s*si)]}function li(t,n,e){const r=t[0]-n[0],i=t[1]-n[1],s=t[0]-e[0],o=t[1]-e[1];return r*o-s*i==0&&r*s<=0&&i*o<=0}function hi(t,n){let e=!1;for(let o=0,a=n.length;o<a;o++){const a=n[o];for(let n=0,o=a.length;n<o-1;n++){if(li(t,a[n],a[n+1]))return!1;r=t,i=a[n],s=a[n+1],i[1]>r[1]!=s[1]>r[1]&&r[0]<(s[0]-i[0])*(r[1]-i[1])/(s[1]-i[1])+i[0]&&(e=!e)}}var r,i,s;return e}function ci(t,n){for(let e=0;e<n.length;e++)if(hi(t,n[e]))return!0;return!1}function fi(t,n,e,r){const i=t[0]-e[0],s=t[1]-e[1],o=n[0]-e[0],a=n[1]-e[1],u=r[0]-e[0],l=r[1]-e[1],h=i*l-u*s,c=o*l-u*a;return h>0&&c<0||h<0&&c>0}function di(t,n,e,r){const i=[n[0]-t[0],n[1]-t[1]],s=[r[0]-e[0],r[1]-e[1]];return 0!=(o=s)[0]*(a=i)[1]-o[1]*a[0]&&!(!fi(t,n,e,r)||!fi(e,r,t,n));var o,a}function pi(t,n,e){for(const r of e)for(let e=0;e<r.length-1;++e)if(di(t,n,r[e],r[e+1]))return!0;return!1}function yi(t,n){for(let e=0;e<t.length;++e)if(!hi(t[e],n))return!1;for(let e=0;e<t.length-1;++e)if(pi(t[e],t[e+1],n))return!1;return!0}function mi(t,n){for(let e=0;e<n.length;e++)if(yi(t,n[e]))return!0;return!1}function gi(t,n,e){const r=[];for(let i=0;i<t.length;i++){const s=[];for(let r=0;r<t[i].length;r++){const o=ui(t[i][r],e);oi(n,o),s.push(o)}r.push(s)}return r}function vi(t,n,e){const r=[];for(let i=0;i<t.length;i++){const s=gi(t[i],n,e);r.push(s)}return r}function bi(t,n,e,r){if(t[0]<e[0]||t[0]>e[2]){const n=.5*r;let i=t[0]-e[0]>n?-r:e[0]-t[0]>n?r:0;0===i&&(i=t[0]-e[2]>n?-r:e[2]-t[0]>n?r:0),t[0]+=i}oi(n,t)}function wi(t,n,e,r){const i=Math.pow(2,r.z)*si,s=[r.x*si,r.y*si],o=[];if(!t)return o;for(const r of t)for(const t of r){const r=[t.x+s[0],t.y+s[1]];bi(r,n,e,i),o.push(r)}return o}function Mi(t,n,e,r){const i=Math.pow(2,r.z)*si,s=[r.x*si,r.y*si],o=[];if(!t)return o;for(const e of t){const t=[];for(const r of e){const e=[r.x+s[0],r.y+s[1]];oi(n,e),t.push(e)}o.push(t)}if(n[2]-n[0]<=i/2){!function(t){t[0]=t[1]=1/0,t[2]=t[3]=-1/0}(n);for(const t of o)for(const r of t)bi(r,n,e,i)}return o}class xi{constructor(t,n){this.type=dr,this.geojson=t,this.geometries=n}static parse(t,n){if(2!==t.length)return n.error(\`'within' expression requires exactly one argument, but found ${YL}t.length-1} instead.\`);if(Lr(t[1])){const n=t[1];if("FeatureCollection"===n.type)for(let t=0;t<n.features.length;++t){const e=n.features[t].geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new xi(n,n.features[t].geometry)}else if("Feature"===n.type){const t=n.geometry.type;if("Polygon"===t||"MultiPolygon"===t)return new xi(n,n.geometry)}else if("Polygon"===n.type||"MultiPolygon"===n.type)return new xi(n,n)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,n){const e=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if(!i)return!1;if("Polygon"===n.type){const s=gi(n.coordinates,r,i),o=wi(t.geometry(),e,r,i);if(!ai(e,r))return!1;for(const t of o)if(!hi(t,s))return!1}if("MultiPolygon"===n.type){const s=vi(n.coordinates,r,i),o=wi(t.geometry(),e,r,i);if(!ai(e,r))return!1;for(const t of o)if(!ci(t,s))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,n){const e=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if(!i)return!1;if("Polygon"===n.type){const s=gi(n.coordinates,r,i),o=Mi(t.geometry(),e,r,i);if(!ai(e,r))return!1;for(const t of o)if(!yi(t,s))return!1}if("MultiPolygon"===n.type){const s=vi(n.coordinates,r,i),o=Mi(t.geometry(),e,r,i);if(!ai(e,r))return!1;for(const t of o)if(!mi(t,s))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Fi=xi;function ki(t){if(t instanceof ri){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof Fi)return!1;let n=!0;return t.eachChild((t=>{n&&!ki(t)&&(n=!1)})),n}function Ai(t){if(t instanceof ri&&"feature-state"===t.name)return!1;let n=!0;return t.eachChild((t=>{n&&!Ai(t)&&(n=!1)})),n}function Pi(t,n){if(t instanceof ri&&n.indexOf(t.name)>=0)return!1;let e=!0;return t.eachChild((t=>{e&&!Pi(t,n)&&(e=!1)})),e}class Si{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(2!==t.length||"string"!=typeof t[1])return n.error("'var' expression requires exactly one string literal argument.");const e=t[1];return n.scope.has(e)?new Si(e,n.scope.get(e)):n.error(\`Unknown variable "${YL}e}". Make sure "${YL}e}" has been bound in an enclosing "let" expression before using it.\`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var _i=Si;class Oi{constructor(t,n=[],e,r=new lr,i=[]){this.registry=t,this.path=n,this.key=n.map((t=>\`[${YL}t}]\`)).join(""),this.scope=r,this.errors=i,this.expectedType=e}parse(t,n,e,r,i={}){return n?this.concat(n,e,r).q(t,i):this.q(t,i)}q(t,n){function e(t,n,e){return"assert"===e?new Br(n,[t]):"coerce"===e?new Qr(n,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const r=t[0];if("string"!=typeof r)return this.error(\`Expression name must be a string, but found ${YL}typeof r} instead. If you wanted a literal array, use ["literal", [...]].\`,0),null;const i=this.registry[r];if(i){let r=i.parse(t,this);if(!r)return null;if(this.expectedType){const t=this.expectedType,i=r.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==i.kind)if("color"!==t.kind&&"formatted"!==t.kind&&"resolvedImage"!==t.kind||"value"!==i.kind&&"string"!==i.kind){if(this.checkSubtype(t,i))return null}else r=e(r,t,n.typeAnnotation||"coerce");else r=e(r,t,n.typeAnnotation||"assert")}if(!(r instanceof qr)&&"resolvedImage"!==r.type.kind&&Ei(r)){const t=new ni;try{r=new qr(r.type,r.evaluate(t))}catch(t){return this.error(t.message),null}}return r}return this.error(\`Unknown expression "${YL}r}". If you wanted a literal array, use ["literal", [...]].\`,0)}return void 0===t?this.error("'undefined' value invalid. Use null instead."):"object"==typeof t?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(\`Expected an array, but found ${YL}typeof t} instead.\`)}concat(t,n,e){const r="number"==typeof t?this.path.concat(t):this.path,i=e?this.scope.concat(e):this.scope;return new Oi(this.registry,r,n||null,i,this.errors)}error(t,...n){const e=\`${YL}this.key}${YL}n.map((t=>\`[${YL}t}]\`)).join("")}\`;this.errors.push(new ar(e,t))}checkSubtype(t,n){const e=Fr(t,n);return e&&this.error(e),e}}var Ci=Oi;function Ei(t){if(t instanceof _i)return Ei(t.boundExpression);if(t instanceof ri&&"error"===t.name)return!1;if(t instanceof ii)return!1;if(t instanceof Fi)return!1;const n=t instanceof Qr||t instanceof Br;let e=!0;return t.eachChild((t=>{e=n?e&&Ei(t):e&&t instanceof qr})),!!e&&(ki(t)&&Pi(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"]))}function $i(t,n){const e=t.length-1;let r,i,s=0,o=e,a=0;for(;s<=o;)if(a=Math.floor((s+o)/2),r=t[a],i=t[a+1],r<=n){if(a===e||n<i)return a;s=a+1}else{if(!(r>n))throw new Gr("Input is not a number.");o=a-1}return 0}class Ii{constructor(t,n,e){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[t,n]of e)this.labels.push(t),this.outputs.push(n)}static parse(t,n){if(t.length-1<4)return n.error(\`Expected at least 4 arguments, but found only ${YL}t.length-1}.\`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const e=n.parse(t[1],1,cr);if(!e)return null;const r=[];let i=null;n.expectedType&&"value"!==n.expectedType.kind&&(i=n.expectedType);for(let e=1;e<t.length;e+=2){const s=1===e?-1/0:t[e],o=t[e+1],a=e,u=e+1;if("number"!=typeof s)return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(r.length&&r[r.length-1][0]>=s)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const l=n.parse(o,u,i);if(!l)return null;i=i||l.type,r.push([s,l])}return new Ii(i,e,r)}evaluate(t){const n=this.labels,e=this.outputs;if(1===n.length)return e[0].evaluate(t);const r=this.input.evaluate(t);if(r<=n[0])return e[0].evaluate(t);const i=n.length;if(r>=n[i-1])return e[i-1].evaluate(t);return e[$i(n,r)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}serialize(){const t=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&t.push(this.labels[n]),t.push(this.outputs[n].serialize());return t}}var zi=Ii,Di=Ti;function Ti(t,n,e,r){this.cx=3*t,this.bx=3*(e-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(r-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=e,this.p2y=r}function Ui(t,n,e){return t*(1-e)+n*e}Ti.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,n){if(void 0===n&&(n=1e-6),t<0)return 0;if(t>1)return 1;for(var e=t,r=0;r<8;r++){var i=this.sampleCurveX(e)-t;if(Math.abs(i)<n)return e;var s=this.sampleCurveDerivativeX(e);if(Math.abs(s)<1e-6)break;e-=i/s}var o=0,a=1;for(e=t,r=0;r<20&&(i=this.sampleCurveX(e),!(Math.abs(i-t)<n));r++)t>i?o=e:a=e,e=.5*(a-o)+o;return e},solve:function(t,n){return this.sampleCurveY(this.solveCurveX(t,n))}};var ji=Object.freeze({__proto__:null,number:Ui,color:function(t,n,e){return new zr(Ui(t.r,n.r,e),Ui(t.g,n.g,e),Ui(t.b,n.b,e),Ui(t.a,n.a,e))},array:function(t,n,e){return t.map(((t,r)=>Ui(t,n[r],e)))}});const Ni=.95047,Li=1,Hi=1.08883,Ri=4/29,Vi=6/29,qi=3*Vi*Vi,Gi=Vi*Vi*Vi,Ji=Math.PI/180,Wi=180/Math.PI;function Bi(t){return t>Gi?Math.pow(t,1/3):t/qi+Ri}function Xi(t){return t>Vi?t*t*t:qi*(t-Ri)}function Yi(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Ki(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Zi(t){const n=Ki(t.r),e=Ki(t.g),r=Ki(t.b),i=Bi((.4124564*n+.3575761*e+.1804375*r)/Ni),s=Bi((.2126729*n+.7151522*e+.072175*r)/Li);return{l:116*s-16,a:500*(i-s),b:200*(s-Bi((.0193339*n+.119192*e+.9503041*r)/Hi)),alpha:t.a}}function Qi(t){let n=(t.l+16)/116,e=isNaN(t.a)?n:n+t.a/500,r=isNaN(t.b)?n:n-t.b/200;return n=Li*Xi(n),e=Ni*Xi(e),r=Hi*Xi(r),new zr(Yi(3.2404542*e-1.5371385*n-.4985314*r),Yi(-.969266*e+1.8760108*n+.041556*r),Yi(.0556434*e-.2040259*n+1.0572252*r),t.alpha)}function ts(t,n,e){const r=n-t;return t+e*(r>180||r<-180?r-360*Math.round(r/360):r)}const ns={forward:Zi,reverse:Qi,interpolate:function(t,n,e){return{l:Ui(t.l,n.l,e),a:Ui(t.a,n.a,e),b:Ui(t.b,n.b,e),alpha:Ui(t.alpha,n.alpha,e)}}},es={forward:function(t){const{l:n,a:e,b:r}=Zi(t),i=Math.atan2(r,e)*Wi;return{h:i<0?i+360:i,c:Math.sqrt(e*e+r*r),l:n,alpha:t.a}},reverse:function(t){const n=t.h*Ji,e=t.c;return Qi({l:t.l,a:Math.cos(n)*e,b:Math.sin(n)*e,alpha:t.alpha})},interpolate:function(t,n,e){return{h:ts(t.h,n.h,e),c:Ui(t.c,n.c,e),l:Ui(t.l,n.l,e),alpha:Ui(t.alpha,n.alpha,e)}}};var rs=Object.freeze({__proto__:null,lab:ns,hcl:es});class is{constructor(t,n,e,r,i){this.type=t,this.operator=n,this.interpolation=e,this.input=r,this.labels=[],this.outputs=[];for(const[t,n]of i)this.labels.push(t),this.outputs.push(n)}static interpolationFactor(t,n,e,r){let i=0;if("exponential"===t.name)i=ss(n,t.base,e,r);else if("linear"===t.name)i=ss(n,1,e,r);else if("cubic-bezier"===t.name){const s=t.controlPoints;i=new Di(s[0],s[1],s[2],s[3]).solve(ss(n,1,e,r))}return i}static parse(t,n){let[e,r,i,...s]=t;if(!Array.isArray(r)||0===r.length)return n.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){const t=r[1];if("number"!=typeof t)return n.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:t}}else{if("cubic-bezier"!==r[0])return n.error(\`Unknown interpolation type ${YL}String(r[0])}\`,1,0);{const t=r.slice(1);if(4!==t.length||t.some((t=>"number"!=typeof t||t<0||t>1)))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:t}}}if(t.length-1<4)return n.error(\`Expected at least 4 arguments, but found only ${YL}t.length-1}.\`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(i=n.parse(i,2,cr),!i)return null;const o=[];let a=null;"interpolate-hcl"===e||"interpolate-lab"===e?a=pr:n.expectedType&&"value"!==n.expectedType.kind&&(a=n.expectedType);for(let t=0;t<s.length;t+=2){const e=s[t],r=s[t+1],i=t+3,u=t+4;if("number"!=typeof e)return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',i);if(o.length&&o[o.length-1][0]>=e)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',i);const l=n.parse(r,u,a);if(!l)return null;a=a||l.type,o.push([e,l])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new is(a,e,r,i,o):n.error(\`Type ${YL}Mr(a)} is not interpolatable.\`)}evaluate(t){const n=this.labels,e=this.outputs;if(1===n.length)return e[0].evaluate(t);const r=this.input.evaluate(t);if(r<=n[0])return e[0].evaluate(t);const i=n.length;if(r>=n[i-1])return e[i-1].evaluate(t);const s=$i(n,r),o=n[s],a=n[s+1],u=is.interpolationFactor(this.interpolation,r,o,a),l=e[s].evaluate(t),h=e[s+1].evaluate(t);return"interpolate"===this.operator?ji[this.type.kind.toLowerCase()](l,h,u):"interpolate-hcl"===this.operator?es.reverse(es.interpolate(es.forward(l),es.forward(h),u)):ns.reverse(ns.interpolate(ns.forward(l),ns.forward(h),u))}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,t,this.input.serialize()];for(let t=0;t<this.labels.length;t++)n.push(this.labels[t],this.outputs[t].serialize());return n}}function ss(t,n,e,r){const i=r-e,s=t-e;return 0===i?0:1===n?s/i:(Math.pow(n,s)-1)/(Math.pow(n,i)-1)}var os=is;class as{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expectected at least one argument.");let e=null;const r=n.expectedType;r&&"value"!==r.kind&&(e=r);const i=[];for(const r of t.slice(1)){const t=n.parse(r,1+i.length,e,void 0,{typeAnnotation:"omit"});if(!t)return null;e=e||t.type,i.push(t)}const s=r&&i.some((t=>Fr(r,t.type)));return new as(s?mr:e,i)}evaluate(t){let n,e=null,r=0;for(const i of this.args){if(r++,e=i.evaluate(t),e&&e instanceof jr&&!e.available&&(n||(n=e),e=null,r===this.args.length))return n;if(null!==e)break}return e}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){const t=["coalesce"];return this.eachChild((n=>{t.push(n.serialize())})),t}}var us=as;class ls{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(\`Expected at least 3 arguments, but found ${YL}t.length-1} instead.\`);const e=[];for(let r=1;r<t.length-1;r+=2){const i=t[r];if("string"!=typeof i)return n.error(\`Expected string, but found ${YL}typeof i} instead.\`,r);if(/[^a-zA-Z0-9_]/.test(i))return n.error("Variable names must contain only alphanumeric characters or '_'.",r);const s=n.parse(t[r+1],r+1);if(!s)return null;e.push([i,s])}const r=n.parse(t[t.length-1],t.length-1,n.expectedType,e);return r?new ls(e,r):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[n,e]of this.bindings)t.push(n,e.serialize());return t.push(this.result.serialize()),t}}var hs=ls;class cs{constructor(t,n,e){this.type=t,this.index=n,this.input=e}static parse(t,n){if(3!==t.length)return n.error(\`Expected 2 arguments, but found ${YL}t.length-1} instead.\`);const e=n.parse(t[1],1,cr),r=n.parse(t[2],2,wr(n.expectedType||mr));if(!e||!r)return null;const i=r.type;return new cs(i.itemType,e,r)}evaluate(t){const n=this.index.evaluate(t),e=this.input.evaluate(t);if(n<0)throw new Gr(\`Array index out of bounds: ${YL}n} < 0.\`);if(n>=e.length)throw new Gr(\`Array index out of bounds: ${YL}n} > ${YL}e.length-1}.\`);if(n!==Math.floor(n))throw new Gr(\`Array index must be an integer, but found ${YL}n} instead.\`);return e[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var fs=cs;class ds{constructor(t,n){this.type=dr,this.needle=t,this.haystack=n}static parse(t,n){if(3!==t.length)return n.error(\`Expected 2 arguments, but found ${YL}t.length-1} instead.\`);const e=n.parse(t[1],1,mr),r=n.parse(t[2],2,mr);return e&&r?kr(e.type,[dr,fr,cr,hr,mr])?new ds(e,r):n.error(\`Expected first argument to be of type boolean, string, number or null, but found ${YL}Mr(e.type)} instead\`):null}evaluate(t){const n=this.needle.evaluate(t),e=this.haystack.evaluate(t);if(null==e)return!1;if(!Ar(n,["boolean","string","number","null"]))throw new Gr(\`Expected first argument to be of type boolean, string, number or null, but found ${YL}Mr(Hr(n))} instead.\`);if(!Ar(e,["string","array"]))throw new Gr(\`Expected second argument to be of type array or string, but found ${YL}Mr(Hr(e))} instead.\`);return e.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var ps=ds;class ys{constructor(t,n,e){this.type=cr,this.needle=t,this.haystack=n,this.fromIndex=e}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(\`Expected 3 or 4 arguments, but found ${YL}t.length-1} instead.\`);const e=n.parse(t[1],1,mr),r=n.parse(t[2],2,mr);if(!e||!r)return null;if(!kr(e.type,[dr,fr,cr,hr,mr]))return n.error(\`Expected first argument to be of type boolean, string, number or null, but found ${YL}Mr(e.type)} instead\`);if(4===t.length){const i=n.parse(t[3],3,cr);return i?new ys(e,r,i):null}return new ys(e,r)}evaluate(t){const n=this.needle.evaluate(t),e=this.haystack.evaluate(t);if(!Ar(n,["boolean","string","number","null"]))throw new Gr(\`Expected first argument to be of type boolean, string, number or null, but found ${YL}Mr(Hr(n))} instead.\`);if(!Ar(e,["string","array"]))throw new Gr(\`Expected second argument to be of type array or string, but found ${YL}Mr(Hr(e))} instead.\`);if(this.fromIndex){const r=this.fromIndex.evaluate(t);return e.indexOf(n,r)}return e.indexOf(n)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var ms=ys;class gs{constructor(t,n,e,r,i,s){this.inputType=t,this.type=n,this.input=e,this.cases=r,this.outputs=i,this.otherwise=s}static parse(t,n){if(t.length<5)return n.error(\`Expected at least 4 arguments, but found only ${YL}t.length-1}.\`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let e,r;n.expectedType&&"value"!==n.expectedType.kind&&(r=n.expectedType);const i={},s=[];for(let o=2;o<t.length-1;o+=2){let a=t[o];const u=t[o+1];Array.isArray(a)||(a=[a]);const l=n.concat(o);if(0===a.length)return l.error("Expected at least one branch label.");for(const t of a){if("number"!=typeof t&&"string"!=typeof t)return l.error("Branch labels must be numbers or strings.");if("number"==typeof t&&Math.abs(t)>Number.MAX_SAFE_INTEGER)return l.error(\`Branch labels must be integers no larger than ${YL}Number.MAX_SAFE_INTEGER}.\`);if("number"==typeof t&&Math.floor(t)!==t)return l.error("Numeric branch labels must be integer values.");if(e){if(l.checkSubtype(e,Hr(t)))return null}else e=Hr(t);if(void 0!==i[String(t)])return l.error("Branch labels must be unique.");i[String(t)]=s.length}const h=n.parse(u,o,r);if(!h)return null;r=r||h.type,s.push(h)}const o=n.parse(t[1],1,mr);if(!o)return null;const a=n.parse(t[t.length-1],t.length-1,r);return a?"value"!==o.type.kind&&n.concat(1).checkSubtype(e,o.type)?null:new gs(e,r,o,i,s,a):null}evaluate(t){const n=this.input.evaluate(t);return(Hr(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),e=[],r={};for(const t of n){const n=r[this.cases[t]];void 0===n?(r[this.cases[t]]=e.length,e.push([this.cases[t],[t]])):e[n][1].push(t)}const i=t=>"number"===this.inputType.kind?Number(t):t;for(const[n,r]of e)1===r.length?t.push(i(r[0])):t.push(r.map(i)),t.push(this.outputs[n].serialize());return t.push(this.otherwise.serialize()),t}}var vs=gs;class bs{constructor(t,n,e){this.type=t,this.branches=n,this.otherwise=e}static parse(t,n){if(t.length<4)return n.error(\`Expected at least 3 arguments, but found only ${YL}t.length-1}.\`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let e;n.expectedType&&"value"!==n.expectedType.kind&&(e=n.expectedType);const r=[];for(let i=1;i<t.length-1;i+=2){const s=n.parse(t[i],i,dr);if(!s)return null;const o=n.parse(t[i+1],i+1,e);if(!o)return null;r.push([s,o]),e=e||o.type}const i=n.parse(t[t.length-1],t.length-1,e);return i?new bs(e,r,i):null}evaluate(t){for(const[n,e]of this.branches)if(n.evaluate(t))return e.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,e]of this.branches)t(n),t(e);t(this.otherwise)}outputDefined(){return this.branches.every((([t,n])=>n.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild((n=>{t.push(n.serialize())})),t}}var ws=bs;class Ms{constructor(t,n,e,r){this.type=t,this.input=n,this.beginIndex=e,this.endIndex=r}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(\`Expected 3 or 4 arguments, but found ${YL}t.length-1} instead.\`);const e=n.parse(t[1],1,mr),r=n.parse(t[2],2,cr);if(!e||!r)return null;if(!kr(e.type,[wr(mr),fr,mr]))return n.error(\`Expected first argument to be of type array or string, but found ${YL}Mr(e.type)} instead\`);if(4===t.length){const i=n.parse(t[3],3,cr);return i?new Ms(e.type,e,r,i):null}return new Ms(e.type,e,r)}evaluate(t){const n=this.input.evaluate(t),e=this.beginIndex.evaluate(t);if(!Ar(n,["string","array"]))throw new Gr(\`Expected first argument to be of type array or string, but found ${YL}Mr(Hr(n))} instead.\`);if(this.endIndex){const r=this.endIndex.evaluate(t);return n.slice(e,r)}return n.slice(e)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var xs=Ms;function Fs(t,n){return"=="===t||"!="===t?"boolean"===n.kind||"string"===n.kind||"number"===n.kind||"null"===n.kind||"value"===n.kind:"string"===n.kind||"number"===n.kind||"value"===n.kind}function ks(t,n,e,r){return 0===r.compare(n,e)}function As(t,n,e){const r="=="!==t&&"!="!==t;return class i{constructor(t,n,e){this.type=dr,this.lhs=t,this.rhs=n,this.collator=e,this.hasUntypedArgument="value"===t.type.kind||"value"===n.type.kind}static parse(t,n){if(3!==t.length&&4!==t.length)return n.error("Expected two or three arguments.");const e=t[0];let s=n.parse(t[1],1,mr);if(!s)return null;if(!Fs(e,s.type))return n.concat(1).error(\`"${YL}e}" comparisons are not supported for type '${YL}Mr(s.type)}'.\`);let o=n.parse(t[2],2,mr);if(!o)return null;if(!Fs(e,o.type))return n.concat(2).error(\`"${YL}e}" comparisons are not supported for type '${YL}Mr(o.type)}'.\`);if(s.type.kind!==o.type.kind&&"value"!==s.type.kind&&"value"!==o.type.kind)return n.error(\`Cannot compare types '${YL}Mr(s.type)}' and '${YL}Mr(o.type)}'.\`);r&&("value"===s.type.kind&&"value"!==o.type.kind?s=new Br(o.type,[s]):"value"!==s.type.kind&&"value"===o.type.kind&&(o=new Br(s.type,[o])));let a=null;if(4===t.length){if("string"!==s.type.kind&&"string"!==o.type.kind&&"value"!==s.type.kind&&"value"!==o.type.kind)return n.error("Cannot use collator to compare non-string types.");if(a=n.parse(t[3],3,gr),!a)return null}return new i(s,o,a)}evaluate(i){const s=this.lhs.evaluate(i),o=this.rhs.evaluate(i);if(r&&this.hasUntypedArgument){const n=Hr(s),e=Hr(o);if(n.kind!==e.kind||"string"!==n.kind&&"number"!==n.kind)throw new Gr(\`Expected arguments for "${YL}t}" to be (string, string) or (number, number), but found (${YL}n.kind}, ${YL}e.kind}) instead.\`)}if(this.collator&&!r&&this.hasUntypedArgument){const t=Hr(s),e=Hr(o);if("string"!==t.kind||"string"!==e.kind)return n(i,s,o)}return this.collator?e(i,s,o,this.collator.evaluate(i)):n(i,s,o)}eachChild(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)}outputDefined(){return!0}serialize(){const n=[t];return this.eachChild((t=>{n.push(t.serialize())})),n}}}const Ps=As("==",(function(t,n,e){return n===e}),ks),Ss=As("!=",(function(t,n,e){return n!==e}),(function(t,n,e,r){return!ks(0,n,e,r)})),_s=As("<",(function(t,n,e){return n<e}),(function(t,n,e,r){return r.compare(n,e)<0})),Os=As(">",(function(t,n,e){return n>e}),(function(t,n,e,r){return r.compare(n,e)>0})),Cs=As("<=",(function(t,n,e){return n<=e}),(function(t,n,e,r){return r.compare(n,e)<=0})),Es=As(">=",(function(t,n,e){return n>=e}),(function(t,n,e,r){return r.compare(n,e)>=0}));class $s{constructor(t,n,e,r,i,s){this.type=fr,this.number=t,this.locale=n,this.currency=e,this.unit=r,this.minFractionDigits=i,this.maxFractionDigits=s}static parse(t,n){if(3!==t.length)return n.error("Expected two arguments.");const e=n.parse(t[1],1,cr);if(!e)return null;const r=t[2];if("object"!=typeof r||Array.isArray(r))return n.error("NumberFormat options argument must be an object.");let i=null;if(r.locale&&(i=n.parse(r.locale,1,fr),!i))return null;let s=null;if(r.currency&&(s=n.parse(r.currency,1,fr),!s))return null;let o=null;if(r.unit&&(o=n.parse(r.unit,1,fr),!o))return null;let a=null;if(r["min-fraction-digits"]&&(a=n.parse(r["min-fraction-digits"],1,cr),!a))return null;let u=null;return r["max-fraction-digits"]&&(u=n.parse(r["max-fraction-digits"],1,cr),!u)?null:new $s(e,i,s,o,a,u)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class Is{constructor(t){this.type=cr,this.input=t}static parse(t,n){if(2!==t.length)return n.error(\`Expected 1 argument, but found ${YL}t.length-1} instead.\`);const e=n.parse(t[1],1);return e?"array"!==e.type.kind&&"string"!==e.type.kind&&"value"!==e.type.kind?n.error(\`Expected argument of type string or array, but found ${YL}Mr(e.type)} instead.\`):new Is(e):null}evaluate(t){const n=this.input.evaluate(t);if("string"==typeof n)return n.length;if(Array.isArray(n))return n.length;throw new Gr(\`Expected value to be of type string or array, but found ${YL}Mr(Hr(n))} instead.\`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild((n=>{t.push(n.serialize())})),t}}const zs={"==":Ps,"!=":Ss,">":Os,"<":_s,">=":Es,"<=":Cs,array:Br,at:fs,boolean:Br,case:ws,coalesce:us,collator:ii,format:Xr,image:Yr,in:ps,"index-of":ms,interpolate:os,"interpolate-hcl":os,"interpolate-lab":os,length:Is,let:hs,literal:qr,match:vs,number:Br,"number-format":$s,object:Br,slice:xs,step:zi,string:Br,"to-boolean":Qr,"to-color":Qr,"to-number":Qr,"to-string":Qr,var:_i,within:Fi};function Ds(t,[n,e,r,i]){n=n.evaluate(t),e=e.evaluate(t),r=r.evaluate(t);const s=i?i.evaluate(t):1,o=Nr(n,e,r,s);if(o)throw new Gr(o);return new zr(n/255*s,e/255*s,r/255*s,s)}function Ts(t,n){return t in n}function Us(t,n){const e=n[t];return void 0===e?null:e}function js(t){return{type:t}}ri.register(zs,{error:[{kind:"error"},[fr],(t,[n])=>{throw new Gr(n.evaluate(t))}],typeof:[fr,[mr],(t,[n])=>Mr(Hr(n.evaluate(t)))],"to-rgba":[wr(cr,4),[pr],(t,[n])=>n.evaluate(t).toArray()],rgb:[pr,[cr,cr,cr],Ds],rgba:[pr,[cr,cr,cr,cr],Ds],has:{type:dr,overloads:[[[fr],(t,[n])=>Ts(n.evaluate(t),t.properties())],[[fr,yr],(t,[n,e])=>Ts(n.evaluate(t),e.evaluate(t))]]},get:{type:mr,overloads:[[[fr],(t,[n])=>Us(n.evaluate(t),t.properties())],[[fr,yr],(t,[n,e])=>Us(n.evaluate(t),e.evaluate(t))]]},"feature-state":[mr,[fr],(t,[n])=>Us(n.evaluate(t),t.featureState||{})],properties:[yr,[],t=>t.properties()],"geometry-type":[fr,[],t=>t.geometryType()],id:[mr,[],t=>t.id()],zoom:[cr,[],t=>t.globals.zoom],pitch:[cr,[],t=>t.globals.pitch||0],"distance-from-center":[cr,[],t=>t.distanceFromCenter()],"heatmap-density":[cr,[],t=>t.globals.heatmapDensity||0],"line-progress":[cr,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[cr,[],t=>t.globals.skyRadialProgress||0],accumulated:[mr,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[cr,js(cr),(t,n)=>{let e=0;for(const r of n)e+=r.evaluate(t);return e}],"*":[cr,js(cr),(t,n)=>{let e=1;for(const r of n)e*=r.evaluate(t);return e}],"-":{type:cr,overloads:[[[cr,cr],(t,[n,e])=>n.evaluate(t)-e.evaluate(t)],[[cr],(t,[n])=>-n.evaluate(t)]]},"/":[cr,[cr,cr],(t,[n,e])=>n.evaluate(t)/e.evaluate(t)],"%":[cr,[cr,cr],(t,[n,e])=>n.evaluate(t)%e.evaluate(t)],ln2:[cr,[],()=>Math.LN2],pi:[cr,[],()=>Math.PI],e:[cr,[],()=>Math.E],"^":[cr,[cr,cr],(t,[n,e])=>Math.pow(n.evaluate(t),e.evaluate(t))],sqrt:[cr,[cr],(t,[n])=>Math.sqrt(n.evaluate(t))],log10:[cr,[cr],(t,[n])=>Math.log(n.evaluate(t))/Math.LN10],ln:[cr,[cr],(t,[n])=>Math.log(n.evaluate(t))],log2:[cr,[cr],(t,[n])=>Math.log(n.evaluate(t))/Math.LN2],sin:[cr,[cr],(t,[n])=>Math.sin(n.evaluate(t))],cos:[cr,[cr],(t,[n])=>Math.cos(n.evaluate(t))],tan:[cr,[cr],(t,[n])=>Math.tan(n.evaluate(t))],asin:[cr,[cr],(t,[n])=>Math.asin(n.evaluate(t))],acos:[cr,[cr],(t,[n])=>Math.acos(n.evaluate(t))],atan:[cr,[cr],(t,[n])=>Math.atan(n.evaluate(t))],min:[cr,js(cr),(t,n)=>Math.min(...n.map((n=>n.evaluate(t))))],max:[cr,js(cr),(t,n)=>Math.max(...n.map((n=>n.evaluate(t))))],abs:[cr,[cr],(t,[n])=>Math.abs(n.evaluate(t))],round:[cr,[cr],(t,[n])=>{const e=n.evaluate(t);return e<0?-Math.round(-e):Math.round(e)}],floor:[cr,[cr],(t,[n])=>Math.floor(n.evaluate(t))],ceil:[cr,[cr],(t,[n])=>Math.ceil(n.evaluate(t))],"filter-==":[dr,[fr,mr],(t,[n,e])=>t.properties()[n.value]===e.value],"filter-id-==":[dr,[mr],(t,[n])=>t.id()===n.value],"filter-type-==":[dr,[fr],(t,[n])=>t.geometryType()===n.value],"filter-<":[dr,[fr,mr],(t,[n,e])=>{const r=t.properties()[n.value],i=e.value;return typeof r==typeof i&&r<i}],"filter-id-<":[dr,[mr],(t,[n])=>{const e=t.id(),r=n.value;return typeof e==typeof r&&e<r}],"filter->":[dr,[fr,mr],(t,[n,e])=>{const r=t.properties()[n.value],i=e.value;return typeof r==typeof i&&r>i}],"filter-id->":[dr,[mr],(t,[n])=>{const e=t.id(),r=n.value;return typeof e==typeof r&&e>r}],"filter-<=":[dr,[fr,mr],(t,[n,e])=>{const r=t.properties()[n.value],i=e.value;return typeof r==typeof i&&r<=i}],"filter-id-<=":[dr,[mr],(t,[n])=>{const e=t.id(),r=n.value;return typeof e==typeof r&&e<=r}],"filter->=":[dr,[fr,mr],(t,[n,e])=>{const r=t.properties()[n.value],i=e.value;return typeof r==typeof i&&r>=i}],"filter-id->=":[dr,[mr],(t,[n])=>{const e=t.id(),r=n.value;return typeof e==typeof r&&e>=r}],"filter-has":[dr,[mr],(t,[n])=>n.value in t.properties()],"filter-has-id":[dr,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[dr,[wr(fr)],(t,[n])=>n.value.indexOf(t.geometryType())>=0],"filter-id-in":[dr,[wr(mr)],(t,[n])=>n.value.indexOf(t.id())>=0],"filter-in-small":[dr,[fr,wr(mr)],(t,[n,e])=>e.value.indexOf(t.properties()[n.value])>=0],"filter-in-large":[dr,[fr,wr(mr)],(t,[n,e])=>function(t,n,e,r){for(;e<=r;){const i=e+r>>1;if(n[i]===t)return!0;n[i]>t?r=i-1:e=i+1}return!1}(t.properties()[n.value],e.value,0,e.value.length-1)],all:{type:dr,overloads:[[[dr,dr],(t,[n,e])=>n.evaluate(t)&&e.evaluate(t)],[js(dr),(t,n)=>{for(const e of n)if(!e.evaluate(t))return!1;return!0}]]},any:{type:dr,overloads:[[[dr,dr],(t,[n,e])=>n.evaluate(t)||e.evaluate(t)],[js(dr),(t,n)=>{for(const e of n)if(e.evaluate(t))return!0;return!1}]]},"!":[dr,[dr],(t,[n])=>!n.evaluate(t)],"is-supported-script":[dr,[fr],(t,[n])=>{const e=t.globals&&t.globals.isSupportedScript;return!e||e(n.evaluate(t))}],upcase:[fr,[fr],(t,[n])=>n.evaluate(t).toUpperCase()],downcase:[fr,[fr],(t,[n])=>n.evaluate(t).toLowerCase()],concat:[fr,js(mr),(t,n)=>n.map((n=>Rr(n.evaluate(t)))).join("")],"resolved-locale":[fr,[gr],(t,[n])=>n.evaluate(t).resolvedLocale()]});var Ns=zs;function Ls(t){return{result:"success",value:t}}function Hs(t){return{result:"error",value:t}}function Rs(t){return!!t.expression&&t.expression.interpolated}function Vs(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function qs(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function Gs(t){return t}function Js(t,n){const e="color"===n.type,r=t.stops&&"object"==typeof t.stops[0][0],i=r||void 0!==t.property,s=r||!i,o=t.type||(Rs(n)?"exponential":"interval");if(e&&((t=sr({},t)).stops&&(t.stops=t.stops.map((t=>[t[0],zr.parse(t[1])]))),t.default?t.default=zr.parse(t.default):t.default=zr.parse(n.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!rs[t.colorSpace])throw new Error(\`Unknown color space: ${YL}t.colorSpace}\`);let a,u,l;if("exponential"===o)a=Ys;else if("interval"===o)a=Xs;else if("categorical"===o){a=Bs,u=Object.create(null);for(const n of t.stops)u[n[0]]=n[1];l=typeof t.stops[0][0]}else{if("identity"!==o)throw new Error(\`Unknown function type "${YL}o}"\`);a=Ks}if(r){const e={},r=[];for(let n=0;n<t.stops.length;n++){const i=t.stops[n],s=i[0].zoom;void 0===e[s]&&(e[s]={zoom:s,type:t.type,property:t.property,default:t.default,stops:[]},r.push(s)),e[s].stops.push([i[0].value,i[1]])}const i=[];for(const t of r)i.push([e[t].zoom,Js(e[t],n)]);const s={name:"linear"};return{kind:"composite",interpolationType:s,interpolationFactor:os.interpolationFactor.bind(void 0,s),zoomStops:i.map((t=>t[0])),evaluate:({zoom:e},r)=>Ys({stops:i,base:t.base},n,e).evaluate(e,r)}}if(s){const e="exponential"===o?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:e,interpolationFactor:os.interpolationFactor.bind(void 0,e),zoomStops:t.stops.map((t=>t[0])),evaluate:({zoom:e})=>a(t,n,e,u,l)}}return{kind:"source",evaluate(e,r){const i=r&&r.properties?r.properties[t.property]:void 0;return void 0===i?Ws(t.default,n.default):a(t,n,i,u,l)}}}function Ws(t,n,e){return void 0!==t?t:void 0!==n?n:void 0!==e?e:void 0}function Bs(t,n,e,r,i){return Ws(typeof e===i?r[e]:void 0,t.default,n.default)}function Xs(t,n,e){if("number"!==Vs(e))return Ws(t.default,n.default);const r=t.stops.length;if(1===r)return t.stops[0][1];if(e<=t.stops[0][0])return t.stops[0][1];if(e>=t.stops[r-1][0])return t.stops[r-1][1];const i=$i(t.stops.map((t=>t[0])),e);return t.stops[i][1]}function Ys(t,n,e){const r=void 0!==t.base?t.base:1;if("number"!==Vs(e))return Ws(t.default,n.default);const i=t.stops.length;if(1===i)return t.stops[0][1];if(e<=t.stops[0][0])return t.stops[0][1];if(e>=t.stops[i-1][0])return t.stops[i-1][1];const s=$i(t.stops.map((t=>t[0])),e),o=function(t,n,e,r){const i=r-e,s=t-e;return 0===i?0:1===n?s/i:(Math.pow(n,s)-1)/(Math.pow(n,i)-1)}(e,r,t.stops[s][0],t.stops[s+1][0]),a=t.stops[s][1],u=t.stops[s+1][1];let l=ji[n.type]||Gs;if(t.colorSpace&&"rgb"!==t.colorSpace){const n=rs[t.colorSpace];l=(t,e)=>n.reverse(n.interpolate(n.forward(t),n.forward(e),o))}return"function"==typeof a.evaluate?{evaluate(...t){const n=a.evaluate.apply(void 0,t),e=u.evaluate.apply(void 0,t);if(void 0!==n&&void 0!==e)return l(n,e,o)}}:l(a,u,o)}function Ks(t,n,e){return"color"===n.type?e=zr.parse(e):"formatted"===n.type?e=Ur.fromString(e.toString()):"resolvedImage"===n.type?e=jr.fromString(e.toString()):Vs(e)===n.type||"enum"===n.type&&n.values[e]||(e=void 0),Ws(e,t.default,n.default)}class Zs{constructor(t,n){this.expression=t,this.G={},this.J=new ni,this.W=n?function(t){return"color"===t.type&&(qs(t.default)||Array.isArray(t.default))?new zr(0,0,0,0):"color"===t.type?zr.parse(t.default)||null:void 0===t.default?null:t.default}(n):null,this.B=n&&"enum"===n.type?n.values:null}evaluateWithoutErrorHandling(t,n,e,r,i,s,o,a){return this.J.globals=t,this.J.feature=n,this.J.featureState=e,this.J.canonical=r||null,this.J.availableImages=i||null,this.J.formattedSection=s,this.J.featureTileCoord=o||null,this.J.featureDistanceData=a||null,this.expression.evaluate(this.J)}evaluate(t,n,e,r,i,s,o,a){this.J.globals=t,this.J.feature=n||null,this.J.featureState=e||null,this.J.canonical=r||null,this.J.availableImages=i||null,this.J.formattedSection=s||null,this.J.featureTileCoord=o||null,this.J.featureDistanceData=a||null;try{const t=this.expression.evaluate(this.J);if(null==t||"number"==typeof t&&t!=t)return this.W;if(this.B&&!(t in this.B))throw new Gr(\`Expected value to be one of ${YL}Object.keys(this.B).map((t=>JSON.stringify(t))).join(", ")}, but found ${YL}JSON.stringify(t)} instead.\`);return t}catch(t){return this.G[t.message]||(this.G[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this.W}}}function Qs(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Ns}function to(t,n){const e=new Ci(Ns,[],n?function(t){const n={color:pr,string:fr,number:cr,enum:fr,boolean:dr,formatted:vr,resolvedImage:br};if("array"===t.type)return wr(n[t.value]||mr,t.length);return n[t.type]}(n):void 0),r=e.parse(t,void 0,void 0,void 0,n&&"string"===n.type?{typeAnnotation:"coerce"}:void 0);return r?Ls(new Zs(r,n)):Hs(e.errors)}class no{constructor(t,n){this.kind=t,this.X=n,this.isStateDependent="constant"!==t&&!Ai(n.expression)}evaluateWithoutErrorHandling(t,n,e,r,i,s){return this.X.evaluateWithoutErrorHandling(t,n,e,r,i,s)}evaluate(t,n,e,r,i,s){return this.X.evaluate(t,n,e,r,i,s)}}class eo{constructor(t,n,e,r){this.kind=t,this.zoomStops=e,this.X=n,this.isStateDependent="camera"!==t&&!Ai(n.expression),this.interpolationType=r}evaluateWithoutErrorHandling(t,n,e,r,i,s){return this.X.evaluateWithoutErrorHandling(t,n,e,r,i,s)}evaluate(t,n,e,r,i,s){return this.X.evaluate(t,n,e,r,i,s)}interpolationFactor(t,n,e){return this.interpolationType?os.interpolationFactor(this.interpolationType,t,n,e):0}}function ro(t,n){if("error"===(t=to(t,n)).result)return t;const e=t.value.expression,r=ki(e);if(!r&&!function(t){return"data-driven"===t["property-type"]}(n))return Hs([new ar("","data expressions not supported")]);const i=Pi(e,["zoom","pitch","distance-from-center"]);if(!i&&!function(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}(n))return Hs([new ar("","zoom expressions not supported")]);const s=so(e);if(!s&&!i)return Hs([new ar("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(s instanceof ar)return Hs([s]);if(s instanceof os&&!Rs(n))return Hs([new ar("",'"interpolate" expressions cannot be used with this property')]);if(!s)return Ls(new no(r?"constant":"source",t.value));const o=s instanceof os?s.interpolation:void 0;return Ls(new eo(r?"camera":"composite",t.value,s.labels,o))}class io{constructor(t,n){this.Y=t,this.K=n,sr(this,Js(this.Y,this.K))}static deserialize(t){return new io(t.Y,t.K)}static serialize(t){return{Y:t.Y,K:t.K}}}function so(t){let n=null;if(t instanceof hs)n=so(t.result);else if(t instanceof us){for(const e of t.args)if(n=so(e),n)break}else(t instanceof zi||t instanceof os)&&t.input instanceof ri&&"zoom"===t.input.name&&(n=t);return n instanceof ar||t.eachChild((t=>{const e=so(t);e instanceof ar?n=e:!n&&e?n=new ar("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&e&&n!==e&&(n=new ar("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),n}function oo(t){if(Array.isArray(t))return t.map(oo);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const n={};for(const e in t)n[e]=oo(t[e]);return n}return function(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}(t)}function ao(t,n="fill"){if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};const e=t;let r=!0;try{r=function(t){if(!ho(t))return t;let n=oo(t);return lo(n),n=uo(n),n}(e)}catch(t){console.warn(\`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\\nand paste the contents of this message in the report.\\nThank you!\\nFilter Expression:\\n${YL}JSON.stringify(e,null,2)}\\n        \`)}const i=to(r,null);let s=null;if("error"===i.result)throw new Error(i.value.map((t=>\`${YL}t.key}: ${YL}t.message}\`)).join(", "));s=(t,n,e)=>i.value.evaluate(t,n,{},e);let o=null,a=null;if(r!==e){const t=to(e,null);if("error"===t.result)throw new Error(t.value.map((t=>\`${YL}t.key}: ${YL}t.message}\`)).join(", "));o=(n,e,r,i,s)=>t.value.evaluate(n,e,{},r,void 0,void 0,i,s),a=!ki(t.value.expression)}return{filter:s,dynamicFilter:o||void 0,needGeometry:fo(r),needFeature:!!a}}function uo(t){if(!Array.isArray(t))return t;const n=function(t){if(co.has(t[0]))for(let n=1;n<t.length;n++){if(ho(t[n]))return!0}return t}(t);return!0===n?n:n.map((t=>uo(t)))}function lo(t){let n=!1;const e=[];if("case"===t[0]){for(let r=1;r<t.length-1;r+=2)n=n||ho(t[r]),e.push(t[r+1]);e.push(t[t.length-1])}else if("match"===t[0]){n=n||ho(t[1]);for(let n=2;n<t.length-1;n+=2)e.push(t[n+1]);e.push(t[t.length-1])}else if("step"===t[0]){n=n||ho(t[1]);for(let n=1;n<t.length-1;n+=2)e.push(t[n+1])}n&&(t.length=0,t.push("any",...e));for(let n=1;n<t.length;n++)lo(t[n])}function ho(t){if(!Array.isArray(t))return!1;if(function(t){return"pitch"===t||"distance-from-center"===t}(t[0]))return!0;for(let n=1;n<t.length;n++){if(ho(t[n]))return!0}return!1}const co=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function fo(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(let n=1;n<t.length;n++)if(fo(t[n]))return!0;return!1}const po={StyleExpression:Zs,isExpression:Qs,isExpressionFilter:function t(n){if(!0===n||!1===n)return!0;if(!Array.isArray(n)||0===n.length)return!1;switch(n[0]){case"has":return n.length>=2&&"$id"!==n[1]&&"$type"!==n[1];case"in":return n.length>=3&&("string"!=typeof n[1]||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==n.length||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!t(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}},createExpression:to,createPropertyExpression:ro,normalizePropertyExpression:function(t,n){if(qs(t))return new io(t,n);if(Qs(t)){const e=ro(t,n);if("error"===e.result)throw new Error(e.value.map((t=>\`${YL}t.key}: ${YL}t.message}\`)).join(", "));return e.value}{let e=t;return"string"==typeof t&&"color"===n.type&&(e=zr.parse(t)),{kind:"constant",evaluate:()=>e}}},ZoomConstantExpression:no,ZoomDependentExpression:eo,StylePropertyFunction:io},{isExpression:yo,createExpression:mo}=po;function go(t=[]){return bo(t=t.map((t=>{const n=$e({},t);return n.filter&&n.filter.value&&(n.filter=n.filter.value),n})))}const vo={};function bo(t){if(!Array.isArray(t))return bo([t]);const n=[];for(let e=0;e<t.length;e++){let r;r=!0===t[e].filter?function(){return!0}:wo(t[e].filter),n.push($e({},t[e],{filter:r}))}return n}function wo(t){if(!0===t)return function(){return!0};if(t&&t.condition){if("any"===t.type){const n=t.condition,e=[];for(let t=0;t<n.length;t++)e.push(wo(n[t]));return(t,n)=>{for(let r=0;r<e.length;r++)if(e[r](t,n))return!0;return!1}}const n=wo(t.condition);if(Ie(t.layer))return n;const e=n=>n.layer===t.layer;return(t,r)=>e(t)&&n(t,r)}if(We(t))return Je(t);{let n=ao(t);n=n&&n.filter;const e=(t,e)=>(vo.zoom=e,n&&n(vo,t));return e}}const Mo={type:"number","property-type":"data-driven",expression:{parameters:["zoom","feature"]}};function xo(t,n){Mo.type=n||"number";const e=mo(t,Mo);if("success"!==e.result)throw new Error(\`Invalid maplibre spec expression: ${YL}JSON.stringify(t)} (${YL}e.value})\`);return e.value}function Fo(t){return yo(t)}const ko={lineWidth:1,lineStrokeWidth:1,lineDx:1,lineDy:1,lineOpacity:1,linePatternAnimSpeed:1,markerWidth:1,markerHeight:1,markerDx:1,markerDy:1,markerSpacing:1,markerOpacity:1,markerRotation:1,textWrapWidth:1,textSpacing:1,textSize:1,textHaloRadius:1,textHaloOpacity:1,textDx:1,textDy:1,textOpacity:1,textRotation:1,polygonOpacity:1};function Ao(t){return ko[t]}const Po={markerPlacement:1,markerFile:1,mergeOnProperty:1,markerTextFit:1,markerType:1,markerHorizontalAlignment:1,markerVerticalAlignment:1,markerRotationAlignment:1,markerPitchAlignment:1,markerFillPatternFile:1,markerLinePatternFile:1,textName:1,textPlacement:1,textFaceName:1,textStyle:1,textHorizontalAlignment:1,textVerticalAlignment:1,textRotationAlignment:1,textPitchAlignment:1,lineJoin:1,lineCap:1,linePatternFile:1,polygonPatternFile:1},So={lineDasharray:1,markerLineDasharray:1,uvScale:1,uvOffset:1};function _o(t){return Po[t]?"string":Ao(t)?"number":So[t]?"array":"color"}const Oo="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,Co=function(t){return class extends t{pushIn(...t){const n=t.length;for(let e=0;e<n;e++)this[this.currentIndex++]=t[e]}fill(t,n,e){super.fill(t,n,e),e>this.currentIndex&&(this.currentIndex=e)}set(t,n){t>=this.currentIndex&&(this.currentIndex=t+1),this[t]=n}getLength(){return this.currentIndex}setLength(t){this.currentIndex=t,super.length<t&&(super.length=t)}trySetLength(t){t>this.currentIndex&&this.setLength(t)}reset(){this.currentIndex=0}slice(t,n){const e=super.slice(t,n);return e.currentIndex=n-t,e}}},Eo=Co(Array),$o={get:function(t,n){return"length"===n?t.getLength():t[n]}};class Io extends Array{setLength(t){this.length=t,this.currentIndex=t}trySetLength(t){this.length=t,this.currentIndex=t}getLength(){return this.length}}let zo;class Do{static createTypedArray(t,n){return Hn(t,n)}static getInstance(){return zo}static ensureCapacity(t,n){if(!t.BYTES_PER_ELEMENT)return t;if(t.length>=n)return t;const e=new t.constructor(n+Math.ceil(.5*n)),r=t.getLength();for(let n=0;n<r;n++)e[n]=t[n];return e.currentIndex=t.currentIndex,e}static getArray(t){let n;if(t){const e=Co(t),r=1048576/e.BYTES_PER_ELEMENT;n=new e(r)}else n=new Eo;return n.push=(...t)=>{n.pushIn(...t)},n}static getProxyArray(){const t=new Eo,n=new Proxy(t,$o);return n.push=(...n)=>{t.pushIn(...n)},n.L=t,n}constructor(){this.Z=[],this.tt=0,this.nt=[],this.et=0,this.rt={}}getProxy(){if(!Oo){const t=new Io;return t.currentIndex=0,t}const t=this.nt[this.et]=this.nt[this.et]||Do.getProxyArray();return t.reset(),this.et++,t}get(t){if(!Oo){const t=new Io;return t.currentIndex=0,t}if(t){const n=t.name;let e=this.rt[n];e||(e=this.rt[n]={arrays:[],index:0});const r=e.index,i=e.arrays[r]=e.arrays[r]||Do.getArray(t);return i.reset(),e.index++,i}const n=this.Z[this.tt]=this.Z[this.tt]||Do.getArray();return n.reset(),this.tt++,n}reset(){this.tt=0,this.et=0;for(const t in this.rt)this.rt[t].index=0}}zo=new Do;const To="__fea_idx",Uo=[],jo={},No={},Lo={},Ho=[],Ro=Do.getInstance();let Vo=!1;const qo=Math.pow(2,17);class Go{static isAtlasLoaded(t,n={}){const{iconAtlas:e}=n;return!!(!t||e&&e.positions[t])}static genFnTypes(t){const n={};for(const e in t)if(Fo(t[e])){const r=(e+"_Fn_0").trim(),i=(e+"Fn").trim(),s=_o(e);n[r]=xo(t[e],s),n[i]=(t,e)=>{let i;jo.zoom=t,No.properties=e;try{i=n[r].evaluateWithoutErrorHandling(jo,No,Lo,null,Ho)}catch(t){return null}return i}}else if(Ne(t[e])){const r=(e+"_Fn_0").trim(),i=(e+"Fn").trim();Ao(e)?(n[r]=v(t[e]),n[i]=(t,e)=>{const i=n[r](t,e);return Ne(i)?v(i)(t,e):i}):(n[r]=b(t[e]),n[i]=(t,e)=>{const i=n[r](t,e);return Ne(i)?b(i)(t,e):i})}return n}constructor(t,n,e){this.options=e;const r=[];this.symbolDef=n,this.symbol=w(n,(()=>(r[0]=e.zoom,r))),this.styledVectors=[],this.properties={},this.it=e.fnTypes||Go.genFnTypes(this.symbolDef),Ne(this.symbolDef.visible)&&(this.st=v(this.symbolDef.visible)),e.atlas&&(this.iconAtlas=e.atlas.iconAtlas,this.glyphAtlas=e.atlas.glyphAtlas),this.features=this.ot(t)}needAltitudeAttribute(){return this.options.forceAltitudeAttribute||this.maxPosZ>=qo||this.options.positionType===Float32Array}getPositionFormat(){return this.needAltitudeAttribute()?[{type:Int16Array,width:2,name:"aPosition"},{type:Float32Array,width:1,name:"aAltitude"}]:[{type:Float32Array,width:3,name:"aPosition"}]}fillPosition(t,n,e,r){if(n<this.ut&&(this.ut=n),n>this.lt&&(this.lt=n),e<this.ht&&(this.ht=e),e>this.ct&&(this.ct=e),this.needAltitudeAttribute()){let i=t.aPosition.currentIndex;t.aPosition[i++]=n,t.aPosition[i++]=e,t.aPosition.currentIndex=i,i=t.aAltitude.currentIndex,t.aAltitude[i++]=r,t.aAltitude.currentIndex=i}else{!function(t,n,e,r){const i=Math.abs(r)>>15,s=i>>1,o=i%2;let a=r%Math.pow(2,15);const u=n+(s<<14)*Math.sign(n),l=e+(o<<14)*Math.sign(e);t[0]=u,t[1]=l,a=Math.round(a),t[2]=0===a?r<0?-1:0:a}(Uo,n,e,r);let i=t.aPosition.currentIndex;t.aPosition[i++]=Uo[0],t.aPosition[i++]=Uo[1],t.aPosition[i++]=Uo[2],t.aPosition.currentIndex=i}}ot(t){if(!t.length)return t;const n=(To+"").trim();let e,r=0,i=t[r];for(;!i.geometry;)r++,i=t[r];if(Array.isArray(i.geometry)&&i.properties){let n=i.geometry[0];for(;Array.isArray(n);)n=n[0];n instanceof ln&&(e=t)}if(!e)if(e=[],Array.isArray(i.geometry))for(let n=0;n<t.length;n++){const r=$e({},t[n]);e.push(Rn(r))}else for(let r=0;r<t.length;r++){const i=t[r],s=cn(i);for(let t=0;t<s.length;t++){const r=s[t];r[n]=i[n],e.push(r)}}if(this.maxPosZ=0,!this.options.forceAltitudeAttribute){const t="line"===this.symbolDef.textPlacement;let n=0,r=!1;const{textPitchAlignmentFn:i}=this.it;!i&&t&&"map"===this.symbolDef.textPitchAlignment&&(r=!0);for(let s=0;s<e.length;s++){const o=Wo(e[s]&&e[s].geometry);if(o>n&&(n=o),t&&!r&&i&&e[s].properties){const t=i(null,e[s].properties);"map"===t&&(r=t)}}this.hasMapPitchAlign=r,this.maxPosZ=n}const s=this.options.order;if(s){const t=[];for(let n=0;n<s.length;n++)s[n]&&t.push(wo(s[n]));e=e.sort(((n,e)=>{const r=t.length;let i=-1,s=-1;for(let o=0;o<r&&(t[o](n)&&(i=o),t[o](e)&&(s=o),!(i>=0&&i<r&&s>=0&&s<r));o++);return i-s}))}return e}load(t=1){const n=(To+"").trim(),e="_debug_info".trim(),r=this.it,i=this.styledVectors;this.count=0;const s=this.features;if(!s||!s.length)return Promise.resolve(null);const o={},a={},u={zoom:this.options.zoom,isVector3D:!!this.options.center},l=[],h=w(this.symbolDef,(()=>(l[0]=u.zoom,l)));let c=0,f=s.length;const d=this.options.debugIndex;try{for(;c<f;c++){const t=s[c];if(!t||!t.geometry)continue;if(ze(d)&&t[e].index!==d)continue;t.properties||(t.properties={}),t.properties.$layer=t.layer,t.properties.$type=t.type;const l=this.createStyledVector(t,h,r,u,o,a);l&&l.feature.geometry&&(l.featureIdx=void 0===t[n]?c:t[n],this.count++,i.push(l))}}catch(t){return Promise.reject(t)}return this.options.atlas?Promise.resolve(this.pack(t)):this.loadAtlas(o,a).then((()=>this.pack(t)))}loadAtlas(t,n){return new Promise(((e,r)=>{this.fetchAtlas(t,n,((t,n)=>{if(t)r(t);else{if(n){const{icons:t,glyphs:e}=n;if(t&&Object.keys(t).length){for(const n in t){const e=t[n],{width:r,height:i,data:s}=e.data;e.data=new kn({width:r,height:i},s)}this.iconAtlas=new Dn(t)}if(e&&Object.keys(e).length){for(const t in e){const n=e[t];for(const t in n){const e=n[t],{width:r,height:i,data:s}=e.bitmap;e.bitmap=new Fn({width:r,height:i},s)}}this.glyphAtlas=new Un(e)}}e({glyphAtlas:this.glyphAtlas,iconAtlas:this.iconAtlas})}}))}))}fetchAtlas(t,n,e){Object.keys(t).length>0||Object.keys(n).length>0?this.options.requestor(t,n,e):e()}pack(t){if(!this.count)return null;if(null==t)throw new Error("layout scale is undefined");const n=this.createDataPack(this.styledVectors,t);if(!n)return null;n.properties=this.properties,this.empty&&(n.empty=!0);const e=n.buffers;delete n.buffers;const r={data:n,buffers:e};if(this.iconAtlas){const t=r.data.iconAtlas=Jo(this.iconAtlas);if(t.glyphMap)for(const n in t.glyphMap){const r=t.glyphMap[n];e.push(r.data.data.buffer)}e.push(r.data.iconAtlas.image.data.buffer)}return this.glyphAtlas&&(r.data.glyphAtlas=Jo(this.glyphAtlas),e.push(r.data.glyphAtlas.image.data.buffer)),r}createStyledVector(t,n,e,r){return new qe(t,n,e,r)}createDataPack(t,n){if(!t||!t.length)return null;this.maxIndex=0,this.maxPos=0,this.ut=this.ht=1/0,this.lt=this.ct=-1/0,this.maxAltitude=0,this.dynamicAttrs={};const e=this.data={};this.ft=Ro,Ro.reset();let r=this.elements=Ro.get();const i=this.dt=this.getFormat(Array.isArray(t[0])?t[0][0].symbol:t[0].symbol),s=this.needAltitudeAttribute()?2:3;for(let t=0;t<i.length;t++)e[i[t].name]=Ro.get(i[t].type);let o=Ro.get(),a=0;const u=Ro.get();let l=0,h=!1,c=!0;const f=new Set;for(let r=0,i=t.length;r<i;r++){if(!t[r].feature.geometry)continue;const i=Array.isArray(t[r])?t[r][0].feature.id:t[r].feature.id;c&&(void 0!==No.id?f&&(f.has(No.id)?c=!1:f.add(No.id)):c=!1),ze(i)&&(Math.abs(i)>l&&(l=Math.abs(i)),i<0&&(h=!0));const d=this.data.aPosition.getLength();if(Array.isArray(t[r]))for(let e=0;e<t[r].length;e++)this.yt(t[r][e],n);else this.yt(t[r],n);const p=(e.aPosition.getLength()-d)/s;for(let n=0;n<p;n++)o.push(t[r].featureIdx),ze(i)&&u.push(i);a=Math.max(a,t[r].featureIdx)}if(this.countOutOfAngle>0&&!Vo&&(Vo=!0,console.warn("text anchor along line is ignored as anchor's line angle is bigger than textMaxAngle.")),this.hasElements()&&!r.getLength())return null;const d=!!this.options.center?Float32Array:Ln(a);o=Do.createTypedArray(o,d),this.options.positionType?i[0].type=this.options.positionType:i[0].type=Nn(this.maxPos);const p=this.options.center;if(p&&(p[0]||p[1])){const t=e.aPosition,n=t.getLength();for(let e=0;e<n;e+=s)t[e]-=p[0],t[e+1]-=p[1]}const y=function(t,n){const e={};for(let r=0;r<t.length;r++){const i=t[r],s=i.type,o=i.name;e[o]=s===Array?n[o]:Hn(n[o],s)}return e}(i,e);y.aPickingId=o;const m=[];for(const t in y)m.push(y[t].buffer);const g=jn(this.maxIndex);r=Do.createTypedArray(r,g),m.push(r.buffer);const v={data:y,isIdUnique:c,is2D:0===this.maxPosZ,indices:this.hasElements()?r:null,positionSize:s,positionBounding:[this.ut,this.ht,this.lt,this.ct],buffers:m,symbolIndex:this.symbolDef.index||{index:0},dynamicAttributes:this.dynamicAttrs};if(this.gt&&(v.markerPlacement=this.gt),this.vt&&(v.textPlacement=this.vt),u.getLength()){const t=h?Nn(l):Ln(l);v.featureIds=Do.createTypedArray(u,t),m.push(v.featureIds.buffer)}else v.featureIds=[];return v.pickingIdIndiceMap=$n(o,v.indices),v}yt(t,n){const e=t.feature.properties;this.st&&!this.st(this.options.zoom,e)||this.placeVector(t,n,this.formatWidth)}addElements(t,n,e){this.maxIndex=Math.max(this.maxIndex,t,n,e);let r=this.elements.currentIndex;this.elements[r++]=t,this.elements[r++]=n,this.elements[r++]=e,this.elements.currentIndex=r}hasElements(){return!0}getAltitude(t){const{altitudeProperty:n,defaultAltitude:e,altitudeScale:r}=this.options;let i=Sn(t,n,e);return r&&(i*=r),this.maxAltitude=Math.max(this.maxAltitude,Math.abs(i)),i}getIconAtlasMaxValue(){const t=this.iconAtlas.positions;let n=0;for(const e in t)if(je(t,e)){const{tl:r,displaySize:i}=t[e],s=Math.max(r[0],r[1],i[0]-1,i[1]-1);s>n&&(n=s)}return n}ensureDataCapacity(t,n){const e=this.dt;for(let r=0;r<e.length;r++){const i=this.data[e[r].name];if(!i)continue;const s=e[r].width*t,o=i.getLength();this.data[e[r].name]=Do.ensureCapacity(i,o+s*n)}}}function Jo(t){let n=t.positions,e=t.image&&t.image.format||"alpha";if(t instanceof Dn){n={};for(const e in t.positions){const r=t.positions[e];n[e]={paddedRect:r.paddedRect,pixelRatio:r.pixelRatio,tl:r.tl,br:r.br,displaySize:r.displaySize}}e="rgba"}const r=t.image;return{image:{width:r.width,height:r.height,data:r.data,format:e},glyphMap:t.glyphMap,positions:n}}function Wo(t){if(!t)return 0;let n=0;if(Array.isArray(t))for(let e=0;e<t.length;e++)if(Array.isArray(t[e])){const r=Wo(t[e]);r>n&&(n=r)}else{const r=Math.abs(t[e].z||0);r>n&&(n=r)}else{const e=Math.abs(t.z||0);e>n&&(n=e)}return n}const Bo="___fn_in_stops";function Xo(t,n,e,r){const i="__fn_textSize".trim();let s=t.textSize;if(Ie(n.textSize))return[16,16];t[i]&&(s=t[i]);const o=[];var a;if(Ie(a=s)||"function"!=typeof a&&(null===a.constructor||a.constructor!==Function)?o[0]=s:o[0]=s(r,e),g(o[0])){const n=o[0].__fn_key=o[0].__fn_key||JSON.stringify(o[0]);t[Bo]||(t[Bo]={}),t[Bo][n]||(t[Bo][n]=v(o[0]));const i=t[Bo][n];o[0]=i(r,e)}return o[1]=o[0],o}function Yo(t){const n=t.stops;let e=-1/0;for(let t=0;t<n.length;t++){let r=n[t][1];De(n[t][1])&&(r=Yo(n[t][1])),r>e&&(e=r)}return e}const Ko=["{","}"],Zo="";const Qo=/\\{[\\w-]+(?:\\|[\\w-]+)*\\}/g;function ta(t,n){if(!Te(t))return t;function e(t){if(!n)return Zo;const e=n[t];return Ie(e)?Zo:Array.isArray(e)?e.join():e}const[r,i]=Ko,s=function(t){t+=Zo;const[n,e]=Ko,r=[];let i=!1,s=Zo;for(let o=0,a=t.length;o<a;o++){const a=t[o];i||a!==n||(i=!0),a===n&&i&&(s=Zo),i&&a!==n&&a!==e&&(s+=a),a===e&&s&&(i=!1,r.push(s),s=Zo)}return r}(t);for(let n=0,o=s.length;n<o;n++){const o=s[n],a=\`${YL}r}${YL}o}${YL}i}\`;if(o.indexOf("|")>0){const n=o.split("|");let r=!1;for(let i=0;i<n.length;i++){const s=e(n[i]);if(s!==Zo){t=ea(t,a,s),r=!0;break}}r||(t=ea(t,a,Zo))}else{t=ea(t,a,e(o))}}return t}function na(t,n){if(2!==n.length||"get"!==n[0])for(let e=0;e<n.length;e++)2===n[e].length&&"get"===n[e][0]?t.push(n[e][1]):Array.isArray(n[e])&&na(t,n[e]);else t.push(n[1])}function ea(t,n,e){if(!t)return t;if(t.replaceAll)return t.replaceAll(n,e);for(;t.indexOf(n)>-1;)t=t.replace(n,e);return t}const ra={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519};function ia(t){return!ra.Arabic(t)&&(!ra["Arabic Supplement"](t)&&(!ra["Arabic Extended-A"](t)&&(!ra["Arabic Presentation Forms-A"](t)&&!ra["Arabic Presentation Forms-B"](t))))}function sa(t){return!(t<11904)&&(!!ra["Bopomofo Extended"](t)||(!!ra.Bopomofo(t)||(!!ra["CJK Compatibility Forms"](t)||(!!ra["CJK Compatibility Ideographs"](t)||(!!ra["CJK Compatibility"](t)||(!!ra["CJK Radicals Supplement"](t)||(!!ra["CJK Strokes"](t)||(!!ra["CJK Symbols and Punctuation"](t)||(!!ra["CJK Unified Ideographs Extension A"](t)||(!!ra["CJK Unified Ideographs"](t)||(!!ra["Enclosed CJK Letters and Months"](t)||(!!ra["Halfwidth and Fullwidth Forms"](t)||(!!ra.Hiragana(t)||(!!ra["Ideographic Description Characters"](t)||(!!ra["Kangxi Radicals"](t)||(!!ra["Katakana Phonetic Extensions"](t)||(!!ra.Katakana(t)||(!!ra["Vertical Forms"](t)||(!!ra["Yi Radicals"](t)||!!ra["Yi Syllables"](t))))))))))))))))))))}function oa(t){return 746===t||747===t||!(t<4352)&&(!!ra["Bopomofo Extended"](t)||(!!ra.Bopomofo(t)||(!(!ra["CJK Compatibility Forms"](t)||t>=65097&&t<=65103)||(!!ra["CJK Compatibility Ideographs"](t)||(!!ra["CJK Compatibility"](t)||(!!ra["CJK Radicals Supplement"](t)||(!!ra["CJK Strokes"](t)||(!(!ra["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||(!!ra["CJK Unified Ideographs Extension A"](t)||(!!ra["CJK Unified Ideographs"](t)||(!!ra["Enclosed CJK Letters and Months"](t)||(!!ra["Hangul Compatibility Jamo"](t)||(!!ra["Hangul Jamo Extended-A"](t)||(!!ra["Hangul Jamo Extended-B"](t)||(!!ra["Hangul Jamo"](t)||(!!ra["Hangul Syllables"](t)||(!!ra.Hiragana(t)||(!!ra["Ideographic Description Characters"](t)||(!!ra.Kanbun(t)||(!!ra["Kangxi Radicals"](t)||(!!ra["Katakana Phonetic Extensions"](t)||(!(!ra.Katakana(t)||12540===t)||(!(!ra["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||(!(!ra["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(!!ra["Unified Canadian Aboriginal Syllabics"](t)||(!!ra["Unified Canadian Aboriginal Syllabics Extended"](t)||(!!ra["Vertical Forms"](t)||(!!ra["Yijing Hexagram Symbols"](t)||(!!ra["Yi Syllables"](t)||!!ra["Yi Radicals"](t))))))))))))))))))))))))))))))}function aa(t){return!(oa(t)||function(t){return!!(ra["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||ra["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||ra["Letterlike Symbols"](t)||ra["Number Forms"](t)||ra["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||ra["Control Pictures"](t)&&9251!==t||ra["Optical Character Recognition"](t)||ra["Enclosed Alphanumerics"](t)||ra["Geometric Shapes"](t)||ra["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||ra["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||ra["CJK Symbols and Punctuation"](t)||ra.Katakana(t)||ra["Private Use Area"](t)||ra["CJK Compatibility Forms"](t)||ra["Small Form Variants"](t)||ra["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function ua(t){return t>=1424&&t<=2303||ra["Arabic Presentation Forms-A"](t)||ra["Arabic Presentation Forms-B"](t)}const la=[[9,9],[32,32],[5760,5760],[8192,8198],[8200,8202],[8287,12288],[6158,6158],[8203,8205]];function ha(t){for(const n of la)if(t>=n[0]&&t<=n[1])return!0;return!1}const ca={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\\\":"","]":"","^":"",_:"","\`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};const fa={horizontal:1,vertical:2,horizontalOnly:3};function da(t,n,e,r,i,s,o,a,u,l){let h=t.trim();l===fa.vertical&&(h=function(t){let n="";const e=Array.from(t);for(let t=0;t<e.length;t++){const r=e[t+1].codePointAt(0)||null,i=e[t-1].codePointAt(0)||null;r&&aa(r)&&!ca[e[t+1]]||i&&aa(i)&&!ca[e[t-1]]||!ca[e[t]]?n+=e[t]:n+=ca[e[t]]}return n}(h));const c=[],f={positionedGlyphs:c,text:h,top:a[1],bottom:a[1],left:a[0],right:a[0],writingMode:l};let d;return d=function(t,n){const e=[];let r=0;for(let i=0;i<n.length;i++){const s=n[i];e.push(t.substring(r,s)),r=s}return r<t.length&&e.push(t.substring(r,t.length)),e}(h,function(t,n,e,r){if(!e)return[];if(!t)return[];const i=[],s=function(t,n,e,r){let i=0;for(let e=0;e<t.length;e++){const s=r[t.codePointAt(e)];s&&(i+=s.metrics.advance+n)}const s=Math.max(1,Math.ceil(i/e));return i/s}(t,n,e,r);let o=0;for(let e=0;e<t.length;e++){const a=t.codePointAt(e),u=r[a];u&&(u&&!pa[a]&&(o+=u.metrics.advance+n),e<t.length-1&&(ya[a]||sa(a))&&i.push(va(e+1,o,s,i,ga(a,t.codePointAt(e+1)),!1)))}return ba(va(t.length,o,s,i,0,!0))}(h,o,e,n)),function(t,n,e,r,i,s,o,a,u,l){let h=0,c=0,f=0;const d=t.positionedGlyphs,p=.5;for(let t=0;t<e.length;t++){let i=e[t];if(i=i.trim(),!i.length){c-=r;continue}const s=d.length;for(let t=0;t<i.length;t++){const e=i.codePointAt(t),r=n[e];r&&(oa(e)&&o!==fa.horizontal?(32!==e&&d.push({glyph:e,x:h,y:0,vertical:!0}),h+=u+a):(32!==e&&d.push({glyph:e,x:h,y:c,vertical:!1}),h+=r.metrics.advance+a))}if(d.length!==s){const t=h-a;f=Math.max(t,f),Ma(d,n,s,d.length-1,p)}h=0,c-=r}const{horizontalAlign:y,verticalAlign:m}=wa(i,l);!function(t,n,e,r,i,s,o){const a=(n-e)*i,u=-(-r*o+.5)*s;if(!a&&!u)return;for(let n=0;n<t.length;n++)t[n].x+=a,t[n].y+=u}(d,p,y,m,f,r,e.length);const g=e.length*r;t.top+=-m*g,t.bottom=t.top+g,t.left+=-y*f,t.right=t.left+f}(f,n,d,r,i,0,l,o,u),!!c.length&&f}const pa={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ya={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function ma(t,n,e,r){const i=Math.pow(t-n,2);return r?t<n?i/2:2*i:i+Math.abs(e)*e}function ga(t,n){let e=0;return 10===t&&(e-=1e4),40!==t&&65288!==t||(e+=50),41!==n&&65289!==n||(e+=50),e}function va(t,n,e,r,i,s){let o=null,a=ma(n,e,i,s);for(let t=0;t<r.length;t++){const u=r[t],l=ma(n-u.x,e,i,s)+u.badness;l<=a&&(o=u,a=l)}return{index:t,x:n,priorBreak:o,badness:a}}function ba(t){return t?ba(t.priorBreak).concat(t.index):[]}function wa(t,n){let e=.5,r=.5;switch(t){case"right":case"top-right":case"bottom-right":e=n?1:0;break;case"left":case"top-left":case"bottom-left":e=n?0:1}switch(t){case"bottom":case"bottom-right":case"bottom-left":r=n?1:0;break;case"top":case"top-right":case"top-left":r=n?0:1}return{horizontalAlign:e,verticalAlign:r}}function Ma(t,n,e,r,i){const s=n[t[r].glyph];if(s){const n=s.metrics.advance,o=(t[r].x+n)*i;if(!o)return;for(let n=e;n<=r;n++)t[n].x-=o}}function xa(t){if(!function(t){for(const n of t)if(ua(n.charCodeAt(0)))return!0;return!1}(t))return t;const n=[],e=[],r=[];let i=0,s=0,o=1,a=1;for(const u of t){const t=u.codePointAt(0);ha(t)?(r.push(u),i++):(o=ua(t)?-1:1,a!==o?(s=i,e.length&&(a>0&&e.reverse(),n.push(...e)),r.length&&(n.splice(s,0,...r),r.length=0),a=o,e.length=0):r.length&&(e.push(...r),r.length=0),e.push(u),i++)}return r.length&&e.push(...r),e.length&&(a>0&&e.reverse(),n.push(...e)),n.reverse().join("")}const Fa=/\\{ *([\\w_]+) *\\}/g;class ka{constructor(t,n,e,r,i){this.feature=t,this.symbolDef=n,this.symbol=e,this.options=i,this.bt=this.wt.bind(this),this.it=r}wt(t,n){return this.feature.properties[n]||""}getShape(t,n){if(this.Mt)return this.Mt;const{textHorizontalAlignmentFn:e,textVerticalAlignmentFn:r,markerHorizontalAlignmentFn:i,markerVerticalAlignmentFn:s,textWrapWidthFn:o}=this.it;let a;const u=this.symbol,l=this.getIconAndGlyph(),h=this.feature.properties;if(l&&l.glyph){const{font:t,text:i}=l.glyph;if(""===i)return null;const s=24,c=this.size[0]/s,f=24,d=u.textKeepUpright,p="map"===u.textRotationAlignment&&"line"===u.textPlacement&&!u.isIconText,y=n.glyphMap[t],m=Aa(e?e(null,h):u.textHorizontalAlignment,r?r(null,h):u.textVerticalAlignment),g=1.2*f,v=function(t){for(let n=0;n<t.length;n++)if(!ia(t.charAt(n).charCodeAt(0)))return!1;return!0}(i),b=v&&u.textLetterSpacing/c||0,w=[u.textDx/c||0,u.textDy/c||0],M=((o?o(null,h):u.textWrapWidth)||10*f)/c;a={},a.horizontal=da(i,y,M,g,m,0,b,w,f,fa.horizontal,this.options.isVector3D),v&&p&&d&&(a.vertical=da(i,y,M,g,m,0,b,w,f,fa.vertical))}else if(l&&l.icon){if(!t||!t.positions[l.icon.url])return null;const n=Aa(i?i(null,h):u.markerHorizontalAlignment,s?s(null,h):u.markerVerticalAlignment);a=function(t,n,e){let{horizontalAlign:r,verticalAlign:i}=wa(n,e);e?r=1-r:i=1-i;const s=-2048*r,o=-2048*i;return{image:t,top:o,bottom:o+2048,left:s,right:s+2048}}(t.positions[l.icon.url],n,this.options.isVector3D),this.size||(this.size=a.image.displaySize)}return this.Mt=a,a}getIconAndGlyph(){if(this.iconGlyph)return this.iconGlyph;const{markerFileFn:t,markerTypeFn:n,markerPathFn:e,markerWidthFn:r,markerHeightFn:i,markerFillFn:s,markerFillPatternFileFn:o,markerFillOpacityFn:a,markerTextFitFn:u,markerTextFitPaddingFn:l,markerLineColorFn:h,markerLineWidthFn:c,markerLineOpacityFn:f,markerLineDasharrayFn:d,markerLinePatternFileFn:p,markerPathWidthFn:y,markerPathHeightFn:m,textNameFn:b,textFaceNameFn:w}=this.it,{zoom:M}=this.options,x={},F=this.symbol,k=this.feature.properties,A=t?t(null,k):F.markerFile,P=n?n(null,k):F.markerType,S=A||P||F.markerPath,_=!Ie(this.symbolDef.textName);let O;if(S){O=function(t,n,e,r,i,s){if(Ie(n.markerWidth)&&Ie(n.markerHeight))return null;const o="__fn_markerWidth".trim(),a="__fn_markerHeight".trim();let u=n.markerWidth||0,l=n.markerHeight||0;return De(u)&&("identity"!==u.type?u=Yo(u):(u=t.markerWidth,t[o]&&(u=t[o](r,e)),De(u)&&(u="identity"===u.type?i(r,e):Yo(u)))),De(l)&&("identity"!==l.type?l=Yo(l):(l=t.markerHeight,t[a]&&(l=t[a](r,e)),De(l)&&(l="identity"===l.type?s(r,e):Yo(l)))),[u,l]}(F,this.symbolDef,k,M,r,i)||[0,0];let t=F.markerTextFit;if(u&&(t=u(M,k)),t&&F.text&&"none"!==t){const n=F.text.textSize;let e=F.text.textName;g(e)&&(e=v(e)(M,k));const r=ta(e,k);if(r){const e="__fn_textSize".trim(),i="__fn_textSize_0".trim();g(n)&&!F.text[e]&&(F.text[i]=v(n),F.text[e]=(t,n)=>{const e=F.text[i](t,n);return g(e)?v(e)(t,n):e});const s=Xo(F.text,F.text,k,M);if("width"!==t&&"both"!==t||(O[0]=s[0]*r.length),"height"!==t&&"both"!==t||(O[1]=s[1]),s[0]&&s[1]){let t=F.markerTextFitPadding||[0,0,0,0];l&&(t=l(M,k)),O[0]+=t[1]+t[3],O[1]+=t[0]+t[2]}}else O[0]=O[1]=-1}}if(_&&(O=Xo(F,this.symbolDef,k,M)),!O)return x;if(O[0]=Math.ceil(O[0]),O[1]=Math.ceil(O[1]),this.size=O,S&&O[0]>=0&&O[1]>=0){let t;if(P){const n={};if(n.markerType=P,"path"===P&&(n.markerPath=e?e(null,k):F.markerPath,n.markerPathWidth=y?y(null,k):F.markerPathWidth,n.markerPathHeight=m?m(null,k):F.markerPathHeight),r){const t=r(null,k);Ie(t)||(n.markerWidth=t)}else F.markerWidth>=0&&(n.markerWidth=F.markerWidth);if(i){const t=i(null,k);Ie(t)||(n.markerHeight=t)}else F.markerHeight>=0&&(n.markerHeight=F.markerHeight);if(s){const t=s(null,k);Ie(t)||(n.markerFill=t)}else F.markerFill&&(n.markerFill=F.markerFill);if(o){const t=o(null,k);Ie(t)||(n.markerFillPatternFile=t)}else F.markerFillPatternFile&&(n.markerFillPatternFile=F.markerFillPatternFile);if(a){const t=a(null,k);Ie(t)||(n.markerFillOpacity=t)}else F.markerFillOpacity>=0&&(n.markerFillOpacity=F.markerFillOpacity);if(h){const t=h(null,k);Ie(t)||(n.markerLineColor=t)}else F.markerLineColor&&(n.markerLineColor=F.markerLineColor);if(c){const t=c(null,k);Ie(t)||(n.markerLineWidth=t)}else F.markerLineWidth>=0&&(n.markerLineWidth=F.markerLineWidth);if(f){const t=f(null,k);Ie(t)||(n.markerLineOpacity=t)}else F.markerLineOpacity>=0&&(n.markerLineOpacity=F.markerLineOpacity);if(d){const t=d(null,k);Ie(t)||(n.markerLineDasharray=t)}else F.markerLineDasharray&&(n.markerLineDasharray=F.markerLineDasharray);if(p){const t=p(null,k);Ie(t)||(n.markerLinePatternFile=t)}else F.markerLinePatternFile&&(n.markerLinePatternFile=F.markerLinePatternFile);t="vector://"+JSON.stringify(n)}else t=A?A.replace(Fa,this.bt):F.markerPath?function(t,n,e){if(!t.markerPath)return null;let r=1;const i=function(t){const n={stroke:{stroke:t.markerLineColor,"stroke-width":t.markerLineWidth,"stroke-opacity":t.markerLineOpacity,"stroke-dasharray":null,"stroke-linecap":"butt","stroke-linejoin":"round"},fill:{fill:t.markerFill,"fill-opacity":t.markerFillOpacity}};return 0===n.stroke["stroke-width"]&&(n.stroke["stroke-opacity"]=0),n}(t);ze(t.markerOpacity)&&(r=t.markerOpacity),ze(t.opacity)&&(r*=t.opacity);const s={};if(i){for(const t in i.stroke)je(i.stroke,t)&&(Ie(i.stroke[t])||(s[t]=i.stroke[t]));for(const t in i.fill)je(i.fill,t)&&(Ie(i.fill[t])||(s[t]=i.fill[t]))}const o=Array.isArray(t.markerPath)?t.markerPath:[t.markerPath];let a;const u=[];for(let t=0;t<o.length;t++)a=Te(o[t])?{path:o[t]}:o[t],a=$e({},a,s),a.d=a.path,delete a.path,u.push(a);const l=['<svg version="1.1"','xmlns="http://www.w3.org/2000/svg"'];r<1&&l.push('opacity="'+r+'"'),t.markerPathWidth&&t.markerPathHeight&&l.push('viewBox="0 0 '+t.markerPathWidth+" "+t.markerPathHeight+'"'),l.push('preserveAspectRatio="none"'),n&&l.push('width="'+n+'"'),e&&l.push('height="'+e+'"'),l.push("><defs></defs>");for(let t=0;t<u.length;t++){let n="<path ";for(const e in u[t])je(u[t],e)&&(n+=" "+e+'="'+u[t][e]+'"');n+="></path>",l.push(n)}return l.push("</svg>"),"data:image/svg+xml;base64,"+btoa(l.join(" "))}(F,O[0],O[1]):null;x.icon={url:t,size:O}}if(_){const t=b?b(this.options.zoom,k):F.textName;if(t||0===t){const n=function(t){return t||"Open Sans Regular"}(w?w(null,k):F.textFaceName);let e=ta(t,k);e&&e.length&&(e=xa(e),x.glyph={font:n,text:e})}}return this.iconGlyph=x,x}}function Aa(t,n){n&&"middle"!==n||(n="center"),t&&"middle"!==t||(t="center");let e="center"!==n?n:"";return e+="center"!==t?(e.length?"-":"")+t:"",e}\n/*!\n     * From mapbox-gl-js\n     * MIT License\n     * https://github.com/mapbox/mapbox-gl-js\n     */function Pa(t,n,e,r,i){const s=[];let o;for(let a=0;a<t.length;a++){const u=t[a];let l,h=!1;for(let t=0;t<u.length-1;t++){let a=u[t],c=u[t+1];a.x<n&&c.x<n||(a.x<n?(o=a,a=new ln(n,a.y+(c.y-a.y)*((n-a.x)/(c.x-a.x))).j(),a.z=o.z+(c.z-o.z)*((n-o.x)/(c.x-o.x)),h=!0):c.x<n&&(o=c,c=new ln(n,a.y+(c.y-a.y)*((n-a.x)/(c.x-a.x))).j(),c.z=a.z+(o.z-a.z)*((n-a.x)/(o.x-a.x)),h=!0),a.y<e&&c.y<e||(a.y<e?(o=a,a=new ln(a.x+(c.x-a.x)*((e-a.y)/(c.y-a.y)),e).j(),a.z=o.z+(c.z-o.z)*((e-o.y)/(c.y-o.y)),h=!0):c.y<e&&(o=c,c=new ln(a.x+(c.x-a.x)*((e-a.y)/(c.y-a.y)),e).j(),c.z=a.z+(o.z-a.z)*((e-a.y)/(o.y-a.y)),h=!0),a.x>=r&&c.x>=r||(a.x>=r?(o=a,a=new ln(r,a.y+(c.y-a.y)*((r-a.x)/(c.x-a.x))).j(),a.z=o.z+(c.z-o.z)*((r-o.x)/(c.x-o.x)),h=!0):c.x>=r&&(o=c,c=new ln(r,a.y+(c.y-a.y)*((r-a.x)/(c.x-a.x))).j(),c.z=a.z+(o.z-a.z)*((r-a.x)/(o.x-a.x)),h=!0),a.y>=i&&c.y>=i||(a.y>=i?(o=a,a=new ln(a.x+(c.x-a.x)*((i-a.y)/(c.y-a.y)),i).j(),a.z=o.z+(c.z-o.z)*((i-o.y)/(c.y-o.y)),h=!0):c.y>=i&&(o=c,c=new ln(a.x+(c.x-a.x)*((i-a.y)/(c.y-a.y)),i).j(),c.z=a.z+(o.z-a.z)*((i-a.y)/(o.y-a.y)),h=!0),l&&a.equals(l[l.length-1])||(l=[a],s.push(l)),h&&(l.clipped=!0),l.push(c)))))}}return s}class Sa extends ln{constructor(t,n,e,r){super(t,n),this.angle=e,void 0!==r&&(this.segment=r)}clone(){return new Sa(this.x,this.y,this.angle,this.segment)}}\n/*!\n     * From mapbox-gl-js\n     * MIT License\n     * https://github.com/mapbox/mapbox-gl-js\n     */function _a(t,n,e,r,i){if(void 0===n.segment)return!0;let s=n,o=n.segment+1,a=0;for(;a>-e/2;){if(o--,o<0)return!1;a-=t[o].dist(s),s=t[o]}a+=t[o].dist(t[o+1]),o++;const u=[];let l=0;for(;a<e/2;){const n=t[o-1],e=t[o],s=t[o+1];if(!s)return!1;let h=n.angleTo(e)-e.angleTo(s);for(h=Math.abs((h+3*Math.PI)%(2*Math.PI)-Math.PI),u.push({distance:a,angleDelta:h}),l+=h;a-u[0].distance>r;)l-=u.shift().angleDelta;if(l>i)return!1;o++,a+=e.dist(s)}return!0}function Oa(t,n,e,r,i,s,o,a,u,l,h){const c=function(t,n,e){return t?.6*n*e:0}(r,s,o),f=function(t,n){return Math.max(t?t.right-t.left:0,0)}(r),d=0===t[0].x||t[0].x===u||0===t[0].y||t[0].y===u;n-f*o<n/4&&(n=f*o+n/4);return Ca(t,d?n/2*a%n:(f/2+2*s)*o*a%n,n,c,e,f*o,d,!1,u,l,h)}function Ca(t,n,e,r,i,s,o,a,u,l,h){let c=0;const f=s/2,d=function(t){let n=0;for(let e=0;e<t.length-1;e++)n+=t[e].dist(t[e+1]);return n}(t);let p=0,y=n-e,m=[];for(let n=0;n<t.length-1;n++){const o=t[n],a=t[n+1],g=o.dist(a),v=a.angleTo(o);for(;y+e<p+g;){y+=e;const b=(y-p)/g,w=Ea(o.x,a.x,b),M=Ea(o.y,a.y,b),x=Ea(o.z||0,a.z||0,b);if(w>=0&&w<u&&M>=0&&M<u&&y-f>=0&&y+f<=d){const e=new Sa(w,M,v,n);e.z=x,l&&(e.axis=[o.y-M,w-o.x],e.angleR=x===(o.z||0)?0:Math.atan(.9*(x-(o.z||0))*h/o.dist(e))),e.line=t,e.j(),!r||_a(t,e,s,r,i)?m.push(e):r&&c++}}p+=g}return a||m.length||o||(m=Ca(t,p/2,e,r,i,s,o,!0,u,l,h)),m.countOutOfAngle=c,m}function Ea(t,n,e){return t*(1-e)+n*e}var $a={exports:{}};$a.exports=function(){function t(t,e,i,s,o){n(t,e,i||0,s||t.length-1,o||r)}function n(t,r,i,s,o){for(;s>i;){if(s-i>600){var a=s-i+1,u=r-i+1,l=Math.log(a),h=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*h*(a-h)/a)*(u-a/2<0?-1:1);n(t,r,Math.max(i,Math.floor(r-u*h/a+c)),Math.min(s,Math.floor(r+(a-u)*h/a+c)),o)}var f=t[r],d=i,p=s;for(e(t,i,r),o(t[s],f)>0&&e(t,i,s);d<p;){for(e(t,d,p),d++,p--;o(t[d],f)<0;)d++;for(;o(t[p],f)>0;)p--}0===o(t[i],f)?e(t,i,p):e(t,++p,s),p<=r&&(i=p+1),r<=p&&(s=p-1)}}function e(t,n,e){var r=t[n];t[n]=t[e],t[e]=r}function r(t,n){return t<n?-1:t>n?1:0}return t}();var Ia=Et($a.exports);function za(t,n){const e=t.length;if(e<=1)return[t];const r=[];let i,s;for(let n=0;n<e;n++){const e=An(t[n]);0!==e&&(t[n].area=Math.abs(e),void 0===s&&(s=e<0),s===e<0?(i&&r.push(i),i=[t[n]]):i.push(t[n]))}if(i&&r.push(i),n>1)for(let t=0;t<r.length;t++)r[t].length<=n||(Ia(r[t],n,1,r[t].length-1,Da),r[t]=r[t].slice(0,n));return r}function Da(t,n){return n.area-t.area}class Ta{constructor(t=[],n=Ua){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this.xt(t)}push(t){this.data.push(t),this.length++,this.Ft(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this.xt(0)),t}peek(){return this.data[0]}Ft(t){const{data:n,compare:e}=this,r=n[t];for(;t>0;){const i=t-1>>1,s=n[i];if(e(r,s)>=0)break;n[t]=s,t=i}n[t]=r}xt(t){const{data:n,compare:e}=this,r=this.length>>1,i=n[t];for(;t<r;){let r=1+(t<<1),s=n[r];const o=r+1;if(o<this.length&&e(n[o],s)<0&&(r=o,s=n[o]),e(s,i)>=0)break;n[t]=s,t=r}n[t]=i}}function Ua(t,n){return t<n?-1:t>n?1:0}function ja(t,n,e){const r=n.distSqr(e);if(0===r)return t.distSqr(n);const i=((t.x-n.x)*(e.x-n.x)+(t.y-n.y)*(e.y-n.y))/r;return i<0?t.distSqr(n):i>1?t.distSqr(e):t.distSqr(e.sub(n).S(i).F(n))}function Na(t,n=1,e=!1){let r=1/0,i=1/0,s=-1/0,o=-1/0;const a=t[0];for(let t=0;t<a.length;t++){const n=a[t];(!t||n.x<r)&&(r=n.x),(!t||n.y<i)&&(i=n.y),(!t||n.x>s)&&(s=n.x),(!t||n.y>o)&&(o=n.y)}const u=s-r,l=o-i,h=Math.min(u,l);let c=h/2;const f=new Ta([],La);if(0===h)return new ln(r,i);for(let n=r;n<s;n+=h)for(let e=i;e<o;e+=h)f.push(new Ha(n+c,e+c,c,t));let d=function(t){let n=0,e=0,r=0;const i=t[0];for(let t=0,s=i.length,o=s-1;t<s;o=t++){const s=i[t],a=i[o],u=s.x*a.y-a.x*s.y;e+=(s.x+a.x)*u,r+=(s.y+a.y)*u,n+=3*u}return new Ha(e/n,r/n,0,t)}(t),p=f.length;for(;f.length;){const r=f.pop();(r.d>d.d||!d.d)&&(d=r,e&&console.log("found best %d after %d probes",Math.round(1e4*r.d)/1e4,p)),r.max-d.d<=n||(c=r.h/2,f.push(new Ha(r.p.x-c,r.p.y-c,c,t)),f.push(new Ha(r.p.x+c,r.p.y-c,c,t)),f.push(new Ha(r.p.x-c,r.p.y+c,c,t)),f.push(new Ha(r.p.x+c,r.p.y+c,c,t)),p+=4)}return e&&(console.log(\`num probes: ${YL}p}\`),console.log(\`best distance: ${YL}d.d}\`)),d.p}function La(t,n){return n.max-t.max}function Ha(t,n,e,r){this.p=new ln(t,n),this.h=e,this.d=function(t,n){let e=!1,r=1/0;for(let i=0;i<n.length;i++){const s=n[i];for(let n=0,i=s.length,o=i-1;n<i;o=n++){const i=s[n],a=s[o];i.y>t.y!=a.y>t.y&&t.x<(a.x-i.x)*(t.y-i.y)/(a.y-i.y)+i.x&&(e=!e),r=Math.min(r,ja(t,i,a))}}return(e?1:-1)*Math.sqrt(r)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}function Ra(t,n,e,r,i,s,o,a,u,l){const{feature:h,size:c,symbol:f}=t,d=c?24:0,p=i*(c?c[0]/d:1);if("line"===o){const t=[];t.countOutOfAngle=0;let i=h.geometry;s&&(i=Pa(h.geometry,0,0,s,s));for(let o=0;o<i.length;o++){const h=Oa(i[o],a,e,f.isIconText?null:r&&r.vertical||r&&r.horizontal||r,0,d,f.isIconText?1:p,1,s||1/0,u,l);if(f.textPlacement&&!f.isIconText)for(let t=0;t<h.length;t++)h[t].startIndex=n.length/3;if(t.push.apply(t,h),f.textPlacement&&!f.isIconText)for(let t=0;t<i[o].length;t++)n.push(i[o][t].x,i[o][t].y,i[o][t].z||0);t.countOutOfAngle+=h.countOutOfAngle||0}return t}return Va(h,o,s)}function Va(t,n,e,r,i){const s=[];if(3===t.type){const o=za(t.geometry,0);for(let t=0;t<o.length;t++){const a=o[t];if("vertex"===n)for(let t=0;t<a.length;t++){const n=a[t];for(let o=0;o<n.length;o++)On(n[o],e)||(s.push(n[o]),r&&(0===o?qa(n[o],n[o],n[t+1],i):qa(n[o],n[o-1],n[o],i)))}else if("vertex-first"===n){const t=a[0];t&&t[0]&&!On(t[0],e)&&(s.push(t[0]),r&&qa(t[0],t[0],t[1],i))}else if("vertex-last"===n||"vertex-firstlast"===n){const t=a[0];if("vertex-firstlast"===n&&t&&t[0]&&!On(t[0],e)&&(s.push(t[0]),r&&qa(t[0],t[0],t[1],i)),t&&t[t.length-1]&&!On(t[t.length-1],e)){const n=t.length-1;s.push(t[n]),r&&qa(t[n],t[n-1],t[n],i)}}else{const t=Na(a,16);On(t,e)||s.push(t)}}}else if(2===t.type)for(let o=0;o<t.geometry.length;o++){const a=t.geometry[o];if("vertex"===n)for(let t=0;t<a.length;t++)On(a[t],e)||(s.push(a[t]),r&&(0===t?qa(a[t],a[t],a[t+1],i):qa(a[t],a[t-1],a[t],i)));else if("vertex-last"===n||"vertex-firstlast"===n){if("vertex-firstlast"!==n||On(a[0],e)||(s.push(a[0]),r&&qa(a[0],a[0],a[1],i)),a&&a[a.length-1]&&!On(a[a.length-1],e)){const t=a.length-1;s.push(a[t]),r&&qa(a[t],a[t-1],a[t],i)}}else On(a[0],e)||(s.push(a[0]),r&&qa(a[0],a[0],a[1],i))}else if(1===t.type)for(let n=0;n<t.geometry.length;n++){const i=t.geometry[n];for(let t=0;t<i.length;t++){const n=i[t];On(n,e)||(r&&(n.xRotation=0,n.yRotation=0,n.zRotation=0),s.push(n))}}return s}function qa(t,n,e,r){if(t.xRotation||t.yRotation||t.zRotation)return t;const i=e.x-n.x,s=n.y-e.y,o=(e.z-n.z)*r,a=Math.atan2(s,i);t.zRotation=a;const u=Math.atan2(o,Math.sqrt(i*i+s*s));return t.xyRotation=u,t}function Ga(t,n){const e={},r={},i=[];let s=0;function o(n){i.push(t[n]),s++}function a(t,n,e){const s=r[t];return delete r[t],r[n]=s,i[s].geometry[0].pop(),i[s].geometry[0]=i[s].geometry[0].concat(e[0]),s}function u(t,n,r){const s=e[n];return delete e[n],e[t]=s,i[s].geometry[0].shift(),i[s].geometry[0]=r[0].concat(i[s].geometry[0]),s}function l(t,n,e){const r=e?n[0][n[0].length-1]:n[0][0];return\`${YL}t}:${YL}r.x}:${YL}r.y}\`}for(let h=0;h<t.length;h++){const c=t[h],f=c.geometry;if(!f)continue;const d=c.properties[n]?c.properties[n].toString():null;if(!d){o(h);continue}const p=l(d,f),y=l(d,f,!0);if(p in r&&y in e&&r[p]!==e[y]){const t=u(p,y,f),n=a(p,y,i[t].geometry);delete e[p],delete r[y],r[l(d,i[n].geometry,!0)]=n,i[t].geometry=null}else p in r?a(p,y,f):y in e?u(p,y,f):(o(h),e[p]=s-1,r[y]=s-1)}return i.filter((t=>t.geometry))}const Ja="__index";function Wa(t,n,e,r){const i=(Ja+"").trim(),s=function(t,n,e,r){const i=(Ja+"").trim(),{mergeOnPropertyFn:s}=e;if(!n.mergeOnProperty)return[];if(o=n.mergeOnProperty,!Cn(o)&&("string"==typeof o||null!==o.constructor&&o.constructor===String))return[{features:t,property:n.mergeOnProperty}];var o;const a=[],u={},l=[];for(let e=0;e<t.length;e++){t[e][i]=e;const o=t[e].properties=t[e].properties||{};o.$layer=t[e].layer,o.$type=t[e].type;const h=s?s(r,o):n.mergeOnProperty;Cn(h)?l.push(t[e]):(void 0===u[h]&&(u[h]=a.length,a.push({features:[],property:h})),a[u[h]].features.push(t[e]))}l.length&&a.push({features:l});return a}(t,n,e,r);if(s.length){const n=[];for(let e=0;e<s.length;e++)s[e].property?n.push(Ga(s[e].features,s[e].property)):n.push(t);if(1===n.length)return n[0];{let t=[];for(let e=0;e<n.length;e++)t=t.concat(n[e]);return t.sort(((t,n)=>t[i]-n[i])),t}}return[]}const Ba=14;class Xa extends Go{static needMerge(t,n,e){if(!t)return!1;let r="line"===t.textPlacement||"line"===t.markerPlacement;return r||(n.textPlacementFn&&(r="line"===n.textPlacementFn(e)),n.markerPlacementFn&&(r="line"===n.markerPlacementFn(e))),t.mergeOnProperty&&r}static mergeLineFeatures(t,n,e,r){let i=n.textPlacement,s=n.markerPlacement;return e.textPlacementFn&&(i=e.textPlacementFn(r)),e.markerPlacementFn&&(s=e.markerPlacementFn(r)),"line"!==i&&"line"!==s?t:Wa(t,n,e,r)}static splitPointSymbol(t,n=0){const e=[];if(Array.isArray(t)){const n=t;for(let t=0;t<n.length;t++)n[t]&&e.push(...Xa.splitPointSymbol(n[t],t));return e}let r=null,i=null;for(const n in t)0===n.indexOf("marker")?(r=r||{},r[n]=t[n]):0===n.indexOf("text")&&(i=i||{},i[n]=t[n]);return r&&(r.isIconText=!0,t.mergeOnProperty&&(r.mergeOnProperty=t.mergeOnProperty),e.push(r)),i&&(r&&(i.textPlacement=r.markerPlacement,i.textSpacing=r.markerSpacing,i.isIconText=!0),t.mergeOnProperty&&(i.mergeOnProperty=t.mergeOnProperty),e.push(i)),void 0!==t.visible&&(r&&(r.visible=t.visible),i&&(i.visible=t.visible)),r&&(r.markerTextFit&&i&&(r.text={},r.text.textName=i.textName,r.text.textSize=i.textSize),r.index={index:n,type:0}),i&&(i.index={index:n,type:1}),e}static isAtlasLoaded(t,n){const{icon:e,glyph:r}=t,{iconAtlas:i,glyphAtlas:s}=n;if(e&&(!i||!i.positions[e.url]))return!1;if(r){if(!s||!s.positions[r.font])return!1;const t=s.positions[r.font],{text:n}=r;for(const e of n)if(!t[e.codePointAt(0)])return!1}return!0}constructor(t,n,e){super(t,n,e),this.kt=n.textPlacement,this.it.textPlacementFn&&(this.kt=this.it.textPlacementFn(this.options.zoom))}createStyledVector(t,n,e,r,i,s){const o=new ka(t,this.symbolDef,n,e,r),a=o.getIconAndGlyph();if(a.icon&&!this.options.atlas){const{url:t,size:n}=a.icon;i[t]||(i[t]=a.icon.size),i[t][0]<n[0]&&(i[t][0]=n[0]),i[t][1]<n[1]&&(i[t][1]=n[1])}if(a.glyph&&!this.options.atlas){const{font:t,text:n}=a.glyph,e=s[t]=s[t]||{};for(const t of n)e[t.codePointAt(0)]=1;"line"===this.kt&&(s.options={isCharsCompact:!1})}return this.options.allowEmptyPack||a.icon||a.glyph?o:null}getFormat(t){const n=void 0!==t.textName,e=n?this.getPackSDFFormat(t):this.getPackMarkerFormat();n?e.push(...this.At()):e.push(...this.Pt());const{markerOpacityFn:r,textOpacityFn:i,markerPitchAlignmentFn:s,textPitchAlignmentFn:o,markerRotationAlignmentFn:a,textRotationAlignmentFn:u,markerRotationFn:l,textRotationFn:h,markerAllowOverlapFn:c,textAllowOverlapFn:f,markerIgnorePlacementFn:d,textIgnorePlacementFn:p}=this.it;return(r||i)&&e.push({type:Uint8Array,width:1,name:"aColorOpacity"}),(s||o)&&e.push({type:Uint8Array,width:1,name:"aPitchAlign"}),(a||u)&&e.push({type:Uint8Array,width:1,name:"aRotationAlign"}),(l||h)&&e.push({type:Uint16Array,width:1,name:"aRotation"}),(c||f||d||p)&&e.push({type:Uint8Array,width:1,name:"aOverlap"}),e}St(){return this.hasMapPitchAlign}At(){const{textFillFn:t,textSizeFn:n,textHaloFillFn:e,textHaloRadiusFn:r,textHaloOpacityFn:i,textDxFn:s,textDyFn:o}=this.it,a=[];return t&&a.push({type:Uint8Array,width:4,name:"aTextFill"}),n&&a.push({type:Uint8Array,width:1,name:"aTextSize"}),e&&a.push({type:Uint8Array,width:4,name:"aTextHaloFill"}),r&&a.push({type:Uint8Array,width:1,name:"aTextHaloRadius"}),i&&a.push({type:Uint8Array,width:1,name:"aTextHaloOpacity"}),s&&a.push({type:Int8Array,width:1,name:"aTextDx"}),o&&a.push({type:Int8Array,width:1,name:"aTextDy"}),a}Pt(){const{markerWidthFn:t,markerHeightFn:n,markerDxFn:e,markerDyFn:r}=this.it,i=[];return t&&i.push({type:this.options.markerWidthType||Uint8Array,width:1,name:"aMarkerWidth"}),n&&i.push({type:this.options.markerHeightType||Uint8Array,width:1,name:"aMarkerHeight"}),e&&i.push({type:Int8Array,width:1,name:"aMarkerDx"}),r&&i.push({type:Int8Array,width:1,name:"aMarkerDy"}),i}createDataPack(){if(!this.iconAtlas&&!this.glyphAtlas){if(!this.options.allowEmptyPack)return null;this.empty=!0}this.countOutOfAngle=0,this.lineVertex=[];const t=super.createDataPack.apply(this,arguments);return t?(t.lineVertex=new Int16Array(this.lineVertex),t.buffers.push(t.lineVertex.buffer),t):null}placeVector(t,n){const e=t.getShape(this.iconAtlas,this.glyphAtlas),r=!e||!e.image,i=!e||!e.horizontal&&!e.vertical;if(!this.options.allowEmptyPack&&r&&i)return;const s=this._t(t,e,n);this.countOutOfAngle+=s.countOutOfAngle||0;if(0===s.length)return;const o=this.data,a=this.needAltitudeAttribute()?2:3;let u=this.data.aPosition.getLength()/a;const l=t.symbol,h=t.feature.properties,c="line"===this.kt&&!l.isIconText,f=void 0!==l.textName,d=f&&c&&function(t){let n=0;for(let e=0;e<t.length;e++)if(oa(t.charAt(e).charCodeAt(0)))n=0;else if(n++,n>=1)return!1;return!0}(t.getIconAndGlyph().glyph.text)?1:0,{textFillFn:p,textSizeFn:y,textHaloFillFn:m,textHaloRadiusFn:v,textHaloOpacityFn:b,textDxFn:w,textDyFn:M,textPitchAlignmentFn:x,textRotationAlignmentFn:F,textRotationFn:k,textAllowOverlapFn:A,textIgnorePlacementFn:P,textOpacityFn:S,markerWidthFn:_,markerHeightFn:O,markerDxFn:C,markerDyFn:E,markerPitchAlignmentFn:$,markerRotationAlignmentFn:I,markerRotationFn:z,markerAllowOverlapFn:D,markerIgnorePlacementFn:T,markerOpacityFn:U}=this.it;let j,N,L,H,R,V,q,G,J,W,B,X,Y,K,Z,Q,tt;if(f){const n=t.getIconAndGlyph().glyph.font;j=function(t,n,e){const r=t.positionedGlyphs,i=[];for(let s=0;s<r.length;s++){const o=r[s],a=e[o.glyph];if(!a)continue;const u=a.rect;if(!u)continue;const l=4,h=a.metrics.advance/2,c=a.metrics.height/2,f=n?[o.x+h,0]:[0,0],d=n?[0,o.y-c]:[o.x+h,o.y-c],p=a.metrics.left-l-h+d[0],y=a.metrics.top-l+d[1],m=p+u.w,g=y+u.h,v=new ln(p,y),b=new ln(m,y),w=new ln(p,g),M=new ln(m,g);if(n&&o.vertical){const t=new ln(-h,h),n=-Math.PI/2,e=new ln(5,0);v.I(n,t).F(e),b.I(n,t).F(e),w.I(n,t).F(e),M.I(n,t).F(e)}i.push({tl:v,tr:b,bl:w,br:M,tex:u,writingMode:t.writingMode,glyphOffset:f})}return i}(e.horizontal,c,this.glyphAtlas.positions[n]),p&&(N=p(null,h),g(N)?(this.dynamicAttrs.aTextFill=1,N=[0,0,0,0]):N=He([],N)),y&&(L=y(this.options.zoom,h),Cn(L)&&(L=Ba)),m&&(H=m(null,h),g(H)?(this.dynamicAttrs.aTextHaloFill=1,H=[0,0,0,0]):H=He([],H)),v&&(R=v(null,h)),b&&(V=255*b(null,h)),w&&(q=w(null,h)||0),M&&(G=M(null,h)||0),x&&(Y=+("map"===x(null,h))),F&&(K=+("map"===F(null,h))),k&&(Z=En(k(null,h),0,360)*Math.PI/180)}else j=e?function(t){const n=t.image,e=t.top-1/n.pixelRatio,r=t.left-1/n.pixelRatio,i=t.bottom+1/n.pixelRatio,s=t.right+1/n.pixelRatio;let o,a,u,l;return o=new ln(r,e),a=new ln(s,e),u=new ln(s,i),l=new ln(r,i),[{tl:o,tr:a,bl:l,br:u,tex:{x:n.tl[0],y:n.tl[1],w:n.displaySize[0],h:n.displaySize[1]},writingMode:void 0,glyphOffset:[0,0]}]}(e):function(){const t=new ln(0,0),n=new ln(0,0),e=new ln(0,0);return[{tl:t,tr:n,bl:new ln(0,0),br:e,tex:{x:0,y:0,w:0,h:0},writingMode:void 0,glyphOffset:[0,0]}]}(),_&&(J=_(null,h)),Cn(J)&&(J=j[0].tex.w),O&&(W=O(null,h)),Cn(W)&&(W=j[0].tex.h),C&&(B=C(null,h)),E&&(X=E(null,h)),$&&(Y=+("map"===$(null,h))),I&&(K=+("map"===I(null,h))),z&&(Z=En(z(null,h),0,360)*Math.PI/180);g(L)&&(this.dynamicAttrs.aTextSize=1),g(R)&&(this.dynamicAttrs.aTextHaloRadius=1),g(V)&&(this.dynamicAttrs.aTextHaloOpacity=1),g(q)&&(this.dynamicAttrs.aTextDx=1),g(G)&&(this.dynamicAttrs.aTextDy=1),g(J)&&(this.dynamicAttrs.aMarkerWidth=1),g(W)&&(this.dynamicAttrs.aMarkerHeight=1),g(B)&&(this.dynamicAttrs.aMarkerDx=1),g(X)&&(this.dynamicAttrs.aMarkerDy=1),g(Y)&&(this.dynamicAttrs.aPitchAlign=1),g(K)&&(this.dynamicAttrs.aRotationAlign=1),g(Z)&&(this.dynamicAttrs.aRotation=1);const nt=D||A;nt&&(Q=nt(null,h)||0);const et=T||P;let rt;et&&(tt=et(null,h)||0);const it=S||U;it&&(rt=255*it(this.options.zoom,h));const st=j.length;this.ensureDataCapacity(4*st,s.length);const ot=this.options.EXTENT,{altitudeScale:at,altitudeProperty:ut,defaultAltitude:lt}=this.options,{altitude:ht}=_n(t.feature,at,ut,lt);for(let t=0;t<s.length;t++){const n=s[t],e=n.z||ht||0;if(ot!==1/0&&On(n,ot))continue;const r=n.x,i=n.y,a=j.length;for(let t=0;t<a;t++){const s=j[t],{tl:a,tr:l,bl:h,br:p,tex:y}=s;this.Ot(o,r,i,e,10*a.x,10*a.y,y.x,y.y+y.h),f&&this.Ct(o,c,st,s.glyphOffset,n,d,n.axis,n.angleR),this.Et(o,N,L,H,R,V,q,G,J,W,B,X,rt,Y,K,Z,Q,tt),this.Ot(o,r,i,e,10*l.x,10*l.y,y.x+y.w,y.y+y.h),f&&this.Ct(o,c,st,s.glyphOffset,n,d,n.axis,n.angleR),this.Et(o,N,L,H,R,V,q,G,J,W,B,X,rt,Y,K,Z,Q,tt),this.Ot(o,r,i,e,10*h.x,10*h.y,y.x,y.y),f&&this.Ct(o,c,st,s.glyphOffset,n,d,n.axis,n.angleR),this.Et(o,N,L,H,R,V,q,G,J,W,B,X,rt,Y,K,Z,Q,tt),this.Ot(o,r,i,e,10*p.x,10*p.y,y.x+y.w,y.y),f&&this.Ct(o,c,st,s.glyphOffset,n,d,n.axis,n.angleR),this.Et(o,N,L,H,R,V,q,G,J,W,B,X,rt,Y,K,Z,Q,tt),this.addElements(u,u+1,u+2),this.addElements(u+1,u+2,u+3),u+=4;const m=Math.max(Math.abs(r),Math.abs(i),Math.abs(e));m>this.maxPos&&(this.maxPos=m)}}}Ot(t,n,e,r,i,s,o,a){this.fillPosition(t,n,e,r);let u=t.aShape.currentIndex;t.aShape[u++]=i,t.aShape[u++]=s,t.aShape.currentIndex=u,u=t.aTexCoord.currentIndex,t.aTexCoord[u++]=o,t.aTexCoord[u++]=a,t.aTexCoord.currentIndex=u}Ct(t,n,e,r,i,s,o,a){let u=t.aCount.currentIndex;if(t.aCount[u++]=e,t.aCount.currentIndex=u,n){u=t.aGlyphOffset.currentIndex,t.aGlyphOffset[u++]=r[0],t.aGlyphOffset[u++]=r[1],t.aGlyphOffset.currentIndex=u,this.St()&&(u=t.aPitchRotation.currentIndex,t.aPitchRotation[u++]=o[0],t.aPitchRotation[u++]=o[1],t.aPitchRotation[u++]=a,t.aPitchRotation.currentIndex=u);const n=i.startIndex;u=t.aSegment.currentIndex,t.aSegment[u++]=i.segment+n,t.aSegment[u++]=n,t.aSegment[u++]=i.line.length,t.aSegment.currentIndex=u,u=t.aVertical.currentIndex,t.aVertical[u++]=s,t.aVertical.currentIndex=u}}Et(t,n,e,r,i,s,o,a,u,l,h,c,f,d,p,y,m,g){const{textFillFn:v,textSizeFn:b,textHaloFillFn:w,textHaloRadiusFn:M,textHaloOpacityFn:x,textDxFn:F,textDyFn:k,textPitchAlignmentFn:A,textRotationAlignmentFn:P,textRotationFn:S,textAllowOverlapFn:_,textIgnorePlacementFn:O,textOpacityFn:C,markerWidthFn:E,markerHeightFn:$,markerDxFn:I,markerDyFn:z,markerPitchAlignmentFn:D,markerRotationAlignmentFn:T,markerRotationFn:U,markerAllowOverlapFn:j,markerIgnorePlacementFn:N,markerOpacityFn:L}=this.it;if(v){let e=t.aTextFill.currentIndex;t.aTextFill[e++]=n[0],t.aTextFill[e++]=n[1],t.aTextFill[e++]=n[2],t.aTextFill[e++]=n[3],t.aTextFill.currentIndex=e}if(b){let n=t.aTextSize.currentIndex;t.aTextSize[n++]=e,t.aTextSize.currentIndex=n}if(w){let n=t.aTextHaloFill.currentIndex;t.aTextHaloFill[n++]=r[0],t.aTextHaloFill[n++]=r[1],t.aTextHaloFill[n++]=r[2],t.aTextHaloFill[n++]=r[3],t.aTextHaloFill.currentIndex=n}if(M){let n=t.aTextHaloRadius.currentIndex;t.aTextHaloRadius[n++]=i,t.aTextHaloRadius.currentIndex=n}if(x){let n=t.aTextHaloOpacity.currentIndex;t.aTextHaloOpacity[n++]=s,t.aTextHaloOpacity.currentIndex=n}if(F){let n=t.aTextDx.currentIndex;t.aTextDx[n++]=o,t.aTextDx.currentIndex=n}if(k){let n=t.aTextDy.currentIndex;t.aTextDy[n++]=a,t.aTextDy.currentIndex=n}if(E){let n=t.aMarkerWidth.currentIndex;t.aMarkerWidth[n++]=u,t.aMarkerWidth.currentIndex=n}if($){let n=t.aMarkerHeight.currentIndex;t.aMarkerHeight[n++]=l,t.aMarkerHeight.currentIndex=n}if(I){let n=t.aMarkerDx.currentIndex;t.aMarkerDx[n++]=h,t.aMarkerDx.currentIndex=n}if(z){let n=t.aMarkerDy.currentIndex;t.aMarkerDy[n++]=c,t.aMarkerDy.currentIndex=n}if(L||C){let n=t.aColorOpacity.currentIndex;t.aColorOpacity[n++]=f,t.aColorOpacity.currentIndex=n}if(A||D){let n=t.aPitchAlign.currentIndex;t.aPitchAlign[n++]=d,t.aPitchAlign.currentIndex=n}if(T||P){let n=t.aRotationAlign.currentIndex;t.aRotationAlign[n++]=p,t.aRotationAlign.currentIndex=n}if(U||S){let n=t.aRotation.currentIndex;t.aRotation[n++]=9362*y,t.aRotation.currentIndex=n}const H=j||_,R=N||O;if(H||R){const n=(H?8:0)+4*m,e=(R?2:0)+g;let r=t.aOverlap.currentIndex;t.aOverlap[r++]=n+e,t.aOverlap.currentIndex=r}i>0&&(this.properties.hasHalo=1)}_t(t,n,e){const{feature:r,symbol:i}=t,s=this.$t(t,i),o=r.properties,{markerSpacingFn:a,textSpacingFn:u,textMaxAngleFn:l}=this.it,h=((a?a(null,o):i.markerSpacing)||(u?u(null,o):i.textSpacing)||250)*e;let c=l?l(this.options.zoom,o):i.textMaxAngle;Cn(c)&&(c=80),c*=Math.PI/180;const f=this.options.EXTENT,d=this.options.altitudeToTileScale,p=this.St();return Ra(t,this.lineVertex,c,n,e,f,s,h,p,d)}$t(t,n){let e;return e=this.it.markerPlacementFn?this.it.markerPlacementFn(this.options.zoom,t.feature.properties):n.markerPlacement||this.kt,this.gt||!n.markerPlacement&&!n.isIconText||(this.gt=e),!this.kt||n.isIconText||this.vt||(this.vt=e),e}getPackSDFFormat(t){if("line"!==this.kt||t.isIconText)return[...this.getPositionFormat(),{type:Int16Array,width:2,name:"aShape"},{type:Uint16Array,width:2,name:"aTexCoord"},{type:Uint8Array,width:1,name:"aCount"}];{const t=[...this.getPositionFormat(),{type:Int16Array,width:2,name:"aShape"},{type:Uint16Array,width:2,name:"aTexCoord"},{type:Uint8Array,width:1,name:"aCount"},{type:Int16Array,width:2,name:"aGlyphOffset"},{type:Uint16Array,width:3,name:"aSegment"},{type:Uint8Array,width:1,name:"aVertical"}];return this.St()&&t.push({type:Float32Array,width:3,name:"aPitchRotation"}),t}}getPackMarkerFormat(){return[...this.getPositionFormat(),{type:Int16Array,width:2,name:"aShape"},{type:Uint16Array,width:2,name:"aTexCoord"}]}}class Ya{constructor(t){this.x=t.x,this.y=t.y,this.z=t.z||0}clone(){return new Ya(this)}T(){return this.O(this.mag()),this}O(t){return this.x/=t,this.y/=t,this.z/=t,this}U(){var t=this.y;return this.y=this.x,this.x=-t,this}mag(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}add(t){return this.clone().F(t)}sub(t){return this.clone().k(t)}F(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}k(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}mult(t){return this.clone().S(t)}S(t){return this.x*=t,this.y*=t,this.z*=t,this}dist(t){return Math.sqrt(this.distSqr(t))}distSqr(t){var n=t.x-this.x,e=t.y-this.y,r=t.z-this.z;return n*n+e*e+r*r}j(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}angleTo(t){return Math.atan2(this.y-t.y,this.x-t.x)}}const Ka=63,Za=Math.cos(Math.PI/180*37.5),Qa=Math.pow(2,16)/1,tu=new ln,nu=new ln,eu=new ln;class ru extends Go{static mergeLineFeatures(t,n,e,r){return Wa(t,n,e,r)}constructor(t,n,e){super(t,n,e);let r=!1;const{lineDasharrayFn:i,lineDashColorFn:s}=this.it;this.hasGradient=this.symbol.lineGradientProperty,i&&(r=function(t,n,e){for(let r=0;r<t.length;r++){if(e(n,t[r].properties))return!0}return!1}(t,this.options.zoom,i),r&&(this.dasharrayFn=i)),this.hasDasharray=ou(this.symbol.lineDasharray)||r,this.hasDasharray&&s&&(this.dashColorFn=s)}createStyledVector(t,n,e,r,i){const s=new qe(t,n,e,r),o=s.getLineResource();return!this.options.atlas&&o&&(i[o]=[0,0]),s}getFormat(){const{lineWidthFn:t,lineStrokeWidthFn:n,lineStrokeColorFn:e,lineColorFn:r,lineOpacityFn:i,lineDxFn:s,lineDyFn:o,linePatternAnimSpeedFn:a,linePatternGapFn:u}=this.it,l=[...this.getPositionFormat()];if(this.iconAtlas||this.hasDasharray?l.push({type:Int8Array,width:3,name:"aExtrude"}):l.push({type:Int8Array,width:2,name:"aExtrude"}),l.push({type:this.options.positionType||Uint16Array,width:1,name:"aLinesofar"}),t&&l.push({type:Uint8Array,width:1,name:"aLineWidth"}),n&&l.push({type:Uint8Array,width:1,name:"aLineStrokeWidth"}),r&&l.push({type:Uint8Array,width:4,name:"aColor"}),e&&l.push({type:Uint8Array,width:4,name:"aStrokeColor"}),i&&l.push({type:Uint8Array,width:1,name:"aOpacity"}),this.dasharrayFn&&l.push({type:Uint8Array,width:4,name:"aDasharray"}),this.dashColorFn&&l.push({type:Uint8Array,width:4,name:"aDashColor"}),this.iconAtlas){const t=this.getIconAtlasMaxValue();l.push({type:t>255?Uint16Array:Uint8Array,width:4,name:"aTexInfo"})}return(s||o)&&l.push({type:Int8Array,width:2,name:"aLineDxDy"}),(a||u)&&l.push({type:Int8Array,width:2,name:"aLinePattern"}),l}placeVector(t){const{lineJoinFn:n,lineCapFn:e,lineWidthFn:r,lineHeightFn:i,lineStrokeWidthFn:s,lineStrokeColorFn:o,lineColorFn:a,lineOpacityFn:u,lineDxFn:l,lineDyFn:h,linePatternAnimSpeedFn:c,linePatternGapFn:f}=this.it,d=this.symbol,p=t.feature,y=p.properties;this.elements;let m=d.lineJoin||"miter",v=d.lineCap||"butt";if(n&&(m=n(this.options.zoom,y)||"miter"),e&&(v=e(this.options.zoom,y)||"butt"),r){let t=r(this.options.zoom,y);g(t)&&(this.dynamicAttrs.aLineWidth=1,t=4),Ie(t)&&(t=4),this.feaLineWidth=+t}else this.feaLineWidth=+d.lineWidth;if(i){let t=i(this.options.zoom,y);g(t)&&(this.dynamicAttrs.aLineHeight=1),Ie(t)&&(t=this.feaLineWidth),this.feaLineHeight=+t}else this.feaLineHeight=+d.lineHeight||this.feaLineWidth;if(s){let t=s(this.options.zoom,y);g(t)&&(this.dynamicAttrs.aLineStrokeWidth=1,t=0),Ie(t)&&(t=0),this.feaLineStrokeWidth=t}else this.feaLineStrokeWidth=d.lineStrokeWidth||0;if(a&&(this.feaColor=a(this.options.zoom,y)||[255,255,255,255],g(this.feaColor)?(this.dynamicAttrs.aColor=1,this.feaColor=[0,0,0,0]):this.feaColor=He([],this.feaColor)),o&&(this.feaStrokeColor=o(this.options.zoom,y)||[0,0,0,255],g(this.feaStrokeColor)?(this.dynamicAttrs.aStrokeColor=1,this.feaStrokeColor=[0,0,0,0]):this.feaStrokeColor=He([],this.feaStrokeColor)),u){let t=u(this.options.zoom,y);g(t)&&(this.dynamicAttrs.aOpacity=1,t=1),Ie(t)&&(t=1),this.feaOpacity=255*t}if(this.dasharrayFn){let t=this.dasharrayFn(this.options.zoom,y)||[0,0,0,0];if(g(t)&&(this.dynamicAttrs.aDasharray=1,t=[0,0,0,0]),t.length<4){const n=t;1===t.length?t=[n[0],n[0],n[0],n[0]]:2===t.length?t=[n[0],n[1],n[0],n[1]]:3===t.length&&(t=[n[0],n[1],n[2],n[2]])}this.feaDash=t}if(this.dashColorFn){let t=(this.dashColorFn?this.dashColorFn(this.options.zoom,y):this.symbol.lineDashColor)||[0,0,0,0];g(t)&&(this.dynamicAttrs.aDashColor=1,t=[0,0,0,0]),t=He([],t),this.feaDashColor=t}if(this.iconAtlas){const n=t.getLineResource(),e=this.iconAtlas.glyphMap[n];if(this.feaTexInfo=this.feaTexInfo||[0,0,0,0],e){const{tl:t,displaySize:e}=this.iconAtlas.positions[n];this.feaTexInfo[0]=t[0]+1,this.feaTexInfo[1]=t[1]+1,this.feaTexInfo[2]=e[0]-3,this.feaTexInfo[3]=e[1]-3}else this.feaTexInfo[0]=this.feaTexInfo[1]=this.feaTexInfo[2]=this.feaTexInfo[3]=0}if(l){let t=l(this.options.zoom,y);g(t)&&(this.dynamicAttrs.aLineDxDy=1,t=0),Ie(t)&&(t=0),this.feaLineDx=t}if(h){let t=h(this.options.zoom,y);g(t)&&(this.dynamicAttrs.aLineDxDy=1,t=0),Ie(t)&&(t=0),this.feaLineDy=t}if(c){let t=c(this.options.zoom,y);g(t)&&(this.dynamicAttrs.aLinePatternAnimSpeed=1,t=0),Ie(t)&&(t=0),0!==t&&(this.properties.hasPatternAnim=1),this.feaPatternAnimSpeed=t}if(f){let t=f(this.options.zoom,y);g(t)&&(this.dynamicAttrs.aLinePatternGap=1,t=0),Ie(t)&&(t=0),this.feaLinePatternGap=t}const b=this.options.EXTENT;let w=p.geometry;if(b!==1/0){w=[];const t=[];for(let n=0;n<p.geometry.length;n++){t[0]=p.geometry[n];const e=Pa(t,-1,-1,b+1,b+1);if(3===p.type&&e.length>1){const t=e[0],n=e[e.length-1];hu(t[0],n[n.length-1])&&(e[0]=n.concat(t.slice(1)),e.length=e.length-1)}w.push(...e)}}const M=this.needAltitudeAttribute()?2:3;for(let t=0;t<w.length;t++){this.offset=this.data.aPosition.getLength()/M;const n=w[t];this.It(n,p,m,v,2,1.05)}}zt(){return this.iconAtlas&&this.feaTexInfo[2]&&this.feaTexInfo[3]}It(t,n,e,r,i,s){const o=this.zt()||ou(this.feaDash)||ou(this.symbol.lineDasharray),a=this.options.isTube;a&&(t=t.map((t=>new Ya(t)))),this.overscaling=1;const u=this.options.EXTENT;if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.prevVertex=null,this.symbol.lineGradientProperty&&n.properties&&ze(n.properties.mapbox_clip_start)&&ze(n.properties.mapbox_clip_end)){this.clipStart=+n.properties.mapbox_clip_start,this.clipEnd=+n.properties.mapbox_clip_end;for(let n=0;n<t.length-1;n++)this.totalDistance+=t[n].dist(t[n+1]);this.updateScaledDistance()}const l=3===n.type&&!t.clipped;let h=t.length;for(;h>=2&&hu(t[h-1],t[h-2]);)h--;let c=0;for(;c<h-1&&hu(t[c],t[c+1]);)c++;if(h<(l?3:2))return;"bevel"===e&&(i=1.05);const f=this.overscaling<=16?15*u/(512*this.overscaling):0,d={vertexLength:0,primitiveLength:0,currentNormal:null};let p,y,m,g,v;this.e1=this.e2=-1,l&&(p=t[h-2],v=t[c].sub(p).T().U()),this.ensureDataCapacity(e,h,360,2);for(let n=c;n<h;n++){if(m=n===h-1?l?t[c+1]:void 0:t[n+1],m&&hu(t[n],m))continue;v&&(g=v),p&&(y=p),p=t[n],m&&p.x===m.x&&p.y===m.y&&(p.x+=1e-4),v=m?m.sub(p).T().U():g,d.dir=y?p.sub(y).T():m.sub(p).T(),g=g||v,d.currentNormal=g;let u=g.add(v);0===u.x&&0===u.y||u.T();const b=g.x*v.x+g.y*v.y,w=u.x*v.x+u.y*v.y,M=0!==w?1/w:1/0,x=2*Math.sqrt(2-2*w),F=w<Za&&y&&m,k=g.x*v.y-g.y*v.x>0;if(!a&&F&&n>c){const t=p.dist(y);if(t>2*f){const n=p.sub(p.sub(y).S(f/t).j());n.z=p.z,this.updateDistance(y,n),this.addCurrentVertex(n,g,0,0,d),y=n}}const A=y&&m;d.middleVertex=A;let P=A?e:l?"butt":r;if(A&&"round"===P&&(M<s?P="miter":M<=2&&(P="fakeround")),"miter"===P&&M>i&&!a&&(P="bevel"),"bevel"===P&&(M>2&&(P="flipbevel"),M<i&&(P="miter")),y&&this.updateDistance(y,p),"miter"===P)a?(this.addCurrentVertex(p,g,0,0,d),d.dir=m.sub(p).T(),this.addCurrentVertex(p,v,0,0,d)):(u.S(M),this.addCurrentVertex(p,u,0,0,d),o&&(d.currentNormal=v,d.dir=m.sub(p).T(),this.addCurrentVertex(p,u,0,0,d)));else if("flipbevel"===P){if(M>100)u=v.mult(-1);else{const t=M*g.add(v).mag()/g.sub(v).mag();u.U().S(t*(k?-1:1))}this.addCurrentVertex(p,u,0,0,d),this.addCurrentVertex(p,u.mult(-1),0,0,d)}else if("bevel"===P||"fakeround"===P){const t=-Math.sqrt(M*M-1),n=k?t:0,e=k?0:t;if(y&&this.addCurrentVertex(p,g,n,e,d),"fakeround"===P){const t=Math.round(180*x/Math.PI/20);for(let n=1;n<t;n++){let e=n/t;if(.5!==e){const t=e-.5;e+=e*t*(e-1)*((1.0904+b*(b*(3.55645-1.43519*b)-3.2452))*t*t+(.848013+b*(.215638*b-1.06021)))}const r=v.sub(g).S(e).F(g).T().S(k?-1:1);this.addHalfVertex(p,r.x,r.y,!1,k,0,d)}}m&&(d.currentNormal=v,d.dir=m.sub(p).T(),this.addCurrentVertex(p,v,-n,-e,d))}else if("butt"===P)this.addCurrentVertex(p,u,0,0,d);else if("square"===P){const t=y?1:-1;this.addCurrentVertex(p,u,t,t,d)}else"round"===P&&(y&&(this.addCurrentVertex(p,g,0,0,d),this.addCurrentVertex(p,g,1,1,d,!0)),m&&(this.addCurrentVertex(p,v,-1,-1,d,!0),this.addCurrentVertex(p,v,0,0,d)));if(!a&&F&&n<h-1){const t=p.dist(m);if(t>2*f){const n=p.add(m.sub(p).S(f/t).j());n.z=p.z,this.updateDistance(p,n),this.addCurrentVertex(n,v,0,0,d),p=n}}}}ensureDataCapacity(t,n,e,r){const i="round"===t?Math.round(e/20)-1:0;super.ensureDataCapacity((6+i)*r,n)}addCurrentVertex(t,n,e,r,i,s=!1){const o=n.x+n.y*e,a=n.y-n.x*e,u=-n.x+n.y*r,l=-n.y-n.x*r;let h=0,c=0;if(i.middleVertex){tu.x=o,tu.y=a;const t=i.currentNormal;if(h=lu(t,tu,i.dir),0===e&&0===r)c=-h;else{const n=nu;n.x=t.x,n.y=t.y,n.S(-1),eu.x=u,eu.y=l,c=lu(n,eu,i.dir)}}this.addHalfVertex(t,o,a,s,!1,e,i,h),this.addHalfVertex(t,u,l,s,!0,-r,i,c),this.prevVertex&&hu(t,this.prevVertex)||(this.prevVertex=t),this.distance>Qa/2&&0===this.totalDistance&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,n,e,r,i,s))}addHalfVertex({x:t,y:n,z:e},r,i,s,o,a,u,l){const h=1*this.scaledDistance;this.fillData(this.data,t,n,e||0,r,i,s,o,h,l);const c=u.vertexLength++;this.e1>=0&&this.e2>=0&&(this.addElements(this.e1,this.e2,c),u.primitiveLength++),o?this.e2=c:this.e1=c}fillData(t,n,e,r,i,s,o,a,u,l){const{lineWidthFn:h,lineStrokeWidthFn:c,lineStrokeColorFn:f,lineColorFn:d,lineOpacityFn:p,lineDxFn:y,lineDyFn:m,linePatternAnimSpeedFn:g,linePatternGapFn:v}=this.it;this.fillPosition(t,n,e,r);let b=Ka*i;b=(Math.sign(b)||1)*((Math.floor(Math.abs(b))>>1<<1)+ +o);let w=Ka*s;w=(Math.sign(w)||1)*((Math.floor(Math.abs(w))>>1<<1)+ +a);let M=t.aExtrude.currentIndex;t.aExtrude[M++]=b,t.aExtrude[M++]=w,(this.iconAtlas||this.hasDasharray)&&(t.aExtrude[M++]=Ka*l),t.aExtrude.currentIndex=M,M=t.aLinesofar.currentIndex,t.aLinesofar[M++]=u,t.aLinesofar.currentIndex=M,h&&(M=t.aLineWidth.currentIndex,t.aLineWidth[M++]=Math.round(2*this.feaLineWidth),t.aLineWidth.currentIndex=M),c&&(M=t.aLineStrokeWidth.currentIndex,t.aLineStrokeWidth[M++]=Math.round(2*this.feaLineStrokeWidth),t.aLineStrokeWidth.currentIndex=M),d&&(M=t.aColor.currentIndex,t.aColor[M++]=this.feaColor[0],t.aColor[M++]=this.feaColor[1],t.aColor[M++]=this.feaColor[2],t.aColor[M++]=this.feaColor[3],t.aColor.currentIndex=M),f&&(M=t.aStrokeColor.currentIndex,t.aStrokeColor[M++]=this.feaStrokeColor[0],t.aStrokeColor[M++]=this.feaStrokeColor[1],t.aStrokeColor[M++]=this.feaStrokeColor[2],t.aStrokeColor[M++]=this.feaStrokeColor[3],t.aStrokeColor.currentIndex=M),p&&(M=t.aOpacity.currentIndex,t.aOpacity[M++]=this.feaOpacity,t.aOpacity.currentIndex=M),this.dasharrayFn&&(M=t.aDasharray.currentIndex,t.aDasharray[M++]=this.feaDash[0],t.aDasharray[M++]=this.feaDash[1],t.aDasharray[M++]=this.feaDash[2],t.aDasharray[M++]=this.feaDash[3],t.aDasharray.currentIndex=M),this.dashColorFn&&(M=t.aDashColor.currentIndex,t.aDashColor[M++]=this.feaDashColor[0],t.aDashColor[M++]=this.feaDashColor[1],t.aDashColor[M++]=this.feaDashColor[2],t.aDashColor[M++]=this.feaDashColor[3],t.aDashColor.currentIndex=M),this.iconAtlas&&(M=t.aTexInfo.currentIndex,t.aTexInfo[M++]=this.feaTexInfo[0],t.aTexInfo[M++]=this.feaTexInfo[1],t.aTexInfo[M++]=this.feaTexInfo[2],t.aTexInfo[M++]=this.feaTexInfo[3],t.aTexInfo.currentIndex=M),(y||m)&&(M=t.aLineDxDy.currentIndex,t.aLineDxDy[M++]=this.feaLineDx||0,t.aLineDxDy[M++]=this.feaLineDy||0,t.aLineDxDy.currentIndex=M),(g||v)&&(M=t.aLinePattern.currentIndex,t.aLinePattern[M++]=127*(this.feaPatternAnimSpeed||0),t.aLinePattern[M++]=10*(this.feaLinePatternGap||0),t.aLinePattern.currentIndex=M),this.maxPos=Math.max(this.maxPos,Math.abs(n)+1,Math.abs(e)+1)}addElements(t,n,e){super.addElements(this.offset+t,this.offset+n,this.offset+e)}Dt(t){const n=this.options.EXTENT,e=this.elements;for(let r=0;r<e.length;r+=3)if(n===1/0||!su(this.data.aPosition,e[r],e[r+1],3,n)&&!su(this.data.aPosition,e[r+1],e[r+2],3,n)){let n=t.currentIndex;t[n++]=e[r],t[n++]=e[r+1],t[n++]=e[r+2],t.currentIndex=n}}Tt(t){if(t.length<=1)return t;const n=[],e=this.options.EXTENT;let r,i=!0;for(r=0;r<t.length-1;r++){const s=iu(t[r],t[r+1],e);s&&i||(n.push(t[r]),i=s)}return i||n.push(t[r]),n}updateDistance(t,n){if(this.options.isTube){const e=t.dist(n),r=function(t){const{verticalCentimeterToPoint:n,tileRatio:e}=t;return n*e}(this.options)*(n.z-t.z);this.distance+=Math.sqrt(e*e+r*r)}else this.distance+=t.dist(n);this.updateScaledDistance()}updateScaledDistance(){this.scaledDistance=this.totalDistance>0?(this.clipStart+(this.clipEnd-this.clipStart)*this.distance/this.totalDistance)*(Qa-1):this.distance}}function iu(t,n,e){return e!==1/0&&(t.x<0&&n.x<0||t.x>e&&n.x>e||t.y<0&&n.y<0||t.y>e&&n.y>e)}function su(t,n,e,r,i){if(i===1/0)return!1;const s=Math.floor(.5*t[n*r]),o=Math.floor(.5*t[n*r+1]),a=Math.floor(.5*t[e*r]),u=Math.floor(.5*t[e*r+1]);return s===a&&(s<0||s>i)&&o!==u||o===u&&(o<0||o>i)&&s!==a}function ou(t){if(!Array.isArray(t))return!1;for(let n=0;n<t.length;n++)if(t[n])return!0;return!1}const au=[],uu=[];function lu(t,n,e){const r=t.mag(),i=n.mag();wt(au,e.x,e.y),wt(uu,n.x,n.y);const s=(a=uu,(o=au)[0]*a[0]+o[1]*a[1]);var o,a;return-Math.sign(s)*Math.sqrt(i*i-r*r)}function hu(t,n){return t.equals(n)&&t.z===n.z}var cu="undefined"!=typeof Float32Array?Float32Array:Array;function fu(){var t=new cu(3);return cu!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function du(t,n,e){var r=new cu(3);return r[0]=t,r[1]=n,r[2]=e,r}function pu(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t}function yu(t,n,e,r){return t[0]=n,t[1]=e,t[2]=r,t}function mu(t,n,e){return t[0]=n[0]+e[0],t[1]=n[1]+e[1],t[2]=n[2]+e[2],t}function gu(t,n){var e=n[0],r=n[1],i=n[2],s=e*e+r*r+i*i;return s>0&&(s=1/Math.sqrt(s),t[0]=n[0]*s,t[1]=n[1]*s,t[2]=n[2]*s),t}function vu(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}function bu(t,n,e){var r=n[0],i=n[1],s=n[2],o=e[0],a=e[1],u=e[2];return t[0]=i*u-s*a,t[1]=s*o-r*u,t[2]=r*a-i*o,t}var wu=function(t,n,e){return t[0]=n[0]-e[0],t[1]=n[1]-e[1],t[2]=n[2]-e[2],t};function Mu(){var t=new cu(4);return cu!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function xu(t,n){var e=n[0]+n[4]+n[8],r=void 0;if(e>0)r=Math.sqrt(e+1),t[3]=.5*r,r=.5/r,t[0]=(n[5]-n[7])*r,t[1]=(n[6]-n[2])*r,t[2]=(n[1]-n[3])*r;else{var i=0;n[4]>n[0]&&(i=1),n[8]>n[3*i+i]&&(i=2);var s=(i+1)%3,o=(i+2)%3;r=Math.sqrt(n[3*i+i]-n[3*s+s]-n[3*o+o]+1),t[i]=.5*r,r=.5/r,t[3]=(n[3*s+o]-n[3*o+s])*r,t[s]=(n[3*s+i]+n[3*i+s])*r,t[o]=(n[3*o+i]+n[3*i+o])*r}return t}!function(){var t=fu()}(),function(){var t,n=(t=new cu(4),cu!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();var Fu,ku=function(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t[3]=n[3]*e,t},Au=function(t,n){var e=n[0],r=n[1],i=n[2],s=n[3],o=e*e+r*r+i*i+s*s;return o>0&&(o=1/Math.sqrt(o),t[0]=e*o,t[1]=r*o,t[2]=i*o,t[3]=s*o),t};fu(),du(1,0,0),du(0,1,0),Mu(),Mu(),Fu=new cu(9),cu!=Float32Array&&(Fu[1]=0,Fu[2]=0,Fu[3]=0,Fu[5]=0,Fu[6]=0,Fu[7]=0),Fu[0]=1,Fu[4]=1,Fu[8]=1;\n/*!\n     * Contains code from google filament\n     * https://github.com/google/filament/\n     * License Apache-2.0\n     */\nconst Pu=8,Su=[],_u=[],Ou=[],Cu=[];function Eu(t,n,e){const r=bu(_u,n,e),i=function(t,n,e,r,i,s,o,a,u,l){return t[0]=n,t[1]=e,t[2]=r,t[3]=i,t[4]=s,t[5]=o,t[6]=a,t[7]=u,t[8]=l,t}(Su,e[0],e[1],e[2],...r,...n);t=xu(t,i),t=function(t){return t[3]<0?ku(t,t,-1):t}(t=Au(t,t));const s=1/((1<<2*Pu-1)-1);if(t[3]<s){t[3]=s;const n=Math.sqrt(1-s*s);t[0]*=n,t[1]*=n,t[2]*=n}const o=e[3]>0?bu(Ou,e,n):bu(Ou,n,e);return vu(bu(Cu,e,n),o)<0&&ku(t,t,-1),t}const $u=[];function Iu(t,n,e){const r=e||[];r.setLength&&r.setLength(t.length);const i=$u;i.length<t.length/3&&(i.length=t.length/3),i.fill(0,0,t.length/3);const s=void 0===n.length?n:n.length;for(let e=0;e<s/3;e++)void 0===n.length?Hu(t,3*e,3*e+1,3*e+2,r,i):Hu(t,n[3*e],n[3*e+1],n[3*e+2],r,i);const o=r.getLength?r.getLength():r.length;for(let t=0;t<o;t+=3){const n=i[t/3];0!==n?(r[t]/=n,r[t+1]/=n,r[t+2]/=n):(r[t]=0,r[t+1]=0,r[t+2]=0)}return r}const zu=[],Du=[],Tu=[],Uu=[],ju=[],Nu=[],Lu=[];function Hu(t,n,e,r,i,s){yu(Uu,t[3*n],t[3*n+1],t[3*n+2]),yu(ju,t[3*e],t[3*e+1],t[3*e+2]),yu(Nu,t[3*r],t[3*r+1],t[3*r+2]);const o=wu(zu,Nu,ju),a=wu(Du,Uu,ju),u=bu(Tu,o,a);gu(Lu,u),i[3*n]=i[3*n]||0,i[3*e]=i[3*e]||0,i[3*r]=i[3*r]||0,i[3*n+1]=i[3*n+1]||0,i[3*e+1]=i[3*e+1]||0,i[3*r+1]=i[3*r+1]||0,i[3*n+2]=i[3*n+2]||0,i[3*e+2]=i[3*e+2]||0,i[3*r+2]=i[3*r+2]||0,i[3*n]+=Lu[0],i[3*e]+=Lu[0],i[3*r]+=Lu[0],i[3*n+1]+=Lu[1],i[3*e+1]+=Lu[1],i[3*r+1]+=Lu[1],i[3*n+2]+=Lu[2],i[3*e+2]+=Lu[2],i[3*r+2]+=Lu[2],s[n]+=1,s[e]+=1,s[r]+=1}\n/*!\n     * Contains code from THREE.JS\n     * https://github.com/mrdoob/three.js/\n     * License MIT\n     *\n     * Generate tangents per vertex.\n     */function Ru(t,n,e){return t[0]=n[e],t[1]=n[e+1],t[2]=n[e+2],t}function Vu(t,n,e){return t[0]=n[e],t[1]=n[e+1],t}class qu extends ru{constructor(t,n,e){super(t,n,e),this.Ut=e.altitudeProperty}getFormat(){const{lineColorFn:t,lineWidthFn:n}=this.it,e=[{type:this.maxPosZ>=Math.pow(2,15)?Float32Array:Int16Array,width:3,name:"aPosition"},{type:Uint16Array,width:1,name:"aLinesofar"},{type:Uint8Array,width:1,name:"aUp"},{type:Int16Array,width:3,name:"aExtrudedPosition"},{type:Int8Array,width:2,name:"aExtrude"}];return t&&e.push({type:Uint8Array,width:4,name:"aColor"}),n&&e.push({type:Uint8Array,width:1,name:"aLineWidth"}),this.Ut&&e.push({type:Float32Array,width:1,name:"aLineHeight"}),e}placeVector(t){const n=t.feature;if(this.Ut){const{altitudeScale:t,altitudeProperty:e,defaultAltitude:r,heightProperty:i,defaultHeight:s,minHeightProperty:o}=this.options,{altitude:a,height:u}=_n(n,t,e,r,i,s,o);this.feaAltitude=a,this.feaMinHeight=(a-u)/a*32767,a>this.maxAltitude&&(this.maxAltitude=a)}return super.placeVector(t)}needAltitudeAttribute(){return!1}It(t,n,e,r,i,s){const o=this.data.aPosition.getLength()/3;super.It(t,n,e,r,i,s);const a=this.data.aPosition.getLength()/3,u=this.data.aPosition.getLength()/3-this.offset,l=3===n.type,h=!1!==this.options.side;if(!l&&u>0&&h){const t=!1!==this.options.top?1:0,n=t+4;let e=this.data.aPosition.getLength()/3;for(const t in this.data){const n=this.data[t],r=n.getLength()/e;let i=n.currentIndex;for(let t=0;t<r;t++)n[i++]=n[o*r+3*r+t];n.currentIndex=i}e=this.data.aPosition.getLength()/3;for(const t in this.data){const r=this.data[t],i=r.getLength()/e;let s=r.currentIndex;for(let t=0;t<i;t++)r[s++]=r[o*i+i*n+t];r.currentIndex=s}e=this.data.aPosition.getLength()/3;for(const t in this.data){const r=this.data[t],i=r.getLength()/e;let s=r.currentIndex;for(let t=0;t<i;t++)r[s++]=r[o*i+i*(n+3)+t];r.currentIndex=s}super.addElements(t+1,u+1,u),super.addElements(u,u+1,u+2);const r=this.data.aPosition.getLength()/3-this.offset;e=this.data.aPosition.getLength()/3;for(const t in this.data){const n=this.data[t],r=n.getLength()/e;let i=n.currentIndex;for(let t=0;t<r;t++)n[i++]=n[a*r-r+t];n.currentIndex=i}e=this.data.aPosition.getLength()/3;for(const t in this.data){const r=this.data[t],i=r.getLength()/e;let s=r.currentIndex;for(let t=0;t<i;t++)r[s++]=r[a*i-n*i-i+t];r.currentIndex=s}e=this.data.aPosition.getLength()/3;for(const t in this.data){const r=this.data[t],i=r.getLength()/e;let s=r.currentIndex;for(let t=0;t<i;t++)r[s++]=r[a*i-n*i-3*i+t];r.currentIndex=s}super.addElements(r,u-3,r+1),super.addElements(u-3,r+2,r+1)}}fillData(t,n,e,r,i,s,o,a,u){const l=!1!==this.options.top,h=!1!==this.options.side,c=this.options.EXTENT/this.options.tileSize,f=this.feaLineWidth||this.symbol.lineWidth/2*c,d=Ka*i,p=Ka*s,y=f*i+n,m=f*s+e;this.jt(t,n,e,i,s,o,a,u,y,m,d,p),h&&(l&&this.jt(t,n,e,i,s,o,a,u,y,m,d,p),this.jt(t,n,e,i,s,o,a,u,y,m,d,p),this.Nt(t,n,e,i,s,o,a,u,y,m,d,p),this.Nt(t,n,e,i,s,o,a,u,y,m,d,p)),this.maxPos=Math.max(this.maxPos,Math.abs(n),Math.abs(e))}jt(t,n,e,r,i,s,o,a,u,l,h,c){const{lineColorFn:f,lineWidthFn:d}=this.it;let p=t.aPosition.currentIndex;t.aPosition[p++]=n,t.aPosition[p++]=e,t.aPosition[p++]=32767,t.aPosition.currentIndex=p,p=t.aLinesofar.currentIndex,t.aLinesofar[p++]=a,t.aLinesofar.currentIndex=p,p=t.aUp.currentIndex,t.aUp[p++]=+o,t.aUp.currentIndex=p,p=t.aExtrudedPosition.currentIndex,t.aExtrudedPosition[p++]=u,t.aExtrudedPosition[p++]=l,t.aExtrudedPosition[p++]=1,t.aExtrudedPosition.currentIndex=p,p=t.aExtrude.currentIndex,t.aExtrude[p++]=h,t.aExtrude[p++]=c,t.aExtrude.push(h,c),f&&(p=t.aColor.currentIndex,t.aColor[p++]=this.feaColor[0],t.aColor[p++]=this.feaColor[1],t.aColor[p++]=this.feaColor[2],t.aColor[p++]=this.feaColor[3],t.aColor.currentIndex=p),d&&(p=t.aLineWidth.currentIndex,t.aLineWidth[p++]=Math.round(2*this.feaLineWidth),t.aLineWidth.currentIndex=p),this.Ut&&(p=t.aLineHeight.currentIndex,t.aLineHeight[p++]=this.feaAltitude,t.aLineHeight.currentIndex=p)}Nt(t,n,e,r,i,s,o,a,u,l,h,c){const{lineColorFn:f,lineWidthFn:d}=this.it;let p=t.aPosition.currentIndex;t.aPosition[p++]=n,t.aPosition[p++]=e,t.aPosition[p++]=this.feaMinHeight||0,t.aPosition.currentIndex=p,p=t.aLinesofar.currentIndex,t.aLinesofar[p++]=a,t.aLinesofar.currentIndex=p,p=t.aUp.currentIndex,t.aUp[p++]=+o,t.aUp.currentIndex=p,p=t.aExtrudedPosition.currentIndex,t.aExtrudedPosition[p++]=u,t.aExtrudedPosition[p++]=l,t.aExtrudedPosition[p++]=1,t.aExtrudedPosition.currentIndex=p,p=t.aExtrude.currentIndex,t.aExtrude[p++]=h,t.aExtrude[p++]=c,t.aExtrude.push(h,c),f&&(p=t.aColor.currentIndex,t.aColor[p++]=this.feaColor[0],t.aColor[p++]=this.feaColor[1],t.aColor[p++]=this.feaColor[2],t.aColor[p++]=this.feaColor[3],t.aColor.currentIndex=p),d&&(p=t.aLineWidth.currentIndex,t.aLineWidth[p++]=Math.round(2*this.feaLineWidth),t.aLineWidth.currentIndex=p),this.Ut&&(p=t.aLineHeight.currentIndex,t.aLineHeight[p++]=this.feaAltitude,t.aLineHeight.currentIndex=p)}addElements(t,n,e){const r=!1!==this.options.top,i=!1!==this.options.side,s=(r?1:0)+(i?4:0),o=this.offset;t*=s,n*=s,e*=s;if(this.data.aUp[o+e+4]){if(r&&super.addElements(n,t,e),i){const t=r?1:0;super.addElements(n+t,e+t,e+t+2),super.addElements(n+t+1,e+t+1+2,n+t+1+2)}}else if(r&&super.addElements(t,e,n),i){const n=r?1:0;super.addElements(t+n,t+n+2,e+n),super.addElements(t+n+1+2,e+n+1+2,e+n+1)}}createDataPack(t,n){this.maxAltitude=0;const e=super.createDataPack(t,n);if(!e)return e;const{data:r,indices:i}=e;this.getFormat().reduce(((t,n)=>(t[n.name]={size:n.width},t)),{}).aPickingId={size:1};const{aExtrudedPosition:s,aPosition:o,aLinesofar:a,aUp:u,aExtrude:l,aColor:h,aLineHeight:c,aLineWidth:f}=r,d={},p=Iu(s,i);let y,m=!0;for(let t=0;t<p.length;t++)p[t]=-p[t],p[t]%1!=0&&(m=!1);if(!1!==this.options.top&&this.symbol.material&&function(t){for(const n in t)if(n.indexOf("Texture")>=0&&t[n])return!0;return!1}(this.symbol.material)&&(y=function(t,n,e){const r=256,i=[];for(let s=0;s<t.length;s+=3){const t=n[s/3];e[s/3]?i.push(t/r,1):i.push(t/r,0)}return i}(s,a,u)),d.aPosition=o,y&&(d.aTexCoord0=new Float32Array(y)),d.aNormal=m?new Int8Array(p):new Float32Array(p),d.aPickingId=r.aPickingId,d.aExtrude=l,h&&(d.aColor=h),f&&(d.aLineWidth=f),c){const t=Nn(this.maxAltitude);d.aLineHeight=new t(c)}const g=[];for(const t in d)g.push(d[t].buffer);return e.data=d,e.buffers=g,e}}const Gu=Math.pow(2,16)/1;class Ju extends Go{getFormat(){return[...this.getPositionFormat()]}placeVector(t){const n=t.feature,e=3===n.type,r=n.geometry,i=this.elements;e&&(this.elements=this.ft.get());const s=this.needAltitudeAttribute()?2:3;for(let t=0;t<r.length;t++)this.offset=this.data.aPosition.getLength()/s,this.It(r[t],n),e&&(this.Dt(i),this.elements=this.ft.get());e&&(this.elements=i)}It(t,n){const e=3===n.type;let r=t.length;for(;r>=2&&t[r-1].equals(t[r-2]);)r--;let i,s,o,a=0;for(;a<r-1&&t[a].equals(t[a+1]);)a++;if(!(r<(e?3:2))){this.distance=0,this.vertexLength=0,this.primitiveLength=0,this.e1=this.e2=this.e3=-1,e&&(i=t[r-2]);for(let n=a;n<r;n++)o=e&&n===r-1?t[a+1]:t[n+1],o&&t[n].equals(o)||(i&&(s=i),i=t[n],s&&(this.distance+=i.dist(s)),this.addCurrentVertex(i,this.distance))}}addCurrentVertex(t,n){const e=this.vertexLength++;this.addLineVertex(this.data,t,n),e>=1&&this.addElements(e-1,e),n>Gu&&(this.distance=0,this.addCurrentVertex(t,this.distance))}addLineVertex(t,n){this.fillPosition(t,n.x,n.y,n.z||0),this.maxPos=Math.max(this.maxPos,Math.abs(n.x),Math.abs(n.y))}addElements(t,n){this.maxIndex=Math.max(this.maxIndex,this.offset+t,this.offset+n);let e=this.elements.currentIndex;this.elements[e++]=this.offset+t,this.elements[e++]=this.offset+n,this.elements.currentIndex=e}Dt(t){const n=this.options.EXTENT,e=this.elements,r=e.getLength();for(let i=0;i<r;i+=2)if(!Pn(this.data.aPosition,e[i],e[i+1],3,n)){let n=t.currentIndex;t[n++]=e[i],t[n++]=e[i+1],t.currentIndex=n}}}const Wu=45*Math.PI/100;class Bu extends Go{getFormat(){const{markerFillFn:t}=this.it;let n;return n="line"===this.symbol.markerRotationAlignment?[...this.getPositionFormat(),{type:Float32Array,width:1,name:"aXYRotation"},{type:Float32Array,width:1,name:"aZRotation"}]:[...this.getPositionFormat()],t&&n.push({type:Uint8Array,width:4,name:"aColor"}),n}placeVector(t){const n=t.feature.properties,{markerFillFn:e}=this.it;let r;e&&(r=e(this.options.zoom,n)||[255,255,255,255],g(r)?(this.dynamicAttrs.aColor=1,r=[0,0,0,0]):r=He([],r));const i=this.data,s=this.symbol.markerSpacing||250,o=this.symbol.markerPlacement||"point",a="line"===this.symbol.markerRotationAlignment,u=this._t(t,s,o,a);for(let t=0;t<u.length;t++){const n=u[t];if(this.fillPosition(this.data,n.x,n.y,n.z),a){let t=i.aXYRotation.currentIndex;i.aXYRotation[t++]=n.xyRotation||0,i.aXYRotation.currentIndex=t,t=i.aZRotation.currentIndex,i.aZRotation[t++]=n.zRotation||0,i.aZRotation.currentIndex=t}if(r){let t=i.aColor.currentIndex;i.aColor[t++]=r[0],i.aColor[t++]=r[1],i.aColor[t++]=r[2],i.aColor[t++]=r[3],i.aColor.currentIndex=t}const e=Math.max(Math.abs(n.x),Math.abs(n.y));e>this.maxPos&&(this.maxPos=e)}}_t(t,n,e,r){const i=t.feature,s=this.options.EXTENT;if("line"===e){const t=[];let e=i.geometry;s&&(e=Pa(i.geometry,0,0,s,s));for(let r=0;r<e.length;r++){const i=Oa(e[r],n,Wu,null,0,24,1,1,s||1/0);t.push.apply(t,i)}return t}return Va(i,e,s,r,this.options.altitudeToTileScale)}hasElements(){return!1}}\n/*!\n     * from @turf/bboxClip\n     * https://github.com/Turfjs/turf\n     * MIT LICENSE\n     */const Xu=[],Yu=[];function Ku(t,n){var e,r,i,s,o,a,u;for(r=1;r<=8;r*=2){for(e=[],s=!(Qu(i=t[t.length-1],n)&r),o=0;o<t.length;o++){if((u=!(Qu(a=t[o],n)&r))!==s){const t=Zu(i,a,r,n);void 0!==a.x?e.push(new ln(t[0],t[1])):e.push(t)}u&&e.push(a),i=a,s=u}if(!(t=e).length)break}return e}function Zu(t,n,e,r){return Xu[0]=void 0===t.x?t[0]:t.x,Xu[1]=void 0===t.y?t[1]:t.y,t=Xu,Yu[0]=void 0===n.x?n[0]:n.x,Yu[1]=void 0===n.y?n[1]:n.y,n=Yu,8&e?[t[0]+(n[0]-t[0])*(r[3]-t[1])/(n[1]-t[1]),r[3]]:4&e?[t[0]+(n[0]-t[0])*(r[1]-t[1])/(n[1]-t[1]),r[1]]:2&e?[r[2],t[1]+(n[1]-t[1])*(r[2]-t[0])/(n[0]-t[0])]:1&e?[r[0],t[1]+(n[1]-t[1])*(r[0]-t[0])/(n[0]-t[0])]:null}function Qu(t,n){Xu[0]=void 0===t.x?t[0]:t.x,Xu[1]=void 0===t.y?t[1]:t.y;var e=0;return(t=Xu)[0]<n[0]?e|=1:t[0]>n[2]&&(e|=2),t[1]<n[1]?e|=4:t[1]>n[3]&&(e|=8),e}const tl=[0,0,0,0],nl=-9999999;class el extends Go{constructor(...t){super(...t),this.lineElements=[]}createStyledVector(t,n,e,r,i){const s=new qe(t,n,e,r),o=s.getPolygonResource();return!this.options.atlas&&o&&(i[o]=[0,0]),s}getFormat(){const t=[...this.getPositionFormat()],{polygonFillFn:n,polygonOpacityFn:e,uvScaleFn:r,uvOffsetFn:i,polygonPatternUVFn:s}=this.it;if(this.iconAtlas){const n=this.getIconAtlasMaxValue();t.push({type:n>255?Uint16Array:Uint8Array,width:4,name:"aTexInfo"})}return n&&t.push({type:Uint8Array,width:4,name:"aColor"}),e&&t.push({type:Uint8Array,width:1,name:"aOpacity"}),r&&t.push({type:Uint16Array,width:2,name:"aUVScale"}),i&&t.push({type:Uint8Array,width:2,name:"aUVOffset"}),s&&t.push({type:Float32Array,width:2,name:"aTexCoord"}),t}placeVector(t,n){const e=t.feature,r=e.geometry;this.Lt(r,e,n)}Lt(t,n){let e,r,i,s;const{polygonFillFn:o,polygonOpacityFn:a,uvScaleFn:u,uvOffsetFn:l,uvOffsetInMeterFn:h,polygonPatternUVFn:c}=this.it,f=n.properties;o&&(e=o(this.options.zoom,f)||gt([],255,255,255,255),g(e)?(this.dynamicAttrs.aColor=1,e=tl):e=He([],e)),a&&(r=a(this.options.zoom,f),g(r)?(this.dynamicAttrs.aOpacity=1,r=255):(Ie(r)&&(r=1),r*=255)),u&&(i=u(this.options.zoom,f),g(i)?(i=[255,255],this.dynamicAttrs.aUVScale=1):(Ie(i)&&(i=[1,1]),i=[255*i[0],255*i[1]])),l&&(h&&h(null,f)?s=[0,0]:(s=l(this.options.zoom,f),g(s)?(s=[0,0],this.dynamicAttrs.aUVOffset=1):(Ie(s)&&(s=[0,0]),s=[255*s[0],255*s[1]])));const d=!!this.iconAtlas,p=za(t,500),y=[0,0],m=[0,0];if(d){const{polygonPatternFileFn:t}=this.it,n=t?t(null,f):this.symbol.polygonPatternFile;if(this.iconAtlas.glyphMap[n]){const t=this.iconAtlas.positions[n],e=!In(t.displaySize[0])||!In(t.displaySize[1]);y[0]=t.tl[0]+(e?1:0),y[1]=t.tl[1]+(e?1:0),m[0]=t.displaySize[0]-1-(e?2:0),m[1]=t.displaySize[1]-1-(e?2:0)}}let v,b=0;c&&(v=c(this.options.zoom,f));const w=this.needAltitudeAttribute()?2:3,M=[-1,-1,n.extent+1,n.extent+1],x=this.Ht=this.Ht||this.ft.getProxy(),F=this.Rt=this.Rt||this.ft.getProxy();for(let t=0;t<p.length;t++){const n=p[t],o=this.data.aPosition.getLength()/w;x.setLength(0),F.setLength(0);for(let t=0;t<n.length;t++){let o=n[t];if(this.options.EXTENT!==1/0&&0===this.maxPosZ&&(o=Ku(o,M)),0===o.length)continue;0!==t&&F.push(x.length/3),this.ensureDataCapacity(o.length);const a=this.data;for(let t=0;t<o.length;t++){const n=o[t].x,u=o[t].y,l=o[t].z||0;if(this.fillPosition(this.data,n,u,l),d){let t=a.aTexInfo.currentIndex;a.aTexInfo[t++]=y[0],a.aTexInfo[t++]=y[1],a.aTexInfo[t++]=m[0],a.aTexInfo[t++]=m[1],a.aTexInfo.currentIndex=t}if(void 0!==e){let t=a.aColor.currentIndex;a.aColor[t++]=e[0],a.aColor[t++]=e[1],a.aColor[t++]=e[2],a.aColor[t++]=e[3],a.aColor.currentIndex=t}if(void 0!==r){let t=a.aOpacity.currentIndex;a.aOpacity[t++]=r,a.aOpacity.currentIndex=t}if(void 0!==i){let t=a.aUVScale.currentIndex;a.aUVScale[t++]=i[0],a.aUVScale[t++]=i[1],a.aUVScale.currentIndex=t}if(void 0!==s){let t=a.aUVOffset.currentIndex;a.aUVOffset[t++]=s[0],a.aUVOffset[t++]=s[1],a.aUVOffset.currentIndex=t}if(c){let t=a.aTexCoord.currentIndex;if(v){const n=Ie(v[2*b])?v[0]:v[2*b],e=Ie(v[2*b]+1)?v[1]:v[2*b+1];a.aTexCoord[t++]=n,a.aTexCoord[t++]=e}else a.aTexCoord[t++]=nl,a.aTexCoord[t++]=nl;a.aTexCoord.currentIndex=t,b++}const h=Math.abs(n),f=Math.abs(u);h>this.maxPos&&(this.maxPos=h),f>this.maxPos&&(this.maxPos=f),x.push(n,u,l)}}let a=on(x,F,3);if(x.length&&!a.length){const t=[];for(let n=0;n<x.length;n+=3)t[n]=x[n],t[n+1]=x[n+2],t[n+2]=x[n+1];if(a=on(t,F,3),!a.length){for(let n=0;n<x.length;n+=3)t[n]=x[n+1],t[n+1]=x[n+2],t[n+2]=x[n];a=on(t,F,3)}}for(let t=0;t<a.length;t+=3)this.addElements(o+a[t],o+a[t+1],o+a[t+2])}}ensureDataCapacity(t){super.ensureDataCapacity(1,t)}}const rl=[{type:Int16Array,width:3,name:"aPosition"}];class il extends Go{getFormat(){return rl}placeVector(t,n){const e=this._t(t,n);if(0===e.length)return;const r=this.data,i=this.getAltitude(t.feature.properties);let s=r.aPosition.getLength()/rl[0].width;for(let t=0;t<e.length;t++){const n=e[t];r.aPosition.push(2*n.x+0,2*n.y+0,i),r.aPosition.push(2*n.x+1,2*n.y+0,i),r.aPosition.push(2*n.x+1,2*n.y+1,i),r.aPosition.push(2*n.x+0,2*n.y+1,i),this.addElements(s,s+1,s+2),this.addElements(s,s+2,s+3),s+=4;const o=Math.max(Math.abs(2*n.x+1),Math.abs(2*n.y+1));o>this.maxPos&&(this.maxPos=o)}}_t(t,n){const{feature:e,symbol:r}=t,i=this.$t(t,r),s=e.properties,{markerSpacingFn:o}=this.it,a=((o?o(null,s):r.markerSpacing)||250)*n;return Ra(t,null,null,n,this.options.EXTENT,i,a)}$t(t,n){return this.it.markerPlacementFn?this.it.markerPlacementFn(this.options.zoom,t.feature.properties):n.markerPlacement}}class sl extends ru{constructor(t,n,e){(n=$e({},n)).lineJoin="miter",n.lineCap="butt",super(t,n,e),this.options.radialSegments%2==1&&this.options.radialSegments--}getFormat(){const{lineWidthFn:t,lineColorFn:n,lineOpacityFn:e,linePatternAnimSpeedFn:r,linePatternGapFn:i}=this.it,s=[...this.getPositionFormat(),{type:Int8Array,width:4,name:"aTubeNormal"},{type:this.options.positionType||Uint16Array,width:1,name:"aLinesofar"}];if(this.iconAtlas){s.push({type:Int8Array,width:1,name:"aNormalDistance"});const t=this.getIconAtlasMaxValue();s.push({type:t>255?Uint16Array:Uint8Array,width:4,name:"aTexInfo"})}return t&&s.push({type:Uint16Array,width:1,name:"aLineWidth"}),n&&s.push({type:Uint8Array,width:4,name:"aColor"}),e&&s.push({type:Uint8Array,width:1,name:"aOpacity"}),r&&s.push({type:Int8Array,width:1,name:"aLinePatternAnimSpeed"}),i&&s.push({type:Int8Array,width:1,name:"aLinePatternGap"}),s}ensureDataCapacity(t,n,e,r){const i=this.options.radialSegments/2;return super.ensureDataCapacity(t,n,e,r*i)}addHalfVertex(t,n,e,r,i,s,o,a){const{x:u,y:l,z:h}=t,c=1*this.scaledDistance,f=this.options.radialSegments/2,{x:d,y:p,z:y}=o.dir,m=function(t,n,e,r,i,s,o,a){dt(ol,e,r,i),dt(al,s,o,0),yt(ul,ol,al),pt(al,al),pt(ul,ul),ll[n]||(ll[n]=[]);const u=ll[n];for(var l=0;l<n;l++){const e=Math.PI*l/n,r=0,i=1-Math.abs(e-r)/(Math.PI/2);u[l]=u[l]||[],hl(al,ul,u[l],t,e,i*(a?-1:1))}return u}(1,f,d,p,y,n,e,i);this.prevVertex&&this.fillTubeElements(i),this.fillData(this.data,u,l,h||0,m,i,c,a)}fillTubeElements(t){const n=this.options.radialSegments/2,e=this.needAltitudeAttribute()?2:3,r=this.data.aPosition.getLength()/e;for(let e=0;e<n;e++){const i=e+r,s=e+r-2*n;let o,a;e===n-1&&t?(o=e+r-2*n+1,a=e+r-2*n-2*n+1):(o=e+r+1,a=e+r+1-2*n),super.addElements(i-this.offset,o-this.offset,s-this.offset),super.addElements(s-this.offset,o-this.offset,a-this.offset)}}fillData(t,n,e,r,i,s,o,a){const{lineWidthFn:u,lineColorFn:l,lineOpacityFn:h,linePatternAnimSpeedFn:c,linePatternGapFn:f}=this.it,d=i.length;for(let s=0;s<d;s++){this.fillPosition(t,n,e,r),bt(i[s],i[s],Ka);let d=t.aTubeNormal.currentIndex;for(let n=0;n<i[s].length;n++)t.aTubeNormal[d++]=i[s][n];if(t.aTubeNormal.currentIndex=d,d=t.aLinesofar.currentIndex,t.aLinesofar[d++]=o,t.aLinesofar.currentIndex=d,this.iconAtlas&&(d=t.aNormalDistance.currentIndex,t.aNormalDistance[d++]=Ka*a,t.aNormalDistance.currentIndex=d,d=t.aTexInfo.currentIndex,t.aTexInfo[d++]=this.feaTexInfo[0],t.aTexInfo[d++]=this.feaTexInfo[1],t.aTexInfo[d++]=this.feaTexInfo[2],t.aTexInfo[d++]=this.feaTexInfo[3],t.aTexInfo.currentIndex=d),u){const n="centimeter"===(p=this.options.metric)||"cm"===p?1:"millimeter"===p||"mm"===p?.1:100;let e=this.feaLineWidth*n;isNaN(e)&&(e=0),d=t.aLineWidth.currentIndex,t.aLineWidth[d++]=Math.round(e),t.aLineWidth.currentIndex=d}l&&(d=t.aColor.currentIndex,t.aColor[d++]=this.feaColor[0],t.aColor[d++]=this.feaColor[1],t.aColor[d++]=this.feaColor[2],t.aColor[d++]=this.feaColor[3],t.aColor.currentIndex=d),h&&(d=t.aOpacity.currentIndex,t.aOpacity[d++]=this.feaOpacity,t.aOpacity.currentIndex=d),c&&(d=t.aLinePatternAnimSpeed.currentIndex,t.aLinePatternAnimSpeed[d++]=127*(this.feaPatternAnimSpeed||0),t.aLinePatternAnimSpeed.currentIndex=d),f&&(d=t.aLinePatternGap.currentIndex,t.aLinePatternGap[d++]=10*(this.feaLinePatternGap||0),t.aLinePatternGap.currentIndex=d)}var p;this.maxPos=Math.max(this.maxPos,Math.abs(n)+1,Math.abs(e)+1)}createDataPack(t,n){const e=super.createDataPack(t,n);return e&&(e.is2D=!1),e}}const ol=[],al=[],ul=[],ll={};function hl(t,n,e,r,i,s){return gt(e,r*(Math.cos(i)*t[0]+Math.sin(i)*n[0]),r*(Math.cos(i)*t[1]+Math.sin(i)*n[1]),r*(Math.cos(i)*t[2]+Math.sin(i)*n[2]),s),e}class cl extends sl{addHalfVertex(t,n,e,r,i,s,o,a){const{x:u,y:l,z:h}=t,c=1*this.scaledDistance,{x:f,y:d,z:p}=o.dir,y=gl(this.feaLineWidth,this.feaLineHeight,f,d,p,n,e,i);this.prevVertex&&this.fillTubeElements(i),this.fillData(this.data,u,l,h||0,y,i,c,a)}ensureDataCapacity(t,n,e,r){return super.ensureDataCapacity(t,n,e,2*r)}}const fl=[],dl=[],pl=[],yl=[],ml=[];function gl(t,n,e,r,i,s,o,a){dt(dl,e,r,i),dt(pl,s,o,0),yt(yl,dl,pl),pt(pl,pl),pt(yl,yl),wt(fl,t,n);const u=xt(fl)/t,l=Math.atan(n/t);let h=Math.PI/2+(Math.PI/2-l);return ml[0]||(ml[0]=[]),hl(pl,yl,ml[0],u,h,a?1:-1),h+=2*l,ml[1]||(ml[1]=[]),hl(pl,yl,ml[1],u,h,a?1:-1),ml}class vl{constructor(t){this.max=t,this.reset()}reset(){return this.data={},this.order=[],this}clear(){this.reset()}add(t,n){return this.has(t)?(this.order.splice(this.order.indexOf(t),1),this.data[t]=n,this.order.push(t)):(this.data[t]=n,this.order.push(t),this.order.length>this.max&&this.getAndRemove(this.order[0])),this}has(t){return t in this.data}keys(){return this.order}getAndRemove(t){if(!this.has(t))return null;const n=this.data[t];return delete this.data[t],this.order.splice(this.order.indexOf(t),1),n}get(t){if(!this.has(t))return null;return this.data[t]}remove(t){return this.has(t)?(delete this.data[t],this.order.splice(this.order.indexOf(t),1),this):this}setMaxSize(t){for(this.max=t;this.order.length>this.max;)this.getAndRemove(this.order[0]);return this}}\n/*!\n     * based on @mapbox/tiny-sdf\n     * https://github.com/mapbox/tiny-sdf\n     * @License BSD 2-Clause\n     */var bl=1e20;function wl(t,n,e,r,i,s,o){this.fontSize=t||24,this.buffer=void 0===n?3:n,this.cutoff=r||.25,this.fontFamily=i||"sans-serif",this.fontWeight=s||"normal",this.fontStyle=o||"normal",this.radius=e||8;var a=this.size=this.fontSize+2*this.buffer;this.canvas="undefined"==typeof document?new OffscreenCanvas(a,a):document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),this.ctx.font=this.fontStyle+" "+this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a),this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Ml(t,n,e,r,i,s){for(var o=0;o<n;o++)xl(t,o,n,e,r,i,s);for(var a=0;a<e;a++)xl(t,a*n,1,n,r,i,s)}function xl(t,n,e,r,i,s,o){var a,u,l,h;for(s[0]=0,o[0]=-bl,o[1]=bl,a=0;a<r;a++)i[a]=t[n+a*e];for(a=1,u=0,l=0;a<r;a++){do{h=s[u],l=(i[a]-i[h]+a*a-h*h)/(a-h)/2}while(l<=o[u]&&--u>-1);s[++u]=a,o[u]=l,o[u+1]=bl}for(a=0,u=0;a<r;a++){for(;o[u+1]<a;)u++;h=s[u],t[n+a*e]=i[h]+(a-h)*(a-h)}}wl.prototype.draw=function(t,n,e){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.textBaseline="top",this.ctx.fillText(t,this.buffer,this.buffer);for(var r=this.ctx.getImageData(0,0,n,e),i=new Uint8ClampedArray(n*e),s=0;s<n*e;s++){var o=r.data[4*s+3]/255;this.gridOuter[s]=1===o?0:0===o?bl:Math.pow(Math.max(0,.5-o),2),this.gridInner[s]=1===o?bl:0===o?0:Math.pow(Math.max(0,o-.5),2)}for(Ml(this.gridOuter,n,e,this.f,this.v,this.z),Ml(this.gridInner,n,e,this.f,this.v,this.z),s=0;s<n*e;s++){var a=Math.sqrt(this.gridOuter[s])-Math.sqrt(this.gridInner[s]);i[s]=Math.round(255-255*(a/this.radius+this.cutoff))}return i};let Fl=0;class kl{constructor(t,n=15,e,r){this.entries={},this.Vt={},this.qt=new vl(2048,(function(){})),this.Gt=t,this.Jt=n,this.Wt=e,this.Bt=r}Xt(t){return t&&t.indexOf("{stack}")>=0&&t.indexOf("{range}")>0}getGlyphs(t,n){if(!t||!Object.keys(t).length)return void n(null,{glyphs:null});if(this.Xt(this.Bt))return void this.Yt(t,n);const e=this.entries,r=t.options;let i=!0;r&&(i=!1!==r.isCharsCompact),i=i||this.Wt;const s=(r,s,a)=>{let u=0,l=0;for(const n in t)if("options"!==n){e[n]=e[n]||{},s[n]=s[n]||{};for(const h in t[n]){if(l++,l<=r)continue;const t=i&&!oa(+h),c=n+":"+h+":"+t;let f;if(this.qt.has(c)?f=this.qt.get(c):(f=this.Kt(e[n],n,h,t),this.qt.add(c,f),u++),f=Al(f),s[n][h]=f,a.push(f.bitmap.data.buffer),this.Gt&&u>this.Jt)return void this.Gt(o(l,s,a))}}n(null,{glyphs:s,buffers:a})};function o(t,n,e){return()=>{s(t,n,e)}}s(0,{},[])}Yt(t,n){const e=[];for(const n in t)for(const r of t[n])e.push(this.Zt(n,r));Promise.all(e).then((t=>{n(null,t)}))}Zt(){return Promise.resolve(null)}Kt(t,n,e,r){const i=n;let s=t.tinySDF;const o=r?-1:2;if(!s){let n="400";/bolder/i.test(i)?n="1000":/bold/i.test(i)?n="900":/medium/i.test(i)?n="500":/light/i.test(i)&&(n="200"),s=t.tinySDF=new wl(24,2,8,.25,i,n)}const a=String.fromCodePoint(e),u=s.ctx.measureText(a),l=Math.round(u.width),h=s.draw(a,l+4,28);if(Fl<4){const t="undefined"!=typeof document&&document.getElementById("sdf-debug-"+Fl++);if(t){t.width=l+4,t.height=s.canvas.height;t.getContext("2d").drawImage(s.canvas,0,0)}}return{charCode:e,bitmap:{width:l+4,height:28,data:h},metrics:{width:l,height:24,left:1,top:-2,advance:l+2+o}}}}function Al(t){const n={width:t.bitmap.width,height:t.bitmap.height,data:new Uint8ClampedArray(t.bitmap.data)};return{charCode:t.charCode,bitmap:n,metrics:$e({},t.metrics)}}const Pl={polygonPatternFile:1,markerFile:1,markerPlacement:1,markerSpacing:1,textName:1,textFaceName:1,textPlacement:1,textSpacing:1,lineJoin:1,lineCap:1,linePatternFile:1};Object.assign({visible:1,textHorizontalAlignment:1,textVerticalAlignment:1,textWrapWidth:1,markerHorizontalAlignment:1,markerVerticalAlignment:1},Pl),Object.assign({lineDasharray:1,topPolygonFill:1,bottomPolygonFill:1},Pl);const Sl="__fea_idx";new Float32Array([-1e12])[0];const _l="maptalks_ombb";function Ol(t,n,e,r,i,s,o,a,u,l,h,c,f,d,p,y,m){const g=n.getLength(),v=i/3;for(let e=2,r=g;e<r;e+=3)t[i+e-2]=n[e-2],t[i+e-1]=n[e-1],t[i+e-0]=n[e]-o;i+=g;for(let e=2,r=g;e<r;e+=3)t[i+e-2]=n[e-2],t[i+e-1]=n[e-1],t[i+e-0]=n[e]-a;i+=g,t.trySetLength(i+g),t.copyWithin(i,i-2*g,i-g),i+=g,t.trySetLength(i+g),t.copyWithin(i,i-2*g,i-g),i+=g,(e=e||[]).push(g/3);const b=e.getLength();for(let n=0;n<b;n++){Cl(v+(e[n-1]||0),v+e[n],t,g/3,u,r,l,h,c,f,s,d,p,y,m)}return i}function Cl(t,n,e,r,i,s,o,a,u,l,h,c,f,d,p){const y=s.getLength();let m,g;for(let o=t,a=n;o<a-1;o++)if(m=o,g=o+1,i===1/0||!ct(e,m,g,i))if((o-t)%2==1&&(m+=2*r,g+=2*r),p){let t=s.currentIndex;s[t++]=m+r,s[t++]=g,s[t++]=m,s[t++]=g+r,s[t++]=g,s[t++]=m+r,s.currentIndex=t}else{let t=s.currentIndex;s[t++]=m+r,s[t++]=m,s[t++]=g,s[t++]=g,s[t++]=g+r,s[t++]=m+r,s.currentIndex=t}o&&function(t,n,e,r,i,s,o,a,u,l,h,c){let f,d=0,p=0,y=0,m=0;const g=c?[1,3,4]:[2,3,4];for(let c=s.getLength()-1;c>=o;c--){const o=s[c],v=3*o+1,b=3*o+2,w=i[3*o],M=i[v],x=i[b];d||p||(d=Math.max(i[b],i[3*s[c-3]+2]),p=Math.min(i[b],i[3*s[c-3]+2]),f=d-p);let F=y;const k=c%6;0===t?(5===k&&(m=Ct(i,s,c,w,M)),F=k===g[0]||k===g[1]||k===g[2]?y:y+m):1===t&&(k===g[0]||k===g[1]||k===g[2]?F=0:5===k?(m=Ct(i,s,c,w,M),F=m):F=m);const A=F/l*(1/(100*h))/a;let P;P=1===n?x===d?1:0:"bottom"===e?x===d?f/100/u:0:x===d?0:-f/100/u,r[2*o]=A,r[2*o+1]=P,0===k&&(y+=m)}}(a,u,l,h,e,s,y,c[0],c[1],f,d,p)}function El(t){const n=[t[0]];let e=t[0];for(let r=1;r<t.length;r++)Array.isArray(t[r])?t[r][0]===e[0]&&t[r][1]===e[1]&&t[r][2]===e[2]||n.push(t[r]):t[r].x===e.x&&t[r].y===e.y&&t[r].z===e.z||n.push(t[r]),e=t[r];return n}const $l=Do.getInstance();function Il(t,n,e,r,i,s,o,a,u,l,h,c,f,d,p,y){void 0===n.top&&(n.top=!0),void 0===n.side&&(n.side=!0),$l.reset();const{altitudeScale:m,altitudeProperty:w,defaultAltitude:M,heightProperty:x,minHeightProperty:F,defaultHeight:k,tangent:A,uv:S,topUVMode:_,sideUVMode:O,sideVerticalUVMode:E,top:$,side:I,textureYOrigin:z,topThickness:D}=n,T=function(t,n,{altitudeScale:e,altitudeProperty:r,defaultAltitude:i,heightProperty:s,minHeightProperty:o,defaultHeight:a},{center:u,side:l,top:h,topThickness:c,uvOrigin:f,uv:d,uvSize:p,topUVMode:y,sideUVMode:m,sideVerticalUVMode:g,textureYOrigin:v,tileRatio:b,centimeterToPoint:w,verticalCentimeterToPoint:M,positionType:x,res:F,glScale:k,projectionCode:A},S,_){let O=n/t[0].extent;n===1/0&&(O=1);const C=n===1/0,E=_.get(),$=_.get(),I=_.get(),z=_.getProxy(),D=_.get(),T=_.get(),U=_.get(),j=!!d,N=!!h,L=!!l,H=j?_.get():null;function R(t,e,r,i,s,o){let a=e;if(N){const l=on(z,r,3);if(0===l.length)return e;let h=z.getLength(),d=D.currentIndex;for(let t=0;t<h;t++)D[d++]=z[t];if(D.currentIndex=d,e+=z.getLength(),o)for(let n=2,e=l.length;n<e;n+=3)l[n]+=t/3,l[n-1]+=t/3,l[n-2]+=t/3;else{let n;for(let e=2,r=l.length;e<r;e+=3)n=l[e-1],l[e-1]=l[e]+t/3,l[e]=n+t/3,l[e-2]+=t/3}h=l.length,d=T.currentIndex;for(let t=0;t<h;t++)T[d++]=l[t];T.currentIndex=d,j&&_t(y||0,t,e,H,D,f,w,b,p[0],p[1],s,F,k,A,u),c>0&&!L&&(e=Ol(D,z,r,T,e,H,0,c,n,j,m||0,g||0,v,p,b,M,i<0?!o:o)),U.setLength(e/3),U.fill(1,a/3,e/3)}if(L){N&&(c=0),a=e,e=Ol(D,z,r,T,e,H,c,i,n,j,m||0,g||0,v,p,b,M,i<0?!o:o),U.setLength(e/3);const t=z.getLength()/3;U.fill(1,a/3,a/3+t),U.fill(0,a/3+t,a/3+2*t),U.fill(1,a/3+2*t,a/3+3*t),U.fill(0,a/3+3*t,e/3)}return e}let V=0,q=0;const G=[-1,-1,n+1,n+1];let J=0,W=t.length;P(S)&&(J=S,W=S+1);let B=0,X=!1;const Y=_.getProxy();let K=!1;for(;J<W;J++){const u=t[J],l=u.id;P(l)&&(Math.abs(l)>B&&(B=Math.abs(l)),l<0&&(X=!0));const h=u.geometry,c=u.properties[_l];let f=Array.isArray(c&&c[0]&&c[0][0])?c[0]:c;const{altitude:d,height:p}=_n(u,e,r,i,s,a,o);p<0&&(K=!0),V=Math.max(Math.abs(d),V);const y=D.getLength();let m=0,g=q;Y.setLength(0),z.setLength(0);const v=An(h[0])<0;for(let t=0,e=h.length;t<e;t++){let r=h[t];v&&(r=r.reverse()),r=El(r);const i=An(r)<0;if(!i&&t>0&&(m++,f=c&&c[m],q=R(g,q,Y,p*O,f,C),z.setLength(0),Y.setLength(0),g=q),n!==1/0&&(r=Ku(r,G)),!r.length){t===e-1&&(q=R(g,q,Y,p*O,f,C));continue}const s=r.length;if(Array.isArray(r[0])?r[0][0]===r[s-1][0]&&r[0][1]===r[s-1][1]||r.push([r[0][0],r[0][1]]):r[0].x===r[s-1].x&&r[0].y===r[s-1].y||r.push(r[0]),i){let t=Y.currentIndex;Y[t++]=z.getLength()/3,Y.currentIndex=t}ht(z,z.getLength(),r,O,d,!1,x),t===e-1&&(q=R(g,q,Y,p*O,f,C))}const b=D.getLength()-y,w=(Sl+"").trim();for(let t=0;t<b/3;t++){let t=$.currentIndex;$[t++]=void 0===u[w]?J:u[w],$.currentIndex=t,t=E.currentIndex,E[t++]=J,E.currentIndex=t,P(l)&&(t=I.currentIndex,I[t++]=l,I.currentIndex=t)}}const Z=Ln($.getLength()?$[$.getLength()-1]:0),Q={hasNegativeHeight:K,maxAltitude:V,vertices:D,verticeTypes:U,indices:T,pickingIds:Do.createTypedArray($,Z),featureIndexes:E};if(I.getLength()){const t=X?Nn(B):Ln(B);Q.featureIds=Do.createTypedArray(I,t)}else Q.featureIds=[];return H&&(H.setLength(D.getLength()/3*2),Q.uvs=H),Q}(t,e,{altitudeScale:m,altitudeProperty:w,defaultAltitude:M||0,heightProperty:x,minHeightProperty:F,defaultHeight:k||0},{center:y,top:$,side:I,topThickness:10*D||0,uv:S||A,uvSize:[i,i],uvOrigin:r,topUVMode:_,sideUVMode:O,sideVerticalUVMode:E,textureYOrigin:z,tileRatio:a,centimeterToPoint:u,verticalCentimeterToPoint:l,positionType:p,res:s,glScale:o,projectionCode:f},d,$l),U=[],j=T.vertices.getLength()/3,N=jn(j),L=Do.createTypedArray(T.indices,N);delete T.indices,U.push(L.buffer,T.pickingIds.buffer);const H=Nn(Math.max(512,T.maxAltitude));T.vertices=Do.createTypedArray(T.vertices,H);const R=A?$l.getProxy():new Float32Array(3*j);R.setLength&&R.setLength(3*j);const V=Iu(T.vertices,L,R);let q=!0;const G=V.getLength?V.getLength():V.length;for(let t=0;t<G;t++){V[t]=-V[t];const n=V[t]%1;1-Math.abs(n)>1e-6?q=!1:0!==n&&(V[t]=Math.round(V[t]))}if(T.normals=V,A){let t=$l.get();t.setLength(4*j),t=function(t,n,e,r,i){const s=(t.getLength?t.getLength():t.length)/3,o=i||new Array(4*s),a=[],u=[];for(let t=0;t<s;t++)a[t]=[0,0,0],u[t]=[0,0,0];const l=[0,0,0],h=[0,0,0],c=[0,0,0],f=[0,0],d=[0,0],p=[0,0],y=[0,0,0],m=[0,0,0];function g(n,r,i){Ru(l,t,3*n),Ru(h,t,3*r),Ru(c,t,3*i),Vu(f,e,2*n),Vu(d,e,2*r),Vu(p,e,2*i);const s=h[0]-l[0],o=c[0]-l[0],g=h[1]-l[1],v=c[1]-l[1],b=h[2]-l[2],w=c[2]-l[2],M=d[0]-f[0],x=p[0]-f[0],F=d[1]-f[1],k=p[1]-f[1],A=1/(M*k-x*F);yu(y,(k*s-F*o)*A,(k*g-F*v)*A,(k*b-F*w)*A),yu(m,(M*o-x*s)*A,(M*v-x*g)*A,(M*w-x*b)*A),mu(a[n],a[n],y),mu(a[r],a[r],y),mu(a[i],a[i],y),mu(u[n],u[n],m),mu(u[r],u[r],m),mu(u[i],u[i],m)}for(let t=0,n=r.length;t<n;t+=3)g(r[t+0],r[t+1],r[t+2]);const v=[],b=[],w=[],M=[];let x,F,k;function A(t){Ru(w,n,3*t),pu(M,w),F=a[t],pu(v,F),wu(v,v,function(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t}(w,w,vu(w,F))),gu(v,v),bu(b,M,F),k=vu(b,u[t]),x=k<0?-1:1,o[4*t]=v[0],o[4*t+1]=v[1],o[4*t+2]=v[2],o[4*t+3]=x}for(let t=0,n=r.length;t<n;t+=3)A(r[t+0]),A(r[t+1]),A(r[t+2]);return o}(T.vertices,T.normals,T.uvs,L,t),t=function(t,n){const e=n.getLength(),r=new Float32Array(e),i=[],s=[],o=[];for(let a=0;a<e;a+=4){const e=a/4*3;dt(s,t[e]||0,t[e+1]||0,t[e+2]||0),gt(i,n[a]||0,n[a+1]||0,n[a+2]||0,n[a+3]||0),Eu(o,s,i),mt(r.subarray(a,a+4),o)}return r}(T.normals,t),T.tangents=t,U.push(t.buffer),delete T.normals}if(T.normals&&(q&&(T.normals=Do.createTypedArray(T.normals,Int8Array)),U.push(T.normals.buffer)),T.uvs){const t=T.uvs;T.uvs=Do.createTypedArray(t,Float32Array),U.push(T.uvs.buffer)}const J=function(t,n,e,r){const i={},s={},o=r.getLength();if(C(n.polygonFill)){let a=b(n.polygonFill);const u=new Uint8Array(4*o);u.fill(255);for(let n=0;n<o;n++){const s=t[r[n]],o=s.properties||{};o.$layer=s.layer,o.$type=s.type;let l=a(e,o);g(l)&&(i.aColor=1,a=b(l),l=a(e,o)),delete o.$layer,delete o.$type,He(zl,l),u[4*n]=zl[0],u[4*n+1]=zl[1],u[4*n+2]=zl[2],u[4*n+3]=zl[3]}s.aColor=u}if(C(n.polygonOpacity)){let a=v(n.polygonOpacity);const u=new Uint8Array(o);u.fill(255);for(let n=0;n<o;n++){const s=t[r[n]],o=s.properties||{};o.$layer=s.layer,o.$type=s.type;let l=a(e,o);g(l)&&(i.aOpacity=1,a=b(l),l=a(e,o)),delete o.$layer,delete o.$type,u[n]=255*l}s.aOpacity=u}return s.dynamicAttributes=i,s}(t,h,c,T.featureIndexes),W=function(t,n,e,r,i){const s=[[],[]],o=C(r.topPolygonFill),a=C(r.bottomPolygonFill),u=[255,255,255,255],l=n.getLength();if(o||a){let h=o&&b(r.topPolygonFill),c=a&&b(r.bottomPolygonFill),f=null,d=null,p=null,y=null;for(let r=0;r<l;r++){if(1===t[r]&&!o||0===t[r]&&!a)continue;const l=1===t[r];if(l&&n[r]===f){t[r]=p;continue}if(!l&&n[r]===d){t[r]=y;continue}const m=e[n[r]],v=m.properties||{};v.$layer=m.layer,v.$type=m.type;let w=l?h:c,M=w(i,v);g(M)&&(w=b(M),M=w(i,v)),delete v.$layer,delete v.$type,He(zl,M),vt(zl,zl,u);let x=Dl(s,zl);x<0&&(x=s.length,s.push(mt([],zl))),t[r]=x,l?(f=n[r],p=x):(d=n[r],y=x)}}return s.slice(2)}(T.verticeTypes,T.featureIndexes,t,h,c),B={data:{data:{aVertexColorType:W.length<=252?Do.createTypedArray(T.verticeTypes,Uint8Array):Do.createTypedArray(T.verticeTypes,Uint16Array),aPosition:T.vertices,aNormal:T.normals,aTexCoord0:T.uvs,aTangent:T.tangents,aPickingId:T.pickingIds},indices:L,properties:{maxAltitude:T.maxAltitude,hasNegativeHeight:T.hasNegativeHeight},dynamicAttributes:J.dynamicAttributes,vertexColors:W},buffers:U};return T.featureIds.length?(B.data.featureIds=T.featureIds,U.push(B.data.featureIds.buffer)):B.data.featureIds=[],J.aColor&&(B.data.data.aColor=J.aColor,B.buffers.push(J.aColor.buffer)),J.aOpacity&&(B.data.data.aOpacity=J.aOpacity,B.buffers.push(J.aOpacity.buffer)),B.buffers.push(B.data.data.aPosition.buffer),B.data.pickingIdIndiceMap=$n(B.data.data.aPickingId,B.data.indices),B}const zl=[];function Dl(t,n){for(let i=0;i<t.length;i++)if(e=n,r=t[i],e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3])return i;var e,r;return-1}function Tl(t,n,e,r,{altitudeScale:i,altitudeProperty:s,defaultAltitude:o,heightProperty:a,minHeightProperty:u,defaultHeight:l,bottom:h}){const c=h,f=n/t[0].extent,d=2*function(t,n){let e=0;for(let n=0,r=t.length;n<r;n++){const r=t[n];if(P(r.geometry[0][0]))e+=3*r.geometry.length;else for(let t=0,n=r.geometry.length;t<n;t++){let n=3*r.geometry[t].length;3===r.type&&(n-=3),e+=n}}return e}(t)+3*t.length*2,p=[],y=new Int16Array(d),m=new Uint8Array(y.length/3*4);g(e)&&(e=wo(e));const v=[];function b(t,e,r){const i=e-t,s=y.subarray(t,e),o=y.subarray(e,e+i);o.set(s);for(let t=2,n=o.length;t<n;t+=3)o[t]=s[t]-r;const a=t/3,u=i/3;let l,h;for(let t=a,e=u+a;t<e;t++)t<e-1?(l=t,h=t+1):(l=t,h=a),ct(y,l,h,n)||(v.push(l,h),c&&v.push(l+u,h+u),Ul(y,l,n)||v.push(l,l+u));return e+i}let w=0,M=0;const x=(Sl+"").trim(),F=[];for(let n=0,h=t.length;n<h;n++){const h=t[n],c=h.geometry;if(e){let t;t="function"==typeof e?e(h&&h.properties):e,He(F,t)}else dt(F,255,255,255);const d=w/3*4,{altitude:g,height:k}=_n(h,i,s,o,a,l,u);M=Math.max(Math.abs(g),M);let A=w;for(let t=0,n=c.length;t<n;t++){let n=c[t];const e=n.length;n[0][0]===n[e-1][0]&&n[0][1]===n[e-1][1]&&(n=n.slice(0,e-1)),w=ht(y,A,n,f,g),w=b(A,w,k*f),A=w}const P=A/3*4;for(let t=d;t<P;t+=4)m[t]=F[0],m[t+1]=F[1],m[t+2]=F[2],m[t+3]=255*(r||1);const S=v.length-p.length;for(let t=0;t<S;t++)p.push(h[x])}const k=new(jn(v.reduce(((t,n)=>Math.max(t,n)),0)))(v),A=Ln(t.length);return{aPosition:new(Nn(Math.max(512,M)))(y),indices:k,aPickingId:new A(p),aColor:m}}function Ul(t,n,e){const r=t[3*n],i=t[3*n+1];return r<0||r>e||i<0||i>e}function jl(t,n,e,r){const i=Tl(t,n,e.lineColor,e.lineOpacity,r),s=[i.aPosition.buffer,i.indices.buffer,i.aPickingId.buffer],o=i.indices;return delete i.indices,{data:{data:i,indices:o},buffers:s}}let Nl=!1;try{const t=new OffscreenCanvas(1,1);t.getContext("2d").fillText("hello",0,0),Nl=!0}catch(t){Nl=!1}var Ll=Nl;const Hl="__original_properties",Rl="__fn-type_properties";class Vl{constructor(t,n,e,r,i){this.id=t,this.options=n,this.upload=e,this.Qt(n.style),this.requests={},this.qt=r,this.tn=1,this.loadings=i}updateStyle(t,n){this.options.style=t,this.tn=t.styleCounter,this.Qt(t),n()}updateOptions(t,n){this.options=k(this.options,t),n()}loadTile(t,n){const e=this.loadings,r=t.tileInfo.url,i=this.options.debugTile;if(i){const{x:e,y:r,z:s}=t.tileInfo;let o=!1;for(let t=0;t<i.length;t++)if(e===i[t].x&&r===i[t].y&&s===i[t].z){o=!0;break}if(!o)return void n()}if(e[r])return void e[r].push({context:t,callback:n,ref:this});e[r]=[{context:t,callback:n,ref:this}];const s=this.options.featureIdProperty;this.requests[r]=this.getTileFeatures(t,((n,i,o,a)=>{const u=e[r];if(delete e[r],this.checkIfCanceled(r))return delete this.requests[r],void this.nn(u,null,{canceled:!0});if(delete this.requests[r],(this.options.debug||s)&&i)for(let n=0;n<i.length;n++)if(this.options.debug&&(i[n]._debug_info={index:n,id:i[n].id,tileId:t.tileInfo.id}),s){const t=_(s)?s[i[n].layer]:s,e=i[n].properties;i[n].id=e&&e[t]||null}if(n)this.nn(u,n);else if(i&&i.length){if(u)for(let t=0;t<u.length;t++)this.en.call(u[t].ref,u[t].context,u[t].callback,r,o,i,a)}else this.nn(u)}))}en(t,n,e,r,i,s){this.rn(r,i,t).then((e=>{e.canceled?n(null,{canceled:!0}):(e.data.styleCounter=t.styleCounter,s&&k(e.data,s),n(null,e.data,e.buffers))})).catch((t=>{n(t)}))}abortTile(t,n){delete this.requests[t],this.sn(t),n()}sn(t){const n=this.loadings[t];if(n)for(let t=0;t<n.length;t++)n[t].callback(null,{canceled:!0});delete this.loadings[t]}nn(t,n,e){if(t)for(let r=0;r<t.length;r++)t[r].callback(n,e)}checkIfCanceled(t){return!this.requests[t]}onRemove(){this.loadings={},delete this.qt,this.requests={}}fetchIconGlyphs(t,n,e){if(this.options.workerGlyph&&Ll){const r=[];if(t&&Object.keys(t).length){const n=new Promise((n=>{this.upload("fetchIconGlyphs",{icons:t},null,((t,e)=>{n({err:t,iconData:e})}))}));r.push(n)}if(n&&Object.keys(n).length){const t=new Promise((t=>{this.an||(this.an=new kl),this.an.getGlyphs(n,((n,e)=>{t({err:n,glyphData:e})}))}));r.push(t)}Promise.all(r).then((t=>{const n={icons:null,glyphs:null};for(let r=0;r<t.length;r++){if(t[r].err)return void e(t[r].err);t[r].iconData?n.icons=t[r].iconData.icons:t[r].glyphData&&(n.glyphs=t[r].glyphData.glyphs)}return n})).then((t=>{e(null,t)}))}else this.upload("fetchIconGlyphs",{icons:t,glyphs:n},null,e)}rn(t,n,e){if(!n.length)return Promise.resolve({data:null,buffers:[]});const{glScale:r,tileInfo:i}=e,s=!this.options.style.style.length&&!this.options.style.featureStyle.length;let o=this.pluginConfig.slice(0);s&&(o=this.un(t)),this.featurePlugins&&function(t){for(let n=1;n<arguments.length;n++){const e=arguments[n];if(e)for(let n=0,r=e.length;n<r;n++)t.push(e[n])}t.length}(o,this.featurePlugins);const a={};for(let t=0;t<o.length;t++)Yl(n,e.tileInfo.z,o[t],a);const u=[],l=[];for(let t=0;t<n.length;t++){const e=n[t],r=a[t];if(r){l.fill(null);let t=0;for(const n in r){let i=0;const s=r[n].values();for(const t of s){let r=l[i];r||(r=th(e),l[i]=r),r.properties[n]=t,i++}i>t&&(t=i)}for(let n=0;n<t;n++)u.push(l[n])}else u.push(e)}const h=(n=u)[0].extent,c=i.z,f={x:i.extent2d.xmin*r,y:i.extent2d.ymax*r},d=[],p=[],y=[],m=this.options,g=[],v={},b=[Promise.resolve(e.styleCounter)];let w=0,M=-1;const x=[];let F=!1;for(let t=0;t<o.length;t++){M++;const r=o[t];r.type!==w&&(M=0,w=r.type);const a=0===r.type?d:p;if(r.symbol&&!1===r.symbol.visible){a[M]=null;continue}rh(r.symbol,x,t),F=F||x[t]&&x[t].size>0;const{tileFeatures:u,tileFeaIndexes:l}=this.hn(c,r.type,r.filter,n,v,t);if(!u.length){a[M]=null;continue}const m=jn(l[l.length-1]);a[M]={styledFeatures:new m(l)},y.push({idx:t,typeIdx:M}),g.push(a[M].styledFeatures.buffer);const A=k({},e,{extent:h,zoom:c,tilePoint:f});if(this.options.debugTile){const t=this.options.debugTile;for(let n=0;n<t.length;n++){const{x:e,y:r,z:s}=t[n];if(i.x===e&&i.y===r&&i.z===s){A.debugIndex=t[n].index;break}}}let P=this.cn(u,r,A);s&&(P=P.then((t=>{if(!t)return null;if(t.data)t.data.layer=u[0].layer;else if(Array.isArray(t))for(let n=0;n<t.length;n++)t[n]&&t[n].data&&(t[n].data.layer=u[0].layer);return t}))),b.push(P)}return Promise.all(b).then((([e,...r])=>{if(e!==this.tn)return{canceled:!0};function i(t,n){if(void 0===t.data.ref&&(t.data.type=o[y[n].idx].renderPlugin.dataConfig.type,t.data.filter=o[y[n].idx].filter.def,t.buffers&&t.buffers.length))for(let n=0;n<t.buffers.length;n++)g.push(t.buffers[n])}for(let t=0;t<r.length;t++){if(!r[t])continue;const n=r[t],e=0===o[y[t].idx].type?d:p;if(Array.isArray(n)){const r=[];for(let e=0;e<n.length;e++)n[e]&&(i(n[e],t),(void 0===n[e].data.ref||n[n[e].data.ref])&&r.push(n[e].data));r.length&&(e[y[t].typeIdx].data=r)}else i(n,t),e[y[t].typeIdx].data=n.data}const s={},a=t;if(m.features||m.schema||F){let t,e=!1;for(let r=0,i=n.length;r<i;r++)if(t=n[r],a[t.layer].properties||(a[t.layer].properties=Jl(t.properties)),t&&(m.features||F&&v[r]))if("id"===m.features)s[r]=t.id;else{m.pickingGeometry||delete t.geometry,delete t.extent,delete t.properties.$layer,delete t.properties.$type,delete t.__index;const n=t.originalFeature;if(n){const n=t.properties,e=k({},t.originalFeature);delete n[Hl],e.customProps=k({},n),t=e}const i=k({},t);if(F&&v[r]&&(!m.features||"transient"===m.features)){const i=v[r];for(let r=0;r<i.length;r++){const i=x[r];i&&i.forEach((r=>{const i=n?n.properties:t.properties;i[Rl]||(i[Rl]=new Set),i[Rl].add(r),e=!0}))}}s[r]=i}if(e)for(const t in s){const n=s[t],e=n.properties[Rl];if(e){delete n.properties[Rl],"transient"===m.features&&(n.fnTypeProps=k({},n.properties));for(const t in n.properties)e.has(t)||("transient"===m.features?delete n.fnTypeProps[t]:delete n.properties[t])}}}return{data:{styleCounter:e,schema:a,data:d,featureData:p,extent:h,features:s},buffers:g}})).catch((t=>{console.error(t)}))}cn(t,n,e){let r=t;const i=n.renderPlugin.dataConfig,s=n.symbol,o=this.options.tileSize,{extent:a,glScale:u,zScale:l,zoom:h,tilePoint:c,centimeterToPoint:f,verticalCentimeterToPoint:d}=e,p=a/o,y=i.type,m=e.debugIndex;let g=k({},i,{EXTENT:a,zoom:h,debugIndex:m,features:this.options.features});if("3d-extrusion"===y){Wl(s)&&(i.uv=1);const t=this.options.projectionCode,n=s.material&&s.material.textureWidth||23.25;return Promise.all([Promise.resolve(Il(r,i,a,c,n,e.tileInfo.res,u,a/this.options.tileSize,f,d,s,h,t,m))])}if("3d-wireframe"===y)return Promise.all([Promise.resolve(jl(r,a,s,i))]);if("point"===y){g=k(g,{requestor:this.fetchIconGlyphs.bind(this),altitudeToTileScale:l*a/this.options.tileSize/u});const t=Xa.splitPointSymbol(s),n=Go.genFnTypes(t[0]);return Xa.needMerge(t[0],n,h)&&(r=Xa.mergeLineFeatures(r,t[0],n,h)),Promise.all(t.map(((t,e)=>(0===e?g.fnTypes=n:delete g.fnTypes,new Xa(r,t,g).load(p)))))}if("native-point"===y){const t=l*a/this.options.tileSize/u;return g.altitudeToTileScale=t,Bl(r,s,g,Bu,a/o)}if("line"===y)return g=k(g,{requestor:this.fetchIconGlyphs.bind(this),tileRatio:p}),Bl(r,s,g,ru,1,!0);if("native-line"===y)return Bl(r,s,g,Ju,1,!0);if("fill"===y)return g=k(g,{requestor:this.fetchIconGlyphs.bind(this)}),Bl(r,s,g,el);if("line-extrusion"===y){delete s.lineGradientProperty,s.lineJoin="miter",s.lineCap="butt";const t=Wl(s);if(t&&(i.uv=1),g=k(g,{tileSize:o,zScale:l,glScale:u}),s.mergeOnProperty){const t=Go.genFnTypes(s);r=ru.mergeLineFeatures(r,s,t,g.zoom)}if(t){const t=[];if(!1!==i.top){const n=k({},g);n.side=!1,t.push(new qu(r,s,n))}return!1!==i.side&&(g.side=!0,g.top=!1,t.push(new qu(r,s,g))),Promise.all(t.map((t=>t.load())))}return Promise.all([new qu(r,s,g).load()])}if("circle"===y)return Bl(r,s,g,il);if("round-tube"===y||"square-tube"===y){const t="round-tube"===y?sl:cl;return g=k(g,{requestor:this.fetchIconGlyphs.bind(this),radialSegments:"round-tube"===y?i.radialSegments||8:4,centimeterToPoint:f,verticalCentimeterToPoint:d,tileRatio:p,isTube:!0}),Bl(r,s,g,t)}return Promise.resolve([])}hn(t,n,e,r,i,s){const o=(Sl+"").trim(),a=[],u=[],l=r.length;for(let h=0;h<l;h++)if((1===n||void 0===r[h].id||!this.styledFeatures[r[h].id])&&((!e.def||"default"===e.def)&&!i[h]||!0===e.def||e.def&&(void 0!==e.def.condition||Array.isArray(e.def))&&e(r[h],t))){const t=r[h];if(void 0===t[o]&&(t[o]=h),i[h]||(i[h]=[]),i[h].push(s),u.push(t),a.push(h),1===n)break}return{tileFeatures:u,tileFeaIndexes:a}}Qt(t){const{style:n,featureStyle:e}=t,r={};e.forEach((t=>{Array.isArray(t.id)?(t.id.forEach((t=>{r[t]=1})),t.filter=["in","$id",...t.id]):(r[t.id]=1,t.filter=["==","$id",t.id])}));const i=go(n);for(let t=0;t<n.length;t++)i[t].filter&&(i[t].filter.def=n[t].filter?n[t].filter.value||n[t].filter:void 0),i[t].type=0;const s=[],o=go(e);for(let t=0;t<e.length;t++)o[t].type=1,o[t].filter.def=e[t].filter?e[t].filter.value||e[t].filter:void 0,o[t].renderPlugin&&s.push(o[t]);this.pluginConfig=i,this.featurePlugins=s,this.styledFeatures=r}un(t){let n=this.dn;this.dn||(n=this.dn={});const e=["","Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon"],r=[];for(const i in t){const s=i;if(!n[i]){const r=[];for(let n=0;n<t[i].types.length;n++){const o=t[i].types[n],a=["all",["==","$layer",s],["==","$type",e[o]]],u={filter:Je(a),renderPlugin:ql(o),symbol:Gl(o)};u.filter.def=a,u.type=0,r.push(u)}n[s]=r}r.push(...n[s])}return r}}function ql(t){switch(t){case 1:return{type:"native-point",dataConfig:{type:"native-point",only2D:!0}};case 2:return{type:"native-line",dataConfig:{type:"native-line",only2D:!0}};case 3:return{type:"fill",dataConfig:{type:"fill",only2D:!0}}}return null}function Gl(t){switch(t){case 1:return{markerFill:"#f00",markerSize:10};case 2:return{lineColor:"#fff"};case 3:return{polygonFill:"#00f",polygonOpacity:.4}}return null}function Jl(t){if(Array.isArray(t)||!_(t))return{};const n={};for(const e in t){const r=t[e];A(r)?n[e]="string":P(r)?n[e]="number":!0===r||!1===r?n[e]="boolean":Array.isArray(r)?n[e]="array":n[e]="object"}return n}function Wl(t){if(!t)return 0;let n=0;for(const e in t){if(("normalTexture"===e||"bumpTexture"===e)&&t[e])return 2;if(e.indexOf("Texture")>0&&t[e])n=1;else if(_(t[e])){const r=Wl(t[e]);if(2===r)return r;1===r&&(n=1)}}return n}function Bl(t,n,e,r,i,s){const o={},a=Array.isArray(n)?n:[n];let u=-1;for(let t=0;t<a.length;t++)o[t]=Xl(a[t]),!o[t]&&a[t]&&-1===u&&(u=t);const l=[];for(let n=0;n<a.length;n++){if(!a[n])continue;a[n].index={index:n};let h=t;if(s&&a[n].mergeOnProperty){const r=Go.genFnTypes(a[n]);h=ru.mergeLineFeatures(t,a[0],r,e.zoom)}o[n]||n===u?l.push(new r(h,a[n],e).load(i)):l.push({data:{ref:u,symbolIndex:{index:n}}})}return Promise.all(l)}function Xl(t){if(!t)return 0;for(const n in t)if(C(t[n]))return 1;return 0}function Yl(t,n,e,r){const i=e.customProperties;if(!i)return t;if(i)for(let t=0;t<i.length;t++)i[t].fn=wo(i[t].filter);for(let e=0;e<i.length;e++)for(let s=0,o=t.length;s<o;s++)if(i[e].fn(t[s],n))for(const t in i[e].properties){const n=i[e].properties[t];O(n)||(r[s]||(r[s]={}),r[s][t]||(r[s][t]=new Set),r[s][t].add(n))}}const Kl={get:(t,n)=>n in t?t[n]:t.originalFeature[n],has:(t,n)=>n in t||n in t.originalFeature},Zl={get:function(t,n){return n in t?t[n]:t[Hl][n]},has:(t,n)=>n in t||n in t[Hl]},Ql={};function th(t){const n={};n.originalFeature=t;const e=new Proxy(n,Kl);return e.properties=new Proxy({},Zl),e.properties[Hl]=t.properties||Ql,e}function nh(t,n,e){t[n]||(t[n]=new Set),t[n].add(e)}const eh=[];function rh(t,n,e){if(!t)return eh;for(const i in t){if(!t[i]||!Re[r=i]&&!Ve[r])continue;if(C(t[i]))nh(n,e,t[i].property);else{if("lineGradientProperty"===i){nh(n,e,t[i]);continue}if("textName"===i)if(A(t[i])){const r=t[i].match(Qo);if(r)for(let t=0;t<r.length;t++)nh(n,e,r[t])}else if(Fo(t[i])){const r=[];na(r,t[i]);for(let t=0;t<r.length;t++)nh(n,e,r[t])}}const s=t[i].stops;if(s&&s.length)for(let t=0;t<s.length;t++)C(s[t][1])&&nh(n,t,s[t][1].property)}var r;return n[e]}function ih(t,n){sh(t.geometry,n)}function sh(t,n){if(t)switch(t.type){case"Point":oh(t.coordinates,n);break;case"MultiPoint":case"LineString":ah(t.coordinates,n);break;case"MultiLineString":!function(t,n){for(let e=0,r=t.length;e<r;e++)ah(t[e],n)}(t.coordinates,n);break;case"Polygon":uh(t.coordinates,n);break;case"MultiPolygon":!function(t,n){for(let e=0,r=t.length;e<r;e++)uh(t[e],n)}(t.coordinates,n);break;case"GeometryCollection":const e=t.geometries.length;for(let r=0;r<e;r++)sh(t.geometries[r],n)}}function oh(t,n){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function ah(t,n){for(let e=0,r=t.length;e<r;e++)oh(t[e],n)}function uh(t,n){t.length&&ah(t[0],n)}function lh(t,n,e,r,i){hh(t,n,e||0,r||t.length-1,i||fh)}function hh(t,n,e,r,i){for(;r>e;){if(r-e>600){var s=r-e+1,o=n-e+1,a=Math.log(s),u=.5*Math.exp(2*a/3),l=.5*Math.sqrt(a*u*(s-u)/s)*(o-s/2<0?-1:1);hh(t,n,Math.max(e,Math.floor(n-o*u/s+l)),Math.min(r,Math.floor(n+(s-o)*u/s+l)),i)}var h=t[n],c=e,f=r;for(ch(t,e,n),i(t[r],h)>0&&ch(t,e,r);c<f;){for(ch(t,c,f),c++,f--;i(t[c],h)<0;)c++;for(;i(t[f],h)>0;)f--}0===i(t[e],h)?ch(t,e,f):ch(t,++f,r),f<=n&&(e=f+1),n<=f&&(r=f-1)}}function ch(t,n,e){var r=t[n];t[n]=t[e],t[e]=r}function fh(t,n){return t<n?-1:t>n?1:0}class dh{constructor(t=9){this.pn=Math.max(4,t),this.yn=Math.max(2,Math.ceil(.4*this.pn)),this.clear()}all(){return this.mn(this.data,[])}search(t){let n=this.data;const e=[];if(!kh(t,n))return e;const r=this.toBBox,i=[];for(;n;){for(let s=0;s<n.children.length;s++){const o=n.children[s],a=n.leaf?r(o):o;kh(t,a)&&(n.leaf?e.push(o):Fh(t,a)?this.mn(o,e):i.push(o))}n=i.pop()}return e}collides(t){let n=this.data;if(!kh(t,n))return!1;const e=[];for(;n;){for(let r=0;r<n.children.length;r++){const i=n.children[r],s=n.leaf?this.toBBox(i):i;if(kh(t,s)){if(n.leaf||Fh(t,s))return!0;e.push(i)}}n=e.pop()}return!1}load(t){if(!t||!t.length)return this;if(t.length<this.yn){for(let n=0;n<t.length;n++)this.insert(t[n]);return this}let n=this.gn(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this.vn(this.data,n);else{if(this.data.height<n.height){const t=this.data;this.data=n,n=t}this.bn(n,this.data.height-n.height-1,!0)}else this.data=n;return this}insert(t){return t&&this.bn(t,this.data.height-1),this}clear(){return this.data=Ah([]),this}remove(t,n){if(!t)return this;let e=this.data;const r=this.toBBox(t),i=[],s=[];let o,a,u;for(;e||i.length;){if(e||(e=i.pop(),a=i[i.length-1],o=s.pop(),u=!0),e.leaf){const r=ph(t,e.children,n);if(-1!==r)return e.children.splice(r,1),i.push(e),this.wn(i),this}u||e.leaf||!Fh(e,r)?a?(o++,e=a.children[o],u=!1):e=null:(i.push(e),s.push(o),o=0,a=e,e=e.children[0])}return this}toBBox(t){return t}compareMinX(t,n){return t.minX-n.minX}compareMinY(t,n){return t.minY-n.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}mn(t,n){const e=[];for(;t;)t.leaf?n.push(...t.children):e.push(...t.children),t=e.pop();return n}gn(t,n,e,r){const i=e-n+1;let s,o=this.pn;if(i<=o)return s=Ah(t.slice(n,e+1)),yh(s,this.toBBox),s;r||(r=Math.ceil(Math.log(i)/Math.log(o)),o=Math.ceil(i/Math.pow(o,r-1))),s=Ah([]),s.leaf=!1,s.height=r;const a=Math.ceil(i/o),u=a*Math.ceil(Math.sqrt(o));Ph(t,n,e,u,this.compareMinX);for(let i=n;i<=e;i+=u){const n=Math.min(i+u-1,e);Ph(t,i,n,a,this.compareMinY);for(let e=i;e<=n;e+=a){const i=Math.min(e+a-1,n);s.children.push(this.gn(t,e,i,r-1))}}return yh(s,this.toBBox),s}Mn(t,n,e,r){for(;r.push(n),!n.leaf&&r.length-1!==e;){let e,r=1/0,o=1/0;for(let a=0;a<n.children.length;a++){const u=n.children[a],l=wh(u),h=(i=t,s=u,(Math.max(s.maxX,i.maxX)-Math.min(s.minX,i.minX))*(Math.max(s.maxY,i.maxY)-Math.min(s.minY,i.minY))-l);h<o?(o=h,r=l<r?l:r,e=u):h===o&&l<r&&(r=l,e=u)}n=e||n.children[0]}var i,s;return n}bn(t,n,e){const r=e?t:this.toBBox(t),i=[],s=this.Mn(r,this.data,n,i);for(s.children.push(t),gh(s,r);n>=0&&i[n].children.length>this.pn;)this.xn(i,n),n--;this.Fn(r,i,n)}xn(t,n){const e=t[n],r=e.children.length,i=this.yn;this.kn(e,i,r);const s=this.An(e,i,r),o=Ah(e.children.splice(s,e.children.length-s));o.height=e.height,o.leaf=e.leaf,yh(e,this.toBBox),yh(o,this.toBBox),n?t[n-1].children.push(o):this.vn(e,o)}vn(t,n){this.data=Ah([t,n]),this.data.height=t.height+1,this.data.leaf=!1,yh(this.data,this.toBBox)}An(t,n,e){let r,i=1/0,s=1/0;for(let o=n;o<=e-n;o++){const n=mh(t,0,o,this.toBBox),a=mh(t,o,e,this.toBBox),u=xh(n,a),l=wh(n)+wh(a);u<i?(i=u,r=o,s=l<s?l:s):u===i&&l<s&&(s=l,r=o)}return r||e-n}kn(t,n,e){const r=t.leaf?this.compareMinX:vh,i=t.leaf?this.compareMinY:bh;this.Pn(t,n,e,r)<this.Pn(t,n,e,i)&&t.children.sort(r)}Pn(t,n,e,r){t.children.sort(r);const i=this.toBBox,s=mh(t,0,n,i),o=mh(t,e-n,e,i);let a=Mh(s)+Mh(o);for(let r=n;r<e-n;r++){const n=t.children[r];gh(s,t.leaf?i(n):n),a+=Mh(s)}for(let r=e-n-1;r>=n;r--){const n=t.children[r];gh(o,t.leaf?i(n):n),a+=Mh(o)}return a}Fn(t,n,e){for(let r=e;r>=0;r--)gh(n[r],t)}wn(t){for(let n,e=t.length-1;e>=0;e--)0===t[e].children.length?e>0?(n=t[e-1].children,n.splice(n.indexOf(t[e]),1)):this.clear():yh(t[e],this.toBBox)}}function ph(t,n,e){if(!e)return n.indexOf(t);for(let r=0;r<n.length;r++)if(e(t,n[r]))return r;return-1}function yh(t,n){mh(t,0,t.children.length,n,t)}function mh(t,n,e,r,i){i||(i=Ah(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let s=n;s<e;s++){const n=t.children[s];gh(i,t.leaf?r(n):n)}return i}function gh(t,n){return t.minX=Math.min(t.minX,n.minX),t.minY=Math.min(t.minY,n.minY),t.maxX=Math.max(t.maxX,n.maxX),t.maxY=Math.max(t.maxY,n.maxY),t}function vh(t,n){return t.minX-n.minX}function bh(t,n){return t.minY-n.minY}function wh(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function Mh(t){return t.maxX-t.minX+(t.maxY-t.minY)}function xh(t,n){const e=Math.max(t.minX,n.minX),r=Math.max(t.minY,n.minY),i=Math.min(t.maxX,n.maxX),s=Math.min(t.maxY,n.maxY);return Math.max(0,i-e)*Math.max(0,s-r)}function Fh(t,n){return t.minX<=n.minX&&t.minY<=n.minY&&n.maxX<=t.maxX&&n.maxY<=t.maxY}function kh(t,n){return n.minX<=t.maxX&&n.minY<=t.maxY&&n.maxX>=t.minX&&n.maxY>=t.minY}function Ah(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Ph(t,n,e,r,i){const s=[n,e];for(;s.length;){if((e=s.pop())-(n=s.pop())<=r)continue;const o=n+Math.ceil((e-n)/r/2)*r;lh(t,o,n,e,i),s.push(n,o,o,e)}}var Sh={exports:{}},_h=function(t,n,e,r){var i=t[0],s=t[1],o=!1;void 0===e&&(e=0),void 0===r&&(r=n.length);for(var a=(r-e)/2,u=0,l=a-1;u<a;l=u++){var h=n[e+2*u+0],c=n[e+2*u+1],f=n[e+2*l+0],d=n[e+2*l+1];c>s!=d>s&&i<(f-h)*(s-c)/(d-c)+h&&(o=!o)}return o},Oh=function(t,n,e,r){var i=t[0],s=t[1],o=!1;void 0===e&&(e=0),void 0===r&&(r=n.length);for(var a=r-e,u=0,l=a-1;u<a;l=u++){var h=n[u+e][0],c=n[u+e][1],f=n[l+e][0],d=n[l+e][1];c>s!=d>s&&i<(f-h)*(s-c)/(d-c)+h&&(o=!o)}return o};Sh.exports=function(t,n,e,r){return n.length>0&&Array.isArray(n[0])?Oh(t,n,e,r):_h(t,n,e,r)};var Ch=Sh.exports.nested=Oh;Sh.exports.flat=_h;const Eh=11102230246251565e-32,$h=134217729,Ih=(3+8*Eh)*Eh;function zh(t,n,e,r,i){let s,o,a,u,l=n[0],h=r[0],c=0,f=0;h>l==h>-l?(s=l,l=n[++c]):(s=h,h=r[++f]);let d=0;if(c<t&&f<e)for(h>l==h>-l?(o=l+s,a=s-(o-l),l=n[++c]):(o=h+s,a=s-(o-h),h=r[++f]),s=o,0!==a&&(i[d++]=a);c<t&&f<e;)h>l==h>-l?(o=s+l,u=o-s,a=s-(o-u)+(l-u),l=n[++c]):(o=s+h,u=o-s,a=s-(o-u)+(h-u),h=r[++f]),s=o,0!==a&&(i[d++]=a);for(;c<t;)o=s+l,u=o-s,a=s-(o-u)+(l-u),l=n[++c],s=o,0!==a&&(i[d++]=a);for(;f<e;)o=s+h,u=o-s,a=s-(o-u)+(h-u),h=r[++f],s=o,0!==a&&(i[d++]=a);return 0===s&&0!==d||(i[d++]=s),d}function Dh(t){return new Float64Array(t)}const Th=33306690738754716e-32,Uh=22204460492503146e-32,jh=11093356479670487e-47,Nh=Dh(4),Lh=Dh(8),Hh=Dh(12),Rh=Dh(16),Vh=Dh(4);function qh(t,n,e,r,i,s){const o=(n-s)*(e-i),a=(t-i)*(r-s),u=o-a;if(0===o||0===a||o>0!=a>0)return u;const l=Math.abs(o+a);return Math.abs(u)>=Th*l?u:-function(t,n,e,r,i,s,o){let a,u,l,h,c,f,d,p,y,m,g,v,b,w,M,x,F,k;const A=t-i,P=e-i,S=n-s,_=r-s;w=A*_,f=$h*A,d=f-(f-A),p=A-d,f=$h*_,y=f-(f-_),m=_-y,M=p*m-(w-d*y-p*y-d*m),x=S*P,f=$h*S,d=f-(f-S),p=S-d,f=$h*P,y=f-(f-P),m=P-y,F=p*m-(x-d*y-p*y-d*m),g=M-F,c=M-g,Nh[0]=M-(g+c)+(c-F),v=w+g,c=v-w,b=w-(v-c)+(g-c),g=b-x,c=b-g,Nh[1]=b-(g+c)+(c-x),k=v+g,c=k-v,Nh[2]=v-(k-c)+(g-c),Nh[3]=k;let O=function(t,n){let e=n[0];for(let r=1;r<t;r++)e+=n[r];return e}(4,Nh),C=Uh*o;if(O>=C||-O>=C)return O;if(c=t-A,a=t-(A+c)+(c-i),c=e-P,l=e-(P+c)+(c-i),c=n-S,u=n-(S+c)+(c-s),c=r-_,h=r-(_+c)+(c-s),0===a&&0===u&&0===l&&0===h)return O;if(C=jh*o+Ih*Math.abs(O),O+=A*h+_*a-(S*l+P*u),O>=C||-O>=C)return O;w=a*_,f=$h*a,d=f-(f-a),p=a-d,f=$h*_,y=f-(f-_),m=_-y,M=p*m-(w-d*y-p*y-d*m),x=u*P,f=$h*u,d=f-(f-u),p=u-d,f=$h*P,y=f-(f-P),m=P-y,F=p*m-(x-d*y-p*y-d*m),g=M-F,c=M-g,Vh[0]=M-(g+c)+(c-F),v=w+g,c=v-w,b=w-(v-c)+(g-c),g=b-x,c=b-g,Vh[1]=b-(g+c)+(c-x),k=v+g,c=k-v,Vh[2]=v-(k-c)+(g-c),Vh[3]=k;const E=zh(4,Nh,4,Vh,Lh);w=A*h,f=$h*A,d=f-(f-A),p=A-d,f=$h*h,y=f-(f-h),m=h-y,M=p*m-(w-d*y-p*y-d*m),x=S*l,f=$h*S,d=f-(f-S),p=S-d,f=$h*l,y=f-(f-l),m=l-y,F=p*m-(x-d*y-p*y-d*m),g=M-F,c=M-g,Vh[0]=M-(g+c)+(c-F),v=w+g,c=v-w,b=w-(v-c)+(g-c),g=b-x,c=b-g,Vh[1]=b-(g+c)+(c-x),k=v+g,c=k-v,Vh[2]=v-(k-c)+(g-c),Vh[3]=k;const $=zh(E,Lh,4,Vh,Hh);w=a*h,f=$h*a,d=f-(f-a),p=a-d,f=$h*h,y=f-(f-h),m=h-y,M=p*m-(w-d*y-p*y-d*m),x=u*l,f=$h*u,d=f-(f-u),p=u-d,f=$h*l,y=f-(f-l),m=l-y,F=p*m-(x-d*y-p*y-d*m),g=M-F,c=M-g,Vh[0]=M-(g+c)+(c-F),v=w+g,c=v-w,b=w-(v-c)+(g-c),g=b-x,c=b-g,Vh[1]=b-(g+c)+(c-x),k=v+g,c=k-v,Vh[2]=v-(k-c)+(g-c),Vh[3]=k;const I=zh($,Hh,4,Vh,Rh);return Rh[I-1]}(t,n,e,r,i,s,l)}function Gh(t,n,e){n=Math.max(0,void 0===n?2:n),e=e||0;var r=function(t){for(var n=t[0],e=t[0],r=t[0],i=t[0],s=0;s<t.length;s++){var o=t[s];o[0]<n[0]&&(n=o),o[0]>r[0]&&(r=o),o[1]<e[1]&&(e=o),o[1]>i[1]&&(i=o)}var a=[n,e,r,i],u=a.slice();for(s=0;s<t.length;s++)Ch(t[s],a)||u.push(t[s]);return function(t){t.sort(rc);for(var n=[],e=0;e<t.length;e++){for(;n.length>=2&&Kh(n[n.length-2],n[n.length-1],t[e])<=0;)n.pop();n.push(t[e])}for(var r=[],i=t.length-1;i>=0;i--){for(;r.length>=2&&Kh(r[r.length-2],r[r.length-1],t[i])<=0;)r.pop();r.push(t[i])}return r.pop(),n.pop(),n.concat(r)}(u)}(t),i=new dh(16);i.toBBox=function(t){return{minX:t[0],minY:t[1],maxX:t[0],maxY:t[1]}},i.compareMinX=function(t,n){return t[0]-n[0]},i.compareMinY=function(t,n){return t[1]-n[1]},i.load(t);for(var s,o=[],a=0;a<r.length;a++){var u=r[a];i.remove(u),s=Qh(u,s),o.push(s)}var l=new dh(16);for(a=0;a<o.length;a++)l.insert(Zh(o[a]));for(var h=n*n,c=e*e;o.length;){var f=o.shift(),d=f.p,p=f.next.p,y=tc(d,p);if(!(y<c)){var m=y/h;(u=Jh(i,f.prev.p,d,p,f.next.next.p,m,l))&&Math.min(tc(u,d),tc(u,p))<=m&&(o.push(f),o.push(Qh(u,f)),i.remove(u),l.remove(f),l.insert(Zh(f)),l.insert(Zh(f.next)))}}f=s;var g=[];do{g.push(f.p),f=f.next}while(f!==s);return g.push(f.p),g}function Jh(t,n,e,r,i,s,o){for(var a=new Ta([],Wh),u=t.data;u;){for(var l=0;l<u.children.length;l++){var h=u.children[l],c=u.leaf?nc(h,e,r):Bh(e,r,h);c>s||a.push({node:h,dist:c})}for(;a.length&&!a.peek().node.children;){var f=a.pop(),d=f.node,p=nc(d,n,e),y=nc(d,r,i);if(f.dist<p&&f.dist<y&&Yh(e,d,o)&&Yh(r,d,o))return d}(u=a.pop())&&(u=u.node)}return null}function Wh(t,n){return t.dist-n.dist}function Bh(t,n,e){if(Xh(t,e)||Xh(n,e))return 0;var r=ec(t[0],t[1],n[0],n[1],e.minX,e.minY,e.maxX,e.minY);if(0===r)return 0;var i=ec(t[0],t[1],n[0],n[1],e.minX,e.minY,e.minX,e.maxY);if(0===i)return 0;var s=ec(t[0],t[1],n[0],n[1],e.maxX,e.minY,e.maxX,e.maxY);if(0===s)return 0;var o=ec(t[0],t[1],n[0],n[1],e.minX,e.maxY,e.maxX,e.maxY);return 0===o?0:Math.min(r,i,s,o)}function Xh(t,n){return t[0]>=n.minX&&t[0]<=n.maxX&&t[1]>=n.minY&&t[1]<=n.maxY}function Yh(t,n,e){for(var r,i,s,o,a=Math.min(t[0],n[0]),u=Math.min(t[1],n[1]),l=Math.max(t[0],n[0]),h=Math.max(t[1],n[1]),c=e.search({minX:a,minY:u,maxX:l,maxY:h}),f=0;f<c.length;f++)if(r=c[f].p,i=c[f].next.p,s=t,r!==(o=n)&&i!==s&&Kh(r,i,s)>0!=Kh(r,i,o)>0&&Kh(s,o,r)>0!=Kh(s,o,i)>0)return!1;return!0}function Kh(t,n,e){return qh(t[0],t[1],n[0],n[1],e[0],e[1])}function Zh(t){var n=t.p,e=t.next.p;return t.minX=Math.min(n[0],e[0]),t.minY=Math.min(n[1],e[1]),t.maxX=Math.max(n[0],e[0]),t.maxY=Math.max(n[1],e[1]),t}function Qh(t,n){var e={p:t,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return n?(e.next=n.next,e.prev=n,n.next.prev=e,n.next=e):(e.prev=e,e.next=e),e}function tc(t,n){var e=t[0]-n[0],r=t[1]-n[1];return e*e+r*r}function nc(t,n,e){var r=n[0],i=n[1],s=e[0]-r,o=e[1]-i;if(0!==s||0!==o){var a=((t[0]-r)*s+(t[1]-i)*o)/(s*s+o*o);a>1?(r=e[0],i=e[1]):a>0&&(r+=s*a,i+=o*a)}return(s=t[0]-r)*s+(o=t[1]-i)*o}function ec(t,n,e,r,i,s,o,a){var u,l,h,c,f=e-t,d=r-n,p=o-i,y=a-s,m=t-i,g=n-s,v=f*f+d*d,b=f*p+d*y,w=p*p+y*y,M=f*m+d*g,x=p*m+y*g,F=v*w-b*b,k=F,A=F;0===F?(l=0,k=1,c=x,A=w):(c=v*x-b*M,(l=b*x-w*M)<0?(l=0,c=x,A=w):l>k&&(l=k,c=x+b,A=w)),c<0?(c=0,-M<0?l=0:-M>v?l=k:(l=-M,k=v)):c>A&&(c=A,-M+b<0?l=0:-M+b>v?l=k:(l=-M+b,k=v));var P=(1-(h=0===c?0:c/A))*i+h*o-((1-(u=0===l?0:l/k))*t+u*e),S=(1-h)*s+h*a-((1-u)*n+u*r);return P*P+S*S}function rc(t,n){return t[0]===n[0]?t[1]-n[1]:t[0]-n[0]}class ic{constructor(t,n){this.x=t,this.y=n}clone(){return new ic(this.x,this.y)}normalize(){const t=this.length();this.x/=t,this.y/=t}negate(){this.x=-this.x,this.y=-this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}diff(t){return new ic(this.x-t.x,this.y-t.y)}distance(t){const n=this.x-t.x,e=this.y-t.y;return Math.sqrt(n*n+e*e)}dot(t){return this.x*t.x+this.y*t.y}equals(t){return this.x===t.x&&this.y===t.y}orthogonal(){return new ic(this.y,-this.x)}}function sc(t,n,e,r){const i=n.x*r.y-n.y*r.x,s=e.x-t.x,o=e.y-t.y,a=(s*r.y-o*r.x)/i;return new ic(t.x+a*n.x,t.y+a*n.y)}const oc=[],ac=[];function uc(t){if(P(t[0]&&t[0].x)){const n=[];let e=0;for(let r=0;r<t.length;r++)ac[e]?(ac[e][0]=t[r].x,ac[e][1]=t[r].y):ac[e]=[t[r].x,t[r].y],n.push(ac[e]),e++;t=n}try{const n=Gh(t,1/0);let e=[1/0,1/0],r=[-1/0,-1/0];for(let t=0;t<n.length;t++)n[t][0]<e[0]&&(e[0]=n[t][0]),n[t][0]>r[0]&&(r[0]=n[t][0]),n[t][1]<e[1]&&(e[1]=n[t][1]),n[t][1]>r[1]&&(r[1]=n[t][1]);const i=[];let s=[],o=0;for(let t=0;t<n.length;t++)t===n.length-1&&n[t][0]===n[0][0]&&n[t][1]===n[0][1]||(Pt(i,n[t],"EPSG:3857"),oc[o]?(oc[o].x=i[0],oc[o].y=i[1]):oc[o]=new ic(i[0],i[1]),s.push(oc[o]),o++);An(s)<0&&(s=s.reverse());const a=function(t){let n,e=Number.MAX_VALUE;const r=function(t,r,i,s,o,a,u,l){var h=sc(t,r,o,a),c=sc(i,s,o,a),f=sc(u,l,t,r),d=sc(u,l,i,s),p=h.distance(c)*h.distance(f);0!==p&&p<e&&(n=[h,f,d,c],e=p)};var i=[];for(let n=0;n<t.length;n++)i.push(t[(n+1)%t.length].diff(t[n])),i[n].normalize();var s,o,a,u,l=new ic(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),h=new ic(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let n=0;n<t.length;n++){var c=t[n];c.x<l.x&&(l.x=c.x,s=n),c.x>h.x&&(h.x=c.x,o=n),c.y<l.y&&(l.y=c.y,u=n),c.y>h.y&&(h.y=c.y,a=n)}var f=new ic(0,-1),d=new ic(0,1),p=new ic(-1,0),y=new ic(1,0);for(let n=0;n<t.length;n++){var m=[Math.acos(f.dot(i[s])),Math.acos(d.dot(i[o])),Math.acos(p.dot(i[a])),Math.acos(y.dot(i[u]))];switch(m.indexOf(Math.min.apply(Math,m))){case 0:(d=(f=i[s].clone()).clone()).negate(),(y=(p=f.orthogonal()).clone()).negate(),s=(s+1)%t.length;break;case 1:(f=(d=i[o].clone()).clone()).negate(),(y=(p=f.orthogonal()).clone()).negate(),o=(o+1)%t.length;break;case 2:(y=(p=i[a].clone()).clone()).negate(),(d=(f=y.orthogonal()).clone()).negate(),a=(a+1)%t.length;break;case 3:(p=(y=i[u].clone()).clone()).negate(),(d=(f=y.orthogonal()).clone()).negate(),u=(u+1)%t.length}r(t[s],f,t[o],d,t[a],p,t[u],y)}return n}(s);if(!a||4!==a.length)return null;const u=a[0].distance(a[1]),l=a[1].distance(a[2]),h=a.map((t=>[t.x,t.y]));return h.push(+(l>u)),h}catch(t){return null}}const lc=[];function hc(t,n){const e=Array.isArray(t&&t[0]&&t[0][0]);for(let r=0;r<t.length;r++)e?t[r]=hc(t[r]):(Pt(lc,t[r],n),t[r][0]=lc[0],t[r][1]=lc[1]);return t}class cc extends Vl{constructor(t,n,e,r,i,s){super(t,n,e,r,i),(n=n||{}).extent||(n.extent=8192),this.setData(n.data,s)}setData(t,n){if(delete this.index,function(t){if(!t)return!0;if(Array.isArray(t)&&!t.length)return!0;if(t.features&&!t.features.length)return!0;return!1}(t))return this.empty=!0,void n();const e={maxZoom:24,tolerance:this.options.simplifyTolerance,extent:this.options.extent,buffer:P(this.options.tileBuffer)?this.options.tileBuffer:64,hasAltitude:!!this.options.hasAltitude,debug:0,lineMetrics:!0,indexMaxZoom:5,indexMaxPoints:1e5,disableFilter:!0};if(this.options.projection&&(e.projection=this.options.projection,"EPSG:4490"===e.projection&&(e.projection="EPSG:4326")),A(t)&&"{"!=t.substring(0,1)||t.url){const r=t.url?t.url:t;$.getJSON(r,t.url?t:{},((t,i)=>{if(t&&(console.error("Failed to fetch geojson:"+r),n(t)),!i)return void n(null,{extent:null,idMap:{}});let s=i;if(this.options.convertFn){s=new Function("data",this.options.convertFn+"\\nreturn convert(data)")(s)}const o=Array.isArray(s)?s:s.features;this.Sn(o);const{sample1000:a,idMap:u}=this._n(o);this.On(a,u,s,e,n)}))}else{"string"==typeof t&&(t=JSON.parse(t));const r=Array.isArray(t)?t:t.features,i=r&&r.length;this.Sn(r);let s=r;if(r&&i>1e3){s=[];for(let t=0;t<i;t++)fc(r[t],s,t,i)}this.On(s,null,t,e,n)}}Sn(t){if(this.options.generateOMBB&&t)for(let n=0;n<t.length;n++){const e=t[n];if(e&&e.geometry&&e.geometry.coordinates)if("Polygon"===e.geometry.type){const t=e.geometry.coordinates[0];if(!t)continue;const n=uc(t,t.length);e.properties=e.properties||{},e.properties[_l]=n}else if("MultiPolygon"===e.geometry.type){const t=e.geometry.coordinates;for(let n=0;n<t.length;n++){if(!t[n])continue;const r=t[n][0];if(!r)continue;const i=uc(r,r.length);e.properties=e.properties||{},e.properties[_l]=e.properties[_l]||[],e.properties[_l][n]=i}}}}On(t,n,e,r,i){try{const s=t&&t.length?function(t){let n=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];switch(t.type){case"FeatureCollection":const e=t.features.length;for(let r=0;r<e;r++)ih(t.features[r],n);break;case"Feature":ih(t,n);break;default:sh(t,n)}return n}({type:"FeatureCollection",features:t}):null;this.index=function(t,n){return new ut(t,n)}(e,this.options.geojsonvt||r),i(null,{extent:s,idMap:n})}catch(t){console.warn(t),i({error:t.message})}}_n(t){const n=[],e={};let r=0;const i=this.options.featureIdProperty;if(t){const s=t.length;t.forEach(((t,o)=>{!function(t,s,o){if(t&&("Feature"!==t.type||t.geometry)){if(P(t.id)||(t.id=r++),i){let n=i;_(i)&&(n=i[t.layer||"0"]),t.id=t.properties[n]}e[t.id]=k({},t),t.geometry?(e[t.id].geometry=k({},t.geometry),e[t.id].geometry.coordinates=null):t.coordinates&&(e[t.id].coordinates=null),fc(t,n,s,o)}}(t,o,s)}))}return{sample1000:n,idMap:e}}getTileFeatures(t,n){const e=t.tileInfo,r=[];if(!this.index)return this.empty?(setTimeout((function(){n(null,r,[])}),1),1):(setTimeout((function(){n({loading:!0})}),1),1);const i=this.index.getTile(e.z,e.x,e.y);if(!i||0===i.features.length)return setTimeout((function(){n(null,r,[])}),1),1;const s=[];for(let t=0,n=i.features.length;t<n;t++){const n=i.features[t];let e=n.layer;void 0===e&&(e="0"),s[e]={types:{}};s[e].types[n.type]=1,n.tags=n.tags||{},n.geometry.converted||(Rn(n),n.geometry.converted=1),r.push({type:n.type,layer:e,id:n.id,geometry:n.geometry,properties:n.tags,extent:this.options.extent})}for(const t in s)s[t].types=Object.keys(s[t].types).map((t=>+t));return setTimeout((function(){n(null,r,s)}),1),1}onRemove(){super.onRemove(),delete this.index}}function fc(t,n,e,r){const i=Math.floor(r/998);(0===e||e===r-1||(0===i||e%i==0)&&n.length<999)&&n.push(t)}var dc={\n/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */\nread:function(t,n,e,r,i){var s,o,a=8*i-r-1,u=(1<<a)-1,l=u>>1,h=-7,c=e?i-1:0,f=e?-1:1,d=t[n+c];for(c+=f,s=d&(1<<-h)-1,d>>=-h,h+=a;h>0;s=256*s+t[n+c],c+=f,h-=8);for(o=s&(1<<-h)-1,s>>=-h,h+=r;h>0;o=256*o+t[n+c],c+=f,h-=8);if(0===s)s=1-l;else{if(s===u)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,r),s-=l}return(d?-1:1)*o*Math.pow(2,s-r)},write:function(t,n,e,r,i,s){var o,a,u,l=8*s-i-1,h=(1<<l)-1,c=h>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:s-1,p=r?1:-1,y=n<0||0===n&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(a=isNaN(n)?1:0,o=h):(o=Math.floor(Math.log(n)/Math.LN2),n*(u=Math.pow(2,-o))<1&&(o--,u*=2),(n+=o+c>=1?f/u:f*Math.pow(2,1-c))*u>=2&&(o++,u/=2),o+c>=h?(a=0,o=h):o+c>=1?(a=(n*u-1)*Math.pow(2,i),o+=c):(a=n*Math.pow(2,c-1)*Math.pow(2,i),o=0));i>=8;t[e+d]=255&a,d+=p,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;t[e+d]=255&o,d+=p,o/=256,l-=8);t[e+d-p]|=128*y}},pc=mc,yc=dc;function mc(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}mc.Varint=0,mc.Fixed64=1,mc.Bytes=2,mc.Fixed32=5;var gc=4294967296,vc=1/gc,bc="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function wc(t){return t.type===mc.Bytes?t.readVarint()+t.pos:t.pos+1}function Mc(t,n,e){return e?4294967296*n+(t>>>0):4294967296*(n>>>0)+(t>>>0)}function xc(t,n,e){var r=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));e.realloc(r);for(var i=e.pos-1;i>=t;i--)e.buf[i+r]=e.buf[i]}function Fc(t,n){for(var e=0;e<t.length;e++)n.writeVarint(t[e])}function kc(t,n){for(var e=0;e<t.length;e++)n.writeSVarint(t[e])}function Ac(t,n){for(var e=0;e<t.length;e++)n.writeFloat(t[e])}function Pc(t,n){for(var e=0;e<t.length;e++)n.writeDouble(t[e])}function Sc(t,n){for(var e=0;e<t.length;e++)n.writeBoolean(t[e])}function _c(t,n){for(var e=0;e<t.length;e++)n.writeFixed32(t[e])}function Oc(t,n){for(var e=0;e<t.length;e++)n.writeSFixed32(t[e])}function Cc(t,n){for(var e=0;e<t.length;e++)n.writeFixed64(t[e])}function Ec(t,n){for(var e=0;e<t.length;e++)n.writeSFixed64(t[e])}function $c(t,n){return(t[n]|t[n+1]<<8|t[n+2]<<16)+16777216*t[n+3]}function Ic(t,n,e){t[e]=n,t[e+1]=n>>>8,t[e+2]=n>>>16,t[e+3]=n>>>24}function zc(t,n){return(t[n]|t[n+1]<<8|t[n+2]<<16)+(t[n+3]<<24)}mc.prototype={destroy:function(){this.buf=null},readFields:function(t,n,e){for(e=e||this.length;this.pos<e;){var r=this.readVarint(),i=r>>3,s=this.pos;this.type=7&r,t(i,n,this),this.pos===s&&this.skip(r)}return n},readMessage:function(t,n){return this.readFields(t,n,this.readVarint()+this.pos)},readFixed32:function(){var t=$c(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=zc(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=$c(this.buf,this.pos)+$c(this.buf,this.pos+4)*gc;return this.pos+=8,t},readSFixed64:function(){var t=$c(this.buf,this.pos)+zc(this.buf,this.pos+4)*gc;return this.pos+=8,t},readFloat:function(){var t=yc.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=yc.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var n,e,r=this.buf;return n=127&(e=r[this.pos++]),e<128?n:(n|=(127&(e=r[this.pos++]))<<7,e<128?n:(n|=(127&(e=r[this.pos++]))<<14,e<128?n:(n|=(127&(e=r[this.pos++]))<<21,e<128?n:function(t,n,e){var r,i,s=e.buf;if(i=s[e.pos++],r=(112&i)>>4,i<128)return Mc(t,r,n);if(i=s[e.pos++],r|=(127&i)<<3,i<128)return Mc(t,r,n);if(i=s[e.pos++],r|=(127&i)<<10,i<128)return Mc(t,r,n);if(i=s[e.pos++],r|=(127&i)<<17,i<128)return Mc(t,r,n);if(i=s[e.pos++],r|=(127&i)<<24,i<128)return Mc(t,r,n);if(i=s[e.pos++],r|=(1&i)<<31,i<128)return Mc(t,r,n);throw new Error("Expected varint not more than 10 bytes")}(n|=(15&(e=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,n=this.pos;return this.pos=t,t-n>=12&&bc?function(t,n,e){return bc.decode(t.subarray(n,e))}(this.buf,n,t):function(t,n,e){var r="",i=n;for(;i<e;){var s,o,a,u=t[i],l=null,h=u>239?4:u>223?3:u>191?2:1;if(i+h>e)break;1===h?u<128&&(l=u):2===h?128==(192&(s=t[i+1]))&&(l=(31&u)<<6|63&s)<=127&&(l=null):3===h?(s=t[i+1],o=t[i+2],128==(192&s)&&128==(192&o)&&((l=(15&u)<<12|(63&s)<<6|63&o)<=2047||l>=55296&&l<=57343)&&(l=null)):4===h&&(s=t[i+1],o=t[i+2],a=t[i+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&((l=(15&u)<<18|(63&s)<<12|(63&o)<<6|63&a)<=65535||l>=1114112)&&(l=null)),null===l?(l=65533,h=1):l>65535&&(l-=65536,r+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),r+=String.fromCharCode(l),i+=h}return r}(this.buf,n,t)},readBytes:function(){var t=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,t);return this.pos=t,n},readPackedVarint:function(t,n){if(this.type!==mc.Bytes)return t.push(this.readVarint(n));var e=wc(this);for(t=t||[];this.pos<e;)t.push(this.readVarint(n));return t},readPackedSVarint:function(t){if(this.type!==mc.Bytes)return t.push(this.readSVarint());var n=wc(this);for(t=t||[];this.pos<n;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==mc.Bytes)return t.push(this.readBoolean());var n=wc(this);for(t=t||[];this.pos<n;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==mc.Bytes)return t.push(this.readFloat());var n=wc(this);for(t=t||[];this.pos<n;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==mc.Bytes)return t.push(this.readDouble());var n=wc(this);for(t=t||[];this.pos<n;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==mc.Bytes)return t.push(this.readFixed32());var n=wc(this);for(t=t||[];this.pos<n;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==mc.Bytes)return t.push(this.readSFixed32());var n=wc(this);for(t=t||[];this.pos<n;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==mc.Bytes)return t.push(this.readFixed64());var n=wc(this);for(t=t||[];this.pos<n;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==mc.Bytes)return t.push(this.readSFixed64());var n=wc(this);for(t=t||[];this.pos<n;)t.push(this.readSFixed64());return t},skip:function(t){var n=7&t;if(n===mc.Varint)for(;this.buf[this.pos++]>127;);else if(n===mc.Bytes)this.pos=this.readVarint()+this.pos;else if(n===mc.Fixed32)this.pos+=4;else{if(n!==mc.Fixed64)throw new Error("Unimplemented type: "+n);this.pos+=8}},writeTag:function(t,n){this.writeVarint(t<<3|n)},realloc:function(t){for(var n=this.length||16;n<this.pos+t;)n*=2;if(n!==this.length){var e=new Uint8Array(n);e.set(this.buf),this.buf=e,this.length=n}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Ic(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Ic(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Ic(this.buf,-1&t,this.pos),Ic(this.buf,Math.floor(t*vc),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Ic(this.buf,-1&t,this.pos),Ic(this.buf,Math.floor(t*vc),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,n){var e,r;t>=0?(e=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(e=~(-t%4294967296))?e=e+1|0:(e=0,r=r+1|0));if(t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(t,n,e){e.buf[e.pos++]=127&t|128,t>>>=7,e.buf[e.pos++]=127&t|128,t>>>=7,e.buf[e.pos++]=127&t|128,t>>>=7,e.buf[e.pos++]=127&t|128,t>>>=7,e.buf[e.pos]=127&t}(e,0,n),function(t,n){var e=(7&t)<<4;if(n.buf[n.pos++]|=e|((t>>>=3)?128:0),!t)return;if(n.buf[n.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(n.buf[n.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(n.buf[n.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(n.buf[n.pos++]=127&t|((t>>>=7)?128:0),!t)return;n.buf[n.pos++]=127&t}(r,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var n=this.pos;this.pos=function(t,n,e){for(var r,i,s=0;s<n.length;s++){if((r=n.charCodeAt(s))>55295&&r<57344){if(!i){r>56319||s+1===n.length?(t[e++]=239,t[e++]=191,t[e++]=189):i=r;continue}if(r<56320){t[e++]=239,t[e++]=191,t[e++]=189,i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&(t[e++]=239,t[e++]=191,t[e++]=189,i=null);r<128?t[e++]=r:(r<2048?t[e++]=r>>6|192:(r<65536?t[e++]=r>>12|224:(t[e++]=r>>18|240,t[e++]=r>>12&63|128),t[e++]=r>>6&63|128),t[e++]=63&r|128)}return e}(this.buf,t,this.pos);var e=this.pos-n;e>=128&&xc(n,e,this),this.pos=n-1,this.writeVarint(e),this.pos+=e},writeFloat:function(t){this.realloc(4),yc.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),yc.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var n=t.length;this.writeVarint(n),this.realloc(n);for(var e=0;e<n;e++)this.buf[this.pos++]=t[e]},writeRawMessage:function(t,n){this.pos++;var e=this.pos;t(n,this);var r=this.pos-e;r>=128&&xc(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,n,e){this.writeTag(t,mc.Bytes),this.writeRawMessage(n,e)},writePackedVarint:function(t,n){n.length&&this.writeMessage(t,Fc,n)},writePackedSVarint:function(t,n){n.length&&this.writeMessage(t,kc,n)},writePackedBoolean:function(t,n){n.length&&this.writeMessage(t,Sc,n)},writePackedFloat:function(t,n){n.length&&this.writeMessage(t,Ac,n)},writePackedDouble:function(t,n){n.length&&this.writeMessage(t,Pc,n)},writePackedFixed32:function(t,n){n.length&&this.writeMessage(t,_c,n)},writePackedSFixed32:function(t,n){n.length&&this.writeMessage(t,Oc,n)},writePackedFixed64:function(t,n){n.length&&this.writeMessage(t,Cc,n)},writePackedSFixed64:function(t,n){n.length&&this.writeMessage(t,Ec,n)},writeBytesField:function(t,n){this.writeTag(t,mc.Bytes),this.writeBytes(n)},writeFixed32Field:function(t,n){this.writeTag(t,mc.Fixed32),this.writeFixed32(n)},writeSFixed32Field:function(t,n){this.writeTag(t,mc.Fixed32),this.writeSFixed32(n)},writeFixed64Field:function(t,n){this.writeTag(t,mc.Fixed64),this.writeFixed64(n)},writeSFixed64Field:function(t,n){this.writeTag(t,mc.Fixed64),this.writeSFixed64(n)},writeVarintField:function(t,n){this.writeTag(t,mc.Varint),this.writeVarint(n)},writeSVarintField:function(t,n){this.writeTag(t,mc.Varint),this.writeSVarint(n)},writeStringField:function(t,n){this.writeTag(t,mc.Bytes),this.writeString(n)},writeFloatField:function(t,n){this.writeTag(t,mc.Fixed32),this.writeFloat(n)},writeDoubleField:function(t,n){this.writeTag(t,mc.Fixed64),this.writeDouble(n)},writeBooleanField:function(t,n){this.writeVarintField(t,Boolean(n))}};var Dc=Et(pc),Tc=an,Uc=jc;function jc(t,n,e,r,i){this.properties={},this.extent=e,this.type=0,this.Cn=t,this.En=-1,this.$n=r,this.In=i,t.readFields(Nc,this,n)}function Nc(t,n,e){1==t?n.id=e.readVarint():2==t?function(t,n){var e=t.readVarint()+t.pos;for(;t.pos<e;){var r=n.$n[t.readVarint()],i=n.In[t.readVarint()];n.properties[r]=i}}(e,n):3==t?n.type=e.readVarint():4==t&&(n.En=e.pos)}function Lc(t){for(var n,e,r=0,i=0,s=t.length,o=s-1;i<s;o=i++)n=t[i],r+=((e=t[o]).x-n.x)*(n.y+e.y);return r}jc.types=["Unknown","Point","LineString","Polygon"],jc.prototype.loadGeometry=function(){var t=this.Cn;t.pos=this.En;for(var n,e=t.readVarint()+t.pos,r=1,i=0,s=0,o=0,a=[];t.pos<e;){if(i<=0){var u=t.readVarint();r=7&u,i=u>>3}if(i--,1===r||2===r)s+=t.readSVarint(),o+=t.readSVarint(),1===r&&(n&&a.push(n),n=[]),n.push(new Tc(s,o));else{if(7!==r)throw new Error("unknown command "+r);n&&n.push(n[0].clone())}}return n&&a.push(n),a},jc.prototype.bbox=function(){var t=this.Cn;t.pos=this.En;for(var n=t.readVarint()+t.pos,e=1,r=0,i=0,s=0,o=1/0,a=-1/0,u=1/0,l=-1/0;t.pos<n;){if(r<=0){var h=t.readVarint();e=7&h,r=h>>3}if(r--,1===e||2===e)(i+=t.readSVarint())<o&&(o=i),i>a&&(a=i),(s+=t.readSVarint())<u&&(u=s),s>l&&(l=s);else if(7!==e)throw new Error("unknown command "+e)}return[o,u,a,l]},jc.prototype.toGeoJSON=function(t,n,e){var r,i,s=this.extent*Math.pow(2,e),o=this.extent*t,a=this.extent*n,u=this.loadGeometry(),l=jc.types[this.type];function h(t){for(var n=0;n<t.length;n++){var e=t[n],r=180-360*(e.y+a)/s;t[n]=[360*(e.x+o)/s-180,360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90]}}switch(this.type){case 1:var c=[];for(r=0;r<u.length;r++)c[r]=u[r][0];h(u=c);break;case 2:for(r=0;r<u.length;r++)h(u[r]);break;case 3:for(u=function(t){var n=t.length;if(n<=1)return[t];for(var e,r,i=[],s=0;s<n;s++){var o=Lc(t[s]);0!==o&&(void 0===r&&(r=o<0),r===o<0?(e&&i.push(e),e=[t[s]]):e.push(t[s]))}e&&i.push(e);return i}(u),r=0;r<u.length;r++)for(i=0;i<u[r].length;i++)h(u[r][i])}1===u.length?u=u[0]:l="Multi"+l;var f={type:"Feature",geometry:{type:l,coordinates:u},properties:this.properties};return"id"in this&&(f.id=this.id),f};var Hc=Uc,Rc=Vc;function Vc(t,n){this.version=1,this.name=null,this.extent=4096,this.length=0,this.Cn=t,this.$n=[],this.In=[],this.zn=[],t.readFields(qc,this,n),this.length=this.zn.length}function qc(t,n,e){15===t?n.version=e.readVarint():1===t?n.name=e.readString():5===t?n.extent=e.readVarint():2===t?n.zn.push(e.pos):3===t?n.$n.push(e.readString()):4===t&&n.In.push(function(t){var n=null,e=t.readVarint()+t.pos;for(;t.pos<e;){var r=t.readVarint()>>3;n=1===r?t.readString():2===r?t.readFloat():3===r?t.readDouble():4===r?t.readVarint64():5===r?t.readVarint():6===r?t.readSVarint():7===r?t.readBoolean():null}return n}(e))}Vc.prototype.feature=function(t){if(t<0||t>=this.zn.length)throw new Error("feature index out of bounds");this.Cn.pos=this.zn[t];var n=this.Cn.readVarint()+this.Cn.pos;return new Hc(this.Cn,n,this.extent,this.$n,this.In)};var Gc=Rc,Jc=function(t,n){this.layers=t.readFields(Wc,{},n)};function Wc(t,n,e){if(3===t){var r=new Gc(e,e.readVarint()+e.pos);r.length&&(n[r.name]=r)}}var Bc=Jc;class Xc extends Vl{constructor(t,n,e,r,i,s){super(t,n,e,r,i),n=n||{},s()}getTileFeatures(t,n){const e=t.tileInfo.url,r=t.fetchOptions||{},i=this.qt.get(e);if(i&&i.cacheIndex===t.workerCacheIndex){const{err:t,data:r}=i;return setTimeout((()=>{this.Dn(e,t,r,n)}),1)}return r.referrer=t.referrer,$.getArrayBuffer(e,r,((r,i)=>{this.qt&&(r?r.loading||this.qt.add(e,{err:r,data:i&&i.data,cacheIndex:t.workerCacheIndex}):i&&i.data&&this.qt.add(e,{err:null,data:i.data,cacheIndex:t.workerCacheIndex}),this.Dn(e,r,i&&i.data,n))}))}Dn(t,n,e,r){if(n)return void r(n);let i;try{i=new Bc(new Dc(e))}catch(n){return void r(n.message,[],[])}const s=[];if(!i.layers)return void r(null,s,[]);const o={};let a;for(const t in i.layers)if(u=i.layers,l=t,Object.prototype.hasOwnProperty.call(u,l)){o[t]={types:{}};const e=o[t].types;for(let r=0,o=i.layers[t].length;r<o;r++)try{a=i.layers[t].feature(r),e[a.type]=1;const n={type:a.type,layer:t,geometry:a.loadGeometry(),properties:a.properties,extent:a.extent};void 0!==a.id&&(n.id=a.id);let o=n.properties[_l];o&&(A(o)&&(o=JSON.parse(o)),n.properties[_l]=hc(o,"EPSG:3857")),s.push(n)}catch(n){console.warn("error when load vt geometry:",n)}}var u,l;for(const t in o)o[t].types=Object.keys(o[t].types).map((t=>+t));r(null,s,o,{byteLength:e.byteLength})}abortTile(t,n){const e=this.requests[t];delete this.requests[t],e&&e.abort&&e.abort(),this.sn(t),n()}onRemove(){super.onRemove();for(const t in this.requests){const n=this.requests[t];n&&n.abort&&n.abort()}this.requests={}}}let Yc=0;const Kc=new vl(128);class Zc{constructor(t){this.Tn={},this.Un={},this.workerId=t}addLayer({actorId:t,mapId:n,layerId:e,params:r},i){if(this.jn(n,e))return;const s=this.Nn(n,e),o=r.type,a=r.options,u=this.send.bind(this,t);this.Tn[s]="GeoJSONVectorTileLayer"===o?new cc(e,a,u,Kc,{},i):new Xc(e,a,u,Kc,{},i)}removeLayer({mapId:t,layerId:n},e){const r=this.jn(t,n),i=this.Nn(t,n);delete this.Tn[i],r&&r.onRemove(e)}loadTile({mapId:t,layerId:n,params:e},r){const i=this.jn(t,n);i&&i.loadTile(e,r)}abortTile({mapId:t,layerId:n,params:e},r){const i=this.jn(t,n);i&&i.abortTile&&i.abortTile(e.url,r)}removeTile({mapId:t,layerId:n,params:e},r){const i=this.jn(t,n);i&&i.removeTile(e,r)}updateStyle({mapId:t,layerId:n,params:e},r){const i=this.jn(t,n);i&&i.updateStyle(e,r)}updateOptions({mapId:t,layerId:n,params:e},r){const i=this.jn(t,n);i&&i.updateOptions(e,r)}setData({mapId:t,layerId:n,params:e},r){const i=this.jn(t,n);i&&i.setData(e.data,r)}receive(t){const n=t.callback,e=this.Un[n];delete this.Un[n],e&&t.error?e(new Error(t.error)):e&&e(null,t.data)}send(t,n,e,r,i){const s=i?\`${YL}t}-${YL}Yc++}\`:null;i&&(this.Un[s]=i),postMessage({type:"<request>",workerId:this.workerId,actorId:t,command:n,params:e,callback:String(s)},r||[])}Nn(t,n){return\`${YL}t}-${YL}n}\`}jn(t,n){const e=this.Nn(t,n);return this.Tn[e]}Ln(){Kc.reset()}}t.initialize=function(){},t.onmessage=function(t,n){const e=t.data;if(this.dispatcher||(this.dispatcher=new Zc(t.workerId)),"<response>"===t.type)this.dispatcher.workerId===t.workerId&&this.dispatcher.receive(t);else{const r=e.command;this.dispatcher[r]({actorId:t.actorId,mapId:e.mapId,layerId:e.layerId,params:e.params},((t,e,i)=>{t&&404!==t.status&&204!==t.status&&!t.loading&&console.error(r,t),n(t,e,i)}))}}}`;var KL=$L;function $L(e,n){this.x=e,this.y=n}$L.prototype={clone:function(){return new $L(this.x,this.y)},add:function(e){return this.clone().i(e)},sub:function(e){return this.clone().o(e)},multByPoint:function(e){return this.clone().u(e)},divByPoint:function(e){return this.clone().m(e)},mult:function(e){return this.clone().A(e)},div:function(e){return this.clone().M(e)},rotate:function(e){return this.clone().S(e)},rotateAround:function(e,n){return this.clone().k(e,n)},matMult:function(e){return this.clone().P(e)},unit:function(){return this.clone().T()},perp:function(){return this.clone().I()},round:function(){return this.clone().F()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var n=e.x-this.x,i=e.y-this.y;return n*n+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,n){return Math.atan2(this.x*n-this.y*e,this.x*e+this.y*n)},P:function(e){var n=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=n,this},i:function(e){return this.x+=e.x,this.y+=e.y,this},o:function(e){return this.x-=e.x,this.y-=e.y,this},A:function(e){return this.x*=e,this.y*=e,this},M:function(e){return this.x/=e,this.y/=e,this},u:function(e){return this.x*=e.x,this.y*=e.y,this},m:function(e){return this.x/=e.x,this.y/=e.y,this},T:function(){return this.M(this.mag()),this},I:function(){var e=this.y;return this.y=this.x,this.x=-e,this},S:function(e){var n=Math.cos(e),i=Math.sin(e),o=i*this.x+n*this.y;return this.x=n*this.x-i*this.y,this.y=o,this},k:function(e,n){var i=Math.cos(e),o=Math.sin(e),s=n.y+o*(this.x-n.x)+i*(this.y-n.y);return this.x=n.x+i*(this.x-n.x)-o*(this.y-n.y),this.y=s,this},F:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},$L.convert=function(e){return e instanceof $L?e:Array.isArray(e)?new $L(e[0],e[1]):e};var tF=function(e){return e&&e.t&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}(KL);const eF={Point:1,LineString:2,Polygon:3,MultiPoint:4,MultiLineString:5,MultiPolygon:6};function nF(e,n={}){var i=[];if("FeatureCollection"===e.type)for(var o=0;o<e.features.length;o++)iF(i,e.features[o],n,o);else iF(i,"Feature"===e.type?e:{geometry:e},n);return i}function iF(e,n,i,o){if(n.geometry&&n.geometry.geometry){var s=n.geometry.coordinates,a=n.geometry.type,h=[],l=n.id;if(i.promoteId?l=n.properties[i.promoteId]:i.generateId&&(l=o||0),"Point"===a)rF(s,h);else if("MultiPoint"===a)for(var c=0;c<s.length;c++)rF(s[c],h);else if("LineString"===a)sF([s],h);else if("MultiLineString"===a){if(i.lineMetrics){for(c=0;c<s.length;c++)oF(s[c],h=[]),e.push(aF(l,"LineString",h,n.properties));return}sF(s,h)}else if("Polygon"===a)sF(s,h);else{if("MultiPolygon"!==a){if("GeometryCollection"===a){for(c=0;c<n.geometry.geometries.length;c++)iF(e,{id:l,geometry:n.geometry.geometries[c],properties:n.properties},i,o);return}return void console.warn(`Input data type(${a}) is not a valid GeoJSON geometry type.`)}for(c=0;c<s.length;c++){var A=[];sF(s[c],A),h.push(A)}}e.push(aF(l,a,h,n.properties))}}function rF(e,n){const i=new tF(e[0],e[1]);i.z=100*(e[2]||0),n.push([i])}function oF(e,n){for(let i=0;i<e.length;i++){const o=new tF(e[i][0],e[i][1]);o.z=100*(e[i][2]||0),n.push(o)}}function sF(e,n,i,o){for(var s=0;s<e.length;s++){var a=[];oF(e[s],a),n.push(a)}}function aF(e,n,i,o){return{id:void 0===e?null:e,type:eF[n],geometry:i,properties:o}}function hF(e,n,i){i=i||{},this.w=e||64,this.h=n||64,this.autoResize=!!i.autoResize,this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0}function lF(e,n,i){this.x=0,this.y=e,this.w=this.free=n,this.h=i}function uF(e,n,i,o,s,a,h){this.id=e,this.x=n,this.y=i,this.w=o,this.h=s,this.maxw=a||o,this.maxh=h||s,this.refcount=0
/*!
   * Codes from mapbox-gl-js
   * github.com/mapbox/mapbox-gl-js
   * MIT License
   */}function cF(e,{width:n,height:i},o,s){if(s){if(s.length!==n*i*o)throw new RangeError("mismatched image size")}else s=new Uint8Array(n*i*o);return e.width=n,e.height=i,e.data=s,e}function AF(e,{width:n,height:i},o){if(n===e.width&&i===e.height)return;const s=cF({},{width:n,height:i},o);fF(e,s,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,n),height:Math.min(e.height,i)},o),e.width=n,e.height=i,e.data=s.data}function fF(e,n,i,o,s,a){if(0===s.width||0===s.height)return n;if(s.width>e.width||s.height>e.height||i.x>e.width-s.width||i.y>e.height-s.height)throw new RangeError("out of range source coordinates for image copy");if(s.width>n.width||s.height>n.height||o.x>n.width-s.width||o.y>n.height-s.height)throw new RangeError("out of range destination coordinates for image copy");const h=e.data,l=n.data;if(h===l)return n;for(let c=0;c<s.height;c++){const A=((i.y+c)*e.width+i.x)*a,f=((o.y+c)*n.width+o.x)*a;for(let e=0;e<s.width*a;e++)l[f+e]=h[A+e]}return n}hF.prototype.pack=function(e,n){e=[].concat(e),n=n||{};for(var i,o,s,a=[],h=0;h<e.length;h++)if(o=e[h].h||e[h].height,(i=e[h].w||e[h].width)&&o){if(!(s=this.packOne(i,o,e[h].id)))continue;n.inPlace&&(e[h].x=s.x,e[h].y=s.y,e[h].id=s.id),a.push(s)}return this.shrink(),a},hF.prototype.packOne=function(e,n,i){var o,s,a,h,l,c,A,f,d={freebin:-1,shelf:-1,waste:1/0},p=0;if("string"==typeof i||"number"==typeof i){if(o=this.getBin(i))return this.ref(o),o;"number"==typeof i&&(this.maxId=Math.max(i,this.maxId))}else i=++this.maxId;for(h=0;h<this.freebins.length;h++){if(n===(o=this.freebins[h]).maxh&&e===o.maxw)return this.allocFreebin(h,e,n,i);n>o.maxh||e>o.maxw||n<=o.maxh&&e<=o.maxw&&(a=o.maxw*o.maxh-e*n)<d.waste&&(d.waste=a,d.freebin=h)}for(h=0;h<this.shelves.length;h++)if(p+=(s=this.shelves[h]).h,!(e>s.free)){if(n===s.h)return this.allocShelf(h,e,n,i);n>s.h||n<s.h&&(a=(s.h-n)*e)<d.waste&&(d.freebin=-1,d.waste=a,d.shelf=h)}return-1!==d.freebin?this.allocFreebin(d.freebin,e,n,i):-1!==d.shelf?this.allocShelf(d.shelf,e,n,i):n<=this.h-p&&e<=this.w?(s=new lF(p,this.w,n),this.allocShelf(this.shelves.push(s)-1,e,n,i)):this.autoResize?(l=c=this.h,((A=f=this.w)<=l||e>A)&&(f=2*Math.max(e,A)),(l<A||n>l)&&(c=2*Math.max(n,l)),this.resize(f,c),this.packOne(e,n,i)):null},hF.prototype.allocFreebin=function(e,n,i,o){var s=this.freebins.splice(e,1)[0];return s.id=o,s.w=n,s.h=i,s.refcount=0,this.bins[o]=s,this.ref(s),s},hF.prototype.allocShelf=function(e,n,i,o){var s=this.shelves[e].alloc(n,i,o);return this.bins[o]=s,this.ref(s),s},hF.prototype.shrink=function(){if(this.shelves.length>0){for(var e=0,n=0,i=0;i<this.shelves.length;i++){var o=this.shelves[i];n+=o.h,e=Math.max(o.w-o.free,e)}this.resize(e,n)}},hF.prototype.getBin=function(e){return this.bins[e]},hF.prototype.ref=function(e){if(1==++e.refcount){var n=e.h;this.stats[n]=1+(0|this.stats[n])}return e.refcount},hF.prototype.unref=function(e){return 0===e.refcount?0:(0==--e.refcount&&(this.stats[e.h]--,delete this.bins[e.id],this.freebins.push(e)),e.refcount)},hF.prototype.clear=function(){this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0},hF.prototype.resize=function(e,n){this.w=e,this.h=n;for(var i=0;i<this.shelves.length;i++)this.shelves[i].resize(e);return!0},lF.prototype.alloc=function(e,n,i){if(e>this.free||n>this.h)return null;var o=this.x;return this.x+=e,this.free-=e,new uF(i,o,this.y,e,n,e,this.h)},lF.prototype.resize=function(e){return this.free+=e-this.w,this.w=e,!0};let dF=class tt{constructor(e,n){cF(this,e,1,n)}resize(e){AF(this,e,1)}clone(){return new tt({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,i,o,s){fF(e,n,i,o,s,1)}},pF=class et{constructor(e,n){cF(this,e,4,n)}resize(e){AF(this,e,4)}clone(){return new et({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,i,o,s){fF(e,n,i,o,s,4)}};function gF(e){let n=0;for(let i,o,s=0,a=e.length,h=a-1;s<a;h=s++)if(i=e[s],o=e[h],void 0!==i.x){if(i.z||o.z)return 1;n+=(o.x-i.x)*(i.y+o.y)}else{if(i[2]||o[2])return 1;n+=(o[0]-i[0])*(i[1]+o[1])}return n}function mF(e,n,i){let o=i;return n&&e&&(o=+e[n]),isNaN(o)&&(o=i||0),100*o}function yF(e,n,i,o,s,a,h){n||0===n||(n=1);const l=mF(e.properties,i,o),c=l*n;let A=(a?100*a:0)||l;return s?A=mF(e.properties,s,a):h&&(A=l-mF(e.properties,h,a)),A*=n,{altitude:c,height:A}}function vF(e,n){return n<1/0&&(e.x<0||e.x>n||e.y<0||e.y>n)}function _F(e){return null==e}function xF(e,n,i){if(e===i||e===n)return e;const o=i-n;return((e-n)%o+o)%o+n}function bF(e,n){if(!n)return null;const i=new Map;for(let o=0;o<n.length;o++){const s=n[o],a=e[s];let h=i.get(a);h||(h=[],i.set(a,h)),h.push(s)}return i}function wF(e){return!(e&e-1)&&0!==e}
/*!
   * Codes from mapbox-gl-js
   * github.com/mapbox/mapbox-gl-js
   * MIT License
   */let CF=class ut{constructor(e,n,{pixelRatio:i}){this.paddedRect=e,this.pixelRatio=i||1,this.padding=n}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.pixelRatio,(this.paddedRect.h-2*this.padding)/this.pixelRatio]}},PF=class ct{constructor(e){this.glyphMap=e,this.build()}build(){const e=this.glyphMap,n=Object.keys(e).length,i={},o=new hF(0,0,{autoResize:!0}),s=[],a=n>1?1:0;for(const n in e){const o=e[n],h={x:0,y:0,w:o.data.width+2*a,h:o.data.height+2*a};s.push(h),i[n]=new CF(h,a,o)}if(o.pack(s,{inPlace:!0}),!wF(o.w)||!wF(o.h)){const e=MF(o.w),n=MF(o.h);o.resize(e,n)}const h=new pF({width:o.w,height:o.h});for(const n in e){const o=e[n],s=i[n].paddedRect;pF.copy(o.data,h,{x:0,y:0},{x:s.x+a,y:s.y+a},o.data)}this.image=h,this.positions=i}};function MF(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}
/*!
   * Codes from mapbox-gl-js
   * github.com/mapbox/mapbox-gl-js
   * MIT License
   * TODO potpack
   */let TF=class dt{constructor(e){this.glyphMap=e,this.build()}build(){const e=this.glyphMap,n={},i=new hF(0,0,{autoResize:!0}),o=[];for(const i in e){const s=e[i],a=n[i]={};for(const e in s){const n=s[+e];if(!n||0===n.bitmap.width||0===n.bitmap.height)continue;const i={x:0,y:0,w:n.bitmap.width+2,h:n.bitmap.height+2};o.push(i),a[e]={rect:i,metrics:n.metrics}}}i.pack(o,{inPlace:!0});const s=new dF({width:i.w,height:i.h});for(const i in e){const o=e[i];for(const e in o){const a=o[+e];if(!a||0===a.bitmap.width||0===a.bitmap.height)continue;const h=n[i][e].rect;dF.copy(a.bitmap,s,{x:0,y:0},{x:h.x+1,y:h.y+1},a.bitmap)}}this.image=s,this.positions=n}};function SF(e){return e<65536?Uint16Array:Uint32Array}function IF(e){return(e=Math.abs(e))<128?Int8Array:e<32768?Int16Array:Float32Array}function EF(e){return e<256?Uint8Array:e<65536?Uint16Array:Float32Array}function OF(e,n){const i=e.getLength?e.getLength():e.length;if(e instanceof n)return e.slice(0,i);const o=new n(i);e=e.C||e;for(let n=0;n<i;n++)o[n]=e[n]||0;return o}function RF(e){const n=e.type,i=[];if(1===n||4===n)for(let n=0;n<e.geometry.length;n++)rF(e.geometry[n],i);else if(2===n)sF(e.geometry,i);else if(3===n)sF(e.geometry,i);else if(5===n)sF(e.geometry,i);else if(6===n)for(let n=0;n<e.geometry.length;n++){const o=[];sF(e.geometry[n],o),i.push(o)}return e.geometry=i,e}function DF(e){for(let n=1;n<arguments.length;n++){const i=arguments[n];for(const n in i)e[n]=i[n]}return e}function kF(e){return null==e}function LF(e){return"number"==typeof e&&!isNaN(e)}function FF(e){return"object"==typeof e&&!!e}function NF(e){return!kF(e)&&("string"==typeof e||null!==e.constructor&&e.constructor===String)}const zF=Object.prototype.hasOwnProperty;function BF(e,n){return zF.call(e,n)}function HF(e){return e&&ED(e)&&e.property}const jF={};function UF(e,n){if(!Array.isArray(n)){if(n&&void 0!==n.r&&void 0!==n.g&&void 0!==n.b)return e[0]=255*n.r,e[1]=255*n.g,e[2]=255*n.b,e[3]=void 0!==n.a?255*n.a:255,e;n=jF[n]=jF[n]||Ck(n).unitArray()}for(let i=0;i<n.length;i++)e[i]=255*n[i];return 3===n.length&&(e[3]=255),e}const GF={textFill:1,textSize:1,textOpacity:1,textDx:1,textDy:1,markerWidth:1,markerHeight:1,markerOpacity:1,markerDx:1,markerDy:1,lineWidth:1,lineColor:1,lineOpacity:1,polygonFill:1,polygonOpacity:1,polygonPatternFileWidth:1,polygonPatternFileOrigin:1,rotationX:1,rotationY:1,rotationZ:1,scaleX:1,scaleY:1,scaleZ:1,translationX:1,translationY:1,translationZ:1};let VF=class Ft{constructor(e,n,i,o){this.feature=e,this.symbol=n,this.fnTypes=i,this.options=o}getPolygonResource(){let e=this.symbol.polygonPatternFile;const{polygonPatternFileFn:n}=this.fnTypes;return this.O(e,n)}getLineResource(){let e=this.symbol.linePatternFile;const{linePatternFileFn:n}=this.fnTypes;return this.O(e,n)}O(e,n){if(n){e=n(this.options.zoom,this.feature.properties)}return e}};function WF(e,n,i,o){const s=Math.abs(o)>>15,a=s>>1,h=s%2;let l=o%Math.pow(2,15);const c=n+(a<<14)*Math.sign(n),A=i+(h<<14)*Math.sign(i);return e[0]=c,e[1]=A,l=Math.round(l),e[2]=0===l?o<0?-1:0:l,e}const qF=Math.pow(2,14),ZF=Math.pow(2,15);function QF(e,n,i,o){const s=(Math.sign(n)||1)*(Math.abs(n)%qF),a=(Math.sign(i)||1)*(Math.abs(i)%qF),h=Math.floor(Math.abs(n)/qF),l=Math.floor(Math.abs(i)/qF);return e[0]=s,e[1]=a,e[2]=Math.sign(o+1e-5)*(2*h+l)*ZF+o,e
/*!
   * a compact version of mapbox-gl-style-spec
   * based on mapbox-gl-style-spec@13.28.0
   * https://github.com/mapbox/mapbox-gl-js/tree/main/src/style-spec
   * LICENSE : ISC
   */}var XF,YF,JF="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},KF={exports:{}};function $F(e,...n){for(const i of n)for(const n in i)e[n]=i[n];return e}
/*! https://mths.be/punycode v1.3.2 by @mathias */XF=KF,YF=KF.exports,function(e){var n=YF&&!YF.nodeType&&YF,i=XF&&!XF.nodeType&&XF,o="object"==typeof JF&&JF;o.global!==o&&o.window!==o&&o.self!==o||(e=o);var s,a,h=2147483647,l=36,c=26,A=38,f=700,d=/^xn--/,p=/[^\x20-\x7E]/,g=/[\x2E\u3002\uFF0E\uFF61]/g,v={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},w=l-1,C=Math.floor,P=String.fromCharCode;function T(e){throw RangeError(v[e])}function S(e,n){for(var i=e.length,o=[];i--;)o[i]=n(e[i]);return o}function I(e,n){var i=e.split("@"),o="";return i.length>1&&(o=i[0]+"@",e=i[1]),o+S((e=e.replace(g,".")).split("."),n).join(".")}function E(e){for(var n,i,o=[],s=0,a=e.length;s<a;)(n=e.charCodeAt(s++))>=55296&&n<=56319&&s<a?56320==(64512&(i=e.charCodeAt(s++)))?o.push(((1023&n)<<10)+(1023&i)+65536):(o.push(n),s--):o.push(n);return o}function O(e){return S(e,(function(e){var n="";return e>65535&&(n+=P((e-=65536)>>>10&1023|55296),e=56320|1023&e),n+P(e)})).join("")}function k(e,n){return e+22+75*(e<26)-((0!=n)<<5)}function L(e,n,i){var o=0;for(e=i?C(e/f):e>>1,e+=C(e/n);e>w*c>>1;o+=l)e=C(e/w);return C(o+(w+1)*e/(e+A))}function F(e){var n,i,o,s,a,A,f,d,p,g,v,w=[],P=e.length,S=0,I=128,E=72;for((i=e.lastIndexOf("-"))<0&&(i=0),o=0;o<i;++o)e.charCodeAt(o)>=128&&T("not-basic"),w.push(e.charCodeAt(o));for(s=i>0?i+1:0;s<P;){for(a=S,A=1,f=l;s>=P&&T("invalid-input"),((d=(v=e.charCodeAt(s++))-48<10?v-22:v-65<26?v-65:v-97<26?v-97:l)>=l||d>C((h-S)/A))&&T("overflow"),S+=d*A,!(d<(p=f<=E?1:f>=E+c?c:f-E));f+=l)A>C(h/(g=l-p))&&T("overflow"),A*=g;E=L(S-a,n=w.length+1,0==a),C(S/n)>h-I&&T("overflow"),I+=C(S/n),S%=n,w.splice(S++,0,I)}return O(w)}function N(e){var n,i,o,s,a,A,f,d,p,g,v,w,S,I,O,F=[];for(w=(e=E(e)).length,n=128,i=0,a=72,A=0;A<w;++A)(v=e[A])<128&&F.push(P(v));for(o=s=F.length,s&&F.push("-");o<w;){for(f=h,A=0;A<w;++A)(v=e[A])>=n&&v<f&&(f=v);for(f-n>C((h-i)/(S=o+1))&&T("overflow"),i+=(f-n)*S,n=f,A=0;A<w;++A)if((v=e[A])<n&&++i>h&&T("overflow"),v==n){for(d=i,p=l;!(d<(g=p<=a?1:p>=a+c?c:p-a));p+=l)F.push(P(k(g+(O=d-g)%(I=l-g),0))),d=C(O/I);F.push(P(k(d,0))),a=L(i,S,o==s),i=0,++o}++i,++n}return F.join("")}if(s={version:"1.3.2",ucs2:{decode:E,encode:O},decode:F,encode:N,toASCII:function(e){return I(e,(function(e){return p.test(e)?"xn--"+N(e):e}))},toUnicode:function(e){return I(e,(function(e){return d.test(e)?F(e.slice(4).toLowerCase()):e}))}},n&&i)if(XF.exports==n)i.exports=s;else for(a in s)s.hasOwnProperty(a)&&(n[a]=s[a]);else e.punycode=s}(JF);let tN=class Vt extends Error{constructor(e,n){super(n),this.message=n,this.key=e}};var eN=tN;var nN=class jt{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[e,i]of n)this.bindings[e]=i}concat(e){return new jt(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}};const iN={kind:"null"},rN={kind:"number"},oN={kind:"string"},sN={kind:"boolean"},aN={kind:"color"},hN={kind:"object"},lN={kind:"value"},uN={kind:"collator"},cN={kind:"formatted"},AN={kind:"resolvedImage"};function fN(e,n){return{kind:"array",itemType:e,N:n}}function dN(e){if("array"===e.kind){const n=dN(e.itemType);return"number"==typeof e.N?`array<${n}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${n}>`}return e.kind}const pN=[iN,rN,oN,sN,aN,cN,hN,fN(lN),AN];function gN(e,n){if("error"===n.kind)return null;if("array"===e.kind){if("array"===n.kind&&(0===n.N&&"value"===n.itemType.kind||!gN(e.itemType,n.itemType))&&("number"!=typeof e.N||e.N===n.N))return null}else{if(e.kind===n.kind)return null;if("value"===e.kind)for(const e of pN)if(!gN(e,n))return null}return`Expected ${dN(e)} but found ${dN(n)} instead.`}function mN(e,n){return n.some((n=>n.kind===e.kind))}function yN(e,n){return n.some((n=>"null"===n?null===e:"array"===n?Array.isArray(e):"object"===n?e&&!Array.isArray(e)&&"object"==typeof e:n===typeof e))}var vN,_N={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function xN(e){return(e=Math.round(e))<0?0:e>255?255:e}function bN(e){return e<0?0:e>1?1:e}function wN(e){return xN("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function CN(e){return bN("%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))}function PN(e,n,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?e+(n-e)*i*6:2*i<1?n:3*i<2?e+(n-e)*(2/3-i)*6:e}try{vN={}.parseCSSColor=function(e){var n,i=e.replace(/ /g,"").toLowerCase();if(i in _N)return _N[i].slice();if("#"===i[0])return 4===i.length?(n=parseInt(i.substr(1),16))>=0&&n<=4095?[(3840&n)>>4|(3840&n)>>8,240&n|(240&n)>>4,15&n|(15&n)<<4,1]:null:7===i.length&&(n=parseInt(i.substr(1),16))>=0&&n<=16777215?[(16711680&n)>>16,(65280&n)>>8,255&n,1]:null;var o=i.indexOf("("),s=i.indexOf(")");if(-1!==o&&s+1===i.length){var a=i.substr(0,o),h=i.substr(o+1,s-(o+1)).split(","),l=1;switch(a){case"rgba":if(4!==h.length)return null;l=CN(h.pop());case"rgb":return 3!==h.length?null:[wN(h[0]),wN(h[1]),wN(h[2]),l];case"hsla":if(4!==h.length)return null;l=CN(h.pop());case"hsl":if(3!==h.length)return null;var c=(parseFloat(h[0])%360+360)%360/360,A=CN(h[1]),f=CN(h[2]),d=f<=.5?f*(A+1):f+A-f*A,p=2*f-d;return[xN(255*PN(p,d,c+1/3)),xN(255*PN(p,d,c)),xN(255*PN(p,d,c-1/3)),l];default:return null}}return null}}catch(sat){}let MN=class de{constructor(e,n,i,o=1){this.r=e,this.g=n,this.b=i,this.a=o}static parse(e){if(!e)return;if(e instanceof de)return e;if("string"!=typeof e)return;const n=vN(e);return n?new de(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[e,n,i,o]=this.toArray();return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(i)},${o})`}toArray(){const{r:e,g:n,b:i,a:o}=this;return 0===o?[0,0,0,0]:[255*e/o,255*n/o,255*i/o,o]}toArray01(){const{r:e,g:n,b:i,a:o}=this;return 0===o?[0,0,0,0]:[e/o,n/o,i/o,o]}toArray01PremultipliedAlpha(){const{r:e,g:n,b:i,a:o}=this;return[e,n,i,o]}};MN.black=new MN(0,0,0,1),MN.white=new MN(1,1,1,1),MN.transparent=new MN(0,0,0,0),MN.red=new MN(1,0,0,1),MN.blue=new MN(0,0,1,1);var TN=MN;let SN=class me{constructor(e,n,i){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}},IN=class ye{constructor(e,n,i,o,s){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=i,this.fontStack=o,this.textColor=s}},EN=class ge{constructor(e){this.sections=e}static fromString(e){return new ge([new IN(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((e=>0!==e.text.length||e.image&&0!==e.image.name.length))}static factory(e){return e instanceof ge?e:ge.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){e.push(["image",n.image.name]);continue}e.push(n.text);const i={};n.fontStack&&(i["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(i["font-scale"]=n.scale),n.textColor&&(i["text-color"]=["rgba"].concat(n.textColor.toArray())),e.push(i)}return e}},ON=class ve{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new ve({name:e,available:!1}):null}serialize(){return["image",this.name]}};function RN(e,n,i,o){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof n&&n>=0&&n<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===o||"number"==typeof o&&o>=0&&o<=1?null:`Invalid rgba value [${[e,n,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof o?[e,n,i,o]:[e,n,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function DN(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof TN)return!0;if(e instanceof SN)return!0;if(e instanceof EN)return!0;if(e instanceof ON)return!0;if(Array.isArray(e)){for(const n of e)if(!DN(n))return!1;return!0}if("object"==typeof e){for(const n in e)if(!DN(e[n]))return!1;return!0}return!1}function kN(e){if(null===e)return iN;if("string"==typeof e)return oN;if("boolean"==typeof e)return sN;if("number"==typeof e)return rN;if(e instanceof TN)return aN;if(e instanceof SN)return uN;if(e instanceof EN)return cN;if(e instanceof ON)return AN;if(Array.isArray(e)){const n=e.length;let i;for(const n of e){const e=kN(n);if(i){if(i===e)continue;i=lN;break}i=e}return fN(i||lN,n)}return hN}function LN(e){const n=typeof e;return null===e?"":"string"===n||"number"===n||"boolean"===n?String(e):e instanceof TN||e instanceof EN||e instanceof ON?e.toString():JSON.stringify(e)}var FN=class Me{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(2!==e.length)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!DN(e[1]))return n.error("invalid value");const i=e[1];let o=kN(i);const s=n.expectedType;return"array"!==o.kind||0!==o.N||!s||"array"!==s.kind||"number"==typeof s.N&&0!==s.N||(o=s),new Me(o,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof TN?["rgba"].concat(this.value.toArray()):this.value instanceof EN?this.value.serialize():this.value}},NN=class Se{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}};const zN={string:oN,number:rN,boolean:sN,object:hN};var BN=class Pe{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let i,o=1;const s=e[0];if("array"===s){let s,a;if(e.length>2){const i=e[1];if("string"!=typeof i||!(i in zN)||"object"===i)return n.error('The item type argument of "array" must be one of string, number, boolean',1);s=zN[i],o++}else s=lN;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);a=e[2],o++}i=fN(s,a)}else i=zN[s];const a=[];for(;o<e.length;o++){const i=n.parse(e[o],o,lN);if(!i)return null;a.push(i)}return new Pe(i,a)}evaluate(e){for(let n=0;n<this.args.length;n++){const i=this.args[n].evaluate(e);if(!gN(this.type,kN(i)))return i;if(n===this.args.length-1)throw new NN(`Expected value to be of type ${dN(this.type)}, but found ${dN(kN(i))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,n=[e.kind];if("array"===e.kind){const i=e.itemType;if("string"===i.kind||"number"===i.kind||"boolean"===i.kind){n.push(i.kind);const o=e.N;("number"==typeof o||this.args.length>1)&&n.push(o)}}return n.concat(this.args.map((e=>e.serialize())))}};let HN=class Ie{constructor(e){this.type=cN,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const i=e[1];if(!Array.isArray(i)&&"object"==typeof i)return n.error("First argument must be an image or text section.");const o=[];let s=!1;for(let i=1;i<=e.length-1;++i){const a=e[i];if(s&&"object"==typeof a&&!Array.isArray(a)){s=!1;let e=null;if(a["font-scale"]&&(e=n.parse(a["font-scale"],1,rN),!e))return null;let i=null;if(a["text-font"]&&(i=n.parse(a["text-font"],1,fN(oN)),!i))return null;let h=null;if(a["text-color"]&&(h=n.parse(a["text-color"],1,aN),!h))return null;const l=o[o.length-1];l.scale=e,l.font=i,l.textColor=h}else{const a=n.parse(e[i],1,lN);if(!a)return null;const h=a.type.kind;if("string"!==h&&"value"!==h&&"null"!==h&&"resolvedImage"!==h)return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");s=!0,o.push({content:a,scale:null,font:null,textColor:null})}}return new Ie(o)}evaluate(e){return new EN(this.sections.map((n=>{const i=n.content.evaluate(e);return kN(i)===AN?new IN("",i,null,null,null):new IN(LN(i),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)})))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const i={};n.scale&&(i["font-scale"]=n.scale.serialize()),n.font&&(i["text-font"]=n.font.serialize()),n.textColor&&(i["text-color"]=n.textColor.serialize()),e.push(i)}return e}},jN=class Fe{constructor(e){this.type=AN,this.input=e}static parse(e,n){if(2!==e.length)return n.error("Expected two arguments.");const i=n.parse(e[1],1,oN);return i?new Fe(i):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),i=ON.fromString(n);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(n)>-1),i}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}};const UN={"to-boolean":sN,"to-color":aN,"to-number":rN,"to-string":oN};var GN=class Oe{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const i=e[0];if(("to-boolean"===i||"to-string"===i)&&2!==e.length)return n.error("Expected one argument.");const o=UN[i],s=[];for(let i=1;i<e.length;i++){const o=n.parse(e[i],i,lN);if(!o)return null;s.push(o)}return new Oe(o,s)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let n,i;for(const o of this.args){if(n=o.evaluate(e),i=null,n instanceof TN)return n;if("string"==typeof n){const i=e.parseColor(n);if(i)return i}else if(Array.isArray(n)&&(i=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:RN(n[0],n[1],n[2],n[3]),!i))return new TN(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new NN(i||`Could not parse color from value '${"string"==typeof n?n:String(JSON.stringify(n))}'`)}if("number"===this.type.kind){let n=null;for(const i of this.args){if(n=i.evaluate(e),null===n)return 0;const o=Number(n);if(!isNaN(o))return o}throw new NN(`Could not convert ${JSON.stringify(n)} to number.`)}return"formatted"===this.type.kind?EN.fromString(LN(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?ON.fromString(LN(this.args[0].evaluate(e))):LN(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new HN([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new jN(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild((n=>{e.push(n.serialize())})),e}};const VN=["Unknown","Point","LineString","Polygon"];var WN=class Le{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this.D={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?VN[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:i,y:o}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*n-e[0])+this.featureDistanceData.bearing[1]*(o*n-e[1])}return 0}parseColor(e){let n=this.D[e];return n||(n=this.D[e]=TN.parse(e)),n}};var qN=class Re{constructor(e,n,i,o){this.name=e,this.type=n,this.L=i,this.args=o}evaluate(e){return this.L(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,n){const i=e[0],o=Re.definitions[i];if(!o)return n.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const s=Array.isArray(o)?o[0]:o.type,a=Array.isArray(o)?[[o[1],o[2]]]:o.overloads,h=a.filter((([n])=>!Array.isArray(n)||n.length===e.length-1));let l=null;for(const[o,a]of h){l=new gz(n.registry,n.path,null,n.scope);const h=[];let c=!1;for(let n=1;n<e.length;n++){const i=e[n],s=Array.isArray(o)?o[n-1]:o.type,a=l.parse(i,1+h.length,s);if(!a){c=!0;break}h.push(a)}if(!c)if(Array.isArray(o)&&o.length!==h.length)l.error(`Expected ${o.length} arguments, but found ${h.length} instead.`);else{for(let e=0;e<h.length;e++){const n=Array.isArray(o)?o[e]:o.type,i=h[e];l.concat(e+1).checkSubtype(n,i.type)}if(0===l.errors.length)return new Re(i,s,a,h)}}if(1===h.length)n.errors.push(...l.errors);else{const i=(h.length?h:a).map((([e])=>{return n=e,Array.isArray(n)?`(${n.map(dN).join(", ")})`:`(${dN(n.type)}...)`;var n})).join(" | "),o=[];for(let i=1;i<e.length;i++){const s=n.parse(e[i],1+o.length);if(!s)return null;o.push(dN(s.type))}n.error(`Expected arguments of type ${i}, but found (${o.join(", ")}) instead.`)}return null}static register(e,n){Re.definitions=n;for(const i in n)e[i]=Re}};let ZN=class ze{constructor(e,n,i){this.type=uN,this.locale=i,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(2!==e.length)return n.error("Expected one argument.");const i=e[1];if("object"!=typeof i||Array.isArray(i))return n.error("Collator options argument must be an object.");const o=n.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,sN);if(!o)return null;const s=n.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,sN);if(!s)return null;let a=null;return i.locale&&(a=n.parse(i.locale,1,oN),!a)?null:new ze(o,s,a)}evaluate(e){return new SN(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}};const QN=8192;function XN(e,n){e[0]=Math.min(e[0],n[0]),e[1]=Math.min(e[1],n[1]),e[2]=Math.max(e[2],n[0]),e[3]=Math.max(e[3],n[1])}function YN(e,n){return!(e[0]<=n[0]||e[2]>=n[2]||e[1]<=n[1]||e[3]>=n[3])}function JN(e,n){const i=(180+e[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360;const s=Math.pow(2,n.z);return[Math.round(i*s*QN),Math.round(o*s*QN)]}function KN(e,n,i){const o=e[0]-n[0],s=e[1]-n[1],a=e[0]-i[0],h=e[1]-i[1];return o*h-a*s==0&&o*a<=0&&s*h<=0}function $N(e,n){let i=!1;for(let h=0,l=n.length;h<l;h++){const l=n[h];for(let n=0,h=l.length;n<h-1;n++){if(KN(e,l[n],l[n+1]))return!1;(s=l[n])[1]>(o=e)[1]!=(a=l[n+1])[1]>o[1]&&o[0]<(a[0]-s[0])*(o[1]-s[1])/(a[1]-s[1])+s[0]&&(i=!i)}}var o,s,a;return i}function tz(e,n){for(let i=0;i<n.length;i++)if($N(e,n[i]))return!0;return!1}function ez(e,n,i,o){const s=o[0]-i[0],a=o[1]-i[1],h=(e[0]-i[0])*a-s*(e[1]-i[1]),l=(n[0]-i[0])*a-s*(n[1]-i[1]);return h>0&&l<0||h<0&&l>0}function nz(e,n,i,o){return 0!=(s=[o[0]-i[0],o[1]-i[1]])[0]*(a=[n[0]-e[0],n[1]-e[1]])[1]-s[1]*a[0]&&!(!ez(e,n,i,o)||!ez(i,o,e,n));var s,a}function iz(e,n,i){for(const o of i)for(let i=0;i<o.length-1;++i)if(nz(e,n,o[i],o[i+1]))return!0;return!1}function rz(e,n){for(let i=0;i<e.length;++i)if(!$N(e[i],n))return!1;for(let i=0;i<e.length-1;++i)if(iz(e[i],e[i+1],n))return!1;return!0}function oz(e,n){for(let i=0;i<n.length;i++)if(rz(e,n[i]))return!0;return!1}function sz(e,n,i){const o=[];for(let s=0;s<e.length;s++){const a=[];for(let o=0;o<e[s].length;o++){const h=JN(e[s][o],i);XN(n,h),a.push(h)}o.push(a)}return o}function az(e,n,i){const o=[];for(let s=0;s<e.length;s++){const a=sz(e[s],n,i);o.push(a)}return o}function hz(e,n,i,o){if(e[0]<i[0]||e[0]>i[2]){const n=.5*o;let s=e[0]-i[0]>n?-o:i[0]-e[0]>n?o:0;0===s&&(s=e[0]-i[2]>n?-o:i[2]-e[0]>n?o:0),e[0]+=s}XN(n,e)}function lz(e,n,i,o){const s=Math.pow(2,o.z)*QN,a=[o.x*QN,o.y*QN],h=[];if(!e)return h;for(const o of e)for(const e of o){const o=[e.x+a[0],e.y+a[1]];hz(o,n,i,s),h.push(o)}return h}function uz(e,n,i,o){const s=Math.pow(2,o.z)*QN,a=[o.x*QN,o.y*QN],h=[];if(!e)return h;for(const i of e){const e=[];for(const o of i){const i=[o.x+a[0],o.y+a[1]];XN(n,i),e.push(i)}h.push(e)}if(n[2]-n[0]<=s/2){(l=n)[0]=l[1]=1/0,l[2]=l[3]=-1/0;for(const e of h)for(const o of e)hz(o,n,i,s)}var l;return h}var cz=class nn{constructor(e,n){this.type=sN,this.geojson=e,this.geometries=n}static parse(e,n){if(2!==e.length)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(DN(e[1])){const n=e[1];if("FeatureCollection"===n.type)for(let e=0;e<n.features.length;++e){const i=n.features[e].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new nn(n,n.features[e].geometry)}else if("Feature"===n.type){const e=n.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new nn(n,n.geometry)}else if("Polygon"===n.type||"MultiPolygon"===n.type)return new nn(n,n)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,n){const i=[1/0,1/0,-1/0,-1/0],o=[1/0,1/0,-1/0,-1/0],s=e.canonicalID();if(!s)return!1;if("Polygon"===n.type){const a=sz(n.coordinates,o,s),h=lz(e.geometry(),i,o,s);if(!YN(i,o))return!1;for(const e of h)if(!$N(e,a))return!1}if("MultiPolygon"===n.type){const a=az(n.coordinates,o,s),h=lz(e.geometry(),i,o,s);if(!YN(i,o))return!1;for(const e of h)if(!tz(e,a))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,n){const i=[1/0,1/0,-1/0,-1/0],o=[1/0,1/0,-1/0,-1/0],s=e.canonicalID();if(!s)return!1;if("Polygon"===n.type){const a=sz(n.coordinates,o,s),h=uz(e.geometry(),i,o,s);if(!YN(i,o))return!1;for(const e of h)if(!rz(e,a))return!1}if("MultiPolygon"===n.type){const a=az(n.coordinates,o,s),h=uz(e.geometry(),i,o,s);if(!YN(i,o))return!1;for(const e of h)if(!oz(e,a))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}};function Az(e){if(e instanceof qN){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof cz)return!1;let n=!0;return e.eachChild((e=>{n&&!Az(e)&&(n=!1)})),n}function fz(e){if(e instanceof qN&&"feature-state"===e.name)return!1;let n=!0;return e.eachChild((e=>{n&&!fz(e)&&(n=!1)})),n}function dz(e,n){if(e instanceof qN&&n.indexOf(e.name)>=0)return!1;let i=!0;return e.eachChild((e=>{i&&!dz(e,n)&&(i=!1)})),i}var pz=class ln{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(2!==e.length||"string"!=typeof e[1])return n.error("'var' expression requires exactly one string literal argument.");const i=e[1];return n.scope.has(i)?new ln(i,n.scope.get(i)):n.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}};var gz=class un{constructor(e,n=[],i,o=new nN,s=[]){this.registry=e,this.path=n,this.key=n.map((e=>`[${e}]`)).join(""),this.scope=o,this.errors=s,this.expectedType=i}parse(e,n,i,o,s={}){return n?this.concat(n,i,o).R(e,s):this.R(e,s)}R(e,n){function i(e,n,i){return"assert"===i?new BN(n,[e]):"coerce"===i?new GN(n,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const o=e[0];if("string"!=typeof o)return this.error(`Expression name must be a string, but found ${typeof o} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const s=this.registry[o];if(s){let o=s.parse(e,this);if(!o)return null;if(this.expectedType){const e=this.expectedType,s=o.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==s.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==s.kind&&"string"!==s.kind){if(this.checkSubtype(e,s))return null}else o=i(o,e,n.typeAnnotation||"coerce");else o=i(o,e,n.typeAnnotation||"assert")}if(!(o instanceof FN)&&"resolvedImage"!==o.type.kind&&mz(o)){const n=new WN;try{o=new FN(o.type,o.evaluate(n))}catch(e){return this.error(e.message),null}}return o}return this.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,i){const o="number"==typeof e?this.path.concat(e):this.path,s=i?this.scope.concat(i):this.scope;return new un(this.registry,o,n||null,s,this.errors)}error(e,...n){const i=`${this.key}${n.map((e=>`[${e}]`)).join("")}`;this.errors.push(new eN(i,e))}checkSubtype(e,n){const i=gN(e,n);return i&&this.error(i),i}};function mz(e){if(e instanceof pz)return mz(e.boundExpression);if(e instanceof qN&&"error"===e.name)return!1;if(e instanceof ZN)return!1;if(e instanceof cz)return!1;const n=e instanceof GN||e instanceof BN;let i=!0;return e.eachChild((e=>{i=n?i&&mz(e):i&&e instanceof FN})),!!i&&Az(e)&&dz(e,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function yz(e,n){const i=e.length-1;let o,s,a=0,h=i,l=0;for(;a<=h;)if(l=Math.floor((a+h)/2),o=e[l],s=e[l+1],o<=n){if(l===i||n<s)return l;a=l+1}else{if(!(o>n))throw new NN("Input is not a number.");h=l-1}return 0}var vz=class pn{constructor(e,n,i){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[e,n]of i)this.labels.push(e),this.outputs.push(n)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const i=n.parse(e[1],1,rN);if(!i)return null;const o=[];let s=null;n.expectedType&&"value"!==n.expectedType.kind&&(s=n.expectedType);for(let i=1;i<e.length;i+=2){const a=1===i?-1/0:e[i],h=e[i+1],l=i,c=i+1;if("number"!=typeof a)return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',l);if(o.length&&o[o.length-1][0]>=a)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',l);const A=n.parse(h,c,s);if(!A)return null;s=s||A.type,o.push([a,A])}return new pn(s,i,o)}evaluate(e){const n=this.labels,i=this.outputs;if(1===n.length)return i[0].evaluate(e);const o=this.input.evaluate(e);if(o<=n[0])return i[0].evaluate(e);const s=n.length;return o>=n[s-1]?i[s-1].evaluate(e):i[yz(n,o)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}},_z=xz;function xz(e,n,i,o){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(o-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=i,this.p2y=o}function bz(e,n,i){return e*(1-i)+n*i}xz.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,n){if(void 0===n&&(n=1e-6),e<0)return 0;if(e>1)return 1;for(var i=e,o=0;o<8;o++){var s=this.sampleCurveX(i)-e;if(Math.abs(s)<n)return i;var a=this.sampleCurveDerivativeX(i);if(Math.abs(a)<1e-6)break;i-=s/a}var h=0,l=1;for(i=e,o=0;o<20&&(s=this.sampleCurveX(i),!(Math.abs(s-e)<n));o++)e>s?h=i:l=i,i=.5*(l-h)+h;return i},solve:function(e,n){return this.sampleCurveY(this.solveCurveX(e,n))}};var wz=Object.freeze({__proto__:null,number:bz,color:function(e,n,i){return new TN(bz(e.r,n.r,i),bz(e.g,n.g,i),bz(e.b,n.b,i),bz(e.a,n.a,i))},array:function(e,n,i){return e.map(((e,o)=>bz(e,n[o],i)))}});const Cz=.95047,Pz=1.08883,Mz=4/29,Tz=6/29,Sz=3*Tz*Tz,Iz=Tz*Tz*Tz,Ez=Math.PI/180,Oz=180/Math.PI;function Rz(e){return e>Iz?Math.pow(e,1/3):e/Sz+Mz}function Dz(e){return e>Tz?e*e*e:Sz*(e-Mz)}function kz(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Lz(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Fz(e){const n=Lz(e.r),i=Lz(e.g),o=Lz(e.b),s=Rz((.4124564*n+.3575761*i+.1804375*o)/Cz),a=Rz((.2126729*n+.7151522*i+.072175*o)/1);return{l:116*a-16,a:500*(s-a),b:200*(a-Rz((.0193339*n+.119192*i+.9503041*o)/Pz)),alpha:e.a}}function Nz(e){let n=(e.l+16)/116,i=isNaN(e.a)?n:n+e.a/500,o=isNaN(e.b)?n:n-e.b/200;return n=1*Dz(n),i=Cz*Dz(i),o=Pz*Dz(o),new TN(kz(3.2404542*i-1.5371385*n-.4985314*o),kz(-.969266*i+1.8760108*n+.041556*o),kz(.0556434*i-.2040259*n+1.0572252*o),e.alpha)}function zz(e,n,i){const o=n-e;return e+i*(o>180||o<-180?o-360*Math.round(o/360):o)}const Bz={forward:Fz,reverse:Nz,interpolate:function(e,n,i){return{l:bz(e.l,n.l,i),a:bz(e.a,n.a,i),b:bz(e.b,n.b,i),alpha:bz(e.alpha,n.alpha,i)}}},Hz={forward:function(e){const{l:n,a:i,b:o}=Fz(e),s=Math.atan2(o,i)*Oz;return{h:s<0?s+360:s,c:Math.sqrt(i*i+o*o),l:n,alpha:e.a}},reverse:function(e){const n=e.h*Ez,i=e.c;return Nz({l:e.l,a:Math.cos(n)*i,b:Math.sin(n)*i,alpha:e.alpha})},interpolate:function(e,n,i){return{h:zz(e.h,n.h,i),c:bz(e.c,n.c,i),l:bz(e.l,n.l,i),alpha:bz(e.alpha,n.alpha,i)}}};var jz=Object.freeze({__proto__:null,lab:Bz,hcl:Hz});function Uz(e,n,i,o){const s=o-i,a=e-i;return 0===s?0:1===n?a/s:(Math.pow(n,a)-1)/(Math.pow(n,s)-1)}var Gz=class Nn{constructor(e,n,i,o,s){this.type=e,this.operator=n,this.interpolation=i,this.input=o,this.labels=[],this.outputs=[];for(const[e,n]of s)this.labels.push(e),this.outputs.push(n)}static interpolationFactor(e,n,i,o){let s=0;if("exponential"===e.name)s=Uz(n,e.base,i,o);else if("linear"===e.name)s=Uz(n,1,i,o);else if("cubic-bezier"===e.name){const a=e.controlPoints;s=new _z(a[0],a[1],a[2],a[3]).solve(Uz(n,1,i,o))}return s}static parse(e,n){let[i,o,s,...a]=e;if(!Array.isArray(o)||0===o.length)return n.error("Expected an interpolation type expression.",1);if("linear"===o[0])o={name:"linear"};else if("exponential"===o[0]){const e=o[1];if("number"!=typeof e)return n.error("Exponential interpolation requires a numeric base.",1,1);o={name:"exponential",base:e}}else{if("cubic-bezier"!==o[0])return n.error(`Unknown interpolation type ${String(o[0])}`,1,0);{const e=o.slice(1);if(4!==e.length||e.some((e=>"number"!=typeof e||e<0||e>1)))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);o={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(s=n.parse(s,2,rN),!s)return null;const h=[];let l=null;"interpolate-hcl"===i||"interpolate-lab"===i?l=aN:n.expectedType&&"value"!==n.expectedType.kind&&(l=n.expectedType);for(let e=0;e<a.length;e+=2){const i=a[e],o=a[e+1],s=e+3,c=e+4;if("number"!=typeof i)return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',s);if(h.length&&h[h.length-1][0]>=i)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',s);const A=n.parse(o,c,l);if(!A)return null;l=l||A.type,h.push([i,A])}return"number"===l.kind||"color"===l.kind||"array"===l.kind&&"number"===l.itemType.kind&&"number"==typeof l.N?new Nn(l,i,o,s,h):n.error(`Type ${dN(l)} is not interpolatable.`)}evaluate(e){const n=this.labels,i=this.outputs;if(1===n.length)return i[0].evaluate(e);const o=this.input.evaluate(e);if(o<=n[0])return i[0].evaluate(e);const s=n.length;if(o>=n[s-1])return i[s-1].evaluate(e);const a=yz(n,o),h=Nn.interpolationFactor(this.interpolation,o,n[a],n[a+1]),l=i[a].evaluate(e),c=i[a+1].evaluate(e);return"interpolate"===this.operator?wz[this.type.kind.toLowerCase()](l,c,h):"interpolate-hcl"===this.operator?Hz.reverse(Hz.interpolate(Hz.forward(l),Hz.forward(c),h)):Bz.reverse(Bz.interpolate(Bz.forward(l),Bz.forward(c),h))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,e,this.input.serialize()];for(let e=0;e<this.labels.length;e++)n.push(this.labels[e],this.outputs[e].serialize());return n}};var Vz=class jn{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let i=null;const o=n.expectedType;o&&"value"!==o.kind&&(i=o);const s=[];for(const o of e.slice(1)){const e=n.parse(o,1+s.length,i,void 0,{typeAnnotation:"omit"});if(!e)return null;i=i||e.type,s.push(e)}const a=o&&s.some((e=>gN(o,e.type)));return new jn(a?lN:i,s)}evaluate(e){let n,i=null,o=0;for(const s of this.args){if(o++,i=s.evaluate(e),i&&i instanceof ON&&!i.available&&(n||(n=i),i=null,o===this.args.length))return n;if(null!==i)break}return i}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((n=>{e.push(n.serialize())})),e}};var Wz=class Bn{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const i=[];for(let o=1;o<e.length-1;o+=2){const s=e[o];if("string"!=typeof s)return n.error(`Expected string, but found ${typeof s} instead.`,o);if(/[^a-zA-Z0-9_]/.test(s))return n.error("Variable names must contain only alphanumeric characters or '_'.",o);const a=n.parse(e[o+1],o+1);if(!a)return null;i.push([s,a])}const o=n.parse(e[e.length-1],e.length-1,n.expectedType,i);return o?new Bn(i,o):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,i]of this.bindings)e.push(n,i.serialize());return e.push(this.result.serialize()),e}};var qz=class Wn{constructor(e,n,i){this.type=e,this.index=n,this.input=i}static parse(e,n){if(3!==e.length)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=n.parse(e[1],1,rN),o=n.parse(e[2],2,fN(n.expectedType||lN));if(!i||!o)return null;return new Wn(o.type.itemType,i,o)}evaluate(e){const n=this.index.evaluate(e),i=this.input.evaluate(e);if(n<0)throw new NN(`Array index out of bounds: ${n} < 0.`);if(n>=i.length)throw new NN(`Array index out of bounds: ${n} > ${i.length-1}.`);if(n!==Math.floor(n))throw new NN(`Array index must be an integer, but found ${n} instead.`);return i[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}};var Zz=class Yn{constructor(e,n){this.type=sN,this.needle=e,this.haystack=n}static parse(e,n){if(3!==e.length)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=n.parse(e[1],1,lN),o=n.parse(e[2],2,lN);return i&&o?mN(i.type,[sN,oN,rN,iN,lN])?new Yn(i,o):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${dN(i.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(null==i)return!1;if(!yN(n,["boolean","string","number","null"]))throw new NN(`Expected first argument to be of type boolean, string, number or null, but found ${dN(kN(n))} instead.`);if(!yN(i,["string","array"]))throw new NN(`Expected second argument to be of type array or string, but found ${dN(kN(i))} instead.`);return i.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}};var Qz=class Jn{constructor(e,n,i){this.type=rN,this.needle=e,this.haystack=n,this.fromIndex=i}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=n.parse(e[1],1,lN),o=n.parse(e[2],2,lN);if(!i||!o)return null;if(!mN(i.type,[sN,oN,rN,iN,lN]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${dN(i.type)} instead`);if(4===e.length){const s=n.parse(e[3],3,rN);return s?new Jn(i,o,s):null}return new Jn(i,o)}evaluate(e){const n=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!yN(n,["boolean","string","number","null"]))throw new NN(`Expected first argument to be of type boolean, string, number or null, but found ${dN(kN(n))} instead.`);if(!yN(i,["string","array"]))throw new NN(`Expected second argument to be of type array or string, but found ${dN(kN(i))} instead.`);if(this.fromIndex){const o=this.fromIndex.evaluate(e);return i.indexOf(n,o)}return i.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}};var Xz=class Zn{constructor(e,n,i,o,s,a){this.inputType=e,this.type=n,this.input=i,this.cases=o,this.outputs=s,this.otherwise=a}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let i,o;n.expectedType&&"value"!==n.expectedType.kind&&(o=n.expectedType);const s={},a=[];for(let h=2;h<e.length-1;h+=2){let l=e[h];const c=e[h+1];Array.isArray(l)||(l=[l]);const A=n.concat(h);if(0===l.length)return A.error("Expected at least one branch label.");for(const e of l){if("number"!=typeof e&&"string"!=typeof e)return A.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return A.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return A.error("Numeric branch labels must be integer values.");if(i){if(A.checkSubtype(i,kN(e)))return null}else i=kN(e);if(void 0!==s[String(e)])return A.error("Branch labels must be unique.");s[String(e)]=a.length}const f=n.parse(c,h,o);if(!f)return null;o=o||f.type,a.push(f)}const h=n.parse(e[1],1,lN);if(!h)return null;const l=n.parse(e[e.length-1],e.length-1,o);return l?"value"!==h.type.kind&&n.concat(1).checkSubtype(i,h.type)?null:new Zn(i,o,h,s,a,l):null}evaluate(e){const n=this.input.evaluate(e);return(kN(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),i=[],o={};for(const e of n){const n=o[this.cases[e]];void 0===n?(o[this.cases[e]]=i.length,i.push([this.cases[e],[e]])):i[n][1].push(e)}const s=e=>"number"===this.inputType.kind?Number(e):e;for(const[n,o]of i)e.push(1===o.length?s(o[0]):o.map(s)),e.push(this.outputs[n].serialize());return e.push(this.otherwise.serialize()),e}};var Yz=class ti{constructor(e,n,i){this.type=e,this.branches=n,this.otherwise=i}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let i;n.expectedType&&"value"!==n.expectedType.kind&&(i=n.expectedType);const o=[];for(let s=1;s<e.length-1;s+=2){const a=n.parse(e[s],s,sN);if(!a)return null;const h=n.parse(e[s+1],s+1,i);if(!h)return null;o.push([a,h]),i=i||h.type}const s=n.parse(e[e.length-1],e.length-1,i);return s?new ti(i,o,s):null}evaluate(e){for(const[n,i]of this.branches)if(n.evaluate(e))return i.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,i]of this.branches)e(n),e(i);e(this.otherwise)}outputDefined(){return this.branches.every((([e,n])=>n.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((n=>{e.push(n.serialize())})),e}};var Jz=class ni{constructor(e,n,i,o){this.type=e,this.input=n,this.beginIndex=i,this.endIndex=o}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=n.parse(e[1],1,lN),o=n.parse(e[2],2,rN);if(!i||!o)return null;if(!mN(i.type,[fN(lN),oN,lN]))return n.error(`Expected first argument to be of type array or string, but found ${dN(i.type)} instead`);if(4===e.length){const s=n.parse(e[3],3,rN);return s?new ni(i.type,i,o,s):null}return new ni(i.type,i,o)}evaluate(e){const n=this.input.evaluate(e),i=this.beginIndex.evaluate(e);if(!yN(n,["string","array"]))throw new NN(`Expected first argument to be of type array or string, but found ${dN(kN(n))} instead.`);if(this.endIndex){const o=this.endIndex.evaluate(e);return n.slice(i,o)}return n.slice(i)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}};function Kz(e,n){return"=="===e||"!="===e?"boolean"===n.kind||"string"===n.kind||"number"===n.kind||"null"===n.kind||"value"===n.kind:"string"===n.kind||"number"===n.kind||"value"===n.kind}function $z(e,n,i,o){return 0===o.compare(n,i)}function tB(e,n,i){const o="=="!==e&&"!="!==e;return class r{constructor(e,n,i){this.type=sN,this.lhs=e,this.rhs=n,this.collator=i,this.hasUntypedArgument="value"===e.type.kind||"value"===n.type.kind}static parse(e,n){if(3!==e.length&&4!==e.length)return n.error("Expected two or three arguments.");const i=e[0];let s=n.parse(e[1],1,lN);if(!s)return null;if(!Kz(i,s.type))return n.concat(1).error(`"${i}" comparisons are not supported for type '${dN(s.type)}'.`);let a=n.parse(e[2],2,lN);if(!a)return null;if(!Kz(i,a.type))return n.concat(2).error(`"${i}" comparisons are not supported for type '${dN(a.type)}'.`);if(s.type.kind!==a.type.kind&&"value"!==s.type.kind&&"value"!==a.type.kind)return n.error(`Cannot compare types '${dN(s.type)}' and '${dN(a.type)}'.`);o&&("value"===s.type.kind&&"value"!==a.type.kind?s=new BN(a.type,[s]):"value"!==s.type.kind&&"value"===a.type.kind&&(a=new BN(s.type,[a])));let h=null;if(4===e.length){if("string"!==s.type.kind&&"string"!==a.type.kind&&"value"!==s.type.kind&&"value"!==a.type.kind)return n.error("Cannot use collator to compare non-string types.");if(h=n.parse(e[3],3,uN),!h)return null}return new r(s,a,h)}evaluate(s){const a=this.lhs.evaluate(s),h=this.rhs.evaluate(s);if(o&&this.hasUntypedArgument){const n=kN(a),i=kN(h);if(n.kind!==i.kind||"string"!==n.kind&&"number"!==n.kind)throw new NN(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${n.kind}, ${i.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const e=kN(a),i=kN(h);if("string"!==e.kind||"string"!==i.kind)return n(s,a,h)}return this.collator?i(s,a,h,this.collator.evaluate(s)):n(s,a,h)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){const n=[e];return this.eachChild((e=>{n.push(e.serialize())})),n}}}const eB=tB("==",(function(e,n,i){return n===i}),$z),nB=tB("!=",(function(e,n,i){return n!==i}),(function(e,n,i,o){return!$z(0,n,i,o)})),iB=tB("<",(function(e,n,i){return n<i}),(function(e,n,i,o){return o.compare(n,i)<0})),rB=tB(">",(function(e,n,i){return n>i}),(function(e,n,i,o){return o.compare(n,i)>0})),oB=tB("<=",(function(e,n,i){return n<=i}),(function(e,n,i,o){return o.compare(n,i)<=0})),sB=tB(">=",(function(e,n,i){return n>=i}),(function(e,n,i,o){return o.compare(n,i)>=0}));const aB={"==":eB,"!=":nB,">":rB,"<":iB,">=":sB,"<=":oB,array:BN,at:qz,boolean:BN,case:Yz,coalesce:Vz,collator:ZN,format:HN,image:jN,in:Zz,"index-of":Qz,interpolate:Gz,"interpolate-hcl":Gz,"interpolate-lab":Gz,length:class pi{constructor(e){this.type=rN,this.input=e}static parse(e,n){if(2!==e.length)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const i=n.parse(e[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?n.error(`Expected argument of type string or array, but found ${dN(i.type)} instead.`):new pi(i):null}evaluate(e){const n=this.input.evaluate(e);if("string"==typeof n)return n.length;if(Array.isArray(n))return n.length;throw new NN(`Expected value to be of type string or array, but found ${dN(kN(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((n=>{e.push(n.serialize())})),e}},let:Wz,literal:FN,match:Xz,number:BN,"number-format":class di{constructor(e,n,i,o,s,a){this.type=oN,this.number=e,this.locale=n,this.currency=i,this.unit=o,this.minFractionDigits=s,this.maxFractionDigits=a}static parse(e,n){if(3!==e.length)return n.error("Expected two arguments.");const i=n.parse(e[1],1,rN);if(!i)return null;const o=e[2];if("object"!=typeof o||Array.isArray(o))return n.error("NumberFormat options argument must be an object.");let s=null;if(o.locale&&(s=n.parse(o.locale,1,oN),!s))return null;let a=null;if(o.currency&&(a=n.parse(o.currency,1,oN),!a))return null;let h=null;if(o.unit&&(h=n.parse(o.unit,1,oN),!h))return null;let l=null;if(o["min-fraction-digits"]&&(l=n.parse(o["min-fraction-digits"],1,rN),!l))return null;let c=null;return o["max-fraction-digits"]&&(c=n.parse(o["max-fraction-digits"],1,rN),!c)?null:new di(i,s,a,h,l,c)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}},object:BN,slice:Jz,step:vz,string:BN,"to-boolean":GN,"to-color":GN,"to-number":GN,"to-string":GN,var:pz,within:cz};function hB(e,[n,i,o,s]){n=n.evaluate(e),i=i.evaluate(e),o=o.evaluate(e);const a=s?s.evaluate(e):1,h=RN(n,i,o,a);if(h)throw new NN(h);return new TN(n/255*a,i/255*a,o/255*a,a)}function lB(e,n){return e in n}function uB(e,n){const i=n[e];return void 0===i?null:i}function cB(e){return{type:e}}qN.register(aB,{error:[{kind:"error"},[oN],(e,[n])=>{throw new NN(n.evaluate(e))}],typeof:[oN,[lN],(e,[n])=>dN(kN(n.evaluate(e)))],"to-rgba":[fN(rN,4),[aN],(e,[n])=>n.evaluate(e).toArray()],rgb:[aN,[rN,rN,rN],hB],rgba:[aN,[rN,rN,rN,rN],hB],has:{type:sN,overloads:[[[oN],(e,[n])=>lB(n.evaluate(e),e.properties())],[[oN,hN],(e,[n,i])=>lB(n.evaluate(e),i.evaluate(e))]]},get:{type:lN,overloads:[[[oN],(e,[n])=>uB(n.evaluate(e),e.properties())],[[oN,hN],(e,[n,i])=>uB(n.evaluate(e),i.evaluate(e))]]},"feature-state":[lN,[oN],(e,[n])=>uB(n.evaluate(e),e.featureState||{})],properties:[hN,[],e=>e.properties()],"geometry-type":[oN,[],e=>e.geometryType()],id:[lN,[],e=>e.id()],zoom:[rN,[],e=>e.globals.zoom],pitch:[rN,[],e=>e.globals.pitch||0],"distance-from-center":[rN,[],e=>e.distanceFromCenter()],"heatmap-density":[rN,[],e=>e.globals.heatmapDensity||0],"line-progress":[rN,[],e=>e.globals.lineProgress||0],"sky-radial-progress":[rN,[],e=>e.globals.skyRadialProgress||0],accumulated:[lN,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[rN,cB(rN),(e,n)=>{let i=0;for(const o of n)i+=o.evaluate(e);return i}],"*":[rN,cB(rN),(e,n)=>{let i=1;for(const o of n)i*=o.evaluate(e);return i}],"-":{type:rN,overloads:[[[rN,rN],(e,[n,i])=>n.evaluate(e)-i.evaluate(e)],[[rN],(e,[n])=>-n.evaluate(e)]]},"/":[rN,[rN,rN],(e,[n,i])=>n.evaluate(e)/i.evaluate(e)],"%":[rN,[rN,rN],(e,[n,i])=>n.evaluate(e)%i.evaluate(e)],ln2:[rN,[],()=>Math.LN2],pi:[rN,[],()=>Math.PI],e:[rN,[],()=>Math.E],"^":[rN,[rN,rN],(e,[n,i])=>Math.pow(n.evaluate(e),i.evaluate(e))],sqrt:[rN,[rN],(e,[n])=>Math.sqrt(n.evaluate(e))],log10:[rN,[rN],(e,[n])=>Math.log(n.evaluate(e))/Math.LN10],ln:[rN,[rN],(e,[n])=>Math.log(n.evaluate(e))],log2:[rN,[rN],(e,[n])=>Math.log(n.evaluate(e))/Math.LN2],sin:[rN,[rN],(e,[n])=>Math.sin(n.evaluate(e))],cos:[rN,[rN],(e,[n])=>Math.cos(n.evaluate(e))],tan:[rN,[rN],(e,[n])=>Math.tan(n.evaluate(e))],asin:[rN,[rN],(e,[n])=>Math.asin(n.evaluate(e))],acos:[rN,[rN],(e,[n])=>Math.acos(n.evaluate(e))],atan:[rN,[rN],(e,[n])=>Math.atan(n.evaluate(e))],min:[rN,cB(rN),(e,n)=>Math.min(...n.map((n=>n.evaluate(e))))],max:[rN,cB(rN),(e,n)=>Math.max(...n.map((n=>n.evaluate(e))))],abs:[rN,[rN],(e,[n])=>Math.abs(n.evaluate(e))],round:[rN,[rN],(e,[n])=>{const i=n.evaluate(e);return i<0?-Math.round(-i):Math.round(i)}],floor:[rN,[rN],(e,[n])=>Math.floor(n.evaluate(e))],ceil:[rN,[rN],(e,[n])=>Math.ceil(n.evaluate(e))],"filter-==":[sN,[oN,lN],(e,[n,i])=>e.properties()[n.value]===i.value],"filter-id-==":[sN,[lN],(e,[n])=>e.id()===n.value],"filter-type-==":[sN,[oN],(e,[n])=>e.geometryType()===n.value],"filter-<":[sN,[oN,lN],(e,[n,i])=>{const o=e.properties()[n.value],s=i.value;return typeof o==typeof s&&o<s}],"filter-id-<":[sN,[lN],(e,[n])=>{const i=e.id(),o=n.value;return typeof i==typeof o&&i<o}],"filter->":[sN,[oN,lN],(e,[n,i])=>{const o=e.properties()[n.value],s=i.value;return typeof o==typeof s&&o>s}],"filter-id->":[sN,[lN],(e,[n])=>{const i=e.id(),o=n.value;return typeof i==typeof o&&i>o}],"filter-<=":[sN,[oN,lN],(e,[n,i])=>{const o=e.properties()[n.value],s=i.value;return typeof o==typeof s&&o<=s}],"filter-id-<=":[sN,[lN],(e,[n])=>{const i=e.id(),o=n.value;return typeof i==typeof o&&i<=o}],"filter->=":[sN,[oN,lN],(e,[n,i])=>{const o=e.properties()[n.value],s=i.value;return typeof o==typeof s&&o>=s}],"filter-id->=":[sN,[lN],(e,[n])=>{const i=e.id(),o=n.value;return typeof i==typeof o&&i>=o}],"filter-has":[sN,[lN],(e,[n])=>n.value in e.properties()],"filter-has-id":[sN,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[sN,[fN(oN)],(e,[n])=>n.value.indexOf(e.geometryType())>=0],"filter-id-in":[sN,[fN(lN)],(e,[n])=>n.value.indexOf(e.id())>=0],"filter-in-small":[sN,[oN,fN(lN)],(e,[n,i])=>i.value.indexOf(e.properties()[n.value])>=0],"filter-in-large":[sN,[oN,fN(lN)],(e,[n,i])=>function(e,n,i,o){for(;i<=o;){const s=i+o>>1;if(n[s]===e)return!0;n[s]>e?o=s-1:i=s+1}return!1}(e.properties()[n.value],i.value,0,i.value.length-1)],all:{type:sN,overloads:[[[sN,sN],(e,[n,i])=>n.evaluate(e)&&i.evaluate(e)],[cB(sN),(e,n)=>{for(const i of n)if(!i.evaluate(e))return!1;return!0}]]},any:{type:sN,overloads:[[[sN,sN],(e,[n,i])=>n.evaluate(e)||i.evaluate(e)],[cB(sN),(e,n)=>{for(const i of n)if(i.evaluate(e))return!0;return!1}]]},"!":[sN,[sN],(e,[n])=>!n.evaluate(e)],"is-supported-script":[sN,[oN],(e,[n])=>{const i=e.globals&&e.globals.isSupportedScript;return!i||i(n.evaluate(e))}],upcase:[oN,[oN],(e,[n])=>n.evaluate(e).toUpperCase()],downcase:[oN,[oN],(e,[n])=>n.evaluate(e).toLowerCase()],concat:[oN,cB(lN),(e,n)=>n.map((n=>LN(n.evaluate(e)))).join("")],"resolved-locale":[oN,[uN],(e,[n])=>n.evaluate(e).resolvedLocale()]});var AB=aB;function fB(e){return{result:"success",value:e}}function dB(e){return{result:"error",value:e}}function pB(e){return!!e.expression&&e.expression.interpolated}function gB(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function mB(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function yB(e){return e}function vB(e,n){const i="color"===n.type,o=e.stops&&"object"==typeof e.stops[0][0],s=o||!(o||void 0!==e.property),a=e.type||(pB(n)?"exponential":"interval");if(i&&((e=$F({},e)).stops&&(e.stops=e.stops.map((e=>[e[0],TN.parse(e[1])]))),e.default=TN.parse(e.default?e.default:n.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!jz[e.colorSpace])throw new Error(`Unknown color space: ${e.colorSpace}`);let h,l,c;if("exponential"===a)h=wB;else if("interval"===a)h=bB;else if("categorical"===a){h=xB,l=Object.create(null);for(const n of e.stops)l[n[0]]=n[1];c=typeof e.stops[0][0]}else{if("identity"!==a)throw new Error(`Unknown function type "${a}"`);h=CB}if(o){const i={},o=[];for(let n=0;n<e.stops.length;n++){const s=e.stops[n],a=s[0].zoom;void 0===i[a]&&(i[a]={zoom:a,type:e.type,property:e.property,default:e.default,stops:[]},o.push(a)),i[a].stops.push([s[0].value,s[1]])}const s=[];for(const e of o)s.push([i[e].zoom,vB(i[e],n)]);const a={name:"linear"};return{kind:"composite",interpolationType:a,interpolationFactor:Gz.interpolationFactor.bind(void 0,a),zoomStops:s.map((e=>e[0])),evaluate:({zoom:i},o)=>wB({stops:s,base:e.base},n,i).evaluate(i,o)}}if(s){const i="exponential"===a?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:i,interpolationFactor:Gz.interpolationFactor.bind(void 0,i),zoomStops:e.stops.map((e=>e[0])),evaluate:({zoom:i})=>h(e,n,i,l,c)}}return{kind:"source",evaluate(i,o){const s=o&&o.properties?o.properties[e.property]:void 0;return void 0===s?_B(e.default,n.default):h(e,n,s,l,c)}}}function _B(e,n,i){return void 0!==e?e:void 0!==n?n:void 0!==i?i:void 0}function xB(e,n,i,o,s){return _B(typeof i===s?o[i]:void 0,e.default,n.default)}function bB(e,n,i){if("number"!==gB(i))return _B(e.default,n.default);const o=e.stops.length;if(1===o)return e.stops[0][1];if(i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[o-1][0])return e.stops[o-1][1];const s=yz(e.stops.map((e=>e[0])),i);return e.stops[s][1]}function wB(e,n,i){const o=void 0!==e.base?e.base:1;if("number"!==gB(i))return _B(e.default,n.default);const s=e.stops.length;if(1===s)return e.stops[0][1];if(i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[s-1][0])return e.stops[s-1][1];const a=yz(e.stops.map((e=>e[0])),i),h=function(e,n,i,o){const s=o-i,a=e-i;return 0===s?0:1===n?a/s:(Math.pow(n,a)-1)/(Math.pow(n,s)-1)}(i,o,e.stops[a][0],e.stops[a+1][0]),l=e.stops[a][1],c=e.stops[a+1][1];let A=wz[n.type]||yB;if(e.colorSpace&&"rgb"!==e.colorSpace){const n=jz[e.colorSpace];A=(e,i)=>n.reverse(n.interpolate(n.forward(e),n.forward(i),h))}return"function"==typeof l.evaluate?{evaluate(...e){const n=l.evaluate.apply(void 0,e),i=c.evaluate.apply(void 0,e);if(void 0!==n&&void 0!==i)return A(n,i,h)}}:A(l,c,h)}function CB(e,n,i){return"color"===n.type?i=TN.parse(i):"formatted"===n.type?i=EN.fromString(i.toString()):"resolvedImage"===n.type?i=ON.fromString(i.toString()):gB(i)===n.type||"enum"===n.type&&n.values[i]||(i=void 0),_B(i,e.default,n.default)}let PB=class Ei{constructor(e,n){this.expression=e,this.H={},this.V=new WN,this.U=n?function(e){return"color"===e.type&&(mB(e.default)||Array.isArray(e.default))?new TN(0,0,0,0):"color"===e.type?TN.parse(e.default)||null:void 0===e.default?null:e.default}(n):null,this.j=n&&"enum"===n.type?n.values:null}evaluateWithoutErrorHandling(e,n,i,o,s,a,h,l){return this.V.globals=e,this.V.feature=n,this.V.featureState=i,this.V.canonical=o||null,this.V.availableImages=s||null,this.V.formattedSection=a,this.V.featureTileCoord=h||null,this.V.featureDistanceData=l||null,this.expression.evaluate(this.V)}evaluate(e,n,i,o,s,a,h,l){this.V.globals=e,this.V.feature=n||null,this.V.featureState=i||null,this.V.canonical=o||null,this.V.availableImages=s||null,this.V.formattedSection=a||null,this.V.featureTileCoord=h||null,this.V.featureDistanceData=l||null;try{const e=this.expression.evaluate(this.V);if(null==e||"number"==typeof e&&e!=e)return this.U;if(this.j&&!(e in this.j))throw new NN(`Expected value to be one of ${Object.keys(this.j).map((e=>JSON.stringify(e))).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this.H[e.message]||(this.H[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this.U}}};function MB(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in AB}function TB(e,n){const i=new gz(AB,[],n?function(e){const n={color:aN,string:oN,number:rN,enum:oN,boolean:sN,formatted:cN,resolvedImage:AN};return"array"===e.type?fN(n[e.value]||lN,e.length):n[e.type]}(n):void 0),o=i.parse(e,void 0,void 0,void 0,n&&"string"===n.type?{typeAnnotation:"coerce"}:void 0);return o?fB(new PB(o,n)):dB(i.errors)}let SB=class Ri{constructor(e,n){this.kind=e,this.G=n,this.isStateDependent="constant"!==e&&!fz(n.expression)}evaluateWithoutErrorHandling(e,n,i,o,s,a){return this.G.evaluateWithoutErrorHandling(e,n,i,o,s,a)}evaluate(e,n,i,o,s,a){return this.G.evaluate(e,n,i,o,s,a)}},IB=class Hi{constructor(e,n,i,o){this.kind=e,this.zoomStops=i,this.G=n,this.isStateDependent="camera"!==e&&!fz(n.expression),this.interpolationType=o}evaluateWithoutErrorHandling(e,n,i,o,s,a){return this.G.evaluateWithoutErrorHandling(e,n,i,o,s,a)}evaluate(e,n,i,o,s,a){return this.G.evaluate(e,n,i,o,s,a)}interpolationFactor(e,n,i){return this.interpolationType?Gz.interpolationFactor(this.interpolationType,e,n,i):0}};function EB(e,n){if("error"===(e=TB(e,n)).result)return e;const i=e.value.expression,o=Az(i);if(!o&&!function(e){return"data-driven"===e["property-type"]}(n))return dB([new eN("","data expressions not supported")]);const s=dz(i,["zoom","pitch","distance-from-center"]);if(!s&&!function(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}(n))return dB([new eN("","zoom expressions not supported")]);const a=RB(i);if(!a&&!s)return dB([new eN("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(a instanceof eN)return dB([a]);if(a instanceof Gz&&!pB(n))return dB([new eN("",'"interpolate" expressions cannot be used with this property')]);if(!a)return fB(new SB(o?"constant":"source",e.value));return fB(new IB(o?"camera":"composite",e.value,a.labels,a instanceof Gz?a.interpolation:void 0))}let OB=class Ni{constructor(e,n){this.B=e,this.W=n,$F(this,vB(this.B,this.W))}static deserialize(e){return new Ni(e.B,e.W)}static serialize(e){return{B:e.B,W:e.W}}};function RB(e){let n=null;if(e instanceof Wz)n=RB(e.result);else if(e instanceof Vz){for(const i of e.args)if(n=RB(i),n)break}else(e instanceof vz||e instanceof Gz)&&e.input instanceof qN&&"zoom"===e.input.name&&(n=e);return n instanceof eN||e.eachChild((e=>{const i=RB(e);i instanceof eN?n=i:!n&&i?n=new eN("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&i&&n!==i&&(n=new eN("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),n}function DB(e){if(Array.isArray(e))return e.map(DB);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const n={};for(const i in e)n[i]=DB(e[i]);return n}return function(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}(e)}function kB(e,n="fill"){if(null==e)return{filter:()=>!0,needGeometry:!1,needFeature:!1};const i=e;let o=!0;try{o=function(e){if(!NB(e))return e;let n=DB(e);return FB(n),n=LB(n),n}(i)}catch(e){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(i,null,2)}\n        `)}const s=TB(o,null);let a=null;if("error"===s.result)throw new Error(s.value.map((e=>`${e.key}: ${e.message}`)).join(", "));a=(e,n,i)=>s.value.evaluate(e,n,{},i);let h=null,l=null;if(o!==i){const e=TB(i,null);if("error"===e.result)throw new Error(e.value.map((e=>`${e.key}: ${e.message}`)).join(", "));h=(n,i,o,s,a)=>e.value.evaluate(n,i,{},o,void 0,void 0,s,a),l=!Az(e.value.expression)}return{filter:a,dynamicFilter:h||void 0,needGeometry:BB(o),needFeature:!!l}}function LB(e){if(!Array.isArray(e))return e;const n=function(e){if(zB.has(e[0]))for(let n=1;n<e.length;n++)if(NB(e[n]))return!0;return e}(e);return!0===n?n:n.map((e=>LB(e)))}function FB(e){let n=!1;const i=[];if("case"===e[0]){for(let o=1;o<e.length-1;o+=2)n=n||NB(e[o]),i.push(e[o+1]);i.push(e[e.length-1])}else if("match"===e[0]){n=n||NB(e[1]);for(let n=2;n<e.length-1;n+=2)i.push(e[n+1]);i.push(e[e.length-1])}else if("step"===e[0]){n=n||NB(e[1]);for(let n=1;n<e.length-1;n+=2)i.push(e[n+1])}n&&(e.length=0,e.push("any",...i));for(let n=1;n<e.length;n++)FB(e[n])}function NB(e){if(!Array.isArray(e))return!1;if(function(e){return"pitch"===e||"distance-from-center"===e}(e[0]))return!0;for(let n=1;n<e.length;n++)if(NB(e[n]))return!0;return!1}const zB=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function BB(e){if(!Array.isArray(e))return!1;if("within"===e[0])return!0;for(let n=1;n<e.length;n++)if(BB(e[n]))return!0;return!1}const HB={StyleExpression:PB,isExpression:MB,isExpressionFilter:function e(n){if(!0===n||!1===n)return!0;if(!Array.isArray(n)||0===n.length)return!1;switch(n[0]){case"has":return n.length>=2&&"$id"!==n[1]&&"$type"!==n[1];case"in":return n.length>=3&&("string"!=typeof n[1]||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==n.length||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const i of n.slice(1))if(!e(i)&&"boolean"!=typeof i)return!1;return!0;default:return!0}},createExpression:TB,createPropertyExpression:EB,normalizePropertyExpression:function(e,n){if(mB(e))return new OB(e,n);if(MB(e)){const i=EB(e,n);if("error"===i.result)throw new Error(i.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return i.value}{let i=e;return"string"==typeof e&&"color"===n.type&&(i=TN.parse(e)),{kind:"constant",evaluate:()=>i}}},ZoomConstantExpression:SB,ZoomDependentExpression:IB,StylePropertyFunction:OB},{isExpression:jB,createExpression:UB}=HB,GB={};function VB(e){if(!Array.isArray(e))return VB([e]);const n=[];for(let i=0;i<e.length;i++){let o;o=!0===e[i].filter?function(){return!0}:WB(e[i].filter),n.push(DF({},e[i],{filter:o}))}return n}function WB(e){if(!0===e)return function(){return!0};if(e&&e.condition){if("any"===e.type){const n=e.condition,i=[];for(let e=0;e<n.length;e++)i.push(WB(n[e]));return(e,n)=>{for(let o=0;o<i.length;o++)if(i[o](e,n))return!0;return!1}}const n=WB(e.condition);if(kF(e.layer))return n;const i=n=>n.layer===e.layer;return(e,o)=>i(e)&&n(e,o)}if(Tk(e))return Mk(e);{let n=kB(e);n=n&&n.filter;const i=(e,i)=>(GB.zoom=i,n&&n(GB,e));return i}}const qB={type:"number","property-type":"data-driven",expression:{parameters:["zoom","feature"]}};function ZB(e,n){qB.type=n||"number";const i=UB(e,qB);if("success"!==i.result)throw new Error(`Invalid maplibre spec expression: ${JSON.stringify(e)} (${i.value})`);return i.value}function QB(e){return jB(e)}const XB={lineWidth:1,lineStrokeWidth:1,lineDx:1,lineDy:1,lineOpacity:1,linePatternAnimSpeed:1,markerWidth:1,markerHeight:1,markerDx:1,markerDy:1,markerSpacing:1,markerOpacity:1,markerRotation:1,textWrapWidth:1,textSpacing:1,textSize:1,textHaloRadius:1,textHaloOpacity:1,textDx:1,textDy:1,textOpacity:1,textRotation:1,polygonOpacity:1};function YB(e){return XB[e]}const JB={markerPlacement:1,markerFile:1,mergeOnProperty:1,markerTextFit:1,markerType:1,markerHorizontalAlignment:1,markerVerticalAlignment:1,markerRotationAlignment:1,markerPitchAlignment:1,markerFillPatternFile:1,markerLinePatternFile:1,textName:1,textPlacement:1,textFaceName:1,textStyle:1,textHorizontalAlignment:1,textVerticalAlignment:1,textRotationAlignment:1,textPitchAlignment:1,lineJoin:1,lineCap:1,linePatternFile:1,polygonPatternFile:1},KB={lineDasharray:1,markerLineDasharray:1,uvScale:1,uvOffset:1};function $B(e){return JB[e]?"string":YB(e)?"number":KB[e]?"array":"color"}var tH=Object.freeze({__proto__:null,compileFilter:WB,compileStyle:function(e=[]){return VB(e=e.map((e=>{const n=DF({},e);return n.filter&&n.filter.value&&(n.filter=n.filter.value),n})))},createExpression:ZB,getExpressionType:$B,isExpression:QB,isInterpolated:YB});const eH="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,nH=function(e){return class extends e{pushIn(...e){const n=e.length;for(let i=0;i<n;i++)this[this.currentIndex++]=e[i]}fill(e,n,i){super.fill(e,n,i),i>this.currentIndex&&(this.currentIndex=i)}set(e,n){e>=this.currentIndex&&(this.currentIndex=e+1),this[e]=n}getLength(){return this.currentIndex}setLength(e){this.currentIndex=e,super.length<e&&(super.length=e)}trySetLength(e){e>this.currentIndex&&this.setLength(e)}reset(){this.currentIndex=0}slice(e,n){const i=super.slice(e,n);return i.currentIndex=n-e,i}}},iH=nH(Array),rH={get:function(e,n){return"length"===n?e.getLength():e[n]}};let oH,sH=class dr extends Array{setLength(e){this.length=e,this.currentIndex=e}trySetLength(e){this.length=e,this.currentIndex=e}getLength(){return this.length}},aH=class mr{static createTypedArray(e,n){return OF(e,n)}static getInstance(){return oH}static ensureCapacity(e,n){if(!e.BYTES_PER_ELEMENT)return e;if(e.length>=n)return e;const i=new e.constructor(n+Math.ceil(.5*n)),o=e.getLength();for(let n=0;n<o;n++)i[n]=e[n];return i.currentIndex=e.currentIndex,i}static getArray(e){let n;if(e){const i=nH(e);n=new i(1048576/i.BYTES_PER_ELEMENT)}else n=new iH;return n.push=(...e)=>{n.pushIn(...e)},n}static getProxyArray(){const e=new iH,n=new Proxy(e,rH);return n.push=(...n)=>{e.pushIn(...n)},n.C=e,n}constructor(){this.X=[],this.Y=0,this.q=[],this.J=0,this.K={}}getProxy(){if(!eH){const e=new sH;return e.currentIndex=0,e}const e=this.q[this.J]=this.q[this.J]||mr.getProxyArray();return e.reset(),this.J++,e}get(e){if(!eH){const e=new sH;return e.currentIndex=0,e}if(e){const n=e.name;let i=this.K[n];i||(i=this.K[n]={arrays:[],index:0});const o=i.index,s=i.arrays[o]=i.arrays[o]||mr.getArray(e);return s.reset(),i.index++,s}const n=this.X[this.Y]=this.X[this.Y]||mr.getArray();return n.reset(),this.Y++,n}reset(){this.Y=0,this.J=0;for(const e in this.K)this.K[e].index=0}};oH=new aH;const hH="__fea_idx",lH=[],uH={},cH={},AH={},fH=[],dH=aH.getInstance();let pH=!1;const gH=Math.pow(2,17);let mH=class Sr{static isAtlasLoaded(e,n={}){const{iconAtlas:i}=n;return!!(!e||i&&i.positions[e])}static genFnTypes(e){const n={};for(const i in e)if(QB(e[i])){const o=(i+"_Fn_0").trim(),s=(i+"Fn").trim(),a=$B(i);n[o]=ZB(e[i],a),n[s]=(e,i)=>{let s;uH.zoom=e,cH.properties=i;try{s=n[o].evaluateWithoutErrorHandling(uH,cH,AH,null,fH)}catch(e){return null}return s}}else if(HF(e[i])){const o=(i+"_Fn_0").trim(),s=(i+"Fn").trim();YB(i)?(n[o]=RD(e[i]),n[s]=(e,i)=>{const s=n[o](e,i);return HF(s)?RD(s)(e,i):s}):(n[o]=DD(e[i]),n[s]=(e,i)=>{const s=n[o](e,i);return HF(s)?DD(s)(e,i):s})}return n}constructor(e,n,i){this.options=i;const o=[];this.symbolDef=n,this.symbol=kD(n,(()=>(o[0]=i.zoom,o))),this.styledVectors=[],this.properties={},this.Z=i.fnTypes||Sr.genFnTypes(this.symbolDef),HF(this.symbolDef.visible)&&(this.tt=RD(this.symbolDef.visible)),i.atlas&&(this.iconAtlas=i.atlas.iconAtlas,this.glyphAtlas=i.atlas.glyphAtlas),this.features=this.et(e)}needAltitudeAttribute(){return this.options.forceAltitudeAttribute||this.maxPosZ>=gH||this.options.positionType===Float32Array}getPositionFormat(){return this.needAltitudeAttribute()?[{type:Int16Array,width:2,name:"aPosition"},{type:Float32Array,width:1,name:"aAltitude"}]:[{type:Float32Array,width:3,name:"aPosition"}]}fillPosition(e,n,i,o){if(n<this.nt&&(this.nt=n),n>this.it&&(this.it=n),i<this.rt&&(this.rt=i),i>this.st&&(this.st=i),this.needAltitudeAttribute()){let s=e.aPosition.currentIndex;e.aPosition[s++]=n,e.aPosition[s++]=i,e.aPosition.currentIndex=s,s=e.aAltitude.currentIndex,e.aAltitude[s++]=o,e.aAltitude.currentIndex=s}else{WF(lH,n,i,o);let s=e.aPosition.currentIndex;e.aPosition[s++]=lH[0],e.aPosition[s++]=lH[1],e.aPosition[s++]=lH[2],e.aPosition.currentIndex=s}}et(e){if(!e.length)return e;const n=(hH+"").trim();let i,o=0,s=e[o];for(;!s.geometry;)o++,s=e[o];if(Array.isArray(s.geometry)&&s.properties){let n=s.geometry[0];for(;Array.isArray(n);)n=n[0];n instanceof tF&&(i=e)}if(!i)if(i=[],Array.isArray(s.geometry))for(let n=0;n<e.length;n++){const o=DF({},e[n]);i.push(RF(o))}else for(let o=0;o<e.length;o++){const s=e[o],a=nF(s);for(let e=0;e<a.length;e++){const o=a[e];o[n]=s[n],i.push(o)}}if(this.maxPosZ=0,!this.options.forceAltitudeAttribute){const e="line"===this.symbolDef.textPlacement;let n=0,o=!1;const{textPitchAlignmentFn:s}=this.Z;!s&&e&&"map"===this.symbolDef.textPitchAlignment&&(o=!0);for(let a=0;a<i.length;a++){const h=vH(i[a]&&i[a].geometry);if(h>n&&(n=h),e&&!o&&s&&i[a].properties){const e=s(null,i[a].properties);"map"===e&&(o=e)}}this.hasMapPitchAlign=o,this.maxPosZ=n}const a=this.options.order;if(a){const e=[];for(let n=0;n<a.length;n++)a[n]&&e.push(WB(a[n]));i=i.sort(((n,i)=>{const o=e.length;let s=-1,a=-1;for(let h=0;h<o&&(e[h](n)&&(s=h),e[h](i)&&(a=h),!(s>=0&&s<o&&a>=0&&a<o));h++);return s-a}))}return i}load(e=1){const n=(hH+"").trim(),i="_debug_info".trim(),o=this.Z,s=this.styledVectors;this.count=0;const a=this.features;if(!a||!a.length)return Promise.resolve(null);const h={},l={},c={zoom:this.options.zoom,isVector3D:!!this.options.center},A=[],f=kD(this.symbolDef,(()=>(A[0]=c.zoom,A)));let d=0,p=a.length;const g=this.options.debugIndex;try{for(;d<p;d++){const e=a[d];if(!e||!e.geometry)continue;if(LF(g)&&e[i].index!==g)continue;e.properties||(e.properties={}),e.properties.$layer=e.layer,e.properties.$type=e.type;const A=this.createStyledVector(e,f,o,c,h,l);A&&A.feature.geometry&&(A.featureIdx=void 0===e[n]?d:e[n],this.count++,s.push(A))}}catch(e){return Promise.reject(e)}return this.options.atlas?Promise.resolve(this.pack(e)):this.loadAtlas(h,l).then((()=>this.pack(e)))}loadAtlas(e,n){return new Promise(((i,o)=>{this.fetchAtlas(e,n,((e,n)=>{if(e)o(e);else{if(n){const{icons:e,glyphs:i}=n;if(e&&Object.keys(e).length){for(const n in e){const i=e[n],{width:o,height:s,data:a}=i.data;i.data=new pF({width:o,height:s},a)}this.iconAtlas=new PF(e)}if(i&&Object.keys(i).length){for(const e in i){const n=i[e];for(const e in n){const i=n[e],{width:o,height:s,data:a}=i.bitmap;i.bitmap=new dF({width:o,height:s},a)}}this.glyphAtlas=new TF(i)}}i({glyphAtlas:this.glyphAtlas,iconAtlas:this.iconAtlas})}}))}))}fetchAtlas(e,n,i){Object.keys(e).length>0||Object.keys(n).length>0?this.options.requestor(e,n,i):i()}pack(e){if(!this.count)return null;if(null==e)throw new Error("layout scale is undefined");const n=this.createDataPack(this.styledVectors,e);if(!n)return null;n.properties=this.properties,this.empty&&(n.empty=!0);const i=n.buffers;delete n.buffers;const o={data:n,buffers:i};if(this.iconAtlas){const e=o.data.iconAtlas=yH(this.iconAtlas);if(e.glyphMap)for(const n in e.glyphMap){i.push(e.glyphMap[n].data.data.buffer)}i.push(o.data.iconAtlas.image.data.buffer)}return this.glyphAtlas&&(o.data.glyphAtlas=yH(this.glyphAtlas),i.push(o.data.glyphAtlas.image.data.buffer)),o}createStyledVector(e,n,i,o){return new VF(e,n,i,o)}createDataPack(e,n){if(!e||!e.length)return null;this.maxIndex=0,this.maxPos=0,this.nt=this.rt=1/0,this.it=this.st=-1/0,this.maxAltitude=0,this.dynamicAttrs={};const i=this.data={};this.ot=dH,dH.reset();let o=this.elements=dH.get();const s=this.lt=this.getFormat(Array.isArray(e[0])?e[0][0].symbol:e[0].symbol),a=this.needAltitudeAttribute()?2:3;for(let e=0;e<s.length;e++)i[s[e].name]=dH.get(s[e].type);let h=dH.get(),l=0;const c=dH.get();let A=0,f=!1,d=!0;const p=new Set;for(let o=0,s=e.length;o<s;o++){if(!e[o].feature.geometry)continue;const s=Array.isArray(e[o])?e[o][0].feature.id:e[o].feature.id;d&&(void 0!==cH.id?p&&(p.has(cH.id)?d=!1:p.add(cH.id)):d=!1),LF(s)&&(Math.abs(s)>A&&(A=Math.abs(s)),s<0&&(f=!0));const g=this.data.aPosition.getLength();if(Array.isArray(e[o]))for(let i=0;i<e[o].length;i++)this.ht(e[o][i],n);else this.ht(e[o],n);const v=(i.aPosition.getLength()-g)/a;for(let n=0;n<v;n++)h.push(e[o].featureIdx),LF(s)&&c.push(s);l=Math.max(l,e[o].featureIdx)}if(this.countOutOfAngle>0&&!pH&&(pH=!0,console.warn("text anchor along line is ignored as anchor's line angle is bigger than textMaxAngle.")),this.hasElements()&&!o.getLength())return null;const g=this.options.center?Float32Array:EF(l);h=aH.createTypedArray(h,g),s[0].type=this.options.positionType?this.options.positionType:IF(this.maxPos);const v=this.options.center;if(v&&(v[0]||v[1])){const e=i.aPosition,n=e.getLength();for(let i=0;i<n;i+=a)e[i]-=v[0],e[i+1]-=v[1]}const w=function(e,n){const i={};for(let o=0;o<e.length;o++){const s=e[o],a=s.type,h=s.name;i[h]=a===Array?n[h]:OF(n[h],a)}return i}(s,i);w.aPickingId=h;const C=[];for(const e in w)C.push(w[e].buffer);const P=SF(this.maxIndex);o=aH.createTypedArray(o,P),C.push(o.buffer);const T={data:w,isIdUnique:d,is2D:0===this.maxPosZ,indices:this.hasElements()?o:null,positionSize:a,positionBounding:[this.nt,this.rt,this.it,this.st],buffers:C,symbolIndex:this.symbolDef.index||{index:0},dynamicAttributes:this.dynamicAttrs};if(this.ut&&(T.markerPlacement=this.ut),this.ct&&(T.textPlacement=this.ct),c.getLength()){const e=f?IF(A):EF(A);T.featureIds=aH.createTypedArray(c,e),C.push(T.featureIds.buffer)}else T.featureIds=[];return T.pickingIdIndiceMap=bF(h,T.indices),T}ht(e,n){this.tt&&!this.tt(this.options.zoom,e.feature.properties)||this.placeVector(e,n,this.formatWidth)}addElements(e,n,i){this.maxIndex=Math.max(this.maxIndex,e,n,i);let o=this.elements.currentIndex;this.elements[o++]=e,this.elements[o++]=n,this.elements[o++]=i,this.elements.currentIndex=o}hasElements(){return!0}getAltitude(e){const{altitudeProperty:n,defaultAltitude:i,altitudeScale:o}=this.options;let s=mF(e,n,i);return o&&(s*=o),this.maxAltitude=Math.max(this.maxAltitude,Math.abs(s)),s}getIconAtlasMaxValue(){const e=this.iconAtlas.positions;let n=0;for(const i in e)if(BF(e,i)){const{tl:o,displaySize:s}=e[i],a=Math.max(o[0],o[1],s[0]-1,s[1]-1);a>n&&(n=a)}return n}ensureDataCapacity(e,n){const i=this.lt;for(let o=0;o<i.length;o++){const s=this.data[i[o].name];if(!s)continue;const a=i[o].width*e,h=s.getLength();this.data[i[o].name]=aH.ensureCapacity(s,h+a*n)}}};function yH(e){let n=e.positions,i=e.image&&e.image.format||"alpha";if(e instanceof PF){n={};for(const i in e.positions){const o=e.positions[i];n[i]={paddedRect:o.paddedRect,pixelRatio:o.pixelRatio,tl:o.tl,br:o.br,displaySize:o.displaySize}}i="rgba"}const o=e.image;return{image:{width:o.width,height:o.height,data:o.data,format:i},glyphMap:e.glyphMap,positions:n}}function vH(e){if(!e)return 0;let n=0;if(Array.isArray(e))for(let i=0;i<e.length;i++)if(Array.isArray(e[i])){const o=vH(e[i]);o>n&&(n=o)}else{const o=Math.abs(e[i].z||0);o>n&&(n=o)}else{const i=Math.abs(e.z||0);i>n&&(n=i)}return n}const _H="___fn_in_stops";function xH(e,n,i,o){const s="__fn_textSize".trim();let a=e.textSize;if(kF(n.textSize))return[16,16];e[s]&&(a=e[s]);const h=[];var l;if(h[0]=kF(l=a)||"function"!=typeof l&&(null===l.constructor||l.constructor!==Function)?a:a(o,i),ED(h[0])){const n=h[0].__fn_key=h[0].__fn_key||JSON.stringify(h[0]);e[_H]||(e[_H]={}),e[_H][n]||(e[_H][n]=RD(h[0]));h[0]=(0,e[_H][n])(o,i)}return h[1]=h[0],h}function bH(e){const n=e.stops;let i=-1/0;for(let e=0;e<n.length;e++){let o=n[e][1];FF(n[e][1])&&(o=bH(n[e][1])),o>i&&(i=o)}return i}const wH=["{","}"],CH="";function PH(e,n){if(!NF(e))return e;function i(e){if(!n)return CH;const i=n[e];return kF(i)?CH:Array.isArray(i)?i.join():i}const[o,s]=wH,a=function(e){e+=CH;const[n,i]=wH,o=[];let s=!1,a=CH;for(let h=0,l=e.length;h<l;h++){const l=e[h];s||l!==n||(s=!0),l===n&&s&&(a=CH),s&&l!==n&&l!==i&&(a+=l),l===i&&a&&(s=!1,o.push(a),a=CH)}return o}(e);for(let n=0,h=a.length;n<h;n++){const h=a[n],l=`${o}${h}${s}`;if(h.indexOf("|")>0){const n=h.split("|");let o=!1;for(let s=0;s<n.length;s++){const a=i(n[s]);if(a!==CH){e=MH(e,l,a),o=!0;break}}o||(e=MH(e,l,CH))}else e=MH(e,l,i(h))}return e}function MH(e,n,i){if(!e)return e;if(e.replaceAll)return e.replaceAll(n,i);for(;e.indexOf(n)>-1;)e=e.replace(n,i);return e}const TH={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519};function SH(e){return!(TH.Arabic(e)||TH["Arabic Supplement"](e)||TH["Arabic Extended-A"](e)||TH["Arabic Presentation Forms-A"](e)||TH["Arabic Presentation Forms-B"](e))}function IH(e){return!!(!(e<11904)&&(TH["Bopomofo Extended"](e)||TH.Bopomofo(e)||TH["CJK Compatibility Forms"](e)||TH["CJK Compatibility Ideographs"](e)||TH["CJK Compatibility"](e)||TH["CJK Radicals Supplement"](e)||TH["CJK Strokes"](e)||TH["CJK Symbols and Punctuation"](e)||TH["CJK Unified Ideographs Extension A"](e)||TH["CJK Unified Ideographs"](e)||TH["Enclosed CJK Letters and Months"](e)||TH["Halfwidth and Fullwidth Forms"](e)||TH.Hiragana(e)||TH["Ideographic Description Characters"](e)||TH["Kangxi Radicals"](e)||TH["Katakana Phonetic Extensions"](e)||TH.Katakana(e)||TH["Vertical Forms"](e)||TH["Yi Radicals"](e)||TH["Yi Syllables"](e)))}function EH(e){return!!(746===e||747===e||!(e<4352)&&(TH["Bopomofo Extended"](e)||TH.Bopomofo(e)||TH["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||TH["CJK Compatibility Ideographs"](e)||TH["CJK Compatibility"](e)||TH["CJK Radicals Supplement"](e)||TH["CJK Strokes"](e)||!(!TH["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||TH["CJK Unified Ideographs Extension A"](e)||TH["CJK Unified Ideographs"](e)||TH["Enclosed CJK Letters and Months"](e)||TH["Hangul Compatibility Jamo"](e)||TH["Hangul Jamo Extended-A"](e)||TH["Hangul Jamo Extended-B"](e)||TH["Hangul Jamo"](e)||TH["Hangul Syllables"](e)||TH.Hiragana(e)||TH["Ideographic Description Characters"](e)||TH.Kanbun(e)||TH["Kangxi Radicals"](e)||TH["Katakana Phonetic Extensions"](e)||TH.Katakana(e)&&12540!==e||!(!TH["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!TH["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||TH["Unified Canadian Aboriginal Syllabics"](e)||TH["Unified Canadian Aboriginal Syllabics Extended"](e)||TH["Vertical Forms"](e)||TH["Yijing Hexagram Symbols"](e)||TH["Yi Syllables"](e)||TH["Yi Radicals"](e)))}function OH(e){return!(EH(e)||function(e){return!!(TH["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||TH["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||TH["Letterlike Symbols"](e)||TH["Number Forms"](e)||TH["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||TH["Control Pictures"](e)&&9251!==e||TH["Optical Character Recognition"](e)||TH["Enclosed Alphanumerics"](e)||TH["Geometric Shapes"](e)||TH["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||TH["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||TH["CJK Symbols and Punctuation"](e)||TH.Katakana(e)||TH["Private Use Area"](e)||TH["CJK Compatibility Forms"](e)||TH["Small Form Variants"](e)||TH["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function RH(e){return e>=1424&&e<=2303||TH["Arabic Presentation Forms-A"](e)||TH["Arabic Presentation Forms-B"](e)}const DH=[[9,9],[32,32],[5760,5760],[8192,8198],[8200,8202],[8287,12288],[6158,6158],[8203,8205]];function kH(e){for(const n of DH)if(e>=n[0]&&e<=n[1])return!0;return!1}const LH={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},FH=1,NH=2;function zH(e,n,i,o,s,a,h,l,c,A){let f=e.trim();A===NH&&(f=function(e){let n="";const i=Array.from(e);for(let e=0;e<i.length;e++){const o=i[e+1].codePointAt(0)||null,s=i[e-1].codePointAt(0)||null;o&&OH(o)&&!LH[i[e+1]]||s&&OH(s)&&!LH[i[e-1]]||!LH[i[e]]?n+=i[e]:n+=LH[i[e]]}return n}(f));const d=[],p={positionedGlyphs:d,text:f,top:l[1],bottom:l[1],left:l[0],right:l[0],writingMode:A};let g;return g=function(e,n){const i=[];let o=0;for(let s=0;s<n.length;s++){const a=n[s];i.push(e.substring(o,a)),o=a}return o<e.length&&i.push(e.substring(o,e.length)),i}(f,function(e,n,i,o){if(!i)return[];if(!e)return[];const s=[],a=function(e,n,i,o){let s=0;for(let i=0;i<e.length;i++){const a=o[e.codePointAt(i)];a&&(s+=a.metrics.advance+n)}return s/Math.max(1,Math.ceil(s/i))}(e,n,i,o);let h=0;for(let i=0;i<e.length;i++){const l=e.codePointAt(i),c=o[l];c&&(c&&!BH[l]&&(h+=c.metrics.advance+n),i<e.length-1&&(HH[l]||IH(l))&&s.push(GH(i+1,h,a,s,UH(l,e.codePointAt(i+1)),!1)))}return VH(GH(e.length,h,a,s,0,!0))}(f,h,i,n)),function(e,n,i,o,s,a,h,l,c,A){let f=0,d=0,p=0;const g=e.positionedGlyphs;for(let e=0;e<i.length;e++){let s=i[e];if(s=s.trim(),!s.length){d-=o;continue}const a=g.length;for(let e=0;e<s.length;e++){const i=s.codePointAt(e),o=n[i];o&&(EH(i)&&h!==FH?(32!==i&&g.push({glyph:i,x:f,y:0,vertical:!0}),f+=c+l):(32!==i&&g.push({glyph:i,x:f,y:d,vertical:!1}),f+=o.metrics.advance+l))}if(g.length!==a){p=Math.max(f-l,p),qH(g,n,a,g.length-1,.5)}f=0,d-=o}const{horizontalAlign:v,verticalAlign:w}=WH(s,void 0);!function(e,n,i,o,s,a,h){const l=(.5-i)*s,c=-(-o*h+.5)*a;if(l||c)for(let n=0;n<e.length;n++)e[n].x+=l,e[n].y+=c}(g,0,v,w,p,o,i.length);const C=i.length*o;e.top+=-w*C,e.bottom=e.top+C,e.left+=-v*p,e.right=e.left+p}(p,n,g,o,s,0,A,h,c),!!d.length&&p}const BH={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},HH={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function jH(e,n,i,o){const s=Math.pow(e-n,2);return o?e<n?s/2:2*s:s+Math.abs(i)*i}function UH(e,n){let i=0;return 10===e&&(i-=1e4),40!==e&&65288!==e||(i+=50),41!==n&&65289!==n||(i+=50),i}function GH(e,n,i,o,s,a){let h=null,l=jH(n,i,s,a);for(let e=0;e<o.length;e++){const c=o[e],A=jH(n-c.x,i,s,a)+c.badness;A<=l&&(h=c,l=A)}return{index:e,x:n,priorBreak:h,badness:l}}function VH(e){return e?VH(e.priorBreak).concat(e.index):[]}function WH(e,n){let i=.5,o=.5;switch(e){case"right":case"top-right":case"bottom-right":i=n?1:0;break;case"left":case"top-left":case"bottom-left":i=n?0:1}switch(e){case"bottom":case"bottom-right":case"bottom-left":o=n?1:0;break;case"top":case"top-right":case"top-left":o=n?0:1}return{horizontalAlign:i,verticalAlign:o}}function qH(e,n,i,o,s){const a=n[e[o].glyph];if(a){const n=(e[o].x+a.metrics.advance)*s;if(!n)return;for(let s=i;s<=o;s++)e[s].x-=n}}function ZH(e){if(!function(e){for(const n of e)if(RH(n.charCodeAt(0)))return!0;return!1}(e))return e;const n=[],i=[],o=[];let s=0,a=0,h=1,l=1;for(const c of e){const e=c.codePointAt(0);kH(e)?(o.push(c),s++):(h=RH(e)?-1:1,l!==h?(a=s,i.length&&(l>0&&i.reverse(),n.push(...i)),o.length&&(n.splice(a,0,...o),o.length=0),l=h,i.length=0):o.length&&(i.push(...o),o.length=0),i.push(c),s++)}return o.length&&i.push(...o),i.length&&(l>0&&i.reverse(),n.push(...i)),n.reverse().join("")}const QH=/\{ *([\w_]+) *\}/g;let XH=class ns{constructor(e,n,i,o,s){this.feature=e,this.symbolDef=n,this.symbol=i,this.options=s,this.ft=this.dt.bind(this),this.Z=o}dt(e,n){return this.feature.properties[n]||""}getShape(e,n){if(this.yt)return this.yt;const{textHorizontalAlignmentFn:i,textVerticalAlignmentFn:o,markerHorizontalAlignmentFn:s,markerVerticalAlignmentFn:a,textWrapWidthFn:h}=this.Z;let l;const c=this.symbol,A=this.getIconAndGlyph(),f=this.feature.properties;if(A&&A.glyph){const{font:e,text:s}=A.glyph;if(""===s)return null;const a=this.size[0]/24,d=24,p=c.textKeepUpright,g="map"===c.textRotationAlignment&&"line"===c.textPlacement&&!c.isIconText,v=n.glyphMap[e],w=YH(i?i(null,f):c.textHorizontalAlignment,o?o(null,f):c.textVerticalAlignment),C=1.2*d,P=function(e){for(let n=0;n<e.length;n++)if(!SH(e.charAt(n).charCodeAt(0)))return!1;return!0}(s),T=P&&c.textLetterSpacing/a||0,S=[c.textDx/a||0,c.textDy/a||0],I=((h?h(null,f):c.textWrapWidth)||10*d)/a;l={},l.horizontal=zH(s,v,I,C,w,0,T,S,d,FH),P&&g&&p&&(l.vertical=zH(s,v,I,C,w,0,T,S,d,NH))}else if(A&&A.icon){if(!e||!e.positions[A.icon.url])return null;const n=YH(s?s(null,f):c.markerHorizontalAlignment,a?a(null,f):c.markerVerticalAlignment);l=function(e,n,i){let{horizontalAlign:o,verticalAlign:s}=WH(n,i);i?o=1-o:s=1-s;const a=-2048*o,h=-2048*s;return{image:e,top:h,bottom:h+2048,left:a,right:a+2048}}(e.positions[A.icon.url],n,this.options.isVector3D),this.size||(this.size=l.image.displaySize)}return this.yt=l,l}getIconAndGlyph(){if(this.iconGlyph)return this.iconGlyph;const{markerFileFn:e,markerTypeFn:n,markerPathFn:i,markerWidthFn:o,markerHeightFn:s,markerFillFn:a,markerFillPatternFileFn:h,markerFillOpacityFn:l,markerTextFitFn:c,markerTextFitPaddingFn:A,markerLineColorFn:f,markerLineWidthFn:d,markerLineOpacityFn:p,markerLineDasharrayFn:g,markerLinePatternFileFn:v,markerPathWidthFn:w,markerPathHeightFn:C,textNameFn:P,textFaceNameFn:T}=this.Z,{zoom:S}=this.options,I={},E=this.symbol,O=this.feature.properties,k=e?e(null,O):E.markerFile,L=n?n(null,O):E.markerType,F=k||L||E.markerPath,N=!kF(this.symbolDef.textName);let z;if(F){z=function(e,n,i,o,s,a){if(kF(n.markerWidth)&&kF(n.markerHeight))return null;const h="__fn_markerWidth".trim(),l="__fn_markerHeight".trim();let c=n.markerWidth||0,A=n.markerHeight||0;return FF(c)&&("identity"!==c.type?c=bH(c):(c=e.markerWidth,e[h]&&(c=e[h](o,i)),FF(c)&&(c="identity"===c.type?s(o,i):bH(c)))),FF(A)&&("identity"!==A.type?A=bH(A):(A=e.markerHeight,e[l]&&(A=e[l](o,i)),FF(A)&&(A="identity"===A.type?a(o,i):bH(A)))),[c,A]}(E,this.symbolDef,O,S,o,s)||[0,0];let e=E.markerTextFit;if(c&&(e=c(S,O)),e&&E.text&&"none"!==e){const n=E.text.textSize;let i=E.text.textName;ED(i)&&(i=RD(i)(S,O));const o=PH(i,O);if(o){const i="__fn_textSize".trim(),s="__fn_textSize_0".trim();ED(n)&&!E.text[i]&&(E.text[s]=RD(n),E.text[i]=(e,n)=>{const i=E.text[s](e,n);return ED(i)?RD(i)(e,n):i});const a=xH(E.text,E.text,O,S);if("width"!==e&&"both"!==e||(z[0]=a[0]*o.length),"height"!==e&&"both"!==e||(z[1]=a[1]),a[0]&&a[1]){let e=E.markerTextFitPadding||[0,0,0,0];A&&(e=A(S,O)),z[0]+=e[1]+e[3],z[1]+=e[0]+e[2]}}else z[0]=z[1]=-1}}if(N&&(z=xH(E,this.symbolDef,O,S)),!z)return I;if(z[0]=Math.ceil(z[0]),z[1]=Math.ceil(z[1]),this.size=z,F&&z[0]>=0&&z[1]>=0){let e;if(L){const n={};if(n.markerType=L,"path"===L&&(n.markerPath=i?i(null,O):E.markerPath,n.markerPathWidth=w?w(null,O):E.markerPathWidth,n.markerPathHeight=C?C(null,O):E.markerPathHeight),o){const e=o(null,O);kF(e)||(n.markerWidth=e)}else E.markerWidth>=0&&(n.markerWidth=E.markerWidth);if(s){const e=s(null,O);kF(e)||(n.markerHeight=e)}else E.markerHeight>=0&&(n.markerHeight=E.markerHeight);if(a){const e=a(null,O);kF(e)||(n.markerFill=e)}else E.markerFill&&(n.markerFill=E.markerFill);if(h){const e=h(null,O);kF(e)||(n.markerFillPatternFile=e)}else E.markerFillPatternFile&&(n.markerFillPatternFile=E.markerFillPatternFile);if(l){const e=l(null,O);kF(e)||(n.markerFillOpacity=e)}else E.markerFillOpacity>=0&&(n.markerFillOpacity=E.markerFillOpacity);if(f){const e=f(null,O);kF(e)||(n.markerLineColor=e)}else E.markerLineColor&&(n.markerLineColor=E.markerLineColor);if(d){const e=d(null,O);kF(e)||(n.markerLineWidth=e)}else E.markerLineWidth>=0&&(n.markerLineWidth=E.markerLineWidth);if(p){const e=p(null,O);kF(e)||(n.markerLineOpacity=e)}else E.markerLineOpacity>=0&&(n.markerLineOpacity=E.markerLineOpacity);if(g){const e=g(null,O);kF(e)||(n.markerLineDasharray=e)}else E.markerLineDasharray&&(n.markerLineDasharray=E.markerLineDasharray);if(v){const e=v(null,O);kF(e)||(n.markerLinePatternFile=e)}else E.markerLinePatternFile&&(n.markerLinePatternFile=E.markerLinePatternFile);e="vector://"+JSON.stringify(n)}else e=k?k.replace(QH,this.ft):E.markerPath?function(e,n,i){if(!e.markerPath)return null;let o=1;const s=function(e){const n={stroke:{stroke:e.markerLineColor,"stroke-width":e.markerLineWidth,"stroke-opacity":e.markerLineOpacity,"stroke-dasharray":null,"stroke-linecap":"butt","stroke-linejoin":"round"},fill:{fill:e.markerFill,"fill-opacity":e.markerFillOpacity}};return 0===n.stroke["stroke-width"]&&(n.stroke["stroke-opacity"]=0),n}(e);LF(e.markerOpacity)&&(o=e.markerOpacity),LF(e.opacity)&&(o*=e.opacity);const a={};if(s){for(const e in s.stroke)BF(s.stroke,e)&&(kF(s.stroke[e])||(a[e]=s.stroke[e]));for(const e in s.fill)BF(s.fill,e)&&(kF(s.fill[e])||(a[e]=s.fill[e]))}const h=Array.isArray(e.markerPath)?e.markerPath:[e.markerPath];let l;const c=[];for(let e=0;e<h.length;e++)l=NF(h[e])?{path:h[e]}:h[e],l=DF({},l,a),l.d=l.path,delete l.path,c.push(l);const A=['<svg version="1.1"','xmlns="http://www.w3.org/2000/svg"'];o<1&&A.push('opacity="'+o+'"'),e.markerPathWidth&&e.markerPathHeight&&A.push('viewBox="0 0 '+e.markerPathWidth+" "+e.markerPathHeight+'"'),A.push('preserveAspectRatio="none"'),n&&A.push('width="'+n+'"'),i&&A.push('height="'+i+'"'),A.push("><defs></defs>");for(let e=0;e<c.length;e++){let n="<path ";for(const i in c[e])BF(c[e],i)&&(n+=" "+i+'="'+c[e][i]+'"');n+="></path>",A.push(n)}return A.push("</svg>"),"data:image/svg+xml;base64,"+btoa(A.join(" "))}(E,z[0],z[1]):null;I.icon={url:e,size:z}}if(N){const e=P?P(this.options.zoom,O):E.textName;if(e||0===e){const n=function(e){return e||"Open Sans Regular"}(T?T(null,O):E.textFaceName);let i=PH(e,O);i&&i.length&&(i=ZH(i),I.glyph={font:n,text:i})}}return this.iconGlyph=I,I}};function YH(e,n){n&&"middle"!==n||(n="center"),e&&"middle"!==e||(e="center");let i="center"!==n?n:"";return i+="center"!==e?(i.length?"-":"")+e:"",i
/*!
   * From mapbox-gl-js
   * MIT License
   * https://github.com/mapbox/mapbox-gl-js
   */}function JH(e,n,i,o,s){const a=[];let h;for(let l=0;l<e.length;l++){const c=e[l];let A,f=!1;for(let e=0;e<c.length-1;e++){let l=c[e],d=c[e+1];l.x<n&&d.x<n||(l.x<n?(h=l,l=new tF(n,l.y+(n-l.x)/(d.x-l.x)*(d.y-l.y)).F(),l.z=h.z+(n-h.x)/(d.x-h.x)*(d.z-h.z),f=!0):d.x<n&&(h=d,d=new tF(n,l.y+(n-l.x)/(d.x-l.x)*(d.y-l.y)).F(),d.z=l.z+(n-l.x)/(h.x-l.x)*(h.z-l.z),f=!0),l.y<i&&d.y<i||(l.y<i?(h=l,l=new tF(l.x+(i-l.y)/(d.y-l.y)*(d.x-l.x),i).F(),l.z=h.z+(i-h.y)/(d.y-h.y)*(d.z-h.z),f=!0):d.y<i&&(h=d,d=new tF(l.x+(i-l.y)/(d.y-l.y)*(d.x-l.x),i).F(),d.z=l.z+(i-l.y)/(h.y-l.y)*(h.z-l.z),f=!0),l.x>=o&&d.x>=o||(l.x>=o?(h=l,l=new tF(o,l.y+(o-l.x)/(d.x-l.x)*(d.y-l.y)).F(),l.z=h.z+(o-h.x)/(d.x-h.x)*(d.z-h.z),f=!0):d.x>=o&&(h=d,d=new tF(o,l.y+(o-l.x)/(d.x-l.x)*(d.y-l.y)).F(),d.z=l.z+(o-l.x)/(h.x-l.x)*(h.z-l.z),f=!0),l.y>=s&&d.y>=s||(l.y>=s?(h=l,l=new tF(l.x+(s-l.y)/(d.y-l.y)*(d.x-l.x),s).F(),l.z=h.z+(s-h.y)/(d.y-h.y)*(d.z-h.z),f=!0):d.y>=s&&(h=d,d=new tF(l.x+(s-l.y)/(d.y-l.y)*(d.x-l.x),s).F(),d.z=l.z+(s-l.y)/(h.y-l.y)*(h.z-l.z),f=!0),A&&l.equals(A[A.length-1])||(A=[l],a.push(A)),f&&(A.clipped=!0),A.push(d)))))}}return a}let KH=class ss extends tF{constructor(e,n,i,o){super(e,n),this.angle=i,void 0!==o&&(this.segment=o)}clone(){return new ss(this.x,this.y,this.angle,this.segment)}};
/*!
   * From mapbox-gl-js
   * MIT License
   * https://github.com/mapbox/mapbox-gl-js
   */function $H(e,n,i,o,s){if(void 0===n.segment)return!0;let a=n,h=n.segment+1,l=0;for(;l>-i/2;){if(h--,h<0)return!1;l-=e[h].dist(a),a=e[h]}l+=e[h].dist(e[h+1]),h++;const c=[];let A=0;for(;l<i/2;){const n=e[h],i=e[h+1];if(!i)return!1;let a=e[h-1].angleTo(n)-n.angleTo(i);for(a=Math.abs((a+3*Math.PI)%(2*Math.PI)-Math.PI),c.push({distance:l,angleDelta:a}),A+=a;l-c[0].distance>o;)A-=c.shift().angleDelta;if(A>s)return!1;h++,l+=n.dist(i)}return!0}function tj(e,n,i,o,s,a,h,l,c,A,f){const d=function(e,n,i){return e?.6*n*i:0}(o,a,h),p=function(e,n){return Math.max(e?e.right-e.left:0,0)}(o),g=0===e[0].x||e[0].x===c||0===e[0].y||e[0].y===c;return n-p*h<n/4&&(n=p*h+n/4),ej(e,g?n/2*l%n:(p/2+2*a)*h*l%n,n,d,i,p*h,g,!1,c,A,f)}function ej(e,n,i,o,s,a,h,l,c,A,f){let d=0;const p=a/2,g=function(e){let n=0;for(let i=0;i<e.length-1;i++)n+=e[i].dist(e[i+1]);return n}(e);let v=0,w=n-i,C=[];for(let n=0;n<e.length-1;n++){const h=e[n],l=e[n+1],P=h.dist(l),T=l.angleTo(h);for(;w+i<v+P;){w+=i;const S=(w-v)/P,I=nj(h.x,l.x,S),E=nj(h.y,l.y,S),O=nj(h.z||0,l.z||0,S);if(I>=0&&I<c&&E>=0&&E<c&&w-p>=0&&w+p<=g){const i=new KH(I,E,T,n);i.z=O,A&&(i.axis=[h.y-E,I-h.x],i.angleR=O===(h.z||0)?0:Math.atan(.9*(O-(h.z||0))*f/h.dist(i))),i.line=e,i.F(),!o||$H(e,i,a,o,s)?C.push(i):o&&d++}}v+=P}return l||C.length||h||(C=ej(e,v/2,i,o,s,a,h,!0,c,A,f)),C.countOutOfAngle=d,C}function nj(e,n,i){return e*(1-i)+n*i}function ij(e,n){const i=e.length;if(i<=1)return[e];const o=[];let s,a;for(let n=0;n<i;n++){const i=gF(e[n]);0!==i&&(e[n].area=Math.abs(i),void 0===a&&(a=i<0),a===i<0?(s&&o.push(s),s=[e[n]]):s.push(e[n]))}if(s&&o.push(s),n>1)for(let e=0;e<o.length;e++)o[e].length<=n||(Hk(o[e],n,1,o[e].length-1,rj),o[e]=o[e].slice(0,n));return o}function rj(e,n){return n.area-e.area}let oj=class fs{constructor(e=[],n=sj){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this.gt(e)}push(e){this.data.push(e),this.length++,this.vt(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this.gt(0)),e}peek(){return this.data[0]}vt(e){const{data:n,compare:i}=this,o=n[e];for(;e>0;){const s=e-1>>1,a=n[s];if(i(o,a)>=0)break;n[e]=a,e=s}n[e]=o}gt(e){const{data:n,compare:i}=this,o=this.length>>1,s=n[e];for(;e<o;){let o=1+(e<<1),a=n[o];const h=o+1;if(h<this.length&&i(n[h],a)<0&&(o=h,a=n[h]),i(a,s)>=0)break;n[e]=a,e=o}n[e]=s}};function sj(e,n){return e<n?-1:e>n?1:0}function aj(e,n,i){const o=n.distSqr(i);if(0===o)return e.distSqr(n);const s=((e.x-n.x)*(i.x-n.x)+(e.y-n.y)*(i.y-n.y))/o;return e.distSqr(s<0?n:s>1?i:i.sub(n).A(s).i(n))}function hj(e,n=1,i=!1){let o=1/0,s=1/0,a=-1/0,h=-1/0;const l=e[0];for(let e=0;e<l.length;e++){const n=l[e];(!e||n.x<o)&&(o=n.x),(!e||n.y<s)&&(s=n.y),(!e||n.x>a)&&(a=n.x),(!e||n.y>h)&&(h=n.y)}const c=Math.min(a-o,h-s);let A=c/2;const f=new oj([],lj);if(0===c)return new tF(o,s);for(let n=o;n<a;n+=c)for(let i=s;i<h;i+=c)f.push(new uj(n+A,i+A,A,e));let d=function(e){let n=0,i=0,o=0;const s=e[0];for(let e=0,a=s.length,h=a-1;e<a;h=e++){const a=s[e],l=s[h],c=a.x*l.y-l.x*a.y;i+=(a.x+l.x)*c,o+=(a.y+l.y)*c,n+=3*c}return new uj(i/n,o/n,0,e)}(e),p=f.length;for(;f.length;){const o=f.pop();(o.d>d.d||!d.d)&&(d=o,i&&console.log("found best %d after %d probes",Math.round(1e4*o.d)/1e4,p)),o.max-d.d<=n||(A=o.h/2,f.push(new uj(o.p.x-A,o.p.y-A,A,e)),f.push(new uj(o.p.x+A,o.p.y-A,A,e)),f.push(new uj(o.p.x-A,o.p.y+A,A,e)),f.push(new uj(o.p.x+A,o.p.y+A,A,e)),p+=4)}return i&&(console.log(`num probes: ${p}`),console.log(`best distance: ${d.d}`)),d.p}function lj(e,n){return n.max-e.max}function uj(e,n,i,o){this.p=new tF(e,n),this.h=i,this.d=function(e,n){let i=!1,o=1/0;for(let s=0;s<n.length;s++){const a=n[s];for(let n=0,s=a.length,h=s-1;n<s;h=n++){const s=a[n],l=a[h];s.y>e.y!=l.y>e.y&&e.x<(l.x-s.x)*(e.y-s.y)/(l.y-s.y)+s.x&&(i=!i),o=Math.min(o,aj(e,s,l))}}return(i?1:-1)*Math.sqrt(o)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}function cj(e,n){const i={},o={},s=[];let a=0;function h(n){s.push(e[n]),a++}function l(e,n,i){const a=o[e];return delete o[e],o[n]=a,s[a].geometry[0].pop(),s[a].geometry[0]=s[a].geometry[0].concat(i[0]),a}function c(e,n,o){const a=i[n];return delete i[n],i[e]=a,s[a].geometry[0].shift(),s[a].geometry[0]=o[0].concat(s[a].geometry[0]),a}function A(e,n,i){const o=i?n[0][n[0].length-1]:n[0][0];return`${e}:${o.x}:${o.y}`}for(let f=0;f<e.length;f++){const d=e[f],p=d.geometry;if(!p)continue;const g=d.properties[n]?d.properties[n].toString():null;if(!g){h(f);continue}const v=A(g,p),w=A(g,p,!0);if(v in o&&w in i&&o[v]!==i[w]){const e=c(v,w,p),n=l(v,w,s[e].geometry);delete i[v],delete o[w],o[A(g,s[n].geometry,!0)]=n,s[e].geometry=null}else v in o?l(v,w,p):w in i?c(v,w,p):(h(f),i[v]=a-1,o[w]=a-1)}return s.filter((e=>e.geometry))}const Aj="__index";function fj(e,n,i,o){const s=(Aj+"").trim(),a=function(e,n,i,o){const s=(Aj+"").trim(),{mergeOnPropertyFn:a}=i;if(!n.mergeOnProperty)return[];if(!_F(h=n.mergeOnProperty)&&("string"==typeof h||null!==h.constructor&&h.constructor===String))return[{features:e,property:n.mergeOnProperty}];var h;const l=[],c={},A=[];for(let i=0;i<e.length;i++){e[i][s]=i;const h=e[i].properties=e[i].properties||{};h.$layer=e[i].layer,h.$type=e[i].type;const f=a?a(o,h):n.mergeOnProperty;_F(f)?A.push(e[i]):(void 0===c[f]&&(c[f]=l.length,l.push({features:[],property:f})),l[c[f]].features.push(e[i]))}return A.length&&l.push({features:A}),l}(e,n,i,o);if(a.length){const n=[];for(let i=0;i<a.length;i++)n.push(a[i].property?cj(a[i].features,a[i].property):e);if(1===n.length)return n[0];{let e=[];for(let i=0;i<n.length;i++)e=e.concat(n[i]);return e.sort(((e,n)=>e[s]-n[s])),e}}return[]}let dj=class Ms extends mH{static needMerge(e,n,i){if(!e)return!1;let o="line"===e.textPlacement||"line"===e.markerPlacement;return o||(n.textPlacementFn&&(o="line"===n.textPlacementFn(i)),n.markerPlacementFn&&(o="line"===n.markerPlacementFn(i))),e.mergeOnProperty&&o}static mergeLineFeatures(e,n,i,o){let s=n.textPlacement,a=n.markerPlacement;return i.textPlacementFn&&(s=i.textPlacementFn(o)),i.markerPlacementFn&&(a=i.markerPlacementFn(o)),"line"!==s&&"line"!==a?e:fj(e,n,i,o)}static splitPointSymbol(e,n=0){const i=[];if(Array.isArray(e)){const n=e;for(let e=0;e<n.length;e++)n[e]&&i.push(...Ms.splitPointSymbol(n[e],e));return i}let o=null,s=null;for(const n in e)0===n.indexOf("marker")?(o=o||{},o[n]=e[n]):0===n.indexOf("text")&&(s=s||{},s[n]=e[n]);return o&&(o.isIconText=!0,e.mergeOnProperty&&(o.mergeOnProperty=e.mergeOnProperty),i.push(o)),s&&(o&&(s.textPlacement=o.markerPlacement,s.textSpacing=o.markerSpacing,s.isIconText=!0),e.mergeOnProperty&&(s.mergeOnProperty=e.mergeOnProperty),i.push(s)),void 0!==e.visible&&(o&&(o.visible=e.visible),s&&(s.visible=e.visible)),o&&(o.markerTextFit&&s&&(o.text={},o.text.textName=s.textName,o.text.textSize=s.textSize),o.index={index:n,type:0}),s&&(s.index={index:n,type:1}),i}static isAtlasLoaded(e,n){const{icon:i,glyph:o}=e,{iconAtlas:s,glyphAtlas:a}=n;if(i&&(!s||!s.positions[i.url]))return!1;if(o){if(!a||!a.positions[o.font])return!1;const e=a.positions[o.font],{text:n}=o;for(const i of n)if(!e[i.codePointAt(0)])return!1}return!0}constructor(e,n,i){super(e,n,i),this.xt=n.textPlacement,this.Z.textPlacementFn&&(this.xt=this.Z.textPlacementFn(this.options.zoom))}createStyledVector(e,n,i,o,s,a){const h=new XH(e,this.symbolDef,n,i,o),l=h.getIconAndGlyph();if(l.icon&&!this.options.atlas){const{url:e,size:n}=l.icon;s[e]||(s[e]=l.icon.size),s[e][0]<n[0]&&(s[e][0]=n[0]),s[e][1]<n[1]&&(s[e][1]=n[1])}if(l.glyph&&!this.options.atlas){const{font:e,text:n}=l.glyph,i=a[e]=a[e]||{};for(const e of n)i[e.codePointAt(0)]=1;"line"===this.xt&&(a.options={isCharsCompact:!1})}return this.options.allowEmptyPack||l.icon||l.glyph?h:null}getFormat(e){const n=void 0!==e.textName,i=n?this.getPackSDFFormat(e):this.getPackMarkerFormat();n?i.push(...this.bt()):i.push(...this.wt());const{markerOpacityFn:o,textOpacityFn:s,markerPitchAlignmentFn:a,textPitchAlignmentFn:h,markerRotationAlignmentFn:l,textRotationAlignmentFn:c,markerRotationFn:A,textRotationFn:f,markerAllowOverlapFn:d,textAllowOverlapFn:p,markerIgnorePlacementFn:g,textIgnorePlacementFn:v}=this.Z;return(o||s)&&i.push({type:Uint8Array,width:1,name:"aColorOpacity"}),(a||h)&&i.push({type:Uint8Array,width:1,name:"aPitchAlign"}),(l||c)&&i.push({type:Uint8Array,width:1,name:"aRotationAlign"}),(A||f)&&i.push({type:Uint16Array,width:1,name:"aRotation"}),(d||p||g||v)&&i.push({type:Uint8Array,width:1,name:"aOverlap"}),i}At(){return this.hasMapPitchAlign}bt(){const{textFillFn:e,textSizeFn:n,textHaloFillFn:i,textHaloRadiusFn:o,textHaloOpacityFn:s,textDxFn:a,textDyFn:h}=this.Z,l=[];return e&&l.push({type:Uint8Array,width:4,name:"aTextFill"}),n&&l.push({type:Uint8Array,width:1,name:"aTextSize"}),i&&l.push({type:Uint8Array,width:4,name:"aTextHaloFill"}),o&&l.push({type:Uint8Array,width:1,name:"aTextHaloRadius"}),s&&l.push({type:Uint8Array,width:1,name:"aTextHaloOpacity"}),a&&l.push({type:Int8Array,width:1,name:"aTextDx"}),h&&l.push({type:Int8Array,width:1,name:"aTextDy"}),l}wt(){const{markerWidthFn:e,markerHeightFn:n,markerDxFn:i,markerDyFn:o}=this.Z,s=[];return e&&s.push({type:this.options.markerWidthType||Uint8Array,width:1,name:"aMarkerWidth"}),n&&s.push({type:this.options.markerHeightType||Uint8Array,width:1,name:"aMarkerHeight"}),i&&s.push({type:Int8Array,width:1,name:"aMarkerDx"}),o&&s.push({type:Int8Array,width:1,name:"aMarkerDy"}),s}createDataPack(){if(!this.iconAtlas&&!this.glyphAtlas){if(!this.options.allowEmptyPack)return null;this.empty=!0}this.countOutOfAngle=0,this.lineVertex=[];const e=super.createDataPack.apply(this,arguments);return e?(e.lineVertex=new Int16Array(this.lineVertex),e.buffers.push(e.lineVertex.buffer),e):null}placeVector(e,n){const i=e.getShape(this.iconAtlas,this.glyphAtlas);if(!this.options.allowEmptyPack&&(!i||!i.image)&&(!i||!i.horizontal&&!i.vertical))return;const o=this.Mt(e,i,n);if(this.countOutOfAngle+=o.countOutOfAngle||0,0===o.length)return;const s=this.data,a=this.needAltitudeAttribute()?2:3;let h=this.data.aPosition.getLength()/a;const l=e.symbol,c=e.feature.properties,A="line"===this.xt&&!l.isIconText,f=void 0!==l.textName,d=f&&A&&function(e){let n=0;for(let i=0;i<e.length;i++)if(EH(e.charAt(i).charCodeAt(0)))n=0;else if(n++,n>=1)return!1;return!0}(e.getIconAndGlyph().glyph.text)?1:0,{textFillFn:p,textSizeFn:g,textHaloFillFn:v,textHaloRadiusFn:w,textHaloOpacityFn:C,textDxFn:P,textDyFn:T,textPitchAlignmentFn:S,textRotationAlignmentFn:I,textRotationFn:E,textAllowOverlapFn:O,textIgnorePlacementFn:k,textOpacityFn:L,markerWidthFn:F,markerHeightFn:N,markerDxFn:z,markerDyFn:H,markerPitchAlignmentFn:j,markerRotationAlignmentFn:W,markerRotationFn:q,markerAllowOverlapFn:Y,markerIgnorePlacementFn:J,markerOpacityFn:$}=this.Z;let it,rt,ot,st,at,ht,At,ft,gt,vt,_t,xt,wt,Ct,Ot,Dt,kt;if(f){const n=e.getIconAndGlyph().glyph.font;it=function(e,n,i){const o=e.positionedGlyphs,s=[];for(let a=0;a<o.length;a++){const h=o[a],l=i[h.glyph];if(!l)continue;const c=l.rect;if(!c)continue;const A=4,f=l.metrics.advance/2,d=l.metrics.height/2,p=n?[h.x+f,0]:[0,0],g=n?[0,h.y-d]:[h.x+f,h.y-d],v=l.metrics.left-A-f+g[0],w=l.metrics.top-A+g[1],C=v+c.w,P=w+c.h,T=new tF(v,w),S=new tF(C,w),I=new tF(v,P),E=new tF(C,P);if(n&&h.vertical){const e=new tF(-f,f),n=-Math.PI/2,i=new tF(5,0);T.k(n,e).i(i),S.k(n,e).i(i),I.k(n,e).i(i),E.k(n,e).i(i)}s.push({tl:T,tr:S,bl:I,br:E,tex:c,writingMode:e.writingMode,glyphOffset:p})}return s}(i.horizontal,A,this.glyphAtlas.positions[n]),p&&(rt=p(null,c),ED(rt)?(this.dynamicAttrs.aTextFill=1,rt=[0,0,0,0]):rt=UF([],rt)),g&&(ot=g(this.options.zoom,c),_F(ot)&&(ot=14)),v&&(st=v(null,c),ED(st)?(this.dynamicAttrs.aTextHaloFill=1,st=[0,0,0,0]):st=UF([],st)),w&&(at=w(null,c)),C&&(ht=255*C(null,c)),P&&(At=P(null,c)||0),T&&(ft=T(null,c)||0),S&&(wt=+("map"===S(null,c))),I&&(Ct=+("map"===I(null,c))),E&&(Ot=xF(E(null,c),0,360)*Math.PI/180)}else it=i?function(e){const n=e.image,i=e.top-1/n.pixelRatio,o=e.left-1/n.pixelRatio,s=e.bottom+1/n.pixelRatio,a=e.right+1/n.pixelRatio;let h,l,c,A;return h=new tF(o,i),l=new tF(a,i),c=new tF(a,s),A=new tF(o,s),[{tl:h,tr:l,bl:A,br:c,tex:{x:n.tl[0],y:n.tl[1],w:n.displaySize[0],h:n.displaySize[1]},writingMode:void 0,glyphOffset:[0,0]}]}(i):function(){const e=new tF(0,0),n=new tF(0,0),i=new tF(0,0);return[{tl:e,tr:n,bl:new tF(0,0),br:i,tex:{x:0,y:0,w:0,h:0},writingMode:void 0,glyphOffset:[0,0]}]}(),F&&(gt=F(null,c)),_F(gt)&&(gt=it[0].tex.w),N&&(vt=N(null,c)),_F(vt)&&(vt=it[0].tex.h),z&&(_t=z(null,c)),H&&(xt=H(null,c)),j&&(wt=+("map"===j(null,c))),W&&(Ct=+("map"===W(null,c))),q&&(Ot=xF(q(null,c),0,360)*Math.PI/180);ED(ot)&&(this.dynamicAttrs.aTextSize=1),ED(at)&&(this.dynamicAttrs.aTextHaloRadius=1),ED(ht)&&(this.dynamicAttrs.aTextHaloOpacity=1),ED(At)&&(this.dynamicAttrs.aTextDx=1),ED(ft)&&(this.dynamicAttrs.aTextDy=1),ED(gt)&&(this.dynamicAttrs.aMarkerWidth=1),ED(vt)&&(this.dynamicAttrs.aMarkerHeight=1),ED(_t)&&(this.dynamicAttrs.aMarkerDx=1),ED(xt)&&(this.dynamicAttrs.aMarkerDy=1),ED(wt)&&(this.dynamicAttrs.aPitchAlign=1),ED(Ct)&&(this.dynamicAttrs.aRotationAlign=1),ED(Ot)&&(this.dynamicAttrs.aRotation=1);const Nt=Y||O;Nt&&(Dt=Nt(null,c)||0);const Bt=J||k;let Ht;Bt&&(kt=Bt(null,c)||0);const Ut=L||$;Ut&&(Ht=255*Ut(this.options.zoom,c));const Wt=it.length;this.ensureDataCapacity(4*Wt,o.length);const Xt=this.options.EXTENT,{altitudeScale:Kt,altitudeProperty:$t,defaultAltitude:te}=this.options,{altitude:ee}=yF(e.feature,Kt,$t,te);for(let e=0;e<o.length;e++){const n=o[e],i=n.z||ee||0;if(Xt!==1/0&&vF(n,Xt))continue;const a=n.x,l=n.y,c=it.length;for(let e=0;e<c;e++){const o=it[e],{tl:c,tr:p,bl:g,br:v,tex:w}=o;this._t(s,a,l,i,10*c.x,10*c.y,w.x,w.y+w.h),f&&this.St(s,A,Wt,o.glyphOffset,n,d,n.axis,n.angleR),this.kt(s,rt,ot,st,at,ht,At,ft,gt,vt,_t,xt,Ht,wt,Ct,Ot,Dt,kt),this._t(s,a,l,i,10*p.x,10*p.y,w.x+w.w,w.y+w.h),f&&this.St(s,A,Wt,o.glyphOffset,n,d,n.axis,n.angleR),this.kt(s,rt,ot,st,at,ht,At,ft,gt,vt,_t,xt,Ht,wt,Ct,Ot,Dt,kt),this._t(s,a,l,i,10*g.x,10*g.y,w.x,w.y),f&&this.St(s,A,Wt,o.glyphOffset,n,d,n.axis,n.angleR),this.kt(s,rt,ot,st,at,ht,At,ft,gt,vt,_t,xt,Ht,wt,Ct,Ot,Dt,kt),this._t(s,a,l,i,10*v.x,10*v.y,w.x+w.w,w.y),f&&this.St(s,A,Wt,o.glyphOffset,n,d,n.axis,n.angleR),this.kt(s,rt,ot,st,at,ht,At,ft,gt,vt,_t,xt,Ht,wt,Ct,Ot,Dt,kt),this.addElements(h,h+1,h+2),this.addElements(h+1,h+2,h+3),h+=4;const C=Math.max(Math.abs(a),Math.abs(l),Math.abs(i));C>this.maxPos&&(this.maxPos=C)}}}_t(e,n,i,o,s,a,h,l){this.fillPosition(e,n,i,o);let c=e.aShape.currentIndex;e.aShape[c++]=s,e.aShape[c++]=a,e.aShape.currentIndex=c,c=e.aTexCoord.currentIndex,e.aTexCoord[c++]=h,e.aTexCoord[c++]=l,e.aTexCoord.currentIndex=c}St(e,n,i,o,s,a,h,l){let c=e.aCount.currentIndex;if(e.aCount[c++]=i,e.aCount.currentIndex=c,n){c=e.aGlyphOffset.currentIndex,e.aGlyphOffset[c++]=o[0],e.aGlyphOffset[c++]=o[1],e.aGlyphOffset.currentIndex=c,this.At()&&(c=e.aPitchRotation.currentIndex,e.aPitchRotation[c++]=h[0],e.aPitchRotation[c++]=h[1],e.aPitchRotation[c++]=l,e.aPitchRotation.currentIndex=c);const n=s.startIndex;c=e.aSegment.currentIndex,e.aSegment[c++]=s.segment+n,e.aSegment[c++]=n,e.aSegment[c++]=s.line.length,e.aSegment.currentIndex=c,c=e.aVertical.currentIndex,e.aVertical[c++]=a,e.aVertical.currentIndex=c}}kt(e,n,i,o,s,a,h,l,c,A,f,d,p,g,v,w,C,P){const{textFillFn:T,textSizeFn:S,textHaloFillFn:I,textHaloRadiusFn:E,textHaloOpacityFn:O,textDxFn:k,textDyFn:L,textPitchAlignmentFn:F,textRotationAlignmentFn:N,textRotationFn:z,textAllowOverlapFn:H,textIgnorePlacementFn:j,textOpacityFn:W,markerWidthFn:q,markerHeightFn:Y,markerDxFn:J,markerDyFn:$,markerPitchAlignmentFn:it,markerRotationAlignmentFn:rt,markerRotationFn:ot,markerAllowOverlapFn:st,markerIgnorePlacementFn:at,markerOpacityFn:ht}=this.Z;if(T){let i=e.aTextFill.currentIndex;e.aTextFill[i++]=n[0],e.aTextFill[i++]=n[1],e.aTextFill[i++]=n[2],e.aTextFill[i++]=n[3],e.aTextFill.currentIndex=i}if(S){let n=e.aTextSize.currentIndex;e.aTextSize[n++]=i,e.aTextSize.currentIndex=n}if(I){let n=e.aTextHaloFill.currentIndex;e.aTextHaloFill[n++]=o[0],e.aTextHaloFill[n++]=o[1],e.aTextHaloFill[n++]=o[2],e.aTextHaloFill[n++]=o[3],e.aTextHaloFill.currentIndex=n}if(E){let n=e.aTextHaloRadius.currentIndex;e.aTextHaloRadius[n++]=s,e.aTextHaloRadius.currentIndex=n}if(O){let n=e.aTextHaloOpacity.currentIndex;e.aTextHaloOpacity[n++]=a,e.aTextHaloOpacity.currentIndex=n}if(k){let n=e.aTextDx.currentIndex;e.aTextDx[n++]=h,e.aTextDx.currentIndex=n}if(L){let n=e.aTextDy.currentIndex;e.aTextDy[n++]=l,e.aTextDy.currentIndex=n}if(q){let n=e.aMarkerWidth.currentIndex;e.aMarkerWidth[n++]=c,e.aMarkerWidth.currentIndex=n}if(Y){let n=e.aMarkerHeight.currentIndex;e.aMarkerHeight[n++]=A,e.aMarkerHeight.currentIndex=n}if(J){let n=e.aMarkerDx.currentIndex;e.aMarkerDx[n++]=f,e.aMarkerDx.currentIndex=n}if($){let n=e.aMarkerDy.currentIndex;e.aMarkerDy[n++]=d,e.aMarkerDy.currentIndex=n}if(ht||W){let n=e.aColorOpacity.currentIndex;e.aColorOpacity[n++]=p,e.aColorOpacity.currentIndex=n}if(F||it){let n=e.aPitchAlign.currentIndex;e.aPitchAlign[n++]=g,e.aPitchAlign.currentIndex=n}if(rt||N){let n=e.aRotationAlign.currentIndex;e.aRotationAlign[n++]=v,e.aRotationAlign.currentIndex=n}if(ot||z){let n=e.aRotation.currentIndex;e.aRotation[n++]=9362*w,e.aRotation.currentIndex=n}const At=st||H,ft=at||j;if(At||ft){let n=e.aOverlap.currentIndex;e.aOverlap[n++]=(At?8:0)+4*C+((ft?2:0)+P),e.aOverlap.currentIndex=n}s>0&&(this.properties.hasHalo=1)}Mt(e,n,i){const{feature:o,symbol:s}=e,a=this.Pt(e,s),h=o.properties,{markerSpacingFn:l,textSpacingFn:c,textMaxAngleFn:A}=this.Z,f=((l?l(null,h):s.markerSpacing)||(c?c(null,h):s.textSpacing)||250)*i;let d=A?A(this.options.zoom,h):s.textMaxAngle;_F(d)&&(d=80),d*=Math.PI/180;const p=this.options.EXTENT,g=this.options.altitudeToTileScale,v=this.At();return function(e,n,i,o,s,a,h,l,c,A){const{feature:f,size:d,symbol:p}=e,g=d?24:0,v=s*(d?d[0]/g:1);if("line"===h){const e=[];e.countOutOfAngle=0;let s=f.geometry;a&&(s=JH(f.geometry,0,0,a,a));for(let h=0;h<s.length;h++){const f=tj(s[h],l,i,p.isIconText?null:o&&o.vertical||o&&o.horizontal||o,0,g,p.isIconText?1:v,1,a||1/0,c,A);if(p.textPlacement&&!p.isIconText)for(let e=0;e<f.length;e++)f[e].startIndex=n.length/3;if(e.push.apply(e,f),p.textPlacement&&!p.isIconText)for(let e=0;e<s[h].length;e++)n.push(s[h][e].x,s[h][e].y,s[h][e].z||0);e.countOutOfAngle+=f.countOutOfAngle||0}return e}return function(e,n,i,o,s){const a=[];if(3===e.type){const o=ij(e.geometry,0);for(let e=0;e<o.length;e++){const s=o[e];if("vertex"===n)for(let e=0;e<s.length;e++){const n=s[e];for(let e=0;e<n.length;e++)vF(n[e],i)||a.push(n[e])}else if("vertex-first"===n){const e=s[0];e&&e[0]&&!vF(e[0],i)&&a.push(e[0])}else if("vertex-last"===n||"vertex-firstlast"===n){const e=s[0];"vertex-firstlast"===n&&e&&e[0]&&!vF(e[0],i)&&a.push(e[0]),e&&e[e.length-1]&&!vF(e[e.length-1],i)&&a.push(e[e.length-1])}else{const e=hj(s,16);vF(e,i)||a.push(e)}}}else if(2===e.type)for(let o=0;o<e.geometry.length;o++){const s=e.geometry[o];if("vertex"===n)for(let e=0;e<s.length;e++)vF(s[e],i)||a.push(s[e]);else"vertex-last"===n||"vertex-firstlast"===n?("vertex-firstlast"!==n||vF(s[0],i)||a.push(s[0]),s&&s[s.length-1]&&!vF(s[s.length-1],i)&&a.push(s[s.length-1])):vF(s[0],i)||a.push(s[0])}else if(1===e.type)for(let n=0;n<e.geometry.length;n++){const o=e.geometry[n];for(let e=0;e<o.length;e++){const n=o[e];vF(n,i)||a.push(n)}}return a}(f,h,a)}(e,this.lineVertex,d,n,i,p,a,f,v,g)}Pt(e,n){let i;return i=this.Z.markerPlacementFn?this.Z.markerPlacementFn(this.options.zoom,e.feature.properties):n.markerPlacement||this.xt,this.ut||!n.markerPlacement&&!n.isIconText||(this.ut=i),!this.xt||n.isIconText||this.ct||(this.ct=i),i}getPackSDFFormat(e){if("line"!==this.xt||e.isIconText)return[...this.getPositionFormat(),{type:Int16Array,width:2,name:"aShape"},{type:Uint16Array,width:2,name:"aTexCoord"},{type:Uint8Array,width:1,name:"aCount"}];{const e=[...this.getPositionFormat(),{type:Int16Array,width:2,name:"aShape"},{type:Uint16Array,width:2,name:"aTexCoord"},{type:Uint8Array,width:1,name:"aCount"},{type:Int16Array,width:2,name:"aGlyphOffset"},{type:Uint16Array,width:3,name:"aSegment"},{type:Uint8Array,width:1,name:"aVertical"}];return this.At()&&e.push({type:Float32Array,width:3,name:"aPitchRotation"}),e}}getPackMarkerFormat(){return[...this.getPositionFormat(),{type:Int16Array,width:2,name:"aShape"},{type:Uint16Array,width:2,name:"aTexCoord"}]}},pj=class _s{constructor(e){this.x=e.x,this.y=e.y,this.z=e.z||0}clone(){return new _s(this)}T(){return this.M(this.mag()),this}M(e){return this.x/=e,this.y/=e,this.z/=e,this}I(){var e=this.y;return this.y=this.x,this.x=-e,this}mag(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}add(e){return this.clone().i(e)}sub(e){return this.clone().o(e)}i(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}o(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}equals(e){return this.x===e.x&&this.y===e.y&&this.z===e.z}mult(e){return this.clone().A(e)}A(e){return this.x*=e,this.y*=e,this.z*=e,this}dist(e){return Math.sqrt(this.distSqr(e))}distSqr(e){var n=e.x-this.x,i=e.y-this.y,o=e.z-this.z;return n*n+i*i+o*o}F(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}angleTo(e){return Math.atan2(this.y-e.y,this.x-e.x)}};const gj=Math.cos(Math.PI/180*37.5),mj=Math.pow(2,16)/1,yj=new tF,vj=new tF,_j=new tF;let xj=class Fs extends mH{static mergeLineFeatures(e,n,i,o){return fj(e,n,i,o)}constructor(e,n,i){super(e,n,i);let o=!1;const{lineDasharrayFn:s,lineDashColorFn:a}=this.Z;this.hasGradient=this.symbol.lineGradientProperty,s&&(o=function(e,n,i){for(let o=0;o<e.length;o++)if(i(n,e[o].properties))return!0;return!1}(e,this.options.zoom,s),o&&(this.dasharrayFn=s)),this.hasDasharray=Cj(this.symbol.lineDasharray)||o,this.hasDasharray&&a&&(this.dashColorFn=a)}createStyledVector(e,n,i,o,s){const a=new VF(e,n,i,o),h=a.getLineResource();return!this.options.atlas&&h&&(s[h]=[0,0]),a}getFormat(){const{lineWidthFn:e,lineStrokeWidthFn:n,lineStrokeColorFn:i,lineColorFn:o,lineOpacityFn:s,lineDxFn:a,lineDyFn:h,linePatternAnimSpeedFn:l,linePatternGapFn:c}=this.Z,A=[...this.getPositionFormat()];if(A.push(this.iconAtlas||this.hasDasharray?{type:Int8Array,width:3,name:"aExtrude"}:{type:Int8Array,width:2,name:"aExtrude"}),A.push({type:this.options.positionType||Uint16Array,width:1,name:"aLinesofar"}),e&&A.push({type:Uint8Array,width:1,name:"aLineWidth"}),n&&A.push({type:Uint8Array,width:1,name:"aLineStrokeWidth"}),o&&A.push({type:Uint8Array,width:4,name:"aColor"}),i&&A.push({type:Uint8Array,width:4,name:"aStrokeColor"}),s&&A.push({type:Uint8Array,width:1,name:"aOpacity"}),this.dasharrayFn&&A.push({type:Uint8Array,width:4,name:"aDasharray"}),this.dashColorFn&&A.push({type:Uint8Array,width:4,name:"aDashColor"}),this.iconAtlas){const e=this.getIconAtlasMaxValue();A.push({type:e>255?Uint16Array:Uint8Array,width:4,name:"aTexInfo"})}return(a||h)&&A.push({type:Int8Array,width:2,name:"aLineDxDy"}),(l||c)&&A.push({type:Int8Array,width:2,name:"aLinePattern"}),A}placeVector(e){const{lineJoinFn:n,lineCapFn:i,lineWidthFn:o,lineHeightFn:s,lineStrokeWidthFn:a,lineStrokeColorFn:h,lineColorFn:l,lineOpacityFn:c,lineDxFn:A,lineDyFn:f,linePatternAnimSpeedFn:d,linePatternGapFn:p}=this.Z,g=this.symbol,v=e.feature,w=v.properties;let C=g.lineJoin||"miter",P=g.lineCap||"butt";if(n&&(C=n(this.options.zoom,w)||"miter"),i&&(P=i(this.options.zoom,w)||"butt"),o){let e=o(this.options.zoom,w);ED(e)&&(this.dynamicAttrs.aLineWidth=1,e=4),kF(e)&&(e=4),this.feaLineWidth=+e}else this.feaLineWidth=+g.lineWidth;if(s){let e=s(this.options.zoom,w);ED(e)&&(this.dynamicAttrs.aLineHeight=1),kF(e)&&(e=this.feaLineWidth),this.feaLineHeight=+e}else this.feaLineHeight=+g.lineHeight||this.feaLineWidth;if(a){let e=a(this.options.zoom,w);ED(e)&&(this.dynamicAttrs.aLineStrokeWidth=1,e=0),kF(e)&&(e=0),this.feaLineStrokeWidth=e}else this.feaLineStrokeWidth=g.lineStrokeWidth||0;if(l&&(this.feaColor=l(this.options.zoom,w)||[255,255,255,255],ED(this.feaColor)?(this.dynamicAttrs.aColor=1,this.feaColor=[0,0,0,0]):this.feaColor=UF([],this.feaColor)),h&&(this.feaStrokeColor=h(this.options.zoom,w)||[0,0,0,255],ED(this.feaStrokeColor)?(this.dynamicAttrs.aStrokeColor=1,this.feaStrokeColor=[0,0,0,0]):this.feaStrokeColor=UF([],this.feaStrokeColor)),c){let e=c(this.options.zoom,w);ED(e)&&(this.dynamicAttrs.aOpacity=1,e=1),kF(e)&&(e=1),this.feaOpacity=255*e}if(this.dasharrayFn){let e=this.dasharrayFn(this.options.zoom,w)||[0,0,0,0];if(ED(e)&&(this.dynamicAttrs.aDasharray=1,e=[0,0,0,0]),e.length<4){const n=e;1===e.length?e=[n[0],n[0],n[0],n[0]]:2===e.length?e=[n[0],n[1],n[0],n[1]]:3===e.length&&(e=[n[0],n[1],n[2],n[2]])}this.feaDash=e}if(this.dashColorFn){let e=(this.dashColorFn?this.dashColorFn(this.options.zoom,w):this.symbol.lineDashColor)||[0,0,0,0];ED(e)&&(this.dynamicAttrs.aDashColor=1,e=[0,0,0,0]),e=UF([],e),this.feaDashColor=e}if(this.iconAtlas){const n=e.getLineResource(),i=this.iconAtlas.glyphMap[n];if(this.feaTexInfo=this.feaTexInfo||[0,0,0,0],i){const{tl:e,displaySize:i}=this.iconAtlas.positions[n];this.feaTexInfo[0]=e[0]+1,this.feaTexInfo[1]=e[1]+1,this.feaTexInfo[2]=i[0]-3,this.feaTexInfo[3]=i[1]-3}else this.feaTexInfo[0]=this.feaTexInfo[1]=this.feaTexInfo[2]=this.feaTexInfo[3]=0}if(A){let e=A(this.options.zoom,w);ED(e)&&(this.dynamicAttrs.aLineDxDy=1,e=0),kF(e)&&(e=0),this.feaLineDx=e}if(f){let e=f(this.options.zoom,w);ED(e)&&(this.dynamicAttrs.aLineDxDy=1,e=0),kF(e)&&(e=0),this.feaLineDy=e}if(d){let e=d(this.options.zoom,w);ED(e)&&(this.dynamicAttrs.aLinePatternAnimSpeed=1,e=0),kF(e)&&(e=0),0!==e&&(this.properties.hasPatternAnim=1),this.feaPatternAnimSpeed=e}if(p){let e=p(this.options.zoom,w);ED(e)&&(this.dynamicAttrs.aLinePatternGap=1,e=0),kF(e)&&(e=0),this.feaLinePatternGap=e}const T=this.options.EXTENT;let S=v.geometry;if(T!==1/0){S=[];const e=[];for(let n=0;n<v.geometry.length;n++){e[0]=v.geometry[n];const i=JH(e,-1,-1,T+1,T+1);if(3===v.type&&i.length>1){const e=i[0],n=i[i.length-1];Sj(e[0],n[n.length-1])&&(i[0]=n.concat(e.slice(1)),i.length=i.length-1)}S.push(...i)}}const I=this.needAltitudeAttribute()?2:3;for(let e=0;e<S.length;e++){this.offset=this.data.aPosition.getLength()/I;this.Tt(S[e],v,C,P,2,1.05)}}It(){return this.iconAtlas&&this.feaTexInfo[2]&&this.feaTexInfo[3]}Tt(e,n,i,o,s,a){const h=this.It()||Cj(this.feaDash)||Cj(this.symbol.lineDasharray),l=this.options.isTube;l&&(e=e.map((e=>new pj(e)))),this.overscaling=1;const c=this.options.EXTENT;if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.prevVertex=null,this.symbol.lineGradientProperty&&n.properties&&LF(n.properties.mapbox_clip_start)&&LF(n.properties.mapbox_clip_end)){this.clipStart=+n.properties.mapbox_clip_start,this.clipEnd=+n.properties.mapbox_clip_end;for(let n=0;n<e.length-1;n++)this.totalDistance+=e[n].dist(e[n+1]);this.updateScaledDistance()}const A=3===n.type&&!e.clipped;let f=e.length;for(;f>=2&&Sj(e[f-1],e[f-2]);)f--;let d=0;for(;d<f-1&&Sj(e[d],e[d+1]);)d++;if(f<(A?3:2))return;"bevel"===i&&(s=1.05);const p=this.overscaling<=16?15*c/(512*this.overscaling):0,g={vertexLength:0,primitiveLength:0,currentNormal:null};let v,w,C,P,T;this.e1=this.e2=-1,A&&(v=e[f-2],T=e[d].sub(v).T().I()),this.ensureDataCapacity(i,f,360,2);for(let n=d;n<f;n++){if(C=n===f-1?A?e[d+1]:void 0:e[n+1],C&&Sj(e[n],C))continue;T&&(P=T),v&&(w=v),v=e[n],C&&v.x===C.x&&v.y===C.y&&(v.x+=1e-4),T=C?C.sub(v).T().I():P,g.dir=w?v.sub(w).T():C.sub(v).T(),P=P||T,g.currentNormal=P;let c=P.add(T);0===c.x&&0===c.y||c.T();const S=P.x*T.x+P.y*T.y,I=c.x*T.x+c.y*T.y,E=0!==I?1/I:1/0,O=2*Math.sqrt(2-2*I),k=I<gj&&w&&C,L=P.x*T.y-P.y*T.x>0;if(!l&&k&&n>d){const e=v.dist(w);if(e>2*p){const n=v.sub(v.sub(w).A(p/e).F());n.z=v.z,this.updateDistance(w,n),this.addCurrentVertex(n,P,0,0,g),w=n}}const F=w&&C;g.middleVertex=F;let N=F?i:A?"butt":o;if(F&&"round"===N&&(E<a?N="miter":E<=2&&(N="fakeround")),"miter"===N&&E>s&&!l&&(N="bevel"),"bevel"===N&&(E>2&&(N="flipbevel"),E<s&&(N="miter")),w&&this.updateDistance(w,v),"miter"===N)l?(this.addCurrentVertex(v,P,0,0,g),g.dir=C.sub(v).T(),this.addCurrentVertex(v,T,0,0,g)):(c.A(E),this.addCurrentVertex(v,c,0,0,g),h&&(g.currentNormal=T,g.dir=C.sub(v).T(),this.addCurrentVertex(v,c,0,0,g)));else if("flipbevel"===N){if(E>100)c=T.mult(-1);else{const e=E*P.add(T).mag()/P.sub(T).mag();c.I().A(e*(L?-1:1))}this.addCurrentVertex(v,c,0,0,g),this.addCurrentVertex(v,c.mult(-1),0,0,g)}else if("bevel"===N||"fakeround"===N){const e=-Math.sqrt(E*E-1),n=L?e:0,i=L?0:e;if(w&&this.addCurrentVertex(v,P,n,i,g),"fakeround"===N){const e=Math.round(180*O/Math.PI/20);for(let n=1;n<e;n++){let i=n/e;if(.5!==i){const e=i-.5;i+=i*e*(i-1)*((1.0904+S*(S*(3.55645-1.43519*S)-3.2452))*e*e+(.848013+S*(.215638*S-1.06021)))}const o=T.sub(P).A(i).i(P).T().A(L?-1:1);this.addHalfVertex(v,o.x,o.y,!1,L,0,g)}}C&&(g.currentNormal=T,g.dir=C.sub(v).T(),this.addCurrentVertex(v,T,-n,-i,g))}else if("butt"===N)this.addCurrentVertex(v,c,0,0,g);else if("square"===N){const e=w?1:-1;this.addCurrentVertex(v,c,e,e,g)}else"round"===N&&(w&&(this.addCurrentVertex(v,P,0,0,g),this.addCurrentVertex(v,P,1,1,g,!0)),C&&(this.addCurrentVertex(v,T,-1,-1,g,!0),this.addCurrentVertex(v,T,0,0,g)));if(!l&&k&&n<f-1){const e=v.dist(C);if(e>2*p){const n=v.add(C.sub(v).A(p/e).F());n.z=v.z,this.updateDistance(v,n),this.addCurrentVertex(n,T,0,0,g),v=n}}}}ensureDataCapacity(e,n,i,o){const s="round"===e?Math.round(i/20)-1:0;super.ensureDataCapacity((6+s)*o,n)}addCurrentVertex(e,n,i,o,s,a=!1){const h=n.x+n.y*i,l=n.y-n.x*i,c=n.y*o-n.x,A=-n.y-n.x*o;let f=0,d=0;if(s.middleVertex){yj.x=h,yj.y=l;const e=s.currentNormal;if(f=Tj(e,yj,s.dir),0===i&&0===o)d=-f;else{const n=vj;n.x=e.x,n.y=e.y,n.A(-1),_j.x=c,_j.y=A,d=Tj(n,_j,s.dir)}}this.addHalfVertex(e,h,l,a,!1,i,s,f),this.addHalfVertex(e,c,A,a,!0,-o,s,d),this.prevVertex&&Sj(e,this.prevVertex)||(this.prevVertex=e),this.distance>mj/2&&0===this.totalDistance&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,n,i,o,s,a))}addHalfVertex({x:e,y:n,z:i},o,s,a,h,l,c,A){this.fillData(this.data,e,n,i||0,o,s,a,h,1*this.scaledDistance,A);const f=c.vertexLength++;this.e1>=0&&this.e2>=0&&(this.addElements(this.e1,this.e2,f),c.primitiveLength++),h?this.e2=f:this.e1=f}fillData(e,n,i,o,s,a,h,l,c,A){const{lineWidthFn:f,lineStrokeWidthFn:d,lineStrokeColorFn:p,lineColorFn:g,lineOpacityFn:v,lineDxFn:w,lineDyFn:C,linePatternAnimSpeedFn:P,linePatternGapFn:T}=this.Z;this.fillPosition(e,n,i,o);let S=63*s;S=(Math.sign(S)||1)*((Math.floor(Math.abs(S))>>1<<1)+ +h);let I=63*a;I=(Math.sign(I)||1)*((Math.floor(Math.abs(I))>>1<<1)+ +l);let E=e.aExtrude.currentIndex;e.aExtrude[E++]=S,e.aExtrude[E++]=I,(this.iconAtlas||this.hasDasharray)&&(e.aExtrude[E++]=63*A),e.aExtrude.currentIndex=E,E=e.aLinesofar.currentIndex,e.aLinesofar[E++]=c,e.aLinesofar.currentIndex=E,f&&(E=e.aLineWidth.currentIndex,e.aLineWidth[E++]=Math.round(2*this.feaLineWidth),e.aLineWidth.currentIndex=E),d&&(E=e.aLineStrokeWidth.currentIndex,e.aLineStrokeWidth[E++]=Math.round(2*this.feaLineStrokeWidth),e.aLineStrokeWidth.currentIndex=E),g&&(E=e.aColor.currentIndex,e.aColor[E++]=this.feaColor[0],e.aColor[E++]=this.feaColor[1],e.aColor[E++]=this.feaColor[2],e.aColor[E++]=this.feaColor[3],e.aColor.currentIndex=E),p&&(E=e.aStrokeColor.currentIndex,e.aStrokeColor[E++]=this.feaStrokeColor[0],e.aStrokeColor[E++]=this.feaStrokeColor[1],e.aStrokeColor[E++]=this.feaStrokeColor[2],e.aStrokeColor[E++]=this.feaStrokeColor[3],e.aStrokeColor.currentIndex=E),v&&(E=e.aOpacity.currentIndex,e.aOpacity[E++]=this.feaOpacity,e.aOpacity.currentIndex=E),this.dasharrayFn&&(E=e.aDasharray.currentIndex,e.aDasharray[E++]=this.feaDash[0],e.aDasharray[E++]=this.feaDash[1],e.aDasharray[E++]=this.feaDash[2],e.aDasharray[E++]=this.feaDash[3],e.aDasharray.currentIndex=E),this.dashColorFn&&(E=e.aDashColor.currentIndex,e.aDashColor[E++]=this.feaDashColor[0],e.aDashColor[E++]=this.feaDashColor[1],e.aDashColor[E++]=this.feaDashColor[2],e.aDashColor[E++]=this.feaDashColor[3],e.aDashColor.currentIndex=E),this.iconAtlas&&(E=e.aTexInfo.currentIndex,e.aTexInfo[E++]=this.feaTexInfo[0],e.aTexInfo[E++]=this.feaTexInfo[1],e.aTexInfo[E++]=this.feaTexInfo[2],e.aTexInfo[E++]=this.feaTexInfo[3],e.aTexInfo.currentIndex=E),(w||C)&&(E=e.aLineDxDy.currentIndex,e.aLineDxDy[E++]=this.feaLineDx||0,e.aLineDxDy[E++]=this.feaLineDy||0,e.aLineDxDy.currentIndex=E),(P||T)&&(E=e.aLinePattern.currentIndex,e.aLinePattern[E++]=127*(this.feaPatternAnimSpeed||0),e.aLinePattern[E++]=10*(this.feaLinePatternGap||0),e.aLinePattern.currentIndex=E),this.maxPos=Math.max(this.maxPos,Math.abs(n)+1,Math.abs(i)+1)}addElements(e,n,i){super.addElements(this.offset+e,this.offset+n,this.offset+i)}Ft(e){const n=this.options.EXTENT,i=this.elements;for(let o=0;o<i.length;o+=3)if(n===1/0||!wj(this.data.aPosition,i[o],i[o+1],3,n)&&!wj(this.data.aPosition,i[o+1],i[o+2],3,n)){let n=e.currentIndex;e[n++]=i[o],e[n++]=i[o+1],e[n++]=i[o+2],e.currentIndex=n}}Ct(e){if(e.length<=1)return e;const n=[],i=this.options.EXTENT;let o,s=!0;for(o=0;o<e.length-1;o++){const a=bj(e[o],e[o+1],i);a&&s||(n.push(e[o]),s=a)}return s||n.push(e[o]),n}updateDistance(e,n){if(this.options.isTube){const i=e.dist(n),o=function(e){const{verticalCentimeterToPoint:n,tileRatio:i}=e;return n*i}(this.options),s=o*(n.z-e.z);this.distance+=Math.sqrt(i*i+s*s)}else this.distance+=e.dist(n);this.updateScaledDistance()}updateScaledDistance(){this.scaledDistance=this.totalDistance>0?(this.clipStart+(this.clipEnd-this.clipStart)*this.distance/this.totalDistance)*(mj-1):this.distance}};function bj(e,n,i){return i!==1/0&&(e.x<0&&n.x<0||e.x>i&&n.x>i||e.y<0&&n.y<0||e.y>i&&n.y>i)}function wj(e,n,i,o,s){if(s===1/0)return!1;const a=Math.floor(.5*e[n*o]),h=Math.floor(.5*e[n*o+1]),l=Math.floor(.5*e[i*o]),c=Math.floor(.5*e[i*o+1]);return a===l&&(a<0||a>s)&&h!==c||h===c&&(h<0||h>s)&&a!==l}function Cj(e){if(!Array.isArray(e))return!1;for(let n=0;n<e.length;n++)if(e[n])return!0;return!1}const Pj=[],Mj=[];function Tj(e,n,i){const o=e.mag(),s=n.mag();Zx(Pj,i.x,i.y),Zx(Mj,n.x,n.y);const a=ib(Pj,Mj);return-Math.sign(a)*Math.sqrt(s*s-o*o)}function Sj(e,n){return e.equals(n)&&e.z===n.z}
/*!
   * from @turf/bboxClip
   * https://github.com/Turfjs/turf
   * MIT LICENSE
   */const Ij=[],Ej=[];function Oj(e,n){var i,o,s,a,h,l,c;for(o=1;o<=8;o*=2){for(i=[],a=!(Dj(s=e[e.length-1],n)&o),h=0;h<e.length;h++){if((c=!(Dj(l=e[h],n)&o))!==a){const e=Rj(s,l,o,n);i.push(void 0!==l.x?new tF(e[0],e[1]):e)}c&&i.push(l),s=l,a=c}if(!(e=i).length)break}return i}function Rj(e,n,i,o){return Ij[0]=void 0===e.x?e[0]:e.x,Ij[1]=void 0===e.y?e[1]:e.y,e=Ij,Ej[0]=void 0===n.x?n[0]:n.x,Ej[1]=void 0===n.y?n[1]:n.y,n=Ej,8&i?[e[0]+(n[0]-e[0])*(o[3]-e[1])/(n[1]-e[1]),o[3]]:4&i?[e[0]+(n[0]-e[0])*(o[1]-e[1])/(n[1]-e[1]),o[1]]:2&i?[o[2],e[1]+(n[1]-e[1])*(o[2]-e[0])/(n[0]-e[0])]:1&i?[o[0],e[1]+(n[1]-e[1])*(o[0]-e[0])/(n[0]-e[0])]:null}function Dj(e,n){Ij[0]=void 0===e.x?e[0]:e.x,Ij[1]=void 0===e.y?e[1]:e.y;var i=0;return(e=Ij)[0]<n[0]?i|=1:e[0]>n[2]&&(i|=2),e[1]<n[1]?i|=4:e[1]>n[3]&&(i|=8),i}const kj=[0,0,0,0],Lj=-9999999;let Fj=class $s extends mH{constructor(...e){super(...e),this.lineElements=[]}createStyledVector(e,n,i,o,s){const a=new VF(e,n,i,o),h=a.getPolygonResource();return!this.options.atlas&&h&&(s[h]=[0,0]),a}getFormat(){const e=[...this.getPositionFormat()],{polygonFillFn:n,polygonOpacityFn:i,uvScaleFn:o,uvOffsetFn:s,polygonPatternUVFn:a}=this.Z;if(this.iconAtlas){const n=this.getIconAtlasMaxValue();e.push({type:n>255?Uint16Array:Uint8Array,width:4,name:"aTexInfo"})}return n&&e.push({type:Uint8Array,width:4,name:"aColor"}),i&&e.push({type:Uint8Array,width:1,name:"aOpacity"}),o&&e.push({type:Uint16Array,width:2,name:"aUVScale"}),s&&e.push({type:Uint8Array,width:2,name:"aUVOffset"}),a&&e.push({type:Float32Array,width:2,name:"aTexCoord"}),e}placeVector(e,n){const i=e.feature;this.Ot(i.geometry,i,n)}Ot(e,n){let i,o,s,a;const{polygonFillFn:h,polygonOpacityFn:l,uvScaleFn:c,uvOffsetFn:A,uvOffsetInMeterFn:f,polygonPatternUVFn:d}=this.Z,p=n.properties;h&&(i=h(this.options.zoom,p)||E_([],255,255,255,255),ED(i)?(this.dynamicAttrs.aColor=1,i=kj):i=UF([],i)),l&&(o=l(this.options.zoom,p),ED(o)?(this.dynamicAttrs.aOpacity=1,o=255):(kF(o)&&(o=1),o*=255)),c&&(s=c(this.options.zoom,p),ED(s)?(s=[255,255],this.dynamicAttrs.aUVScale=1):(kF(s)&&(s=[1,1]),s=[255*s[0],255*s[1]])),A&&(f&&f(null,p)?a=[0,0]:(a=A(this.options.zoom,p),ED(a)?(a=[0,0],this.dynamicAttrs.aUVOffset=1):(kF(a)&&(a=[0,0]),a=[255*a[0],255*a[1]])));const g=!!this.iconAtlas,v=ij(e,500),w=[0,0],C=[0,0];if(g){const{polygonPatternFileFn:e}=this.Z,n=e?e(null,p):this.symbol.polygonPatternFile;if(this.iconAtlas.glyphMap[n]){const e=this.iconAtlas.positions[n],i=!wF(e.displaySize[0])||!wF(e.displaySize[1]);w[0]=e.tl[0]+(i?1:0),w[1]=e.tl[1]+(i?1:0),C[0]=e.displaySize[0]-1-(i?2:0),C[1]=e.displaySize[1]-1-(i?2:0)}}let P,T=0;d&&(P=d(this.options.zoom,p));const S=this.needAltitudeAttribute()?2:3,I=[-1,-1,n.extent+1,n.extent+1],E=this.Et=this.Et||this.ot.getProxy(),O=this.Dt=this.Dt||this.ot.getProxy();for(let e=0;e<v.length;e++){const n=v[e],h=this.data.aPosition.getLength()/S;E.setLength(0),O.setLength(0);for(let e=0;e<n.length;e++){let h=n[e];if(this.options.EXTENT!==1/0&&0===this.maxPosZ&&(h=Oj(h,I)),0===h.length)continue;0!==e&&O.push(E.length/3),this.ensureDataCapacity(h.length);const l=this.data;for(let e=0;e<h.length;e++){const n=h[e].x,c=h[e].y,A=h[e].z||0;if(this.fillPosition(this.data,n,c,A),g){let e=l.aTexInfo.currentIndex;l.aTexInfo[e++]=w[0],l.aTexInfo[e++]=w[1],l.aTexInfo[e++]=C[0],l.aTexInfo[e++]=C[1],l.aTexInfo.currentIndex=e}if(void 0!==i){let e=l.aColor.currentIndex;l.aColor[e++]=i[0],l.aColor[e++]=i[1],l.aColor[e++]=i[2],l.aColor[e++]=i[3],l.aColor.currentIndex=e}if(void 0!==o){let e=l.aOpacity.currentIndex;l.aOpacity[e++]=o,l.aOpacity.currentIndex=e}if(void 0!==s){let e=l.aUVScale.currentIndex;l.aUVScale[e++]=s[0],l.aUVScale[e++]=s[1],l.aUVScale.currentIndex=e}if(void 0!==a){let e=l.aUVOffset.currentIndex;l.aUVOffset[e++]=a[0],l.aUVOffset[e++]=a[1],l.aUVOffset.currentIndex=e}if(d){let e=l.aTexCoord.currentIndex;if(P){const n=kF(P[2*T])?P[0]:P[2*T],i=kF(P[2*T]+1)?P[1]:P[2*T+1];l.aTexCoord[e++]=n,l.aTexCoord[e++]=i}else l.aTexCoord[e++]=Lj,l.aTexCoord[e++]=Lj;l.aTexCoord.currentIndex=e,T++}const f=Math.abs(n),p=Math.abs(c);f>this.maxPos&&(this.maxPos=f),p>this.maxPos&&(this.maxPos=p),E.push(n,c,A)}}let l=dL(E,O,3);if(E.length&&!l.length){const e=[];for(let n=0;n<E.length;n+=3)e[n]=E[n],e[n+1]=E[n+2],e[n+2]=E[n+1];if(l=dL(e,O,3),!l.length){for(let n=0;n<E.length;n+=3)e[n]=E[n+1],e[n+1]=E[n+2],e[n+2]=E[n];l=dL(e,O,3)}}for(let e=0;e<l.length;e+=3)this.addElements(h+l[e],h+l[e+1],h+l[e+2])}}ensureDataCapacity(e){super.ensureDataCapacity(1,e)}},Nj=class Ws{constructor(e){this.max=e,this.reset()}reset(){return this.data={},this.order=[],this}clear(){this.reset()}add(e,n){return this.has(e)?(this.order.splice(this.order.indexOf(e),1),this.data[e]=n,this.order.push(e)):(this.data[e]=n,this.order.push(e),this.order.length>this.max&&this.getAndRemove(this.order[0])),this}has(e){return e in this.data}keys(){return this.order}getAndRemove(e){if(!this.has(e))return null;const n=this.data[e];return delete this.data[e],this.order.splice(this.order.indexOf(e),1),n}get(e){return this.has(e)?this.data[e]:null}remove(e){return this.has(e)?(delete this.data[e],this.order.splice(this.order.indexOf(e),1),this):this}setMaxSize(e){for(this.max=e;this.order.length>this.max;)this.getAndRemove(this.order[0]);return this}};
/*!
   * based on @mapbox/tiny-sdf
   * https://github.com/mapbox/tiny-sdf
   * @License BSD 2-Clause
   */
var zj=1e20;function Bj(e,n,i,o,s,a,h){this.fontSize=e||24,this.buffer=void 0===n?3:n,this.cutoff=o||.25,this.fontFamily=s||"sans-serif",this.fontWeight=a||"normal",this.fontStyle=h||"normal",this.radius=i||8;var l=this.size=this.fontSize+2*this.buffer;this.canvas="undefined"==typeof document?new OffscreenCanvas(l,l):document.createElement("canvas"),this.canvas.width=this.canvas.height=l,this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),this.ctx.font=this.fontStyle+" "+this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(l*l),this.gridInner=new Float64Array(l*l),this.f=new Float64Array(l),this.z=new Float64Array(l+1),this.v=new Uint16Array(l),this.middle=Math.round(l/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Hj(e,n,i,o,s,a){for(var h=0;h<n;h++)jj(e,h,n,i,o,s,a);for(var l=0;l<i;l++)jj(e,l*n,1,n,o,s,a)}function jj(e,n,i,o,s,a,h){var l,c,A,f;for(a[0]=0,h[0]=-zj,h[1]=zj,l=0;l<o;l++)s[l]=e[n+l*i];for(l=1,c=0,A=0;l<o;l++){do{A=(s[l]-s[f=a[c]]+l*l-f*f)/(l-f)/2}while(A<=h[c]&&--c>-1);a[++c]=l,h[c]=A,h[c+1]=zj}for(l=0,c=0;l<o;l++){for(;h[c+1]<l;)c++;e[n+l*i]=s[f=a[c]]+(l-f)*(l-f)}}Bj.prototype.draw=function(e,n,i){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.textBaseline="top",this.ctx.fillText(e,this.buffer,this.buffer);for(var o=this.ctx.getImageData(0,0,n,i),s=new Uint8ClampedArray(n*i),a=0;a<n*i;a++){var h=o.data[4*a+3]/255;this.gridOuter[a]=1===h?0:0===h?zj:Math.pow(Math.max(0,.5-h),2),this.gridInner[a]=1===h?zj:0===h?0:Math.pow(Math.max(0,h-.5),2)}for(Hj(this.gridOuter,n,i,this.f,this.v,this.z),Hj(this.gridInner,n,i,this.f,this.v,this.z),a=0;a<n*i;a++){var l=Math.sqrt(this.gridOuter[a])-Math.sqrt(this.gridInner[a]);s[a]=Math.round(255-255*(l/this.radius+this.cutoff))}return s};let Uj=0,Gj=class Zs{constructor(e,n=15,i,o){this.entries={},this.Lt={},this.Rt=new Nj(2048,(function(){})),this.Ht=e,this.zt=n,this.Nt=i,this.Vt=o}Ut(e){return e&&e.indexOf("{stack}")>=0&&e.indexOf("{range}")>0}getGlyphs(e,n){if(!e||!Object.keys(e).length)return void n(null,{glyphs:null});if(this.Ut(this.Vt))return void this.jt(e,n);const i=this.entries,o=e.options;let s=!0;o&&(s=!1!==o.isCharsCompact),s=s||this.Nt;const a=(o,a,l)=>{let c=0,A=0;for(const n in e)if("options"!==n){i[n]=i[n]||{},a[n]=a[n]||{};for(const f in e[n]){if(A++,A<=o)continue;const e=s&&!EH(+f),d=n+":"+f+":"+e;let p;if(this.Rt.has(d)?p=this.Rt.get(d):(p=this.Gt(i[n],n,f,e),this.Rt.add(d,p),c++),p=Vj(p),a[n][f]=p,l.push(p.bitmap.data.buffer),this.Ht&&c>this.zt)return void this.Ht(h(A,a,l))}}n(null,{glyphs:a,buffers:l})};function h(e,n,i){return()=>{a(e,n,i)}}a(0,{},[])}jt(e,n){const i=[];for(const n in e)for(const o of e[n])i.push(this.Bt(n,o));Promise.all(i).then((e=>{n(null,e)}))}Bt(){return Promise.resolve(null)}Gt(e,n,i,o){const s=n;let a=e.tinySDF;const h=o?-1:2;if(!a){let n="400";/bolder/i.test(s)?n="1000":/bold/i.test(s)?n="900":/medium/i.test(s)?n="500":/light/i.test(s)&&(n="200"),a=e.tinySDF=new Bj(24,2,8,.25,s,n)}const l=String.fromCodePoint(i),c=a.ctx.measureText(l),A=Math.round(c.width),f=a.draw(l,A+4,28);if(Uj<4){const e="undefined"!=typeof document&&document.getElementById("sdf-debug-"+Uj++);e&&(e.width=A+4,e.height=a.canvas.height,e.getContext("2d").drawImage(a.canvas,0,0))}return{charCode:i,bitmap:{width:A+4,height:28,data:f},metrics:{width:A,height:24,left:1,top:-2,advance:A+2+h}}}};function Vj(e){const n={width:e.bitmap.width,height:e.bitmap.height,data:new Uint8ClampedArray(e.bitmap.data)};return{charCode:e.charCode,bitmap:n,metrics:DF({},e.metrics)}}let Wj=class to{constructor(e){this.options=e||{},this.$t={},this.Rt=new Nj(256,(function(){}));const n=document.createElement("canvas");this.ctx=n.getContext("2d",{willReadFrequently:!0})}getIcons(e,n){if(!e||!Object.keys(e).length)return void n(null,{icons:null});const i=Object.keys(e),o={},s=[];let a=0,h=0;const l=this;function c(e,i){o[e]=l.Wt(e,i),o[e]&&"error"!==o[e]?s.push(o[e].data.data.buffer):delete o[e],h++,h===a&&n(null,{icons:o,buffers:s})}function A(e){const n=l.$t[e.url];for(let i=0;i<n.length;i++)n[i].call(e,e.url,e.size);delete l.$t[e.url]}function f(){const e=l.ctx;let n,i;try{n=this.width,i=this.height,this.size[0]=n,this.size[1]=i,l.Xt(null,this.size),n=this.size[0],i=this.size[1];const o=e.canvas;o.width=n,o.height=i,e.imageSmoothingEnabled=!1,e.drawImage(this,0,0,n,i);const s=e.getImageData(0,0,o.width,o.height).data;l.Yt(this.url,s,o.width,o.height)}catch(e){console.warn(e)}A(this)}function d(e){console.warn(`failed loading icon(${this.index}) at "${this.url}"`),console.warn(e),l.options.iconErrorUrl?this.src=l.options.iconErrorUrl:(l.Yt(this.url),A(this))}const p=this.options.urlModifier;let g,v=!1;for(let n=0;n<i.length;n++){const h=i[n],l=e[h];this.Xt(h,l);const A=this.Wt(h,l);if(A&&"error"!==A){o[h]=this.Wt(h,l);continue}if("error"===A)continue;let w,C=h;if(0===h.indexOf("vector://")&&(w=JSON.parse(h.substring(9)),"path"===w.markerType&&(C=Yo.getMarkerPathBase64(w,w.markerWidth,w.markerHeight))),0===h.indexOf("vector://")&&"path"!==w.markerType){g=g||new pf([0,0]);const{markerFill:e,markerLineColor:n}=w;e&&Array.isArray(e)&&(w.markerFill=qj(e)),n&&Array.isArray(n)&&(w.markerLineColor=qj(n)),delete w.markerHorizontalAlignment,delete w.markerVerticalAlignment,delete w.markerDx,delete w.markerDy,delete w.markerPlacement,delete w.markerFile,w.markerWidth=l[0],w.markerHeight=l[1],g.setSymbol(w);const i=g["_getSprite".trim()]();if(i){const e=i.canvas,n=e.width,a=e.height,l=e.getContext("2d").getImageData(0,0,n,a).data;o[h]={data:{data:new Uint8ClampedArray(l),width:n,height:a},url:h},s.push(o[h].data.data.buffer),this.Yt(h,l,n,a)}}else{if(this.$t[h]){v=!0,a++,this.$t[h].push(c);continue}this.$t[h]=[],this.$t[h].push(c);const e=new Image;e.index=n,e.size=l,e.onload=f,e.onerror=d,e.onabort=d,e.url=h,e.crossOrigin="Anonymous",v=!0,a++,e.src=p&&p(C)||C}}v||n(null,{icons:o,buffers:s})}qt(e,n,i){const o=this.Rt.get(e);return o&&"error"!==o&&o.data.width>=n&&o.data.height>=i}Yt(e,n,i,o){this.qt(e,i,o)||this.Rt.add(e,n?{data:{data:n,width:i,height:o},url:e}:"error")}Wt(e,n){if(!this.qt(e,n[0],n[1]))return null;const i=this.Rt.get(e);return i?"error"===i?i:{data:{data:new Uint8ClampedArray(i.data.data),width:i.data.width,height:i.data.height},url:i.url}:null}Xt(e,n){if(!n[0]||!n[1])return;const i=this.options.maxSize||2048;let[o,s]=n;const a=o/s;if(e){const n=this.Rt.get(e);if(n&&"error"!==n){const{width:e,height:i}=n.data;e>o&&(o=e),i>s&&(s=i)}}o>i&&(s=i/a,o=i),s>i&&(o=i*a,s=i),n[0]=Math.floor(o),n[1]=Math.floor(s)}};function qj(e){return 3===e.length&&e.push(1),e.reduce(((e,n,i)=>e+(i<3?255*n+",":n+")")),"rgba(")}var Zj=Object.freeze({__proto__:null,calculateSignedArea:gF,clipPolygon:Oj,convertGeometry:RF,convertRTLText:ZH,generatePickingIndiceIndex:bF,getFeaAltitudeAndHeight:yF,getIndexArrayType:SF,getPosArrayType:IF,getUnsignedArrayType:EF,packPosition:WF,unpackPosition:QF});const Qj={},Xj={},Yj=[];function Jj(e,n){if(!e)return null;var i=!1;if(Array.isArray(e)){var o,s=[];for(let a=0;a<e.length;a++)(o=Jj(e[a],n))?(s.push(o),i=!0):s.push(e[a]);return i?s:e}var a={__fn_types_loaded:!0};const h=[];for(const n in e)BF(e,n)&&h.push(n);const l=function(e){Object.defineProperty(a,e,{get:function(){return this["__fn_"+e]||(this["__fn_"+e]=RD(this["_"+e])),this["__fn_"+e].apply(this,n())},set:function(n){this["_"+e]=n},configurable:!0,enumerable:!0})},c={},A=function(e,i){Object.defineProperty(a,e,{get:function(){this["__fn_"+e]||(this["__fn_"+e]=ZB(this["_"+e],i));const o=n()[0];c.zoom=o;try{return this["__fn_"+e].evaluateWithoutErrorHandling(c,Qj,Xj,null,Yj)}catch(e){return null}},set:function(n){this["_"+e]=n},configurable:!0,enumerable:!0})};for(let n=0,o=h.length;n<o;n++){const o=h[n];if(ED(e[o]))i=!0,a["_"+o]=e[o],l(o);else if(QB(e[o])){i=!0;const n=$B(o);a["_"+o]=e[o],A(o,n)}else a[o]=e[o]}return i?a:e}const Kj={polygonPatternFile:1,markerFile:1,markerPlacement:1,markerSpacing:1,textName:1,textFaceName:1,textPlacement:1,textSpacing:1,lineJoin:1,lineCap:1,linePatternFile:1},$j={visible:1,textHorizontalAlignment:1,textVerticalAlignment:1,textWrapWidth:1,markerHorizontalAlignment:1,markerVerticalAlignment:1},tU={lineDasharray:1,topPolygonFill:1,bottomPolygonFill:1};Object.assign($j,Kj),Object.assign(tU,Kj);let eU=0;function nU(){return eU++}const iU="function"==typeof Object.assign;function rU(e,...n){if(iU)return Object.assign(e,...n),e;for(let i=0;i<n.length;i++){const o=n[i];for(const n in o)e[n]=o[n]}return e}function oU(e){return!lU(e)&&("string"==typeof e||null!==e.constructor&&e.constructor===String)}function sU(e){return"number"==typeof e&&!isNaN(e)}function aU(e){return!lU(e)&&("function"==typeof e||null!==e.constructor&&e.constructor===Function)}function hU(e){return!Array.isArray(e)&&"object"==typeof e&&!!e}function lU(e){return null==e}function uU(e){for(let n=1;n<arguments.length;n++){const i=arguments[n];if(i)for(let n=0,o=i.length;n<o;n++)e.push(i[n])}return e.length}function cU(e){return ED(e)&&e.property}function AU(e,n){return Object.prototype.hasOwnProperty.call(e,n)}function fU(e,n){let i;if(n.altitudeToPoint){i=n.altitudeToPoint(100,e);const o=n.options.heightFactor;o&&1!==o&&(i/=o)}else i=n.distanceToPointAtRes(100,0,e).x;return i/100/100}function dU(e,n,i){for(let o=0;o<e.length;o++){const s=e[o],a=rU({},s),{renderPlugin:h}=s,l=rU({},h);l.sceneConfig&&!Object.keys(l.sceneConfig).length&&delete l.sceneConfig;let c=-1;for(let e=i.length-1;e>=0;e--)if(BT(l,i[e])){c=e;break}c<0&&(c=i.length,i.push(l)),a.renderPlugin=c,n.push(a)}}const pU="function"==typeof fetch&&"function"==typeof AbortController,gU={jsonp:function(e,n){const i="_maptalks_jsonp_"+nU();e.match(/\?/)?e+="&callback="+i:e+="?callback="+i;let o=document.createElement("script");return o.type="text/javascript",o.src=e,window[i]=function(e){n(null,e),document.getElementsByTagName("head")[0].removeChild(o),o=null,delete window[i]},document.getElementsByTagName("head")[0].appendChild(o),this},get:function(e,n,i){if(aU(n)){const e=i;i=n,n=e}(n=n||{}).method&&(n.method=n.method.toUpperCase());const o="POST"===n.method;if(pU){const o=new AbortController,s=n;s.signal=o.signal,s.referrerPolicy=s.referrerPolicy||"origin",s.method=s.method||"GET";const a=new Request(e,s);return n.returnJSON&&a.headers.set("Accept","application/json"),fetch(a).then((o=>{const s=this.Jt(o,n.returnJSON,n.responseType);s.message?(s.url=e,i(s)):s.then((e=>{i(null,"arraybuffer"===n.responseType?{data:e,cacheControl:o.headers.get("Cache-Control"),expires:o.headers.get("Expires"),contentType:o.headers.get("Content-Type")}:e)})).catch((n=>{n.code&&n.code===DOMException.ABORT_ERR||(console.error("Fetch error:",e,n),i(n))}))})).catch((n=>{n.code&&n.code===DOMException.ABORT_ERR||(console.error("Fetch error:",e,n),i(n))})),o}{const s=gU.Kt(i);if(s.open(n.method||"GET",e,!0),n){for(const e in n.headers)s.setRequestHeader(e,n.headers[e]);s.withCredentials="include"===n.credentials,n.responseType&&(s.responseType=n.responseType)}return s.send(o?n.body:null),s}},Jt:(e,n,i)=>200!==e.status?{status:e.status,statusText:e.statusText,message:`incorrect http request with status code(${e.status}): ${e.statusText}`}:"arraybuffer"===i?e.arrayBuffer():n?e.json():e.text(),Zt:function(e,n){return function(){4===e.readyState&&(200===e.status?"arraybuffer"===e.responseType?0===e.response.byteLength?n({status:200,statusText:e.statusText,message:"http status 200 returned without content."}):n(null,{data:e.response,cacheControl:e.getResponseHeader("Cache-Control"),expires:e.getResponseHeader("Expires"),contentType:e.getResponseHeader("Content-Type")}):n(null,e.responseText):n({status:e.status,statusText:e.statusText,message:`incorrect http request with status code(${e.status}): ${e.statusText}`}))}},Kt:function(e){let n;try{n=new XMLHttpRequest}catch(e){try{n=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{n=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}}return n.onreadystatechange=gU.Zt(n,e),n},getArrayBuffer(e,n,i){if(aU(n)){const e=i;i=n,n=e}return n||(n={}),n.responseType="arraybuffer",gU.get(e,n,i)},getJSON:function(e,n,i){if(aU(n)){const e=i;i=n,n=e}const o=function(e,n){const o="string"==typeof n?JSON.parse(n):n||null;i(e,o)};return n&&n.jsonp?gU.jsonp(e,o):((n=n||{}).returnJSON=!0,gU.get(e,n,o))}},mU=["GeoJSONVectorTileLayer"];class To extends Nm.Actor{constructor(e,n){super(e);const i=n.getMap().id;this.Qt=n,this.te=i,this.ee="vt_"+nU();const o=n.getJSONType();this.ne=mU.indexOf(o)>=0,this.ie={},this.re=new Wj({iconErrorUrl:n.options.iconErrorUrl,maxSize:n.options.maxIconSize,urlModifier:e=>{const i=n.getURLModifier();return i&&i(e)||e}});const s=!n.getRenderer().isEnableWorkAround("win-intel-gpu-crash");this.se=new Gj((e=>{n.getMap().getRenderer().callInNextFrame(e)}),n.options.glyphSdfLimitPerFrame,s)}initialize(e){e(null)}addLayer(e){const n=this.Qt,i=n.getWorkerOptions()||{},o=this.ee,s=n.getJSONType(),a={mapId:this.te,layerId:o,command:"addLayer",params:{type:s,options:i}};this.ne?(void 0===this.ie[o]&&(this.ie[o]=this.getDedicatedWorker()),this.send(a,null,e,this.ie[o])):this.broadcast(a,null,e)}abortTile(e,n){const i=this.ee,o={mapId:this.te,layerId:i,command:"abortTile",params:{url:e}};this.ne?(void 0===this.ie[i]&&(this.ie[i]=this.getDedicatedWorker()),this.send(o,null,n,this.ie[i])):this.broadcast(o,null,n)}removeLayer(e){const n=this.ee,i={mapId:this.te,layerId:n,command:"removeLayer"};this.ne?(void 0!==this.ie[n]&&this.send(i,null,e,this.ie[n]),delete this.ie[n]):this.broadcast(i,null,e)}updateStyle(e,n){const i=this.ee,o={mapId:this.te,layerId:i,command:"updateStyle",params:e};this.ne?void 0!==this.ie[i]&&this.send(o,null,n,this.ie[i]):this.broadcast(o,null,n)}updateOptions(e,n){const i=this.ee,o={mapId:this.te,layerId:i,command:"updateOptions",params:e};this.ne?void 0!==this.ie[i]&&this.send(o,null,n,this.ie[i]):this.broadcast(o,null,n)}loadTile(e,n){const i=rU({},e);i.tileInfo=function(e){const n={};for(const i in e)null!=e[i]&&(n[i]=e[i].toJSON?e[i].toJSON():e[i]);return n}(e.tileInfo);const o=this.ee,s={mapId:this.te,layerId:o,command:"loadTile",params:i},{x:a,y:h}=e.tileInfo;this.send(s,null,n,void 0===this.ie[o]?this.workers[(a+h)%this.workers.length].id:this.ie[o])}remove(){super.remove(),this.ie={}}fetchIconGlyphs({icons:e,glyphs:n},i){this.se.getGlyphs(n,((n,o)=>{if(n)throw n;const s=o.buffers||[];this.re.getIcons(e,((e,n)=>{if(e)throw e;n.buffers&&n.buffers.length&&s.push(...n.buffers),i(null,{icons:n.icons,glyphs:o.glyphs},s)}))}))}setData(e,n){const i=this.ee;this.send({mapId:this.te,layerId:i,command:"setData",params:{data:e}},null,n,this.ie[i])}oe(e){return e.id}}const yU={},vU={collision:!0,fading:!1,fadingDuration:224,fadeInDelay:600,fadeOutDelay:100,uniquePlacement:!1,depthFunc:"always"};let _U=class Co{constructor(e,n,i){this.ae=e,this.le=n,this.he=i||[0,1,0]}draw(e,n,i,o,s){if(this.ue||this.ce(),!this.fe){this.fe=this.ae.buffer(xU(o));this.de=this.ae.buffer(bU(o,o/i))}if(o!==this.pe){const e=o/i;this.fe(xU(o)),this.de(bU(o,e))}this.pe=o;let a=this.me;if(!a){const e=this.le.getDevicePixelRatio()>1?2:1;a=this.me=document.createElement("canvas"),a.width=512*e,a.height=64*e;const n=a.getContext("2d");n.font="36px monospace",n.scale(e,e),this.ye=this.ae.texture({width:a.width,height:a.height,data:a})}const h=a.getContext("2d");h.clearRect(0,0,a.width,a.height),h.fillStyle=`rgba(${this.he.map((e=>255*e)).join()})`,h.fillText(e,20,36),this.ye({width:a.width,height:a.height,data:a}),this.ue({transform:n,data:this.fe,texData:this.ge,debugLine:1,primitive:"lines",framebuffer:s||null,image:this.ye,count:8}),this.ue({transform:n,data:this.de,texData:this.ge,debugLine:0,primitive:"triangle strip",framebuffer:s||null,image:this.ye,count:4})}delete(){this.ye&&(this.ye.destroy(),delete this.ye),this.ge&&(this.ge.destroy(),delete this.ge),this.fe&&(this.fe.destroy(),this.de.destroy(),delete this.fe,delete this.de),this.ue&&(this.ue.destroy(),delete this.ue)}ce(){this.ge=this.ae.buffer(new Uint8Array([0,0,0,1,1,0,1,1,0,0,0,1,1,0,1,1])),this.ue=this.ae({vert:"\n                attribute vec2 aPosition;\n                attribute vec2 aTexCoord;\n                uniform mat4 transform;\n\n                varying vec2 vTexCoord;\n                void main()\n                {\n                    gl_Position = transform * vec4(aPosition, 0.0, 1.0);\n                    vTexCoord = aTexCoord;\n                }\n            ",frag:"\n                precision mediump float;\n                uniform sampler2D uImage;\n                uniform vec3 uColor;\n                uniform float uOpacity;\n                uniform float uDebugLine;\n\n                varying vec2 vTexCoord;\n\n                void main()\n                {\n                    if (uDebugLine == 1.) {\n                        gl_FragColor = vec4(uColor, 1.0) * uOpacity;\n                    } else {\n                        gl_FragColor = texture2D(uImage, vTexCoord) * uOpacity;\n                    }\n                    gl_FragColor *= gl_FragColor.a;\n                }\n            ",attributes:{aPosition:this.ae.prop("data"),aTexCoord:this.ae.prop("texData")},uniforms:{transform:this.ae.prop("transform"),uColor:this.he,uOpacity:1,uDebugLine:this.ae.prop("debugLine"),uImage:this.ae.prop("image")},count:this.ae.prop("count"),primitive:this.ae.prop("primitive"),depth:{enable:!1,mask:!1},blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"},stencil:{enable:!1},viewport:{x:0,y:0,width:()=>this.le.getRenderer().canvas.width,height:()=>this.le.getRenderer().canvas.height},framebuffer:this.ae.prop("framebuffer")})}};function xU(e){return new Uint16Array([0,0,0,e,0,e,e,e,e,e,e,0,e,0,0,0])}function bU(e,n){return new Uint16Array([0,e-64*n,0,e,512*n,e-64*n,512*n,e])}const wU=new Uint8Array([0,0,0,1,1,0,1,0,0,1,1,1]),CU=[];class Ro{constructor(e,n,i){this.ae=e,(this.ve=new Lw({aPosition:wU},null,wU.length/2,{positionSize:2})).generateBuffers(e),this.xe=new kC,this.be=[],this.we=0,this.Ae=n,this.le=i,this.ce(e)}start(){this.we=0,this.xe.clear()}add(e,n,i){const o=this.Me(i);o.setUniform("ref",e),$v(CU,n,n,1);const s=o.localTransform;Rv(s,CU),Zv(s,i,s),o.setLocalTransform(s),this.xe.addMesh(o)}render(e){this._e.render(this.Se,{projViewMatrix:this.le.projViewMatrix},this.xe,e)}Me(){const e=this.we++;return this.be[e]||(this.be[e]=new bC(this.ve)),this.be[e]}ce(e){const n=this.Ae,i={viewport:{x:0,y:0,width:()=>n.width,height:()=>n.height},stencil:{enable:!0,mask:255,func:{cmp:"always",ref:(e,n)=>n.ref,mask:255},op:{fail:"replace",zfail:"replace",zpass:"replace"}},depth:{enable:!0,func:"always",mask:!1},colorMask:[!1,!1,!1,!1]};this.Se=new eP({vert:"\n#define SHADER_NAME TILE_STENCIL_VERT\nattribute vec2 aPosition;\nuniform mat4 projViewModelMatrix;\n\nvoid main()\n{\n    gl_Position = projViewModelMatrix * vec4(aPosition, 0.0, 1.0);\n}\n",frag:"\n#define SHADER_NAME TILE_STENCIL_FRAG\nvoid main()\n{\n    gl_FragColor = vec4(1.0, 0.0, 0.0, 0.1);\n}\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(e,n){const i=[];return Cv(i,n.projViewMatrix,n.modelMatrix),i}}],extraCommandProps:i}),this._e=new PC(e)}remove(){this.ve.dispose();for(let e=0;e<this.be.length;e++)this.be[e].dispose();this.be.length=0,this.Se.dispose()}}const PU="__fea_idx",MU=-999999,TU=new Float32Array([-1e12])[0],SU="maptalks_ombb",IU=(PU+"").trim();function EU(e,n,i,o,s,a){const h={};if(function(e){if(!e)return!1;for(const n in e)if(null!=e[n])return!0;return!1}(e))for(let l=0,c=(n||e).length;l<c;l++){let c=n?e[n[l]]:e[l];"id"===s.options.features&&s.getFeature&&(c=s.getFeature(c),c.layer=i),s instanceof Qp&&(c=LU(c,a)),h[n?n[l]:c[IU]]={feature:c,symbol:o}}return h}const OU="__original_properties",RU="__external_properties",DU={get:function(e,n){return n in e?e[n]:e[OU][n]||e[RU]&&e[RU][n]},has:function(e,n){return n in e||n in e[OU]||e[RU]&&n in e[RU]}},kU={};function LU(e,n){const i=e.properties;if(i&&i[OU])return e;n&&(e=rU({},e)),e.customProps=e.customProps||{};const o=e.customProps;return o.$layer=e.layer,o.$type=e.type,o[OU]=i||kU,e.properties=new Proxy(o,DU),e}function FU(e){for(let n=1;n<arguments.length;n++){const i=arguments[n];for(const n in i)e[n]=i[n]}return e}function NU(e,n,i){return Math.min(i,Math.max(n,e))}function zU(e,n,i){if(e===i||e===n)return e;const o=i-n;return((e-n)%o+o)%o+n}function BU(e){return null==e}function HU(e){return JSON.parse(JSON.stringify(e))}function jU(e,n,i,o,s,a){n in e||Object.defineProperty(e,n,{enumerable:!0,get:function(){const e=BU(i[o])||ED(i[o])?s:i[o];return a?a(e):e}})}const UU=[];function GU(e){for(let n=0;n<e.length;n++)UU[n]=e[n],UU[n]*=255;return 3===e.length&&(UU[3]=255),UU}function VU(e,n=4){return WU.bind(this,e,n)}function WU(e,n,i){if(Array.isArray(i))return 3===i.length&&4===n&&i.push(1),i;if(e&&e[i])return e[i];if(void 0!==i.r&&void 0!==i.g&&void 0!==i.b&&void 0!==i.a)return[i.r,i.g,i.b,i.a];const o=Ck(i).unitArray();return 3===o.length&&4===n&&o.push(1),e&&(e[i]=o),o}function qU(e,n,i,o){if(e.fill)e.fill(n,i,o);else for(let s=i;s<o;s++)e[s]=n}function ZU(e){return"number"==typeof e&&!isNaN(e)}function QU(e){return e&&(e.markerFile||e.markerType)&&void 0!==e.textName}function XU(e,n){return Object.prototype.hasOwnProperty.call(e,n)}function YU(e,n){if(n){let n=e[e.length-1];const i=[n];for(let o=e.length-2;o>=0;o--)e[o]!==n&&(i.push(e[o]),n=e[o]);return i}{let n=e[e[0]];const i=[n];for(let o=1;o<e.length;o++)e[o]!==n&&(i.push(e[o]),n=e[o]);return i}}const JU=new Zh(0,0);function KU(e,n,i,o,s){const a=e.distanceToPointAtRes(n,n,o,i,JU);return s?a.y:a.x}const $U=[],tG=[0,0,0,0],eG=new ee(0,0),nG={color:tG,depth:1,stencil:0},iG=e=>e.isTerrainSkin(),rG=e=>e.isTerrainVector();class ga extends Mm.TileLayerCanvasRenderer{supportRenderMode(){return!0}constructor(e){super(e),this.ke=0,this.ready=!1,this.Pe=1,this.Te={},this.Ie={},this.Fe={}}getTileLevelValue(e,n){if(this.isBackTile(e.id)){const i=e.z,o=5;return i-n>=0?n+o-i:o+(n-i)}return 0}getWorkerConnection(){return this.Ce}getStyleCounter(){return this.Pe}setStyle(){if(this.Oe&&this.Oe.update(),this.Ce){this.Pe++,this.Ee();const e=this.layer.De();e.styleCounter=this.Pe,this.Le=!0,this.Ce.updateStyle(e,(e=>{if(this.Le=!1,e)throw new Error(e);this.Re=!0,this.He(),this.setToRedraw(),this.layer.fire("refreshstyle")}))}else this.He()}Ee(){if(this.ze)for(const e in this.ze){const n=this.ze[e];n&&this.deleteTile(n)}this.ze=this.tilesInView;const e=this.tileCache;for(const n in this.ze){const i=this.ze[n];i&&i.info&&e.getAndRemove(i.info.id)}e.reset(),this.tilesInView={},this.tilesLoading={},this.Te={},this._parentTiles=[],this._childTiles=[],this._tileZoom=void 0}updateOptions(e){this.Ce&&this.Ce.updateOptions(this.layer.getWorkerOptions(),(n=>{if(n)throw new Error(n);e&&(e.features||e.pickingGeometry||e.altitudeProperty)&&(this.clear(),this.Ne(),this.He()),this.setToRedraw()}))}updateSceneConfig(e,n,i){const o=0===e?this.Ve():this.Ue();if(!o||!o[n])return;this.Re=!0;const s=this.layer.De(),a=this.layer.je(e,s);o[n].config=a[n].renderPlugin,o[n].updateSceneConfig({sceneConfig:i}),this.setToRedraw()}updateDataConfig(e,n,i,o){const s=0===e?this.Ve():this.Ue();s&&s[n]&&(this.Re=!0,s[n].updateDataConfig(i,o)?this.setStyle():this.setToRedraw())}updateSymbol(e,n,i){const o=0===e?this.Ve():this.Ue();if(!o||!o[n])return!1;const s=this.layer.De(),a=this.layer.je(e,s),h=o[n];h.style=a[n];const l=h.updateSymbol(i,a[n].symbol);return!l&&hG(i)&&this.setStyle(),this.setToRedraw(),l}needToRedraw(){const e=super.needToRedraw();if(!e){const e=this.Ge();for(let n=0;n<e.length;n++)if(e[n]&&e[n].needToRedraw())return!0}return e}needRetireFrames(){if(this.Re)return!0;const e=this.Ge();for(let n=0;n<e.length;n++)if(e[n]&&e[n].needToRetireFrames())return!0;return!1}isAnimating(){const e=this.getMap().getRenderer(),n=e.getFrameTimestamp&&e.getFrameTimestamp()||e._frameTimestamp;if(this.Be&&(this.$e=n,delete this.Be),this.$e===n)return!0;const i=this.Ge();for(let e=0;e<i.length;e++)if(i[e]&&i[e].isAnimating())return!0;return!1}needToRefreshTerrainTileOnZooming(){const e=this.Ge();for(let n=0;n<e.length;n++)if(e[n]&&e[n].needToRefreshTerrainTileOnZooming())return!0;return!1}We(){return!!(this.canvas&&this.canvas.gl&&this.canvas.gl.wrap)}createContext(){const e=this.canvas.gl&&this.canvas.gl.wrap;if(e)this.gl=this.canvas.gl.wrap(),this.regl=this.canvas.gl.regl;else{const{gl:e,regl:n,attributes:i}=this.Xe(this.canvas);this.gl=e,this.regl=n,this.glOptions=i}if(e&&(this.canvas.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height)),this.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height),this.Ye=new _U(this.regl,this.getMap()),this.qe(),this.Oe=new GroundPainter(this.regl,this.layer),!this.consumeTile){const e=this.getMap().VERSION;throw new Error(`Incompatible version of maptalks: ${e}, upgrade maptalks >= v1.0.0-rc.14`)}}Xe(e){const n=this.layer,i=n.options.glOptions||{alpha:!0,depth:!0,antialias:this.layer.options.antialias};i.preserveDrawingBuffer=!0,i.stencil=!0;const o=this.Je(e,i);return{gl:o,attributes:i,regl:jm({gl:o,attributes:i,extensions:["ANGLE_instanced_arrays","OES_element_index_uint","OES_standard_derivatives"],optionalExtensions:n.options.glExtensions||["OES_vertex_array_object","OES_texture_half_float","OES_texture_half_float_linear","OES_texture_float","OES_texture_float_linear","WEBGL_draw_buffers","EXT_shader_texture_lod","EXT_frag_depth"]})}}qe(){this.Ce||(this.Ce=new To("@maptalks/vt",this.layer)),this.Ce.addLayer(((e,n)=>{this.layer&&(this.ready=!0,this.layer.onWorkerReady(e,n),this.layer.fire("workerready"),this.setToRedraw())}))}Ke(){this.ke++}clearCanvas(){super.clearCanvas(),this.regl&&this.regl.clear({color:tG,depth:1,stencil:0})}isDrawable(){return!0}checkResources(){return $U}_drawTiles(e,n,i,o,s){if(super._drawTiles(e,n,i,o,s),this.ze)if(Object.keys(this.ze).length)for(const e in this.ze){const n=this.ze[e];n&&n.info&&n.info.id&&!this.tileCache.has(n.info.id)&&this._drawTile(n.info,n.image,s)}else this.Ze(),delete this.ze}Ze(){const e=this.Pe,n=[],i=[];for(const i in this.Ie)+i!==e&&(n.push(i),this.Ve(i).forEach((e=>{e.remove()})));for(const n in this.Fe)+n!==e&&(i.push(n),this.Ue(n).forEach((e=>{e.remove()})));for(let e=0;e<n.length;e++)delete this.Ie[n[e]];for(let e=0;e<i.length;e++)delete this.Fe[i[e]]}draw(e,n){this.Qe!==e&&(this.Re=!1,this.tn());const i=this.layer;if(this.prepareCanvas(),!this.ready||!i.ready)return;let o=this.Ie[this.Pe];o||(this.He(),this.tn(),o=this.Ve());const s=this.Ue();i.isDefaultRender()||o.length||s.length?(i.options.collision&&i.clearCollisionIndex(),this.en=e,this.nn=this.rn(this.getMap().getGLRes()),this.sn=n||{},this.an(e),super.draw(e),this.Qe!==e&&this.hn(e),this.un(e),this.Qe=e):this.completeRender()}tn(){this.Ge().forEach(((e,n)=>{e&&(e.renderIndex=n)}))}hn(){const e=this.Ge();this.cn=this.cn||[];let n=0;for(let i=e.length-1;i>=0;i--){const o=e[i];o.isVisible()&&o.hasMesh()&&(this.cn[i]=n,o.needPolygonOffset()&&n++)}this.Oe.isEnable()&&n++,this.dn=n}getFrameTimestamp(){return this.en}drawOnInteracting(e,n,i){this.draw(n,i)}drawOutline(e){(this.pn||this.mn)&&(this.mn?this.paintOutlineAll(e):this.pn.forEach((n=>{this[n[0]](e,...n[1])})))}getAnalysisMeshes(){return this.getShadowMeshes()}getShadowMeshes(){const e=[];return this.yn().forEach((n=>{if(!n)return;if(!this.gn(n))return;const i=n.getShadowMeshes();if(Array.isArray(i))for(let n=0;n<i.length;n++)e.push(i[n])})),e}isForeground(e){return!(!this.vn||!this.vn[e.properties.tile.id])}xn(e){const n=this.layer;let i=n._getTileZoom(this.getMap().getZoom());const o=n.getMinZoom(),s=n.getMaxZoom();return i=Yo.clamp(i,o,s),i-e.properties.tile.z}isTileNearCamera(e){return this.xn(e)<=1}isBackTile(e){return!(!this.bn||!this.bn[e])}loadTileQueue(e){this.Le||super.loadTileQueue(e)}loadTile(e){const{url:n}=e,i=this.Te[n];if(i)i.keys[e.id]||(i.tiles.push(e),i.keys[e.id]=1);else{const i=this.getMap(),o=eG.set(e.extent2d.xmin,e.extent2d.ymax),s=i.pointAtResToCoord(new ee(o),e.res),a=[KU(i,1,s,e.res)/100,KU(i,1,s,e.res,1)/100],h=this.getCentimeterToPoint(e.z),l=this.getTileGLScale(e.z);this.Te[n]={keys:{},tiles:[e]},this.Te[n].keys[e.id]=1;const c=window&&window.location.href;this.Ce.loadTile({tileInfo:{res:e.res,x:e.x,y:e.y,z:e.z,url:e.url,id:e.id,extent2d:e.extent2d},glScale:l,zScale:this.nn,centimeterToPoint:a,verticalCentimeterToPoint:h,fetchOptions:this.layer.options.fetchOptions,styleCounter:this.Pe,referrer:c,workerCacheIndex:this.ke},this.wn.bind(this,n))}return{}}getTileGLScale(e){const n=this.getMap();return this.layer.getSpatialReference().getResolution(e)/n.getGLRes()}getCentimeterToPoint(e){const n=this.getMap();return fU(this.layer.getSpatialReference().getResolution(e),n)}getRenderedFeatures(){const e=[],n=this.tileCache.keys();for(let i=0;i<n.length;i++){const o=this.tileCache.get(n[i]);if(!o||!o.info||!o.image)continue;const{info:s,image:a}=o,h=uG(a);e.push({tile:{id:s.id,x:s.x,y:s.y,z:s.z,url:s.url},current:!!this.tilesInView[s.id],features:h})}return e}wn(e,n,i){if(this.setToRedraw(),!this.Te[e])return;if(i&&i.canceled)return;const o=this.layer,s=o.isDefaultRender(),{tiles:a}=this.Te[e];if(delete this.Te[e],n){if(n.status&&(404===n.status||204===n.status))for(let e=0;e<a.length;e++){this.onTileError(yU,a[e])}return}if(!i){for(let e=0;e<a.length;e++){this.consumeTile({An:!0},a[e])}return}if(i.styleCounter!==this.Pe)return;let h=!1;const l=i.features,c=[];for(let e=0;e<i.data.length;e++){const n=i.data[e];if(!n||!n.data||!n.styledFeatures.length)continue;const{isUpdated:o,layer:s}=this.Mn(0,e,n,l,c);c.push(s),o&&(h=o)}for(let e=0;e<i.featureData.length;e++){const n=i.featureData[e];n&&n.data&&n.styledFeatures.length&&this.Mn(1,e,n,l)}h&&o._n();const A=this.layer.getDataSchema(a[0].z);if(this.Sn(A,i.schema),delete i.features,s&&i.data.length!==c.length){const e=i.data;i.data=[];for(let n=0;n<e.length;n++)e[n]&&e[n].features&&i.data.push(e[n])}i.layers=c;for(let e=0;e<a.length;e++){const n=a[e];if(0===e&&o.options.debugTileData){const{x:e,y:i,z:s}=n;console.log("tile",{layerId:o.getId(),x:e,y:i,z:s,layers:aG(Object.values(l))})}const s=0===e?i:oG(i);for(let e=0;e<s.data.length;e++){if(!s.data[e])continue;const i=s.data[e].features;for(const e in i)i[e].tile=n}n.extent=s.extent,this.kn||(this.kn=n.extent),s.features=Object.values(l),s.styleCounter=i.styleCounter,this.onTileLoad(s,n)}this.layer.fire("datareceived",{url:e})}Mn(e,n,i,o){const{style:s,isUpdated:a}=this.Pn(e,n,i.data),h=this.layer,l=h.isDefaultRender(),c=EU(o,i.styledFeatures,n,s.symbol,h,!(!h.getData||!h.getData()));delete i.styledFeatures,i.features=c;let A=i.data;return Array.isArray(A)&&(A=A[0]),{isUpdated:a,layer:l?{layer:A.layer,type:A.type}:null}}Sn(e,n){for(const i in n){e[i]||(e[i]={types:n[i].types,properties:{}});const o=n[i].properties,s=e[i].properties;for(const e in o)(!s[e]||s[e]&&"object"!==o[e]&&"object"===s[e])&&(s[e]=o[e])}}Pn(e,n,i){Array.isArray(i)&&(i=i[0]);const o=this.layer;let s,a=!1;if(o.isDefaultRender()&&0===e){let e=this.Tn;e||(e=this.Tn={});const n=i.layer,o=i.type;e[n]||(e[n]=[]);const h=("plugin_"+o).trim();e[n][h]?s=e[n][h]:(s=this.In(o),s.filter=i.filter,e[n].push(s),e[n][h]=s,a=!0)}else{const h=o.De(),l=o.je(e,h),c=this.Ve();if(s=l[n],!s.renderPlugin){a=!0;const{plugin:e,symbol:o,renderPlugin:h}=this.In(i.type);c[n]=e,s.symbol=o,s.renderPlugin=h}}return{style:s,isUpdated:a}}Ge(e){const n=e&&e.style;let i=this.Ve(n)||[];this.layer.isDefaultRender()&&this.Tn&&(i=[],e?e.layers&&e.layers.forEach((e=>{if(!e)return;const n=("plugin_"+e.type).trim();i.push(this.Tn[e.layer][n].plugin)})):Object.keys(this.Tn).forEach((e=>{for(let n=0;n<this.Tn[e].length;n++)i.push(this.Tn[e][n].plugin)})));const o=this.Ue(n);return o&&o.length&&(i=i.slice(),uU(i,o)),i}yn(){if(this.layer.isDefaultRender()&&this.Tn){const e=[];return Object.keys(this.Tn).forEach((n=>{for(let i=0;i<this.Tn[n].length;i++)e.push(this.Tn[n][i].plugin)})),e}const e=[];for(const n in this.Ie)e.push(...this.Ie[n]);for(const n in this.Fe)e.push(...this.Fe[n]);return e}Ve(e){return lU(e)&&(e=this.Pe),this.Ie[e]||$U}Ue(e){return lU(e)&&(e=this.Pe),this.Fe[e]||$U}an(e,n){const i=!!this.Fn,o=this.layer.isDefaultRender()&&this.Tn,s=this.sn;this.yn().forEach(((a,h)=>{if(!a||n&&!n(a))return;if(!this.gn(h))return;const l={regl:this.regl,layer:this.layer,symbol:o?a.defaultSymbol:a.style&&a.style.symbol,gl:this.gl,isRenderingTerrain:i,sceneConfig:a.config?a.config.sceneConfig:null,dataConfig:a.config?a.config.dataConfig:null,pluginIndex:h,timestamp:e};s&&rU(l,s),a.startFrame(l)}))}un(e){const n=this.sn,i=n.renderMode,o=n&&n.renderTarget&&n.renderTarget.fbo,s=this.getMap().cameraPosition,a=this.yn(),h=!!this.Fn,l=!n.timestamp||n.isFinalRender;a.forEach(this.layer.options.collision&&!n.isPostProcess?n=>{if(!this.gn(n)||!n.hasMesh())return;if(i&&"default"!==i&&!n.supportRenderMode(i))return;if(h&&!rG(n))return;const o=this.Cn(n,0,s,e);n.prepareRender(o),n.updateCollision(o)}:n=>{if(!this.gn(n)||!n.hasMesh())return;if(i&&"default"!==i&&!n.supportRenderMode(i))return;if(h&&!rG(n))return;const o=this.Cn(n,0,s,e);n.prepareRender(o)});let c=!1;if(this.Qe!==n.timestamp&&!h){const n=this.layer.getPolygonOffset()+this.layer.getPolygonOffsetCount(),i=this.Cn(null,n,s,e);i.offsetFactor=n,i.offsetUnits=n,this.Oe.paint(i)}a.forEach(((n,a)=>{if(!this.On(n))return;if(i&&"default"!==i&&!n.supportRenderMode(i))return;if(h&&!rG(n))return;this.regl.clear({stencil:255,framebuffer:o});const l=this.Cn(n,this.cn[a]||0,s,e);n.painter&&n.painter.isEnableTileStencil(l)&&this.En(o,n.painter);const A=n.endFrame(l);A&&A.redraw&&this.setToRedraw(),c=!0})),c&&this.layer.fire("canvasisdirty"),l&&this.Dn()}getPolygonOffsetCount(){return this.dn||0}Dn(){if(this.layer.options.debug){const e=this.sn,n=[],i=this.getMap().projViewMatrix;for(const o in this.tilesInView){const s=this.tilesInView[o].info,a=this.tilesInView[o].image;if(a.An)continue;const h=s.transform,l=a.extent,c=e&&e.renderTarget;if(h&&l){const e=this.getDebugInfo(s.id),o=Cv(n,i,h),a=this.layer.getTileSize().width;this.Ye.draw(e,o,a,l,c&&c.fbo)}}}}On(e){if(!e)return!0;const n=this.sn,i=this.gn(e),o=n&&n.states&&n.states.includesChanged,s=this.Ln(e.painter.scene.getMeshes());return i&&(o||s)?s?2:1:0}Cn(e,n,i,o){const s=!!this.Fn,a=s&&e&&iG(e),h={regl:this.regl,layer:this.layer,gl:this.gl,isRenderingTerrain:s,isRenderingTerrainSkin:a,sceneConfig:e&&e.config.sceneConfig,pluginIndex:e&&e.renderIndex,polygonOffsetIndex:n,cameraPosition:i,timestamp:o},l=this.sn;return l&&rU(h,l),h}Ln(e){if(!e)return!1;const n=this.sn&&this.sn.sceneFilter;return n?e.filter((e=>n(e)||e.properties.hlBloomMesh&&n(e.properties.hlBloomMesh))).length>0:e.length>0}En(e,n){const i=n.isUniqueStencilRefPerTile(),o=this.getCurrentTileZoom();let s=this.Rn;s||(s=this.Rn=new Ro(this.regl,this.canvas,this.getMap())),s.start();const{tiles:a}=this.Hn;let{parentTiles:h,childTiles:l}=this.Hn,c=1;l=l.sort(sG);for(let e=0;e<l.length;e++){const n=i?c:this.getTileLevelValue(l[e].info,o);this.zn(l[e].info,n),c++}h=h.sort(sG);for(let e=0;e<h.length;e++){const n=i?c:this.getTileLevelValue(h[e].info,o);this.zn(h[e].info,n),c++}const A=a.sort(sG);for(let e=A.length-1;e>=0;e--){const n=i?c:this.getTileLevelValue(A[e].info,o);this.zn(A[e].info,n),c++}s.render(e)}zn(e,n){const i=eG.set(e.extent2d.xmin,e.extent2d.ymax),o=e.extent||this.kn||8192,s=e.transform=e.transform||this.calculateTileMatrix(i,e.z,o);e.stencilRef=n,this.Rn.add(n,o,s)}onDrawTileStart(e){super.onDrawTileStart(e);const{tiles:n,childTiles:i,parentTiles:o}=e;this.vn={},this.bn={};for(let e=0;e<n.length;e++)this.vn[n[e].info.id]=1;for(let e=0;e<i.length;e++)this.bn[i[e].info.id]=1;for(let e=0;e<o.length;e++)this.bn[o[e].info.id]=1;this.Hn=e}isEnableTileStencil(){if(this.layer.options.altitude)return!1;const e=this.Ge();for(let n=0;n<e.length;n++)if(e[n]&&e[n].painter&&!e[n].painter.isOnly2D())return!1;return!0}setTerrainHelper(e){this.Fn=e}getTerrainHelper(){return this.Fn}drawTileOnTerrain(...e){ga.prototype.drawTile.call(this,...e)}createTerrainTexture(e){const n=this.layer.getTileSize().width,i=2*n,o=2*n,s=e.texture({min:"linear",mag:"linear",type:"uint8",width:i,height:o});this.Nn||(this.Nn=e.renderbuffer({width:i,height:o,format:"depth24 stencil8"}));const a={width:i,height:o,colors:[s],colorFormat:"rgba",ignoreStatusCheck:!0};a.depthStencil=this.Nn;const h=e.framebuffer(a);return h.colorTex=s,h}deleteTerrainTexture(e){e.destroy(),e.colorTex&&(e.colorTex.destroy(),delete e.colorTex)}renderTerrainSkin(e,n,i){const o=this.Qe,s=this.sn,a=this.layer.getTileSize().width;this.an(o);for(let n=0;n<i.length;n++){const o=i[n].texture;this.sn={renderTarget:{fbo:o}},nG.framebuffer=o,e.clear(nG),this.sn.viewport=lG(a),this.Vn(i[n].tile,o)}this.Un(i),this.sn=s}Vn(e){const{info:n,image:i}=e;this.drawTile(n,i,iG)}Un(e){const n=this.yn(),i=this.getMap().cameraPosition,o=this.Qe||0;n.forEach(this.layer.options.collision?e=>{if(!this.gn(e)||!e.hasMesh())return;if(!iG(e)||!this.layer.options.awareOfTerrain)return;const n=this.Cn(e,0,i,o);n.isRenderingTerrainSkin=!0,e.prepareRender(n),e.updateCollision(n)}:e=>{if(!this.gn(e)||!e.hasMesh())return;if(!iG(e)||!this.layer.options.awareOfTerrain)return;const n=this.Cn(e,0,i,o);n.isRenderingTerrainSkin=!0,e.prepareRender(n)}),n.forEach(((n,i)=>{if(!this.On(n)||!iG(n))return;for(let n=0;n<e.length;n++){this.regl.clear({stencil:255,framebuffer:e[n].texture})}const o=this.Cn(n,this.cn[i]||0,[0,0,0],this.Qe);o.isRenderingTerrainSkin=!0,n.endFrame(o)}))}drawTile(e,n,i){if(!n.cache)return;const o=!!this.Fn,s=n.cache,a=eG.set(e.extent2d.xmin,e.extent2d.ymax),h=e.extent||this.kn||8192,l=e.transform=e.transform||this.calculateTileMatrix(a,e.z,h),c=e.tileTranslationMatrix=e.tileTranslationMatrix||this.calculateTileTranslationMatrix(a,e.z),A=e.terrainTransform=e.terrainTransform||this.calculateTerrainTileMatrix(a,e.z,h),f=this.sn,d=[];uU(d,n.data),uU(d,n.featureData),this.Ge(n).forEach(((a,h)=>{if(!a||i&&!i(a))return;if(!d[h])return;if(!s[h])return;const p=o&&iG(a),g={regl:this.regl,layer:this.layer,gl:this.gl,sceneConfig:a.config.sceneConfig,pluginIndex:h,tileCache:s[h],tileData:d[h],tileTransform:p?A:l,tileVectorTransform:l,tileTranslationMatrix:c,tileExtent:n.extent,timestamp:this.en,tileInfo:e,tileZoom:this._tileZoom,bloom:this.sn&&this.sn.bloom,isRenderingTerrain:o,isRenderingTerrainSkin:p};p&&f&&f.renderTarget&&(g.renderTarget=f.renderTarget);const v=a.paintTile(g);!this.Re&&(v.retire||v.redraw)&&a.supportRenderMode("taa")&&(this.Re=!0),v.redraw&&this.setToRedraw()})),n&&n.style===this.Pe&&this.jn(e),this.setCanvasUpdated()}Gn(e,n){if(!n.loadTime||n.An)return;let i=n.cache;i||(i=n.cache={});const o=!!this.Fn,s=eG.set(e.extent2d.xmin,e.extent2d.ymax),a=e.transform=e.transform||this.calculateTileMatrix(s,e.z,n.extent),h=e.tileTranslationMatrix=e.tileTranslationMatrix||this.calculateTileTranslationMatrix(s,e.z),l=e.terrainTransform=e.terrainTransform||this.calculateTerrainTileMatrix(s,e.z,e.extent),c=[];uU(c,n.data),uU(c,n.featureData),this.Ge(n).forEach(((s,A)=>{if(!s)return;if(!c[A])return;const f=o&&iG(s),d=this.regl,p=this.gl;i[A]||(i[A]={});const g=s.createTile({regl:d,layer:this.layer,gl:p,sceneConfig:s.config.sceneConfig,pluginIndex:A,tileCache:i[A],tileData:c[A],tileTransform:f?l:a,tileVectorTransform:a,isRenderingTerrain:o,isRenderingTerrainSkin:f,tileTranslationMatrix:h,tileExtent:n.extent,timestamp:this.en,tileInfo:e,tileZoom:this._tileZoom});i[A].geometry&&(n.data[A]=1),!this.Re&&g.retire&&s.supportRenderMode("taa")&&(this.Re=!0)}))}checkTileInQueue(e){return e.styleCounter===this.Pe}pick(e,n,i){const o=[];return this.layer.isVisible()?(this.Ge().forEach((s=>{if(!s)return;if(!this.gn(s))return;const a=s.pick(e,n,i.tolerance);a&&(a.type=s.getType(),o.push(a))})),o):o}deleteTile(e){if(e){if(e.image&&!e.image.An){const n=this.Ve(e.image&&e.image.style);n&&n.forEach(((n,i)=>{n&&n.deleteTile({pluginIndex:i,regl:this.regl,layer:this.layer,gl:this.gl,tileCache:e.image.cache?e.image.cache[i]:{},tileInfo:e.info,tileData:e.image})})),e.image.cache={}}e.info&&(delete e.info.completeTerrainQuery,delete e.info.terrainQueryStatus),super.deleteTile(e)}}abortTileLoading(e,n){n&&n.url&&(this.Ce&&this.Ce.abortTile(n.url),delete this.Te[n.url]),super.abortTileLoading(e,n)}resizeCanvas(e){super.resizeCanvas(e);const n=this.canvas;n&&(!this.pickingFBO||this.pickingFBO.width===n.width&&this.pickingFBO.height===n.height||(this.pickingFBO.resize(n.width,n.height),this.Ge().forEach((e=>{e&&e.resize(n.width,n.height)}))))}onRemove(){this.Rn&&this.Rn.remove(),this.Ce&&(this.Ce.removeLayer((e=>{if(e)throw e})),this.Ce.remove(),delete this.Ce),this.pickingFBO&&(this.canvas.pickingFBO||this.pickingFBO.destroy(),delete this.pickingFBO),this.Ye&&(this.Ye.delete(),delete this.Ye),this.Nn&&(this.Nn.destroy(),delete this.Nn),this.Oe&&(this.Oe.dispose(),delete this.Oe),super.onRemove&&super.onRemove(),this.Ne()}Ne(){this.yn().forEach((e=>{e.remove()})),this.plugins={}}hitDetect(e){if(!this.gl||!this.layer.options.hitDetect)return!1;const n=this.gl,i=new Uint8Array(4);return n.readPixels(e.x,this.canvas.height-e.y,1,1,n.RGBA,n.UNSIGNED_BYTE,i),i[3]>0}He(){const{style:e,featureStyle:n}=this.layer.De(),i=e.map(((e,n)=>{const i=e.renderPlugin;if(!i)return null;if(!i.type)throw new Error("invalid plugin type for style at "+n);const o=this.Bn(i);return o.styleCounter=this.Pe,o.style=e,o})),o=[];n.forEach(((e,n)=>{const i=e.renderPlugin;if(!i)return null;if(!i.type)throw new Error("invalid plugin type for features at "+n);const s=this.Bn(i);return s.style=e,s.styleCounter=this.Pe,o.push(s),s}));const s=this.Pe;return this.Ie[s]=i,this.Fe[s]=o,this.layer.fire("pluginsinited"),(this.$n&&this.$n.size||this.layer.$n)&&(this.layer.$n&&this.layer.Wn(),this.getMap().getRenderer().callInNextFrame((()=>{this.Ge().forEach((e=>{e.highlight(this.$n)}))}))),i}Bn(e){const n=this.layer.constructor.getPlugins()[e.type];if(!n)throw new Error(`Plugin for (${e.type}) is not loaded.`);const i=new n;return i.config=e,i.config.sceneConfig||(i.config.sceneConfig={}),i}Je(e,n){const i=["webgl","experimental-webgl"];let o=null;for(let s=0;s<i.length;++s){try{o=e.getContext(i[s],n)}catch(e){}if(o)break}return o}rn(e){return fU(e,this.getMap())}debugFBO(e,n){const i=document.getElementById(e),o=n.width,s=n.height;i.width=o,i.height=s;const a=i.getContext("2d"),h=this.regl.read({framebuffer:n}),l=s/2|0,c=4*o;for(let e=0;e<h.length;e++)h[e]*=255;const A=new Uint8Array(4*o);for(let e=0;e<l;++e){const n=e*c,i=(s-e-1)*c;A.set(h.subarray(n,n+c)),h.copyWithin(n,i,i+c),h.set(A,i)}const f=new ImageData(o,s);f.data.set(h),a.putImageData(f,0,0)}In(e){let n;switch(e){case"native-line":n={type:"native-line",dataConfig:{type:"native-line",only2D:!0}};break;case"native-point":n={type:"native-point",dataConfig:{type:"native-point",only2D:!0}};break;case"fill":n={type:"fill",dataConfig:{type:"fill",only2D:!0},sceneConfig:{antialias:!0}};break;default:n=null}const i=function(e){switch(e){case"native-point":return{markerFill:"#f00",markerSize:6,markerOpacity:.5};case"native-line":return{lineColor:"#bbb",lineOpacity:.5};case"fill":return{polygonFill:"#76a6f0",polygonOpacity:.8}}return null}(e),o=this.Bn(n);return o.defaultSymbol=i,{plugin:o,symbol:i,renderPlugin:n}}gn(){return!0}isEnableWorkAround(e){return"win-intel-gpu-crash"===e&&this.layer.options.workarounds["win-intel-gpu-crash"]&&function(e){const n=e.getExtension("WEBGL_debug_renderer_info");if(n&&"undefined"!=typeof navigator){const i=e.getParameter(n.UNMASKED_RENDERER_WEBGL),o="Win32"===navigator.platform||"Win64"===navigator.platform;if(i&&i.toLowerCase().indexOf("intel")>=0&&o)return!0}return!1}(this.gl)}getZScale(){return this.nn}outline(e,n){n&&(Array.isArray(n)||(n=[n]),this.pn||(this.pn=[]),this.pn.push(["paintOutline",[e,n]]),this.setToRedraw())}outlineFeatures(e){e&&(Array.isArray(e)||(e=[e]),this.pn||(this.pn=[]),this.pn.push(["paintOutline",[null,e]]),this.setToRedraw())}outlineBatch(e){this.pn||(this.pn=[]),this.pn.push(["paintBatchOutline",[e]]),this.setToRedraw()}outlineAll(){this.mn=!0,this.setToRedraw()}paintOutlineAll(e){const n=this.Ge();for(let i=0;i<n.length;i++)n[i].outlineAll(e)}paintOutline(e,n,i){if(!lU(n)){const o=n,s=this.Ge();if(!s[o]||s[o].painter&&!s[o].painter.isVisible())return;return void s[o].outline(e,i)}const o=this.Ge();for(let n=0;n<i.length;n++){const s=i[n];for(let n=0;n<o.length;n++)o[n].style&&o[n].style.id===s&&o[n].outline(e,[s])}}paintBatchOutline(e,n){const i=this.Ge();!i[n]||i[n].painter&&!i[n].painter.isVisible()||i[n].outlineAll(e)}cancelOutline(){delete this.pn,delete this.mn,this.setToRedraw()}setZIndex(){return this.setToRedraw(),this.Re=!0,super.setZIndex.apply(this,arguments)}consumeTile(e,n){if(this.jn(n),super.consumeTile(e,n),"transient"===this.layer.options.features&&e.data){for(let n=0;n<e.data.length;n++){if(!e.data[n])continue;const i=e.data[n].features;if(i)for(const e in i){const n=i[e]&&i[e].feature;n&&(n.fnTypeProps?n.customProps[OU]=n.fnTypeProps:i[e]=null)}}this.layer.fire("_transientfeature",{tileImage:e})}e&&e.features&&(e.features=[]),this.Gn(n,e)}onTileError(e,n){this.jn(n),super.onTileError(e,n)}jn(e){const{id:n}=e;if(this.ze&&this.ze[n]){this.deleteTile(this.ze[n]),delete this.ze[n]}}highlight(e){if(this.$n||(this.$n=new Map),Array.isArray(e))for(let n=0;n<e.length;n++)lU(e[n].name)&&!lU(e[n].id)&&(e[n]=rU({},e[n]),e[n].name=e[n].id),this.$n.set(e[n].name,e[n]);else lU(e.name)&&!lU(e.id)&&((e=rU({},e)).name=e.id),this.$n.set(e.name,e);this.Ge().forEach((e=>{e.highlight(this.$n)})),this.Be=!0}cancelHighlight(e){if(this.$n){if(Array.isArray(e))for(let n=0;n<e.length;n++)this.$n.delete(e[n]);else this.$n.delete(e);this.Ge().forEach((e=>{e.highlight(this.$n)})),this.Be=!0}}cancelAllHighlight(){this.$n&&(delete this.$n,this.Ge().forEach((e=>{e.cancelAllHighlight()})),this.Be=!0)}Xn(){const e=this.layer.options.opacity;return this.We()?lU(e)?1:e:1}}function oG(e){let n;Array.isArray(e.data)?(n=[],uU(n,e.data)):(n={},rU(n,e.data));const i=rU({},e);return i.data=n,i}function sG(e,n){return n.info.z-e.info.z}function aG(e){const n={};for(let i=0;i<e.length;i++){const o=e[i].layer||"default";n[o]||(n[o]=[]),n[o].push(e[i])}return n}function hG(e){if(Array.isArray(e)){const n=e;for(let e=0;e<n.length;e++)if(hG(n[e]))return!0}for(const n in e)if(ED(e[n])||QB(e[n]))return!0;return!1}function lG(e){return{x:0,y:0,width:2*e,height:2*e}}function uG(e){if(!e.cache)return[];for(const n in e.cache){const i=e.cache[n];if(i.geometry)for(let e=0;e<i.geometry.length;e++){const n=i.geometry[e]&&i.geometry[e].geometry;if(n&&n.properties&&n.properties.features){const e=n.properties.features.empty;delete n.properties.features.empty;const i=Object.values(n.properties.features);return void 0!==e&&(n.properties.features.empty=e),i}}}return[]}ga.include({calculateTileMatrix:function(){const e=new Array(3),n=new Array(3),i=new Array(3);return function(o,s,a){const h=this.getTileGLScale(s),l=o,c=this.layer.getTileSize().width,A=xv([]);return Mv(A,A,$v(e,h,h,this.nn)),Pv(A,A,$v(n,l.x,l.y,0)),Mv(A,A,$v(i,c/a,-c/a,1)),A}}(),calculateTerrainTileMatrix:function(){const e=new Array(3);return function(n,i,o){const s=xv([]),a=o/2;return Mv(s,s,$v(e,1/a,-1/a,0)),Pv(s,s,$v(e,-a,-a,0)),s}}(),calculateTileTranslationMatrix:function(){const e=new Array(3);return function(n,i){const o=this.getTileGLScale(i),s=n,a=xv([]);return Pv(a,a,$v(e,s.x*o,s.y*o,0)),a}}()});const cG=new ee(0,0),AG=new Zh(0,0),fG=[null,0],dG=[];class Ta extends Qp{static loadFrom(e,n){return fetch(e,n||{}).then((e=>e.json())).then((e=>Ta.fromJSON(e)))}constructor(e,n){super(e,n),this.Yn={},this.VERSION=Ta.VERSION;this.setStyle(n&&n.style)}setURLModifier(e){this.qn=e;const n=this.getRenderer();return n&&n.updateOptions(),this}getURLModifier(){return this.qn}onAdd(){const e=this.getMap();this.Jn();const n=this.getSpatialReference().toJSON().projection,i=e.getSpatialReference().toJSON().projection;if((n&&n.toLowerCase())!==(i&&i.toLowerCase()))throw new Error(`VectorTileLayer's projection(${n}) must be the same with map(${i}).`)}setFeatureState(e,n){if(lU(e.id))throw new Error("missing id in first parameter of setFeatureState.");this.Kn||(this.Kn={});const i=e.layer||"0";let o=this.Kn[i];return this.Kn[i]||(o=this.Kn[i]=new Map),o.set(e.id,n),this.Zn(),this}removeFeatureState(e,n){if(lU(e.id))throw new Error("missing id in first parameter of removeFeatureState.");if(!this.Kn)return this;const i=this.Kn[e.layer||"0"];if(!i)return this;if(n){const o=i.get(e.id);if(hU(n))for(const e in n)delete o[e];else delete o[n];i.set(e.id,o)}else i.delete(e.id);return this.Zn(),this}getFeatureState(e){if(lU(e.id))throw new Error("missing id in first parameter of getFeatureState.");if(!this.Kn)return null;return this.Kn[e.layer||"0"].get(e.id)}Zn(){const e=this.getRenderer();if(!e)return;const n=e.getFrameTimestamp();this.Qn=n}ti(){return this.Qn}ei(e){return this.Qn&&this.Qn!==e}Jn(){const e=this.options,n=this.getMap().getProjection(),i="EPSG:4326"===n.code||"EPSG:4490"===n.code,o="EPSG:3857"===n.code;e.spatialReference||512===this.getTileSize().width&&(o?e.spatialReference="preset-vt-3857":i&&(e.spatialReference="preset-vt-4326")),e.tileSystem||(e.tms?o?e.tileSystem=[1,1,-6378137*Math.PI,-6378137*Math.PI]:i&&(e.tileSystem=[1,1,-180,-90]):i&&(e.tileSystem=[1,-1,-180,90]))}forceReload(){const e=this.getRenderer();return e&&e.Ke(),super.forceReload()}onWorkerReady(){}onConfig(e){const n=this.getRenderer();n&&n.updateOptions(e)}getWorkerOptions(){return{debug:this.options.debug,debugTile:this.options.debugTile,altitudeProperty:this.options.altitudeProperty,tileSize:this.getTileSize().width,style:this.isDefaultRender()?{style:[],featureStyle:[]}:this.De(),features:this.options.debugTileData||this.options.features,schema:this.options.schema,pickingGeometry:this.options.pickingGeometry,projectionCode:this.getSpatialReference().getProjection().code,workerGlyph:this.options.workerGlyph&&!this.getURLModifier(),featureIdProperty:this.options.featureIdProperty}}setStyle(e){if(e&&(oU(e)||e.url)){const n=e,i=n.lastIndexOf("/"),o=i<0?".":n.substring(0,i);return this.ready=!1,gU.getJSON(e.url?e.url:e,e.url?e:{},((e,i)=>{if(e)throw this.setStyle([]),e;let s;i.style?(s=i,s.$root||(s.$root=o)):s={$root:o,style:i},this.options.style=n,this.ni(s)})),this}return this.options.style=e,this.ni(e),this}ii(e,n,i,o){const s=o/this.getTileSize().width;return e.set(i.x+n.x/s,i.y-n.y/s)}queryTilePointTerrain(e,n,i,o,s){const a=this.getRenderer(),h=a&&a.getTerrainHelper();if(!a||!h)return fG[0]=null,fG[1]=0,fG;const l=this.ii(cG,e,i,o);return n&&h.queryTileTerrainByPointAtRes?h.queryTileTerrainByPointAtRes(l,s,n.id,n,dG):(fG[0]=null,fG[1]=0,fG)}queryTerrainTiles(e){const n=this.getRenderer(),i=n&&n.getTerrainHelper();return n&&i?i.getTerrainTiles(e):null}ni(e){if(e&&e.$root){let n=e.$root;n&&"/"===n[n.length-1]&&(n=n.substring(0,n.length-1)),this.dt=function(e){return"{$root}"===e?n:null}}this.ready=!0,e=e||[],Array.isArray(e)?e={style:e}:e.renderPlugin&&(e={style:[e]}),e=function(e){if(!e.plugins)return e;const{plugins:n,styles:i}=e;let{style:o,featureStyle:s}=i;o=o||[],s=s||[];const a=new Array(o.length);for(let e=0;e<o.length;e++)a[e]=rU({},o[e]),a[e].renderPlugin=n[o[e].renderPlugin];const h=new Array(s.length);for(let e=0;e<s.length;e++)h[e]=rU({},s[e]),h[e].renderPlugin=n[s[e].renderPlugin];const l={style:a,featureStyle:h};return e.$root&&(l.$root=e.$root),l}(e=JSON.parse(JSON.stringify(e))),this.ri=e.featureStyle||[],this.si=function(e){if(!e||!Array.isArray(e))return[];const n=[];for(let i=0;i<e.length;i++){const o=e[i].style;if(o&&Array.isArray(o)&&o.length)for(let s=0;s<o.length;s++){const a=rU({},e[i],o[s]);o[s].oi=n.length,delete a.style,n.push(a)}else n.push(rU({},e[i]))}return n}(e.featureStyle),this.ai=e.style||[];const n=e.background||{};this.li={enable:n.enable||!1,color:gG(n.color)||[0,0,0,0],opacity:mG(n.opacity,1),patternFile:n.patternFile,depthRange:n.depthRange},this.validateStyle(),this.dt&&this.hi(),this._n();const i=this.getRenderer();i&&i.setStyle(),this.fire("setstyle",{style:this.getStyle(),computedStyle:this.getComputedStyle()})}getPolygonOffsetCount(){const e=this.getRenderer();return e?e.getPolygonOffsetCount():0}getPolygonOffset(){return this.ui||0}setPolygonOffset(e,n){return this.ui=e,this.ci=n,this}getTotalPolygonOffset(){return this.ci}fi(e){if(!e||!e.length)return;const n=this._getTileConfig();let i;for(let o=0,s=e.length;o<s;o++){const{feature:s,tile:a}=e[o],h=s.geometry;if(!s||!a||!h)continue;if(h.type)continue;const{x:l,y:c,res:A,extent:f}=a;void 0===l&&void 0===c&&void 0===A||(i=n.getTilePointNW(l,c,A));const d=this.di(s.type,h,i,f,A);s.geometry=d}}getRenderedFeatures(){const e=this.getRenderer();if(!e)return[];const n=e.getRenderedFeatures()||[];for(let e=0,i=n.length;e<i;e++){const i=n[e];if(!i)continue;this.fi(i.features||[])}return n}getRenderedFeaturesAsync(e={}){return new Promise(((n,i)=>{const o=this.getRenderer();if(o)if(Ma){const i=o.getRenderedFeatures()||[],s=[];i.forEach((e=>{const n=e.features||[];n.length&&uU(s,n)}));const a=(e=Object.assign({},{countPerTime:1e4},e)).countPerTime,h=Math.ceil(s.length/a);let l=1;const c=()=>{const e=s.slice((l-1)*a,l*a);this.fi(e),l++};Ma.runTaskAsync({count:h,run:c}).then((()=>{n(i)}))}else n(this.getRenderedFeatures());else n([])}))}outlineAll(){const e=this.getRenderer();return e?(e.outlineAll(),this):this}outline(e,n){const i=this.getRenderer();return i?(i.outline(e,n),this):this}outlineBatch(e){const n=this.getRenderer();return n?(n.outlineBatch(e),this):this}outlineFeatures(e){const n=this.getRenderer();return n?(n.outlineFeatures(e),this):this}cancelOutline(){const e=this.getRenderer();return e?(e.cancelOutline(),this):this}highlight(e){this.mi(e);const n=this.getRenderer();return n?(n.highlight(e),this):(this.$n||(this.$n=[]),this.$n.push(e),this)}mi(e){if(Array.isArray(e))for(let n=0;n<e.length;n++)this.mi(e[n]);else{if(e.filter){if(!this.options.features)throw new Error("options.features must be turned on to support filter in highlight");if(!e.name)throw new Error("A name is required for highlight with filter")}if(lU(e.filter)&&lU(e.id))throw new Error("id or filter must be provided for highlight")}}Wn(){if(this.$n){for(let e=0;e<this.$n.length;e++)this.highlight(this.$n[e]);delete this.$n}}cancelHighlight(e){const n=this.getRenderer();return n?(n.cancelHighlight(e),this):this}cancelAllHighlight(){const e=this.getRenderer();return e?(e.cancelAllHighlight(),this):this}hi(){Yo.convertStylePath(this.ai,this.dt),Yo.convertStylePath(this.si,this.dt)}updateSceneConfig(e,n){return oU(e)&&(e=this.yi(e)),this.gi(0,e,n)}updateFeatureSceneConfig(e,n,i){return this.gi(1,e,i,n)}gi(e,n,i,o){const s=this.je(e);if(!s)return this;let a,h=n;if(s[n].renderPlugin.sceneConfig||(s[n].renderPlugin.sceneConfig={}),rU(s[n].renderPlugin.sceneConfig,i),void 0!==o){yG(this.ri,n,o),h=this.ri[n].style[o].oi;const e=s[h].renderPlugin;e.sceneConfig||(e.sceneConfig={}),a=e.sceneConfig}else vG(s,n),a=s[n].renderPlugin.sceneConfig;if(rU(a,i),Array.isArray(this.options.style)){const e=this.options.style[n].renderPlugin;e.sceneConfig||(e.sceneConfig={}),rU(e.sceneConfig,i)}else{const s=this.je(e,this.options.style);let a;void 0!==o?(yG(s,n,o),a=s[n].style[o].renderPlugin):(vG(s,n),a=s[n].renderPlugin),a.sceneConfig||(a.sceneConfig={}),rU(a.sceneConfig,i)}const l=this.getRenderer();return l&&l.updateSceneConfig(e,h,i),0===e?this.fire("updatesceneconfig",{index:n,sceneConfig:i}):1===e&&this.fire("updatefeaturesceneconfig",{index:n,styleIdx:o,sceneConfig:i}),this}updateDataConfig(e,n){return oU(e)&&(e=this.yi(e)),this.vi(0,e,n)}updateFeatureDataConfig(e,n,i){return this.vi(1,e,i,n)}vi(e,n,i,o){const s=this.je(e);if(!s)return this;let a,h=n;void 0!==o?(yG(this.ri,n,o),h=this.ri[n].style[o].oi,a=s[h].renderPlugin.dataConfig):(vG(s,n),a=s[n].renderPlugin.dataConfig);const l=rU({},a);if(rU(a,i),Array.isArray(this.options.style))rU(this.options.style[n].renderPlugin.dataConfig,i);else{const s=this.je(e,this.options.style);let a;void 0!==o?(yG(s,n,o),a=s[n].style[o].renderPlugin):(vG(s,n),a=s[n].renderPlugin),a.dataConfig||(a.dataConfig={}),rU(a.dataConfig,i)}const c=this.getRenderer();return c&&c.updateDataConfig(e,h,i,l),0===e?this.fire("updatedataconfig",{index:n,dataConfig:i}):1===e&&this.fire("updatefeaturedataconfig",{index:n,styleIdx:o,dataConfig:i}),this}updateSymbol(e,n){return oU(e)&&(e=this.yi(e)),this.xi(0,e,n)}updateFeatureSymbol(e,n,i){return this.xi(1,e,i,n)}xi(e,n,i,o){const s=this.je(e);if(!s)return this;let a=n;void 0!==o&&(yG(this.ri,n,o),a=this.ri[n].style[o].oi);const h=s[a];if(!h)throw new Error(`No style defined at ${n}`);const l=this,c=this.dt;function A(i,s,a){if(!i)return!1;c&&(i=JSON.parse(JSON.stringify(i)),Yo.parseSymbolPath(i,c));const h=Object.keys(i);let A=!1;for(let e=0;e<h.length;e++){const n=h[e];if(pG(s[n])||pG(i[n])){A=!0;break}}for(const e in i)AU(i,e)&&(!Yo.isObject(i[e])||Array.isArray(i[e])||ED(i[e])?s[e]=i[e]:(s[e]||(s[e]={}),rU(s[e],i[e])));let f=l.options.style;if(oU(f))return A;Array.isArray(f)||(f=l.je(e,l.options.style));const d=JSON.parse(JSON.stringify(s));return void 0!==o?(yG(f,n,o),void 0===a?f[n].style[o].symbol=d:f[n].style[o].symbol[a]=d):(vG(f,n),void 0===a?f[n].symbol=d:f[n].symbol[a]=d),A}const f=this.getRenderer();if(!f)return A(),this._n(),this;let d=!1;const p=h.symbol;if(Array.isArray(i))for(let e=0;e<i.length;e++){const n=A(i[e],p[e],e);n&&(d=n)}else A(i,p);return this._n(),d?f.setStyle():(d=f.updateSymbol(e,a,i),d&&f.setStyle()),0===e?this.fire("updatesymbol",{index:n,symbol:i}):1===e&&this.fire("updatefeaturesymbol",{index:n,featureStyleIndex:o,symbol:i}),this}je(e,n){return n?0===e?n.style:n.featureStyle:0===e?this.ai:this.si}isDefaultRender(){return!!this.bi&&this.options.defaultRendering}validateStyle(){this.bi=!1;let e=this.ai;this.options.style||(this.bi=!0,e=this.ai=[]),Array.isArray(e)||(e=this.ai=[e]);for(let n=0;n<e.length;n++){let i=e[n].filter;if(i&&i.value&&(i=i.value),i||console.warn(`render plugin at ${n} doesn't define filter, its filter will be set to 'default' by default.`),void 0!==i&&"default"!==i&&!0!==i&&!Array.isArray(i)&&void 0===i.condition)throw new Error(`Invalid filter at ${n} : ${JSON.stringify(i)}`)}}getStyle(){return this.options.style?JSON.parse(JSON.stringify(this.options.style)):null}yi(e){const n=this.ai;if(!n)return-1;for(let i=0;i<n.length;i++)if(n[i].name===e)return i;throw new Error(`No style defined with name: ${e}`)}getGroundConfig(){this.wi||(this.wi={enable:!0,renderPlugin:{type:"fill",sceneConfig:{}},symbol:{polygonFill:[0,0,0,0],polygonOpacity:1}});const e=this.De().background||{};return this.wi.enable=e.enable,this.wi.symbol.polygonFill=e.color,this.wi.symbol.polygonOpacity=e.opacity,this.wi.symbol.polygonPatternFile=e.patternFile,this.wi.renderPlugin.sceneConfig.depthRange=e.depthRange,this.wi}getComputedStyle(){return JSON.parse(JSON.stringify(this.De()))}De(){return{background:this.li,style:this.ai||[],featureStyle:this.si||[]}}identify(e,n={}){const i=this.getMap(),o=this.getRenderer();if(!i||!o)return[];const s=i.coordToContainerPoint(new Zh(e));return this.identifyAtPoint(s,n)}identifyAtPoint(e,n={}){const i=this.getMap(),o=this.getRenderer();if(!i||!o)return[];const s=i.getDevicePixelRatio();let a=o.pick(e.x*s,e.y*s,n);return this.options.features&&"id"!==this.options.features&&(a=this.Ai(a)),n&&n.filter?a.filter((e=>n.filter(e))):a}Ai(e){if(!this.getRenderer())return e;const n=this._getTileConfig(),i=this.getSpatialReference();for(let o=0;o<e.length;o++){let s=e[o];if(!s||!s.data)continue;const{tile:a}=s.data,{x:h,y:l,z:c,extent:A}=a,f=i.getResolution(c),d=n.getTilePointNW(h,l,f),p=s.data.feature&&s.data.feature.geometry;if(p){s.data=rU({},s.data),s.data.feature=rU({},s.data.feature);const e=s.data.feature.type;s.data.feature.type="Feature",s.data.feature.geometry=this.di(e,p,d,A,f)}}return e}di(e,n,i,o,s){if(n.type&&n.coordinates)return n;let a,h;if(1===e)n.length<=1?(a="Point",h=this.Mi(n,i,o,s)||[]):(a="MultiPoint",h=this.Mi(n,i,o,s));else if(2===e)n.length<=1?(a="LineString",h=this.Mi(n,i,o,s)||[]):(a="MultiLineString",h=this.Mi(n,i,o,s));else if(3===e){h=[];let e=[],l=0;for(let a=0;a<n.length;a++)gF(n[a])>0&&(l++,e&&e.length&&h.push(e),e=[]),e.push(this.Mi(n[a],i,o,s));e.length&&h.push(e),l<=1?(a="Polygon",h=h[0]):a="MultiPolygon"}return{type:a,coordinates:h}}Mi(e,n,i,o){const s=i/this.getTileSize().width,a=this.getMap(),h=e=>{const i=[];hU(e)&&(e=[e]);for(let h=0,l=e.length;h<l;h++){const l=e[h];cG.x=n.x+l.x/s,cG.y=n.y-l.y/s,a.pointAtResToCoord(cG,o,AG),i.push(AG.toArray())}return 1===e.length?i[0]:i};if(hU(e))return h(e);const l=e.length;if(1===l)return h(e[0]);{let n=[];for(let i=0;i<l;i++)n.push(h(e[i]));return n}}getDataSchema(e){return this.Yn||(this.Yn={}),lU(e)||this.Yn[e]||(this.Yn[e]={}),lU(e)?this.Yn:this.Yn[e]}onRemove(){super.onRemove()}static fromJSON(e){return e&&"VectorTileLayer"===e.type?new Ta(e.id,e.options):null}_n(){}static registerPlugin(e){Ta.plugins||(Ta.plugins={}),Ta.plugins[e.type]=e}static getPlugins(){return Ta.plugins||{}}static compressStyleJSON(e){return Array.isArray(e)&&e.length?function(e){Array.isArray(e)&&(e={style:e,featureStyle:[]});const n=[],i=[],o=[];dU(e.style,n,o),dU(e.featureStyle,i,o);const s={plugins:o,styles:{style:n,featureStyle:i}};return e.$root&&(s.$root=e.$root),s}(e):e}}function pG(e){return!(!e||!e.properties)}function gG(e){return e?(Array.isArray(e)||(e=Ck(e).unitArray()),3===e.length&&e.push(1),e):null}function mG(e,n){return null==e?n:e}function yG(e,n,i){if(!e[n]||!e[n].style||!e[n].style[i])throw new Error(`No plugin defined at feature style of ${n} - ${i}`)}function vG(e,n){if(!e[n])throw new Error(`No plugin defined at style of ${n}`)}Ta.prototype._getTileZoom=function(e){return e=Math.floor(e),Qp.prototype._getTileZoom.call(this,e)},Ta.registerJSONType("VectorTileLayer"),Ta.mergeOptions({urlTemplate:null,renderer:"gl",altitudeProperty:"altitude",forceRenderOnZooming:!0,forceRenderOnMoving:!0,forceRenderOnRotating:!0,tileSize:[512,512],features:!1,schema:!1,cascadeTiles:!0,collision:!0,collisionBuffserSize:0,picking:!0,pickingPoint:!0,pickingGeometry:!1,glyphSdfLimitPerFrame:15,tileLimitPerFrame:1,loadingLimitOnInteracting:5,loadingLimit:0,antialias:!1,iconErrorUrl:null,collisionFrameLimit:1.5,defaultRendering:!0,textGamma:1,maxIconSize:254,workarounds:{"win-intel-gpu-crash":!1},pyramidMode:1,styleScale:1,enableAltitude:!0,fadeAnimation:!1,debugTileData:!1,fetchOptions:null,awareOfTerrain:!0,altitudeQueryTimeLimitPerFrame:3,workerGlyph:!0,featureIdProperty:null,currentTilesFirst:!0}),Ta.registerRenderer("gl",ga),Ta.registerRenderer("canvas",null);const _G=new Cn(1,1);class La extends rd{static registerPainter(e,n){La.painters||(La.painters={}),La.painters[e]=n}static get3DPainterClass(e){return La.painters[e]}setURLModifier(e){return this.qn=e,this}getURLModifier(){return this.qn}getEvents(){let e;return e=super.getEvents?super.getEvents():{},e.spatialreferencechange=this._i,e}onConfig(e){if(super.onConfig(e),void 0!==e.enableBloom){const n=this.getRenderer();n&&n.updateBloom(e.enableBloom)}}updateSymbol(e,n){if(!this.options.style)throw new Error("can't call update symbol when style is not set");const i=Array.isArray(this.options.style)?this.options.style:this.options.style.style;if(!i[e])throw new Error(`invalid style at ${e}`);return rU(i[e].symbol,n),this.setStyle(this.options.style),this}getPolygonOffsetCount(){return this.isEmpty()||this.options.altitude?0:1}getPolygonOffset(){return this.options.altitude?0:this.ui||0}setPolygonOffset(e,n){return this.ui=e,this.ci=n,this}getTotalPolygonOffset(){return this.ci}identify(e,n={}){const i=this.getMap(),o=this.getRenderer();if(!i||!o)return[];const s=i.coordToContainerPoint(new Zh(e));return this.identifyAtPoint(s,n)}identifyAtPoint(e,n={}){const i=this.getMap(),o=this.getRenderer();if(!i||!o)return[];const s=this.getMap().getDevicePixelRatio(),a=o.pick(e.x*s,e.y*s,n);return n&&n.filter?a.filter((e=>n.filter(e))):a}getComputedStyle(){return{style:this.getStyle()||[]}}outlineAll(){const e=this.getRenderer();return e?(e.outlineAll(),this):this}outline(e){if(!Array.isArray(e)||!e.length)return this;const n=this.getRenderer();return n?(n.outline(e),this):this}cancelOutline(){const e=this.getRenderer();return e?(e.cancelOutline(),this):this}toJSON(){const e={type:this.getJSONType(),id:this.getId(),options:this.config(),geometries:[]},n=this.getGeometries();for(let i=0,o=n.length;i<o;i++){const o=n[i].toJSON();e.geometries.push(o)}return e}getTileSize(){return _G}_i(){const e=this.getRenderer();e&&e._i()}}La.mergeOptions({picking:!0,pickingPoint:!0,renderer:"gl",collision:!1,collisionBufferSize:0,textGamma:1,geometryEvents:!0,styleScale:1,forceRenderOnZooming:!0,forceRenderOnMoving:!0,forceRenderOnRotating:!0,meshRenderOrder:0,enableBloom:!1,enableAltitude:!0,workarounds:{"win-intel-gpu-crash":!0}});const xG={redraw:!1,retire:!1},bG=[];let wG=1;function CG(e,n){const i=SL.extend(e,{init:function(){this.Si={}},isVisible(){return this.painter&&this.painter.isVisible()},supportRenderMode:function(e){return this.painter.supportRenderMode(e)},hasMesh(){return this.painter&&this.painter.hasMesh()},startFrame:function(e){const i=e.sceneConfig;let o=this.painter;if(!o){o=this.painter=new n(e.regl,e.layer,e.symbol,i,e.pluginIndex,e.dataConfig)}this.Si||(this.Si={});const s=i.excludes;this.ki?s!==this.ki&&(this.Pi=s?Mk(s):null,this.ki=s):s&&(this.ki=s),o.startFrame(e),this.Ti={}},updateCollision:function(e){const n=this.painter;return n&&n.isVisible()?n.updateCollision(e):null},prepareRender:function(e){const n=this.painter;return n&&n.isVisible()?n.prepareRender(e):null},endFrame:function(e){const n=this.painter;return n&&n.isVisible()?n.render(e):null},getShadowMeshes(){const e=this.painter;return e&&e.getShadowMeshes&&e.getShadowMeshes()||bG},createTile:function(e){const{tileCache:n,tileData:i}=e;let o=!1;const s=this.painter;if(!s)return{retire:o};const a=this.Ii(e);let h=n.geometry;if(!h){const a=i.features,l=i.data;if(!l||!l.length)return{retire:o};const c=l;if(this.painter.colorSymbol&&!function(e){if(!e)return!0;for(const n in e)return!1;return!0}(a))for(let e=0;e<l.length;e++){const n=this.Fi(a,l[e].data.aPickingId,l[e].indices,l[e].data.aPosition,l[e].positionSize);l[e].data.aColor=n}h=n.geometry=s.createGeometries(c,a);for(let n=0;n<h.length;n++)h[n]&&h[n].geometry&&(o=!0,h[n].geometry.properties.features=a,this.Ci(h[n].geometry,e))}let l=this.Me(a);if(!l){const{meshes:n,retire:i}=this.Oi(h,e);o||(o=i),l=n}return{retire:o}},Oi(e,n){const{tileInfo:i,tileExtent:o,tileTransform:s,tileTranslationMatrix:a,tileVectorTransform:h,tileZoom:l,sceneConfig:c}=n;let A=!1;const f=this.painter,d=f.createMeshes(e,s,{tileExtent:o,tilePoint:[i.extent2d.xmin,i.extent2d.ymax],tileZoom:l,tileTranslationMatrix:a,tileVectorTransform:h},n);if(d.length){for(let e=0;e<d.length;e++)d[e]&&(A=!0,this.Ei(d[e],s,n.timestamp,wG++,f.isEnableTileStencil()));c.animation&&(d.Di=n.timestamp);const e=this.Ii(n);this.Si[e]=d}return{meshes:d,retire:A}},paintTile:function(e){const{tileCache:n,tileInfo:i,tileZoom:o,sceneConfig:s}=e,a=this.painter;if(!a)return xG;let h=n.geometry;if(!h)return xG;let l=!1;const c=this.Ii(e);let A=this.Me(c);if(!A){const{meshes:n,retire:i}=this.Oi(h,e);l||(l=i),A=n}if(!A.length)return xG;const f=a.getTileLevelValue(i,o);A.forEach((e=>{e.properties.tile=i,e.properties.level=f}));let d=!1;if(!this.Ti[c]){let n=null,i=s.animation;if(i){const o=e.sceneConfig.animationDuration||800,s=(e.timestamp-A.Di)/o;A.Di-A[0].properties.createTime<o&&s<1&&(!0!==i&&1!==i||(i="linear"),n="linear"===i?s:ML(i,s),d=!0)}a.addMesh(A,n,e),this.Ti[c]=1}return{redraw:d,retire:l}},Ei:function(e,n,i,o,s){if(e.properties.tileTransform=n,e.properties.createTime=i,e.properties.meshKey=o,e.needUpdateShadow=!0,s){const n=e.defines||{};n.ENABLE_TILE_STENCIL=1,e.setDefines(n)}"stencilRef"in e.uniforms||Object.defineProperty(e.uniforms,"stencilRef",{enumerable:!0,get:function(){return e.properties.tile&&void 0!==e.properties.tile.stencilRef?e.properties.tile.stencilRef:e.properties.level}})},Ci:function(e,n){const{layer:i,tileInfo:o}=n,s=i.getMap(),a=(i.getSpatialReference?i.getSpatialReference():s.getSpatialReference()).getResolution(o.z),h=n.tileExtent/i.getTileSize().width;e.properties.tileResolution=a,e.properties.tileRatio=h,e.properties.z=o.z,e.properties.tileExtent=n.tileExtent},updateSceneConfig:function(e){const n=this.painter;n&&n.updateSceneConfig(e.sceneConfig)},updateDataConfig:function(e,n){const i=this.painter;return!i||i.updateDataConfig(e,n)},updateSymbol:function(e,n){const i=this.painter;if(!i)return!1;if(i.shouldDeleteMeshOnUpdateSymbol(e)){if(this.Si)for(const e in this.Si)i.deleteMesh(this.Si[e],!0);delete this.Si,delete this.Ti}return i.updateSymbol(e,n)},pick:function(e,n,i){return this.painter&&this.painter.pick?this.painter.pick(e,n,i):null},deleteTile:function(e){if(!this.Si)return;const n=this.Ii(e),i=this.Si[n];i&&this.painter&&this.painter.deleteMesh(i),delete this.Si[n],this.Ti&&delete this.Ti[n]},remove:function(){const e=this.painter;if(e&&this.Si){for(const n in this.Si)e.deleteMesh(this.Si[n]);e.delete(),delete this.painter}delete this.Si,delete this.Ti},resize:function(e,n){const i=this.painter;i&&i.resize(e,n)},needToRedraw:function(){return!!this.painter&&this.painter.needToRedraw()},needToRetireFrames:function(){return!!this.painter&&this.painter.needToRetireFrames()},isAnimating(){return!!this.painter&&this.painter.isAnimating()},needToRefreshTerrainTileOnZooming:function(){return!!this.painter&&this.painter.needToRefreshTerrainTileOnZooming()},isTerrainSkin:function(){return!!this.painter&&this.painter.isTerrainSkin()},isTerrainVector:function(){return!!this.painter&&this.painter.isTerrainVector()},Fi:function(e,n,i,o,s=3){if(!o||!e||!n.length)return null;const a=new Uint8Array(o.length/s*4);let h,l;const c=this.painter.colorSymbol,A={};let f;for(let i=0,o=n.length;i<o;i++){const o=n[i];if(h=e[o].symbol,l=A[o],!l)if(c){let n;n="function"==typeof c?c(e[o].feature&&e[o].feature.properties):c,n=Ck(n),l=A[o]=n.array()}else l=A[o]=[255,255,255];f=4*i,a[f]=l[0],a[f+1]=l[1],a[f+2]=l[2],a[f+3]=255*(h[this.painter.opacitySymbol]||1)}return a},Ii:function(e){const n=e.tileInfo;return n.meshKey||(n.meshKey=wG++),n.meshKey},Me:function(e){return this.Si[e]},Li(e,n){if(Array.isArray(e))e.forEach(((e,i)=>{const{features:o}=e.properties;this.Ri(e,n[i],o)}));else{const{features:i}=e.properties;this.Ri(e,Array.isArray(n)?n[0]:n,i)}},Ri(e,n,i){const o=n.featureIndexes||n.data.featureIndexes;if(o)if(this.Pi){const s=n.indices;let a=null,h=!1;const l=[];for(let e=0;e<s.length;e++){null!==a&&a===s[e]||(h=this.Pi(i[o[s[e]]].feature),a=s[e]),h||l.push(s[e])}e.setElements(new n.indices.constructor(l))}else e.setElements(n.indices)},outline(e,n){const i=this.painter;i&&i.outline(e,n)},outlineAll(e){const n=this.painter;n&&n.outlineAll(e)},needPolygonOffset(){const e=this.painter;return e&&e.needPolygonOffset()},highlight(e){const n=this.painter,i=this.style.name,o=this.renderIndex;if(e){const n=[];if(e.forEach(((e,s)=>{null!=e.plugin&&(Array.isArray(e.plugin)?e.plugin.length&&e.plugin.indexOf(i)<0&&e.plugin.indexOf(o)<0&&n.push(s):e.plugin!==i&&e.plugin!==o&&n.push(s))})),n.length){const i=new Map(e);for(let e=0;e<n.length;e++)i.delete(n[e]);e=i}}return n&&n.highlight(e)},cancelAllHighlight(){const e=this.painter;return e&&e.cancelAllHighlight()}});return i}function PG(e){return!e||(void 0!==e.empty||(e.empty=function(e){for(const n in e)return!1;return!0}(e)),e.empty)}const MG="_fn_type_",TG="__current_fn_types";function SG(e,n,i,o){if(!PG(e.properties.features))for(let s=0;s<i.length;s++){const{symbolName:a}=i[s];(e[TG]=e[TG]||{})[a]=n[a],IG(e,n,i[s],o)}}function IG(e,n,i,o){const s=function(e){const n=e.properties;let i=n.aPickingId;return i||(i=n.aPickingId=new e.data.aPickingId.constructor(e.data.aPickingId)),i}(e),{attrName:a,symbolName:h,related:l}=i;let c=e.data[a];return c?BG(n[h])||function(e,n){if(!Array.isArray(e))return!1;for(let i=0;i<e.length;i++)if(BG(n[e[i]]))return!0;return!1}(l,n)?(BG(n[h])&&EG(e,n,i),c):(e.deleteData(a),OG(e,a),null):BG(n[h])?(c=e.data[a]=new i.type(i.width*s.length),function(e,n,i,o,s){const{attrName:a}=o,h=(MG+a+"Index").trim();EG(n,i,o);FG(n,n.properties[h],o,s)}(0,e,n,i,o),c):null}function EG(e,n,i){const{attrName:o,symbolName:s}=i,a=e.properties,h=(MG+o+"Index").trim(),l=(MG+o).trim();if(a[h]&&a[l])return;const c=function(e){if(!e)return LG;const n=[];for(let i=0;i<e.length;i++)ED(e[i][1])&&!RD(e[i][1]).isZoomConstant&&n.push(e[i][0]);return n}(n[s].stops),A="identity"===n[s].type&&function(e,n,i){if(Array.isArray(i)||(i=Object.values(i)),!i||!i.length)return!1;if(!GF[e])return!1;for(let e=0;e<i.length;e++){const o=i[e]&&(i[e].feature||i[e]);if(!o)continue;const s=o.properties&&o.properties[n];if(s&&ED(s)&&!RD(s).isZoomConstant)return!0}return!1}(s,n[s].property,a.features);if(!A&&!c.length)return void OG(e,o);const{features:f,aPickingId:d}=a,p=function(e,n,i,o,s){const a=[];let h=0,l=n[0];for(let c=1,A=n.length;c<A;c++)!e[l]||n[c]===l&&c!==A-1||((s||kG(e[l].feature,i,o))&&a.push(h,c===A-1?A:c),l=n[c],h=c);return a}(f,d,n[s].property,c,A);if(!p.length)return void OG(e,o);const g=e.data[o];a[h]=p,a[l]=g.BYTES_PER_ELEMENT?new g.constructor(g):new i.type(g.length)}function OG(e,n){const i=e.properties,o=(MG+n+"Index").trim(),s=(MG+n).trim();delete i[o],delete i[s]}function RG(e,n,i,o,s,a){if(!s)return;const h=s.geometry;if(h&&!PG(h.properties.features)){for(let l=0;l<o.length;l++){const c=o[l],A=c.attrName;if(!(DG(h,i,c)||n.ei&&n.ei(s.geometry.Hi))){const{aPickingId:e}=h.properties;if(!e||h.zi===a)continue;const i=(MG+A+"Index").trim(),o=h.properties[i];if(!o)continue;FG(h,o,c,n);continue}const f=IG(h,i,c),d=c.define;if(f){const i=(MG+A+"Index").trim();if(FG(h,h.properties[i],c,n),n.ti&&(h.Hi=n.ti()),d){const e=s.defines;e[d]=1,s.setDefines(e)}h.generateBuffers(e)}else if(d){const e=s.defines;e[d]&&(delete e[d],s.setDefines(e))}}h.zi=a}}function DG(e,n,i){const o=n[i.symbolName],s=e[TG];return!BT(o,s[i.symbolName])&&(s[i.symbolName]=o,!0)}function kG(e,n,i){for(let o=0;o<i.length;o++)if("$"===n[0]&&e[n.substring(1)]===i[o]||e.properties[n]===i[o])return!0;return!1}const LG=[];function FG(e,n,i,o){const{attrName:s,evaluate:a}=i,{aPickingId:h,features:l}=e.properties;let c;if(n){const i=(MG+s).trim();c=e.properties[i];const A=c.length/h.length,f=n.length;for(let i=0;i<f;i+=2){const s=n[i];let f=l[h[s]];f&&f.feature&&zG(c,f,a,s,n[i+1],A,e,o)}}else{if(c=e.data[s],function(e){return Array.isArray(e)||e.constructor===Float32Array||e.constructor===Float64Array||e.constructor===Uint8Array||e.constructor===Int8Array||e.constructor===Uint16Array||e.constructor===Int16Array||e.constructor===Uint32Array||e.constructor===Int32Array||e.constructor===Uint8ClampedArray}(c))c.dirty=!0;else{const n=(MG+s).trim();c=e.properties[n],c||(c=e.properties[n]=new i.type(i.width*h.length),c.dirty=!0)}const n=c.length/h.length,A=h.length;let f=0;for(let i=0;i<A;i++){if(h[i]===h[f]&&i<A-1)continue;let s=l[h[f]];s&&s.feature&&(zG(c,s,a,f,i===A-1?A:i,n,e,o),f=i)}}c.dirty&&(e.updateData(s,c),c.dirty=!1)}const NG={};function zG(e,n,i,o,s,a,h,l){const c=(n=n.feature).properties||{};if(void 0===c.$layer&&(n.properties||(n.properties=c),c.$layer=n.layer,c.$type=n.type),l.getFeatureState&&(NG.layer=n.layer,NG.id=n.id,n[RU]&&(n[RU]=null),!BU(n.id))){const e=l.getFeatureState(NG);n.properties[RU]=e}const A=i(c,h,e,o*a);if(Array.isArray(A)){let n=!1;for(let i=0;i<a;i++)if(e[o*a+i]!==A[i]){n=!0;break}if(n){for(let n=o*a;n<s*a;n+=a)e.set(A,n);e.dirty=!0}}else e[o]!==A&&(qU(e,A,o,s),e.dirty=!0)}function BG(e){return HF(e)}const HG=[];function jG(e,n,i,o,s){return E_(HG,n[0],n[1],n[2],1),G_(HG,HG,i),e[2]=HG[3],L_(HG,HG,1/HG[3]),e[0]=(HG[0]+1)*o/2,e[1]=(1-HG[1])*s/2,e}const UG=[],GG=[],VG=[],WG=[-99999,-99999],qG=new ee(0,0),ZG=[];function QG(e,n,i,o,s,a,h,l){const{res:c,extent:A,extent2d:f}=i.properties.tile,{xmin:d,ymax:p}=f,g=d+o.x*s,v=p-o.y*s;let w=null;if(l)for(let e=0;e<l.length;e++)if(XG(l[e],g,v,c)){w=l[e];break}if(!w)return WG;const C=qG.set(d,p),P=a.queryTilePointTerrain(o,w,C,A,c),T=null===P[0]?TU:P[0];if(T){let i=$v(ZG,o.x,o.y,0);return i[2]+=100*T,i=jG(e,i,h,n.width,n.height),i}return e[0]=o.x,e[1]=o.y,e}function XG(e,n,i,o){const s=qG.set(n,i)._multi(o/e.res);return e.extent2d.contains(s)}const{loginIBLResOnCanvas:YG,logoutIBLResOnCanvas:JG,getIBLResOnCanvas:KG}=DT.PBRUtils,$G="__gl_textures",tV=[],eV=new ee(0,0),nV=new ee(0,0),iV=new Float32Array(1),rV=[],oV=e=>0===e.properties.level,sV=e=>e.properties.level>0;class Al{static getBloomSymbol(){return["bloom"]}constructor(e,n,i,o,s,a){this.Ni=!0,this.regl=e,this.layer=n,this.canvas=e._gl.canvas,this.sceneConfig=o||{},this.dataConfig=a||{},this.pluginIndex=s,this.scene=new kC,this.pickingFBO=n.getRenderer().pickingFBO,this.level0Filter=oV,this.levelNFilter=sV,this.loginTextureCache(),this.symbolDef=Array.isArray(i)?i.map((e=>HU(e))):[HU(i)],this.Vi(),this.pickingViewport={x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1},this.sortByCommandKey=aV.bind(this),this.colorCache={},this.Ui=this.symbolDef.map((e=>!(!e||!1!==e.visible)))}hasMesh(){const e=this.scene&&this.scene.getMeshes();return this.isVisible()&&e&&!!e.length}getMap(){return this.layer?this.layer.getMap():null}getTileLevelValue(e,n){const i=this.layer.getRenderer();return i.getTileLevelValue&&i.getTileLevelValue(e,n)||0}getAnalysisMeshes(){return this.getShadowMeshes?this.getShadowMeshes():rV}isVisible(){const{minZoom:e,maxZoom:n}=this.sceneConfig,i=this.getMap().getZoom();if(!BU(e)&&i<e)return!1;if(!BU(n)&&i>n)return!1;const o=this.tt;if(o.length)for(let e=0;e<o.length;e++)if(o[e]&&!o[e].isFeatureConstant)return!0;const s=this.getSymbols();for(let e=0;e<s.length;e++){const n=s[e].visible;if(!1!==n&&0!==n)return!0}return!1}isMeshVisible(e){const n=e&&e.properties&&e.properties.symbolIndex;if(!n)return!1;const i=this.tt,o=n.index;let s;if(i[o]){if(!i[o].isFeatureConstant)return!0;s=i[o](this.getMap().getZoom())}else s=this.getSymbol(n).visible;return!1!==s&&0!==s}isAnimating(){return!1}needToRedraw(){return this.isAnimating()||this.ji}needToRetireFrames(){return this.Re}needToRefreshTerrainTileOnZooming(){return!0}isTerrainSkin(){return this.layer.options.awareOfTerrain}isTerrainVector(){return!1}isShadowIncludeChanged(e){const n=e&&e.isRenderingTerrain&&this.isTerrainSkin();return e&&e.states&&e.states.includesChanged.shadow||n&&this.Gi}fillIncludes(e,n,i){if(delete this.Gi,i&&i.isRenderingTerrain&&this.isTerrainSkin())return;const o=i&&i.includes;if(o){let s="";for(const a in o)o[a]&&(s+=a,i[a].uniformDeclares&&n.push(...i[a].uniformDeclares),i[a].defines&&FU(e,i[a].defines));this.Gi=s}}setIncludeUniformValues(e,n){if(n&&n.isRenderingTerrain&&this.isTerrainSkin())return;const i=n&&n.includes;if(i)for(const o in i)i[o]&&n[o].renderUniforms&&FU(e,n[o].renderUniforms)}createGeometries(e,n){if(!e.length)return rV;const i=[];for(let o=0;o<e.length;o++)if(e[o])if(void 0!==e[o].ref)i.push(i[e[o].ref]?{geometry:i[e[o].ref].geometry,symbolIndex:e[o].symbolIndex,ref:e[o].ref}:null);else{e[o]&&!e[o].is2D&&(this.Ni=!1);const s=this.createGeometry(e[o],n,o);if(s&&s.geometry){const a=s.geometry.properties,{pickingIdMap:h,idPickingMap:l,hasFeaIds:c}=this.Bi(e[o]);c&&(a.feaIdPickingMap=h,a.feaPickingIdMap=l),a.symbolIndex=s.symbolIndex,a.features=n,a.is2D=e[o].is2D,a.layer=this.layer,a.positionBounding=e[o].positionBounding,this.postCreateGeometry(s,i)}i.push(s)}return i}isOnly2D(){return this.Ni}postCreateGeometry(){}Bi(e){if(!e)return{};if(Array.isArray(e)&&!(e=e[0]))return{};const n=e.featureIds,i={},o={},s=n&&n.length;if(s)for(let s=0;s<n.length;s++){const a=e.data.aPickingId[s];void 0===i[a]&&(i[a]=n[s],o[n[s]]||(o[n[s]]=[]),o[n[s]].push(e.data.aPickingId[s]))}return{hasFeaIds:s,idPickingMap:i,pickingIdMap:o}}createGeometry(){throw new Error("not implemented")}createMeshes(e,n,i,o){const s=this.layer.options.awareOfTerrain,a=[];for(let h=0;h<e.length;h++){if(!e[h])continue;if(s&&o&&o.isRenderingTerrain&&this.isTerrainVector()){const n=e[h],i=n&&n.geometry;this.$i(i,i.data,i.properties,i.positionSize||i.desc.positionSize,o)}let l=this.createMesh(e[h],n,i,o||{});Array.isArray(l)?(l=l.filter((e=>!!e)),a.push(...l)):l&&a.push(l)}return a}createMesh(){throw new Error("not implemented")}getAltitudeOffsetMatrix(){const e=100*(this.dataConfig.altitudeOffset||0),n=xv([]);return $v(tV,0,0,e),Pv(n,n,tV),n}isBloom(e){return!!this.getSymbol(e.properties.symbolIndex).bloom}forbiddenTerrainUpscale(){return!0}addMesh(e,n,i){if(i.isRenderingTerrain&&this.isTerrainSkin()&&this.forbiddenTerrainUpscale()){const e=this.getMap().getResolution();if(i.tileInfo.res/e>3)return}const o=i.isRenderingTerrain&&this.isTerrainVector(),s=this.getRenderFBO(i);e=e.filter((e=>this.isMeshVisible(e))),o&&(e=e.filter((e=>e.geometry&&e.geometry.data.aTerrainAltitude)));const a=void 0===this.sceneConfig.castShadow||!!this.sceneConfig.castShadow,h=!(!i||!i.bloom);e.forEach((e=>{const n=this.isBloom(e)&&h;e.bloom=n,e.castShadow=a;let l=!1;const c=e.defines||{};if(!!c.HAS_BLOOM!==n&&(l=!0,n?c.HAS_BLOOM=1:delete c.HAS_BLOOM),o){if(e.geometry.data.aTerrainAltitude){const n=e.geometry;this.$i(n,n.data,n.properties,n.desc.positionSize,i)}e.geometry.data.aTerrainAltitude&&!c.HAS_TERRAIN_ALTITUDE&&(c.HAS_TERRAIN_ALTITUDE=1,l=!0)}else c.HAS_TERRAIN_ALTITUDE&&(delete c.HAS_TERRAIN_ALTITUDE,l=!0);l&&e.setDefines(c),s?e.setUniform("targetFramebuffer",s):e.uniforms.targetFramebuffer&&(e.uniforms.targetFramebuffer=null),this.Wi(e)})),this.scene.addMesh(e)}updateCollision(){}render(e){return this.pluginIndex=e.pluginIndex,this.polygonOffsetIndex=e.polygonOffsetIndex,this.paint(e),{redraw:this.ji,drawCount:this.Xi}}prepareRender(e){if(this.Qe===e.timestamp)return;if(!this.createFnTypeConfig)return;const n=this.scene.getMeshes();if(!n||!n.length)return;const i=e&&e.sceneFilter,o=this.getMap().getZoom();for(let s=0;s<n.length;s++){if(!n[s]||!n[s].geometry)continue;if(i&&!i(n[s]))continue;const{symbolIndex:a}=n[s].properties,h=this.getSymbolDef(a);if(!h)continue;this.Qe=e.timestamp;const l=this.getFnTypeConfig(a);RG(this.regl,this.layer,h,l,n[s],o)}}paint(e){const n=this.layer.getMap();if(!n)return{redraw:!1};this.Yi=e;const i=this.getUniformValues(n,e);return this.callShader(i,e),{redraw:this.ji}}setToRedraw(e){e&&(this.Re=e),this.ji=!0}callShader(e,n){this.callCurrentTileShader(e,n),this.callBackgroundTileShader(e,n)}callCurrentTileShader(e,n){this.shader&&(this.shader.filter=n&&n.sceneFilter?[this.level0Filter,n.sceneFilter]:this.level0Filter),this.callRenderer(this.shader,e,n)}callBackgroundTileShader(e,n){this.shader&&(this.shader.filter=n&&n.sceneFilter?[this.levelNFilter,n.sceneFilter]:this.levelNFilter),this.scene.getMeshes().sort(hV),this.callRenderer(this.shader,e,n)}callRenderer(e,n,i){const o=this.scene.getMeshes(),s=[];o.forEach((e=>{e.properties.hlBloomMesh&&i&&i.bloom&&s.push(e.properties.hlBloomMesh),s.push(e)})),this.qi(n),this.scene.setMeshes(s),this.Xi+=this.renderer.render(e,n,this.scene,this.getRenderFBO(i)),this.scene.setMeshes(o)}qi(e){const n=this.layer.options.altitude||0,i=this.layer.getRenderer();e.layerOpacity=i.Xn(),e.minAltitude=n}getRenderFBO(e){return e&&e.renderTarget&&e.renderTarget.fbo}needPolygonOffset(){return!1}getPolygonOffset(){const e=this.layer;return{factor:()=>e.getPolygonOffset()+(this.polygonOffsetIndex||0),units:()=>e.getPolygonOffset()+(this.polygonOffsetIndex||0)}}getBlendFunc(){return{src:()=>this.sceneConfig.blendSrc||"one",dst:()=>this.sceneConfig.blendDst||"one minus src alpha"}}pick(e,n,i=3){if(!this.layer.options.picking||!1===this.sceneConfig.picking)return null;if(!this.pickingFBO||!this.picking)return null;const o=this.getMap(),s=this.getUniformValues(o);this.qi(s);for(let a=0;a<this.picking.length;a++){const h=this.picking[a];h.render(this.scene.getMeshes(),s,!0);let l={};h.getRenderedMeshes().length&&(l=h.pick(e,n,i,s,{viewMatrix:o.viewMatrix,projMatrix:o.projMatrix,returnPoint:this.layer.options.pickingPoint&&!1!==this.sceneConfig.pickingPoint,logDepthBufFC:2/(Math.log(o.cameraFar+1)/Math.LN2)}));const{meshId:c,pickingId:A,point:f}=l,d=(0===c||c)&&h.getMeshAt(c);if(!d||!d.geometry)continue;let p=d.geometry.properties;return p.features||(p=d.properties),f&&f.length&&(f[0]=Math.round(1e5*f[0])/1e5,f[1]=Math.round(1e5*f[1])/1e5,f[2]=Math.round(1e5*f[2])/1e5),{data:this.Ji(p&&p.features&&p.features[A]),point:f,coordinate:l.coordinate,plugin:this.pluginIndex}}return null}Ji(e){const n=e&&e.feature;if(!n||!n.customProps)return e;const i=FU({},e);return i.feature=FU({},e.feature),delete i.feature.customProps,i.feature.properties=FU({},n.properties,n.properties[OU],n.properties[RU]),delete i.feature.properties[RU],delete i.feature.properties[OU],delete i.feature.properties.$layer,delete i.feature.properties.$type,i}updateSceneConfig(){}updateDataConfig(e){return FU(this.dataConfig,e),!0}deleteMesh(e,n){if(e)if(this.scene.removeMesh(e),Array.isArray(e))for(let i=0;i<e.length;i++){if(!e[i].isValid())continue;const o=e[i].geometry;!n&&o&&o.dispose(),e[i].material&&e[i].material.dispose(),e[i].dispose(),rD.deleteHighlightBloomMesh(e[i])}else{if(!e.isValid())return;!n&&e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose(),e.dispose(),rD.deleteHighlightBloomMesh(e)}}startFrame(e){this.Ki||(this.init(e),this.Ki=!0),this.Qe!==e.timestamp&&(this.ji=!1,this.Re=!1,this.Xi=0),this.scene.clear()}resize(){}delete(){if(this.scene.clear(),this.shader&&this.shader.dispose(),this.picking){for(let e=0;e<this.picking.length;e++)this.picking[e].dispose();delete this.picking}if(this.Zi){for(let e=0;e<this.Zi.length;e++)this.Zi[e].dispose();delete this.Zi}delete this.Qi,this.logoutTextureCache()}updateSymbol(e,n){Array.isArray(e)||(e=[e],n=[n]);let i=!1;for(let o=0;o<e.length;o++)if(e[o]){const s=this.er(o,e[o],n[o]);s&&(i=s)}return delete this.nr,this.setToRedraw(!1),i}ir(e,n){for(const i in n)if(XU(n,i)){if(HF(n[i])&&!this.layer.options.features&&(!e[i]||e[i].property!==n[i].property))return!0;if($j[i]&&!BT(n[i],e[i]))return!0}return!1}er(e,n,i){if(!this.rr)return!1;const o=this.ir(this.symbolDef[e]||{},i);if(this.Ui[e]&&!1!==i.visible)return this.Ui[e]=!1,!0;this.symbolDef[e]=HU(i);const s=this.rr[e];for(const e in s)delete s[e];const a=this.getMap(),h=[],l=Jj(this.symbolDef[e],(()=>(h[0]=a.getZoom(),h)));for(const e in l){const n=Object.getOwnPropertyDescriptor(l,e);n.get?Object.defineProperty(s,e,{get:n.get,set:n.set,configurable:!0,enumerable:!0}):s[e]=l[e]}return ED(i.visible)&&(this.tt[e]=RD(i.visible)),o}getSymbolDef(e){return this.symbolDef[e.index]}getSymbols(){return this.rr}getSymbol(e){return this.rr[e.index]}Vi(){const e=this.getMap(),n=[],i=()=>(n[0]=e.getZoom(),n);this.rr=[],this.tt=[];for(let e=0;e<this.symbolDef.length;e++)this.rr[e]=Jj(FU({},this.symbolDef[e]),i),this.symbolDef[e]&&ED(this.symbolDef[e].visible)&&(this.tt[e]=RD(this.symbolDef[e].visible))}getFnTypeConfig(e){this.nr||(this.nr=[]);const n=e.index;if(!this.nr[n]){const i=this.getSymbolDef(e),o=this.getMap();this.nr[n]=this.createFnTypeConfig(o,i)}return this.nr[n]}sr(){delete this.nr}loginTextureCache(){const e=($G+"").trim(),n=this.getMap();n[e]||(n[e]={count:0}),n[e].count++}logoutTextureCache(){const e=($G+"").trim(),n=this.getMap(),i=this.ar;if(i)for(const o in i)XU(i,o)&&n[e][o]&&(n[e][o].count--,n[e][o].count<=0&&delete n[e][o]);n[e].count--,n[e].count<=0&&(n[e]={})}getCachedTexture(e){const n=($G+"").trim(),i=this.getMap()[n][e];return i?i.data:null}addCachedTexture(e,n){const i=($G+"").trim(),o=this.getMap();let s=o[i][e];s?s.data=n:s=o[i][e]={data:n,count:0},this.ar||(this.ar={}),s.data.then||this.ar[e]||(s.count++,this.ar[e]=1)}disposeCachedTexture(e){let n;if(n="string"==typeof e?e:e.url,!this.ar||!this.ar[n])return;const i=($G+"").trim();delete this.ar[n];const o=this.getMap();o[i][n]&&(o[i][n].count--,o[i][n].count<=0&&delete o[i][n])}shouldDeleteMeshOnUpdateSymbol(){return!1}isEnableTileStencil(){return!0}isUniqueStencilRefPerTile(){return this.isOnly2D()}supportRenderMode(e){return"taa"===e||"fxaa"===e}outline(e,n){const i={};for(let o=0;o<n.length;o++)BU(n[o])||i[n[o]]||(this.lr(e,n[o]),i[n[o]]=1)}lr(e,n){if(!this.picking)return;if(this.hr||(this.hr=new kC),!this.Zi&&(this.ur(),!this.Zi))return void console.warn(`Plugin at ${this.pluginIndex} doesn't support outline.`);const i=this.getUniformValues(this.getMap(),this.Yi);this.qi(i);const o=this.cr(n);if(o.length)for(let s=0;s<o.length;s++){const a=o[s].geometry.properties.feaIdPickingMap;if(a){const h=a[n];if(h){const n={};this.hr.setMeshes(o[s]);for(let o=0;o<h.length;o++){const s=h[o];if(!n[s]){n[s]=1,i.highlightPickingId=s;for(let n=0;n<this.Zi.length;n++)this.renderer.render(this.Zi[n],i,this.hr,e)}}}}}}cr(e){const n=[],i=this.scene.getMeshes();for(let o=0;o<i.length;o++){const s=i[o],a=s.geometry.properties.feaIdPickingMap;a&&void 0!==a[e]&&n.push(s)}return n}outlineAll(e){if(!this.picking)return;if(!this.Zi&&(this.ur(),!this.Zi))return void console.warn(`Plugin at ${this.pluginIndex} doesn't support outline.`);const n=this.getUniformValues(this.getMap(),this.Yi);this.qi(n),n.highlightPickingId=-1;for(let i=0;i<this.Zi.length;i++)this.renderer.render(this.Zi[i],n,this.scene,e)}ur(){if(!this.picking)return;const e=this.layer.getRenderer().canvas;this.Zi=[];for(let n=0;n<this.picking.length;n++){const i=this.picking[n].getPickingVert(),o={ENABLE_PICKING:1,HAS_PICKING_ID:1},s=this.picking[n].getUniformDeclares().slice(0);void 0!==s.uPickingId&&(o.HAS_PICKING_ID=2),this.Zi[n]=new eP({vert:i,frag:"precision highp float;\nuniform float highlightPickingId;\nvarying float vPickingId;\nvoid main() {\n  if(highlightPickingId < .0 || floor(highlightPickingId + .5) == floor(vPickingId + .5)) {\n    gl_FragColor = vec4(1.);\n  } else {\n    discard;\n  }\n}",uniforms:s,defines:o,extraCommandProps:{viewport:{x:0,y:0,width:()=>e.width,height:()=>e.height},depth:{enable:!0,mask:!1,func:"always"},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}}),this.Zi[n].filter=this.picking[n].filter}}hasIBL(){const e=this.getMap().getLightManager();return!(!e||!e.getAmbientResource())}updateIBLDefines(e){const n=e.shaderDefines;let i=!1;this.hasIBL()?n[["HAS_IBL_LIGHTING"]]||(n.HAS_IBL_LIGHTING=1,i=!0):n[["HAS_IBL_LIGHTING"]]&&(delete n.HAS_IBL_LIGHTING,i=!0),i&&(e.shaderDefines=n)}getIBLRes(){const e=this.layer.getRenderer().canvas;return KG(e)}createIBLTextures(){const e=this.layer.getRenderer().canvas;YG(e,this.regl,this.getMap()),this.setToRedraw(!0),this.layer.fire("iblupdated")}disposeIBLTextures(){const e=this.layer.getRenderer().canvas;JG(e,this.getMap())}evaluateInFnTypeConfig(e,n,i,o,s){let a=this.dr;a||(a=this.dr={});const h=function(e){let n=0;const i=e&&e.length||0;if(!i)return n;let o;for(let s=0;s<i;s++)o=e.codePointAt(s),n=(n<<5)-n+o,n|=0;return n}(JSON.stringify(e));let l=a[h];return l||(l=a[h]=s?DD(e):RD(e)),l(i.getZoom(),o)}highlight(e){this.$n=e,this.pr=this.layer.getRenderer().getFrameTimestamp(),this.setToRedraw(!0)}cancelAllHighlight(){this.$n=null,this.pr=this.layer.getRenderer().getFrameTimestamp(),this.setToRedraw(!0)}mr(e,n){const{featureIds:i,pickingIdIndiceMap:o}=n;e.properties.aFeaIds=i,e.properties.pickingIdIndiceMap=o}Wi(e){if(e&&e.properties.isHalo)return;const{pickingIdIndiceMap:n}=e.geometry.properties,i=this.$n?function(e,n,i){const{aPickingId:o,feaIdPickingMap:s,features:a}=e.geometry.properties,h=new Map,l=i.keys();for(const e of l){const l=i.get(e);if(l)if(BU(l.id)){if(l.filter&&o){let e=null;for(let i=0;i<o.length;i++){o[i]!==e&&(e=o[i]);const s=a[e];l.filter(s&&s.feature,n)&&h.set(e,l)}}}else{const e=s[l.id];if(!e||!e.length)continue;for(let n=0;n<e.length;n++)h.set(e[n],l)}}return h}(e,this.layer,this.$n):null;rD.highlightMesh(this.regl,e,i,this.pr,n)}$i(e,n,i,o,s){let a=i.aAnchor;if(!a){const{aPosition:e}=n;a=i.aAnchor=e.slice(0)}let h=i.aTerrainAltitude;h||(h=i.aTerrainAltitude=new Float32Array(a.length/o),h.fill(TU)),this.yr(h,a,s.tileInfo,0,h.length-1),n.aTerrainAltitude?h.dirty&&this.gr(e,h):n.aTerrainAltitude=h,h.dirty=!1}gr(e,n){e&&e.updateData&&e.updateData("aTerrainAltitude",n)}yr(e,n,i,o,s){const{res:a,extent:h,extent2d:l,id:c}=i,A=this.pluginIndex,f=c+"-"+A;if(i.completeTerrainQuery||(i.completeTerrainQuery=[]),i.completeTerrainQuery[A])return;if(!i.completeTerrainQuery[A]&&this.Qi&&this.Qi.has(f)){const n=this.Qi.getAndRemove(f);return this.Qi.add(f,n),e.set(n.altitudeData),i.terrainTileInfos=n.terrainTileInfos,e.dirty=!0,void(i.completeTerrainQuery[A]=!0)}const d=this.layer,p=d.getMap(),g=d.getRenderer(),v=g&&g.getTerrainHelper();let w=i.terrainTileInfos;w||(w=i.terrainTileInfos=this.layer.queryTerrainTiles(i)),i.terrainQueryStatus||(i.terrainQueryStatus=[]);let C=!1,P=[];for(let e=0;e<i.terrainTileInfos.length;e++)if(P[e]=+v.isTerrainTileLoaded(i.terrainTileInfos[e].id),P[e]&&i.terrainQueryStatus[A]&&!i.terrainQueryStatus[A][e]){C=!0;break}if(!C&&i.terrainQueryStatus[A])return;const T=d.constructor;if(p.isInteracting()){const e=g.getFrameTimestamp();T.altitudeQueryFrameTimestamp!==e&&(T.altitudeQueryFrameTimestamp=e,T.altitudeQueryFrameTime=0);if(T.altitudeQueryFrameTime>d.options.altitudeQueryTimeLimitPerFrame)return}const S=performance.now();i.terrainQueryStatus[A]=P;const{xmin:I,ymax:E}=l,O=eV.set(I,E),k=this.layer.getTileSize().width/i.extent,L=n.length/e.length;let F=e.queryResult;F||(F=e.queryResult=new Map);let N=!0;for(let i=o;i<=s;i++){let o=n[i*L];o<0?o=0:o>h&&(o=h);let s=n[i*L+1];s<0?s=0:s>h&&(s=h);const l=o+s*h;let c,A,f=F.get(l);if(f||0===f)e[i]!==f&&(e[i]=f,e.dirty=!0);else{for(let e=0;e<w.length;e++)if(XG(w[e],I+k*o,E-k*s,a)){c=w[e];break}c&&(v.getRenderer().isTileCached(c.id)||e[i]===TU)&&(nV.set(o,s),A=this.layer.queryTilePointTerrain(nV,c,O,h,a)),f=e[i],A&&(f=null===A[0]?TU:A[0],iV[0]=f,f=iV[0]),e[i]!==f&&(e[i]=f,e.dirty=!0),A&&A[1]?F.set(l,f):N=!1}}T.altitudeQueryFrameTime=(T.altitudeQueryFrameTime||0)+(performance.now()-S),i.completeTerrainQuery[A]=N,N&&(this.Qi||(this.Qi=new Oa(4*this.layer.options.maxCacheSize)),this.Qi.add(f,{altitudeData:e,terrainTileInfos:w}))}}function aV(e,n){const i=e&&e.getCommandKey(this.regl)||"",o=n&&n.getCommandKey(this.regl)||"";return i.localeCompare(o)}function hV(e,n){return e.properties.level-n.properties.level}class Sl extends Al{createGeometry(e,n){if(!e.data)return{geometry:null,symbolIndex:e.symbolIndex};e.iconAtlas&&e.iconAtlas.image&&(e.iconAtlas.image.dataType=e.type,e.iconAtlas.image.type="icon"),e.glyphAtlas&&e.glyphAtlas.image&&(e.glyphAtlas.image.type="glyph");const i=FU({},e.data),o={primitive:this.getPrimitive(),positionSize:e.positionSize};i.aAltitude&&(o.altitudeAttribute="aAltitude");const s=new Lw(i,e.indices,0,o);return s.properties={features:n},e.iconAtlas&&(s.properties.iconAtlas=e.iconAtlas.image,s.properties.iconPositions=e.iconAtlas.positions),e.glyphAtlas&&(s.properties.glyphAtlas=e.glyphAtlas.image),PG(n)||(s.properties.aFeaIds=e.featureIds,this.mr(s,e)),e.markerPlacement&&(s.properties.markerPlacement=e.markerPlacement),e.textPlacement&&(s.properties.textPlacement=e.textPlacement),FU(s.properties,e.properties),{geometry:s,symbolIndex:e.symbolIndex}}getRayCastData(e,n){const{features:i,aFeaIds:o}=e.geometry.properties;return i&&o?i[o[n]]:null}getPrimitive(){return"triangles"}getRenderFBO(e){return e&&e.renderTarget&&e.renderTarget.fbo}supportRenderMode(e){return"noAa"===e}drawDebugAtlas(e){if(document.getElementById("MAPTALKS_ICON_DEBUG")){const n=document.getElementById("MAPTALKS_ICON_DEBUG");let i;if(n.width=e.width,n.height=e.height,n.style.width=e.width+"px",n.style.height=e.height+"px","alpha"===e.format){i=new Uint8ClampedArray(4*e.data.length);for(let n=0;n<e.data.length;n++)i[4*n+3]=e.data[n]}else i=new Uint8ClampedArray(e.data);const o=n.getContext("2d");o.imageSmoothingEnabled=!1,o.putImageData(new ImageData(i,e.width,e.height),0,0)}}}var lV="#include <gl2_vert>\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\nuniform mat4 projViewModelMatrix;\n#include <fbo_picking_vert>\n#include <vt_position_vert>\nvoid main() {\n  vec3 c = unpackVTPosition();\n  gl_Position = projViewModelMatrix * vec4(c, 1.);\n  fbo_picking_setData(gl_Position.w, true);\n}";function uV(e,n,i,o){if(o){const e=vw.resizeToPowerOfTwo(n.data,n.width,n.height);n.data=e}const s={width:n.width,height:n.height,data:n.data,format:n.format,mag:"linear",min:o?"linear mipmap linear":"linear",flipY:i,premultiplyAlpha:!0};if("icon"===n.type){const e="point"!==n.dataType?"repeat":"clamp";s.wrapS=e,s.wrapT=e}return e.texture(s)}const cV=[0,0],AV=[];function fV(e){if(!e.properties.iconPositions)return cV;let n,i=0;for(const o in e.properties.iconPositions)if(n=o,i++,i>1)return cV;if(!n)return cV;const o=e.properties.iconPositions[n],s=o.displaySize[1];return AV[0]=o.displaySize[0],AV[1]=s,AV}const dV=xv([]),pV={polygonFill:[1,1,1,1],polygonOpacity:1,uvScale:[1,1],uvOffset:[0,0],patternWidth:[0,0],patternOffset:[0,0]},gV=[],mV=new Zh(0,0),yV=new Zh(0,0),vV=new Zh(0,0),_V=[];class zl extends Sl{static getBloomSymbol(){return["polygonBloom"]}prepareSymbol(e){const n=e.polygonFill;Array.isArray(n)&&(3===n.length&&n.push(1),e.polygonFill=n.map((e=>255*e)))}supportRenderMode(e){return this.sceneConfig.antialias||void 0===this.sceneConfig.antialias?"fxaa"===e||"fxaaBeforeTaa"===e:super.supportRenderMode(e)}isBloom(e){return!!this.getSymbol(e.properties.symbolIndex)[zl.getBloomSymbol()[0]]}forbiddenTerrainUpscale(){return!0}needPolygonOffset(){return!0}getAnalysisMeshes(){return this.isVisible()?this.scene.getMeshes().filter((e=>0===e.properties.level)):gV}createMesh(e,n,i){const o=this.getMap(),{tilePoint:s}=i,{geometry:a,symbolIndex:h,ref:l}=e,c=this.layer instanceof Qp,A=this.layer.getTileSize().width,f=a.properties.tileExtent/A,d=a.properties.tileResolution,p=o.pointAtResToCoord(mV.set(s[0],s[1]),d),g={tileExtent:a.properties.tileExtent,tileRatio:f},v=this.getSymbol(h),w=this.getSymbolDef(h);if(ED(w.polygonPatternFileOrigin)&&this.vr(w,e,c?[0,0]:s,d),(ED(w.polygonPatternFileWidth)||ED(w.polygonPatternFileWidth))&&this.wr(w,e,c?f:1,p,d),w.uvOffsetInMeter&&ED(w.uvOffset)&&this.Ar(w,e,p,d),jU(g,"polygonFill",v,"polygonFill",pV.polygonFill,VU(this.colorCache)),jU(g,"polygonOpacity",v,"polygonOpacity",pV.polygonOpacity),jU(g,"uvScale",v,"uvScale",pV.uvScale),void 0===l){const e=this.getFnTypeConfig(h);SG(a,w,e,this.layer),a.generateBuffers(this.regl)}const C=a.properties.iconAtlas,P=2048;if(C&&a.data.aTexInfo){const e=[];Object.defineProperty(g,"uvOrigin",{enumerable:!0,get:()=>{const n=g.tileScale;if(a.data.aPatternOrigin)return e[0]=s[0]*n%P,e[1]=s[1]*n%P,e;const i=v.polygonPatternFileOrigin;return i?(mV.set(i[0],i[1]),o.coordToPointAtRes(mV,d,yV),Zx(e,s[0]-yV.x,s[1]-yV.y)):(e[0]=s[0]*n%P,e[1]=s[1]*n%P,e)}});const n=[];Object.defineProperty(g,"patternWidth",{enumerable:!0,get:()=>{if(a.data.aPatternWidth)return pV.patternWidth;const e=w.polygonPatternFileWidth,i=w.polygonPatternFileHeight;if(!e&&!i)return pV.patternWidth;const[o,s]=this.Mr(_V,e,i,c?f:1,p,d);return Zx(n,o,s)}}),Object.defineProperty(g,"uvOffset",{enumerable:!0,get:()=>a.data.aPatternOffset||w.uvOffsetInMeter?pV.uvOffset:v.uvOffset||pV.uvOffset});const i=[];Object.defineProperty(g,"patternOffset",{enumerable:!0,get:()=>{if(a.data.aPatternOffset)return pV.uvOffset;if(!w.uvOffsetInMeter)return pV.uvOffset;const e=w.uvOffset;if(!e)return pV.uvOffset;const n=KU(o,e[0],p,d),s=KU(o,e[1],p,d);return Zx(i,n,s)}}),Object.defineProperty(g,"tileScale",{enumerable:!0,get:function(){return w.polygonPatternFileWidth||w.polygonPatternFileHeight?1:a.properties.tileResolution/o.getResolution()}}),g.polygonPatternFile=uV(this.regl,C,!1,!1),g.atlasSize=[C.width,C.height],this.drawDebugAtlas(C)}const T=new cC(g,pV),S=new bC(a,T,{castShadow:!1,picking:!0}),I={};return C&&a.data.aTexInfo&&(I.HAS_PATTERN=1),C&&a.data.aTexCoord&&(I.HAS_TEX_COORD=1,I.INVALID_TEX_COORD=Lj+".0"),a.data.aAltitude&&(I.HAS_ALTITUDE=1),a.data.aColor&&(I.HAS_COLOR=1),a.data.aOpacity&&(I.HAS_OPACITY=1),a.data.aUVScale&&(I.HAS_UV_SCALE=1),a.data.aUVOffset&&(I.HAS_UV_OFFSET=1),a.data.aPatternOrigin&&(I.HAS_PATTERN_ORIGIN=1),a.data.aPatternWidth&&(I.HAS_PATTERN_WIDTH=1),a.data.aPatternOffset&&(I.HAS_PATTERN_OFFSET=1),c&&(I.IS_VT=1),S.setDefines(I),S.setLocalTransform(n),S.properties.symbolIndex=h,S}wr(e,n,i,o,s){if(!(n=n&&n.geometry))return;const a=n.properties.features;if(PG(a))return;const h=e.polygonPatternFileWidth,l=e.polygonPatternFileHeight,c=RD(e.polygonPatternFileOrigin);let A,f;ED(h)&&(A=RD(h)),ED(l)&&(f=RD(l));const{aPickingId:d,aPatternOrigin:p}=n.data,g=new Float32Array(2*d.length);let v,w,C;for(let e=0,n=d.length;e<n;e++){let n,P;if(d[e]===v){g[2*e]=w,g[2*e+1]=C;continue}const T=a[d[e]];if(n=A?A(null,T.feature.properties):h,P=f?f(null,T.feature.properties):l,v=d[e],n||P){let a=o;if(p){const e=c(null,T.feature.properties);e&&(a=vV.set(e[0],e[1]))}const[h,l]=this.Mr(_V,n,P,i,a,s);w=g[2*e]=h,C=g[2*e+1]=l}else w=g[2*e]=0,C=g[2*e+1]=0}n.data.aPatternWidth=g}Ar(e,n,i,o){if(!(n=n&&n.geometry))return;const s=n.properties.features;if(PG(s))return;const a=this.getMap();let h=ED(e.uvOffsetInMeter)&&DD(e.uvOffsetInMeter);const l=RD(e.uvOffset),c=RD(e.polygonPatternFileOrigin),{aPickingId:A,aPatternOrigin:f}=n.data,d=new Float32Array(2*A.length);let p,g,v;for(let e=0,n=A.length;e<n;e++){if(A[e]===p){d[2*e]=g,d[2*e+1]=v;continue}const n=s[A[e]],w=l(null,n.feature.properties);let C=!0;if(h&&(C=h(null,n.feature.properties)),p=A[e],w&&C){let s=i;if(f){const e=c(null,n.feature.properties);e&&(s=vV.set(e[0],e[1]))}const h=KU(a,w[0],s,o),l=KU(a,w[0],s,o);g=d[2*e]=h,v=d[2*e+1]=l}else g=d[2*e]=0,v=d[2*e+1]=0}n.data.aPatternOffset=d}vr(e,n,i,o){if(!(n=n&&n.geometry))return;const s=n.properties.features;if(PG(s))return;const a=this.getMap(),h=RD(e.polygonPatternFileOrigin),l=n.data.aPickingId,c=new Float32Array(2*l.length);let A,f,d;for(let e=0,n=l.length;e<n;e++){if(l[e]===A){c[2*e]=f,c[2*e+1]=d;continue}A=l[e];const n=h(null,s[A].feature.properties);n?(mV.set(n[0],n[1]),a.coordToPointAtRes(mV,o,yV),f=c[2*e]=yV.x,d=c[2*e+1]=yV.y):(f=c[2*e]=i[0],d=c[2*e+1]=i[1])}n.data.aPatternOrigin=c}createFnTypeConfig(e,n){const i=DD(n.polygonFill),o=RD(n.polygonOpacity),s=RD(n.uvScale),a=RD(n.uvOffset),h=new Uint8Array(1),l=new Uint16Array(2),c=new Uint8Array(2);return[{attrName:"aColor",symbolName:"polygonFill",type:Uint8Array,width:4,define:"HAS_COLOR",evaluate:(n,o)=>{let s=i(e.getZoom(),n);return ED(s)&&(s=this.evaluateInFnTypeConfig(s,o,e,n,!0)),Array.isArray(s)||(s=this.colorCache[s]=this.colorCache[s]||Ck(s).unitArray()),s=GU(s),s}},{attrName:"aOpacity",symbolName:"polygonOpacity",type:Uint8Array,width:1,define:"HAS_OPACITY",evaluate:(n,i)=>{let s=o(e.getZoom(),n);return ED(s)&&(s=this.evaluateInFnTypeConfig(s,i,e,n)),h[0]=255*s,h[0]}},{attrName:"aUVScale",symbolName:"uvScale",type:Uint16Array,width:2,define:"HAS_UV_SCALE",evaluate:n=>{const i=s(e.getZoom(),n);return l[0]=255*i[0],l[1]=255*i[1],l}},{attrName:"aUVOffset",symbolName:"uvOffset",type:Uint8Array,width:2,define:"HAS_UV_OFFSET",evaluate:n=>{const i=a(e.getZoom(),n);return c[0]=255*i[0],c[1]=255*i[1],c}}]}paint(e){this.isShadowIncludeChanged(e)&&(this.shader.dispose(),this._r(e)),super.paint(e)}isEnableTileStencil(e){const n="VectorTileLayer"===this.layer.getJSONType(),i=this.layer instanceof Qp;return!(e&&e.isRenderingTerrain&&this.isTerrainSkin())&&(n||i&&this.isOnly2D())}init(e){const n=this.canvas,i={x:(e,n)=>n.viewport?n.viewport.x:0,y:(e,n)=>n.viewport?n.viewport.y:0,width:(e,i)=>i.viewport?i.viewport.width:n?n.width:1,height:(e,i)=>i.viewport?i.viewport.height:n?n.height:1};this.renderer=new PC(this.regl);const o={viewport:i,stencil:{enable:()=>this.isEnableTileStencil(e),func:{cmp:()=>this.isOnly2D()?"=":"<=",ref:(e,n)=>n.stencilRef},op:{fail:"keep",zfail:"keep",zpass:()=>{const e="VectorTileLayer"===this.layer.getJSONType(),n=this.isOnly2D();return e&&n?"zero":"replace"}}},depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],mask:(e,n)=>{if(!BU(this.sceneConfig.depthMask))return!!this.sceneConfig.depthMask;if(n.hasSSRGround)return!0;if(n.meshConfig.transparent)return!1;const i=n.polygonOpacity;return!(ZU(i)&&i<1)},func:this.sceneConfig.depthFunc||"<="},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}};if(this._r(e,o),this.pickingFBO){const e=[];this.picking=[new XM(this.renderer,{vert:lV,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(n,i){return Cv(e,i.projViewMatrix,i.modelMatrix),e}}],extraCommandProps:o},this.pickingFBO,this.getMap())]}}_r(e,n){const i=[],o=[{name:"projViewModelMatrix",type:"function",fn:function(e,n){return Cv(i,n.projViewMatrix,n.modelMatrix),i}}],s={};this.fillIncludes(s,o,e),this.shader=new eP({vert:"#define SHADER_NAME FILL\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\n#ifdef HAS_COLOR\nattribute vec4 aColor;\nvarying vec4 vColor;\n#endif\n#ifdef HAS_OPACITY\nattribute float aOpacity;\nvarying float vOpacity;\n#endif\nuniform mat4 projViewModelMatrix;\n#ifndef IS_VT\nuniform mat4 modelMatrix;\n#endif\n#ifdef HAS_PATTERN\n#ifdef HAS_TEX_COORD\nattribute vec2 aTexCoord;\n#endif\nattribute vec4 aTexInfo;\nuniform vec2 patternWidth;\nuniform vec2 patternOffset;\nuniform vec2 uvOrigin;\nuniform vec2 uvScale;\n#ifdef IS_VT\nuniform float tileRatio;\nuniform float tileScale;\n#else\nuniform float glScale;\n#endif\n#ifdef HAS_UV_SCALE\nattribute vec2 aUVScale;\nvarying vec2 vUVScale;\n#endif\n#ifdef HAS_UV_OFFSET\nattribute vec2 aUVOffset;\nvarying vec2 vUVOffset;\n#endif\n#ifdef HAS_PATTERN_WIDTH\nattribute vec2 aPatternWidth;\n#endif\n#ifdef HAS_PATTERN_ORIGIN\nattribute vec2 aPatternOrigin;\n#endif\n#ifdef HAS_PATTERN_OFFSET\nattribute vec2 aPatternOffset;\n#endif\nvarying vec2 vTexCoord;\nvarying vec4 vTexInfo;\nvec2 c(vec2 d, vec2 e) {\n  \n#ifdef IS_VT\nfloat f = d.x / e.x;\n  float h = d.y / e.y;\n  return vec2(f, h);\n#else\nfloat i = glScale;\n#ifdef HAS_PATTERN_WIDTH\nfloat j = sign(length(aPatternWidth));\n  i = mix(glScale, 1., j);\n#endif\nvec2 k = uvOrigin;\n#ifdef HAS_PATTERN_ORIGIN\nk = aPatternOrigin;\n#endif\n#ifdef HAS_PATTERN_OFFSET\nvec2 l = aPatternOffset;\n#else\nvec2 l = patternOffset;\n#endif\nk += l;\n  float f = (d.x - k.x) * i / e.x;\n  float h = (d.y - k.y) * i / e.y;\n  return vec2(f, -h);\n#endif\n}\nvec2 m(vec4 n, vec2 o) {\n  \n#ifdef IS_VT\n#ifdef HAS_PATTERN_OFFSET\nvec2 l = aPatternOffset;\n#else\nvec2 l = patternOffset;\n#endif\nvec2 k = uvOrigin + l;\n#ifdef HAS_PATTERN_ORIGIN\nk = k - aPatternOrigin * tileScale;\n#endif\nfloat j = sign(length(patternWidth));\n  vec2 A = mix(o, patternWidth, j);\n#ifdef HAS_PATTERN_WIDTH\nA = aPatternWidth;\n#endif\nvec2 B = k * vec2(1., -1.) / A;\n  return mod(B, 1.) + c(n.xy * tileScale / tileRatio, A);\n#else\nvec2 A = o;\n#ifdef HAS_PATTERN_WIDTH\nfloat j = sign(length(aPatternWidth));\n  A = mix(o, aPatternWidth, j);\n#endif\nvec4 C = modelMatrix * n;\n  return c(C.xy, A);\n#endif\n}\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_vert>\n#endif\n#include <vt_position_vert>\n#include <highlight_vert>\nvoid main() {\n  vec3 D = unpackVTPosition();\n  vec4 n = vec4(D, 1.);\n  gl_Position = projViewModelMatrix * n;\n#ifdef HAS_PATTERN\nvec2 o = aTexInfo.zw + 1.;\n  vTexInfo = vec4(aTexInfo.xy, o);\n#ifdef HAS_TEX_COORD\nif(aTexCoord.x == INVALID_TEX_COORD) {\n    vTexCoord = m(n, o);\n  } else {\n    vTexCoord = aTexCoord;\n  }\n#else\nvTexCoord = m(n, o);\n#endif\n#ifdef HAS_UV_SCALE\nvUVScale = aUVScale / 255.;\n#endif\n#ifdef HAS_UV_OFFSET\nvUVOffset = aUVOffset / 255.;\n#endif\n#endif\n#ifdef HAS_COLOR\nvColor = aColor / 255.;\n#endif\nhighlight_setVarying();\n#ifdef HAS_OPACITY\nvOpacity = aOpacity / 255.;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nshadow_computeShadowPars(n);\n#endif\n}",frag:"#define SHADER_NAME FILL\nprecision mediump float;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_frag>\n#endif\n#ifdef HAS_PATTERN\n#ifdef HAS_UV_SCALE\nvarying vec2 vUVScale;\n#else\nuniform highp vec2 uvScale;\n#endif\n#ifdef HAS_UV_OFFSET\nvarying vec2 vUVOffset;\n#else\nuniform vec2 uvOffset;\n#endif\n#endif\n#ifdef HAS_PATTERN\nuniform sampler2D polygonPatternFile;\nuniform vec2 atlasSize;\nvarying vec2 vTexCoord;\nvarying vec4 vTexInfo;\nvec2 c() {\n  \n#ifdef HAS_UV_SCALE\nvec2 d = vUVScale;\n#else\nvec2 d = uvScale;\n#endif\n#ifdef HAS_UV_OFFSET\nvec2 e = vUVOffset;\n#else\nvec2 e = uvOffset;\n#endif\nvec2 f = mod(vTexCoord * d + e, 1.);\n  vec2 h = vTexInfo.xy;\n  vec2 i = vTexInfo.zw;\n  return (h + f * i) / atlasSize;\n}\n#endif\n#ifdef HAS_COLOR\nvarying vec4 vColor;\n#else\nuniform vec4 polygonFill;\n#endif\n#include <highlight_frag>\n#ifdef HAS_OPACITY\nvarying float vOpacity;\n#else\nuniform lowp float polygonOpacity;\n#endif\nuniform float layerOpacity;\nuniform float tileExtent;\nvoid main() {\n  \n#ifdef HAS_COLOR\nvec4 j = vColor;\n#else\nvec4 j = polygonFill;\n#endif\n#ifdef HAS_PATTERN\nif(vTexInfo.z * vTexInfo.w > 1.) {\n    vec2 f = c();\n    j = texture2D(polygonPatternFile, f);\n  }\n#endif\n#ifdef HAS_OPACITY\ngl_FragColor = j * vOpacity;\n#else\ngl_FragColor = j * polygonOpacity;\n#endif\ngl_FragColor *= layerOpacity;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nfloat k = shadow_computeShadow();\n  gl_FragColor.rgb = shadow_blend(gl_FragColor.rgb, k);\n#endif\ngl_FragColor = highlight_blendColor(gl_FragColor);\n}",uniforms:o,defines:s,extraCommandProps:n})}getUniformValues(e,n){const i=n&&n.isRenderingTerrainSkin,o={projViewMatrix:i?dV:e.projViewMatrix,glScale:n&&n.isRenderingTerrainSkin?1:1/e.getGLScale(),viewport:i&&n&&n.viewport,hasSSRGround:n&&n.hasSSRGround};return this.setIncludeUniformValues(o,n),o}Mr(e,n,i,o,s,a){let h,l;const c=this.getMap();return n&&(h=KU(c,n,s,a)),i&&(l=KU(c,i,s,a,1)),h=h||l,l=l||h,e[0]=h,e[1]=l,e}}var xV="#define SHADER_NAME LINE\n#define AA_CLIP_LIMIT 2.0\n#define AA_LINE_WIDTH 16.0\n#define DEVICE_PIXEL_RATIO 1.0\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n#define EXTRUDE_SCALE 63.0\n#define EXTRUDE_MOD 64.0\n#define MAX_LINE_DISTANCE 65535.0\n#ifdef PICKING_MODE\n#include <gl2_vert>\n#endif\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\n#if defined(HAS_PATTERN) || defined(HAS_DASHARRAY)\nattribute vec3 aExtrude;\n#else\nattribute vec2 aExtrude;\n#endif\n#if defined(HAS_PATTERN) || defined(HAS_DASHARRAY) || defined(HAS_GRADIENT) || defined(HAS_TRAIL)\nattribute float aLinesofar;\nvarying highp float vLinesofar;\n#endif\nuniform float cameraToCenterDistance;\n#if defined(HAS_STROKE_WIDTH)\nattribute float aLineStrokeWidth;\n#else\nuniform float lineStrokeWidth;\n#endif\nuniform mat4 positionMatrix;\nuniform mat4 projViewModelMatrix;\nuniform mat4 modelMatrix;\nuniform float tileResolution;\nuniform float resolution;\nuniform float tileRatio;\nuniform float isRenderingTerrain;\n#if defined(HAS_LINE_DX) || defined(HAS_LINE_DY)\nattribute vec2 aLineDxDy;\n#endif\n#ifndef HAS_LINE_DX\nuniform float lineDx;\n#endif\n#ifndef HAS_LINE_DY\nuniform float lineDy;\n#endif\nuniform vec2 canvasSize;\nuniform float layerScale;\nvarying vec2 vNormal;\nvarying vec2 vWidth;\nvarying float vGammaScale;\n#ifndef ENABLE_TILE_STENCIL\nvarying vec2 vPosition;\n#endif\n#ifdef USE_LINE_OFFSET\nattribute vec2 aExtrudeOffset;\n#endif\n#ifdef HAS_LINE_WIDTH\nattribute float aLineWidth;\n#else\nuniform float lineWidth;\n#endif\n#ifndef PICKING_MODE\n#ifndef HAS_GRADIENT\n#ifdef HAS_COLOR\nattribute vec4 aColor;\nvarying vec4 vColor;\n#endif\n#ifdef HAS_PATTERN\n#if defined(HAS_PATTERN_ANIM) || defined(HAS_PATTERN_GAP)\nattribute vec2 aLinePattern;\n#endif\n#ifdef HAS_PATTERN_ANIM\nvarying float vLinePatternAnimSpeed;\n#endif\n#ifdef HAS_PATTERN_GAP\nvarying float vLinePatternGap;\n#endif\nattribute vec4 aTexInfo;\nvarying vec4 vTexInfo;\n#endif\n#ifdef HAS_DASHARRAY\n#ifdef HAS_DASHARRAY_ATTR\nattribute vec4 aDasharray;\nvarying vec4 vDasharray;\n#endif\n#ifdef HAS_DASHARRAY_COLOR\nattribute vec4 aDashColor;\nvarying vec4 vDashColor;\n#endif\n#endif\n#endif\n#ifdef HAS_STROKE_COLOR\nattribute vec4 aStrokeColor;\nvarying vec4 vStrokeColor;\n#endif\n#ifdef HAS_OPACITY\nattribute float aOpacity;\nvarying float vOpacity;\n#endif\n#ifdef HAS_GRADIENT\nattribute float aGradIndex;\nvarying float vGradIndex;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_vert>\n#endif\n#include <highlight_vert>\n#else\n#include <fbo_picking_vert>\n#endif\nvarying vec3 vVertex;\n#include <vt_position_vert>\nvoid main() {\n  vec3 c = unpackVTPosition();\n  float d = mod(abs(aExtrude.x), 2.);\n  float e = mod(abs(aExtrude.y), 2.);\n  vNormal = vec2(d, e * 2. - 1.);\n  vec4 f = vec4(c, 1.);\n  vec4 h = projViewModelMatrix * positionMatrix * f;\n  if(isRenderingTerrain == 1.) {\n    vVertex = (positionMatrix * f).xyz;\n  } else {\n    vVertex = (modelMatrix * positionMatrix * f).xyz;\n  }\n#ifdef HAS_STROKE_WIDTH\nfloat i = aLineStrokeWidth / 2. * layerScale;\n#else\nfloat i = lineStrokeWidth;\n#endif\n#ifdef HAS_LINE_WIDTH\nfloat j = aLineWidth / 2. * layerScale;\n#else\nfloat j = lineWidth * layerScale;\n#endif\nfloat k = j / 2. + i;\n  float l = sign(i) * j / 2.;\n  float m = l + sign(l) * ANTIALIASING;\n  float n = k + sign(k) * ANTIALIASING;\n#ifdef USE_LINE_OFFSET\nvec2 o = lineOffset * (vNormal.y * (aExtrude.xy - aExtrudeOffset) + aExtrudeOffset);\n  vec2 u = (n * aExtrude.xy + o) / EXTRUDE_SCALE;\n#else\nvec2 v = aExtrude.xy / EXTRUDE_SCALE;\n  vec2 u = n * v;\n#endif\nfloat A = tileResolution / resolution;\n  vec4 B = vec4(c + vec3(u, .0) * tileRatio / A, 1.);\n  gl_Position = projViewModelMatrix * positionMatrix * B;\n  if(isRenderingTerrain == .0) {\n    float C = min(AA_CLIP_LIMIT / canvasSize.x, AA_CLIP_LIMIT / canvasSize.y);\n    float D = distance(gl_Position.xy / gl_Position.w, h.xy / h.w) - C;\n    if(D * j < .0) {\n      float E = -D / C;\n      float F = E * E * E * E * AA_LINE_WIDTH;\n      u += F * v;\n      n += F / 6.;\n      B = vec4(c + vec3(u, .0) * tileRatio / A, 1.);\n      gl_Position = projViewModelMatrix * positionMatrix * B;\n    }\n  }\n#ifdef HAS_LINE_DX\nfloat G = aLineDxDy[0];\n#else\nfloat G = lineDx;\n#endif\n#ifdef HAS_LINE_DY\nfloat H = aLineDxDy[1];\n#else\nfloat H = lineDy;\n#endif\nfloat I = gl_Position.w;\n  gl_Position.xy += vec2(G, H) * 2. / canvasSize * I;\n#ifndef PICKING_MODE\nvWidth = vec2(n, m);\n  if(isRenderingTerrain == 1.) {\n    vGammaScale = 1.;\n  } else {\n    vGammaScale = I / cameraToCenterDistance;\n  }\n#ifndef ENABLE_TILE_STENCIL\nvPosition = c.xy;\n#ifdef USE_LINE_OFFSET\nvPosition += tileRatio * o / EXTRUDE_SCALE;\n#endif\n#endif\n#if defined(HAS_PATTERN) || defined(HAS_DASHARRAY) || defined(HAS_GRADIENT)\n#ifdef HAS_GRADIENT\nvLinesofar = aLinesofar / MAX_LINE_DISTANCE;\n  vGradIndex = aGradIndex;\n#else\nfloat J = aLinesofar - k * aExtrude.z / EXTRUDE_SCALE / A * tileRatio;\n  vLinesofar = J / tileRatio * A;\n#endif\n#endif\n#ifndef HAS_GRADIENT\n#ifdef HAS_COLOR\nvColor = aColor;\n#endif\n#ifdef HAS_DASHARRAY\n#ifdef HAS_DASHARRAY_ATTR\nvDasharray = aDasharray;\n#endif\n#ifdef HAS_DASHARRAY_COLOR\nvDashColor = aDashColor / 255.;\n#endif\n#endif\n#ifdef HAS_PATTERN\nvTexInfo = vec4(aTexInfo.xy, aTexInfo.zw + 1.);\n#ifdef HAS_PATTERN_ANIM\nvLinePatternAnimSpeed = aLinePattern[0] / 127.;\n#endif\n#ifdef HAS_PATTERN_GAP\nvLinePatternGap = aLinePattern[1] / 10.0;\n#endif\n#endif\n#endif\n#ifdef HAS_STROKE_COLOR\nvStrokeColor = aStrokeColor;\n#endif\n#ifdef HAS_OPACITY\nvOpacity = aOpacity / 255.;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nshadow_computeShadowPars(B);\n#endif\nhighlight_setVarying();\n#else\nfbo_picking_setData(I, true);\n#endif\n}";const bV=xv([]),wV=[];class jl extends Sl{static getBloomSymbol(){return["lineBloom"]}isUniqueStencilRefPerTile(){return!1}prepareSymbol(e){const n=e.lineColor;Array.isArray(n)&&(3===n.length&&n.push(1),e.lineColor=n.map((e=>255*e)));const i=e.lineStrokeColor;Array.isArray(i)&&(3===i.length&&i.push(1),e.lineStrokeColor=i.map((e=>255*e)));const o=e.lineDashColor;Array.isArray(o)&&(3===o.length&&o.push(1),e.lineDashColor=o.map((e=>255*e)))}isAnimating(){if(this.Sr)return!0;const e=this.getSymbols(),n=this.sceneConfig.trailAnimation;if(n&&n.enable)return!0;for(let n=0;n<e.length;n++)if(e[n].linePatternFile&&e[n].linePatternAnimSpeed)return!0;return!1}needToRedraw(){return!!super.needToRedraw()||!!this.isAnimating()}isBloom(e){return!!this.getSymbol(e.properties.symbolIndex)[jl.getBloomSymbol()[0]]}needPolygonOffset(){return!0}createMesh(e,n){if(!e.geometry)return null;const{geometry:i,symbolIndex:o,ref:s}=e,a=this.getSymbolDef(o);void 0===s&&SG(i,a,this.getFnTypeConfig(o),this.layer);const h=this.getSymbol(o),l={tileResolution:i.properties.tileResolution,tileRatio:i.properties.tileRatio,tileExtent:i.properties.tileExtent};this.setLineUniforms(h,l),jU(l,"lineColor",h,"lineColor","#fff",VU(this.colorCache)),jU(l,"linePatterGapColor",h,"linePatterGapColor",[0,0,0,0],VU(this.colorCache)),jU(l,"lineStrokeColor",h,"lineStrokeColor",[0,0,0,0],VU(this.colorCache)),jU(l,"lineDasharray",h,"lineDasharray",[0,0,0,0],(e=>{let n;if(e&&e.length){1===e.length?n=[e[0],e[0],e[0],e[0]]:2===e.length?n=[e[0],e[1],e[0],e[1]]:3===e.length?n=[e[0],e[1],e[2],e[2]]:4===e.length?n=e:e.length>4&&(n=e.slice(0,4))}return n||[0,0,0,0]})),jU(l,"lineDashColor",h,"lineDashColor",[0,0,0,0],VU(this.colorCache));const c=i.properties.iconAtlas,A=this.layer instanceof Qp;c&&(l.linePatternFile=uV(this.regl,c,!1,!1),l.atlasSize=c?[c.width,c.height]:[0,0],l.flipY=A?-1:1,this.drawDebugAtlas(c)),void 0===s&&i.generateBuffers(this.regl);const f=new cC(l),d=new bC(i,f,{castShadow:!1,picking:!0});d.setLocalTransform(n),d.positionMatrix=this.getAltitudeOffsetMatrix();const p={};return c&&(p.HAS_PATTERN=1),d.properties.symbolIndex=o,this.kr(d,p),i.data.aColor&&(p.HAS_COLOR=1),i.data.aStrokeColor&&(p.HAS_STROKE_COLOR=1),this.setMeshDefines(p,i,a),i.data.aAltitude&&(p.HAS_ALTITUDE=1),d.setDefines(p),d}addMesh(...e){delete this.Sr;const n=e[0];Array.isArray(n)?n.forEach((e=>{this.Pr(e)})):this.Pr(n),super.addMesh(...e)}Pr(e){if(!e.geometry.aLineWidth&&e.material.get("lineWidth")<=0||!e.geometry.aOpacity&&e.material.get("lineOpacity")<=0)return;const n=e.defines;this.kr(e,n),e.setDefines(n),e.geometry.properties.hasPatternAnim&&(this.Sr=1)}kr(e,n){const i=e.geometry,o=this.getSymbol(e.properties.symbolIndex);i.data.aDasharray||Array.isArray(o.lineDasharray)&&o.lineDasharray.reduce(((e,n)=>e+n),0)>0?(n.HAS_DASHARRAY=1,i.data.aDasharray&&(n.HAS_DASHARRAY_ATTR=1),i.data.aDashColor&&(n.HAS_DASHARRAY_COLOR=1)):n.HAS_DASHARRAY&&delete n.HAS_DASHARRAY}setLineUniforms(e,n){jU(n,"lineWidth",e,"lineWidth",2),jU(n,"lineOpacity",e,"lineOpacity",1),jU(n,"lineStrokeWidth",e,"lineStrokeWidth",0),jU(n,"lineBlur",e,"lineBlur",.7),jU(n,"lineOffset",e,"lineOffset",0),jU(n,"lineDx",e,"lineDx",0),jU(n,"lineDy",e,"lineDy",0),jU(n,"linePatternAnimSpeed",e,"linePatternAnimSpeed",0),jU(n,"linePatternGap",e,"linePatternGap",0)}setMeshDefines(e,n,i){n.data.aOpacity&&(e.HAS_OPACITY=1),n.data.aLineWidth&&(e.HAS_LINE_WIDTH=1),n.data.aLineStrokeWidth&&(e.HAS_STROKE_WIDTH=1),BG(i.lineDx)&&(e.HAS_LINE_DX=1),BG(i.lineDy)&&(e.HAS_LINE_DY=1),BG(i.linePatternAnimSpeed)&&(e.HAS_PATTERN_ANIM=1),BG(i.linePatternGap)&&(e.HAS_PATTERN_GAP=1)}paint(e){this.isShadowIncludeChanged(e)&&(this.shader.dispose(),this.createShader(e)),super.paint(e)}createFnTypeConfig(e,n){const i=DD(n.lineColor),o=DD(n.aLinePatternAnimSpeed),s=DD(n.aLinePatternGap),a=this.createShapeFnTypeConfigs(e,n),h=new Int8Array(2);return[{attrName:"aColor",symbolName:"lineColor",type:Uint8Array,width:4,define:"HAS_COLOR",evaluate:(n,o)=>{let s=i(e.getZoom(),n);return ED(s)&&(s=this.evaluateInFnTypeConfig(s,o,e,n,!0)),Array.isArray(s)||(s=this.colorCache[s]=this.colorCache[s]||Ck(s).unitArray()),s=GU(s),s}},{attrName:"aLinePattern",symbolName:"linePatternAnimSpeed",type:Int8Array,width:2,related:["linePatternGap"],define:"HAS_LINE_PATTERN",evaluate:(n,i,s,a)=>{let l=o(e.getZoom(),n);return BU(l)&&(l=0),0!==l&&(i.properties.hasPatternAnim=1),h[0]=l/127,h[1]=s[a+1],h}},{attrName:"aLinePattern",symbolName:"linePatternGap",type:Int8Array,width:2,related:["linePatternAnimSpeed"],define:"HAS_LINE_PATTERN",evaluate:(n,i,o,a)=>{let l=s(e.getZoom(),n);return BU(l)&&(l=0),h[1]=10*l,h[0]=o[a],h}}].concat(a)}createShapeFnTypeConfigs(e,n){const i=RD(n.lineWidth),o=RD(n.lineOpacity),s=RD(n.lineStrokeWidth),a=RD(n.lineDx),h=RD(n.lineDy),l=new Uint16Array(1),c=new Int8Array(1);return[{attrName:"aLineWidth",symbolName:"lineWidth",type:Uint8Array,width:1,define:"HAS_LINE_WIDTH",evaluate:(n,o)=>{let s=i(e.getZoom(),n);return ED(s)&&(s=this.evaluateInFnTypeConfig(s,o,e,n)),l[0]=Math.round(2*s),l[0]}},{attrName:"aLineStrokeWidth",symbolName:"lineStrokeWidth",type:Uint8Array,width:1,define:"HAS_STROKE_WIDTH",evaluate:n=>{const i=s(e.getZoom(),n);return l[0]=Math.round(2*i),l[0]}},{attrName:"aLineDxDy",symbolName:"lineDx",type:Int8Array,width:2,define:"HAS_LINE_DX",evaluate:n=>{const i=a(e.getZoom(),n);return c[0]=i,c[0]}},{attrName:"aLineDxDy",symbolName:"lineDy",type:Int8Array,width:2,define:"HAS_LINE_DY",evaluate:n=>{const i=h(e.getZoom(),n);return c[0]=i,c[0]}},{attrName:"aOpacity",symbolName:"lineOpacity",type:Uint8Array,width:1,define:"HAS_OPACITY",evaluate:(n,i)=>{let s=o(e.getZoom(),n);return ED(s)&&(s=this.evaluateInFnTypeConfig(s,i,e,n)),l[0]=255*s,l[0]}}]}updateSceneConfig(e){e.trailAnimation&&this.createShader(this.Tr)}init(e){this.renderer=new PC(this.regl),this.createShader(e),this.pickingFBO&&(this.picking=[new XM(this.renderer,{vert:"#define PICKING_MODE 1\n"+xV,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(e,n){const i=[];return Cv(i,n.projViewMatrix,n.modelMatrix),i}}],extraCommandProps:this.getExtraCommandProps()},this.pickingFBO,this.getMap())])}createShader(e){this.Tr=e;const n=[],i={};this.fillIncludes(i,n,e),this.sceneConfig.trailAnimation&&this.sceneConfig.trailAnimation.enable&&(i.HAS_TRAIL=1);const o=[];n.push({name:"projViewModelMatrix",type:"function",fn:function(e,n){return Cv(o,n.projViewMatrix,n.modelMatrix),o}}),this.shader=new eP({vert:xV,frag:"#define SHADER_NAME LINE\n#define DEVICE_PIXEL_RATIO 1.0\nprecision highp float;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_frag>\n#endif\nuniform lowp float blendSrcIsOne;\nuniform lowp float lineBlur;\nuniform float isRenderingTerrain;\n#ifdef HAS_COLOR\nvarying vec4 vColor;\n#else\nuniform lowp vec4 lineColor;\n#endif\n#include <highlight_frag>\n#ifdef HAS_STROKE_COLOR\nvarying vec4 vStrokeColor;\n#else\nuniform lowp vec4 lineStrokeColor;\n#endif\n#ifdef HAS_OPACITY\nvarying float vOpacity;\n#else\nuniform lowp float lineOpacity;\n#endif\nuniform float layerOpacity;\n#ifdef HAS_PATTERN\nuniform sampler2D linePatternFile;\nuniform vec2 atlasSize;\nuniform float flipY;\n#ifdef HAS_PATTERN_ANIM\nvarying float vLinePatternAnimSpeed;\n#else\nuniform float linePatternAnimSpeed;\n#endif\n#ifdef HAS_PATTERN_GAP\nvarying float vLinePatternGap;\n#else\nuniform float linePatternGap;\n#endif\nuniform vec4 linePatterGapColor;\nvarying vec4 vTexInfo;\nvec2 c(vec2 d) {\n  vec2 e = mod(d, 1.);\n  vec2 f = vTexInfo.xy;\n  vec2 h = vTexInfo.zw;\n  return (f + e * h) / atlasSize;\n}\n#endif\nvarying vec2 vNormal;\nvarying vec2 vWidth;\nvarying float vGammaScale;\n#ifndef ENABLE_TILE_STENCIL\nvarying vec2 vPosition;\n#endif\nuniform float tileExtent;\n#ifdef HAS_DASHARRAY\n#ifdef HAS_DASHARRAY_ATTR\nvarying vec4 vDasharray;\n#else\nuniform vec4 lineDasharray;\n#endif\n#ifdef HAS_DASHARRAY_COLOR\nvarying vec4 vDashColor;\n#else\nuniform vec4 lineDashColor;\n#endif\n#endif\n#if defined(HAS_PATTERN) || defined(HAS_DASHARRAY) || defined(HAS_GRADIENT) || defined(HAS_TRAIL)\nvarying highp float vLinesofar;\n#endif\n#ifdef HAS_TRAIL\nuniform float trailSpeed;\nuniform float trailLength;\nuniform float trailCircle;\n#endif\n#if defined(HAS_TRAIL) || defined(HAS_PATTERN)\nuniform float currentTime;\n#endif\nfloat i(float j, float k) {\n  float l = k / 2.;\n  float m = abs(j - l);\n  float n = (.1 + 1. / DEVICE_PIXEL_RATIO) * vGammaScale;\n  return clamp(min(m + n, l - m) / n, .0, 1.);\n}\nvarying vec3 vVertex;\nuniform vec3 cameraPosition;\nuniform float cameraToCenterDistance;\nvoid main() {\n  \n#ifndef ENABLE_TILE_STENCIL\nfloat o = sign(tileExtent - min(tileExtent, abs(vPosition.x))) * sign(1. + sign(vPosition.x)) * sign(tileExtent - min(tileExtent, abs(vPosition.y))) * sign(1. + sign(vPosition.y));\n  if(o == .0) {\n    discard;\n  }\n#endif\n#if defined(HAS_PATTERN) || defined(HAS_DASHARRAY) || defined(HAS_GRADIENT) || defined(HAS_TRAIL)\nfloat u = vLinesofar;\n#endif\nfloat v = length(vNormal) * vWidth.s;\n#ifdef HAS_PATTERN\nvec2 h = vTexInfo.zw;\n  float A = sign(h.x * h.y);\n  float B = mix(lineBlur, .0, A);\n#else\nfloat B = lineBlur;\n#endif\nfloat n = (B + 1. / DEVICE_PIXEL_RATIO) * vGammaScale;\n  float C = clamp(min(v - (vWidth.t - n), vWidth.s - v) / n, .0, 1.);\n#ifdef HAS_COLOR\nvec4 D = vColor / 255.;\n#else\nvec4 D = lineColor;\n#endif\n#ifdef HAS_PATTERN\nif(A == 1.) {\n    \n#ifdef HAS_PATTERN_GAP\nfloat E = vLinePatternGap;\n#else\nfloat E = linePatternGap;\n#endif\n#ifdef HAS_PATTERN_ANIM\nfloat F = vLinePatternAnimSpeed;\n#else\nfloat F = linePatternAnimSpeed;\n#endif\nfloat G = h.x * vWidth.s * 2. / h.y;\n    float H = G * (1. + E);\n    u += mod(currentTime * -F * .2, H);\n    float I = mod(u / H, 1.);\n    float J = mod((flipY * vNormal.y + 1.) / 2., 1.);\n    vec4 K = texture2D(linePatternFile, c(vec2(I * (1. + E), J)));\n    float L = clamp(sign(1. / (1. + E) - I) + .000001, .0, 1.);\n    K = mix(linePatterGapColor, K, L);\n    D *= K;\n  }\n#endif\n#ifdef HAS_DASHARRAY\n#ifdef HAS_DASHARRAY_ATTR\nvec4 M = vDasharray;\n#else\nvec4 M = lineDasharray;\n#endif\n#ifdef HAS_DASHARRAY_COLOR\nvec4 N = vDashColor;\n#else\nvec4 N = lineDashColor;\n#endif\nfloat k = M[0] + M[1] + M[2] + M[3];\n  float j = mod(u, k);\n  float O = max(sign(M[0] - j), .0);\n  float P = j - M[0] - M[1];\n  float Q = max(sign(P), .0) * max(sign(M[2] - P), .0);\n  float R = O + Q;\n  float S = i(j, M[0]);\n  float T = i(P, M[2]);\n  float U = S * O + T * Q;\n  D = D * (1. - U) + N * U;\n#endif\n#ifdef HAS_STROKE_COLOR\nvec4 V = vStrokeColor / 255.;\n#else\nvec4 V = lineStrokeColor;\n#endif\nV = mix(D, V, sign(vWidth.t));\n  D = V * C + max(sign(vWidth.t - v), .0) * D * (1. - C);\n#ifdef HAS_TRAIL\nfloat W = mod(u - currentTime * trailSpeed * .1, trailCircle);\n  float X = W < trailLength ? mix(.0, 1., W / trailLength) : .0;\n  D *= X;\n#endif\n#ifdef HAS_OPACITY\nfloat Y = vOpacity;\n#else\nfloat Y = lineOpacity;\n#endif\ngl_FragColor = D * Y * layerOpacity;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nfloat Z = shadow_computeShadow();\n  gl_FragColor.rgb = shadow_blend(gl_FragColor.rgb, Z);\n#endif\nfloat ba;\n  if(isRenderingTerrain == 1.) {\n    ba = 1.;\n  } else {\n    ba = clamp(cameraToCenterDistance * 1.5 / distance(vVertex, cameraPosition), .0, 1.);\n  }\n  gl_FragColor *= ba;\n  gl_FragColor = highlight_blendColor(gl_FragColor);\n}",uniforms:n,defines:i,extraCommandProps:this.getExtraCommandProps(e)})}isEnableTileStencil(e){return!(e&&e.isRenderingTerrain&&this.isTerrainSkin())}getExtraCommandProps(e){const n=this.canvas;return{viewport:{x:(e,n)=>n.viewport?n.viewport.x:0,y:(e,n)=>n.viewport?n.viewport.y:0,width:(e,i)=>i.viewport?i.viewport.width:n?n.width:1,height:(e,i)=>i.viewport?i.viewport.height:n?n.height:1},stencil:{enable:()=>this.isEnableTileStencil(e),mask:255,func:{cmp:()=>"<=",ref:(e,n)=>n.stencilRef},op:{fail:"keep",zfail:"keep",zpass:"replace"}},depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],mask:this.sceneConfig.depthMask||!1,func:this.sceneConfig.depthFunc||"<="},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}}}getUniformValues(e,n){const i=n&&n.isRenderingTerrainSkin,o=this.layer.getTileSize().width,s=i?bV:e.projViewMatrix,a=e.viewMatrix,h=e.cameraToCenterDistance,l=e.getResolution(),c=Zx(wV,e.width,e.height);i&&Zx(c,o,o);const A=this.getBlendFunc().src(),f=this.sceneConfig.trailAnimation||{},d={layerScale:this.layer.options.styleScale||1,projViewMatrix:s,viewMatrix:a,cameraToCenterDistance:h,resolution:l,canvasSize:c,trailSpeed:f.speed||1,trailLength:f.trailLength||500,trailCircle:f.trailCircle||1e3,currentTime:this.layer.getRenderer().getFrameTimestamp()||0,blendSrcIsOne:+!(1!==A&&"one"!==A),cameraPosition:e.cameraPosition,viewport:i&&n&&n.viewport,isRenderingTerrain:+!!i};return this.setIncludeUniformValues(d,n),d}}class Gl extends jl{postCreateGeometry(e){const{symbolIndex:n,geometry:i}=e,{features:o}=i.properties,s=this.getSymbol(n).lineGradientProperty,a=i.data.aPickingId,h=new Uint8Array(a.length),l=[],c=new Map;function A(e){let n=e&&e[s];Array.isArray(n)||(n=[0,"black",1,"black"]);let i,o=n.join();return c.has(o)?i=c.get(o):(i=l.length,c.set(o,i),l.push(n)),i}let f=a[0],d=o[f].feature.properties,p=A(d);for(let e=1;e<a.length;e++)a[e]!==f&&(f=a[e],d=o[f].feature.properties,p=A(d)),h[e]=p;i.data.aGradIndex=h,i.properties.gradients=l}createMesh(e,n){const{geometry:i,symbolIndex:o,ref:s}=e,a=this.getSymbolDef(o);void 0===s&&SG(i,a,this.getFnTypeConfig(o),this.layer);const h={tileResolution:i.properties.tileResolution,tileRatio:i.properties.tileRatio,tileExtent:i.properties.tileExtent},l=this.getSymbol(o);this.setLineUniforms(l,h);const c=i.properties.gradients,A=this.regl.texture({width:256,height:2*c.length,data:CV(c),format:"rgba",mag:"linear",min:"linear",flipY:!1});h.lineGradientTexture=A,h.lineGradientTextureHeight=A.height,void 0===s&&i.generateBuffers(this.regl);const f=new cC(h),d=new bC(i,f,{castShadow:!1,picking:!0});d.setLocalTransform(n);const p={HAS_GRADIENT:1};return i.data.aAltitude&&(p.HAS_ALTITUDE=1),this.setMeshDefines(p,i,a),d.setDefines(p),d.properties.symbolIndex=o,d}createFnTypeConfig(e,n){return this.createShapeFnTypeConfigs(e,n)}createShader(e){this.Tr=e;const n=[],i={};this.fillIncludes(i,n,e),this.sceneConfig.trailAnimation&&this.sceneConfig.trailAnimation.enable&&(i.HAS_TRAIL=1);const o=[];n.push({name:"projViewModelMatrix",type:"function",fn:function(e,n){return Cv(o,n.projViewMatrix,n.modelMatrix),o}}),this.shader=new eP({vert:xV,frag:"#define SHADER_NAME LINE_GRADIENT\n#define DEVICE_PIXEL_RATIO 1.0\n#define MAX_LINE_COUNT 128.0\nprecision mediump float;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_frag>\n#endif\n#ifdef HAS_OPACITY\nvarying float vOpacity;\n#else\nuniform lowp float lineOpacity;\n#endif\nuniform float layerOpacity;\nuniform lowp float lineBlur;\nuniform float lineGradientTextureHeight;\nuniform float tileExtent;\nuniform sampler2D lineGradientTexture;\nvarying vec2 vNormal;\nvarying vec2 vWidth;\nvarying float vGammaScale;\nvarying highp float vLinesofar;\nvarying float vGradIndex;\n#ifndef ENABLE_TILE_STENCIL\nvarying vec2 vPosition;\n#endif\n#ifdef HAS_TRAIL\nuniform float trailSpeed;\nuniform float trailLength;\nuniform float trailCircle;\nuniform float currentTime;\n#endif\n#include <highlight_frag>\nvoid main() {\n  \n#ifndef ENABLE_TILE_STENCIL\nfloat c = sign(tileExtent - min(tileExtent, abs(vPosition.x))) * sign(1. + sign(vPosition.x)) * sign(tileExtent - min(tileExtent, abs(vPosition.y))) * sign(1. + sign(vPosition.y));\n  if(c == .0) {\n    discard;\n  }\n#endif\nfloat d = length(vNormal) * vWidth.s;\n  float e = (lineBlur + 1. / DEVICE_PIXEL_RATIO) * vGammaScale;\n  float f = clamp(min(d - (vWidth.t - e), vWidth.s - d) / e, .0, 1.);\n  float h = vLinesofar;\n  vec4 i = texture2D(lineGradientTexture, vec2(h, (vGradIndex * 2. + .5) / lineGradientTextureHeight)) * f;\n  i *= max(sign(MAX_LINE_COUNT - vGradIndex), .0);\n#ifdef HAS_TRAIL\nfloat j = mod(h - currentTime * trailSpeed * .1, trailCircle);\n  float k = j < trailLength ? mix(.0, 1., j / trailLength) : .0;\n  i *= k;\n#endif\n#ifdef HAS_OPACITY\nfloat l = vOpacity;\n#else\nfloat l = lineOpacity;\n#endif\ngl_FragColor = i * l * layerOpacity;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nfloat m = shadow_computeShadow();\n  gl_FragColor.rgb = shadow_blend(gl_FragColor.rgb, m);\n#endif\ngl_FragColor = highlight_blendColor(gl_FragColor);\n}",uniforms:n,defines:i,extraCommandProps:this.getExtraCommandProps()})}}function CV(e){e.length>2048&&console.warn(`Gradients count is (${e.length}), it may be slow to render.`);const n=document.createElement("canvas"),i=n.getContext("2d");n.width=256,n.height=2*e.length;for(let n=0;n<e.length;n++){const o=e[n],s=i.createLinearGradient(0,0,256,0);for(let e=0;e<o.length;e+=2)s.addColorStop(+o[e],o[e+1]);i.fillStyle=s;const a=n%256;i.fillRect(0,2*a,256,2*a+2)}return i.canvas}class $l{constructor(e){this.be=e||[],this.properties={}}set meshes(e){this.be=e}get meshes(){return this.be}}const PV=224,MV=100,TV=new Uint8Array(1),SV=[],IV={collides:0,boxes:[]},EV=[],OV=[];class th extends Sl{createGeometry(...e){const n=super.createGeometry(...e);if(!n||!n.geometry)return n;const{geometry:i}=n,o=e[0];i.properties.collideIds=o.featureIds&&o.featureIds.length&&o.isIdUnique?o.featureIds:o.data.aPickingId;return i.properties.uniqueCollideIds=YU(i.properties.collideIds,!(this.layer instanceof Qp)),n}supportRenderMode(e){const n=this.sceneConfig.renderToPointRenderTarget;return n||void 0===n?"point"===e:"fxaa"===e||"fxaaAfterTaa"===e}addMesh(e,n,i){if(e&&!this.isEnableCollision()){let n=e;Array.isArray(n)||(EV[0]=e,n=EV);for(let e=0;e<n.length;e++){const i=n[e].defines;delete i.ENABLE_COLLISION,n[e].setDefines(i);const{elements:o,visElemts:s}=n[e].geometry.properties;s&&void 0!==s.count&&s.count!==o.length&&(n[e].geometry.setElements(o),s.count=o.length)}}return super.addMesh(e,n,i)}startMeshCollision(e){const{meshKey:n}=e.properties,{renderer:i}=this.Ir,o=i.isForeground(e instanceof $l?e.meshes[0]:e);if(e.properties.isForeground=o,e instanceof $l&&e.meshes.length)for(let n=0;n<e.meshes.length;n++)e.meshes[n].properties.isForeground=o;this.Fr=performance.now(),this.Cr=this.Or(),this.Er=this.Dr(n)}endMeshCollision(e){const n=this.Lr.tags[e];if(this.Cr&&n&&this.Er){const e=this.getMap();this.Rr||(this.Rr=new Zh(0,0),this.Hr=new Zh(0,0)),n.anchor0=e.containerPointToCoord(this.zr,this.Rr),n.anchor1=e.containerPointToCoord(this.Nr,this.Hr),n.anchor0.z=e.getZoom(),n.anchor0.width=e.width,n.anchor0.height=e.height,n.anchor0.pitch=e.getPitch()}this.getMap().collisionFrameTime+=performance.now()-this.Fr}Dr(e){const n=this.getMap(),i=n.getZoom(),o=n.getPitch(),[s,a]=this.Vr(e);return!s||!a||s.z!==i||s.width!==n.width||s.height!==n.height||s.pitch!==o||s.distanceTo(this.zr)>3||a.distanceTo(this.Nr)>3}Ur(){const e=this.getMap();this.jr={},this.zr=new ee(e.width/3,e.height/2),this.Nr=new ee(2*e.width/3,e.height/2),delete this.Cr,this.Lr||(this.Lr={tags:{}}),this.Ir={layer:this.layer,renderer:this.layer.getRenderer(),frameTimestamp:this.layer.getRenderer().getFrameTimestamp(),map:this.getMap(),zoom:e.getZoom(),collisionTags:this.Lr.tags,isEnableUniquePlacement:this.isEnableUniquePlacement()}}Gr(){}Br(e,n){const i=this.Lr;return i.tags[e]&&i.tags[e][n]}$r(e,n,i){const o=this.Lr;o.tags[e]=o.tags[e]||[],o.tags[e][n]=i}Or(){const e=this.getMap();if(!e.isInteracting())return!0;return e.collisionFrameTime<=this.layer.options.collisionFrameLimit}Vr(e){const n="__meshAnchorKey".trim(),i=this.Lr.tags[e];if(i&&i.anchor0){const{anchor0:e,anchor1:o}=i,s=e[n]=e[n]||e.x+","+e.y,a=o[n]=o[n]||o.x+","+o.y;let h=this.jr[s],l=this.jr[a];if(!h||!l){const n=this.getMap();h=this.jr[s]=n.coordToContainerPoint(e),l=this.jr[a]=n.coordToContainerPoint(o)}return h.z=e.z,SV[0]=h,SV[1]=l,h.width=e.width,h.height=e.height,SV}return SV[0]=SV[1]=null,SV}updateBoxCollisionFading(e,n,i,o,s){const{layer:a,renderer:h,zoom:l,collisionTags:c,isEnableUniquePlacement:A}=this.Ir,{meshKey:f,isForeground:d}=n.properties;if(A&&this.Wr(f,s))return!1;const p=i.length;let g=c[f]&&c[f][s];const v=g,w=this.Xr&&g;if((!w||0===g.collides)&&e){if(this.Cr||w&&0===g.collides)if((this.Er||g&&g.z!==l)&&(g=null),g){if(g.boxes&&g.boxes.length){const{boxes:e,isAllowOverlap:n}=g;let i=0;if(!n){let n=0;for(let o=0;o<e.length;o++)if(!i){const s=this.isCollides(e[o]);if(-1===s)n++;else if(1===s){i=1;break}}n===e.length&&(i=-1)}g.collides=i}}else{g=v||{collides:0,boxes:[]},g.boxes.length=0,g.z=l;let e=0;for(let n=0;n<p;n++){const{mesh:a,allElements:h,boxCount:l,start:c,end:A}=i[n],f=this.Yr(a,h,l,c,A,o,s);f.isAllowOverlap&&(g.isAllowOverlap=1),0===e&&(e=f.collides),f.boxes&&g.boxes.push(...f.boxes)}g.collides=e,this.$r(f,s,g)}}let C=e&&g&&0===g.collides,P=1,T=!1;if(this.sceneConfig.fading){const e=this.qr(n);if(this.Jr)e[s]=C?1:-1;else if(d&&delete n.Kr,P=this.Zr(d,C,e,s),d?(P>0&&(C=!0),T=this.isBoxFading(n,s),T&&this.setToRedraw()):C||(this.Qr(e,s),P=0),C){const i=n.Kr;if(i&&1===P&&e[s]>0){let{fadeOutDelay:e,fadingDuration:n}=this.sceneConfig;BU(n)&&(n=PV),BU(e)&&(e=MV);const o=NU(1-(h.getFrameTimestamp()-i-e)/n,0,1);P*=o,o>0&&this.setToRedraw()}}}if(g&&a.options.debugCollision&&this.addCollisionDebugBox(g.boxes,g.collides?0:1),C||T){const{mesh:e,start:n}=i[0],o=this.getSymbol(e.properties.symbolIndex);!this.ts(o,e,n)&&g&&g.boxes&&this.es(g.boxes,e)}if(C){const e=TV[0]=255*P;for(let n=0;n<p;n++){const{mesh:o,allElements:s,start:a,end:h,boxIndex:l}=i[n];this.setCollisionOpacity(o,s,e,a,h,l)}}return C&&P>0}isMeshIterable(){return!0}setCollisionOpacity(e,n,i,o,s){this.ns(e,i,n[o],n[s-1])}ns(e,n,i,o){const{aOpacity:s}=e.geometry.properties;if(!s)return;const a=i;if(s[a]!==n){const e=o;for(let i=a;i<=e;i++)s[i]=n;s.dirty=!0}}isBoxFading(e,n){const{frameTimestamp:i}=this.Ir;let o=this.sceneConfig.fadingDuration;return BU(o)&&(o=PV),i-Math.abs(this.qr(e)[n])<o}Yr(e,n,i,o,s,a,h){const l=this.getSymbol(e.properties.symbolIndex),c=this.ts(l,e,n[o]),A=this.rs(l,e,n[o]);if(!this.isEnableCollision()||c&&A)return IV;const f=this.isBoxCollides(e,n,i,o,s,a,h);return A&&(f.collides=0,f.isAllowOverlap=1),f}ts(e,n,i){if(!this.isEnableCollision())return!0;const o=n.geometry.properties.aOverlap;if(!o)return 1==+e[this.propIgnorePlacement];const s=o[i];return s<2?1==+e[this.propIgnorePlacement]:s%8%2}rs(e,n,i){if(!this.isEnableCollision())return!0;const o=n.geometry.properties.aOverlap;if(!o)return 1==+e[this.propAllowOverlap];const s=o[i];return s<2?1==+e[this.propAllowOverlap]:(s>>2)%2}es(e){if(Array.isArray(e[0]))for(let n=0;n<e.length;n++)this.insertCollisionBox(e[n]);else this.insertCollisionBox(e)}Zr(e,n,i,o){let{fadingDuration:s,fadeInDelay:a,fadeOutDelay:h}=this.sceneConfig;BU(s)&&(s=PV),BU(a)&&(a=600),BU(h)&&(h=MV);const{frameTimestamp:l}=this.Ir;let c=i[o],A=n?1:0;if(!c)return n&&e&&(i[o]=l+a),0;if(l<Math.abs(c)&&(!n&&c>0||n&&c<0)){const e=l-s;i[o]=c=n?e:-e}return l-Math.abs(c)<s?A=c>0?(l-c)/s:1-(l+c)/s:n?(c<0&&(i[o]=c=l+a),A=(l-c)/s):(c>0&&(i[o]=c=-(l+h)),A=1-(l+c)/s),(A<0||A>1)&&(A=NU(A,0,1)),A}qr(e){this.ss||(this.ss={});const{meshKey:n}=e.properties;if(!this.ss[n]){const{frameTimestamp:e}=this.Ir;this.ss[n]={timestamp:e}}return this.ss[n]}os(e){if(!this.ls)return void(this.ls=e);const n=this.scene.getMeshes();if(n&&n.length){for(let i=0;i<n.length;i++){const o=this.qr(n[i]);o.timestamp<this.ls?delete n[i]._fading_timestamps:o.timestamp=e}this.ls=e}}Qr(e,n){if(!e)return;const{frameTimestamp:i}=this.Ir;let{fadingDuration:o}=this.sceneConfig;BU(o)&&(o=PV),e[n]=-(i-o-1)}deleteMesh(e,n){if(e){if(Array.isArray(e))for(let n=0;n<e.length;n++){const i=e[n].properties.meshKey;this.Lr&&delete this.Lr.tags[i],this.ss&&delete this.ss[i]}else{const n=e.properties.meshKey;this.Lr&&delete this.Lr.tags[n],this.ss&&delete this.ss[n]}super.deleteMesh(e,n)}}delete(e){this.hs&&(this.hs.geometry.dispose(),this.us.dispose(),this.hs.dispose(),delete this.hs,delete this.us,delete this.cs),delete this.Lr,super.delete(e)}isCollides(e){const n=this.layer,i=n.getMap(),o=i.getDevicePixelRatio();if(L_(OV,e,1/o),i.isOffscreen(OV))return-1;const s=n.getCollisionIndex(),a=this.sceneConfig.collisionBufferSize||n.options.collisionBufferSize||0;return a&&(e=LV(OV,e,a)),+s.collides(e)}insertCollisionBox(e){const n=this.layer,i=n.getCollisionIndex(),o=this.sceneConfig.collisionBufferSize||n.options.collisionBufferSize||0;let s=e;o&&(s=e.fs=e.fs||[],e=LV(s,e,o)),i.insertBox(s)}addCollisionDebugBox(e,n){if(e&&e.length)if(Array.isArray(e[0]))for(let i=0;i<e.length;i++){this.ds(e[i],n)}else this.ds(e,n)}ds(e,n){if(!e)return;const i=this.ps=this.ps||{aPosition:[],aVisible:[],indices:[]},o=this.sceneConfig.collisionBufferSize||this.layer.options.collisionBufferSize||0;o&&(e=LV(OV,e,o));const s=this.getMap(),a=s.getDevicePixelRatio();if(L_(OV,e,1/a),s.isOffscreen(OV))return;const h=i.aPosition.length/2;i.aPosition.push(e[0],e[1],e[2],e[1],e[2],e[3],e[0],e[3]),i.aVisible.push(n,n,n,n),i.indices.push(h,h+1,h+1,h+2,h+2,h+3,h+3,h)}updateCollision(e){super.updateCollision(e),this.Ur(),this.ys(),this.gs&&this.gs.length&&(this.vs(),this.gs&&(this.setToRedraw(),this.scene.addMesh(this.gs))),(this.getMap().isZooming()||this.gs&&this.gs.length)&&(this.xs(),this.bs(this.scene.getMeshes()))}paint(e){const n=super.paint(e);return this.ws(e),!1===this.Cr&&this.setToRedraw(),n}shouldIgnoreBackground(){return!this.getMap().isZooming()&&!this.gs}ys(){const e=this.getMap(),n=e.isZooming();if(!n&&this.Xr){const e=this.layer.getRenderer();this.gs=this.scene.getMeshes().filter((n=>!e.isForeground(n)&&!n.properties.isLinePlacement))}else n&&!this.Xr&&(this.As=e.getResolution());if(n)this.Ms&&(clearTimeout(this.Ms),delete this.Jr,delete this.Ms),this.Jr=this.As&&e.getResolution()>this.As;else if(this.Xr&&!this.Ms){let{fadeOutDelay:e,fadingDuration:n}=this.sceneConfig;BU(e)&&(e=MV),BU(n)&&(n=PV),this.Ms=setTimeout((()=>{delete this.Jr,delete this.Ms}),e+n+1)}this.Xr=n}ws(e){if(!this.ps||!this.layer.options.debugCollision)return;this.cs||this._s();const{aPosition:n,aVisible:i,indices:o}=this.ps;if(!this.hs){const e=new Lw({aPosition:[],aVisible:[]},[],0,{positionSize:2,primitive:"lines"});this.hs=new bC(e),this.Ss=new kC,this.Ss.addMesh(this.hs)}const s=this.hs.geometry;s.updateData("aPosition",new Float32Array(n)),s.updateData("aVisible",new Uint8Array(i)),s.setElements(o),this.cs.render(this.us,{size:[this.canvas.width,this.canvas.height]},this.Ss,this.getRenderFBO(e)),delete this.ps}_s(){this.cs=new PC(this.regl);const e=this.canvas;this.us=new eP({vert:"attribute vec2 aPosition;\nattribute float aVisible;\nuniform vec2 size;\nvarying vec4 vColor;\nvoid main() {\n  vec2 c = (aPosition / size - .5) * 2. * vec2(1., -1.);\n  gl_Position = vec4(c, .0, 1.);\n  vColor = mix(vec4(1., .0, .0, 1.5) * .5, vec4(.0, 1., .0, 1.) * .4, aVisible);\n}",frag:"precision mediump float;\nvarying vec4 vColor;\nvoid main() {\n  gl_FragColor = vec4(vColor.rgb, .5);\n}",uniforms:["size"],extraCommandProps:{viewport:{x:0,y:0,width:()=>e?e.width:1,height:()=>e?e.height:1},depth:{enable:!1},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}})}vs(){let{fadeOutDelay:e,fadingDuration:n}=this.sceneConfig;BU(e)&&(e=MV),BU(n)&&(n=PV);const i=this.layer.getRenderer(),o=i.getCurrentTileZoom(),s=i.getFrameTimestamp(),a=[];for(let h=0;h<this.gs.length;h++){const l=this.gs[h],c=l.properties.tile;!l.Kr&&i.isBackTile(c.id)&&(l.Kr=s);l.properties.level=c.z-o>0?2*(c.z-o)-1:2*(o-c.z),i.isForeground(l)||l.Kr&&s-l.Kr>e+n?delete l.Kr:a.push(l)}delete this.gs,a.length&&(this.gs=a)}isEnableCollision(){return this.layer.options.collision&&!!this.sceneConfig.collision}isEnableUniquePlacement(){return this.isEnableCollision()&&this.sceneConfig.uniquePlacement}isMeshUniquePlaced(e){return this.isMeshIterable(e)}xs(){if(!this.isEnableUniquePlacement())return;const e=this.scene.getMeshes(),n=(e,n,i,o)=>{const{start:s,end:a}=n[0],h=e.geometry.properties,l=h.elements;let c=h.uniquePlacements;if(c||(c=h.uniquePlacements=[]),void 0===c[o]){const n=this.getUniqueEntryKey(e,l[s],o);c[o]=n?{key:n,index:o,start:l[s],end:l[a-1]}:null}};for(let i=0;i<e.length;i++){const o=e[i];this.isMeshUniquePlaced(o)&&this.forEachBox(o,n)}}bs(e){if(!this.isEnableUniquePlacement())return;const n=this.getMap().getZoom();let i=!this.ks||this.Ps!==n;if(!i)for(let n=0;n<e.length;n++)if(!this.ks[e[n].properties.meshKey]){i=!0;break}if(!i)return;this.Ps=n,this.Ts={},this.ks={},e=e.sort(kV);const o=this.getMap().getGLScale(),s={};for(let n=0;n<e.length;n++){const i=e[n];if(!i.geometry)continue;const{meshKey:a}=i.properties;this.ks[a]=1;const{uniquePlacements:h}=i.geometry.properties;if(h)for(let e=0;e<h.length;e++){if(!h[e])continue;const{key:n,index:a}=h[e],l=this.qr(i),c=DV(n,o),A=s[c];if(A){const e=A.length,n=A[e-3].properties.meshKey,o=A[e-2],s=A[e-1];this.Ts[n]=this.Ts[n]||{},this.Ts[n][s]=1,this.Is(l,a,o,s),A.push(i,l,a)}else s[c]=[i,l,a]}}for(const e in s){const n=s[e];if(n.length<=6)continue;const i=n.length,o=n[i-2][n[i-1]];if(n[1][n[2]]!==o)for(let e=0;e<i-6;e+=3)n[e+1][n[e+2]]=o}}Is(e,n,i,o){if(void 0!==i[o])if(void 0===e[n])e[n]=i[o];else{let s=e[n];Math.abs(i[o])>Math.abs(s)?e[n]=i[o]:i[o]=e[n]}else void 0!==e[n]&&(i[o]=e[n])}Wr(e,n){return this.Ts&&this.Ts[e]&&this.Ts[e][n]}Fs(e,n){const{symbolIndex:i}=e.properties,o=i.type||0;let s=e.properties._collidesBoxes;s||(s=e.properties._collidesBoxes=[]);let a=s[i.index];a||(a=e.properties._collidesBoxes=[]),a[o]||(a[o]=[]),a=a[o];const h=n/6;if(!a[h]){const e=[];a[h]={boxes:e,collision:{boxes:e}}}return a[h]}Cs(e){let n=this.Os;if(n||(n=this.Os=[]),!n[e]){n[e]=[];for(let i=0;i<e;i++)n[e][i]={}}return n[e]}Es(e){return!e||!e.geometry||!(!e.geometry.properties.glyphAtlas||!e.material.get("isHalo")||e.geometry.data.aTextHaloRadius&&e.geometry.properties.hasHalo)&&(!(!e.geometry.data.aTextHaloRadius||e.geometry.properties.hasHalo)||!this.getSymbol(e.geometry.properties.symbolIndex).textHaloRadius)}}const RV=10;function DV(e,n){return Math.round(e[0]/n/RV)*Math.round(e[1]/n/RV)*(e[2]?Math.round(e[2]/RV):1)+"-"+e[3]}function kV(e,n){const i=n.properties.level-e.properties.level;return 0===i?e.properties.meshKey-n.properties.meshKey:i}function LV(e,n,i){return e[0]=n[0]-i,e[1]=n[1]-i,e[2]=n[2]+i,e[3]=n[3]+i,e}var FV="#include <gl2_vert>\n#define SHADER_NAME MARKER\n#define RAD 0.0174532925\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\nattribute vec2 aShape;\nattribute vec2 aTexCoord;\n#ifdef ENABLE_COLLISION\nattribute float aOpacity;\n#endif\n#ifdef HAS_OPACITY\nattribute float aColorOpacity;\n#endif\n#ifdef HAS_MARKER_WIDTH\nattribute float aMarkerWidth;\n#else\nuniform float markerWidth;\n#endif\n#ifdef HAS_MARKER_HEIGHT\nattribute float aMarkerHeight;\n#else\nuniform float markerHeight;\n#endif\n#ifdef HAS_MARKER_DX\nattribute float aMarkerDx;\n#else\nuniform float markerDx;\n#endif\n#ifdef HAS_MARKER_DY\nattribute float aMarkerDy;\n#else\nuniform float markerDy;\n#endif\n#if defined(HAS_PITCH_ALIGN)\nattribute float aPitchAlign;\n#else\nuniform float pitchWithMap;\n#endif\n#if defined(HAS_ROTATION_ALIGN)\nattribute float aRotationAlign;\n#else\nuniform float rotateWithMap;\n#endif\nuniform float flipY;\n#ifdef HAS_ROTATION\nattribute float aRotation;\n#else\nuniform float markerRotation;\n#endif\n#ifdef HAS_PAD_OFFSET\nattribute float aPadOffsetX;\nattribute float aPadOffsetY;\n#endif\nuniform float cameraToCenterDistance;\nuniform mat4 positionMatrix;\nuniform mat4 projViewModelMatrix;\nuniform float markerPerspectiveRatio;\nuniform vec2 iconSize;\nuniform vec2 texSize;\nuniform vec2 canvasSize;\nuniform float mapPitch;\nuniform float mapRotation;\nuniform float zoomScale;\nuniform float tileRatio;\nuniform float layerScale;\nuniform float isRenderingTerrain;\n#include <vt_position_vert>\n#ifndef PICKING_MODE\nvarying vec2 vTexCoord;\nvarying float vOpacity;\n#include <highlight_vert>\n#else\n#include <fbo_picking_vert>\n#endif\nvoid main() {\n  vec3 c = unpackVTPosition();\n#ifdef HAS_MARKER_WIDTH\nfloat d = aMarkerWidth;\n#else\nfloat d = markerWidth;\n#endif\n#ifdef HAS_MARKER_HEIGHT\nfloat e = aMarkerHeight;\n#else\nfloat e = markerHeight;\n#endif\n#ifdef HAS_MARKER_DX\nfloat f = aMarkerDx;\n#else\nfloat f = markerDx;\n#endif\n#ifdef HAS_MARKER_DY\nfloat h = aMarkerDy;\n#else\nfloat h = markerDy;\n#endif\n#if defined(HAS_PITCH_ALIGN)\nfloat i = aPitchAlign;\n#else\nfloat i = pitchWithMap;\n#endif\n#if defined(HAS_ROTATION_ALIGN)\nfloat j = aRotationAlign;\n#else\nfloat j = rotateWithMap;\n#endif\ngl_Position = projViewModelMatrix * positionMatrix * vec4(c, 1.);\n  float k = gl_Position.w;\n  float l;\n  if(isRenderingTerrain == 1. && i == 1.) {\n    l = 1.;\n  } else {\n    float m = (1. - cameraToCenterDistance / k) * markerPerspectiveRatio;\n    l = clamp(.5 + .5 * (1. - m), .0, 4.);\n  }\n#ifdef HAS_ROTATION\nfloat n = -aRotation / 9362. - mapRotation * j;\n#else\nfloat n = -markerRotation - mapRotation * j;\n#endif\nif(i == 1.) {\n    n += mapRotation;\n  }\n  float o = sin(n);\n  float u = cos(n);\n  mat2 v = mat2(u, -1. * o, o, u);\n  vec2 A = (aShape / 10.0);\n  if(i == 1. && flipY == .0) {\n    A *= vec2(1., -1.);\n  }\n#ifdef HAS_PAD_OFFSET\nA = (A / iconSize * vec2(d, e) + vec2(aPadOffsetX - 1., aPadOffsetY)) * layerScale;\n#else\nA = A / iconSize * vec2(d, e) * layerScale;\n#endif\nA = v * A;\n  if(i == .0) {\n    vec2 B = A * 2. / canvasSize;\n    gl_Position.xy += B * l * k;\n  } else {\n    float C;\n    if(isRenderingTerrain == 1.) {\n      C = 1.;\n    } else {\n      C = k / cameraToCenterDistance;\n    }\n    vec2 B = A;\n    gl_Position = projViewModelMatrix * positionMatrix * vec4(c + vec3(B, .0) * tileRatio / zoomScale * C * l, 1.);\n  }\n  gl_Position.xy += vec2(f, -h) * 2. / canvasSize * k;\n#ifndef PICKING_MODE\nvTexCoord = aTexCoord / texSize;\n#ifdef ENABLE_COLLISION\nvOpacity = aOpacity / 255.;\n#else\nvOpacity = 1.;\n#endif\n#ifdef HAS_OPACITY\nvOpacity *= aColorOpacity / 255.;\n#endif\nhighlight_setVarying();\n#else\n#ifdef ENABLE_COLLISION\nbool D = aOpacity == 255.;\n#else\nbool D = true;\n#endif\nfbo_picking_setData(gl_Position.w, D);\n#endif\n}";const NV=[],zV=[],BV=[],HV=[],jV=[],UV=[];function GV(e,n,i,o,s,a,h,l,c,A,f,d,p,g){const{tileRatio:v,tileResolution:w}=c,C=v/(w/A.getResolution())*(f/A.cameraToCenterDistance)*d;Kx(i,i,C),Kx(o,o,C),Kx(s,s,C),Kx(a,a,C),$v(NV,i[0],i[1],p?i[2]/g:0),$v(zV,o[0],o[1],p?o[2]/g:0),$v(BV,s[0],s[1],p?s[2]/g:0),$v(HV,a[0],a[1],p?a[2]/g:0),t_(NV,NV,n),t_(zV,zV,n),t_(BV,BV,n),t_(HV,HV,n),jG(i,NV,h,A.width,A.height),jG(o,zV,h,A.width,A.height),jG(s,BV,h,A.width,A.height),jG(a,HV,h,A.width,A.height),Zx(jV,Math.min(i[0],o[0],s[0],a[0]),Math.min(i[1],o[1],s[1],a[1])),Zx(UV,Math.max(i[0],o[0],s[0],a[0]),Math.max(i[1],o[1],s[1],a[1])),E_(e,jV[0]+l[0],jV[1]+l[1],UV[0]+l[0],UV[1]+l[1])}function VV(e,n,i,o,s,a,h,l){1!==l&&(Kx(i,i,l),Kx(o,o,l),Kx(s,s,l),Kx(a,a,l)),Zx(jV,Math.min(i[0],o[0],s[0],a[0]),Math.min(i[1],o[1],s[1],a[1])),Zx(UV,Math.max(i[0],o[0],s[0],a[0]),Math.max(i[1],o[1],s[1],a[1])),E_(e,n[0]+jV[0]+h[0],n[1]+jV[1]-h[1],n[0]+UV[0]+h[0],n[1]+UV[1]-h[1])}function WV(e,n,i,o,s){n-=i*o,1===s&&(n+=i);const a=Math.sin(n),h=Math.cos(n);return ev(e,h,-a,a,h)}const qV=2048,ZV=24,QV=.01,XV=[],YV=[],JV=[],KV=[],$V=[],tW=[],eW=[],nW=[],iW=[1,-1],rW=[1,1];function oW(e,n,i,o,s){const a=n.material.uniforms,h=s.cameraToCenterDistance,l=n.geometry.properties,c=this.getSymbol(l.symbolIndex),A=n.geometry.desc.positionSize,f=l.aAnchor,d=$v(XV,f[i*A],f[i*A+1],2===A?0:f[i*A+2]),{aTerrainAltitude:p}=l;if(p){const e=100*p[2*i];e&&(d[2]+=e)}let g=jG(YV,d,o,s.width,s.height);const v=g[2];let w=1;a.markerPerspectiveRatio&&(w=NU(.5+.5*(1-(1-h/v)*a.markerPerspectiveRatio),0,4));const{aShape:C,aMarkerDx:P,aMarkerDy:T,aMarkerWidth:S,aMarkerHeight:I,aPitchAlign:E,aRotationAlign:O,aRotation:k}=l,L=E?E[i]:a.pitchWithMap,F=O?O[i]:a.rotateWithMap,N=Zx(nW,(P?P[i]:c.markerDx)||0,-((T?T[i]:c.markerDy)||0));let z=Zx(KV,C[2*i]/10,C[2*i+1]/10),H=Zx($V,C[2*i+2]/10,C[2*i+3]/10),j=Zx(tW,C[2*i+4]/10,C[2*i+5]/10),W=Zx(eW,C[2*i+6]/10,C[2*i+7]/10);0===a.flipY&&1===L&&(Yx(z,z,iW),Yx(H,H,iW),Yx(j,j,iW),Yx(W,W,iW));const[q,Y]=fV(n.geometry);let J=S?S[i]:c.markerWidth;BU(J)&&(J=q||15);let $=I?I[i]:c.markerHeight;BU($)&&($=Y||15);const it=Zx(rW,J/qV,$/qV);lb(z,z,it),lb(H,H,it),lb(j,j,it),lb(W,W,it);const rt=-(k?k[i]/9362:-(c.markerRotation||0)*Math.PI/180),ot=s.getBearing()*Math.PI/180;if(ot*F||rt){const e=WV(JV,rt,ot,F,L);z=rb(z,z,e),H=rb(H,H,e),j=rb(j,j,e),W=rb(W,W,e)}1===L?GV(e,d,z,H,j,W,o,N,a,s,v,w):(Yx(z,z,iW),Yx(H,H,iW),Yx(j,j,iW),Yx(W,W,iW),VV(e,g,z,H,j,W,N,w));const st=this.getMap().getDevicePixelRatio();return 1!==st&&(e[0]*=st,e[1]*=st,e[2]*=st,e[3]*=st),e}const sW=1,aW=[],hW=[],lW=[],uW=[],cW=[],AW=[],fW=[1,-1];function dW(e,n,i,o,s,a,h,l,c){const A=o.material.uniforms,f=c.cameraToCenterDistance,d=o.geometry.properties,p=this.getSymbol(d.symbolIndex),g="line"===p.textPlacement&&!QU(p),v=ZV,w=i[2];let C=1;A.textPerspectiveRatio&&(C=NU(.5+.5*(1-(1-f/w)*A.textPerspectiveRatio),0,4));const{aTextDx:P,aTextDy:T,aPitchAlign:S,aRotationAlign:I,aRotation:E}=o.geometry.properties,O=S?S[h]:A.pitchWithMap,k=I?I[h]:A.rotateWithMap,L=Zx(AW,(P?P[h]:p.textDx)||0,-((T?T[h]:p.textDy)||0));if(g){const{aOffset:o,aShape:s}=d,a=o.length!==s.length;let f,p,g,v;if(a?(f=$v(hW,o[3*h]/10,o[3*h+1]/10,o[3*h+2]/10),p=$v(lW,o[3*h+3]/10,o[3*h+4]/10,o[3*h+5]/10),g=$v(uW,o[3*h+6]/10,o[3*h+7]/10,o[3*h+8]/10),v=$v(cW,o[3*h+9]/10,o[3*h+10]/10,o[3*h+11]/10)):(f=Zx(hW,o[2*h]/10,o[2*h+1]/10),p=Zx(lW,o[2*h+2]/10,o[2*h+3]/10),g=Zx(uW,o[2*h+4]/10,o[2*h+5]/10),v=Zx(cW,o[2*h+6]/10,o[2*h+7]/10)),1===O){const i=fU(c.getResolution(),c);GV(e,n,f,p,g,v,l,L,A,c,w,C,a,i)}else Yx(f,f,fW),Yx(p,p,fW),Yx(g,g,fW),Yx(v,v,fW),VV(e,i,f,p,g,v,L,C)}else{const{aShape:o}=d;let a=Zx(hW,o[2*h]/10,-o[2*h+1]/10),f=Zx(lW,o[2*h+2]/10,-o[2*h+3]/10),P=Zx(uW,o[2*h+4]/10,-o[2*h+5]/10),T=Zx(cW,o[2*h+6]/10,-o[2*h+7]/10);0===A.flipY&&1===O&&(Yx(a,a,fW),Yx(f,f,fW),Yx(P,P,fW),Yx(T,T,fW));const S=E?E[h]/9362:(p.textRotation||0)*Math.PI/180,I=g?0:c.getBearing()*Math.PI/180;if(S||I){const e=WV(aW,S,I,k,O);a=rb(a,a,e),f=rb(f,f,e),P=rb(P,P,e),T=rb(T,T,e)}const F=s/v;Kx(a,a,F),Kx(f,f,F),Kx(P,P,F),Kx(T,T,F),1===O?GV(e,n,a,f,P,T,l,L,A,c,w,C):VV(e,i,a,f,P,T,L,C)}e[0]-=(a=a||0)+sW,e[1]-=a+sW,e[2]+=a+sW,e[3]+=a+sW;const F=this.getMap().getDevicePixelRatio();return 1!==F&&(e[0]*=F,e[1]*=F,e[2]*=F,e[3]*=F),e}function pW(e,n,i){const o=n.geometry.desc.positionSize,{aAnchor:s,aAltitude:a,aTerrainAltitude:h}=n.geometry.properties,l=i*o;if(a?$v(e,s[l],s[l+1],a[i]):3===o?QF(e,s[l],s[l+1],s[l+2]):$v(e,s[l],s[l+1],0),h){const n=100*h[2*i];n&&(e[2]+=n)}return e}const gW={textFill:[0,0,0,1],textOpacity:1,textPitchAlignment:0,textRotationAlignment:0,textHaloRadius:0,textHaloFill:[1,1,1,1],textHaloBlur:0,textHaloOpacity:1,textPerspectiveRatio:0,textSize:14,textDx:0,textDy:0,textRotation:0};function mW(e,n,i,o,s,a,h,l,c){const A=[];if(n.isDisposed()||0===n.data.aPosition.length)return A;const f=n.properties.glyphAtlas;if(!f)return A;if(0===o.textSize||0===o.textOpacity)return A;if(SG(n,o,a,this.layer),!n.properties.aCount){yW.call(this,n,h||c,l);const{aTextSize:e,aTextDx:i,aTextDy:o,aPitchAlign:s,aRotationAlign:a,aRotation:A,aOverlap:f,aAltitude:d}=n.data;if(e){const i=(MG+"aTextSize").trim();n.properties.aTextSize=n.properties[i]||new e.constructor(e)}if(i){const e=(MG+"aTextDx").trim();n.properties.aTextDx=n.properties[e]||new i.constructor(i)}if(o){const e=(MG+"aTextDy").trim();n.properties.aTextDy=n.properties[e]||new o.constructor(o)}if(s){const e=(MG+"aPitchAlign").trim();n.properties.aPitchAlign=n.properties[e]||new s.constructor(s)}if(a){const e=(MG+"aRotationAlign").trim();n.properties.aRotationAlign=n.properties[e]||new a.constructor(a)}if(A){const e=(MG+"aRotation").trim();n.properties.aRotation=n.properties[e]||new A.constructor(A)}if(f){const e=(MG+"aOverlap").trim();n.properties.aOverlap=n.properties[e]||new f.constructor(f)}if(d){const e=(MG+"aAltitude").trim();n.properties.aAltitude=n.properties[e]||new d.constructor(d)}}const d=uV(e,f,!1),p={flipY:0,tileResolution:n.properties.tileResolution,tileRatio:n.properties.tileRatio,texture:d,texSize:[f.width,f.height]};vW(n,p,s);let g=!1;s.textOpacity<1&&(g=!0),n.properties.memorySize=n.getMemorySize(),n.generateBuffers(e,{excludeElementsInVAO:!0});const v=new cC(p,gW),w=new bC(n,v,{disableVAO:!0,transparent:g,castShadow:!1,picking:!0});if(w.setLocalTransform(i),w.setUniform("alphaTest",QV),p.isHalo&&(w.properties.isHalo=!0),h&&w.setDefines({ENABLE_COLLISION:1}),A.push(w),p.isHalo){const e={flipY:0,tileResolution:n.properties.tileResolution,tileRatio:n.properties.tileRatio,texture:d,texSize:[f.width,f.height],isHalo:0};vW(n,e,s);const o=new cC(e,gW),a=new bC(n,o,{disableVAO:!0,transparent:g,castShadow:!1,picking:!0});a.setUniform("alphaTest",QV),a.properties.haloMesh=w,Object.defineProperty(a.properties,"textSize",{enumerable:!0,get:function(){return e.textSize}}),h&&a.setDefines({ENABLE_COLLISION:1}),a.setLocalTransform(i),A.push(a)}return A.forEach((e=>{const i=e.defines||{};n.data.aTextFill&&(i.HAS_TEXT_FILL=1),n.data.aTextSize&&(i.HAS_TEXT_SIZE=1),n.data.aColorOpacity&&(i.HAS_OPACITY=1),n.data.aTextHaloFill&&e.material.uniforms.isHalo&&(i.HAS_TEXT_HALO_FILL=1),n.data.aTextHaloRadius&&e.material.uniforms.isHalo&&(i.HAS_TEXT_HALO_RADIUS=1),n.data.aTextHaloOpacity&&e.material.uniforms.isHalo&&(i.HAS_TEXT_HALO_OPACITY=1),n.data.aTextDx&&(i.HAS_TEXT_DX=1),n.data.aTextDy&&(i.HAS_TEXT_DY=1),n.data.aPitchAlign&&(i.HAS_PITCH_ALIGN=1),n.data.aRotationAlign&&(i.HAS_ROTATION_ALIGN=1),n.data.aRotation&&(i.HAS_ROTATION=1),n.data.aAltitude&&(i.HAS_ALTITUDE=1),n.properties.aOffset&&n.properties.aShape&&n.properties.aOffset.length!==n.properties.aShape.length&&(i.HAS_OFFSET_Z=1),e.setDefines(i),e.properties.symbolIndex=n.properties.symbolIndex})),A}function yW(e,n,i){const o=this.getSymbol(e.properties.symbolIndex),s="line"===e.properties.textPlacement&&!QU(o),{aPosition:a,aShape:h}=e.data,l=a.length/e.desc.positionSize;if(e.properties.aPickingId=e.data.aPickingId,e.properties.aCount=e.data.aCount,delete e.data.aCount,(n||s)&&(e.properties.aAnchor=a,e.properties.aShape=h),e.properties.visElemts||(e.properties.elements=e.elements,e.properties.visElemts=new e.elements.constructor(e.elements.length)),s){const{aVertical:n,aSegment:i,aGlyphOffset:o,aPitchRotation:s}=e.data,a=!!s;e.properties.aGlyphOffset=o,e.properties.aPitchRotation=s,e.properties.aSegment=i,e.properties.aVertical=n,delete e.data.aSegment,delete e.data.aVertical,delete e.data.aGlyphOffset,delete e.data.aPitchRotation;const l=h.length/2*(a?3:2);e.data.aOffset={usage:"dynamic",data:new Int16Array(l)},e.properties.aOffset=new Int16Array(l)}if(n){e.data.aOpacity={usage:"dynamic",data:new Uint8Array(l)},e.properties.aOpacity=new Uint8Array(l),i&&(e.properties.aOpacity.fill(255,0),e.data.aOpacity.data.fill(255,0));const{aTextHaloRadius:n}=e.data;if(n&&!e.properties.aTextHaloRadius){const i=(MG+"aTextHaloRadius").trim();e.properties.aTextHaloRadius=e.properties[i]||new n.constructor(n)}}}function vW(e,n,i){void 0===n.isHalo&&(n.isHalo=1),jU(n,"textOpacity",i,"textOpacity",gW.textOpacity),jU(n,"textFill",i,"textFill",gW.textFill,VU()),jU(n,"textHaloFill",i,"textHaloFill",gW.textHaloFill,VU()),jU(n,"textHaloBlur",i,"textHaloBlur",gW.textHaloBlur),jU(n,"textHaloRadius",i,"textHaloRadius",gW.textHaloRadius),jU(n,"textHaloOpacity",i,"textHaloOpacity",gW.textHaloOpacity),jU(n,"textPerspectiveRatio",i,"textPerspectiveRatio",gW.textPerspectiveRatio,(n=>"line"===e.properties.textPlacement?1:n)),jU(n,"rotateWithMap",i,"textRotationAlignment",gW.textRotationAlignment,(e=>+("map"===e))),jU(n,"pitchWithMap",i,"textPitchAlignment",gW.textPitchAlignment,(e=>+("map"===e))),jU(n,"textSize",i,"textSize",gW.textSize),jU(n,"textDx",i,"textDx",gW.textDx),jU(n,"textDy",i,"textDy",gW.textDy),jU(n,"textRotation",i,"textRotation",gW.textRotation,(e=>e*Math.PI/180))}function _W(e,n){const i=[];return{uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(e,n){return Cv(i,n.projViewMatrix,n.modelMatrix)}},{name:"zoomScale",type:"function",fn:function(e,n){return n.tileResolution/n.resolution}}],extraCommandProps:{viewport:{x:0,y:0,width:()=>e?e.width:1,height:()=>e?e.height:1},stencil:{enable:!0,mask:255,func:{cmp:"<=",ref:(e,n)=>n.stencilRef,mask:255},op:{fail:"keep",zfail:"keep",zpass:"replace"}},blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"},depth:{enable:!0,range:n.depthRange||[0,1],func:n.depthFunc||"always",mask:!1},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}}}}function xW(e,n){const i=RD(n.textFill),o=RD(n.textSize),s=RD(n.textHaloFill),a=RD(n.textHaloRadius),h=RD(n.textHaloOpacity),l=RD(n.textDx),c=RD(n.textDy),A=RD(n.textOpacity),f=DD(n.textPitchAlignment),d=DD(n.textRotationAlignment),p=RD(n.textRotation),g=DD(n.textAllowOverlapFn),v=DD(n.textIgnorePlacement),w={},C=new Int16Array(1),P=new Uint16Array(1);return[{attrName:"aTextFill",symbolName:"textFill",define:"HAS_TEXT_FILL",type:Uint8Array,width:4,evaluate:(n,o)=>{let s=i(e.getZoom(),n);return ED(s)&&(s=this.evaluateInFnTypeConfig(s,o,e,n,!0)),Array.isArray(s)||(s=w[s]=w[s]||Ck(s).unitArray()),s=GU(s),s}},{attrName:"aTextSize",symbolName:"textSize",define:"HAS_TEXT_SIZE",type:Uint8Array,width:1,evaluate:(n,i)=>{let s=o(e.getZoom(),n)||gW.textSize;return ED(s)&&(s=this.evaluateInFnTypeConfig(s,i,e,n)),C[0]=s,C[0]}},{attrName:"aTextHaloFill",symbolName:"textHaloFill",define:"HAS_TEXT_HALO_FILL",type:Uint8Array,width:4,evaluate:n=>{let i=s(e.getZoom(),n);return Array.isArray(i)||(i=w[i]=w[i]||Ck(i).unitArray()),i=GU(i),i}},{attrName:"aTextHaloRadius",symbolName:"textHaloRadius",define:"HAS_TEXT_HALO_RADIUS",type:Uint8Array,width:1,evaluate:n=>{const i=a(e.getZoom(),n);return C[0]=i,C[0]}},{attrName:"aTextHaloOpacity",symbolName:"textHaloOpacity",define:"HAS_TEXT_HALO_OPACITY",type:Uint8Array,width:1,evaluate:n=>{const i=h(e.getZoom(),n);return C[0]=i,C[0]}},{attrName:"aTextDx",symbolName:"textDx",define:"HAS_TEXT_DX",type:Uint8Array,width:1,evaluate:(n,i)=>{let o=l(e.getZoom(),n);return ED(o)&&(o=this.evaluateInFnTypeConfig(o,i,e,n)),C[0]=o,C[0]}},{attrName:"aTextDy",symbolName:"textDy",define:"HAS_TEXT_DY",type:Uint8Array,width:1,evaluate:(n,i)=>{let o=c(e.getZoom(),n);return ED(o)&&(o=this.evaluateInFnTypeConfig(o,i,e,n)),C[0]=o,C[0]}},{attrName:"aColorOpacity",symbolName:"textOpacity",define:"HAS_OPACITY",type:Uint8Array,width:1,evaluate:(n,i)=>{let o=A(e.getZoom(),n);return ED(o)&&(o=this.evaluateInFnTypeConfig(o,i,e,n)),C[0]=255*o,C[0]}},{attrName:"aPitchAlign",symbolName:"textPitchAlignment",type:Uint8Array,width:1,define:"HAS_PITCH_ALIGN",evaluate:n=>+("map"===f(e.getZoom(),n))},{attrName:"aRotationAlign",symbolName:"textRotationAlignment",type:Uint8Array,width:1,define:"HAS_ROTATION_ALIGN",evaluate:n=>+("map"===d(e.getZoom(),n))},{attrName:"aRotation",symbolName:"textRotation",type:Uint16Array,width:1,define:"HAS_ROTATION",evaluate:n=>{const i=zU(p(e.getZoom(),n),0,360)*Math.PI/180;return P[0]=9362*i,P[0]}},{attrName:"aOverlap",symbolName:"textAllowOverlap",type:Uint8Array,width:1,evaluate:i=>{let o=g(e.getZoom(),i)||0,s=(v?v(e.getZoom(),i):n.textIgnorePlacement)||0;return o=1<<3+4*o,s=(v?2:0)+s,o+s}},{attrName:"aOverlap",symbolName:"textIgnorePlacement",type:Uint8Array,width:1,evaluate:i=>{let o=(g?g(e.getZoom(),i):n.textAllowOverlap)||0,s=v(e.getZoom(),i)||0;return o=(g?8:0)+4*o,s=1<<1+s,o+s}}]}const bW=[],wW=[],CW=[],PW=[];function MW(e,n,i,o,s,a,h){e=1===e?1:0;const l=this.getMap(),c=n.geometry.properties,A=this.getSymbol(c.symbolIndex),f="line"===c.textPlacement&&!QU(A),{aTextSize:d,aTextHaloRadius:p,aShape:g}=c;let v=d?d[i[s]]:n.properties.textSize;null==v&&(v=gW.textSize);const w=p?p[i[s]]:n.properties.textHaloRadius,C=pW(CW,n,i[s]),{aProjectedAnchor:P}=n.geometry.properties;let T=PW;const S=3*i[s];P&&P[S]!==MU?(PW[0]=P[S],PW[1]=P[S+1],PW[2]=P[S+2]):T=jG(PW,C,h,l.width,l.height);const I=o,{boxes:E,collision:O}=this.Fs(n,s);let k=0;if(f||1===n.material.uniforms.rotateWithMap||A.textRotation){let o=0;for(let a=s;a<s+6*I;a+=6){const s=E[k]=E[k]||[];k++;const c=dW.call(this,s,C,T,n,v,w,i[a],h,l);if(!e){const n=this.isCollides(c);1===n?e=1:-1===n&&o++}}o===I&&(e=-1)}else{let o=i[s],c=g[2*o+1];for(let A=s;A<a;A+=6){const s=g[2*i[A]+1];if(c!==s||A===a-6){const f=i[A===a-6?A:A-6],d=dW.call(this,bW,C,T,n,v,w,o,h,l),p=dW.call(this,wW,C,T,n,v,w,f,h,l),g=E[k]=E[k]||[];k++,g[0]=Math.min(d[0],p[0]),g[1]=Math.min(d[1],p[1]),g[2]=Math.max(d[2],p[2]),g[3]=Math.max(d[3],p[3]),o=i[A],c=s,!e&&this.isCollides(g)&&(e=1)}}}return O.collides=e,O}function TW(e,n){const i=function(e,n){const{aPickingId:i,features:o}=e.geometry.properties,s=i[n],a=o&&o[s]&&o[s].feature;return a&&a.label}(e,n);return i?function(e,n,i){if(!i)return null;const o=e.localTransform,s=pW(SW,e,n);E_(IW,s[0],s[1],s[2],1);const a=G_(IW,IW,o);let h=0;for(const e of i)h+=e.codePointAt(0);return[Math.floor(a[0]),Math.floor(a[1]),Math.floor(a[2]),h]}(e,n,i):null}const SW=[],IW=[];var EW="#define SHADER_NAME TEXT_VERT\n#define RAD 0.0174532925\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\nattribute vec2 aShape;\nattribute vec2 aTexCoord;\n#ifdef ENABLE_COLLISION\nattribute float aOpacity;\n#endif\n#ifdef HAS_OPACITY\nattribute float aColorOpacity;\n#endif\n#ifdef HAS_TEXT_SIZE\nattribute float aTextSize;\n#else\nuniform float textSize;\n#endif\n#ifdef HAS_TEXT_DX\nattribute float aTextDx;\n#else\nuniform float textDx;\n#endif\n#ifdef HAS_TEXT_DY\nattribute float aTextDy;\n#else\nuniform float textDy;\n#endif\n#if defined(HAS_PITCH_ALIGN)\nattribute float aPitchAlign;\n#else\nuniform float pitchWithMap;\n#endif\n#if defined(HAS_ROTATION_ALIGN)\nattribute float aRotationAlign;\n#else\nuniform float rotateWithMap;\n#endif\nuniform float flipY;\n#if defined(HAS_ROTATION)\nattribute float aRotation;\n#else\nuniform float textRotation;\n#endif\nuniform float cameraToCenterDistance;\nuniform mat4 positionMatrix;\nuniform mat4 projViewModelMatrix;\nuniform float textPerspectiveRatio;\nuniform vec2 texSize;\nuniform vec2 canvasSize;\nuniform float glyphSize;\nuniform float mapPitch;\nuniform float mapRotation;\nuniform float zoomScale;\nuniform float tileRatio;\nuniform float layerScale;\nuniform float isRenderingTerrain;\n#ifndef PICKING_MODE\nvarying vec2 vTexCoord;\nvarying float vGammaScale;\nvarying float vSize;\nvarying float vOpacity;\n#ifdef HAS_TEXT_FILL\nattribute vec4 aTextFill;\nvarying vec4 vTextFill;\n#endif\n#ifdef HAS_TEXT_HALO_FILL\nattribute vec4 aTextHaloFill;\nvarying vec4 vTextHaloFill;\n#endif\n#ifdef HAS_TEXT_HALO_RADIUS\nattribute float aTextHaloRadius;\nvarying float vTextHaloRadius;\n#endif\n#ifdef HAS_TEXT_HALO_OPACITY\nattribute float aTextHaloOpacity;\nvarying float vTextHaloOpacity;\n#endif\n#include <highlight_vert>\n#else\n#include <fbo_picking_vert>\n#endif\n#include <vt_position_vert>\nvoid main() {\n  vec3 c = unpackVTPosition();\n#ifdef HAS_TEXT_SIZE\nfloat d = aTextSize * layerScale;\n#else\nfloat d = textSize * layerScale;\n#endif\n#ifdef HAS_TEXT_DX\nfloat e = aTextDx;\n#else\nfloat e = textDx;\n#endif\n#ifdef HAS_TEXT_DY\nfloat f = aTextDy;\n#else\nfloat f = textDy;\n#endif\n#if defined(HAS_PITCH_ALIGN)\nfloat h = aPitchAlign;\n#else\nfloat h = pitchWithMap;\n#endif\n#if defined(HAS_ROTATION_ALIGN)\nfloat i = aRotationAlign;\n#else\nfloat i = rotateWithMap;\n#endif\nvec2 j = aShape / 10.0;\n  if(h == 1. && flipY == .0) {\n    j = j * vec2(1., -1.);\n  }\n  vec2 k = aTexCoord;\n  gl_Position = projViewModelMatrix * positionMatrix * vec4(c, 1.);\n  float l = gl_Position.w;\n  float m;\n  if(isRenderingTerrain == 1. && h == 1.) {\n    m = 1.;\n  } else {\n    float n = (1. - cameraToCenterDistance / l) * textPerspectiveRatio;\n    m = clamp(.5 + .5 * (1. - n), .0, 4.);\n  }\n#ifdef HAS_ROTATION\nfloat o = -aRotation / 9362. - mapRotation * i;\n#else\nfloat o = -textRotation - mapRotation * i;\n#endif\nif(h == 1.) {\n    \n#ifdef REVERSE_MAP_ROTATION_ON_PITCH\no += mapRotation;\n#else\no -= mapRotation;\n#endif\n  }\n  float u = sin(o);\n  float v = cos(o);\n  mat2 A = mat2(v, -1. * u, u, v);\n  j = A * (j / glyphSize * d);\n  float B;\n  if(isRenderingTerrain == 1.) {\n    B = 1.;\n  } else {\n    B = l / cameraToCenterDistance;\n  }\n  if(h == .0) {\n    vec2 C = j * 2. / canvasSize;\n    gl_Position.xy += C * m * l;\n  } else {\n    float D;\n    if(isRenderingTerrain == 1.) {\n      D = tileRatio / zoomScale;\n    } else {\n      D = tileRatio / zoomScale * B * m;\n    }\n    vec2 C = j;\n    gl_Position = projViewModelMatrix * positionMatrix * vec4(c + vec3(C, .0) * D, 1.);\n  }\n  gl_Position.xy += vec2(e, -f) * 2. / canvasSize * l;\n#ifndef PICKING_MODE\nif(h == .0) {\n    vGammaScale = mix(1., B, textPerspectiveRatio);\n  } else {\n    vGammaScale = B + mapPitch / 4.;\n  }\n  vTexCoord = k / texSize;\n  vGammaScale = clamp(vGammaScale, .0, 1.);\n  vSize = d;\n#ifdef ENABLE_COLLISION\nvOpacity = aOpacity / 255.;\n#else\nvOpacity = 1.;\n#endif\n#ifdef HAS_OPACITY\nvOpacity *= aColorOpacity / 255.;\n#endif\n#ifdef HAS_TEXT_FILL\nvTextFill = aTextFill / 255.;\n#endif\n#ifdef HAS_TEXT_HALO_FILL\nvTextHaloFill = aTextHaloFill / 255.;\n#endif\n#ifdef HAS_TEXT_HALO_RADIUS\nvTextHaloRadius = aTextHaloRadius;\n#endif\n#ifdef HAS_TEXT_HALO_OPACITY\nvTextHaloOpacity = aTextHaloOpacity;\n#endif\nhighlight_setVarying();\n#else\n#ifdef ENABLE_COLLISION\nbool E = aOpacity == 255.;\n#else\nbool E = true;\n#endif\nfbo_picking_setData(gl_Position.w, E);\n#endif\n}",OW="#define SHADER_NAME TEXT_FRAG\n#define HAS_HIGHLIGHT_COLOR_POINT 1\n#define SDF_PX 8.0\n#define DEVICE_PIXEL_RATIO 1.0\n#define EDGE_GAMMA 0.105 / DEVICE_PIXEL_RATIO\nprecision mediump float;\nuniform sampler2D texture;\nuniform float textOpacity;\nuniform highp float gammaScale;\nuniform int isHalo;\nuniform highp float textHaloBlur;\nuniform float alphaTest;\n#ifdef HAS_TEXT_HALO_OPACITY\nvarying float vTextHaloOpacity;\n#else\nuniform float textHaloOpacity;\n#endif\nuniform float layerOpacity;\nvarying vec2 vTexCoord;\nvarying float vSize;\nvarying float vGammaScale;\nvarying float vOpacity;\n#ifdef HAS_TEXT_FILL\nvarying vec4 vTextFill;\n#else\nuniform vec4 textFill;\n#endif\n#ifdef HAS_TEXT_HALO_FILL\nvarying vec4 vTextHaloFill;\n#else\nuniform vec4 textHaloFill;\n#endif\n#ifdef HAS_TEXT_HALO_RADIUS\nvarying float vTextHaloRadius;\n#else\nuniform highp float textHaloRadius;\n#endif\n#include <highlight_frag>\nvoid main() {\n  \n#ifdef HAS_TEXT_FILL\nvec4 c = vTextFill;\n#else\nvec4 c = textFill;\n#endif\nfloat d = vSize / 24.;\n  lowp vec4 e = c;\n  highp float f = EDGE_GAMMA / (d * gammaScale);\n  lowp float h = 185. / 256.;\n  if(isHalo == 1) {\n    \n#ifdef HAS_TEXT_HALO_FILL\nvec4 i = vTextHaloFill;\n#else\nvec4 i = textHaloFill;\n#endif\n#ifdef HAS_TEXT_HALO_RADIUS\nfloat j = vTextHaloRadius;\n#else\nfloat j = textHaloRadius;\n#endif\ne = i;\n    f = (textHaloBlur * 1.19 / SDF_PX + EDGE_GAMMA) / (d * gammaScale);\n    h = (6. - j / d) / SDF_PX;\n#ifdef HAS_TEXT_HALO_OPACITY\nfloat k = vTextHaloOpacity / 255.;\n#else\nfloat k = textHaloOpacity;\n#endif\ne *= k * 1.25;\n  }\n  float l = texture2D(texture, vTexCoord).a;\n  highp float m = f * vGammaScale * .7;\n  float n = clamp(smoothstep(h - m, h + m, l), .0, 1.);\n  gl_FragColor = e * (n * textOpacity * vOpacity * layerOpacity);\n  if(gl_FragColor.a < alphaTest) {\n    discard;\n  }\n  gl_FragColor = highlight_blendColor(gl_FragColor);\n}";const RW=6,DW=4,kW=new Uint16Array(1),LW=new Int8Array(1);function FW(e,n){const i=RD(n.markerWidth),o=RD(n.markerHeight),s=RD(n.markerDx),a=RD(n.markerDy),h=RD(n.markerOpacity),l=RD(n.markerTextFit),c=DD(n.markerPitchAlignment),A=DD(n.markerRotationAlignment),f=RD(n.markerRotation),d=DD(n.markerAllowOverlapFn),p=DD(n.markerIgnorePlacement),g=new Int16Array(1),v=new Uint16Array(1);return[{attrName:"aMarkerWidth",symbolName:"markerWidth",type:Uint16Array,width:1,define:"HAS_MARKER_WIDTH",evaluate:(o,s,a,h)=>{const c=a[h],A=n.markerTextFit,f=l?l(e.getZoom(),o):A;if("both"===f||"width"===f)return c;let d=i(e.getZoom(),o);return ED(d)&&(d=this.evaluateInFnTypeConfig(d,s,e,o)),g[0]=d,g[0]}},{attrName:"aMarkerHeight",symbolName:"markerHeight",type:Uint16Array,width:1,define:"HAS_MARKER_HEIGHT",evaluate:(i,s,a,h)=>{const c=a[h],A=n.markerTextFit,f=l?l(e.getZoom(),i):A;if("both"===f||"height"===f)return c;let d=o(e.getZoom(),i);return ED(d)&&(d=this.evaluateInFnTypeConfig(d,s,e,i)),g[0]=d,g[0]}},{attrName:"aMarkerDx",symbolName:"markerDx",type:Uint8Array,width:1,define:"HAS_MARKER_DX",evaluate:(n,i)=>{let o=s(e.getZoom(),n);return ED(o)&&(o=this.evaluateInFnTypeConfig(o,i,e,n)),g[0]=o,g[0]}},{attrName:"aMarkerDy",symbolName:"markerDy",type:Uint8Array,width:1,define:"HAS_MARKER_DY",evaluate:(n,i)=>{let o=a(e.getZoom(),n);return ED(o)&&(o=this.evaluateInFnTypeConfig(o,i,e,n)),g[0]=o,g[0]}},{attrName:"aColorOpacity",symbolName:"markerOpacity",type:Uint8Array,width:1,define:"HAS_OPACITY",evaluate:(n,i)=>{let o=h(e.getZoom(),n);return ED(o)&&(o=this.evaluateInFnTypeConfig(o,i,e,n)),g[0]=255*o,g[0]}},{attrName:"aPitchAlign",symbolName:"markerPitchAlignment",type:Uint8Array,width:1,define:"HAS_PITCH_ALIGN",evaluate:n=>+("map"===c(e.getZoom(),n))},{attrName:"aRotationAlign",symbolName:"markerRotationAlignment",type:Uint8Array,width:1,define:"HAS_ROTATION_ALIGN",evaluate:n=>+("map"===A(e.getZoom(),n))},{attrName:"aRotation",symbolName:"markerRotation",type:Uint16Array,width:1,define:"HAS_ROTATION",evaluate:n=>{const i=zU(f(e.getZoom(),n),0,360)*Math.PI/180;return v[0]=9362*i,v[0]}},{attrName:"aOverlap",symbolName:"markerAllowOverlap",type:Uint8Array,width:1,evaluate:i=>{let o=d(e.getZoom(),i)||0,s=(p?p(e.getZoom(),i):n.markerIgnorePlacement)||0;return o=1<<3+4*o,s=(p?2:0)+s,o+s}},{attrName:"aOverlap",symbolName:"markerIgnorePlacement",type:Uint8Array,width:1,evaluate:i=>{let o=(d?d(e.getZoom(),i):n.markerAllowOverlap)||0,s=p(e.getZoom(),i)||0;return o=(d?8:0)+4*o,s=2+s,o+s}}]}function NW(e,n,i,o){if(!i||!o||"none"===o)return;const s=function(e,n,i){let o=e.properties.textFitFn;ED(i)&&(o=e.properties.textFitFn=DD(i));const s="none"!==i,a=[],h=e.getElements(),l=e.data.aPickingId;let c,A,f;n&&(c=n.getElements(),A=n.data.aPickingId,f=n.data.aCount);const d=e.properties.features;let p;if(n){let e=c[0];p={pickingId:A[e],start:0,end:f[e]*RW}}let g=!1,v=!1,w=0;const C=new Set;for(let e=0;e<h.length;e+=RW){const n=l[h[e]];if(!g&&p)for(;p.pickingId<n&&p.end<c.length;){const e=p.end,n=c[e];p.start=e,p.end=e+f[n]*RW,p.pickingId=A[n]}if(!g&&p&&p.pickingId<n&&(g=!0,!s)){if(!v)return[];for(let n=e;n<h.length;n+=RW)a[w++]=[-1,-1];return a}const P=d[n]&&d[n].feature,T=o?o(null,P&&P.properties||{}):i;if(p&&n===p.pickingId){a[w++]=[p.start,p.end];const e=p.end,n=c[e];p.start=e,p.end=e+f[n]*RW,p.pickingId=A[n],v=!0}else if(T&&"none"!==T)for(let n=e;n<e+RW;n++)C.add(n);else a[w++]=[-1,-1]}if(C.size)if(C.size===h.length)e.setElements([]);else{const n=[];for(let e=0;e<h.length;e++)C.has(e)||n.push(h[e]);e.setElements(new h.constructor(n))}return v?a:[]}(n,i,o);if(n.getElements().length&&s.length&&(n.properties.labelIndex=s,s.length&&o&&"none"!==o&&i)){const o=function(e,n){const i=[],o=e.properties.labelIndex,{aShape:s}=n.data;let a=!1;for(let e=0;e<o.length;e++){const[h,l]=o[e];if(-1===h)i.push(0,0,0,0);else{a=!0;let e=1/0,o=1/0,c=-1/0,A=-1/0;const f=n.elements;for(let n=h;n<l;n++){const i=f[n],a=s[2*i],h=s[2*i+1];a<e&&(e=a),a>c&&(c=a),h<o&&(o=h),h>A&&(A=h)}i.push(e,o,c,A)}}return a?i:[]}(n,i);o.length&&(n.properties.labelShape=o,zW.call(this,e,n,i))}}function zW(e,n){const i=this.getSymbolDef(n.properties.symbolIndex),o=i.markerTextFit,s=n.properties;let a="both"===o||"width"===o,h="both"===o||"height"===o;if(ED(i.markerTextFit)){let e=n.properties.textFitFn;e||(e=n.properties.textFitFn=RD(i.markerTextFit));const{features:o}=n.properties,l=n.properties.elements||n.elements,{aPickingId:c}=n.data,A=[],f=[];let d=!0;for(let n=0;n<l.length;n+=RW){const i=o[c[l[n]]],s=(i&&i.feature||{}).properties||{};let a=e(null,s);ED(a)&&(a=(s.textFitFn=s.textFitFn||RD(a))(null,s)),"both"===a?(A.push(n/RW),f.push(n/RW)):"width"===a?(d=!1,A.push(n/RW)):"height"===a&&(d=!1,f.push(n/RW))}d?(s.fitIcons=A,a=!0,h=!0):(A.length&&(s.fitWidthIcons=A,a=!0),f.length&&(s.fitHeightIcons=f,h=!0))}s.aPickingId||(s.aPickingId=new n.data.aPickingId.constructor(n.data.aPickingId));const{aMarkerWidth:l,aMarkerHeight:c,aPickingId:A}=s,f=A.length;if(a)if(l){const e=n.data.aMarkerWidth;n.data.aMarkerWidth=new Uint16Array(e),s.aMarkerWidth=new Uint16Array(e);const i=(MG+"aMarkerWidth").trim();s[i]&&(s[i]=s.aMarkerWidth)}else{const e=this.getSymbol(n.properties.symbolIndex).markerWidth||0;s.aMarkerWidth=new Uint16Array(f),s.aMarkerWidth.fill(e),e&&(s.aMarkerWidth.dirty=!0),n.data.aMarkerWidth=new Uint16Array(f)}if(h)if(c){const e=n.data.aMarkerHeight;n.data.aMarkerHeight=new Uint16Array(e),s.aMarkerHeight=new Uint16Array(e);const i=(MG+"aMarkerHeight").trim();s[i]&&(s[i]=s.aMarkerHeight)}else{const e=this.getSymbol(n.properties.symbolIndex).markerHeight||0;s.aMarkerHeight=new Uint16Array(f),s.aMarkerHeight.fill(e),e&&(s.aMarkerHeight.dirty=!0),n.data.aMarkerHeight=new Uint16Array(f)}const d=this.getSymbolDef(n.properties.textGeo.properties.symbolIndex),p=RD(d.textSize);HW.call(this,e,n),(!ED(d.textSize)||p.isZoomConstant&&p.isFeatureConstant)&&(s.isFitConstant=!0)}const BW=[0,0,0,0];function HW(e,n){const i=n.properties.textGeo;if(!i)return;const o=i.properties,s=n.properties;if(s.isFitConstant||!s.labelShape||!s.labelShape.length)return;const a=this.getSymbolDef(n.properties.symbolIndex),h=this.getSymbolDef(i.properties.symbolIndex).textSize;let l;ED(h)&&(l=o.Ds?o.Ds:o.Ds=RD(h));const c=a.markerTextFitPadding||BW;let A;ED(c)&&(A=s.Ls?s.Ls:s.Ls=DD(c));const f=e.getZoom(),{fitIcons:d,fitWidthIcons:p,fitHeightIcons:g}=s,{aMarkerWidth:v,aMarkerHeight:w,labelShape:C}=s,P=s.elements||n.elements,{features:T,aPickingId:S}=s,I=(e,n,i,o)=>{const a=C[4*n],d=C[4*n+1],p=C[4*n+2],g=C[4*n+3];if(!(a||d||p||g))return;const P=S[e],I=T[P]&&T[P].feature,E=I&&I.properties||{};let O=l?l(f,E):h;ED(O)&&(O=(E.textSizeFn=E.textSizeFn||RD(O))(f,E)),O/=ZV;let k,L,F=A&&A(f,E)||c;if(ED(F)&&(F=(E.fitPaddingFn=E.fitPaddingFn||DD(F))(f,E)),F=F||BW,F[0]===F[2]&&F[1]===F[3]||(k=s.aPadOffsetX,L=s.aPadOffsetY,k||(k=s.aPadOffsetX=new Int8Array(v.length),L=s.aPadOffsetY=new Int8Array(v.length))),v&&i){const n=Math.abs((p-a)/10*O)+(F[1]+F[3]||0);if(kW[0]=n,v[e]!==kW[0]&&(qU(v,kW[0],e,e+DW),v.dirty=!0),k){const n=(F[1]+F[3])/2-F[3];LW[0]=n,k[e]!==LW[0]&&(qU(k,n,e,e+DW),k.dirty=!0)}}if(w&&o){const n=Math.abs((g-d)/10*O)+(F[0]+F[2]||0);if(kW[0]=n,w[e]!==kW[0]&&(qU(w,kW[0],e,e+DW),w.dirty=!0),L){const n=F[0]-(F[0]+F[2])/2;LW[0]=n,L[e]!==LW[0]&&(qU(L,n,e,e+DW),L.dirty=!0)}}};if(d||p||g){if(d)for(let e=0;e<d.length;e++){const n=d[e];I(P[n*RW],n,!0,!0)}else if(p||g){if(p)for(let e=0;e<p.length;e++){const n=p[e];I(P[n*RW],n,!0,!1)}if(g)for(let e=0;e<g.length;e++){const n=g[e];I(P[n*RW],n,!1,!0)}}}else for(let e=0;e<P.length;e+=RW){I(P[e],e/RW,!0,!0)}const{aPadOffsetX:E,aPadOffsetY:O}=s;E&&(n.data.aPadOffsetX=E,n.data.aPadOffsetY=O)}const jW=function(e){const n=this.layer.getRenderer();return!this.Es(e)&&n.isForeground(e)&&!!e.geometry.properties.iconAtlas&&!e.geometry.properties.isEmpty},UW=function(e){const n=this.layer.getRenderer();return!(this.Es(e)||n.isForeground(e)||!e.geometry.properties.iconAtlas||e.geometry.properties.isEmpty)},GW=function(e){const n=this.layer.getRenderer();return!this.Es(e)&&n.isForeground(e)&&!!e.geometry.properties.glyphAtlas},VW=function(e){const n=this.layer.getRenderer();return!this.Es(e)&&!n.isForeground(e)&&!!e.geometry.properties.glyphAtlas},WW=[],qW={collides:-1},ZW=[qV,qV],QW=xv([]),XW=[];let YW=class bu extends th{static getBloomSymbol(){return["markerBloom","textBloom"]}constructor(e,n,i,o,s,a){super(e,n,i,o,s,a),this.propAllowOverlap="markerAllowOverlap",this.propIgnorePlacement="markerIgnorePlacement",this.nr={},this.isLabelCollides=MW.bind(this),this.Rs=jW.bind(this),this.Hs=UW.bind(this),this.zs=GW.bind(this),this.Ns=VW.bind(this),this.Vs=[]}needToRefreshTerrainTileOnZooming(){for(let e=0;e<this.symbolDef.length;e++){const n=this.symbolDef[e].markerPitchAlignment;if("map"===n||ED(n)||QB(n))return!0}return!1}isTerrainVector(){return this.layer.options.awareOfTerrain&&!this.needToRefreshTerrainTileOnZooming()}isTerrainSkin(){return super.isTerrainSkin()&&this.needToRefreshTerrainTileOnZooming()}setTextShaderDefines(e){this.Us=e}createFnTypeConfig(e,n){return{icon:FW.call(this,e,n),text:xW.call(this,e,n)}}startFrame(...e){return this.Vs.length=0,super.startFrame(...e)}createGeometry(e,n){return e&&e.empty&&(e.data={aPosition:new Uint8Array(e.data.aPosition),aPickingId:e.data.aPickingId}),super.createGeometry(e,n)}postCreateGeometry(e,n){const{geometry:i,symbolIndex:o}=e,s=this.getSymbolDef(o),a=this.getFnTypeConfig(o);if(this.js(i))i.properties.iconAtlas?this.drawDebugAtlas(i.properties.iconAtlas):i.properties.isEmpty=!0,function(e,n,i,o){SG(e,n,i,o),function(e){const{aMarkerWidth:n,aMarkerHeight:i,aMarkerDx:o,aMarkerDy:s,aPitchAlign:a,aRotationAlign:h,aRotation:l,aOverlap:c}=e.data;if(n){const i=(MG+"aMarkerWidth").trim();e.properties.aMarkerWidth=e.properties[i]||new n.constructor(n)}if(i){const n=(MG+"aMarkerHeight").trim();e.properties.aMarkerHeight=e.properties[n]||new i.constructor(i)}if(o){const n=(MG+"aMarkerDx").trim();e.properties.aMarkerDx=e.properties[n]||new o.constructor(o)}if(s){const n=(MG+"aMarkerDy").trim();e.properties.aMarkerDy=e.properties[n]||new s.constructor(s)}if(a){const n=(MG+"aPitchAlign").trim();e.properties.aPitchAlign=e.properties[n]||new a.constructor(a)}if(h){const n=(MG+"aRotationAlign").trim();e.properties.aRotationAlign=e.properties[n]||new h.constructor(h)}if(l){const n=(MG+"aRotation").trim();e.properties.aRotation=e.properties[n]||new l.constructor(l)}if(c){const n=(MG+"aOverlap").trim();e.properties.aOverlap=e.properties[n]||new c.constructor(c)}}(e)}(i,s,a.icon,this.layer);else if(this.Gs(i)&&QU(s)){const e=n[n.length-1];if(e){const{geometry:n,symbolIndex:a}=e;if(n&&a.index===o.index){const e=this.getMap(),o=s.markerTextFit;n.properties.textGeo=i,NW.call(this,e,n,i,o)}}}}prepareCollideIndex(e){const{collideIds:n,elements:i,aCount:o}=e.properties;if(!n)return;const s=n,a={};if(!i)return void(e.properties.collideBoxIndex=a);let h=0,l=i[0],c=0,A=s[l],f=1;o&&(f=o[i[c]]);for(let e=0;e<=i.length;e+=RW)l=i[e],s[l]===A&&e!==i.length||(a[A]=[c,e,(e-c)/(f*RW),h++],A=s[l],c=e,o&&(f=o[i[c]]));e.properties.collideBoxIndex=a}createMesh(e,n,i,o){const s=this.isEnableCollision(),a=this.layer,{geometry:h,symbolIndex:l}=e;h.properties.symbolIndex=l;const c=this.getSymbolDef(l),A=this.getSymbol(l),f=this.getFnTypeConfig(l),d=[];if(this.js(h)){const e=function(e,n,i,o,s,a,h,l){if(n.isDisposed()||0===n.data.aPosition.length)return null;const c=n.properties.iconAtlas;if(!c&&!n.properties.isEmpty)return null;const A={flipY:0,tileResolution:n.properties.tileResolution,tileRatio:n.properties.tileRatio};
//!geometry.properties.aShape collision
if(!n.properties.aShape){const{aPosition:e,aShape:i}=n.data,o=n.data.aPosition.length/n.desc.positionSize,s=new Uint8Array(o);l&&s.fill(255,0),n.data.aOpacity={usage:"dynamic",data:s},n.properties.aOpacity=new Uint8Array(o),l&&n.properties.aOpacity.fill(255,0),n.properties.aAnchor=e,n.properties.aShape=i}n.properties.visElemts||(n.properties.elements=n.elements,n.properties.visElemts=new n.elements.constructor(n.elements.length));const[f,d]=fV(n);jU(A,"markerOpacity",s,"markerOpacity",1),jU(A,"markerPerspectiveRatio",s,"markerPerspectiveRatio",s.markerTextFit?0:1),jU(A,"markerWidth",s,"markerWidth",f||15),jU(A,"markerHeight",s,"markerHeight",d||15),jU(A,"markerDx",s,"markerDx",0),jU(A,"markerDy",s,"markerDy",0),jU(A,"markerRotation",s,"markerRotation",0,(e=>e*Math.PI/180)),jU(A,"pitchWithMap",s,"markerPitchAlignment",0,(e=>"map"===e?1:0)),jU(A,"rotateWithMap",s,"markerRotationAlignment",0,(e=>"map"===e?1:0)),A.iconTex=c?uV(e,c,!1):null,A.texSize=c?[c.width,c.height]:[0,0],n.generateBuffers(e,{excludeElementsInVAO:!0});const p=new cC(A),g=new bC(n,p,{disableVAO:!0,transparent:!0,castShadow:!1,picking:!0}),v={};return h&&(v.ENABLE_COLLISION=1),n.data.aMarkerWidth&&(v.HAS_MARKER_WIDTH=1),n.data.aMarkerHeight&&(v.HAS_MARKER_HEIGHT=1),n.data.aColorOpacity&&(v.HAS_OPACITY=1),n.data.aMarkerDx&&(v.HAS_MARKER_DX=1),n.data.aMarkerDy&&(v.HAS_MARKER_DY=1),n.data.aPitchAlign&&(v.HAS_PITCH_ALIGN=1),n.data.aRotationAlign&&(v.HAS_ROTATION_ALIGN=1),n.data.aRotation&&(v.HAS_ROTATION=1),n.data.aPadOffsetX&&(v.HAS_PAD_OFFSET=1),n.data.aAltitude&&(v.HAS_ALTITUDE=1),g.setDefines(v),g.setUniform("alphaTest",QV),g.setLocalTransform(i),g.properties.symbolIndex=n.properties.symbolIndex,g}(this.regl,h,n,0,A,0,a.options.collision,!s,this.isEnableUniquePlacement());e&&(e.positionMatrix=this.getAltitudeOffsetMatrix(),delete e.geometry.properties.glyphAtlas,d.push(e))}else if(this.Gs(h)){const e=mW.call(this,this.regl,h,n,c,A,f.text,a.options.collision,!s,this.isEnableUniquePlacement());e.length&&(e.forEach((e=>{e.positionMatrix=this.getAltitudeOffsetMatrix(),delete e.geometry.properties.iconAtlas})),d.push(...e))}return"line"===h.properties.markerPlacement&&this.Bs(h,o),"line"===h.properties.markerPlacement&&d.forEach((e=>e.properties.isLinePlacement=!0)),this.prepareCollideIndex(h),d}Bs(e,n){const i=this.layer instanceof Qp,{collideIds:o}=e.properties,s=new Uint16Array(o.length);if(this.js(e)){let a=0;for(let e=0;e<o.length;e+=DW)s.fill(a++,e,e+DW);e.properties.collideIds=s,e.properties.uniqueCollideIds=YU(s,!i),n.markerCollideMap={old:o,new:s}}else if(this.Gs(e)){const{collideIds:o,aCount:s}=e.properties;if(!s)return;if(n.markerCollideMap){const{markerCollideMap:a}=n;let h=a.new[a.new.length-1],l=0,c=o[0],A=n.markerCollideMap.old.indexOf(c),f=s[0];for(let e=0;e<o.length;){const i=o[e];c!==i&&(c=i,A=n.markerCollideMap.old.indexOf(c),l=0);const a=-1===A?++h:n.markerCollideMap.new[A+l*DW],d=e+f*DW;o.fill(a,e,d),e+=f*DW,l++,d<o.length&&(f=s[d])}e.properties.uniqueCollideIds=YU(o,!i)}else{let n=0,a=s[0];for(let e=0;e<o.length;){const i=e+a*DW;o.fill(n++,e,i),e+=a*DW,i<o.length&&(a=s[i])}e.properties.uniqueCollideIds=YU(o,!i)}}}addMesh(e){if(this.isEnableCollision()&&e.length>0){const n=new $l(e);n.properties.uniqueCollideIds=e[0].geometry.properties.uniqueCollideIds,n.properties.meshKey=e[0].properties.meshKey,n.properties.level=e[0].properties.level,this.Vs.push(n)}for(let n=0;n<e.length;n++){if(!this.isMeshIterable(e[n]))continue;const i=e[n].geometry,{symbolIndex:o}=i.properties;QU(this.getSymbolDef(o))&&HW.call(this,this.getMap(),i)}const n=this.getMap().getZoom();for(let i=0;i<e.length;i++){if(!this.isMeshIterable(e[i]))continue;const o=e[i].geometry,{symbolIndex:s}=o.properties,a=this.getSymbolDef(s),h=this.getFnTypeConfig(s);RG(this.regl,this.layer,a,0===s.type?h.icon:h.text,e[i],n);const{aMarkerWidth:l,aMarkerHeight:c,aPadOffsetX:A,aPadOffsetY:f}=o.properties;l&&l.dirty&&(o.updateData("aMarkerWidth",l),l.dirty=!1),c&&c.dirty&&(o.updateData("aMarkerHeight",c),c.dirty=!1),A&&A.dirty&&(o.updateData("aPadOffsetX",A),A.dirty=!1),f&&f.dirty&&(o.updateData("aPadOffsetY",f),f.dirty=!1)}super.addMesh(...arguments)}updateCollision(e){if(!this.isEnableCollision())return;super.updateCollision(e);const n=this.scene.getMeshes();n&&n.length?(this.$s(e.timestamp),this.Vs=[],this.Gr()):this.Gr()}callCurrentTileShader(e,n){this.shader.filter=n.sceneFilter?[this.Rs,n.sceneFilter]:this.Rs,this.callRenderer(this.shader,e,n),this.Ws.filter=n.sceneFilter?[this.zs,n.sceneFilter]:this.zs,this.callRenderer(this.Ws,e,n)}callBackgroundTileShader(e,n){this.shader.filter=n.sceneFilter?[this.Hs,n.sceneFilter]:this.Hs,this.callRenderer(this.shader,e,n),this.Ws.filter=n.sceneFilter?[this.Ns,n.sceneFilter]:this.Ns,this.callRenderer(this.Ws,e,n)}isMeshIterable(e){return e&&e.geometry&&!e.geometry.properties.isEmpty&&e.material&&!e.material.get("isHalo")&&this.isMeshVisible(e)&&!(this.shouldIgnoreBackground()&&!this.layer.getRenderer().isForeground(e))}$s(){if(!this.isEnableCollision())return;let e=this.Vs;e&&e.length&&this.Xs(e)}Ys(e,n,i,o){return this.updateBoxCollisionFading(!0,e,n,i,o)}isEnableUniquePlacement(){return this.isEnableCollision()&&!0===this.sceneConfig.uniquePlacement}Xs(e){const n=this.layer.getRenderer();e=e.sort(JW);for(let i=0;i<e.length;i++){const o=e[i];if(!o||!o.meshes.length)continue;let s=!1;if(1===o.meshes.length)s=this.isMeshIterable(o.meshes[0]);else for(let e=0;e<o.meshes.length;e++)if(this.isMeshIterable(o.meshes[e])){s=!0;break}if(!s)continue;const a=n.isForeground(o.meshes[0]);if(this.shouldIgnoreBackground()&&!a)continue;const h=o.properties.meshKey;this.startMeshCollision(o),this.qs(o),this.forEachBox(o,this.Ys),this.Js(o),this.endMeshCollision(h);for(let e=0;e<o.meshes.length;e++)this.Ks(o.meshes[e])}}Ks(e){const n=e&&e.geometry&&e.geometry.properties.aOpacity;n&&n.dirty&&(e.geometry.updateData("aOpacity",n),n.dirty=!1)}forEachBox(e,n){const i=e.properties.uniqueCollideIds;if(!i)return;const o={boxIndex:0},s=i.length;for(let a=0;a<s;a++)this.Zs(e,i[a],n,o)}Zs(e,n,i,o){const s=this.getMap(),{collideBoxIndex:a}=e.meshes[0].geometry.properties;if(!a||!a[n])return!1;const h=Cv(WW,s.projViewMatrix,e.meshes[0].localTransform);let l,c=!1;const A=e.meshes;let f=0;for(let e=0;e<A.length;e++){if(!this.isMeshIterable(A[e]))continue;const{collideBoxIndex:i}=A[e].geometry.properties;i[n]&&f++}if(!f)return!1;l=this.Cs(f);let d=0;for(let e=0;e<A.length;e++){if(!this.isMeshIterable(A[e]))continue;c=!0;const i=A[e].geometry.properties,{elements:o,aCount:s,collideBoxIndex:a}=i,h=a[n];if(!h)continue;const[f,p,g]=h;let v=1;s&&(v=s[o[f]]);const w=f+0*v*RW;l[d].mesh=A[e],l[d].start=w,l[d].end=p,l[d].boxCount=i.glyphAtlas?v:g,l[d].allElements=o,d++}return!!c&&(i.call(this,e,l,h,o.boxIndex++)&&this.Qs(e,n),!0)}qs(e){const n=e.meshes;for(let e=0;e<n.length;e++){const i=n[e],o=i&&i.geometry;o&&(o.properties.visElemts.count=0)}}Qs(e,n){const i=e.meshes;for(let e=0;e<i.length;e++){const o=i[e];if(o.properties.isHalo)continue;const s=o&&o.geometry;if(!s||s.properties.isEmpty)continue;const{collideBoxIndex:a,elements:h,visElemts:l}=s.properties,c=a[n];if(!c)continue;const[A,f]=c;let d=l.count;for(let e=A;e<f;e++)l[d++]=h[e];l.count=d}}Js(e){const n=e.meshes;for(let e=0;e<n.length;e++){const i=n[e],o=i&&i.geometry;if(!o)continue;const{visElemts:s}=o.properties;o.setElements(s,s.count)}}isBoxCollides(e,n,i,o,s,a){if(this.Gs(e.geometry))return MW.call(this,0,e,n,i,o,s,a);if(e.geometry.properties.isEmpty)return qW;const{aTerrainAltitude:h}=e.geometry.properties;if(h&&h[2*n[o]]===TU)return qW;const l=this.getMap(),{boxes:c,collision:A}=this.Fs(e,o);let f=0,d=0,p=0;for(let i=o;i<s;i+=RW){const o=c[p]=c[p]||[];p++;const s=oW.call(this,o,e,n[i],a,l);if(!f){const e=this.isCollides(s);1===e?f=1:-1===e&&d++}}return d===i&&(f=-1),A.collides=f,A}deleteMesh(e,n){e&&(e instanceof $l&&(e=e.meshes),n&&(Array.isArray(e)?e.forEach((e=>{e&&e.material&&delete e.material.uniforms.iconTex})):e.material&&delete e.material.uniforms.iconTex),super.deleteMesh(e,n))}isBloom(e){const n=e&&e.material&&!BU(e.material.get("markerOpacity")),i=this.getSymbol(e.properties.symbolIndex);return!!(n?i.markerBloom:i.textBloom)}isUniqueStencilRefPerTile(){return!1}init(){const e=this.canvas;this.renderer=new PC(this.regl);const n={viewport:{x:(e,n)=>n.viewport?n.viewport.x:0,y:(e,n)=>n.viewport?n.viewport.y:0,width:(n,i)=>i.viewport?i.viewport.width:e?e.width:1,height:(n,i)=>i.viewport?i.viewport.height:e?e.height:1},stencil:{enable:!0,func:{cmp:"<=",ref:(e,n)=>n.stencilRef},op:{fail:"keep",zfail:"keep",zpass:"replace"}},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"},depth:{enable:!0,range:()=>this.sceneConfig.depthRange||[0,1],func:()=>this.sceneConfig.depthFunc||"always",mask:!!BU(this.sceneConfig.depthMask)||this.sceneConfig.depthMask},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}};this.shader=new eP({vert:FV,frag:"#define SHADER_NAME MARKER\n#define HAS_HIGHLIGHT_COLOR_POINT 1\nprecision mediump float;\n#include <gl2_frag>\nuniform float alphaTest;\nuniform sampler2D iconTex;\nuniform lowp float markerOpacity;\nuniform lowp float blendSrcIsOne;\nuniform float layerOpacity;\n#include <highlight_frag>\nvarying vec2 vTexCoord;\nvarying float vOpacity;\nvoid main() {\n  vec4 c = texture2D(iconTex, vTexCoord) * markerOpacity * vOpacity * layerOpacity;\n  if(c.a < .05) {\n    discard;\n  }\n  glFragColor = c;\n  glFragColor = highlight_blendColor(glFragColor);\n  if(glFragColor.a < alphaTest) {\n    discard;\n  }\n  glFragColor = highlight_blendColor(glFragColor);\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(e,n){return Cv([],n.projViewMatrix,n.modelMatrix)}},{name:"zoomScale",type:"function",fn:function(e,n){return n.tileResolution/n.resolution}}],extraCommandProps:n}),this.shader.version=300;const{uniforms:i,extraCommandProps:o}=_W.call(this,e,this.sceneConfig);if(this.Ws=new eP({vert:EW,frag:OW,uniforms:i,extraCommandProps:o,defines:this.Us||{}}),this.pickingFBO){const e=new XM(this.renderer,{vert:"#define PICKING_MODE 1\n"+FV,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(e,n){return Cv([],n.projViewMatrix,n.modelMatrix)}},{name:"zoomScale",type:"function",fn:function(e,n){return n.tileResolution/n.resolution}}],extraCommandProps:n},this.pickingFBO,this.getMap());e.filter=e=>!!e.geometry.properties.iconAtlas;const s=new XM(this.renderer,{vert:"#define PICKING_MODE 1\n"+EW,uniforms:i,extraCommandProps:o},this.pickingFBO,this.getMap());s.filter=e=>!!e.geometry.properties.glyphAtlas,this.picking=[e,s]}}getUniformValues(e,n){const i=n&&n.isRenderingTerrainSkin,o=this.layer.getTileSize().width,s=i?QW:e.projViewMatrix,a=e.cameraToCenterDistance,h=Zx(XW,e.width,e.height);i&&Zx(h,o,o);const l=this.getBlendFunc(),c=Yo.isFunction(l.src)?l.src():l.src;return{layerScale:this.layer.options.styleScale||1,mapPitch:e.getPitch()*Math.PI/180,mapRotation:e.getBearing()*Math.PI/180,projViewMatrix:s,cameraToCenterDistance:a,canvasSize:h,iconSize:ZW,resolution:e.getResolution(),glyphSize:ZV,gammaScale:1,blendSrcIsOne:+!("one"!==c&&1!==c),viewport:i&&n&&n.viewport,isRenderingTerrain:+!!i}}getUniqueEntryKey(e,n){if(!this.Gs(e.geometry))return null;const{elements:i}=e.geometry.properties;return TW(e,i[n])}js(e){const{symbolIndex:n}=e.properties;return 0===n.type}Gs(e){const{symbolIndex:n}=e.properties;return 1===n.type}};function JW(e,n){return e.properties.level-n.properties.level||e.properties.meshKey-n.properties.meshKey}const KW=[],$W=[],tq=[];function eq(e,n,i,o,s,a,h,l,c,A,f,d,p){const{aGlyphOffset:g,aSegment:v,aTextDx:w,aTextDy:C,symbolIndex:P}=n.geometry.properties,T=this.getSymbol(P),S=Zx(tq,(w?w[s]:T.textDx)||0,(C?C[s]:T.textDy)||0),I=Zx(KW,g[2*s],g[2*s+1]),E=$v($W,v[3*s],v[3*s+1],v[3*s+2]),O=function(e,n,i,o,s,a,h,l,c,A,f,d,p,g,v,w,C,P){v||(v=o);const T=n.geometry.properties.line,S=a[0]*d,I=p?S-h:S+h;let E=I>0?1:-1,O=0;p&&(E*=-1,O=Math.PI),E<0&&(O+=Math.PI);const k=A+f,L=Math.abs(I);let F=E>0?c:c+1,N=tF.convert(o),z=tF.convert(o),H=tF.convert(s),j=tF.convert(s),W=0,q=0;for(;W+q<=L;){if(F+=E,F<A||F>=k)return null;z.x=N.x,z.y=N.y,j.x=H.x,j.y=H.y,N.x=i[3*F],N.y=i[3*F+1],H.x=T[3*F],H.y=T[3*F+1],W+=q,q=z.dist(N)/g}const Y=(L-W)/q,J=w&&w.getRenderer(),$=J&&J.getTerrainHelper(),it=n.properties.tile.terrainTileInfos;if(!P&&$){const{extent:i}=n.properties.tile,o=w.getTileSize().width/i,s=w.getMap();let a=H.sub(j).mult(Y).i(j);N=QG(UG,s,n,H,o,w,C,it),z=QG(GG,s,n,j,o,w,C,it),a=QG(VG,s,n,a,o,w,C,it);const h=O+Math.atan2(N[1]-z[1],N[0]-z[0]);return e[0]=(a[0]-v[0])/g,e[1]=(a[1]-v[1])/g,e[2]=h,e}const rt=N.sub(z),ot=rt.mult(Y).i(z);ot.i(rt.T().I().A(l*E));const st=O+Math.atan2(N.y-z.y,N.x-z.x);return e[0]=(ot.x-o[0])/g,e[1]=(ot.y-o[1])/g,e[2]=st,e}(e,n,o,a,h,I,S[0],S[1],E[0],E[1],E[2],i/24,c,l,A,f,d,p);return O}const nq=[],iq=[];function rq(e,n,i,o,s,a,h,l,c,A,f,d){const{aVertical:p}=i.geometry.properties,g=p[a];let v,w,C=eq.call(this,nq,i,o,s,a,l,c,A,!1);if(!C)return null;if(Kv(e,C),C=eq.call(this,iq,i,o,s,h,l,c,A,!1),!C)return null;if(Kv(n,C),d&&(rb(nq,nq,d),rb(iq,iq,d)),g){const e=Math.abs(iq[1]-nq[1]),n=Math.abs(iq[0]-nq[0])*f;w=nq[0]>iq[0]?1:0,e>n?(v=1,w=nq[1]<iq[1]?0:1):v=0}else v=0,w=nq[0]>iq[0]?1:0;return 2*w+v}var oq="#define SHADER_NAME TEXT_LINE\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\nattribute vec2 aTexCoord;\n#ifdef HAS_OFFSET_Z\nattribute vec3 aOffset;\nuniform float altitudeScale;\n#else\nattribute vec2 aOffset;\n#endif\n#ifdef ENABLE_COLLISION\nattribute float aOpacity;\n#endif\n#ifdef HAS_OPACITY\nattribute float aColorOpacity;\n#endif\n#ifdef HAS_TEXT_SIZE\nattribute float aTextSize;\n#else\nuniform float textSize;\n#endif\n#ifdef HAS_TEXT_DX\nattribute float aTextDx;\n#else\nuniform float textDx;\n#endif\n#ifdef HAS_TEXT_DY\nattribute float aTextDy;\n#else\nuniform float textDy;\n#endif\n#if defined(HAS_PITCH_ALIGN)\nattribute float aPitchAlign;\n#else\nuniform float pitchWithMap;\n#endif\nuniform float zoomScale;\nuniform float cameraToCenterDistance;\nuniform mat4 projViewModelMatrix;\nuniform float textPerspectiveRatio;\nuniform float mapPitch;\nuniform vec2 texSize;\nuniform vec2 canvasSize;\nuniform float tileRatio;\nuniform float layerScale;\nuniform float isRenderingTerrain;\nuniform float textPitchFilter;\n#ifndef PICKING_MODE\nvarying vec2 vTexCoord;\nvarying float vGammaScale;\nvarying float vSize;\nvarying float vOpacity;\n#ifdef HAS_TEXT_FILL\nattribute vec4 aTextFill;\nvarying vec4 vTextFill;\n#endif\n#ifdef HAS_TEXT_HALO_FILL\nattribute vec4 aTextHaloFill;\nvarying vec4 vTextHaloFill;\n#endif\n#ifdef HAS_TEXT_HALO_RADIUS\nattribute float aTextHaloRadius;\nvarying float vTextHaloRadius;\n#endif\n#ifdef HAS_TEXT_HALO_OPACITY\nattribute float aTextHaloOpacity;\nvarying float vTextHaloOpacity;\n#endif\n#include <highlight_vert>\n#else\n#include <fbo_picking_vert>\n#endif\n#include <vt_position_vert>\nvoid main() {\n  vec3 c = unpackVTPosition();\n#ifdef HAS_TEXT_DX\nfloat d = aTextDx;\n#else\nfloat d = textDx;\n#endif\n#ifdef HAS_TEXT_DY\nfloat e = aTextDy;\n#else\nfloat e = textDy;\n#endif\n#ifdef HAS_TEXT_SIZE\nfloat f = aTextSize * layerScale;\n#else\nfloat f = textSize * layerScale;\n#endif\n#ifdef HAS_PITCH_ALIGN\nfloat h = aPitchAlign;\n#else\nfloat h = pitchWithMap;\n#endif\ngl_Position = projViewModelMatrix * vec4(c, 1.);\n  float i = gl_Position.w;\n  float j = i / cameraToCenterDistance;\n  float k;\n  if(isRenderingTerrain == 1.) {\n    k = 1.;\n  } else {\n    float l = (1. - cameraToCenterDistance / i) * textPerspectiveRatio;\n    k = clamp(.5 + .5 * (1. - l), .0, 4.);\n  }\n#ifdef HAS_OFFSET_Z\nvec3 m = aOffset / 10.0;\n  m[2] /= altitudeScale;\n#else\nvec3 m = vec3(aOffset / 10.0, .0);\n#endif\nvec2 n = aTexCoord;\n  if(h == 1.) {\n    float o;\n    if(isRenderingTerrain == 1.) {\n      o = tileRatio;\n    } else {\n      o = tileRatio / zoomScale * j * k;\n    }\n    m.xy *= o;\n    gl_Position = projViewModelMatrix * vec4(c + m, 1.);\n  } else {\n    gl_Position.xy += m.xy * 2. / canvasSize * k * i;\n  }\n  gl_Position.xy += vec2(d, -e) * 2. / canvasSize * i;\n  if(textPitchFilter > .0) {\n    if(textPitchFilter == 1. && h == .0 || textPitchFilter == 2. && h == 1.) {\n      gl_Position = vec4(-9999., -9999., .0, 1.);\n    }\n  }\n#ifndef PICKING_MODE\nif(h == 1.) {\n    vGammaScale = j + mapPitch / 4.;\n  } else {\n    vGammaScale = mix(1., j, textPerspectiveRatio);\n  }\n  vGammaScale = clamp(vGammaScale, .0, 1.);\n  vTexCoord = n / texSize;\n  vSize = f;\n#ifdef ENABLE_COLLISION\nvOpacity = aOpacity / 255.;\n#else\nvOpacity = 1.;\n#endif\n#ifdef HAS_OPACITY\nvOpacity *= aColorOpacity / 255.;\n#endif\n#ifdef HAS_TEXT_FILL\nvTextFill = aTextFill / 255.;\n#endif\n#ifdef HAS_TEXT_HALO_FILL\nvTextHaloFill = aTextHaloFill / 255.;\n#endif\n#ifdef HAS_TEXT_HALO_RADIUS\nvTextHaloRadius = aTextHaloRadius;\n#endif\n#ifdef HAS_TEXT_HALO_OPACITY\nvTextHaloOpacity = aTextHaloOpacity;\n#endif\nhighlight_setVarying();\n#else\n#ifdef ENABLE_COLLISION\nbool u = aOpacity == 255.;\n#else\nbool u = true;\n#endif\nfbo_picking_setData(gl_Position.w, u);\n#endif\n}";const sq=function(e){const n=this.layer.getRenderer();return!this.Es(e)&&n.isTileNearCamera(e)&&"line"!==e.geometry.properties.textPlacement},aq=function(e){const n=this.layer.getRenderer();return!this.Es(e)&&!n.isForeground(e)&&"line"!==e.geometry.properties.textPlacement},hq=function(e){const n=this.layer.getRenderer();return!this.Es(e)&&n.isTileNearCamera(e)&&"line"===e.geometry.properties.textPlacement},lq=function(e){const n=this.layer.getRenderer(),i=e.properties.tile.z,o=n.getCurrentTileZoom();return!this.Es(e)&&!n.isForeground(e)&&"line"===e.geometry.properties.textPlacement&&i<o},uq=[0,0,3],cq=[],Aq=[],fq=[],dq=[],pq=[],gq=[],mq=[],yq=[],vq=[1,-1],_q=new Int16Array(3),xq=[],bq=[],wq=[],Cq=[],Pq=[],Mq=[],Tq=[],Sq={},Iq={},Eq={},Oq=[],Rq=[],Dq=xv([]),kq=[];class sc extends th{static getBloomSymbol(){return["textBloom"]}constructor(e,n,i,o,s,a){super(e,n,i,o,s,a),this.propAllowOverlap="textAllowOverlap",this.propIgnorePlacement="textIgnorePlacement",this.colorCache={},this.eo=sq.bind(this),this.no=aq.bind(this),this.io=hq.bind(this),this.ro=lq.bind(this),this.isLabelCollides=MW.bind(this),this.so()}prepareRender(...e){super.prepareRender(...e);const n=this.scene.getMeshes();if(n&&n.length)for(let e=0;e<n.length;e++){if(n[e].properties.isHalo)continue;const{haloMesh:i}=n[e].properties;i.dirtyDefines&&n[e].setDefines(i.defines)}}updateSymbol(...e){this.oo=void 0,this.ao=void 0;const n=super.updateSymbol(...e);return this.so(),n}isTerrainVector(){if(!super.isTerrainSkin())return!1;if(void 0!==this.oo)return this.oo;for(let e=0;e<this.symbolDef.length;e++)if("map"!==this.symbolDef[e].textPitchAlignment)return this.oo=!0,!0;return this.oo=!1,!1}isTerrainSkin(){if(!super.isTerrainSkin())return!1;if(void 0!==this.ao)return this.ao;for(let e=0;e<this.symbolDef.length;e++){const n=this.symbolDef[e].textPitchAlignment;if("map"===n||ED(n)||QB(n))return this.ao=!0,!0}return this.ao=!1,!1}so(){this.lo=[];for(let e=0;e<this.symbolDef.length;e++){const n=this.symbolDef[e];if(QB(n.textName)){const i=ZB(n.textName,"string");this.lo[e]=(e,n)=>{let o;Sq.zoom=e,Iq.properties=n;try{o=i.evaluateWithoutErrorHandling(Sq,Iq,Eq,null,Oq)}catch(e){o=null}return o}}else ED(n.textName)&&(this.lo[e]=RD(n.textName))}}shouldDeleteMeshOnUpdateSymbol(e){if(!Array.isArray(e))return(0===e.textHaloRadius||0===this.symbolDef[0].textHaloRadius)&&e.textHaloRadius!==this.symbolDef[0].textHaloRadius;for(let n=0;n<e.length;n++)if(e[n]&&(0===e[n].textHaloRadius||0===this.symbolDef[n].textHaloRadius)&&e[n].textHaloRadius!==this.symbolDef[n].textHaloRadius)return!0;return!1}createFnTypeConfig(e,n){return xW(e,n)}isBloom(e){return!!this.getSymbol(e.properties.symbolIndex)[sc.getBloomSymbol()[0]]}createGeometry(e,n,i){const o=e;if(!o.glyphAtlas)return null;const s=super.createGeometry(o,n);if(!s||!s.geometry)return null;const{geometry:a}=s;return a.properties.glyphAtlas&&this.drawDebugAtlas(a.properties.glyphAtlas),a&&o.lineVertex&&(a.properties.line=o.lineVertex,a.properties.line.id=i),s}createMesh(e,n,{tileVectorTransform:i}){const o=this.isEnableCollision(),s=this.isEnableUniquePlacement(),{geometry:a,symbolIndex:h}=e;a.properties.symbolIndex=h;const l=this.getSymbol(h),c=this.getSymbolDef(h),A=this.getFnTypeConfig(h),f=mW.call(this,this.regl,a,n,c,l,A,this.layer.options.collision,!o,s);return f.length&&("line"===a.properties.textPlacement?this.ho=!0:this.uo=!0),f.forEach((e=>{e.positionMatrix=this.getAltitudeOffsetMatrix(),e.properties.tileVectorTransform=i})),f}updateCollision(e){super.updateCollision(e);const n=this.scene.getMeshes();n&&n.length?(this.co={},this.fo(e.timestamp),this.Gr()):this.Gr()}callCurrentTileShader(e,n){this.shader.filter=n.sceneFilter?[this.eo,n.sceneFilter]:this.eo,this.callRenderer(this.shader,e,n),this.do.filter=n.sceneFilter?[this.io,n.sceneFilter]:this.io,this.callRenderer(this.do,e,n)}callBackgroundTileShader(e,n){this.shader.filter=n.sceneFilter?[this.no,n.sceneFilter]:this.no,this.callRenderer(this.shader,e,n),this.do.filter=n.sceneFilter?[this.ro,n.sceneFilter]:this.ro,this.callRenderer(this.do,e,n)}callRenderer(e,n,i){i&&i.isRenderingTerrain&&ED(this.symbolDef.textPitchAlignment)&&(n.textPitchFilter=i.isRenderingTerrainSkin?1:2),super.callRenderer(e,n,i)}fo(){let e=this.scene.getMeshes();if(!e||!e.length)return;const n=-this.getMap().getBearing()*Math.PI/180,i=iv(fq,n),o=(e,n,i,o)=>{const{start:s,end:a,mesh:h,allElements:l}=n[0];if(this.updateBoxCollisionFading(!0,h,n,i,o)){let n=e.count;for(let i=s;i<a;i++)e[n++]=l[i];e.count=n}},s=this.isEnableCollision(),a=this.layer.getRenderer();e=e.sort(Fq);for(let n=0;n<e.length;n++){const h=e[n];if(!this.isMeshIterable(h))continue;if(!a.isTileNearCamera(h)){const{visElemts:e}=h.geometry.properties;e&&(e.count=0),h.geometry.setElements(e,0);continue}const l=h.geometry,c=this.getSymbol(h.properties.symbolIndex);h.properties.textHaloRadius=BU(c.textHaloRadius)?gW.textHaloRadius:c.textHaloRadius;const A=h.properties.meshKey;if("line"===l.properties.textPlacement){if(!l.properties.line)continue;s&&this.startMeshCollision(h),this.po(h,i);const{aOffset:e,aOpacity:n}=l.properties;e.dirty&&(l.updateData("aOffset",e),e.dirty=!1),n&&n.dirty&&(l.updateData("aOpacity",n),n.dirty=!1),s&&this.endMeshCollision(A)}else if(s){this.startMeshCollision(h);const{elements:e,aOpacity:n,visElemts:i}=l.properties;i.count=0,this.forEachBox(h,((e,n,s,a,h)=>{o(i,n,s,a)})),n&&n.dirty&&l.updateData("aOpacity",n);i.count===e.length&&l.count===e.length||!i.count&&!l.count||l.setElements(i,i.count),this.endMeshCollision(A)}}}isMeshIterable(e){return e.isValid()&&e.material&&!e.material.get("isHalo")&&!(this.shouldIgnoreBackground()&&!this.layer.getRenderer().isForeground(e))}isMeshUniquePlaced(e){return!!this.isMeshIterable(e)&&"line"!==this.getSymbol(e.properties.symbolIndex).textPlacement}getUniqueEntryKey(e,n){return TW(e,n)}po(e,n){const i=this.getMap(),o=e.geometry,s=o.properties;let a=s.line;if(!a)return;const h=i.getPitch(),l=i.getBearing(),{lineTextPitch:c,lineTextBearing:A}=e.properties,f=1===e.material.uniforms.pitchWithMap,d=s.elements;if(!f){const n=Cv(cq,i.projViewMatrix,e.localTransform),o=a.id+"-"+n.join();let h;this.co[o]?a=this.co[o]:(h=s.projectedLine=s.projectedLine||new Array(a.length),a=this.mo(h,a,n,i.width,i.height),this.co[o]=h)}const p=this.isEnableCollision(),g=o.properties.visElemts=o.properties.visElemts||new d.constructor(d.length),v=o.properties.visCache=o.properties.visCache||[];p&&(g.count=0);const w=void 0===c||!i.isInteracting()||Math.abs(h-c)>2||Math.abs(l-A)>2;w&&(this.Er=!0),this.forEachBox(e,((e,i,o,s)=>{const{start:h,end:l}=i[0];let c=v[s];if((void 0===c||w)&&(c=this.yo(e,d,h,l,a,o,f?n:null,s)),v[s]=c,p&&(c=this.updateBoxCollisionFading(c,e,i,o,s),c)){let e=g.count;for(let n=h;n<l;n++)g[e++]=d[n];g.count=e}})),w&&(e.properties.lineTextPitch=h,e.properties.lineTextBearing=l);const C=e.geometry.properties.aAltitude;C&&C.dirty&&(o.updateData("aAltitude",C),C.dirty=!1),!p||g.count===d.length&&o.count===g.count||o.setElements(g,g.count)}mo(e,n,i,o,s){const a=function(e,n,i,o,s){for(let a=0;a<n.length;a+=3)E_(HG,n[a],n[a+1],n[a+2],1),jG(HG,HG,i,o,s),e[a]=HG[0],e[a+1]=HG[1],e[a+2]=n[a+2];return e}(e,n,i,o,s);return a}forEachBox(e,n){const i=this.getMap(),o=Cv(cq,i.projViewMatrix,e.properties.tileVectorTransform),{collideIds:s,aCount:a,features:h,elements:l}=e.geometry.properties,c=s;if(!c)return;const A=this.isEnableUniquePlacement(),f=this.Cs(1);f[0].allElements=l,f[0].mesh=e;let d=0,p=l[0],g=0,v=c[p];for(let i=0;i<=l.length;i+=6)if(p=l[i],c[p]!==v||i===l.length){const s=h[v]&&h[v].feature;if(A&&this.isMeshUniquePlaced(e)&&s&&!s.label){const n=s.properties||{},{symbolIndex:i}=e.properties,o=PH(i&&this.lo[i.index]?this.lo[i.index](e.properties.z,n):this.getSymbol(e.properties.symbolIndex).textName,n);s.label=o}const w=i,C=a[l[g]];for(let i=g;i<w;i+=6*C)f[0].start=i,f[0].end=i+6*C,f[0].boxCount=C,n.call(this,e,f,o,d++);v=c[p],g=i}}yo(e,n,i,o,s,a,h){const l=this.layer.getRenderer(),c=e.material.uniforms,A=1===c.pitchWithMap,f=!A&&l.getTerrainHelper&&l.getTerrainHelper(),d=this.isEnableCollision(),p=this.getMap(),g=e.geometry,v=g.desc.positionSize,{aShape:w,aOffset:C,aAnchor:P,aAltitude:T,aPitchRotation:S}=g.properties;let{aProjectedAnchor:I}=g.properties;I||(I=g.properties.aProjectedAnchor=new Array(P.length/v*3));const E=g.properties.aTextSize,O=!h,k=n[i],L=k*v;let F;F=g.data.aAltitude?$v(dq,P[L],P[L+1],T[k]):QF(dq,P[L],P[L+1],P[L+2]);const N=jG(pq,F,a,p.width,p.height),z=g.properties.aTerrainAltitude;let H;if(z){const e=z[k];if(e===TU)return I[3*k]=MU,I[3*k+1]=MU,I[3*k+2]=MU,!1;e?(H=$v(Rq,...F),H[2]=100*e,H=jG(H,H,a,p.width,p.height)):H=N}else H=N;const j=p.getDevicePixelRatio();if(L_(kq,H,1/j),p.isOffscreen(kq))return d||Lq(C,n,i,o),I[3*k]=MU,I[3*k+1]=MU,I[3*k+2]=MU,!1;O&&(F=N),I[3*k]=H[0],I[3*k+1]=H[1],I[3*k+2]=H[2];const W=O?1:g.properties.tileExtent/this.layer.getTileSize().width;let q=!0;const Y=n[i],J=n[o-1],$=E?E[Y]:e.properties.textSize,it=this.vo(e,$,s,Y,J,F,dq,W,h);if(null===it)return Lq(C,n,i,o),!1;const rt=J-Y<=3,ot=Math.floor(it/2),st=it%2;for(let h=i;h<o;h+=6){const l=n[h];let p;if(p=ot||h!==i||rt||f?ot||h!==o-6||rt||f?eq.call(this,Aq,e,$,s,l,F,dq,W,ot,H,this.layer,a,A):Tq:Mq,!p){q=!1,d||Lq(C,n,i,o);break}let g=p[2];st&&(g-=Math.PI/2);const v=WV(gq,g,0,c.rotateWithMap,c.pitchWithMap),P=C.length>w.length;let T;if(P){$v(Cq,S[3*l],S[3*l+1],0);const e=l_(Cq,Cq),n=-S[3*l+2];if(n){const i=ix(xq,e,n);Ov(bq,uq),Bv(wq,i),T=Cv(wq,wq,bq)}}for(let e=0;e<4;e++){const n=2*(l+e);Zx(mq,w[n]/10,w[n+1]/10),Kx(mq,mq,$/24),rb(mq,mq,v),A?(Yx(mq,mq,vq),Qx(yq,mq,p),P&&(yq[2]=0,T&&A_(yq,yq,T))):(Yx(yq,p,vq),Qx(yq,mq,yq)),_q[0]=10*yq[0],_q[1]=10*yq[1],P&&(_q[2]=10*yq[2]);const i=(P?3:2)*(l+e);(C[i]!==_q[0]||C[i+1]!==_q[1]||P&&C[i+2]!==_q[2])&&(C.dirty=!0,C[i]=_q[0],C[i+1]=_q[1],P&&(C[i+2]=_q[2]))}}return q}vo(e,n,i,o,s,a,h,l,c){const A=s-o<=3,f=this.getMap();return A?0:rq.call(this,Mq,Tq,e,n,i,o,s,a,h,l,f.width/f.height,c)}isBoxCollides(e,n,i,o,s,a){return this.isLabelCollides(0,e,n,i,o,s,a)}deleteMesh(e,n){e&&(n&&(Array.isArray(e)?e.forEach((e=>{e&&e.material&&delete e.material.uniforms.texture})):e.material&&delete e.material.uniforms.texture),super.deleteMesh(e,n))}delete(){super.delete(),this.do.dispose(),delete this.co,this.xo&&this.xo.dispose()}isUniqueStencilRefPerTile(){return!1}isEnableTileStencil(){return!this.layer.getRenderer().isEnableWorkAround("win-intel-gpu-crash")}init(){this.renderer=new PC(this.regl);const{uniforms:e,extraCommandProps:n}=_W.call(this,this.canvas,this.sceneConfig),i=this.canvas,o={x:(e,n)=>n.viewport?n.viewport.x:0,y:(e,n)=>n.viewport?n.viewport.y:0,width:(e,n)=>n.viewport?n.viewport.width:i?i.width:1,height:(e,n)=>n.viewport?n.viewport.height:i?i.height:1};n.viewport=o,this.shader=new eP({vert:EW,frag:OW,uniforms:e,extraCommandProps:n});let s=n;if(this.layer.getRenderer().isEnableWorkAround("win-intel-gpu-crash")&&(s=FU({},n),s.stencil=FU({},n.stencil),s.stencil.enable=!0,s.stencil.func.cmp="<",s.stencil.func.ref=(e,n)=>2*n.level+(n.isHalo||0)+1),this.do=new eP({vert:oq,frag:OW,uniforms:e,extraCommandProps:s}),this.pickingFBO){const n=new XM(this.renderer,{vert:"#define PICKING_MODE 1\n"+EW,uniforms:e,extraCommandProps:{viewport:this.pickingViewport}},this.pickingFBO,this.getMap());n.filter=e=>"line"!==this.getSymbol(e.properties.symbolIndex).textPlacement;const i=new XM(this.renderer,{vert:"#define PICKING_MODE 1\n"+oq,uniforms:e,extraCommandProps:{viewport:this.pickingViewport}},this.pickingFBO,this.getMap());i.filter=e=>"line"===e.geometry.properties.textPlacement,this.picking=[n,i]}}getUniformValues(e,n){const i=n&&n.isRenderingTerrainSkin,o=this.layer.getTileSize().width,s=i?Dq:e.projViewMatrix,a=e.cameraToCenterDistance,h=Zx(Pq,e.width,e.height);i&&Zx(h,o,o);const l=fU(e.getResolution(),e);return{layerScale:this.layer.options.styleScale||1,mapPitch:e.getPitch()*Math.PI/180,mapRotation:e.getBearing()*Math.PI/180,projViewMatrix:s,viewMatrix:e.viewMatrix,cameraToCenterDistance:a,canvasSize:h,glyphSize:ZV,gammaScale:1*(this.layer.options.textGamma||1),resolution:e.getResolution(),altitudeScale:l,viewport:i&&n&&n.viewport,textPitchFilter:0,isRenderingTerrain:+!!i}}}function Lq(e,n,i,o){for(let s=i;s<o;s+=6){const i=n[s];for(let n=0;n<4;n++){const o=3*(i+n);(e[o]||e[o+1]||e[o+2])&&(e.dirty=!0,e[o]=0,e[o+1]=0,e[o+2]=0)}}}function Fq(e,n){const i=e.properties.level-n.properties.level;return 0===i?e.properties.meshKey-n.properties.meshKey:i}var Nq="#define SHADER_NAME NATIVE_POINT\n#include <gl2_vert>\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\n#ifdef HAS_COLOR\nattribute vec4 aColor;\nvarying vec4 vColor;\n#endif\nuniform mat4 positionMatrix;\nuniform mat4 projViewModelMatrix;\nuniform float markerSize;\n#ifdef PICKING_MODE\n#include <fbo_picking_vert>\n#endif\n#include <vt_position_vert>\nvoid main() {\n  vec3 c = unpackVTPosition();\n  gl_Position = projViewModelMatrix * positionMatrix * vec4(c, 1.);\n  gl_PointSize = markerSize;\n#ifdef HAS_COLOR\nvColor = aColor / 255.;\n#endif\n#ifdef PICKING_MODE\nfbo_picking_setData(gl_Position.w, true);\n#endif\n}";const zq={markerFill:[0,0,0],markerOpacity:1,markerSize:10};class uc extends Sl{getPrimitive(){return"points"}isTerrainSkin(){return!1}isTerrainVector(){return this.layer.options.awareOfTerrain}isUniqueStencilRefPerTile(){return!1}createMesh(e,n){const{geometry:i,symbolIndex:o,ref:s}=e,a=this.getSymbol(o);void 0===s&&(SG(i,this.getSymbolDef(o),this.getFnTypeConfig(o),this.layer),i.generateBuffers(this.regl));const h={};jU(h,"markerOpacity",a,"markerOpacity",1),jU(h,"markerSize",a,"markerSize",10),jU(h,"markerFill",a,"markerFill","#000",VU(this.colorCache,3));const l=new cC(h,zq);l.createDefines=()=>"square"!==a.markerType?{USE_CIRCLE:1}:null,l.appendDefines=e=>("square"!==a.markerType&&(e.USE_CIRCLE=1),e);const c=new bC(i,l,{castShadow:!1,picking:!0}),A={};return c.geometry.data.aAltitude&&(A.HAS_ALTITUDE=1),i.data.aColor&&(A.HAS_COLOR=1),c.setDefines(A),c.positionMatrix=this.getAltitudeOffsetMatrix(),c.setLocalTransform(n),c.properties.symbolIndex=o,c}createFnTypeConfig(e,n){const i=DD(n.markerFill);return[{attrName:"aColor",symbolName:"markerFill",type:Uint8Array,width:4,define:"HAS_COLOR",evaluate:(n,o)=>{let s=i(e.getZoom(),n);return ED(s)&&(s=this.evaluateInFnTypeConfig(s,o,e,n,!0)),Array.isArray(s)||(s=this.colorCache[s]=this.colorCache[s]||Ck(s).unitArray()),s=GU(s),s}}]}init(){this.renderer=new PC(this.regl);const e=[],n={vert:Nq,frag:"#define SHADER_NAME NATIVE_POINT\nprecision mediump float;\n#include <gl2_frag>\n#ifdef USE_CIRCLE\n#if __VERSION__ == 100\n#ifdef GL_OES_standard_derivatives\n#define STANDARD_DERIVATIVES_ENABLED 1\n#extension GL_OES_standard_derivatives : enable\n#endif\n#else\n#define STANDARD_DERIVATIVES_ENABLED 1\n#endif\n#endif\n#ifdef HAS_COLOR\nvarying vec4 vColor;\n#else\nuniform vec3 markerFill;\n#endif\nuniform float markerOpacity;\nuniform float layerOpacity;\nvoid main() {\n  float c = 1.;\n#ifdef USE_CIRCLE\nfloat r = .0, d = .0;\n  vec2 e = 2. * gl_PointCoord - 1.;\n  r = dot(e, e);\n  if(r > 1.) {\n    discard;\n  }\n#ifdef STANDARD_DERIVATIVES_ENABLED\nd = fwidth(r);\n  c = 1. - smoothstep(1. - d, 1. + d, r);\n#endif\n#endif\n#ifdef HAS_COLOR\nvec4 f = vColor;\n#else\nvec4 f = vec4(markerFill, 1.);\n#endif\nglFragColor = f * markerOpacity * c * layerOpacity;\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(n,i){return Cv(e,i.projViewMatrix,i.modelMatrix),e}}],defines:null,extraCommandProps:{viewport:{x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1},depth:{enable:!0,mask:!1,range:this.sceneConfig.depthRange||[0,1],func:this.sceneConfig.depthFunc||"always"},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"}}};if(this.shader=new eP(n),this.shader.version=300,this.pickingFBO){const e=[];this.picking=[new XM(this.renderer,{vert:"#define PICKING_MODE 1\n"+Nq,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(n,i){return Cv(e,i.projViewMatrix,i.modelMatrix),e}}],extraCommandProps:{viewport:this.pickingViewport}},this.pickingFBO,this.getMap())]}}getUniformValues(e){return{projViewMatrix:e.projViewMatrix}}}var Bq="#define SHADER_NAME NATIVE_LINE\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\nuniform mat4 projViewModelMatrix;\n#ifndef PICKING_MODE\n#if defined(HAS_COLOR)\nattribute vec4 aColor;\nvarying vec4 vColor;\n#endif\n#else\n#include <fbo_picking_vert>\n#endif\n#include <vt_position_vert>\nvoid main() {\n  vec3 c = unpackVTPosition();\n  gl_Position = projViewModelMatrix * vec4(c, 1.);\n#ifndef PICKING_MODE\n#if defined(HAS_COLOR)\nvColor = aColor / 255.;\n#endif\n#else\nfbo_picking_setData(gl_Position.w, true);\n#endif\n}";const Hq=xv([]);class dc extends Sl{constructor(e,n,i,o,s,a){if(super(e,n,i,o,s,a),this.primitive="lines",ED(this.symbolDef.lineColor)){const e=n.getMap(),i=DD(this.symbolDef.lineColor);this.colorSymbol=n=>i(e.getZoom(),n)}}needPolygonOffset(){return!0}createMesh(e,n){const{geometry:i,symbolIndex:o,ref:s}=e,a=this.getSymbol(o),h=this.getMeshUniforms(i,a);void 0===s&&i.generateBuffers(this.regl);const l=new cC(h),c=new bC(i,l,{castShadow:!1,picking:!0});c.setLocalTransform(n),c.properties.symbolIndex=o;const A={};return c.geometry.data.aAltitude&&(A.HAS_ALTITUDE=1),c.setDefines(A),c}getMeshUniforms(e,n){const i={};return jU(i,"lineColor",n,"lineColor","#000",VU(this.colorCache)),jU(i,"lineOpacity",n,"lineOpacity",1),i}isEnableTileStencil(e){return!(e&&e.isRenderingTerrain&&this.isTerrainSkin())}init(e){this.renderer=new PC(this.regl);const n=this.canvas,i={x:(e,n)=>n.viewport?n.viewport.x:0,y:(e,n)=>n.viewport?n.viewport.y:0,width:(e,i)=>i.viewport?i.viewport.width:n?n.width:1,height:(e,i)=>i.viewport?i.viewport.height:n?n.height:1},o=[{name:"projViewModelMatrix",type:"function",fn:function(e,n){const i=[];return Cv(i,n.projViewMatrix,n.modelMatrix),i}}],s={vert:Bq,frag:"#define SHADER_NAME NATIVE_LINE\nprecision mediump float;\nuniform float lineOpacity;\nuniform vec4 lineColor;\nuniform float layerOpacity;\n#if defined(HAS_COLOR)\nvarying vec4 vColor;\n#endif\nvoid main() {\n  gl_FragColor = lineColor * lineOpacity;\n#if defined(HAS_COLOR)\ngl_FragColor *= vColor;\n#endif\ngl_FragColor *= layerOpacity;\n}",uniforms:o,defines:null,extraCommandProps:{viewport:i,stencil:{enable:()=>this.isEnableTileStencil(e),mask:255,func:{cmp:()=>this.isOnly2D()?"=":"<=",ref:(e,n)=>n.stencilRef,mask:255},op:{fail:"keep",zfail:"keep",zpass:"replace"}},depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],func:this.sceneConfig.depthFunc||"<="},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}}};this.shader=new eP(s),this.pickingFBO&&(this.picking=[new XM(this.renderer,{vert:"#define PICKING_MODE 1\n"+Bq,uniforms:o,extraCommandProps:{viewport:this.pickingViewport}},this.pickingFBO,this.getMap())])}getUniformValues(e,n){const i=n&&n.isRenderingTerrainSkin;return{projViewMatrix:i?Hq:e.projViewMatrix,viewport:i&&n&&n.viewport}}getPrimitive(){return"lines"}}const jq=[1,1,1],Uq=[1,1,1,1],Gq=[0,0],Vq=[1,1],Wq=[],qq=new Zh(0,0),Zq=new Zh(0,0),Qq=[],Xq=[];class Mc extends Al{isEnableTileStencil(){return!1}supportRenderMode(e){return this.isAnimating()?"fxaa"===e||"fxaaAfterTaa"===e:"taa"===e||"fxaa"===e}isTerrainSkin(){return!1}isTerrainVector(){return this.layer.options.awareOfTerrain}isAnimating(){return!1}createMesh(e,n,{tilePoint:i}){if(!this.material)return this.setToRedraw(),null;const{geometry:o,symbolIndex:s}=e,a=this.layer instanceof Qp,h=new bC(o,this.material);if(this.sceneConfig.animation){jq[2]=.01;const e=[];Rv(e,jq),Cv(e,n,e),n=e}const l=this.getSymbolDef(s),c=this.getFnTypeConfig(s);SG(o,l,c,this.layer);const A=this.getShader(),f=A.getGeometryDefines?A.getGeometryDefines(o):{},d=this.getSymbol(s),p=VU(this.colorCache);if(o.data.aExtrude){f.IS_LINE_EXTRUSION=1;const{tileResolution:e,tileRatio:n}=o.properties,i=this.getMap();Object.defineProperty(h.uniforms,"linePixelScale",{enumerable:!0,get:function(){return n*i.getResolution()/e}}),jU(h.uniforms,"lineWidth",d,"lineWidth",4),jU(h.uniforms,"lineOpacity",d,"lineOpacity",1),jU(h.uniforms,"lineColor",d,"lineColor","#fff",p),Object.defineProperty(h.uniforms,"lineHeight",{enumerable:!0,get:()=>{const e=this.dataConfig.defaultAltitude*(this.dataConfig.altitudeScale||1);return ZU(e)?e:0}})}else{jU(h.uniforms,"polygonFill",d,"polygonFill",Uq,p),jU(h.uniforms,"polygonOpacity",d,"polygonOpacity",1);const e=[];Object.defineProperty(h.uniforms,"vertexColorsOfType",{enumerable:!0,get:()=>{const n=p(d.bottomPolygonFill||Uq),i=p(d.topPolygonFill||Uq);e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=i[0],e[5]=i[1],e[6]=i[2],e[7]=i[3];const o=h.geometry.properties.vertexColors;if(o){let n=8;e.length=8+o.length;for(let i=0;i<o.length;i++)e[n++]=o[i][0],e[n++]=o[i][1],e[n++]=o[i][2],e[n++]=o[i][3]}return e}})}if(o.data.aColor&&(f.HAS_COLOR=1),o.data.aOpacity&&(f.HAS_OPACITY=1),o.data.aLineWidth&&(f.HAS_LINE_WIDTH=1),o.data.aLineHeight&&(f.HAS_LINE_HEIGHT=1),o.data.aTerrainAltitude&&(f.HAS_TERRAIN_ALTITUDE=1),o.data.aVertexColorType){const e=h.geometry.properties.vertexColors;let n=2;e&&(n+=e.length),f.VERTEX_TYPES_COUNT=n}if(o.data.aOpacity){const e=o.data.aOpacity;for(let n=0;n<e.length;n++)if(e[n]<255){o.properties.hasAlpha=!0;break}}f.HAS_MIN_ALTITUDE=1,f.HAS_LAYER_OPACITY=1,o.generateBuffers(this.regl),h.setDefines(f),h.setPositionMatrix(this.getAltitudeOffsetMatrix()),h.setLocalTransform(n),(o.properties.maxAltitude<=0||h.properties.level>=3)&&(h.castShadow=!1),h.setUniform("maxAltitude",h.geometry.properties.maxAltitude),Object.defineProperty(h.uniforms,"minAltitude",{enumerable:!0,get:()=>this.layer.options.altitude||0});const{tileResolution:g}=o.properties,v=this.getMap(),w=this.layer.getRenderer(),C=v.pointAtResToCoord(new ee(i),g),P=function(e,n,i,o,s){return e.pointAtResToDistance(1,0,o,i)}(v,0,C,g),T=[];Object.defineProperty(h.uniforms,"uvOrigin",{enumerable:!0,get:()=>this.bo(T,s,i,g,P,a)}),h.setUniform("uvOffset",[0,0]),Object.defineProperty(h.uniforms,"hasAlpha",{enumerable:!0,get:()=>{const e=this.getSymbol(s);return o.properties.hasAlpha||e.polygonOpacity<1||e.lineOpacity<1||h.material&&(h.material.uniforms.baseColorTexture||h.material.uniforms.emissiveTexture)}});const S=this.layer.getMap().getMaxNativeZoom();return Object.defineProperty(h.uniforms,"stencilRef",{enumerable:!0,get:()=>w.isForeground(h)?0:S-h.properties.tile.z}),h.properties.symbolIndex=s,h}bo(e,n,i,o,s,a){if(1===this.dataConfig.topUVMode)return e[0]=0,e[1]=0,e;const h=this.getMap(),l=this.getSymbol(n).material;let c=i;!this.dataConfig.side&&l&&l.textureOrigin&&(qq.set(l.textureOrigin[0],l.textureOrigin[1]),h.coordToPointAtRes(qq,o,Zq),c=Zx(Qq,i[0]-Zq.x,i[1]-Zq.y));const A=!!l&&l.uvOffsetInMeter;let f=l&&l.uvOffset||Gq;const d=this.getUVOffsetAnim();d&&(f=this.getUVOffset(d));const p=l&&l.uvScale||Vq;let g=this.dataConfig.side?0:c[0],v=this.dataConfig.side?0:c[1];const w=l&&l.textureWidth||23.25;A&&(g+=f[0]/s,v+=f[1]/s);const C=Zx(e,g*s*p[0]/w+(A?0:f[0]),v*s*p[1]/(w*p[1]/p[0])+(A?0:f[1]));return a||(C[1]*=-1),C}callShader(e,n){const i=this.sceneConfig.cullFace;this.sceneConfig.cullFace="front",this.callBackgroundTileShader(e,n),void 0===i?delete this.sceneConfig.cullFace:this.sceneConfig.cullFace=i,super.callShader(e,n)}getShadowMeshes(){if(!this.isVisible())return Wq;this.shadowCount=this.scene.getMeshes().length;const e=this.scene.getMeshes().filter((e=>0===e.properties.level));for(let n=0;n<e.length;n++){const i=e[n];i.material!==this.material&&i.setMaterial(this.material)}return e}getUVOffsetAnim(){const e=this.getSymbols()[0];return e.material&&e.material.uvOffsetAnim}getUVOffset(e){const n=this.getSymbols()[0],i=n.material&&n.material.uvOffset||Gq,o=!!n.material&&n.material.uvOffsetInMeter,s=performance.now()/1e3,a=Zx(Xq,i[0],i[1]);return a[0]=s*e[0],a[1]=s*e[0],o||(a[0]%=1,a[1]%=1),a}needPolygonOffset(){return this.wo}startFrame(...e){return delete this.wo,super.startFrame(...e)}addMesh(e,n){e.forEach((e=>{this.Pr(e,n)})),super.addMesh(...arguments)}Pr(e,n){if(null!==n){const i=e.localTransform;0===n&&(n=.01),jq[2]=n,Rv(i,jq),Cv(i,e.properties.tileTransform,i),e.setLocalTransform(i)}else e.setLocalTransform(e.properties.tileTransform);e.material!==this.material&&e.setMaterial(this.material),e.geometry.properties.maxAltitude<=0&&(this.wo=!0),e.ssr=this.getSymbol(e.properties.symbolIndex).ssr?1:0}deleteMaterial(){this.material&&(this.material.dispose(),delete this.material)}deleteMesh(e,n){if(e)if(this.scene.removeMesh(e),Array.isArray(e))for(let i=0;i<e.length;i++)n||(e[i].geometry.dispose(),delete e[i].geometry.properties.layer),e[i].dispose();else n||(e.geometry.dispose(),delete e.geometry.properties.layer),e.dispose()}updateDataConfig(e,n){return!("line-extrusion"===this.dataConfig.type&&!e.altitudeProperty&&!n.altitudeProperty)}createFnTypeConfig(e,n){const i=DD(n.polygonFill||n.lineColor),o=RD(n.polygonOpacity||n.lineOpacity),s=RD(n.lineWidth),a=new Uint8Array(1),h=new Uint16Array(1);return[{attrName:"aColor",type:Uint8Array,width:4,symbolName:n.polygonFill?"polygonFill":n.lineColor?"lineColor":"polygonFill",define:"HAS_COLOR",evaluate:(n,o)=>{let s=i(e.getZoom(),n);return ED(s)&&(s=this.evaluateInFnTypeConfig(s,o,e,n,!0)),Array.isArray(s)||(s=this.colorCache[s]=this.colorCache[s]||Ck(s).unitArray()),s=GU(s),s}},{attrName:"aOpacity",type:Uint8Array,width:1,symbolName:n.polygonOpacity?"polygonOpacity":n.lineOpacity?"lineOpacity":"polygonOpacity",evaluate:(n,i)=>{let s=o(e.getZoom(),n);return ED(s)&&(s=this.evaluateInFnTypeConfig(s,i,e,n,!1)),a[0]=255*s,a[0]<255&&(i.properties.hasAlpha=!0),a[0]}},{attrName:"aLineWidth",type:Uint8Array,width:1,symbolName:"lineWidth",define:"HAS_LINE_WIDTH",evaluate:n=>{const i=s(e.getZoom(),n);return h[0]=Math.round(2*i),h[0]}}]}updateSymbol(e,n){let i=!1;e&&e.material&&(i=function(e,n){for(const i in n)if(Jq[i]&&n[i]!==e[i]&&(!e[i]||!n[i]))return!0;return!1}(this.symbolDef[0].material||{},e.material));const o=super.updateSymbol(e,n);return e&&e.material&&this.Ao(e.material),i||o}ir(e,n){return Yq(e)!==Yq(n)}}function Yq(e){if(!e||!e.material)return!1;for(const n in e.material)if(n.indexOf("Texture")>0&&e.material[n])return!0;return!1}const Jq={normalTexture:1,bumpTexture:1};class kc extends Mc{createGeometry(e){const n=e.data,i=this.getSymbols()[0];if(i.material&&i.material.extrusionOpacity){const e=new Uint8Array(n.aPosition.length/3);for(let i=0;i<n.aPosition.length;i+=3)e[i/3]=n.aPosition[i+2]>0?0:1;n.aExtrusionOpacity=e}const o=new Lw(n,e.indices);return FU(o.properties,e.properties),this.mr(o,e),{geometry:o,symbolIndex:{index:0}}}updateSceneConfig(e){let n;if(this.sceneConfig.cullFace!==e.cullFace&&(n=!0),FU(this.sceneConfig,e),n){const e=this.getShaderConfig();this.shader.dispose(),this.shader=new nP(e)}this.setToRedraw()}getShader(){return this.shader}delete(e){this.getMap().off("updatelights",this.Mo,this),super.delete(e),this.material.dispose()}init(){this.getMap().on("updatelights",this.Mo,this);this.renderer=new PC(this.regl);const e=this.getShaderConfig();this.shader=new nP(e),this.Ao();const n={vert:this.getPickingVert(),uniforms:["projViewMatrix","modelMatrix","positionMatrix",{name:"projViewModelMatrix",type:"function",fn:function(e,n){return Cv([],n.projViewMatrix,n.modelMatrix)}}],extraCommandProps:{viewport:this.pickingViewport}};this.picking=[new XM(this.renderer,n,this.layer.getRenderer().pickingFBO,this.getMap())]}Mo(){this.setToRedraw()}getShaderConfig(){const e=this.canvas,n={x:0,y:0,width:()=>e?e.width:1,height:()=>e?e.height:1};return{extraCommandProps:{cull:{enable:()=>void 0===this.sceneConfig.cullFace||!!this.sceneConfig.cullFace,face:()=>{let e=this.sceneConfig.cullFace;return!0===e&&(e="back"),e||"back"}},stencil:{enable:!0,func:{cmp:"<=",ref:(e,n)=>n.level},op:{fail:"keep",zfail:"keep",zpass:"replace"}},depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],func:this.sceneConfig.depthFunc||"<="},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"},viewport:n,polygonOffset:{enable:!0,offset:this.getPolygonOffset()}}}}Ao(){this.material&&this.material.dispose();const e=this.layer instanceof Qp,n=this.getSymbols()[0].material,i={};for(const o in n)XU(n,o)&&(i[o]=n[o],"uvRotation"===o&&(i[o]=i[o]*Math.PI/180,e||(i[o]*=-1)));this.material=new dC(i)}getUniformValues(e,n){const i=e.viewMatrix,o=e.projMatrix,s=e.cameraPosition,a=this._o(),h=FU({viewMatrix:i,projMatrix:o,cameraPosition:s,projViewMatrix:e.projViewMatrix},a);h.halton=n&&n.jitter?n.jitter:[0,0];const l=this.layer.getRenderer().canvas;return h.outSize=[l.width,l.height],h}getPickingVert(){return"\n            attribute vec3 aPosition;\n            uniform mat4 projViewModelMatrix;\n            uniform mat4 modelMatrix;\n            uniform mat4 positionMatrix;\n            //fbo pickingvert\n            #include <fbo_picking_vert>\n            #include <get_output>\n            void main()\n            {\n                mat4 localPositionMatrix = getPositionMatrix();\n                vec4 localPosition = getPosition(aPosition);\n\n                gl_Position = projViewModelMatrix * localPositionMatrix * localPosition;\n                //gl_Positiondepth\n                fbo_picking_setData(gl_Position.w, true);\n            }\n        "}_o(){const e=this.getMap().getLightManager(),n=e&&e.getAmbientLight()||{},i=e&&e.getDirectionalLight()||{};return{ambientColor:n.color||[.2,.2,.2],light0_diffuse:[...i.color||[.1,.1,.1],1],lightSpecular:i.specular||[.8,.8,.8],light0_viewDirection:i.direction||[1,1,-1]}}}const Kq=[1,1,1];class Tc extends Al{createGeometry(e){const{data:n,indices:i}=e,o=new Lw(n,i,0,{primitive:"lines"});return o.generateBuffers(this.regl),{geometry:o,symbolIndex:{index:0}}}createMesh(e,n){const{geometry:i}=e,o=new bC(i);if(o.castShadow=!1,this.sceneConfig.animation){Kq[2]=.01;const e=[];Rv(e,Kq),Cv(e,n,e),n=e}return o.setLocalTransform(n),o.properties.symbolIndex={index:0},o}addMesh(e,n){if(!e.length)return this;let i;null!==n?(0===n&&(n=.01),i=e[0].localTransform,Kq[2]=n,Rv(i,Kq),Cv(i,e[0].properties.tileTransform,i)):i=e[0].properties.tileTransform;for(let n=0;n<e.length;n++)e[n].setLocalTransform(i);return this.scene.addMesh(e),this}init(){const e=this.regl;this.scene=new kC,this.renderer=new PC(e);const n={x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1},i={vert:"\n    attribute vec3 aPosition;\n    attribute vec4 aColor;\n\n    uniform mat4 projViewModelMatrix;\n    uniform vec2 outSize;\n\n    varying vec4 vColor;\n\n    void main()\n    {\n        gl_Position = projViewModelMatrix * vec4(aPosition, 1.0);\n        vColor = aColor / 255.0;\n    }\n",frag:"\n    #ifdef GL_ES\n        precision lowp float;\n    #endif\n\n    uniform float opacity;\n\n    varying vec4 vColor;\n\n    void main()\n    {\n        gl_FragColor = vColor * opacity;\n    }\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(e,n){const i=[];return Cv(i,n.projViewMatrix,n.modelMatrix),i}}],extraCommandProps:{stencil:{enable:!0,func:{cmp:"<=",ref:(e,n)=>n.level},op:{fail:"keep",zfail:"keep",zpass:"replace"}},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"},viewport:n}};this.shader=new eP(i)}getUniformValues(e){const n=this.sceneConfig.opacity||.3,i=this.layer.getRenderer().canvas;return{projViewMatrix:e.projViewMatrix,outSize:[i.width,i.height],opacity:n}}}const{getPBRUniforms:$q}=DT.PBRUtils;class Fc extends Mc{constructor(...e){super(...e),this.So=new SC(null,this.layer.getURLModifier()),this.scene.sortFunction=this.sortByCommandKey}supportRenderMode(e){return this.getSymbols()[0].ssr?"fxaa"===e||"fxaaAfterTaa"===e:super.supportRenderMode(e)}isAnimating(){const e=this.ko();if(e&&(e[0]||e[1]))return!0}needToRedraw(){const e=this.ko();return!(!e||!e[0]&&!e[1])||super.needToRedraw()}ko(){const e=this.getSymbols()[0];return e.material&&e.material.uvOffsetAnim}createGeometry(e){if(!e.data||!e.data.aPosition||!e.data.aPosition.length)return null;const n={uv0Attribute:"aTexCoord0"};e.data.aAltitude&&(n.altitudeAttribute="aAltitude");const i=new Lw(e.data,e.indices,0,n);return FU(i.properties,e.properties),e.vertexColors&&(i.properties.vertexColors=e.vertexColors),this.material.uniforms.normalTexture&&!i.data[i.desc.tangentAttribute]&&i.data[i.desc.uv0Attribute]&&(i.data[i.desc.normalAttribute]||i.createNormal(),i.createTangent()),this.mr(i,e),{geometry:i,symbolIndex:{index:0}}}paint(e){const n=!!e.shadow;e.states&&e.states.includesChanged&&(this.shader.dispose(),delete this.shader,this.Po.dispose(),delete this.Po,this._r(e));let i=!!e.ssr&&this.getSymbols()[0].ssr;const o=this.shader,s=o.shaderDefines;if(i){const n=FU({},s,e.ssr.defines);o.shaderDefines=n}if(e.onlyUpdateDepthInTaa&&(this.shader=this.Po,!i&&this.To&&(this.shader=o,this.setToRedraw(!0))),this.updateIBLDefines(o),super.paint(e),void 0!==this.shadowCount&&n){const e=this.scene.getMeshes().length;this.shadowCount!==e&&this.setToRedraw()}this.shader=o,i&&(o.shaderDefines=s),delete this.shadowCount,this.To=i}updateSceneConfig(e){FU(this.sceneConfig,e),this.setToRedraw()}delete(){super.delete(),this.disposeIBLTextures(),this.material.dispose(),this.Po&&(this.Po.dispose(),delete this.Po)}init(e){this.getMap().on("updatelights",this.Io,this),this.createIBLTextures(),this.Tr=this.Tr||e;this.renderer=new PC(this.regl),this.Fo=this.Co.bind(this),this.Oo=this.disposeCachedTexture.bind(this),this.Eo=this.Do.bind(this),this.Ao(),this._r(e);const n={vert:"\n                #include <gl2_vert>\n                attribute vec3 aPosition;\n                uniform mat4 projViewModelMatrix;\n                uniform mat4 positionMatrix;\n                //fbo pickingvert\n                #include <line_extrusion_vert>\n                #include <get_output>\n                #include <fbo_picking_vert>\n                void main() {\n                    mat4 localPositionMatrix = getPositionMatrix();\n                    #ifdef IS_LINE_EXTRUSION\n                        vec3 linePosition = getLineExtrudePosition(aPosition);\n                        vec4 localVertex = getPosition(linePosition);\n                    #else\n                        vec4 localVertex = getPosition(aPosition);\n                    #endif\n\n                    gl_Position = projViewModelMatrix * localPositionMatrix * localVertex;\n                    fbo_picking_setData(gl_Position.w, true);\n                }\n            ",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(e,n)=>Cv([],n.projViewMatrix,n.modelMatrix)}],extraCommandProps:{viewport:this.pickingViewport,depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],func:this.sceneConfig.depthFunc||"<=",mask:!!BU(this.sceneConfig.depthMask)||this.sceneConfig.depthMask}}};this.picking=[new XM(this.renderer,n,this.layer.getRenderer().pickingFBO,this.getMap())]}_r(e){const n={x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1},i={},o=[];o.push(...gP.getUniformDeclares()),this.fillIncludes(i,o,e);const s={cull:{enable:(e,n)=>!(n.geometryProperties.hasNegativeHeight||void 0!==this.sceneConfig.cullFace&&!this.sceneConfig.cullFace),face:()=>this.sceneConfig.cullFace||"back"},stencil:{enable:!1},viewport:n,depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],func:this.sceneConfig.depthFunc||"<="},blend:{enable:(e,n)=>void 0===n.hasAlpha||!!n.hasAlpha,func:this.getBlendFunc(),equation:"add"},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}},a={uniforms:o,defines:this.Lo(i),extraCommandProps:s};this.shader=new DT.StandardShader(a),a.frag="\n            precision mediump float;\n            #include <gl2_frag>\n            void main() {\n                glFragColor = vec4(0.0);\n                #if __VERSION__ == 100\n                    gl_FragColor = glFragColor;\n                #endif\n            }\n        ",this.Po=new DT.StandardShader(a)}Co({resources:e}){for(let n=0;n<e.length;n++)this.addCachedTexture(e[n].url,e[n].data);this.setToRedraw(!0)}Do(){this.setToRedraw(!0)}Ao(e){if(e){const n=this.getSymbols()[0].material;n&&FU(n,e)}const n=this.layer instanceof Qp,i=this.dataConfig,o=e||this.getSymbols()[0].material,s={};let a=!1;for(const e in o)if(XU(o,e))if(e.indexOf("Texture")>0){let n=o[e];if(!n){s[e]=void 0;continue}const h="string"==typeof n?n:n.url,l=this.getCachedTexture(h);l?l.then?h===n?n={promise:l,wrap:"repeat"}:n.promise=l:h===n?n={data:l,wrap:"repeat"}:n.data=l:h===n&&(n={url:h,wrap:"repeat"}),n.flipY=!i.upsideUpTexture,n.min="linear mipmap linear",n.mag="linear",s[e]=new VC(n,this.So),s[e].once("complete",this.Fo),s[e].once("disposed",this.Oo),s[e].promise&&this.addCachedTexture(h,s[e].promise),a=!0}else s[e]=o[e],"uvRotation"===e&&(s[e]=Math.PI*s[e]/180,n||(s[e]*=-1));if(void 0===s.alphaTest&&this.getMaterialClazz&&(s.alphaTest=.05),this.material){for(let e in s)this.material.set(e,s[e]);this.setToRedraw(!0)}else this.material=new DT.StandardMaterial(s),this.material.once("complete",this.Eo);a||this.Do()}getShader(){return this.shader}getUniformValues(e,n){const{iblTexes:i,dfgLUT:o}=this.getIBLRes(),s=$q(e,i,o,n&&n.ssr,n&&n.jitter);return this.setIncludeUniformValues(s,n),s}Lo(e){return this.hasIBL()?e.HAS_IBL_LIGHTING=1:delete e.HAS_IBL_LIGHTING,e}Io(){if(!this.shader)return;const e=this.shader.shaderDefines;this.Lo(e),this.shader.shaderDefines=e}}var tZ="#include <gl2_vert>\n#define EXTRUDE_SCALE 63.0\n#define EXTRUDE_MOD 64.0\n#define MAX_LINE_DISTANCE 65535.0\nuniform mat4 projViewModelMatrix;\nuniform vec2 centiMeterToLocal;\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\nattribute vec4 aTubeNormal;\n#ifdef HAS_LINE_WIDTH\nattribute float aLineWidth;\n#else\nuniform float lineWidth;\n#endif\n#include <vt_position_vert>\n#ifdef PICKING_MODE\n#include <fbo_picking_vert>\n#else\nuniform mat4 modelViewMatrix;\nuniform mat3 modelNormalMatrix;\nuniform mat4 modelMatrix;\n#if defined(HAS_PATTERN)\nuniform float resolution;\nuniform float tileResolution;\nuniform float tileRatio;\nattribute float aLinesofar;\nvarying highp float vLinesofar;\nattribute vec4 aTexInfo;\nvarying vec4 vTexInfo;\nvarying float vNormalY;\nvarying float vPatternHeight;\nattribute float aNormalDistance;\n#if defined(HAS_PATTERN_ANIM)\nattribute float aLinePatternAnimSpeed;\nvarying float vLinePatternAnimSpeed;\n#endif\n#if defined(HAS_PATTERN_GAP)\nattribute float aLinePatternGap;\nvarying float vLinePatternGap;\n#endif\n#endif\n#ifdef HAS_COLOR\nattribute vec4 aColor;\nvarying vec4 vColor;\n#endif\n#ifdef HAS_OPACITY\nattribute float aOpacity;\n#endif\nvarying float vOpacity;\nvarying vec3 vModelNormal;\nvarying vec4 vViewVertex;\nvarying vec3 vModelVertex;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_vert>\n#endif\n#include <highlight_vert>\nvoid main() {\n  \n#ifdef HAS_LINE_WIDTH\nfloat c = aLineWidth;\n#else\nfloat c = lineWidth;\n#endif\nfloat d = c / 2.;\n  vec3 e = aTubeNormal.xyz / EXTRUDE_SCALE;\n  vec3 f = unpackVTPosition();\n  vec4 h = vec4(f, 1.);\n  h.xy += e.xy * d * centiMeterToLocal;\n  h.z += e.z * d;\n  gl_Position = projViewModelMatrix * h;\n#ifdef PICKING_MODE\nfbo_picking_setData(gl_Position.w, true);\n#else\nvViewVertex = modelViewMatrix * h;\n  vec3 i = normalize(e);\n  vModelNormal = modelNormalMatrix * i;\n  vModelVertex = (modelMatrix * h).xyz;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nshadow_computeShadowPars(h);\n#endif\n#ifdef HAS_COLOR\nvColor = aColor / 255.;\n#endif\n#ifdef HAS_OPACITY\nvOpacity = aOpacity / 255.;\n#else\nvOpacity = 1.;\n#endif\n#ifdef HAS_PATTERN\nfloat j = tileResolution / resolution;\n  float k = aLinesofar - d * centiMeterToLocal.y * aNormalDistance / EXTRUDE_SCALE;\n  vLinesofar = k / tileRatio * j;\n  vTexInfo = vec4(aTexInfo.xy, aTexInfo.zw + 1.);\n  vPatternHeight = c * centiMeterToLocal.x / tileRatio * j;\n  vNormalY = aTubeNormal.w / EXTRUDE_SCALE;\n#if defined(HAS_PATTERN_ANIM)\nvLinePatternAnimSpeed = aLinePatternAnimSpeed / 127.;\n#endif\n#if defined(HAS_PATTERN_GAP)\nvLinePatternGap = aLinePatternGap / 10.0;\n#endif\n#endif\nhighlight_setVarying();\n#endif\n}";const{getPBRUniforms:eZ}=DT.PBRUtils;class Ec extends Sl{needToRedraw(){return super.needToRedraw()||this.isAnimating()}isTerrainSkin(){return!1}isTerrainVector(){return!0}isUniqueStencilRefPerTile(){return!1}supportRenderMode(e){return this.isAnimating()?"fxaa"===e||"fxaaAfterTaa"===e:"taa"===e||"fxaa"===e}isAnimating(){if(this.Sr)return!0;const e=this.getSymbols();for(let n=0;n<e.length;n++)if(e[n].linePatternFile&&e[n].linePatternAnimSpeed)return!0;return!1}isBloom(e){return!!this.getSymbol(e.properties.symbolIndex).lineBloom}createMesh(e,n){if(!e.geometry)return null;const i=this.getMap(),{geometry:o,symbolIndex:s,ref:a}=e,h=this.getSymbolDef(s);void 0===a&&SG(o,h,this.getFnTypeConfig(s),this.layer);const l=this.getSymbol(s),{tileResolution:c,tileRatio:A}=o.properties,f={tileResolution:c,tileRatio:A};jU(f,"lineColor",l,"lineColor","#fff",VU(this.colorCache)),jU(f,"linePatternGapColor",l,"linePatternGapColor",[1,1,1,1],VU(this.colorCache)),jU(f,"lineWidth",l,"lineWidth",2,(e=>{var n;return("centimeter"===(n=this.dataConfig.metric)||"cm"===n?1:"millimeter"===n||"mm"===n?.1:100)*e})),jU(f,"lineOpacity",l,"lineOpacity",1),jU(f,"linePatternAnimSpeed",l,"linePatternAnimSpeed",0),jU(f,"linePatternGap",l,"linePatternGap",0),jU(f,"metallicFactor",l,"metallicFactor",0),jU(f,"roughnessFactor",l,"roughnessFactor",.4),jU(f,"emissiveFactor",l,"emissiveFactor",[0,0,0]),jU(f,"uvScale",l,"uvScale",[1,1]);const d=o.properties.iconAtlas,p=this.layer instanceof Qp;d&&(f.linePatternFile=uV(this.regl,d,!1),f.atlasSize=d?[d.width,d.height]:[0,0],f.flipY=p?-1:1,this.drawDebugAtlas(d)),void 0===a&&o.generateBuffers(this.regl),f.alphaTest=-1;const g=new DT.StandardMaterial(f),v=new bC(o,g,{castShadow:!1,picking:!0}),w=i.distanceToPointAtRes(100,100,o.properties.tileResolution)._multi(A/1e4).toArray();v.setUniform("centiMeterToLocal",w);const C=i.getResolution(i.getMaxNativeZoom());v.setUniform("animSpeedScale",c/C),v.setLocalTransform(n);const P={IS_LINE_EXTRUSION:1,HAS_LAYER_OPACITY:1};return"square-tube"===this.dataConfig.type&&(P.IS_SQUARE_TUBE=1),d&&(P.HAS_PATTERN=1),v.properties.symbolIndex=s,o.data.aColor&&(P.HAS_COLOR=1),this.setMeshDefines(P,o,h),o.data.aAltitude&&(P.HAS_ALTITUDE=1),v.setDefines(P),v}setMeshDefines(e,n,i){n.data.aOpacity&&(e.HAS_OPACITY=1),n.data.aLineWidth&&(e.HAS_LINE_WIDTH=1),BG(i.linePatternAnimSpeed)&&(e.HAS_PATTERN_ANIM=1),BG(i.linePatternGap)&&(e.HAS_PATTERN_GAP=1)}paint(e){e.states&&e.states.includesChanged.shadow&&(this.shader.dispose(),this.createShader(e)),super.paint(e)}init(e){this.getMap().on("updatelights",this.Io,this),this.createIBLTextures();if(this.renderer=new PC(this.regl),this.createShader(e),this.pickingFBO){const e=[];this.picking=[new XM(this.renderer,{vert:"#define PICKING_MODE 1\n"+tZ,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(e,n){const i=[];return Cv(i,n.projViewMatrix,n.modelMatrix),i}},{name:"modelNormalMatrix",type:"function",fn:(n,i)=>uv(e,i.modelMatrix)}],extraCommandProps:this.getExtraCommandProps()},this.pickingFBO,this.getMap())]}}createShader(e){this.Tr=e;const n=[],i={};this.fillIncludes(i,n,e),n.push({name:"projViewModelMatrix",type:"function",fn:function(e,n){const i=[];return Cv(i,n.projViewMatrix,n.modelMatrix),i}}),this.shader=new DT.StandardShader({vert:tZ,uniforms:n,defines:this.Lo(i),extraCommandProps:this.getExtraCommandProps()})}getExtraCommandProps(){const e=this.canvas;return{viewport:{x:0,y:0,width:()=>e?e.width:1,height:()=>e?e.height:1},stencil:{enable:!0,func:{cmp:()=>"<=",ref:(e,n)=>n.level},op:{fail:"keep",zfail:"keep",zpass:"replace"}},cull:{enable:()=>!!this.sceneConfig.cullFace,face:this.sceneConfig.cullFace||"back"},depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],mask:this.sceneConfig.depthMask||!0,func:this.sceneConfig.depthFunc||"<="},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}}}getUniformValues(e,n){const{iblTexes:i,dfgLUT:o}=this.getIBLRes(),s=eZ(e,i,o,null,n&&n.jitter),a=e.viewMatrix;return s.projViewMatrix=e.projViewMatrix,s.viewMatrix=a,s.resolution=e.getResolution(),s.currentTime=this.layer.getRenderer().getFrameTimestamp()||0,this.setIncludeUniformValues(s,n),s}createFnTypeConfig(e,n){const i=DD(n.lineColor),o=DD(n.aLinePatternAnimSpeed),s=DD(n.aLinePatternGap),a=this.createShapeFnTypeConfigs(e,n),h=new Int8Array(2);return[{attrName:"aColor",symbolName:"lineColor",type:Uint8Array,width:4,define:"HAS_COLOR",evaluate:(n,o)=>{let s=i(e.getZoom(),n);return ED(s)&&(s=this.evaluateInFnTypeConfig(s,o,e,n,!0)),Array.isArray(s)||(s=this.colorCache[s]=this.colorCache[s]||Ck(s).unitArray()),s=GU(s),s}},{attrName:"aLinePattern",symbolName:"linePatternAnimSpeed",type:Int8Array,width:2,related:["linePatternGap"],define:"HAS_LINE_PATTERN",evaluate:(n,i,s,a)=>{let l=o(e.getZoom(),n);return BU(l)&&(l=0),0!==l&&(i.properties.hasPatternAnim=1),h[0]=l/127,h[1]=s[a+1],h}},{attrName:"aLinePattern",symbolName:"linePatternGap",type:Int8Array,width:2,related:["linePatternAnimSpeed"],define:"HAS_LINE_PATTERN",evaluate:(n,i,o,a)=>{let l=s(e.getZoom(),n);return BU(l)&&(l=0),h[1]=10*l,h[0]=o[a],h}}].concat(a)}createShapeFnTypeConfigs(e,n){const i=RD(n.lineWidth),o=RD(n.lineOpacity),s=new Uint16Array(1);return[{attrName:"aLineWidth",symbolName:"lineWidth",type:Uint8Array,width:1,define:"HAS_LINE_WIDTH",evaluate:(n,o)=>{let a=i(e.getZoom(),n);return ED(a)&&(a=this.evaluateInFnTypeConfig(a,o,e,n)),s[0]=Math.round(2*a),s[0]}},{attrName:"aOpacity",symbolName:"lineOpacity",type:Uint8Array,width:1,define:"HAS_OPACITY",evaluate:(n,i)=>{let a=o(e.getZoom(),n);return ED(a)&&(a=this.evaluateInFnTypeConfig(a,i,e,n)),s[0]=255*a,s[0]}}]}Lo(e){return this.hasIBL()?e.HAS_IBL_LIGHTING=1:delete e.HAS_IBL_LIGHTING,e}Io(){if(!this.shader)return;const e=this.shader.shaderDefines;this.Lo(e),this.shader.shaderDefines=e}delete(){super.delete(),this.disposeIBLTextures(),this.shader&&(this.shader.dispose(),delete this.shader)}}const nZ=[],iZ=[],rZ=[],oZ=[],sZ=[],aZ=[0,0,0],hZ=[0,0,0],lZ=[1,1,1],uZ=[],cZ=[1,1,1,1],AZ=[],fZ=[1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1],dZ=e=>class extends e{constructor(e,n,i,o,s,a){super(e,n,i,o,s,a),this.Ro=!1,this.scene.sortFunction=this.sortByCommandKey;const h=o.fetchOptions||{};h.referrer=window&&window.location.href,this.Ho=new lM(e,{fetchOptions:h,urlModifier:e=>{const i=n.getURLModifier();return i&&i(e)||e}}),this.zo(),this.No()}isUniqueStencilRefPerTile(){return!1}isAnimating(){const e=this.getSymbols();for(let n=0;n<e.length;n++)if(e[n]&&this.Vo[n]&&this.Uo(n))return!0;return!1}createGeometry(e,n){const{data:i,positionSize:o}=e;return{geometry:{properties:FU({},e.properties),data:i,positionSize:o,features:n},symbolIndex:e.symbolIndex}}getFnTypeConfig(){return uZ}createMesh(e,n,{tileTranslationMatrix:i,tileExtent:o},{timestamp:s}){if(!this.Ro)return null;const a=this.getMap(),{geometry:h}=e,{positionSize:l,features:c}=h,{aPosition:A,aPickingId:f,aXYRotation:d,aZRotation:p,aAltitude:g}=h.data,v=A.length/l;if(0===v)return null;const w={instance_vectorA:new Float32Array(4*v),instance_vectorB:new Float32Array(4*v),instance_vectorC:new Float32Array(4*v),aPickingId:[]},C=this.jo(w,i,o,h.properties.z,A,g,d,p,l,f,c);h.data.aTerrainAltitude&&(w.aTerrainAltitude=h.data.aTerrainAltitude);const P={};for(const e in w)P[e]={buffer:this.regl.buffer({dimension:w[e].length/v,data:w[e]}),divisor:1};const T=this.Go(),S=this.Bo(),I=xv([]);Mv(I,I,[S,S,S]);const E=[],O=this.getSymbols();for(let e=0;e<O.length;e++){const n=O[e],o=this.$o[e];if(!o)continue;const l=this.Vo[e][0],{fixSizeOnZoom:c}=n;let A=xv([]);T||(A=this.Wo(A));let f=0;o.forEach((e=>{const{geometry:i,nodeMatrix:o}=e;Cv(AZ,fZ,o),Cv(AZ,A,AZ);const s=Cv(AZ,I,AZ),a=i.boundingBox.copy();a.transform(s);const h=this.Xo(a,n);Math.abs(h)>Math.abs(f)&&(f=h)}));const d=[0,0,f],p=o.map(((o,p)=>{const{geometry:g,materialInfo:T,morphWeights:S,extraInfo:E,nodeIndex:O}=o;n.alphaTest&&(T.alphaTest=n.alphaTest);const k=new(this.getMaterialClazz(T))(T),L={},F=new wC(P,v,g,k,{transparent:!1,picking:!0});if(l.hasSkinAnimation()){const n=this.Yo(F,e,0)[O];F.setUniform("jointTexture",n.jointTexture),F.setUniform("jointTextureSize",n.jointTextureSize),F.setUniform("numJoints",n.numJoints),F.setUniform("skinAnimation",+this.Uo(e)),F.properties.startTime=s,L.HAS_SKIN=1}S&&(F.setUniform("morphWeights",S),L.HAS_MORPH=1),F.setUniform("hasAlpha",E.alphaMode&&"BLEND"===E.alphaMode.toUpperCase()),jU(F.uniforms,"polygonFill",n,"markerFill",cZ,VU(this.colorCache)),jU(F.uniforms,"polygonOpacity",n,"markerOpacity",1);const N=[];F.setPositionMatrix((()=>{const n=this.qo(e,p,O);Cv(N,fZ,n),Cv(N,A,N),Cv(N,I,N);const i=xv(AZ);if(0!==f&&(Ov(i,d),Cv(N,i,N)),ZU(c)){const e=a.getGLScale()/a.getGLScale(c);return $v(nZ,e,e,e),Rv(i,nZ),Cv(i,i,N)}return N}));const z=this.layer.getRenderer().getZScale(),H=[],j=[];return F.setLocalTransform((()=>{const e=this.layer.options.altitude||0;return Kv(j,C),j[2]+=100*e*z,Pv(H,i,j),H})),g.generateBuffers(this.regl,{excludeElementsInVAO:!0}),w.instance_color&&(L.HAS_INSTANCE_COLOR=1),w.aTerrainAltitude&&(L.HAS_INSTANCE_TERRAIN_ALTITUDE=1,F.setUniform("terrainAltitudeScale",100*this.layer.getRenderer().getZScale())),L.HAS_LAYER_OPACITY=1,FU(F.properties,h.properties),F.setDefines(L),F.properties.symbolIndex={index:e},F}));E.push(...p)}return E.insContext={instanceData:w,tileTranslationMatrix:i,tileExtent:o,aPosition:A,positionSize:l},E}qo(e,n,i){const o=this.$o[e][n];return this.Uo(e)&&this.Jo&&this.Jo[i]||o.nodeMatrix}Yo(e,n,i){if(!this.Vo)return;const o=this.Vo[n][0];this.Ko||(this.Ko={}),this.Jo={},this.Ko[e.uuid]||(this.Ko[e.uuid]={});const s=this.getSymbols()[n],a=this.Zo[n],{loop:h,speed:l,animationName:c}=s;return o.updateAnimation(i,h||!1,l||1,c||a.animations[0].name,e.properties.startTime||0,this.Jo,this.Ko[e.uuid]),this.Ko[e.uuid]}Xo(e,n){const i=n.anchorZ||"center";let o=0;const s=e.max[2]-e.min[2];return"bottom"===i?o=s/2:"top"===i&&(o=-s/2),o}addMesh(e,n,i){if(!e)return null;if(e[0].properties.level>2)return null;const o=i.timestamp;for(let n=0;n<e.length;n++){if(!e[n]||!e[n].geometry)continue;e[n].instancedData.aTerrainAltitude&&this.$i(e[n],e[n].instancedData,e[n].properties,3,i);const s=e[n].properties.symbolIndex.index,a=this.Uo(s);a&&this.Yo(e[n],s,o),e[n].setUniform("skinAnimation",+a)}return this.scene.addMesh(e),this}gr(e,n){e&&e.updateInstancedData&&e.updateInstancedData("aTerrainAltitude",n)}prepareRender(e){const n=this.getSymbols();let i=!1;for(let e=0;e<n.length;e++)if(n[e]&&this.Vo[e]&&this.Uo(e)&&this.Vo[e]&&!i){i=!0;break}i&&this.setToRedraw(!0),super.prepareRender(e)}getShadowMeshes(){return this.isVisible()?(this.shadowCount=this.scene.getMeshes().length,this.scene.getMeshes().filter((e=>0===e.properties.level))):uZ}Uo(e){const n=this.getSymbols()[e];return!!(n&&n.animation&&this.Vo[e]&&this.Vo[e][0]&&this.Vo[e][0].hasSkinAnimation())}jo(e,n,i,o,s,a,h,l,c,A,f){function d(n,i,o,s){e[n][4*i]=o[s],e[n][4*i+1]=o[s+4],e[n][4*i+2]=o[s+8],e[n][4*i+3]=o[s+12]}const p=s.length/c,g=this.layer.getTileSize().width/i*this.layer.getRenderer().getTileGLScale(o),v=this.layer.getRenderer().getZScale(),w=100*(this.dataConfig.altitudeOffset||0);let C=1/0,P=1/0,T=1/0,S=-1/0,I=-1/0,E=-1/0;const O=[],k=[];for(let e=0;e<p;e++){a?$v(k,s[e*c],s[e*c+1],a[e]):QF(k,s[e*c],s[e*c+1],s[e*c+2]);const n=$v(O,k[0]*g,-k[1]*g,(k[2]+w)*v);n[0]<C&&(C=n[0]),n[0]>S&&(S=n[0]),n[1]<P&&(P=n[1]),n[1]>I&&(I=n[1]),n[2]<T&&(T=n[2]),n[2]>E&&(E=n[2])}const L=(C+S)/2,F=(P+I)/2,N=(T+E)/2,z=[],H=this.Go(),j=[0,0,1];for(let n=0;n<p;n++){a?$v(k,s[n*c],s[n*c+1],a[n]):QF(k,s[n*c],s[n*c+1],s[n*c+2]);const i=k[0],o=k[1],p=$v(O,i*g-L,-o*g-F,(k[2]+w)*v-N),C=h&&h[n]||0,P=l&&l[n]||0;if(C||P){Dv(z,P,j);const e=$v(nZ,i,o,0);Tv(z,z,C,l_(e,c_(e,e,j)));Cv(z,Ov(AZ,p),z)}else Ov(z,p);if(H){Cv(z,z,this.Wo(AZ,f,A,n))}d("instance_vectorA",n,z,0),d("instance_vectorB",n,z,1),d("instance_vectorC",n,z,2),e.aPickingId[n]=n}return $v(O,L,F,N),O}Bo(){if(!this.Qo){const e=this.getMap();this.Qo=100*fU(e.getGLRes(),e)}return this.Qo}Wo(e,n,i,o){const s=this.getMap(),a=this.symbolDef[0],h=this.Bo();let l=a.translationX||0,c=a.translationY||0,A=a.translationZ||0,f=a.rotationX||0,d=a.rotationY||0,p=a.rotationZ||0,g=a.scaleX||1,v=a.scaleY||1,w=a.scaleZ||1;const C=n&&n[i&&i[o]],P=s.getZoom(),T=C&&C.feature&&C.feature.properties,S=this.ta(P,T);this.ea&&(l=this.ea(P,T)),this.na&&(c=this.na(P,T)),this.ia&&(A=this.ia(P,T));const I=$v(iZ,l*h,c*h,A*h);this.ra&&(f=this.ra(P,T)),this.sa&&(d=this.sa(P,T)),this.oa&&(p=this.oa(P,T));const E=$v(rZ,f,d,p);this.aa&&(g=this.aa(P,T)),this.la&&(v=this.la(P,T)),this.ha&&(w=this.ha(P,T));const O=$v(oZ,g*S,v*S,w*S);return this.ua(e,I,E,O)}ta(e,n){const i=this.symbolDef[0];let o=this.ca?this.ca(e,n):i.modelHeight;if(lU(o))return 1;const s=this.fa[0];return o/Math.abs(s.max[1]-s.min[1])}getShaderConfig(){const e=super.getShaderConfig();return e.positionAttribute="POSITION",e.normalAttribute="NORMAL",e}init(e){super.init(e),this.No()}zo(){const e=this.symbolDef[0];ED(e.modelHeight)&&(this.ca=RD(e.modelHeight)),ED(e.translationX)&&(this.ea=RD(e.translationX)),ED(e.translationY)&&(this.na=RD(e.translationY)),ED(e.translationZ)&&(this.ia=RD(e.translationZ)),ED(e.rotationX)&&(this.ra=RD(e.rotationX)),ED(e.rotationY)&&(this.sa=RD(e.rotationY)),ED(e.rotationZ)&&(this.oa=RD(e.rotationZ)),ED(e.scaleX)&&(this.aa=RD(e.scaleX)),ED(e.scaleY)&&(this.la=RD(e.scaleY)),ED(e.scaleZ)&&(this.ha=RD(e.scaleZ))}Go(){return!!(this.ca&&!this.ca.isFeatureConstant||this.ea&&!this.ea.isFeatureConstant||this.na&&!this.na.isFeatureConstant||this.ia&&!this.ia.isFeatureConstant||this.ra&&!this.ra.isFeatureConstant||this.sa&&!this.sa.isFeatureConstant||this.oa&&!this.oa.isFeatureConstant||this.aa&&!this.aa.isFeatureConstant||this.la&&!this.la.isFeatureConstant||this.ha&&!this.ha.isFeatureConstant)}No(){if(this.Vo)return;this.Vo=[],this.Zo=[],this.fa=[],this.$o=[];const e=this.getSymbols();this.da=0;for(let n=0;n<e.length;n++){const i=e[n].url||"pyramid";this.Ho.loginGLTF(i);const o=this.Ho.getGLTF(i);if(o.then)o.then((i=>{if(!i.gltfPack)return this.da++,void(this.da>=e.length&&(this.Ro=!0,this.setToRedraw(!0)));const{gltfPack:o,json:s,bbox:a}=i;this.Vo[n]=[o],this.$o[n]=o.getMeshesInfo(),this.Zo[n]=s,this.fa[n]=a,this.da++,this.da>=e.length&&(this.Ro=!0),this.setToRedraw(!0)}));else{const{gltfPack:e,json:i,bbox:s}=o;e&&(this.Vo[n]=[e],this.$o[n]=e.getMeshesInfo(),this.Zo[n]=i,this.fa[n]=s,this.da++)}}this.da>=e.length&&(this.Ro=!0)}getPickingVert(){return"\n    attribute vec3 aPosition;\n    uniform mat4 projViewModelMatrix;\n    uniform mat4 modelMatrix;\n    uniform mat4 positionMatrix;\n    //fbo pickingvert\n    #include <fbo_picking_vert>\n    #include <get_output>\n    void main()\n    {\n        mat4 localPositionMatrix = getPositionMatrix();\n        vec4 localPosition = getPosition(aPosition);\n\n        gl_Position = projViewModelMatrix * localPositionMatrix * localPosition;\n        //gl_Positiondepth\n        fbo_picking_setData(gl_Position.w, true);\n    }"}deleteMesh(e){if(e){this.scene.removeMesh(e);for(let n=0;n<e.length;n++){const i=this.Ko&&this.Ko[e[n].uuid];if(i){for(const e in i)i[e].jointTexture&&i[e].jointTexture.destroy();delete this.Ko[e[n].uuid]}e[n].disposeInstancedData(),e[n].dispose()}}}delete(){super.delete();const e=this.getSymbols();for(let n=0;n<e.length;n++){this.Ho.logoutGLTF(e[n].url||"pyramid")}if(this.Ko){for(const e in this.Ko){const n=this.Ko[e];for(const e in n)n[e].jointTexture&&n[e].jointTexture.destroy()}delete this.Ko}delete this.Jo}ua(e,n,i,o){const s=$v(nZ,...n||aZ),a=i||hZ,h=o||lZ;return zv(e,Ax(sZ,a[0],a[1],a[2]),s,h)}};class Xc extends(dZ(kc)){getMaterialClazz(e){return e.diffuseFactor?vC:dC}}class Yc extends(dZ(Fc)){getMaterialClazz(e){return e.specularGlossinessTexture||e.diffuseTexture?DT.StandardSpecularGlossinessMaterial:DT.StandardMaterial}}const{getPBRUniforms:pZ}=DT.PBRUtils,gZ={color:[2.0303,2.028,2.028],direction:[0,-.2717,-1]},mZ=.3737,yZ={index:0},vZ=[0,0,0],_Z=[2,2];class ef extends Sl{supportRenderMode(e){return"fxaa"===e||"fxaaBeforeTaa"===e}needPolygonOffset(){return!0}isTerrainSkin(){return!1}isTerrainVector(){return!0}needToRedraw(){return!!super.needToRedraw()||this.getSymbol(yZ).animation}createMesh(e,n){const{geometry:i}=e;i.generateBuffers(this.regl);const o=new bC(i,null,{castShadow:!1,picking:!0});return o.properties.symbolIndex=yZ,o.setLocalTransform(n),o}callShader(e,n){super.callShader(e,n),this.transformWater();const i=this.pa(this.getMap(),n);this.Xi+=this.renderer.render(this.ma,i,this.ya,this.getRenderFBO(n))}addMesh(e,n){this.Pr(e,n),super.addMesh(...arguments)}Pr(e){const n=this.getSymbol(yZ).ssr;for(let i=0;i<e.length;i++)e[i].ssr=n?1:0}paint(e){e.states&&e.states.includesChanged&&(this.shader.dispose(),this.ma.dispose(),this._r(e));const n=!!e.ssr&&this.getSymbol(yZ).ssr,i=this.ma,o=i.shaderDefines;if(n){const n=FU({},o,e.ssr.defines);i.shaderDefines=n}this.updateIBLDefines(i),this.ga.ssr=n?1:0,super.paint(e),n&&(i.shaderDefines=o)}isEnableTileStencil(){return!1}init(e){this.createIBLTextures();this.renderer=new PC(this.regl),this.createGround(),this._r(e),this.pickingFBO&&(this.picking=[new XM(this.renderer,{vert:lV,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(e,n){const i=[];return Cv(i,n.projViewMatrix,n.modelMatrix),i}}],extraCommandProps:{viewport:this.pickingViewport}},this.pickingFBO,this.getMap())]),this.va()}va(){const e=this.regl;this.xa||(this.xa=e.texture(2));const n=this.layer.getURLModifier(),i=this.getSymbol({index:0}),o=i.texWaveNormal,s=this.getCachedTexture(o),a=this;if(s)this.ba||(s.isLoading?setTimeout((()=>{this.shader&&this.va()}),20):this.ba=this.wa(e,s));else{const i=new Image;i.isLoading=!0,i.onload=function(){delete this.isLoading,a.ba=a.wa(e,this),a.setToRedraw()},i.onerror=()=>{console.error("invalid water wave normal texture:"+o)},this.addCachedTexture(o,i),i.src=n&&n(o)||o}const h=i.texWavePerturbation,l=this.getCachedTexture(h);if(l)this.Aa||(l.isLoading?setTimeout((()=>{this.va()}),20):this.Aa=this.wa(e,l));else{const i=new Image;i.isLoading=!0,i.onload=function(){delete this.isLoading,a.Aa=a.wa(e,this),a.setToRedraw()},i.onerror=()=>{console.error("invalid water wave perturbation texture:"+h)},this.addCachedTexture(h,i),i.src=n&&n(h)||h}}wa(e,n){return this.xa?e.texture({width:n.width,height:n.height,mag:"linear",min:"linear mipmap linear",wrapS:"repeat",wrapT:"repeat",flipY:!0,data:n}):null}_r(e){const n=this.canvas,i=[],o=[{name:"projViewModelMatrix",type:"function",fn:function(e,n){const i=[];return Cv(i,n.projViewMatrix,n.modelMatrix),i}},{name:"modelViewNormalMatrix",type:"function",fn:(e,n)=>{const i=Cv([],n.viewMatrix,n.modelMatrix),o=wv(i,i);return uv([],bv(o,o))}},{name:"modelViewMatrix",type:"function",fn:(e,n)=>Cv([],n.viewMatrix,n.modelMatrix)},{name:"environmentTransform",type:"function",fn:(e,n)=>pv(i,Math.PI*(n.environmentOrientation||0)/180)}],s={TIME_NOISE_TEXTURE_REPEAT:mZ};this.fillIncludes(s,o,e);const a={x:0,y:0,width:()=>n?n.width:1,height:()=>n?n.height:1};this.shader=new eP({vert:"\n                attribute vec3 aPosition;\n\n                uniform mat4 projViewModelMatrix;\n                uniform float minAltitude;\n\n                void main() {\n                    vec3 position = aPosition;\n                    position.z += minAltitude * 100.0;\n                    gl_Position = projViewModelMatrix * vec4(position, 1.);\n                }\n            ",frag:"\n    #define SHADER_NAME WATER_STENCIL\n    precision mediump float;\n    void main() {\n        gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n    }\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(e,n){const i=[];return Cv(i,n.projViewMatrix,n.modelMatrix),i}}],extraCommandProps:{viewport:a,colorMask:[!1,!1,!1,!1],stencil:{enable:!0,mask:255,func:{cmp:"<=",ref:254,mask:255},op:{fail:"keep",zfail:"keep",zpass:"replace"}},depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],func:this.sceneConfig.depthFunc||"<="},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}}});const h={viewport:a,stencil:{enable:!0,mask:255,func:{cmp:"==",ref:254,mask:255},op:{fail:"keep",zfail:"keep",zpass:"replace"}},depth:{enable:!1}};o.push(...gP.getUniformDeclares()),this.ma=new eP({vert:"#define SHADER_NAME WATER\nuniform mat4 modelMatrix;\nuniform mat4 projViewModelMatrix;\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\nuniform vec2 uvOffset;\nuniform vec2 noiseUvOffset;\nuniform vec2 uvScale;\nvarying vec2 vUv;\nvarying vec2 vNoiseUv;\nvarying vec3 vPos;\nvarying mat3 vTbnMatrix;\n#ifdef HAS_SSR\nuniform mat4 modelViewMatrix;\nvarying vec4 vViewVertex;\n#endif\n#include <highlight_vert>\nmat3 c(in vec3 d) {\n  vec3 t = normalize(cross(d, vec3(.0, 1., .0)));\n  vec3 e = normalize(cross(d, t));\n  return mat3(t, e, d);\n}\n#if defined(HAS_SHADOWING)\n#include <vsm_shadow_vert>\n#endif\nconst vec3 f = vec3(0., 0., 1.);\nvoid main(void) {\n  vec4 h = vec4(aPosition, 1.);\n  vec4 i = modelMatrix * h;\n  vPos = i.xyz;\n  vTbnMatrix = c(f);\n  gl_Position = projViewModelMatrix * h;\n  vUv = aTexCoord * uvScale + uvOffset;\n  vNoiseUv = aTexCoord * uvScale * TIME_NOISE_TEXTURE_REPEAT + noiseUvOffset;\n#ifdef HAS_SSR\nvec4 j = modelViewMatrix * h;\n  vViewVertex = j;\n#endif\n#if defined(HAS_SHADOWING)\nshadow_computeShadowPars(h);\n#endif\nhighlight_setVarying();\n}",frag:"#define SHADER_NAME WATER\nprecision highp float;\nprecision highp sampler2D;\n#include <hsv_frag>\nuniform vec3 hsv;\nuniform float contrast;\nuniform float layerOpacity;\n#if defined(HAS_SHADOWING)\n#include <vsm_shadow_frag>\n#endif\n#include <highlight_frag>\n#if defined(HAS_IBL_LIGHTING)\nuniform vec3 hdrHSV;\nuniform samplerCube prefilterMap;\nuniform sampler2D brdfLUT;\nuniform mat3 environmentTransform;\nuniform vec3 diffuseSPH[9];\nvec3 c(const in vec3 d) {\n  vec3 e = environmentTransform * d;\n  float x = e.x;\n  float y = e.y;\n  float z = e.z;\n  vec3 f = (diffuseSPH[0] + diffuseSPH[1] * x + diffuseSPH[2] * y + diffuseSPH[3] * z + diffuseSPH[4] * z * x + diffuseSPH[5] * y * z + diffuseSPH[6] * y * x + diffuseSPH[7] * (3. * z * z - 1.) + diffuseSPH[8] * (x * x - y * y));\n  if(length(hdrHSV) > .0) {\n    f = hsv_apply(f, hdrHSV);\n  }\n  return max(f, vec3(.0));\n}\nvec3 h(const in vec3 i, const in float j, const in float k, const in float l) {\n  vec4 rgba = texture2D(brdfLUT, vec2(k, j));\n  float b = (rgba[3] * 65280.0 + rgba[2] * 255.);\n  float a = (rgba[1] * 65280.0 + rgba[0] * 255.);\n  const float m = 1. / 65535.;\n  return (i * a + b * l) * m;\n}\n#else\nuniform vec3 ambientColor;\n#endif\nstruct PBRShadingWater {\n  float NdotL;\n  float NdotV;\n  float NdotH;\n  float VdotH;\n  float LdotH;\n  float VdotN;\n};\nvec3 o(const in vec4 u, const in float v) {\n  if(v <= .0)\n    return u.rgb;\n  return v * u.rgb * u.a;\n}\n#ifdef HAS_SSR\nvarying vec4 vViewVertex;\nuniform mat3 modelViewNormalMatrix;\nuniform sampler2D TextureDepth;\nuniform highp vec2 outSize;\nuniform float ssrFactor;\nuniform float ssrQuality;\nuniform sampler2D TextureReflected;\nuniform highp mat4 projMatrix;\nuniform mat4 invProjMatrix;\nuniform vec4 outputFovInfo[2];\nuniform mat4 reprojViewProjMatrix;\nuniform vec2 cameraNearFar;\nfloat A(const in vec4 B) {\n  return B.r + B.g / 255.;\n}\nfloat C(const in vec2 D, const in float E) {\n  vec3 F = vec3(.06711056, .00583715, 52.9829189);\n  return fract(F.z * fract(dot(D.xy + E * vec2(47., 17.) * .695, F.xy))) * .5;\n}\nvec3 G(const in float H, const in float I, const in vec2 J) {\n  float K = min(I - .01, H);\n  float L = floor(K);\n  float M = min(I, L + 1.);\n  float N = pow(2., M);\n  vec2 O = 2. * N / J;\n  if(K - L > .5)\n    N *= 2.;\n  return vec3(O, N);\n}\nvec2 P(const in vec2 Q, const in vec3 R) {\n  vec2 S = max(R.xy, min(1. - R.xy, Q));\n  return vec2(2. * S.x, R.z - 1. - S.y) / R.z;\n}\nvec3 T(const in mat4 U, const in vec3 V) {\n  vec4 W = U * vec4(V, 1.);\n  return vec3(.5 + .5 * W.xy / W.w, W.w);\n}\nvec3 X(const in float Y, const in vec2 S) {\n  return texture2D(TextureReflected, S).rgb;\n}\nfloat Z(float ba) {\n  highp mat4 U = projMatrix;\n  highp float z = ba * 2. - 1.;\n  return -U[3].z / (z + U[2].z);\n}\nfloat bb(const vec2 S) {\n  float ba = A(texture2D(TextureDepth, S));\n  return ba;\n}\nvec3 bc(const in float E, const in vec3 bd, const in vec3 be, const in vec3 bf, const in vec3 bg, const in float bh) {\n  vec2 bi;\n  bi.x = C(gl_FragCoord.yx, E);\n  bi.y = fract(bi.x * 52.9829189);\n  bi.y = mix(bi.y, 1., .7);\n  float bj = 2. * 3.14159 * bi.x;\n  float bk = pow(max(bi.y, .000001), bh / (2. - bh));\n  float bl = sqrt(1. - bk * bk);\n  vec3 bm = vec3(bl * cos(bj), bl * sin(bj), bk);\n  bm = bm.x * bd + bm.y * be + bm.z * bf;\n  return normalize((2. * dot(bg, bm)) * bm - bg);\n}\nfloat bn(const in float E) {\n  return (C(gl_FragCoord.xy, E) - .5);\n}\nvec3 bo(const in vec3 bp, const in float bq, const in vec3 br) {\n  vec3 bs = T(projMatrix, vViewVertex.xyz + br * bq);\n  bs.z = 1. / bs.z;\n  bs -= bp;\n  float bt = min(1., .99 * (1. - bp.x) / max(1e-5, bs.x));\n  float bu = min(1., .99 * (1. - bp.y) / max(1e-5, bs.y));\n  float bv = min(1., .99 * bp.x / max(1e-5, -bs.x));\n  float bw = min(1., .99 * bp.y / max(1e-5, -bs.y));\n  return bs * min(bt, bu) * min(bv, bw);\n}\nfloat bx(const in vec3 bp, const in vec3 bs, inout float by, inout float bz) {\n  float bA = (bz + by) * .5;\n  vec3 bB = bp + bs * bA;\n  float z = bb(bB.xy);\n  float ba = Z(z);\n  float bC = -1. / bB.z;\n  by = ba > bC ? by : bA;\n  bz = ba > bC ? bA : bz;\n  return bA;\n}\nvec4 bD(const in vec3 bp, const in float bq, in float bE, const in vec3 br, const in float j, const in float E) {\n  const int bF = 20;\n  float bG = 1. / float(bF);\n  bE *= bG;\n  vec3 bs = bo(bp, bq, br);\n  float bH = bG;\n  vec3 bI = vec3(.0, bH, 1.);\n  vec3 bB;\n  float z, ba, bC, bJ, bK, bL;\n  bool bM;\n  float bN = 1.;\n  float bA;\n  for(int bO = 0; bO < bF; bO++) {\n    bB = bp + bs * bI.y;\n    z = bb(bB.xy);\n    ba = Z(z);\n    bC = -1. / bB.z;\n    bJ = bC - ba;\n    bJ *= clamp(sign(abs(bJ) - bq * bG * bG), .0, 1.);\n    bM = abs(bJ + bE) < bE;\n    bK = clamp(bI.x / (bI.x - bJ), .0, 1.);\n    bL = bM ? bI.y + bK * bG - bG : 1.;\n    bI.z = min(bI.z, bL);\n    bI.x = bJ;\n    if(bM) {\n      float by = bI.y - bG;\n      float bz = bI.y;\n      bA = bx(bp, bs, by, bz);\n      bA = bx(bp, bs, by, bz);\n      bA = bx(bp, bs, by, bz);\n      bN = bA;\n      break;\n    }\n    bI.y += bG;\n  }\n  return vec4(bp + bs * bN, 1. - bN);\n}\nvec3 bP(in vec4 bQ, const in float bR, const in vec3 bS, const in vec3 bT, const in float j) {\n  vec4 bU = mix(outputFovInfo[0], outputFovInfo[1], bQ.x);\n  bQ.xyz = vec3(mix(bU.xy, bU.zw, bQ.y), 1.) * -1. / bQ.z;\n  bQ.xyz = (reprojViewProjMatrix * vec4(bQ.xyz, 1.)).xyw;\n  bQ.xy /= bQ.z;\n  float bV = clamp(6. - 6. * max(abs(bQ.x), abs(bQ.y)), .0, 1.);\n  bQ.xy = .5 + .5 * bQ.xy;\n  return vec3(bQ.xy, 1.);\n}\nvec3 ssr(const in vec3 bS, const in vec3 bT, const in float j, const in vec3 d, const in vec3 bg) {\n  float bW = .0;\n  vec4 f = vec4(.0);\n  float bh = j * j;\n  bh = bh * bh;\n  vec3 bX = abs(d.z) < .999 ? vec3(.0, .0, 1.) : vec3(1., .0, .0);\n  vec3 bd = normalize(cross(bX, d));\n  vec3 be = cross(d, bd);\n  float bR = ssrFactor * clamp(-4. * dot(bg, d) + 3.8, .0, 1.);\n  bR *= clamp(4.7 - j * 5., .0, 1.);\n  vec3 bp = T(projMatrix, vViewVertex.xyz);\n  bp.z = 1. / bp.z;\n  vec3 br = bc(bW, bd, be, d, bg, bh);\n  float bq = mix(cameraNearFar.y + vViewVertex.z, -vViewVertex.z - cameraNearFar.x, br.z * .5 + .5);\n  float bE = .5 * bq;\n  vec4 bQ;\n  if(dot(br, d) > .001 && bR > .0) {\n    bQ = bD(bp, bq, bE, br, j, bW);\n    if(bQ.w > .0)\n      return bP(bQ, bR, bS, bT, j);\n    \n  }\n  return vec3(.0);\n}\n#endif\nconst vec3 bY = vec3(0., 0., 1.);\nuniform mat4 viewMatrix;\nuniform sampler2D normalTexture;\nuniform sampler2D heightTexture;\nuniform vec4 waveParams;\nuniform vec2 waterDir;\nuniform vec4 waterBaseColor;\nuniform vec3 lightDirection;\nuniform vec3 lightColor;\nuniform vec3 camPos;\nuniform float timeElapsed;\nvarying vec2 vUv;\nvarying vec2 vNoiseUv;\nvarying vec3 vPos;\nvarying mat3 vTbnMatrix;\nfloat bZ(vec3 e, float ca) {\n  float cb = max(.015, ca);\n  return max((e.x + e.y) * .3303545 / cb + .3303545, .0);\n}\nconst vec2 cc = vec2(6. / 25., 5. / 24.);\nvec2 cd(sampler2D ce, vec2 S) {\n  return 2. * texture2D(ce, S).rg - 1.;\n}\nfloat cf(vec2 S) {\n  return texture2D(heightTexture, S).b;\n}\nvec3 cg(sampler2D ce, vec2 S) {\n  return 2. * texture2D(ce, S).rgb - 1.;\n}\nfloat ch(vec2 S, float ci) {\n  return fract(ci);\n}\nfloat cj(vec2 S, float ci) {\n  float ck = ch(S, ci);\n  return 1. - abs(1. - 2. * ck);\n}\nvec3 cl(sampler2D cm, vec2 S, float ci, float cn) {\n  float co = waveParams[2];\n  float cp = waveParams[3];\n  vec2 cq = cd(cm, S) * co;\n  float ck = ch(S, ci + cn);\n  float cr = cj(S, ci + cn);\n  vec2 f = S;\n  f -= cq * (ck + cp);\n  f += cn;\n  f += (ci - ck) * cc;\n  return vec3(f, cr);\n}\nconst float cs = 7.77;\nvec3 ct(sampler2D cu, sampler2D cv, vec2 cw, vec2 cx, float ci) {\n  float ca = waveParams[0];\n  vec2 cy = ci * -cx;\n  float cz = cf(vNoiseUv) * cs;\n  vec3 cA = cl(cv, cw + cy, ci + cz, .0);\n  vec3 cB = cl(cv, cw + cy, ci + cz, .5);\n  vec3 cC = cg(cu, cA.xy) * cA.z;\n  vec3 cD = cg(cu, cB.xy) * cB.z;\n  vec3 cE = normalize(cC + cD);\n  cE.xy *= ca;\n  cE.z = sqrt(1. - dot(cE.xy, cE.xy));\n  return cE;\n}\nvec4 cF(vec2 cw, float cG) {\n  float cH = waveParams[1];\n  vec3 d = ct(normalTexture, heightTexture, cw * cH, waterDir, cG);\n  float cI = bZ(d, waveParams[0]);\n  return vec4(d, cI);\n}\nconst float cJ = 3.141592653589793;\nconst float cK = 1. / cJ;\nconst float cL = .3183098861837907;\nconst float cM = 1.570796326794897;\nconst float cN = .4;\nfloat cO = 2.2;\nvec3 cP(float cQ, vec3 cR, float l) {\n  return cR + (l - cR) * pow(1. - cQ, 5.);\n}\nfloat cS(float cT, float j) {\n  float cU = j * j;\n  float cV = cT * cT;\n  float cW = pow((cV * (cU - 1.) + 1.), cO) * cJ;\n  return cU / cW;\n}\nfloat cX(float cY) {\n  return .25 / (cY * cY);\n}\nvec3 cZ(const vec3 x) {\n  return (x * (2.51 * x + .03)) / (x * (2.43 * x + .59) + .14);\n}\nconst float da = 2.2;\nconst float db = .4545454545;\nvec4 dc(vec4 u) {\n  return vec4(pow(u.rgb, vec3(db)), u.w);\n}\nvec3 dd(vec3 u) {\n  return pow(u, vec3(da));\n}\nconst vec3 de = vec3(.02, 1., 5.);\nconst vec2 df = vec2(.02, .1);\nconst float j = .06;\nconst float dg = 1.7;\nconst vec3 dh = vec3(0, .6, .9);\nconst vec3 di = vec3(.72, .92, 1.);\nconst float dj = .65;\nconst float dk = 300000.0;\nconst float dl = 500000.0;\nconst float dm = .775;\nconst float dn = .8;\nPBRShadingWater dp;\nvec3 dq(in PBRShadingWater dr, float j, vec3 ds, float dt) {\n  vec3 du = cP(dr.VdotH, ds, dt);\n  float dv = cS(dr.NdotH, j);\n  float dw = cX(dr.LdotH);\n  float dx = mix(j + .045, j + .385, 1. - dr.VdotH);\n  float dy = 1.2;\n  float dz = cS(dr.NdotH, dx) * dy;\n  return ((dv + dz) * dw) * du;\n}\nvec3 dA(float dg, float dB, vec3 dh, float dC) {\n  return dg * (.075 * dh * pow(dB, 4.) + 50. * pow(dB, 23.)) * dC;\n}\nvec3 dD(in float bk, in vec3 dE, in vec3 dF) {\n  float dG = pow((1. - bk), de[2]);\n  return mix(dF, dE, dG);\n}\nvec3 dH(in vec3 e, in vec3 dI, in float dJ, in float j) {\n  \n#ifdef HAS_IBL_LIGHTING\nvec3 dK = reflect(-dI, e);\n  vec3 dL = textureCube(prefilterMap, environmentTransform * dK).rgb;\n  float dM = clamp(1. + dot(dK, e), .0, 1.);\n  dL *= dM * dM;\n  vec3 i = dL;\n  vec3 dN = c(e);\n  float l = clamp(50.0 * waterBaseColor.g, .0, 1.);\n  vec3 dO = h(waterBaseColor.rgb, j, dot(e, dI), l);\n  return i * dO + dN;\n#else\nvec3 dP = dd(di);\n  vec3 dQ = dd(dh);\n  vec3 di = dD(dJ, dP, dQ);\n  return di;\n#endif\n}\nvec3 dR(in vec3 e, in vec3 dI, in vec3 dS, vec3 u, in vec3 dT, in vec3 dU, in float dV, float dW, vec3 dX) {\n  float dY = 0.;\n  vec3 dZ = dd(u);\n  vec3 bm = normalize(dS + dI);\n  dp.NdotL = clamp(dot(e, dS), .0, 1.);\n  dp.NdotV = clamp(dot(e, dI), .001, 1.);\n  dp.VdotN = clamp(dot(dI, e), .001, 1.);\n  dp.NdotH = clamp(dot(e, bm), .0, 1.);\n  dp.VdotH = clamp(dot(dI, bm), .0, 1.);\n  dp.LdotH = clamp(dot(dS, bm), .0, 1.);\n  float dJ = max(dot(dU, dI), .0);\n  vec3 di = dH(e, dI, dJ, j);\n  float ea = max(dot(dU, dS), .0);\n  float eb = .1 + ea * .9;\n  di *= eb;\n  float ec = clamp(dV, .8, 1.);\n  vec3 ed = cP(dp.VdotN, vec3(de[0]), de[1]);\n  vec3 ee = ed * di * ec;\n  vec3 ef = dZ * mix(di, ea * dT * cK, 2. / 3.) * ec;\n  vec3 i = vec3(.0);\n  if(dJ > .0 && ea > .0) {\n    vec3 eg = dq(dp, j, vec3(df[0]), df[1]);\n    vec3 eh = dT * cK * dV;\n    i = dp.NdotL * eh * eg;\n  }\n  vec3 cI = vec3(.0);\n  if(dJ > .0) {\n    cI = dA(dg, dW, dh, eb);\n  }\n  vec3 ei = vec3(.0);\n#ifdef HAS_SSR\nfloat ej = smoothstep(dl, dk, -dX.z);\n  mat4 ek = viewMatrix;\n  vec4 el = vec4(dX.xyz, 1.);\n  vec3 em = normalize(el.xyz);\n  vec4 en = ek * vec4(e, .0);\n  vec3 eo = normalize(en.xyz);\n  vec4 ep = ek * vec4(dU, .0);\n  float eq = pow(max(dot(-em, ep.xyz), .0), cN);\n  vec3 er = mix(ep.xyz, eo, eq);\n  vec3 es = ssr(vec3(.0), vec3(1.), j, normalize(er), -normalize(vViewVertex.xyz));\n  if(es.z > .0) {\n    vec2 et = smoothstep(.3, .6, abs(vec2(.5) - es.xy));\n    dY = dm * clamp(1. - 1.3 * et.y, .0, 1.) * ej;\n    vec3 eu = X(.0, es.xy);\n    ei = dd(eu) * dY * ed.y * dj;\n  }\n#endif\nfloat ev = mix(dn, dn * .5, dY);\n  return cZ((1. - dY) * ee + ei + ef * ev + i + cI);\n}\nvoid main() {\n  vec3 dU = bY;\n  vec4 ew = cF(vUv, timeElapsed);\n  vec3 e = normalize(vTbnMatrix * ew.xyz);\n  vec3 dI = -normalize(vPos - camPos);\n  vec3 dS = normalize(-lightDirection);\n#if defined(HAS_SHADOWING)\nfloat dV = shadow_computeShadow();\n#else\nfloat dV = 1.;\n#endif\nvec4 ex = viewMatrix * vec4(vPos, 1.);\n  vec4 ey = vec4(dR(e, dI, dS, waterBaseColor.rgb, lightColor, dU, dV, ew.w, ex.xyz), waterBaseColor.a);\n  gl_FragColor = dc(ey);\n  if(contrast != 1.) {\n    gl_FragColor = contrastMatrix(contrast) * gl_FragColor;\n  }\n  if(length(hsv) > .0) {\n    gl_FragColor = hsv_apply(gl_FragColor, hsv);\n  }\n  gl_FragColor = highlight_blendColor(gl_FragColor) * layerOpacity;\n}",defines:s,uniforms:o,extraCommandProps:h})}getUniformValues(e){return{projViewMatrix:e.projViewMatrix,minAltitude:this.layer.options.altitude||0}}pa(e,n){const{iblTexes:i,dfgLUT:o}=this.getIBLRes(),s=pZ(e,i,o,n&&n.ssr,n&&n.jitter),a=e.getLightManager();let h=a&&a.getDirectionalLight()||{};const l=a&&a.getAmbientLight()||{},c=this.getSymbol(yZ),A=this.Ma=this.Ma||[],f=this._a=this._a||[];E_(f,.09,c.uvScale||3,.03,-.5),FU(s,{ambientColor:l.color||[.2,.2,.2],viewMatrix:e.viewMatrix,lightDirection:h.direction||gZ.direction,lightColor:h.color||gZ.color,camPos:e.cameraPosition,timeElapsed:c.animation?(this.layer.getRenderer().getFrameTimestamp()||0)/(1/(c.waterSpeed||1)*1e4):0,normalTexture:this.ba||this.xa,heightTexture:this.Aa||this.xa,waveParams:f,waterDir:xZ(A,c.waterDirection||0),waterBaseColor:c.waterBaseColor||[.1451,.2588,.4863,1],contrast:c.contrast||1,hsv:c.hsv||vZ});const d=this.layer.getRenderer();return s.layerOpacity=d.Xn(),this.setIncludeUniformValues(s,n),n&&n.ssr&&n.ssr.renderUniforms&&FU(s,n.ssr.renderUniforms),s}delete(){super.delete(),this.xa&&(this.xa.destroy(),delete this.xa),this.ba&&this.ba.destroy(),this.Aa&&this.Aa.destroy(),this.shader&&(this.shader.dispose(),delete this.shader),this.ma&&this.ma.dispose(),this.ga&&(this.ga.geometry.dispose(),this.ga.material&&this.ga.material.dispose(),this.ga.dispose(),delete this.ga),this.disposeIBLTextures()}createGround(){const e=new WC;e.data.aTexCoord=new Uint8Array([0,1,1,1,0,0,1,0]),e.generateBuffers(this.renderer.regl),this.ga=new bC(e,null,{castShadow:!1}),this.ya=new kC([this.ga])}transformWater(){const e=this.getMap(),n=GroundPainter.getGroundTransform(this.ga.localTransform,e);this.ga.setLocalTransform(n);const i=e._get2DExtentAtRes(e.getGLRes()),o=i.getWidth(),s=i.getHeight(),a=e.cameraLookAt,h=(a[0]-o)/_Z[0],l=(a[1]+s)/_Z[1],c=h*mZ%1,A=l*mZ%1,f=o/_Z[0]*2,d=s/_Z[1]*2;this.ga.setUniform("uvOffset",[h%1,l%1]),this.ga.setUniform("noiseUvOffset",[c,A]),this.ga.setUniform("uvScale",[f,-d])}}function xZ(e,n){return n=Math.PI*n/180,e[0]=Math.sin(n),e[1]=Math.cos(n),e}const bZ=CG("fill",zl);bZ.registerAt(Ta);const wZ=CG("line",jl);wZ.registerAt(Ta);const CZ=CG("line-gradient",Gl);CZ.registerAt(Ta);const PZ=CG("icon",YW);PZ.registerAt(Ta);const MZ=CG("text",sc);MZ.registerAt(Ta);const TZ=CG("native-line",dc);TZ.registerAt(Ta),CG("native-point",uc).registerAt(Ta);const SZ=CG("phong",kc);SZ.registerAt(Ta);const IZ=CG("wireframe",Tc);IZ.registerAt(Ta);const EZ=CG("lit",Fc);EZ.registerAt(Ta);const OZ=CG("tube",Ec);OZ.registerAt(Ta);const RZ=CG("gltf-phong",Xc);RZ.registerAt(Ta);const DZ=CG("gltf-lit",Yc);DZ.registerAt(Ta);const kZ=CG("heatmap",class extends Sl{createFnTypeConfig(e,n){const i=RD(n.heatmapWeight),o=new Int16Array(1);return[{attrName:"aWeight",symbolName:"heatmapWeight",type:Int16Array,width:1,define:"HAS_HEAT_WEIGHT",evaluate:n=>{const s=i(e.getZoom(),n);return o[0]=255*s,o[0]}}]}createMesh(e,n){const{geometry:i,symbolIndex:o,ref:s}=e;void 0===s&&SG(i,this.getSymbolDef(o),this.getFnTypeConfig(o),this.layer);const a=this.getSymbol(o),h={tileRatio:i.properties.tileRatio,dataResolution:i.properties.tileResolution};jU(h,"heatmapIntensity",a,"heatmapIntensity",1),jU(h,"heatmapRadius",a,"heatmapRadius",6),jU(h,"heatmapWeight",a,"heatmapWeight",1),jU(h,"heatmapOpacity",a,"heatmapOpacity",1),i.generateBuffers(this.regl);const l=new cC(h),c=new bC(i,l,{transparent:!0,castShadow:!1,picking:!0}),A={};return i.data.aWeight&&(A.HAS_HEAT_WEIGHT=1),c.setDefines(A),c.setLocalTransform(n),c.properties.symbolIndex=o,c}callRenderer(e,n,i){const o=this.getRenderFBO(i);this.Xi+=this.Sa.render(this.scene,n,o)}getUniformValues(e){const n=this.getSymbol({index:0}),{projViewMatrix:i}=e;return{glScale:1/e.getGLScale(),resolution:e.getResolution(),projViewMatrix:i,heatmapOpacity:n.heatmapOpacity}}getHeatmapMeshes(){return this.scene.getMeshes()}delete(){super.delete(...arguments),this.Sa.dispose(),delete this.Sa}init(){this.renderer=new PC(this.regl);const e=this.getPolygonOffset(),n=this.getSymbols()[0];this.Sa=new HeatmapProcess(this.regl,this.sceneConfig,this.layer,n.heatmapColor,null,e)}});kZ.registerAt(Ta);const LZ=CG("water",ef);LZ.registerAt(Ta),La.registerPainter("lit",Fc),La.registerPainter("icon",YW),La.registerPainter("fill",zl),La.registerPainter("line",jl),La.registerPainter("line-gradient",Gl),La.registerPainter("water",ef),La.registerPainter("tube",Ec);class vf extends Ta{getTileUrl(e,n,i){const o=this.getMap().getResolution(i);return super.getTileUrl(e,n,function(e){return 19-Math.log(e/FZ)/Math.LN2}(o))}static fromJSON(e){return e&&"MapboxVectorTileLayer"===e.type?new vf(e.id,e.options):null}}vf.registerJSONType("MapboxVectorTileLayer");const FZ=12756274*Math.PI/(256*Math.pow(2,20));class bf extends Ta{constructor(e,n){(n=n||{}).spatialReference=null,super(e,n),this.setData(n.data)}onAdd(){this.Jn()}Jn(){const e=this.getMap(),n=e.getMaxNativeZoom(),i=e.getProjection(),o="EPSG:4326"===i.code||"EPSG:4490"===i.code;var s;o&&(this.options.tileSystem=[1,-1,-180,90]),this.options.spatialReference=o?function(e,n){return{projection:n,fullExtent:{top:90,left:-180,bottom:-90,right:180},resolutions:function(){const n=[];for(let i=0;i<=e+1;i++)n[i]=90/(128*Math.pow(2,i));return n}()}}(n,i.code):(s=n,{projection:"EPSG:3857",resolutions:function(){const e=[],n=6378137*Math.PI;for(let i=0;i<=s+1;i++)e[i]=n/(256*Math.pow(2,i));return e}(),fullExtent:{top:6378137*Math.PI,left:-6378137*Math.PI,bottom:-6378137*Math.PI,right:6378137*Math.PI}})}getWorkerOptions(){const e=super.getWorkerOptions();let n=this.options.data;return oU(n)||n&&n.url?(n.url&&(n=JSON.parse(JSON.stringify(n))),n=zZ(n,this.getURLModifier())):n=this.features,e.data=n,e.tileBuffer=this.options.tileBuffer,e.extent=this.options.extent,e.hasAltitude=this.options.enableAltitude,e.simplifyTolerance=this.options.simplifyTolerance,e.projection=this.getSpatialReference().getProjection().code,e.generateOMBB=this.options.generateOMBB,e.convertFn=this.options.convertFn?this.options.convertFn+"":null,e}setData(e){return this.options.data=e,e&&(oU(e)||e.url)?(!!this.getRenderer()&&this.ka(),this):(this.Pa(e),this.ka(),this)}Pa(e){return this.options.convertFn&&(e=new Function("data",this.options.convertFn+"\nreturn convert(data)")(e)),this.features=e,this.Ta(),this}ka(){const e=this.getRenderer();if(e){const n=e.getWorkerConnection();if(n){let i=this.options.data;oU(i)||i&&i.url?(i.url&&(i=JSON.parse(JSON.stringify(i))),i=zZ(i,this.getURLModifier())):i=this.features,n.setData(i,((n,i)=>{e.clear(),this.onWorkerReady(null,i),e.setToRedraw(),setTimeout((()=>{e.setToRedraw()}),500)}))}}}getExtent(){return this.Ia}onWorkerReady(e,n){e?this.fire("dataerror",{error:e}):(n&&(n.extent&&this.Fa(n.extent),n.idMap&&(this.Ca=n.idMap)),this.fire("dataload",{extent:n&&n.extent}))}Fa(e){this.Ia=new al(...e)}Oa(e,n){oU(e)?gU.getJSON(e,n):gU.getJSON(e.url,e,n)}getData(){return this.features||null}getTileUrl(e,n,i){return this.getId()+","+e+","+n+","+i}getFeature(e){return this.Ca[e]}static fromJSON(e){return e&&"GeoJSONVectorTileLayer"===e.type?new bf(e.id,e.options):null}getGeometryById(e){return this.Ca?this.Ca[e]:null}Ta(){if(!this.features)return;if(this.features=JSON.parse(JSON.stringify(this.features)),!this.features)return;let e=0;this.Ca={};const n=this.options.featureIdProperty,i=this.features;Array.isArray(i)?i.forEach((i=>{if(i){if(sU(i.id)||(i.id=e++),n){let e=n;hU(n)&&(e=n[i.layer||"0"]),i.id=i.properties[e]}this.Ca[i.id]=i}})):i.features&&i.features.forEach((i=>{if(i){if(sU(i.id)||(i.id=e++),n){let e=n;hU(n)&&(e=n[i.layer||"0"]),i.id=i.properties[e]}this.Ca[i.id]=i}}))}}function NZ(e){let n=document.createElement("a");return n.href=e,e=n.href,n=null,e}function zZ(e,n){return e.url?e.url=n?n(e.url):NZ(e.url):e=n?n(e):NZ(e),e}bf.registerJSONType("GeoJSONVectorTileLayer"),bf.mergeOptions({features:"id",tileBuffer:64,extent:8192,pyramidMode:1,simplifyTolerance:3,tileStackDepth:0,generateOMBB:!0});const BZ={markerFile:{type:"identity",default:null,property:"_symbol_markerFile"},markerWidth:{type:"identity",default:null,property:"_symbol_markerWidth"},markerHeight:{type:"identity",default:null,property:"_symbol_markerHeight"},markerPathWidth:{type:"identity",default:20,property:"_symbol_markerPathWidth"},markerPathHeight:{type:"identity",default:20,property:"_symbol_markerPathHeight"},markerDx:{type:"identity",default:null,property:"_symbol_markerDx"},markerDy:{type:"identity",default:null,property:"_symbol_markerDy"},markerType:{type:"identity",default:null,property:"_symbol_markerType"},markerPath:{type:"identity",default:null,property:"_symbol_markerPath"},markerFill:{type:"identity",default:null,property:"_symbol_markerFill"},markerFillPatternFile:{type:"identity",default:null,property:"_symbol_markerFillPatternFile"},markerFillOpacity:{type:"identity",default:null,property:"_symbol_markerFillOpacity"},markerLineColor:{type:"identity",default:null,property:"_symbol_markerLineColor"},markerLineWidth:{type:"identity",default:null,property:"_symbol_markerLineWidth"},markerLineOpacity:{type:"identity",default:null,property:"_symbol_markerLineOpacity"},markerLineDasharray:{type:"identity",default:null,property:"_symbol_markerLineDasharray"},markerLinePatternFile:{type:"identity",default:null,property:"_symbol_markerLinePatternFile"},markerVerticalAlignment:{type:"identity",default:"top",property:"_symbol_markerVerticalAlignment"},markerHorizontalAlignment:{type:"identity",default:"middle",property:"_symbol_markerHorizontalAlignment"},markerOpacity:{type:"identity",default:1,property:"_symbol_markerOpacity"},markerPitchAlignment:{type:"identity",default:"viewport",property:"_symbol_markerPitchAlignment"},markerRotationAlignment:{type:"identity",default:"viewport",property:"_symbol_markerRotationAlignment"},markerRotation:{type:"identity",default:0,property:"_symbol_markerRotation"},markerAllowOverlap:{type:"identity",default:0,property:"_symbol_markerAllowOverlap"},markerIgnorePlacement:{type:"identity",default:0,property:"_symbol_markerIgnorePlacement"},markerTextFit:{type:"identity",default:null,property:"_symbol_markerTextFit"},markerSpacing:{type:"identity",default:250,property:"_symbol_markerSpacing"},markerTextFitPadding:{type:"identity",default:null,property:"_symbol_markerTextFitPadding"},markerPlacement:{type:"identity",default:"point",property:"_symbol_markerPlacement"}},HZ={textName:{type:"identity",default:null,property:"_symbol_textName"},textFaceName:{type:"identity",default:null,property:"_symbol_textFaceName"},textWrapWidth:{type:"identity",default:null,property:"_symbol_textWrapWidth"},textHorizontalAlignment:{type:"identity",default:null,property:"_symbol_textHorizontalAlignment"},textVerticalAlignment:{type:"identity",default:null,property:"_symbol_textVerticalAlignment"},textFill:{type:"identity",default:null,property:"_symbol_textFill"},textSize:{type:"identity",default:null,property:"_symbol_textSize"},textHaloRadius:{type:"identity",default:null,property:"_symbol_textHaloRadius"},textHaloFill:{type:"identity",default:null,property:"_symbol_textHaloFill"},textHaloOpacity:{type:"identity",default:1,property:"_symbol_textHaloOpacity"},textDx:{type:"identity",default:0,property:"_symbol_textDx"},textDy:{type:"identity",default:0,property:"_symbol_textDy"},textOpacity:{type:"identity",default:1,property:"_symbol_textOpacity"},textPitchAlignment:{type:"identity",default:"viewport",property:"_symbol_textPitchAlignment"},textRotationAlignment:{type:"identity",default:"viewport",property:"_symbol_textRotationAlignment"},textRotation:{type:"identity",default:0,property:"_symbol_textRotation"},textAllowOverlap:{type:"identity",default:0,property:"_symbol_textAllowOverlap"},textIgnorePlacement:{type:"identity",default:0,property:"_symbol_textIgnorePlacement"},textSpacing:{type:"identity",default:250,property:"_symbol_textSpacing"},textPlacement:{type:"identity",default:"point",property:"_symbol_textPlacement"}},jZ={lineWidth:{type:"identity",default:2,property:"_symbol_lineWidth"},lineStrokeWidth:{type:"identity",default:0,property:"_symbol_lineStrokeWidth"},lineColor:{type:"identity",default:[1,1,1,1],property:"_symbol_lineColor"},lineStrokeColor:{type:"identity",default:[0,0,0,0],property:"_symbol_lineStrokeColor"},lineDx:{type:"identity",default:0,property:"_symbol_lineDx"},lineDy:{type:"identity",default:0,property:"_symbol_lineDy"},linePatternFile:{type:"identity",default:null,property:"_symbol_linePatternFile"},linePatternAnimSpeed:{type:"identity",default:0,property:"_symbol_linePatternAnimSpeed"},linePatternGap:{type:"identity",default:0,property:"_symbol_linePatternGap"},lineOpacity:{type:"identity",default:1,property:"_symbol_lineOpacity"},lineJoin:{type:"identity",default:null,property:"_symbol_lineJoin"},lineCap:{type:"identity",default:null,property:"_symbol_lineCap"},lineDasharray:{type:"identity",default:null,property:"_symbol_lineDasharray"},lineDashColor:{type:"identity",default:null,property:"_symbol_lineDashColor"}},UZ="_line_gradient_property",GZ=new ee(0,0),VZ="_vector3dlayer_id",WZ=(UZ+"").trim();function qZ(e,n,i){const o=(PU+"").trim(),s=e.getMap(),a=s.getGLRes();let h=e.getCoordinates();const l=[],c=[];let A=1;if(e instanceof pf||e instanceof Cf){e instanceof pf&&(h=[h]);for(let e=0;e<h.length;e++)s.coordToPointAtRes(h[e],a,GZ),l.push([GZ.x,GZ.y,h[e].z||0]),c.push([h[e].x,h[e].y])}else if(e instanceof mf||e instanceof Mf){A=2,e instanceof mf&&(h=[h]);for(let e=0;e<h.length;e++){l[e]=[],c[e]=[];for(let n=0;n<h[e].length;n++)s.coordToPointAtRes(h[e][n],a,GZ),l[e].push([GZ.x,GZ.y,h[e][n].z||0]),c[e].push([h[e][n].x,h[e][n].y])}}else if(e instanceof Af||e instanceof Tf){A=3,e instanceof Df||e instanceof Ff||e instanceof Lf||e instanceof Nf?h=[[e.getShell()]]:e instanceof Af&&(h=[h]);let n=0;for(let e=0;e<h.length;e++){let i=!1;for(let o=0;o<h[e].length;o++){if(l[n]=[],c[n]=[],i)for(let i=h[e][o].length-1;i>=0;i--)s.coordToPointAtRes(h[e][o][i],a,GZ),l[n].push([GZ.x,GZ.y,h[e][o][i].z||0]),c[n].push([h[e][o][i].x,h[e][o][i].y]);else for(let i=0;i<h[e][o].length;i++)s.coordToPointAtRes(h[e][o][i],a,GZ),l[n].push([GZ.x,GZ.y,h[e][o][i].z||0]),c[n].push([h[e][o][i].x,h[e][o][i].y]);0===o&&(i=gF(l[n])<0,i&&(l[n]=l[n].reverse(),c[n]=c[n].reverse())),n++}}}const f=e.getProperties()?Object.assign({},e.getProperties()):{},d=e._getInternalSymbol()||function(e){return e instanceof pf||e instanceof Cf?{markerType:"ellipse",markerWidth:8,markerHeight:0,markerFill:"#000"}:e instanceof mf||e instanceof Mf?{lineColor:"#000",lineWidth:1}:e instanceof Af||e instanceof Tf?{polygonFill:"#fff",lineColor:"#000",lineWidth:1}:void 0}(e),p=i?Array.isArray(i)?i[0].id:i.id:n.id++;if(Array.isArray(d)&&d.length){const s=[],a=d.length;for(let h=0;h<a;h++){const g=h===a-1?f:rU({},f),v=ZZ(d[h],g);for(const e in d[h])AU(d[h],e)&&(g[("_symbol_"+e).trim()]=d[h][e]);v&&(d[h].lineGradientProperty=v);const w=i&&i[h]?i[h][o]:n.pickingId++,C={type:A,id:p,properties:g,visible:e.isVisible(),geometry:l,coordinates:c,extent:1/0};C[o]=w,s.push(C)}return s}if(d){const e=ZZ(d,f);for(const e in d)AU(d,e)&&(f[("_symbol_"+e).trim()]=d[e]);e&&(d.lineGradientProperty=e)}const g=i?i.id:n.pickingId++,v={type:A,id:p,properties:f,visible:e.isVisible(),geometry:l,coordinates:c,extent:1/0};return v[o]=g,v}function ZZ(e,n){const i=e.lineGradientProperty;return i&&(n[WZ]=n[i],n.mapbox_clip_start=0,n.mapbox_clip_end=1,delete n[i]),i}let QZ=!1,XZ=1;const YZ="_symbol_".trim(),JZ=(PU+"").trim();let KZ=new Float32Array(1);const $Z=[];class zf extends Mm.CanvasRenderer{constructor(...e){super(...e),this.features={},this.Ea={},this.we=0,this.Da={},this.La={},this.Ra={},this.Ha={},this.za={},this.Na=!0,this.Va={id:0,pickingId:0},this.Ua={}}setURLModifier(e){this.qn=e}getURLModifier(){return this.qn}needToRedraw(){return super.needToRedraw()||this.painter&&this.painter.needToRedraw()||this.ja&&this.ja.needToRedraw()||this.Ga&&this.Ga.needToRedraw()}getAnalysisMeshes(){return this.painter&&this.painter.getAnalysisMeshes()||$Z}getRayCastData(){return null}draw(e,n){this.en=e;const i=this.layer;this.prepareCanvas(),this.nn=this.rn(this.getMap().getGLRes()),this.sn=n||{};const o=this.sn.renderMode,s=this.Ba();if(this.an(s,o),this.Na)this.buildMesh(),this.$a(),this.Wa(),this.Ua={},this.Xa=!1,this.Na=!1,this.Ya=!1;else if(this.Xa){const e=this.atlas,n=this.qa,i=this.Ja;delete this.atlas,delete this.qa,delete this.Ja,this.buildMesh(e),this.$a(n),this.Wa(i),this.Xa=!1,this.Ya=!1}else if(this.Ya){const e=this.Ja;delete this.Ja,this.Wa(e),this.Ya=!1}if(!this.meshes&&!this.Ka&&!this.Za)return void this.completeRender();this.Qa&&(this.el(),this.Qa=!1),this.nl();const a=!o||"default"===o;let h=0;0===this.layer.options.meshRenderOrder&&this.il(s,h,o);let l=0;if(this.Za&&(a||this.Ga.supportRenderMode(o))){this.Ga.startFrame(s),this.Ga.addMesh(this.Za,null,{bloom:this.sn.bloom}),this.Ga.prepareRender(s);const e=s.polygonOffsetIndex||0;h=this.meshes&&this.meshes.length?h-1:h,s.polygonOffsetIndex=(s.polygonOffsetIndex||0)+h,l=this.Ga.render(s).drawCount,s.polygonOffsetIndex=e}if(1===this.layer.options.meshRenderOrder&&this.il(s,l?h-1:h,o),this.Ka&&(a||this.ja.supportRenderMode(o))){const n=!this.sn.timestamp||this.sn.isFinalRender,o=!this.rl||this.rl!==e;i.options.collision&&o&&i.clearCollisionIndex();const a=this.layer.options.sceneConfig;this.ja.sceneConfig.collision=!a||!!lU(a.collision)||a.collision,this.ja.startFrame(s),this.ja.addMesh(this.Ka,null,{bloom:this.sn.bloom}),this.ja.prepareRender(s),i.options.collision&&o&&(this.ja.updateCollision(s),n&&(this.rl=e)),this.ja.render(s)}(a||n&&n.isFinalRender)&&(this.completeRender(),this.layer.fire("canvasisdirty"))}an(e,n){this.painter&&(!n||"default"===n||this.painter.supportRenderMode(n))&&this.painter.startFrame(e)}il(e,n,i){return this.painter&&this.meshes&&(!i||"default"===i||this.painter.supportRenderMode(i))?(this.painter.addMesh(this.meshes,null,{bloom:e&&e.bloom}),this.painter.prepareRender(e),e.polygonOffsetIndex=(e.polygonOffsetIndex||0)+n,this.painter.render(e)):{redraw:!1,drawCount:0}}supportRenderMode(){return!0}isForeground(){return!0}Ba(){const e={regl:this.regl,layer:this.layer,symbol:this.sl,gl:this.gl,sceneConfig:this.layer.options.sceneConfig,pluginIndex:0,cameraPosition:this.getMap().cameraPosition,timestamp:this.getFrameTimestamp()};return this.sn&&rU(e,this.sn),e}drawOnInteracting(e,n,i){this.draw(n,i)}getFrameTimestamp(){return this.en}ol(e,n){(e=e||n)===n&&(n=null);const i=[],o=[0,0,0,0];this.layer._sortGeometries();const s=this.layer.getGeometries();for(let a=0;a<s.length;a++){const h=s[a][VZ];if(!this.features[h])continue;const l=this.features[h];if(Array.isArray(l))for(let s=0;s<l.length;s++){const a=l[s],h=a[JZ];(!e||e[h]||n&&(!n||n[h]))&&(a.visible||(this.Qa=!0),this.al(a.geometry,o,a.coordinates),i.push(a))}else{l.visible||(this.Qa=!0);const s=l[JZ];if(e&&!e[s]&&(!n||n&&!n[s]))continue;this.al(l.geometry,o,l.coordinates),i.push(l)}}if(i.length||(this.meshes&&this.painter&&(this.painter.deleteMesh(this.meshes),delete this.meshes),this.Ka&&(this.ja.deleteMesh(this.Ka),delete this.Ka),this.Za&&(this.Ga.deleteMesh(this.Za),delete this.Za)),o[3]&&(o[0]/=o[3],o[1]/=o[3]),isNaN(o[0])||isNaN(o[1]))throw new Error(`invalid geometry coordinates for ${this.layer.getJSONType()}`);return{features:i,center:o}}buildMesh(){}createVectorPacks(e,n,i,o,s,a){return e&&o&&o.length?new n(o,i,{zoom:this.getMap().getZoom(),EXTENT:1/0,requestor:this.requestor,atlas:s,center:a,positionType:Float32Array}).load():Promise.resolve(null)}createMesh(e,n,i,o,s,a){return this.createVectorPacks(e,n,i,o,s,a).then((h=>this.ll(h,e,n,i,o,s,a)))}ll(e,n,i,o,s,a,h){if(!e)return null;const l=n.createGeometries([e.data],EU(s,null,0,o,this.layer));for(let e=0;e<l.length;e++)l[e]&&this.Ci(l[e].geometry);const c=xv([]);Pv(c,c,$v([],h[0],h[1],0)),Mv(c,c,$v([],1,1,this.nn));const A=n.createMeshes(l,c,{tilePoint:[h[0],h[1]]});for(let e=0;e<A.length;e++){const n=A[e];n.properties.level=0,n.properties.tileTransform=c;const i=n.defines;i.ENABLE_TILE_STENCIL=1,n.setDefines(i),n.properties.meshKey=this.layer.getId()}return{meshes:A,atlas:{iconAtlas:e.data.iconAtlas}}}al(e,n,i){for(let o=0;o<e.length;o++)if(Array.isArray(e[o][0]))for(let s=0;s<e[o].length;s++)if(Array.isArray(e[o][s][0]))for(let a=0;a<e[o][s].length;a++)isNaN(+e[o][s][a][0])||isNaN(+e[o][s][a][1])||this.hl(n,e[o][s][a][0],e[o][s][a][1],e[o][s][a][2],1,i[o][s][a]);else isNaN(+e[o][s][0])||isNaN(+e[o][s][1])||this.hl(n,e[o][s][0],e[o][s][1],e[o][s][2],1,i[o][s]);else isNaN(+e[o][0])||isNaN(+e[o][1])||this.hl(n,e[o][0],e[o][1],e[o][2],1,i[o])}hl(e,n,i,o,s,a){const h=this.getMap().getProjection().isSphere();let l=!1;(a[0]>180||a[0]<-180)&&(l=!0,h&&!QZ&&(QZ=!0,console.warn(`Layer(${this.layer.getId()}) has invalid longitude value: ${a[0]}`))),(a[1]>90||a[1]<-90)&&(l=!0,h&&!QZ&&(QZ=!0,console.warn(`Layer(${this.layer.getId()}) has invalid latitude value: ${a[1]}`))),l||(e[0]+=n,e[1]+=i,e[2]+=o||0,e[3]+=s)}Ci(e){const n=this.getMap().getGLRes(),i=e.properties;i.tileResolution=n,i.tileRatio=1,i.z=1,i.tileExtent=1,i.elements=e.elements,i.aPickingId=e.data.aPickingId}ul(e){return"win-intel-gpu-crash"===e&&this.layer.options.workarounds["win-intel-gpu-crash"]&&eQ(this.gl)}prepareRequestors(){if(this.re)return;const e=this.layer;this.re=new Wj({iconErrorUrl:e.options.iconErrorUrl,urlModifier:n=>{const i=e.getURLModifier();return i&&i(n)||n}});const n=!this.ul("win-intel-gpu-crash");this.se=new Gj((n=>{e.getMap().getRenderer().callInNextFrame(n)}),e.options.glyphSdfLimitPerFrame,n),this.requestor=this.cl.bind(this),this.fl=this.dl.bind(this)}cl(e,n,i){const o=[];this.re.getIcons(e,((e,n)=>{if(e)throw e;n.buffers&&o.push(...n.buffers),i(null,{icons:n.icons},o)}))}dl(e,n,i){this.se.getGlyphs(n,((n,o)=>{if(n)throw n;const s=o.buffers||[];this.re.getIcons(e,((e,n)=>{if(e)throw e;n.buffers&&n.buffers.length&&s.push(...n.buffers),i(null,{icons:n.icons,glyphs:o.glyphs},s)}))}))}$a(e){const n=Object.keys(this.Ra),i=Object.keys(this.Ha);if(!n.length&&!i.length)return void(this.Ka&&(this.ja.deleteMesh(this.Ka),delete this.Ka));const{features:o,center:s}=this.ol(this.Ra,this.Ha),a=[],h=[];for(let e=0;e<o.length;e++){const n=o[e][JZ];this.Ra[n]&&a.push(o[e]),this.Ha[n]&&h.push(o[e])}if(!a.length&&!h.length)return void(this.Ka&&(this.ja.deleteMesh(this.Ka),delete this.Ka));const l=this.Qa;this.pl=s;const c=this.ml(a,h,e,s);this.qa={};const A=[],f=[];this.yl=!0,Promise.all(c).then((e=>{if(this.Ka&&(this.ja.deleteMesh(this.Ka),delete this.Ka),!e||!e.length)return void this.setToRedraw();const n=this.ja.createGeometries(e.map((e=>(e&&e.data&&(e.data.isIdUnique=!0),e&&e.data))),this.Da);for(let i=0;i<n.length;i++)this.Ci(n[i].geometry,e[i]&&e[i].data);const i=e[0]&&e[0].data.iconAtlas,o=e[0]&&e[0].data.glyphAtlas||e[1]&&e[1].data.glyphAtlas;i&&(this.qa.iconAtlas=i),o&&(this.qa.glyphAtlas=o);const a=xv([]);Pv(a,a,$v(f,s[0],s[1],0)),Mv(a,a,$v(A,1,1,this.nn));const h=this.ja.createMeshes(n,a);for(let e=0;e<h.length;e++)h[e].geometry.properties.originElements=h[e].geometry.properties.elements.slice(),h[e].properties.level=0,h[e].material.set("flipY",1),h[e].properties.meshKey=XZ++;this.Ka=h,l&&(this.Qa=!0),this.yl=!1,this.setToRedraw(),this.layer.fire("buildmarkermesh")}))}el(){if(this.Ka&&(this.vl(this.Ka[0],this.Ra),this.vl(this.Ka[1],this.Ha),this.Ka[0]&&this.ja.prepareCollideIndex(this.Ka[0].geometry),this.Ka[1]&&this.ja.prepareCollideIndex(this.Ka[1].geometry)),this.Za)for(let e=0;e<this.Za.length;e++)this.vl(this.Za[e],this.za);if(this.meshes)for(let e=0;e<this.meshes.length;e++)this.vl(this.meshes[e],this.Da)}vl(e,n){if(!e)return;const{aPickingId:i,originElements:o}=e.geometry.properties,s=[];for(let e=0;e<o.length;e++){const a=i[o[e]];n[a]&&n[a].feature.visible&&s.push(o[e])}const a=e.geometry.properties.elements=new o.constructor(s);e.geometry.setElements(a)}ml(e,n,i,o){const s={zoom:this.getMap().getZoom(),EXTENT:1/0,requestor:this.fl,atlas:i,center:o,positionType:Float32Array,defaultAltitude:0,forceAltitudeAttribute:!0,markerWidthType:Uint16Array,markerHeightType:Uint16Array},a=rU({},s);return s.allowEmptyPack=1,dj.splitPointSymbol(this.xl).map(((i,o)=>new dj(0===o?e:n,i,0===o?s:a).load()))}updateMesh(){}wl(e){const n=e._getInternalSymbol(),i={zoom:this.getMap().getZoom(),isVector3D:!0},o=this.Al(e);if(!this.Ka)return!1;let s=this.features[o];Array.isArray(s)||(s=[s]);const a=[],h=[],l=[],c=this.getMap().getZoom();let A,f;A=Array.isArray(n)?n.map((e=>e?kD(e,(()=>(a[0]=c,a))):e)):kD(n,(()=>(a[0]=c,a))),f=Array.isArray(n)?n.map((e=>e?mH.genFnTypes(e):e)):mH.genFnTypes(n);for(let e=0;e<s.length;e++){if(!s[e])continue;const o=Array.isArray(n)?n[e]:n,a=Array.isArray(A)?A[e]:A,h=Array.isArray(f)?f[e]:f,l=new XH(s,o,a,h,i).getIconAndGlyph();if(!this.qa||!dj.isAtlasLoaded(l,this.qa))return this.Ml(),this.setToRedraw(),!1}for(let e=0;e<s.length;e++){const n=s[e][JZ];this.Ra[n]&&h.push(s[e]),this.Ha[n]&&l.push(s[e])}const d=s[0].id,p=this.ml(h,l,this.qa,this.pl),g=this.Ka;return Promise.all(p).then((e=>{for(let n=0;n<e.length;n++){if(!e[n])continue;e[n].data&&(e[n].data.isIdUnique=!0);const i=g[n],o=i.geometry.properties.aFeaIds.indexOf(d);if(o<0)continue;const s=e[n].data.featureIds.length,a=e[n].data.dynamicAttributes;for(const h in e[n].data.data){if("aPickingId"===h)continue;if(a[h])continue;const l=e[n].data.data[h];l&&i.geometry.updateSubData(h,l,o*l.length/s)}}this.setToRedraw()})),!0}_l(e){return this.Sl(e,this.Za,this.Ja,this.kl,this.Ga,xj,jZ,this.Pl)}Sl(e,n,i,o,s,a,h,l){if(!n)return!1;if(!i)return this.Ml(),this.setToRedraw(),!1;const c=e._getInternalSymbol(),A={zoom:this.getMap().getZoom()};let f=this.features[e[VZ]];Array.isArray(f)||(f=[f]);const d=[];for(let e=0;e<f.length;e++){const n=f[e];if(!n)continue;const o=Array.isArray(c)?c[e]:c,s=mH.genFnTypes(o),h=new VF(f,o,s,A),l=a===xj?h.getLineResource():h.getPolygonResource();if(!mH.isAtlasLoaded(l,i[e]))return this.Ml(),this.setToRedraw(),!1;d.push(n)}const p=f[0].id,g=l.call(this,d);for(let e=0;e<g.length;e++)if(g[e].length){const i=n.filter((n=>n.feaGroupIndex===e));if(!i.length)return this.Ml(),this.setToRedraw(),!1;if(i[0].geometry.properties.aFeaIds.indexOf(p)<0)return this.Ml(),this.setToRedraw(),!1}const v=rU({},h),w=g.map((e=>this.createVectorPacks(s,a,v,e,i[0],o)));return Promise.all(w).then((e=>{for(let i=0;i<e.length;i++){let o;if(Array.isArray(n)){for(let e=0;e<n.length;e++)if(n[e].feaGroupIndex===i){o=n[e];break}}else o=n;o&&this.Tl(o,p,e[i])}})),!0}Tl(e,n,i){const o=e.geometry.properties.aFeaIds,s=o.indexOf(n);if(!(s<0)){if(i){const n=i.data.dynamicAttributes,o=i.data.featureIds.length,a=i.data.data;for(const i in a)if(!n[i]&&AU(a,i)&&a[i]){const n=a[i];e.geometry.updateSubData(i,n,s*n.length/o)}}else{let i=s+1;for(;o[i]===n;)i++;const a=i-s,h=e.geometry.desc.positionSize;KZ.length!==3*a&&(KZ=new Float32Array(a*h),KZ.fill(-1/0,0)),e.geometry.updateSubData(e.geometry.desc.positionAttribute,KZ,s*h)}this.layer.fire("updatemesh"),this.setToRedraw()}}Wa(e){if(!Object.keys(this.za).length)return void(this.Za&&(this.Ga.deleteMesh(this.Za),delete this.Za));const{features:n,center:i}=this.ol(this.za);if(!n.length)return;const o=this.Qa;this.kl=i;const s=this.Pl(n),a=rU({},jZ),h=s.map(((n,o)=>this.createMesh(this.Ga,xj,a,n,e&&e[o],i)));this.Il=!0,Promise.all(h).then((e=>{this.Za&&this.Ga.deleteMesh(this.Za);const n=[],i=[];for(let o=0;o<e.length;o++){const s=e[o]&&e[o].meshes;if(s){for(let e=0;e<s.length;e++){const i=s[e];i.feaGroupIndex=o,n.push(i),i.geometry.properties.originElements=i.geometry.properties.elements.slice()}i[o]=e[o].atlas}}this.Za=n,this.Ja=i,o&&(this.Qa=o),this.Il=!1,this.setToRedraw(),this.layer.fire("buildlinemesh")}))}Pl(e){const n=(YZ+"lineDasharray").trim(),i=(YZ+"linePatternFile").trim(),o=[],s=[],a=[];for(let h=0;h<e.length;h++){const l=e[h],c=l.properties&&l.properties[n];c&&aQ(c)?a.push(l):l.properties&&l.properties[i]?s.push(l):o.push(l)}return[o,s,a]}Fl(){this.Xa=!0,this.setToRedraw()}Ml(){this.Na=!0,this.setToRedraw()}Cl(e){const n=this.layer.getId();for(let i=0;i<e.length;i++){const o=e[i];let s=!1;for(let e=0;e<this.GeometryTypes.length;e++)if(o instanceof this.GeometryTypes[e]){s=!0;break}if(!s)throw new Error(`${o.getJSONType()} can't be added to ${this.layer.getJSONType()}(id:${n}).`);this.Al(o)}}Al(e){void 0===e[VZ]&&(e[VZ]=this.we++);const n=e[VZ];this.features[n]&&this.Ol(n),this.features[n]=qZ(e,this.Va,this.features[n]);return this.El(this.features[n],n),this.Ea[n]=e,n}El(e,n){if(!e)return;const i=Array.isArray(e)?e[0].id:e.id;if(this.La[i]=e,Array.isArray(e))for(let i=0;i<e.length;i++){const o=e[i][JZ];if(e[i][VZ]=n,this.Da[o]={feature:e[i]},this.Da[o][VZ]=n,!this.needCheckPointLineSymbols())continue;const s={feature:e[i]};(nQ(e[i])||iQ(e[i]))&&(this.Ra[o]=s),iQ(e[i])&&(this.Ha[o]=s),sQ(e[i])&&(this.za[o]=s)}else{e[VZ]=n;const i={feature:e},o=e[JZ];if(this.Da[o]=i,!this.needCheckPointLineSymbols())return;(nQ(e)||iQ(e))&&(this.Ra[o]=i),iQ(e)&&(this.Ha[o]=i),sQ(e)&&(this.za[o]=i)}}needCheckPointLineSymbols(){return!0}Ol(e){const n=this.features[e];if(n)if(Array.isArray(n))for(let e=0;e<n.length;e++){const i=n[e][JZ];delete this.La[n[e].id],delete this.Da[i],delete this.Ra[i],delete this.Ha[i],delete this.za[i]}else{const e=n[JZ];delete this.La[n.id],delete this.Da[e],delete this.Ra[e],delete this.Ha[e],delete this.za[e]}}pick(e,n,i){const o=[];return this.layer.isVisible()?([this.painter,this.ja,this.Ga].forEach((s=>{if(!s)return;const a=s.pick(e,n,i.tolerance);if(a&&a.data&&a.data.feature){const e=this.Ea[a.data.feature[VZ]];i&&i.includeInternals?o.push(e):(a.geometry=e,delete a.plugin,delete a.data,delete a.point,o.push(a))}})),o):o}Dl(e){const n=this.features[e[VZ]];return Array.isArray(n)?n[0][JZ]:n[JZ]}nl(){let e=!1;for(const n in this.Ua){const i=this.Ua[n],o=this.Dl(i);if(!this.yl&&(this.Ra[o]||this.Ha[o])){const n=this.wl(i);e=e||n}if(!this.Il&&this.za[o]){const n=this._l(i);e=e||n}if(!this.Ll){const n=this.updateMesh(i);e=e||n}}this.Ua={},e&&(tQ(this),this.layer.fire("partialupdate"))}Rl(e){this.Al(e),this.Ml(),tQ(this)}onGeometryAdd(e){this.setToRedraw(),this.canvas&&e&&e.length&&(this.Cl(e),this.Ml(),tQ(this))}onGeometryRemove(e){if(e&&e.length){for(let n=0;n<e.length;n++){const i=e[n][VZ];void 0!==i&&(delete this.Ea[i],this.Ol(i),delete this.features[i])}this.Ml(),tQ(this)}}onGeometrySymbolChange(e){const n=e.target._getParent()||e.target,i=n[VZ];if(void 0===i)return;let o=e.properties;if(Array.isArray(o)){const e={};for(let n=0;n<o.length;n++)o[n]&&rU(e,o[n]);o=e}else if(o&&void 0!==o[0]){const e={};for(const n in o)o[n]&&rU(e,o[n]);o=e}for(const e in o)if(AU(o,e)&&tU[e])return void this.Rl(n);const s=n._getInternalSymbol(),a=this.features[i];if(this.Al(n),a)if(function(e,n){return Array.isArray(e)?!!Array.isArray(n)&&e.length===n.length:!Array.isArray(n)}(s,a)){if(Array.isArray(s)){for(let e=0;e<s.length;e++)if(!hQ(s[e],a[e]))return void this.Rl(n)}else if(!hQ(s,a))return void this.Rl(n);this.onGeometryPositionChange(e)}else this.Rl(n);else this.Rl(n)}onGeometryShapeChange(e){const n=e.target._getParent()||e.target;void 0!==n[VZ]&&(this.Cl([n]),this.Fl(),tQ(this))}onGeometryPositionChange(e){const n=e.target._getParent()||e.target,i=n[VZ];void 0!==i&&(this.Cl([n]),this.Ua[i]=n,tQ(this))}onGeometryZIndexChange(e){void 0!==(e.target._getParent()||e.target)[VZ]&&this.Ml()}onGeometryShow(e){void 0!==(e.target._getParent()||e.target)[VZ]&&this.Hl(e)}onGeometryHide(e){void 0!==(e.target._getParent()||e.target)[VZ]&&this.Hl(e)}Hl(e){const n=e.target._getParent()||e.target,i=this.features[n[VZ]];if(i){const e=n.isVisible();if(Array.isArray(i)){if(e===i[0].visible)return;for(let n=0;n<i.length;n++)i[n].visible=e}else{if(e===i.visible)return;i.visible=e}this.zl(),tQ(this)}}zl(){this.Qa=!0}onGeometryPropertiesChange(e){const n=e.target._getParent()||e.target,i=n[VZ];void 0!==i&&(this.features[i]=qZ(n,this.Va),this.El(this.features[i],i),this.Ml(),tQ(this))}createContext(){const e=this.canvas.gl&&this.canvas.gl.wrap;e?(this.gl=this.canvas.gl.wrap(),this.regl=this.canvas.gl.regl):this.Xe(),e&&(this.canvas.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height)),this.prepareRequestors(),this.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height),this.painter=this.createPainter();const n=La.get3DPainterClass("icon");let i=n.getBloomSymbol();const o=rU({},BZ,HZ);o.markerPerspectiveRatio=this.layer.options.markerPerspectiveRatio||0,this.Nl(o,i),this.xl=o;const s=rU({},vU,this.layer.options.sceneConfig||{});this.ja=new n(this.regl,this.layer,o,s,0),this.ja.setTextShaderDefines({REVERSE_MAP_ROTATION_ON_PITCH:1});const a=La.get3DPainterClass("line"),h=rU({},jZ);i=a.getBloomSymbol(),this.Nl(h,i),this.Vl=h;const l=rU({},this.layer.options.sceneConfig||{});void 0===l.depthMask&&(l.depthMask=!0),this.Ga=new a(this.regl,this.layer,h,l,0),this.layer.getGeometries()&&this.onGeometryAdd(this.layer.getGeometries())}We(){return!!(this.canvas&&this.canvas.gl&&this.canvas.gl.wrap)}Nl(e,n){for(let i=0;i<n.length;i++)e[n[i]]=this.layer.options.enableBloom}updateBloom(e){this.ja&&this.Ul(this.ja,this.xl,e),this.Ga&&this.Ul(this.Ga,this.Vl,e),this.painter&&this.Ul(this.painter,this.painterSymbol,e)}Ul(e,n,i){const o=e.constructor.getBloomSymbol().reduce(((e,o)=>(e[o]=i,n[o]=i,e)),{});e.updateSymbol(o,n)}createPainter(){}Xe(){const e=this.layer.options.glOptions||{alpha:!0,depth:!0,stencil:!0,antialias:!1};e.preserveDrawingBuffer=!0,e.stencil=!0,this.glOptions=e,this.gl=this.gl||this.Je(this.canvas,e),this.regl=jm({gl:this.gl,attributes:e,extensions:bw.WEBGL_EXTENSIONS,optionalExtensions:bw.WEBGL_OPTIONAL_EXTENSIONS})}Je(e,n){const i=["webgl","experimental-webgl"];let o=null;for(let s=0;s<i.length;++s){try{o=e.getContext(i[s],n)}catch(e){}if(o)break}return o}clearCanvas(){super.clearCanvas(),this.regl&&this.regl.clear({color:[0,0,0,0],depth:1,stencil:255})}resizeCanvas(e){super.resizeCanvas(e);const n=this.canvas;n&&(!this.pickingFBO||this.pickingFBO.width===n.width&&this.pickingFBO.height===n.height||this.pickingFBO.resize(n.width,n.height),this.painter&&this.painter.resize(n.width,n.height))}onRemove(){super.onRemove(),this.painter&&(this.painter.delete(),delete this.painter),this.ja&&(this.ja.delete(),delete this.ja),this.Ga&&(this.Ga.delete(),delete this.Ga)}drawOutline(e){if(this.mn&&(this.painter&&this.painter.outlineAll(e),this.ja.outlineAll(e),this.Ga.outlineAll(e)),this.jl)for(let n=0;n<this.jl.length;n++)this.painter&&this.painter.outline(e,this.jl[n]),this.ja.outline(e,this.jl[n]),this.Ga.outline(e,this.jl[n])}outlineAll(){this.mn=!0,this.setToRedraw()}outline(e){this.jl||(this.jl=[]);const n=[];for(let i=0;i<e.length;i++){const o=this.layer.getGeometryById(e[i]);if(o){const e=this.features[o[VZ]];if(Array.isArray(e))for(let i=0;i<e.length;i++)n.push(e[i].id);else n.push(e.id)}}this.jl.push(n),this.setToRedraw()}cancelOutline(){delete this.mn,delete this.jl,this.setToRedraw()}isEnableWorkAround(e){return"win-intel-gpu-crash"===e&&this.layer.options.workarounds["win-intel-gpu-crash"]&&eQ(this.gl)}rn(e){return fU(e,this.getMap())}_i(){const e=this.layer.getGeometries();e&&this.Cl(e),this.Ml()}Xn(){const e=this.layer.options.opacity;return this.We()?lU(e)?1:e:1}}function tQ(e){e.setToRedraw()}function eQ(e){const n=e.getExtension("WEBGL_debug_renderer_info");if(n&&"undefined"!=typeof navigator){const i=e.getParameter(n.UNMASKED_RENDERER_WEBGL),o="Win32"===navigator.platform||"Win64"===navigator.platform;if(i&&i.toLowerCase().indexOf("intel")>=0&&o)return!0}return!1}function nQ({properties:e}){const n=(YZ+"markerFile").trim(),i=(YZ+"markerType").trim();return e[n]||e[i]}function iQ({properties:e}){return e[(YZ+"textName").trim()]}const rQ=(YZ+"lineWidth").trim(),oQ=(UZ+"").trim();function sQ(e){return 2===e.type&&!e.properties[oQ]||3===e.type&&void 0!==e.properties[rQ]}function aQ(e){if(!Array.isArray(e))return 0;let n=0;for(let i=0;i<e.length;i++)n+=e[i];return n}function hQ(e,n){if(Object.keys(e).sort().join()!==Object.keys(n.properties||{}).filter((e=>0===e.indexOf(YZ))).map((e=>e.substring(YZ.length))).sort().join())return!1;for(const i in e)if(AU(e,i)){const o=(YZ+i).trim();if(ED(e[i])!==ED(n.properties[o]))return!1}return!0}function lQ(e,n,i){if(!e||e.type!==n)return null;const o=new i(e.id,e.options),s=e.geometries,a=[];for(let e=0;e<s.length;e++){const n=_A.fromJSON(s[e]);n&&a.push(n)}return o.addGeometry(a),o}class qf extends La{static fromJSON(e){return lQ(e,"PointLayer",qf)}constructor(...e){super(...e),this.options.sceneConfig||(this.options.sceneConfig=rU({},vU))}getPolygonOffsetCount(){return 0}getPolygonOffset(){return 0}}qf.mergeOptions({glyphSdfLimitPerFrame:15,iconErrorUrl:null,workarounds:{"win-intel-gpu-crash":!0},collision:!1,collisionFrameLimit:1}),qf.registerJSONType("PointLayer"),qf.registerRenderer("canvas",null),qf.registerRenderer("gl",class extends zf{constructor(...e){super(...e),this.GeometryTypes=[pf,Cf]}onGeometryAdd(e){e&&(Array.isArray(e)?e.forEach((e=>{e.options.maxMarkerWidth=e.options.maxMarkerHeight=255})):e.options.maxMarkerWidth=e.options.maxMarkerHeight=255,super.onGeometryAdd(e))}});class Jf extends La{static fromJSON(e){return lQ(e,"LineStringLayer",Jf)}}Jf.mergeOptions({meshRenderOrder:1}),Jf.registerJSONType("LineStringLayer");const uQ=(UZ+"").trim();Jf.registerRenderer("gl",class extends zf{constructor(...e){super(...e),this.GeometryTypes=[mf,Mf]}createPainter(){const e=La.get3DPainterClass("line-gradient");this.painterSymbol=rU({},{lineGradientProperty:uQ},jZ),this.Nl(this.painterSymbol,e.getBloomSymbol());const n=rU({},this.layer.options.sceneConfig||{});return void 0===n.depthMask&&(n.depthMask=!0),new e(this.regl,this.layer,this.painterSymbol,n,0)}buildMesh(){let{features:e,center:n}=this.ol();if(e=e.filter((e=>!!e.properties[uQ])),!e.length)return;const i=this.Qa;this.Gl=n;const o=rU({},this.painterSymbol),s=this.createMesh(this.painter,xj,o,e,null,n);this.Ll=!0,s.then((e=>{this.meshes&&this.painter.deleteMesh(this.meshes);const n=[],o=e&&e.meshes;if(o){n.push(...o);for(let e=0;e<o.length;e++)o[e].feaGroupIndex=0,o[e].geometry.properties.originElements=o[e].geometry.properties.elements.slice()}this.meshes=n,i&&(this.Qa=i),this.Ll=!1,this.setToRedraw()}))}}),Jf.registerRenderer("canvas",null);class Zf extends La{static fromJSON(e){return lQ(e,"PolygonLayer",Zf)}}Zf.registerJSONType("PolygonLayer");const cQ={polygonFill:{type:"identity",default:[1,1,1,1],property:"_symbol_polygonFill"},polygonPatternFile:{type:"identity",default:void 0,property:"_symbol_polygonPatternFile"},polygonOpacity:{type:"identity",default:1,property:"_symbol_polygonOpacity"},uvScale:{type:"identity",default:[1,1],property:"_symbol_uvScale"},uvOffset:{type:"identity",default:[0,0],property:"_symbol_uvOffset"},uvOffsetInMeter:{type:"identity",default:!1,property:"_symbol_uvOffsetInMeter"},polygonPatternFileWidth:{type:"identity",default:void 0,property:"_symbol_polygonPatternFileWidth"},polygonPatternFileHeight:{type:"identity",default:void 0,property:"_symbol_polygonPatternFileHeight"},polygonPatternFileOrigin:{type:"identity",default:void 0,property:"_symbol_polygonPatternFileOrigin"},polygonPatternUV:{type:"identity",default:void 0,property:"_symbol_polygonPatternUV"}};class td extends zf{constructor(){super(...arguments),this.GeometryTypes=[Af,Tf]}getPolygonOffsetCount(){return this.options.altitude>0?0:2}buildMesh(e){const{features:n,center:i}=this.ol();if(!n.length)return;const o=this.Qa;this.Gl=i;const s=this.Bl(n),a=rU({},cQ),h=s.map(((n,o)=>this.createMesh(this.painter,Fj,a,n,e&&e[o],i)));this.Ll=!0,Promise.all(h).then((e=>{this.meshes&&this.painter.deleteMesh(this.meshes),e=function(e){const n=[];for(let i=0;i<e.length;i++)Array.isArray(e[i])?n.push(...e[i]):n.push(e[i]);return n}(e);const n=[],i=[];for(let o=0;o<e.length;o++){const s=e[o]&&e[o].meshes;if(s){n.push(...s);for(let e=0;e<s.length;e++)s[e].feaGroupIndex=o,s[e].geometry.properties.originElements=s[e].geometry.properties.elements.slice(),1===o&&(s[e].transparent=!0);i[o]=e[o].atlas}}this.meshes=n,this.atlas=i,o&&(this.Qa=o),this.Ll=!1,this.setToRedraw(),this.layer.fire("buildmesh")}))}getRayCastData(e,n){const i=this.painter.getRayCastData(e,n);if(!i||!i.feature)return null;return this.Ea[i.feature[VZ]]}Bl(e){const n=[],i=[];for(let o=0;o<e.length;o++){const s=e[o];s.properties&&s.properties._symbol_polygonOpacity<1?i.push(s):n.push(s)}return[n,i]}createPainter(){const e=La.get3DPainterClass("fill"),n=this.painterSymbol=rU({},cQ);return this.Nl(n,e.getBloomSymbol()),new e(this.regl,this.layer,n,this.layer.options.sceneConfig,0)}updateMesh(e){return this.Sl(e,this.meshes,this.atlas,this.Gl,this.painter,Fj,cQ,this.Bl)}}function AQ(e,n,i,o,s,a,h){const l=i&&Array.isArray(i[0]);for(let a=0,c=i.length;a<c;a++){e[n]=(l?i[a][0]:i[a].x)*o,e[n+1]=(l?i[a][1]:i[a].y)*o,h!==Float32Array&&(e[n]=Math.round(e[n]),e[n+1]=Math.round(e[n+1]));let c=s||0;Array.isArray(s)&&(c=s[a]),c=c?Math.round(o*c):0,e[n+2]=c,n+=3}return e.trySetLength&&e.trySetLength(n),n}Zf.registerRenderer("gl",td),Zf.registerRenderer("canvas",null);const fQ=Math.PI/180,dQ=6378137*Math.PI/180,pQ=85.0511287798;function gQ(e,n,i){return function(e,n){const i=pQ,o=n[0],s=Math.max(Math.min(i,n[1]),-i);let a;return a=0===s?0:Math.log(Math.tan((90+s)*fQ/2))/fQ,e[0]=o*dQ,e[1]=a*dQ,e}(e,n)}function mQ(e,n,i,o){const s=i[0]-o[0],a=i[1]-o[1];let h=(n[0]-i[0])*(i[0]-o[0])+(n[1]-i[1])*(i[1]-o[1]);return h/=s*s+a*a,e[0]=i[0]+h*s,e[1]=i[1]+h*a,e}function yQ(e,n,i,o,s){return a=o,h=s,l=e[3*n[i-1]],c=e[3*n[i-1]+1],Math.sqrt((l-a)*(l-a)+(c-h)*(c-h));var a,h,l,c}function vQ(e,n,i,o,s,a,h,l,c,A,f,d,p,g,v,w,C){const P=n.getLength(),T=s/3;for(let i=2,o=P;i<o;i+=3)e[s+i-2]=n[i-2],e[s+i-1]=n[i-1],e[s+i-0]=n[i]-h;s+=P;for(let i=2,o=P;i<o;i+=3)e[s+i-2]=n[i-2],e[s+i-1]=n[i-1],e[s+i-0]=n[i]-l;e.trySetLength((s+=P)+P),e.copyWithin(s,s-2*P,s-P),e.trySetLength((s+=P)+P),e.copyWithin(s,s-2*P,s-P),s+=P,(i=i||[]).push(P/3);const S=i.getLength();for(let n=0;n<S;n++)_Q(T+(i[n-1]||0),T+i[n],e,P/3,c,o,A,f,d,p,a,g,v,w,C);return s}function _Q(e,n,i,o,s,a,h,l,c,A,f,d,p,g,v){const w=a.getLength();let C,P;for(let i=e,h=n;i<h-1;i++)if(C=i,P=i+1,s===1/0)if((i-e)%2==1&&(C+=2*o,P+=2*o),v){let e=a.currentIndex;a[e++]=C+o,a[e++]=P,a[e++]=C,a[e++]=P+o,a[e++]=P,a[e++]=C+o,a.currentIndex=e}else{let e=a.currentIndex;a[e++]=C+o,a[e++]=C,a[e++]=P,a[e++]=P,a[e++]=P+o,a[e++]=C+o,a.currentIndex=e}h&&function(e,n,i,o,s,a,h,l,c,A,f,d){let p,g=0,v=0,w=0,C=0;const P=d?[1,3,4]:[2,3,4];for(let d=a.getLength()-1;d>=h;d--){const h=a[d],T=3*h+2,S=s[3*h],I=s[3*h+1],E=s[T];g||v||(g=Math.max(s[T],s[3*a[d-3]+2]),v=Math.min(s[T],s[3*a[d-3]+2]),p=g-v);let O=w;const k=d%6;0===e?(5===k&&(C=yQ(s,a,d,S,I)),O=k===P[0]||k===P[1]||k===P[2]?w:w+C):1===e&&(k===P[0]||k===P[1]||k===P[2]?O=0:5===k?(C=yQ(s,a,d,S,I),O=C):O=C);let L;L=1===n?E===g?1:0:"bottom"===i?E===g?p/100/c:0:E===g?0:-p/100/c,o[2*h]=O/A*(1/(100*f))/l,o[2*h+1]=L,0===k&&(w+=C)}}(l,c,A,f,i,a,w,d[0],d[1],p,g,v)}function xQ(e){const n=[e[0]];let i=e[0];for(let o=1;o<e.length;o++)Array.isArray(e[o])?e[o][0]===i[0]&&e[o][1]===i[1]&&e[o][2]===i[2]||n.push(e[o]):e[o].x===i.x&&e[o].y===i.y&&e[o].z===i.z||n.push(e[o]),i=e[o];return n}const bQ=aH.getInstance();function wQ(e,n,i,o,s,a,h,l,c,A,f,d,p,g,v,w){void 0===n.top&&(n.top=!0),void 0===n.side&&(n.side=!0),bQ.reset();const{altitudeScale:C,altitudeProperty:P,defaultAltitude:T,heightProperty:S,minHeightProperty:I,defaultHeight:E,tangent:O,uv:k,topUVMode:L,sideUVMode:F,sideVerticalUVMode:N,top:z,side:H,textureYOrigin:j,topThickness:W}=n,q=!!w,Y=function(e,n,{altitudeScale:i,altitudeProperty:o,defaultAltitude:s,heightProperty:a,minHeightProperty:h,defaultHeight:l},{center:c,side:A,top:f,topThickness:d,uvOrigin:p,uv:g,uvSize:v,topUVMode:w,sideUVMode:C,sideVerticalUVMode:P,textureYOrigin:T,tileRatio:S,centimeterToPoint:I,verticalCentimeterToPoint:E,positionType:O,res:k,glScale:L,projectionCode:F},N,z){let H=n/e[0].extent;H=1;const j=n===1/0,W=z.get(),q=z.get(),Y=z.get(),J=z.getProxy(),$=z.get(),it=z.get(),rt=z.get(),ot=!!g,st=!!f,at=!!A,ht=ot?z.get():null;function At(e,i,o,s,a,h){let l=i;if(st){const A=dL(J,o,3);if(0===A.length)return i;let f=J.getLength(),g=$.currentIndex;for(let e=0;e<f;e++)$[g++]=J[e];if($.currentIndex=g,i+=J.getLength(),h)for(let n=2,i=A.length;n<i;n+=3)A[n]+=e/3,A[n-1]+=e/3,A[n-2]+=e/3;f=A.length,g=it.currentIndex;for(let e=0;e<f;e++)it[g++]=A[e];it.currentIndex=g,ot&&function(e,n,i,o,s,a,h,l,c,A,f,d,p,g,v){0===e?function(e,n,i,o,s,a,h,l,c,A){const f=1/(100*a[0]),d=1/(100*a[1]),p=A&&A[0]||0,g=A&&A[1]||0,v=[0,0];for(let s=e;s<n;s+=3){const e=s/3*2,n=o[s+1]-g;i[e]=v[0]+(o[s]-p)/h*f/l,i[e+1]=v[1]-n/h*d/c}}(n,i,o,s,0,h,l,c,A,v):1===e&&function(e,n,i,o,s,a,h,l,c,A,f){if(!e)return;let d,p,g,v;0===e[4]?(d=e[0],p=e[1],g=e[2],v=e[3]):(d=e[1],p=e[2],g=e[3],v=e[0]);const w=$x(d,p),C=$x(p,g),P=[],T=[],S=[];for(let e=n;e<i;e+=3){const n=e/3*2;Zx(P,(a.x/c+s[e]/h)*l,a.y/c*l+(f?s[e+1]:-s[e+1])/h*l),"EPSG:4326"!==A&&"EPSG:4490"!==A||gQ(P,P),mQ(T,P,d,p),mQ(S,P,v,d),o[n]=$x(d,T)/w,o[n+1]=$x(d,S)/C}}(f,n,i,o,s,a,l,d,p,g,!!v)}(w||0,e,i,ht,$,p,I,S,v[0],v[1],a,k,L,F,c),d>0&&!at&&(i=vQ($,J,o,it,i,ht,0,d,n,ot,C||0,P||0,T,v,S,E,s<0?!h:h)),rt.setLength(i/3),rt.fill(1,l/3,i/3)}if(at){st&&(d=0),l=i,i=vQ($,J,o,it,i,ht,d,s,n,ot,C||0,P||0,T,v,S,E,s<0?!h:h),rt.setLength(i/3);const e=J.getLength()/3;rt.fill(1,l/3,l/3+e),rt.fill(0,l/3+e,l/3+2*e),rt.fill(1,l/3+2*e,l/3+3*e),rt.fill(0,l/3+3*e,i/3)}return i}let ft=0,gt=0,vt=0,_t=e.length;sU(N)&&(vt=N,_t=N+1);let xt=0,wt=!1;const Ct=z.getProxy();let Ot=!1;for(;vt<_t;vt++){const n=e[vt],c=n.id;sU(c)&&(Math.abs(c)>xt&&(xt=Math.abs(c)),c<0&&(wt=!0));const A=n.geometry,f=n.properties[SU];let d=Array.isArray(f&&f[0]&&f[0][0])?f[0]:f;const{altitude:p,height:g}=yF(n,i,o,s,a,l,h);g<0&&(Ot=!0),ft=Math.max(Math.abs(p),ft);const v=$.getLength();let w=0,C=gt;Ct.setLength(0),J.setLength(0);const P=gF(A[0])<0;for(let e=0,n=A.length;e<n;e++){let i=A[e];P&&(i=i.reverse()),i=xQ(i);const o=gF(i)<0;if(!o&&e>0&&(w++,d=f&&f[w],gt=At(C,gt,Ct,1*g,d,j),J.setLength(0),Ct.setLength(0),C=gt),!i.length){e===n-1&&(gt=At(C,gt,Ct,1*g,d,j));continue}const s=i.length;if(Array.isArray(i[0])?i[0][0]===i[s-1][0]&&i[0][1]===i[s-1][1]||i.push([i[0][0],i[0][1]]):i[0].x===i[s-1].x&&i[0].y===i[s-1].y||i.push(i[0]),o){let e=Ct.currentIndex;Ct[e++]=J.getLength()/3,Ct.currentIndex=e}AQ(J,J.getLength(),i,1,p,0,O),e===n-1&&(gt=At(C,gt,Ct,1*g,d,j))}const T=$.getLength()-v,S=(PU+"").trim();for(let e=0;e<T/3;e++){let e=q.currentIndex;q[e++]=void 0===n[S]?vt:n[S],q.currentIndex=e,e=W.currentIndex,W[e++]=vt,W.currentIndex=e,sU(c)&&(e=Y.currentIndex,Y[e++]=c,Y.currentIndex=e)}}const Dt=EF(q.getLength()?q[q.getLength()-1]:0),kt={hasNegativeHeight:Ot,maxAltitude:ft,vertices:$,verticeTypes:rt,indices:it,pickingIds:aH.createTypedArray(q,Dt),featureIndexes:W};if(Y.getLength()){const e=wt?IF(xt):EF(xt);kt.featureIds=aH.createTypedArray(Y,e)}else kt.featureIds=[];return ht&&(ht.setLength($.getLength()/3*2),kt.uvs=ht),kt}(e,i,{altitudeScale:C,altitudeProperty:P,defaultAltitude:T||0,heightProperty:S,minHeightProperty:I,defaultHeight:E||0},{center:w,top:z,side:H,topThickness:10*W||0,uv:k||O,uvSize:[s,s],uvOrigin:o,topUVMode:L,sideUVMode:F,sideVerticalUVMode:N,textureYOrigin:j,tileRatio:l,centimeterToPoint:c,verticalCentimeterToPoint:A,positionType:v,res:a,glScale:h,projectionCode:p},g,bQ),J=[],$=Y.vertices.getLength()/3,it=SF($),rt=aH.createTypedArray(Y.indices,it);delete Y.indices,J.push(rt.buffer,Y.pickingIds.buffer);const ot=v||IF(Math.max(512,Y.maxAltitude));Y.vertices=aH.createTypedArray(Y.vertices,ot);const st=O?bQ.getProxy():new Float32Array(3*$);st.setLength&&st.setLength(3*$);const at=Nb(Y.vertices,rt,st);let ht=!0;const At=at.getLength?at.getLength():at.length;for(let e=0;e<At;e++){q||(at[e]=-at[e]);const n=at[e]%1;1-Math.abs(n)>1e-6?ht=!1:0!==n&&(at[e]=Math.round(at[e]))}if(Y.normals=at,O){let e=bQ.get();e.setLength(4*$),e=qb(Y.vertices,Y.normals,Y.uvs,rt,e),e=function(e,n){const i=n.getLength(),o=new Float32Array(i),s=[],a=[],h=[];for(let l=0;l<i;l+=4){const i=l/4*3;$v(a,e[i]||0,e[i+1]||0,e[i+2]||0),E_(s,n[l]||0,n[l+1]||0,n[l+2]||0,n[l+3]||0),Lb(h,a,s),I_(o.subarray(l,l+4),h)}return o}(Y.normals,e),Y.tangents=e,J.push(e.buffer),delete Y.normals}if(Y.normals&&(ht&&(Y.normals=aH.createTypedArray(Y.normals,Int8Array)),J.push(Y.normals.buffer)),Y.uvs){Y.uvs=aH.createTypedArray(Y.uvs,Float32Array),J.push(Y.uvs.buffer)}if(w){const e=Y.vertices,n=e.length;for(let i=0;i<n;i+=3)e[i]-=w[0],e[i+1]-=w[1]}const ft=function(e,n,i,o){const s={},a={},h=o.getLength();if(cU(n.polygonFill)){let l=DD(n.polygonFill);const c=new Uint8Array(4*h);c.fill(255);for(let n=0;n<h;n++){const a=e[o[n]],h=a.properties||{};h.$layer=a.layer,h.$type=a.type;let A=l(i,h);ED(A)&&(s.aColor=1,l=DD(A),A=l(i,h)),delete h.$layer,delete h.$type,UF(CQ,A),c[4*n]=CQ[0],c[4*n+1]=CQ[1],c[4*n+2]=CQ[2],c[4*n+3]=CQ[3]}a.aColor=c}if(cU(n.polygonOpacity)){let l=RD(n.polygonOpacity);const c=new Uint8Array(h);c.fill(255);for(let n=0;n<h;n++){const a=e[o[n]],h=a.properties||{};h.$layer=a.layer,h.$type=a.type;let A=l(i,h);ED(A)&&(s.aOpacity=1,l=DD(A),A=l(i,h)),delete h.$layer,delete h.$type,c[n]=255*A}a.aOpacity=c}return a.dynamicAttributes=s,a}(e,f,d,Y.featureIndexes),gt=function(e,n,i,o,s){const a=[[],[]],h=cU(o.topPolygonFill),l=cU(o.bottomPolygonFill),c=[255,255,255,255],A=n.getLength();if(h||l){let f=h&&DD(o.topPolygonFill),d=l&&DD(o.bottomPolygonFill),p=null,g=null,v=null,w=null;for(let o=0;o<A;o++){if(1===e[o]&&!h||0===e[o]&&!l)continue;const A=1===e[o];if(A&&n[o]===p){e[o]=v;continue}if(!A&&n[o]===g){e[o]=w;continue}const C=i[n[o]],P=C.properties||{};P.$layer=C.layer,P.$type=C.type;let T=A?f:d,S=T(s,P);ED(S)&&(T=DD(S),S=T(s,P)),delete P.$layer,delete P.$type,UF(CQ,S),k_(CQ,CQ,c);let I=PQ(a,CQ);I<0&&(I=a.length,a.push(I_([],CQ))),e[o]=I,A?(p=n[o],v=I):(g=n[o],w=I)}}return a.slice(2)}(Y.verticeTypes,Y.featureIndexes,e,f,d),vt={data:{data:{aVertexColorType:aH.createTypedArray(Y.verticeTypes,gt.length<=252?Uint8Array:Uint16Array),aPosition:Y.vertices,aNormal:Y.normals,aTexCoord0:Y.uvs,aTangent:Y.tangents,aPickingId:Y.pickingIds},indices:rt,properties:{maxAltitude:Y.maxAltitude,hasNegativeHeight:Y.hasNegativeHeight},dynamicAttributes:ft.dynamicAttributes,vertexColors:gt},buffers:J};return Y.featureIds.length?(vt.data.featureIds=Y.featureIds,J.push(vt.data.featureIds.buffer)):vt.data.featureIds=[],ft.aColor&&(vt.data.data.aColor=ft.aColor,vt.buffers.push(ft.aColor.buffer)),ft.aOpacity&&(vt.data.data.aOpacity=ft.aOpacity,vt.buffers.push(ft.aOpacity.buffer)),vt.buffers.push(vt.data.data.aPosition.buffer),vt.data.pickingIdIndiceMap=bF(vt.data.data.aPickingId,vt.data.indices),vt}const CQ=[];function PQ(e,n){for(let i=0;i<e.length;i++)if(V_(n,e[i]))return i;return-1}var MQ={exports:{}},TQ=function(e,n,i,o){var s=e[0],a=e[1],h=!1;void 0===i&&(i=0),void 0===o&&(o=n.length);for(var l=(o-i)/2,c=0,A=l-1;c<l;A=c++){var f=n[i+2*c+0],d=n[i+2*c+1],p=n[i+2*A+1];d>a!=p>a&&s<(n[i+2*A+0]-f)*(a-d)/(p-d)+f&&(h=!h)}return h},SQ=function(e,n,i,o){var s=e[0],a=e[1],h=!1;void 0===i&&(i=0),void 0===o&&(o=n.length);for(var l=o-i,c=0,A=l-1;c<l;A=c++){var f=n[c+i][0],d=n[c+i][1],p=n[A+i][1];d>a!=p>a&&s<(n[A+i][0]-f)*(a-d)/(p-d)+f&&(h=!h)}return h};MQ.exports=function(e,n,i,o){return n.length>0&&Array.isArray(n[0])?SQ(e,n,i,o):TQ(e,n,i,o)};var IQ=MQ.exports.nested=SQ;MQ.exports.flat=TQ;const EQ=11102230246251565e-32,OQ=134217729,RQ=(3+8*EQ)*EQ;function DQ(e,n,i,o,s){let a,h,l,c,A=n[0],f=o[0],d=0,p=0;f>A==f>-A?(a=A,A=n[++d]):(a=f,f=o[++p]);let g=0;if(d<e&&p<i)for(f>A==f>-A?(h=A+a,l=a-(h-A),A=n[++d]):(h=f+a,l=a-(h-f),f=o[++p]),a=h,0!==l&&(s[g++]=l);d<e&&p<i;)f>A==f>-A?(h=a+A,c=h-a,l=a-(h-c)+(A-c),A=n[++d]):(h=a+f,c=h-a,l=a-(h-c)+(f-c),f=o[++p]),a=h,0!==l&&(s[g++]=l);for(;d<e;)h=a+A,c=h-a,l=a-(h-c)+(A-c),A=n[++d],a=h,0!==l&&(s[g++]=l);for(;p<i;)h=a+f,c=h-a,l=a-(h-c)+(f-c),f=o[++p],a=h,0!==l&&(s[g++]=l);return 0===a&&0!==g||(s[g++]=a),g}function kQ(e){return new Float64Array(e)}const LQ=33306690738754716e-32,FQ=22204460492503146e-32,NQ=11093356479670487e-47,zQ=kQ(4),BQ=kQ(8),HQ=kQ(12),jQ=kQ(16),UQ=kQ(4);function GQ(e,n,i,o,s,a,h){for(var l=new oj([],VQ),c=e.data;c;){for(var A=0;A<c.children.length;A++){var f=c.children[A],d=c.leaf?KQ(f,i,o):WQ(i,o,f);d>a||l.push({node:f,dist:d})}for(;l.length&&!l.peek().node.children;){var p=l.pop(),g=p.node,v=KQ(g,n,i),w=KQ(g,o,s);if(p.dist<v&&p.dist<w&&ZQ(i,g,h)&&ZQ(o,g,h))return g}(c=l.pop())&&(c=c.node)}return null}function VQ(e,n){return e.dist-n.dist}function WQ(e,n,i){if(qQ(e,i)||qQ(n,i))return 0;var o=$Q(e[0],e[1],n[0],n[1],i.minX,i.minY,i.maxX,i.minY);if(0===o)return 0;var s=$Q(e[0],e[1],n[0],n[1],i.minX,i.minY,i.minX,i.maxY);if(0===s)return 0;var a=$Q(e[0],e[1],n[0],n[1],i.maxX,i.minY,i.maxX,i.maxY);if(0===a)return 0;var h=$Q(e[0],e[1],n[0],n[1],i.minX,i.maxY,i.maxX,i.maxY);return 0===h?0:Math.min(o,s,a,h)}function qQ(e,n){return e[0]>=n.minX&&e[0]<=n.maxX&&e[1]>=n.minY&&e[1]<=n.maxY}function ZQ(e,n,i){for(var o,s,a,h,l=Math.min(e[0],n[0]),c=Math.min(e[1],n[1]),A=Math.max(e[0],n[0]),f=Math.max(e[1],n[1]),d=i.search({minX:l,minY:c,maxX:A,maxY:f}),p=0;p<d.length;p++)if(s=d[p].next.p,a=e,(o=d[p].p)!==(h=n)&&s!==a&&QQ(o,s,a)>0!=QQ(o,s,h)>0&&QQ(a,h,o)>0!=QQ(a,h,s)>0)return!1;return!0}function QQ(e,n,i){return function(e,n,i,o,s,a){const h=(n-a)*(i-s),l=(e-s)*(o-a),c=h-l;if(0===h||0===l||h>0!=l>0)return c;const A=Math.abs(h+l);return Math.abs(c)>=LQ*A?c:-function(e,n,i,o,s,a,h){let l,c,A,f,d,p,g,v,w,C,P,T,S,I,E,O,k,L;const F=e-s,N=i-s,z=n-a,H=o-a;I=F*H,p=OQ*F,g=p-(p-F),v=F-g,p=OQ*H,w=p-(p-H),C=H-w,E=v*C-(I-g*w-v*w-g*C),O=z*N,p=OQ*z,g=p-(p-z),v=z-g,p=OQ*N,w=p-(p-N),C=N-w,k=v*C-(O-g*w-v*w-g*C),P=E-k,d=E-P,zQ[0]=E-(P+d)+(d-k),T=I+P,d=T-I,S=I-(T-d)+(P-d),P=S-O,d=S-P,zQ[1]=S-(P+d)+(d-O),L=T+P,d=L-T,zQ[2]=T-(L-d)+(P-d),zQ[3]=L;let j=function(e,n){let i=n[0];for(let e=1;e<4;e++)i+=n[e];return i}(0,zQ),W=FQ*h;if(j>=W||-j>=W)return j;if(d=e-F,l=e-(F+d)+(d-s),d=i-N,A=i-(N+d)+(d-s),d=n-z,c=n-(z+d)+(d-a),d=o-H,f=o-(H+d)+(d-a),0===l&&0===c&&0===A&&0===f)return j;if(W=NQ*h+RQ*Math.abs(j),j+=F*f+H*l-(z*A+N*c),j>=W||-j>=W)return j;I=l*H,p=OQ*l,g=p-(p-l),v=l-g,p=OQ*H,w=p-(p-H),C=H-w,E=v*C-(I-g*w-v*w-g*C),O=c*N,p=OQ*c,g=p-(p-c),v=c-g,p=OQ*N,w=p-(p-N),C=N-w,k=v*C-(O-g*w-v*w-g*C),P=E-k,d=E-P,UQ[0]=E-(P+d)+(d-k),T=I+P,d=T-I,S=I-(T-d)+(P-d),P=S-O,d=S-P,UQ[1]=S-(P+d)+(d-O),L=T+P,d=L-T,UQ[2]=T-(L-d)+(P-d),UQ[3]=L;const q=DQ(4,zQ,4,UQ,BQ);I=F*f,p=OQ*F,g=p-(p-F),v=F-g,p=OQ*f,w=p-(p-f),C=f-w,E=v*C-(I-g*w-v*w-g*C),O=z*A,p=OQ*z,g=p-(p-z),v=z-g,p=OQ*A,w=p-(p-A),C=A-w,k=v*C-(O-g*w-v*w-g*C),P=E-k,d=E-P,UQ[0]=E-(P+d)+(d-k),T=I+P,d=T-I,S=I-(T-d)+(P-d),P=S-O,d=S-P,UQ[1]=S-(P+d)+(d-O),L=T+P,d=L-T,UQ[2]=T-(L-d)+(P-d),UQ[3]=L;const Y=DQ(q,BQ,4,UQ,HQ);I=l*f,p=OQ*l,g=p-(p-l),v=l-g,p=OQ*f,w=p-(p-f),C=f-w,E=v*C-(I-g*w-v*w-g*C),O=c*A,p=OQ*c,g=p-(p-c),v=c-g,p=OQ*A,w=p-(p-A),C=A-w,k=v*C-(O-g*w-v*w-g*C),P=E-k,d=E-P,UQ[0]=E-(P+d)+(d-k),T=I+P,d=T-I,S=I-(T-d)+(P-d),P=S-O,d=S-P,UQ[1]=S-(P+d)+(d-O),L=T+P,d=L-T,UQ[2]=T-(L-d)+(P-d),UQ[3]=L;const J=DQ(Y,HQ,4,UQ,jQ);return jQ[J-1]}(e,n,i,o,s,a,A)}(e[0],e[1],n[0],n[1],i[0],i[1])}function XQ(e){var n=e.p,i=e.next.p;return e.minX=Math.min(n[0],i[0]),e.minY=Math.min(n[1],i[1]),e.maxX=Math.max(n[0],i[0]),e.maxY=Math.max(n[1],i[1]),e}function YQ(e,n){var i={p:e,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function JQ(e,n){var i=e[0]-n[0],o=e[1]-n[1];return i*i+o*o}function KQ(e,n,i){var o=n[0],s=n[1],a=i[0]-o,h=i[1]-s;if(0!==a||0!==h){var l=((e[0]-o)*a+(e[1]-s)*h)/(a*a+h*h);l>1?(o=i[0],s=i[1]):l>0&&(o+=a*l,s+=h*l)}return(a=e[0]-o)*a+(h=e[1]-s)*h}function $Q(e,n,i,o,s,a,h,l){var c,A,f,d,p=i-e,g=o-n,v=h-s,w=l-a,C=e-s,P=n-a,T=p*p+g*g,S=p*v+g*w,I=v*v+w*w,E=p*C+g*P,O=v*C+w*P,k=T*I-S*S,L=k,F=k;0===k?(A=0,L=1,d=O,F=I):(d=T*O-S*E,(A=S*O-I*E)<0?(A=0,d=O,F=I):A>L&&(A=L,d=O+S,F=I)),d<0?(d=0,-E<0?A=0:-E>T?A=L:(A=-E,L=T)):d>F&&(d=F,-E+S<0?A=0:-E+S>T?A=L:(A=-E+S,L=T));var N=(1-(f=0===d?0:d/F))*s+f*h-((1-(c=0===A?0:A/L))*e+c*i),z=(1-f)*a+f*l-((1-c)*n+c*o);return N*N+z*z}function tX(e,n){return e[0]===n[0]?e[1]-n[1]:e[0]-n[0]}class Yd{constructor(e,n){this.x=e,this.y=n}clone(){return new Yd(this.x,this.y)}normalize(){const e=this.length();this.x/=e,this.y/=e}negate(){this.x=-this.x,this.y=-this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}diff(e){return new Yd(this.x-e.x,this.y-e.y)}distance(e){const n=this.x-e.x,i=this.y-e.y;return Math.sqrt(n*n+i*i)}dot(e){return this.x*e.x+this.y*e.y}equals(e){return this.x===e.x&&this.y===e.y}orthogonal(){return new Yd(this.y,-this.x)}}function eX(e,n,i,o){const s=((i.x-e.x)*o.y-(i.y-e.y)*o.x)/(n.x*o.y-n.y*o.x);return new Yd(e.x+s*n.x,e.y+s*n.y)}const nX=[],iX=[];function rX(e){if(sU(e[0]&&e[0].x)){const n=[];let i=0;for(let o=0;o<e.length;o++)iX[i]?(iX[i][0]=e[o].x,iX[i][1]=e[o].y):iX[i]=[e[o].x,e[o].y],n.push(iX[i]),i++;e=n}try{const n=function(e,n,i){n=Math.max(0,void 0===n?2:n),i=i||0;var o=function(e){for(var n=e[0],i=e[0],o=e[0],s=e[0],a=0;a<e.length;a++){var h=e[a];h[0]<n[0]&&(n=h),h[0]>o[0]&&(o=h),h[1]<i[1]&&(i=h),h[1]>s[1]&&(s=h)}var l=[n,i,o,s],c=l.slice();for(a=0;a<e.length;a++)IQ(e[a],l)||c.push(e[a]);return function(e){e.sort(tX);for(var n=[],i=0;i<e.length;i++){for(;n.length>=2&&QQ(n[n.length-2],n[n.length-1],e[i])<=0;)n.pop();n.push(e[i])}for(var o=[],s=e.length-1;s>=0;s--){for(;o.length>=2&&QQ(o[o.length-2],o[o.length-1],e[s])<=0;)o.pop();o.push(e[s])}return o.pop(),n.pop(),n.concat(o)}(c)}(e),s=new RBush(16);s.toBBox=function(e){return{minX:e[0],minY:e[1],maxX:e[0],maxY:e[1]}},s.compareMinX=function(e,n){return e[0]-n[0]},s.compareMinY=function(e,n){return e[1]-n[1]},s.load(e);for(var a,h=[],l=0;l<o.length;l++){var c=o[l];s.remove(c),a=YQ(c,a),h.push(a)}var A=new RBush(16);for(l=0;l<h.length;l++)A.insert(XQ(h[l]));for(var f=n*n,d=i*i;h.length;){var p=h.shift(),g=p.p,v=p.next.p,w=JQ(g,v);if(!(w<d)){var C=w/f;(c=GQ(s,p.prev.p,g,v,p.next.next.p,C,A))&&Math.min(JQ(c,g),JQ(c,v))<=C&&(h.push(p),h.push(YQ(c,p)),s.remove(c),A.remove(p),A.insert(XQ(p)),A.insert(XQ(p.next)))}}p=a;var P=[];do{P.push(p.p),p=p.next}while(p!==a);return P.push(p.p),P}(e,1/0);let i=[1/0,1/0],o=[-1/0,-1/0];for(let e=0;e<n.length;e++)n[e][0]<i[0]&&(i[0]=n[e][0]),n[e][0]>o[0]&&(o[0]=n[e][0]),n[e][1]<i[1]&&(i[1]=n[e][1]),n[e][1]>o[1]&&(o[1]=n[e][1]);const s=[];let a=[],h=0;for(let e=0;e<n.length;e++)e===n.length-1&&n[e][0]===n[0][0]&&n[e][1]===n[0][1]||(gQ(s,n[e]),nX[h]?(nX[h].x=s[0],nX[h].y=s[1]):nX[h]=new Yd(s[0],s[1]),a.push(nX[h]),h++);gF(a)<0&&(a=a.reverse());const l=function(e){let n,i=Number.MAX_VALUE;const o=function(e,o,s,a,h,l,c,A){var f=eX(e,o,h,l),d=eX(s,a,h,l),p=eX(c,A,e,o),g=eX(c,A,s,a),v=f.distance(d)*f.distance(p);0!==v&&v<i&&(n=[f,p,g,d],i=v)};var s=[];for(let n=0;n<e.length;n++)s.push(e[(n+1)%e.length].diff(e[n])),s[n].normalize();var a,h,l,c,A=new Yd(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),f=new Yd(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let n=0;n<e.length;n++){var d=e[n];d.x<A.x&&(A.x=d.x,a=n),d.x>f.x&&(f.x=d.x,h=n),d.y<A.y&&(A.y=d.y,c=n),d.y>f.y&&(f.y=d.y,l=n)}var p=new Yd(0,-1),g=new Yd(0,1),v=new Yd(-1,0),w=new Yd(1,0);for(let n=0;n<e.length;n++){var C=[Math.acos(p.dot(s[a])),Math.acos(g.dot(s[h])),Math.acos(v.dot(s[l])),Math.acos(w.dot(s[c]))];switch(C.indexOf(Math.min.apply(Math,C))){case 0:(g=(p=s[a].clone()).clone()).negate(),(w=(v=p.orthogonal()).clone()).negate(),a=(a+1)%e.length;break;case 1:(p=(g=s[h].clone()).clone()).negate(),(w=(v=p.orthogonal()).clone()).negate(),h=(h+1)%e.length;break;case 2:(w=(v=s[l].clone()).clone()).negate(),(g=(p=w.orthogonal()).clone()).negate(),l=(l+1)%e.length;break;case 3:(v=(w=s[c].clone()).clone()).negate(),(g=(p=w.orthogonal()).clone()).negate(),c=(c+1)%e.length}o(e[a],p,e[h],g,e[l],v,e[c],w)}return n}(a);if(!l||4!==l.length)return null;const c=l[0].distance(l[1]),A=l[1].distance(l[2]),f=l.map((e=>[e.x,e.y]));return f.push(+(A>c)),f}catch(e){return null}}class Qd extends La{static fromJSON(e){return lQ(e,"ExtrudePolygonLayer",Qd)}getPolygonOffsetCount(){return 0}getPolygonOffset(){return 0}onConfig(e){const n=this.getRenderer();return n&&n.onConfig(e),super.onConfig(e)}updateMaterial(e){this.options.material||(this.options.material={}),e?rU(this.options.material,e):this.options.material=null;const n=this.getRenderer();return n&&n.updateMaterial(e),this}updateSideMaterial(e){let n=!1;this.options.sideMaterial||(this.options.sideMaterial={},n=!0),e?rU(this.options.sideMaterial,e):this.options.sideMaterial=null;const i=this.getRenderer();return i&&(n&&i.$l(),i.updateSideMaterial(e)),this}updateDataConfig(e){if(!e)return this;this.options.dataConfig||(this.options.dataConfig={});const n=JSON.parse(JSON.stringify(this.options.dataConfig));rU(this.options.dataConfig,e);const i=this.getRenderer();return i&&i.updateDataConfig(e,n),this}}Qd.registerJSONType("ExtrudePolygonLayer"),Qd.mergeOptions({cullFace:!1,castShadow:!0});const oX={polygonFill:{type:"identity",default:[1,1,1,1],property:"_symbol_polygonFill"},polygonOpacity:{type:"identity",default:1,property:"_symbol_polygonOpacity"},topPolygonFill:{type:"identity",default:[1,1,1,1],property:"_symbol_topPolygonFill"},bottomPolygonFill:{type:"identity",default:[1,1,1,1],property:"_symbol_bottomPolygonFill"}},sX={defaultAltitude:20},aX=e=>1===e.properties.top;if(Qd.registerRenderer("gl",class extends td{constructor(...e){super(...e),this.GeometryTypes=[Af,Tf]}Bl(e){return[e]}onConfig(e){this.painter&&(lU(e.cullFace)||this.painter.updateSceneConfig({cullFace:e.cullFace}))}updateMaterial(e){this.painter&&(this.painter.Ao(e),this.layer.options.sideMaterial||this.sidePainter.Ao(e),this.setToRedraw())}$l(){this.sidePainter&&this.sidePainter.deleteMaterial()}updateSideMaterial(e){this.sidePainter&&(e?this.sidePainter.Ao(e):(this.sidePainter.deleteMaterial(),this.sidePainter.Ao(this.layer.options.material)),this.setToRedraw())}updateDataConfig(e,n){this.painter&&(this.painter.updateDataConfig(e,n),this.Ml())}updateBloom(e){super.updateBloom(e),this.sidePainter&&this.Ul(this.sidePainter,this.sidePainterSymbol,e)}needCheckPointLineSymbols(){return!1}draw(e,n){return super.draw(e,n)}createPainter(){const e=La.get3DPainterClass("lit");this.painterSymbol=rU({},oX),this.sidePainterSymbol=rU({},oX),this.Nl(this.painterSymbol,e.getBloomSymbol());const n=this.layer,i=rU({},sX,n.options.dataConfig||{});n.options.material&&(this.painterSymbol.material=n.options.material),this.sidePainterSymbol.material=n.options.sideMaterial?n.options.sideMaterial:n.options.material;const o={cullFace:n.options.cullFace};Object.defineProperty(o,"castShadow",{enumerable:!0,get:()=>n.options.castShadow}),Object.defineProperty(o,"depthMask",{enumerable:!0,get:()=>n.options.depthMask});const s=rU({},i);s.upsideUpTexture=!0;const a=new e(this.regl,n,this.painterSymbol,o,0,s);return this.sidePainter=new e(this.regl,n,this.sidePainterSymbol,o,0,i),a}an(...e){super.an(...e);const n=this.painter;this.painter=this.sidePainter,super.an(...e),this.painter=n}il(...e){const n=e[0],i=n.sceneFilter;n.sceneFilter=e=>(!i||i(e))&&aX(e);const o=super.il(...e);n.sceneFilter=e=>(!i||i(e))&&aX(e);const s=this.painter;this.painter=this.sidePainter;const a=n.sceneFilter=e=>(!i||i(e))&&(e=>1===e.properties.side)(e);return super.il(...e),this.painter=s,n.sceneFilter=i,{redraw:o.redraw||a.redraw,drawCount:(o.drawCount||0)+(a.drawCount||0)}}createMesh(e,n,i,o,s,a){const h=[];this.Wl=a;const l=this.Xl(o,i,!0,!1),c=this.Xl(o,i,!1,!0);if(l){const s=this.ll(l,e,n,i,o,null,a);s.meshes[0].properties.top=1,h.push(s)}if(c){const s=this.ll(c,e,n,i,o,null,a);s.meshes[0].properties.side=1,h.push(s)}return h}Xl(e,n,i,o){const s=this.getMap();n=oX;const a=this.Wl,h=s.getZoom(),l=new ee(0,0),c=new Zh(0,0),A=rU({},sX,this.layer.options.dataConfig);if(A.uv=!0,A.top&&(A.top=i),A.side&&(A.side=o),!1===A.top&&!1===A.side)return null;if(!e.length)return null;const f=s.getGLRes(),d=s.getProjection().code,p=i?this.painterSymbol&&this.painterSymbol.material:this.sidePainterSymbol&&this.sidePainterSymbol.material,g=p&&p.textureWidth||23.25,v=[KU(s,1,c,f)/100,KU(s,1,c,f,1)/100];return wQ(e,A,1/0,l,g,s.getGLRes(),1,1,v,this.nn,n,h,d,void 0,Float32Array,a)}updateMesh(e){let n=this.features[e[VZ]];if(!n||!this.meshes)return;const i=this.Xl([n],this.painterSymbol,!0,!1);let o=0;i&&i.data&&this.Tl(this.meshes[o++],n.id,i);const s=this.Xl([n],this.painterSymbol,!1,!0);s&&s.data&&this.Tl(this.meshes[o++],n.id,s)}Al(e){if(e.getProperties()||e.setProperties({}),!e.getProperties()[SU]){const n=e.getCoordinates();if(e instanceof Tf){const i=[];for(let e=0;e<n.length;e++){i[e]=rX(n[e]&&n[e][0])}e.getProperties()[SU]=i}else{const i=rX(n[0]);e.getProperties()[SU]=i}}return super.Al(e)}resizeCanvas(e){super.resizeCanvas(e),this.sidePainter&&this.sidePainter.resize(this.canvas.width,this.canvas.height)}onRemove(){super.onRemove(),this.sidePainter&&(this.sidePainter.delete(),delete this.sidePainter)}drawOutline(e){if(super.drawOutline(e),this.mn&&this.sidePainter&&this.sidePainter.outlineAll(e),this.jl)for(let n=0;n<this.jl.length;n++)this.sidePainter&&this.sidePainter.outline(e,this.jl[n])}getShadowMeshes(){return this.painter?this.painter.getShadowMeshes():[]}}),Qd.registerRenderer("canvas",null),ZC.register("vt_position_vert","#ifdef HAS_TERRAIN_ALTITUDE\n    attribute float aTerrainAltitude;\n#endif\nuniform float minAltitude;\n#ifdef HAS_ALTITUDE\n    vec3 unpackVTPosition() {\n        float altitude = aAltitude;\n        #ifdef HAS_TERRAIN_ALTITUDE\n            altitude += aTerrainAltitude * 100.0;\n        #endif\n        altitude += minAltitude * 100.0;\n        return vec3(aPosition, altitude);\n    }\n#else\n    float position_modValue = 16384.0;\n    float position_delta = 0.00001;\n    vec3 unpackVTPosition() {\n        float z = aPosition.z;\n        vec2 pos = sign(aPosition.xy + position_delta) * mod(abs(aPosition.xy), position_modValue);\n        vec2 highs = floor(abs(aPosition.xy) / position_modValue);\n        float altitude = sign(z + position_delta) * (highs.x * 2.0 + highs.y) * pow(2.0, 15.0) + z;\n        #ifdef HAS_TERRAIN_ALTITUDE\n            altitude += aTerrainAltitude * 100.0;\n        #endif\n        altitude += minAltitude * 100.0;\n        return vec3(pos, altitude);\n    }\n#endif"),vv(),fD){const e=BA.VERSION;if(e.indexOf("1.0.0-beta")>=0||e.indexOf("1.0.0-alpha")>=0){na("@maptalks/vt",fD.inject(JL))}else na("@maptalks/vt",(function(){return fD.inject(JL)}))}else na("@maptalks/vt",JL);"undefined"!=typeof console&&console.log("@maptalks/vt v0.101.1");for(
/*!
  * Contains code from THREE.js
  * MIT License
  * https://github.com/mrdoob/three.js
  */
var hX=[],lX=0;lX<6;lX++)hX[lX]=[];var uX=[];function cX(e,n,i){bX(e);for(var o=0;o<6;o++){var s=hX[o];if(uX[0]=s[0]>0?n[1][0]:n[0][0],uX[1]=s[1]>0?n[1][1]:n[0][1],uX[2]=s[2]>0?n[1][2]:n[0][2],CX(s,uX)<0)return!1}return!0}var AX=3,fX=4,dX=5,pX=6,gX=7,mX=8,yX=9,vX=10,_X=11;function xX(e,n){var i=n,o=n,s=e[0],a=e[1],h=e[2],l=Math.abs(s*o[AX]+a*o[fX]+h*o[dX])+Math.abs(s*o[pX]+a*o[gX]+h*o[mX])+Math.abs(s*o[yX]+a*o[vX]+h*o[_X]),c=CX(e,i);return!(c<=-l)}function bX(e){var n=e[0],i=e[1],o=e[2],s=e[3],a=e[4],h=e[5],l=e[6],c=e[7],A=e[8],f=e[9],d=e[10],p=e[11],g=e[12],v=e[13],w=e[14],C=e[15];wX(hX[0],s-n,c-a,p-A,C-g),wX(hX[1],s+n,c+a,p+A,C+g),wX(hX[2],s+i,c+h,p+f,C+v),wX(hX[3],s-i,c-h,p-f,C-v),wX(hX[4],s-o,c-l,p-d,C-w),wX(hX[5],s+o,c+l,p+d,C+w)}function wX(e,n,i,o,s){var a=1/Math.sqrt(n*n+i*i+o*o);return e[0]=n*a,e[1]=i*a,e[2]=o*a,e[3]=s*a,e}function CX(e,n){return e[0]*n[0]+e[1]*n[1]+e[2]*n[2]+e[3]}
/*!
   * @maptalks/3dtiles v0.102.1
   * LICENSE : UNLICENSED
   * (c) 2016-2024 maptalks.org
   */const PX="${",MX=`function(t){\n/*!\n   * @maptalks/gltf-loader v0.98.4\n   * LICENSE : UNLICENSED\n   * (c) 2016-2024 maptalks.org\n   */\nvar e="undefined"!=typeof Float32Array?Float32Array:Array;function n(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],c=e[5],u=e[6],f=e[7],l=e[8],h=e[9],d=e[10],y=e[11],m=e[12],b=e[13],p=e[14],g=e[15],w=n[0],v=n[1],M=n[2],A=n[3];return t[0]=w*r+v*a+M*l+A*m,t[1]=w*i+v*c+M*h+A*b,t[2]=w*s+v*u+M*d+A*p,t[3]=w*o+v*f+M*y+A*g,w=n[4],v=n[5],M=n[6],A=n[7],t[4]=w*r+v*a+M*l+A*m,t[5]=w*i+v*c+M*h+A*b,t[6]=w*s+v*u+M*d+A*p,t[7]=w*o+v*f+M*y+A*g,w=n[8],v=n[9],M=n[10],A=n[11],t[8]=w*r+v*a+M*l+A*m,t[9]=w*i+v*c+M*h+A*b,t[10]=w*s+v*u+M*d+A*p,t[11]=w*o+v*f+M*y+A*g,w=n[12],v=n[13],M=n[14],A=n[15],t[12]=w*r+v*a+M*l+A*m,t[13]=w*i+v*c+M*h+A*b,t[14]=w*s+v*u+M*d+A*p,t[15]=w*o+v*f+M*y+A*g,t}function r(){var t=new e(3);return e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function i(t,n,r){var i=new e(3);return i[0]=t,i[1]=n,i[2]=r,i}function s(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function o(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function a(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function c(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function u(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t}function f(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*s+n[12]*o,t[1]=n[1]*r+n[5]*i+n[9]*s+n[13]*o,t[2]=n[2]*r+n[6]*i+n[10]*s+n[14]*o,t[3]=n[3]*r+n[7]*i+n[11]*s+n[15]*o,t}function l(){var t=new e(4);return e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),r(),function(){var t;t=new e(4),e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var h,d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t};r(),i(1,0,0),i(0,1,0),l(),l(),h=new e(9),e!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[5]=0,h[6]=0,h[7]=0),h[0]=1,h[4]=1,h[8]=1;let y=0;function m(t){return null==t}function b(t){return!m(t)}function p(t){return!m(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}function g(t){for(let e=1;e<arguments.length;e++){const n=arguments[e];for(const e in n)t[e]=n[e]}return t}function w(t){switch(t){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array}throw new Error("unsupported bufferView's component type: "+t)}function v(t){return 0===t.indexOf("data:")&&t.indexOf("base64,")>0}function M(t){const e=function(t){return"undefined"!=typeof self?self.atob(t):window.atob(t)}(t.substring(t.indexOf(",")+1)),n=e.length,r=new Uint8Array(n);for(let t=0;t<n;t++)r[t]=e.charCodeAt(t);return r.buffer}const A=[],T=[],_=[],k=[0,0,0],O=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}([]),x=[1,1,1];function S(t,e,n,r,i,s,o){const a=w(o),c=a.BYTES_PER_ELEMENT;if((0===i||i===r*c)&&s%c==0){const i=new a(e,s,n*r);return t.set(i),t}0===i&&(i=r*c);const u=new Uint8Array(r*c);for(let o=0;o<n;o++){let n=null;const f=new Uint8Array(e,i*o+s,r*c);u.set(f),n=new a(u.buffer,0,r);for(let e=0;e<r;e++)t[o*r+e]=n[e]}return t}const I="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;function E(t,e,n){const r=new Uint8Array(t,e,n);return I.decode(r)}const C={get:function(t,e={},n){e||(e={});const r=new AbortController,i=r.signal,s=g({},e);s.signal=i,s.method||(s.method="GET"),s.referrerPolicy=s.referrerPolicy||"origin","undefined"==typeof window||s.referrer||(s.referrer=window.location.href),n&&(t=n(t));const o=fetch(t,s).then((t=>{const n=this.t(t,e.responseType);return n.message?n:n.then((n=>"arraybuffer"===e.responseType?{data:n,cacheControl:t.headers.get("Cache-Control"),expires:t.headers.get("Expires"),contentType:t.headers.get("Content-Type")}:n)).catch((t=>{if(!t.code||t.code!==DOMException.ABORT_ERR)throw t}))})).catch((t=>{if(!t.code||t.code!==DOMException.ABORT_ERR)throw t}));return o.xhr=r,o},t:(t,e)=>200!==t.status?{status:t.status,statusText:t.statusText,message:\`incorrect http request with status code(${PX}t.status}): ${PX}t.statusText}\`}:"arraybuffer"===e?t.arrayBuffer():"json"===e?t.json():t.text(),getArrayBuffer:(t,e={},n)=>(e||(e={}),e.responseType="arraybuffer",C.get(t,e,n)),getJSON:function(t,e={},n){return e&&e.jsonp?C.jsonp(t):((e=e||{}).responseType="json",C.get(t,e,n))},jsonp:function(t){const e="_maptalks_jsonp_"+y++;t.match(/\\?/)?t+="&callback="+e:t+="?callback="+e;let n=document.createElement("script");return n.type="text/javascript",n.src=t,new Promise((t=>{window[e]=function(r){document.getElementsByTagName("head")[0].removeChild(n),n=null,delete window[e],t(r)},document.getElementsByTagName("head")[0].appendChild(n)}))}};class U{constructor(t,e,n,r,i){this.i=t,this.decoders=e,this.o=n,this.images={},this.u={},this.h=r||{},this.m=i}requestImageFromBufferURI(t,e,n){if(this.buffers[t.id]){const r=this.buffers[t.id],i=this.p(e,r);return this.getImageByBuffer(i,n)}if(this.u[t.id])return this.u[t.id].then((()=>{const r=this.buffers[t.id],i=this.p(e,r);return this.getImageByBuffer(i,n)}));if(v(t.uri)){const r=this.buffers[t.id]=M(t.uri),i=this.p(e,r);return this.getImageByBuffer(i,n)}let r;const i=t.uri.indexOf("blob:")>=0;return r=t.uri.indexOf("://")>0||i?t.uri:this.rootPath+"/"+t.uri,this.u[t.id]=C.getArrayBuffer(r,this.h,this.m).then((r=>{const i=this.buffers[t.id]=r.data,s=this.p(e,i);return this.getImageByBuffer(s,n)}))}getImageByBuffer(t,e){if(this.images[e.id])return Promise.resolve(this.images[e.id]);const n=this.decoders;return n[e.mimeType]?n[e.mimeType](t,{supportedFormats:this.o}):"image/crn"===e.mimeType||"image/ktx2"===e.mimeType||"image/cttf"===e.mimeType?(console.warn("missing transcoder for "+e.mimeType,", visit https://maptalks.com/docs/transcoders for details"),Promise.resolve(null)):this.v(e.id,t)}requestExternalImage(t){if(this.images[t.id])return Promise.resolve(this.images[t.id]);const e=0===t.uri.indexOf("data:image/")?t.uri:this.rootPath+"/"+t.uri;return this.u[t.id]?this.u[t.id].then((()=>this.images[t.id])):this.u[t.id]=this.v(t.id,e)}v(t,e){return new Promise(((n,r)=>{let i=e;this.m&&(i=this.m(e)),this.i(i,this.h,((i,s)=>{i?r(i):(URL.revokeObjectURL(e),this.images[t]=s,n(this.images[t]))}))}))}}const F=["SCALAR",1,"VEC2",2,"VEC3",3,"VEC4",4,"MAT2",4,"MAT3",9,"MAT4",16],N=[];class P{constructor(t,e,n,r,i){this.rootPath=t,this.gltf=e,this.M=!1,this.glbBuffer=n,this.buffers={},this.requests={},this.accessors={},this.A(),this.h=r,this.m=i}T(t,e){const n=this.gltf,r=n.accessors[e];if(void 0===r.bufferView)return this.accessors[r.id]=this._(t,e,null,0),Promise.resolve(this.accessors[r.id]);if(r&&this.accessors[r.id])return Promise.resolve(this.accessors[r.id]);const i=n.bufferViews[r.bufferView];return this.k(i).then((n=>{const{buffer:i,byteOffset:s}=n;return this.accessors[r.id]=this._(t,e,i,s)}))}k(t){const e=this.gltf.buffers[t.buffer];if(this.buffers[e.id]){const t=this.buffers[e.id];return Promise.resolve({buffer:t,byteOffset:0})}if(this.requests[e.id])return this.requests[e.id].then((()=>{const t=this.buffers[e.id];return Promise.resolve({buffer:t,byteOffset:0})}));if("binary_glTF"!==t.buffer&&"KHR_binary_glTF"!==t.buffer&&e.uri){if(v(e.uri)){const t=this.buffers[e.id]=M(e.uri);return Promise.resolve({buffer:t,byteOffset:0})}let t;const n=e.uri.indexOf("blob:")>=0;return t=e.uri.indexOf("://")>0||n?e.uri:this.rootPath+"/"+e.uri,this.requests[e.id]=C.getArrayBuffer(t,this.h,!n&&this.m).then((r=>(n&&URL.revokeObjectURL(t),{buffer:this.buffers[e.id]=r.data,byteOffset:0})))}return Promise.resolve({buffer:this.glbBuffer.buffer,byteOffset:this.glbBuffer.byteOffset})}_(t,e,n,r=0){const i=this.gltf,s=i.accessors[e],o=void 0!==s.bufferView?i.bufferViews[s.bufferView]:{},a=(o.byteOffset||0)+r,c=this.O(s.type),u=w(s.componentType),l=o.byteStride||0,h={array:void 0,name:t,accessorName:e,byteLength:s.count*c*u.BYTES_PER_ELEMENT,componentType:s.componentType,count:s.count,type:s.type,itemSize:c,max:s.max,min:s.min,extensions:s.extensions};if(s.min&&(h.min=s.min),s.max&&(h.max=s.max),n)if(this.M)h.byteStride=l,h.byteOffset=a+(s.byteOffset||0),!l||l===c*u.BYTES_PER_ELEMENT||"indices"===t||"input"===t||"output"===t||t.indexOf("morph")>=0?(h.array=this.S(n,s.count,c,a+(s.byteOffset||0),u),h.array.buffer.byteLength===h.byteLength&&(h.byteOffset=0)):h.array=new Uint8Array(n,a,o.byteLength);else if(s.interleaved){h.byteStride=0,h.byteOffset=0;const t=new u(s.count*c);if(h.array=S(t,n,s.count,c,l,a+(s.byteOffset||0),s.componentType),h.extensions&&h.extensions.WEB3D_quantized_attributes&&c>2){const t=new Float32Array(h.array.length),{decodeMatrix:e}=h.extensions.WEB3D_quantized_attributes;for(let n=0;n<h.array.length;n+=c){N[0]=h.array[n],N[1]=h.array[n+1],N[2]=h.array[n+2],N[3]=1;const r=f(N,N,e);t[n]=r[0],t[n+1]=r[1],t[n+2]=r[2]}h.componentType=5126,h.array=t}}else h.byteStride=0,h.array=this.S(n,s.count,c,a+(s.byteOffset||0),u),h.byteOffset=h.array.byteOffset;else{h.array=new u(s.count);const t=h.min||h.max;t&&(h.array[0]=t[0],h.array[1]=t[1],h.array[2]=t[2])}return h}A(){const t=this.gltf.accessors;if(Array.isArray(t))for(let e=0;e<t.length;e++)for(let n=0;n<t.length;n++)e!==n&&t[e].bufferView===t[n].bufferView&&(t[e].interleaved=t[n].interleaved=!0);else for(const e in t)for(const n in t)e!==n&&t[e].bufferView===t[n].bufferView&&(t[e].interleaved=t[n].interleaved=!0)}S(t,e,n,r,i){return r%i.BYTES_PER_ELEMENT!=0&&(t=t.slice(r,r+e*n*i.BYTES_PER_ELEMENT),r=0),new i(t,r,n*e)}O(t){const e=F.indexOf(t);return F[e+1]}requestKHRTechniquesWebgl(t){const{shaders:e}=t,n=e.map((t=>{if(void 0!==t.bufferView){const e=this.gltf.bufferViews[t.bufferView],{byteLength:n}=e;return this.k(e).then((r=>{const{buffer:i,byteOffset:s}=r,o=E(i,s+(e.byteOffset||0),n);return t.content=o,t}))}if(t.uri){if(v(t.uri)){const e=M(t.uri),n=E(e,0,e.byteLength);return t.content=n,Promise.resolve(t)}{const e=this.rootPath+"/"+t.uri;return C.get(e,this.h,this.m).then((e=>(t.content=e,t)))}}return Promise.resolve(t)}));return Promise.all(n).then((()=>t))}}class B extends U{constructor(t,e,n,r,i,s,o,a){super(r,i,s,o,a),this.rootPath=t,this.gltf=e,this.requests={},this.buffers={},this.glbBuffer=n,this.accessor=new P(t,e,n,o,a)}iterate(t,e){const n=this.gltf[e];if(!n)return;let r=0;for(const e in n)t(e,n[e],r++)}createNode(t){const e={};if(b(t.name)&&(e.name=t.name),b(t.children)&&(e.children=t.children),b(t.jointName)&&(e.jointName=t.jointName),b(t.matrix)&&(e.matrix=t.matrix),b(t.rotation)&&(e.rotation=t.rotation),b(t.scale)&&(e.scale=t.scale),b(t.translation)&&(e.translation=t.translation),b(t.extras)&&(e.extras=t.extras),b(t.meshes)&&(e.mesh=t.meshes[0]),e.translation||e.rotation||e.scale){const t=function(t,e){if(e.matrix)return e.matrix;if(e.translation||e.scale||e.rotation){const r=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}(A,e.translation||k),i=function(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,a=r+r,c=i+i,u=n*o,f=r*o,l=r*a,h=i*o,d=i*a,y=i*c,m=s*o,b=s*a,p=s*c;return t[0]=1-l-y,t[1]=f+p,t[2]=h-b,t[3]=0,t[4]=f-p,t[5]=1-u-y,t[6]=d+m,t[7]=0,t[8]=h+b,t[9]=d-m,t[10]=1-u-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(T,e.rotation||O),s=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(_,e.scale||x);return n(s,i,s),n(t,r,s)}return function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(t)}([],e);delete e.translation,delete e.rotation,delete e.scale,e.matrix=t}return e}I(t){const e={};for(const n in t){const r=t[n];let i,s;r.instanceTechnique&&r.instanceTechnique.values?(i=r.instanceTechnique,s=i.values.diffuse):(i=r,s=i.values.tex||i.values.diffuseTex||i.values.diffuse);const o={baseColorTexture:{index:s}};r.name&&(o.name=r.name),r.extensions&&(o.extensions=r.extensions),r.extras&&(o.extras=r.extras),e[n]=o}return e}C(t){if(t.bufferView||t.extensions&&(t.extensions.KHR_binary_glTF||t.extensions.binary_glTF)){const e=t.bufferView?t:t.extensions.KHR_binary_glTF||t.extensions.binary_glTF;t.extensions&&(t.mimeType=e.mimeType,t.width=e.width,t.height=e.height);const n=this.gltf.bufferViews[e.bufferView],r=(n.byteOffset||0)+this.glbBuffer.byteOffset,i=n.byteLength,s=this.buffers[e.bufferView]=new Uint8Array(this.glbBuffer.buffer,r,i);return this.getImageByBuffer(s,t)}return this.requestExternalImage(t)}U(t){const e=this.gltf.textures[t];if(!e)return null;const n=this.gltf.images[e.source];return this.C(n).then((t=>{const r=this.gltf.samplers[e.sampler];return{image:{array:t.data,width:t.width,height:t.height,index:e.source,mimeType:n.mimeType,name:n.name,extras:n.extras},sampler:r}}))}getBaseColorTexture(t){const e=this.gltf.materials[t];let n,r;if(e.instanceTechnique&&e.instanceTechnique.values?(n=e.instanceTechnique,r=n.values.diffuse):(n=e,r=n.values.tex||n.values.diffuseTex||n.values.diffuse),void 0===r||void 0===this.gltf.textures)return null;const i=this.gltf.textures[r];if(!i)return null;const s=this.gltf.samplers[i.sampler];return{format:i.format||6408,internalFormat:i.internalFormat||6408,type:i.type||5121,sampler:s,source:this.gltf.images[i.source]}}getMaterial(){return null}getAnimations(){return null}}const D=9729;class R extends U{constructor(t,e,n,r,i,s,o,a){super(r,i,s,o,a),this.rootPath=t,this.gltf=e,this.glbBuffer=n,this.buffers={},this.requests={},this.accessor=new P(t,e,n,o,a)}iterate(t,e){const n=this.gltf[e];if(n)for(let e=0;e<n.length;e++)t(e,n[e],e)}createNode(t){const e={};return g(e,t),!b(t.weights)&&this.gltf.meshes&&b(e.mesh)?e.weights=this.gltf.meshes[e.mesh].weights:t.weights&&(e.weights=t.weights),e}U(t){const e=this.gltf.textures[t];if(!e)return null;let n=e.source;if(e.extensions&&e.extensions.EXT_texture_webp&&(n=e.extensions.EXT_texture_webp.source),!b(n))return null;const r=this.gltf.images[n];return this.C(r).then((t=>{if(!t)return null;const n={image:{array:t.data,mipmap:t.mipmap,width:t.width,height:t.height,index:e.source,mimeType:r.mimeType,name:r.name,extensions:r.extensions,extras:r.extras}};g(n,e);const i=b(e.sampler)?this.gltf.samplers[e.sampler]:void 0;if(i&&(n.sampler=i,n.sampler.magFilter=i.magFilter||D,n.sampler.minFilter=i.minFilter||9987,n.sampler.wrapS=i.wrapS||10497,n.sampler.wrapT=i.wrapT||10497),"image/ktx2"===n.image.mimeType&&!n.image.mipmap&&n.sampler&&n.sampler.minFilter!==D&&9728!==n.sampler.minFilter){const t=n.sampler.minFilter;n.sampler.minFilter=9984===t||9986===t?9728:D}return t.format&&(n.format=t.format),n}))}C(t){if(!b(t.bufferView))return this.requestExternalImage(t);{const e=this.gltf.bufferViews[t.bufferView],n=this.gltf.buffers[e.buffer];if(n.uri)return this.requestImageFromBufferURI(n,e,t);if(this.glbBuffer)return this.F(e,t)}return null}F(t,e){const n=this.p(t,this.glbBuffer.buffer,this.glbBuffer.byteOffset);return this.getImageByBuffer(n,e)}p(t,e,n){n=n||0;const r=(t.byteOffset||0)+n,i=t.byteLength;return new Uint8Array(e,r,i)}N(t,e){const n=new Array(t.byteLength);for(let e=0;e<t.byteLength;e++)n[e]=String.fromCharCode(t[e]);n.join("");const r="data:"+(e=e||"image/png")+";base64,"+function(t){return"undefined"!=typeof self?self.btoa(t):window.btoa(t)}(unescape(encodeURIComponent(n)));return r}getAnimations(t){const e=[];return t.forEach((t=>{e.push(this.getSamplers(t.samplers))})),Promise.all(e).then((e=>{for(let n=0;n<e.length;n++)t[n].samplers=e[n];return t}))}getSamplers(t){const e=[];for(let n=0;n<t.length;n++)(b(t[n].input)||b(t[n].output))&&(e.push(this.accessor.T("input",t[n].input)),e.push(this.accessor.T("output",t[n].output)));return Promise.all(e).then((e=>{for(let n=0;n<e.length/2;n++)t[n].input=e[2*n],t[n].output=e[2*n+1],t[n].interpolation||(t[n].interpolation="LINEAR");return t}))}}const L="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;class j{static read(t,e=0,n=0){n||(n=t.byteLength);const r=new DataView(t,e,n),i=r.getUint32(4,!0);if(1===i)return j.readV1(r,e);if(2===i)return j.readV2(t,e);throw new Error("Unsupported glb version : "+i)}static readV1(t,e){const n=t.getUint32(8,!0),r=t.getUint32(12,!0);if(n!==t.byteLength)throw new Error("Length in GLB header is inconsistent with glb's byte length.");const i=z(t.buffer,20+e,r);return{json:JSON.parse(i),glbBuffer:{byteOffset:20+e+r,buffer:t.buffer,byteLength:n}}}static readV2(t,e){let n,r,i;const s=new DataView(t,e+12);let o=0;for(;o+8<s.byteLength;){const a=s.getUint32(o,!0);o+=4;const c=s.getUint32(o,!0);if(o+=4,1313821514===c)n=z(t,e+12+o,a);else if(5130562===c){i=e+12+o,r=a;break}o+=a}return{json:JSON.parse(n),glbBuffer:{byteOffset:i,buffer:t,byteLength:r}}}}function z(t,e,n){if(L){const r=new Uint8Array(t,e,n);return L.decode(r)}return function(t){const e=t.length;let n="";for(let r=0;r<e;){let i=t[r++];if(128&i){let n=q[i>>3&7];if(!(64&i)||!n||r+n>e)return null;for(i&=63>>n;n>0;n-=1){const e=t[r++];if(128!=(192&e))return null;i=i<<6|63&e}}n+=String.fromCharCode(i)}return n}(new Uint8Array(t,e,n))}const q=[1,1,1,1,2,2,3,0],V=[0,0,0],G=[0,0,0,1],$=[1,1,1],X={TRANSLATION:[0,0,0],ROTATION:[0,0,0,1],SCALE:[1,1,1]},H={PREVIOUS:null,NEXT:null,PREINDEX:null,NEXTINDEX:null,INTERPOLATION:null},J={P(t,e,n,r,i,o,a,c){const u=b(t)?e.animations:[e.animations[0]],f={};for(let e=0;e<u.length;e++){const l=u[e],h=l.name||e;if(b(t)&&h!==t)continue;const y=l.channelsMap[n];if(y)for(let t=0;t<y.length;t++){const e=y[t];"translation"===e.target.path?(this.B(i,l.samplers[e.sampler],r,1),f.translation=s(V,i)):"rotation"===e.target.path?(this.D(o,l.samplers[e.sampler],r,1),f.rotation=d(G,o)):"scale"===e.target.path?(this.B(a,l.samplers[e.sampler],r,1),f.scale=s($,a)):"weights"===e.target.path&&c&&(this.B(c,l.samplers[e.sampler],r,c.length),f.weights=c)}}return f},B(t,e,n,r){switch(e.interpolation){case"LINEAR":{const i=this.R(H,e,n,1*r);i&&(t=function(t,e,n,r){for(let i=0;i<t.length;i++)t[i]=e[i]+r*(n[i]-e[i]);return t}(t,i.PREVIOUS,i.NEXT,i.INTERPOLATION));break}case"STEP":{const i=this.R(H,e,n,1*r);i&&(t=function(t,e){for(let n=0;n<t.length;n++)t[n]=e[n];return t}(t,...i.PREVIOUS));break}case"CUBICSPLINE":{const i=this.R(H,e,n,3*r);i&&(t=this.L(t,i,e.input.array,3*r));break}}return t},D(t,e,n){switch(e.interpolation){case"LINEAR":{const r=this.R(H,e,n,1);r&&function(t,e,n,r){var i,s,o,a,c,u=e[0],f=e[1],l=e[2],h=e[3],d=n[0],y=n[1],m=n[2],b=n[3];(s=u*d+f*y+l*m+h*b)<0&&(s=-s,d=-d,y=-y,m=-m,b=-b),1-s>1e-6?(i=Math.acos(s),o=Math.sin(i),a=Math.sin((1-r)*i)/o,c=Math.sin(r*i)/o):(a=1-r,c=r),t[0]=a*u+c*d,t[1]=a*f+c*y,t[2]=a*l+c*m,t[3]=a*h+c*b}(t,r.PREVIOUS,r.NEXT,r.INTERPOLATION);break}case"STEP":{const r=this.R(H,e,n,1);r&&(t=u(t,...r.PREVIOUS));break}case"CUBICSPLINE":{const r=this.R(H,e,n,3);if(r){for(let t=0;t<r.PREVIOUS.length;t++)r.PREVIOUS[t]=Math.acos(r.PREVIOUS[t]),r.NEXT[t]=Math.acos(r.NEXT[t]);t=this.L(t,r,e.input.array,3);for(let e=0;e<t.length;e++)t[e]=Math.cos(t[e])}break}}return t},j(t,e){const n=t.length;let r,i,s,o=0,a=n-1,c=Math.floor((o+a)/2);for(;o<=n-1&&a>=0;){if(o===a)return null;if(t[c]<=e&&e<=t[c+1]){const n=t[c];return r=c,i=c+1,s=(e-n)/(t[c+1]-n),{preIndx:r,nextIndex:i,interpolation:s}}e<t[c]?(a=c,c=Math.floor((o+a)/2)):t[c+1]<e&&(o=c,c=Math.floor((o+a)/2))}return null},R(t,e,n,r){const i=e.input.array,s=e.output.array,o=e.output.itemSize;(n<i[0]||n>i[i.length-1])&&(n=Math.max(i[0],Math.min(i[i.length-1],n))),n===i[i.length-1]&&(n=i[0]);const a=this.j(i,n);if(!a||!a.nextIndex)return null;const{preIndx:c,nextIndex:u,interpolation:f}=a;t.PREINDEX=c,t.NEXTINDEX=u,t.INTERPOLATION=f;const l=o*r;return t.PREVIOUS=s.subarray(t.PREINDEX*l,(t.PREINDEX+1)*l),t.NEXT=s.subarray(t.NEXTINDEX*l,(t.NEXTINDEX+1)*l),t},L(t,e,n,r){const i=e.INTERPOLATION,s=n[e.PREINDEX],o=n[e.NEXTINDEX];for(let n=0;n<3;n++){const a=e.PREVIOUS[r+n],c=(o-s)*e.PREVIOUS[2*r+n],u=e.NEXT[3+n],f=(o-s)*e.NEXT[n],l=(2*Math.pow(i,3)-3*Math.pow(i,2)+1)*a+(Math.pow(i,3)-2*Math.pow(i,2)+i)*c+(2*-Math.pow(i,3)+3*Math.pow(i,2))*u+(Math.pow(i,3)-Math.pow(i,2))*f;t[n]=l}return t},getAnimationClip(t,e,n,r){const i=t.nodes[e]&&t.nodes[e].weights;return o(V,...X.TRANSLATION),u(G,...X.ROTATION),o($,...X.SCALE),this.P(r,t,e,n,V,G,$,i)},getTimeSpan(t){if(!t.animations)return null;if(t.timeSpan)return t.timeSpan;const e=t.animations;return t.timeSpan={},e.forEach(((e,n)=>{let r=-1/0,i=1/0;const s=e.channels;for(let t=0;t<s.length;t++){const n=s[t],o=e.samplers[n.sampler].input.array;o[o.length-1]>r&&(r=o[o.length-1]),o[0]<i&&(i=o[0])}const o=e.name||n;t.timeSpan[o]={max:r,min:i}})),t.timeSpan},getTimeSpanByName(t,e){const n=this.getTimeSpan(t);return n?b(e)?n[e]:n[Object.keys(n)[0]]:null}};let K=!1;if("undefined"!=typeof OffscreenCanvas){let t;try{t=new OffscreenCanvas(2,2).getContext("2d")}catch(Je){}t&&"undefined"!=typeof createImageBitmap&&(K=!0)}const Y="undefined"==typeof document?null:document.createElement("canvas");class Q{constructor(t,e,n){if(this.options=n||{},this.options.decoders||(this.options.decoders={}),this.h=this.options.fetchOptions||{},e.buffer instanceof ArrayBuffer){const{json:n,glbBuffer:r}=j.read(e.buffer,e.byteOffset,e.byteLength);this.q(t,n,r)}else this.q(t,e);this.V=new P(this.rootPath,this.gltf,this.glbBuffer,this.h,this.options.urlModifier),this.G()}G(){const t=this.gltf.extensionsRequired;if(t){if(t.indexOf("KHR_draco_mesh_compression")>=0&&!this.options.decoders.draco)throw new Error("KHR_draco_mesh_compression is required but @maptalks/transcoders.draco is not loaded");if(t.indexOf("KHR_texture_basisu")>=0&&!this.options.decoders["image/ktx2"])throw new Error("KHR_texture_basisu is required but @maptalks/transcoders.ktx2 is not loaded");if(t.indexOf("EXT_meshopt_compression")>=0)throw new Error("EXT_meshopt_compression extension is not supported yet.")}}$(){const t=this.gltf.extensions;return t&&t.KHR_techniques_webgl?this.V.requestKHRTechniquesWebgl(t.KHR_techniques_webgl).then((e=>(t.KHR_techniques_webgl=e,t))):Promise.resolve(t)}load(t){t=t||{};const e=this.X(t),n=this.H(),r=this.J(),i=this.$();return Promise.all([e,n,r,i]).then((t=>(t[0].animations=t[1],t[0].textures=t[2],t[0].extensions=t[3],t[0].transferables=this.transferables||[],this.createChannelsMap(t[0]),t[0])))}createChannelsMap(t){const e=t.animations;if(e)for(let t=0;t<e.length;t++){const n=e[t];n.channelsMap={};for(let t=0;t<n.channels.length;t++){const e=n.channels[t];n.channelsMap[e.target.node]||(n.channelsMap[e.target.node]=[]),n.channelsMap[e.target.node].push(e)}}}getExternalResources(){const t=[];if(this.gltf){const{buffers:e,images:n}=this.gltf;for(let n=0;n<e.length;n++)e[n].uri&&e[n].uri.indexOf("data:application/octet-stream;base64")<0&&t.push({type:"buffer",uri:e[n].uri});for(let e=0;e<n.length;e++)n[e].uri&&n[e].uri.indexOf("data:image/")<0&&t.push({type:"image",uri:n[e].uri})}return t}static getAnimationClip(t,e,n,r){return J.getAnimationClip(t,e,n,r)}static getAnimationTimeSpan(t,e){return J.getTimeSpanByName(t,e)}static getTypedArrayCtor(t){return w(t)}static readInterleavedArray(t,e,n,r,i,s,o){return S(t,e,n,r,i,s,o)}q(t,e,n){this.gltf=e,this.glbBuffer=n,this.version=e.asset?+e.asset.version:1,this.rootPath=t,this.buffers={},this.requests={},this.options.requestImage=K?it.bind(this):this.options.requestImage||W,this.options.transferable&&(this.transferables=[]),2===this.version?(this.adapter=new R(t,e,n,this.options.requestImage,this.options.decoders||{},this.options.supportedFormats||{},this.h,this.options.urlModifier),this.adapter.iterate(((t,e,n)=>{e.id="buffer_"+n}),"buffers"),this.adapter.iterate(((t,e,n)=>{e.id="image_"+n}),"images"),this.adapter.iterate(((t,e,n)=>{e.id="accessor_"+n}),"accessors")):(this.adapter=new B(t,e,n,this.options.requestImage,this.options.decoders||{},this.options.supportedFormats||{},this.h,this.options.urlModifier),this.adapter.iterate(((t,e,n)=>{e.id="accessor_"+n}),"accessors"),this.adapter.iterate(((t,e,n)=>{e.id="image_"+n}),"images"))}K(t,e){if(t.children&&t.children.length>0){if(!("number"==typeof(n=t.children[0])&&isFinite(n)||p(t.children[0])))return t;const r=t.children.map((t=>{const n=e[t];return n.nodeIndex=t,this.K(n,e)}));t.children=r}var n;return t}X(t){return this.Y(t).then((t=>{const e=this.scenes=[];let n;for(const e in t)t[e]=this.K(t[e],t),t[e].nodeIndex=Number(e)?Number(e):e;this.adapter.iterate(((r,i,s)=>{const o={};i.name&&(o.name=i.name),i.nodes&&(o.nodes=i.nodes.map((e=>t[e]))),this.gltf.scene===r&&(n=s),e.push(o)}),"scenes");const r={textures:this.gltf.textures,asset:this.gltf.asset,scene:n,scenes:e,nodes:t,meshes:this.meshes,materials:this.gltf.materials,skins:this.skins,extensionsRequired:this.gltf.extensionsRequired,extensionsUsed:this.gltf.extensionsUsed};if(this.gltf.extensions&&(r.extensions=this.gltf.extensions),1===this.version){const t=this.adapter.I(this.gltf.materials);r.materials=t}return delete this.gltf.buffers,r.json=this.gltf,r}))}Y(t){return this.W(t).then((()=>{const t=this.nodes={};return this.adapter.iterate(((e,n)=>{const r=this.adapter.createNode(n,this.meshes,this.skins);t[e]=r}),"nodes"),t}))}Z(){this.skins=[];const t=[];return this.adapter.iterate(((e,n,r)=>{t.push(this.tt(n).then((t=>{t.index=r,this.skins.push(t)})))}),"skins"),t}tt(t){const e=t.inverseBindMatrices;return this.adapter.accessor.T("inverseBindMatrices",e).then((e=>(t.inverseBindMatrices=e,e&&e.buffer&&this.transferables&&this.transferables.indexOf(e.buffer)<0&&this.transferables.push(e.buffer),t)))}H(){const t=this.gltf.animations;return b(t)?this.adapter.getAnimations(t):null}W(t){this.meshes={};let e=[];return this.adapter.iterate(((n,r,i)=>{e.push(this.et(r,t).then((t=>{t.index=i,this.meshes[n]=t})))}),"meshes"),e=e.concat(this.Z()),Promise.all(e)}et(t,e){const n=t.primitives.map((t=>this.nt(t,e))).filter((t=>!!t));return Promise.all(n).then((e=>{const n={};return g(n,t),n.primitives=e,n}))}J(){const t=this.gltf.textures;if(!t)return null;const e=[];for(const n in t)e.push(this.adapter.U(n));return Promise.all(e).then((e=>{if(this.transferables)for(let t=0;t<e.length;t++){const n=e[t]&&e[t].image.array;if(n){let t;t=n instanceof ImageBitmap?n:n.buffer,t&&this.transferables.indexOf(t)<0&&this.transferables.push(t)}}if(!Array.isArray(t)){const n={},r=Object.keys(t);for(let t=0;t<e.length;t++)e[t]&&(n[r[t]]=e[t]);return n}return e}))}nt(t,e){let n;const r=[],i=t.extensions;if(b(t.targets))for(let e=0;e<t.targets.length;e++){const n=t.targets[e];for(const t in n){const i=this.adapter.accessor.T(\`morphTargets_${PX}t}_${PX}e}\`,n[t]);i&&r.push(i)}}if(i&&i.KHR_draco_mesh_compression){if(!this.options.decoders.draco&&(!this.gltf.extensionsRequired||!this.gltf.extensionsRequired.indexOf("KHR_draco_mesh_compression")<0))return null;const t=this.options.decoders.draco,{bufferView:s,attributes:o}=i.KHR_draco_mesh_compression,a=this.gltf.bufferViews[s],c=this.V.k(a).then((n=>{const{buffer:r,byteOffset:i}=n;let{byteOffset:s}=a;const c=a.byteLength;s||(s=0);const u=new DataView(r,i+s,c),f={attributes:o,useUniqueIDs:!1,skipAttributeTransform:e.skipAttributeTransform};return t(u,f).then((t=>{const e=Object.values(t.attributes);return t.indices&&e.push(t.indices),e}))}));r.push(c),n=Promise.all(r)}else{const e=t.attributes;for(const t in e){const n=this.adapter.accessor.T(t,e[t]);n&&r.push(n)}if(b(t.indices)){const e=this.adapter.accessor.T("indices",t.indices);e&&r.push(e)}n=Promise.all(r)}return n.then((e=>{if(i&&i.KHR_draco_mesh_compression){const n=t.targets?t.targets.length:0;e[n]=e[n].concat(e.slice(0,n)),e=e[n]}let n,r;const s={attributes:e.reduce(((t,e)=>{if("indices"===e.name)n=e;else if(e.name.indexOf("morphTargets_")>-1)r=r||{},r[e.name.slice(13)]=e;else{if(!("POSITION"!==e.name||e.min&&e.max)){const t=[1/0,1/0,1/0],n=[-1/0,-1/0,-1/0],{itemSize:r,array:i}=e,s=i.length/r;for(let e=0;e<s;e++)for(let s=0;s<r;s++){const o=e*r+s;i[o]<t[s]&&(t[s]=i[o]),i[o]>n[s]&&(n[s]=i[o])}if(e.quantization){const r=e.quantization,i=r.range/(1<<r.quantizationBits),s=r.minValues;c(t,t,i),a(t,t,s),c(n,n,i),a(n,n,s)}e.min=t,e.max=n}t[e.name]=e}return this.transferables&&e.array.buffer&&this.transferables.indexOf(e.array.buffer)<0&&this.transferables.push(e.array.buffer),t}),{}),material:t.material};return n&&(s.indices=n),r&&(s.morphTargets=r),s.mode=b(t.mode)?t.mode:4,b(t.extras)&&(s.extras=t.extras),s}))}}function W(t,e,n){const r=new Image;r.crossOrigin="",r.onload=()=>{if(!Y)return void n(new Error("There is no canvas to draw image!"));Y.width=r.width,Y.height=r.height;const t=Y.getContext("2d",{willReadFrequently:!0});t.drawImage(r,0,0,r.width,r.height);const e=t.getImageData(0,0,r.width,r.height),i={width:r.width,height:r.height,data:new Uint8Array(e.data)};n(null,i)},r.onerror=function(t){n(t)},r.src=t}const Z=[],tt=[],et=30;let nt,rt;function it(t,e,n){nt||(nt=new OffscreenCanvas(2,2),rt=nt.getContext("2d",{willReadFrequently:!0}));let r=null;if(p(t))this.options.urlModifier&&(t=this.options.urlModifier(t)),Z.push([t,e,n,this]),st();else{const e=new Blob([t]);r=createImageBitmap(e),r.then(ot.bind(this)).then((t=>{n(null,t)})).catch((t=>{console.warn(t),n(t)}))}}function st(){if(!Z.length||tt.length>et)return;const t=Z.shift(),[e,n,r,i]=t;tt.push(t),fetch(e,n).then((t=>t.arrayBuffer())).then((t=>{const e=new Blob([new Uint8Array(t)]);return createImageBitmap(e)})).then(ot.bind(i)).then((e=>{r.call(i,null,e);const n=tt.indexOf(t);tt.splice(n,1),st()})).catch((e=>{console.warn(e),r.call(i,e);const n=tt.indexOf(t);tt.splice(n,1),st()}))}function ot(t){let{width:e,height:n}=t;at(e)||(e=ct(e)),at(n)||(n=ct(n));const r=this.options.maxTextureSize;r&&(e=Math.min(r,e),n=Math.min(r,n)),nt.width=e,nt.height=n,rt.drawImage(t,0,0,e,n),t.close();const i=rt.getImageData(0,0,e,n);return{width:e,height:n,data:new Uint8Array(i.data)}}function at(t){return!(t&t-1)&&0!==t}function ct(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}var ut="undefined"!=typeof Float32Array?Float32Array:Array;function ft(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function lt(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],c=e[5],u=e[6],f=e[7],l=e[8],h=e[9],d=e[10],y=e[11],m=e[12],b=e[13],p=e[14],g=e[15],w=n[0],v=n[1],M=n[2],A=n[3];return t[0]=w*r+v*a+M*l+A*m,t[1]=w*i+v*c+M*h+A*b,t[2]=w*s+v*u+M*d+A*p,t[3]=w*o+v*f+M*y+A*g,w=n[4],v=n[5],M=n[6],A=n[7],t[4]=w*r+v*a+M*l+A*m,t[5]=w*i+v*c+M*h+A*b,t[6]=w*s+v*u+M*d+A*p,t[7]=w*o+v*f+M*y+A*g,w=n[8],v=n[9],M=n[10],A=n[11],t[8]=w*r+v*a+M*l+A*m,t[9]=w*i+v*c+M*h+A*b,t[10]=w*s+v*u+M*d+A*p,t[11]=w*o+v*f+M*y+A*g,w=n[12],v=n[13],M=n[14],A=n[15],t[12]=w*r+v*a+M*l+A*m,t[13]=w*i+v*c+M*h+A*b,t[14]=w*s+v*u+M*d+A*p,t[15]=w*o+v*f+M*y+A*g,t}function ht(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function dt(){var t=new ut(3);return ut!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function yt(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function mt(t,e,n){var r=new ut(3);return r[0]=t,r[1]=e,r[2]=n,r}function bt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function pt(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function gt(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function wt(t,e){var n=e[0],r=e[1],i=e[2],s=n*n+r*r+i*i;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function vt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Mt(t,e,n){var r=e[0],i=e[1],s=e[2],o=n[3]*r+n[7]*i+n[11]*s+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*i+n[8]*s+n[12])/o,t[1]=(n[1]*r+n[5]*i+n[9]*s+n[13])/o,t[2]=(n[2]*r+n[6]*i+n[10]*s+n[14])/o,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var At=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t},Tt=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t},_t=yt;function kt(){var t=new ut(4);return ut!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}dt(),function(){var t,e=(t=new ut(4),ut!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();var Ot;function xt(t){return t&&t.rt&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}dt(),mt(1,0,0),mt(0,1,0),kt(),kt(),Ot=new ut(9),ut!=Float32Array&&(Ot[1]=0,Ot[2]=0,Ot[3]=0,Ot[5]=0,Ot[6]=0,Ot[7]=0),Ot[0]=1,Ot[4]=1,Ot[8]=1;var St={exports:{}},It={exports:{}},Et=function(t){return!(!t||"string"==typeof t)&&(t instanceof Array||Array.isArray(t)||t.length>=0&&(t.splice instanceof Function||Object.getOwnPropertyDescriptor(t,t.length-1)&&"String"!==t.constructor.name))},Ct=Array.prototype.concat,Ut=Array.prototype.slice,Ft=It.exports=function(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n];Et(i)?e=Ct.call(e,Ut.call(i)):e.push(i)}return e};Ft.wrap=function(t){return function(){return t(Ft(arguments))}};var Nt=It.exports,Pt={"aliceblue":[240,248,255],"antiquewhite":[250,235,215],"aqua":[0,255,255],"aquamarine":[127,255,212],"azure":[240,255,255],"beige":[245,245,220],"bisque":[255,228,196],"black":[0,0,0],"blanchedalmond":[255,235,205],"blue":[0,0,255],"blueviolet":[138,43,226],"brown":[165,42,42],"burlywood":[222,184,135],"cadetblue":[95,158,160],"chartreuse":[127,255,0],"chocolate":[210,105,30],"coral":[255,127,80],"cornflowerblue":[100,149,237],"cornsilk":[255,248,220],"crimson":[220,20,60],"cyan":[0,255,255],"darkblue":[0,0,139],"darkcyan":[0,139,139],"darkgoldenrod":[184,134,11],"darkgray":[169,169,169],"darkgreen":[0,100,0],"darkgrey":[169,169,169],"darkkhaki":[189,183,107],"darkmagenta":[139,0,139],"darkolivegreen":[85,107,47],"darkorange":[255,140,0],"darkorchid":[153,50,204],"darkred":[139,0,0],"darksalmon":[233,150,122],"darkseagreen":[143,188,143],"darkslateblue":[72,61,139],"darkslategray":[47,79,79],"darkslategrey":[47,79,79],"darkturquoise":[0,206,209],"darkviolet":[148,0,211],"deeppink":[255,20,147],"deepskyblue":[0,191,255],"dimgray":[105,105,105],"dimgrey":[105,105,105],"dodgerblue":[30,144,255],"firebrick":[178,34,34],"floralwhite":[255,250,240],"forestgreen":[34,139,34],"fuchsia":[255,0,255],"gainsboro":[220,220,220],"ghostwhite":[248,248,255],"gold":[255,215,0],"goldenrod":[218,165,32],"gray":[128,128,128],"green":[0,128,0],"greenyellow":[173,255,47],"grey":[128,128,128],"honeydew":[240,255,240],"hotpink":[255,105,180],"indianred":[205,92,92],"indigo":[75,0,130],"ivory":[255,255,240],"khaki":[240,230,140],"lavender":[230,230,250],"lavenderblush":[255,240,245],"lawngreen":[124,252,0],"lemonchiffon":[255,250,205],"lightblue":[173,216,230],"lightcoral":[240,128,128],"lightcyan":[224,255,255],"lightgoldenrodyellow":[250,250,210],"lightgray":[211,211,211],"lightgreen":[144,238,144],"lightgrey":[211,211,211],"lightpink":[255,182,193],"lightsalmon":[255,160,122],"lightseagreen":[32,178,170],"lightskyblue":[135,206,250],"lightslategray":[119,136,153],"lightslategrey":[119,136,153],"lightsteelblue":[176,196,222],"lightyellow":[255,255,224],"lime":[0,255,0],"limegreen":[50,205,50],"linen":[250,240,230],"magenta":[255,0,255],"maroon":[128,0,0],"mediumaquamarine":[102,205,170],"mediumblue":[0,0,205],"mediumorchid":[186,85,211],"mediumpurple":[147,112,219],"mediumseagreen":[60,179,113],"mediumslateblue":[123,104,238],"mediumspringgreen":[0,250,154],"mediumturquoise":[72,209,204],"mediumvioletred":[199,21,133],"midnightblue":[25,25,112],"mintcream":[245,255,250],"mistyrose":[255,228,225],"moccasin":[255,228,181],"navajowhite":[255,222,173],"navy":[0,0,128],"oldlace":[253,245,230],"olive":[128,128,0],"olivedrab":[107,142,35],"orange":[255,165,0],"orangered":[255,69,0],"orchid":[218,112,214],"palegoldenrod":[238,232,170],"palegreen":[152,251,152],"paleturquoise":[175,238,238],"palevioletred":[219,112,147],"papayawhip":[255,239,213],"peachpuff":[255,218,185],"peru":[205,133,63],"pink":[255,192,203],"plum":[221,160,221],"powderblue":[176,224,230],"purple":[128,0,128],"rebeccapurple":[102,51,153],"red":[255,0,0],"rosybrown":[188,143,143],"royalblue":[65,105,225],"saddlebrown":[139,69,19],"salmon":[250,128,114],"sandybrown":[244,164,96],"seagreen":[46,139,87],"seashell":[255,245,238],"sienna":[160,82,45],"silver":[192,192,192],"skyblue":[135,206,235],"slateblue":[106,90,205],"slategray":[112,128,144],"slategrey":[112,128,144],"snow":[255,250,250],"springgreen":[0,255,127],"steelblue":[70,130,180],"tan":[210,180,140],"teal":[0,128,128],"thistle":[216,191,216],"tomato":[255,99,71],"turquoise":[64,224,208],"violet":[238,130,238],"wheat":[245,222,179],"white":[255,255,255],"whitesmoke":[245,245,245],"yellow":[255,255,0],"yellowgreen":[154,205,50]},Bt=Nt,Dt=Object.hasOwnProperty,Rt=Object.create(null);for(var Lt in Pt)Dt.call(Pt,Lt)&&(Rt[Pt[Lt]]=Lt);var jt=St.exports={to:{},get:{}};function zt(t,e,n){return Math.min(Math.max(e,t),n)}function qt(t){var e=Math.round(t).toString(16).toUpperCase();return e.length<2?"0"+e:e}jt.get=function(t){var e,n;switch(t.substring(0,3).toLowerCase()){case"hsl":e=jt.get.hsl(t),n="hsl";break;case"hwb":e=jt.get.hwb(t),n="hwb";break;default:e=jt.get.rgb(t),n="rgb"}return e?{model:n,value:e}:null},jt.get.rgb=function(t){if(!t)return null;var e,n,r,i=[0,0,0,1];if(e=t.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(r=e[2],e=e[1],n=0;n<3;n++){var s=2*n;i[n]=parseInt(e.slice(s,s+2),16)}r&&(i[3]=parseInt(r,16)/255)}else if(e=t.match(/^#([a-f0-9]{3,4})$/i)){for(r=(e=e[1])[3],n=0;n<3;n++)i[n]=parseInt(e[n]+e[n],16);r&&(i[3]=parseInt(r+r,16)/255)}else if(e=t.match(/^rgba?\\(\\s*([+-]?\\d+)(?=[\\s,])\\s*(?:,\\s*)?([+-]?\\d+)(?=[\\s,])\\s*(?:,\\s*)?([+-]?\\d+)\\s*(?:[,|\\/]\\s*([+-]?[\\d\\.]+)(%?)\\s*)?\\)$/)){for(n=0;n<3;n++)i[n]=parseInt(e[n+1],0);e[4]&&(e[5]?i[3]=.01*parseFloat(e[4]):i[3]=parseFloat(e[4]))}else{if(!(e=t.match(/^rgba?\\(\\s*([+-]?[\\d\\.]+)\\%\\s*,?\\s*([+-]?[\\d\\.]+)\\%\\s*,?\\s*([+-]?[\\d\\.]+)\\%\\s*(?:[,|\\/]\\s*([+-]?[\\d\\.]+)(%?)\\s*)?\\)$/)))return(e=t.match(/^(\\w+)$/))?"transparent"===e[1]?[0,0,0,0]:Dt.call(Pt,e[1])?((i=Pt[e[1]])[3]=1,i):null:null;for(n=0;n<3;n++)i[n]=Math.round(2.55*parseFloat(e[n+1]));e[4]&&(e[5]?i[3]=.01*parseFloat(e[4]):i[3]=parseFloat(e[4]))}for(n=0;n<3;n++)i[n]=zt(i[n],0,255);return i[3]=zt(i[3],0,1),i},jt.get.hsl=function(t){if(!t)return null;var e=t.match(/^hsla?\\(\\s*([+-]?(?:\\d{0,3}\\.)?\\d+)(?:deg)?\\s*,?\\s*([+-]?[\\d\\.]+)%\\s*,?\\s*([+-]?[\\d\\.]+)%\\s*(?:[,|\\/]\\s*([+-]?(?=\\.\\d|\\d)(?:0|[1-9]\\d*)?(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)\\s*)?\\)$/);if(e){var n=parseFloat(e[4]);return[(parseFloat(e[1])%360+360)%360,zt(parseFloat(e[2]),0,100),zt(parseFloat(e[3]),0,100),zt(isNaN(n)?1:n,0,1)]}return null},jt.get.hwb=function(t){if(!t)return null;var e=t.match(/^hwb\\(\\s*([+-]?\\d{0,3}(?:\\.\\d+)?)(?:deg)?\\s*,\\s*([+-]?[\\d\\.]+)%\\s*,\\s*([+-]?[\\d\\.]+)%\\s*(?:,\\s*([+-]?(?=\\.\\d|\\d)(?:0|[1-9]\\d*)?(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)\\s*)?\\)$/);if(e){var n=parseFloat(e[4]);return[(parseFloat(e[1])%360+360)%360,zt(parseFloat(e[2]),0,100),zt(parseFloat(e[3]),0,100),zt(isNaN(n)?1:n,0,1)]}return null},jt.to.hex=function(){var t=Bt(arguments);return"#"+qt(t[0])+qt(t[1])+qt(t[2])+(t[3]<1?qt(Math.round(255*t[3])):"")},jt.to.rgb=function(){var t=Bt(arguments);return t.length<4||1===t[3]?"rgb("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+")":"rgba("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+", "+t[3]+")"},jt.to.rgb.percent=function(){var t=Bt(arguments),e=Math.round(t[0]/255*100),n=Math.round(t[1]/255*100),r=Math.round(t[2]/255*100);return t.length<4||1===t[3]?"rgb("+e+"%, "+n+"%, "+r+"%)":"rgba("+e+"%, "+n+"%, "+r+"%, "+t[3]+")"},jt.to.hsl=function(){var t=Bt(arguments);return t.length<4||1===t[3]?"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)":"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+t[3]+")"},jt.to.hwb=function(){var t=Bt(arguments),e="";return t.length>=4&&1!==t[3]&&(e=", "+t[3]),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+e+")"},jt.to.keyword=function(t){return Rt[t.slice(0,3)]};var Vt=St.exports,Gt={exports:{}},$t={"aliceblue":[240,248,255],"antiquewhite":[250,235,215],"aqua":[0,255,255],"aquamarine":[127,255,212],"azure":[240,255,255],"beige":[245,245,220],"bisque":[255,228,196],"black":[0,0,0],"blanchedalmond":[255,235,205],"blue":[0,0,255],"blueviolet":[138,43,226],"brown":[165,42,42],"burlywood":[222,184,135],"cadetblue":[95,158,160],"chartreuse":[127,255,0],"chocolate":[210,105,30],"coral":[255,127,80],"cornflowerblue":[100,149,237],"cornsilk":[255,248,220],"crimson":[220,20,60],"cyan":[0,255,255],"darkblue":[0,0,139],"darkcyan":[0,139,139],"darkgoldenrod":[184,134,11],"darkgray":[169,169,169],"darkgreen":[0,100,0],"darkgrey":[169,169,169],"darkkhaki":[189,183,107],"darkmagenta":[139,0,139],"darkolivegreen":[85,107,47],"darkorange":[255,140,0],"darkorchid":[153,50,204],"darkred":[139,0,0],"darksalmon":[233,150,122],"darkseagreen":[143,188,143],"darkslateblue":[72,61,139],"darkslategray":[47,79,79],"darkslategrey":[47,79,79],"darkturquoise":[0,206,209],"darkviolet":[148,0,211],"deeppink":[255,20,147],"deepskyblue":[0,191,255],"dimgray":[105,105,105],"dimgrey":[105,105,105],"dodgerblue":[30,144,255],"firebrick":[178,34,34],"floralwhite":[255,250,240],"forestgreen":[34,139,34],"fuchsia":[255,0,255],"gainsboro":[220,220,220],"ghostwhite":[248,248,255],"gold":[255,215,0],"goldenrod":[218,165,32],"gray":[128,128,128],"green":[0,128,0],"greenyellow":[173,255,47],"grey":[128,128,128],"honeydew":[240,255,240],"hotpink":[255,105,180],"indianred":[205,92,92],"indigo":[75,0,130],"ivory":[255,255,240],"khaki":[240,230,140],"lavender":[230,230,250],"lavenderblush":[255,240,245],"lawngreen":[124,252,0],"lemonchiffon":[255,250,205],"lightblue":[173,216,230],"lightcoral":[240,128,128],"lightcyan":[224,255,255],"lightgoldenrodyellow":[250,250,210],"lightgray":[211,211,211],"lightgreen":[144,238,144],"lightgrey":[211,211,211],"lightpink":[255,182,193],"lightsalmon":[255,160,122],"lightseagreen":[32,178,170],"lightskyblue":[135,206,250],"lightslategray":[119,136,153],"lightslategrey":[119,136,153],"lightsteelblue":[176,196,222],"lightyellow":[255,255,224],"lime":[0,255,0],"limegreen":[50,205,50],"linen":[250,240,230],"magenta":[255,0,255],"maroon":[128,0,0],"mediumaquamarine":[102,205,170],"mediumblue":[0,0,205],"mediumorchid":[186,85,211],"mediumpurple":[147,112,219],"mediumseagreen":[60,179,113],"mediumslateblue":[123,104,238],"mediumspringgreen":[0,250,154],"mediumturquoise":[72,209,204],"mediumvioletred":[199,21,133],"midnightblue":[25,25,112],"mintcream":[245,255,250],"mistyrose":[255,228,225],"moccasin":[255,228,181],"navajowhite":[255,222,173],"navy":[0,0,128],"oldlace":[253,245,230],"olive":[128,128,0],"olivedrab":[107,142,35],"orange":[255,165,0],"orangered":[255,69,0],"orchid":[218,112,214],"palegoldenrod":[238,232,170],"palegreen":[152,251,152],"paleturquoise":[175,238,238],"palevioletred":[219,112,147],"papayawhip":[255,239,213],"peachpuff":[255,218,185],"peru":[205,133,63],"pink":[255,192,203],"plum":[221,160,221],"powderblue":[176,224,230],"purple":[128,0,128],"rebeccapurple":[102,51,153],"red":[255,0,0],"rosybrown":[188,143,143],"royalblue":[65,105,225],"saddlebrown":[139,69,19],"salmon":[250,128,114],"sandybrown":[244,164,96],"seagreen":[46,139,87],"seashell":[255,245,238],"sienna":[160,82,45],"silver":[192,192,192],"skyblue":[135,206,235],"slateblue":[106,90,205],"slategray":[112,128,144],"slategrey":[112,128,144],"snow":[255,250,250],"springgreen":[0,255,127],"steelblue":[70,130,180],"tan":[210,180,140],"teal":[0,128,128],"thistle":[216,191,216],"tomato":[255,99,71],"turquoise":[64,224,208],"violet":[238,130,238],"wheat":[245,222,179],"white":[255,255,255],"whitesmoke":[245,245,245],"yellow":[255,255,0],"yellowgreen":[154,205,50]},Xt={};for(var Ht in $t)$t.hasOwnProperty(Ht)&&(Xt[$t[Ht]]=Ht);var Jt=Gt.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var Kt in Jt)if(Jt.hasOwnProperty(Kt)){if(!("channels"in Jt[Kt]))throw new Error("missing channels property: "+Kt);if(!("labels"in Jt[Kt]))throw new Error("missing channel labels property: "+Kt);if(Jt[Kt].labels.length!==Jt[Kt].channels)throw new Error("channel and label counts mismatch: "+Kt);var Yt=Jt[Kt].channels,Qt=Jt[Kt].labels;delete Jt[Kt].channels,delete Jt[Kt].labels,Object.defineProperty(Jt[Kt],"channels",{value:Yt}),Object.defineProperty(Jt[Kt],"labels",{value:Qt})}function Wt(t,e){return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2)}Jt.rgb.hsl=function(t){var e,n,r=t[0]/255,i=t[1]/255,s=t[2]/255,o=Math.min(r,i,s),a=Math.max(r,i,s),c=a-o;return a===o?e=0:r===a?e=(i-s)/c:i===a?e=2+(s-r)/c:s===a&&(e=4+(r-i)/c),(e=Math.min(60*e,360))<0&&(e+=360),n=(o+a)/2,[e,100*(a===o?0:n<=.5?c/(a+o):c/(2-a-o)),100*n]},Jt.rgb.hsv=function(t){var e,n,r,i,s,o=t[0]/255,a=t[1]/255,c=t[2]/255,u=Math.max(o,a,c),f=u-Math.min(o,a,c),l=function(t){return(u-t)/6/f+.5};return 0===f?i=s=0:(s=f/u,e=l(o),n=l(a),r=l(c),o===u?i=r-n:a===u?i=1/3+e-r:c===u&&(i=2/3+n-e),i<0?i+=1:i>1&&(i-=1)),[360*i,100*s,100*u]},Jt.rgb.hwb=function(t){var e=t[0],n=t[1],r=t[2];return[Jt.rgb.hsl(t)[0],100*(1/255*Math.min(e,Math.min(n,r))),100*(r=1-1/255*Math.max(e,Math.max(n,r)))]},Jt.rgb.cmyk=function(t){var e,n=t[0]/255,r=t[1]/255,i=t[2]/255;return[100*((1-n-(e=Math.min(1-n,1-r,1-i)))/(1-e)||0),100*((1-r-e)/(1-e)||0),100*((1-i-e)/(1-e)||0),100*e]},Jt.rgb.keyword=function(t){var e=Xt[t];if(e)return e;var n,r=1/0;for(var i in $t)if($t.hasOwnProperty(i)){var s=Wt(t,$t[i]);s<r&&(r=s,n=i)}return n},Jt.keyword.rgb=function(t){return $t[t]},Jt.rgb.xyz=function(t){var e=t[0]/255,n=t[1]/255,r=t[2]/255;return[100*(.4124*(e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92)+.3576*(n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92)+.1805*(r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92)),100*(.2126*e+.7152*n+.0722*r),100*(.0193*e+.1192*n+.9505*r)]},Jt.rgb.lab=function(t){var e=Jt.rgb.xyz(t),n=e[0],r=e[1],i=e[2];return r/=100,i/=108.883,n=(n/=95.047)>.008856?Math.pow(n,1/3):7.787*n+16/116,[116*(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116)-16,500*(n-r),200*(r-(i=i>.008856?Math.pow(i,1/3):7.787*i+16/116))]},Jt.hsl.rgb=function(t){var e,n,r,i,s,o=t[0]/360,a=t[1]/100,c=t[2]/100;if(0===a)return[s=255*c,s,s];e=2*c-(n=c<.5?c*(1+a):c+a-c*a),i=[0,0,0];for(var u=0;u<3;u++)(r=o+1/3*-(u-1))<0&&r++,r>1&&r--,s=6*r<1?e+6*(n-e)*r:2*r<1?n:3*r<2?e+(n-e)*(2/3-r)*6:e,i[u]=255*s;return i},Jt.hsl.hsv=function(t){var e=t[0],n=t[1]/100,r=t[2]/100,i=n,s=Math.max(r,.01);return n*=(r*=2)<=1?r:2-r,i*=s<=1?s:2-s,[e,100*(0===r?2*i/(s+i):2*n/(r+n)),100*((r+n)/2)]},Jt.hsv.rgb=function(t){var e=t[0]/60,n=t[1]/100,r=t[2]/100,i=Math.floor(e)%6,s=e-Math.floor(e),o=255*r*(1-n),a=255*r*(1-n*s),c=255*r*(1-n*(1-s));switch(r*=255,i){case 0:return[r,c,o];case 1:return[a,r,o];case 2:return[o,r,c];case 3:return[o,a,r];case 4:return[c,o,r];case 5:return[r,o,a]}},Jt.hsv.hsl=function(t){var e,n,r,i=t[0],s=t[1]/100,o=t[2]/100,a=Math.max(o,.01);return r=(2-s)*o,n=s*a,[i,100*(n=(n/=(e=(2-s)*a)<=1?e:2-e)||0),100*(r/=2)]},Jt.hwb.rgb=function(t){var e,n,r,i,s,o,a,c=t[0]/360,u=t[1]/100,f=t[2]/100,l=u+f;switch(l>1&&(u/=l,f/=l),r=6*c-(e=Math.floor(6*c)),1&e&&(r=1-r),i=u+r*((n=1-f)-u),e){default:case 6:case 0:s=n,o=i,a=u;break;case 1:s=i,o=n,a=u;break;case 2:s=u,o=n,a=i;break;case 3:s=u,o=i,a=n;break;case 4:s=i,o=u,a=n;break;case 5:s=n,o=u,a=i}return[255*s,255*o,255*a]},Jt.cmyk.rgb=function(t){var e=t[0]/100,n=t[1]/100,r=t[2]/100,i=t[3]/100;return[255*(1-Math.min(1,e*(1-i)+i)),255*(1-Math.min(1,n*(1-i)+i)),255*(1-Math.min(1,r*(1-i)+i))]},Jt.xyz.rgb=function(t){var e,n,r,i=t[0]/100,s=t[1]/100,o=t[2]/100;return n=-.9689*i+1.8758*s+.0415*o,r=.0557*i+-.204*s+1.057*o,e=(e=3.2406*i+-1.5372*s+-.4986*o)>.0031308?1.055*Math.pow(e,1/2.4)-.055:12.92*e,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:12.92*r,[255*(e=Math.min(Math.max(0,e),1)),255*(n=Math.min(Math.max(0,n),1)),255*(r=Math.min(Math.max(0,r),1))]},Jt.xyz.lab=function(t){var e=t[0],n=t[1],r=t[2];return n/=100,r/=108.883,e=(e/=95.047)>.008856?Math.pow(e,1/3):7.787*e+16/116,[116*(n=n>.008856?Math.pow(n,1/3):7.787*n+16/116)-16,500*(e-n),200*(n-(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116))]},Jt.lab.xyz=function(t){var e,n,r,i=t[0];e=t[1]/500+(n=(i+16)/116),r=n-t[2]/200;var s=Math.pow(n,3),o=Math.pow(e,3),a=Math.pow(r,3);return n=s>.008856?s:(n-16/116)/7.787,e=o>.008856?o:(e-16/116)/7.787,r=a>.008856?a:(r-16/116)/7.787,[e*=95.047,n*=100,r*=108.883]},Jt.lab.lch=function(t){var e,n=t[0],r=t[1],i=t[2];return(e=360*Math.atan2(i,r)/2/Math.PI)<0&&(e+=360),[n,Math.sqrt(r*r+i*i),e]},Jt.lch.lab=function(t){var e,n=t[0],r=t[1];return e=t[2]/360*2*Math.PI,[n,r*Math.cos(e),r*Math.sin(e)]},Jt.rgb.ansi16=function(t){var e=t[0],n=t[1],r=t[2],i=1 in arguments?arguments[1]:Jt.rgb.hsv(t)[2];if(0===(i=Math.round(i/50)))return 30;var s=30+(Math.round(r/255)<<2|Math.round(n/255)<<1|Math.round(e/255));return 2===i&&(s+=60),s},Jt.hsv.ansi16=function(t){return Jt.rgb.ansi16(Jt.hsv.rgb(t),t[2])},Jt.rgb.ansi256=function(t){var e=t[0],n=t[1],r=t[2];return e===n&&n===r?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(n/255*5)+Math.round(r/255*5)},Jt.ansi16.rgb=function(t){var e=t%10;if(0===e||7===e)return t>50&&(e+=3.5),[e=e/10.5*255,e,e];var n=.5*(1+~~(t>50));return[(1&e)*n*255,(e>>1&1)*n*255,(e>>2&1)*n*255]},Jt.ansi256.rgb=function(t){if(t>=232){var e=10*(t-232)+8;return[e,e,e]}var n;return t-=16,[Math.floor(t/36)/5*255,Math.floor((n=t%36)/6)/5*255,n%6/5*255]},Jt.rgb.hex=function(t){var e=(((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2]))).toString(16).toUpperCase();return"000000".substring(e.length)+e},Jt.hex.rgb=function(t){var e=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!e)return[0,0,0];var n=e[0];3===e[0].length&&(n=n.split("").map((function(t){return t+t})).join(""));var r=parseInt(n,16);return[r>>16&255,r>>8&255,255&r]},Jt.rgb.hcg=function(t){var e,n=t[0]/255,r=t[1]/255,i=t[2]/255,s=Math.max(Math.max(n,r),i),o=Math.min(Math.min(n,r),i),a=s-o;return e=a<=0?0:s===n?(r-i)/a%6:s===r?2+(i-n)/a:4+(n-r)/a+4,e/=6,[360*(e%=1),100*a,100*(a<1?o/(1-a):0)]},Jt.hsl.hcg=function(t){var e=t[1]/100,n=t[2]/100,r=1,i=0;return(r=n<.5?2*e*n:2*e*(1-n))<1&&(i=(n-.5*r)/(1-r)),[t[0],100*r,100*i]},Jt.hsv.hcg=function(t){var e=t[1]/100,n=t[2]/100,r=e*n,i=0;return r<1&&(i=(n-r)/(1-r)),[t[0],100*r,100*i]},Jt.hcg.rgb=function(t){var e=t[0]/360,n=t[1]/100,r=t[2]/100;if(0===n)return[255*r,255*r,255*r];var i,s=[0,0,0],o=e%1*6,a=o%1,c=1-a;switch(Math.floor(o)){case 0:s[0]=1,s[1]=a,s[2]=0;break;case 1:s[0]=c,s[1]=1,s[2]=0;break;case 2:s[0]=0,s[1]=1,s[2]=a;break;case 3:s[0]=0,s[1]=c,s[2]=1;break;case 4:s[0]=a,s[1]=0,s[2]=1;break;default:s[0]=1,s[1]=0,s[2]=c}return i=(1-n)*r,[255*(n*s[0]+i),255*(n*s[1]+i),255*(n*s[2]+i)]},Jt.hcg.hsv=function(t){var e=t[1]/100,n=e+t[2]/100*(1-e),r=0;return n>0&&(r=e/n),[t[0],100*r,100*n]},Jt.hcg.hsl=function(t){var e=t[1]/100,n=t[2]/100*(1-e)+.5*e,r=0;return n>0&&n<.5?r=e/(2*n):n>=.5&&n<1&&(r=e/(2*(1-n))),[t[0],100*r,100*n]},Jt.hcg.hwb=function(t){var e=t[1]/100,n=e+t[2]/100*(1-e);return[t[0],100*(n-e),100*(1-n)]},Jt.hwb.hcg=function(t){var e=t[1]/100,n=1-t[2]/100,r=n-e,i=0;return r<1&&(i=(n-r)/(1-r)),[t[0],100*r,100*i]},Jt.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},Jt.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},Jt.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},Jt.gray.hsl=Jt.gray.hsv=function(t){return[0,0,t[0]]},Jt.gray.hwb=function(t){return[0,100,t[0]]},Jt.gray.cmyk=function(t){return[0,0,0,t[0]]},Jt.gray.lab=function(t){return[t[0],0,0]},Jt.gray.hex=function(t){var e=255&Math.round(t[0]/100*255),n=((e<<16)+(e<<8)+e).toString(16).toUpperCase();return"000000".substring(n.length)+n},Jt.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]};var Zt=Gt.exports,te=Zt;function ee(t){var e=function(){for(var t={},e=Object.keys(te),n=e.length,r=0;r<n;r++)t[e[r]]={distance:-1,parent:null};return t}(),n=[t];for(e[t].distance=0;n.length;)for(var r=n.pop(),i=Object.keys(te[r]),s=i.length,o=0;o<s;o++){var a=i[o],c=e[a];-1===c.distance&&(c.distance=e[r].distance+1,c.parent=r,n.unshift(a))}return e}function ne(t,e){return function(n){return e(t(n))}}function re(t,e){for(var n=[e[t].parent,t],r=te[e[t].parent][t],i=e[t].parent;e[i].parent;)n.unshift(e[i].parent),r=ne(te[e[i].parent][i],r),i=e[i].parent;return r.conversion=n,r}var ie=Zt,se=function(t){for(var e=ee(t),n={},r=Object.keys(e),i=r.length,s=0;s<i;s++){var o=r[s];null!==e[o].parent&&(n[o]=re(o,e))}return n},oe={};Object.keys(ie).forEach((function(t){oe[t]={},Object.defineProperty(oe[t],"channels",{value:ie[t].channels}),Object.defineProperty(oe[t],"labels",{value:ie[t].labels});var e=se(t);Object.keys(e).forEach((function(n){var r=e[n];oe[t][n]=function(t){var e=function(e){if(null==e)return e;arguments.length>1&&(e=Array.prototype.slice.call(arguments));var n=t(e);if("object"==typeof n)for(var r=n.length,i=0;i<r;i++)n[i]=Math.round(n[i]);return n};return"conversion"in t&&(e.conversion=t.conversion),e}(r),oe[t][n].raw=function(t){var e=function(e){return null==e?e:(arguments.length>1&&(e=Array.prototype.slice.call(arguments)),t(e))};return"conversion"in t&&(e.conversion=t.conversion),e}(r)}))}));var ae=Vt,ce=oe,ue=[].slice,fe=["keyword","gray","hex"],le={};Object.keys(ce).forEach((function(t){le[ue.call(ce[t].labels).sort().join("")]=t}));var he={};function de(t,e){if(!(this instanceof de))return new de(t,e);if(e&&e in fe&&(e=null),e&&!(e in ce))throw new Error("Unknown model: "+e);var n,r;if(null==t)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(t instanceof de)this.model=t.model,this.color=t.color.slice(),this.valpha=t.valpha;else if("string"==typeof t){var i=ae.get(t);if(null===i)throw new Error("Unable to parse color from string: "+t);this.model=i.model,r=ce[this.model].channels,this.color=i.value.slice(0,r),this.valpha="number"==typeof i.value[r]?i.value[r]:1}else if(t.length){this.model=e||"rgb",r=ce[this.model].channels;var s=ue.call(t,0,r);this.color=be(s,r),this.valpha="number"==typeof t[r]?t[r]:1}else if("number"==typeof t)t&=16777215,this.model="rgb",this.color=[t>>16&255,t>>8&255,255&t],this.valpha=1;else{this.valpha=1;var o=Object.keys(t);"alpha"in t&&(o.splice(o.indexOf("alpha"),1),this.valpha="number"==typeof t.alpha?t.alpha:0);var a=o.sort().join("");if(!(a in le))throw new Error("Unable to parse color from object: "+JSON.stringify(t));this.model=le[a];var c=ce[this.model].labels,u=[];for(n=0;n<c.length;n++)u.push(t[c[n]]);this.color=be(u)}if(he[this.model])for(r=ce[this.model].channels,n=0;n<r;n++){var f=he[this.model][n];f&&(this.color[n]=f(this.color[n]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}function ye(t,e,n){return(t=Array.isArray(t)?t:[t]).forEach((function(t){(he[t]||(he[t]=[]))[e]=n})),t=t[0],function(r){var i;return arguments.length?(n&&(r=n(r)),(i=this[t]()).color[e]=r,i):(i=this[t]().color[e],n&&(i=n(i)),i)}}function me(t){return function(e){return Math.max(0,Math.min(t,e))}}function be(t,e){for(var n=0;n<e;n++)"number"!=typeof t[n]&&(t[n]=0);return t}function pe(t){return null==t}function ge(t){return"object"==typeof t&&!!t}function we(t){return t/Math.PI*180}de.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(t){var e=this.model in ae.to?this:this.rgb(),n=1===(e=e.round("number"==typeof t?t:1)).valpha?e.color:e.color.concat(this.valpha);return ae.to[e.model](n)},percentString:function(t){var e=this.rgb().round("number"==typeof t?t:1),n=1===e.valpha?e.color:e.color.concat(this.valpha);return ae.to.rgb.percent(n)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var t={},e=ce[this.model].channels,n=ce[this.model].labels,r=0;r<e;r++)t[n[r]]=this.color[r];return 1!==this.valpha&&(t.alpha=this.valpha),t},unitArray:function(){var t=this.rgb().color;return t[0]/=255,t[1]/=255,t[2]/=255,1!==this.valpha&&t.push(this.valpha),t},unitObject:function(){var t=this.rgb().object();return t.r/=255,t.g/=255,t.b/=255,1!==this.valpha&&(t.alpha=this.valpha),t},round:function(t){return t=Math.max(t||0,0),new de(this.color.map(function(t){return function(e){return function(t,e){return Number(t.toFixed(e))}(e,t)}}(t)).concat(this.valpha),this.model)},alpha:function(t){return arguments.length?new de(this.color.concat(Math.max(0,Math.min(1,t))),this.model):this.valpha},red:ye("rgb",0,me(255)),green:ye("rgb",1,me(255)),blue:ye("rgb",2,me(255)),hue:ye(["hsl","hsv","hsl","hwb","hcg"],0,(function(t){return(t%360+360)%360})),saturationl:ye("hsl",1,me(100)),lightness:ye("hsl",2,me(100)),saturationv:ye("hsv",1,me(100)),value:ye("hsv",2,me(100)),chroma:ye("hcg",1,me(100)),gray:ye("hcg",2,me(100)),white:ye("hwb",1,me(100)),wblack:ye("hwb",2,me(100)),cyan:ye("cmyk",0,me(100)),magenta:ye("cmyk",1,me(100)),yellow:ye("cmyk",2,me(100)),black:ye("cmyk",3,me(100)),x:ye("xyz",0,me(100)),y:ye("xyz",1,me(100)),z:ye("xyz",2,me(100)),l:ye("lab",0,me(100)),a:ye("lab",1),b:ye("lab",2),keyword:function(t){return arguments.length?new de(t):ce[this.model].keyword(this.color)},hex:function(t){return arguments.length?new de(t):ae.to.hex(this.rgb().round().color)},rgbNumber:function(){var t=this.rgb().color;return(255&t[0])<<16|(255&t[1])<<8|255&t[2]},luminosity:function(){for(var t=this.rgb().color,e=[],n=0;n<t.length;n++){var r=t[n]/255;e[n]=r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4)}return.2126*e[0]+.7152*e[1]+.0722*e[2]},contrast:function(t){var e=this.luminosity(),n=t.luminosity();return e>n?(e+.05)/(n+.05):(n+.05)/(e+.05)},level:function(t){var e=this.contrast(t);return e>=7.1?"AAA":e>=4.5?"AA":""},isDark:function(){var t=this.rgb().color;return(299*t[0]+587*t[1]+114*t[2])/1e3<128},isLight:function(){return!this.isDark()},negate:function(){for(var t=this.rgb(),e=0;e<3;e++)t.color[e]=255-t.color[e];return t},lighten:function(t){var e=this.hsl();return e.color[2]+=e.color[2]*t,e},darken:function(t){var e=this.hsl();return e.color[2]-=e.color[2]*t,e},saturate:function(t){var e=this.hsl();return e.color[1]+=e.color[1]*t,e},desaturate:function(t){var e=this.hsl();return e.color[1]-=e.color[1]*t,e},whiten:function(t){var e=this.hwb();return e.color[1]+=e.color[1]*t,e},blacken:function(t){var e=this.hwb();return e.color[2]+=e.color[2]*t,e},grayscale:function(){var t=this.rgb().color,e=.3*t[0]+.59*t[1]+.11*t[2];return de.rgb(e,e,e)},fade:function(t){return this.alpha(this.valpha-this.valpha*t)},opaquer:function(t){return this.alpha(this.valpha+this.valpha*t)},rotate:function(t){var e=this.hsl(),n=e.color[0];return n=(n=(n+t)%360)<0?360+n:n,e.color[0]=n,e},mix:function(t,e){if(!t||!t.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof t);var n=t.rgb(),r=this.rgb(),i=void 0===e?.5:e,s=2*i-1,o=n.alpha()-r.alpha(),a=((s*o==-1?s:(s+o)/(1+s*o))+1)/2,c=1-a;return de.rgb(a*n.red()+c*r.red(),a*n.green()+c*r.green(),a*n.blue()+c*r.blue(),n.alpha()*i+r.alpha()*(1-i))}},Object.keys(ce).forEach((function(t){if(-1===fe.indexOf(t)){var e=ce[t].channels;de.prototype[t]=function(){if(this.model===t)return new de(this);if(arguments.length)return new de(arguments,t);var n,r="number"==typeof arguments[e]?e:this.valpha;return new de((n=ce[this.model][t].raw(this.color),Array.isArray(n)?n:[n]).concat(r),t)},de[t]=function(n){return"number"==typeof n&&(n=be(ue.call(arguments),e)),new de(n,t)}}}));const ve=[1,1,1,1,2,2,3,0];function Me(t){const e=t.length;let n="";for(let r=0;r<e;){let i=t[r++];if(128&i){let n=ve[i>>3&7];if(!(64&i)||!n||r+n>e)return null;for(i&=63>>n;n>0;n-=1){const e=t[r++];if(128!=(192&e))return null;i=i<<6|63&e}}n+=String.fromCharCode(i)}return n}new Array(3),new Array(3);const Ae=[1/6378137,1/6378137,1/6356752.314245179],Te=[1/40680631590769,1/40680631590769,1/40408299984661.445],_e=new Array(3),ke=new Array(3),Oe=new Array(3);function xe(t,e){const n=Te,r=function(t,e,n,r,i){const s=e[0],o=e[1],a=e[2],c=n[0],u=n[1],f=n[2],l=s*s*c*c,h=o*o*u*u,d=a*a*f*f,y=l+h+d,m=Math.sqrt(1/y),b=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}(Se,e,m);if(y<i)return isFinite(m)?b:void 0;const p=r[0],g=r[1],w=r[2],v=Ie;v[0]=b[0]*p*2,v[1]=b[1]*g*2,v[2]=b[2]*w*2;let M,A,T,_,k,O,x,S,I,E,C,U=(1-m)*Ce(e)/(.5*Ce(v)),F=0;do{U-=F,T=1/(1+U*p),_=1/(1+U*g),k=1/(1+U*w),O=T*T,x=_*_,S=k*k,I=O*T,E=x*_,C=S*k,M=l*O+h*x+d*S-1,A=l*I*p+h*E*g+d*C*w;F=M/(-2*A)}while(Math.abs(M)>Ee);return t[0]=s*T,t[1]=o*_,t[2]=a*k,t}(_e,e,Ae,n,.1);let i=Tt(ke,r,n);i=function(t,e){const n=e[0],r=e[1],i=e[2];let s=n*n+r*r+i*i;s>0&&(s=Math.sqrt(s),t[0]=e[0]/s,t[1]=e[1]/s,t[2]=e[2]/s);return t}(i,i);const s=At(Oe,e,r),o=Math.atan2(i[1],i[0]),a=Math.asin(i[2]),c=function(t){return Math.sign?Math.sign(t):0==(t=+t)||isNaN(t)?Number(t):t>0?1:-1}(vt(s,e))*Ce(s);return t[0]=we(o),t[1]=we(a),t[2]=c,t}const Se=new Array(3),Ie=new Array(3),Ee=1e-12;function Ce(t){return yt(t)}function Ue(t,e){let n="";for(let r=0;r<4;r++){const i=t.getUint8(e+r);n+=String.fromCharCode(i)}return n}const Fe="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;function Ne(t,e,n){const r=new Uint8Array(t,e,n);return Fe?JSON.parse(Fe.decode(r)):JSON.parse(Me(r))}function Pe(t,e,n){const r=new Uint8Array(t,e,n);return Fe?JSON.parse(Fe.decode(r)):JSON.parse(Me(r))}function Be(t,e,n){return{offset:e,byteLength:n}}function De(t,e,n,r){const{byteOffset:i,componentType:s,type:o}=t,{ctor:a,type:c}=function(t){return je[t]}(s||"UNSIGNED_SHORT"),u=function(t){if(!t)return 1;return Le[t]}(o);return{byteStride:0,byteOffset:i+n,itemSize:u,count:r*u,componentType:c,array:new a(e,n+i,r*u)}}function Re(t,e,n,r){const i=De(t,e,n,r);return i.array.buffer.byteLength!==e.byteLength&&(i.array=i.array.slice()),i}const Le={"SCALAR":1,"VEC2":2,"VEC3":3,"VEC4":4};const je={"BYTE":{ctor:Int8Array,type:5120,name:"Int8Array"},"UNSIGNED_BYTE":{ctor:Uint8Array,type:5121,name:"Uint8Array"},"SHORT":{ctor:Int16Array,type:5122,name:"Int16Array"},"UNSIGNED_SHORT":{ctor:Uint16Array,type:5123,name:"Uint16Array"},"INT":{ctor:Int32Array,type:5124,name:"Int32Array"},"UNSIGNED_INT":{ctor:Uint32Array,type:5125,name:"Uint32Array"},"FLOAT":{ctor:Float32Array,type:5126,name:"Float32Array"},"DOUBLE":{ctor:Float64Array,type:5126,name:"Float64Array"}};function ze(t){for(const e in je)if(t===je[e].ctor)return je[e].type;throw new Error("unrecognized ctor:"+t)}function qe(t,e,n,r){const i=t,s=e.length/3;for(let t=0;t<s;t++)i[3*t]=e[3*t]/65535*r[0]+n[0],i[3*t+1]=e[3*t+1]/65535*r[1]+n[1],i[3*t+2]=e[3*t+2]/65535*r[2]+n[2];return i}function Ve(t,e,n){const r=t.getUint32(12,!0),i=t.getUint32(16,!0),s=t.getUint32(20,!0),o=t.getUint32(24,!0),a=t.buffer;let c,u={},f={},l=null;r>0&&(u=Ne(a,e,r),e+=r),i>0&&(c=function(t,e,n){return{offset:e,byteLength:n}}(0,e,i),e+=i),s>0&&(f=Pe(a,e,s),e+=s);const h=Be(0,e,o);return l=a.slice(h.offset,h.offset+h.byteLength),n.push(l),{featureTable:u,featureTableBin:c,batchTable:f,batchTableBin:l}}const Ge={5120:Int8Array,5122:Int16Array,5124:Int32Array,5121:Uint8Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function $e(t){for(const e in Ge)if(t===Ge[e])return+e;throw new Error("unrecognized ctor:"+t)}\n/*!\n   * @maptalks/gl v0.102.1\n   * LICENSE : UNLICENSED\n   * (c) 2016-2024 maptalks.com\n   */const Xe=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof undefined)return global;throw new Error("unable to locate global object")},He=Xe(),Je=He.gl_trans__coders=He.gl_trans__coders||{};Je.inject=function(t){const e=t.toString(),n=e.indexOf("{")+1,r=e.substring(0,n),i=He.gl_trans__coders=He.gl_trans__coders||{};let s=\`${PX}r}\\n    const _____getGlobal = ${PX}Xe.toString()};\\n    const g___lobals = _____getGlobal()\\n    const tran_____scoders = g___lobals['gl_trans__coders'] = g___lobals['gl_trans__coders'] || {};\`;for(const t in i)"inject"!==t&&"getTranscoder"!==t&&"registerTranscoder"!==t&&(s+='tran_____scoders["'+t+'"] ='+i[t].toString()+"\\n;");return s+="\\n"+e.substring(r.length),s},Je.registerTranscoder=function(t,e){Je[t]=e},Je.getTranscoder=function(t){return Je[t]};let Ke=null;function Ye(){return Ke||(Ke={"image/crn":Je.crn&&Je.crn(),"image/ktx2":Je.ktx2&&Je.ktx2(),"image/cttf":Je.ktx2&&Je.ktx2(),"draco":Je.draco&&Je.draco()}),Ke}class Qe{constructor(t,e,n){this.i=t,this.it=e||Q,this.o=n,this.st=Ye()}static createEmptyB3DM(){return{featureTable:null,batchTable:null,gltf:{}}}load(t,e,n=0,r=0,i){return e?(r||(r=e.byteLength),this.ot(t,e,n,r,i)):C.getArrayBuffer(t,{}).then((e=>{const i=e.data;return r||(r=i.byteLength),this.ot(t,i,n,r)}))}ot(t,e,n,r,i){const s=i&&i.maxTextureSize,o=this.ct(e,n,r,t);if(o.error)return Promise.resolve(o);const a=t.substring(0,t.lastIndexOf("/"));let c;try{c=new this.it(a,o.glb,{transferable:!0,requestImage:this.i,decoders:this.st,supportedFormats:this.o,maxTextureSize:s})}catch(t){return Promise.resolve({error:t})}return c.load({skipAttributeTransform:!1}).then((e=>{e.url=\`${PX}t}-${PX}n}-${PX}r}\`;const i=c.transferables;for(let t=0;t<o.transferables.length;t++)i.indexOf(o.transferables[t])<0&&i.push(o.transferables[t]);return{magic:"b3dm",count:o.count,transferables:i,featureTable:o.featureTable,batchTable:o.batchTable,batchTableBin:o.batchTableBin,gltf:e}}))}ct(t,e,n,r){const i=new DataView(t,e,n),s=i.getUint32(4,!0);if(1!==s){const t="Unsupported b3dm version: "+s+", url:"+r;return console.warn(t),{error:t}}if(i.getUint32(8,!0)!==i.byteLength){const t="Length in b3dm header is inconsistent with b3dm's byte length, url: "+r;return console.warn(t),{error:t}}let o,a=i.getUint32(12,!0),c=i.getUint32(16,!0),u=i.getUint32(20,!0),f=i.getUint32(24,!0),l=28+e;u>=570425344?(l-=8,o=a,u=c,f=0,a=0,c=0):f>=570425344&&(l-=4,o=u,u=a,f=c,a=0,c=0);const h=[t];let d,y,m;if(a>0?(d=Ne(t,l,a),l+=a,o=d.BATCH_LENGTH):d={"BATCH_LENGTH":o},c>0&&(l+=c),u>0&&(y=Pe(t,l,u),l+=u,f>0)){const e=Be(0,l,f);m=t.slice(e.offset,e.offset+e.byteLength),l+=f,h.push(m)}const b=d.BATCH_LENGTH,p={};if(d&&d.BATCH_ID){p.BATCH_ID=Re(d.BATCH_ID,t,undefined.offset,b);const e=p.BATCH_ID.array&&p.BATCH_ID.array.buffer;e&&h.indexOf(e)<0&&h.push(e)}return{count:o,transferables:h,featureTable:d,batchTable:y,batchTableBin:m,b3dm:p,glb:{buffer:t,byteOffset:l,byteLength:i.byteLength+i.byteOffset-l}}}ut(){return null}}class We{constructor(t,e,n,r){this.i=t,this.it=e||Q,this.o=n,this.st=Ye(),this.ft=r}load(t,e,n=0,r=0,i){return e?(r||(r=e.byteLength),this.ot(t,e,n,r,i)):C.getArrayBuffer(t,{}).then((e=>{const i=e.data;return r||(r=i.byteLength),this.ot(t,i,n,r)}))}ot(t,e,n,r,i){return this.lt(t,e,n,r,i).then((({gltf:i,transferables:s})=>{const o=this.ht(e,n,r,t);if(o.error)return Promise.resolve(o);for(let t=0;t<s.length;t++)-1===o.transferables.indexOf(s[t])&&o.transferables.push(s[t]);return delete i.transferables,Promise.resolve({magic:"i3dm",count:o.count,transferables:o.transferables,featureTable:o.featureTable,batchTable:o.batchTable,batchTableBin:o.batchTableBin,i3dm:o.i3dm,gltf:i})}))}lt(t,e,n,r,i){const s=i&&i.maxTextureSize,o={transferable:!0,requestImage:this.i,decoders:this.st,supportedFormats:this.o,maxTextureSize:s},a=new DataView(e,n,r),c=32+a.getUint32(12,!0)+a.getUint32(16,!0)+a.getUint32(20,!0)+a.getUint32(24,!0);if(0===a.getUint32(28,!0)){let r=Me(new Uint8Array(e,c+n,a.byteLength-c));-1==r.indexOf("://")&&(r=t.substring(0,t.lastIndexOf("/"))+"/"+r);return r.indexOf(".glb")>0?C.getArrayBuffer(r,{}).then((t=>this.dt(r,{buffer:t.data,byteOffset:0},o))):C.getJSON(r,{}).then((t=>this.dt(r,t,o)))}{const r={buffer:e,byteOffset:c+n,byteLength:a.byteLength-c};return this.dt(t,r,o)}}dt(t,e,n){const r=t.substring(0,t.lastIndexOf("/")),i=new this.it(r,e,n);return i.load({skipAttributeTransform:!0}).then((n=>{let r=0,s=0;return e.buffer&&(r=e.byteOffset||0,s=e.byteLength||0),n.url=\`${PX}t}-${PX}r}-${PX}s}\`,{transferables:i.transferables,gltf:n}}))}ht(t,e,n,r){const i=new DataView(t,e,n),s=i.getUint32(4,!0);if(1!==s){const t="Unsupported pnts version: "+s+", url:"+r;return console.warn(t),{error:t}}if(i.getUint32(8,!0)!==i.byteLength){const t="Length in pnts header is inconsistent with pnts's byte length, url: "+r;return console.warn(t),{error:t}}const o=[t],{featureTable:a,featureTableBin:c,batchTable:u,batchTableBin:f}=Ve(i,32+e,o),l={},h=a.INSTANCES_LENGTH;if(a.POSITION){const{byteOffset:e}=a.POSITION;l.POSITION={byteStride:0,byteOffset:0,itemSize:3,count:h,componentType:5126,array:new Float32Array(t,e+c.offset,3*h).slice()},o.push(l.POSITION.array.buffer)}else if(a.POSITION_QUANTIZED){const e=a.QUANTIZED_VOLUME_OFFSET,n=a.QUANTIZED_VOLUME_SCALE,{byteOffset:r}=a.POSITION_QUANTIZED;l.POSITION={byteStride:12,byteOffset:0,itemSize:3,count:h,componentType:5126,array:this.yt(new Uint16Array(t,r+c.offset,3*h),e,n)},o.push(l.POSITION.array.buffer)}if(a.BATCH_ID){l.BATCH_ID=Re(a.BATCH_ID,t,c.offset,h);const e=l.BATCH_ID.array&&l.BATCH_ID.array.buffer;e&&o.indexOf(e)<0&&o.push(e)}if(a.NORMAL_UP){let{byteOffset:e}=a.NORMAL_UP;l.NORMAL_UP={byteStride:0,byteOffset:0,itemSize:3,count:h,componentType:5126,array:new Float32Array(t,e+c.offset,3*h).slice()},o.push(l.NORMAL_UP.array.buffer),e=a.NORMAL_RIGHT.byteOffset,l.NORMAL_RIGHT={byteStride:0,byteOffset:0,itemSize:3,count:h,componentType:5126,array:new Float32Array(t,e+c.offset,3*h).slice()},o.push(l.NORMAL_RIGHT.array.buffer)}else if(a.NORMAL_UP_OCT32P){let{byteOffset:e}=a.NORMAL_UP_OCT32P;l.NORMAL_UP={byteStride:0,byteOffset:0,itemSize:3,count:h,componentType:5126,array:this.bt(new Uint16Array(t,e+c.offset,2*h))},o.push(l.NORMAL_UP.array.buffer),e=a.NORMAL_RIGHT_OCT32P.byteOffset,l.NORMAL_RIGHT={byteStride:0,byteOffset:0,itemSize:3,count:h,componentType:5126,array:this.bt(new Uint16Array(t,e+c.offset,2*h))},o.push(l.NORMAL_RIGHT.array.buffer)}if(a.SCALE){const{byteOffset:e}=a.SCALE;l.SCALE={byteStride:0,byteOffset:0,itemSize:1,count:h,componentType:5126,array:new Float32Array(t,e+c.offset,h).slice()},o.push(l.SCALE.array.buffer)}else if(a.SCALE_NON_UNIFORM){const{byteOffset:e}=a.SCALE_NON_UNIFORM;l.SCALE_NON_UNIFORM={byteStride:0,byteOffset:0,itemSize:3,count:h,componentType:5126,array:new Float32Array(t,e+c.offset,3*h).slice()},o.push(l.SCALE_NON_UNIFORM.array.buffer)}return{count:h,batchTable:u,batchTableBin:f,featureTable:a,i3dm:l,transferables:o}}bt(t){const e=t.length/2,n=new Float32Array(3*e),r=[];for(let i=0;i<e;i++)Ze(r,t[2*i],t[2*i+1],65535),n[3*i]=r[0],n[3*i+1]=r[1],n[3*i+2]=r[2];return n}yt(t,e,n){return qe(new Float32Array(t.length),t,e,n)}ut(){return null}}function Ze(t,e,n,r){if(t[0]=tn(e,r),t[1]=tn(n,r),t[2]=1-(Math.abs(t[0])+Math.abs(t[1])),t[2]<0){const e=t[0];t[0]=(1-Math.abs(t[1]))*en(e),t[1]=(1-Math.abs(e))*en(t[1])}return wt(t,t)}function tn(t,e){return e=function(t,e){if(null!=t)return t;return e}(e,255),function(t,e,n){return t<e?e:t>n?n:t}(t,0,e)/e*2-1}function en(t){return t<0?-1:1}class nn{constructor(){}load(t,e,n=0,r=0){return e?(r||(r=e.byteLength),this.ot(t,e,n,r)):C.getArrayBuffer(t,{}).then((e=>{const i=e.data;return r||(r=i.byteLength),this.ot(t,i,n,r)}))}ot(t,e,n,r){return this.gt(e,n,r,t).then((t=>t.error?t:{magic:"pnts",count:t.count,transferables:t.transferables,featureTable:t.featureTable,batchTable:t.batchTable,batchTableBin:t.batchTableBin,pnts:t.pnts}))}gt(t,e,n,r){const i=new DataView(t,e,n),s=i.getUint32(4,!0);if(1!==s){const t="Unsupported pnts version: "+s+", url:"+r;return console.warn(t),{error:t}}if(i.getUint32(8,!0)!==i.byteLength){const t="Length in pnts header is inconsistent with pnts's byte length, url: "+r;return console.warn(t),{error:t}}const o=[t],{featureTable:a,featureTableBin:c,batchTable:u,batchTableBin:f}=Ve(i,e+28,o),l=a.QUANTIZED_VOLUME_OFFSET,h=a.QUANTIZED_VOLUME_SCALE,d=a.POINTS_LENGTH;let y,m={};if(a.extensions&&a.extensions["3DTILES_draco_point_compression"]){m=a.extensions["3DTILES_draco_point_compression"],y=new DataView(t,m.byteOffset+c.offset,m.byteLength);const e={attributes:m.properties,useUniqueIDs:!1};return this.wt||(this.wt=Ye().draco),this.wt(y,e).then((e=>{const n=e.attributes;!a.POSITION&&!a.POSITION_QUANTIZED||n.POSITION||n.POSITION_QUANTIZED||(n.POSITION=a.POSITION,n.POSITION_QUANTIZED=a.POSITION_QUANTIZED),!(a.RGB||a.RGBA||a.RGB565)||n.RGB||n.RGBA||n.RGB565||(n.RGB=a.RGB,n.RGBA=a.RGBA,n.RGB565=a.RGB565),!a.NORMAL&&!a.NORMAL_OCT16P||n.NORMAL||n.NORMAL_OCT16P||(n.NORMAL=a.NORMAL,n.NORMAL_OCT16P=a.NORMAL_OCT16P);const r=this.vt(t,e.attributes,c.offset,d,o,l,h);if(e.attributes.BATCH_ID){const t=e.attributes.BATCH_ID.array;r.BATCH_ID={byteStride:0,byteOffset:0,itemSize:1,count:t.length,componentType:ze(t.constructor),array:t},o.push(t.buffer)}else if(a.BATCH_ID||Object.keys(u).length){a.BATCH_ID?r.BATCH_ID=Re(a.BATCH_ID,t,c.offset,d):r.BATCH_ID=rn(d);const e=r.BATCH_ID.array&&r.BATCH_ID.array.buffer;e&&o.indexOf(e)<0&&o.push(e)}return{count:d,batchTable:u,batchTableBin:f,featureTable:a,pnts:r,transferables:o}}))}const b=this.vt(t,a,c.offset,d,o,l,h);if(a.BATCH_ID||Object.keys(u).length){a.BATCH_ID?b.BATCH_ID=Re(a.BATCH_ID,t,c.offset,d):b.BATCH_ID=rn(d);const e=b.BATCH_ID.array&&b.BATCH_ID.array.buffer;e&&o.indexOf(e)<0&&o.push(e)}return Promise.resolve({count:d,batchTable:u,batchTableBin:f,featureTable:a,pnts:b,transferables:o})}vt(t,e,n,r,i,s,o){const a={};if(e.POSITION){let{byteOffset:s,array:o}=e.POSITION;s=s||0;const c=o?0:n;if(!o){const e=t.slice(s+c,s+c+3*r*4);o=new Float32Array(e)}a.POSITION={byteStride:0,byteOffset:0,itemSize:3,count:r,componentType:5126,array:o},i.push(o.buffer)}else if(e.POSITION_QUANTIZED){let{byteOffset:c}=e.POSITION_QUANTIZED;const{array:u}=e.POSITION_QUANTIZED;c=c||0;const f=u?0:n;a.POSITION={byteStride:0,byteOffset:0,itemSize:3,count:r,componentType:5126,array:this.yt(u||new Uint16Array(t,c+f,3*r),s,o)},i.push(a.POSITION.array.buffer)}if(e.RGBA){let{byteOffset:s,array:o}=e.RGBA;s=s||0;const c=o?0:n;if(!o){const e=t.slice(s+c,s+c+4*r);o=new Uint8Array(e)}a.RGBA={byteStride:0,byteOffset:0,itemSize:4,count:r,componentType:5121,array:o},i.push(o.buffer)}else if(e.RGB){let{byteOffset:s,array:o}=e.RGB;s=s||0;const c=o?0:n;if(!o){const e=t.slice(s+c,s+c+3*r);o=new Uint8Array(e)}a.RGB={byteStride:0,byteOffset:0,itemSize:3,count:r,componentType:5121,array:o},i.push(o.buffer)}else if(e.RGB565){let{byteOffset:s,array:o}=e.RGB565;s=s||0;const c=o?0:n;if(!o){const e=t.slice(s+c,s+c+2*r);o=new Uint16Array(e)}a.RGB565={byteStride:0,byteOffset:0,itemSize:1,count:r,componentType:5123,array:o},i.push(o.buffer)}if(e.NORMAL){let{byteOffset:s,array:o}=e.NORMAL;s=s||0;const c=o?0:n;if(!o){const e=t.slice(s+c,s+c+3*r*4);o=new Float32Array(e)}a.NORMAL={byteStride:0,byteOffset:0,itemSize:3,count:r,componentType:5126,array:o},i.push(o.buffer)}else if(e.NORMAL_OCT16P){let{byteOffset:s,array:o}=e.NORMAL_OCT16P;s=s||0;const c=o?0:n;if(!o){const e=t.slice(s+c,s+c+2*r);o=new Uint8Array(e)}a.NORMAL_OCT16P={byteStride:0,byteOffset:0,itemSize:2,count:r,componentType:5121,array:o},i.push(o.buffer)}return a}yt(t,e,n){return qe(new Float32Array(t.length),t,e,n)}ut(){return null}}function rn(t){const e=(n=t)<256?Uint8Array:n<65536?Uint16Array:Uint32Array;var n;const r=new e(t);for(let e=0;e<t;e++)r[e]=e;return{byteStride:0,byteOffset:0,itemSize:1,count:t,componentType:ze(e),array:r}}class sn{constructor(t,e,n,r){this.o=n,this.i=t,this.it=e||Q,this.ft=r}load(t,e,n=0,r=0,i){return e?this.ot(t,e,n,r,i):C.getArrayBuffer(t,{}).then((e=>{const i=e.data;return this.ot(t,i,n,r)}))}ot(t,e,n,r,i){r||(r=e.byteLength);const s=this.Mt(e,t,n,r),o=[];for(let n=0;n<s.length;n++){let r;if("b3dm"===s[n].magic)r=new Qe(this.i,this.it,this.o);else if("i3dm"===s[n].magic)r=new We(this.i,this.it,this.o,this.ft);else if("pnts"===s[n].magic)r=new nn;else{if("cmpt"!==s[n].magic){console.warn("Unsupported magic in CMPT tile:",s[n].magic);continue}r=new sn(this.i,this.it,this.o,this.ft)}o.push(r.load(t,e,s[n].offset,s[n].byteLength,i).then((t=>t)))}return Promise.all(o).then((t=>({magic:"cmpt",tiles:t})))}Mt(t,e,n,r){const i=new DataView(t,n,r),s=i.getUint32(4,!0);if(1!==s){const t="Unsupported cmpt version: "+s+", url:"+e;return console.warn(t),{error:t}}if(16===i.byteLength)return[];const o=[],a=i.getUint32(12,!0);let c=16;for(let e=0;e<a;e++){const e=Ue(i,c),r=i.getUint32(c+8,!0);o.push({magic:e,buffer:t,offset:c+n,byteLength:r}),c+=r}return o}}function on(t,e){if(t.scenes&&t.scenes.length)for(let n=0,r=t.scenes.length;n<r;n++){const r=t.scenes[n].nodes;for(let n=0,i=r.length;n<i;n++){const i=[];dn(r[n],i,t,e)}}}const an=[],cn=[],un=[],fn=[0,0,0],ln=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}([]),hn=[1,1,1];function dn(t,e,n,r){const i=e.slice(0);if(t.matrix)i.push(t.matrix);else if(t.rotation||t.translation||t.scale){const e=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}(an,t.translation||fn),n=function(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,a=r+r,c=i+i,u=n*o,f=r*o,l=r*a,h=i*o,d=i*a,y=i*c,m=s*o,b=s*a,p=s*c;return t[0]=1-l-y,t[1]=f+p,t[2]=h-b,t[3]=0,t[4]=f-p,t[5]=1-u-y,t[6]=d+m,t[7]=0,t[8]=h+b,t[9]=d-m,t[10]=1-u-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(cn,t.rotation||ln),r=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(un,t.scale||hn);lt(r,n,r);const s=lt([],e,r);i.push(s)}if(t.children&&t.children.length)for(let e=0,s=t.children.length;e<s;e++)dn(t.children[e],i,n,r);if(void 0!==t.mesh){const e=t.mesh,s=n.meshes[e];if(s){const t=i.slice(0),o=s.primitives;for(let i=0,s=o.length;i<s;i++){const s=o[i];s&&(s.matrices=t,r(s,e,i,n))}}}}function yn(t,e){let{byteOffset:n,byteStride:r,count:i}=t;const{componentType:s,itemSize:o}=t,a=t.array.buffer,c=s?Q.getTypedArrayCtor(s):t.array.constructor;if(n=void 0===n?t.array.byteOffset:n,r=r||0,i=i||t.array.length/o,(!r||r===o*c.BYTES_PER_ELEMENT)&&n%c.BYTES_PER_ELEMENT==0){const t=new c(a,n,i*o);for(let r=0;r<i*o;r+=o){e(new c(t.buffer,n+r*c.BYTES_PER_ELEMENT,o),r/o)}return}const u=new Uint8Array(o*c.BYTES_PER_ELEMENT);r||(r=o*c.BYTES_PER_ELEMENT);for(let t=0;t<i;t++){const i=new Uint8Array(a,r*t+n,o*c.BYTES_PER_ELEMENT);u.set(i);e(new c(u.buffer),t),i.set(u)}}var mn=vn("DXT1"),bn=vn("DXT3"),pn=vn("DXT5"),gn=vn("DX10"),wn=function(t){var e,n,r=new Int32Array(t,0,31);if(542327876!==r[0])throw new Error("Invalid magic number in DDS header");if(4&!r[20])throw new Error("Unsupported format, must contain a FourCC code");var i=r[21];switch(i){case mn:e=8,n="dxt1";break;case bn:e=16,n="dxt3";break;case pn:e=16,n="dxt5";break;case 116:n="rgba32f";break;case gn:var s=new Uint32Array(t.slice(128,148));n=s[0];var o=s[1];if(s[2],s[3],s[4],3!==o||2!==n)throw new Error("Unsupported DX10 texture format "+n);n="rgba32f";break;default:throw new Error("Unsupported FourCC code: "+(a=i,String.fromCharCode(255&a,a>>8&255,a>>16&255,a>>24&255)))}var a;var c=r[2],u=1;131072&c&&(u=Math.max(1,r[7]));var f=!1;512&r[28]&&(f=!0);var l,h=r[4],d=r[3],y=r[1]+4,m=h,b=d,p=[];i===gn&&(y+=20);if(f)for(var g=0;g<6;g++){if("rgba32f"!==n)throw new Error("Only RGBA32f cubemaps are supported");h=m,d=b;for(var w=Math.log(h)/Math.log(2)+1,v=0;v<w;v++)l=h*d*16,p.push({offset:y,length:l,shape:[h,d]}),v<u&&(y+=l),h=Math.floor(h/2),d=Math.floor(d/2)}else for(v=0;v<u;v++)l=Math.max(4,h)/4*Math.max(4,d)/4*e,p.push({offset:y,length:l,shape:[h,d]}),y+=l,h=Math.floor(h/2),d=Math.floor(d/2);return{shape:[m,b],images:p,format:n,flags:c,cubemap:f}};function vn(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}var Mn=xt(wn),An=Math.abs,Tn=Math.sin,_n=Math.cos,kn=Math.tan,On=Math.atan,xn=Math.atan2,Sn=Math.sqrt,In=Math.log,En=Math.hypot,Cn=Math.sinh,Un=Math.cosh,Fn=1/0;function Nn(t){var e,n,r,i,s,o,a=[],c=[],u=[],f=[];function l(t,e){for(var n,r=2*_n(2*e),i=t.length-1,s=t[i],o=0;--i>=0;)n=r*s-o+t[i],o=s,s=n;return e+n*Tn(2*e)}function h(t,e,n){for(var r,i,s=Tn(e),o=_n(e),a=Cn(n),c=Un(n),u=2*o*c,f=-2*s*a,l=t.length-1,h=t[l],d=0,y=0,m=0;--l>=0;)r=y,i=d,h=u*(y=h)-r-f*(d=m)+t[l],m=f*y-i+u*d;return[(u=s*c)*h-(f=o*a)*m,u*m+f*h]}t.es,s=i=(r=t.es/(1+Sn(1-t.es)))/(2-r),a[0]=i*(2+i*(-2/3+i*(i*(116/45+i*(26/45+i*(-2854/675)))-2))),c[0]=i*(i*(2/3+i*(4/3+i*(-82/45+i*(32/45+i*(4642/4725)))))-2),s*=i,a[1]=s*(7/3+i*(i*(-227/45+i*(2704/315+i*(2323/945)))-1.6)),c[1]=s*(5/3+i*(-16/15+i*(-13/9+i*(904/315+i*(-1522/945))))),s*=i,a[2]=s*(56/15+i*(-136/35+i*(-1262/105+i*(73814/2835)))),c[2]=s*(-26/15+i*(34/21+i*(1.6+i*(-12686/2835)))),s*=i,a[3]=s*(4279/630+i*(-332/35+i*(-399572/14175))),c[3]=s*(1237/630+i*(i*(-24832/14175)-2.4)),s*=i,a[4]=s*(4174/315+i*(-144838/6237)),c[4]=s*(-734/315+i*(109598/31185)),s*=i,a[5]=s*(601676/22275),c[5]=s*(444337/155925),s=i*i,e=t.k0/(1+i)*(1+s*(1/4+s*(1/64+s/256))),u[0]=i*(i*(2/3+i*(-37/96+i*(1/360+i*(81/512+i*(-96199/604800)))))-.5),f[0]=i*(.5+i*(-2/3+i*(5/16+i*(41/180+i*(-127/288+i*(7891/37800)))))),u[1]=s*(-1/48+i*(-1/15+i*(437/1440+i*(-46/105+i*(1118711/3870720))))),f[1]=s*(13/48+i*(i*(557/1440+i*(281/630+i*(-1983433/1935360)))-.6)),s*=i,u[2]=s*(-17/480+i*(37/840+i*(209/4480+i*(-5569/90720)))),f[2]=s*(61/240+i*(-103/140+i*(15061/26880+i*(167603/181440)))),s*=i,u[3]=s*(-4397/161280+i*(11/504+i*(830251/7257600))),f[3]=s*(49561/161280+i*(-179/168+i*(6601661/7257600))),s*=i,u[4]=s*(-4583/161280+i*(108847/3991680)),f[4]=s*(34729/80640+i*(-3418889/1995840)),s*=i,u[5]=s*(-20648693/638668800),f[5]=.6650675310896665*s,o=l(c,t.phi0),n=-e*(o+function(t,e){var n,r=2*_n(e),i=t.length-1,s=t[i],o=0;for(;--i>=0;)n=r*s-o+t[i],o=s,s=n;return Tn(e)*n}(f,2*o)),t.fwd=function(t,r){var i,s,o,a,u,d=t.phi,y=t.lam;d=l(c,d),i=Tn(d),s=_n(d),a=Tn(y),o=_n(y),d=xn(i,o*s),y=xn(a*s,En(i,s*o)),y=function(t){var e=An(t);return e=function(t){var e=1+t,n=e-1;return 0===n?t:t*In(e)/n}(e*(1+e/(En(1,e)+1))),t<0?-e:e}(kn(y)),u=h(f,2*d,2*y),d+=u[0],y+=u[1],An(y)<=2.623395162778?(r.y=e*d+n,r.x=e*y):r.x=r.y=Fn},t.inv=function(t,r){var i,s,o,c,f,d=t.y,y=t.x;d=(d-n)/e,An(y/=e)<=2.623395162778?(d+=(f=h(u,2*d,2*y))[0],y+=f[1],y=On(Cn(y)),i=Tn(d),s=_n(d),c=Tn(y),o=_n(y),y=xn(c,o*s),d=xn(i*o,En(c,o*s)),r.phi=l(a,d),r.lam=y):r.phi=r.lam=Fn}}const Pn=Math.PI/180,Bn=6378137*Math.PI/180,Dn=85.0511287798,Rn={};function Ln(t,e,n,r){if("EPSG:3857"===n)return function(t,e){const n=Dn,r=e[0],i=Math.max(Math.min(n,e[1]),-n);let s;s=0===i?0:Math.log(Math.tan((90+i)*Pn/2))/Pn;return t[0]=r*Bn,t[1]=s*Bn,t}(t,e);if(!n||"EPSG:9807"!==n.code&&"Traverse_Mercator"!==n.code){if("EPSG:4326"===n||"EPSG:4490"===n||"identity"===n)return jn(t,e);if("baidu"===n)return jn(t,e);throw new Error("unsupported projection:"+n)}{if(!(!r||4326===r.wkid))return function(t,e){return t[0]=e[0],t[1]=e[1],t}(t,e);const i=JSON.stringify(n);let s=Rn[i];return s||(s=Rn[i]=function(t){const e={a:qn,es:Vn,x0:pe(t.falseEasting)?5e5:t.falseEasting,y0:pe(t.falseNorthing)?0:t.falseNorthing,k0:t.scaleFactor||.9996,lam0:(t.centralMeridian||0)*zn,phi0:(t.latitudeOfOrigin||0)*zn,originLam0:t.startLongtitude||0,originPhi0:t.startLatitude||0};Nn(e);const n={lam:0,phi:0},r={};let i=0,s=0;(e.originLam0||e.originPhi0)&&(n.lam=e.originLam0*zn-e.lam0,n.phi=e.originPhi0*zn,e.fwd(n,r),i=e.a*r.x+e.x0,s=e.a*r.y+e.y0);return{project:function(t,o){n.lam=t[0]*zn-e.lam0,n.phi=t[1]*zn,e.fwd(n,r);const a=e.a*r.x+e.x0-i,c=e.a*r.y+e.y0-s;return o[0]=a,o[1]=c,o}}}(n)),s.project(e,t)}}function jn(t,e){return t[0]=e[0],t[1]=e[1],t}const zn=.017453292519943295,qn=6378137,Vn=.0066943799901413165;const Gn=ft([]),$n=Ye().draco,Xn=Ye().ktx2,Hn={"pbrMetallicRoughness":{"baseColorFactor":[.5,.5,.5,1],"metallicFactor":0,"roughnessFactor":.5}},Jn={"position":{name:"POSITION",accessor:{"componentType":5126,"type":"VEC3"}},"normal":{name:"NORMAL",accessor:{"componentType":5126,"type":"VEC3"}},"uv0":{name:"TEXCOORD_0",accessor:{"componentType":5126,"type":"VEC2"}},"color":{name:"COLOR_0",accessor:{"componentType":5121,"type":"VEC4"}},"uv-region":{name:"uvRegion",accessor:{"componentType":5123,"type":"VEC4"}},"feature-index":{name:"_BATCHID",accessor:{"componentType":5125,"type":"SCALAR"}},"faceRange":{name:"faceRange",accessor:{"componentType":5125,"type":"VEC2"}}};function Kn(t,e,n,r,i,s){const o=[],a=[],c=[];for(let e=0;e<t.meshes.length;e++){const{geometry:n,material:r}=t.meshes[e],i=C.getArrayBuffer(n.url,s);i.xhr.url=n.url,c.push(i.xhr);const u=i.then((t=>({buffer:t})));o.push(u);const f=[];if(rr(r,f),f.length){const t=f.map((t=>{const e=C.getArrayBuffer(t.url,s);return e.xhr.url=t.url,c.push(e.xhr),e.then((e=>e&&e.status?null:{buffer:e,mimeType:t.mimeType,format:t.format}))}));o.push(...t)}a[e]=f.length}const u=Promise.all(o).then((s=>{for(let t=0;t<s.length;t++)if(!s[t]||!s[t].buffer)return Promise.resolve(null);const o=[];let c=0;for(let t=0;t<a.length;t++){const e=a[t];o.push({geoBuffer:{data:s[c].buffer.data},textureBuffers:s.slice(c+1,e+c+1).map((t=>({data:t.buffer.data,mimeType:t.mimeType,format:t.format})))}),c+=1+e}const u=function(t,e,n,r,i,s){const o={asset:{generator:"i3s",version:"2.0"},extensions:{},scene:0,scenes:[{nodes:[]}],nodes:{},meshes:{},materials:[],skins:[],animations:null,textures:[],transferables:[]},a=[];for(let c=0;c<t.meshes.length;c++){let{material:u}=t.meshes[c];const{geometry:f}=t.meshes[c];let l;const h=e[c].geoBuffer.data;if(!h)continue;l=ur(h)?Qn(o,c,f,h,t.transform,t.center,i,s):Zn(o,c,f,h,t.transform,t.center,i,s),a.push(l),o.nodes[c]={mesh:c,nodeIndex:c,matrix:ft([])},o.scenes[0].nodes[c]=o.nodes[c],u||(u=Hn);const d=er(c,o,u,e[c].textureBuffers,n,r);a.push(d)}return Promise.all(a).then((()=>({gltf:o,featureTable:{BATCH_LENGTH:0},transferables:o.transferables})))}(t,o,e,i,n,r);return u}));return u.xhr=c,u}const Yn={"magFilter":9728,"minFilter":9728,"wrapR":33071,"wrapS":33071,"wrapT":33071};function Qn(t,e,n,r,i,s,o,a){const c=n.info.compressedAttributes.attributes.reduce(((t,e,n)=>{const r=Jn[e];if(!r)return t;return t[r.name||e]=n,t}),{});return $n(r,{attributes:c,metadatas:{"POSITION":[{name:"i3s-scale_x",type:"double"},{name:"i3s-scale_y",type:"double"}]},useUniqueIDs:!1,skipAttributeTransform:!1}).then((n=>tr(n,t,e,i,s,o,a)))}const Wn={position:function(t,e,n){const r=3*t.vertexCount,i=new Float32Array(e,n,r);return t.position={array:i,componentType:5126,itemSize:3,count:r/3,meta:{"i3s-scale_x":1,"i3s-scale_y":1},type:"VEC3"},n+=4*r},normal:function(t,e,n){const r=3*t.vertexCount,i=new Float32Array(e,n,r);return t.normal={array:i,componentType:5126,itemSize:3,count:r/3,type:"VEC3"},n+=4*r},uv0:function(t,e,n){const r=2*t.vertexCount,i=new Float32Array(e,n,r);return t.uv0={array:i,componentType:5126,itemSize:2,count:r/2,type:"VEC2"},n+=4*r},color:function(t,e,n){const r=4*t.vertexCount,i=new Uint8Array(e,n,r);return t.color={array:i,componentType:5121,itemSize:4,count:r/4,type:"VEC4"},n+=r},featureId:function(t,e,n){return n+=8*t.featureCount},id:function(t,e,n){return n+=8*t.featureCount},faceRange:function(t,e,n){const r=2*t.featureCount,i=new Uint32Array(e,n,r);return t.faceRange={array:i,componentType:5125,itemSize:2,count:r/2,type:"VEC2"},n+=4*r},uvRegion:function(t,e,n){const r=4*t.vertexCount,i=new Uint16Array(e,n,r);return t["uv-region"]={array:i,componentType:5123,itemSize:4,count:r/4,type:"VEC4"},n+=2*r},region:function(t,e,n){const r=4*t.vertexCount,i=new Uint16Array(e,n,r);return t["uv-region"]={array:i,componentType:5123,itemSize:4,count:r/4,type:"VEC4"},n+=2*r}};function Zn(t,e,n,r,i,s,o,a){const c={vertexCount:0},u=new DataView(r);try{let t=0;c.vertexCount=u.getUint32(t,1),t+=4,c.featureCount=u.getUint32(t,1),t+=4;const e=n.info.ordering?null:n.info;if(e){const n=[];for(const t in e)"offset"!==t&&""!==t&&n.push(t);for(let e=0;e<n.length;e++)Wn[n[e]]?t=Wn[n[e]](c,r,t):console.error("Unknown decoder for",n[e])}else{const e=n.info;let i=e.ordering,s=e.featureAttributeOrder;const o=null;o&&o.geometryData&&o.geometryData[0]&&o.geometryData[0].params;for(let e=0;e<i.length;e++){const n=Wn[i[e]];n||console.log(i[e]),t=n(c,r,t)}for(let e=0;e<s.length;e++){const n=Wn[s[e]];n||console.log(s[e]),t=n(c,r,t)}}}catch(t){}c.scale_x=1,c.scale_y=1;const f={};for(const t in c){const e=Jn[t]&&Jn[t].name;e&&(f[e]=c[t])}if(c.faceRange){const t=c.faceRange.array,e=t.length/2,n=(l=e)<=255?Uint8Array:l<=65535?Uint16Array:Uint32Array,r=new n(f.POSITION.array.length/3);for(let e=0;e<t.length-1;e+=2){const n=e/2,i=t[e],s=t[e+1];for(let t=i;t<=s;t++)r[3*t]=n,r[3*t+1]=n,r[3*t+2]=n}f._BATCHID={componentType:$e(n),array:r,itemSize:1,count:r.length,type:"SCALAR"}}var l;return tr({attributes:f},t,e,i,s,o,a)}function tr(t,e,n,r,i,s,o){const a={attributes:t.attributes,material:n,indices:t.indices,mode:4};!function(t){const e=t.array,n=t.meta&&t.meta["i3s-scale_x"],r=t.meta&&t.meta["i3s-scale_y"];if(n&&r&&(1!==n||1!==r))for(let t=0;t<e.length;t+=3)e[t]*=n.value,e[t+1]*=r.value}(t.attributes.POSITION);const c=function(t,e,n,r,i){let s,o=[0,0,0,1];const a=[0,0],c=Ln([],n,r,i);c[2]=n[2];const u=e&&ht(Gn,e);return yn(t,(t=>(o[0]=t[0],o[1]=t[1],o[2]=t[2],u||(o=Mt(o,o,e)),n&&gt(o,o,n),Ln(a,o,r,i),s=o[2],t[0]=a[0]-c[0],t[1]=a[1]-c[1],t[2]=s-c[2],t))),c}(t.attributes.POSITION,r,i,s,o);e.meshes[n]={primitives:[a],index:n},e.extensions.MAPTALKS_RTC={projCenter:c},e.extensions.CESIUM_RTC={rtcCoord:i};for(const n in t.attributes)cr(e.transferables,t.attributes[n].array.buffer);return t.indices&&cr(e.transferables,t.indices.array.buffer),a}function er(t,e,n,r,i,s){const o=r.map((t=>function(t,e,n,r,i){if("dds"===e){const e=Mn(t),r=e.images.map((e=>new Uint8Array(t,e.offset,e.length))),i="dxt1"===e.format?33777:33779;return Promise.resolve({image:{mipmap:r,width:e.shape[0],height:e.shape[1],mimeType:n},sampler:Yn,format:i})}if("png"===e||"jpg"===e)return function(t,e){ir||(ir=new OffscreenCanvas(2,2),sr=ir.getContext("2d",{willReadFrequently:!0}));const n=new Blob([new Uint8Array(t)]);return createImageBitmap(n).then((t=>{let{width:n,height:r}=t;or(n)||(n=ar(n)),or(r)||(r=ar(r));const i=e;i&&(n=Math.min(i,n),r=Math.min(i,r)),ir.width=n,ir.height=r,sr.drawImage(t,0,0,n,r),t.close();const s=sr.getImageData(0,0,n,r);return{width:n,height:r,array:new Uint8Array(s.data)}})).catch((()=>({width:2,height:2,array:new Uint8Array(4)})))}(t,i).then((t=>{t.mimeType=n;return{image:t,sampler:Yn,format:6408}}));if("ktx2"===e)return Xn(t,r).then((t=>(t.mimeType=n,{image:t,sampler:Yn,format:t.format})));return null}(t.data,t.format,t.mimeType,i,s).then((t=>{if(t.image)if(t.image.array)cr(e.transferables,t.image.array.buffer);else if(t.image.mipmap)for(let n=0;n<t.image.mipmap.length;n++)cr(e.transferables,t.image.mipmap[n].buffer);return t}))));return Promise.all(o).then((r=>{nr(t,e,n,r)}))}function nr(t,e,n,r){const i=JSON.parse(JSON.stringify(n)),s=e.textures;r.ptr||(r.ptr=0);for(const t in n)n[t]&&n[t].url?(s.push(r[r.ptr++]),i[t]={index:s.length-1},void 0!==n[t].factor&&(i[t].scale=n[t].factor)):ge(n[t])&&(i[t]=nr(-1,e,n[t],r));return t>=0&&(e.materials[t]=i),i}function rr(t,e){for(const n in t)t[n]&&t[n].url?e.push({url:t[n].url,mimeType:t[n].mimeType,format:t[n].format}):ge(t[n])&&rr(t[n],e)}let ir,sr;function or(t){return!(t&t-1)&&0!==t}function ar(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function cr(t,e){e&&(t.indexOf(e)>=0||t.push(e))}function ur(t){const e=new Uint8Array(t,0,5);return e[0]==="D".charCodeAt()&&e[1]==="R".charCodeAt()&&e[2]==="A".charCodeAt()&&e[3]==="C".charCodeAt()&&e[4]==="O".charCodeAt()}var fr="undefined"!=typeof Float32Array?Float32Array:Array;function lr(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}var hr=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t};!function(){var t=function(){var t=new fr(3);return fr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}()}();const dr=[];const yr=[],mr=[],br=[],pr=[],gr=[],wr=[],vr=[];function Mr(t,e,n,r,i,s){lr(pr,t[3*e],t[3*e+1],t[3*e+2]),lr(gr,t[3*n],t[3*n+1],t[3*n+2]),lr(wr,t[3*r],t[3*r+1],t[3*r+2]);const o=hr(yr,wr,gr),a=hr(mr,pr,gr),c=function(t,e,n){var r=e[0],i=e[1],s=e[2],o=n[0],a=n[1],c=n[2];return t[0]=i*c-s*a,t[1]=s*o-r*c,t[2]=r*a-i*o,t}(br,o,a);!function(t,e){var n=e[0],r=e[1],i=e[2],s=n*n+r*r+i*i;s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s)}(vr,c),i[3*e]=i[3*e]||0,i[3*n]=i[3*n]||0,i[3*r]=i[3*r]||0,i[3*e+1]=i[3*e+1]||0,i[3*n+1]=i[3*n+1]||0,i[3*r+1]=i[3*r+1]||0,i[3*e+2]=i[3*e+2]||0,i[3*n+2]=i[3*n+2]||0,i[3*r+2]=i[3*r+2]||0,i[3*e]+=vr[0],i[3*n]+=vr[0],i[3*r]+=vr[0],i[3*e+1]+=vr[1],i[3*n+1]+=vr[1],i[3*r+1]+=vr[1],i[3*e+2]+=vr[2],i[3*n+2]+=vr[2],i[3*r+2]+=vr[2],s[e]+=1,s[n]+=1,s[r]+=1}const Ar=[1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1],Tr=[0,0,1,0,0,1,0,0,-1,0,0,0,0,0,0,1],_r=2*Math.PI*6378137/360,kr="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;let Or,xr,Sr=!1;if("undefined"!=typeof OffscreenCanvas){try{xr=new OffscreenCanvas(2,2).getContext("2d",{willReadFrequently:!0})}catch(t){}xr&&"undefined"!=typeof createImageBitmap&&(Sr=!0)}const Ir=ft([]),Er=[0,0,0],Cr=[],Ur=[],Fr=[],Nr=[],Pr={"POSITION":1,"TEXCOORD_0":1,"TEXCOORD_1":1,"NORMAL":1,"TANGENT":1},Br={"TEXCOORD_0":1e-4,"TEXCOORD_1":1e-4};let Dr;class Rr{constructor(t,e,n,r){this.id=t,this.options=e,this.At=(...t)=>this.requestImage.call(this,...t),this.Tt=n,this._t={},r(null,{},[])}kt(t){this.Ot||(this.o=t,this.xt=new nn,this.Ot=new Qe(this.At,Q,t),this.St=new We(this.At,Q,t))}requestImage(t,e){Sr?fetch(t).then((t=>t.arrayBuffer())).then((t=>{const e=new self.Blob([new Uint8Array(t)]);return createImageBitmap(e)})).then((t=>{Or.width=t.width,Or.height=t.height,xr.drawImage(t,0,0);const n=xr.getImageData(0,0,Or.width,Or.height);t.close(),e(null,{width:t.width,height:t.height,data:new Uint8Array(n.data)})})):this.Tt("requestImage",{url:t},null,e)}loadTile(t,e){this.kt(t.supportedFormats);const{service:n,url:r,arraybuffer:i}=t,s=n.fetchOptions||{};if(s.referrer=t.referrer,s.referrerPolicy=s.referrerPolicy||"origin",function(t){return t.indexOf("i3s:")>=0}(r)){const i=t.i3sInfo,o=n.maxTextureSize||0,a=Kn(i,t.supportedFormats,this.options.projection,t.projection,o,s);return a.then((t=>{if(delete this._t[r],!t)return void e({status:404,url:r,i3sInfo:i});if(!Object.keys(t.gltf.meshes).length)return void e({status:404,url:r,i3sInfo:i});t.gltf.url=r;const{transferables:s}=t;t.magic="b3dm",n.createNormalIfMissed&&this.It(t.gltf),Hr(n)&&this.Et(t.gltf),e(null,t,s)})),void(this._t[r]=a.xhr)}if(i){delete this._t[r];const n=Ue(new DataView(i),0);if("{"===n[0]||" "===n[0]||"<"===n[0]){const n=function(t,e,n){if(kr){const r=new Uint8Array(t,e,n);return kr.decode(r)}return Me(new Uint8Array(t,e,n))}(i,0,i.byteLength),s=JSON.parse(n);s.accessors?this.Ct(s,r,t,"gltf",e):this.Ut(t.rootIdx,s,i,r,e)}else this.Ct(i,r,t,n,e)}else{let i=n.urlParams;i&&(i=(r.indexOf("?")>0?"&":"?")+i);const o=r.replace(/\\+/g,"%2B");let a=C.getArrayBuffer(o+(i||""),s);const c=a.xhr;a=a.then((n=>{delete this._t[r],n&&n.status?e(n):(t.arraybuffer=n&&n.data,this.loadTile(t,e))})).catch((t=>{delete this._t[r],e(t)})),this._t[r]=c}}Ct(t,e,n,r,i){r=r&&r.toLowerCase();const{service:s}=n;if("b3dm"===r){this.Ot.load(e,t,0,0,{maxTextureSize:s.maxTextureSize||0}).then((t=>{if(t.error)return void i(t);const{content:e,transferables:r}=this.Ft(t,n);s.createNormalIfMissed&&this.It(e.gltf),Hr(s)&&this.Et(e.gltf),i(null,e,r)})).catch((t=>{i(t)}))}else if("pnts"===r){const r=n.transform||Ir;this.xt.load(e,t).then((t=>{const{content:e,transferables:s}=this.Nt(t,r,n.rootIdx);this.Pt(e),i(null,e,s)}))}else if("i3dm"===r){const r=n.transform||Ir;this.St.load(e,t,0,0,{maxTextureSize:s.maxTextureSize||0}).then((t=>{const{content:e,transferables:o}=this.Bt(t,r,n.rootIdx);s.createNormalIfMissed&&this.It(e.gltf),Hr(s)&&this.Et(e.gltf),i(null,e,o)}))}else if("cmpt"===r){new sn(this.At,Q,this.o,s.maxTextureSize||0).load(e,t,0,0,{maxTextureSize:s.maxTextureSize||0}).then((t=>{const{content:e,transferables:r}=this.Dt(t,n);this.Rt(e,s),Hr(s)&&this.Lt(e),i(null,e,r)})).catch((t=>{i(t)}))}else if("gltf"===r){this.st||(this.st=Ye());const r=e.substring(0,e.lastIndexOf("/")),o=t instanceof ArrayBuffer&&{buffer:t,byteOffset:0,byteLength:t.byteLength}||t;let a;try{a=new Q(r,o,{transferable:!0,requestImage:this.At,decoders:this.st,supportedFormats:this.o,maxTextureSize:s.maxTextureSize||0})}catch(t){i(t)}a.load({skipAttributeTransform:!1}).then((t=>{t.url=e,this.jt(t,null,n),s.createNormalIfMissed&&this.It(t),Hr(s)&&this.Et(t),i(null,{magic:"gltf",gltf:t},a.transferables)}))}else i(new Error("unsupported tile format: "+r))}Rt(t,e){t.content?t.content.forEach((t=>{this.Rt(t,e)})):e.createNormalIfMissed&&this.It(t.gltf)}Lt(t){t.content?t.content.forEach((t=>{this.Lt(t)})):this.Et(t.gltf)}zt(t,e){if(this.qt(t,e)&&!t.attributes.NORMAL){const e=t.attributes.POSITION.array,n=e.length,r=this.Vt()?Dr.subarray(0,n):e,i=function(t,e,n){const r=n||[];r.setLength&&r.setLength(t.length);const i=dr;i.length<t.length/3&&(i.length=t.length/3),i.fill(0,0,t.length/3);const s=void 0===e.length?e:e.length;for(let n=0;n<s/3;n++)void 0===e.length?Mr(t,3*n,3*n+1,3*n+2,r,i):Mr(t,e[3*n],e[3*n+1],e[3*n+2],r,i);const o=r.getLength?r.getLength():r.length;for(let t=0;t<o;t+=3){const e=i[t/3];0!==e?(r[t]/=e,r[t+1]/=e,r[t+2]/=e):(r[t]=0,r[t+1]=0,r[t+2]=0)}return r}(r,t.indices.array,new Float32Array(r.length));t.attributes.NORMAL={array:i,byteLength:i.byteLength,byteOffset:0,byteStride:0,componentType:5126,count:i.length/3,itemSize:3,name:"NORMAL",type:"VEC3"}}}Et(t){if(!t||!t.meshes||t.extensionsUsed&&t.extensionsUsed.indexOf("KHR_techniques_webgl")>-1)return;if(t.asset&&t.asset.sharePosition)return;const e=t.meshes;for(const t in e){e[t].primitives.forEach((t=>{t.compressed_int16_params={};const e=t.attributes;for(const n in e)if(Pr[n]&&e[n].array&&e[n].array instanceof Float32Array){let r=1;this.Vt()&&"POSITION"===n&&(r=_r,t.compressed_int16_params.compressed_ratio=r);const i=Gr(e[n].array,r,e[n].min,e[n].max,n);if(!i)continue;const{array:s,range:o}=i;e[n].componentType=5124,e[n].array=s,t.compressed_int16_params[n]=o}}))}}It(t){if(!t||!t.meshes||t.extensionsUsed&&t.extensionsUsed.indexOf("KHR_techniques_webgl")>-1)return;if(t.asset&&t.asset.sharePosition)return;const e=t.meshes;for(const n in e){e[n].primitives.forEach((e=>{this.zt(e,t)}))}}Pt(t){if(!t||!t.pnts)return;const e=t.pnts;t.compressed_int16_params={};for(const n in e)if(Pr[n]&&e[n].array&&e[n].array instanceof Float32Array){let r=1;this.Vt()&&"POSITION"===n&&(r=_r,t.compressed_int16_params.compressed_ratio=r);const{array:i,range:s}=Gr(e[n].array,r,e[n].min,e[n].max,n);e[n].array=i,t.compressed_int16_params[n]=s}}Gt(t){const e=[];for(let n=0;n<t.length;n++){const r=t[n];if(!r.childTile)continue;const i={boundingVolume:{sphere:[r.boundingSphere.center.x,r.boundingSphere.center.y,r.boundingSphere.center.z,r.boundingSphere.radius]},content:{uri:r.childTile},geometricError:r.boundingSphere.radius/r.rangeList*16,refine:"REPLACE"};e.push(i)}return e}Ut(t,e,n,r,i){return e.capabilities,void i(null,e)}Dt(t,e){const{tiles:n}=t,r={magic:"cmpt",content:[]},i=[];for(let t=0;t<n.length;t++){const{magic:s}=n[t];if("b3dm"===s){const{content:s,transferables:o}=this.Ft(n[t],e);qr(i,o),r.content.push(s)}else if("i3dm"===s){const{transform:s,rootIdx:o}=e,{content:a,transferables:c}=this.Bt(n[t],s,o);qr(i,c),r.content.push(a)}else if("pnts"===s){const{transform:s,rootIdx:o}=e,{content:a,transferables:c}=this.Nt(n[t],s,o);qr(i,c),r.content.push(a)}else if("cmpt"===s){const{content:s,transferables:o}=this.Dt(n[t],e);qr(i,o),r.content.push(s)}}return{content:r,transferables:i}}Ft(t,e){const{gltf:n,transferables:r,featureTable:i}=t;return this.jt(n,i,e),delete t.transferables,{content:t,transferables:r}}jt(t,e,n){const r=function(t){if(!t||!t.meshes)return!1;const e="visited";let n=1;const r=[];for(const i in t.meshes){const s=t.meshes[i],{primitives:o}=s;if(o)for(let t=0;t<o.length;t++){const i=o[t].attributes&&o[t].attributes.POSITION;if(!i||!i.array)continue;i.array.buffer[e]||(i.array.buffer[e]=n++);const s=n-1+"-"+(i.byteOffset||0);if(r.indexOf(s)>=0)return!0;r.push(s)}}return!1}(t);this.$t(t);n.service.createNormalIfMissed||this.Xt(t),t.asset||(t.asset={}),r?(t.asset.sharePosition=!0,this.Ht(t,e,n.upAxis,n.transform)):this.Jt(t,e,n.upAxis,n.transform)}Bt(t,e,n){const{featureTable:r}=t,i=t.i3dm,s=r&&r.RTC_CENTER||[0,0,0],o=this.options.projection,a=e&&ht(Ir,e),c={xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0,hmin:1/0,hmax:-1/0};jr(i.POSITION.array,3,s,Ir,c);const u=zr(c);e&&!a&&Mt(u,u,e);const f=this.Kt(u),l=[];Ln(l,f,o),l[2]=f[2];const h=bt([],u),d=[0,0,0],y=[0,0,0],m=[0,0],b=[1/0,1/0,1/0],p=[-1/0,-1/0,-1/0];yn(i.POSITION,(t=>{d[0]=t[0]+s[0],d[1]=t[1]+s[1],d[2]=t[2]+s[2],e&&!a&&Mt(d,d,e),0===_t(d)?pt(y,0,0,-6378137):xe(y,d),Ln(m,y,o),t[0]=m[0]-l[0],t[1]=m[1]-l[1],t[2]=y[2]-l[2],t[0]<b[0]&&(b[0]=t[0]),t[1]<b[1]&&(b[1]=t[1]),t[2]<b[2]&&(b[2]=t[2]),t[0]>p[0]&&(p[0]=t[0]),t[1]>p[1]&&(p[1]=t[1]),t[2]>p[2]&&(p[2]=t[2])})),i.POSITION.min=b,i.POSITION.max=p,e&&Mt(u,u,e),t.rtcCenter=h,t.rtcCoord=f,t.projCenter=l,t.rootIdx=n;const g=t.transferables;return delete t.transferables,{content:t,transferables:g}}Nt(t,e,n){const{featureTable:r}=t,i=t.pnts,s=r&&r.RTC_CENTER||[0,0,0],o=this.options.projection,a=e&&ht(Ir,e),c={xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0,hmin:1/0,hmax:-1/0};jr(i.POSITION.array,3,s,e,c);const u=zr(c),f=this.Yt(u),l=bt([],u),h=[1/0,1/0,1/0],d=[-1/0,-1/0,-1/0];let y=[0,0,0,1];const m=[0,0,0],b=[0,0];yn(i.POSITION,(t=>(y[0]=t[0]+s[0],y[1]=t[1]+s[1],y[2]=t[2]+s[2],e&&!a&&(y=Mt(y,y,e)),0===_t(y)?pt(m,0,0,-6378137):xe(m,y),Ln(b,m,o),t[0]=b[0]-f[0],t[1]=b[1]-f[1],t[2]=m[2]-f[2],t[0]<h[0]&&(h[0]=t[0]),t[1]<h[1]&&(h[1]=t[1]),t[2]<h[2]&&(h[2]=t[2]),t[0]>d[0]&&(d[0]=t[0]),t[1]>d[1]&&(d[1]=t[1]),t[2]>d[2]&&(d[2]=t[2]),t))),i.POSITION.min=h,i.POSITION.max=d,e&&Mt(u,u,e);const p=this.Kt(u);t.rtcCenter=l,t.projCenter=f,t.rtcCoord=p,t.rootIdx=n;const g=t.transferables;return delete t.transferables,{content:t,transferables:g}}$t(t){if(!Array.isArray(t.textures))return;const e=t.textures;for(let t=0;t<e.length;t++){const n=e[t]&&e[t].image&&e[t].image.array;if(n&&n.length){const r=n[0],i=n[1],s=n[2],o=n[3];let a=!0;for(let t=4;t<n.length;t+=4)if(n[t]!==r||n[t+1]!==i||n[t+2]!==s||n[t+3]!==o){a=!1;break}a&&(e[t].image.color=[r/255,i/255,s/255,o/255],delete e[t].image.array)}}}Xt(t){const e=t.meshes;for(const n in e){const r=e[n];if(!r)continue;const i=r.primitives;if(i)for(let e=0;e<i.length;e++){if(!i[e])continue;if(!i[e].attributes||i[e].attributes.NORMAL)continue;const n=i[e].material;if(!pe(n)){const e=t.materials[n];if(!e)continue;e.extensions||(e.extensions={}),e.extensions.KHR_materials_unlit={}}}}}abortTileLoading(t,e){const n=this._t[t.url];if(Array.isArray(n))for(let t=0;t<n.length;t++)n[t].abort();else n&&n.abort&&n.abort();delete this._t[t.url],e(null)}Qt(t,e,n,r){const i=e&&e.RTC_CENTER||t.extensions&&t.extensions.CESIUM_RTC&&t.extensions.CESIUM_RTC.center;let s=Ar;"X"===(n=n&&n.toUpperCase())?s=Tr:"Z"===n&&(s=Ir),t.extensions=t.extensions||{},t.extensions.CESIUM_RTC||(t.extensions.CESIUM_RTC={}),i&&(t.extensions.CESIUM_RTC.center=i),t.extensions.MAPTALKS_RTC={};const o={xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0,hmin:1/0,hmax:-1/0};on(t,(t=>{if(!(t.attributes&&t.attributes.POSITION))return;const e=ft(Cr);t.matrices&&Vr(e,t.matrices);const n=t.attributes.POSITION.array,a=t.attributes.POSITION.itemSize;lt(e,s,e),r&&lt(e,r,e),jr(n,a,i||Er,e,o,t.compressUniforms)}));const a=zr(o);return{rtcCenter:i,modelCenter:a,upAxisTransform:s}}Ht(t,e,n,r){const{modelCenter:i,upAxisTransform:s,rtcCenter:o}=this.Qt(t,e,n),a=this.Yt(i);t.extensions.MAPTALKS_RTC.projCenter=a,t.extensions.MAPTALKS_RTC.rtcCoord=t.extensions.CESIUM_RTC.rtcCoord=this.Kt(i);const c=bt([],i);r&&Mt(i,i,r),t.extensions.CESIUM_RTC.rtcCoord=this.Kt(i),o||(on(t,(t=>{if(t.attributes&&t.attributes.POSITION){const e=t.attributes.POSITION;if(e.array.buffer.projected&&e.array.buffer.projected[e.byteOffset])return;const n=ft(Cr);t.matrices&&Vr(n,t.matrices),lt(n,s,n);const r=function(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],u=e[7],f=e[8],l=e[9],h=e[10],d=e[11],y=e[12],m=e[13],b=e[14],p=e[15],g=n*a-r*o,w=n*c-i*o,v=n*u-s*o,M=r*c-i*a,A=r*u-s*a,T=i*u-s*c,_=f*m-l*y,k=f*b-h*y,O=f*p-d*y,x=l*b-h*m,S=l*p-d*m,I=h*p-d*b,E=g*I-w*S+v*x+M*O-A*k+T*_;return E?(E=1/E,t[0]=(a*I-c*S+u*x)*E,t[1]=(i*S-r*I-s*x)*E,t[2]=(m*T-b*A+p*M)*E,t[3]=(h*A-l*T-d*M)*E,t[4]=(c*O-o*I-u*k)*E,t[5]=(n*I-i*O+s*k)*E,t[6]=(b*v-y*T-p*w)*E,t[7]=(f*T-h*v+d*w)*E,t[8]=(o*S-a*O+u*_)*E,t[9]=(r*O-n*S-s*_)*E,t[10]=(y*A-m*v+p*g)*E,t[11]=(l*v-f*A-d*g)*E,t[12]=(a*k-o*x-c*_)*E,t[13]=(n*x-r*k+i*_)*E,t[14]=(m*w-y*M-b*g)*E,t[15]=(f*M-l*w+h*g)*E,t):null}(Ur,n),i=[1/0,1/0,1/0],o=[-1/0,-1/0,-1/0];yn(e,(t=>{Mt(t,t,n),t[0]=t[0]-c[0],t[1]=t[1]-c[1],t[2]=t[2]-c[2],Mt(t,t,r),t[0]<i[0]&&(i[0]=t[0]),t[1]<i[1]&&(i[1]=t[1]),t[2]<i[2]&&(i[2]=t[2]),t[0]>o[0]&&(o[0]=t[0]),t[1]>o[1]&&(o[1]=t[1]),t[2]>o[2]&&(o[2]=t[2])})),e.min=i,e.max=o,e.array.buffer.projected||(e.array.buffer.projected={}),e.array.buffer.projected[e.byteOffset]=1}})),t.extensions.CESIUM_RTC.center=c)}Jt(t,e,n,r){const{modelCenter:i,rtcCenter:s}=this.Qt(t,e,n,r),o=this.Yt(i);t.extensions.MAPTALKS_RTC.projCenter=o,t.extensions.MAPTALKS_RTC.rtcCoord=t.extensions.CESIUM_RTC.rtcCoord=this.Kt(i),on(t,(e=>{if(e.attributes&&e.attributes.POSITION){const i=this.qt(e,t);if(i){const t=e.attributes.POSITION.array.length;(!Dr||Dr.length<t)&&(Dr=new Float32Array(t))}e.attributes.NORMAL&&this.Wt(e.attributes.NORMAL,e.matrices,n),e.attributes.TANGENT&&this.Wt(e.attributes.TANGENT,e.matrices,n);const{newPositions:o}=this.Zt(e.attributes.POSITION,e.matrices,s,t.extensions.MAPTALKS_RTC,n,r,e.compressUniforms,i),{componentType:a}=e.attributes.POSITION;5126!==a&&(e.attributes.POSITION.array=new Float32Array(o))}}));for(const e in t.nodes){t.nodes[e].matrix=Ir}}Yt(t){const e=this.options.projection;"identity"===e?bt(Fr,t):0===_t(t)?pt(Fr,0,0,-6378137):xe(Fr,t),Ln(Nr,Fr,e);const n=Fr[2],r=[];return r[0]=Nr[0],r[1]=Nr[1],r[2]=n,r}Wt(t,e,n){let r;r="Y"===n?Ar:"X"===n?Tr:Ir;const i=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}([],r);if(Vr(i,e),ht(i,Ir))return;const s=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}([],i),o=[];yn(t,(t=>(function(t,e,n){var r=e[0],i=e[1],s=e[2];t[0]=r*n[0]+i*n[3]+s*n[6],t[1]=r*n[1]+i*n[4]+s*n[7],t[2]=r*n[2]+i*n[5]+s*n[8]}(o,t,s),wt(o,o),bt(t,o),o)))}Zt(t,e,n,r,i,s,o,a){if(t.array.buffer.projected&&t.array.buffer.projected[t.byteOffset])return null;const c=ft([]);Vr(c,e);const u=this.options.projection;i=i&&i.toUpperCase();const f=n;let l=null;"Y"===i?l=Ar:"X"===i&&(l=Tr);let h=[0,0,0,1];const d=[0,0,0],y=[0,0],m=r.projCenter,b=Ln([],r.rtcCoord,"EPSG:3857"),p=s&&ht(Ir,s),g=t.min=t.min||[],w=t.max=t.max||[];pt(g,1/0,1/0,1/0),pt(w,-1/0,-1/0,-1/0);const v=o||{},{decode_position_min:M,decode_position_normConstant:A}=v;let T=[0,0,0,0],_=1;M&&(T=M),A&&(_=A);const k=[];return yn(t,((e,n)=>{if(h[0]=e[0]*_+T[0],h[1]=e[1]*_+T[1],h[2]=e[2]*_+T[2],h=Mt(h,h,c),l&&(h=Mt(h,h,l)),f&&gt(h,h,f),s&&!p&&(h=Mt(h,h,s)),0===_t(h)?pt(d,0,0,-6378137):xe(d,h),a){const t=Dr;Ln(y,d,u),t[3*n]=y[0]-b[0],t[3*n+1]=y[0]-b[1],t[3*n+2]=y[0]-b[2]}if(Ln(y,d,u),e instanceof Float32Array)e[0]=y[0]-m[0],e[1]=y[1]-m[1],e[2]=d[2]-m[2];else{const n=y[0]-m[0],r=y[1]-m[1],i=d[2]-m[2];5126!==t.componentType&&(k.push(n),k.push(r),k.push(i),k.push(e[3]))}return e[0]<g[0]&&(g[0]=e[0]),e[1]<g[1]&&(g[1]=e[1]),e[2]<g[2]&&(g[2]=e[2]),e[0]>w[0]&&(w[0]=e[0]),e[1]>w[1]&&(w[1]=e[1]),e[2]>w[2]&&(w[2]=e[2]),e})),t.array.buffer.projected||(t.array.buffer.projected={}),t.array.buffer.projected[t.byteOffset]=1,{projCenter:m,newPositions:k}}Kt(t){return 0===_t(t)?pt([],0,0,-6378137):xe([],t)}onRemove(){}Vt(){return"EPSG:4326"===this.options.projection||"EPSG:4490"===this.options.projection}qt(t,e){if(!t.attributes.POSITION||function(t,e){const n=e.materials[t.material],r=n&&n.extensions&&n.extensions.KHR_materials_unlit;return r}(t,e))return!1;return!t.attributes.TANGENT}}const Lr=[];function jr(t,e,n,r,i,s){const o=s||{},{decode_position_min:a,decode_position_normConstant:c}=o;let u=[0,0,0,0],f=1;a&&(u=a),c&&(f=c);for(let s=0,o=t.length;s<o;s+=e){const{xmin:o,ymin:a,xmax:c,ymax:l,hmin:h,hmax:d}=i;pt(Lr,t[s]*f+u[0],t[s+1]*f+u[1],t[s+2]*f+u[2]),Mt(Lr,Lr,r);const y=gt(Lr,n,Lr);y[0]<o&&(i.xmin=y[0]),y[0]>c&&(i.xmax=y[0]),y[1]<a&&(i.ymin=y[1]),y[1]>l&&(i.ymax=y[1]),e>2&&(y[2]<h&&(i.hmin=y[2]),y[2]>d&&(i.hmax=y[2]))}}function zr(t){const{xmax:e,ymax:n,xmin:r,ymin:i,hmin:s,hmax:o}=t,a=[(r+e)/2,(i+n)/2,(s+o)/2];return e===-1/0&&(a[0]=0),n===-1/0&&(a[1]=0),o===-1/0&&(a[2]=0),isNaN(a[2])&&(a[2]=0),a}function qr(t,e){for(let n=0;n<e.length;n++)t.indexOf(e[n])<0&&t.push(e[n])}function Vr(t,e){const n=t;for(let t=e.length-1;t>=0;t--)lt(n,e[t],n);return n}function Gr(t,e,n,r,i){if(e&&e>1)for(let n=0;n<t.length;n++)(n+1)%3!=0&&(t[n]*=e);let s,o;if(n&&r&&1===e)s=Math.min(...n),o=Math.max(...r);else{const{min:e,max:n}=function(t){let e=1/0,n=-1/0;for(let r=0;r<t.length;r++)t[r]>n&&(n=t[r]),t[r]<e&&(e=t[r]);return{min:e,max:n}}(t);s=e,o=n}return!function(t,e,n,r){for(let i=0;i<t.length;i++){const s=$r(Xr(t[i],e,n),e,n);if(Math.abs(s-t[i])>Br[r])return!1}return!0}(t,s,o,i)&&Br[i]?null:function(t,e,n){const r=new Int16Array(t.length);for(let i=0;i<t.length;i++)r[i]=Xr(t[i],e,n);return{array:r,range:[e,n]}}(t,s,o)}function $r(t,e,n){return((t>=32768?-(65536-t)/32768:t/32767)+1)*(n-e)/2+e}function Xr(t,e,n){const r=2*(t-e)/(n-e)-1,i=Math.max(-1,Math.min(1,r));return i<0?32768*i:32767*i}function Hr(t){return void 0===t.compressGeometry||t.compressGeometry}let Jr=0;class Kr{constructor(t){this.workerId=t,this.workers={},this.te={}}addLayer({actorId:t,mapId:e,layerId:n,params:r},i){if(this.ee(e,n))return;const s=this.ne(e,n),o=r.options;this.workers[s]=new Rr(n,o,((...e)=>this.send.call(this,t,...e)),i)}removeLayer({mapId:t,layerId:e},n){const r=this.ee(t,e),i=this.ne(t,e);delete this.workers[i],r&&r.onRemove(n)}loadTile({mapId:t,layerId:e,params:n},r){const i=this.ee(t,e);i&&i.loadTile(n,r)}abortTileLoading({mapId:t,layerId:e,params:n},r){const i=this.ee(t,e);i&&i.abortTileLoading(n,r)}receive(t){const e=t.callback,n=this.te[e];delete this.te[e],n&&t.error?n(new Error(t.error)):n&&n(null,t.data)}send(t,e,n,r,i){const s=i?\`${PX}t}-${PX}Jr++}\`:null;i&&(this.te[s]=i),postMessage({type:"<request>",workerId:this.workerId,actorId:t,command:e,params:n,callback:String(s)},r||[])}ne(t,e){return\`${PX}t}-${PX}e}\`}ee(t,e){const n=this.ne(t,e);return this.workers[n]}}t.initialize=function(){},t.onmessage=function(t,e){const n=t.data;this.dispatcher||(this.dispatcher=new Kr(t.workerId)),"<response>"===t.type?this.dispatcher.workerId===t.workerId&&this.dispatcher.receive(t):this.dispatcher[n.command]({actorId:n.actorId,mapId:n.mapId,layerId:n.layerId,params:n.params},((t,n,r)=>{t&&404!==t.status&&204!==t.status&&console.error(t),t instanceof Error&&(t={message:t.message}),e(t,n,r)}))}}`;var TX={exports:{}},SX={exports:{}},IX=function(e){return!(!e||"string"==typeof e)&&(e instanceof Array||Array.isArray(e)||e.length>=0&&(e.splice instanceof Function||Object.getOwnPropertyDescriptor(e,e.length-1)&&"String"!==e.constructor.name))},EX=Array.prototype.concat,OX=Array.prototype.slice,RX=SX.exports=function(e){for(var n=[],i=0,o=e.length;i<o;i++){var s=e[i];IX(s)?n=EX.call(n,OX.call(s)):n.push(s)}return n};RX.wrap=function(e){return function(){return e(RX(arguments))}};var DX={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},kX=SX.exports,LX=Object.hasOwnProperty,FX=Object.create(null);for(var NX in DX)LX.call(DX,NX)&&(FX[DX[NX]]=NX);var zX=TX.exports={to:{},get:{}};function BX(e,n,i){return Math.min(Math.max(n,e),i)}function HX(e){var n=Math.round(e).toString(16).toUpperCase();return n.length<2?"0"+n:n}zX.get=function(e){var n,i;switch(e.substring(0,3).toLowerCase()){case"hsl":n=zX.get.hsl(e),i="hsl";break;case"hwb":n=zX.get.hwb(e),i="hwb";break;default:n=zX.get.rgb(e),i="rgb"}return n?{model:i,value:n}:null},zX.get.rgb=function(e){if(!e)return null;var n,i,o,s=[0,0,0,1];if(n=e.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(o=n[2],n=n[1],i=0;i<3;i++){var a=2*i;s[i]=parseInt(n.slice(a,a+2),16)}o&&(s[3]=parseInt(o,16)/255)}else if(n=e.match(/^#([a-f0-9]{3,4})$/i)){for(o=(n=n[1])[3],i=0;i<3;i++)s[i]=parseInt(n[i]+n[i],16);o&&(s[3]=parseInt(o+o,16)/255)}else if(n=e.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(i=0;i<3;i++)s[i]=parseInt(n[i+1],0);n[4]&&(s[3]=n[5]?.01*parseFloat(n[4]):parseFloat(n[4]))}else{if(!(n=e.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(n=e.match(/^(\w+)$/))?"transparent"===n[1]?[0,0,0,0]:LX.call(DX,n[1])?((s=DX[n[1]])[3]=1,s):null:null;for(i=0;i<3;i++)s[i]=Math.round(2.55*parseFloat(n[i+1]));n[4]&&(s[3]=n[5]?.01*parseFloat(n[4]):parseFloat(n[4]))}for(i=0;i<3;i++)s[i]=BX(s[i],0,255);return s[3]=BX(s[3],0,1),s},zX.get.hsl=function(e){if(!e)return null;var n=e.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(n){var i=parseFloat(n[4]);return[(parseFloat(n[1])%360+360)%360,BX(parseFloat(n[2]),0,100),BX(parseFloat(n[3]),0,100),BX(isNaN(i)?1:i,0,1)]}return null},zX.get.hwb=function(e){if(!e)return null;var n=e.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(n){var i=parseFloat(n[4]);return[(parseFloat(n[1])%360+360)%360,BX(parseFloat(n[2]),0,100),BX(parseFloat(n[3]),0,100),BX(isNaN(i)?1:i,0,1)]}return null},zX.to.hex=function(){var e=kX(arguments);return"#"+HX(e[0])+HX(e[1])+HX(e[2])+(e[3]<1?HX(Math.round(255*e[3])):"")},zX.to.rgb=function(){var e=kX(arguments);return e.length<4||1===e[3]?"rgb("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+")":"rgba("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+", "+e[3]+")"},zX.to.rgb.percent=function(){var e=kX(arguments),n=Math.round(e[0]/255*100),i=Math.round(e[1]/255*100),o=Math.round(e[2]/255*100);return e.length<4||1===e[3]?"rgb("+n+"%, "+i+"%, "+o+"%)":"rgba("+n+"%, "+i+"%, "+o+"%, "+e[3]+")"},zX.to.hsl=function(){var e=kX(arguments);return e.length<4||1===e[3]?"hsl("+e[0]+", "+e[1]+"%, "+e[2]+"%)":"hsla("+e[0]+", "+e[1]+"%, "+e[2]+"%, "+e[3]+")"},zX.to.hwb=function(){var e=kX(arguments),n="";return e.length>=4&&1!==e[3]&&(n=", "+e[3]),"hwb("+e[0]+", "+e[1]+"%, "+e[2]+"%"+n+")"},zX.to.keyword=function(e){return FX[e.slice(0,3)]};var jX=TX.exports,UX={exports:{}},GX={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},VX={};for(var WX in GX)GX.hasOwnProperty(WX)&&(VX[GX[WX]]=WX);var qX=UX.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var ZX in qX)if(qX.hasOwnProperty(ZX)){if(!("channels"in qX[ZX]))throw new Error("missing channels property: "+ZX);if(!("labels"in qX[ZX]))throw new Error("missing channel labels property: "+ZX);if(qX[ZX].labels.length!==qX[ZX].channels)throw new Error("channel and label counts mismatch: "+ZX);var QX=qX[ZX].channels,XX=qX[ZX].labels;delete qX[ZX].channels,delete qX[ZX].labels,Object.defineProperty(qX[ZX],"channels",{value:QX}),Object.defineProperty(qX[ZX],"labels",{value:XX})}qX.rgb.hsl=function(e){var n,i,o=e[0]/255,s=e[1]/255,a=e[2]/255,h=Math.min(o,s,a),l=Math.max(o,s,a),c=l-h;return l===h?n=0:o===l?n=(s-a)/c:s===l?n=2+(a-o)/c:a===l&&(n=4+(o-s)/c),(n=Math.min(60*n,360))<0&&(n+=360),i=(h+l)/2,[n,100*(l===h?0:i<=.5?c/(l+h):c/(2-l-h)),100*i]},qX.rgb.hsv=function(e){var n,i,o,s,a,h=e[0]/255,l=e[1]/255,c=e[2]/255,A=Math.max(h,l,c),f=A-Math.min(h,l,c),d=function(e){return(A-e)/6/f+.5};return 0===f?s=a=0:(a=f/A,n=d(h),i=d(l),o=d(c),h===A?s=o-i:l===A?s=1/3+n-o:c===A&&(s=2/3+i-n),s<0?s+=1:s>1&&(s-=1)),[360*s,100*a,100*A]},qX.rgb.hwb=function(e){var n=e[0],i=e[1],o=e[2];return[qX.rgb.hsl(e)[0],1/255*Math.min(n,Math.min(i,o))*100,100*(o=1-1/255*Math.max(n,Math.max(i,o)))]},qX.rgb.cmyk=function(e){var n,i=e[0]/255,o=e[1]/255,s=e[2]/255;return[100*((1-i-(n=Math.min(1-i,1-o,1-s)))/(1-n)||0),100*((1-o-n)/(1-n)||0),100*((1-s-n)/(1-n)||0),100*n]},qX.rgb.keyword=function(e){var n=VX[e];if(n)return n;var i,o,s,a=1/0;for(var h in GX)if(GX.hasOwnProperty(h)){var l=(o=e,s=GX[h],Math.pow(o[0]-s[0],2)+Math.pow(o[1]-s[1],2)+Math.pow(o[2]-s[2],2));l<a&&(a=l,i=h)}return i},qX.keyword.rgb=function(e){return GX[e]},qX.rgb.xyz=function(e){var n=e[0]/255,i=e[1]/255,o=e[2]/255;return[100*(.4124*(n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92)+.3576*(i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92)+.1805*(o=o>.04045?Math.pow((o+.055)/1.055,2.4):o/12.92)),100*(.2126*n+.7152*i+.0722*o),100*(.0193*n+.1192*i+.9505*o)]},qX.rgb.lab=function(e){var n=qX.rgb.xyz(e),i=n[0],o=n[1],s=n[2];return o/=100,s/=108.883,i=(i/=95.047)>.008856?Math.pow(i,1/3):7.787*i+16/116,[116*(o=o>.008856?Math.pow(o,1/3):7.787*o+16/116)-16,500*(i-o),200*(o-(s=s>.008856?Math.pow(s,1/3):7.787*s+16/116))]},qX.hsl.rgb=function(e){var n,i,o,s,a,h=e[0]/360,l=e[1]/100,c=e[2]/100;if(0===l)return[a=255*c,a,a];n=2*c-(i=c<.5?c*(1+l):c+l-c*l),s=[0,0,0];for(var A=0;A<3;A++)(o=h+1/3*-(A-1))<0&&o++,o>1&&o--,s[A]=255*(a=6*o<1?n+6*(i-n)*o:2*o<1?i:3*o<2?n+(i-n)*(2/3-o)*6:n);return s},qX.hsl.hsv=function(e){var n=e[0],i=e[1]/100,o=e[2]/100,s=i,a=Math.max(o,.01);return i*=(o*=2)<=1?o:2-o,s*=a<=1?a:2-a,[n,100*(0===o?2*s/(a+s):2*i/(o+i)),(o+i)/2*100]},qX.hsv.rgb=function(e){var n=e[0]/60,i=e[1]/100,o=e[2]/100,s=Math.floor(n)%6,a=n-Math.floor(n),h=255*o*(1-i),l=255*o*(1-i*a),c=255*o*(1-i*(1-a));switch(o*=255,s){case 0:return[o,c,h];case 1:return[l,o,h];case 2:return[h,o,c];case 3:return[h,l,o];case 4:return[c,h,o];case 5:return[o,h,l]}},qX.hsv.hsl=function(e){var n,i,o,s=e[0],a=e[1]/100,h=e[2]/100,l=Math.max(h,.01);return o=(2-a)*h,i=a*l,[s,100*(i=(i/=(n=(2-a)*l)<=1?n:2-n)||0),100*(o/=2)]},qX.hwb.rgb=function(e){var n,i,o,s,a,h,l,c=e[0]/360,A=e[1]/100,f=e[2]/100,d=A+f;switch(d>1&&(A/=d,f/=d),o=6*c-(n=Math.floor(6*c)),1&n&&(o=1-o),s=A+o*((i=1-f)-A),n){default:case 6:case 0:a=i,h=s,l=A;break;case 1:a=s,h=i,l=A;break;case 2:a=A,h=i,l=s;break;case 3:a=A,h=s,l=i;break;case 4:a=s,h=A,l=i;break;case 5:a=i,h=A,l=s}return[255*a,255*h,255*l]},qX.cmyk.rgb=function(e){var n=e[1]/100,i=e[2]/100,o=e[3]/100;return[255*(1-Math.min(1,e[0]/100*(1-o)+o)),255*(1-Math.min(1,n*(1-o)+o)),255*(1-Math.min(1,i*(1-o)+o))]},qX.xyz.rgb=function(e){var n,i,o,s=e[0]/100,a=e[1]/100,h=e[2]/100;return i=-.9689*s+1.8758*a+.0415*h,o=.0557*s+-.204*a+1.057*h,n=(n=3.2406*s+-1.5372*a+-.4986*h)>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,i=i>.0031308?1.055*Math.pow(i,1/2.4)-.055:12.92*i,o=o>.0031308?1.055*Math.pow(o,1/2.4)-.055:12.92*o,[255*(n=Math.min(Math.max(0,n),1)),255*(i=Math.min(Math.max(0,i),1)),255*(o=Math.min(Math.max(0,o),1))]},qX.xyz.lab=function(e){var n=e[0],i=e[1],o=e[2];return i/=100,o/=108.883,n=(n/=95.047)>.008856?Math.pow(n,1/3):7.787*n+16/116,[116*(i=i>.008856?Math.pow(i,1/3):7.787*i+16/116)-16,500*(n-i),200*(i-(o=o>.008856?Math.pow(o,1/3):7.787*o+16/116))]},qX.lab.xyz=function(e){var n,i,o;n=e[1]/500+(i=(e[0]+16)/116),o=i-e[2]/200;var s=Math.pow(i,3),a=Math.pow(n,3),h=Math.pow(o,3);return i=s>.008856?s:(i-16/116)/7.787,n=a>.008856?a:(n-16/116)/7.787,o=h>.008856?h:(o-16/116)/7.787,[n*=95.047,i*=100,o*=108.883]},qX.lab.lch=function(e){var n,i=e[0],o=e[1],s=e[2];return(n=360*Math.atan2(s,o)/2/Math.PI)<0&&(n+=360),[i,Math.sqrt(o*o+s*s),n]},qX.lch.lab=function(e){var n,i=e[1];return n=e[2]/360*2*Math.PI,[e[0],i*Math.cos(n),i*Math.sin(n)]},qX.rgb.ansi16=function(e){var n=e[0],i=e[1],o=e[2],s=1 in arguments?arguments[1]:qX.rgb.hsv(e)[2];if(0===(s=Math.round(s/50)))return 30;var a=30+(Math.round(o/255)<<2|Math.round(i/255)<<1|Math.round(n/255));return 2===s&&(a+=60),a},qX.hsv.ansi16=function(e){return qX.rgb.ansi16(qX.hsv.rgb(e),e[2])},qX.rgb.ansi256=function(e){var n=e[0],i=e[1],o=e[2];return n===i&&i===o?n<8?16:n>248?231:Math.round((n-8)/247*24)+232:16+36*Math.round(n/255*5)+6*Math.round(i/255*5)+Math.round(o/255*5)},qX.ansi16.rgb=function(e){var n=e%10;if(0===n||7===n)return e>50&&(n+=3.5),[n=n/10.5*255,n,n];var i=.5*(1+~~(e>50));return[(1&n)*i*255,(n>>1&1)*i*255,(n>>2&1)*i*255]},qX.ansi256.rgb=function(e){if(e>=232){var n=10*(e-232)+8;return[n,n,n]}var i;return e-=16,[Math.floor(e/36)/5*255,Math.floor((i=e%36)/6)/5*255,i%6/5*255]},qX.rgb.hex=function(e){var n=(((255&Math.round(e[0]))<<16)+((255&Math.round(e[1]))<<8)+(255&Math.round(e[2]))).toString(16).toUpperCase();return"000000".substring(n.length)+n},qX.hex.rgb=function(e){var n=e.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!n)return[0,0,0];var i=n[0];3===n[0].length&&(i=i.split("").map((function(e){return e+e})).join(""));var o=parseInt(i,16);return[o>>16&255,o>>8&255,255&o]},qX.rgb.hcg=function(e){var n,i=e[0]/255,o=e[1]/255,s=e[2]/255,a=Math.max(Math.max(i,o),s),h=Math.min(Math.min(i,o),s),l=a-h;return n=l<=0?0:a===i?(o-s)/l%6:a===o?2+(s-i)/l:4+(i-o)/l+4,n/=6,[360*(n%=1),100*l,100*(l<1?h/(1-l):0)]},qX.hsl.hcg=function(e){var n,i=e[1]/100,o=e[2]/100,s=0;return(n=o<.5?2*i*o:2*i*(1-o))<1&&(s=(o-.5*n)/(1-n)),[e[0],100*n,100*s]},qX.hsv.hcg=function(e){var n=e[2]/100,i=e[1]/100*n,o=0;return i<1&&(o=(n-i)/(1-i)),[e[0],100*i,100*o]},qX.hcg.rgb=function(e){var n=e[1]/100,i=e[2]/100;if(0===n)return[255*i,255*i,255*i];var o,s=[0,0,0],a=e[0]/360%1*6,h=a%1,l=1-h;switch(Math.floor(a)){case 0:s[0]=1,s[1]=h,s[2]=0;break;case 1:s[0]=l,s[1]=1,s[2]=0;break;case 2:s[0]=0,s[1]=1,s[2]=h;break;case 3:s[0]=0,s[1]=l,s[2]=1;break;case 4:s[0]=h,s[1]=0,s[2]=1;break;default:s[0]=1,s[1]=0,s[2]=l}return[255*(n*s[0]+(o=(1-n)*i)),255*(n*s[1]+o),255*(n*s[2]+o)]},qX.hcg.hsv=function(e){var n=e[1]/100,i=n+e[2]/100*(1-n),o=0;return i>0&&(o=n/i),[e[0],100*o,100*i]},qX.hcg.hsl=function(e){var n=e[1]/100,i=e[2]/100*(1-n)+.5*n,o=0;return i>0&&i<.5?o=n/(2*i):i>=.5&&i<1&&(o=n/(2*(1-i))),[e[0],100*o,100*i]},qX.hcg.hwb=function(e){var n=e[1]/100,i=n+e[2]/100*(1-n);return[e[0],100*(i-n),100*(1-i)]},qX.hwb.hcg=function(e){var n=1-e[2]/100,i=n-e[1]/100,o=0;return i<1&&(o=(n-i)/(1-i)),[e[0],100*i,100*o]},qX.apple.rgb=function(e){return[e[0]/65535*255,e[1]/65535*255,e[2]/65535*255]},qX.rgb.apple=function(e){return[e[0]/255*65535,e[1]/255*65535,e[2]/255*65535]},qX.gray.rgb=function(e){return[e[0]/100*255,e[0]/100*255,e[0]/100*255]},qX.gray.hsl=qX.gray.hsv=function(e){return[0,0,e[0]]},qX.gray.hwb=function(e){return[0,100,e[0]]},qX.gray.cmyk=function(e){return[0,0,0,e[0]]},qX.gray.lab=function(e){return[e[0],0,0]},qX.gray.hex=function(e){var n=255&Math.round(e[0]/100*255),i=((n<<16)+(n<<8)+n).toString(16).toUpperCase();return"000000".substring(i.length)+i},qX.rgb.gray=function(e){return[(e[0]+e[1]+e[2])/3/255*100]};var YX=UX.exports,JX=YX;function KX(e,n){return function(i){return n(e(i))}}function $X(e,n){for(var i=[n[e].parent,e],o=JX[n[e].parent][e],s=n[e].parent;n[s].parent;)i.unshift(n[s].parent),o=KX(JX[n[s].parent][s],o),s=n[s].parent;return o.conversion=i,o}var tY=YX,eY=function(e){for(var n=function(e){var n=function(){for(var e={},n=Object.keys(JX),i=n.length,o=0;o<i;o++)e[n[o]]={distance:-1,parent:null};return e}(),i=[e];for(n[e].distance=0;i.length;)for(var o=i.pop(),s=Object.keys(JX[o]),a=s.length,h=0;h<a;h++){var l=s[h],c=n[l];-1===c.distance&&(c.distance=n[o].distance+1,c.parent=o,i.unshift(l))}return n}(e),i={},o=Object.keys(n),s=o.length,a=0;a<s;a++){var h=o[a];null!==n[h].parent&&(i[h]=$X(h,n))}return i},nY={};Object.keys(tY).forEach((function(e){nY[e]={},Object.defineProperty(nY[e],"channels",{value:tY[e].channels}),Object.defineProperty(nY[e],"labels",{value:tY[e].labels});var n=eY(e);Object.keys(n).forEach((function(i){var o=n[i];nY[e][i]=function(e){var n=function(n){if(null==n)return n;arguments.length>1&&(n=Array.prototype.slice.call(arguments));var i=e(n);if("object"==typeof i)for(var o=i.length,s=0;s<o;s++)i[s]=Math.round(i[s]);return i};return"conversion"in e&&(n.conversion=e.conversion),n}(o),nY[e][i].raw=function(e){var n=function(n){return null==n?n:(arguments.length>1&&(n=Array.prototype.slice.call(arguments)),e(n))};return"conversion"in e&&(n.conversion=e.conversion),n}(o)}))}));var iY=jX,rY=nY,oY=[].slice,sY=["keyword","gray","hex"],aY={};Object.keys(rY).forEach((function(e){aY[oY.call(rY[e].labels).sort().join("")]=e}));var hY={};function lY(e,n){if(!(this instanceof lY))return new lY(e,n);if(n&&n in sY&&(n=null),n&&!(n in rY))throw new Error("Unknown model: "+n);var i,o;if(null==e)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(e instanceof lY)this.model=e.model,this.color=e.color.slice(),this.valpha=e.valpha;else if("string"==typeof e){var s=iY.get(e);if(null===s)throw new Error("Unable to parse color from string: "+e);this.model=s.model,this.color=s.value.slice(0,o=rY[this.model].channels),this.valpha="number"==typeof s.value[o]?s.value[o]:1}else if(e.length){this.model=n||"rgb";var a=oY.call(e,0,o=rY[this.model].channels);this.color=AY(a,o),this.valpha="number"==typeof e[o]?e[o]:1}else if("number"==typeof e)e&=16777215,this.model="rgb",this.color=[e>>16&255,e>>8&255,255&e],this.valpha=1;else{this.valpha=1;var h=Object.keys(e);"alpha"in e&&(h.splice(h.indexOf("alpha"),1),this.valpha="number"==typeof e.alpha?e.alpha:0);var l=h.sort().join("");if(!(l in aY))throw new Error("Unable to parse color from object: "+JSON.stringify(e));this.model=aY[l];var c=rY[this.model].labels,A=[];for(i=0;i<c.length;i++)A.push(e[c[i]]);this.color=AY(A)}if(hY[this.model])for(o=rY[this.model].channels,i=0;i<o;i++){var f=hY[this.model][i];f&&(this.color[i]=f(this.color[i]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}function uY(e,n,i){return(e=Array.isArray(e)?e:[e]).forEach((function(e){(hY[e]||(hY[e]=[]))[n]=i})),e=e[0],function(o){var s;return arguments.length?(i&&(o=i(o)),(s=this[e]()).color[n]=o,s):(s=this[e]().color[n],i&&(s=i(s)),s)}}function cY(e){return function(n){return Math.max(0,Math.min(e,n))}}function AY(e,n){for(var i=0;i<n;i++)"number"!=typeof e[i]&&(e[i]=0);return e}lY.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(e){var n=this.model in iY.to?this:this.rgb(),i=1===(n=n.round("number"==typeof e?e:1)).valpha?n.color:n.color.concat(this.valpha);return iY.to[n.model](i)},percentString:function(e){var n=this.rgb().round("number"==typeof e?e:1),i=1===n.valpha?n.color:n.color.concat(this.valpha);return iY.to.rgb.percent(i)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var e={},n=rY[this.model].channels,i=rY[this.model].labels,o=0;o<n;o++)e[i[o]]=this.color[o];return 1!==this.valpha&&(e.alpha=this.valpha),e},unitArray:function(){var e=this.rgb().color;return e[0]/=255,e[1]/=255,e[2]/=255,1!==this.valpha&&e.push(this.valpha),e},unitObject:function(){var e=this.rgb().object();return e.r/=255,e.g/=255,e.b/=255,1!==this.valpha&&(e.alpha=this.valpha),e},round:function(e){return e=Math.max(e||0,0),new lY(this.color.map(function(e){return function(n){return function(e,n){return Number(e.toFixed(n))}(n,e)}}(e)).concat(this.valpha),this.model)},alpha:function(e){return arguments.length?new lY(this.color.concat(Math.max(0,Math.min(1,e))),this.model):this.valpha},red:uY("rgb",0,cY(255)),green:uY("rgb",1,cY(255)),blue:uY("rgb",2,cY(255)),hue:uY(["hsl","hsv","hsl","hwb","hcg"],0,(function(e){return(e%360+360)%360})),saturationl:uY("hsl",1,cY(100)),lightness:uY("hsl",2,cY(100)),saturationv:uY("hsv",1,cY(100)),value:uY("hsv",2,cY(100)),chroma:uY("hcg",1,cY(100)),gray:uY("hcg",2,cY(100)),white:uY("hwb",1,cY(100)),wblack:uY("hwb",2,cY(100)),cyan:uY("cmyk",0,cY(100)),magenta:uY("cmyk",1,cY(100)),yellow:uY("cmyk",2,cY(100)),black:uY("cmyk",3,cY(100)),x:uY("xyz",0,cY(100)),y:uY("xyz",1,cY(100)),z:uY("xyz",2,cY(100)),l:uY("lab",0,cY(100)),a:uY("lab",1),b:uY("lab",2),keyword:function(e){return arguments.length?new lY(e):rY[this.model].keyword(this.color)},hex:function(e){return arguments.length?new lY(e):iY.to.hex(this.rgb().round().color)},rgbNumber:function(){var e=this.rgb().color;return(255&e[0])<<16|(255&e[1])<<8|255&e[2]},luminosity:function(){for(var e=this.rgb().color,n=[],i=0;i<e.length;i++){var o=e[i]/255;n[i]=o<=.03928?o/12.92:Math.pow((o+.055)/1.055,2.4)}return.2126*n[0]+.7152*n[1]+.0722*n[2]},contrast:function(e){var n=this.luminosity(),i=e.luminosity();return n>i?(n+.05)/(i+.05):(i+.05)/(n+.05)},level:function(e){var n=this.contrast(e);return n>=7.1?"AAA":n>=4.5?"AA":""},isDark:function(){var e=this.rgb().color;return(299*e[0]+587*e[1]+114*e[2])/1e3<128},isLight:function(){return!this.isDark()},negate:function(){for(var e=this.rgb(),n=0;n<3;n++)e.color[n]=255-e.color[n];return e},lighten:function(e){var n=this.hsl();return n.color[2]+=n.color[2]*e,n},darken:function(e){var n=this.hsl();return n.color[2]-=n.color[2]*e,n},saturate:function(e){var n=this.hsl();return n.color[1]+=n.color[1]*e,n},desaturate:function(e){var n=this.hsl();return n.color[1]-=n.color[1]*e,n},whiten:function(e){var n=this.hwb();return n.color[1]+=n.color[1]*e,n},blacken:function(e){var n=this.hwb();return n.color[2]+=n.color[2]*e,n},grayscale:function(){var e=this.rgb().color,n=.3*e[0]+.59*e[1]+.11*e[2];return lY.rgb(n,n,n)},fade:function(e){return this.alpha(this.valpha-this.valpha*e)},opaquer:function(e){return this.alpha(this.valpha+this.valpha*e)},rotate:function(e){var n=this.hsl(),i=n.color[0];return i=(i=(i+e)%360)<0?360+i:i,n.color[0]=i,n},mix:function(e,n){if(!e||!e.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof e);var i=e.rgb(),o=this.rgb(),s=void 0===n?.5:n,a=2*s-1,h=i.alpha()-o.alpha(),l=((a*h==-1?a:(a+h)/(1+a*h))+1)/2,c=1-l;return lY.rgb(l*i.red()+c*o.red(),l*i.green()+c*o.green(),l*i.blue()+c*o.blue(),i.alpha()*s+o.alpha()*(1-s))}},Object.keys(rY).forEach((function(e){if(-1===sY.indexOf(e)){var n=rY[e].channels;lY.prototype[e]=function(){if(this.model===e)return new lY(this);if(arguments.length)return new lY(arguments,e);var i,o="number"==typeof arguments[n]?n:this.valpha;return new lY((i=rY[this.model][e].raw(this.color),Array.isArray(i)?i:[i]).concat(o),e)},lY[e]=function(i){return"number"==typeof i&&(i=AY(oY.call(arguments),n)),new lY(i,e)}}}));var fY=function(e){return e&&e.t&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}(lY);function dY(e){return null==e}function pY(e){for(let n=1;n<arguments.length;n++){const i=arguments[n];for(const n in i)e[n]=i[n]}return e}function gY(e){return null!=e&&("function"==typeof e||null!==e.constructor&&e.constructor===Function)}function mY(e){return"object"==typeof e&&!!e}function yY(e){return"number"==typeof e&&!isNaN(e)}function vY(e){return e*Math.PI/180}function _Y(e){return e/Math.PI*180}function xY(e){let n=document.createElement("a");return n.href=e,e=n.href,n=null,e}function bY(e){return Math.sign?Math.sign(e):0==(e=+e)||isNaN(e)?Number(e):e>0?1:-1}const wY=[1,1,1,1,2,2,3,0];function CY(e){const n=e.length;let i="";for(let o=0;o<n;){let s=e[o++];if(128&s){let i=wY[s>>3&7];if(!(64&s)||!i||o+i>n)return null;for(s&=63>>i;i>0;i-=1){const n=e[o++];if(128!=(192&n))return null;s=s<<6|63&n}}i+=String.fromCharCode(s)}return i}function PY(e,n,i){return e[3*i]=n[0],e[3*i+1]=n[1],e[3*i+2]=n[2],e}function MY(e){return e.flat?e.flat(1/0):e.reduce(((e,n)=>e.concat(n)),[])}function TY(e){return e<256?Uint8Array:e<65536?Uint16Array:Uint32Array}function SY(e){return 0===e.indexOf("data:")}function IY(e){const n=e.indexOf("base64,"),i=e.substring(n+7),o=window.atob(i),s=o.length,a=new Uint8Array(s);for(let e=0;e<s;e++)a[e]=o.charCodeAt(e);return a.buffer}function EY(e){for(let n=1;n<arguments.length;n++){const i=arguments[n];if(i)for(let n=0,o=i.length;n<o;n++)e.push(i[n])}return e.length}const OY={};function RY(e,n){if(!Array.isArray(n)){n=OY[n]=OY[n]||fY(n).array().map((e=>e/255))}for(let i=0;i<n.length;i++)e[i]=n[i];return 3===n.length&&(e[3]=1),e}var DY=Object.freeze({__proto__:null,base64URLToArrayBuffer:IY,extend:pY,flatArr:MY,getAbsoluteURL:xY,getBatchIdArrayType:TY,isBase64:SY,isFunction:gY,isNil:dY,isNumber:yY,isObject:mY,normalizeColor:RY,pushIn:EY,setColumn3:PY,sign:bY,stringFromUTF8Array:CY,toDegree:_Y,toRadian:vY});function kY(e){return-1===e.indexOf("http://")&&-1===e.indexOf("https://")&&-1===e.indexOf("file://")}function LY(e){return(e=e||{}).referrerPolicy=e.referrerPolicy||"origin",e.referrer=window&&window.location.href,e}const FY="undefined"==typeof document?null:document.createElement("canvas");let NY=class Ft extends Nm.Actor{constructor(e,n,i){super(e),this.mapId=n,this.i=i}initialize(e){e(null)}loadTile(e,n,i){let o=null;n&&n.arraybuffer&&(o=[n.arraybuffer]);this.send({mapId:this.mapId,layerId:e,command:"loadTile",params:n},o,i)}abortTileLoading(e,n,i){this.broadcast({mapId:this.mapId,layerId:e,command:"abortTileLoading",params:{url:n}},null,i)}addLayer(e,n,i){this.broadcast({actorId:this.actorId,mapId:this.mapId,layerId:e,command:"addLayer",params:{options:n}},null,i)}removeLayer(e,n){this.broadcast({mapId:this.mapId,layerId:e,command:"removeLayer"},null,n)}requestImage({url:e},n){const i=new Image;i.onload=()=>{if(!this.isActive())return;if(!FY)return void n(new Error("There is no canvas to draw image!"));const e=this.i?i:function(e){if(zY(e.width)&&zY(e.height))return e;let n=e.width,i=e.height;zY(n)||(n=BY(n)),zY(i)||(i=BY(i));const o=document.createElement("canvas");o.width=n,o.height=i,o.getContext("2d").drawImage(e,0,0,n,i);const s=e.src,a=s.lastIndexOf("/")+1,h=s.substring(a);return console.warn(`Texture(${h})'s size is not power of two, resize from (${e.width}, ${e.height}) to (${n}, ${i})`),o}(i);FY.width=e.width,FY.height=e.height;const o=FY.getContext("2d",{willReadFrequently:!0});o.drawImage(e,0,0,e.width,e.height);const s=o.getImageData(0,0,e.width,e.height),a={width:e.width,height:e.height,data:new Uint8Array(s.data)};n(null,a,[a.data.buffer])},i.onerror=function(e){n(e)},i.src=e}};function zY(e){return!(e&e-1)&&0!==e}function BY(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function HY(e,n){if(e.scenes&&e.scenes.length)for(let i=0,o=e.scenes.length;i<o;i++){const o=e.scenes[i].nodes;for(let i=0,s=o.length;i<s;i++){ZY(o[i],[],e,n)}}}const jY=[],UY=[],GY=[],VY=[0,0,0],WY=nx([]),qY=[1,1,1];function ZY(e,n,i,o){const s=n.slice(0);if(e.matrix)s.push(e.matrix);else if(e.rotation||e.translation||e.scale){const n=Ov(jY,e.translation||VY),i=Bv(UY,e.rotation||WY),o=Rv(GY,e.scale||qY);Cv(o,i,o);const a=Cv([],n,o);s.push(a)}if(e.children&&e.children.length)for(let n=0,a=e.children.length;n<a;n++)ZY(e.children[n],s,i,o);if(void 0!==e.mesh){const n=e.mesh,a=i.meshes[n];if(a){const e=s.slice(0),h=a.primitives;for(let s=0,a=h.length;s<a;s++){const a=h[s];a&&(a.matrices=e,o(a,n,s,i))}}}}function QY(e,n,i){let{byteOffset:o,byteStride:s}=n;const{componentType:a,itemSize:h}=n,l=n.array.buffer,c=a?zy.getTypedArrayCtor(a):n.array.constructor;if(o=void 0===o?n.array.byteOffset:o,s=s||0,!s||s===h*c.BYTES_PER_ELEMENT&&o%c.BYTES_PER_ELEMENT==0){const n=new c(l,o+i*h*c.BYTES_PER_ELEMENT,h);return e.set(n),e}s||(s=h*c.BYTES_PER_ELEMENT);const A=new Uint8Array(l,s*i+o,h*c.BYTES_PER_ELEMENT);return new Uint8Array(e.buffer).set(A),e}function XY(e,n,i,o){e[4*n]=i[o],e[4*n+1]=i[o+4],e[4*n+2]=i[o+8],e[4*n+3]=i[o+12]}var YY="#include <gl2_vert>\n\nconst float SHIFT_RIGHT_11 = 1.0 / 2048.0;\n\nconst float SHIFT_RIGHT_5 = 1.0 / 32.0;\n\nconst float SHIFT_LEFT_11 = 2048.0;\n\nconst float SHIFT_LEFT_5 = 32.0;\n\nconst float NORMALIZE_6 = 1.0 / 64.0;\n\nconst float NORMALIZE_5 = 1.0 / 32.0;\n\n\n\n#ifdef HAS_POSITION\n\n    attribute vec3 POSITION;\n\n#endif\n\n\n\n#if defined(HAS_RGB)\n\n    attribute vec3 RGB;\n\n#elif defined(HAS_RGBA)\n\n    attribute vec4 RGBA;\n\n#elif defined(HAS_RGB565)\n\n    attribute float RGB565;\n\n#endif\n\n\n\nuniform vec4 pointColor;\n\nuniform float pointSize;\n\n\n\nuniform mat4 projViewModelMatrix;\n\nuniform float pointOpacity;\n\n\n\nvarying vec4 vColor;\n\n\n\n#ifdef HAS_NORMAL\n\n    #ifdef HAS_NORMAL_OCT16P\n\n        attribute vec2 NORMAL_OCT16P;\n\n        float signNotZero(float value) {\n\n            return value >= 0.0 ? 1.0 : -1.0;\n\n        }\n\n        vec2 signNotZero(vec2 value) {\n\n            return vec2(signNotZero(value.x), signNotZero(value.y));\n\n        }\n\n        vec3 octDecode(vec2 encoded, float range) {\n\n            if (encoded.x == 0.0 && encoded.y == 0.0) {\n\n                return vec3(0.0, 0.0, 0.0);\n\n            }\n\n            encoded = encoded / range * 2.0 - 1.0;\n\n            vec3 v = vec3(encoded.x, encoded.y, 1.0 - abs(encoded.x) - abs(encoded.y));\n\n            if (v.z < 0.0) {\n\n                v.xy = (1.0 - abs(v.yx)) * signNotZero(v.xy);\n\n            }\n\n            return normalize(v);\n\n        }\n\n        vec3 octDecode(vec2 encoded) {\n\n            return octDecode(encoded, 255.0);\n\n        }\n\n    #else\n\n        attribute vec3 NORMAL;\n\n    #endif\n\n    uniform vec3 lightDir;\n\n    uniform mat3 modelNormalMatrix;\n\n    uniform mat4 positionMatrix;\n\n    float getLambertDiffuse(vec3 lightDir, vec3 normal) {\n\n        return max(dot(-lightDir, normal), 0.0);\n\n    }\n\n#endif\n\n#ifdef PICKING_MODE\n\n    #include <fbo_picking_vert>\n\n#endif\n\n#include <draco_decode_vert>\n\nvoid main() {\n\n    #ifdef HAS_POSITION\n\n        vec3 localPos = decode_getPosition(POSITION);\n\n    #endif\n\n    gl_Position = projViewModelMatrix * vec4(localPos, 1.0);\n\n    gl_PointSize = pointSize;\n\n\n\n    #ifdef PICKING_MODE\n\n        fbo_picking_setData(gl_Position.w, true);\n\n    #else\n\n        #if defined(HAS_RGB)\n\n            vColor = vec4(RGB / 255.0, 1.0) * pointOpacity;\n\n        #elif defined(HAS_RGBA)\n\n            vColor = RGBA / 255.0 * pointOpacity;\n\n        #elif defined(HAS_RGB565)\n\n            float compressed = RGB565;\n\n            float r = floor(compressed * SHIFT_RIGHT_11);\n\n            compressed -= r * SHIFT_LEFT_11;\n\n            float g = floor(compressed * SHIFT_RIGHT_5);\n\n            compressed -= g * SHIFT_LEFT_5;\n\n            float b = compressed;\n\n            vec3 rgb = vec3(r * NORMALIZE_5, g * NORMALIZE_6, b * NORMALIZE_5);\n\n            vColor = vec4(rgb, 1.0);\n\n        #else\n\n            vColor = pointColor;\n\n        #endif\n\n\n\n        #ifdef HAS_NORMAL\n\n            mat3 positionNormalMatrix = mat3(positionMatrix);\n\n            mat3 normalMatrix = modelNormalMatrix * positionNormalMatrix;\n\n            #ifdef HAS_NORMAL_OCT16P\n\n                vec3 localNormal = octDecode(NORMAL_OCT16P);\n\n            #else\n\n                vec3 localNormal = NORMAL;\n\n            #endif\n\n            vec3 normal = normalize(normalMatrix * localNormal);\n\n            float colorStrength = getLambertDiffuse(lightDir, normal);\n\n            colorStrength = max(colorStrength, 0.5);\n\n            vColor *= colorStrength;\n\n        #endif\n\n    #endif\n\n\n\n\n\n\n\n\n\n}\n\n";const JY=new Array(3),KY=new Array(3),$Y=[40680631590769,40680631590769,40408299984661.445];function tJ(e,n,i,o){const s=$Y,a=Math.cos(i);JY[0]=a*Math.cos(n),JY[1]=a*Math.sin(n),JY[2]=Math.sin(i),cJ(JY,JY),n_(KY,s,JY);const h=Math.sqrt(u_(JY,KY));var l,c,A;return(l=KY)[0]=(c=KY)[0]/(A=h),l[1]=c[1]/A,l[2]=c[2]/A,r_(JY,JY,o),t_(e,KY,JY)}const eJ=[1/6378137,1/6378137,1/6356752.314245179],nJ=[1/40680631590769,1/40680631590769,1/40408299984661.445],iJ=new Array(3),rJ=new Array(3),oJ=new Array(3);function sJ(e,n){const i=nJ,o=function(e,n,i,o,s){const a=n[0],h=n[1],l=n[2],c=i[0],A=i[1],f=i[2],d=a*a*c*c,p=h*h*A*A,g=l*l*f*f,v=d+p+g,w=Math.sqrt(1/v),C=r_(aJ,n,w);if(v<.1)return isFinite(w)?C:void 0;const P=o[0],T=o[1],S=o[2],I=hJ;I[0]=C[0]*P*2,I[1]=C[1]*T*2,I[2]=C[2]*S*2;let E,O,k,L,F,N,z,H,j,W,q,Y=(1-w)*uJ(n)/(.5*uJ(I)),J=0;do{Y-=J,k=1/(1+Y*P),L=1/(1+Y*T),F=1/(1+Y*S),N=k*k,z=L*L,H=F*F,j=N*k,W=z*L,q=H*F,E=d*N+p*z+g*H-1,O=d*j*P+p*W*T+g*q*S,J=E/(-2*O)}while(Math.abs(E)>lJ);return e[0]=a*k,e[1]=h*L,e[2]=l*F,e}(iJ,n,eJ,i);let s=y_(rJ,o,i);s=cJ(s,s);const a=m_(oJ,n,o),h=Math.atan2(s[1],s[0]),l=Math.asin(s[2]),c=bY(u_(a,n))*uJ(a);return e[0]=_Y(h),e[1]=_Y(l),e[2]=c,e}const aJ=new Array(3),hJ=new Array(3),lJ=1e-12;function uJ(e){return Yv(e)}function cJ(e,n){const i=n[0],o=n[1],s=n[2];let a=i*i+o*o+s*s;return a>0&&(a=Math.sqrt(a),e[0]=n[0]/a,e[1]=n[1]/a,e[2]=n[2]/a),e}function AJ(e,n){return n_(n,e,nJ),l_(n,n)}function fJ(e,n){const i=e[0],o=e[1],s=Math.cos(o),a=s*Math.cos(i),h=s*Math.sin(i),l=Math.sin(o);return n.x=a,n.y=h,n.z=l,l_(n,n)}var dJ=Object.freeze({__proto__:null,cartesian3ToDegree:sJ,geodeticSurfaceNormal:AJ,geodeticSurfaceNormalCartographic:fJ,normalizeCartesian:cJ,radianToCartesian3:tJ});function pJ(e,n,i,o){i=i||0,o=o||i;const s=Math.abs(e-n);return s<=o||s<=i*Math.max(Math.abs(e),Math.abs(n))}function gJ(e,n){let i="";for(let o=0;o<4;o++){const s=e.getUint8(n+o);i+=String.fromCharCode(s)}return i}const mJ="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;function yJ(e,n,i){const o=new Uint8Array(e,n,i);return mJ?JSON.parse(mJ.decode(o)):JSON.parse(CY(o))}function vJ(e,n,i){const o=new Uint8Array(e,n,i);return mJ?JSON.parse(mJ.decode(o)):JSON.parse(CY(o))}function _J(e,n,i){return{offset:n,byteLength:i}}function xJ(e,n,i,o){const{byteOffset:s,componentType:a,type:h}=e,{ctor:l,type:c}=TJ(a||"UNSIGNED_SHORT"),A=PJ(h);return{byteStride:0,byteOffset:s+i,itemSize:A,count:o*A,componentType:c,array:new l(n,i+s,o*A)}}function bJ(e,n,i,o){const s=xJ(e,n,i,o);return s.array.buffer.byteLength!==n.byteLength&&(s.array=s.array.slice()),s}function wJ(e,n,i,o){const{byteOffset:s,componentType:a,type:h}=e,{ctor:l}=TJ(a||"UNSIGNED_SHORT"),c=PJ(h),A=new l(n,s,i*c);return 1===c?A[o]:A.subarray(o*c,o*c+c)}const CJ={SCALAR:1,VEC2:2,VEC3:3,VEC4:4};function PJ(e){return e?CJ[e]:1}const MJ={BYTE:{ctor:Int8Array,type:5120,name:"Int8Array"},UNSIGNED_BYTE:{ctor:Uint8Array,type:5121,name:"Uint8Array"},SHORT:{ctor:Int16Array,type:5122,name:"Int16Array"},UNSIGNED_SHORT:{ctor:Uint16Array,type:5123,name:"Uint16Array"},INT:{ctor:Int32Array,type:5124,name:"Int32Array"},UNSIGNED_INT:{ctor:Uint32Array,type:5125,name:"Uint32Array"},FLOAT:{ctor:Float32Array,type:5126,name:"Float32Array"},DOUBLE:{ctor:Float64Array,type:5126,name:"Float64Array"}};function TJ(e){return MJ[e]}function SJ(e){for(const n in MJ)if(e===MJ[n].ctor)return MJ[n].type;throw new Error("unrecognized ctor:"+e)}function IJ(e,n,i,o){const s=e,a=n.length/3;for(let e=0;e<a;e++)s[3*e]=n[3*e]/65535*o[0]+i[0],s[3*e+1]=n[3*e+1]/65535*o[1]+i[1],s[3*e+2]=n[3*e+2]/65535*o[2]+i[2];return s}function EJ(e,n,i){const o=e.getUint32(12,!0),s=e.getUint32(16,!0),a=e.getUint32(20,!0),h=e.getUint32(24,!0),l=e.buffer;let c,A={},f={},d=null;o>0&&(A=yJ(l,n,o),n+=o),s>0&&(c=function(e,n,i){return{offset:n,byteLength:i}}(0,n,s),n+=s),a>0&&(f=vJ(l,n,a),n+=a);const p=_J(0,n,h);return d=l.slice(p.offset,p.offset+p.byteLength),i.push(d),{featureTable:A,featureTableBin:c,batchTable:f,batchTableBin:d}}const OJ={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},RJ={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},DJ={},kJ={east:[],north:[],up:[],west:[],south:[],down:[]};let LJ=[],FJ=[],NJ=[];const zJ=[0,0,0];function BJ(e,n,i){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=n[0],i[13]=n[1],i[14]=n[2],i[15]=e[15],i}const HJ=function(e,n){const i=OJ[e][n];let o;const s=e+n;return DJ[s]?o=DJ[s]:(o=function(o,s,a){if(p_(o,zJ))Kv(LJ,RJ[e]),Kv(FJ,RJ[n]),Kv(NJ,RJ[i]);else if(pJ(o[0],0,1e-14)&&pJ(o[1],0,1e-14)){const s=bY(o[2]);Kv(LJ,RJ[e]),Kv(FJ,RJ[n]),r_(FJ,FJ,s),Kv(NJ,RJ[i]),r_(NJ,NJ,s)}else{AJ(o,kJ.up);const s=kJ.up,a=kJ.east;a[0]=-o[1],a[1]=o[0],a[2]=0,l_(kJ.east,a),c_(kJ.north,s,a),r_(kJ.down,kJ.up,-1),r_(kJ.west,kJ.east,-1),r_(kJ.south,kJ.north,-1),LJ=kJ[e],FJ=kJ[n],NJ=kJ[i]}return a[0]=LJ[0],a[1]=LJ[1],a[2]=LJ[2],a[3]=0,a[4]=FJ[0],a[5]=FJ[1],a[6]=FJ[2],a[7]=0,a[8]=NJ[0],a[9]=NJ[1],a[10]=NJ[2],a[11]=0,a[12]=o[0],a[13]=o[1],a[14]=o[2],a[15]=1,a},DJ[s]=o),o}("east","north"),jJ=[],UJ=[],GJ=[],VJ=[],WJ=[],qJ=[],ZJ=[],QJ={x:0,y:0},XJ={x:0,y:0},YJ=Math.PI/180;let JJ;const KJ={width:100,height:10};let $J=!1;try{new OffscreenCanvas(1,1).getContext("2d").fillText("hello",0,0),$J=!0}catch(t){$J=!1}let tK=class rn{constructor(e,n={}){if(!Array.isArray(e))return void console.error("colors is not array");if(e.length<2)return void console.error("colors.length should >1");this.colors=e;let i=1/0,o=-1/0;for(let n=0,s=e.length;n<s;n++){const s=e[n][0];i=Math.min(s,i),o=Math.max(s,o)}this.min=i,this.max=o,this.valueOffset=this.max-this.min,this.options=Object.assign({},KJ,n),this.o()}getImageData(){return this.imgData}o(){const e=function(){if(!JJ){const{width:e,height:n}=KJ;$J?JJ=new OffscreenCanvas(e,n):(JJ=document.createElement("canvas"),JJ.width=e,JJ.height=n)}return JJ}(),{width:n,height:i}=this.options;e.width=n,e.height=i;const o=e.getContext("2d");o.clearRect(0,0,e.width,e.height);const s=o.createLinearGradient(0,0,e.width,0),{colors:a,valueOffset:h}=this;for(let e=0,n=a.length;e<n;e++){const[n,i]=a[e];s.addColorStop((n-this.min)/h,i)}o.fillStyle=s,o.fillRect(0,0,e.width,e.height),this.imgData=o.getImageData(0,0,e.width,e.height)}getColor(e){e=Math.max(this.min,e);const n=((e=Math.min(e,this.max))-this.min)/this.valueOffset;let i=Math.round(n*this.imgData.width);i=Math.min(i,this.imgData.width-1);const o=4*i;return[this.imgData.data[o],this.imgData.data[o+1],this.imgData.data[o+2],this.imgData.data[o+3]]}};var eK;function nK(e,n){var i,o,s;if(AK(e)){var a,h=e.stops&&"object"==typeof e.stops[0][0],l=h||!(h||void 0!==e.property),c=e.type||n||"exponential";if("exponential"===c)a=oK;else if("interval"===c)a=rK;else if("categorical"===c)a=iK;else if("identity"===c)a=hK;else if("color-interpolate"===c)a=aK;else{if("calculate-expression"!==c)throw new Error('Unknown function type "'+c+'"');a=lK}if(h){var A={},f=[];for(let n=0;n<e.stops.length;n++){var d=e.stops[n];void 0===A[d[0].zoom]&&(A[d[0].zoom]={zoom:d[0].zoom,type:e.type,property:e.property,default:e.default,stops:[]}),A[d[0].zoom].stops.push([d[0].value,d[1]])}for(let e in A)f.push([A[e].zoom,nK(A[e])]);i=function(n,i){const o=oK({stops:f,base:e.base},n)(n,i);return"function"==typeof o?o(n,i):o},o=!1,s=!1}else l?(i=function(n){const i=a(e,n);return"function"==typeof i?i(n):i},o=!0,s=!1):(i=function(n,i){const o=a(e,i?i[e.property]:null);return"function"==typeof o?o(n,i):o},o=!1,s=!0)}else i=function(){return e},o=!0,s=!0;return i.isZoomConstant=s,i.isFeatureConstant=o,i}function iK(e,n){for(let i=0;i<e.stops.length;i++)if(n===e.stops[i][0])return e.stops[i][1];return e.default}function rK(e,n){for(var i=0;i<e.stops.length&&!(n<e.stops[i][0]);i++);return e.stops[Math.max(i-1,0)][1]}function oK(e,n){for(var i=void 0!==e.base?e.base:1,o=0;!(o>=e.stops.length||n<=e.stops[o][0]);)o++;return 0===o?e.stops[o][1]:o===e.stops.length?e.stops[o-1][1]:uK(n,i,e.stops[o-1][0],e.stops[o][0],e.stops[o-1][1],e.stops[o][1])}"function"==typeof Map&&(eK=new Map);const sK={width:100,height:1};function aK(e,n){const i=e.stops;if(i&&i.length>1){let e;if(eK){const n=JSON.stringify(i);if(!eK.has(n)){const e=new tK(i,sK);eK.set(n,e)}e=eK.get(n)}else e=new tK(i,sK);const[o,s,a,h]=e.getColor(n);return[o/255,s/255,a/255,h/255]}return i&&1===i.length?i[0][1]:null}function hK(e,n){return o=e.default,void 0!==(i=n)?i:void 0!==o?o:null;var i,o}function lK(e,n){const i=String(e.property),o=e.expression,s=n;function a(n){return null==n||""===n||isNaN(n)?e.default:n}if(null==n||""===n||isNaN(n)||n<0)return a(e.default);{const n=function e(n,i,o){const s=Number(o),a=String(i);return Array.isArray(n)?n.map((n=>e(n,a,s))):n===a?s:n}(o,i,s);return a(function n(i){if(!Array.isArray(i)){if("number"==typeof i)return i;throw new Error("Invalid expression format")}{const o=i[0];if(!["+","-","*","/"].includes(o))throw new Error(`Unknown operator: ${o}`);const s=i.slice(1).map((e=>n(e)));switch(o){case"+":return s.reduce(((e,n)=>e+n),0);case"-":return s.reduce(((e,n)=>e-n));case"*":return s.reduce(((e,n)=>e*n),1);case"/":return s.some((e=>0===e))?e.default:s.reduce(((e,n)=>e/n));default:throw new Error(`Unsupported operator: ${o}`)}}}(n))}}function uK(e,n,i,o,s,a){return"function"==typeof s?function(){var h=s.apply(void 0,arguments),l=a.apply(void 0,arguments);return uK(e,n,i,o,h,l)}:s.length?function(e,n,i,o,s,a){var h=[];for(let l=0;l<s.length;l++)h[l]=cK(e,n,i,o,s[l],a[l]);return h}(e,n,i,o,s,a):cK(e,n,i,o,s,a)}function cK(e,n,i,o,s,a){var h,l=o-i,c=e-i;return s*(1-(h=1===n?c/l:(Math.pow(n,c)-1)/(Math.pow(n,l)-1)))+a*h}function AK(e){return e&&"object"==typeof e&&(e.stops||e.property&&"identity"===e.type||e.expression&&"calculate-expression"===e.type)}function fK(e){return dK(e,"exponential")}function dK(e,n){if(!AK(e))return function(){return e};let i=!0,o=!0;const s=(e=JSON.parse(JSON.stringify(e))).stops;if(s)for(let e=0;e<s.length;e++)if(AK(s[e][1])){const a=dK(s[e][1],n);i=i&&a.isZoomConstant,o=o&&a.isFeatureConstant,s[e]=[s[e][0],a]}const a=nK(e,n);return a.isZoomConstant=i&&a.isZoomConstant,a.isFeatureConstant=o&&a.isFeatureConstant,a}const{getTextureMagFilter:pK,getTextureMinFilter:gK,getTextureWrap:mK,getMaterialType:yK,getMaterialFormat:vK,getPrimitive:_K,getUniqueREGLBuffer:xK}=$w,bK=[1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1],wK=[0,0,1,0,0,1,0,0,-1,0,0,0,0,0,0,1],{loginIBLResOnCanvas:CK,logoutIBLResOnCanvas:PK,getIBLResOnCanvas:MK,getPBRUniforms:TK}=DT.PBRUtils,SK={factor:0,units:0},IK=[1,1,1,1],EK=[0,0,0],OK={specularStrength:0,materialShininess:1},RK=[1,1,1],DK=xv([]),kK=[0,0,0],LK=[0,0],FK=[],NK=e=>e.material instanceof dC,zK=e=>e.material instanceof DT.StandardMaterial,BK=[],HK=new Zh(0,0),jK=new ee(0,0),UK=new ee(0,0),GK=new ee(0,0),VK=[],WK=[],qK=[],ZK=[],QK=[],XK=[],YK=[],JK=[],KK=[],$K=[],t$=[],e$=[],n$=[],i$=[],r$={POSITION:"POSITION",NORMAL:"NORMAL",TEXCOORD_0:"TEXCOORD_0",TEXCOORD_1:"TEXCOORD_1",COLOR_0:"COLOR_0",TANGENT:"TANGENT",_BATCHID:"_BATCHID"},o$=[0,1,1,2,2,3,3,0,0,4,1,5,2,6,3,7,4,5,5,6,6,7,7,4],s$=function(e,n){const i=2*Math.PI/e,o=[],s=[];for(let n=0;n<=e;n++){const e=1*Math.cos(i*n),s=1*Math.sin(i*n),a=0;o[3*n]=e,o[3*n+1]=s,o[3*n+2]=a}for(let n=e;n<=200;n++){const e=1*Math.cos(i*n),s=1*Math.sin(i*n);o[3*n]=0,o[3*n+1]=e,o[3*n+2]=s}for(let e=200;e<=300;e++){const n=1*Math.cos(i*e),s=1*Math.sin(i*e),a=0;o[3*e]=n,o[3*e+1]=a,o[3*e+2]=s}const a=o.length/3-1;for(let e=0;e<a;e++)99!==e&&199!==e&&(s[2*e]=e,s[2*e+1]=e+1);return o.push(0,0,0),o.push(1,0,0),o.push(0,1,0),o.push(0,0,1),s.push(a+1,a+2),s.push(a+1,a+3),s.push(a+1,a+4),{vertices:o,indices:s}}
/*!
   * @maptalks/gl v0.102.1
   * LICENSE : UNLICENSED
   * (c) 2016-2024 maptalks.com
   */(100),a$=[0,0,0,1],h$=[1,1,1];let l$=class dr{constructor(e,n){this.h=n,this.u=n.getRenderer().canvas,this.pickingFBO=n.getRenderer().pickingFBO,this.m=e,this.p=new PC(e),this.v={},this.T={},this._={},this.M={},this.O={},this.A={},this.I=new kC,this.S=new kC,this.C=new kC,this.N=new kC,this.k=new SC(e.texture(2)),this.R=(...e)=>this.L.call(this,...e),this.P=new iT(this.m,this.B(),this.k);const i=this.getMap();this.U=i.altitudeToPoint(100,i.getGLRes())/100}getI3DMMeshes(){return this.M}getPNTSMeshes(){return this._}getB3DMMeshes(){return this.T}getPaintedMeshes(){return this.D}getMap(){return this.h.getMap()}paint(e,n,i,o){const s=o&&o.renderTarget,a=o&&o.sceneFilter,h=this.getMap();if(!e.length||!h)return null;const l=this.F(),c=h.projViewMatrix,A=[],f=[],d=[],p=[],g=[];for(let i=0,s=e.length;i<s;i++){const s=e[i].data.node;let a=this.j(s);if(!a)continue;const h=this.h.q(s.H),l=h.debugNodes,v=h.heightOffset||0,w=h.coordOffset||LK;this.O[s.id]&&(a=this.O[s.id],a=MY(a));let C=h.polygonOffset||SK;gY(C)&&(C=C()),Array.isArray(a)||(A[0]=a,a=A);for(let h=0,A=a.length;h<A;h++){if(!a[h]||!a[h].isValid||!a[h].isValid())continue;const A=a[h].properties.magic;if(a[h].properties.heightOffset===v&&a[h].properties.coordOffset[0]===w[0]&&a[h].properties.coordOffset[1]===w[1]||(this.G(a[h]),a[h].V=_v([],a[h].localTransform)),a[h].J=s,"b3dm"===A){if(a[h].getBoundingBox&&!cX(c,a[h].getBoundingBox()))continue;const{batchIdData:e,batchIdMap:n}=a[h].geometry.properties;if(e&&n){const e=a[h].properties.node.H;this.$&&this.$[e]?rD.highlightMesh(this.m,a[h],this.$[e],this.K,n):this.$&&this.$[e]||rD.highlightMesh(this.m,a[h],null,this.K,n),rD.showOnly(this.m,a[h],this.X&&this.X[e],this.Y,n)}if(l&&l.length&&l.indexOf(a[h].J.id)<0)continue;o&&o.bloom&&a[h].properties.hlBloomMesh&&(a[h].properties.hlBloomMesh.properties.depthFunc="always",a[h].properties.hlBloomMesh.properties.polygonOffset=C,d.push(a[h].properties.hlBloomMesh)),d.push(a[h])}else"pnts"===A?p.push(a[h]):"i3dm"===A&&g.push(a[h]);a[h].properties.isLeaf=!!n[s.id],a[h].properties.selectionDepth=255-e[i].selectionDepth,a[h].properties.polygonOffset=C,n[s.id]||f.push(a[h]),this.Z(a[h]),this.W(a[h],s)}}let v=0;const w=this.P.getExcludeFilter();bO.setIncludeUniformValues(l,o),v+=this.tt(this.et,l,[a,NK,w],s,f,d,g),v+=this.tt(this.nt,l,[a,zK,w],s,f,d,g),this.P.forEachShader(((e,n,i)=>{const o=this.F(i);v+=this.tt(e,o,[a,n],s,f,d,g)})),this.S.setMeshes(p);const C=this.rt();return v+=this.p.render(this.it,C,this.S,s&&s.fbo),this.D={pntsMeshes:p,i3dmMeshes:g,b3dmMeshes:d},this.N.setMeshes(i),this.p.render(this.st,l,this.N,s&&s.fbo),v}prepareRender(e){this.ot(e)}ot(e){e&&e.states&&e.states.includesChanged&&(this.nt.dispose(),delete this.nt,this.et.dispose(),delete this.et),this.ct(e)}tt(e,n,i,o,s,a,h){e.filter=i.filter((e=>!!e)),n.stencilEnable=!1;const l=o&&o.fbo;let c=0;const A=[];for(let i=0;i<a.length;i++){const{isLeaf:o,selectionDepth:s}=a[i].properties;o&&255===s?(n.stencilEnable&&(this.ht(l),this.I.setMeshes(A),c+=this.p.render(e,n,this.I,l),A.length=0,n.stencilEnable=!1),A.push(a[i])):(n.stencilEnable||(this.I.setMeshes(A),c+=this.p.render(e,n,this.I,l),A.length=0,n.stencilEnable=!0),A.push(a[i])),i===a.length-1&&(n.stencilEnable&&this.ht(l),this.I.setMeshes(A),c+=this.p.render(e,n,this.I,l))}return this.I.setMeshes(a.filter((e=>e.properties.isLeaf))),this.C.setMeshes(h),c+=this.p.render(e,n,this.C,o&&o.fbo),c}ht(e){this.m.clear({stencil:255,framebuffer:e})}getCurrentB3DMMeshes(){return this.I.getMeshes()}getCurrentI3DMMeshes(){return this.C.getMeshes()}lt(e,n){return n.J.ut-e.J.ut}deleteTile(e){const n=e.node;n.ft&&(n.ft.geometry.dispose(),n.ft.dispose(),delete n.ft);this.dt(n.id)}dt(e){const n=this.T[e]||this._[e]||this.M[e]||this.O[e]||this.v[e];this.O[e]?this.gt(e):n&&(this.bt(n),delete this.T[e],delete this._[e],delete this.M[e],delete this.v[e])}gt(e){let n=this.O[e];n=MY(n);for(let e=0;e<n.length;e++){const{id:i}=n[e].properties;this.dt(i)}delete this.O[e]}bt(e){if(Array.isArray(e))for(let n=0,i=e.length;n<i;n++)this.bt(e[n]);else{rD.showOnly(this.m,e),rD.highlightMesh(this.m,e);const n=e.geometry.properties.url;if(n){const i=this.A[n];i&&i.refMeshes&&(i.refMeshes.delete(e.uuid),i.refMeshes.size||(i.geometry.dispose(),i.material.dispose(),delete this.A[n]))}else e.geometry.dispose(),e.material&&e.material.dispose();e.dispose()}}remove(){const e=this.h;PK(e.getRenderer().canvas,e.getMap());for(const e in this.O)this.gt(e);this.O={};for(const e in this.T)this.dt(e);this.T={};for(const e in this._)this.dt(e);this._={};for(const e in this.M)this.dt(e);this.M={};for(const e in this.v)this.dt(e);this.v={},this.et&&(this.et.dispose(),delete this.et),this.nt&&(this.nt.dispose(),delete this.nt),this.it&&(this.it.dispose(),delete this.it),this.st&&(this.st.dispose(),delete this.st),this.P.dispose(),this.picking&&this.picking.dispose()}j(e){return this.T[e.id]||this._[e.id]||this.M[e.id]||this.O[e.id]}has(e){return this.j(e)||this.v[e.id]}G(e){const n=e.properties.magic;"b3dm"===n?this.yt(e):"i3dm"===n?this.wt(e):"pnts"===n&&this.vt(e)}createPntsMesh(e,n,i,o){if(this._[n]){const e=this._[n];return console.warn(`pnts mesh with id(${n}) was already created.`),o(null,{id:n,mesh:e}),e}const{pnts:s,featureTable:a,rootIdx:h,compressed_int16_params:l}=e,c=a.POINTS_LENGTH;s.BATCH_ID||(s.BATCH_ID=new Uint8Array(c),s.BATCH_ID.fill(0));const A=new Lw(s,null,c,{static:!0,primitive:"points",positionAttribute:"POSITION",pickingIdAttribute:"BATCH_ID"});A.generateBuffers(this.m);const f={};s.POSITION?f.HAS_POSITION=1:s.POSITION_QUANTIZED&&(f.HAS_POSITION_QUANTIZED=1),s.RGB?f.HAS_RGB=1:s.RGBA?f.HAS_RGBA=1:s.RGB565&&(f.HAS_RGB565=1),(s.NORMAL||s.NORMAL_OCT16P)&&(f.HAS_NORMAL=1,s.NORMAL_OCT16P&&(f.HAS_NORMAL_OCT16P=1)),this.Tt(f,l),e.featureTable.CONSTANT_RGBA&&(e.featureTable.CONSTANT_RGBA=e.featureTable.CONSTANT_RGBA.map((e=>e/255)));const{rtcCenter:d,rtcCoord:p,projCenter:g}=e,v=this.h.q(h),w=new bC(A);w.properties.magic="pnts",w.properties.id=n,w.properties.node=i,w.properties.count=c,w.properties.batchTable=e.batchTable,w.properties.batchTableBin=e.batchTableBin,w.properties.serviceIndex=h,w.properties.rtcCoord=p,w.properties.rtcCenter=d,w.properties.projCenter=g,w.setDefines(f),w.setFunctionUniform("pointColor",(function(){return e.featureTable.CONSTANT_RGBA?e.featureTable.CONSTANT_RGBA:v&&v.pointColor||[1,1,1,1]}));const C=this.getMap();let P=null,T=null;w.setFunctionUniform("pointSize",(function(){if(!v)return 2;if(AK(v.pointSize)){const e=JSON.stringify(v.pointSize);return e!==P&&(T=fK(v.pointSize),P=e),T(C.getZoom())}return v.pointSize||2}));let S=null,I=null;return w.setFunctionUniform("pointOpacity",(function(){if(!v)return 1;if(AK(v.pointOpacity)){const e=JSON.stringify(v.pointOpacity);return e!==S&&(I=fK(v.pointOpacity),S=e),I(C.getZoom())}return v.pointOpacity||1})),this._t(w,l),this.vt(w),w.V=_v([],w.localTransform),this._[n]=w,o(null,{id:n,mesh:[w]}),[w]}vt(e){const n=e.localTransform||[],{rtcCoord:i,node:o,projCenter:s}=e.properties;this.Mt(n,i,s,o.H),e.setLocalTransform(n)}createI3DMMesh(e,n,i,o){if(this.M[n]){const e=this.M[n];return console.warn(`i3dm mesh with id(${n}) was already created.`),this.v[n]||o(null,{id:n,mesh:e}),e}const s=this.h.q(i.H),a=this.Ot(i.At),{i3dm:h,featureTable:l,gltf:c,batchTable:A,batchTableBin:f,count:d}=e,p=l.INSTANCES_LENGTH,{rtcCenter:g,rtcCoord:v,projCenter:w}=e,C=this.xt(ZK,i,g,v);BJ(C,kK,C);const P=Nv(QK,C);Rx(P,P);const T=Fv(XK,C),S=Rv(YK,T),I=this.It(JK,w,i),E=this.St(t$),O=this.Et(e$,v),k=v_(n$,O,E),L=Rv(i$,k),{POSITION:F,NORMAL_UP:N,NORMAL_RIGHT:z,SCALE:H,SCALE_NON_UNIFORM:j}=h,W={instance_vectorA:new Float32Array(4*p),instance_vectorB:new Float32Array(4*p),instance_vectorC:new Float32Array(4*p),aPickingId:new Uint16Array(p)};for(let e=0;e<p;e++)W.aPickingId[e]=e;const q=new Float32Array(3),Y=new Float32Array(3),J=[],$=new Float32Array(1),it=new Float32Array(3),rt=[],ot=[],st=[],at=[];!function(e,n){let{byteOffset:i,byteStride:o,count:s}=e;const{componentType:a,itemSize:h}=e,l=e.array.buffer,c=a?zy.getTypedArrayCtor(a):e.array.constructor;if(i=void 0===i?e.array.byteOffset:i,o=o||0,s=s||e.array.length/h,(!o||o===h*c.BYTES_PER_ELEMENT)&&i%c.BYTES_PER_ELEMENT==0){const e=new c(l,i,s*h);for(let o=0;o<s*h;o+=h)n(new c(e.buffer,i+o*c.BYTES_PER_ELEMENT,h),o/h);return}const A=new Uint8Array(h*c.BYTES_PER_ELEMENT);o||(o=h*c.BYTES_PER_ELEMENT);for(let e=0;e<s;e++){const s=new Uint8Array(l,o*e+i,h*c.BYTES_PER_ELEMENT);A.set(s),n(new c(A.buffer),e),s.set(A)}}(F,((e,n)=>{N?(QY(Y,z,n),QY(q,N,n),c_(J,Y,q),l_(J,J),PY(rt,Y,0),PY(rt,q,1),PY(rt,J,2),cx(ot,rt),Rx(ot,ot),rx(ot,P,ot)):nx(ot),H?(QY($,H,n),$v(st,$[0],$[0],$[0])):j?(QY(it,j,n),$v(st,...it)):$v(st,1,1,1),zv(at,ot,e,st),XY(W.instance_vectorA,n,at,0),XY(W.instance_vectorB,n,at,1),XY(W.instance_vectorC,n,at,2)}));const ht={};for(const e in W)ht[e]={buffer:this.m.buffer({dimension:W[e].length/p,data:W[e]}),divisor:1};const At=s.shader||"pbr";let ft=0,gt=!0;const vt=[],_t=[];return HY(c,((e,o,s,h)=>{const c=this.Ct(e,o,s,h,i,!0,At,_t),{geometry:P,material:T}=c;T&&!T.isReady()&&(gt=!1,ft++);const E=new wC(ht,p,P,T);c.refMeshes||(c.refMeshes=new Set,c.refMeshes.add(E.uuid)),E.properties.magic="i3dm",E.properties.id=n,E.properties.count=d,E.properties.batchTable=A,E.properties.batchTableBin=f,E.properties.serviceIndex=i.H,E.properties.rtcCoord=v,E.properties.rtcCenter=g,E.properties.projCenter=w,E.properties.node=i;const O=this.Nt(e,P,T,i.H,h);e.compressed_int16_params&&this._t(E,e.compressed_int16_params),this.kt(E,e.attributes);const k=xv([]);if(e.matrices&&e.matrices.length)for(let n=0;n<e.matrices.length;n++)Cv(k,k,e.matrices[n]);Cv(k,a,k),Cv(k,L,k),Cv(k,l.EAST_NORTH_UP||N?S:C,k),E.setPositionMatrix(k),this.wt(E,I),E.setDefines(O),E.properties.polygonOffset={offset:0,factor:0},vt.push(E),delete e.attributes,E.V=_v([],E.localTransform)})),u$(_t),gt?(this.M[n]=vt,o(null,{id:n,mesh:vt})):(this.v[n]={meshes:vt,count:ft},vt.Rt=o),vt}wt(e,n){const{rtcCoord:i,node:o,projCenter:s}=e.properties;n||(n=this.It(JK,s,o));const a=this.h.q(o.H),h=e.localTransform||[];if(a.coordOffset){Cv(h,this.Lt(ZK,o.H,i),n)}else _v(h,n);e.setLocalTransform(h),e.properties.heightOffset=a.heightOffset||0,e.properties.coordOffset=a.coordOffset&&a.coordOffset.slice(0)||LK}It(e,n,i){Rv(e,this.St(t$));const o=this.Pt(WK,n,i.H);return Cv(e,Ov(KK,o),e),e}createB3DMMesh(e,n,i,o){if(e.gltf&&(e.gltf.transferables=null),this.T[n]||this.v[n]){const e=this.T[n];return console.warn(`mesh with id(${n}) was already created.`),this.v[n]||o(null,{id:n,mesh:e}),e}let s;if(i.maxExtent){const e=new al(i.maxExtent).convertTo((e=>this._pointToPrj(e)));s=[e.xmin,e.ymin,e.xmax,e.ymax]}const a=e.gltf,{projCenter:h}=a.extensions.MAPTALKS_RTC,{rtcCoord:l,center:c}=a.extensions.CESIUM_RTC,A=a.asset.sharePosition,f=this.Ot(i.At),d=this.Bt(JK,A,l,c,h,i),p=this.h.q(i.H);let g=p.shader||"pbr";if(p.unlit)g="phong";else if(a.materials)for(let e=0;e<a.materials.length;e++)if(a.materials[e]&&a.materials[e].extensions&&a.materials[e].extensions.KHR_materials_unlit){g="phong";break}const v=[],w=[];let C=0,P=!0;return HY(a,((o,a,T,S)=>{const I=this.Ct(o,a,T,S,i,!1,g,v),{geometry:E,material:O}=I;O&&!O.isReady()&&(P=!1,C++);const k=new bC(E,O);I.refMeshes||(I.refMeshes=new Set,I.refMeshes.add(k.uuid)),k.properties.magic="b3dm",k.properties.id=n,k.properties.node=i,e.batchTable&&(k.properties.batchTable=e.batchTable,k.properties.batchTableBin=e.batchTableBin),k.properties.count=e.featureTable&&e.featureTable.BATCH_LENGTH||0,k.properties.serviceIndex=i.H;const L=this.Nt(o,E,O,i.H,S);k.setDefines(L);const F=o.compressUniforms;if(F)for(const e in F)k.setUniform(e,F[e]);o.compressed_int16_params&&this._t(k,o.compressed_int16_params),this.kt(k,o.attributes),s&&(L.USE_MAX_EXTENT=1,k.setUniform("maxPrjExtent",s)),k.hasFunctionUniform("polygonOpacity")||k.setFunctionUniform("polygonOpacity",(function(){return yY(p.opacity)?p.opacity:1})),k.hasFunctionUniform("polygonFill")||k.setFunctionUniform("polygonFill",(function(){return RY([],p.polygonFill||IK)})),k.material.hasFunctionUniform("hsv")||k.material.setFunctionUniform("hsv",(function(){return p.hsv||EK}));const N=xv([]);if(A&&o.matrices&&o.matrices.length)for(let e=0;e<o.matrices.length;e++)Cv(N,N,o.matrices[e]);A&&Cv(N,f,N),k.properties.node=i,k.properties.projCenter=h,k.properties.nodeMatrix=N,k.properties.isSharedPosition=A,k.properties.rtcCoord=l,k.properties.rtcCenter=c,this.yt(k,d),w.push(k),delete o.attributes,k.V=_v([],k.localTransform)})),u$(v),P?(this.T[n]=w,o(null,{id:n,mesh:w})):(this.v[n]={meshes:w,count:C},w.Rt=o),w}Ut(e){const n=this.h.Dt(e.id);if(!n||e.ft)return;let i,o,s,a;if(n.obbox)i=n.boxPosition,o=o$,s=n.boxCenter,a=h$;else if(n.sphereBox){const e=n.sphereBox[1];i=s$.vertices,o=s$.indices,s=n.sphereBox[0],a=[e,e,e]}const h=new Lw({POSITION:i},o,0,{primitive:"lines",positionAttribute:"POSITION"}),l=new bC(h,new cC({lineColor:[.8,.8,.1,1],lineOpacity:1})),c=[];zv(c,a$,s,a),l.localTransform=c,l.V=_v([],c),l.properties.node=e,e.ft=l}Ft(e){e.ft&&(e.ft.geometry.dispose(),e.ft.dispose(),delete e.ft)}_t(e,n){n.POSITION&&e.setUniform("compressedPositionRange",n.POSITION),n.TEXCOORD_0&&e.setUniform("compressedTexcoordRange_0",n.TEXCOORD_0),n.TEXCOORD_1&&e.setUniform("compressedTexcoordRange_1",n.TEXCOORD_0),n.NORMAL&&e.setUniform("compressedNormalRange",n.NORMAL),n.TANGENT&&e.setUniform("compressedTangentRange",n.TANGENT),n.compressed_ratio&&e.setUniform("compressed_ratio",n.compressed_ratio)}yt(e,n){const{isSharedPosition:i,rtcCoord:o,rtcCenter:s,projCenter:a,nodeMatrix:h,node:l}=e.properties;n||(n=this.Bt(n||JK,i,o,s,a,l));const c=e.localTransform||xv([]);Cv(c,n,h);const A=this.h.q(l.H);if(A.coordOffset){Cv(c,this.Lt(ZK,l.H,o),c)}e.setLocalTransform(c),e.properties.heightOffset=A.heightOffset||0,e.properties.coordOffset=A.coordOffset&&A.coordOffset.slice(0)||LK}Bt(e,n,i,o,s,a){if(n){const n=this.Et(e$,i),s=Rv(qK,n);Cv(e,this.xt(ZK,a,o,i),s)}else this.Mt(e,i,s,a.H);return e}kt(e,n){if(n&&n.TEXCOORD_0&&n.TEXCOORD_0.extensions&&n.TEXCOORD_0.extensions.WEB3D_quantized_attributes){e.setUniform("decodeMatrix",n.TEXCOORD_0.extensions.WEB3D_quantized_attributes.decodeMatrix)}}xt(e,n,i,o){const s=this.getMap(),a=this.h.q(n.H).heightOffset||0,h=n.matrix?_v(e,n.matrix):xv(e);i&&BJ(h,A_(BK,i,h),h);const l=function(e,n,i,o,s,a,h){n=Kv(jJ,n);const l=tJ(jJ,n[0]*YJ,n[1]*YJ,n[2]),c=Lv(UJ,i),A=o.ellipsoid;let f;f=0===b_(c)?$v(GJ,0,0,-6378137):sJ(GJ,c),QJ.x=f[0],QJ.y=f[1];const d=o.project(QJ,XJ);VJ[0]=d.x/s,VJ[1]=d.y/s,VJ[2]=(f[2]+h)*a;const p=HJ(l,A,WJ);return BJ(function(e,n,i){const o=e[0],s=e[1],a=e[2],h=e[4],l=e[5],c=e[6],A=e[8],f=e[9],d=e[10],p=n[0],g=n[1],v=n[2],w=n[3],C=n[4],P=n[5],T=n[6],S=n[7],I=n[8],E=s*p+l*g+f*v,O=a*p+c*g+d*v,k=o*w+h*C+A*P,L=s*w+l*C+f*P,F=a*w+c*C+d*P,N=o*T+h*S+A*I,z=s*T+l*S+f*I,H=a*T+c*S+d*I;return i[0]=o*p+h*g+A*v,i[1]=E,i[2]=O,i[3]=0,i[4]=k,i[5]=L,i[6]=F,i[7]=0,i[8]=N,i[9]=z,i[10]=H,i[11]=0,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}(wv(qJ,p),uv(ZJ,i),e),VJ,e),e}(h,o,h,s.getProjection(),s.getGLRes(),this.U,a),c=function(e,n){return $v(e,n[12],n[13],n[14]),e}(WK,l);let A=this.h.options.offset;if(gY(A)){const e=this.h.Dt(n.id).boxCoord;A=A.call(this.h,e)}return $v(VK,A[0],A[1],0),m_(c,c,VK),BJ(l,c,l),l}Lt(e,n,i){const o=this.h.q(n);if(!o.coordOffset)return null;const s=this.getMap(),a=s.getGLRes();HK.set(i[0],i[1]);const h=s.coordToPointAtRes(HK,a,UK),l=o.coordOffset,c=HK.set(i[0]+l[0],i[1]+l[1]),A=s.coordToPointAtRes(c,a,GK);return Ov(e,$v(VK,A.x-h.x,A.y-h.y,(l[2]||0)*this.U))}createCMPTMesh(e,n,i,o){if(this.O[n]){const e=this.O[n];return console.warn(`mesh with id(${n}) was already created.`),o(null,{id:n,mesh:e}),e}const{content:s}=e,a=[];for(let e=0;e<s.length;e++){const{magic:o}=s[e],h=n+"."+e;"b3dm"===o?this.createB3DMMesh(s[e],h,i,((e,{mesh:n})=>{a.push(n)})):"i3dm"===o?this.createI3DMMesh(s[e],h,i,((e,{mesh:n})=>{a.push(n)})):"pnts"===o?this.createPntsMesh(s[e],h,i,((e,{mesh:n})=>{a.push(n)})):"cmpt"===o&&this.createCMPTMesh(s[e],h,i,((e,{mesh:n})=>{a.push(n)}))}return this.O[n]=a,o(null,{id:n,mesh:a}),a}Nt(e,n,i,o,s){const a=("phong"===(this.h.q(o).shader||"pbr")?this.et:this.nt).getGeometryDefines(n);return s.asset&&"S3M"===s.asset.generator&&this.jt(a,n),n.data.uvRegion&&(a.HAS_I3S_UVREGION=1),n.data[n.desc.normalAttribute]&&(a.VertexNormal=1),n.data[n.desc.color0Attribute]&&(a.VertexColor=1),n.data[n.desc.uv0Attribute]&&(a.TexCoord=1),n.data[n.desc.textureCoordMatrixAttribute]&&(a.HAS_TextureCoordMatrix=1),i.get("uTexture")&&(a.COMPUTE_TEXCOORD=1),i.get("uTexture2")&&(a.TexCoord2=1),"MESHOPT"===this.h.zt&&(a.MeshOPT_Compress=1),this.hasIBL()&&(a.HAS_IBL_LIGHTING=1),e.attributes&&e.attributes.TEXCOORD_0&&"WEB3D_quantized_attributes"===e.attributes.TEXCOORD_0.extensions&&(a.HAS_WEB3D_quantized_attributes_TEXCOORD=1),a.HAS_MIN_ALTITUDE=1,a.HAS_LAYER_OPACITY=1,this.Tt(a,e.compressed_int16_params),pY(a,e.compressDefines),a}Tt(e,n){n&&Object.keys(n).length>0&&(e.HAS_COMPRESSED_INT16=1,n.POSITION&&(e.HAS_COMPRESSED_INT16_POSITION=1),n.TEXCOORD_0&&(e.HAS_COMPRESSED_INT16_TEXCOORD_0=1),n.TEXCOORD_1&&(e.HAS_COMPRESSED_INT16_TEXCOORD_1=1),n.NORMAL&&(e.HAS_COMPRESSED_INT16_NORMAL=1),n.TANGENT&&(e.HAS_COMPRESSED_INT16_TANGENT=1),n.compressed_ratio&&(e.HAS_COMPRESSED_INT16_RATIO=1))}Z(e){const n=this.h.getRenderer();n&&n.updateMaskDefines(e)}jt(e,n){n.data.aNormal&&(e.VertexNormal=1),n.data.instanceId&&(e.Instance=1),n.data.aTexCoord0&&(e.TexCoord=1),n.data.aColor&&(e.VertexColor=1),n.data.aTexCoord1&&(e.TexCoord2=1),n.data.uv2&&(e.InstanceBim=1)}Ct(e,n,i,o,s,a,h,l){let c=!1;o.asset&&"S3M"===o.asset.generator&&(c=!0,o.extensions=o.extensions||{});const A=o.url+"-"+n+"-"+i;if(this.A[A])return this.A[A];let f,d;l.push(e);const p=o.materials&&o.materials[e.material],g=o.extensions&&o.extensions.KHR_techniques_webgl,v=this.h.q(s.H);if(g&&p.extensions&&p.extensions.KHR_techniques_webgl){const n=this.qt(e,o,a,c);f=n.material,d=n.geometry,v.fillEmptyDataInMissingAttribute&&(d.desc.fillEmptyDataInMissingAttribute=!0)}else{d=this.Ht(e,a,r$);f=this.Gt(e.material,o,h,v.material||OK,l,v)}f&&(f.setFunctionUniform("alphaTest",(function(){const e=v.alphaTest;return dY(e)?.1:e})),f.setFunctionUniform("environmentExposure",(()=>{const e=v.ambientLight;let n=v.environmentExposure;const i=this.getMap().getLightManager(),o=i&&i.getAmbientLight();if(e&&(!o||o.color)&&void 0===n){n=e[0]/(o&&o.color?o.color[0]:.2)}return n||1}))),f&&!f.isReady()?f.Vt=s.id:f||(f=new dC({baseColorFactor:[1,1,1,1]}));const w={geometry:d,material:f};return d.properties.url=A,this.A[A]=w,w}qt(e,n,i,o){const{geometry:s,material:a}=this.P.createMesh(e,n,i,o);return{geometry:s,material:a}}Ht(e,n,i){const o=e.attributes,s="COLOR_0";let a=o._BATCHID&&o._BATCHID.array;if(a&&a.byteOffset&&(a=new a.constructor(a)),o[s]){const e=o[s].array||o[s];if(e instanceof Float32Array){const n=new Uint8Array(e.length);for(let i=0;i<n.length;i++)n[i]=Math.round(255*e[i]);o[s].array?(o[s].array=n,o[s].componentType=5121):o[s]=n}}const h={};for(const e in o){const n=xK(this.m,o[e],{dimension:o[e].itemSize}),s=i[e]||e;h[s]={buffer:n},o[e].quantization&&(h[s].quantization=o[e].quantization),s===i.POSITION&&(h[s].array=o[e].array,h[s].min=o[e].min,h[s].max=o[e].max)}const l=e.indices?e.indices.array?e.indices.array.slice():e.indices:null,c=new Lw(h,l,0,{positionAttribute:i.POSITION,normalAttribute:i.NORMAL,uv0Attribute:i.TEXCOORD_0,uv1Attribute:i.TEXCOORD_1,color0Attribute:i.COLOR_0,tangentAttribute:i.TANGENT,pickingIdAttribute:i._BATCHID,primitive:void 0===e.mode?"triangles":_K(e.mode)});return a&&l&&(c.properties.batchIdData=a,c.properties.batchIdMap=function(e,n){if(!n)return null;const i=new Map;for(let o=0;o<n.length;o++){const s=n[o],a=e[s];let h=i.get(a);h||(h=[],i.set(a,h)),h.push(s)}return i}(a,l)),c.generateBuffers(this.m,{excludeElementsInVAO:n}),c}Mt(e,n,i,o){const s=xv(e),a=this.St(RK);return this.Pt(WK,i,o),Pv(s,s,WK),Mv(s,s,a),s}Pt(e,n,i){const o=this.U;HK.x=n[0],HK.y=n[1];const s=this._prjToPoint(HK);let a=this.h.options.offset;gY(a)&&(a=a.call(this.h,HK));const h=this.h.q(i).heightOffset||0;return $v(e,s.x-a[0],s.y-a[1],o*n[2]+o*h),e}W(e,n){const i=this.h.Jt($K,n);e.localTransform=Cv(e.localTransform,i,e.V)}Et(e,n){const i=this.getMap();HK.x=n[0],HK.y=n[1];const o=i.distanceToPointAtRes(100,100,i.getGLRes(),HK);return $v(e,o.x/100,o.y/100,this.U),e}ct(e){if(this.nt)return;const n=[],i=[];this.it=new eP({vert:YY,frag:"#define SHADER_NAME PNTS\n\nprecision mediump float;\n\n\n\nvarying vec4 vColor;\n\n\n\nvoid main() {\n\n    vec2 circCoord = 2.0 * gl_PointCoord - 1.0;\n\n    if (dot(circCoord, circCoord) > 1.0) {\n\n        discard;\n\n    } else {\n\n        gl_FragColor = vColor;\n\n    }\n\n}\n\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(e,n)=>Cv(i,n.projViewMatrix,n.modelMatrix)},{name:"modelNormalMatrix",type:"function",fn:(e,i)=>uv(n,i.modelMatrix)}],extraCommandProps:{viewport:{x:0,y:0,width:()=>this.u?this.u.width:1,height:()=>this.u?this.u.height:1},blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"},depth:{enable:!0,range:[0,1],func:"<"}}});const o={},s=[];bO.fillIncludes(o,s,e);const a=this.B();this.et=new nP({uniforms:s,defines:o,extraCommandProps:a}),this.nt=new DT.StandardShader({uniforms:s,defines:o,extraCommandProps:a}),this.st=new wP({extraCommandProps:{viewport:{x:0,y:0,width:()=>this.u?this.u.width:1,height:()=>this.u?this.u.height:1},blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"},equation:"add"}}});const h=this.h;CK(h.getRenderer().canvas,this.m,h.getMap()),this.picking=new XM(this.p,{vert:this.nt.vert,extraCommandProps:a,uniforms:this.nt.uniforms,defines:{PICKING_MODE:1,ENABLE_PICKING:1,HAS_PICKING_ID:1}},this.pickingFBO,this.getMap()),this.$t=new XM(this.p,{vert:YY,extraCommandProps:a,uniforms:this.it.uniforms,defines:{PICKING_MODE:1,ENABLE_PICKING:1,HAS_PICKING_ID:1}},this.pickingFBO,this.getMap())}B(){return{viewport:{x:0,y:0,width:()=>this.u?this.u.width:1,height:()=>this.u?this.u.height:1},cull:{enable:!0},stencil:{enable:(e,n)=>n.stencilEnable,func:{cmp:">=",ref:(e,n)=>n.meshProperties.selectionDepth},opFront:{fail:"keep",zfail:"keep",zpass:"replace"},opBack:{fail:"keep",zfail:"keep",zpass:"replace"}},depth:{enable:!0,range:[0,1],func:(e,n)=>n.meshProperties.depthFunc||"<"},blend:{enable:!0,func:{src:1,dst:"one minus src alpha"},equation:"add"},polygonOffset:{enable:!0,offset:(e,n)=>n.meshProperties.polygonOffset}}}rt(e){const n=this.getMap(),i=n.getLightManager(),o=(i&&i.getDirectionalLight()||{}).direction||[1,1,-1];return{projViewMatrix:n.projViewMatrix,pointOpacity:e&&e.pointOpacity||1,lightDir:l_(FK,o)}}F(){const e=this.getMap(),n=this.h,i=n.getRenderer().canvas,{iblTexes:o,dfgLUT:s}=MK(i),a=TK(e,o,s),h=this.h.getRenderer(),l=h.getMaskUniforms();a.minAltitude=n.options.altitude||0;return a.layerOpacity=h.canvas.gl&&h.canvas.gl.wrap?n.options.opacity||0:1,pY(a,{czm_lightDirectionEC:a.light0_viewDirection,lightSpecular:[1,1,1],viewMatrix:e.viewMatrix,projMatrix:e.projMatrix,projViewMatrix:e.projViewMatrix,outSize:[i.width,i.height],polygonFill:[1,1,1,1],polygonOpacity:1}),pY(a,l),a}Gt(e,n,i,o,s,a){const h=n.materials&&n.materials[e];if(!h||!h.baseColorTexture&&!h.pbrMetallicRoughness)return null;const l=pY({},o);if(h.baseColorTexture){const e=n.textures[h.baseColorTexture.index];let i;e&&!e.image.color&&(i=this.Kt(e,s)),l.baseColorFactor=e&&e.image.color||h.baseColorFactor||[1,1,1,1],i&&(l.baseColorTexture=i)}else{if(h.normalTexture){const e=this.Kt(n.textures[h.normalTexture.index],s);if(e){const n=h.normalTexture.scale||1;l.normalTexture=e,l.normalMapFactor=n}}if(h.occlusionTexture){const e=this.Kt(n.textures[h.occlusionTexture.index],s);if(e){const n=h.occlusionTexture.strength||1;l.occlusionTexture=e,l.occlusionFactor=n}}if(h.emissiveTexture){const e=this.Kt(n.textures[h.emissiveTexture.index],s);e&&(l.emissiveTexture=e)}h.emissiveFactor&&(l.emissiveFactor=h.emissiveFactor);const e=h.pbrMetallicRoughness;if(e){if(e.baseColorFactor&&(l.baseColorFactor=e.baseColorFactor),e.baseColorTexture&&void 0!==e.baseColorTexture.index){const i=n.textures[e.baseColorTexture.index];if(i&&i.image&&i.image.color)l.baseColorFactor=l.baseColorFactor?D_(l.baseColorFactor,l.baseColorFactor,i.image.color):i.image.color;else{const e=this.Kt(i,s);e&&(l.baseColorTexture=e,l.baseColorTexture.getREGLTexture(this.m))}}if(dY(e.metallicFactor)||(l.metallicFactor=e.metallicFactor),dY(e.roughnessFactor)||(l.roughnessFactor=e.roughnessFactor),h.metallicRoughnessTexture){const e=this.Kt(n.textures[h.metallicRoughnessTexture.index],s);e&&(l.metallicRoughnessTexture=e)}}}if(h.s3mMaterial)return new cC(l);if(a.unlit||h.extensions&&h.extensions.KHR_materials_unlit){l.ambientColor=[1,1,1],l.light0_diffuse=[0,0,0,0],l.lightSpecular=[0,0,0];const e=new dC(l);return e.unlit=void 0===a.unlit||!!a.unlit,e}let c=new DT.StandardMaterial(l);"phong"===i&&(c=dC.convertFrom(c));const A=h.pbrMetallicRoughness,f=A&&A.baseColorTexture&&A.baseColorTexture.extensions;return f&&f.KHR_texture_transform&&(c.set("khr_offset",f.KHR_texture_transform.offset||[0,0]),c.set("khr_rotation",f.KHR_texture_transform.rotation||0),c.set("khr_scale",f.KHR_texture_transform.scale||[1,1])),c.doubleSided=!(!a.doubleSided&&!h.doubleSided),c.once("complete",this.R),c}Kt(e,n){if(!e)return null;const i={type:e.type?yK(e.type):"uint8",format:e.format?vK(e.format):"rgba",flipY:!!e.flipY},o=e.image;if(n.push(o),o.array?i.data=o.array:o.mipmap&&(i.mipmap=o.mipmap),!i.data&&!i.mipmap)return null;if(i.width=o.width,i.height=o.height,i.mipmap&&(i.width<4||i.height<4))return null;const s=e.sampler||e.texture&&e.texture.sampler;return s&&(s.magFilter&&(i.mag=pK(s.magFilter)),s.minFilter&&(i.min=gK(s.minFilter)),s.wrapS&&(i.wrapS=mK(s.wrapS)),s.wrapT&&(i.wrapT=mK(s.wrapT))),new VC(i,this.k)}L({target:e}){const n=e.Vt,i=this.v[n];if(i.count--,!i.count){const e=i.meshes;this.T[n]=e,delete this.v[n];const o=e.Rt;delete e.Rt,o(null,{mesh:i.meshes,id:n})}}St(e){const n=1/this.getMap().getGLRes(),i=this.U;return e[0]=e[1]=n,e[2]=i,e}Xt(e){return this.h.Xt(e)}_pointToPrj(e){const n=this.getMap();return n.getGLZoom?n._pointToPrj(e,n.getGLZoom()):n._pointToPrjAtRes(e,n.getGLRes())}_prjToPoint(e){const n=this.getMap();return n.getGLZoom?n._prjToPoint(e,n.getGLZoom()):n._prjToPointAtRes(e,n.getGLRes(),jK)}Ot(e){return"Y"===e?bK:"X"===e?wK:DK}pick(e,n,i=3){const o=this.h;if(!o||!o.options.picking)return[];if(!this.pickingFBO||!this.picking)return[];const s=[],a=this.F(),h=this.Yt(this.picking,a,this.I,e,n,i);h&&s.push(h);const l=this.Yt(this.picking,a,this.C,e,n,i);l&&s.push(l);const c=this.rt(),A=this.Yt(this.$t,c,this.S,e,n,i);return A&&s.push(A),s}Yt(e,n,i,o,s,a){if(!i.getMeshes().length)return null;const h=this.h,l=this.getMap();e.render(i.getMeshes().filter((e=>!e.bloom)),n,!0);let c={};e.getRenderedMeshes().length&&(c=e.pick(o,s,a,n,{viewMatrix:l.viewMatrix,projMatrix:l.projMatrix,returnPoint:h.options.pickingPoint}));const{meshId:A,pickingId:f,point:d,coordinate:p}=c,g=(0===A||A)&&e.getMeshAt(A);if(!g||!g.geometry)return null;const v=g.properties;d&&d.length&&(d[0]=Math.round(1e5*d[0])/1e5,d[1]=Math.round(1e5*d[1])/1e5,d[2]=Math.round(1e5*d[2])/1e5);const w={batchId:f},C=h.options.services,P=C&&C[g.properties.serviceIndex];if(P&&P.debug&&(w.debugInfo=v),v&&v.batchTable){const{batchTable:e,batchTableBin:n,count:i}=v,o=f;for(const s in e)w[s]=void 0!==e[s].byteOffset?wJ(e[s],n,i,o):e[s][o]}return{service:g.properties.serviceIndex,data:w,point:d,coordinate:p}}highlight(e){this.$=e;const n=this.h.getRenderer();this.K=n.getFrameTimestamp(),n.setToRedraw(!0)}cancelAllHighlight(){this.$=null;const e=this.h.getRenderer();this.K=e.getFrameTimestamp(),e.setToRedraw(!0)}showOnly(e){this.X=e;const n=this.h.getRenderer();this.Y=n.getFrameTimestamp(),n.setToRedraw(!0)}cancelShowOnly(){this.X=null;const e=this.h.getRenderer();this.Y=e.getFrameTimestamp(),e.setToRedraw(!0)}Zt(){if(!this.D)return[];const e={},n=[];for(const i in this.D){const o=this.D[i];if(o)for(let i=0;i<o.length;i++){const s=o[i],a=s&&s.geometry;if(!s||!a)continue;const h=s.properties.serviceIndex;e[h]||(e[h]=new Set);const l=a.properties.batchIdData;if(l)for(let i=0;i<l.length;i++)e[h].has(l[i])||(n.push({id:l[i],service:h}),e[h].add(l[i]))}}return n}hasIBL(){const e=this.getMap().getLightManager();return!(!e||!e.getAmbientResource())}};function u$(e){for(let n=0;n<e.length;n++)e[n]&&(e[n].array&&(e[n].array=null),e[n].mipmap&&(e[n].mipmap=null),e[n].indices&&(e[n].indices=null))}const c$=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")},A$=c$(),f$=A$.gl_trans__coders=A$.gl_trans__coders||{};function d$(e,n){if(n)for(let i=0;i<n.length;i++)e[n[i].id||n[i].index]=n[i]}f$.inject=function(e){const n=e.toString(),i=n.indexOf("{")+1,o=n.substring(0,i),s=A$.gl_trans__coders=A$.gl_trans__coders||{};let a=`${o}\n    const _____getGlobal = ${c$.toString()};\n    const g___lobals = _____getGlobal()\n    const tran_____scoders = g___lobals['gl_trans__coders'] = g___lobals['gl_trans__coders'] || {};`;for(const e in s)"inject"!==e&&"getTranscoder"!==e&&"registerTranscoder"!==e&&(a+='tran_____scoders["'+e+'"] ='+s[e].toString()+"\n;");return a+="\n"+n.substring(o.length),a},f$.registerTranscoder=function(e,n){f$[e]=n},f$.getTranscoder=function(e){return f$[e]};const p$=[];let g$=class vr{constructor(e,n,i,o,s){this.h=o,this.Wt=e,this.H=n,this.Qt=s,this.te=i.version,e.indexOf("i3s:tileset:")<0?(this.ee=this.te<=1.6?"root":0,i.version=this.te):(this.ee=e.substring(12),this.te>1.6&&(this.ee=parseInt(this.ee))),this.Wt=e,this.ne=i}load(){const e=this.ne,n=e.layerScene.baseUrl;if(this.te<=1.6)return e[this.ee]&&e[this.ee].lodSelection?(this.re=e[this.ee],this.ie()):new Promise((i=>{let o=n+"/nodes/"+this.ee;e.layerScene.eslpk&&(o+="/3dNodeIndexDocument.json"),this.Qt(this.H,o,(()=>{this.re=e[this.ee],i(this.ie())}))}));if(this.te>=1.7){if(e[this.ee])return this.re=e[this.ee],this.ie();const i=Math.floor(this.ee/e.nodesPerPage);return new Promise((o=>{let s=n+"/nodepages/"+i;e.layerScene.eslpk&&(s+=".json"),this.Qt(this.H,s,(()=>{this.re=e[this.ee],o(this.ie())}))}))}return null}getTileset(){return this.se}getChildrenURL(){return this.oe}ie(){const e=this.ne,n=e.layerScene.baseUrl,i=this.re.children,o=[],s={};if(i)for(let a=0;a<i.length;a++)if(this.te<=1.6){const h=i[a].id;if(e[h])continue;const l=h;s[l]||(s[l]=new Promise((i=>{let o=n+"/nodes/"+l;e.layerScene.eslpk&&(o+="/3dNodeIndexDocument.json"),this.Qt(this.H,o,(()=>{i()}))})),o.push(s[l]))}else{const h=i[a];if(e[h])continue;const l=Math.floor(h/e.nodesPerPage);s[l]||(s[l]=new Promise((i=>{let o=n+"/nodepages/"+l;e.layerScene.eslpk&&(o+=".json"),this.Qt(this.H,o,(()=>{i()}))})),o.push(s[l]))}return o.length?Promise.all(o).then((()=>this.ae())):this.ae()}ae(){return Promise.resolve(this.ce())}he(e){d$(this.ne,e)}ce(){return{asset:{i3s:!0,version:"1.0",gltfUpAxis:"Z"},geometricError:Number.MAX_VALUE,root:this.le(this.re,!0)}}le(e){const n=this.h.getRenderer(),i=this.ne.projection,o=!i||i&&4326===i.wkid,s=this.te,a=this.ne,h=e,l=h.obb,c=h.mbs,A={};let f;if(c)f=$v([],c[0],c[1],c[2]),o||(f=n.ue(f,f)),f=m$([],f[0],f[1],f[2]),A.sphere=[...f,c[3]];else if(l){f=$v([],l.center[0],l.center[1],l.center[2]),o||(f=n.ue(f,f)),f=m$([],f[0],f[1],f[2]);const e=function(e,n,i){const o=gv([],i);return o[0]=o[0]*n[0],o[1]=o[1]*n[0],o[2]=o[2]*n[0],o[3]=o[3]*n[1],o[4]=o[4]*n[1],o[5]=o[5]*n[1],o[6]=o[6]*n[2],o[7]=o[7]*n[2],o[8]=o[8]*n[2],[...e,...o]}(f,l.halfSize,l.quaternion);$v(p$,e[3]+e[6]+e[9],e[4]+e[7]+e[10],e[5]+e[8]+e[11]);const i=b_(p$);A.sphere=[...f,i]}let d=1/0,p=0;if(h.mbs?p=h.mbs[3]:h.obb&&(p=Math.max(Math.max(h.obb.halfSize[0],h.obb.halfSize[1]),h.obb.halfSize[2])),void 0!==h.lodThreshold)"maxScreenThresholdSQ"===a.lodSelectionMetricType?d=p/(Math.sqrt(h.lodThreshold)/(.25*Math.PI)):console.error("Unsupported lodSelectionMetricType in Layer");else if(void 0!==h.lodSelection)for(let e=0;e<h.lodSelection.length;e++)"maxScreenThreshold"===h.lodSelection[e].metricType&&(d=p/h.lodSelection[e].maxError);(d===1/0||isNaN(d))&&(d=1e5);const g=16*d,v=xv([]),w=h.children;let C;if(w){C=[];const e=this.ne;for(let n=0;n<w.length;n++){const i=s<=1.6?w[n].id:w[n];if(!e[i]){C=null;break}C.push(this.le(e[i]))}}const P={refine:"REPLACE",boundingVolume:A,transform:v,geometricError:g};return s<=1.6?e.lodSelection?e.geometryData&&(P.content={uri:"i3s:mesh:"+(e.id||e.index)}):P.content={uri:"i3s:tileset:"+(e.id||e.index)}:w&&w.length&&!C?P.content={uri:"i3s:tileset:"+(e.id||e.index)}:h.mesh&&(P.content={uri:"i3s:mesh:"+(e.id||e.index)}),C&&C.length&&(P.children=C),P}getJSON(){return this.re}};function m$(e,n,i,o){return tJ(e,vY(n),vY(i),o)}const y$=!!f$.ktx2,v$=xv([]),_$=(()=>{try{if("object"==typeof WebAssembly&&"function"==typeof WebAssembly.instantiate){const e=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(e instanceof WebAssembly.Module)return new WebAssembly.Instance(e)instanceof WebAssembly.Instance}}catch(e){}return!1})();function x$(e){return e.indexOf("i3s:mesh")>=0}function b$(e,n,i,o,s){const a=n.layerScene.eslpk,h=function(e,n){const i=n.substring(9);return e>=1.7?parseInt(i):i}(n.version,e),l=n[h],c=n.layerScene.baseUrl,A=[];let f=!1;const d=v$;let p,g;if(n.version<=1.6){if(!l.geometryData)return null;const e=l.geometryData.length;if(!e)return null;let i=c+`/nodes/${l.id}/`+l.geometryData[e-1].href;a&&(i+=".bin");const o={geometry:{url:i,info:n.layerScene.store.defaultGeometrySchema}};let s=l.textureData&&l.textureData[0]&&l.textureData[0].href;if(s){const e=n.layerScene.store.textureEncoding[0];let i;i="image/jpeg"===e?"jpg":"png",a&&(s+="."+i);o.material={pbrMetallicRoughness:{baseColorTexture:{url:c+`/nodes/${l.id}/`+s,factor:1,format:i,mimeType:e},metallicFactor:0}}}A.push(o)}else{p=l.mesh.geometry,g=l.mesh.material;const e=(n.layerScene.store||{}).textureEncoding,h=n.layerScene.geometryDefinitions[p.definition],{geometryBuffers:d}=h;f=o&&2===d.length;let v=c+`/nodes/${p.resource}/geometries/`+(f$.draco&&f?1:0);a&&(v+=".bin");const w={geometry:{url:v,info:f$.draco&&f?d[1]:d[0]}};if(s&&_$&&f&&!f$.draco)throw new Error("Must import @maptalks/transcoder.draco to load i3s draco compressed geometry");const C=n.layerScene.materialDefinitions;let P,T=0;g&&(T=C[g.definition]),P=C?function(e,n,i,o,s,a,h){const l=JSON.parse(JSON.stringify(n));return w$(e,l,i,o,s,a,h),l}(e,T,n.layerScene.textureSetDefinitions,c,g.resource,i,n.layerScene.eslpk):{pbrMetallicRoughness:{metallicFactor:0}},w.material=P,A.push(w)}return{dracoCompression:f,meshes:A,nodeIndex:h,center:l.obb&&l.obb.center||l.mbs&&[l.mbs[0],l.mbs[1],l.mbs[2]],transform:d}}function w$(e,n,i,o,s,a,h){for(const l in n)if(n[l]&&n[l].textureSetDefinitionId>=0){const c=i[n[l].textureSetDefinitionId],A="images/"+c.formats[0].format,f=P$(c.formats,a,e),d={url:o+`/nodes/${s}/textures/${f.name}`,factor:void 0===n[l].factor?1:n[l].factor,format:f.format,mimeType:A};if(h){let e="";switch(f.format){case"dds":e="bin.dds";break;case"jpg":case"png":e=f.format}d.url+="."+e}n[l]=d}else mY(n[l])&&w$(e,n[l],i,o,s,a,h)}const C$={"image/jpeg":"jpg","image/jpg":"jpg","image/png":"jpg","image/vnd-ms.dds":"dds","image/ktx":"jpg"};function P$(e,n,i){if(i&&i.length){const n=i[i.length-1],o=C$[n];if(o){for(let n=0,i=e.length;n<i;n++)if(e[n].format===o)return e[n]}else console.error("i3s not find texture format type from:",C$,"current textureEncoding:",n)}for(let i=0;i<=e.length;i++){const o=e[i].format;if("dds"===o&&n.hasExtension("WEBGL_compressed_texture_s3tc"))return e[i];if("jpg"===o||"png"===o)return e[i];if("ktx2"===o&&y$)return e[i]}return null}const M$=new Zh(0,0),T$=new Zh(0,0),S$=new Set,I$=[],E$=new class{constructor(e,n){this.max=e,this.currentSize=0,this.data=new Map,this.onRemove=n}reset(e){if(this.data){const n=this.data.keys();for(const i of n){const n=this.data.get(i);e&&e!==n.renderer||this.fe(i,n)}}return e||(this.data=new Map,this.currentSize=0),this}clear(e){this.reset(e)}add(e,n){if(!n)return this;if(n.node&&n.node.memorySize&&(this.currentSize+=n.node.memorySize),this.has(e)){const i=this.data.get(e);i&&i.node&&i.node.memorySize&&(this.currentSize-=i.node.memorySize),this.data.delete(e),this.data.set(e,n)}else this.data.set(e,n);return this}shrink(){if(this.currentSize>this.max){let e=!1;const n=this.data.keys();let i=n.next();for(;this.currentSize>this.max&&void 0!==i.value;){!e&&this.data.get(i.value).current&&(e=!0,console.warn(`current maxGPUMemory(${this.max/1024/1024}) for Geo3DTilesLayer is not enough, one or more current tiles will be discarded.`));const o=this.getAndRemove(i.value);o&&this.onRemove(o),i=n.next()}}}has(e){return this.data.has(e)}keys(){const e=new Array(this.data.size);let n=0;const i=this.data.keys();for(const o of i)e[n++]=o;return e}getAndRemove(e){if(!this.has(e))return null;const n=this.data.get(e);return n.node&&n.node.memorySize&&(this.currentSize-=n.node.memorySize),this.data.delete(e),n}get(e){if(!this.has(e))return null;const n=this.data.get(e);return this.data.delete(e),this.data.set(e,n),n}remove(e){if(!this.has(e))return this;const n=this.data.get(e);return this.fe(e,n),this}fe(e,n){n.node&&n.node.memorySize&&(this.currentSize-=n.node.memorySize),this.data.delete(e),this.onRemove(n)}setMaxSize(e){return this.max=e,this.shrink(),this}getMemorySize(){let e=0;const n=this.data.values();for(const i of n){const n=i&&i.node;n&&n.memorySize&&(e+=n.memorySize)}return e}markAll(e,n){const i=this.data.values();for(const o of i)e&&o.renderer!==e||(o.current=n)}}(1024*(wt.mobile?32:1024)*1024,(e=>{const n=e.renderer;delete e.renderer,n.deleteTile(e)}));let O$=0,R$=class Ur extends(LO(Mm.CanvasRenderer)){constructor(e){super(e);const n=1024*e.options.maxGPUMemory*1024;n>E$.max&&E$.setMaxSize(n),this.tileCache=E$,O$++,this.tilesLoading={},this.de={},this.me=[],this.Qt=(...e)=>this.pe.call(this,...e)}getAnalysisMeshes(){if(!this.painter)return I$;const e=this.painter.getPaintedMeshes();if(!e)return I$;const n=[],{b3dmMeshes:i,pntsMeshes:o,i3dmMeshes:s}=e;return i.length&&EY(n,i.filter((e=>!(!e||!e.geometry)))),o.length&&EY(n,o.filter((e=>!(!e||!e.geometry)))),s.length&&EY(n,s.filter((e=>!(!e||!e.geometry)))),n}needToRedraw(){return!!this.getMap().isInteracting()||!!this.me.length||super.needToRedraw()}getFrameTimestamp(){return this.ge}drawOnInteracting(e,n,i){this.draw(n,i)}draw(e,n){this.ge=e;const i=this.prepareCanvas();if(i&&!i.intersects(this.canvasExtent2D))return void this.completeRender();const{root:o,tiles:s}=this.layer.getTiles();if(!s||!s.length)return void this.completeRender();this.painter.prepareRender(n),this.be(),this.ye(n);const{selectedTiles:a,leaves:h,requests:l}=this.we(o,s);l.length&&this.loadTiles(l),this.ve(a,h,n),this.Te(),l.length||this.completeRender()}we(e,n){let i=[];this._e();let o=0;const s=this.Me(),a={};let h=!1,l=!1;for(let e=0;e<n.length;e++){const s=n[e],c=s.node;if(a[c.id])continue;a[c.id]=1;let A=!1;const f=this.getCachedTile(c.id);(this.Oe(c.id)?(o++,A=l=!0,this.tilesLoading[c.id].current=!0):f?(this.getTileOpacity(f)<1&&(A=l=!0),h=!0,s.selected=!0,s.data=f):this.painter.has(c)||(A=l=!0,i.push(c)),A)&&((this.Ae(s)||this.xe(s).length)&&(h=!0))}let c=[],A={};if(h&&({selectedTiles:c,leaves:A}=this.Ie(e)),i.length>1&&(i.sort(D$),s)){const e=s-o;i=e>0?i.slice(0,e):[]}return{loading:l,requests:i,selectedTiles:c,leaves:A}}Ie(e){const n=[],i={};let o;const s=[e],a=[];for(;s.length>0||a.length>0;){if(a.length>0){const e=a[a.length-1];if(e.Se===s.length){a.pop(),e===o&&(e.leave=!0,i[e.node.id]=1),n.push(e);continue}}const e=s.pop(),h=e.children;if(e.selected)if("add"===e.node.refine)i[e.node.id]=1,e.selectionDepth=a.length,n.push(e);else{if(e.selectionDepth=a.length,o=e,0===h.length){e.leave=!0,i[e.node.id]=1,n.push(e);continue}a.push(e),e.Se=s.length}for(let e=0;e<h.length;e++)s.push(h[e])}return{selectedTiles:n,leaves:i}}Ae(e){if(!e.parent)return null;let n=e.parent;for(;n&&n.level>=0;){const e=n.node.id;if(this.tileCache.has(e))return n.selected=!0,n.data=this.tileCache.get(e),n;n=n.parent}return null}xe(e){const n=[];if(!e.node.children||!e.node.children.length)return n;const i=e.Ee+1,o=[e.node];for(;o.length>0;){const s=o.pop().children;for(let a=0,h=s.length;a<h;a++){if((!s[a].content||!s[a].content.url)&&s[a].children&&s[a].children.length){o.push(s[a]);continue}const h=s[a].id;if(this.tileCache.has(h)){const i=this.layer.Ce(s[a],e);i.selected=!0,i.data=this.tileCache.get(h),e.children.push(i),n.push(i)}else s[a].Ee<=i&&o.push(s[a])}}return n}ve(e,n,i){this.tileCache.markAll(this,!1);const o=[];for(let n=0,i=e.length;n<i;n++){const i=e[n].data;i.current=!0,i.renderer=this,this.tileCache.add(e[n].node.id,i);const s=i.node,a=this.layer.q(s.H);s.ft&&a.debug&&!Array.isArray(a.debug)&&o.push(s.ft)}const s=this.layer.options.services;for(let e=0;e<s.length;e++){const n=s[e],i=Array.isArray(n.debug)&&n.debug;if(i)for(const e of i){const n=this.layer.Dt(e),i=n&&n.node;i&&i.ft&&o.push(i.ft)}}const a={tiles:e,leaves:n};this.onDrawTileStart(a);const h=this.painter.paint(e,n,o,i);this.layer.fire("drawtiles",{count:h}),this.onDrawTileEnd(a),h&&this.layer.fire("canvasisdirty",{renderCount:h}),this.tileCache.shrink()}onDrawTileStart(){}onDrawTileEnd(){}loadTiles(e){for(let n=0,i=e.length;n<i;n++){const i=e[n];this.tilesLoading[i.id]={current:!0,node:i},this.loadTile(i)}}loadTile(e){let n=e.content.url;if(SY(n)){const i=IY(n);return this.Ne(n,i,e),null}if(function(e){return e.indexOf("i3s:tileset")>=0}(n)){const i=e.H;return new g$(n,i,this.ke[i],this.layer,this.Qt).load().then((i=>{this.onTilesetLoad(i,e,n)}))}return e&&kY(n)&&!x$(n)&&(n=e.baseUrl+n),this.Ne(n,null,e),null}Ne(e,n,i){let o=this.Re;o||(o=vw.getSupportedFormats(this.gl.gl||this.gl),this.Re=o);const s=this.layer.q(i.H);s.isSuperMapiServer&&(e=function(e,n){const i=e.substring(n.length).split("/"),o=[];for(let e=0;e<i.length;e++)o.push(encodeURIComponent(i[e]));return n+o.join("/")}(e,i.baseUrl));const a={url:this.layer.getTileUrl(e,this.layer.Le[i.H]),arraybuffer:n,rootIdx:i.H,upAxis:i.At,transform:i.matrix,supportedFormats:o};if(x$(e)){const n=this.ke[i.H];if(a.projection=n.projection,a.i3sInfo=b$(e,n,this.regl,this.layer.options.enableI3SCompressedGeometry,this.layer.options.forceI3SCompressedGeometry),!a.i3sInfo)return void this.onTileError({status:404},i,e)}a.service=pY({},s),s.offset&&delete a.service.offset,a.referrer=window&&window.location.href,this.workerConn.loadTile(this.layer.getId(),a,((n,o)=>{if(n)return void this.onTileError(n,i,e);const{magic:s}=o;"b3dm"===s||"pnts"===s||"i3dm"===s||"cmpt"===s||"gltf"===s?this.me.push({data:o,tile:i}):this.onTilesetLoad(o,i,e)}))}Ut(e){this.painter&&this.painter.Ut(e)}Ft(e){this.painter&&this.painter.Ft(e)}ye(){const e=this.getMap(),n=this.layer.options.meshLimitPerFrame;let i=0;for(;this.me.length&&(i<n||!e.isInteracting());){const{data:e,tile:n}=this.me.shift(),{magic:o}=e;"b3dm"===o||"gltf"===o?this.painter.createB3DMMesh(e,n.id,n,((i,{mesh:o})=>{this.Pe(e,n,i,o)})):"pnts"===o?this.painter.createPntsMesh(e,n.id,n,((i,{mesh:o})=>{this.Pe(e,n,i,o)})):"i3dm"===o?this.painter.createI3DMMesh(e,n.id,n,((i,{mesh:o})=>{this.Pe(e,n,i,o)})):"cmpt"===o&&this.painter.createCMPTMesh(e,n.id,n,((i,{mesh:o})=>{this.Pe(e,n,i,o)})),i++}}Pe(e,n,i,o){if(i)this.onTileError(i,n);else{const i=this.Be(o);n.memorySize=i,this.onTileLoad(e,n)}}Be(e){let n=0;if(Array.isArray(e))for(let i=0;i<e.length;i++)e[i]&&(n+=this.Be(e[i]));else e&&(n+=e.getMemorySize());return n}onTileLoad(e,n){this.layer&&(delete this.tilesLoading[n.id],this.layer.onTileLoad(e,n),this.Ue(n),this.setToRedraw(),this.layer.fire("tileload",{node:n}))}onTilesetLoad(e,n,i){this.layer&&(this.layer.zt=e.extensions&&e.extensions["s3m:VertexCompressionType"],e.capabilities||e.layers&&e.layers[0]&&e.layers[0].capabilities?this.De(e,n,i):(delete this.tilesLoading[n.id],this.layer.onTilesetLoad(e,n,i)))}onTileError(e,n,i){if(!this.layer)return;const o=i||n.content.url,s=e&&e.message||e;e&&(404===e.status||204===e.status)||S$.has(s)||(console.warn("failed to load 3d tile: "+o),console.warn(e),S$.add(s)),delete this.tilesLoading[n.id],(!this.layer.options.onlyCacheNoContentTileWhenError||e&&!Yo.isNoContentHttpCode(e.status))&&this.Fe(n,e),this.setToRedraw(),this.layer.fire("tileerror",{node:n,error:e})}getCachedTile(e){return this.tileCache.get(e)}getShadowMeshes(){if(!this.painter)return[];const e=[],n=this.painter.getCurrentB3DMMeshes();for(const i in n)n[i]&&n[i].isValid&&n[i].isValid()&&e.push(n[i]);const i=this.painter.getCurrentI3DMMeshes();for(const n in i)i[n]&&i[n].isValid&&i[n].isValid()&&e.push(i[n]);return e}Fe(e,n){const i={loadTime:Yo.now(),current:!0,error:n,node:e};i.renderer=this,this.tileCache.add(e.id,i)}Ue(e){const n={loadTime:Yo.now(),current:!0,node:e};n.renderer=this,this.tileCache.add(e.id,n)}abortTileLoading(e){if(!e||!this.workerConn)return;const n=e.node.content.url;this.workerConn.abortTileLoading(this.layer.getId(),n),delete this.de[n]}_e(){if(this.tilesLoading)for(const e in this.tilesLoading)this.tilesLoading[e].current=!1}deleteTile(e){this.painter.deleteTile(e)}createContext(){const e=this.layer,n=e.options.glOptions||{alpha:!0,depth:!0,stencil:!0,preserveDrawingBuffer:!0,antialias:e.options.antialias},i=this.canvas.gl&&this.canvas.gl.wrap;i?(this.gl=this.canvas.gl.wrap(),this.regl=this.canvas.gl.regl):(this.glOptions=n,this.gl=this.je(this.canvas,n)),this.regl=this.regl||jm({gl:this.gl,attributes:n,extensions:["OES_element_index_uint"],optionalExtensions:e.options.optionalExtensions||[]}),this.prepareWorker(),i&&(this.canvas.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height)),this.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height),this.painter=new l$(this.regl,e),this.layer.ze(),this.layer.fire("contextcreate",{regl:this.regl})}prepareWorker(){const e=this.getMap();this.workerConn||(this.workerConn=new NY("@maptalks/3dtiles",e.id,vw.supportNPOT(this.regl)));const n=this.workerConn;if(!n.isActive())return;let i=this.layer.options||{};i=pY({},i),delete i.offset;const o=e.options.spatialReference;i.projection=o&&o.coordType||o&&o.projection||e.getSpatialReference().getProjection().code;const s=this.layer.getId();n.addLayer(s,i,(e=>{if(e)throw e;this.layer&&(this.ready=!0,this.layer.fire("workerready"))}))}onRemove(){this.painter&&this.painter.remove(),this.pickingFBO&&(this.canvas.pickingFBO||this.pickingFBO.destroy(),delete this.pickingFBO),this.workerConn&&(this.workerConn.removeLayer(this.layer.getId(),(e=>{if(e)throw e})),this.workerConn.remove(),delete this.workerConn),O$--,O$||E$.reset(),this.clear(),delete this.tileCache,super.onRemove()}clear(){this.Te(!0),this.tileCache.reset(this),this.tilesLoading={},super.clear()}clearCanvas(){this.regl&&this.regl.clear({color:[0,0,0,0],depth:1,stencil:0}),super.clearCanvas()}getTileOpacity(){return 1}getStencilValue(){return 0}Te(e){this.qe||(this.qe=Date.now());const n=Date.now();if(!e&&n-this.qe<this.layer.options.retireInterval)return;this.qe=n;const i=[];for(const n in this.tilesLoading){const o=this.tilesLoading[n];!e&&o.current||(i.push(n),this.abortTileLoading(o))}for(let e=0;e<i.length;e++)delete this.tilesLoading[i[e]]}Me(){return this.getMap().isInteracting()?this.layer.options.loadingLimitOnInteracting:this.layer.options.loadingLimit}je(e,n){const i=["webgl","experimental-webgl"];let o=null;for(let s=0;s<i.length;++s){try{o=e.getContext(i[s],n)}catch(e){}if(o)break}return o}Oe(e){return!!this.tilesLoading[e]}getI3DMMeshes(){return this.painter.getI3DMMeshes()}getPNTSMeshes(){return this.painter.getPNTSMeshes()}getB3DMMeshes(){return this.painter.getB3DMMeshes()}readBatchData(e,n,i){return xJ(e,n,0,i)}be(){if(!this.He)return;const e=this.layer.options.i3sNodepageLimitPerFrame||Number.MAX_VALUE;let n=0;const i=[];for(const o in this.He){const s=this.He[o];if("pending"===s.status)continue;s.status="pending";const a=s.rootIdx,h=LY(this.layer.q(a).fetchOptions);if(i.push(yy.getJSON(o,h).then((e=>{delete this.He[o];const n=this.ke[a];if(n){e.nodes?d$(n,e.nodes):(n[e.id]=e,d$(n,e.children));for(let e=0;e<s.length;e++)s[e]();this.setToRedraw()}else this.setToRedraw()}))),n++,n>=e)break}i.length&&Promise.all(i)}pe(e,n,i){this.He||(this.He={}),this.He[n]=this.He[n]||[],this.He[n].rootIdx=e,this.He[n].push(i),this.setToRedraw()}De(e,n,i){this.ke||(this.ke=[]);const o=n.H;this.ke[o]||(this.ke[o]={});const s=this.ke[o],a=this.layer.q(o);e.layers&&(e=e.layers[0],"/"!==i[i.length-1]&&(i+="/"),i+="layers/0"),s.version=+(a.i3sVersion||e.store.version),!e.spatialReference||e.spatialReference.wkid&&4326===e.spatialReference.wkid||console.warn("i3s has a spatialReference other than 4326.",e.spatialReference),e.spatialReference&&4490===e.spatialReference.wkid&&(console.warn("i3s spatialReference is 4490,auto set spatialReference to 4326,This may cause some location issues, please ensure that your service is 4326"),e.spatialReference.wkid=4326),s.projection=e.spatialReference,function(e,n,i,o,s,a,h){if(!a.layerScene){a.layerScene=n,a.nodesPerPage=n.nodePages&&n.nodePages.nodesPerPage||64,a.lodSelectionMetricType=n.nodePages&&n.nodePages.lodSelectionMetricType;let e=s;if(a.layerScene.eslpk=e.indexOf("3dSceneLayer.json")>=0,e.endsWith(".json")){const n=s.lastIndexOf("/");e=n<0?"./":s.substring(0,n)}a.layerScene.baseUrl=function(e){return e.split("?")[0]}(e)}return new g$(s,i,a,e,h).load()}(this.layer,e,o,0,i,s,this.Qt).then((e=>{this.onTilesetLoad(e,n,i)}))}pick(e,n,i){if(!this.painter)return[];const o=this.pickingFBO,{width:s,height:a}=this.canvas;return!this.pickingFBO||o.width===s&&o.height===a||o.resize(s,a),this.painter.pick(e,n,i&&i.tolerance)}highlight(e){if(this.$||(this.$=[]),Array.isArray(e))for(let n=0;n<e.length;n++){const i=e[n].service||0;let o=this.$[i];o||(o=this.$[i]=new Map),o.set(e[n].id,e[n])}else{const n=e.service||0;let i=this.$[n];i||(i=this.$[n]=new Map),i.set(e.id,e)}this.painter.highlight(this.$)}cancelHighlight(e,n){if(!this.$)return;const i=this.$[e];if(i){if(Array.isArray(n))for(let e=0;e<n.length;e++)i.delete(n[e]);else i.delete(n);i.size||(this.$[e]=null),this.painter.highlight(this.$)}}cancelAllHighlight(){delete this.$,this.painter.cancelAllHighlight()}showOnly(e){if(this.X||(this.X=[]),Array.isArray(e))for(let n=0;n<e.length;n++){const i=e[n].service||0;let o=this.X[i];o||(o=this.X[i]=new Map),o.set(e[n].id,e[n])}else{const n=e.service||0;let i=this.X[n];i||(i=this.X[n]=new Map),i.set(e.id,e)}this.painter.showOnly(this.X)}cancelShowOnly(){delete this.X,this.painter.cancelShowOnly()}Zt(){return this.painter?this.painter.Zt():[]}ue(e,n){const i=this.getMap();if("identity"===i.getProjection().code.toLowerCase()){const i=this.Ge();return M$.set(n[0],n[1]),i.unproject(M$,T$),e[0]=T$.x,e[1]=T$.y,e}return M$.set(n[0],n[1]),i.getProjection().unproject(M$,T$),e[0]=T$.x,e[1]=T$.y,e}Ve(e,n){const i=this.Ge();return M$.set(n[0],n[1]),i.project(M$,T$),e[0]=T$.x,e[1]=T$.y,e}Je(e,n){const i=this.Ge();return M$.set(n[0],n[1]),i.unproject(M$,T$),e[0]=T$.x,e[1]=T$.y,e}Ge(){const e=this.getMap().options.spatialReference.coordType;if(!e)throw new Error("Missing coordType in map spatialReference.");return this.$e||(this.$e=fA.getProjectionInstance(e)),this.$e}};function D$(e,n){return e.ut-n.ut}function k$(e,n,i){return e[0]=n[i],e[1]=n[i+3],e[2]=n[i+6],e}const L$=[],F$=[],N$=[],z$=[],B$=[],H$=2*Math.PI;let j$=class $r{constructor(e,n,i,o){this.west=e,this.south=n,this.east=i,this.north=o}static contains(e,n){let i=n[0];const o=n[1],s=e.west;let a=e.east;return a<s&&(a+=H$,i<0&&(i+=H$)),(i>s||pJ(i,s,1e-14))&&(i<a||pJ(i,a,1e-14))&&o>=e.south&&o<=e.north}static southwest(e,n){return n[0]=e.west,n[1]=e.south,n[2]=0,n}static northeast(e,n){return n[0]=e.east,n[1]=e.north,n[2]=0,n}static southeast(e,n){return n[0]=e.east,n[1]=e.south,n[2]=0,n}static northwest(e,n){return n[0]=e.west,n[1]=e.north,n[2]=0,n}};const U$=[0,0,1];function G$(e,n){return tJ(n,e[0],e[1],e[2])}let V$=class Yr{constructor(e,n){this.normal=Kv([],e),this.distance=n}static fromPointNormal(e,n,i){const o=-u_(n,e);return Kv(i.normal,n),i.distance=o,i}};const W$=[],q$=[],Z$=[],Q$=[],X$=[],Y$=[],J$=[],K$=[],$$=[],t0=[],e0=new V$([1,0,0],0),n0=[];let i0=class hi{constructor(e){this.southwestCornerCartesian=[],this.northeastCornerCartesian=[],this.westNormal=[],this.eastNormal=[],this.southNormal=[],this.northNormal=[],this.rectangle=new j$(...e),this.minimumHeight=e[4],this.maximumHeight=e[5],this.computeBox(this.rectangle)}distanceToCamera(e,n){let i=0;if(!j$.contains(this.rectangle,n)){const n=this.northeastCornerCartesian,o=this.westNormal,s=this.southNormal,a=this.eastNormal,h=this.northNormal,l=e_(n0,e,this.southwestCornerCartesian),c=u_(l,o),A=u_(l,s),f=e_(n0,e,n),d=u_(f,a),p=u_(f,h);c>0?i+=c*c:d>0&&(i+=d*d),A>0?i+=A*A:p>0&&(i+=p*p)}const o=n[2],s=this.minimumHeight,a=this.maximumHeight;if(o>a){const e=o-a;i+=e*e}else if(o<s){const e=s-o;i+=e*e}return Math.sqrt(i)}computeBox(e){const n=this;G$(j$.southwest(e,q$),n.southwestCornerCartesian),G$(j$.northeast(e,q$),n.northeastCornerCartesian),W$[0]=e.west,W$[1]=.5*(e.south+e.north),W$[2]=0;const i=G$(W$,Z$),o=c_(X$,i,U$);l_(n.westNormal,o),W$[0]=e.east;const s=G$(W$,K$),a=c_(X$,U$,s);l_(n.eastNormal,a);const h=e_(X$,i,s),l=l_(Q$,h),c=e.south;let A;if(c>0){W$[0]=.5*(e.west+e.east),W$[1]=c;const i=G$(W$,$$);Kv(t0,l);const o=V$.fromPointNormal(n.southwestCornerCartesian,n.westNormal,e0);r0($$,t0,o,n.southwestCornerCartesian),A=AJ(i,Y$)}else A=fJ(j$.southeast(e,q$),Y$);const f=c_(J$,A,h);l_(n.southNormal,f);const d=e.north;let p;if(d<0){W$[0]=.5*(e.west+e.east),W$[1]=d;const i=G$(W$,$$);r_(t0,l,-1);const o=V$.fromPointNormal(n.northeastCornerCartesian,n.eastNormal,e0);r0($$,t0,o,n.northeastCornerCartesian),p=AJ(i,Y$)}else p=fJ(j$.northwest(e,q$),Y$);const g=c_(J$,h,p);l_(n.northNormal,g)}};function r0(e,n,i,o){const s=e,a=n,h=i.normal,l=u_(h,a);if(Math.abs(l)<1e-15)return;const c=(-i.distance-u_(h,s))/l;return c<0?void 0:t_(o=r_(o,a,c),s,o)}function o0(e){return[e.xmin,e.ymin,e.xmax,e.ymax]}const s0=ws,a0={services:[],maxGPUMemory:wt.mobile?32:1536,retireInterval:2e3,loadingLimitOnInteracting:5,loadingLimit:10,debug:!1,meshLimitPerFrame:1,i3sNodepageLimitPerFrame:1,enableI3SCompressedGeometry:!0,forceI3SCompressedGeometry:!0,onlyCacheNoContentTileWhenError:!0,picking:!0,pickingPoint:!0,geometryEvents:!1,alwaysShowTopTiles:!0,antialias:!1,offset:[0,0],renderer:"gl",forceRenderOnZooming:!0,forceRenderOnRotating:!0,forceRenderOnMoving:!0,optionalExtensions:["ANGLE_instanced_arrays","OES_element_index_uint","OES_standard_derivatives","OES_vertex_array_object","OES_texture_half_float","OES_texture_half_float_linear","OES_texture_float","OES_texture_float_linear","WEBGL_depth_texture","EXT_shader_texture_lod","WEBGL_compressed_texture_astc","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb"]},h0=[0,0,0],l0=[0,0,0],u0=[0,0,0],c0=[0,0,0],A0=[0,0,0],f0=[0,0,0],d0=[0,0,0],p0=[1,1,1],g0=[1,1,1],m0=[0,0,0,0],y0=[],v0=new Zh(0,0),_0=new ee(0,0),x0=[0,0,0,0,0,0,0,0,0],b0=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],w0=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],C0=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],P0=new ee(0,0),M0=xv([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),T0=[0,0],S0=[0,0,0],I0=[1,1,1],E0=[0,0,0],O0=[0,0,0],R0=[0,0,0,0],D0=[1,1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1];let k0=class ji extends(uR(RA)){static fromJSON(e){return e&&"Geo3DTilesLayer"===e.type?new ji(e.id,e.options):null}static getEnuTransform(e,n=[1,1,1],i=[0,0,0]){const o=tJ([],e[0]*Math.PI/180,e[1]*Math.PI/180,e[2]||0),s=HJ(o,null,[]),a=zv([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Ax([0,0,0,0],...i),[0,0,0],n);return Cv(a,s,a)}constructor(e,n){super(e,n),this.isGeo3DTilesLayer=!0,this.Ke(),this.Xe=[]}Ke(){const e=this.options.services.map((e=>e.url));this.Ye=this.Ye||{},this.Le=this.Le||[];for(let n=0;n<e.length;n++){const i=e[n];let o=this.Ye[i];void 0===o&&(o=this.Ye[i]=this.Le.length),this.Le[o]=N0(i,o,this.options.services[n])}this.fire("rootready",{roots:this.Le.slice(0)})}showService(e){return this.updateService(e,{visible:!0}),this}hideService(e){return this.updateService(e,{visible:!1}),this}setToRedraw(){return this.Ze(),this}addService(e){return this.options.services=this.options.services||[],this.options.services.push(e),this.Ke(),this.Ze(),this}updateService(e,n){if(!n)return this;const i=this.options.services;let o=!1;i&&i[e]&&(o=!(H0(i[e].coordOffset,n.coordOffset)&&H0(i[e].heightOffset,n.heightOffset)&&H0(i[e].scale,n.scale)&&H0(i[e].rotation,n.rotation)),pY(i[e],n));const s=this.Le&&this.Le[this.Ye[i[e].url]];return s&&(dY(n.visible)||(s.visible=n.visible),o&&s.version++),this.Ze(),this}removeService(e){const n=this.options.services;if(n&&n[e]){const i=n[e].url,o=this.Ye[i];this.Le[o]&&(this.Le[o]=null),delete this.Ye[i],n.splice(e,1)}return this.Ze(),this}getTileUrl(e,n){const i=n&&n.service&&n.service.subdomains;if(i&&n.domainKey){const o=i.length;if(o){const s=[...e].reduce(((e,n)=>e+n.charCodeAt(0)),0)%o;return e.replace(n.domainKey,i[s])}}return e}getExtent(e){if(!e&&0!==e){const e=new al;for(let n=0;n<this.Le.length;n++){const i=this.Le[n];if(i&&i.boundingVolume){const n=this.boundingVolumeToExtent(i);e._combine(n)}}return e}const n=this.Le[e];return n&&n.boundingVolume?this.boundingVolumeToExtent(n):null}boundingVolumeToExtent(e){const n=e.boundingVolume.We?M0:e.matrix,i=this.getMap(),o="identity"===i.getProjection().code.toLowerCase(),s=this.getRenderer();if(e.boundingVolume.region){const n=e.boundingVolume.region;return new al(_Y(n[0]),_Y(n[1]),_Y(n[2]),_Y(n[3]))}if(e.boundingVolume.sphere){const a=e.boundingVolume.sphere,h=sJ([],A_([0,0,0],a,n));o&&s.Ve(h,h);const l=a[3],c=i.locate(h,-l,l),A=i.locate(h,l,-l);return new al(c,A)}if(e.boundingVolume.box){const a=e.boundingVolume.box,h=A_([0,0,0],a,n),l=new Zh(sJ([],h));o&&s.Ve(l,l);const c=a.slice(3);dv(c,uv([0,0,0,0,0,0,0,0,0],e.matrix),c);const A=Yv(c.slice(0,3)),f=Yv(c.slice(3,6)),d=Yv(c.slice(6,9)),p=Math.max(A,f,d),g=i.locate(l,-p,p),v=i.locate(l,p,-p);return new al(g,v)}return null}getRootTiles(){return this.Le}getTiles(){const e=this.getRenderer();if(!e.ready)return this.Ze(),{tiles:y0};const n=this.getMap(),i=n.cameraPosition,o=n.pointAtResToDistance(i[2],0,n.getGLRes()),s=this.Qe(i);this.tn=this.tn||[0,0,0],$v(this.tn,vY(s.x),vY(s.y),o),this.nn=tJ(this.nn||[],this.tn[0],this.tn[1],this.tn[2]),this.rn=2*Math.tan(.5*vY(n.getFov()));const a=n.projViewMatrix;let h;if(n.getPitch()<=80){const e=n.getExtent(),i=e.getWidth()/2,o=e.getHeight()/2;e.xmin-=i,e.ymin-=o,e.xmax+=i,e.ymax+=o,h=o0(e)}const l=(this.getMasks()||[]).filter((e=>e&&e instanceof ClipOutsideMask));l.forEach((e=>{if(!e.maskGeoJSON&&e.toGeoJSON)try{e.maskGeoJSON=e.toGeoJSON();const n=e.getExtent();e.maskGeoJSON.bbox=o0(n)}catch(e){console.error(e)}}));const c={children:[],level:-1};let A=c;const f=[];for(let n=0;n<this.Le.length;n++){const i=this.Le[n];if(!i||!i.visible)continue;const o=i.service,s=[i],c=this.sn(n);for(;s.length>0;){const n=s.pop();for(n.id||this.an(n);A.level>=n.Ee;)A=A.parent;const i=this.cn(n,c,a,h,l);if(n.service=o,!(i===j0.VISIBLE||i!==j0.OUT_OF_FRUSTUM&&this.options.alwaysShowTopTiles&&B0(n))){let e=A;for(;e&&!e.content;)e=e.parent;i===j0.SCREEN_ERROR_TOO_SMALL&&e&&e.content&&this.hn(f,e);continue}n.ut<1/0&&this.ln(n);const d=this.Ce(n,A);A.children.push(d);const p=n.children,g=p&&p.length,v=d.content;if(v&&(!g||i===j0.SCREEN_ERROR_TOO_SMALL)&&this.hn(f,d),i!==j0.SCREEN_ERROR_TOO_SMALL&&g){v&&"add"===n.refine&&this.hn(f,d),A=d;const i=p[0].parent;let o=!1;for(let a=0,h=p.length;a<h;a++){if(i){const n=e.getCachedTile(p[a].id);if(n&&n.error&&404!==n.error.status)continue;o=!0}else{o=!0,p[a].parent=n,p[a].At=n.At,p[a].baseUrl=n.baseUrl;const e=p[a].content&&(p[a].content.url||p[a].content.uri);e&&(SY(e)||e.indexOf("i3s:")>=0?p[a].baseUrl=n.baseUrl:kY(e)?p[a].content.url=n.baseUrl+e:p[a].baseUrl=e.substring(0,e.lastIndexOf("/")+1))}s.push(p[a])}!o&&v&&this.hn(f,d)}}}return{root:c,tiles:f}}hn(e,n){const{viewerRequestVolume:i,matrix:o}=n.node;i&&!function(e,n,i,o){if(i.region){const n=i.region;if(e[0]>=n[0]&&e[0]<=n[2]&&e[1]>=n[1]&&e[1]<=n[3])return!0}else{if(i.sphere)return L0(i,n,o)<=0;if(i.box)return 0===F0(i,n,o)}return!1}(this.tn,this.nn,i,o)||e.push(n)}Ce(e,n){return{id:e.id,node:e,children:[],level:e.Ee,parent:n,content:e.content&&e.content.url}}an(e){const n=this.getId();e.id=n+":"+Yo.GUID(),e.matrix=e.transform||xv([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),e.un=this.dn(e),e.parent&&(function(e){return e.content&&e.content.uri&&e.content.uri.indexOf("i3s:")>=0}(e)||(e.matrix=Cv(e.matrix,e.parent.matrix,e.matrix)),e.H=e.parent.H,void 0===e.Ee&&(e.Ee=e.parent.Ee+1),e.maxExtent=e.parent.maxExtent),e.refine=e.refine&&e.refine.toLowerCase()||"replace",e.content&&!e.content.url&&e.content.uri&&(e.content.url=e.content.uri)}q(e){return this.Le[e].service}mn(e){const n=e.boundingVolume;if(!n||n.We&&!this.pn(e))return;const i=this.q(e.H),o=i.heightOffset||0,s=this.options.offset,a=gY(s)||s[0]||s[1],h=i.coordOffset||T0;if(!Array.isArray(h))throw new Error("service.coordOffset must be an array");if(!n.We&&(!e.boundingVolume||!o&&qv(e.matrix,M0)&&!a&&h===T0))return;n.box&&n.region&&delete n.region;const{region:l,box:c,sphere:A}=n;if(n.coordOffset=[h[0],h[1]],n.heightOffset=o,l){n.originalVolume||(n.originalVolume=l.slice(0));const e=n.originalVolume,i=this.gn([_Y(e[0]),_Y(e[1])]);l[0]=vY(i.x+h[0]),l[1]=vY(i.y+h[1]);const s=this.gn([_Y(e[2]),_Y(e[3])]);l[2]=vY(s.x+h[0]),l[3]=vY(s.y+h[1]),l[4]=e[4]+o+(h[2]||0),l[5]=e[5]+o+(h[2]||0)}else if(c||A){n.originalVolume||(n.originalVolume=(c||A).slice(0));const i=c||A,s=A_(h0,n.originalVolume,e.matrix),a=sJ(l0,s),l=this.gn([a[0]+h[0],a[1]+h[1]]);a[0]=l.x,a[1]=l.y,a[2]+=o+(h[2]||0),tJ(i,vY(a[0]),vY(a[1]),a[2])}n.We=!0;try{e.extent=this.boundingVolumeToExtent(e)}catch(e){console.error(e)}}pn(e){const n=e.boundingVolume,i=this.q(e.H),o=i.coordOffset||T0;return n.coordOffset[0]!==o[0]||n.coordOffset[1]!==o[1]||n.heightOffset!==(i.heightOffset||0)}dn(e){return void 0===e.geometricError||!e.boundingVolume}ln(e){let n=e.parent;for(;n&&n.un&&!(n.ut<=e.ut);)n.ut=e.ut,n=e.parent}onTileLoad(e,n){if(e.children&&(!n.children||!n.children.length)){n.children=e.children;const i=n.content.url;n.baseUrl=i.substring(0,i.lastIndexOf("/")+1),this.Ze()}}onTilesetLoad(e,n,i){if(!e)return void console.warn("invalid tileset at : "+i);const o=(e.asset&&e.asset.gltfUpAxis||n&&n.At||"Y").toUpperCase();e.root.baseUrl=i.substring(0,i.lastIndexOf("/")+1);const s=i.indexOf("realspace/")>-1;0===n.Ee&&e.asset&&e.asset.s3mType&&s&&(e.root.baseUrl+="data/path/");const a=e.asset.i3s;if(e.root.At=o,n){const i=n.boundingVolume;pY(n,e.root),n.refine=n.refine&&n.refine.toLowerCase()||"replace",i&&(n.boundingVolume=i);const o=e.root.transform||xv([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);if(n.parent)a||(n.matrix=Cv([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n.parent.matrix,o));else{const e=this.q(n.H);n.matrix=e.ecefTransform?Cv([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e.ecefTransform,o):o}delete n.content,e.root.content&&(n.content=e.root.content),n.un=this.dn(n);const s=n.content&&(n.content.url||n.content.uri);s&&n.content.uri&&(n.content.url=n.content.uri,delete n.content.uri),!a&&s&&!SY(s)&&kY(s)&&(n.content.url=n.baseUrl+s),e.root&&!n.parent&&this.bn(n)}this.Ze(),this.fire("loadtileset",{tileset:e,index:n&&n.H,url:i})}yn(e,n,i){if(!e.extent||!s0)return!0;const o=e.extent;if(R0[0]=o.xmin,R0[1]=o.ymin,R0[2]=o.xmax,R0[3]=o.ymax,n&&!s0.bboxIntersect(R0,n))return!1;if(i.length){for(let e=0,n=i.length;e<n;e++){const n=i[e].maskGeoJSON;if(!n||!n.bbox||s0.bboxInMask(R0,n))return!0}return!1}return!0}cn(e,n,i,o,s){if(!this.yn(e,o,s))return j0.OUT_OF_FRUSTUM;if(e.ut=1/0,0===e.Ee||e.un)return this.bn(e),j0.VISIBLE;if(this.mn(e),!this.wn(e,n,i))return j0.OUT_OF_FRUSTUM;if(0===e.geometricError)return j0.VISIBLE;let a=this.q(e.H).maximumScreenSpaceError;null==a&&(a=16);let h=this.vn(e);return 0===h&&e.parent&&(h=.5*(e.parent.Tn||0)),h>=a?j0.VISIBLE:j0.SCREEN_ERROR_TOO_SMALL}Xt(e,n){n||(n=new ee(0,0));const i=this.getMap();return i.coordToPointAtRes(e,i.getGLRes(),n)}wn(e,n,i){const o=e.id;let s=this.Xe[o];const{boundingVolume:a}=e,h=a.region,l=a.box,c=a.sphere,A=this._n(e.H),f=this.getRenderer();return s&&s.version===A.version||(h?s=this.Xe[o]=this.Mn(e):l?s=this.Xe[o]=this.On(e):c&&(s=this.Xe[o]=this.An(e)),s.version=A.version,e.ft&&(f.Ft(e.ft),delete e.ft)),this.q(e.H).debug&&(this.Xe[o].node=e,f.Ut(e)),s.obbox?function(e,n,i){bX(e);for(var o=0;o<6;o++)if(!xX(hX[o],n))return!1;return!0}(i,s.obbox):!!c&&function(e,n,i){bX(e);for(var o=n[0],s=-n[1],a=0;a<6;a++)if(CX(hX[a],o)<s)return!1;return!0}(i,s.sphereBox)}Mn(e){const n=this.getMap(),i=n.getGLRes(),o=e.boundingVolume.region;let{ws:s,en:a}=function(e){const n=e[2],i=e[3],o=e[5],s=tJ([],e[0],e[1],e[4]),a=tJ([],n,i,o);return{ws:sJ(s,s),en:sJ(a,a)}}(o);s=new Zh(s),a=new Zh(a);const h=n.coordToPointAtRes(s,i);h.z=n.altitudeToPoint(s.z,i);const l=n.coordToPointAtRes(a,i);l.z=n.altitudeToPoint(a.z,i);const c=[l.x,h.y,l.z,l.x,l.y,l.z,h.x,l.y,l.z,h.x,h.y,l.z,l.x,h.y,h.z,l.x,l.y,h.z,h.x,l.y,h.z,h.x,h.y,h.z],A=[(c[0]+c[18])/2,(c[1]+c[19])/2,(c[2]+c[20])/2],f=this._n(e.H);e!==f||f.xn||(f.xn=A);const d=this.Jt([],e),p=qv(M0,d);if(!p){A_(A,A,d);const e=h0;for(let n=0;n<c.length;n+=3){let i=$v(e,c[n],c[n+1],c[n+2]);p||(i=A_(i,i,d)),c[n]=i[0],c[n+1]=i[1],c[n+2]=i[2]}}const g=n.pointAtResToCoord(new ee(A),i);g.z=(s.z+a.z)/2;const v=this.In(c,A);for(let e=0;e<c.length;e++)c[e]-=A[e%3];return{obbox:v,boxPosition:c,boxCenter:A,boxCoord:g}}On(e){const n=this.getRenderer(),i=this.getMap(),o="identity"===i.getProjection().code.toLowerCase(),s=i.getGLRes(),{boxCenter:a,boxCoord:h}=this.Sn(e),l=e.boundingVolume.box,c=function(e,n,i,o,s,a,h,l,c,A,f,d,p,g,v,w,C){return e[0]=n||0,e[1]=a||0,e[2]=A||0,e[3]=0,e[4]=i||0,e[5]=h||0,e[6]=f||0,e[7]=0,e[8]=o||0,e[9]=l||0,e[10]=d||0,e[11]=0,e[12]=s||0,e[13]=c||0,e[14]=p||0,e[15]=1,e}([],(A=this.En(l,e.matrix))[0],A[3],A[6],(f=l)[0],A[1],A[4],A[7],f[1],A[2],A[5],A[8],f[2]);var A,f;const d=this.Jt([],e),p=qv(M0,d);p||A_(a,a,d);const g=[],v=h0;for(let e=0;e<D0.length;e+=3){v[0]=D0[e],v[1]=D0[e+1],v[2]=D0[e+2],A_(v,v,c),sJ(v,v),o&&n.Ve(v,v);const a=v0.set(v[0],v[1],v[2]);i.coordToPointAtRes(a,s,_0);let h=$v(v,_0.x,_0.y,i.altitudeToPoint(a.z,s));p||(h=A_(h,h,d)),g[e]=h[0],g[e+1]=h[1],g[e+2]=h[2]}const w=this.In(g,a);for(let e=0;e<g.length;e++)g[e]-=a[e%3];return{obbox:w,boxPosition:g,boxCenter:a,boxCoord:h}}An(e){const n=this.getMap(),i=this.getRenderer(),o="identity"===n.getProjection().code.toLowerCase(),s=e.boundingVolume.sphere;let a=h0;0===s[0]&&0===s[1]&&0===s[2]?a=[0,0,-6378137]:sJ(a,s),o&&i.Ve(a,a);const h=new Zh(a),l=this.Xt(h,_0).toArray();l[2]=n.altitudeToPoint(h.z,n.getGLRes());const c=this.Cn(h);return{boxCenter:l,boxCoord:h,sphereBox:[l,s[3]*c[2]]}}In(e,n){const i=z0(A0,e,0,1,4,5),o=z0(f0,e,0,3,4,7),s=z0(d0,e,0,1,2,3);return[...n,...m_(h0,i,n),...m_(l0,o,n),...m_(u0,s,n)]}Sn(e){const n=this.getMap(),i=this.getRenderer(),o="identity"===n.getProjection().code.toLowerCase(),s=n.getGLRes(),a=e.boundingVolume.box.slice(0,3);sJ(a,a),o&&i.Ve(a,a);const h=new Zh(a),l=n.coordToPointAtRes(h,s);return{boxCenter:[l.x,l.y,n.altitudeToPoint(h.z,s)],boxCoord:h}}Jt(e,n){const i=this._n(n.H),o=this.q(n.H),s=i.xn,a=Ov(b0,$v(h0,-s[0],-s[1],-s[2])),h=Ov(w0,s),l=Ax(m0,...o.rotation||S0),c=o.scale;let A;A=Array.isArray(c)?$v(E0,c[0],c[1],c[2]):c&&$v(E0,c,c,c)||I0;return e=Cv(e,zv(C0,l,O0,A),a),Cv(e,h,e)}bn(e){const n=this.q(e.H);if(!e.boundingVolume||this.Nn(e,n))return;const i=e.boundingVolume.region,o=e.boundingVolume.sphere;let s=null;e.boundingVolume.box?s=this.kn(e).boxCenter:i?s=this.Rn(e).boxCenter:o&&(s=this.An(e).boxCenter);const a=n.heightOffset||0,h=n.coordOffset||[0,0];e.Ln=[h[0]||0,h[1]||0],e.Pn=a,e.xn=s}Nn(e,n){if(!e.Ln)return!1;const i=n.coordOffset||T0;return e.Ln[0]===i[0]&&e.Ln[1]===i[1]&&e.Pn===(n.heightOffset||0)}Rn(e){return this.mn(e),this.Mn(e)}kn(e){return this.mn(e),this.Sn(e)}En(e,n){let i=e.slice(3,12);return i=dv(i,uv(x0,n),i),i}Cn(e){const n=this.getMap(),i=n.distanceToPointAtRes(100,100,n.getGLRes(),e);let o;return o=n.altitudeToPoint?n.altitudeToPoint(100,n.getGLRes())/100:i.y/100,$v(p0,i.x/100*1.01,i.y/100*1.01,o),p0}gn(e){Array.isArray(e)&&(e=new Zh(e));let n=this.options.offset;if(gY(n)&&(n=n.call(this,Array.isArray(e)?new Zh(e):e)),n[0]||n[1]){const i=this.getMap(),o=i.getGLRes(),s=i.coordToPointAtRes(e,o);return _0.set(n[0],n[1]),s._sub(_0),i.pointAtResToCoord(s,o)}return e}_n(e){return this.Le[e]}sn(e){const n=this.q(e).maxExtent;if(!n)return null;const i=this.Le[e];return i.maxExtent||(i.maxExtent=new al(n).convertTo((e=>this.Xt(e)))),i.maxExtent}vn(e){const n=this.rn,i=e.geometricError;if(0===i)return e.Tn=0,0;const o=this.q(e.H);let s=o.scale||1;if(Array.isArray(s)&&(s=Yv(s)),o.ecefTransform){const e=Fv(g0,o.ecefTransform);s*=b_(e)}const a=this.getMap();let h;e.boundingVolume.region?h=function(e,n,i){return e.Bn||(e.Bn=new i0(e.boundingVolume.region)),e.Bn.distanceToCamera(n,i)}(e,this.nn,this.tn):e.boundingVolume.sphere?h=L0(e.boundingVolume,this.nn):e.boundingVolume.box&&(h=F0(e.boundingVolume,this.nn));const l=Math.max(Math.abs(h),1e-7),c=i*s*a.height/(l*n);return e.ut=h,e.Tn=c,c}Ze(){const e=this.getRenderer();e&&e.setToRedraw()}Dt(e){return this.Xe[e]}identify(e,n={}){const i=this.getMap(),o=this.getRenderer();if(!i||!o)return[];Array.isArray(e)&&(e=new Zh(e));const s=i.coordToContainerPoint(e);return this.identifyAtPoint(s,n)}identifyAtPoint(e,n={}){const i=[];if(!n.excludeMasks){const o=this.identifyMask(e,n);o&&o.length&&EY(i,o)}const o=this.getMap(),s=this.getRenderer();if(!o||!s)return[];const a=o.getDevicePixelRatio();return EY(i,s.pick(e.x*a,e.y*a,n)),n&&n.filter&&!n.excludeMasks?i.filter((e=>n.filter(e))):i}getCurrentBatchIDs(){const e=this.getMap(),n=this.getRenderer();return e&&n?n.Zt():[]}highlight(e){const n=this.getRenderer();return Array.isArray(e)||(e=[e]),n?(n.highlight(e),this):(this.$||(this.$=[]),this.$.push(e),this)}ze(){if(this.$){for(let e=0;e<this.$.length;e++)this.highlight(this.$[e]);delete this.$}}cancelHighlight(e,n){const i=this.getRenderer();return i?(i.cancelHighlight(e,n),this):this}cancelAllHighlight(){const e=this.getRenderer();return e?(e.cancelAllHighlight(),this):this}showOnly(e){const n=this.getRenderer();return n?(n.showOnly(e),this):(this.X||(this.X=[]),this.X.push(e),this)}Un(){if(this.X){for(let e=0;e<this.X.length;e++)this.showOnly(this.X[e]);delete this.X}}cancelShowOnly(e){const n=this.getRenderer();return n?(n.cancelShowOnly(e),this):this}setServiceOpacity(e,n){const i=this.options.services[e];return i&&(i.opacity=n),this.getRenderer()?(this.Ze(),this):this}setServiceDebug(e,n){const i=this.options.services[e];return i&&(i.debug=n),this.getRenderer()?(this.Ze(),this):this}Qe(e){const n=this.getMap(),i=n.getGLRes();P0.set(e[0],e[1]);const o=n.pointAtResToCoord(P0,i);return"identity"===n.getProjection().code.toLowerCase()?(l0[0]=o.x,l0[1]=o.y,this.getRenderer().Je(h0,l0),o.set(h0[0],h0[1]),o):o}toJSON(){return{type:this.getJSONType(),id:this.getId(),options:this.config()}}};function L0(e,n,i){let o=e.sphere;i&&(o=A_([0,0,0],o,i));const s=__(o,n),a=e.sphere[3];return s<a?0:s-a}function F0(e,n,i){const o=e.box;let s=$v(h0,o[0],o[1],o[2]);return i&&(s=A_([0,0,0],s,i)),function(e,n,i){return Math.sqrt(function(e,n,i){const o=e_(L$,i,e),s=k$(F$,n,0),a=k$(N$,n,1),h=k$(z$,n,2),l=b_(s),c=b_(a),A=b_(h);l_(s,s),l_(a,a),l_(h,h);const f=B$;f[0]=u_(o,s),f[1]=u_(o,a),f[2]=u_(o,h);let d,p=0;return f[0]<-l?(d=f[0]+l,p+=d*d):f[0]>l&&(d=f[0]-l,p+=d*d),f[1]<-c?(d=f[1]+c,p+=d*d):f[1]>c&&(d=f[1]-c,p+=d*d),f[2]<-A?(d=f[2]+A,p+=d*d):f[2]>A&&(d=f[2]-A,p+=d*d),p}(e,n,i))}(s,cv(x0,o[3],o[4],o[5],o[6],o[7],o[8],o[9],o[10],o[11]),n)}function N0(e,n,i){const o=(e=xY(e)).indexOf("{s}")>=0?"{s}":e.indexOf("%7Bs%7D")>=0?"%7Bs%7D":null;return{version:0,un:!0,service:i,visible:!!dY(i.visible)||i.visible,baseUrl:e.substring(0,e.lastIndexOf("/"))+"/",content:{url:e},refine:"replace",matrix:xv([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),H:n,Ee:0,domainKey:o}}function z0(e,n,i,o,s,a){const h=$v(h0,n[3*i],n[3*i+1],n[3*i+2]),l=$v(l0,n[3*o],n[3*o+1],n[3*o+2]),c=$v(u0,n[3*s],n[3*s+1],n[3*s+2]),A=$v(c0,n[3*a],n[3*a+1],n[3*a+2]);return e[0]=(h[0]+l[0]+c[0]+A[0])/4,e[1]=(h[1]+l[1]+c[1]+A[1])/4,e[2]=(h[2]+l[2]+c[2]+A[2])/4,e}function B0(e){if(!e.content||e.hasParentContent)return!1;let n=e.parent;if(n&&(n.content||n.hasParentContent))return e.hasParentContent||(e.hasParentContent=!0),!1;for(;n;){if(n.content||n.hasParentContent)return e.hasParentContent||(e.hasParentContent=!0),!1;n=n.parent}return!0}function H0(e,n){return Array.isArray(e)&&Array.isArray(n)?2===e.length?sb(e,n):d_(e,n):e===n}var j0;k0.mergeOptions(a0),k0.registerRenderer("gl",R$),k0.registerJSONType("Geo3DTilesLayer"),function(e){e[e.OUT_OF_FRUSTUM=0]="OUT_OF_FRUSTUM",e[e.SCREEN_ERROR_TOO_SMALL=1]="SCREEN_ERROR_TOO_SMALL",e[e.VISIBLE=2]="VISIBLE"}(j0||(j0={}));let U0=null;function G0(){return U0||(U0={"image/crn":f$.crn&&f$.crn(),"image/ktx2":f$.ktx2&&f$.ktx2(),"image/cttf":f$.ktx2&&f$.ktx2(),draco:f$.draco&&f$.draco()}),U0}let V0=class Yi{constructor(e,n,i){this.Dn=e,this.Fn=n||zy,this.Re=i,this.jn=G0()}static createEmptyB3DM(){return{featureTable:null,batchTable:null,gltf:{}}}load(e,n,i=0,o=0,s){return n?(o||(o=n.byteLength),this.zn(e,n,i,o,s)):yy.getArrayBuffer(e,{}).then((n=>{const s=n.data;return o||(o=s.byteLength),this.zn(e,s,i,o)}))}zn(e,n,i,o,s){const a=s&&s.maxTextureSize,h=this.qn(n,i,o,e);if(h.error)return Promise.resolve(h);const l=e.substring(0,e.lastIndexOf("/"));let c;try{c=new this.Fn(l,h.glb,{transferable:!0,requestImage:this.Dn,decoders:this.jn,supportedFormats:this.Re,maxTextureSize:a})}catch(e){return Promise.resolve({error:e})}return c.load({skipAttributeTransform:!1}).then((n=>{n.url=`${e}-${i}-${o}`;const s=c.transferables;for(let e=0;e<h.transferables.length;e++)s.indexOf(h.transferables[e])<0&&s.push(h.transferables[e]);return{magic:"b3dm",count:h.count,transferables:s,featureTable:h.featureTable,batchTable:h.batchTable,batchTableBin:h.batchTableBin,gltf:n}}))}qn(e,n,i,o){const s=new DataView(e,n,i),a=s.getUint32(4,!0);if(1!==a){const e="Unsupported b3dm version: "+a+", url:"+o;return console.warn(e),{error:e}}if(s.getUint32(8,!0)!==s.byteLength){const e="Length in b3dm header is inconsistent with b3dm's byte length, url: "+o;return console.warn(e),{error:e}}let h,l=s.getUint32(12,!0),c=s.getUint32(16,!0),A=s.getUint32(20,!0),f=s.getUint32(24,!0),d=28+n;A>=570425344?(d-=8,h=l,A=c,f=0,l=0,c=0):f>=570425344&&(d-=4,h=A,A=l,f=c,l=0,c=0);const p=[e];let g,v,w;if(l>0?(g=yJ(e,d,l),d+=l,h=g.BATCH_LENGTH):g={BATCH_LENGTH:h},c>0&&(d+=c),A>0&&(v=vJ(e,d,A),d+=A,f>0)){const n=_J(0,d,f);w=e.slice(n.offset,n.offset+n.byteLength),d+=f,p.push(w)}const C=g.BATCH_LENGTH,P={};if(g&&g.BATCH_ID){P.BATCH_ID=bJ(g.BATCH_ID,e,(void 0).offset,C);const n=P.BATCH_ID.array&&P.BATCH_ID.array.buffer;n&&p.indexOf(n)<0&&p.push(n)}return{count:h,transferables:p,featureTable:g,batchTable:v,batchTableBin:w,b3dm:P,glb:{buffer:e,byteOffset:d,byteLength:s.byteLength+s.byteOffset-d}}}Hn(){return null}},W0=class Zi{constructor(e,n,i,o){this.Dn=e,this.Fn=n||zy,this.Re=i,this.jn=G0(),this.Gn=o}load(e,n,i=0,o=0,s){return n?(o||(o=n.byteLength),this.zn(e,n,i,o,s)):yy.getArrayBuffer(e,{}).then((n=>{const s=n.data;return o||(o=s.byteLength),this.zn(e,s,i,o)}))}zn(e,n,i,o,s){return this.Vn(e,n,i,o,s).then((({gltf:s,transferables:a})=>{const h=this.Jn(n,i,o,e);if(h.error)return Promise.resolve(h);for(let e=0;e<a.length;e++)-1===h.transferables.indexOf(a[e])&&h.transferables.push(a[e]);return delete s.transferables,Promise.resolve({magic:"i3dm",count:h.count,transferables:h.transferables,featureTable:h.featureTable,batchTable:h.batchTable,batchTableBin:h.batchTableBin,i3dm:h.i3dm,gltf:s})}))}Vn(e,n,i,o,s){const a={transferable:!0,requestImage:this.Dn,decoders:this.jn,supportedFormats:this.Re,maxTextureSize:s&&s.maxTextureSize},h=new DataView(n,i,o),l=32+h.getUint32(12,!0)+h.getUint32(16,!0)+h.getUint32(20,!0)+h.getUint32(24,!0);if(0===h.getUint32(28,!0)){let o=CY(new Uint8Array(n,l+i,h.byteLength-l));return-1==o.indexOf("://")&&(o=e.substring(0,e.lastIndexOf("/"))+"/"+o),o.indexOf(".glb")>0?yy.getArrayBuffer(o,{}).then((e=>this.$n(o,{buffer:e.data,byteOffset:0},a))):yy.getJSON(o,{}).then((e=>this.$n(o,e,a)))}return this.$n(e,{buffer:n,byteOffset:l+i,byteLength:h.byteLength-l},a)}$n(e,n,i){const o=e.substring(0,e.lastIndexOf("/")),s=new this.Fn(o,n,i);return s.load({skipAttributeTransform:!0}).then((i=>{let o=0,a=0;return n.buffer&&(o=n.byteOffset||0,a=n.byteLength||0),i.url=`${e}-${o}-${a}`,{transferables:s.transferables,gltf:i}}))}Jn(e,n,i,o){const s=new DataView(e,n,i),a=s.getUint32(4,!0);if(1!==a){const e="Unsupported pnts version: "+a+", url:"+o;return console.warn(e),{error:e}}if(s.getUint32(8,!0)!==s.byteLength){const e="Length in pnts header is inconsistent with pnts's byte length, url: "+o;return console.warn(e),{error:e}}const h=[e],{featureTable:l,featureTableBin:c,batchTable:A,batchTableBin:f}=EJ(s,32+n,h),d={},p=l.INSTANCES_LENGTH;if(l.POSITION){const{byteOffset:n}=l.POSITION;d.POSITION={byteStride:0,byteOffset:0,itemSize:3,count:p,componentType:5126,array:new Float32Array(e,n+c.offset,3*p).slice()},h.push(d.POSITION.array.buffer)}else if(l.POSITION_QUANTIZED){const n=l.QUANTIZED_VOLUME_OFFSET,i=l.QUANTIZED_VOLUME_SCALE,{byteOffset:o}=l.POSITION_QUANTIZED;d.POSITION={byteStride:12,byteOffset:0,itemSize:3,count:p,componentType:5126,array:this.Kn(new Uint16Array(e,o+c.offset,3*p),n,i)},h.push(d.POSITION.array.buffer)}if(l.BATCH_ID){d.BATCH_ID=bJ(l.BATCH_ID,e,c.offset,p);const n=d.BATCH_ID.array&&d.BATCH_ID.array.buffer;n&&h.indexOf(n)<0&&h.push(n)}if(l.NORMAL_UP){let{byteOffset:n}=l.NORMAL_UP;d.NORMAL_UP={byteStride:0,byteOffset:0,itemSize:3,count:p,componentType:5126,array:new Float32Array(e,n+c.offset,3*p).slice()},h.push(d.NORMAL_UP.array.buffer),n=l.NORMAL_RIGHT.byteOffset,d.NORMAL_RIGHT={byteStride:0,byteOffset:0,itemSize:3,count:p,componentType:5126,array:new Float32Array(e,n+c.offset,3*p).slice()},h.push(d.NORMAL_RIGHT.array.buffer)}else if(l.NORMAL_UP_OCT32P){let{byteOffset:n}=l.NORMAL_UP_OCT32P;d.NORMAL_UP={byteStride:0,byteOffset:0,itemSize:3,count:p,componentType:5126,array:this.Xn(new Uint16Array(e,n+c.offset,2*p))},h.push(d.NORMAL_UP.array.buffer),n=l.NORMAL_RIGHT_OCT32P.byteOffset,d.NORMAL_RIGHT={byteStride:0,byteOffset:0,itemSize:3,count:p,componentType:5126,array:this.Xn(new Uint16Array(e,n+c.offset,2*p))},h.push(d.NORMAL_RIGHT.array.buffer)}if(l.SCALE){const{byteOffset:n}=l.SCALE;d.SCALE={byteStride:0,byteOffset:0,itemSize:1,count:p,componentType:5126,array:new Float32Array(e,n+c.offset,p).slice()},h.push(d.SCALE.array.buffer)}else if(l.SCALE_NON_UNIFORM){const{byteOffset:n}=l.SCALE_NON_UNIFORM;d.SCALE_NON_UNIFORM={byteStride:0,byteOffset:0,itemSize:3,count:p,componentType:5126,array:new Float32Array(e,n+c.offset,3*p).slice()},h.push(d.SCALE_NON_UNIFORM.array.buffer)}return{count:p,batchTable:A,batchTableBin:f,featureTable:l,i3dm:d,transferables:h}}Xn(e){const n=e.length/2,i=new Float32Array(3*n),o=[];for(let s=0;s<n;s++)q0(o,e[2*s],e[2*s+1],65535),i[3*s]=o[0],i[3*s+1]=o[1],i[3*s+2]=o[2];return i}Kn(e,n,i){return IJ(new Float32Array(e.length),e,n,i)}Hn(){return null}};function q0(e,n,i,o){if(e[0]=Z0(n,o),e[1]=Z0(i,o),e[2]=1-(Math.abs(e[0])+Math.abs(e[1])),e[2]<0){const n=e[0];e[0]=(1-Math.abs(e[1]))*Q0(n),e[1]=(1-Math.abs(n))*Q0(e[1])}return l_(e,e)}function Z0(e,n){return function(e,n,i){return e<0?0:e>i?i:e}(e,0,n=function(e,n){return null!=e?e:255}(n))/n*2-1}function Q0(e){return e<0?-1:1}let X0=class es{constructor(){}load(e,n,i=0,o=0){return n?(o||(o=n.byteLength),this.zn(e,n,i,o)):yy.getArrayBuffer(e,{}).then((n=>{const s=n.data;return o||(o=s.byteLength),this.zn(e,s,i,o)}))}zn(e,n,i,o){return this.Yn(n,i,o,e).then((e=>e.error?e:{magic:"pnts",count:e.count,transferables:e.transferables,featureTable:e.featureTable,batchTable:e.batchTable,batchTableBin:e.batchTableBin,pnts:e.pnts}))}Yn(e,n,i,o){const s=new DataView(e,n,i),a=s.getUint32(4,!0);if(1!==a){const e="Unsupported pnts version: "+a+", url:"+o;return console.warn(e),{error:e}}if(s.getUint32(8,!0)!==s.byteLength){const e="Length in pnts header is inconsistent with pnts's byte length, url: "+o;return console.warn(e),{error:e}}const h=[e],{featureTable:l,featureTableBin:c,batchTable:A,batchTableBin:f}=EJ(s,n+28,h),d=l.QUANTIZED_VOLUME_OFFSET,p=l.QUANTIZED_VOLUME_SCALE,g=l.POINTS_LENGTH;let v,w={};if(l.extensions&&l.extensions["3DTILES_draco_point_compression"]){w=l.extensions["3DTILES_draco_point_compression"],v=new DataView(e,w.byteOffset+c.offset,w.byteLength);const n={attributes:w.properties,useUniqueIDs:!1};return this.Zn||(this.Zn=G0().draco),this.Zn(v,n).then((n=>{const i=n.attributes;!l.POSITION&&!l.POSITION_QUANTIZED||i.POSITION||i.POSITION_QUANTIZED||(i.POSITION=l.POSITION,i.POSITION_QUANTIZED=l.POSITION_QUANTIZED),!(l.RGB||l.RGBA||l.RGB565)||i.RGB||i.RGBA||i.RGB565||(i.RGB=l.RGB,i.RGBA=l.RGBA,i.RGB565=l.RGB565),!l.NORMAL&&!l.NORMAL_OCT16P||i.NORMAL||i.NORMAL_OCT16P||(i.NORMAL=l.NORMAL,i.NORMAL_OCT16P=l.NORMAL_OCT16P);const o=this.Wn(e,n.attributes,c.offset,g,h,d,p);if(n.attributes.BATCH_ID){const e=n.attributes.BATCH_ID.array;o.BATCH_ID={byteStride:0,byteOffset:0,itemSize:1,count:e.length,componentType:SJ(e.constructor),array:e},h.push(e.buffer)}else if(l.BATCH_ID||Object.keys(A).length){o.BATCH_ID=l.BATCH_ID?bJ(l.BATCH_ID,e,c.offset,g):Y0(g);const n=o.BATCH_ID.array&&o.BATCH_ID.array.buffer;n&&h.indexOf(n)<0&&h.push(n)}return{count:g,batchTable:A,batchTableBin:f,featureTable:l,pnts:o,transferables:h}}))}const C=this.Wn(e,l,c.offset,g,h,d,p);if(l.BATCH_ID||Object.keys(A).length){C.BATCH_ID=l.BATCH_ID?bJ(l.BATCH_ID,e,c.offset,g):Y0(g);const n=C.BATCH_ID.array&&C.BATCH_ID.array.buffer;n&&h.indexOf(n)<0&&h.push(n)}return Promise.resolve({count:g,batchTable:A,batchTableBin:f,featureTable:l,pnts:C,transferables:h})}Wn(e,n,i,o,s,a,h){const l={};if(n.POSITION){let{byteOffset:a,array:h}=n.POSITION;a=a||0;const c=h?0:i;if(!h){const n=e.slice(a+c,a+c+3*o*4);h=new Float32Array(n)}l.POSITION={byteStride:0,byteOffset:0,itemSize:3,count:o,componentType:5126,array:h},s.push(h.buffer)}else if(n.POSITION_QUANTIZED){let{byteOffset:c}=n.POSITION_QUANTIZED;const{array:A}=n.POSITION_QUANTIZED;c=c||0;l.POSITION={byteStride:0,byteOffset:0,itemSize:3,count:o,componentType:5126,array:this.Kn(A||new Uint16Array(e,c+(A?0:i),3*o),a,h)},s.push(l.POSITION.array.buffer)}if(n.RGBA){let{byteOffset:a,array:h}=n.RGBA;a=a||0;const c=h?0:i;if(!h){const n=e.slice(a+c,a+c+4*o);h=new Uint8Array(n)}l.RGBA={byteStride:0,byteOffset:0,itemSize:4,count:o,componentType:5121,array:h},s.push(h.buffer)}else if(n.RGB){let{byteOffset:a,array:h}=n.RGB;a=a||0;const c=h?0:i;if(!h){const n=e.slice(a+c,a+c+3*o);h=new Uint8Array(n)}l.RGB={byteStride:0,byteOffset:0,itemSize:3,count:o,componentType:5121,array:h},s.push(h.buffer)}else if(n.RGB565){let{byteOffset:a,array:h}=n.RGB565;a=a||0;const c=h?0:i;if(!h){const n=e.slice(a+c,a+c+2*o);h=new Uint16Array(n)}l.RGB565={byteStride:0,byteOffset:0,itemSize:1,count:o,componentType:5123,array:h},s.push(h.buffer)}if(n.NORMAL){let{byteOffset:a,array:h}=n.NORMAL;a=a||0;const c=h?0:i;if(!h){const n=e.slice(a+c,a+c+3*o*4);h=new Float32Array(n)}l.NORMAL={byteStride:0,byteOffset:0,itemSize:3,count:o,componentType:5126,array:h},s.push(h.buffer)}else if(n.NORMAL_OCT16P){let{byteOffset:a,array:h}=n.NORMAL_OCT16P;a=a||0;const c=h?0:i;if(!h){const n=e.slice(a+c,a+c+2*o);h=new Uint8Array(n)}l.NORMAL_OCT16P={byteStride:0,byteOffset:0,itemSize:2,count:o,componentType:5121,array:h},s.push(h.buffer)}return l}Kn(e,n,i){return IJ(new Float32Array(e.length),e,n,i)}Hn(){return null}};function Y0(e){const n=TY(e),i=new n(e);for(let n=0;n<e;n++)i[n]=n;return{byteStride:0,byteOffset:0,itemSize:1,count:e,componentType:SJ(n),array:i}}if(fD){const e=BA.VERSION;if(e.indexOf("1.0.0-beta")>=0||e.indexOf("1.0.0-alpha")>=0){na("@maptalks/3dtiles",fD.inject(MX))}else na("@maptalks/3dtiles",(function(){return fD.inject(MX)}))}else na("@maptalks/3dtiles",MX);"undefined"!=typeof console&&console.log("@maptalks/3dtiles v0.102.1");
/*!
   * @maptalks/gltf-layer v0.101.1
   * LICENSE : UNLICENSED
   * (c) 2016-2024 maptalks.org
   */
const J0="${",K0=`function(t){\n/*!\n     * @maptalks/gltf-loader v0.98.4\n     * LICENSE : UNLICENSED\n     * (c) 2016-2024 maptalks.org\n     */\nvar e="undefined"!=typeof Float32Array?Float32Array:Array;function n(t,e,n){var r=e[0],s=e[1],i=e[2],o=e[3],c=e[4],a=e[5],u=e[6],h=e[7],f=e[8],l=e[9],d=e[10],m=e[11],p=e[12],w=e[13],g=e[14],y=e[15],_=n[0],b=n[1],A=n[2],T=n[3];return t[0]=_*r+b*c+A*f+T*p,t[1]=_*s+b*a+A*l+T*w,t[2]=_*i+b*u+A*d+T*g,t[3]=_*o+b*h+A*m+T*y,_=n[4],b=n[5],A=n[6],T=n[7],t[4]=_*r+b*c+A*f+T*p,t[5]=_*s+b*a+A*l+T*w,t[6]=_*i+b*u+A*d+T*g,t[7]=_*o+b*h+A*m+T*y,_=n[8],b=n[9],A=n[10],T=n[11],t[8]=_*r+b*c+A*f+T*p,t[9]=_*s+b*a+A*l+T*w,t[10]=_*i+b*u+A*d+T*g,t[11]=_*o+b*h+A*m+T*y,_=n[12],b=n[13],A=n[14],T=n[15],t[12]=_*r+b*c+A*f+T*p,t[13]=_*s+b*a+A*l+T*w,t[14]=_*i+b*u+A*d+T*g,t[15]=_*o+b*h+A*m+T*y,t}function r(){var t=new e(3);return e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function s(t,n,r){var s=new e(3);return s[0]=t,s[1]=n,s[2]=r,s}function i(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function o(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function c(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function a(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function u(t,e,n,r,s){return t[0]=e,t[1]=n,t[2]=r,t[3]=s,t}function h(t,e,n){var r=e[0],s=e[1],i=e[2],o=e[3];return t[0]=n[0]*r+n[4]*s+n[8]*i+n[12]*o,t[1]=n[1]*r+n[5]*s+n[9]*i+n[13]*o,t[2]=n[2]*r+n[6]*s+n[10]*i+n[14]*o,t[3]=n[3]*r+n[7]*s+n[11]*i+n[15]*o,t}function f(){var t=new e(4);return e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),r(),function(){var t;t=new e(4),e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var l,d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t};r(),s(1,0,0),s(0,1,0),f(),f(),l=new e(9),e!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1;let m=0;function p(t){return null==t}function w(t){return!p(t)}function g(t){return!p(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}function y(t){for(let e=1;e<arguments.length;e++){const n=arguments[e];for(const e in n)t[e]=n[e]}return t}function _(t){switch(t){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array}throw new Error("unsupported bufferView's component type: "+t)}function b(t){return 0===t.indexOf("data:")&&t.indexOf("base64,")>0}function A(t){const e=function(t){return"undefined"!=typeof self?self.atob(t):window.atob(t)}(t.substring(t.indexOf(",")+1)),n=e.length,r=new Uint8Array(n);for(let t=0;t<n;t++)r[t]=e.charCodeAt(t);return r.buffer}const T=[],x=[],I=[],M=[0,0,0],E=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}([]),v=[1,1,1];function O(t,e,n,r,s,i,o){const c=_(o),a=c.BYTES_PER_ELEMENT;if((0===s||s===r*a)&&i%a==0){const s=new c(e,i,n*r);return t.set(s),t}0===s&&(s=r*a);const u=new Uint8Array(r*a);for(let o=0;o<n;o++){let n=null;const h=new Uint8Array(e,s*o+i,r*a);u.set(h),n=new c(u.buffer,0,r);for(let e=0;e<r;e++)t[o*r+e]=n[e]}return t}const P="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;function k(t,e,n){const r=new Uint8Array(t,e,n);return P.decode(r)}const N={get:function(t,e={},n){e||(e={});const r=new AbortController,s=r.signal,i=y({},e);i.signal=s,i.method||(i.method="GET"),i.referrerPolicy=i.referrerPolicy||"origin","undefined"==typeof window||i.referrer||(i.referrer=window.location.href),n&&(t=n(t));const o=fetch(t,i).then((t=>{const n=this.t(t,e.responseType);return n.message?n:n.then((n=>"arraybuffer"===e.responseType?{data:n,cacheControl:t.headers.get("Cache-Control"),expires:t.headers.get("Expires"),contentType:t.headers.get("Content-Type")}:n)).catch((t=>{if(!t.code||t.code!==DOMException.ABORT_ERR)throw t}))})).catch((t=>{if(!t.code||t.code!==DOMException.ABORT_ERR)throw t}));return o.xhr=r,o},t:(t,e)=>200!==t.status?{status:t.status,statusText:t.statusText,message:\`incorrect http request with status code(${J0}t.status}): ${J0}t.statusText}\`}:"arraybuffer"===e?t.arrayBuffer():"json"===e?t.json():t.text(),getArrayBuffer:(t,e={},n)=>(e||(e={}),e.responseType="arraybuffer",N.get(t,e,n)),getJSON:function(t,e={},n){return e&&e.jsonp?N.jsonp(t):((e=e||{}).responseType="json",N.get(t,e,n))},jsonp:function(t){const e="_maptalks_jsonp_"+m++;t.match(/\\?/)?t+="&callback="+e:t+="?callback="+e;let n=document.createElement("script");return n.type="text/javascript",n.src=t,new Promise((t=>{window[e]=function(r){document.getElementsByTagName("head")[0].removeChild(n),n=null,delete window[e],t(r)},document.getElementsByTagName("head")[0].appendChild(n)}))}};class S{constructor(t,e,n,r,s){this.i=t,this.decoders=e,this.o=n,this.images={},this.u={},this.h=r||{},this.l=s}requestImageFromBufferURI(t,e,n){if(this.buffers[t.id]){const r=this.buffers[t.id],s=this.m(e,r);return this.getImageByBuffer(s,n)}if(this.u[t.id])return this.u[t.id].then((()=>{const r=this.buffers[t.id],s=this.m(e,r);return this.getImageByBuffer(s,n)}));if(b(t.uri)){const r=this.buffers[t.id]=A(t.uri),s=this.m(e,r);return this.getImageByBuffer(s,n)}let r;const s=t.uri.indexOf("blob:")>=0;return r=t.uri.indexOf("://")>0||s?t.uri:this.rootPath+"/"+t.uri,this.u[t.id]=N.getArrayBuffer(r,this.h,this.l).then((r=>{const s=this.buffers[t.id]=r.data,i=this.m(e,s);return this.getImageByBuffer(i,n)}))}getImageByBuffer(t,e){if(this.images[e.id])return Promise.resolve(this.images[e.id]);const n=this.decoders;return n[e.mimeType]?n[e.mimeType](t,{supportedFormats:this.o}):"image/crn"===e.mimeType||"image/ktx2"===e.mimeType||"image/cttf"===e.mimeType?(console.warn("missing transcoder for "+e.mimeType,", visit https://maptalks.com/docs/transcoders for details"),Promise.resolve(null)):this.p(e.id,t)}requestExternalImage(t){if(this.images[t.id])return Promise.resolve(this.images[t.id]);const e=0===t.uri.indexOf("data:image/")?t.uri:this.rootPath+"/"+t.uri;return this.u[t.id]?this.u[t.id].then((()=>this.images[t.id])):this.u[t.id]=this.p(t.id,e)}p(t,e){return new Promise(((n,r)=>{let s=e;this.l&&(s=this.l(e)),this.i(s,this.h,((s,i)=>{s?r(s):(URL.revokeObjectURL(e),this.images[t]=i,n(this.images[t]))}))}))}}const B=["SCALAR",1,"VEC2",2,"VEC3",3,"VEC4",4,"MAT2",4,"MAT3",9,"MAT4",16],R=[];class U{constructor(t,e,n,r,s){this.rootPath=t,this.gltf=e,this._=!1,this.glbBuffer=n,this.buffers={},this.requests={},this.accessors={},this.A(),this.h=r,this.l=s}T(t,e){const n=this.gltf,r=n.accessors[e];if(void 0===r.bufferView)return this.accessors[r.id]=this.I(t,e,null,0),Promise.resolve(this.accessors[r.id]);if(r&&this.accessors[r.id])return Promise.resolve(this.accessors[r.id]);const s=n.bufferViews[r.bufferView];return this.M(s).then((n=>{const{buffer:s,byteOffset:i}=n;return this.accessors[r.id]=this.I(t,e,s,i)}))}M(t){const e=this.gltf.buffers[t.buffer];if(this.buffers[e.id]){const t=this.buffers[e.id];return Promise.resolve({buffer:t,byteOffset:0})}if(this.requests[e.id])return this.requests[e.id].then((()=>{const t=this.buffers[e.id];return Promise.resolve({buffer:t,byteOffset:0})}));if("binary_glTF"!==t.buffer&&"KHR_binary_glTF"!==t.buffer&&e.uri){if(b(e.uri)){const t=this.buffers[e.id]=A(e.uri);return Promise.resolve({buffer:t,byteOffset:0})}let t;const n=e.uri.indexOf("blob:")>=0;return t=e.uri.indexOf("://")>0||n?e.uri:this.rootPath+"/"+e.uri,this.requests[e.id]=N.getArrayBuffer(t,this.h,!n&&this.l).then((r=>(n&&URL.revokeObjectURL(t),{buffer:this.buffers[e.id]=r.data,byteOffset:0})))}return Promise.resolve({buffer:this.glbBuffer.buffer,byteOffset:this.glbBuffer.byteOffset})}I(t,e,n,r=0){const s=this.gltf,i=s.accessors[e],o=void 0!==i.bufferView?s.bufferViews[i.bufferView]:{},c=(o.byteOffset||0)+r,a=this.v(i.type),u=_(i.componentType),f=o.byteStride||0,l={array:void 0,name:t,accessorName:e,byteLength:i.count*a*u.BYTES_PER_ELEMENT,componentType:i.componentType,count:i.count,type:i.type,itemSize:a,max:i.max,min:i.min,extensions:i.extensions};if(i.min&&(l.min=i.min),i.max&&(l.max=i.max),n)if(this._)l.byteStride=f,l.byteOffset=c+(i.byteOffset||0),!f||f===a*u.BYTES_PER_ELEMENT||"indices"===t||"input"===t||"output"===t||t.indexOf("morph")>=0?(l.array=this.O(n,i.count,a,c+(i.byteOffset||0),u),l.array.buffer.byteLength===l.byteLength&&(l.byteOffset=0)):l.array=new Uint8Array(n,c,o.byteLength);else if(i.interleaved){l.byteStride=0,l.byteOffset=0;const t=new u(i.count*a);if(l.array=O(t,n,i.count,a,f,c+(i.byteOffset||0),i.componentType),l.extensions&&l.extensions.WEB3D_quantized_attributes&&a>2){const t=new Float32Array(l.array.length),{decodeMatrix:e}=l.extensions.WEB3D_quantized_attributes;for(let n=0;n<l.array.length;n+=a){R[0]=l.array[n],R[1]=l.array[n+1],R[2]=l.array[n+2],R[3]=1;const r=h(R,R,e);t[n]=r[0],t[n+1]=r[1],t[n+2]=r[2]}l.componentType=5126,l.array=t}}else l.byteStride=0,l.array=this.O(n,i.count,a,c+(i.byteOffset||0),u),l.byteOffset=l.array.byteOffset;else{l.array=new u(i.count);const t=l.min||l.max;t&&(l.array[0]=t[0],l.array[1]=t[1],l.array[2]=t[2])}return l}A(){const t=this.gltf.accessors;if(Array.isArray(t))for(let e=0;e<t.length;e++)for(let n=0;n<t.length;n++)e!==n&&t[e].bufferView===t[n].bufferView&&(t[e].interleaved=t[n].interleaved=!0);else for(const e in t)for(const n in t)e!==n&&t[e].bufferView===t[n].bufferView&&(t[e].interleaved=t[n].interleaved=!0)}O(t,e,n,r,s){return r%s.BYTES_PER_ELEMENT!=0&&(t=t.slice(r,r+e*n*s.BYTES_PER_ELEMENT),r=0),new s(t,r,n*e)}v(t){const e=B.indexOf(t);return B[e+1]}requestKHRTechniquesWebgl(t){const{shaders:e}=t,n=e.map((t=>{if(void 0!==t.bufferView){const e=this.gltf.bufferViews[t.bufferView],{byteLength:n}=e;return this.M(e).then((r=>{const{buffer:s,byteOffset:i}=r,o=k(s,i+(e.byteOffset||0),n);return t.content=o,t}))}if(t.uri){if(b(t.uri)){const e=A(t.uri),n=k(e,0,e.byteLength);return t.content=n,Promise.resolve(t)}{const e=this.rootPath+"/"+t.uri;return N.get(e,this.h,this.l).then((e=>(t.content=e,t)))}}return Promise.resolve(t)}));return Promise.all(n).then((()=>t))}}class C extends S{constructor(t,e,n,r,s,i,o,c){super(r,s,i,o,c),this.rootPath=t,this.gltf=e,this.requests={},this.buffers={},this.glbBuffer=n,this.accessor=new U(t,e,n,o,c)}iterate(t,e){const n=this.gltf[e];if(!n)return;let r=0;for(const e in n)t(e,n[e],r++)}createNode(t){const e={};if(w(t.name)&&(e.name=t.name),w(t.children)&&(e.children=t.children),w(t.jointName)&&(e.jointName=t.jointName),w(t.matrix)&&(e.matrix=t.matrix),w(t.rotation)&&(e.rotation=t.rotation),w(t.scale)&&(e.scale=t.scale),w(t.translation)&&(e.translation=t.translation),w(t.extras)&&(e.extras=t.extras),w(t.meshes)&&(e.mesh=t.meshes[0]),e.translation||e.rotation||e.scale){const t=function(t,e){if(e.matrix)return e.matrix;if(e.translation||e.scale||e.rotation){const r=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}(T,e.translation||M),s=function(t,e){var n=e[0],r=e[1],s=e[2],i=e[3],o=n+n,c=r+r,a=s+s,u=n*o,h=r*o,f=r*c,l=s*o,d=s*c,m=s*a,p=i*o,w=i*c,g=i*a;return t[0]=1-f-m,t[1]=h+g,t[2]=l-w,t[3]=0,t[4]=h-g,t[5]=1-u-m,t[6]=d+p,t[7]=0,t[8]=l+w,t[9]=d-p,t[10]=1-u-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(x,e.rotation||E),i=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(I,e.scale||v);return n(i,s,i),n(t,r,i)}return function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(t)}([],e);delete e.translation,delete e.rotation,delete e.scale,e.matrix=t}return e}P(t){const e={};for(const n in t){const r=t[n];let s,i;r.instanceTechnique&&r.instanceTechnique.values?(s=r.instanceTechnique,i=s.values.diffuse):(s=r,i=s.values.tex||s.values.diffuseTex||s.values.diffuse);const o={baseColorTexture:{index:i}};r.name&&(o.name=r.name),r.extensions&&(o.extensions=r.extensions),r.extras&&(o.extras=r.extras),e[n]=o}return e}k(t){if(t.bufferView||t.extensions&&(t.extensions.KHR_binary_glTF||t.extensions.binary_glTF)){const e=t.bufferView?t:t.extensions.KHR_binary_glTF||t.extensions.binary_glTF;t.extensions&&(t.mimeType=e.mimeType,t.width=e.width,t.height=e.height);const n=this.gltf.bufferViews[e.bufferView],r=(n.byteOffset||0)+this.glbBuffer.byteOffset,s=n.byteLength,i=this.buffers[e.bufferView]=new Uint8Array(this.glbBuffer.buffer,r,s);return this.getImageByBuffer(i,t)}return this.requestExternalImage(t)}N(t){const e=this.gltf.textures[t];if(!e)return null;const n=this.gltf.images[e.source];return this.k(n).then((t=>{const r=this.gltf.samplers[e.sampler];return{image:{array:t.data,width:t.width,height:t.height,index:e.source,mimeType:n.mimeType,name:n.name,extras:n.extras},sampler:r}}))}getBaseColorTexture(t){const e=this.gltf.materials[t];let n,r;if(e.instanceTechnique&&e.instanceTechnique.values?(n=e.instanceTechnique,r=n.values.diffuse):(n=e,r=n.values.tex||n.values.diffuseTex||n.values.diffuse),void 0===r||void 0===this.gltf.textures)return null;const s=this.gltf.textures[r];if(!s)return null;const i=this.gltf.samplers[s.sampler];return{format:s.format||6408,internalFormat:s.internalFormat||6408,type:s.type||5121,sampler:i,source:this.gltf.images[s.source]}}getMaterial(){return null}getAnimations(){return null}}const L=9729;class D extends S{constructor(t,e,n,r,s,i,o,c){super(r,s,i,o,c),this.rootPath=t,this.gltf=e,this.glbBuffer=n,this.buffers={},this.requests={},this.accessor=new U(t,e,n,o,c)}iterate(t,e){const n=this.gltf[e];if(n)for(let e=0;e<n.length;e++)t(e,n[e],e)}createNode(t){const e={};return y(e,t),!w(t.weights)&&this.gltf.meshes&&w(e.mesh)?e.weights=this.gltf.meshes[e.mesh].weights:t.weights&&(e.weights=t.weights),e}N(t){const e=this.gltf.textures[t];if(!e)return null;let n=e.source;if(e.extensions&&e.extensions.EXT_texture_webp&&(n=e.extensions.EXT_texture_webp.source),!w(n))return null;const r=this.gltf.images[n];return this.k(r).then((t=>{if(!t)return null;const n={image:{array:t.data,mipmap:t.mipmap,width:t.width,height:t.height,index:e.source,mimeType:r.mimeType,name:r.name,extensions:r.extensions,extras:r.extras}};y(n,e);const s=w(e.sampler)?this.gltf.samplers[e.sampler]:void 0;if(s&&(n.sampler=s,n.sampler.magFilter=s.magFilter||L,n.sampler.minFilter=s.minFilter||9987,n.sampler.wrapS=s.wrapS||10497,n.sampler.wrapT=s.wrapT||10497),"image/ktx2"===n.image.mimeType&&!n.image.mipmap&&n.sampler&&n.sampler.minFilter!==L&&9728!==n.sampler.minFilter){const t=n.sampler.minFilter;n.sampler.minFilter=9984===t||9986===t?9728:L}return t.format&&(n.format=t.format),n}))}k(t){if(!w(t.bufferView))return this.requestExternalImage(t);{const e=this.gltf.bufferViews[t.bufferView],n=this.gltf.buffers[e.buffer];if(n.uri)return this.requestImageFromBufferURI(n,e,t);if(this.glbBuffer)return this.S(e,t)}return null}S(t,e){const n=this.m(t,this.glbBuffer.buffer,this.glbBuffer.byteOffset);return this.getImageByBuffer(n,e)}m(t,e,n){n=n||0;const r=(t.byteOffset||0)+n,s=t.byteLength;return new Uint8Array(e,r,s)}B(t,e){const n=new Array(t.byteLength);for(let e=0;e<t.byteLength;e++)n[e]=String.fromCharCode(t[e]);n.join("");const r="data:"+(e=e||"image/png")+";base64,"+function(t){return"undefined"!=typeof self?self.btoa(t):window.btoa(t)}(unescape(encodeURIComponent(n)));return r}getAnimations(t){const e=[];return t.forEach((t=>{e.push(this.getSamplers(t.samplers))})),Promise.all(e).then((e=>{for(let n=0;n<e.length;n++)t[n].samplers=e[n];return t}))}getSamplers(t){const e=[];for(let n=0;n<t.length;n++)(w(t[n].input)||w(t[n].output))&&(e.push(this.accessor.T("input",t[n].input)),e.push(this.accessor.T("output",t[n].output)));return Promise.all(e).then((e=>{for(let n=0;n<e.length/2;n++)t[n].input=e[2*n],t[n].output=e[2*n+1],t[n].interpolation||(t[n].interpolation="LINEAR");return t}))}}const q="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;class F{static read(t,e=0,n=0){n||(n=t.byteLength);const r=new DataView(t,e,n),s=r.getUint32(4,!0);if(1===s)return F.readV1(r,e);if(2===s)return F.readV2(t,e);throw new Error("Unsupported glb version : "+s)}static readV1(t,e){const n=t.getUint32(8,!0),r=t.getUint32(12,!0);if(n!==t.byteLength)throw new Error("Length in GLB header is inconsistent with glb's byte length.");const s=V(t.buffer,20+e,r);return{json:JSON.parse(s),glbBuffer:{byteOffset:20+e+r,buffer:t.buffer,byteLength:n}}}static readV2(t,e){let n,r,s;const i=new DataView(t,e+12);let o=0;for(;o+8<i.byteLength;){const c=i.getUint32(o,!0);o+=4;const a=i.getUint32(o,!0);if(o+=4,1313821514===a)n=V(t,e+12+o,c);else if(5130562===a){s=e+12+o,r=c;break}o+=c}return{json:JSON.parse(n),glbBuffer:{byteOffset:s,buffer:t,byteLength:r}}}}function V(t,e,n){if(q){const r=new Uint8Array(t,e,n);return q.decode(r)}return function(t){const e=t.length;let n="";for(let r=0;r<e;){let s=t[r++];if(128&s){let n=j[s>>3&7];if(!(64&s)||!n||r+n>e)return null;for(s&=63>>n;n>0;n-=1){const e=t[r++];if(128!=(192&e))return null;s=s<<6|63&e}}n+=String.fromCharCode(s)}return n}(new Uint8Array(t,e,n))}const j=[1,1,1,1,2,2,3,0],H=[0,0,0],K=[0,0,0,1],X=[1,1,1],$={TRANSLATION:[0,0,0],ROTATION:[0,0,0,1],SCALE:[1,1,1]},G={PREVIOUS:null,NEXT:null,PREINDEX:null,NEXTINDEX:null,INTERPOLATION:null},z={R(t,e,n,r,s,o,c,a){const u=w(t)?e.animations:[e.animations[0]],h={};for(let e=0;e<u.length;e++){const f=u[e],l=f.name||e;if(w(t)&&l!==t)continue;const m=f.channelsMap[n];if(m)for(let t=0;t<m.length;t++){const e=m[t];"translation"===e.target.path?(this.U(s,f.samplers[e.sampler],r,1),h.translation=i(H,s)):"rotation"===e.target.path?(this.C(o,f.samplers[e.sampler],r,1),h.rotation=d(K,o)):"scale"===e.target.path?(this.U(c,f.samplers[e.sampler],r,1),h.scale=i(X,c)):"weights"===e.target.path&&a&&(this.U(a,f.samplers[e.sampler],r,a.length),h.weights=a)}}return h},U(t,e,n,r){switch(e.interpolation){case"LINEAR":{const s=this.L(G,e,n,1*r);s&&(t=function(t,e,n,r){for(let s=0;s<t.length;s++)t[s]=e[s]+r*(n[s]-e[s]);return t}(t,s.PREVIOUS,s.NEXT,s.INTERPOLATION));break}case"STEP":{const s=this.L(G,e,n,1*r);s&&(t=function(t,e){for(let n=0;n<t.length;n++)t[n]=e[n];return t}(t,...s.PREVIOUS));break}case"CUBICSPLINE":{const s=this.L(G,e,n,3*r);s&&(t=this.D(t,s,e.input.array,3*r));break}}return t},C(t,e,n){switch(e.interpolation){case"LINEAR":{const r=this.L(G,e,n,1);r&&function(t,e,n,r){var s,i,o,c,a,u=e[0],h=e[1],f=e[2],l=e[3],d=n[0],m=n[1],p=n[2],w=n[3];(i=u*d+h*m+f*p+l*w)<0&&(i=-i,d=-d,m=-m,p=-p,w=-w),1-i>1e-6?(s=Math.acos(i),o=Math.sin(s),c=Math.sin((1-r)*s)/o,a=Math.sin(r*s)/o):(c=1-r,a=r),t[0]=c*u+a*d,t[1]=c*h+a*m,t[2]=c*f+a*p,t[3]=c*l+a*w}(t,r.PREVIOUS,r.NEXT,r.INTERPOLATION);break}case"STEP":{const r=this.L(G,e,n,1);r&&(t=u(t,...r.PREVIOUS));break}case"CUBICSPLINE":{const r=this.L(G,e,n,3);if(r){for(let t=0;t<r.PREVIOUS.length;t++)r.PREVIOUS[t]=Math.acos(r.PREVIOUS[t]),r.NEXT[t]=Math.acos(r.NEXT[t]);t=this.D(t,r,e.input.array,3);for(let e=0;e<t.length;e++)t[e]=Math.cos(t[e])}break}}return t},q(t,e){const n=t.length;let r,s,i,o=0,c=n-1,a=Math.floor((o+c)/2);for(;o<=n-1&&c>=0;){if(o===c)return null;if(t[a]<=e&&e<=t[a+1]){const n=t[a];return r=a,s=a+1,i=(e-n)/(t[a+1]-n),{preIndx:r,nextIndex:s,interpolation:i}}e<t[a]?(c=a,a=Math.floor((o+c)/2)):t[a+1]<e&&(o=a,a=Math.floor((o+c)/2))}return null},L(t,e,n,r){const s=e.input.array,i=e.output.array,o=e.output.itemSize;(n<s[0]||n>s[s.length-1])&&(n=Math.max(s[0],Math.min(s[s.length-1],n))),n===s[s.length-1]&&(n=s[0]);const c=this.q(s,n);if(!c||!c.nextIndex)return null;const{preIndx:a,nextIndex:u,interpolation:h}=c;t.PREINDEX=a,t.NEXTINDEX=u,t.INTERPOLATION=h;const f=o*r;return t.PREVIOUS=i.subarray(t.PREINDEX*f,(t.PREINDEX+1)*f),t.NEXT=i.subarray(t.NEXTINDEX*f,(t.NEXTINDEX+1)*f),t},D(t,e,n,r){const s=e.INTERPOLATION,i=n[e.PREINDEX],o=n[e.NEXTINDEX];for(let n=0;n<3;n++){const c=e.PREVIOUS[r+n],a=(o-i)*e.PREVIOUS[2*r+n],u=e.NEXT[3+n],h=(o-i)*e.NEXT[n],f=(2*Math.pow(s,3)-3*Math.pow(s,2)+1)*c+(Math.pow(s,3)-2*Math.pow(s,2)+s)*a+(2*-Math.pow(s,3)+3*Math.pow(s,2))*u+(Math.pow(s,3)-Math.pow(s,2))*h;t[n]=f}return t},getAnimationClip(t,e,n,r){const s=t.nodes[e]&&t.nodes[e].weights;return o(H,...$.TRANSLATION),u(K,...$.ROTATION),o(X,...$.SCALE),this.R(r,t,e,n,H,K,X,s)},getTimeSpan(t){if(!t.animations)return null;if(t.timeSpan)return t.timeSpan;const e=t.animations;return t.timeSpan={},e.forEach(((e,n)=>{let r=-1/0,s=1/0;const i=e.channels;for(let t=0;t<i.length;t++){const n=i[t],o=e.samplers[n.sampler].input.array;o[o.length-1]>r&&(r=o[o.length-1]),o[0]<s&&(s=o[0])}const o=e.name||n;t.timeSpan[o]={max:r,min:s}})),t.timeSpan},getTimeSpanByName(t,e){const n=this.getTimeSpan(t);return n?w(e)?n[e]:n[Object.keys(n)[0]]:null}};let J=!1;if("undefined"!=typeof OffscreenCanvas){let t;try{t=new OffscreenCanvas(2,2).getContext("2d")}catch(ft){}t&&"undefined"!=typeof createImageBitmap&&(J=!0)}const W="undefined"==typeof document?null:document.createElement("canvas");class Q{constructor(t,e,n){if(this.options=n||{},this.options.decoders||(this.options.decoders={}),this.h=this.options.fetchOptions||{},e.buffer instanceof ArrayBuffer){const{json:n,glbBuffer:r}=F.read(e.buffer,e.byteOffset,e.byteLength);this.F(t,n,r)}else this.F(t,e);this.V=new U(this.rootPath,this.gltf,this.glbBuffer,this.h,this.options.urlModifier),this.j()}j(){const t=this.gltf.extensionsRequired;if(t){if(t.indexOf("KHR_draco_mesh_compression")>=0&&!this.options.decoders.draco)throw new Error("KHR_draco_mesh_compression is required but @maptalks/transcoders.draco is not loaded");if(t.indexOf("KHR_texture_basisu")>=0&&!this.options.decoders["image/ktx2"])throw new Error("KHR_texture_basisu is required but @maptalks/transcoders.ktx2 is not loaded");if(t.indexOf("EXT_meshopt_compression")>=0)throw new Error("EXT_meshopt_compression extension is not supported yet.")}}H(){const t=this.gltf.extensions;return t&&t.KHR_techniques_webgl?this.V.requestKHRTechniquesWebgl(t.KHR_techniques_webgl).then((e=>(t.KHR_techniques_webgl=e,t))):Promise.resolve(t)}load(t){t=t||{};const e=this.K(t),n=this.X(),r=this.$(),s=this.H();return Promise.all([e,n,r,s]).then((t=>(t[0].animations=t[1],t[0].textures=t[2],t[0].extensions=t[3],t[0].transferables=this.transferables||[],this.createChannelsMap(t[0]),t[0])))}createChannelsMap(t){const e=t.animations;if(e)for(let t=0;t<e.length;t++){const n=e[t];n.channelsMap={};for(let t=0;t<n.channels.length;t++){const e=n.channels[t];n.channelsMap[e.target.node]||(n.channelsMap[e.target.node]=[]),n.channelsMap[e.target.node].push(e)}}}getExternalResources(){const t=[];if(this.gltf){const{buffers:e,images:n}=this.gltf;for(let n=0;n<e.length;n++)e[n].uri&&e[n].uri.indexOf("data:application/octet-stream;base64")<0&&t.push({type:"buffer",uri:e[n].uri});for(let e=0;e<n.length;e++)n[e].uri&&n[e].uri.indexOf("data:image/")<0&&t.push({type:"image",uri:n[e].uri})}return t}static getAnimationClip(t,e,n,r){return z.getAnimationClip(t,e,n,r)}static getAnimationTimeSpan(t,e){return z.getTimeSpanByName(t,e)}static getTypedArrayCtor(t){return _(t)}static readInterleavedArray(t,e,n,r,s,i,o){return O(t,e,n,r,s,i,o)}F(t,e,n){this.gltf=e,this.glbBuffer=n,this.version=e.asset?+e.asset.version:1,this.rootPath=t,this.buffers={},this.requests={},this.options.requestImage=J?st.bind(this):this.options.requestImage||Y,this.options.transferable&&(this.transferables=[]),2===this.version?(this.adapter=new D(t,e,n,this.options.requestImage,this.options.decoders||{},this.options.supportedFormats||{},this.h,this.options.urlModifier),this.adapter.iterate(((t,e,n)=>{e.id="buffer_"+n}),"buffers"),this.adapter.iterate(((t,e,n)=>{e.id="image_"+n}),"images"),this.adapter.iterate(((t,e,n)=>{e.id="accessor_"+n}),"accessors")):(this.adapter=new C(t,e,n,this.options.requestImage,this.options.decoders||{},this.options.supportedFormats||{},this.h,this.options.urlModifier),this.adapter.iterate(((t,e,n)=>{e.id="accessor_"+n}),"accessors"),this.adapter.iterate(((t,e,n)=>{e.id="image_"+n}),"images"))}G(t,e){if(t.children&&t.children.length>0){if(!("number"==typeof(n=t.children[0])&&isFinite(n)||g(t.children[0])))return t;const r=t.children.map((t=>{const n=e[t];return n.nodeIndex=t,this.G(n,e)}));t.children=r}var n;return t}K(t){return this.J(t).then((t=>{const e=this.scenes=[];let n;for(const e in t)t[e]=this.G(t[e],t),t[e].nodeIndex=Number(e)?Number(e):e;this.adapter.iterate(((r,s,i)=>{const o={};s.name&&(o.name=s.name),s.nodes&&(o.nodes=s.nodes.map((e=>t[e]))),this.gltf.scene===r&&(n=i),e.push(o)}),"scenes");const r={textures:this.gltf.textures,asset:this.gltf.asset,scene:n,scenes:e,nodes:t,meshes:this.meshes,materials:this.gltf.materials,skins:this.skins,extensionsRequired:this.gltf.extensionsRequired,extensionsUsed:this.gltf.extensionsUsed};if(this.gltf.extensions&&(r.extensions=this.gltf.extensions),1===this.version){const t=this.adapter.P(this.gltf.materials);r.materials=t}return delete this.gltf.buffers,r.json=this.gltf,r}))}J(t){return this.W(t).then((()=>{const t=this.nodes={};return this.adapter.iterate(((e,n)=>{const r=this.adapter.createNode(n,this.meshes,this.skins);t[e]=r}),"nodes"),t}))}Y(){this.skins=[];const t=[];return this.adapter.iterate(((e,n,r)=>{t.push(this.Z(n).then((t=>{t.index=r,this.skins.push(t)})))}),"skins"),t}Z(t){const e=t.inverseBindMatrices;return this.adapter.accessor.T("inverseBindMatrices",e).then((e=>(t.inverseBindMatrices=e,e&&e.buffer&&this.transferables&&this.transferables.indexOf(e.buffer)<0&&this.transferables.push(e.buffer),t)))}X(){const t=this.gltf.animations;return w(t)?this.adapter.getAnimations(t):null}W(t){this.meshes={};let e=[];return this.adapter.iterate(((n,r,s)=>{e.push(this.tt(r,t).then((t=>{t.index=s,this.meshes[n]=t})))}),"meshes"),e=e.concat(this.Y()),Promise.all(e)}tt(t,e){const n=t.primitives.map((t=>this.et(t,e))).filter((t=>!!t));return Promise.all(n).then((e=>{const n={};return y(n,t),n.primitives=e,n}))}$(){const t=this.gltf.textures;if(!t)return null;const e=[];for(const n in t)e.push(this.adapter.N(n));return Promise.all(e).then((e=>{if(this.transferables)for(let t=0;t<e.length;t++){const n=e[t]&&e[t].image.array;if(n){let t;t=n instanceof ImageBitmap?n:n.buffer,t&&this.transferables.indexOf(t)<0&&this.transferables.push(t)}}if(!Array.isArray(t)){const n={},r=Object.keys(t);for(let t=0;t<e.length;t++)e[t]&&(n[r[t]]=e[t]);return n}return e}))}et(t,e){let n;const r=[],s=t.extensions;if(w(t.targets))for(let e=0;e<t.targets.length;e++){const n=t.targets[e];for(const t in n){const s=this.adapter.accessor.T(\`morphTargets_${J0}t}_${J0}e}\`,n[t]);s&&r.push(s)}}if(s&&s.KHR_draco_mesh_compression){if(!this.options.decoders.draco&&(!this.gltf.extensionsRequired||!this.gltf.extensionsRequired.indexOf("KHR_draco_mesh_compression")<0))return null;const t=this.options.decoders.draco,{bufferView:i,attributes:o}=s.KHR_draco_mesh_compression,c=this.gltf.bufferViews[i],a=this.V.M(c).then((n=>{const{buffer:r,byteOffset:s}=n;let{byteOffset:i}=c;const a=c.byteLength;i||(i=0);const u=new DataView(r,s+i,a),h={attributes:o,useUniqueIDs:!1,skipAttributeTransform:e.skipAttributeTransform};return t(u,h).then((t=>{const e=Object.values(t.attributes);return t.indices&&e.push(t.indices),e}))}));r.push(a),n=Promise.all(r)}else{const e=t.attributes;for(const t in e){const n=this.adapter.accessor.T(t,e[t]);n&&r.push(n)}if(w(t.indices)){const e=this.adapter.accessor.T("indices",t.indices);e&&r.push(e)}n=Promise.all(r)}return n.then((e=>{if(s&&s.KHR_draco_mesh_compression){const n=t.targets?t.targets.length:0;e[n]=e[n].concat(e.slice(0,n)),e=e[n]}let n,r;const i={attributes:e.reduce(((t,e)=>{if("indices"===e.name)n=e;else if(e.name.indexOf("morphTargets_")>-1)r=r||{},r[e.name.slice(13)]=e;else{if(!("POSITION"!==e.name||e.min&&e.max)){const t=[1/0,1/0,1/0],n=[-1/0,-1/0,-1/0],{itemSize:r,array:s}=e,i=s.length/r;for(let e=0;e<i;e++)for(let i=0;i<r;i++){const o=e*r+i;s[o]<t[i]&&(t[i]=s[o]),s[o]>n[i]&&(n[i]=s[o])}if(e.quantization){const r=e.quantization,s=r.range/(1<<r.quantizationBits),i=r.minValues;a(t,t,s),c(t,t,i),a(n,n,s),c(n,n,i)}e.min=t,e.max=n}t[e.name]=e}return this.transferables&&e.array.buffer&&this.transferables.indexOf(e.array.buffer)<0&&this.transferables.push(e.array.buffer),t}),{}),material:t.material};return n&&(i.indices=n),r&&(i.morphTargets=r),i.mode=w(t.mode)?t.mode:4,w(t.extras)&&(i.extras=t.extras),i}))}}function Y(t,e,n){const r=new Image;r.crossOrigin="",r.onload=()=>{if(!W)return void n(new Error("There is no canvas to draw image!"));W.width=r.width,W.height=r.height;const t=W.getContext("2d",{willReadFrequently:!0});t.drawImage(r,0,0,r.width,r.height);const e=t.getImageData(0,0,r.width,r.height),s={width:r.width,height:r.height,data:new Uint8Array(e.data)};n(null,s)},r.onerror=function(t){n(t)},r.src=t}const Z=[],tt=[],et=30;let nt,rt;function st(t,e,n){nt||(nt=new OffscreenCanvas(2,2),rt=nt.getContext("2d",{willReadFrequently:!0}));let r=null;if(g(t))this.options.urlModifier&&(t=this.options.urlModifier(t)),Z.push([t,e,n,this]),it();else{const e=new Blob([t]);r=createImageBitmap(e),r.then(ot.bind(this)).then((t=>{n(null,t)})).catch((t=>{console.warn(t),n(t)}))}}function it(){if(!Z.length||tt.length>et)return;const t=Z.shift(),[e,n,r,s]=t;tt.push(t),fetch(e,n).then((t=>t.arrayBuffer())).then((t=>{const e=new Blob([new Uint8Array(t)]);return createImageBitmap(e)})).then(ot.bind(s)).then((e=>{r.call(s,null,e);const n=tt.indexOf(t);tt.splice(n,1),it()})).catch((e=>{console.warn(e),r.call(s,e);const n=tt.indexOf(t);tt.splice(n,1),it()}))}function ot(t){let{width:e,height:n}=t;ct(e)||(e=at(e)),ct(n)||(n=at(n));const r=this.options.maxTextureSize;r&&(e=Math.min(r,e),n=Math.min(r,n)),nt.width=e,nt.height=n,rt.drawImage(t,0,0,e,n),t.close();const s=rt.getImageData(0,0,e,n);return{width:e,height:n,data:new Uint8Array(s.data)}}function ct(t){return!(t&t-1)&&0!==t}function at(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}\n/*!\n     * @maptalks/gl v0.102.1\n     * LICENSE : UNLICENSED\n     * (c) 2016-2024 maptalks.com\n     */const ut=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof undefined)return global;throw new Error("unable to locate global object")},ht=ut(),ft=ht.gl_trans__coders=ht.gl_trans__coders||{};ft.inject=function(t){const e=t.toString(),n=e.indexOf("{")+1,r=e.substring(0,n),s=ht.gl_trans__coders=ht.gl_trans__coders||{};let i=\`${J0}r}\\n    const _____getGlobal = ${J0}ut.toString()};\\n    const g___lobals = _____getGlobal()\\n    const tran_____scoders = g___lobals['gl_trans__coders'] = g___lobals['gl_trans__coders'] || {};\`;for(const t in s)"inject"!==t&&"getTranscoder"!==t&&"registerTranscoder"!==t&&(i+='tran_____scoders["'+t+'"] ='+s[t].toString()+"\\n;");return i+="\\n"+e.substring(r.length),i},ft.registerTranscoder=function(t,e){ft[t]=e},ft.getTranscoder=function(t){return ft[t]};const lt={"image/crn":ft.crn&&ft.crn(),"image/ktx2":ft.ktx2&&ft.ktx2(),"image/cttf":ft.ktx2&&ft.ktx2(),"draco":ft.draco&&ft.draco()};let dt;const mt={};function pt(t,e,n){return new Q(t,e,n).load({skipAttributeTransform:!0})}function wt(t,e,n,r){const s=e.lastIndexOf("/"),i=e.slice(0,s);r&&(e=r(e));const o=(...e)=>gt.call(this,t,...e);return function(t,e){return N.getArrayBuffer(t,e)}(e,n).then((t=>{if(t.message)return t;const s=t.data;return new DataView(s,s.byteOffset,s.byteLength).getUint32(4,!0)>2?function(t,e){return N.getJSON(t,e)}(e,n).then((t=>t.message?t:pt(i,t,{requestImage:o,decoders:lt,transferable:!0,fetchOptions:n,urlModifier:r}))):pt(i,{buffer:t.data,byteOffset:0},{requestImage:o,decoders:lt,transferable:!0,fetchOptions:n,urlModifier:r})}))}function gt(t,e,n,r){t?mt[e]?mt[e].push(r):(mt[e]=[r],self.postMessage({type:"<request>",command:"sendImageData",actorId:t,workerId:dt,params:e})):function(t,e){const n=new Image;n.onload=()=>{if(!yt)return void e(new Error("There is no canvas to draw image!"));yt.width=n.width,yt.height=n.height;const t=yt.getContext("2d");t.drawImage(n,0,0,n.width,n.height);const r=t.getImageData(0,0,n.width,n.height),s={width:n.width,height:n.height,data:new Uint8Array(r.data)};e(null,s,[s.data.buffer])},n.onerror=function(t){e(t)},n.src=t}(e,r)}const yt="undefined"==typeof document?null:document.createElement("canvas");t.loadGLTF=wt,t.onmessage=function(t){const e=t.data,n=e.url;if("addLayer"===e.command||"removeLayer"===e.command)dt=t.workerId,self.postMessage({type:"<response>",actorId:e.actorId,workerId:dt,params:"ok"});else if(n)!function(t){const e=t.data,n=t.callback,r=t.actorId,s=e.url,i=e.fetchOptions||{};i.referrerPolicy=i.referrerPolicy||"origin",i.referrer=e.referrer,wt(r,s,i).then((t=>{t.message?self.postMessage({callback:n,error:t}):self.postMessage({callback:n,data:t},t.transferables)})).catch((t=>{self.postMessage({callback:n,error:t})})),mt.receive=n}(t);else if(e.imageUrl){const t=mt[e.imageUrl];if(delete mt[e.imageUrl],t)for(let n=0;n<t.length;n++)t[n](null,e.result)}}}`;function $0(e){return null==e}function t1(e){return!$0(e)}function e1(e,n){if(!e||!n)return null;let i=n;if(Array.isArray(n)){if(!Yo.isNumber(n[0]))return null;i=new Zh(n)}const o=e.coordinateToPointAtRes(i,e.getGLRes()),s=e.altitudeToPoint(i.z||0,e.getGLRes());return[o.x,o.y,s]}function n1(e,n){return Math.abs(e)*Math.sign(n)}function i1(e,n,i){const o=Ml.Measurer.getInstance().measureLenBetween(e,n);let s=i.count;s&&i.snapToEndVertexes&&(s-=1);const a=s>0?o/s:i.gapLength+i.bboxWidth,h=Math.floor(o/a),l=[],c=i.rotateAlongLine+function(e,n,i){const o=i.getGLRes(),s=i.coordinateToPointAtRes(e,o),a=i.coordinateToPointAtRes(n,o);return Yo.computeDegree(a.x,a.y,s.x,s.y)/Math.PI*180}(e,n,i.map);if(h>=1){const s=0,A=h;if(i.snapToEndVertexes)for(let i=s;i<=A;i++){const s={coordinates:r1(e,n,a*i/o),scale:[1,1,1],rotation:[0,0,c]};l.push(s)}else for(let i=s+1;i<=A;i++){const s={coordinates:r1(e,n,a*(i-.5)/o),scale:[1,1,1],rotation:[0,0,c]};l.push(s)}if(i.scaleEndModel){const i=(o-a*h)/a,s={coordinates:r1(e,n,(a*h+(o-a*h)/2)/o),scale:[i,1,1],rotation:[0,0,c]};l.push(s)}}else if(i.scaleEndModel){const i=o/a,s={coordinates:r1(e,n,.5),scale:[i,1,1],rotation:[0,0,c]};l.push(s)}return l}function r1(e,n,i){const o=o1(e.x,n.x,i),s=o1(e.y,n.y,i);return new Zh(o,s)}function o1(e,n,i){return e+i*(n-e)}const s1={},a1="undefined"==typeof document?null:document.createElement("canvas");let h1=class R extends Nm.Actor{constructor(e,n){super(e),this.mapId=n.getMap().id,this.t=n}loadGLTF(e){const n=function(e){let n=document.createElement("a");return n.href=e,e=n.href,n=null,e}(e),i={url:n,referrer:window&&window.location.href,fetchOptions:this.t.options.fetchOptions};return new Promise(((e,n)=>{this.send(i,null,((i,o)=>{i?n(i):e(o)}))}))}sendImageData(e,n){!function(e,n){const i=new Image;i.onload=()=>{if(!a1)return void n(new Error("There is no canvas to draw image!"));a1.width=i.width,a1.height=i.height;const e=a1.getContext("2d");e.drawImage(i,0,0,i.width,i.height);const o=e.getImageData(0,0,i.width,i.height),s={width:i.width,height:i.height,data:new Uint8Array(o.data)};n(null,s)},i.onerror=function(e){n(e)},i.src=e}(e,((i,o)=>{i||this.isActive()&&n(null,{result:o,imageUrl:e})}))}addLayer(e,n,i){this.broadcast({actorId:this.actorId,mapId:this.mapId,layerId:e,command:"addLayer",params:{options:n}},null,i)}removeLayer(e,n,i){this.broadcast({mapId:this.mapId,layerId:e,command:"removeLayer"},null,i)}};
/*!
   * @maptalks/gl v0.102.1
   * LICENSE : UNLICENSED
   * (c) 2016-2024 maptalks.com
   */const l1=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")},u1=l1(),c1=u1.gl_trans__coders=u1.gl_trans__coders||{};c1.inject=function(e){const n=e.toString(),i=n.indexOf("{")+1,o=n.substring(0,i),s=u1.gl_trans__coders=u1.gl_trans__coders||{};let a=`${o}\n    const _____getGlobal = ${l1.toString()};\n    const g___lobals = _____getGlobal()\n    const tran_____scoders = g___lobals['gl_trans__coders'] = g___lobals['gl_trans__coders'] || {};`;for(const e in s)"inject"!==e&&"getTranscoder"!==e&&"registerTranscoder"!==e&&(a+='tran_____scoders["'+e+'"] ='+s[e].toString()+"\n;");return a+="\n"+n.substring(o.length),a},c1.registerTranscoder=function(e,n){c1[e]=n},c1.getTranscoder=function(e){return c1[e]};const A1={"image/crn":c1.crn&&c1.crn(),"image/ktx2":c1.ktx2&&c1.ktx2(),"image/cttf":c1.ktx2&&c1.ktx2(),draco:c1.draco&&c1.draco()};let f1;const d1={};function p1(e,n,i){return new zy(e,n,i).load({skipAttributeTransform:!0})}function g1(e,n,i,o){const s=n.lastIndexOf("/"),a=n.slice(0,s);o&&(n=o(n));const h=(...n)=>m1.call(this,e,...n);return function(e,n){return yy.getArrayBuffer(e,n)}(n,i).then((e=>{if(e.message)return e;const s=e.data;return new DataView(s,s.byteOffset,s.byteLength).getUint32(4,!0)>2?function(e,n){return yy.getJSON(e,n)}(n,i).then((e=>e.message?e:p1(a,e,{requestImage:h,decoders:A1,transferable:!0,fetchOptions:i,urlModifier:o}))):p1(a,{buffer:e.data,byteOffset:0},{requestImage:h,decoders:A1,transferable:!0,fetchOptions:i,urlModifier:o})}))}function m1(e,n,i,o){e?d1[n]?d1[n].push(o):(d1[n]=[o],self.postMessage({type:"<request>",command:"sendImageData",actorId:e,workerId:f1,params:n})):function(e,n){const i=new Image;i.onload=()=>{if(!y1)return void n(new Error("There is no canvas to draw image!"));y1.width=i.width,y1.height=i.height;const e=y1.getContext("2d");e.drawImage(i,0,0,i.width,i.height);const o=e.getImageData(0,0,i.width,i.height),s={width:i.width,height:i.height,data:new Uint8Array(o.data)};n(null,s,[s.data.buffer])},i.onerror=function(e){n(e)},i.src=e}(n,o)}const y1="undefined"==typeof document?null:document.createElement("canvas"),v1=[],_1=[],x1=[],b1=[],w1=[1,1,1],C1=[],P1=[],M1=[1,1,1],T1=[],S1=new Sw,I1=function(e,n){const i=[];return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=0,i[4]=e[3],i[5]=e[4],i[6]=e[5],i[7]=0,i[8]=e[6],i[9]=e[7],i[10]=e[8],i[11]=0,i[12]=n[0],i[13]=n[1],i[14]=n[2],i[15]=1,i}(function(e){const n=Math.cos(e),i=Math.sin(e),o=[];return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=n,o[5]=i,o[6]=0,o[7]=-i,o[8]=n,o}(.5*Math.PI),[0,0,0]),E1=new ee(0,0),O1=[186/255,186/255,186/255,1],R1={lightAmbient:[1,1,1],lightDiffuse:[1,1,1],lightSpecular:[1,1,1],lightDirection:[1,1,1]},D1=new Set(["url","translationX","translationY","translationZ","rotationX","rotationY","rotationZ","scaleX","scaleY","scaleZ","anchorZ","markerPixelHeight","modelHeight"]),k1=[1,1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1],L1=[0,1,1,2,2,3,3,0,0,4,1,5,2,6,3,7,4,5,5,6,6,7,7,4],F1=[.8,.8,.1,1];let N1=class lt extends pf{constructor(e,n){const i=Yo.extend({},n),o=i.symbol;super(e,i),this.options.symbol=o,this.i=!1,this.o=xv([]),this.h="gltfmarker",this.l=!0,this.u=!0,this.m={get translation(){return[0,0,0]},get rotation(){return[0,0,0]},get scale(){return[1,1,1]}},this.p()}static parseJSONData(e){const n=lt.fromJSON(e);return n.setZoomOnAdded(e.zoomOnAdded),n}static fromJSON(e){return new lt(e.coordinates,e.options)}static getGLTFAnchorsAlongLineString(e,n,i,o){const s=[];for(let a=0;a<e.length-1;a++){const h=i1(e[a],e[a+1],{map:i,bboxWidth:n,gapLength:o.gapLength||0,count:o.count,rotateAlongLine:o.rotateAlongLine,snapToEndVertexes:o.snapToEndVertexes,scaleEndModel:o.scaleEndModel});Yo.pushIn(s,h)}return s}static combineGLTFBoundingBox(e){const n=[];for(let i=0;i<e.length;i++){const o=e[i].getBoundingBox();n.push([o.min,o.max])}const i=n[0];if(!i)return null;const o=Kv([],i[0]),s=Kv([],i[1]);for(let e=1;e<n.length;e++){const i=n[e],a=Kv([],i[0]),h=Kv([],i[1]);a[0]<o[0]&&(o[0]=a[0]),a[1]<o[1]&&(o[1]=a[1]),a[2]<o[2]&&(o[2]=a[2]),h[0]>s[0]&&(s[0]=h[0]),h[1]>s[1]&&(s[1]=h[1]),h[2]>s[2]&&(s[2]=h[2])}return{min:o,max:s}}setTransformOrigin(e){this._=e}getTransformOrigin(){return this._||this.getCenter()}getMeshes(e,n,i){let o=[];const s=this.getMap();if(n&&(this.regl=n),this.getLayer().isVisible()&&this.isVisible()&&this.T()){if(!this.v)return this.M(e,n),o;let a=this.isAnimated()||this.O()&&s.isZooming()||this.u||"multigltfmarker"===this.getGLTFMarkerType()&&this.l;if(!a){const e=this.o;_v(C1,e),this.p(),a=!qv(e,C1)}a&&this.A(this.v,i),o=this.v.filter((e=>!!(cX(s.projViewMatrix,e.getBoundingBox())||e instanceof wC)&&(this.S(e),this.I(e),!0))),this.P(!1)}return o}getGLTFJSON(){return this.k}getAllMeshes(){return this.v}L(){return this.k}N(e){this.k=e}C(e,n){this._externSymbol=this._externSymbol||{},this._externSymbol[e]=n,"uniforms"===e&&(this.R=!0)}setUrl(e){return this.updateSymbol({url:e}),this}setSymbol(e){const n=this.getUrl();super.setSymbol(e);const i=this.getShader(),o=this.B;o&&e.url!==n&&(o.logoutGLTF(n),this.F=!1,this.D(!1),delete this.v),this.U&&this.U!==i&&this.V(o,this.regl),this.U=i,this.R=!0,this.l=!0}getCenter(){const e=this.getMap();if(!e)return null;const n=e1(e,super.getCenter()||this.getCoordinates());if(!n)return null;const i=this.q(),o=new ee([n[0]+i[0],n[1]+i[1],n[2]+i[2]]),s=e.getGLRes(),a=e.pointAtResToCoord(o,s);return a.z=o.z/e.altitudeToPoint(100,s)*100,a}getPointZ(){const e=this.getCoordinates(),n=this.getMap();return n&&e?n.altitudeToPoint(e.z||0,n.getGLRes()):null}getUrl(){const e=this._getInternalSymbol();return e&&e.url||"pyramid"}addTo(e){if(this.getLayer())throw new Error("GLTFMarker cannot be added to two or more layers at the same time.");return e.addGeometry(this),this}M(e,n){const i=this.getUrl();if(this.B=e,!this.F){const n=this.getLayer().getRenderer();e.loginGLTF(i,((...e)=>n.G.apply(n,e))),this.F=!0}const o=e.getGLTF(i);o&&!o.then&&(this.D(!0),this.j(o,e,n))}S(e,n){"effectmarker"===this.getGLTFMarkerType()?this.updateUV(n):"glowmarker"===this.getGLTFMarkerType()&&this.X();const i=this.getUniforms();if(i&&this.isDirty()&&this.H())for(const n in i)e.setUniform(n,i[n]);this.J()&&(e.transparent=!0),e.setUniform("uPickingId",this.W()),e.properties.isAnimated=this.isAnimated()}I(e){const n=this.getShader(),i=e.getDefines();let o=!1;if("pbr"===n||"pbr-lite"===n){const e=this.getLayer(),{iblTexes:n}=DT.PBRUtils.getIBLResOnCanvas(e.getRenderer().canvas);n?i.HAS_IBL_LIGHTING||(i.HAS_IBL_LIGHTING=1,o=!0):i.HAS_IBL_LIGHTING&&(o=!0,delete i.HAS_IBL_LIGHTING)}o&&e.setDefines(i);const s=this.getLayer().getRenderer();s&&s.updateMaskDefines(e)}V(e){const n=this.getUrl(),i=this.v;e&&i&&(e.isSimpleModel(n)?this.Z(i):e.getGLTF(n)&&(i.forEach((e=>{this.S(e)})),this.Z(i)))}Z(e){const n=this.getShader();e.forEach((e=>{const i=this.Y(e.properties.geometryResource);"wireframe"===n?(e.properties.geometryResource&&!e.properties.geometryResource.copyGeometry&&e.properties.geometryResource.copyEdgeGeometry(),e.geometry=e.properties.geometryResource.copyGeometry):e.geometry=e.properties.geometryResource.geometry,e.material=i}))}A(e,n){$v(w1,1,1,1);const i=xv(C1),o=this.isAnimated();this.p();const s=this.getModelMatrix(),{nodeMatrixMap:a,skinMap:h}=this.K(n);this.$(w1);let l=0;e.forEach((e=>{const n=e.properties.geometryResource.nodeIndex,c=a[n],A=o&&c?c:e.nodeMatrix;Mv(i,s,w1),Cv(i,i,I1),e.tt=e.tt||xv([]);const f=Cv(T1,e.tt,A);e instanceof wC?(e.positionMatrix=Cv(e.positionMatrix,i,f),e.localTransform=this.et(),this.nt(e)):e.localTransform=Cv(e.localTransform,i,f);const d=e.geometry.boundingBox.copy(S1);d.transform(e.positionMatrix,e.localTransform);const p=this.st(d);if(Math.abs(p)>Math.abs(l)&&(l=p),o){const i=h[n];i&&(e.material.set("skinAnimation",1),e.material.set("jointTextureSize",i.jointTextureSize),e.material.set("numJoints",i.numJoints),e.material.set("jointTexture",i.jointTexture));const o=e.geometry.properties.morphWeights;o&&this.it(o,e.material)}else e.material.set("skinAnimation",0)}));const c=this.rt();if(c&&(Mv(i,s,w1),Cv(i,i,I1),this.ot.localTransform=Cv(this.ot.localTransform,i,this.ot.ht)),0!==l){$v(P1,0,0,l);const n=Ov(C1,P1);e.forEach((e=>{if(e instanceof wC)e.positionMatrix=Cv(e.positionMatrix,n,e.positionMatrix),this.nt(e);else{const i=Cv(e.localTransform,n,e.localTransform);e.localTransform=i}})),c&&(this.ot.localTransform=Cv(this.ot.localTransform,n,this.ot.localTransform))}e.forEach((e=>{e instanceof wC&&this.nt(e)})),this.fire("updatematrix",{target:this})}getBoundingBoxCenter(){const e=this.ct,n=this.getMap();if(!e||!this.ot||!n)return null;const i=n.getGLRes(),{min:o,max:s}=e,a=t_([],o,s);r_(a,a,.5),A_(a,a,this.ot.localTransform);const h=new ee(a),l=n.pointAtResToCoordinate(h,i);return l.z=100/n.altitudeToPoint(100,i)*a[2],l}getBoundingBoxWidth(e){const n=this.ct;if(!n)return 0;let i=0;"x"===e?i=0:"y"===e?i=2:"z"===e&&(i=1);const{min:o,max:s}=n,a=this.lt()[i];return(s[i]-o[i])*a}getAxisXWidth(){return this.getBoundingBoxWidth("x")}getAxisYWidth(){return this.getBoundingBoxWidth("y")}getAxisZWidth(){return this.getBoundingBoxWidth("z")}$(e){const n=this.getMap(),i=n.getGLRes(),o=n.altitudeToPoint(100,i);return e[0]*=o/100,e[1]*=o/100,e[2]*=o/100,e}ut(e,n){const i=this.ct,o=n/Math.abs(i.max[1]-i.min[1]);return $v(e,o,o,o)}ft(e,n){const i=this.ct;if(!n||n<0||!i)return e;const o=this.getMap(),s=Math.abs(i.max[1]-i.min[1]),a=o.altitudeToPoint(s,o.getGLRes()),h=n*o.getGLScale()/a;return $v(e,h,h,h)}getCurrentPixelHeight(){const e=this.getBoundingBox();return Math.abs(e.max[2]-e.min[2])/this.getMap().getGLScale()}getFitTranslate(e){const n=this.ct,i=$v(e,(n.min[0]+n.max[0])/2,(n.min[1]+n.max[1])/2,(n.min[2]+n.max[2])/2);return r_(i,i,-1)}st(e){const n=this.getSymbol(),i=n&&n.anchorZ||"center";let o=0;const s=e.max[2]-e.min[2];return"bottom"===i?o=s/2:"top"===i&&(o=-s/2),o}K(e){const n=this.isAnimated(),i=this.dt(),o={},s=this.gt();if(e&&n&&this.gltfPack&&i){const n=this.bt();if(t1(n)){this.yt(e);const i=this._t(),a=this.isAnimationLooped(),h=this.getAnimationSpeed(),l=this.getSymbol(),c=l&&l.animationNodes;for(let l=0;l<n.length;l++)this.gltfPack.updateAnimation(e,a,h,n[l],i,o,s,c)}else console.warn("animation specified does not exist!")}return{nodeMatrixMap:o,skinMap:s}}j(e,n,i){const o=this.getUrl();this.N(e.json),this.wt(o,n,i),this.V(n,i),this.createdBygltfmarker||(this.fire("load",{data:e.json}),this.fire("setUrl-debug"),this._fireEvent("meshcreate",{url:o}))}wt(e,n,i){const o=[],s=this.getShader(),a=n.getGLTF(e);if(a&&a.resources){if(!a.resources.length)return void this._fireEvent("modelerror",{url:e,info:"there are no geomtries in the gltf model"});this.gltfPack=a.gltfPack,a.resources.forEach((e=>{const n=this.xt(e,s,i);o.push(n)}))}this.v=o,this.ct=this.Tt(),this.vt(this.v),this.fire("createscene-debug",{meshes:this.v})}vt(e){this.A(e);const n=this.getBoundingBox();if(!n)return;const i=this.getMap(),{max:o,min:s}=n;Yv([o[0]-s[0],o[1]-s[1],o[2]-s[2]])/i.getGLScale()<20&&(console.warn("Model's size on screen is too small, try to increase its symbol.scaleX/Y/Z"),this.fire("smallonscreen"))}rt(){if(this.ot)return this.ot.material.set("lineColor",this.Mt||F1),this.ot.material.set("lineOpacity",this.Ot||1),this.ot;const e=this.ct;if(!e)return null;const{min:n,max:i}=e;k1[0]=i[0],k1[1]=n[1],k1[2]=i[2],k1[3]=i[0],k1[4]=i[1],k1[5]=i[2],k1[6]=n[0],k1[7]=i[1],k1[8]=i[2],k1[9]=n[0],k1[10]=n[1],k1[11]=i[2],k1[12]=i[0],k1[13]=n[1],k1[14]=n[2],k1[15]=i[0],k1[16]=i[1],k1[17]=n[2],k1[18]=n[0],k1[19]=i[1],k1[20]=n[2],k1[21]=n[0],k1[22]=n[1],k1[23]=n[2];const o=new Lw({POSITION:k1},L1,0,{primitive:"lines",positionAttribute:"POSITION"});o.generateBuffers(this.regl);const s=new bC(o,new cC({lineColor:this.Mt||F1,lineOpacity:this.Ot||1}));return this.ot=s,this.ot.ht=_v([],s.localTransform),s}showBoundingBox(e){this.options.showDebugBoundingBox=!0,this.Mt=e&&e.lineColor,this.Ot=e&&e.lineOpacity,this.l=!0}hideBoundingBox(){this.options.showDebugBoundingBox=!1,this.l=!0}getBoundingBox(){const e=this.v;if(!e||!e.length)return null;if(!this.u)return this.At;"multigltfmarker"===this.getGLTFMarkerType()&&e.forEach((e=>{this.nt(e),e.updateBoundingBox()}));const n=e[0].getBoundingBox(),i=Kv([],n[0]),o=Kv([],n[1]);for(let n=1;n<e.length;n++){const s=e[n].getBoundingBox(),a=Kv([],s[0]),h=Kv([],s[1]);a[0]<i[0]&&(i[0]=a[0]),a[1]<i[1]&&(i[1]=a[1]),a[2]<i[2]&&(i[2]=a[2]),h[0]>o[0]&&(o[0]=h[0]),h[1]>o[1]&&(o[1]=h[1]),h[2]>o[2]&&(o[2]=h[2])}const s={min:i,max:o};return this.At=s,this.u=!1,s}Tt(){return this.gltfPack.getGLTFBBox()}xt(e,n,i){const o=this.St(e,n,i),s=o.getDefines();return o instanceof wC?(s.HAS_PICKING_ID=1,s.HAS_INSTANCE_COLOR=1):s.HAS_PICKING_ID=2,o.geometry.data.COLOR_0&&(s.HAS_COLOR0=1),s.HAS_MIN_ALTITUDE=1,s.HAS_LAYER_OPACITY=1,o.setDefines(s),o}St(e,n,i){const o=this.getGLTFMarkerType();let s=null;const a=this.Y(e);let h=e.geometry;if("wireframe"===n&&(e.copyEdgeGeometry(),h=e.copyGeometry),i?h.generateBuffers(i):(this.It=this.It||[],this.It.push(h)),"multigltfmarker"===o){this.Et();const e=this.Pt(xv(b1)),n=this.kt();s=new wC(e.attributesData,n,h,a),s.setUniform("instance",1),i?s.generateInstancedBuffers(i):(this.Lt=this.Lt||[],this.Lt.push(s))}else s=new bC(h,a),s.setUniform("instance",0);s.nodeMatrix=_v([],e.nodeMatrix),s.properties.geometryResource=e,s.properties.nodeIndex=e.nodeIndex,this.isBloom()&&(s.bloom=1),s.transparent=this.J(),"BLEND"===e.extraInfo.alphaMode&&(s.transparent=!0),s.properties.pickingId=this.W(),this.Nt(s);const l=this.getLayer();return Object.defineProperty(s.uniforms,"minAltitude",{enumerable:!0,get:()=>l.options.altitude||0}),s}Y(e){let n=null;const i=this.getShader(),o=this.getUniforms()||{},s=e.materialInfo||{},a=this.getLayer().getRenderer();if("phong"===i)if("pbrSpecularGlossiness"===s.name)n=new vC(s);else{for(const e in R1)o[e]=o[e]||R1[e];n=new dC(s)}else if("pbr"===i){if(n="pbrSpecularGlossiness"===s.name?new DT.StandardSpecularGlossinessMaterial(s):new DT.StandardMaterial(s),a.regl&&!DT.PBRUtils.isSupported(a.regl)){n=dC.convertFrom(n);for(const e in R1)o[e]=o[e]||R1[e]}}else n="pbr-lite"===i?new gC(s):new cC(s);const h=this.getSymbol(),l=h&&h.doubleSided;t1(l)&&(n.doubleSided=l);for(const e in o)n.set(e,o[e]);return e.morphWeights&&this.it(e.morphWeights,n),e.skin&&n.set("skinAnimation",0),n}it(e,n){const i=n.get("morphWeights1")||[],o=n.get("morphWeights2")||[];for(let n=0;n<4;n++)i[n]=e[n]||0,o[n]=e[n+4]||0;n.set("morphWeights1",i),n.set("morphWeights2",o)}Nt(e){const n=this.getSymbol();n&&n.uniforms?(e.setUniform("polygonFill",n.uniforms.polygonFill||O1),e.setUniform("polygonOpacity",void 0===n.uniforms.polygonOpacity?1:n.uniforms.polygonOpacity),e.setUniform("lineColor",n.uniforms.lineColor||O1),e.setUniform("lineOpacity",void 0===n.uniforms.lineOpacity?1:n.uniforms.lineOpacity)):(e.setUniform("polygonFill",O1),e.setUniform("polygonOpacity",1),e.setUniform("lineColor",O1),e.setUniform("lineOpacity",1))}Ct(){const e=this.getLayer();if(!e)return null;const n=e.getMap();if(!n)return null;const i=this.getBoundingBox();if(!i)return null;const o=this.getPointZ()||0,s=i.min,a=i.max,h=E_(_1,(s[0]+a[0])/2,(s[1]+a[1])/2,s[2]+o,1),l=E_(x1,(s[0]+a[0])/2,(s[1]+a[1])/2,a[2]+o,1),c=G_(h,h,n.projViewMatrix),A=G_(l,l,n.projViewMatrix),f=(c[0]/c[3]+1)*n.width/2,d=(1-c[1]/c[3])*n.height/2,p=(A[0]/A[3]+1)*n.width/2,g=(1-A[1]/A[3])*n.height/2,v=Math.min(f,p),w=Math.max(f,p),C=Math.min(d,g),P=Math.max(d,g);return new al({xmin:v,ymin:C,xmax:w,ymax:P})}onAdd(){const e=this.getLayer().getMap();if(e&&!t1(this.Rt)){const n=e.getZoom();this.Rt=n}}onRemove(){this.Bt()}remove(){const e=this.getUrl();if(this.B&&(delete this.v,this.B.logoutGLTF(e),delete this.B),this.Ft){for(const e in this.Ft)this.Ft[e]&&this.Ft[e].jointTexture&&this.Ft[e].jointTexture.destroy();delete this.Ft}this.ot&&(this.ot.geometry.dispose(),this.ot.dispose(),delete this.ot),this.v&&this.v.forEach((e=>{e.dispose(),e.properties.bloomMesh&&(e.properties.bloomMesh.dispose(),delete e.properties.bloomMesh)})),this.F=!1,delete this.k,delete this.gltfPack,super.remove()}show(){return super.updateSymbol({visible:!0}),this}hide(){super.updateSymbol({visible:!1})}setBloom(e){return this.updateSymbol({bloom:e}),this}isBloom(){const e=this._getInternalSymbol();return e&&e.bloom}setCastShadow(e){return super.updateSymbol({shadow:e}),this}isCastShadow(){const e=this._getInternalSymbol();return e&&(e.shadow||void 0===e.shadow)}outlineNodes(e){const n=this.v;return n?(n.forEach((n=>{e.indexOf(n.properties.nodeIndex)>-1&&(n.properties.outline=!0)})),this.l=!0,this):this}outline(){this.updateSymbol({outline:!0});const e=this.v;return e?(e.forEach((e=>{e.properties.outline=!0})),this.l=!0,this):this}cancelOutline(e){this.updateSymbol({outline:!1});const n=this.v;return n?(n.forEach((n=>{e?e.indexOf(n.properties.nodeIndex)>-1&&(n.properties.outline=!1):n.properties.outline=!1})),this.l=!0,this):this}isOutline(){const e=this._getInternalSymbol();return!(!e||!t1(e.outline))&&e.outline}isVisible(){const e=this._getInternalSymbol();return!e||!t1(e.visible)||e.visible}setCoordinates(e){return super.setCoordinates(e),this.l=!0,this.u=!0,this}copy(){const e=this.toJSON(),n=lt.fromJSON(e);return n.setZoomOnAdded(this.Rt),n}setShader(e){return super.updateSymbol({shader:e}),this}getShader(){const e=this._getInternalSymbol();return e&&e.shader||"pbr"}setUniforms(e){return super.updateSymbol({uniforms:e}),this.R=!0,this}getUniforms(){const e=this._getInternalSymbol();return e&&e.uniforms}setUniform(e,n){const i=this.getUniforms()||{};return i[e]=n,super.updateSymbol({uniforms:i}),this.R=!0,this}getUniform(e){const n=this._getInternalSymbol();return n&&n.uniforms&&n.uniforms[e]}isAnimated(){const e=this._getInternalSymbol();return e&&e.animation&&this.k&&this.k.animations}isDashAnimated(){const e=this._getInternalSymbol();return e&&e.uniforms&&e.uniforms.dashEnabled&&e.uniforms.dashAnimate}setAnimation(e){return super.updateSymbol({animation:e}),delete this.Dt,this}setAnimationLoop(e){return super.updateSymbol({loop:e}),delete this.Dt,this.l=!0,this}isAnimationLooped(){const e=this._getInternalSymbol();return e&&e.loop}getAnimationSpeed(){const e=this._getInternalSymbol();return e&&t1(e.speed)?e.speed:1}setAnimationSpeed(e){return super.updateSymbol({speed:e}),this}Ut(e){const n=this.getMap();return n?e1(n,e||this.getCoordinates()):null}setTRS(e,n,i){const o=e||this.m.translation;return this.updateSymbol({translationX:o[0],translationY:o[1],translationZ:o[2],rotationX:n[0],rotationY:n[1],rotationZ:n[2],scaleX:i[0],scaleY:i[1],scaleZ:i[2]}),this}Vt(){const e=this.q(),n=this.Ut();return n?t_(e,e,n):e}updateSymbol(e){for(const n in e)if("bloom"===n&&this.v&&this.v.forEach((i=>{i.bloom=+!!e[n]})),D1.has(n)){this.u=!0;break}return super.updateSymbol(e)}setTranslation(e,n,i){return this.updateSymbol({translationX:e,translationY:n,translationZ:i}),this}setRotation(e,n,i){return this.updateSymbol({rotationX:e,rotationY:n,rotationZ:i}),this}rotateAround(e,n){const i=this.getMap();if(!i)return;const o=i.getGLRes();let s=this.getCoordinates();const a=i.coordinateToPointAtRes(s,o),h=i.coordinateToPointAtRes(e,o),l=a.x-h.x,c=a.y-h.y,A=180*Math.atan2(c,l)/Math.PI+n,f=Math.sqrt(l*l+c*c),d=Math.PI*A/180,p=f*Math.cos(d)+h.x,g=f*Math.sin(d)+h.y;E1.set(p,g),s=i.pointAtResToCoordinate(E1,o),this.setCoordinates(s),this.updateSymbol({rotationZ:A})}setScale(e,n,i){return this.updateSymbol({scaleX:e,scaleY:n,scaleZ:i}),this}getTranslation(){const e=this._getInternalSymbol();return $v(this.m.translation,e&&e.translationX||0,e&&e.translationY||0,e&&e.translationZ||0)}q(){const e=this.getTranslation();return this.getMap()?this.qt(e):this.m.translation}qt(e){const n=this.getMap(),i=n.distanceToPointAtRes(e[0],e[1],n.getGLRes(),E1),o=n.altitudeToPoint(e[2],n.getGLRes());return $v(P1,n1(i.x,e[0]),n1(i.y,e[1]),n1(o,e[2]))}getRotation(){const e=this._getInternalSymbol();return $v(this.m.rotation,e&&e.rotationX||0,e&&e.rotationY||0,e&&e.rotationZ||0)}getScale(){const e=this._getInternalSymbol();return $v(this.m.scale,e&&e.scaleX||1,e&&e.scaleY||1,e&&e.scaleZ||1)}lt(){const e=this.getScale();if(this.ct){const n=this.O(),i=this.getModelHeight();if(n&&n>0){const i=this.ft(M1,n);return n_(i,i,e)}if(i){const n=this.ut(M1,i);return n_(n,n,e)}}return e}cancelMarkerPixelHeight(){return this.updateSymbol({markerPixelHeight:null})}setAnchorZ(e){return this.updateSymbol({anchorZ:e}),this}getAnchorZ(){const e=this._getInternalSymbol();return e&&e.anchorZ||"bottom"}_setExternSymbol(e){return this.l=!0,super._setExternSymbol(e)}Gt(e){return kD(e,(()=>{const e=this.getMap();return e?[e.getZoom()]:null}))}_prepareSymbol(e){super._prepareSymbol(e);const n=this.Gt(e);return n&&n.uniforms&&(n.uniforms=this.Gt(e.uniforms)),delete this.jt,n}hasFunctionDefinition(){if(t1(this.jt))return this.jt;const e=this._getInternalSymbol();return this.jt=OD(e)||e&&e.uniforms&&OD(e.uniforms),this.jt}setModelMatrix(e){const n=Lv(this.m.translation,e),i=Nv(this.m.rotation,e),o=Fv(this.m.scale,e);return this.setTranslation(n[0],n[1],n[2]),this.setRotation(i[0],i[1],i[2]),this.setScale(o[0],o[1],o[2]),this}getModelMatrix(){return this.o}p(){const e=this.Vt(),n=this.getRotation(),i=Ax(v1,n[0],n[1],n[2]),o=this.lt();this.o=zv(this.o,i,e,o)}isDirty(){return this.l}P(e){return this.l=e,this}Xt(){const e=this.toJSON();return e.zoomOnAdded=this.Rt,e}toJSON(){const e=JSON.parse(JSON.stringify({coordinates:this.getCoordinates(),options:this.options||{},type:"GLTFMarker"})),n=this.getId();Yo.isNil(n)||(e.options.id=n);const i=this.getProperties();i&&(e.options.properties=JSON.parse(JSON.stringify(i)));const o=this.getSymbol();return o&&(e.options.symbol=JSON.parse(JSON.stringify(o))),e}setZoomOnAdded(e){this.Rt=e}getZoomOnAdded(){return this.Rt}J(){return this.T()<1}T(){const e=this.getUniforms(),n=this.getShader();return"pbr"===n||"phong"===n?e&&t1(e.polygonOpacity)?e.polygonOpacity:1:"wireframe"===n&&e&&t1(e.lineOpacity)?e.lineOpacity:1}D(e){this.i=e}isLoaded(){return this.i}getGLTFMarkerType(){return this.h}Ht(e){this.zt=e}W(){return this.zt}getCount(){return 1}getContainerExtent(){return this.Ct()}getGLTFAsset(){return this.k&&this.k.asset}openInfoWindow(e){this.k?super.openInfoWindow(e):this.once("load",(()=>{super.openInfoWindow(e)}))}getAnimations(){if(!this.k)return null;const e=this.k,n=e.animations?e.animations.map(((e,n)=>({name:t1(e.name)?e.name:n}))):null;return n?n.map(((e,n)=>e.name||n)):null}getCurrentAnimation(){const e=this._getInternalSymbol();return e&&e.animationName}bt(){const e=this.getAnimations();if(!e)return null;let n=this.getCurrentAnimation();if(!t1(n))return e.slice(0,1);const i=[];n=Array.isArray(n)?n:[n];for(let o=0;o<n.length;o++)e.indexOf(n[o])>-1&&i.push(n[o]);return i.length?i:null}setCurrentAnimation(e){this.updateSymbol({animationName:e})}yt(e){t1(this.Dt)||(this.Dt=e)}_t(){return this.Dt||0}gt(){return this.Ft=this.Ft||{},this.Ft}O(){const e=this._getInternalSymbol();return e&&e.markerPixelHeight}setModelHeight(e){return this.updateSymbol({modelHeight:e}),this}getModelHeight(){const e=this._getInternalSymbol();return e&&e.modelHeight}getGLTFBBox(){return this.ct}zoomTo(e,n={animation:!1}){const i=this.getBoundingBox(),o=this.getMap();if(!o||!i)return;const{min:s,max:a}=i;E1.set(s[0],s[1]);const h=o.pointAtResToCoordinate(E1,o.getGLRes());E1.set(a[0],a[1]);const l=o.pointAtResToCoordinate(E1,o.getGLRes()),c=new al(h,l);o.fitExtent(c,e,n,(e=>{"finished"===e.state.playState&&this.Jt(s,a,c)})),!1===n.animation&&this.Jt(s,a,c)}Jt(e,n,i){const o=this.getMap(),s=o.getGLRes(),a=(e[2]+n[2])/2/o.altitudeToPoint(1,s),h=o.cameraPosition,l=o.pointAtResToCoordinate(new ee(h),s),c=h[2]/o.altitudeToPoint(1,s);l.z=c+a,o.setCameraOrientation({position:[l.x,l.y,l.z],pitch:o.getPitch(),bearing:o.getBearing()}),this.fire("zoomtoend",{target:this,extent:i})}H(){return this.R}Wt(){this.R=!1}setAnimationTimeframe(e){const n=this._t(),i=this.gt();this.gltfPack.updateAnimation(e,this.isAnimationLooped(),this.getAnimationSpeed(),n,{},i)}Bt(){delete this.At,delete this.Rt}dt(){return"effectmarker"!==this.getGLTFMarkerType()&&"glowmarker"!==this.getGLTFMarkerType()}_onEvent(e,n){const i=this.getLayer();if(!i)return;const o=i.getId();this.Zt=e.gltfPickingInfo&&e.gltfPickingInfo[o]||{},super._onEvent(e,n)}_fireEvent(e,n){for(const e in this.Zt)n[e]=this.Zt[e];delete this.Zt,super._fireEvent(e,n)}Yt(){let e=[];return this.v&&this.isVisible()&&this.T()?this.isOutline&&this.isOutline()?this.v:(e=this.v.filter((e=>e.properties.outline)),e):e}highlightNodes(e){const n=this.v;n?this.Kt(e,n):this.once("load",(()=>{this.Kt(e,this.v)}),this)}Kt(e,n){e.forEach((e=>{n.forEach((n=>{n.properties.nodeIndex===e.nodeIndex&&this.$t(n,e.color,e.opacity,e.bloom)}))})),this.l=!0}highlight(e){const{color:n,opacity:i,bloom:o}=e,s=this.v;s?(s.forEach((e=>{this.$t(e,n,i,o)})),this.l=!0):this.once("load",(()=>{this.v.forEach((e=>{this.$t(e,n,i,o)})),this.l=!0}),this)}$t(e,n,i,o){e.properties.polygonFill||(e.properties.polygonFill=e.getUniform("polygonFill")||O1),e.properties.polygonOpacity||(e.properties.polygonOpacity=e.getUniform("polygonOpacity")||1),e.setUniform("polygonFill",n||O1),e.setUniform("polygonOpacity",i||1),e.bloom=o}Qt(){if(this.te)if(Array.isArray(this.te)){const e=this.te.map((e=>e.nodeIndex));this.cancelHighlight(e)}else this.cancelHighlight(this.te.nodeIndex)}cancelHighlight(e){const n=this.getLayer();if(!n)return;const i=n.getRenderer();if(!i)return;let o=this.v;if(o){if(e){let n=e;Array.isArray(n)||(n=[n]),o=o.filter((e=>n.indexOf(e.properties.nodeIndex)>-1))}o.forEach((e=>{const{polygonFill:n,polygonOpacity:i}=e.properties;e.setUniform("polygonFill",n),e.setUniform("polygonOpacity",i),e.bloom=!1})),i.setToRedraw()}}setNodeTRS(e,n={}){const i=this.v;if(!i)return;const o=n.translation||this.m.translation,s=n.rotation||this.m.rotation,a=Ax(v1,s[0],s[1],s[2]),h=n.scale||this.m.scale;return i.forEach((n=>{n.properties.nodeIndex===e&&(n.tt=zv(n.tt||[],a,o,h))})),this.A(i),this.l=!0,this}};N1.mergeOptions({symbol:null}),N1.registerJSONType("GLTFMarker");const z1=[1,1,1,1],B1=[],H1=[],j1=[1,1,1],U1=new Zh(0,0),G1=[1,1,1],V1=[1,1,1];let W1=class yt extends N1{constructor(e,n){super(null,n),this.ee=e||[],this.ne=[],this.se=[0,0,0],this.ie=xv([]),this.h="multigltfmarker",this.re=[]}static fromJSON(e){return new yt(e.data,e.options)}setCoordinates(e){return this.oe=Array.isArray(e[0])?e.map((e=>new Zh(e))):e,this.updateAllData("coordinates",this.oe),this.l=!0,this}getCoordinates(e){if(e&&this.ee&&this.ee.length){return this.ee[e.index].coordinates}return null}addData(e){return this.ee||(this.ee=[]),this.ee.push(e),this.l=!0,this}removeData(e){this.ee.splice(e,1),this.ne&&this.ne.splice(e,1);const n=this.getLayer();return n&&n.ae(),this.l=!0,this}getData(e){return this.ee[e]}updateData(e,n,i){return this.ee[e][n]=i,this.l=!0,this}getAllData(){return this.ee}updateAllData(e,n){for(let i=0;i<this.ee.length;i++)this.updateData(i,e,n[i]);return this}removeAllData(){this.ee&&(this.ee=[],this.ne=[],this.l=!0)}Et(){const e=this.getMap();if(this.ee&&e){this.he(),this.ne=this.ne||[];for(let e=0;e<this.ee.length;e++)if(!1!==this.ee[e].visible){const n=this.ce(e);this.ne[e]=n}}}openInfoWindow(e){let n=null;n=t1(e)&&this.ee[e]?this.ee[e].coordinates:this.getCenter(),super.openInfoWindow(n)}getCenter(){let e=0,n=0,i=0,o=0;for(let s=0,a=this.ee.length;s<a;s++){let a=this.ee[s].coordinates;a instanceof Zh&&(a=a.toArray()),e+=a[0],n+=a[1],i+=a[2]||0,o++}return 0===o?null:U1.set(e/o,n/o,i/o)}getMap(){return super.getMap()||this.t&&this.t.getMap()}le(e){this.t=e}getLayer(){return super.getLayer()||this.t}he(){const e=this.getMap(),n=this.getCenter();if(!n)return;this.se=e1(e,n);const i=Ax(H1,0,0,0);zv(this.ie,i,this.se,j1)}ce(e){const n=this.ee[e],i=this.Ut(n.coordinates);if(!i)return null;const o=m_(B1,i,this.se),s=this.qt(n.translation||this.m.translation),a=t_(B1,s||this.m.translation,o||this.m.translation),h=n.rotation||this.m.rotation,l=this.ue(e),c=Ax(H1,h[0]||0,h[1]||0,h[2]||0);return zv(this.ne[e]||[],c,a,l)}ue(e){const n=this.ee[e],{modelHeight:i,markerPixelHeight:o}=n,s=n.scale||this.m.scale;if(this.ct){if(o&&o>0){const e=this.ft(G1,o);return n_(e,e,s)}if(i){const e=this.ut(G1,i);return n_(e,e,s)}}return s}D(e){if(super.D(e),this.ee)for(let n=0;n<this.ee.length;n++){const i=this.ee[n];i.target&&i.target instanceof N1&&i.target.D(e)}}p(){super.p(),this.Et()}fe(){this.de={instance_vectorA:[],instance_vectorB:[],instance_vectorC:[],instance_color:[],aPickingId:[],aOutline:[],highlight_color:[],aBloom:[]},this.me={instance_vectorA:[],instance_vectorB:[],instance_vectorC:[],instance_color:[],aPickingId:[],aOutline:[],highlight_color:[],aBloom:[]};for(let e=0;e<this.ne.length;e++){let n=this.de;this.ee[e].bloom&&(n=this.me);const i=this.ne[e],o=n.instance_vectorA.length/4;this.ge(n,"instance_vectorA",o,i,0),this.ge(n,"instance_vectorB",o,i,1),this.ge(n,"instance_vectorC",o,i,2);const s=this.ee[e].color||z1,a=this.ee[e].highlightColor||z1;n.instance_color[4*o]=s[0],n.instance_color[4*o+1]=s[1],n.instance_color[4*o+2]=s[2],n.instance_color[4*o+3]=s[3],n.aPickingId[o]=this.W()+e,n.aOutline[o]=this.ee[e].outline?1:0,n.highlight_color[4*o]=a[0],n.highlight_color[4*o+1]=a[1],n.highlight_color[4*o+2]=a[2],n.highlight_color[4*o+3]=a[3],n.aBloom[o]=this.ee[e].bloom?1:0}return{attributesData:this.de,bloomAttributesData:this.me}}nt(e){const{attributesData:n,bloomAttributesData:i}=this.Pt();for(const i in n)e.updateInstancedData(i,n[i]);if(this.regl?e.generateInstancedBuffers(this.regl):(this.Lt=this.Lt||[],this.Lt.push(e)),e.instanceCount=this.de.instance_vectorA.length/4,this.pe()){const n=i,o=n.aBloom.length;e.properties.bloomMesh=e.properties.bloomMesh||new wC(n,o,e.geometry,e.material);const s=e.properties.bloomMesh;s.positionMatrix=e.positionMatrix,s.localTransform=e.localTransform;for(const e in n)s.updateInstancedData(e,n[e]);s.generateInstancedBuffers(this.regl);const a=e.getDefines();s.setDefines(a),s.uniforms=e.uniforms,s.bloom=1,s.instanceCount=o}else e.properties.bloomMesh&&(e.properties.bloomMesh.dispose(),delete e.properties.bloomMesh)}be(e,n,i,o){this.me[e]&&i&&(this.me[e][4*n]=i[o],this.me[e][4*n+1]=i[o+4],this.me[e][4*n+2]=i[o+8],this.me[e][4*n+3]=i[o+12])}pe(){return this.me&&this.me.aBloom.length}ge(e,n,i,o,s){e[n]&&o&&(e[n][4*i]=o[s],e[n][4*i+1]=o[s+4],e[n][4*i+2]=o[s+8],e[n][4*i+3]=o[s+12])}Pt(e){return!this.l&&this.de?{attributesData:this.de,bloomAttributesData:this.me}:this.fe(e)}et(){return this.ie}getCount(){return this.ee.length}ye(){return this.Et(),this.me?this.me.aBloom.length:0}kt(){return this.getCount()-this.ye()}toJSON(){const e=JSON.parse(JSON.stringify({data:this.ee,options:this.options,type:"MultiGLTFMarker"})),n=this.getProperties();return e.options&&(e.options.properties=n),e}getIndexByPickingId(e){return e-this.W()}outline(e){return t1(e)&&this.updateData(e,"outline",!0),this}cancelOutline(e){return t1(e)&&this.updateData(e,"outline",!1),this}isOutline(){if(!this.ee||!this.ee.length)return!1;for(let e=0;e<this.ee.length;e++)if(this.ee[e].outline)return!0;return!1}J(){const e=this.getAllData();for(let n=0;n<e.length;n++){const i=e[n].color;if(i&&i[3]<1)return!0}return!1}highlightNodes(e,n){const i=this.v;if(!i)return;const o=this.ee[e];o&&(n.forEach((e=>{i.forEach((n=>{if(n.properties.nodeIndex===e.nodeIndex){const{color:i,opacity:s,bloom:a}=e;o.highlightColor=i||V1,o.highlightColor[3]=s||1,o.highlightBloom=a;const h=n.getDefines();h.HAS_INSTANCE_HIGHLIGHT=1,n.setDefines(h)}}))})),this.l=!0)}highlight(e,n){const{color:i,opacity:o,bloom:s}=n,a=this.v;if(!a)return;const h=this.ee[e];h&&(h.highlightColor=i||V1,h.highlightColor[3]=o||1,h.highlightBloom=s,a.forEach((e=>{const n=e.getDefines();n.HAS_INSTANCE_HIGHLIGHT=1,e.setDefines(n)})),this.l=!0)}cancelHighlight(e,n){let i=this.v;if(!i)return;const o=this.ee[e];if(o){if(n){let e=n;Array.isArray(e)||(e=[e]),i=i.filter((n=>e.indexOf(n.properties.nodeIndex)>-1))}i.forEach((e=>{const n=e.getDefines();delete n.HAS_INSTANCE_HIGHLIGHT,e.setDefines(n),o.highlightColor=V1,o.highlightColor[3]=1,o.highlightBloom=0})),this.l=!0}}};W1.registerJSONType("MultiGLTFMarker");const q1=[],Z1=[],Q1=["points","lines","line strip","line loop"];let X1=class Tt extends(LO(Mm.OverlayLayerCanvasRenderer)){constructor(e){super(e),this._e={},this.we=[],this.xe={}}onAdd(){super.onAdd(),this.prepareWorker()}draw(e,n){this.prepareCanvas(),this.Te(n,e)}drawOnInteracting(e,n,i){this.Te(i,n)}Te(e,n){this.ve=e,this.Me=n;let i=0;this.Oe(e),this.Ae={},this.Se(e);const o=this.Ie(e);this.Ee(n);const s=e&&e.renderTarget?e.renderTarget.fbo:null;let a=0;for(const n in this._e){if("pointline"===n)continue;if(e){const{newShader:i,uniforms:s}=this.Pe(e,n);this._e[n].shader=i,Yo.extend(o,s)}const h=this.ke(n),l=this._e[n].shader;l.filter=e&&e.sceneFilter||null,a+=this.renderer.render(l,o,h,s),i++}const h=this.ke("pointline");if(h.getMeshes().length){o.pointSize=this.layer.options.pointSize||1;const n=this._e.pointline.shader;n.filter=e&&e.sceneFilter||null,a+=this.renderer.render(n,o,h,s),i++}this.Le(o,s),a&&this.layer.fire("canvasisdirty",{renderCount:a}),this.Ne=!0,this.completeRender(),this.layer.fire("rendercomplete-debug",{count:i})}Le(e,n){this.Ce||(this.Ce=new kC);const i=this.layer.getGeometries(),o=[];for(let e=0;e<i.length;e++){if(!i[e].options.showDebugBoundingBox)continue;const n=i[e].rt();n&&o.push(n)}o.length&&(this.Ce.setMeshes(o),this.renderer.render(this._e.wireframe.shader,e,this.Ce,n))}Re(e){const n=e.getUniform("polygonFill")||[1,1,1,1],i=e.getUniform("polygonOpacity")||1;return n[3]=i,{coordinates:e.getCoordinates(),translation:e.getTranslation(),rotation:e.getRotation(),scale:e.getScale(),visible:e.isVisible(),color:n,bloom:e.isBloom(),outline:e.isOutline(),modelHeight:e.getModelHeight(),markerPixelHeight:e.O(),anchorZ:e.getAnchorZ(),pickingId:e.W(),target:e}}Be(e){const n=this.Re(e),i=new W1([n],{symbol:{url:e.getUrl(),shader:e.getShader(),shadow:e.isCastShadow()}});return i.Fe=i.Fe||[],e.De=!0,i.Fe.push(e),i.le(e.getLayer()),i}Ue(){for(const e in this.xe)this.xe[e].removeAllData()}Ve(e,n){const i=e.getMeshes(this.B,this.regl,n),o=e.getShader();if(i.length){this.we.push(e),this.Ae[o]=this.Ae[o]||[],Yo.pushIn(this.Ae[o],i);for(let e=0;e<i.length;e++)i[e].properties.bloomMesh&&this.Ae[o].push(i[e].properties.bloomMesh)}}Ee(e){this.we.length=0;const n=this.layer.getGeometries();this.qe()&&this.Ue();for(let i=0;i<n.length;i++){const o=n[i],s=o.getUrl();if(o instanceof W1||o.isAnimated()||!o.De)this.Ve(o,e);else if(this.qe()){const e=`${s}_${o.getShader()}_${o.isCastShadow()?1:0}`;this.xe[e]?this.xe[e].addData(this.Re(o)):this.xe[e]=this.Be(o)}}for(const n in this.xe){const i=this.xe[n];i.createdBygltfmarker=!0,this.Ve(i,e)}}Ie(){const e={};this.Ge.outSize=[this.canvas.width,this.canvas.height],this.Ge.halton=[0,0];e.layerOpacity=this.canvas.gl&&this.canvas.gl.wrap?this.layer.options.opacity||0:1,Yo.extend(e,this.Ge);const n=this.getMaskUniforms();return Yo.extend(e,n),e}ke(e){const n=[],i=[];if("pointline"===e){for(const e in this.Ae)"wireframe"!==e&&this.Ae[e].forEach((e=>{Q1.indexOf(e.geometry.desc.primitive)>-1&&n.push(e)}));const e=new kC(n);return e.sortMeshes(this.Ge.cameraPosition),e}for(const n in this.Ae){n===e&&this.Ae[n].forEach((n=>{(Q1.indexOf(n.geometry.desc.primitive)<0||"wireframe"===e)&&i.push(n)}))}const o=this.je=this.je||new kC;return o.setMeshes(i),o.sortMeshes(this.Ge.cameraPosition),o}needToRedraw(){return!!super.needToRedraw()||this.qe()}qe(){const e=this.layer.getGeometries();for(let n=0;n<e.length;n++)if(this.we.indexOf(e[n])>-1&&(e[n].isDirty()||e[n].isAnimated()))return!0;return!1}onRemove(){this.workerConn&&(this.workerConn.removeLayer(this.layer.getId(),(e=>{if(e)throw e})),this.workerConn.remove(),delete this.workerConn),super.onRemove()}hitDetect(){return!1}createContext(){const e=this.canvas.gl&&this.canvas.gl.wrap;if(e)this.gl=this.canvas.gl.wrap(),this.regl=this.canvas.gl.regl;else{const e=this.layer.options.glOptions||{alpha:!0,depth:!0,stencil:!0};this.glOptions=e,this.gl=this.gl||this.Xe(this.canvas,e),this.regl=jm({gl:this.gl,optionalExtensions:["ANGLE_instanced_arrays","OES_element_index_uint","OES_standard_derivatives","OES_vertex_array_object","OES_texture_half_float","OES_texture_half_float_linear","OES_texture_float","OES_texture_float_linear","WEBGL_depth_texture","EXT_shader_texture_lod","WEBGL_compressed_texture_s3tc"]})}e&&(this.canvas.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height)),this.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height),this.B=this.regl.gltfManager=this.regl.gltfManager||this.He(),this.ze(),this.Lt&&this.Lt.forEach((e=>{e.generateInstancedBuffers(this.regl)})),this.It&&this.It.forEach((e=>{e.generateBuffers(this.regl)})),this.layer.fire("contextcreate",{regl:this.regl})}getGLTFManager(){return this.B}He(){return new lM(this.regl)}ze(){const e=this.layer.getMap(),n=new PC(this.regl);this.renderer=n,this.Ge={projMatrix:e.projMatrix,projViewMatrix:e.projViewMatrix,viewMatrix:e.viewMatrix,cameraPosition:e.cameraPosition,altitudeScale:1},DT.PBRUtils.loginIBLResOnCanvas(this.canvas,this.regl,e),this.Je=new XM(n,{vert:"#include <gl2_vert>\n\nattribute vec3 aPosition;\n\nuniform mat4 projMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform mat4 modelViewMatrix;\n\nuniform float pointSize;\n\n#include <fbo_picking_vert>\n\n#include <get_output>\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    gl_Position = projMatrix * modelViewMatrix * localPositionMatrix * getPosition(aPosition);\n\n    gl_PointSize = pointSize;\n\n    fbo_picking_setData(gl_Position.w, true);\n\n}\n\n",uniforms:[{name:"modelViewMatrix",type:"function",fn:function(e,n){return Cv([],n.viewMatrix,n.modelMatrix)}}]},this.pickingFBO,e)}prepareWorker(){this.workerConn||(this.workerConn=new h1("@maptalks/gltf-layer",this.layer));const e=this.workerConn;if(!e.isActive())return;const n=this.layer.options||{},i=this.layer.getId();e.addLayer(i,{markerType:n.markerTypes,pointSize:n.pointSize},(e=>{if(e)throw e;this.layer&&(this.ready=!0,this.layer.fire("workerready"))}))}G(e){let n;if(this.layer.getURLModifier()){n=g1(null,e,this.layer.options.fetchOptions,(e=>{const n=this.layer.getURLModifier();return n?n(e):e}))}else n=this.workerConn.loadGLTF(e);return n.then((e=>(this.setToRedraw(),this.We=!0,e))).catch((n=>{console.error(n),this.layer.fire("modelerror",{type:"modelerror",url:e,info:n})}))}Se(e){const n=s1;for(const i in n){if(this._e[i])continue;const o=n[i];this.Ze(e,o.name,o.type,o.config)}}Ze(e,n,i,o){this.viewport||(this.viewport={x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1}),o.extraCommandProps||(o.extraCommandProps={});const s={};e&&this.Ye(s,q1,e);const a=Yo.extend({},o);a.extraCommandProps=Yo.extend({},o.extraCommandProps),a.extraCommandProps.viewport=this.viewport,a.uniforms=Yo.extend([],o.uniforms,q1),a.defines=Yo.extend({},a.defines,s),i.indexOf(".")>-1?(i=i.split("."),this._e[n]={shader:new kT[i[0]][i[1]](a),type:i}):this._e[n]={shader:new kT[i](a),type:i}}remove(){this.Ke();const e=this._e;for(const n in e)e[n].shader.dispose();this.extentShader&&this.extentShader.dispose(),super.remove()}clearCanvas(){this.canvas&&(this.regl.clear({color:[0,0,0,0],depth:1,stencil:0}),super.clearCanvas())}resizeCanvas(e){super.resizeCanvas(e),this.pickingFBO&&this.pickingFBO.resize(this.canvas.width,this.canvas.height),this.layer.fire("resizecanvas",{size:e})}getFrameTimestamp(){return this.Me}getFrameContext(){return this.ve}needRetireFrames(){return this.We}Ye(e,n,i){const o=i&&i.includes;if(o)for(const s in o)o[s]&&(i[s].uniformDeclares&&(n.length=0,n.push(...i[s].uniformDeclares)),i[s].defines&&Yo.extend(e,i[s].defines))}$e(e,n){const i=n&&n.includes;if(i)for(const o in i)i[o]&&n[o].renderUniforms&&Yo.extend(e,n[o].renderUniforms)}Pe(e,n){const{shader:i,type:o}=this._e[n];let s=null;const a={};if(this.$e(a,e),e.states.includesChanged){const n={};this.Ye(n,q1,e);const a={vert:i.vert,frag:i.frag,uniforms:i.uniforms,extraCommandProps:i.extraCommandProps};a.defines=n,a.uniforms=Yo.extend([],a.uniforms,q1),s=Array.isArray(o)?new kT[o[0]][o[1]](a):new kT[o](a),i.dispose()}else s=i;return{uniforms:a,newShader:s}}Qe(e,n,i){if(e.viewshed){for(const n in e.viewshed.renderUniforms)i[n]=e.viewshed.renderUniforms[n];Yo.extend(n.shaderDefines,e.viewshed.defines)}if(e.floodAnalysis){for(const n in e.floodAnalysis.renderUniforms)i[n]=e.floodAnalysis.renderUniforms[n];Yo.extend(n.shaderDefines,e.floodAnalysis.defines)}return i}getShadowMeshes(){const e=[];if(!this.layer||!this.layer.isVisible()||!this.Ae)return e;const n=this.layer.getGeometries();for(let i=0;i<n.length;i++)if(n[i].isCastShadow()&&n[i].isVisible()&&n[i].T()&&!n[i].De){Yo.pushIn(e,n[i].v||[])}for(const n in this.xe){const i=this.xe[n];if(i.isCastShadow()&&i.isVisible()&&i.T()){Yo.pushIn(e,i.v||[])}}return e}tn(){const e=[];if(!this.Ae||!Object.keys(this.Ae).length)return e;for(const n in this.Ae)Yo.pushIn(e,this.Ae[n]);return e}getAnalysisMeshes(){return this.tn()}getRayCastData(e){const n=this.layer.getGeometries();for(let i=0;i<n.length;i++){const o=n[i].v;if(o&&o.indexOf(e)>-1)return n[i]}return null}drawOutline(e){this.extentShader||(this.extentShader=new eP({vert:"attribute vec3 aPosition;\n\nattribute float aOutline;\n\nuniform mat4 projMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 modelViewMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform float instance;\n\n#include <get_output>\n\n\n\nvarying float vOutline;\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    gl_Position = projMatrix * modelViewMatrix * localPositionMatrix * getPosition(aPosition);\n\n    if (instance == 0.0) {\n\n        vOutline = 1.0;\n\n    } else {\n\n        vOutline = aOutline;\n\n    }\n\n}\n\n",frag:"precision highp float;\n\nvarying float vOutline;\n\nvoid main() {\n\n    gl_FragColor = vec4(vOutline);\n\n}\n\n",uniforms:[{name:"modelViewMatrix",type:"function",fn:(e,n)=>Cv([],n.viewMatrix,n.modelMatrix)}],positionAttribute:"POSITION",extraCommandProps:{viewport:this.viewport,cull:{enable:!1},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}}));const n=this.getOutlineMeshes();n.length&&(this.en=this.en||new kC,this.en.setMeshes(n),this.renderer.render(this.extentShader,{projMatrix:this.Ge.projMatrix,viewMatrix:this.Ge.viewMatrix},this.en,e))}getOutlineMeshes(){const e=[];if(!this.layer)return e;const n=this.layer.getGeometries();for(let i=0;i<n.length;i++){if(n[i].De)continue;const o=n[i].Yt();Yo.pushIn(e,o)}for(const n in this.xe){const i=this.xe[n].Yt();Yo.pushIn(e,i)}return e}Ke(){this.canvas&&DT.PBRUtils.logoutIBLResOnCanvas(this.canvas,this.getMap())}Oe(e){const n=this.layer.getMap(),{iblTexes:i,dfgLUT:o}=DT.PBRUtils.getIBLResOnCanvas(this.canvas);if(n&&n.getLights()){const s=DT.PBRUtils.getPBRUniforms(n,i,o,e&&e.ssr,e&&e.jitter),a=n.getLights();this.Ge.ambientColor=a.ambient&&a.ambient.color?a.ambient.color:[.2,.2,.2],s&&Yo.extend(this.Ge,s)}else{const i=DT.PBRUtils.getPBRUniforms(n,null,o,e&&e.ssr,e&&e.jitter);Yo.extend(this.Ge,i)}}Xe(e,n){const i=["webgl","experimental-webgl"];let o=null;for(let s=0;s<i.length;++s){try{o=e.getContext(i[s],n)}catch(e){}if(o)break}return o}nn(e,n,i={}){if(!this.Je||!this.layer.isVisible())return null;const o=this.layer.getMap();if(this.Ne||this.canvas.gl&&this.canvas.gl.wrap){if(!this.Ae||!Object.keys(this.Ae).length)return null;const e=this.tn(),n=Yo.extend({},this.Ge);n.pointSize=this.layer.options.pointSize||1,this.Je.render(e,n,!0),this.Ne=!1}const s=this.Je[i.returnAll?"pickAll":"pick"](e,n,i.tolerance||3,{projMatrix:o.projMatrix,viewMatrix:o.viewMatrix,pointSize:this.layer.options.pointSize||1},{viewMatrix:o.viewMatrix,projMatrix:o.projMatrix,returnPoint:!0});if(s.length){const e={},n=[];for(let i=0;i<s.length;i++)if(!e[s[i].pickingId]){const o=this.sn(s[i]);e[s[i].pickingId]=!0,n.push(o)}return n}return this.sn(s)}sn(e){const{meshId:n,pickingId:i,point:o,coordinate:s}=e,a=this.tn()[n],h=this.rn(i);return{meshId:n,mesh:a,data:this.layer.an()[h],pickingId:i,point:o,coordinate:s,index:i-h,nodeIndex:this.hn(n)}}hn(e){const n=this.tn()[e];return n&&n.properties.nodeIndex}rn(e){if(!t1(e))return null;if(this.layer.an()[e])return e;const n=Object.keys(this.layer.an()),i=n.length;let o=0,s=i-1,a=Math.floor((o+s)/2);for(;o<=i-1&&s>=0;){if(o===s)return n[o];if(n[a]<=e&&e<n[a+1])return n[a];e<n[a]?(s=a-1,a=Math.floor((o+s)/2)):n[a+1]<e&&(o=a+1,a=Math.floor((o+s)/2))}return null}isInFrustum(e){const n=this.layer.getMap(),i=e.getBoundingBox();if(!i||"multigltfmarker"===e.getGLTFMarkerType())return!0;const o=Zx(Z1,i.min,i.max);return!!cX(n.projViewMatrix,o)}getRenderMeshesTest(){return this.tn()}isMarkerTransparent(e){return e.J()}getMarkerFitSizeScale(e){return e.cn()}getMarkerFitTranslate(e){return e.ln()}getFBORayPicking(){return this.Je}getShaderList(){return this._e}};const Y1=/\{ *([\w_]+) *\}/g;let J1=class Mt extends N1{constructor(e,n){super(e,n),this.h="effectmarker"}static fromJSON(e){return new Mt(e.coordinates,e.options)}isAnimated(){const e=this._getInternalSymbol();return e&&e.animation}setTexture(e){const n=this.getLayer()&&this.getLayer().getRenderer();if(n){const i=this.getTextureUrl();n.un(i),n.dn(e)}return super.updateSymbol({textureUrl:e}),this}mn(e){const n=this.getTextureUrl(),i=this.getLayer()&&this.getLayer().getRenderer();if(i){let o=n;const s=this.gn();if(s){const i=this.isAnimationLooped(),a=this.getAnimationSpeed()||1,h=i?Math.floor(.01*e*a)%s.length:Math.floor(.01*e);o=n.replace(Y1,s[h]),this.setUniform("width",1),this.setUniform("height",1),this.setUniform("uvOffset",[0,0])}return i.pn(o,this.W())}return null}gn(){const e=this._getInternalSymbol();return e&&e.textureNames}getTextureUrl(){const e=this._getInternalSymbol();return e&&e.textureUrl||"default"}getUrl(){return"plane"}getShader(){return"effect"}setTransparent(e){return this.options.symbol.transparent=e,this}isTransparent(){return this.options.symbol.transparent}updateUV(e){const n=this.isAnimationLooped(),i=this.getAnimationSpeed()||1,o=this.getUniforms()||{},s=o.width||1,a=o.height||1;let h;const l=this.getEffectType();"uv"===l?h=n?.01*e*i%(s*a):.01*e:"sequence"===l&&(h=n?Math.floor(.01*e*i)%(s*a):Math.floor(.01*e));const c=Number(h%s),A=Math.floor(h/s),f=this.mn(e);this._getSymbol()?(this.setUniform("uvOffset",[c,A]),this.setUniform("width",s),this.setUniform("height",a),this.setUniform("texture",f)):this.C("uniforms",{uvOffset:[c,A],width:s,height:a,texture:f})}_setExternSymbol(e){super._setExternSymbol(e);const n=this.getLayer()&&this.getLayer().getRenderer();if(n){const e=this.getTextureUrl();n.dn(e)}}getEffectType(){const e=this._getInternalSymbol();return e&&e.effect||"uv"}setEffectType(e){return this._getInternalSymbol().effect=e,this}remove(){const e=this.getLayer()&&this.getLayer().getRenderer();if(e){const n=this.getTextureUrl();e.un(n)}super.remove()}};const K1=["Point","Polygon","LineString","MultiPoint","MultiPolygon","MultiLineString","GeometryCollection","Feature","FeatureCollection"].reduce(((e,n)=>(e[n]=!0,e)),{}),$1={toGeometry:function(e,n){if(Yo.isString(e)&&(e=Yo.parseJSON(e)),Array.isArray(e)){const i=[];for(let o=0,s=e.length;o<s;o++){const s=$1.bn(e[o],n);Array.isArray(s)?Yo.pushIn(i,s):i.push(s)}return i}return $1.bn(e,n)},bn:function(e,n){if(!e||Yo.isNil(e.type))return null;const i=e.type;if("Feature"===i){const i=$1.bn(e.geometry,n);return i?(i.setId(e.id),i.setProperties(e.properties),i):null}if("FeatureCollection"===i){const i=e.features;return i?$1.toGeometry(i,n):null}if("Point"===i)return function(e,n){return"EffectLayer"===n?new J1(e):new N1(e)}(e.coordinates,n);if("GeometryCollection"===i){const i=e.geometries,o=[],s=i.length;for(let e=0;e<s;e++)o.push($1.bn(i[e],n));return o}throw new Error("geometry's type is invalid, only support type of Point")},isGeoJSON:function(e){return!(!e||"object"!=typeof e||!e.type||!K1[e.type]||e instanceof _A)}},t2=/\{*(\$root)*\}/g;let e2=class It extends rd{constructor(e,n,i){!n||n instanceof _A||Array.isArray(n)||K1[n.type]||(i=n,n=null),super(e,null,i),this.pickingId=0,this.yn={},this._n={},this.wn={};this.setStyle(i&&i.style),n&&this.addGeometry(n)}static registerShader(e,n,i,o){s1[e]={name:e,type:n,config:i,uniforms:o}}static removeShader(e){delete s1[e]}static getShaders(){const e=[];for(const n in s1)e.push({shader:n,uniforms:s1[n].uniforms});return e}static getShaderMap(){return s1}addGeometry(e,n){let i=$1.isGeoJSON(e)?$1.toGeometry(e,this.getJSONType()):e;i=Array.isArray(i)?i:[i];for(let e=0;e<i.length;e++)if(!this.xn(i[e]))return void console.error("type of geometry is invalid");super.addGeometry(i,n),Array.isArray(i)&&this.addMarker(i)}addMarker(e){for(let n=0;n<e.length;n++){const i=e[n];i.Ht(this.pickingId),this.yn[this.pickingId]=i;const o=i.getId();o&&(this.wn[o]=i),i.fire("add",{type:"add",target:i,layer:this});const s=i.getUrl(),a=this.getRenderer();if(a&&a.xe[s]){i.fire("load",{type:"load",target:i,data:a.xe[s].L()})}if("multigltfmarker"===i.getGLTFMarkerType()){const e=i.getCount()||1;this.pickingId+=e}else this.pickingId++}}Tn(e){const n=this.getRenderer();n&&n.loginGLTFMarker(e)}toJSON(e){e||(e={});const n={type:this.getJSONType(),id:this.getId(),options:this.config()};if(($0(e.style)||e.style)&&(n.style=this.getStyle()),$0(e.geometries)||e.geometries){const e=[],i=this._geoList;for(let n=0;n<i.length;n++){const o=i[n].Xt();e.push(o)}n.geometries=e}return n}xn(e){return!!e.getGLTFMarkerType&&this.options.markerTypes.indexOf(e.getGLTFMarkerType())>-1}setStyle(e){return e?(this.options.style=e,this.vn=JSON.parse(JSON.stringify(e)),this.Mn(),this.fire("setstyle",{target:this,style:this.vn}),this):(delete this.vn,delete this.options.style,this)}getStyle(){return this.options.style}updateSymbol(e,n){const i=this.getStyle();this.On(e,n,i),this.On(e,n,this.vn),this.Mn(),this.fire("updatesymbol",{target:this,index:e,symbol:n})}On(e,n,i){if(!i)return;const o=(i.style?i.style:i)[e].symbol||{};for(const e in n)o[e]=n[e]}Mn(){this._processRootUrl(this.vn);this.An=Nk(this.vn.style?this.vn.style:this.vn),this._geoList.forEach((function(e){this.Sn(e)}),this)}getGLTFUrls(){return Object.keys(this._n)}_processRootUrl(e){Yo.isString(e.$root)&&e.style.forEach((n=>{const i=n.symbol.url;i&&i.indexOf("{$root}")>-1&&(n.symbol.url=i.replace(t2,e.$root))}))}Sn(e){if(!this.An)return!1;for(let n=0,i=this.An.length;n<i;n++)if(!0===this.An[n].filter({properties:e.getProperties()})){const i=this.An[n].symbol;return e.C("url",i.url),e.updateSymbol(i),!0}return!1}In(e){if(this.An)for(let n=0,i=this.An.length;n<i;n++)!0===this.An[n].filter({properties:e.getProperties()})&&this.An[n].outline&&e.outline()}En(e){const n=Yo.isString(e)?this.wn[e].W():e.W(),i=this.getRenderer();i&&i.Pn(n),delete this.yn[n],delete this.wn[e]}clear(){return super.clear(),this.yn={},this.wn={},this}an(){return this.yn}nn(e,n,i){const o=this.getRenderer();return o?o.nn(e,n,i):null}_isModelsLoadComplete(){const e=this._geoList;for(let n=0;n<e.length;n++)if(!e[n].isLoaded())return!1;return!0}Ct(e){const n=this.getRenderer();return n?n.Ct(e):null}V(e){const n=this.getRenderer();n&&n.V(e)}outlineBatch(e){const n=this.vn.style?this.vn.style:this.vn;n[e].outline=!0,this.An=Nk(n),this._geoList.forEach((e=>{this.In(e)}))}outlineAll(){this._geoList.forEach((e=>{e.outline()}))}cancelOutline(){this.vn&&(this.vn.style?this.vn.style:this.vn).forEach((e=>{delete e.outline})),this._geoList.forEach((e=>{e.cancelOutline()}))}};e2.mergeOptions({renderer:"gl",doubleBuffer:!1,glOptions:null,markerEvents:!0,forceRenderOnZooming:!0,forceRenderOnMoving:!0,forceRenderOnRotating:!0});let n2=class Et extends(uR(e2)){static initDefaultShader(){const e={shader:{positionAttribute:"POSITION",normalAttribute:"NORMAL",extraCommandProps:{blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}},material:new dC};Et.registerShader("phong","PhongShader",e.shader,e.material.getUniforms());const n={shader:{positionAttribute:"POSITION",normalAttribute:"NORMAL",tangentAttribute:"TANGENT",colorAttribute:"COLOR_0",uv0Attribute:"TEXCOORD_0",uv1Attribute:"TEXCOORD_1",extraCommandProps:{cull:{enable:!0},frontFace:"ccw",blend:{enable:(e,n)=>!!n.meshConfig.transparent,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"},equation:"add"}}},material:new DT.StandardMaterial({})};Et.registerShader("pbr","pbr.StandardShader",n.shader,n.material.getUniforms()),Et.registerShader("depth","pbr.StandardDepthShader",n.shader,n.material.getUniforms());const i={shader:{positionAttribute:"POSITION",color0Attribute:"COLOR_0",extraCommandProps:{blend:{enable:!1,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}},material:new cC};Et.registerShader("pointline","PointLineShader",i.shader,i.material.getUniforms());const o={shader:{positionAttribute:"POSITION",extraCommandProps:{blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"},equation:"add"}}},material:new cC({lineColor:[0,0,0,1],lineOpacity:1})};Et.registerShader("wireframe","EdgeShader",o.shader,o.material.getUniforms());const s={shader:{positionAttribute:"POSITION",normalAttribute:"NORMAL",extraCommandProps:{blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}},material:new gC};Et.registerShader("pbr-lite","StandardLiteShader",s.shader,s.material.getUniforms())}static fromJSON(e){if(!e||"GLTFLayer"!==e.type)return null;const n=new Et(e.id,e.options),i=e.geometries,o=[];for(let e=0;e<i.length;e++){const n=i[e].type,s=N1.getJSONClass(n);if(!s||!s.fromJSON)throw new Error("unsupported gltfmarker type:"+n);const a=s.fromJSON(i[e]);a&&o.push(a)}return n.addGeometry(o),e.style&&n.setStyle(e.style),n}setURLModifier(e){return this.kn=e,this}getURLModifier(){return this.kn}onAdd(){const e=this.getMap();this._geoList.forEach((n=>{t1(n.getZoomOnAdded())||n.setZoomOnAdded(e.getZoom())})),super.onAdd()}onRemove(){super.onRemove(),this.clear()}identify(e,n){const i=this.getMap();if(!i)return[];const o=i.coordinateToContainerPoint(new Zh(e));return this.identifyAtPoint(o,n)}identifyAtPoint(e,n={}){const i=[];if(!n.excludeMasks){const o=this.identifyMask(e,n);o&&o.length&&Yo.pushIn(i,o)}const o=this.getMap();if(!o)return[];const s=o.getDevicePixelRatio(),a=this.nn(e.x*s,e.y*s,n);if(a&&(a.data||a.length))if(n.includeInternals&&!n.excludeMasks){i.push(a.data);const e=n.domEvent;e&&(e.gltfPickingInfo=e.gltfPickingInfo||{},e.gltfPickingInfo[this.getId()]=a)}else i.push(a);return n&&n.filter&&!n.excludeMasks?i.filter((e=>n.filter(e.data||e))):i}ae(){this.pickingId=0;const e={};for(const n in this.yn){const i=this.yn[n];i.Ht(this.pickingId),i.P(!0),e[this.pickingId]=i;const o=i.getCount()||1;this.pickingId+=o}this.yn=e}_onGeometryEvent(e){if(!e||!e.target)return;const n=e.type;if("meshcreate"===n)this.Ln(e);else if("modelerror"===n)this.Nn(e);else if("positionchange"===n){const e=this.getRenderer();e&&e.setToRedraw()}super._onGeometryEvent(e)}Nn(e){const{url:n,info:i}=e;console.error(i),this.fire("modelerror",{type:"modelerror",url:n,info:i})}Ln(e){this._n[e.url]=1,this.getRenderer().setToRedraw(),this._isModelsLoadComplete()&&this.fire("modelload",{models:this.getGLTFUrls()})}};n2.initDefaultShader(),n2.mergeOptions({markerTypes:["gltfmarker","multigltfmarker"],pointSize:1}),n2.registerJSONType("GLTFLayer"),n2.registerRenderer("gl",X1);const i2=new Zh(0,0),r2=new ee(0,0),o2=new ee(0,0),s2=new ee(0,0);const a2=[];let h2=class Ft extends W1{constructor(e,n){super(null,n),this.on("load",(()=>{this.setCoordinates(e)}))}static fromJSON(e){return new Ft(e.data,e.options)}setCoordinates(e){this.oe=e,this.Cn()}getCoordinates(){return this.oe}toJSON(){const e=super.toJSON();return e.type="GLTFLineString",e}Cn(){const e=this.oe;if(e){this.removeAllData();for(let n=0;n<e.length-1;n++){const i=this.Rn(e[n]),o=this.Rn(e[n+1]);this.Bn(i,o).forEach((e=>{this.addData(e)}))}this.l=!0}}Bn(e,n){const i=[],o=this.getMap();if(!o)return i;const s=o.getProjection().measureLenBetween(e,n),a=this.Fn(e,n),h=Math.floor(s/a),l=this.Dn(e,n);if(h>=1){for(let o=1;o<=h;o++){const h={coordinates:this.Un(e,n,a*(o-.5)/s),scale:[1,1,1],rotation:[0,0,l]};i.push(h)}if(this.options.scaleVertex){const o=(s-a*h)/a,c={coordinates:this.Un(e,n,(a*h+(s-a*h)/2)/s),scale:[o,1,1],rotation:[0,0,l]};i.push(c)}}else if(this.options.scaleVertex){const o=s/a,h={coordinates:this.Un(e,n,.5),scale:[o,1,1],rotation:[0,0,l]};i.push(h)}return i}Un(e,n,i){const o=l2(e.x,n.x,i),s=l2(e.y,n.y,i),a=l2(e.z||0,n.z||0,i);return new Zh(o,s,a)}Fn(e,n){const i=this.getMap(),o=i.getGLRes(),s=new Zh(0,(e.y+n.y)/2),a=i.altitudeToPoint(100,o,s)/i.altitudeToPoint(100,o),h=this.getGLTFBBox(),l=this.options.direction||0,c=[1,1,1];if(this.getModelHeight())this.ut(c);else{const e=this.getSymbol();$v(c,e.scaleX||1,e.scaleY||1,e.scaleZ||1)}const A=m_(a2,h.max,h.min);n_(A,A,c);return A[l]/a+this.options.gapLength}Dn(e,n){const i=this.getMap(),o=i.getGLRes(),s=i.coordinateToPointAtRes(e,o),a=i.coordinateToPointAtRes(n,o);return Yo.computeDegree(a.x,a.y,s.x,s.y)/Math.PI*180}Rn(e){return Array.isArray(e)?new Zh(e):e}};function l2(e,n,i){return e+i*(n-e)}h2.mergeOptions({direction:0,gapLength:0,scaleVertex:!0}),h2.registerJSONType("GLTFLineString");const u2=new VC({url:void 0,mag:"linear"});let c2=class Vt extends X1{constructor(e){super(e),this._textureMap={}}pn(e){return this.regl&&this._textureMap[e]?this._textureMap[e].texture.getREGLTexture(this.regl):u2}dn(e){if(this._textureMap[e])this._textureMap[e].count++;else{this.Vn=this.Vn||new SC;const n=new VC({url:"default"===e?void 0:e,mag:"linear"},this.Vn);n.once("complete",(()=>{this.setToRedraw()}),this),this._textureMap[e]={count:1,texture:n}}}un(e){this._textureMap[e]&&(this._textureMap[e].count--,this._textureMap[e].count<1&&(this._textureMap[e].texture.dispose(),delete this._textureMap[e]))}},A2=class qt extends e2{static initDefaultShader(){const e={shader:{vert:"\n        attribute vec3 aPosition;\n        attribute vec2 aTexCoord;\n        uniform mat4 projViewMatrix;\n        uniform mat4 modelMatrix;\n        uniform vec2 uvOffset;\n        uniform float width;\n        uniform float height;\n        varying vec2 vTexCoords;\n        void main()\n        {\n            gl_Position = projViewMatrix * modelMatrix * vec4(aPosition, 1.0);\n            vTexCoords = (uvOffset + aTexCoord) * vec2(1.0 / width, 1.0 / height);\n        }\n    ",frag:"\n        precision mediump float;\n        uniform sampler2D texture;\n\n        varying vec2 vTexCoords;\n        void main() {\n            vec4 color = texture2D(texture, vTexCoords);\n            gl_FragColor = vec4(color.rgb, color.a) * color.a;\n        }\n    ",positionAttribute:"POSITION",extraCommandProps:{blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"}}},material:new cC};qt.registerShader("effect","MeshShader",e.shader,e.material.getUniforms())}onAddGeometry(e){super.onAddGeometry(e);const n=e.getTextureUrl(),i=this.getRenderer();i?i.dn(n):this.on("renderercreate",(e=>{e.renderer.dn(n)}))}remove(){const e=this.getRenderer();e&&this._geoList.forEach((n=>{const i=n.getTextureUrl();e.un(i)})),super.remove()}clear(){const e=this.getRenderer();e&&this._geoList.forEach((n=>{const i=n.getTextureUrl();e.un(i)})),super.clear()}getTextureMapTest(){const e=this.getRenderer();return e?e._textureMap:null}};A2.initDefaultShader(),A2.mergeOptions({markerTypes:["effectmarker"]}),A2.registerJSONType("EffectLayer"),A2.registerRenderer("gl",c2);let f2=class Gt extends N1{constructor(e,n){super(e,n),this.h="glowmarker"}static fromJSON(e){return new Gt(e.coordinates,e.options)}getUrl(){return"plane"}setSpeed(e){this.setUniform("speed",e)}getSpeed(){return this._getInternalSymbol().uniforms.speed}getShader(){return"glowmarker"}isAnimated(){const e=this._getInternalSymbol();return e&&e.animation}X(){let e=this._getInternalSymbol().uniforms.time||0;e+=.01,this.setUniform("time",e)}};f2.mergeOptions({visible:!0});let d2=class jt extends e2{static initDefaultShader(){const e=function(){const e={vert:"\n        #ifdef GL_ES\n            precision highp float;\n        #endif\n        attribute vec3 aPosition;\n        uniform mat4 projViewModelMatrix;\n        uniform mat4 modelMatrix;\n        uniform mat4 positionMatrix;\n        varying vec3 v_FragPos;\n        varying vec3 v_center;\n        #include <get_output>\n        void main(){\n            mat4 localPositionMatrix = getPositionMatrix();\n            vec4 localVertex = getPosition(aPosition);\n            vec4 position = localPositionMatrix * localVertex;\n            gl_Position = projViewModelMatrix * position;\n            vec4 worldPos = modelMatrix * position;\n            v_FragPos = worldPos.xyz;\n            v_center = (modelMatrix * vec4(0.0, 0.0, 0.0, 1.0)).xyz;\n        }\n    ",frag:"\n        #ifdef GL_ES\n            precision highp float;\n        #endif\n        #define pi 3.14159\n        const float dotsnb = 30.0; // Number of dots\n\n        varying vec3 v_FragPos;\n        varying vec3 v_center;\n        uniform float time;\n        uniform float radius;\n        uniform vec3 color;\n        uniform float speed;\n        vec3 hsb2rgb(in vec3 c)\n        {\n            vec3 rgb = clamp(abs(mod(c.x*6.0+vec3(0.0,4.0,2.0),6.0)-3.0)-1.0,0.0,1.0 );\n            rgb = rgb*rgb*(4.0-2.0*rgb);\n            return c.z * mix( vec3(1.0), rgb, c.y);\n        }\n\n        void main()\n        {\n            float r = length(v_FragPos - v_center);\n            r = r*2.-1.;\n            if(r>radius) {\n                gl_FragColor = vec4(1.0,1.0,1.0, 0.0);\n            } else {\n                //vec3 color = hsb2rgb(vec3(fract(time*.1),.7,.4));\n                vec3 color = color;\n                float s = abs(sin(pow(r+5.0, 1.5)-time*speed+sin(r*0.9))*sin(r+.99));\n                color *= (abs(1./(s*10.8))-.01);\n                gl_FragColor = vec4(color, (color.x + color.y + color.z) / 1.0);\n            }\n        }\n    ",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(e,n){return Cv([],n.projViewMatrix,n.modelMatrix)}}],positionAttribute:"POSITION",extraCommandProps:{blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one",dstAlpha:1},equation:{rgb:"add",alpha:"add"},color:[0,0,0,0]}}};return{shader:e,material:new cC}}();jt.registerShader("glowmarker","MeshShader",e.shader,e.material.getUniforms())}};d2.initDefaultShader(),d2.mergeOptions({markerTypes:["glowmarker"]}),d2.registerJSONType("GlowMarkerLayer"),d2.registerRenderer("gl",X1);const p2={url:"plane",animation:!0,loop:!0,rotation:[0,0,0],translation:[0,0,30],scale:[1,1,30]},g2={width:1,height:1,modelHeight:60,startOpacity:0,endOpacity:1};let m2=class Jt extends e2{static initDefaultShader(){const e={shader:{vert:"\n        attribute vec3 aPosition;\n        attribute vec2 aTexCoord;\n        uniform mat4 projViewMatrix;\n        uniform mat4 modelMatrix;\n        uniform vec2 uvOffset;\n        uniform float width;\n        uniform float height;\n        varying vec2 vTexCoords;\n        varying float vHeight;\n        void main()\n        {\n            vec4 worldPosition = modelMatrix * vec4(aPosition, 1.0);\n            gl_Position = projViewMatrix * worldPosition;\n            vHeight = worldPosition.z;\n            vTexCoords = (uvOffset + aTexCoord) * vec2(1.0 / width, 1.0 / height);\n        }\n    ",frag:"\n        precision mediump float;\n        uniform sampler2D texture;\n        uniform float modelHeight;\n        uniform float startOpacity;\n        uniform float endOpacity;\n        varying float vHeight;\n        varying vec2 vTexCoords;\n        void main() {\n            vec4 color = texture2D(texture, vTexCoords);\n            float opacity = (endOpacity - startOpacity) * (1.0 - vHeight / modelHeight);\n            gl_FragColor = vec4(color.rgb, color.a) * color.a * opacity;\n        }\n    ",positionAttribute:"POSITION",extraCommandProps:{blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"}}},material:new cC};Jt.registerShader("effectline","MeshShader",e.shader)}};m2.initDefaultShader(),m2.mergeOptions({markerTypes:["effectmarker"]}),m2.registerJSONType("EffectLineLayer"),m2.registerRenderer("gl",c2);const y2={offsetX:0,offsetY:0,uReflectivity:.8,opacity:.9,color:[.9,0,0,1]};let v2=class Yt extends e2{static initDefaultShader(){const e=function(){const e={vert:"\n        attribute vec3 aPosition;\n        attribute vec2 aTexCoord;\n        attribute vec3 aNormal;\n        uniform mat4 projViewMatrix;\n        uniform mat4 modelMatrix;\n        uniform mat4 normalMatrix;\n        uniform float offsetX;\n        uniform float offsetY;\n        varying vec2 uv;\n        void main()\n        {\n            gl_Position = projViewMatrix * modelMatrix * vec4(aPosition, 1.0);\n            uv = vec2(aTexCoord.x + offsetX, aTexCoord.y + offsetY);\n        }\n    ",frag:"\n        precision mediump float;\n        uniform sampler2D effectTexture;\n        uniform vec3 uCameraPosition;\n        uniform mat4 viewMatrix;\n        uniform float uReflectivity;\n        uniform vec4 color;\n        uniform float opacity;\n\n        varying vec2 uv;\n\n        vec3 inverseTransformDirection(in vec3 dir, in mat4 matrix) {\n            return normalize((vec4(dir, 0.0) * matrix).xyz);\n        }\n\n        const float GAMMA_FACTOR = 2.0;\n        vec4 GammaToLinear(in vec4 value, in float gammaFactor) {\n            return vec4(pow(value.xyz, vec3(gammaFactor)), value.w);\n        }\n\n        vec4 mixTexelToLinear(vec4 value) {\n            return GammaToLinear(value, float(GAMMA_FACTOR));\n        }\n\n        void main() {\n            vec4 texColor = texture2D(effectTexture, uv);\n            if (color.a == 0.0) {\n                discard;\n            }\n            vec4 mixColor = mixTexelToLinear(color);\n            texColor.rgb += mixColor.xyz * uReflectivity;\n            texColor.a*= opacity;\n            gl_FragColor = texColor;\n        }\n    ",uniforms:[{name:"normalMatrix",type:"function",fn:function(e,n){const i=[];return wv(i,n.modelMatrix),bv(i,i),i}}],positionAttribute:"POSITION",extraCommandProps:{depth:{enable:!0,mask:!1},blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"}}};return{shader:e,material:new cC}}();Yt.registerShader("effectring","MeshShader",e.shader)}};v2.initDefaultShader(),v2.mergeOptions({markerTypes:["effectring"]}),v2.registerJSONType("EffectRingLayer"),v2.registerRenderer("gl",X1);const _2={animation:!0,loop:!0,url:"plane",effect:"sequence",speed:1,scale:[1,1,1],rotation:[90,0,0]},x2={width:9,height:5};if(fD){const e=BA.VERSION;if(e.indexOf("1.0.0-beta")>=0||e.indexOf("1.0.0-alpha")>=0){na("@maptalks/gltf-layer",fD.inject(K0))}else na("@maptalks/gltf-layer",(function(){return fD.inject(K0)}))}else na("@maptalks/gltf-layer",K0);"undefined"!=typeof console&&console.log("@maptalks/gltf-layer v0.101.1");
/*!
   * maptalks v1.0.0-rc.35
   * LICENSE : BSD-3-Clause
   * (c) 2016-2024 maptalks.org
   */
var b2="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0)&&!process.versions.electron&&!process.versions.nw&&!process.versions["node-webkit"];var w2={isTest:!1,idleLog:!1,idleForceTimeThreshold:48,workerCount:("undefined"!=typeof globalThis?globalThis:global||self).MAPTALKS_WORKER_COUNT||0,messagePostRatioPerWorker:.3,maxFPS:0};function C2(){return Date.now()}function P2(e){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];for(var o=0;o<n.length;o++){var s=n[o];for(var a in s)e[a]=s[a]}return e}function M2(e){return null==e}function T2(e){return"number"==typeof e&&!isNaN(e)}function S2(e){return(0|e)===e}function I2(e){return"object"==typeof e&&!!e}function E2(e){return!M2(e)&&("string"==typeof e||null!==e.constructor&&e.constructor===String)}function O2(e){return!M2(e)&&("function"==typeof e||null!==e.constructor&&e.constructor===Function)}var R2=Object.prototype.hasOwnProperty;function D2(e,n){return R2.call(e,n)}var k2=Math.PI/180;function L2(e){return e*k2}function F2(e){return e/k2}var N2={};function z2(){return window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI}if(!b2){var B2=navigator.userAgent.toLowerCase(),H2=document.documentElement||{style:{}},j2="ActiveXObject"in window,U2=-1!==B2.indexOf("webkit"),G2=-1!==B2.indexOf("phantom"),V2=-1!==B2.search("android [23]"),W2=-1!==B2.indexOf("chrome"),q2=-1!==B2.indexOf("gecko")&&!U2&&!window.opera&&!j2,Z2=/iphone/i.test(B2)&&/micromessenger/i.test(B2),Q2="undefined"!=typeof orientation||-1!==B2.indexOf("mobile"),X2=!window.PointerEvent&&window.MSPointerEvent,Y2=window.PointerEvent&&navigator.pointerEnabled||X2,J2=j2&&"transition"in H2.style,K2="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!V2,$2="MozPerspective"in H2.style,t5="OTransition"in H2.style,e5=(J2||K2||$2)&&!t5&&!G2,n5="undefined"!=typeof window&&O2(window.createImageBitmap),i5="undefined"!=typeof window&&O2(window.ResizeObserver),r5="undefined"!=typeof window&&O2(window.btoa),o5="undefined"!=typeof window&&O2(window.Proxy),s5="undefined"!=typeof window&&O2(window.requestIdleCallback),a5=0;W2&&(a5=B2.match(/chrome\/([\d.]+)/)[1]);var h5=!G2&&(Y2||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch),l5="undefined"!=typeof window&&"WebGLRenderingContext"in window,u5=z2(),c5=!1;try{new OffscreenCanvas(2,2).getContext("2d"),c5=!0}catch(e){c5=!1}var A5=!1;try{window.addEventListener("testPassive",(function(){}),{get passive(){return A5=!0,!0}})}catch(Hst){}N2={IS_NODE:b2,isTest:!1,ie:j2,ielt9:j2&&!document.addEventListener,edge:"msLaunchUri"in navigator&&!("documentMode"in document),webkit:U2,gecko:q2,android:-1!==B2.indexOf("android"),android23:V2,chrome:W2,chromeVersion:a5,safari:!W2&&-1!==B2.indexOf("safari"),phantomjs:G2,ie3d:J2,webkit3d:K2,gecko3d:$2,opera12:t5,any3d:e5,iosWeixin:Z2,mobile:Q2,mobileWebkit:Q2&&U2,mobileWebkit3d:Q2&&K2,mobileOpera:Q2&&window.opera,mobileGecko:Q2&&q2,touch:!!h5,msPointer:!!X2,pointer:!!Y2,retina:u5>1,devicePixelRatio:u5,language:navigator.browserLanguage?navigator.browserLanguage:navigator.language,ie9:j2&&9===document.documentMode,ie10:j2&&10===document.documentMode,webgl:l5,imageBitMap:n5,resizeObserver:i5,btoa:r5,decodeImageInWorker:c5,monitorDPRChange:!0,supportsPassive:A5,proxy:o5,requestIdleCallback:s5,checkDevicePixelRatio:function(){if("undefined"!=typeof window&&N2.monitorDPRChange){var e=z2(),n=e!==N2.devicePixelRatio;return n&&(N2.devicePixelRatio=e),n}return!1}}}var f5=N2,d5=function(e,n){return d5=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])},d5(e,n)};function p5(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}d5(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}var g5=function(){return g5=Object.assign||function(e){for(var n,i=1,o=arguments.length;i<o;i++)for(var s in n=arguments[i])Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s]);return e},g5.apply(this,arguments)};function m5(e){var n="function"==typeof Symbol&&Symbol.iterator,i=n&&e[n],o=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}function y5(e,n){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var o,s,a=i.call(e),h=[];try{for(;(void 0===n||n-- >0)&&!(o=a.next()).done;)h.push(o.value)}catch(e){s={error:e}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(s)throw s.error}}return h}function v5(e,n,i){if(2===arguments.length)for(var o,s=0,a=n.length;s<a;s++)!o&&s in n||(o||(o=Array.prototype.slice.call(n,0,s)),o[s]=n[s]);return e.concat(o||Array.prototype.slice.call(n))}"function"==typeof SuppressedError&&SuppressedError;var _5,x5,b5=function(){function e(e,n,i){if(M2(e)||M2(n)?M2(e.x)||M2(e.y)?Array.isArray(e)&&(this.x=+e[0],this.y=+e[1],this.z=e[2]):(this.x=+e.x,this.y=+e.y,this.z=e.z):(this.x=+e,this.y=+n,this.z=i),this._isNaN())throw new Error("Position is NaN")}return e.prototype.set=function(e,n,i){return this.x=e,this.y=n,this.z=i||0,this},e.prototype._abs=function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this},e.prototype._round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},e.prototype._ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},e.prototype.distanceTo=function(e){var n=e.x-this.x,i=e.y-this.y;return Math.sqrt(n*n+i*i)},e.prototype.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},e.prototype._floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},e.prototype._add=function(e,n){return M2(e.x)?M2(e[0])?(this.x+=e,this.y+=n):(this.x+=e[0],this.y+=e[1]):(this.x+=e.x,this.y+=e.y),this},e.prototype._sub=function(e,n){return M2(e.x)?M2(e[0])?(this.x-=e,this.y-=n):(this.x-=e[0],this.y-=e[1]):(this.x-=e.x,this.y-=e.y),this},e.prototype._substract=function(e,n){return T2(n)?this._sub(e,n):this._sub(e)},e.prototype.substract=function(e,n){return this.sub(e,n)},e.prototype._multi=function(e){return this.x*=e,this.y*=e,this},e.prototype.div=function(e){return this.multi(1/e)},e.prototype._div=function(e){return this._multi(1/e)},e.prototype._isNaN=function(){return isNaN(this.x)||isNaN(this.y)||T2(this.z)&&isNaN(this.z)},e.prototype.isZero=function(){return 0===this.x&&0===this.y},e.prototype.toArray=function(){return T2(this.z)?[this.x,this.y,this.z]:[this.x,this.y]},e.prototype.toJSON=function(){var e={x:this.x,y:this.y};return T2(this.z)&&(e.z=this.z),e},e}(),w5=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype.closeTo=function(e,n){return n||(n=0),this.x>=e.x-n&&this.x<=e.x+n&&this.y>=e.y-n&&this.y<=e.y+n},n.prototype.unit=function(){return this.copy()._unit()},n.prototype._unit=function(){return this._div(this.mag()),this},n.prototype.perp=function(){return this.copy()._perp()},n.prototype._perp=function(){var e;return e=y5([-this.y,this.x],2),this.x=e[0],this.y=e[1],this},n.prototype.angleWith=function(e){return this.angleWithSep(e.x,e.y)},n.prototype.angleWithSep=function(e,n){return Math.atan2(this.x*n-this.y*e,this.x*e+this.y*n)},n.prototype._rotate=function(e){var n=Math.cos(e),i=Math.sin(e),o=i*this.x+n*this.y;return this.x=n*this.x-i*this.y,this.y=o,this},n.prototype.rotate=function(e){return this.copy()._rotate(e)},n.prototype.abs=function(){return new n(Math.abs(this.x),Math.abs(this.y))},n.prototype.round=function(){return new n(Math.round(this.x),Math.round(this.y))},n.prototype.ceil=function(){return new n(Math.ceil(this.x),Math.ceil(this.y))},n.prototype.floor=function(){return new n(Math.floor(this.x),Math.floor(this.y))},n.prototype.copy=function(){return new n(this.x,this.y,this.z)},n.prototype.toFixed=function(e){return new n(this.x.toFixed(e),this.y.toFixed(e),T2(this.z)?this.z.toFixed(e):void 0)},n.prototype.add=function(e,i){var o,s;return M2(e.x)?M2(e[0])?(o=this.x+e,s=this.y+i):(o=this.x+e[0],s=this.y+e[1]):(o=this.x+e.x,s=this.y+e.y),new n(o,s)},n.prototype.sub=function(e,i){var o,s;return M2(e.x)?M2(e[0])?(o=this.x-e,s=this.y-i):(o=this.x-e[0],s=this.y-e[1]):(o=this.x-e.x,s=this.y-e.y),new n(o,s)},n.prototype.multi=function(e){return new n(this.x*e,this.y*e)},n.prototype.equals=function(e){return e instanceof this.constructor&&(this.x===e.x&&this.y===e.y&&this.z===e.z)},n}(b5);function C5(e){var n="data:image/svg+xml";return e.length>4&&".svg"===e.slice(-4)?1:e.slice(0,18)===n?2:0}function P5(e,n){b2&&P5.node?P5.node(e,n):e.src=n[0]}!function(){if(b2)return _5=function(e){return setTimeout(e,16)},void(x5=clearTimeout);var e,n,i=1e3/30;function o(e){return setTimeout(e,i)}function s(e){return window["webkit"+e]||window["moz"+e]||window["ms"+e]}"undefined"!=typeof window?(e=window.requestAnimationFrame||s("RequestAnimationFrame")||o,n=window.cancelAnimationFrame||s("CancelAnimationFrame")||s("CancelRequestAnimationFrame")||function(e){window.clearTimeout(e)}):(e=o,n=clearTimeout),_5=function(n){return e(n)},x5=function(e){e&&n(e)}}();var M5=0;function T5(){return M5++}var S5=T5;function I5(e){return e&&E2(e)?JSON.parse(e):e}function E5(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];for(var i=e[0],o=1;o<e.length;o++){var s=e[o];if(s&&s.length)for(var a=0,h=s.length;a<h;a++)i.push(s[a])}return i.length}function O5(e,n){var i=n.indexOf(e);i>-1&&n.splice(i,1)}function R5(e,n,i){if(!Array.isArray(e))return i?n.call(i,e):n(e);for(var o,s,a=[],h=0,l=e.length;h<l;h++)M2(o=e[h])?a.push(null):Array.isArray(o)?a.push(R5(o,n,i)):(s=i?n.call(i,o):n(o),a.push(s));return a}function D5(e,n){return void 0===e?n:e}function k5(e){return Math.sign?Math.sign(e):0===(e=+e)||isNaN(e)?Number(e):e>0?1:-1}function L5(e,n,i){return e*(1-i)+n*i}function F5(e,n,i){if(e===i||e===n)return e;var o=i-n;return((e-n)%o+o)%o+n}function N5(e,n,i){return Math.min(i,Math.max(n,e))}function z5(e){return Array.isArray(e)&&e.length>0}var B5=/^([a-z][a-z\d+\-.]*:)?\/\//i;var H5=/^url\((['"])(.+)\1\)$/i,j5=/^url\(([^'"].*[^'"])\)$/i;function U5(e){var n=function(e){return E2(e)?j5.test(e)?1:H5.test(e)?2:3:0}(e);return 3===n?e:1===n?j5.exec(e)[1]:2===n?H5.exec(e)[2]:e}var G5="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function V5(e,n,i,o){return Math.atan2(o-n,i-e)}var W5="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";function q5(e,n){if(!e&&!n)return!0;if(!e||!n)return!1;for(var i in e)if("center"===i){if(!n[i]||!Z5(e[i][0],n[i][0])||!Z5(e[i][1],n[i][1]))return!1}else if(e[i]!==n[i])return!1;return!0}function Z5(e,n,i){return null==i&&(i=1e-6),e>=n-i&&e<=n+i}function Q5(e,n,i,o){void 0===e&&(e=100),void 0===n&&(n=4),void 0===i&&(i=null),void 0===o&&(o=null),e||(e=100),n||(n=4);var s=this,a=this.isVisible();return n*=2,this._flashTimeout&&clearTimeout(this._flashTimeout),this._flashTimeout=setTimeout((function h(){if(0===n)return a?s.show():s.hide(),void(i&&(o?i.call(o):i()));n%2==0?s.hide():s.show(),n--,s._flashTimeout=setTimeout(h,e)}),e),this}function X5(e,n){void 0===e&&(e=[]),void 0===n&&(n="_pt");for(var i=[],o=0,s=e.length;o<s;o++){var a=e[o];if(a){a[n]||(a[n]=new w5(0,0));var h=a[n];h.x=0,h.y=0,i.push(h)}else i.push(null)}return i}function Y5(e,n){n(e.data)}function J5(e){if(e&&0===e.indexOf("http://")||0===e.indexOf("https://"))return e;var n=document.createElement("a");return n.href=e,e=n.href,n=null,e}var K5={cssWidth:"1px",cssHeight:"1px",width:1,height:1};function $5(e,n){void 0===n&&(n=1);var i=e.width,o=e.height;return K5.cssWidth=i+"px",K5.cssHeight=o+"px",K5.width=Math.round(i*n),K5.height=Math.round(o*n),K5}var t3="_maptalks__internal_layer_",e3=["MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"],n3=["FeatureCollection","Feature","Point","LineString","Polygon"].concat(e3),i3=["markerFile","polygonPatternFile","linePatternFile","markerFillPatternFile","markerLinePatternFile"],r3=[["markerWidth","markerHeight"],[],[null,"lineWidth"],[],[null,"markerLineWidth"]],o3={lineWidth:1,lineOpacity:1,lineDx:1,lineDy:1,polygonOpacity:1,markerWidth:1,markerHeight:1,markerDx:1,markerDy:1,markerOpacity:1,markerFillOpacity:1,markerLineWidth:1,markerLineOpacity:1,textSize:1,textOpacity:1,textHaloRadius:1,textWrapWidth:1,textLineSpacing:1,textDx:1,textDy:1},s3=["lineColor","polygonFill","markerFill","markerLineColor","textFill"],a3=14,h3=function(){function e(e,n){T2(e)&&T2(n)?(this.width=e,this.height=n):T2(e.width)?(this.width=e.width,this.height=e.height):Array.isArray(e)&&(this.width=e[0],this.height=e[1])}return e.prototype.copy=function(){return new e(this.width,this.height)},e.prototype.add=function(n,i){var o,s;return n instanceof e?(o=this.width+n.width,s=this.height+n.height):(o=this.width+n,s=this.height+i),new e(o,s)},e.prototype.equals=function(e){return this.width===e.width&&this.height===e.height},e.prototype.multi=function(n){return new e(this.width*n,this.height*n)},e.prototype._multi=function(e){return this.width*=e,this.height*=e,this},e.prototype._round=function(){return this.width=Math.round(this.width),this.height=Math.round(this.height),this},e.prototype.toPoint=function(){return new w5(this.width,this.height)},e.prototype.toArray=function(){return[this.width,this.height]},e.prototype.toJSON=function(){return{width:this.width,height:this.height}},e}(),l3="";function u3(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function c3(e,n,i){if(!e)return e;for(;e.indexOf(n)>-1;)e=e.replace(n,i);return e}var A3=/[\b\t\r\v\f]/gim;function f3(e){return E2(e)?e.replace(A3,l3):e}var d3="undefined"!=typeof document?document.createElement("canvas").getContext("2d"):null;function p3(e,n){return p3.node?p3.node(e,n):(d3.font=n,d3.measureText(e).width)}function g3(e,n,i){var o=p3(e,n);return new h3(o,i||a3)}function m3(e,n,i,o){if(!e||0===e.length)return[{text:"",width:0}];var s=M2(o)?p3(e,n):o,a=s/e.length,h=Math.floor(i/a/2);if(a>=i||h<=0)return[{text:"",width:i}];if(s<=i)return[{text:e,width:s}];for(var l=[],c=e.substring(0,h),A=a*h,f=h,d=e.length;f<d;f++){var p=e[f],g=p3(c+p);g>=i?(l.push({text:c,width:A}),c=e.substring(f,h+f),f+=h-1,A=a*h):(c+=p,A=g),f>=d-1&&(A=p3(c),l.push({text:c,width:A}))}return l}var y3=["{","}"];function v3(e,n){if(!E2(e))return e;function i(e){if(!n)return l3;var i=n[e];return M2(i)?l3:Array.isArray(i)?i.join():i}for(var o=y5(y3,2),s=o[0],a=o[1],h=function(e){e+=l3;for(var n=y5(y3,2),i=n[0],o=n[1],s=[],a=!1,h=l3,l=0,c=e.length;l<c;l++){var A=e[l];a||A!==i||(a=!0),A===i&&a&&(h=l3),a&&A!==i&&A!==o&&(h+=A),A===o&&h&&(a=!1,s.push(h),h=l3)}return s}(e),l=0,c=h.length;l<c;l++){var A=h[l],f=i(A);e=c3(e,"".concat(s).concat(A).concat(a),f)}return e}function _3(e,n){T2(e)&&(e+="");var i=n.textMaxHeight||0,o=P3(e=e||"",n);return i&&i<o.size.height&&(o.size.height=i),o}function x3(e,n,i){var o=e.width,s=e.height;return new w5("left"===n?-o:"right"===n?0:-o/2,"top"===i?-s:"bottom"===i?0:-s/2)}var b3="sans-serif",w3=14;function C3(e){if(e.textFont)return e.textFont;var n=e.textSize;return M2(n)&&(n=w3),(e.textStyle&&"normal"!==e.textStyle?e.textStyle+" ":"")+(e.textWeight&&"normal"!==e.textWeight?e.textWeight+" ":"")+n+"px "+(e.textFaceName&&function(e){for(var n=e.split(","),i=0;i<n.length;i++)n[i].trim&&(n[i]=n[i].trim()),n[i].indexOf(" ")>0&&'"'!==n[i][0]&&"'"!==n[i][0]&&(n[i]='"'+n[i]+'"');return n.join(",")}(e.textFaceName)||b3)}function P3(e,n){var i=C3(n),o=n.textLineSpacing||0,s=g3(e,i,n.textSize),a=s.width,h=s.height,l=n.textWrapCharacter||"\n",c=[],A=n.textWrapWidth;(!A||A>a)&&(A=a),E2(e)||(e+="");var f=0;if(l&&e.indexOf(l)>=0)for(var d=e.split(l),p=0,g=d.length;p<g;p++){var v=d[p],w=p3(v,i);if(w>A)for(var C=0,P=(T=m3(v,i,A,w)).length;C<P;C++){(S=T[C].width)>f&&(f=S),c.push({text:T[C].text,size:new h3(S,h)})}else w>f&&(f=w),c.push({text:v,size:new h3(w,h)})}else if(a>A){var T=m3(e,i,A,a);for(p=0;p<T.length;p++){var S;(S=T[p].width)>f&&(f=S),c.push({text:T[p].text,size:new h3(S,h)})}}else a>f&&(f=a),c.push({text:e,size:s});var I=c.length;return{total:I,size:new h3(f,h*I+o*(I-1)),rows:c,rawSize:s}}function M3(e){var n=0,i=e&&e.length||0;if(!i)return n;for(var o=0;o<i;o++)n=(n<<5)-n+e.charCodeAt(o),n|=0;return n}var T3=b2?function(e){return e[0]}:function(e){for(var n=document.documentElement&&document.documentElement.style||{},i=0;i<e.length;i++)if(e[i]in n)return e[i];return!1},S3=T3(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),I3=T3(["transformOrigin","WebkitTransformOrigin","OTransformOrigin","MozTransformOrigin","msTransformOrigin"]),E3=T3(["transition","WebkitTransition","OTransition","MozTransition","msTransition"]);function O3(e,n){var i=document.createElement(e);return n&&W3(i,n),i}function R3(e,n,i){var o=O3(e);return n&&U3(o,n),i&&i.appendChild(o),o}function D3(e){if(!e)return this;if(f5.ielt9||f5.ie9){var n=O3("div");n.appendChild(e),n.innerHTML="",n=null}else e.parentNode&&e.parentNode.removeChild(e);return this}function k3(e,n,i,o){if(!(e&&e.addEventListener&&n&&i))return this;for(var s=function(n){n||(n=window.event),i.call(o||e,n)},a=n.split(" "),h=a.length-1;h>=0;h--){var l=a[h];if(l)e["Z__"+l]||(e["Z__"+l]=[]),F3(e,l,i)>=0&&(console.warn(e,"find '".concat(l,"' handler:"),i," The old listener function will be removed"),L3(e,l,i)),e["Z__"+l].push({callback:s,src:i}),e.addEventListener(l,s,!!f5.supportsPassive&&{capture:!1,passive:!1})}return this}function L3(e,n,i){function o(n,i){"mousewheel"===n&&f5.gecko&&(n="DOMMouseScroll"),e.removeEventListener(n,i,!1)}if(!e||!e.removeEventListener||!n)return this;for(var s=n.split(" "),a=s.length-1;a>=0;a--){var h=s[a];if(h){if(!i&&e["Z__"+h]){for(var l=e["Z__"+h],c=0,A=l.length;c<A;c++)o(l[c].callback);return delete e["Z__"+h],this}var f=F3(e,h,i);if(f<0)return this;o(h,e["Z__"+h][f].callback),e["Z__"+h].splice(f,1)}}return this}function F3(e,n,i){if(!e||!e["Z__"+n]||!i)return-1;for(var o=e["Z__"+n],s=0,a=o.length;s<a;s++)if(o[s].src===i)return s;return-1}function N3(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,this}function z3(e){return e._cancelBubble=!0,e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,this}function B3(e,n){return e?(f5.any3d?function(e,n){var i=n||new w5(0,0);e.style[S3]=f5.any3d?"translate3d("+i.x+"px,"+i.y+"px,0px)":"translate("+i.x+"px,"+i.y+"px)"}(e,n):(e.style.left=n.x+"px",e.style.top=n.y+"px"),n):null}function H3(e){var n=window.getComputedStyle(e),i=[parseInt(n["padding-left"]),parseInt(n["padding-top"])],o=e.getBoundingClientRect(),s=e.offsetWidth,a=e.offsetHeight;return e.__position=[o.left+i[0],o.top+i[1],s?o.width/s:1,a?o.height/a:1],e.__position}function j3(e,n){e||(e=window.event);var i=n.__position;i||(i=H3(n));var o=e;return o.touches&&o.touches.length&&(e=o.touches[0]),o.changedTouches&&o.changedTouches.length&&(e=o.changedTouches[0]),new w5((e.clientX-i[0]-n.clientLeft)/i[2],(e.clientY-i[1]-n.clientTop)/i[3])}function U3(e,n){var i=e.style.cssText;return function(e,n){var i=e.length-n.length;return i>=0&&e.indexOf(n,i)===i}(i,";")||(i+=";"),e.style.cssText=i+n,this}function G3(e,n){if(void 0!==e.classList)return e.classList.contains(n);var i=q3(e);return i.length>0&&new RegExp("(^|\\s)"+n+"(\\s|$)").test(i)}function V3(e,n){if(void 0===e.classList||G3(e,n)){var i=q3(e);W3(e,(i?i+" ":"")+n)}else for(var o=u3(n).split(/\s+/),s=0,a=o.length;s<a;s++)e.classList.add(o[s]);return this}function W3(e,n){return M2(e.className.baseVal)?e.className=n:e.className.baseVal=n,this}function q3(e){return M2(e.className.baseVal)?e.className:e.className.baseVal}function Z3(e){return/<[a-z\][\s\S]*>/i.test(e)}function Q3(e,n){var i,o=((i=document.createElement(e)).style.cssText="position:absolute;left:-10000px;top:-10000px;",document.body.appendChild(i),i);E2(n)?o.innerHTML=n:o.appendChild(n);var s=new h3(o.clientWidth,o.clientHeight);return D3(o),s}T3(["filter","WebkitFilter","OFilter","MozFilter","msFilter"]);var X3=k3,Y3=L3;function J3(e){return e&&("mousemove"===e||"touchmove"===e)}function K3(e,n){var i=C2();return!!(e._mousemoveTime&&i-e._mousemoveTime<(n||48))||(e._mousemoveTime=i,!1)}var $3={jsonp:function(e,n){var i="_maptalks_jsonp_"+T5();e.match(/\?/)?e+="&callback="+i:e+="?callback="+i;var o=document.createElement("script");return o.type="text/javascript",o.src=e,window[i]=function(e){n(null,e),document.getElementsByTagName("head")[0].removeChild(o),o=null,delete window[i]},document.getElementsByTagName("head")[0].appendChild(o),this},get:function(e,n,i){if(O2(n)){var o=i;i=n,n=o}if(b2&&$3.get.node)return $3.get.node(e,i,n);var s=$3._getClient(i);if(s.open("GET",e,!0),n){for(var a in n.headers)s.setRequestHeader(a,n.headers[a]);s.withCredentials="include"===n.credentials,n.responseType&&(s.responseType=n.responseType)}return s.send(null),s},post:function(e,n,i){var o;if(E2(e)){if(O2(n)){s=i;i=n,n=s}o=(n=n||{}).postData}else{var s;o=n,e=(n=e).url,i=s=i}if(b2&&$3.post.node)return n.url=e,$3.post.node(n,o,i);var a=$3._getClient(i);if(a.open("POST",n.url,!0),n.headers||(n.headers={}),n.headers["Content-Type"]||(n.headers["Content-Type"]="application/x-www-form-urlencoded"),"setRequestHeader"in a)for(var h in n.headers)n.headers.hasOwnProperty(h)&&a.setRequestHeader(h,n.headers[h]);return E2(o)||(o=JSON.stringify(o)),a.send(o),a},_wrapCallback:function(e,n){return function(){4===e.readyState&&(200===e.status?"arraybuffer"===e.responseType?0===e.response.byteLength?n(new Error("http status 200 returned without content.")):n(null,{data:e.response,cacheControl:e.getResponseHeader("Cache-Control"),expires:e.getResponseHeader("Expires"),contentType:e.getResponseHeader("Content-Type")}):n(null,e.responseText):n(new Error(e.statusText+","+e.status)))}},_getClient:function(e){var n;try{n=new XMLHttpRequest}catch(e){try{n=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{n=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}}return n.onreadystatechange=$3._wrapCallback(n,e),n},getArrayBuffer:function(e,n,i){if(O2(n)){var o=i;i=n,n=o}return n||(n={}),n.responseType="arraybuffer",$3.get(e,n,i)},getImage:function(e,n,i){return $3.getArrayBuffer(n,i,(function(n,i){if(n)e.onerror&&e.onerror(n);else if(i){var o=window.URL||window.webkitURL,s=e.onload;e.onload=function(){s&&s(),o.revokeObjectURL(e.src)};var a=new Blob([new Uint8Array(i.data)],{type:i.contentType});e.cacheControl=i.cacheControl,e.expires=i.expires,e.src=i.data.byteLength?o.createObjectURL(a):W5}}))},getJSON:function(e,n,i){}};$3.getJSON=function(e,n,i){if(O2(n)){var o=i;i=n,n=o}var s=function(e,n){var o=n?I5(n):null;i(e,o)};return n&&n.jsonp?$3.jsonp(e,s):$3.get(e,n,s)};var t4="",e4=/data:image\/.*;base64,/;function n4(e,n){for(var i in void 0===n&&(n={}),n){var o=n[i];if(o&&o.target)if(a=i,T2(s=e)&&(s+=t4),T2(a)&&(a+=t4),s&&a&&(s.includes?s.includes(a):s.indexOf(a)>-1))return e.replace(i,o.target)}var s,a;return t4}var i4={host:t4,resources:{},proxy:{},origin:{},fromJSON:function(e){try{E2(e)&&(e=JSON.parse(e)),I2(e)&&P2(i4,e)}catch(e){console.error(e)}},toJSON:function(){return{host:i4.host,proxy:P2({},i4.proxy||{}),origin:P2({},i4.origin||{})}},getResource:function(e){return i4.resources[e]},removeResource:function(e){delete i4.resources[e]},addResource:function(e,n){i4.resources[e]?console.warn("".concat(e," resource Already exists,the ").concat(e," Cannot be added,the resource name Cannot repeat ")):i4.resources[e]=n},updateResource:function(e,n){i4.resources[e]=n},allResource:function(){return i4.resources},loadSprite:function(e){return void 0===e&&(e={imgUrl:"",jsonUrl:""}),new Promise((function(n,i){var o=e.imgUrl,s=e.jsonUrl;if(!o||!s)return i(new Error("not find imgUrl/jsonUrl from options")),void console.error(e);function a(e,n,i){e.width=n,e.height=i;var o=e.getContext("2d");return o.clearRect(0,0,n,i),o}function h(o,s){void 0===o&&(o={});var h=function(){var e;return f5.IS_NODE?console.error("Current environment does not support canvas dom"):e=O3("canvas"),e}();if(h){var l=[];for(var c in o){l.push({name:c,spriteItem:o[c]})}var A=function(){var e;return f5.decodeImageInWorker&&(e=new OffscreenCanvas(2,2)),e}(),f=e.sourceName||"";l.forEach((function(e){var n,i=e.name,o=e.spriteItem,l=o.x,c=o.y,d=o.width,p=o.height;A?(a(A,d,p).drawImage(s,l,c,d,p,0,0,d,p),n=A.transferToImageBitmap()):(a(h,d,p).drawImage(s,l,c,d,p,0,0,d,p),n=h.toDataURL());e.resource=n,i4.addResource(f+i,n)})),n(l)}else i(new Error("can not create canvas"))}$3.getJSON(s,{},(function(e,n){if(e)i(e);else{var s=new Image;s.onload=function(){h(n,s)},s.onerror=function(e){i(e)},$3.getImage(s,o,{})}}))}))},loadSvgs:function(e){return new Promise((function(n,i){var o="",s=[],a="",h="",l="";if(Array.isArray(e)||e instanceof NodeList)s=e;else if(I2(e)){o=e.url,s=e.symbols,a=e.fill,h=e.stroke,l=e.sourceName||""}else E2(e)&&(o=e);if(o||!s||0!==s.length){var c=[],A=function(e,n){var i=function(e){var n=o4.parseFromString(e,"text/xml"),i=n.querySelector("svg");if(!i)return null;for(var o=i.childNodes,s=[],a=i.attributes,h=s4(a,"fill"),l=s4(a,"fill-opacity"),c=s4(a,"stroke"),A=s4(a,"stroke-opacity"),f=s4(a,"stroke-width"),d=0,p=o.length;d<p;d++){var g=o[d],v=g.attributes;if(v){var w=void 0,C="path"===(g.tagName||"").toLowerCase();if(w=C?s4(v,"d"):g){var P=s4(v,"fill")||h,T=s4(v,"stroke")||c,S={path:w};if(P&&(S.fill=P,S["fill-opacity"]=s4(v,"fill-opacity")||l||1),T&&(S.stroke=T,S["stroke-opacity"]=s4(v,"stroke-opacity")||A||1,S["stroke-width"]=s4(v,"stroke-width")||f||1),s.push(S),!C)for(var I in S)"path"!==I&&S.hasOwnProperty(I)&&g.setAttribute(I,S[I])}}}return s}(n);i&&(i.forEach((function(e){a&&(e.fill=a),h&&(e.stroke=h)})),i4.addResource(l+e,i)),c.push({name:e,paths:i,body:n})};if(o&&E2(o))fetch(o).then((function(e){return e.json()})).then((function(e){e.forEach((function(e){A(e.name,e.body)})),n(c)})).catch((function(e){console.log(e),i(e)}));else if(s){for(var f=0,d=s.length;f<d;f++){var p=s[f],g=p.id,v="<xml><svg>".concat(p.innerHTML,"</svg></xml>");g&&A(g,v)}n(c)}else i(new Error("not support svgs params type"))}else i(new Error("not find svgs data"))}))}};function r4(e){if(T2(e)&&(e+=t4),!e)return console.error("resouce path is null,path:",e),e;if(!E2(e))return e;if(function(e){return e4.test(e)}(e)||function(e){return 0===e.indexOf("blob:")}(e))return e;if("$"===e[0])return i4.getResource(e.substring(1,1/0))||"";var n=i4.origin||{},i=function(e){return B5.test(e)}(e);if(i&&I2(n))return(o=n4(e,n))||e;var o,s=i4.proxy||{};if(I2(s)&&(o=n4(e,s)))return o;var a=i4.host;return!i&&a&&E2(a)?"".concat(a).concat(e):J5(e)}var o4=new DOMParser;function s4(e,n){return e?e[n]&&e[n].value:null}let a4;const h4={width:100,height:10};function l4(){if(!a4){const{width:e,height:n}=h4;OffscreenCanvas?a4=new OffscreenCanvas(e,n):(a4=document.createElement("canvas"),a4.width=e,a4.height=n)}return a4}class ColorIn{constructor(e,n={}){if(!Array.isArray(e))return void console.error("colors is not array");if(e.length<2)return void console.error("colors.length should >1");this.colors=e;let i=1/0,o=-1/0;for(let n=0,s=e.length;n<s;n++){const s=e[n][0];i=Math.min(s,i),o=Math.max(s,o)}this.min=i,this.max=o,this.valueOffset=this.max-this.min,this.options=Object.assign({},h4,n),this._initImgData()}getImageData(){return this.imgData}_initImgData(){const e=l4(),{width:n,height:i}=this.options;e.width=n,e.height=i;const o=e.getContext("2d");o.clearRect(0,0,e.width,e.height);const s=o.createLinearGradient(0,0,e.width,0),{colors:a,valueOffset:h}=this;for(let e=0,n=a.length;e<n;e++){const[n,i]=a[e];s.addColorStop((n-this.min)/h,i)}o.fillStyle=s,o.fillRect(0,0,e.width,e.height),this.imgData=o.getImageData(0,0,e.width,e.height)}getColor(e){e=Math.max(this.min,e),e=Math.min(e,this.max);let n=Math.round((e-this.min)/this.valueOffset*this.imgData.width);n=Math.min(n,this.imgData.width-1);const i=4*n;return[this.imgData.data[i],this.imgData.data[i+1],this.imgData.data[i+2],this.imgData.data[i+3]]}}var u4;function c4(e,n){var i,o,s;if(_4(e)){var a,h=e.stops&&"object"==typeof e.stops[0][0],l=h||!(h||void 0!==e.property),c=e.type||n||"exponential";if("exponential"===c)a=d4;else if("interval"===c)a=f4;else if("categorical"===c)a=A4;else if("identity"===c)a=m4;else{if("color-interpolate"!==c)throw new Error('Unknown function type "'+c+'"');a=g4}if(h){var A={},f=[];for(let n=0;n<e.stops.length;n++){var d=e.stops[n];void 0===A[d[0].zoom]&&(A[d[0].zoom]={zoom:d[0].zoom,type:e.type,property:e.property,default:e.default,stops:[]}),A[d[0].zoom].stops.push([d[0].value,d[1]])}for(let e in A)f.push([A[e].zoom,c4(A[e])]);i=function(n,i){const o=d4({stops:f,base:e.base},n)(n,i);return"function"==typeof o?o(n,i):o},o=!1,s=!1}else l?(i=function(n){const i=a(e,n);return"function"==typeof i?i(n):i},o=!0,s=!1):(i=function(n,i){const o=a(e,i?i[e.property]:null);return"function"==typeof o?o(n,i):o},o=!1,s=!0)}else i=function(){return e},o=!0,s=!0;return i.isZoomConstant=s,i.isFeatureConstant=o,i}function A4(e,n){for(let i=0;i<e.stops.length;i++)if(n===e.stops[i][0])return e.stops[i][1];return e.default}function f4(e,n){for(var i=0;i<e.stops.length&&!(n<e.stops[i][0]);i++);return e.stops[Math.max(i-1,0)][1]}function d4(e,n){for(var i=void 0!==e.base?e.base:1,o=0;!(o>=e.stops.length||n<=e.stops[o][0]);)o++;return 0===o?e.stops[o][1]:o===e.stops.length?e.stops[o-1][1]:y4(n,i,e.stops[o-1][0],e.stops[o][0],e.stops[o-1][1],e.stops[o][1])}"function"==typeof Map&&(u4=new Map);const p4={width:100,height:1};function g4(e,n){const i=e.stops;if(i&&i.length>1){let e;if(u4){const n=JSON.stringify(i);if(!u4.has(n)){const e=new ColorIn(i,p4);u4.set(n,e)}e=u4.get(n)}else e=new ColorIn(i,p4);const[o,s,a,h]=e.getColor(n);return[o/255,s/255,a/255,h/255]}return i&&1===i.length?i[0][1]:null}function m4(e,n){return function(e,n,i){return void 0!==e?e:void 0!==n?n:null}(n,e.default)}function y4(e,n,i,o,s,a){return"function"==typeof s?function(){var h=s.apply(void 0,arguments),l=a.apply(void 0,arguments);return y4(e,n,i,o,h,l)}:s.length?function(e,n,i,o,s,a){var h=[];for(let l=0;l<s.length;l++)h[l]=v4(e,n,i,o,s[l],a[l]);return h}(e,n,i,o,s,a):v4(e,n,i,o,s,a)}function v4(e,n,i,o,s,a){var h,l=o-i,c=e-i;return s*(1-(h=1===n?c/l:(Math.pow(n,c)-1)/(Math.pow(n,l)-1)))+a*h}function _4(e){return e&&"object"==typeof e&&(e.stops||e.property&&"identity"===e.type)}function x4(e){for(const n in e)if(_4(e[n]))return!0;return!1}function b4(e){return P4(e,"exponential")}function w4(e,n){if(!e)return null;var i=!1;if(Array.isArray(e)){var o,s=[];for(let a=0;a<e.length;a++)(o=w4(e[a],n))?(s.push(o),i=!0):s.push(e[a]);return i?s:e}var a,h={__fn_types_loaded:!0},l=[];for(a in e)e.hasOwnProperty(a)&&l.push(a);const c=function(e){Object.defineProperty(h,e,{get:function(){return this["__fn_"+e]||(this["__fn_"+e]=b4(this["_"+e])),this["__fn_"+e].apply(this,n())},set:function(n){this["_"+e]=n},configurable:!0,enumerable:!0})};for(let n=0,o=l.length;n<o;n++)_4(e[a=l[n]])?(i=!0,h["_"+a]=e[a],c(a)):h[a]=e[a];return i?h:e}function C4(e){if(!e||!e.stops)return[];const n=[];for(let i=0,o=e.stops.length;i<o;i++)n.push(e.stops[i][1]);return n}function P4(e,n){if(!_4(e))return function(){return e};let i=!0,o=!0;const s=(e=JSON.parse(JSON.stringify(e))).stops;if(s)for(let e=0;e<s.length;e++)if(_4(s[e][1])){const a=P4(s[e][1],n);i=i&&a.isZoomConstant,o=o&&a.isFeatureConstant,s[e]=[s[e][0],a]}const a=c4(e,n);return a.isZoomConstant=i&&a.isZoomConstant,a.isFeatureConstant=o&&a.isFeatureConstant,a}
/*!
      Feature Filter by

      (c) mapbox 2016 and maptalks 2018
      www.mapbox.com | www.maptalks.org
      License: MIT, header required.
  */const M4=["Unknown","Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"];function T4(e){return new Function("f",`var p = (f && f.properties || {}); return ${S4(e)}`)}function S4(e){if(!e)return"true";const n=e[0];if(e.length<=1)return"any"===n?"false":"true";const i="=="===n?E4(e[1],e[2],"===",!1):"!="===n?E4(e[1],e[2],"!==",!1):"<"===n||">"===n||"<="===n||">="===n?E4(e[1],e[2],n,!0):"any"===n?R4(e.slice(1),"||"):"all"===n?R4(e.slice(1),"&&"):"none"===n?L4(R4(e.slice(1),"||")):"in"===n?D4(e[1],e.slice(2)):"!in"===n?L4(D4(e[1],e.slice(2))):"has"===n?k4(e[1]):"!has"===n?L4(k4(e[1])):"contains"===n?function(e,n,i){const o=I4(e);return void 0!==i?`(${o} + '').indexOf("${n}") === ${i}`:`(${o} + '').indexOf("${n}") >= 0`}(e[1],e[2],e[3]):"true";return`(${i})`}function I4(e){return"$"===e[0]?"f."+e.substring(1):"p["+JSON.stringify(e)+"]"}function E4(e,n,i,o){if("object"==typeof(s=e)&&s&&e.op)return function(e,n,i,o){const s=e.property,a=e.op;let h=I4(s);return"length"!==a?(console.error(`not support ${a} op`),"false"):(h=`((${h}+='').length)`,O4(h,s,n,i,o))}(e,n,i,o);var s;return O4(I4(e),e,n,i,o)}function O4(e,n,i,o,s){const a="$type"===n?M4.indexOf(i):JSON.stringify(i);return(s?`typeof ${e}=== typeof ${a}&&`:"")+e+o+a}function R4(e,n){return e.map(S4).join(n)}function D4(e,n){"$type"===e&&(n=n.map((e=>M4.indexOf(e))));const i=JSON.stringify(n.sort(F4)),o=I4(e);return n.length<=200?`${i}.indexOf(${o}) !== -1`:`function(v, a, i, j) {\n        while (i <= j) { var m = (i + j) >> 1;\n            if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;\n        }\n    return false; }(${o}, ${i},0,${n.length-1})`}function k4(e){return"$id"===e?'"id" in f':`${JSON.stringify(e)} in p`}function L4(e){return`!(${e})`}function F4(e,n){return e<n?-1:e>n?1:0}function N4(e){const n=e._toJSON(),i=n.feature;return i.type=M4.indexOf(i.geometry.type),i.subType=n.subType,i}function z4(e){if(!Array.isArray(e))return z4([e]);const n=[];for(let i=0;i<e.length;i++){let o;o=!0===e[i].filter?function(){return!0}:T4(e[i].filter),n.push(B4({},e[i],{filter:o}))}return n}function B4(e){for(let n=1;n<arguments.length;n++){const i=arguments[n];for(const n in i)e[n]=i[n]}return e}var H4=[],j4={};function U4(e,n){return w4(e,(function(){var e=n.getMap();return function(e,n,i){return e[0]=n,e[1]=i,e}(H4,e?e.getZoom():12,P2({},n.getProperties(),function(e,n,i,o){return e["{bearing}"]=n,e["{pitch}"]=i,e["{zoom}"]=o,e}(j4,e&&e.getBearing()||0,e&&e.getPitch()||0,e?e.getZoom():10)))}))}function G4(e,n,i){if(!e.markerPath)return null;var o=1,s=function(e){var n={stroke:{stroke:e.markerLineColor,"stroke-width":e.markerLineWidth,"stroke-opacity":e.markerLineOpacity,"stroke-dasharray":null,"stroke-linecap":"butt","stroke-linejoin":"round"},fill:{fill:e.markerFill,"fill-opacity":e.markerFillOpacity}};return 0===n.stroke["stroke-width"]&&(n.stroke["stroke-opacity"]=0),n}(e);T2(e.markerOpacity)&&(o=e.markerOpacity),T2(e.opacity)&&(o*=e.opacity);var a,h={};if(s){for(var l in s.stroke)s.stroke.hasOwnProperty(l)&&(M2(s.stroke[l])||(h[l]=s.stroke[l]));for(var l in s.fill)s.fill.hasOwnProperty(l)&&(M2(s.fill[l])||(h[l]=s.fill[l]))}var c,A=e.markerPath;a=E2(A)&&"$"===A[0]?i4.getResource(A.substring(1,1/0))||[]:Array.isArray(e.markerPath)?e.markerPath:[e.markerPath];for(var f=[],d=0;d<a.length;d++)(c=P2({},c=E2(a[d])?{path:a[d]}:a[d],h)).d=c.path,delete c.path,f.push(c);var p=['<svg version="1.1"','xmlns="http://www.w3.org/2000/svg"'];o<1&&p.push('opacity="'+o+'"'),e.markerPathWidth&&e.markerPathHeight&&p.push('viewBox="0 0 '+e.markerPathWidth+" "+e.markerPathHeight+'"'),p.push('preserveAspectRatio="none"'),n&&p.push('width="'+n+'"'),i&&p.push('height="'+i+'"'),p.push("><defs></defs>");for(d=0;d<f.length;d++)if(f[d].d instanceof Element)p.push(f[d].d.outerHTML);else{var g="<path ";for(var l in f[d])f[d].hasOwnProperty(l)&&(g+=" "+l+'="'+f[d][l]+'"');p.push(g+="></path>")}p.push("</svg>");var v="data:image/svg+xml;base64,"+function(e){if(f5.btoa)return window.btoa(e);for(var n=String(e),i="",o=void 0,s=void 0,a=0,h=G5;n.charAt(0|a)||(h="=",a%1);i+=h.charAt(63&o>>8-a%1*8)){if((s=n.charCodeAt(a+=3/4))>255)throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");o=o<<8|s}return i}(p.join(" "));return v}function V4(e,n){if(!e)return[];var i=e;Array.isArray(e)||(i=[e]);for(var o,s,a,h,l=[],c=i3,A=i.length-1;A>=0;A--)if(e=i[A]){n&&(e=W4(e));for(var f=0;f<c.length;f++)if(_4(o=e[c[f]])&&(o=C4(o)),o){Array.isArray(o)||(o=[o]);for(var d=0;d<o.length;d++)"url("===o[d].slice(0,4)&&(o[d]=U5(o[d])),l.push([o[d],e[(s=r3[f])[0]],e[s[1]]])}if("path"===e.markerType&&e.markerPath)if(a=_4(e.markerWidth)?200:e.markerWidth,h=_4(e.markerHeight)?200:e.markerHeight,_4(e.markerPath)){o=C4(e.markerPath);var p=e.markerPath;for(d=0;d<o.length;d++)e.markerPath=o[d],l.push([G4(e),a,h]);e.markerPath=p}else l.push([G4(e),a,h])}return l}function W4(e){if(!e)return null;var n=e;if(b2)return n;for(var i,o=i3,s=0,a=o.length;s<a;s++)(i=n[o[s]])&&(n[o[s]]=q4(i));return n}function q4(e){if(_4(e)&&e.stops){for(var n=e.stops,i=0;i<n.length;i++)n[i][1]=q4(n[i][1]);return e}return"url("===e.slice(0,4)&&(e=U5(e)),e}function Z4(e){return e&&e.colorStops}function Q4(e){var n=[e.type];if(e.places&&n.push(e.places.join()),e.colorStops){for(var i=[],o=e.colorStops.length-1;o>=0;o--)i.push(e.colorStops[o].join());n.push(i.join(","))}return n.join("_")}function X4(e,n){if(!e)return 1;var i=[];if(Array.isArray(e)){for(var o=0;o<e.length;o++)i.push(X4(e[o],n));return i.sort().join(",")}var s=Object.keys(e).sort().reduce((function(i,o){return n&&0!==o.indexOf(n)||(i[o]=e[o]),i}),{});return M3(JSON.stringify(s))}function Y4(e,n){function i(e,n){M2(e.opacity)?e.opacity=n:e.opacity*=n}var o;if(Array.isArray(e)){o=[];for(var s=0;s<e.length;s++){var a=P2({},e[s]);i(a,n),o.push(a)}}else i(o=P2({},e),n);return o}function J4(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var i=e[0],o=Array.prototype.slice.call(e,1);if(o&&o.length||(o=[{}]),Array.isArray(i)){for(var s=void 0,a=void 0,h=[],l=0,c=i.length;l<c;l++){s=i[l],a={};for(var A=0,f=o.length;A<f;A++)Array.isArray(o[A])?M2(o[A][l])?P2(a,s||{}):P2(a,s,o[A][l]):P2(a,s,o[A]?o[A]:{});h.push(a)}return h}var d=[{},i];return d.push.apply(d,o),P2.apply(this,d)}function K4(e){if(e.symbol&&(e=[e]),Array.isArray(e))return e;var n=e.$root,i=e.$iconset;if(e=e.style,n||i){n&&"/"===n[n.length-1]&&(n=n.substring(0,n.length-1)),i&&"/"===i[i.length-1]&&(i=i.substring(0,i.length-1));!function(e,n){for(var i=0;i<e.length;i++){var o=e[i].symbol;o&&t8(o,n)}}(e,(function(e){return"{$root}"===e?n:"{$iconset}"===e?i:null}))}return e}var $4=/(\{\$root\}|\{\$iconset\})/g;function t8(e,n){for(var i in e)e.hasOwnProperty(i)&&"textName"!==i&&(E2(e[i])&&e[i].length>2?e[i]=e[i].replace($4,n):_4(e[i])?e[i]=e8(e[i],n):I2(e[i])&&t8(e[i],n))}function e8(e,n){var i=e.default;E2(i)&&(e.default=i.replace($4,n));var o=e.stops;if(!o)return e;for(var s=0;s<o.length;s++)Array.isArray(o[s])&&(E2(o[s][1])?o[s][1]=o[s][1].replace($4,n):_4(o[s][1])&&(o[s][1]=e8(o[s][1],n)));return e}function n8(e,n,i,o,s){var a=1/Math.tan(n/2),h=1/(o-s);return e[0]=a/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(s+o)*h,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*s*o*h,e[15]=0,e}function i8(e,n,i){var o,s,a,h,l,c,A,f,d,p,g,v,w=i[0],C=i[1],P=i[2];return n===e?(e[12]=n[0]*w+n[4]*C+n[8]*P+n[12],e[13]=n[1]*w+n[5]*C+n[9]*P+n[13],e[14]=n[2]*w+n[6]*C+n[10]*P+n[14],e[15]=n[3]*w+n[7]*C+n[11]*P+n[15]):(s=n[1],a=n[2],h=n[3],l=n[4],c=n[5],A=n[6],f=n[7],d=n[8],p=n[9],g=n[10],v=n[11],e[0]=o=n[0],e[1]=s,e[2]=a,e[3]=h,e[4]=l,e[5]=c,e[6]=A,e[7]=f,e[8]=d,e[9]=p,e[10]=g,e[11]=v,e[12]=o*w+l*C+d*P+n[12],e[13]=s*w+c*C+p*P+n[13],e[14]=a*w+A*C+g*P+n[14],e[15]=h*w+f*C+v*P+n[15]),e}function r8(e,n,i){var o=i[0],s=i[1],a=i[2];return e[0]=n[0]*o,e[1]=n[1]*o,e[2]=n[2]*o,e[3]=n[3]*o,e[4]=n[4]*s,e[5]=n[5]*s,e[6]=n[6]*s,e[7]=n[7]*s,e[8]=n[8]*a,e[9]=n[9]*a,e[10]=n[10]*a,e[11]=n[11]*a,e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e}function o8(e,n,i){var o=n[0],s=n[1],a=n[2],h=n[3],l=n[4],c=n[5],A=n[6],f=n[7],d=n[8],p=n[9],g=n[10],v=n[11],w=n[12],C=n[13],P=n[14],T=n[15],S=i[0],I=i[1],E=i[2],O=i[3];return e[0]=S*o+I*l+E*d+O*w,e[1]=S*s+I*c+E*p+O*C,e[2]=S*a+I*A+E*g+O*P,e[3]=S*h+I*f+E*v+O*T,e[4]=(S=i[4])*o+(I=i[5])*l+(E=i[6])*d+(O=i[7])*w,e[5]=S*s+I*c+E*p+O*C,e[6]=S*a+I*A+E*g+O*P,e[7]=S*h+I*f+E*v+O*T,e[8]=(S=i[8])*o+(I=i[9])*l+(E=i[10])*d+(O=i[11])*w,e[9]=S*s+I*c+E*p+O*C,e[10]=S*a+I*A+E*g+O*P,e[11]=S*h+I*f+E*v+O*T,e[12]=(S=i[12])*o+(I=i[13])*l+(E=i[14])*d+(O=i[15])*w,e[13]=S*s+I*c+E*p+O*C,e[14]=S*a+I*A+E*g+O*P,e[15]=S*h+I*f+E*v+O*T,e}function s8(e,n){var i=n[0],o=n[1],s=n[2],a=n[3],h=n[4],l=n[5],c=n[6],A=n[7],f=n[8],d=n[9],p=n[10],g=n[11],v=n[12],w=n[13],C=n[14],P=n[15],T=i*l-o*h,S=i*c-s*h,I=i*A-a*h,E=o*c-s*l,O=o*A-a*l,k=s*A-a*c,L=f*w-d*v,F=f*C-p*v,N=f*P-g*v,z=d*C-p*w,H=d*P-g*w,j=p*P-g*C,W=T*j-S*H+I*z+E*N-O*F+k*L;return W?(e[0]=(l*j-c*H+A*z)*(W=1/W),e[1]=(s*H-o*j-a*z)*W,e[2]=(w*k-C*O+P*E)*W,e[3]=(p*O-d*k-g*E)*W,e[4]=(c*N-h*j-A*F)*W,e[5]=(i*j-s*N+a*F)*W,e[6]=(C*I-v*k-P*S)*W,e[7]=(f*k-p*I+g*S)*W,e[8]=(h*H-l*N+A*L)*W,e[9]=(o*N-i*H-a*L)*W,e[10]=(v*O-w*I+P*T)*W,e[11]=(d*I-f*O-g*T)*W,e[12]=(l*F-h*z-c*L)*W,e[13]=(i*z-o*F+s*L)*W,e[14]=(w*S-v*E-C*T)*W,e[15]=(f*E-d*S+p*T)*W,e):null}function a8(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function h8(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function l8(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var u8=c8;function c8(e,n,i){var o,s,a,h,l,c=e.length,A=f8(e[0],n),f=[];for(i||(i=[]),o=1;o<c;o++){for(s=e[o-1],h=l=f8(a=e[o],n);;){if(!(A|h)){f.push(s),h!==l?(f.push(a),o<c-1&&(i.push(f),f=[])):o===c-1&&f.push(a);break}if(A&h)break;A?A=f8(s=A8(s,a,A,n),n):h=f8(a=A8(s,a,h,n),n)}A=l}return f.length&&i.push(f),i}function A8(e,n,i,o){return 8&i?[e[0]+(n[0]-e[0])*(o[3]-e[1])/(n[1]-e[1]),o[3]]:4&i?[e[0]+(n[0]-e[0])*(o[1]-e[1])/(n[1]-e[1]),o[1]]:2&i?[o[2],e[1]+(n[1]-e[1])*(o[2]-e[0])/(n[0]-e[0])]:1&i?[o[0],e[1]+(n[1]-e[1])*(o[0]-e[0])/(n[0]-e[0])]:null}function f8(e,n){var i=0;return e[0]<n[0]?i|=1:e[0]>n[2]&&(i|=2),e[1]<n[1]?i|=4:e[1]>n[3]&&(i|=8),i}c8.polyline=c8,c8.polygon=function(e,n){var i,o,s,a,h,l,c;for(o=1;o<=8;o*=2){for(i=[],a=!(f8(s=e[e.length-1],n)&o),h=0;h<e.length;h++)(c=!(f8(l=e[h],n)&o))!==a&&i.push(A8(s,l,o,n)),c&&i.push(l),s=l,a=c;if(!(e=i).length)break}return i};var d8=l8(u8),p8=1/0,g8=1/0,m8=-1/0,y8=-1/0;function v8(){return[p8,g8,m8,y8]}var _8=v8();function x8(e){e[0]=p8,e[1]=g8,e[2]=m8,e[3]=y8}function b8(e,n){if(e)if(Array.isArray(e[0]))for(var i=0,o=e.length;i<o;i++)b8(e[i],n);else if(Array.isArray(e))for(i=0,o=e.length;i<o;i++){var s=e[i],a=s.x,h=s.y;n[0]=Math.min(a,n[0]),n[1]=Math.min(h,n[1]),n[2]=Math.max(a,n[2]),n[3]=Math.max(h,n[3])}else{a=e.x,h=e.y;n[0]=Math.min(a,n[0]),n[1]=Math.min(h,n[1]),n[2]=Math.max(a,n[2]),n[3]=Math.max(h,n[3])}}function w8(e,n,i,o,s){(0===n||n)&&(Array.isArray(n)&&(i=n[1],o=n[2],s=n[3],n=n[0]),e[0]=Math.min(n,e[0]),e[1]=Math.min(i,e[1]),e[2]=Math.max(o,e[2]),e[3]=Math.max(s,e[3]))}function C8(e){return e&&e[0]!==1/0&&void 0!==e[0]}function P8(e,n){void 0===n&&(n=0),e[0]-=n,e[1]-=n,e[2]+=n,e[3]+=n}function M8(e,n){var i=y5(e,4);return i[0]>=n[0]&&i[2]<=n[2]&&i[1]>=n[1]&&i[3]<=n[3]}var T8,S8="core-fetch-image";var I8=!1;var E8=[];function O8(e){return E8.indexOf(e)>-1}function R8(e){O8(e)||E8.push(e)}var D8={};function k8(e,n){D8[e]=n}var L8,F8="\n    var adapters = {};\n    // Dynamic Create Adapter\n    function createAdapter(key,code){\n        if(adapters[key]||!code){\n            return;\n        }\n        var func=new Function('exports',code+'(exports)');\n        var workerExports={};\n        func(workerExports,self);\n        adapters[key]=workerExports;\n        workerExports.initialize && workerExports.initialize(self);\n\n    }\n    onmessage = function (msg) {\n        msg = msg.data;\n        //createAdapter\n        if (msg.messageType === 'createAdapter') {\n           var key=msg.key;\n           var code=msg.code;\n           createAdapter(key,code);\n           postMessage({adapterName:key});\n           return;\n        }\n        // postMessage when main thread idle\n        if(msg.messageType==='idle'){\n            var messageRatio = msg.messageRatio;\n            handleMessageQueue(messageRatio);\n            return;\n        }\n        if (msg.messageType === 'batch') {\n            const messages = msg.messages;\n            if (messages) {\n                for (let i = 0; i < messages.length; i++) {\n                    dispatch(messages[i]);\n                }\n            }\n        } else {\n            dispatch(msg);\n        }\n    };\n\n    function dispatch(msg) {\n        var workerKey = msg.workerKey;\n        var adapter = adapters[workerKey];\n        if (!adapter) {\n            post(msg.callback, 'Unregistered worker adapters for ' + workerKey);\n            return;\n        }\n        try {\n            adapter.onmessage(msg, wrap(msg.callback));\n        } catch (err) {\n            post(msg.callback, workerKey + ':' + err.message);\n            console.error(err);\n            throw err;\n        }\n    }\n\n    var messageResultQueue = [];\n\n    function handleMessageQueue(messageRatio){\n       if(messageResultQueue.length===0){\n          return;\n       }\n       var count = Math.ceil((messageRatio || 1) * messageResultQueue.length);\n       var queues = messageResultQueue.slice(0, count);\n       queues.forEach(function(queue){\n          post(queue.callback,queue.err,queue.data,queue.buffers);\n       });\n       messageResultQueue=messageResultQueue.slice(count, Infinity);\n    }\n\n    function post(callback, err, data, buffers) {\n        var msg = {\n            callback : callback\n        };\n        if (err) {\n            msg.error = err;\n        } else {\n            msg.data = data;\n        }\n        if (buffers && buffers.length > 0) {\n            postMessage(msg, buffers);\n        } else {\n            postMessage(msg);\n        }\n    }\n\n    function joinQueue(callback,err,data,buffers){\n        messageResultQueue.push({\n            callback:callback,\n            err:err,\n            data:data,\n            buffers:buffers\n        });\n    }\n\n    function wrap(callback) {\n        return function (err, data, buffers) {\n            joinQueue(callback, err, data, buffers);\n        };\n    }\n    var workerExports;\n",N8="\n    workerExports = null;\n";function z8(){if("undefined"==typeof window)return null;if(!L8){var e=function(){var e=F8;for(var n in D8){var i=D8[n];R8(n),O2(i)&&0===i.length&&(i=i()),e+="\n    workerExports = {};\n    (".concat(i,")(workerExports, self);\n    adapters['").concat(n,"'] = workerExports"),e+="\n    workerExports.initialize && workerExports.initialize(self);\n        "}return e+N8}();L8=window.URL.createObjectURL(new Blob([e],{type:"text/javascript"})),D8={}}return L8}function B8(e,n){if(D8[e]){var i=D8[e];O2(i)&&0===i.length&&(i=i()),i="(".concat(i,")");if(T8){var o=T8.workers||[];0===o.length&&console.error("workerpool workers count is 0");var s=0,a=function(i){(i=i.data||{}).adapterName===e&&++s===o.length&&(o.forEach((function(e){e.removeEventListener("message",a)})),delete D8[e],n())};o.forEach((function(n){n.addEventListener("message",a),n.postMessage({key:e,code:i,messageType:"createAdapter"})}))}}else console.error("not find ".concat(e," adapter"))}var H8,j8="undefined"!=typeof window?window.navigator.hardwareConcurrency||4:0,U8=Math.max(Math.floor(j8/2),1),G8=function(){function e(e){void 0===e&&(e=50),this._limit=e,this._messages=[],this.buffers=[]}return e.prototype.addMessage=function(e,n){if(this._messages.push(e),Array.isArray(n))for(var i=0;i<n.length;i++)this.buffers.indexOf(n[i])<0&&this.buffers.push(n[i])},e.prototype.isFull=function(){return this._messages.length>=this._limit},e.prototype.getMessage=function(){return{messageType:"batch",messages:this._messages}},e}(),V8=function(){function e(){this.active={},this.workerCount="undefined"!=typeof window?w2.workerCount||U8:0,this._messages=[],this._messageBuffers=[]}return e.prototype.acquire=function(e){if(!this.workers){this.workers=[];for(var n=z8(),i=0;i<this.workerCount;i++){var o=new Worker(n);o.id=i,this.workers.push(o)}URL.revokeObjectURL(n),I8=!0}return this.active[e]=!0,this.workers.slice()},e.prototype.release=function(e){delete this.active[e],0===Object.keys(this.active).length&&(this.workers.forEach((function(e){e.terminate()})),this.workers=null)},e.prototype.addMessage=function(e,n,i){var o=this._messages[e];o&&o.length||(o=this._messages[e]=[new G8]);var s=o[o.length-1];s.isFull()&&(s=new G8,this._messages[e].push(s)),s.addMessage(n,i)},e.prototype.commit=function(){if(this.workers&&this._messages.length)for(var e=0;e<this._messages.length;e++)if(this._messages[e]&&this._messages[e].length){var n=this._messages[e].shift();this.workers[e].postMessage(n.getMessage(),n.buffers)}},e.prototype.getWorkers=function(){return this.workers||[]},e.prototype.broadcastIdleMessage=function(e){return this.getWorkers().forEach((function(n){n.postMessage({messageType:"idle",messageRatio:e})})),this},e}();function W8(){return H8||(H8=new V8,T8=H8),H8}var q8=[],Z8=[];function Q8(e){var n=w2.messagePostRatioPerWorker*(e?.5:1);W8().commit(),W8().broadcastIdleMessage(n),function(){if(0!==q8.length){for(var e=[],n=[],i=q8.length,o=0;o<i;o++)if((a=q8[o]).count--,-1===a.count)n.push(a);else{e.push(a);var s=a.run();a.results.push(s)}for(q8=e,i=n.length,o=0;o<i;o++){var a;(a=n[o]).resolve&&a.resolve(a.results)}}}(),Z8.forEach((function(e){e()}))}var X8=C2();function Y8(){Q8(),X8=C2(),requestIdleCallback(Y8)}function J8(){if(f5.requestIdleCallback){var e=w2.idleForceTimeThreshold,n=w2.idleLog;C2()-X8>e&&(Q8(!0),X8=C2(),n&&console.warn("did not apply for availability, forced run idle"))}else Q8();_5(J8)}var K8=!1;function $8(){K8||(K8=!0,f5.requestIdleCallback&&requestIdleCallback(Y8),_5(J8))}var t6,e6="function"==typeof Map,n6=function(){},i6=function(){function e(e,n){this.max=e,this.onRemove=n||n6,this.reset()}return e.prototype.reset=function(){for(var e in this.data)this.onRemove(this.data[e]);return this.data={},this.order=[],this},e.prototype.clear=function(){this.reset(),delete this.onRemove},e.prototype.add=function(e,n){if(this.has(e))this.order.splice(this.order.indexOf(e),1),this.data[e]=n,this.order.push(e);else if(this.data[e]=n,this.order.push(e),this.order.length>this.max){var i=this.getAndRemove(this.order[0]);i&&this.onRemove(i)}return this},e.prototype.has=function(e){return e in this.data},e.prototype.keys=function(){return this.order},e.prototype.getAndRemove=function(e){if(!this.has(e))return null;var n=this.data[e];return delete this.data[e],this.order.splice(this.order.indexOf(e),1),n},e.prototype.get=function(e){return this.has(e)?this.data[e]:null},e.prototype.remove=function(e){if(!this.has(e))return this;var n=this.data[e];return delete this.data[e],this.onRemove(n),this.order.splice(this.order.indexOf(e),1),this},e.prototype.setMaxSize=function(e){for(this.max=e;this.order.length>this.max;){var n=this.getAndRemove(this.order[0]);n&&this.onRemove(n)}return this},e}();e6&&(t6=function(){function e(e,n){this.max=e,this.onRemove=n||n6,this.reset()}return e.prototype.reset=function(){var e,n;if(this.data){var i=this.data.values();try{for(var o=m5(i),s=o.next();!s.done;s=o.next()){this.onRemove(s.value)}}catch(n){e={error:n}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}}return this.data=new Map,this},e.prototype.clear=function(){this.reset(),delete this.onRemove},e.prototype.add=function(e,n){return n?(this.has(e)?(this.data.delete(e),this.data.set(e,n)):this.data.set(e,n),this):this},e.prototype.keys=function(){var e,n,i=new Array(this.data.size),o=0,s=this.data.keys();try{for(var a=m5(s),h=a.next();!h.done;h=a.next()){i[o++]=h.value}}catch(n){e={error:n}}finally{try{h&&!h.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}return i},e.prototype.shrink=function(){for(var e=this.data.keys(),n=e.next();this.data.size>this.max;){var i=this.getAndRemove(n.value);i&&this.onRemove(i),n=e.next()}},e.prototype.has=function(e){return this.data.has(e)},e.prototype.getAndRemove=function(e){if(!this.has(e))return null;var n=this.data.get(e);return this.data.delete(e),n},e.prototype.get=function(e){return this.has(e)?this.data.get(e):null},e.prototype.remove=function(e){if(!this.has(e))return this;var n=this.data.get(e);return this.data.delete(e),this.onRemove(n),this},e.prototype.setMaxSize=function(e){return this.max=e,this.data.size>this.max&&this.shrink(),this},e}());var r6=e6?t6:i6,o6="#000",s6=!1,a6=null,h6=Math.PI/180;function l6(e,n,i,o,s,a,h,l,c,A){var f=(e+i)/2,d=(n+o)/2,p=(i+s)/2,g=(o+a)/2,v=(s+h)/2,w=(a+l)/2,C=Math.sqrt((i-e)*(i-e)+(o-n)*(o-n)),P=Math.sqrt((s-i)*(s-i)+(a-o)*(a-o)),T=C/(C+P),S=P/(P+Math.sqrt((h-s)*(h-s)+(l-a)*(l-a))),I=f+(p-f)*T,E=d+(g-d)*T,O=p+(v-p)*S,k=g+(w-g)*S,L=I+(p-I)*c+i-I,F=E+(g-E)*c+o-E,N=O+(p-O)*c+s-O,z=k+(g-k)*c+a-k,H=[L,F,N,z];return A<1?function(e,n,i,o,s,a,h,l,c,A){var f=1-e,d=1-n,p=i*d*d+2*s*n*d+h*n*n,g=s*d*d+2*h*n*d+c*n*n,v=o*d*d+2*a*n*d+l*n*n,w=a*d*d+2*l*n*d+A*n*n;return[(i*f*f+2*s*e*f+h*e*e)*d+(s*f*f+2*h*e*f+c*e*e)*n,(o*f*f+2*a*e*f+l*e*e)*d+(a*f*f+2*l*e*f+A*e*e)*n,p*f+g*e,v*f+w*e,p*d+g*n,v*d+w*n]}(0,A,i,o,L,F,N,z,s,a):H}var u6={getCanvas2DContext:function(e){return e.getContext("2d",{willReadFrequently:!0})},setHitTesting:function(e){s6=e},createCanvas:function(e,n,i){var o;return b2?o=new i(e,n):((o=O3("canvas")).width=e,o.height=n),o},prepareCanvasFont:function(e,n){"top"!==e.textBaseline&&(e.textBaseline="top");var i=C3(n);e.font!==i&&(e.font=i);var o=n.textFill;o||(o="#000");var s=u6.getRgba(o,n.textOpacity);e.fillStyle!==s&&(e.fillStyle=s)},prepareCanvas:function(e,n,i,o){if(n){var s=n.lineWidth;M2(s)||e.lineWidth===s||(e.lineWidth=s);var a=n.linePatternFile,h=n.lineColor||o6;if(o)e.strokeStyle="#000";else if(a&&i){var l=void 0;(n.linePatternDx||n.linePatternDy)&&(l=[n.linePatternDx,n.linePatternDy]),u6._setStrokePattern(e,a,s,l,i),n.lineDasharray=[]}else Z4(h)?e.strokeStyle=n.lineGradientExtent?u6._createGradient(e,h,n.lineGradientExtent):o6:(Array.isArray(h)&&(h=u6.normalizeColorToRGBA(h)),e.strokeStyle=h);n.lineJoin&&(e.lineJoin=n.lineJoin),n.lineCap&&(e.lineCap=n.lineCap),e.setLineDash&&z5(n.lineDasharray)&&e.setLineDash(n.lineDasharray);var c=n.polygonPatternFile,A=n.polygonFill||"rgba(255,255,255,0)";if(o)e.fillStyle="#000";else if(c&&i){var f=f6(c),d=i.getImage([f,null,null]);if(d||(d=i.getImage([f+"-texture",null,s])),C5(f)&&d instanceof Image&&(f5.edge||f5.ie)){var p=d.width||20,g=d.height||20,v=u6.createCanvas(p,g);u6.image(v.getContext("2d"),d,0,0,p,g),d=v}d?(e.fillStyle=e.createPattern(d,"repeat"),(n.polygonPatternDx||n.polygonPatternDy)&&(e.fillStyle.polygonPatternOffset=[n.polygonPatternDx,n.polygonPatternDy])):"undefined"!=typeof console&&console.warn("img not found for",f)}else Z4(A)?e.fillStyle=n.polygonGradientExtent?u6._createGradient(e,A,n.polygonGradientExtent):"rgba(255,255,255,0)":(Array.isArray(A)&&(A=u6.normalizeColorToRGBA(A)),e.fillStyle=A)}},_createGradient:function(e,n,i){var o=null,s=n.places,a=i.getMin(),h=i.getMax(),l=i.getWidth(),c=i.getHeight();if(n.type&&"linear"!==n.type){if("radial"===n.type){if(s){if(6!==s.length)throw new Error("A radial gradient's places should have 6 numbers.");s=[a.x+s[0]*l,a.y+s[1]*c,l*s[2],a.x+s[3]*l,a.y+s[4]*c,l*s[5]]}else{var A=i.getCenter()._round();s=[A.x,A.y,Math.abs(A.x-a.x),A.x,A.y,0]}o=e.createRadialGradient.apply(e,s)}}else{if(s){if(4!==s.length)throw new Error("A linear gradient's places should have 4 numbers.");s=[a.x+s[0]*l,a.y+s[1]*c,a.x+s[2]*l,a.y+s[3]*c]}else s=[a.x,a.y,h.x,a.y];o=e.createLinearGradient.apply(e,s)}return n.colorStops.forEach((function(e){o.addColorStop.apply(o,e)})),o},_setStrokePattern:function(e,n,i,o,s){var a,h=f6(n);if(b2)a=s.getImage([h,null,i]);else{var l=h+"-texture-"+i;if(!(a=s.getImage(l))){var c=s.getImage([h,null,null]);if(c){var A=void 0;A=c.width&&c.height?Math.round(c.width*i/c.height):i;var f=u6.createCanvas(A,i,e.canvas.constructor);u6.image(f.getContext("2d"),c,0,0,A,i),s.addResource([l,null,i],f),a=f}}}a?(e.strokeStyle=e.createPattern(a,"repeat"),e.strokeStyle.linePatternOffset=o):"undefined"!=typeof console&&console.warn("img not found for",h)},clearRect:function(e,n,i,o,s){e.canvas._drawn=!1,e.clearRect(n,i,o,s)},fillCanvas:function(e,n,i,o){if(s6&&(n=1),e.canvas._drawn=!0,0!==n){var s,a=u6._isPattern(e.fillStyle),h=e.fillStyle&&e.fillStyle.polygonPatternOffset,l=h?h[0]:0,c=h?h[1]:0;M2(n)&&(n=1),n<1&&(s=e.globalAlpha,e.globalAlpha*=n),a&&e.translate((i=i||0)+l,(o=o||0)+c),e.fill(),a&&e.translate(-i-l,-o-c),n<1&&(e.globalAlpha=s)}},getRgba:function(e,n){return M2(n)&&(n=1),"#"!==e[0]?(Array.isArray(e)&&(e=u6.normalizeColorToRGBA(e,n)),e):(7===e.length?(i=parseInt(e.substring(1,3),16),o=parseInt(e.substring(3,5),16),s=parseInt(e.substring(5,7),16)):(i=17*parseInt(e.substring(1,2),16),o=17*parseInt(e.substring(2,3),16),s=17*parseInt(e.substring(3,4),16)),"rgba("+i+","+o+","+s+","+n+")");var i,o,s},normalizeColorToRGBA:function(e,n){return void 0===n&&(n=1),"rgba(".concat(255*e[0],",").concat(255*e[1],",").concat(255*e[2],",").concat((4===e.length?e[3]:1)*n,")")},image:function(e,n,i,o,s,a){e.canvas._drawn=!0;try{T2(s)&&T2(a)?e.drawImage(n,i,o,s,a):e.drawImage(n,i,o)}catch(e){console&&(console.warn("error when drawing image on canvas:",e),console.warn(n))}},text:function(e,n,i,o,s){return u6._textOnMultiRow(e,s.rows,o,i,s.size,s.rawSize)},_textOnMultiRow:function(e,n,i,o,s,a){var h,l,c=x3(s,i.textHorizontalAlignment,i.textVerticalAlignment),A=a.height+i.textLineSpacing,f=o.add(0,c.y),d=i.textMaxHeight,p=0;x8(_8);for(var g=0,v=n.length;g<v;g++){h=n[g].text,l=x3(n[g].size,i.textHorizontalAlignment,i.textVerticalAlignment);var w=f.add(l.x,g*A);u6._textOnLine(e,h,w,i.textHaloRadius,i.textHaloFill,i.textHaloOpacity);var C=n[g].size,P=w.x,T=w.y;if(w8(_8,P,T,P+C.width,T+C.height),d>0&&(p+=A)+C.height>=d)break}return _8},_textOnLine:function(e,n,i,o,s,a){s6&&(a=1);var h,l,c=0!==a&&0!==o;e.textBaseline="top";var A=e.shadowBlur,f=e.shadowOffsetX,d=e.shadowOffsetY;if(c){var p=e.globalAlpha;e.globalAlpha*=a,e.miterLimit=2,e.lineJoin="round",e.lineCap="round",e.lineWidth=2*o,Array.isArray(s)&&(s=u6.normalizeColorToRGBA(s)),e.strokeStyle=s,e.strokeText(n,i.x,i.y+1),e.miterLimit=10,e.globalAlpha=p,h=e.globalCompositeOperation,e.globalCompositeOperation="destination-out",l=e.fillStyle,e.fillStyle="#000"}A&&c&&(e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0),u6.fillText(e,n,i),h&&(e.globalCompositeOperation=h,u6.fillText(e,n,i,l),A&&(e.shadowBlur=A,e.shadowOffsetX=f,e.shadowOffsetY=d))},fillText:function(e,n,i,o){e.canvas._drawn=!0,o&&(e.fillStyle=o),e.fillText(n,i.x,i.y+1)},_stroke:function(e,n,i,o){if(s6&&(n=1),e.canvas._drawn=!0,0!==n){var s,a=e.strokeStyle&&e.strokeStyle.linePatternOffset,h=a?a[0]:0,l=a?a[1]:0,c=u6._isPattern(e.strokeStyle)&&(!M2(i)&&!M2(o)||!M2(h)&&!M2(l));M2(n)&&(n=1),n<1&&(s=e.globalAlpha,e.globalAlpha*=n),c&&e.translate((i=i||0)+h,(o=o||0)+l),e.stroke(),c&&e.translate(-i-h,-o-l),n<1&&(e.globalAlpha=s)}},_path:function(e,n,i,o,s){if(z5(n))for(var a,h=z5(i),l=!0!==s&&u6._isPattern(e.strokeStyle),c=0,A=n.length;c<A;c++)if(a=n[c],!h||e.setLineDash)e.lineTo(a.x,a.y),l&&c>0&&(f(n[c-1],a),e.beginPath(),e.moveTo(a.x,a.y));else if(h){if(c===A-1)break;c6(e,a,n[c+1],i)}function f(n,i){var s=V5(n.x,n.y,i.x,i.y);e.save();var a=Math.cos(s);Math.abs(a)<1e-7?e.translate(n.x-e.lineWidth/2,n.y):e.translate(n.x,n.y-e.lineWidth/2/a),e.rotate(s),u6._stroke(e,o),e.restore()}},path:function(e,n,i,o,s){z5(n)&&(e.beginPath(),e.moveTo(n[0].x,n[0].y),u6._path(e,n,s,i),u6._stroke(e,i))},_multiClip:function(e,n){n&&0!==n.length&&n.forEach((function(n){for(var i=0,o=n.length;i<o;i++){var s=n[i],a=s.x,h=s.y;0===i?e.moveTo(a,h):e.lineTo(a,h),i===o-1&&e.lineTo(a=n[0].x,h=n[0].y)}}))},polygon:function(e,n,i,o,s,a){if(e.isMultiClip)u6._multiClip(e,n);else if(e.isClip)u6._multiClip(e,Array.isArray(n[0])?n:[n]);else if(z5(n)){var h=u6._isPattern(e.strokeStyle),l=z5(s)&&!e.setLineDash||h&&!a;z5(n[0])||(n=[n]);var c,A,f,d=e,p=e.dpr||1,g=1!==p;if(n.length>1&&!b2&&(a6||(a6=u6.createCanvas(1,1)),e.canvas._drawn=!1,a6.width=e.canvas.width,a6.height=e.canvas.height,p6(e=a6.getContext("2d"),[]),p6(e,s),d6(e,d),g&&e.scale(p,p)),l){for(e.save(),A=0,f=n.length;A<f;A++)z5(n[A])&&(u6._ring(e,n[A],null,0,!0),c=o,A>0&&(e.globalCompositeOperation="destination-out",c=1),u6.fillCanvas(e,c,n[A][0].x,n[A][0].y),A>0?e.globalCompositeOperation="source-over":f>1&&(e.fillStyle="#fff"),u6._stroke(e,0));e.restore()}var v=e.fillStyle;for(A=0,f=n.length;A<f;A++)z5(n[A])&&(a?(u6.paintSmoothLine(e,n[A],i,a,!0),e.closePath()):u6._ring(e,n[A],s,i),l||(c=o,A>0&&(e.globalCompositeOperation="destination-out",c=1),u6.fillCanvas(e,c,n[A][0].x,n[A][0].y),A>0?e.globalCompositeOperation="source-over":f>1&&(e.fillStyle="#fff")),u6._stroke(e,i));if(e.fillStyle!==v&&(e.fillStyle=v),n.length>1&&!b2){if(g){var w=1/p;d.scale(w,w)}d.drawImage(a6,0,0),g&&d.scale(p,p),d.canvas._drawn=e.canvas._drawn,d6(d,e)}}},_ring:function(e,n,i,o,s){var a=u6._isPattern(e.strokeStyle);s||!a||n[0].equals(n[n.length-1])||(n=n.concat([n[0]])),e.beginPath(),e.moveTo(n[0].x,n[0].y),u6._path(e,n,i,o,s),a||e.closePath()},paintSmoothLine_bak:function(e,n,i,o,s,a,h){if(n)if(n.length<=2||!o)u6.path(e,n,i);else{var l,c=n.length,A=s?c:c-1;e.beginPath(),e.moveTo(n[0].x,n[0].y),void 0!==h&&(A-=Math.max(A-a-1,0));for(var f=0;f<A;f++){var d=void 0,p=void 0,g=void 0,v=void 0,w=void 0,C=void 0;f-1<0?s?(d=n[A-1].x,p=n[A-1].y):(d=n[f+1].x,p=n[f+1].y):(d=n[f-1].x,p=n[f-1].y),f+1<c?(g=n[f+1].x,v=n[f+1].y):(g=n[f+1-c].x,v=n[f+1-c].y),f+2<c?(w=n[f+2].x,C=n[f+2].y):s?(w=n[f+2-c].x,C=n[f+2-c].y):(w=n[f].x,C=n[f].y);var P=l6(d,p,n[f].x,n[f].y,g,v,w,C,o,f===A-1?h:1);if(f===A-1&&h>=0&&h<1){e.bezierCurveTo(P[0],P[1],P[2],P[3],P[4],P[5]),n.splice(A-1,c-(A-1)-1);var T=new w5(P[4],P[5]);T.prevCtrlPoint=new w5(P[2],P[3]),n.push(T),c=n.length}else e.bezierCurveTo(P[0],P[1],P[2],P[3],g,v);n[f].nextCtrlPoint=P.slice(0,2),n[f].prevCtrlPoint=l?l.slice(2):null,l=P}!s&&n[1].prevCtrlPoint&&(n[0].nextCtrlPoint=n[1].prevCtrlPoint,delete n[0].prevCtrlPoint),n[c-1].prevCtrlPoint||(n[c-1].prevCtrlPoint=n[c-2].nextCtrlPoint),u6._stroke(e,i)}},paintSmoothLine:function(e,n,i,o,s,a,h){if(n)if(n.length<=2||!o)u6.path(e,n,i);else{var l,c,A=n.length,f=s?A:A-1;e.beginPath(),e.moveTo(n[0].x,n[0].y),void 0!==h&&(f-=Math.max(f-a-1,0));for(var d=0;d<f;d++){var p=void 0,g=void 0,v=void 0,w=void 0,C=void 0,P=void 0;d-1<0?s?(p=n[f-1].x,g=n[f-1].y):(p=n[d+1].x,g=n[d+1].y):(p=n[d-1].x,g=n[d-1].y),d+1<A?(v=n[d+1].x,w=n[d+1].y):(v=n[d+1-A].x,w=n[d+1-A].y),d+2<A?(C=n[d+2].x,P=n[d+2].y):s?(C=n[d+2-A].x,P=n[d+2-A].y):(C=n[d].x,P=n[d].y);var T=n[d],S=l6(p,g,n[d].x,n[d].y,v,w,C,P,o,d===f-1?h:1);if(d===f-1&&h>=0&&h<1){e.bezierCurveTo(S[0],S[1],S[2],S[3],S[4],S[5]),n.splice(f-1,A-(f-1)-1);var I=new w5(S[4],S[5]);n.push(I),A=n.length}else e.bezierCurveTo(S[0],S[1],S[2],S[3],v,w);0===d?(T.arrowNextPoint=T.arrowNextPoint||new w5(0,0),c=S[3],T.arrowNextPoint.x=l=S[2],T.arrowNextPoint.y=c):(T.arrowPrePoint=T.arrowPrePoint||new w5(0,0),T.arrowPrePoint.x=l,T.arrowPrePoint.y=c,l=S[2],c=S[3],d===f-1&&n[d+1]&&(n[d+1].arrowPrePoint=n[d+1].arrowPrePoint||new w5(0,0),n[d+1].arrowPrePoint.x=S[0],n[d+1].arrowPrePoint.y=S[1]))}u6._stroke(e,i)}},_arcBetween:function(e,n,i,o){var s=Math.abs(o),a=n.distanceTo(i),h=Math.abs(a/2/Math.sin(s/2)),l=Math.asin((i.y-n.y)/a);n.x>i.x&&(l=Math.PI-l);var c=l-(90*h6-s/2),A=Math.cos(c)*h,f=Math.sin(c)*h,d=n.x+A,p=n.y+f,g=Math.asin((i.y-p)/h);d>i.x&&(g=Math.PI-g);var v=g+s;if(o<0){g+=Math.PI,v+=Math.PI;var w=(n.x+i.x)/2,C=(n.y+i.y)/2;d=w-(d-w),p=C-(p-C)}e.beginPath(),e.arc(d,p,h,g,v);var P=(v-g)/100,T=Math.cos(g+P)*h+d,S=Math.sin(g+P)*h+p,I=Math.cos(v-P)*h+d,E=Math.sin(v-P)*h+p;return n.arrowNextPoint=n.arrowNextPoint||new w5(0,0),i.arrowPrePoint=i.arrowPrePoint||new w5(0,0),o<0?(n.arrowNextPoint.x=T,n.arrowNextPoint.y=S,i.arrowPrePoint.x=I,i.arrowPrePoint.y=E):(n.arrowNextPoint.x=I,n.arrowNextPoint.y=E,i.arrowPrePoint.x=T,i.arrowPrePoint.y=S),[d,p]},_lineTo:function(e,n){e.lineTo(n.x,n.y)},bezierCurveAndFill:function(e,n,i,o){e.beginPath();var s=n[0];e.moveTo(s.x,s.y);var a=[e];a.push.apply(a,n.splice(1)),u6._bezierCurveTo.apply(u6,a),u6.fillCanvas(e,o),u6._stroke(e,i)},_bezierCurveTo:function(e,n,i,o){e.bezierCurveTo(n.x,n.y,i.x,i.y,o.x,o.y)},ellipse:function(e,n,i,o,s,a,h){e.beginPath(),i===o&&i===s?e.arc(n.x,n.y,i,0,2*Math.PI):e.ellipse?o!==s?(e.ellipse(n.x,n.y,i,o,0,180*h6,360*h6,!1),e.ellipse(n.x,n.y,i,s,0,0,180*h6,!1)):e.ellipse(n.x,n.y,i,o,0,0,360*h6,!1):function(n,i,o,s,a){var h=.5522848,l=o*h,c=s*h,A=a*h;e.moveTo(n-o,i),e.bezierCurveTo(n-o,i-c,n-l,i-s,n,i-s),e.bezierCurveTo(n+l,i-s,n+o,i-c,n+o,i),e.bezierCurveTo(n+o,i+A,n+l,i+a,n,i+a),e.bezierCurveTo(n-l,i+a,n-o,i+A,n-o,i),e.closePath()}(n.x,n.y,i,o,s),u6.fillCanvas(e,h,n.x-i,n.y-o),u6._stroke(e,a,n.x-i,n.y-o)},rectangle:function(e,n,i,o,s){var a=n.x,h=n.y;e.beginPath(),e.rect(a,h,i.width,i.height),u6.fillCanvas(e,s,a,h),u6._stroke(e,o,a,h)},sector:function(e,n,i,o,s,a){var h=h6;!function(e,n,i,o,l,c){var A=h*-c,f=h*-l;e.beginPath(),e.moveTo(n,i),e.arc(n,i,o,A,f),e.lineTo(n,i),u6.fillCanvas(e,a,n-o,i-o),u6._stroke(e,s,n-o,i-o)}(e,n.x,n.y,i,o[0],o[1])},_isPattern:function(e){return!E2(e)&&!("addColorStop"in e)},drawCross:function(e,n,i,o,s){e.canvas._drawn=!0,e.strokeStyle=s,e.lineWidth=o,e.beginPath(),e.moveTo(n-5,i),e.lineTo(n+5,i),e.moveTo(n,i-5),e.lineTo(n,i+5),e.stroke()},copy:function(e,n){var i=n||O3("canvas");return i.width=e.width,i.height=e.height,i.getContext("2d").drawImage(e,0,0),i},pixelRect:function(e,n,i,o){var s=e.globalAlpha,a=!1;if(e.lineWidth>0&&i>0)a=!0,i<1&&(e.globalAlpha*=i);else{if(!(o>0))return;o<1&&(e.globalAlpha*=o)}e.canvas._drawn=!0,a?e.strokeRect(n[0],n[1],1,1):e.fillRect(n[0],n[1],1,1),e.globalAlpha!==s&&(e.globalAlpha=s)}};function c6(e,n,i,o){var s=n.x,a=n.y,h=i.x,l=i.y,c=o,A=function(e,n){return e<=n},f=function(e,n){return e>=n},d=function(e,n){return Math.min(e,n)},p=function(e,n){return Math.max(e,n)},g={thereYet:f,cap:d},v={thereYet:f,cap:d};a-l>0&&(v.thereYet=A,v.cap=p),s-h>0&&(g.thereYet=A,g.cap=p),e.moveTo(s,a);for(var w,C,P=s,T=a,S=0,I=!0;!g.thereYet(P,h)||!v.thereYet(T,l);)w=Math.atan2(l-a,h-s),C=c[S],P=g.cap(h,P+Math.cos(w)*C),T=v.cap(l,T+Math.sin(w)*C),I?e.lineTo(P,T):e.moveTo(P,T),S=(S+1)%c.length,I=!I}var A6="data:image/";function f6(e){return e.substring(0,A6.length)===A6?e:U5(e)}function d6(e,n){e.filter=n.filter,e.fillStyle=n.fillStyle,e.globalAlpha=n.globalAlpha,e.lineCap=n.lineCap,e.lineDashOffset=n.lineDashOffset,e.lineJoin=n.lineJoin,e.lineWidth=n.lineWidth,e.shadowBlur=n.shadowBlur,e.shadowColor=n.shadowColor,e.shadowOffsetX=n.shadowOffsetX,e.shadowOffsetY=n.shadowOffsetY,e.strokeStyle=n.strokeStyle}function p6(e,n){n&&e.setLineDash&&Array.isArray(n)&&e.setLineDash(n)}function g6(e){return"Z__"+e}function m6(e){return function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype.on=function(e,n,i){if(!e)return this;if(!E2(e))return this._switch("on",e,n);if(!n)return this;this._eventMap||(this._eventMap={});var o,s=e.toLowerCase().split(" ");i||(i=this);var a,h=T2(n._id);n._id=T5();for(var l=0,c=s.length;l<c;l++){var A=g6(o=s[l]);if(n[A]&&(n[A]._id=n._id),(a=this._eventMap[o])||(this._eventMap[o]=a=[]),h){var f=a.length;if(f>0)for(var d=0;d<f;d++)if(n===a[d].handler&&a[d].context===i)return console.warn(this,"find '".concat(e,"' handler:"),n," The old listener function will be removed"),this;a.push({handler:n,context:i})}else a.push({handler:n,context:i})}return this},n.prototype.addEventListener=function(){for(var e,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return(e=this.on).call.apply(e,v5([this],y5(n),!1))},n.prototype.once=function(e,n,i){if(!E2(e)){var o={};for(var s in e)e.hasOwnProperty(s)&&(o[s]=this._wrapOnceHandler(s,e[s],n));return this._switch("on",o)}for(var a=e.split(" "),h=0,l=a.length;h<l;h++)this.on(a[h],this._wrapOnceHandler(a[h],n,i));return this},n.prototype.off=function(e,n,i){if(!this._eventMap||!e)return this;if(!E2(e))return this._switch("off",e,n);if(!n)return this;if(!T2(n._id))return this;var o,s,a,h=e.split(" ");i||(i=this);for(var l=0,c=h.length;l<c;l++)if(a=g6(o=h[l].toLowerCase()),s=this._eventMap[o]){for(var A=s.length-1;A>=0;A--){var f=s[A];n!==f.handler&&n!==f.handler[a]||f.context!==i||(delete f.handler[a],s.splice(A,1))}s.length||delete this._eventMap[o]}return this},n.prototype.removeEventListener=function(){for(var e,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return(e=this.off).call.apply(e,v5([this],y5(n),!1))},n.prototype.listens=function(e,n,i){if(!this._eventMap||!E2(e))return 0;var o=this._eventMap[e.toLowerCase()];if(!o||!o.length)return 0;if(!n)return o.length;for(var s=0,a=o.length;s<a;s++)if(n===o[s].handler&&(M2(i)||o[s].context===i))return 1;return 0},n.prototype.getListeningEvents=function(){return this._eventMap?Object.keys(this._eventMap):[]},n.prototype.copyEventListeners=function(e){var n,i=e._eventMap;if(!i)return this;for(var o in i)for(var s=0,a=(n=i[o]).length;s<a;s++)this.on(o,n[s].handler,n[s].context);return this},n.prototype.fire=function(e,n){return this._eventParent?this._eventParent.fire.call(this._eventParent,e,n):this._fire.call(this,e,n)},n.prototype._wrapOnceHandler=function(e,n,i){var o=g6(e),s=!1,a=function e(){for(var h=[],l=0;l<arguments.length;l++)h[l]=arguments[l];s||(delete a[o],s=!0,n.call.apply(n,v5(i?[i]:[this],y5(h),!1)),e._called=!0)};return a[o]=n,a},n.prototype._switch=function(e,n,i){for(var o in n)n.hasOwnProperty(o)&&this[e](o,n[o],i);return this},n.prototype._clearListeners=function(e){this._eventMap&&E2(e)&&(this._eventMap[e.toLowerCase()]&&(this._eventMap[e]=null))},n.prototype._clearAllListeners=function(){this._eventMap=null},n.prototype._setEventParent=function(e){return this._eventParent=e,this},n.prototype._setEventTarget=function(e){return this._eventTarget=e,this},n.prototype._fire=function(e,n){if(!this._eventMap)return this;e=e.toLowerCase();var i=this._eventMap[e];if(!i)return this;n||(n={type:e,target:this._eventTarget||this}),n.type=e,n.target=this._eventTarget||this;for(var o,s,a=i.slice(0),h=0,l=a.length;h<l;h++){if(a[h])a[h].handler._called||(o=a[h].context,!0,s=P2({},n),!1===(o?a[h].handler.call(o,s):a[h].handler(s))&&n.domEvent&&z3(n.domEvent))}var c=this._eventMap[e];if(c){var A=[];for(h=0,l=c.length;h<l;h++){c[h].handler._called||A.push(c[h])}this._eventMap[e]=A}return this},n}(e)}var y6=function(e){function n(n){var i=e.call(this)||this;return i._enabled=!1,i.target=n,i}return p5(n,e),n.prototype.enable=function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},n.prototype.disable=function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},n.prototype.enabled=function(){return!!this._enabled},n.prototype.remove=function(){this.disable(),delete this.target,delete this.dom},n}(m6((function(){}))),v6=function(){function e(e){if(!this||!this.setOptions)throw new Error('Class instance is being created without "new" operator.');this.setOptions(e),this.callInitHooks(),this._isUpdatingOptions=!1}return e.prototype.proxyOptions=function(){var e=this;return f5.proxy?(this.options=new Proxy(this.options,{set:function(n,i,o){if(n[i]===o)return!0;if(n[i]=o,e._isUpdatingOptions)return!0;var s={};return s[i]=o,e.config(s),!0}}),this):this},e.prototype.callInitHooks=function(){var e=Object.getPrototypeOf(this);return this._visitInitHooks(e),this},e.prototype.setOptions=function(e){if(this.hasOwnProperty("options")||(this.options=this.options?Object.create(this.options):{}),!e)return this;for(var n in e)this.options[n]=e[n];return this},e.prototype.config=function(e,n){if(this._isUpdatingOptions=!0,!e){var i={};for(var o in this.options)this.options.hasOwnProperty(o)&&(i[o]=this.options[o]);return this._isUpdatingOptions=!1,i}if(2===arguments.length&&"string"==typeof e){var s={};s[e]=n,e=s}for(var a in e)this.options[a]=e[a],this[a]&&this[a]instanceof y6&&(e[a]?this[a].enable():this[a].disable());return this.onConfig(e),this._isUpdatingOptions=!1,this},e.prototype.onConfig=function(e){},e.prototype._visitInitHooks=function(e){if(!this._initHooksCalled){var n=Object.getPrototypeOf(e);n._visitInitHooks&&n._visitInitHooks.call(this,n),this._initHooksCalled=!0;var i=e._initHooks;if(i&&i!==n._initHooks)for(var o=0;o<i.length;o++)i[o].call(this)}},e.addInitHook=function(e){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var o="function"==typeof e?e:function(){var i;(i=this[e]).call.apply(i,v5([this],y5(n),!1))},s=this.prototype,a=Object.getPrototypeOf(s);return s._initHooks&&s._initHooks!==a._initHooks||(s._initHooks=[]),s._initHooks.push(o),this},e.include=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];for(var i=0;i<e.length;i++)P2(this.prototype,e[i]);return this},e.mergeOptions=function(e){var n=this.prototype,i=Object.getPrototypeOf(n);return n.options&&n.options!==i.options||(n.options=n.options?Object.create(n.options):{}),P2(n.options,e),this},e}(),_6=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n}(m6((function(){}))),x6=new _6,b6="dprchange",w6="docvisibilitychange",C6="dragstart",P6="dragend";if("undefined"!=typeof window&&window.matchMedia)for(var M6=1;M6<500;M6++){var T6=(.01*M6).toFixed(2),S6=window.matchMedia("screen and (resolution: ".concat(T6,"dppx)"));S6&&(S6.addEventListener?S6.addEventListener("change",f5.checkDevicePixelRatio):S6.addListener&&S6.addListener(f5.checkDevicePixelRatio))}if(f5.devicePixelRatio){var I6=f5.devicePixelRatio;Object.defineProperty(f5,"devicePixelRatio",{get:function(){return I6},set:function(e){e!==I6&&(I6=e,f5.monitorDPRChange&&x6.fire(b6,{devicePixelRatio:e}))}})}f5.webgl&&"undefined"!=typeof document&&(k3(document,"visibilitychange",(function(){x6.fire(w6,{visibilityState:document.visibilityState})})),k3(document,"dragstart",(function(){x6.fire(C6)})),k3(document,"dragend",(function(){x6.fire(P6)})));var E6={};function O6(e){return function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.registerJSONType=function(e){e&&(E6[e]?console.error("".concat(e," has register. please use Different name for:"),this):E6[e]=this)},n.getJSONClass=function(e){return e?E6[e]:null},n.prototype.getJSONType=function(){if(void 0===this._jsonType){var e=Object.getPrototypeOf(this).constructor;for(var n in E6)if(E6[n]===e){this._jsonType=n;break}}if(!this._jsonType)throw new Error("Found an unregistered Layer/Geometry class!");return this._jsonType},n}(e)}var R6={exports:{}},D6={exports:{}};!function(e,n){e.exports=function(){function e(e,i,s,a,h){n(e,i,s||0,a||e.length-1,h||o)}function n(e,o,s,a,h){for(;a>s;){if(a-s>600){var l=a-s+1,c=o-s+1,A=Math.log(l),f=.5*Math.exp(2*A/3),d=.5*Math.sqrt(A*f*(l-f)/l)*(c-l/2<0?-1:1);n(e,o,Math.max(s,Math.floor(o-c*f/l+d)),Math.min(a,Math.floor(o+(l-c)*f/l+d)),h)}var p=e[o],g=s,v=a;for(i(e,s,o),h(e[a],p)>0&&i(e,s,a);g<v;){for(i(e,g,v),g++,v--;h(e[g],p)<0;)g++;for(;h(e[v],p)>0;)v--}0===h(e[s],p)?i(e,s,v):i(e,++v,a),v<=o&&(s=v+1),o<=v&&(a=v-1)}}function i(e,n,i){var o=e[n];e[n]=e[i],e[i]=o}function o(e,n){return e<n?-1:e>n?1:0}return e}()}(D6);var k6=D6.exports;R6.exports=F6,R6.exports.default=F6;var L6=k6;function F6(e,n){if(!(this instanceof F6))return new F6(e,n);this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),n&&this._initFormat(n),this.clear()}function N6(e,n,i){if(!i)return n.indexOf(e);for(var o=0;o<n.length;o++)if(i(e,n[o]))return o;return-1}function z6(e,n){B6(e,0,e.children.length,n,e)}function B6(e,n,i,o,s){s||(s=X6(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(var a,h=n;h<i;h++)a=e.children[h],H6(s,e.leaf?o(a):a);return s}function H6(e,n){return e.minX=Math.min(e.minX,n.minX),e.minY=Math.min(e.minY,n.minY),e.maxX=Math.max(e.maxX,n.maxX),e.maxY=Math.max(e.maxY,n.maxY),e}function j6(e,n){return e.minX-n.minX}function U6(e,n){return e.minY-n.minY}function G6(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function V6(e){return e.maxX-e.minX+(e.maxY-e.minY)}function W6(e,n){return(Math.max(n.maxX,e.maxX)-Math.min(n.minX,e.minX))*(Math.max(n.maxY,e.maxY)-Math.min(n.minY,e.minY))}function q6(e,n){var i=Math.max(e.minX,n.minX),o=Math.max(e.minY,n.minY),s=Math.min(e.maxX,n.maxX),a=Math.min(e.maxY,n.maxY);return Math.max(0,s-i)*Math.max(0,a-o)}function Z6(e,n){return e.minX<=n.minX&&e.minY<=n.minY&&n.maxX<=e.maxX&&n.maxY<=e.maxY}function Q6(e,n){return n.minX<=e.maxX&&n.minY<=e.maxY&&n.maxX>=e.minX&&n.maxY>=e.minY}function X6(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Y6(e,n,i,o,s){for(var a,h=[n,i];h.length;)(i=h.pop())-(n=h.pop())<=o||(a=n+Math.ceil((i-n)/o/2)*o,L6(e,a,n,i,s),h.push(n,a,a,i))}F6.prototype={all:function(){return this._all(this.data,[])},search:function(e){var n=this.data,i=[],o=this.toBBox;if(!Q6(e,n))return i;for(var s,a,h,l,c=[];n;){for(s=0,a=n.children.length;s<a;s++)h=n.children[s],Q6(e,l=n.leaf?o(h):h)&&(n.leaf?i.push(h):Z6(e,l)?this._all(h,i):c.push(h));n=c.pop()}return i},collides:function(e){var n=this.data,i=this.toBBox;if(!Q6(e,n))return!1;for(var o,s,a,h,l=[];n;){for(o=0,s=n.children.length;o<s;o++)if(a=n.children[o],Q6(e,h=n.leaf?i(a):a)){if(n.leaf||Z6(e,h))return!0;l.push(a)}n=l.pop()}return!1},load:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var n=0,i=e.length;n<i;n++)this.insert(e[n]);return this}var o=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===o.height)this._splitRoot(this.data,o);else{if(this.data.height<o.height){var s=this.data;this.data=o,o=s}this._insert(o,this.data.height-o.height-1,!0)}else this.data=o;return this},insert:function(e){return e&&this._insert(e,this.data.height-1),this},clear:function(){return this.data=X6([]),this},remove:function(e,n){if(!e)return this;for(var i,o,s,a,h=this.data,l=this.toBBox(e),c=[],A=[];h||c.length;){if(h||(h=c.pop(),o=c[c.length-1],i=A.pop(),a=!0),h.leaf&&-1!==(s=N6(e,h.children,n)))return h.children.splice(s,1),c.push(h),this._condense(c),this;a||h.leaf||!Z6(h,l)?o?(i++,h=o.children[i],a=!1):h=null:(c.push(h),A.push(i),i=0,o=h,h=h.children[0])}return this},toBBox:function(e){return e},compareMinX:j6,compareMinY:U6,toJSON:function(){return this.data},fromJSON:function(e){return this.data=e,this},_all:function(e,n){for(var i=[];e;)e.leaf?n.push.apply(n,e.children):i.push.apply(i,e.children),e=i.pop();return n},_build:function(e,n,i,o){var s,a=i-n+1,h=this._maxEntries;if(a<=h)return z6(s=X6(e.slice(n,i+1)),this.toBBox),s;o||(o=Math.ceil(Math.log(a)/Math.log(h)),h=Math.ceil(a/Math.pow(h,o-1))),(s=X6([])).leaf=!1,s.height=o;var l,c,A,f,d=Math.ceil(a/h),p=d*Math.ceil(Math.sqrt(h));for(Y6(e,n,i,p,this.compareMinX),l=n;l<=i;l+=p)for(Y6(e,l,A=Math.min(l+p-1,i),d,this.compareMinY),c=l;c<=A;c+=d)f=Math.min(c+d-1,A),s.children.push(this._build(e,c,f,o-1));return z6(s,this.toBBox),s},_chooseSubtree:function(e,n,i,o){for(var s,a,h,l,c,A,f,d;o.push(n),!n.leaf&&o.length-1!==i;){for(f=d=1/0,s=0,a=n.children.length;s<a;s++)c=G6(h=n.children[s]),(A=W6(e,h)-c)<d?(d=A,f=c<f?c:f,l=h):A===d&&c<f&&(f=c,l=h);n=l||n.children[0]}return n},_insert:function(e,n,i){var o=i?e:(0,this.toBBox)(e),s=[],a=this._chooseSubtree(o,this.data,n,s);for(a.children.push(e),H6(a,o);n>=0&&s[n].children.length>this._maxEntries;)this._split(s,n),n--;this._adjustParentBBoxes(o,s,n)},_split:function(e,n){var i=e[n],o=i.children.length,s=this._minEntries;this._chooseSplitAxis(i,s,o);var a=this._chooseSplitIndex(i,s,o),h=X6(i.children.splice(a,i.children.length-a));h.height=i.height,h.leaf=i.leaf,z6(i,this.toBBox),z6(h,this.toBBox),n?e[n-1].children.push(h):this._splitRoot(i,h)},_splitRoot:function(e,n){this.data=X6([e,n]),this.data.height=e.height+1,this.data.leaf=!1,z6(this.data,this.toBBox)},_chooseSplitIndex:function(e,n,i){var o,s,a,h,l,c,A,f;for(c=A=1/0,o=n;o<=i-n;o++)h=q6(s=B6(e,0,o,this.toBBox),a=B6(e,o,i,this.toBBox)),l=G6(s)+G6(a),h<c?(c=h,f=o,A=l<A?l:A):h===c&&l<A&&(A=l,f=o);return f},_chooseSplitAxis:function(e,n,i){var o=e.leaf?this.compareMinX:j6,s=e.leaf?this.compareMinY:U6;this._allDistMargin(e,n,i,o)<this._allDistMargin(e,n,i,s)&&e.children.sort(o)},_allDistMargin:function(e,n,i,o){e.children.sort(o);var s,a,h=this.toBBox,l=B6(e,0,n,h),c=B6(e,i-n,i,h),A=V6(l)+V6(c);for(s=n;s<i-n;s++)a=e.children[s],H6(l,e.leaf?h(a):a),A+=V6(l);for(s=i-n-1;s>=n;s--)a=e.children[s],H6(c,e.leaf?h(a):a),A+=V6(c);return A},_adjustParentBBoxes:function(e,n,i){for(var o=i;o>=0;o--)H6(n[o],e)},_condense:function(e){for(var n,i=e.length-1;i>=0;i--)0===e[i].children.length?i>0?(n=e[i-1].children).splice(n.indexOf(e[i]),1):this.clear():z6(e[i],this.toBBox)},_initFormat:function(e){var n=["return a"," - b",";"];this.compareMinX=new Function("a","b",n.join(e[0])),this.compareMinY=new Function("a","b",n.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}};var J6=l8(R6.exports),K6={},$6=function(){function e(){this._tree=J6(9,["[0]","[1]","[2]","[3]"])}return e.prototype.collides=function(e){var n;return n=y5(e,4),K6.minX=n[0],K6.minY=n[1],K6.maxX=n[2],K6.maxY=n[3],this._tree.collides(K6)},e.prototype.insertBox=function(e){return this._tree.insert(e),this},e.prototype.bulkInsertBox=function(e){return this._tree.load(e),this},e.prototype.clear=function(){return this._tree.clear(),this},e}();function t9(e){return function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype.addHandler=function(e,n){if(!n)return this;if(this._handlers||(this._handlers=[]),this[e])return this[e].enable(),this;var i=this[e]=new n(this);return this._handlers.push(i),this.options[e]&&i.enable(),this},n.prototype.removeHandler=function(e){if(!e)return this;var n=this[e];if(n){var i=this._handlers.indexOf(n);i>=0&&this._handlers.splice(i,1),this[e].remove(),delete this[e]}return this},n.prototype._clearHandlers=function(){for(var e=0,n=this._handlers.length;e<n;e++)this._handlers[e].remove();this._handlers=[]},n}(e)}var e9="touchstart mousedown",n9={mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"},i9={mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},r9=function(e){function n(n,i){void 0===i&&(i={});var o=e.call(this,null)||this;return o.dom=n,o.options=i,o}return p5(n,e),n.prototype.addHooks=function(){},n.prototype.removeHooks=function(){},n.prototype.enable=function(){return this.dom?(this._onMouseDown=function(e){return this.onMouseDown(e)},X3(this.dom,e9,this._onMouseDown,this),this):this},n.prototype.disable=function(){return this.dom?(this._offEvents(),Y3(this.dom,e9,this._onMouseDown),delete this._onMouseDown,this):this},n.prototype.onMouseDown=function(e){if(this.options.rightclick||2!==e.button){var n=e;if(!(n.touches&&n.touches.length>1||this.options.cancelOn&&!0===this.options.cancelOn(e))){var i=this.dom;i.setCapture?i.setCapture():window.captureEvents&&window.captureEvents(),i.ondragstart=function(){return!1},delete this.moved;var o=n.touches?n.touches[0]:e;this.startPos=new w5(o.clientX,o.clientY),Y3(document,n9[e.type],this.onMouseMove),Y3(document,i9[e.type],this.onMouseUp),X3(document,n9[e.type],this.onMouseMove,this),X3(document,i9[e.type],this.onMouseUp,this),this.options.ignoreMouseleave||(Y3(this.dom,"mouseleave",this.onMouseUp),X3(this.dom,"mouseleave",this.onMouseUp,this)),this.fire("mousedown",{domEvent:e,mousePos:new w5(o.clientX,o.clientY)})}}},n.prototype.onMouseMove=function(e){var n=e;if(n.touches&&n.touches.length>1)this.moved&&(this.interupted=!0,this.onMouseUp(e));else{var i=n.touches?n.touches[0]:e,o=new w5(i.clientX,i.clientY).sub(this.startPos);(o.x||o.y)&&(this.moved?this.fire("dragging",{domEvent:e,mousePos:new w5(i.clientX,i.clientY)}):(this.fire("dragstart",{domEvent:e,mousePos:this.startPos.copy()}),this.moved=!0))}},n.prototype.onMouseUp=function(e){var n=e.changedTouches?e.changedTouches[0]:e;this._offEvents();var i={domEvent:e};T2(n.clientX)&&(i.mousePos=new w5(parseInt(n.clientX+"",0),parseInt(n.clientY+"",0))),this.moved&&(i.interupted=this.interupted,this.fire("dragend",i),delete this.interupted,delete this.moved),this.fire("mouseup",i)},n.prototype._offEvents=function(){var e=this.dom;if(Y3(e,"mouseleave",this.onMouseUp),"undefined"!=typeof document&&"undefined"!=typeof window){for(var n in n9)Y3(document,n9[n],this.onMouseMove),Y3(document,i9[n],this.onMouseUp);e.releaseCapture?e.releaseCapture():window.captureEvents&&window.captureEvents()}},n}(y6),o9=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.toNumberArrays=function(e){return Array.isArray(e)?R5(e,(function(e){return e.toArray()})):e.toArray()},n.toCoordinates=function(e){if(T2(e[0])&&T2(e[1]))return new n(e);if(e instanceof n)return e;for(var i=[],o=0,s=e.length;o<s;o++){var a=e[o];Array.isArray(a)?T2(a[0])?i.push(new n(a)):i.push(n.toCoordinates(a)):i.push(a instanceof n?a:new n(a))}return i},n.prototype.closeTo=function(e,n){return n||(n=0),this.x>=e.x-n&&this.x<=e.x+n&&this.y>=e.y-n&&this.y<=e.y+n},n.prototype.abs=function(){return new n(Math.abs(this.x),Math.abs(this.y))},n.prototype.round=function(){return new n(Math.round(this.x),Math.round(this.y))},n.prototype.ceil=function(){return new n(Math.ceil(this.x),Math.ceil(this.y))},n.prototype.floor=function(){return new n(Math.floor(this.x),Math.floor(this.y))},n.prototype.copy=function(){return new n(this.x,this.y,this.z)},n.prototype.toFixed=function(e){return new n(this.x.toFixed(e),this.y.toFixed(e),T2(this.z)?this.z.toFixed(e):void 0)},n.prototype.add=function(e,i){var o,s;return M2(e.x)?M2(e[0])?(o=this.x+e,s=this.y+i):(o=this.x+e[0],s=this.y+e[1]):(o=this.x+e.x,s=this.y+e.y),new n(o,s)},n.prototype.sub=function(e,i){var o,s;return M2(e.x)?M2(e[0])?(o=this.x-e,s=this.y-i):(o=this.x-e[0],s=this.y-e[1]):(o=this.x-e.x,s=this.y-e.y),new n(o,s)},n.prototype.multi=function(e){return new n(this.x*e,this.y*e)},n.prototype.equals=function(e){return e instanceof this.constructor&&(this.x===e.x&&this.y===e.y&&this.z===e.z)},n}(b5);!function(){function e(e,n){this.type=e,this.properties=n}e.createProj4=function(n){return new e("proj4",{proj:n})},e.fromProjectionCode=function(n){return n&&e[n=n.toUpperCase().replace(":","")]||null},e.WGS84=e.createProj4("+proj=longlat +datum=WGS84 +no_defs"),e.EPSG3857=e.createProj4("+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs"),e.IDENTITY=e.createProj4("+proj=identity +no_defs"),e.CGCS2000=e.createProj4("+proj=longlat +datum=CGCS2000"),e.EPSG4490=e.CGCS2000,e.BD09LL=e.createProj4("+proj=longlat +datum=BD09"),e.GCJ02=e.createProj4("+proj=longlat +datum=GCJ02")}();var s9,a9=new w5(0,0),h9=new o9(0,0),l9=new o9(0,0),u9=new o9(0,0),c9=new o9(0,0),A9=new o9(0,0),f9=new o9(0,0),d9=new o9(0,0),p9=new o9(0,0),g9=[],m9=[],y9=function(){function e(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._clazz=o9;var i=e.length,o=i>0?e[i-1]:null;o&&o.unproject&&(this.projection=e[i-1]),this._dirty=!0,this.antiMeridian=!1,this._initialize(e[0],e[1],e[2],e[3])}return e.prototype._initialize=function(e,n,i,o){if(this.xmin=null,this.xmax=null,this.ymin=null,this.ymax=null,!M2(e)){var s=this.projection;if(T2(e)&&T2(n)&&T2(i)&&T2(o))s?this.set(e,n,i,o):this.set(Math.min(e,i),Math.min(n,o),Math.max(e,i),Math.max(n,o));else if(Array.isArray(e))s?this.set(e[0],e[1],e[2],e[3]):this.set(Math.min(e[0],e[2]),Math.min(e[1],e[3]),Math.max(e[0],e[2]),Math.max(e[1],e[3]));else if(T2(e.x)&&T2(n.x)&&T2(e.y)&&T2(n.y)){var a=e,h=n;s?this.set(a.x,a.y,h.x,h.y):(a.x>h.x?(this.xmin=h.x,this.xmax=a.x):(this.xmin=a.x,this.xmax=h.x),a.y>h.y?(this.ymin=h.y,this.ymax=a.y):(this.ymin=a.y,this.ymax=h.y))}else T2(e.xmin)&&T2(e.xmax)&&T2(e.ymin)&&T2(e.ymax)&&this.set(e.xmin,e.ymin,e.xmax,e.ymax)}},e.prototype._add=function(e){return this._dirty=!0,M2(e.x)?M2(e.xmin)?M2(e[0])||(this.xmin+=e[0],this.ymin+=e[1],this.xmax+=e[0],this.ymax+=e[1]):(this.xmin+=e.xmin,this.ymin+=e.ymin,this.xmax+=e.xmax,this.ymax+=e.ymax):(this.xmin+=e.x,this.ymin+=e.y,this.xmax+=e.x,this.ymax+=e.y),this},e.prototype.add=function(e){return new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection)._add(e)},e.prototype._scale=function(e){return this._dirty=!0,this.xmin*=e,this.ymin*=e,this.xmax*=e,this.ymax*=e,this},e.prototype._sub=function(e){return this._dirty=!0,M2(e.x)?M2(e.xmin)?M2(e[0])||(this.xmin-=e[0],this.ymin-=e[1],this.xmax-=e[0],this.ymax-=e[1]):(this.xmin-=e.xmin,this.ymin-=e.ymin,this.xmax-=e.xmax,this.ymax-=e.ymax):(this.xmin-=e.x,this.ymin-=e.y,this.xmax-=e.x,this.ymax-=e.y),this},e.prototype._substract=function(e){return this._sub(e)},e.prototype.sub=function(e){return new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection)._sub(e)},e.prototype.substract=function(e){return this.sub(e)},e.prototype.round=function(){return new this.constructor(Math.round(this.xmin),Math.round(this.ymin),Math.round(this.xmax),Math.round(this.ymax),this.projection)},e.prototype._round=function(){return this._dirty=!0,this.xmin=Math.round(this.xmin),this.ymin=Math.round(this.ymin),this.xmax=Math.round(this.xmax),this.ymax=Math.round(this.ymax),this},e.prototype.getMin=function(e){return e?(e.set(this.xmin,this.ymin),e):new this._clazz(this.xmin,this.ymin)},e.prototype.getMax=function(e){return e?(e.set(this.xmax,this.ymax),e):new this._clazz(this.xmax,this.ymax)},e.prototype.getCenter=function(e){var n=(this.xmin+this.xmax)/2,i=(this.ymin+this.ymax)/2;return e?(e.set(n,i),e):new this._clazz(n,i)},e.prototype.isValid=function(){return!(M2(this.xmin)||M2(this.ymin)||M2(this.xmax)||M2(this.ymax))},e.prototype.equals=function(e){return this.xmin===e.xmin&&this.xmax===e.xmax&&this.ymin===e.ymin&&this.ymax===e.ymax},e.prototype.intersects=function(e){this._project(this),this._project(e);var n=Math.max(this.pxmin,e.pxmin),i=Math.max(this.pymin,e.pymin),o=Math.min(this.pxmax,e.pxmax),s=Math.min(this.pymax,e.pymax);return!(n>o||i>s)},e.prototype.within=function(e){return this._project(this),this._project(e),this.pxmin>=e.pxmin&&this.pxmax<=e.pxmax&&this.pymin>=e.pymin&&this.pymax<=e.pymax},e.prototype.contains=function(e){if(!e)return!1;this._project(this);var n=this.projection;if(n){var i=h9;Array.isArray(e)?(i.x=e[0],i.y=e[1],e=n.project(i,i)):void 0!==e.x?(i.x=e.x,i.y=e.y,e=n.project(i,i)):void 0!==e.xmin&&this._project(e)}return(e.x||e.pxmin||0)>=this.pxmin&&(e.x||e.pxmax||0)<=this.pxmax&&(e.y||e.pymin||0)>=this.pymin&&(e.y||e.pymax||0)<=this.pymax},e.prototype.getWidth=function(){return Math.abs(this.xmax-this.xmin)},e.prototype.getHeight=function(){return Math.abs(this.ymax-this.ymin)},e.prototype.getSize=function(){return new h3(this.getWidth(),this.getHeight())},e.prototype.set=function(e,n,i,o){return this.xmin=e,this.ymin=n,this.xmax=i,this.ymax=o,this._dirty=!0,this},e.prototype.__combine=function(e){var n,i,o,s;void 0!==e.x&&(s9.xmin=s9.xmax=e.x,s9.ymin=s9.ymax=e.y,e=s9),this._project(e),this._project(this),T2(this.pxmin)?(n=Math.min(this.pxmin,e.pxmin),i=Math.min(this.pymin,e.pymin),o=Math.max(this.pxmax,e.pxmax),s=Math.max(this.pymax,e.pymax)):(n=e.pxmin,i=e.pymin,o=e.pxmax,s=e.pymax);var a=this.projection;if(a){l9.set(n,i),u9.set(o,s);var h=a.unproject(l9,l9),l=a.unproject(u9,u9);n=h.x,i=h.y,o=l.x,s=l.y}return m9[0]=n,m9[1]=i,m9[2]=o,m9[3]=s,m9},e.prototype._combine=function(e){if(!e||e.isValid&&!e.isValid())return this;var n=this.__combine(e);return this.set(n[0],n[1],n[2],n[3]),this._dirty=!0,this},e.prototype.combine=function(e){if(!e||e.isValid&&!e.isValid())return this;var n=this.__combine(e);return new this.constructor(n[0],n[1],n[2],n[3],this.projection)},e.prototype.intersection=function(e){if(!this.intersects(e))return null;c9.x=Math.max(this.pxmin,e.pxmin),c9.y=Math.max(this.pymin,e.pymin),A9.x=Math.min(this.pxmax,e.pxmax),A9.y=Math.min(this.pymax,e.pymax);var n=c9,i=A9,o=this.projection;return o&&(n=o.unproject(n,n),i=o.unproject(i,i)),new this.constructor(n,i,o)},e.prototype.expand=function(e){var n,i;return T2(e)?n=i=e:(n=e.width||e.x||e[0]||0,i=e.height||e.y||e[1]||0),new this.constructor(this.xmin-n,this.ymin-i,this.xmax+n,this.ymax+i,this.projection)},e.prototype._expand=function(e){var n,i;return T2(e)?n=i=e:(n=e.width||e.x||e[0]||0,i=e.height||e.y||e[1]||0),this.xmin-=n,this.ymin-=i,this.xmax+=n,this.ymax+=i,this._dirty=!0,this},e.prototype.toJSON=function(){return{xmin:this.xmin,ymin:this.ymin,xmax:this.xmax,ymax:this.ymax}},e.prototype.toArray=function(e){var n=this.xmin,i=this.ymin,o=this.xmax,s=this.ymax;return e?(e[0].x=n,e[0].y=s,e[1].x=o,e[1].y=s,e[2].x=o,e[2].y=i,e[3].x=n,e[3].y=i,e[4].x=n,e[4].y=s,e):[new this._clazz([n,s]),new this._clazz([o,s]),new this._clazz([o,i]),new this._clazz([n,i]),new this._clazz([n,s])]},e.prototype.toString=function(){return"".concat(this.xmin,",").concat(this.ymin,",").concat(this.xmax,",").concat(this.ymax)},e.prototype.copy=function(){return new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection)},e.prototype.convertTo=function(e,n){if(!this.isValid())return null;var i,o=n||new this.constructor;return n&&o.set(null,null,null,null),this._clazz===o9?i=f9:this._clazz===w5&&(i=a9),i.x=this.xmin,i.y=this.ymax,o._combine(e(i)),i.x=this.xmax,o._combine(e(i)),i.y=this.ymin,o._combine(e(i)),i.x=this.xmin,o._combine(e(i)),o},e.prototype._project=function(e){if(e&&e.isValid()){var n=this.projection;if(n){if(e._dirty){d9.set(e.xmin,e.ymin),p9.set(e.xmax,e.ymax),g9[0]=d9,g9[1]=p9;var i=n.projectCoords(g9,this.antiMeridian),o=i[0],s=i[1];e.pxmin=Math.min(o.x,s.x),e.pymin=Math.min(o.y,s.y),e.pxmax=Math.max(o.x,s.x),e.pymax=Math.max(o.y,s.y)}delete e._dirty}else e.pxmin=e.xmin,e.pxmax=e.xmax,e.pymin=e.ymin,e.pymax=e.ymax}else e&&(e.pxmin=e.pxmax=e.pymin=e.pymax=null)},e}();s9=new y9(0,0,0,0);var v9=function(e){function n(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var o=e.apply(this,v5([],y5(n),!1))||this;return o._clazz=w5,o}return p5(n,e),n}(y9),_9=function(){function e(e){this.matrix=e}return e.prototype.transform=function(e,n,i){var o=this.matrix[0]*(e.x-this.matrix[2])/n,s=-this.matrix[1]*(e.y-this.matrix[3])/n;return i?(i.x=o,i.y=s,i):new w5(o,s)},e.prototype.untransform=function(e,n,i){var o=e.x*n/this.matrix[0]+this.matrix[2],s=e.y*n/-this.matrix[1]+this.matrix[3];return i?(i.x=o,i.y=s,i):new o9(o,s)},e}(),x9={code:"",is:function(e){if(this.code===e)return!0;if(!this.aliases)return!1;for(var n=0;n<this.aliases.length;n++)if(this.aliases[n]===e)return!0;return!1},project:function(e){return e},unproject:function(e){return e},projectCoords:function(e,n){var i=this;if(!e)return[];if(!Array.isArray(e))return this.project(e);if(0===e.length)return[];if(!this.isSphere())return R5(e,this.project,this);if(Array.isArray(e[0]))return e.map((function(e){return i.projectCoords(e,n)}));for(var o=n,s=this.getCircum(),a=this.getSphereExtent().sy,h=void 0,l=e[0],c=void 0,A=void 0,f=void 0,d=void 0,p=[this.project(l)],g=1,v=e.length;g<v;g++){A=(c=e[g]).x-l.x,f=c.y-l.y,d=this.project(c);var w=!1;Math.abs(A)>180&&o&&(c.x=A<0?360-Math.abs(c.x):-180-(180-Math.abs(c.x)),w=!0),Math.abs(f)>90&&o&&(void 0===h&&(h=c.y<l.y),h&&(d._add(0,-s.y*k5(f)*a),c._add(0,-180*k5(f)))),w&&(d=this.project(c)),l=c,p.push(d)}return p},unprojectCoords:function(e){return e?Array.isArray(e)?R5(e,this.unproject,this):this.unproject(e):[]},isSphere:function(){return!!this.sphere},isOutSphere:function(e){return!!this.isSphere()&&!this.getSphereExtent().contains(e)},wrapCoord:function(e){if(!this.isSphere())return e;var n=this.getSphereExtent(),i=new o9(e);return n.contains(i)||(i.x=F5(e.x,n.xmin,n.xmax),i.y=F5(e.y,n.ymin,n.ymax)),i},getCircum:function(){if(!this.circum&&this.isSphere()){var e=this.getSphereExtent();this.circum={x:e.getWidth(),y:e.getHeight()}}return this.circum},getSphereExtent:function(){if(!this.extent&&this.isSphere()){var e=this.project(new o9(180,90)),n=this.project(new o9(-180,-90));this.extent=new y9(n,e,this),this.extent.sx=e.x>n.x?1:-1,this.extent.sy=e.y>n.y?1:-1}return this.extent}},b9={measureLength:function(e,n){if(!Array.isArray(e))return this.measureLenBetween(e,n);for(var i=0,o=0,s=e.length;o<s-1;o++)i+=this.measureLenBetween(e[o],e[o+1]);return i}},w9={measure:"IDENTITY",measureLenBetween:function(e,n){if(!e||!n)return 0;try{return Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2))}catch(e){return 0}},measureArea:function(e){if(!Array.isArray(e))return 0;for(var n=0,i=0,o=e.length;i<o;i++){var s=e[i],a=null;n+=s.x*(a=i===o-1?e[0]:e[i+1]).y-s.y*a.x}return Math.abs(n/2)},locate:function(e,n,i,o){return(o=o||new o9(0,0)).set(e.x,e.y),this._locate(o,n,i)},_locate:function(e,n,i){return e?(n||(n=0),i||(i=0),n||i?(e.x=e.x+n,e.y=e.y+i,e):e):null},rotate:function(e,n,i){return e=new o9(e.x,e.y),this._rotate(e,n,i)},_rotate:function(){var e=new w5(0,0);return function(n,i,o){return e.x=n.x-i.x,e.y=n.y-i.y,e._rotate(o*Math.PI/180),n.x=i.x+e.x,n.y=i.y+e.y,n}}()},C9=P2(w9,b9),P9=function(){function e(e){this.radius=e}return e.prototype.measureLenBetween=function(e,n){if(!e||!n)return 0;var i=L2(e.y),o=L2(n.y),s=i-o,a=L2(e.x)-L2(n.x);return i=2*Math.asin(Math.sqrt(Math.pow(Math.sin(s/2),2)+Math.cos(i)*Math.cos(o)*Math.pow(Math.sin(a/2),2))),i*=this.radius},e.prototype.measureArea=function(e){var n,i=L2(this.radius),o=0,s=e,a=s.length;if(a<3)return 0;for(n=0;n<a-1;n++){var h=s[n],l=s[n+1];o+=h.x*i*Math.cos(L2(h.y))*l.y*i-l.x*i*Math.cos(L2(l.y))*h.y*i}var c=s[n],A=s[0];return o+=c.x*i*Math.cos(L2(c.y))*A.y*i-A.x*i*Math.cos(L2(A.y))*c.y*i,.5*Math.abs(o)},e.prototype.locate=function(e,n,i,o){return(o=o||new o9(0,0)).set(e.x,e.y),this._locate(o,n,i)},e.prototype._locate=function(e,n,i){if(!e)return null;if(n||(n=0),i||(i=0),!n&&!i)return e;var o,s,a=L2(e.y);if(0!==i){var h=Math.abs(i);s=F5(180*(a+=2*Math.sin(h/(2*this.radius))*(i>0?1:-1))/Math.PI,-90,90)}else s=e.y;if(0!==n){var l=Math.abs(n),c=L2(e.x);o=F5(180*(c+=2*Math.sqrt(Math.pow(Math.sin(l/(2*this.radius)),2)/Math.pow(Math.cos(a),2))*(n>0?1:-1))/Math.PI,-180,180)}else o=e.x;return e.x=o,e.y=s,e},e.prototype.rotate=function(e,n,i){var o=new o9(e);return this._rotate(o,n,i)},e.prototype._rotate=function(e,n,i){var o=function(e,n,i){void 0===i&&(i={});var o;o=i.final?M9(n,e):M9(e,n);return o>180?-(360-o):o}(n,e),s=o-i,a=this.measureLenBetween(n,e);return e.x=n.x,e.y=n.y,function(e,n,i,o){var s=n/o,a=e.x*Math.PI/180,h=L2(e.y),l=L2(i),c=s*Math.cos(l),A=h+c;Math.abs(A)>Math.PI/2&&(A=A>0?Math.PI-A:-Math.PI-A);var f=Math.log(Math.tan(A/2+Math.PI/4)/Math.tan(h/2+Math.PI/4)),d=Math.abs(f)>1e-11?c/f:Math.cos(h),p=s*Math.sin(l)/d;return e.x=(180*(a+p)/Math.PI+540)%360-180,e.y=180*A/Math.PI,e}(e,a,s,this.radius)},e}();function M9(e,n){var i=L2(e.y),o=L2(n.y),s=L2(n.x-e.x);s>Math.PI&&(s-=2*Math.PI),s<-Math.PI&&(s+=2*Math.PI);var a=Math.log(Math.tan(o/2+Math.PI/4)/Math.tan(i/2+Math.PI/4));return(F2(Math.atan2(s,a))+360)%360}var T9={measure:"EPSG:4326",sphere:new P9(6378137),measureLenBetween:function(e,n){return this.sphere.measureLenBetween(e,n)},measureArea:function(e){return this.sphere.measureArea.call(this.sphere,e)},_locate:function(e,n,i){return this.sphere._locate.call(this.sphere,e,n,i)},locate:function(e,n,i,o){return this.sphere.locate.call(this.sphere,e,n,i,o)},_rotate:function(e,n,i){return this.sphere._rotate.call(this.sphere,e,n,i)},rotate:function(e,n,i){return this.sphere.rotate.call(this.sphere,e,n,i)}},S9=P2(T9,b9),I9={measure:"BAIDU",sphere:new P9(6370996.81),measureLenBetween:function(e,n){return this.sphere.measureLenBetween.call(this.sphere,e,n)},measureArea:function(e){return this.sphere.measureArea.call(this.sphere,e)},_locate:function(e,n,i){return this.sphere._locate.call(this.sphere,e,n,i)},locate:function(e,n,i,o){return this.sphere.locate.call(this.sphere,e,n,i,o)},_rotate:function(e,n,i){return this.sphere._rotate.call(this.sphere,e,n,i)},rotate:function(e,n,i){return this.sphere.rotate.call(this.sphere,e,n,i)}},E9=P2(I9,b9),O9=S9,R9={};function D9(e){R9[e.measure]=e}D9(C9),D9(S9),D9(E9);var k9=function(e){if(!e)return O9;for(var n in R9)if(D2(R9,n)){var i=R9[n].measure;if(!i)continue;if(e.toLowerCase()===i.toLowerCase())return R9[n]}return null},L9={code:"EPSG:3857",rad:Math.PI/180,metersPerDegree:6378137*Math.PI/180,maxLatitude:85.0511287798,project:function(e,n){var i=this.rad,o=this.metersPerDegree,s=this.maxLatitude,a=e.x,h=Math.max(Math.min(s,e.y),-s),l=a*o,c=(0===h?0:Math.log(Math.tan((90+h)*i/2))/i)*o;return n?(n.x=l,n.y=c,n):new o9(l,c)},unproject:function(e,n){var i,o=this.rad,s=this.metersPerDegree,a=e.x/s,h=e.y;0===h?i=0:(i=h/s,i=(2*Math.atan(Math.exp(i*o))-Math.PI/2)/o),Math.abs(Math.abs(a)-180)<1e-7&&(a=180*k5(a)),Math.abs(Math.abs(i)-this.maxLatitude)<1e-7&&(i=k5(i)*this.maxLatitude);var l=a,c=i;return n?(n.x=l,n.y=c,n):new o9(l,c)}},F9=P2({},x9,L9,S9),N9={code:"EPSG:4326",aliases:["EPSG:4490"],project:function(e,n){return n?(n.x=e.x,n.y=e.y,n):new o9(e)},unproject:function(e,n){return n?(n.x=e.x,n.y=e.y,n):new o9(e)}},z9=P2({},x9,N9,S9),B9=Math.abs,H9=Math.sin,j9=Math.cos,U9=Math.tan,G9=Math.atan,V9=Math.atan2,W9=Math.sqrt,q9=Math.log,Z9=Math.hypot,Q9=Math.sinh,X9=Math.cosh,Y9=1/0;function J9(e){var n,i,o,s,a,h,l=[],c=[],A=[],f=[];function d(e,n){for(var i,o=2*j9(2*n),s=e.length-1,a=e[s],h=0;--s>=0;)i=o*a-h+e[s],h=a,a=i;return n+i*H9(2*n)}function p(e,n,i){for(var o,s,a=H9(n),h=j9(n),l=Q9(i),c=X9(i),A=2*h*c,f=-2*a*l,d=e.length-1,p=e[d],g=0,v=0,w=0;--d>=0;)o=v,s=g,p=A*(v=p)-o-f*(g=w)+e[d],w=f*v-s+A*g;return[(A=a*c)*p-(f=h*l)*w,A*w+f*p]}a=s=(o=e.es/(1+W9(1-e.es)))/(2-o),l[0]=s*(2+s*(-2/3+s*(s*(116/45+s*(26/45+s*(-2854/675)))-2))),c[0]=s*(s*(2/3+s*(4/3+s*(-82/45+s*(32/45+s*(4642/4725)))))-2),l[1]=(a*=s)*(7/3+s*(s*(-227/45+s*(2704/315+s*(2323/945)))-1.6)),c[1]=a*(5/3+s*(-16/15+s*(-13/9+s*(904/315+s*(-1522/945))))),l[2]=(a*=s)*(56/15+s*(-136/35+s*(-1262/105+s*(73814/2835)))),c[2]=a*(-26/15+s*(34/21+s*(1.6+s*(-12686/2835)))),l[3]=(a*=s)*(4279/630+s*(-332/35+s*(-399572/14175))),c[3]=a*(1237/630+s*(s*(-24832/14175)-2.4)),l[4]=(a*=s)*(4174/315+s*(-144838/6237)),c[4]=a*(-734/315+s*(109598/31185)),l[5]=(a*=s)*(601676/22275),c[5]=a*(444337/155925),n=e.k0/(1+s)*(1+(a=s*s)*(1/4+a*(1/64+a/256))),A[0]=s*(s*(2/3+s*(-37/96+s*(1/360+s*(81/512+s*(-96199/604800)))))-.5),f[0]=s*(.5+s*(-2/3+s*(5/16+s*(41/180+s*(-127/288+s*(7891/37800)))))),A[1]=a*(-1/48+s*(-1/15+s*(437/1440+s*(-46/105+s*(1118711/3870720))))),f[1]=a*(13/48+s*(s*(557/1440+s*(281/630+s*(-1983433/1935360)))-.6)),A[2]=(a*=s)*(-17/480+s*(37/840+s*(209/4480+s*(-5569/90720)))),f[2]=a*(61/240+s*(-103/140+s*(15061/26880+s*(167603/181440)))),A[3]=(a*=s)*(-4397/161280+s*(11/504+s*(830251/7257600))),f[3]=a*(49561/161280+s*(-179/168+s*(6601661/7257600))),A[4]=(a*=s)*(-4583/161280+s*(108847/3991680)),f[4]=a*(34729/80640+s*(-3418889/1995840)),A[5]=(a*=s)*(-20648693/638668800),f[5]=.6650675310896665*a,h=d(c,e.phi0),i=-n*(h+function(e,n){var i,o=2*j9(n),s=e.length-1,a=e[s],h=0;for(;--s>=0;)i=o*a-h+e[s],h=a,a=i;return H9(n)*i}(f,2*h)),e.fwd=function(e,o){var s,a,h,l,A,g=e.phi,v=e.lam;g=d(c,g),s=H9(g),a=j9(g),l=H9(v),h=j9(v),g=V9(s,h*a),v=V9(l*a,Z9(s,a*h)),v=function(e){var n=B9(e);return n=function(e){var n=1+e,i=n-1;return 0===i?e:e*q9(n)/i}(n*(1+n/(Z9(1,n)+1))),e<0?-n:n}(U9(v)),A=p(f,2*g,2*v),g+=A[0],v+=A[1],B9(v)<=2.623395162778?(o.y=n*g+i,o.x=n*v):o.x=o.y=Y9},e.inv=function(e,o){var s,a,h,c,f,g=e.y,v=e.x;g=(g-i)/n,v/=n,B9(v)<=2.623395162778?(g+=(f=p(A,2*g,2*v))[0],v=G9(Q9(v+=f[1])),s=H9(g),a=j9(g),c=H9(v),h=j9(v),v=V9(c,h*a),g=V9(s*h,Z9(c,h*a)),o.phi=d(l,g),o.lam=v):o.phi=o.lam=Y9}}var K9=57.29577951308232,$9=.017453292519943295,t7=["Traverse_Mercator"],e7={code:"EPSG:9807",aliases:t7,centralMeridian:0,create:function(e){var n={a:6378137,es:.0066943799901413165,x0:M2(e.falseEasting)?5e5:e.falseEasting,y0:M2(e.falseNorthing)?0:e.falseNorthing,k0:e.scaleFactor||.9996,lam0:(e.centralMeridian||0)*$9,phi0:(e.latitudeOfOrigin||0)*$9,originLam0:e.startLongtitude||0,originPhi0:e.startLatitude||0};J9(n);var i={lam:0,phi:0},o={},s=0,a=0;(n.originLam0||n.originPhi0)&&(i.lam=n.originLam0*$9-n.lam0,i.phi=n.originPhi0*$9,n.fwd(i,o),s=n.a*o.x+n.x0,a=n.a*o.y+n.y0);var h={code:"EPSG:9807",aliases:t7,centralMeridian:e.centralMeridian,project:function(e,h){i.lam=e.x*$9-n.lam0,i.phi=e.y*$9,n.fwd(i,o);var l=n.a*o.x+n.x0-s,c=n.a*o.y+n.y0-a;return h?(h.x=l,h.y=c,h):new o9(l,c)},unproject:function(e,h){o.x=(e.x-n.x0+s)/n.a,o.y=(e.y-n.y0+a)/n.a,n.inv(o,i);var l=(i.lam+n.lam0)*K9,c=i.phi*K9;return h?(h.x=l,h.y=c,h):new o9(l,c)}};return P2({},x9,h,S9)}},n7=P2({},x9,e7),i7={code:"utm",aliases:[],create:function(e){var n={},i=parseInt(e.zone);if(n.falseNorthing=e.south?1e7:0,n.falseEasting=5e5,!(i>0&&i<=60))throw new Error("zone must be > 0 and <= 60.");return i--,n.centralMeridian=6*(i+.5)-180,n.scaleFactor=.9996,n7.create(n)}},r7=P2({},n7,i7),o7={EARTHRADIUS:6370996.81,MCBAND:[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],LLBAND:[75,60,45,30,15,0],MC2LL:[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],LL2MC:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],convertMC2LL:function(e,n){for(var i,o=0,s=this.MCBAND.length;o<s;o++)if(Math.abs(e.y)>=this.MCBAND[o]){i=this.MC2LL[o];break}return this.convertor(e,i,n)},convertLL2MC:function(e,n){var i,o,s;e.x=this.getLoop(e.x,-180,180),e.y=this.getRange(e.y,-74,74);var a=new o9(e.x,e.y);for(o=0,s=this.LLBAND.length;o<s;o++)if(a.y>=this.LLBAND[o]){i=this.LL2MC[o];break}if(!i)for(o=this.LLBAND.length-1;o>=0;o--)if(a.y<=-this.LLBAND[o]){i=this.LL2MC[o];break}return this.convertor(e,i,n)},convertor:function(e,n,i){if(!e||!n)return null;var o=n[0]+n[1]*Math.abs(e.x),s=Math.abs(e.y)/n[9],a=n[2]+n[3]*s+n[4]*s*s+n[5]*s*s*s+n[6]*s*s*s*s+n[7]*s*s*s*s*s+n[8]*s*s*s*s*s*s;return o*=e.x<0?-1:1,a*=e.y<0?-1:1,i?(i.x=o,i.y=a,i):new o9(o,a)},toRadians:function(e){return Math.PI*e/180},toDegrees:function(e){return 180*e/Math.PI},getRange:function(e,n,i){return null!=n&&(e=Math.max(e,n)),null!=i&&(e=Math.min(e,i)),e},getLoop:function(e,n,i){if(e===1/0)return i;if(e===-1/0)return n;for(;e>i;)e-=i-n;for(;e<n;)e+=i-n;return e}},s7=P2({},x9,{code:"BAIDU",project:function(e,n){return this.convertLL2MC(e,n)},unproject:function(e,n){return this.convertMC2LL(e,n)}},E9,o7),a7=P2({},x9,{code:"IDENTITY",project:function(e,n){return n?(n.x=e.x,n.y=e.y,n):e.copy()},unproject:function(e,n){return n?(n.x=e.x,n.y=e.y,n):e.copy()}},C9),h7=F9,l7=Object.freeze({__proto__:null,BAIDU:s7,Common:x9,DEFAULT:h7,EPSG3857:F9,EPSG4326:z9,EPSG9807:n7,IDENTITY:a7,UTM:r7});function u7(e){return function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.registerRenderer=function(e,n){var i=this.prototype,o=Object.getPrototypeOf(i);return i._rendererClasses&&i._rendererClasses!==o._rendererClasses||(i._rendererClasses=i._rendererClasses?Object.create(i._rendererClasses):{}),i._rendererClasses[e.toLowerCase()]=n,this},n.getRendererClass=function(e){var n=this.prototype;return n._rendererClasses?n._rendererClasses[e.toLowerCase()]:null},n}(e)}var c7="check_browser_max_fps";k8(c7,(function(){return"function (exports) {\n    exports.initialize = function () {};\n    function now(){\n        return  new Date().getTime();\n    }\n    function checkFPS(cb) {\n        if (!requestAnimationFrame) {\n            cb(-1);\n            return;\n        }\n        const count = 100;\n        let idx = 0;\n        let id;\n        let startTime;\n        function loop() {\n            idx++;\n            if (idx === count) {\n                cancelAnimationFrame(id);\n                const endTime = now();\n                const timePerFPS = (endTime - startTime) / count;\n                const fps = Math.floor(1000 / timePerFPS);\n                cb(fps);\n            } else {\n                id = requestAnimationFrame(loop);\n            }\n        }\n        startTime = now();\n        id = requestAnimationFrame(loop);\n    }\n    //recive message\n    exports.onmessage = function (msg, postResponse) {\n        checkFPS((fps) => {\n            if (fps < -1) {\n                postResponse('check fps fail');\n            } else {\n                postResponse(null, { fps });\n            }\n        })\n    }\n}"}));var A7,f7=0,d7=[],p7=function(){function e(e){var n=this;$8(),this._delayMessages=[],this.initializing=!1;var i=O8(e);I8&&!i&&(this.initializing=!0,console.log("Injecting codes in worker with worker key: :".concat(e)),B8(e,(function(){n.initializing=!1,n.created()}))),this.workerKey=e,this.workerPool=W8(),this.currentActor=0,this.actorId=T5(),this.workers=this.workerPool.acquire(this.actorId),this.callbacks={},this.callbackID=0,this.receiveFn=this.receive.bind(this),this.workers.forEach((function(e){e.addEventListener("message",n.receiveFn,!1)})),R8(e)}return e.prototype.created=function(){var e=this;this._delayMessages.forEach((function(n){e[n.command](n.data,n.buffers,n.cb,n.workerId)})),this._delayMessages=[]},e.prototype.isActive=function(){return!!this.workers},e.prototype.broadcast=function(e,n,i){var o=this;return this.initializing?(this._delayMessages.push({command:"broadcast",data:e,buffers:n,cb:i}),this):(function(e,n,i){e.length||i(null,[]);var o=e.length,s=new Array(e.length),a=null;e.forEach((function(e,h){n(e,(function(e,n){e&&(a=e),s[h]=n,0==--o&&i(a,s)}))}))}(this.workers,(function(i,s){o.send(e,n,s,i.id)}),i=i||function(){}),this)},e.prototype.send=function(e,n,i,o){if(this.initializing)return this._delayMessages.push({command:"send",data:e,buffers:n,cb:i,workerId:o}),this;var s=i?"".concat(this.actorId,":").concat(this.callbackID++):null;return i&&(this.callbacks[s]=i),this.post({data:e,callback:String(s)},n,o),this},e.prototype.receive=function(e){var n=this,i=e.data,o=i.callback,s=this.callbacks[o];delete this.callbacks[o],"<request>"===i.type?this.actorId===i.actorId&&this[i.command](i.params,(function(e,o,s){var a={type:"<response>",callback:i.callback};e?a.error=e.message:a.data=o,n.post(a,s||d7,i.workerId)})):s&&i.error?s(i.error):s&&s(null,i.data)},e.prototype.remove=function(){var e=this;this.workers.forEach((function(n){n.removeEventListener("message",e.receiveFn,!1)})),delete this.receiveFn,delete this.workers,delete this.callbacks,delete this.workerPool},e.prototype.post=function(e,n,i){return("number"!=typeof i||isNaN(i))&&(i=this.currentActor=(this.currentActor+1)%this.workerPool.workerCount),e.workerId=i,e.workerKey=this.workerKey,e.actorId=this.actorId,this.workerPool.addMessage(i,e,n||d7),i},e.prototype.getDedicatedWorker=function(){return f7=(f7+1)%this.workerPool.workerCount},e}();var g7=function(e){function n(){return e.call(this,c7)||this}return p5(n,e),n}(p7);var m7,y7=!1;Z8.indexOf(m7=function(){var e;y7||w2.maxFPS<=0&&(y7=!0,e=function(e){T2(e)&&e>0&&w2.maxFPS<=0&&(w2.maxFPS=e),y7=!1},A7||(A7=new g7),A7.send({},[],(function(n,i){n?(console.error(n),e()):e(i.fps)})))})>-1||O2(m7)&&Z8.push(m7);var v7=[],_7=function(e){function n(){return e.call(this,S8)||this}return p5(n,e),n.prototype.fetchImage=function(e,n){this.send({url:e},v7,n)},n}(p7),x7=function(e){function n(n){var i=e.call(this)||this;return i.layer=n,i._painted=!1,i._drawTime=0,!f5.decodeImageInWorker||f5.safari||f5.iosWeixin||(i._resWorkerConn=new _7),i.setToRedraw(),i}return p5(n,e),n.prototype.render=function(e){this.prepareRender(),this.getMap()&&this.layer.isVisible()&&(this.resources||(this.resources=new b7),this.checkAndDraw(this._tryToDraw,e),this._frameTime=e)},n.prototype.getFrameTimestamp=function(){return this._frameTime||0},n.prototype.checkAndDraw=function(e){for(var n=this,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];if(this._toRedraw=!1,this.checkResources){var s=this.checkResources();s.length>0?(this._loadingResource=!0,this.loadResources(s).then((function(){if(n._loadingResource=!1,n.layer){n.layer.fire("resourceload");var e=n.layer.getMap();n.setToRedraw(),e.getRenderer().callInNextFrame((function(){n.setToRedraw()}))}}))):e.call.apply(e,v5([this],y5(i),!1))}else e.call.apply(e,v5([this],y5(i),!1))},n.prototype.testIfNeedRedraw=function(){var e=this.getMap();return!this._loadingResource&&(!!this._toRedraw||!(e.isInteracting()&&!this.drawOnInteracting)&&!!this.needToRedraw())},n.prototype.needToRedraw=function(){var e=this.getMap();return!(!e.isInteracting()&&!e.getRenderer().isViewChanged())&&!(!e.getPitch()&&e.isMoving()&&!e.isZooming()&&!e.isRotating()&&!this.layer.options.forceRenderOnMoving)},n.prototype.onSkipDrawOnInteracting=function(){},n.prototype.isLoadingResource=function(){return this._loadingResource},n.prototype.isRenderComplete=function(){return!!this._renderComplete},n.prototype.mustRenderOnInteracting=function(){return!this._painted},n.prototype.setToRedraw=function(){return this._toRedraw=!0,this},n.prototype.setCanvasUpdated=function(){return this._canvasUpdated=!0,this},n.prototype.isCanvasUpdated=function(){return!!this._canvasUpdated},n.prototype.remove=function(){this.onRemove(),delete this._loadingResource,delete this.middleWest,delete this.canvas,delete this.context,delete this.canvasExtent2D,delete this._extent2D,this.resources&&this.resources.remove(),delete this.resources,this._resWorkerConn&&(this._resWorkerConn.remove(),delete this._resWorkerConn),delete this.layer},n.prototype.onRemove=function(){},n.prototype.onAdd=function(){},n.prototype.getMap=function(){return this.layer?this.layer.getMap():null},n.prototype.getCanvasImage=function(){var e=this.getMap();if(this._canvasUpdated=!1,this._renderZoom!==e.getZoom()||!this.canvas||!this._extent2D)return null;if(this.isBlank())return null;if(this.layer.isEmpty&&this.layer.isEmpty())return null;var n=e._pointToContainerPoint(this.middleWest)._add(0,-e.height/2);return{image:this.canvas,layer:this.layer,point:n}},n.prototype.clear=function(){this.clearCanvas()},n.prototype.isBlank=function(){return!this._painted},n.prototype.show=function(){this.setToRedraw()},n.prototype.hide=function(){this.clear(),this.setToRedraw()},n.prototype.setZIndex=function(e){this.setToRedraw()},n.prototype.hitDetect=function(e){if(!this.context||this.layer.isEmpty&&this.layer.isEmpty()||this.isBlank()||this._errorThrown||this.layer.isVisible&&!this.layer.isVisible())return!1;var n=this.getMap(),i=n.getDevicePixelRatio(),o=n.getSize();if(e.x<0||e.x>o.width*i||e.y<0||e.y>o.height*i)return!1;var s=this.getImageData&&this.getImageData();if(s){var a=Math.round(i*e.x),h=Math.round(i*e.y);return s.data[h*s.width*4+4*a+3]>0}try{if(this.context.getImageData(i*e.x,i*e.y,1,1).data[3]>0)return!0}catch(e){return this._errorThrown||(console&&console.warn("hit detect failed with tainted canvas, some geometries have external resources in another domain:\n",e),this._errorThrown=!0),!1}return!1},n.prototype.loadResources=function(e){this.resources||(this.resources=new b7);var n=this.resources,i=[];if(z5(e))for(var o={},s=e.length-1;s>=0;s--){var a=e[s];a&&a.length&&!o[a.join("-")]&&(o[a.join("-")]=1,n.isResourceLoaded(a,!0)||i.push(new Promise(this._promiseResource(a))))}return Promise.all(i)},n.prototype.prepareRender=function(){delete this._renderComplete;var e=this.getMap();this._renderZoom=e.getZoom(),this.canvasExtent2D=this._extent2D=e.get2DExtent(),this.middleWest=e._containerPointToPoint(new w5(0,e.height/2))},n.prototype.createCanvas=function(){if(!this.canvas){var e=this.getMap(),n=e.getSize(),i=e.getDevicePixelRatio(),o=Math.round(i*n.width),s=Math.round(i*n.height);if(this.layer._canvas){var a=this.layer._canvas;a.width=o,a.height=s,a.style&&(a.style.width=n.width+"px",a.style.height=n.height+"px"),this.canvas=this.layer._canvas}else this.canvas=u6.createCanvas(o,s,e.CanvasClass);this.onCanvasCreate()}},n.prototype.onCanvasCreate=function(){},n.prototype._canvasContextScale=function(e,n){return e.scale(n,n),e.dpr=n,this},n.prototype.createContext=function(){if(!(this.gl&&this.gl.canvas===this.canvas||this.context)&&(this.context=u6.getCanvas2DContext(this.canvas),this.context)){this.context.dpr=1,this.layer.options.globalCompositeOperation&&(this.context.globalCompositeOperation=this.layer.options.globalCompositeOperation);var e=this.getMap().getDevicePixelRatio();1!==e&&this._canvasContextScale(this.context,e)}},n.prototype.resetCanvasTransform=function(){if(this.context){var e=this.getMap().getDevicePixelRatio();this.context.setTransform(e,0,0,e,0,0)}},n.prototype.resizeCanvas=function(e){var n=this.canvas;if(n){var i=e||this.getMap().getSize(),o=this.getMap().getDevicePixelRatio(),s=$5(i,o),a=s.width,h=s.height,l=s.cssWidth,c=s.cssHeight;!this.layer._canvas||n.style.width===l&&n.style.height===c||(n.style.width=l,n.style.height=c),n.width===a&&n.height===h||(n.height=h,n.width=a,this.context&&(this.context.dpr=1),1!==o&&this.context&&this._canvasContextScale(this.context,o))}},n.prototype.clearCanvas=function(){if(this.context&&this.getMap()){var e=1/this.getMap().getDevicePixelRatio(),n=this.canvas.height*e;u6.clearRect(this.context,0,0,Math.max(this.canvas.width*e,this.canvas.width),Math.max(n,this.canvas.height))}},n.prototype.prepareCanvas=function(){this.canvas?(this.resetCanvasTransform(),this.clearCanvas(),this.resizeCanvas()):(this.createCanvas(),this.createContext(),this.layer.onCanvasCreate(),this.layer.fire("canvascreate",{context:this.context,gl:this.gl})),delete this._maskExtent;var e=this.layer.getMask();if(!e)return this.layer.fire("renderstart",{context:this.context,gl:this.gl}),null;var n=this._maskExtent=e._getMaskPainter().get2DExtent();return n&&this._extent2D&&n.intersects(this._extent2D),this.layer.fire("renderstart",{context:this.context,gl:this.gl}),n},n.prototype.clipCanvas=function(e){var n=this.layer.getMask();if(!n)return!1;if(!this.layer.options.maskClip)return!1;var i=this.middleWest,o=this.getMap();this.middleWest=o._containerPointToPoint(new w5(0,o.height/2)),e.save();var s=o.getDevicePixelRatio();if(1!==s&&(e.save(),this._canvasContextScale(e,s)),n.getGeometries){e.isMultiClip=!0;var a=n.getGeometries()||[];e.beginPath(),a.forEach((function(n){n._getMaskPainter().paint(null,e)})),e.stroke(),e.isMultiClip=!1}else{e.isClip=!0,e.beginPath(),n._getMaskPainter().paint(null,e),e.isClip=!1}1!==s&&e.restore();try{e.clip("evenodd")}catch(e){console.error(e)}return this.middleWest=i,!0},n.prototype.getViewExtent=function(){return{extent:this._extent2D,maskExtent:this._maskExtent,zoom:this._renderZoom,middleWest:this.middleWest}},n.prototype.completeRender=function(){this.getMap()&&(this._renderComplete=!0,this.layer.fire("renderend",{context:this.context,gl:this.gl}),this.setCanvasUpdated())},n.prototype.getEvents=function(){return{_zoomstart:this.onZoomStart,_zooming:this.onZooming,_zoomend:this.onZoomEnd,_resize:this.onResize,_movestart:this.onMoveStart,_moving:this.onMoving,_moveend:this.onMoveEnd,_dragrotatestart:this.onDragRotateStart,_dragrotating:this.onDragRotating,_dragrotateend:this.onDragRotateEnd,_spatialreferencechange:this.onSpatialReferenceChange}},n.prototype.onZoomStart=function(e){},n.prototype.onZoomEnd=function(e){this.setToRedraw()},n.prototype.onZooming=function(e){},n.prototype.onMoveStart=function(e){},n.prototype.onMoving=function(e){},n.prototype.onMoveEnd=function(e){this.setToRedraw()},n.prototype.onResize=function(e){delete this._extent2D,this.resizeCanvas(),this.setToRedraw()},n.prototype.onDragRotateStart=function(e){},n.prototype.onDragRotating=function(e){},n.prototype.onDragRotateEnd=function(e){this.setToRedraw()},n.prototype.onSpatialReferenceChange=function(e){},n.prototype.getDrawTime=function(){return this._drawTime},n.prototype._tryToDraw=function(e){this._toRedraw=!1,!this.canvas&&this.layer.isEmpty&&this.layer.isEmpty()?this._renderComplete=!0:this._drawAndRecord(e)},n.prototype._drawAndRecord=function(e){if(this.getMap()){var n=this._painted;this._painted=!0;var i=C2();this.draw(e),i=C2()-i,this._drawTime=n?i:i/2,n&&this.layer&&this.layer.options.logDrawTime&&console.log(this.layer.getId(),"frameTimeStamp:",e,"drawTime:",this._drawTime)}},n.prototype._promiseResource=function(e){var n=this,i=this.layer,o=this.resources,s=i.options.crossOrigin,a=i.options.renderer||"";return function(h){if(o.isResourceLoaded(e,!0))h(e);else{var l,c=r4(e[0]);if((l=c)&&f5.decodeImageInWorker&&l instanceof ImageBitmap)createImageBitmap(c).then((function(i){n._cacheResource(e,i),h(e)})).catch((function(n){console.error(n),h(e)}));else if(!C5(e[0])&&n._resWorkerConn&&("canvas"!==i.options.renderer||i.options.decodeImageInWorker))n._resWorkerConn.fetchImage(c,(function(i,o){if(i)return i&&"undefined"!=typeof console&&console.warn(i),void h(e);Y5(o,(function(i){n._cacheResource(e,i),h(e)}))}));else{var A=new Image;M2(s)?"canvas"!==a&&(A.crossOrigin=""):A.crossOrigin=s,C5(e[0])&&!b2&&(e[1]&&(e[1]*=2),e[2]&&(e[2]*=2)),A.onload=function(){n._cacheResource(e,A),h(e)},A.onabort=function(n){console&&console.warn("image loading aborted: "+e[0]),n&&console&&console.warn(n),h(e)},A.onerror=function(n){n&&"undefined"!=typeof console&&console.warn(n),o.markErrorResource(e),h(e)},P5(A,[c])}}}},n.prototype._cacheResource=function(e,n){if(this.layer&&this.resources){var i=e[1],o=e[2];if(this.layer.options.cacheSvgOnCanvas&&1===C5(e[0])&&(f5.edge||f5.ie)){M2(i)&&(i=n.width||this.layer.options.defaultIconSize[0]),M2(o)&&(o=n.height||this.layer.options.defaultIconSize[1]);var s=u6.createCanvas(i,o);u6.image(s.getContext("2d"),n,0,0,i,o),n=s}this.resources.addResource(e,n)}},n}(v6),b7=function(){function e(){this.resources={},this._errors={}}return e.prototype.addResource=function(e,n){var i=this;if(this.resources[e[0]]={image:n,width:+e[1],height:+e[2],refCnt:0},n&&n.width&&n.height&&!n.close&&f5.imageBitMap&&!f5.safari&&!f5.iosWeixin){if(n.src&&C5(n.src))return;createImageBitmap(n).then((function(n){i.resources[e[0]]&&(i.resources[e[0]].image=n)}))}},e.prototype.isResourceLoaded=function(e,n){if(!e)return!1;var i=this._getImgUrl(e);if(this._errors[i])return!0;var o=this.resources[i];return!!o&&!(n&&C5(e[0])&&(+e[1]>o.width||+e[2]>o.height))},e.prototype.login=function(e){var n=this.resources[e];n&&n.refCnt++},e.prototype.logout=function(e){var n=this.resources[e];n&&n.refCnt--<=0&&(n.image&&n.image.close&&n.image.close(),delete this.resources[e])},e.prototype.getImage=function(e){var n=this._getImgUrl(e);return!this.isResourceLoaded(e)||this._errors[n]?null:this.resources[n].image},e.prototype.markErrorResource=function(e){this._errors[this._getImgUrl(e)]=1},e.prototype.merge=function(e){if(!e)return this;for(var n in e.resources){var i=e.resources[n];this.addResource([n,i.width,i.height],i.image)}return this},e.prototype.forEach=function(e){if(!this.resources)return this;for(var n in this.resources)D2(this.resources,n)&&e(n,this.resources[n]);return this},e.prototype._getImgUrl=function(e){return Array.isArray(e)?e[0]:e},e.prototype.remove=function(){for(var e in this.resources){var n=this.resources[e];n&&n.image&&n.image.close&&n.image.close()}this.resources={}},e}();f5.decodeImageInWorker&&k8(S8,(function(){return"\nfunction (exports) {\n    exports.onmessage = function (msg, postResponse) {\n        var url = msg.data.url;\n        var fetchOptions = msg.data.fetchOptions;\n        requestImageOffscreen(url, function (err, data) {\n            var buffers = [];\n            if (data && data.data) {\n                buffers.push(data.data);\n            }\n            postResponse(err, data, buffers);\n        }, fetchOptions);\n    };\n\n    function requestImageOffscreen(url, cb, fetchOptions) {\n        fetch(url, fetchOptions ? fetchOptions : {})\n            .then(response => response.arrayBuffer())\n            .then(arrayBuffer => {\n                const blob=new Blob([arrayBuffer]);\n                return createImageBitmap(blob);\n            })\n            .then(bitmap => {\n                cb(null, {data:bitmap});\n            }).catch(err => {\n                console.warn('error when loading tile:', url);\n                console.warn(err);\n                cb(err);\n            });\n    }\n}"}));var w7={markerWidth:10,markerHeight:10,markerLineWidth:1},C7=new w5(0,0);function P7(e,n,i,o,s,a){var h=s.x+a.x,l=s.y+a.y;C7.x=h,C7.y=l;var c=function(e){if(!e)return 0;var n=e.x,i=e.y;if(0===n&&0===i)return 0;if(0===n||!n){if(i<0)return-Math.PI/2;if(i>0)return Math.PI/2}var o=i/n;return i<0&&n<0?Math.atan(o)-Math.PI:i>0&&n<0?Math.atan(o)+Math.PI:Math.atan(o)}(C7),A=Math.sqrt(h*h+l*l),f=0,d=0;f+=Math.cos(n+c)*A,d+=Math.sin(n+c)*A;var p=y5(function(e,n,i){var o=Math.PI/2+i,s=Math.PI/4+i,a=i,h=n,l=Math.sqrt(e*e+n*n),c=e,A=Math.cos(o)*h,f=Math.sin(o)*h,d=Math.cos(s)*l,p=Math.sin(s)*l,g=Math.cos(a)*c,v=Math.sin(a)*c,w=Math.min(A,d,g,0),C=Math.min(f,p,v,0);return[w,C,Math.max(A,d,g,0)-w,Math.max(f,p,v,0)-C]}(i,o,n),4),g=p[3];d+=p[1];var v=(f+=p[0])+Math.max(i,p[2]),w=d+Math.max(o,g);return e.set(f,d,v,w),e}var M7=new w5(0,0);function T7(e,n,i,o,s,a,h){var l=M7.set(n,i);if(o)return P7(e,o,a,h,l,s);var c=e.set(l.x,l.y,l.x+a,l.y+h);return c._add(s),o&&function(e,n){L7.set(e.xmin,e.ymin,e.xmax,e.ymax),L7.convertTo((function(e){return e._rotate(n)}),e)}(c,o),c}var S7=[];function I7(e,n,i){if((i=i||k7(S7,n))&&(0===i[0]||0===i[1]))return Q7(e),e;var o=D7(n,i[0],i[1]);return T7(e,n.markerDx||0,n.markerDy||0,F7(n),o,i[0],i[1])}function E7(e){return"rectangle"===e?"right":"middle"}function O7(e){return"bar"===e||"pie"===e||"pin"===e?"top":"rectangle"===e?"bottom":"middle"}var R7=new h3(0,0);function D7(e,n,i){var o=2*(e.shadowBlur||0)+.5;R7.width=n,R7.height=i;var s=e.markerType,a=x3(R7,e.markerHorizontalAlignment||E7(s),e.markerVerticalAlignment||O7(s));return a.x!==-n/2&&(a.x-=k5(a.x+n/2)*o),a.y!==-i/2&&(a.y-=k5(a.y+i/2)*o),a}function k7(e,n){var i=D5(n.markerWidth,w7.markerWidth),o=D5(n.markerHeight,w7.markerHeight);if(0===i||0===o)return e[0]=0,e[1]=0,e;var s=D5(n.markerLineWidth,w7.markerLineWidth),a=2*((n.shadowBlur||0)+Math.max(Math.abs(n.shadowOffsetX||0)+Math.abs(n.shadowOffsetY||0))),h=Math.round(i+s+a+1),l=Math.round(o+s+a+1);return e[0]=h,e[1]=l,e}var L7=new v9;function F7(e,n){void 0===n&&(n="markerRotation");var i=e[n];return T2(i)?-i*Math.PI/180:0}function N7(e,n,i){var o=i?i.getImage(n.markerFile):null,s=n.markerWidth||(o?o.width:0),a=n.markerHeight||(o?o.height:0);if(R7.width=s,R7.height=a,0===n.markerWidth||0===n.markerHeight)return Q7(e),e;var h=x3(R7,n.markerHorizontalAlignment||"middle",n.markerVerticalAlignment||"top");return T7(e,n.markerDx||0,n.markerDy||0,F7(n),h,s,a)}function z7(e,n,i){var o=i.size;if(o&&(0===o.width||0===o.height))return Q7(e),e;var s=x3(o,n.textHorizontalAlignment,n.textVerticalAlignment),a=n.textHaloRadius||0,h=T7(e,n.textDx||0,n.textDy||0,F7(n,"textRotation"),s,o.width,o.height);return h.xmin-=a,h.xmax+=a,h.ymin-=a,h.ymax+=a,h}var B7=new v9;function H7(e,n,i,o){var s=e||new v9;if(Array.isArray(n)){for(var a=n,h=0;h<a.length;h++)H7(s,a[h],i,o[h]);return s}return j7(n)&&s._combine(z7(B7,n,o)),U7(n)&&s._combine(N7(B7,n,i)),G7(n)&&s._combine(I7(B7,n)),V7(n)&&s._combine(N7(B7,n)),s}function j7(e){return!!e&&!M2(e.textName)}function U7(e){return!!e&&!M2(e.markerFile)}function G7(e){return!!e&&!(!M2(e.markerFile)||M2(e.markerType)||"path"===e.markerType)}function V7(e){return!!e&&!(!M2(e.markerFile)||"path"!==e.markerType)}var W7,q7=["markerWidth","markerHeight","markerHorizontalAlignment","markerVerticalAlignment","markerDx","markerDy","markerRotation","textName","textSize","textDx","textDy","textVerticalAlignment","textHorizontalAlignment","textRotation","textWrapWidth"],Z7=["textName","markerType","markerFile","textHaloRadius","shadowBlur","shadowOffsetX","shadowOffsetY","textWrapWidth"];function Q7(e){e&&(e.xmin=1/0,e.ymin=1/0,e.xmax=-1/0,e.ymax=-1/0)}function X7(e,n,i,o){for(var s,a=[],h=0,l=0,c=e.length;l<c-1;l++)(s=Y7(e[l],e[l+1],n,l,i,o))&&(a[h]=a[h]||[],a[h].push({point:s[0],index:l}),s[1]===e[l+1]&&l!==c-2||(a[h].push({point:s[1],index:l+1}),h++));return a}function Y7(e,n,i,o,s,a){var h,l,c,A=o?W7:$7(e,i),f=$7(n,i);for(W7=f;;){if(!(A|f))return[e,n];if(A&f)return!1;if(a)return[e,n];c=$7(l=K7(e,n,h=A||f,i,s),i),h===A?(e=l,A=c):(n=l,f=c)}}function J7(e,n,i){var o,s,a,h,l,c,A,f,d,p=[1,4,2,8];for(s=0,A=e.length;s<A;s++)e[s]._code=$7(e[s],n);for(h=0;h<4;h++){for(f=p[h],o=[],s=0,a=(A=e.length)-1;s<A;a=s++)c=e[a],(l=e[s])._code&f?c._code&f||((d=K7(c,l,f,n,i))._code=$7(d,n),o.push(d)):(c._code&f&&((d=K7(c,l,f,n,i))._code=$7(d,n),o.push(d)),o.push(l));e=o}return e}function K7(e,n,i,o,s){var a,h,l=n.x-e.x,c=n.y-e.y,A=o.getMin(),f=o.getMax();8&i?(a=e.x+l*(f.y-e.y)/c,h=f.y):4&i?(a=e.x+l*(A.y-e.y)/c,h=A.y):2&i?(a=f.x,h=e.y+c*(f.x-e.x)/l):1&i&&(a=A.x,h=e.y+c*(A.x-e.x)/l);var d=new w5(a,h);return s&&d._round(),d}function $7(e,n){var i=0;return e.x<n.getMin().x?i|=1:e.x>n.getMax().x&&(i|=2),e.y<n.getMin().y?i|=4:e.y>n.getMax().y&&(i|=8),i}function ttt(e,n,i,o){e=new w5(e);var s,a,h,l=Math.abs(i.x-n.x),c=Math.abs(i.y-n.y),A=Math.sqrt(Math.abs(l*l-c*c));return l>=c?(s=new w5(n.x-A,n.y),a=new w5(n.x+A,n.y),h=2*l):(s=new w5(n.x,n.y-A),a=new w5(n.x,n.y+A),h=2*c),e.distanceTo(s)+e.distanceTo(a)<=h+2*o}function ett(e){if(!e)return[0,0];var n=1/0,i=-1/0;if(T2(e))return[n=i=e,i];var o=function(e){for(var o=0,s=e.length;o<s;o++){var a=e[o];n=Math.min(n,a),i=Math.max(i,a)}};if(!Array.isArray(e[0]))return o(e),[n,i];for(var s=0,a=e.length;s<a;s++){o(e[s])}return[n,i]}var ntt=function(){function e(){this.bbox=v8()}return e.prototype._setBBOX=function(e,n,i,o,s){return e.isHitTesting||w8(this.bbox,n,i,o,s),this},e.prototype._bufferBBOX=function(e,n){return e.isHitTesting||P8(this.bbox,n),this},e.prototype.getMap=function(){return this.geometry.getMap()},e.prototype.getPainter=function(){return this.painter},e.prototype.isDynamicSize=function(){return!1},e.prototype.isVisible=function(){if(!this.style)return!0;var e=this.style.visible;return!1!==e&&0!==e&&!(this.style.opacity<=0)},e.testColor=function(e){return!(!e||!E2(e))&&s3.indexOf(e)>=0},e}(),itt=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype._prepareContext=function(e){if(_4(this.symbol.opacity)?this._opacityFn||(this._opacityFn=b4(this.symbol.opacity)):delete this._opacityFn,T2(this.symbol.opacity))e.globalAlpha!==this.symbol.opacity&&(e.globalAlpha=this.symbol.opacity);else if(this._opacityFn){var n=this.getMap();e.globalAlpha=this._opacityFn(n.getZoom())}else 1!==e.globalAlpha&&(e.globalAlpha=1)},n.prototype.prepareCanvas=function(e,n,i){e.setLineDash&&z5(n.lineDasharray)&&e.setLineDash(n.lineDasharray);var o=this.getPainter().isHitTesting();u6.prepareCanvas(e,n,i,o)},n.prototype.remove=function(){},n.prototype.setZIndex=function(){},n.prototype.show=function(){},n.prototype.hide=function(){},n.prototype._defineStyle=function(e){return this.symbol&&(e.visible=this.symbol.visible,e.opacity=this.symbol.opacity),U4(e,this.geometry)},n}(ntt);function rtt(e,n,i,o){var s=ott(i),a=i,h=a.markerType.toLowerCase(),l=stt(h,a.markerWidth,a.markerHeight),c=s.lineOpacity,A=s.polygonOpacity;if(Z4(s.polygonFill)){var f=void 0;Z4(s.polygonFill)&&(f||(f=function(e,n,i){var o=new v9;return o._combine(e),o.xmin+=-n/2,o.ymin+=-i/2,o.xmax+=n/2,o.ymax+=i/2,o}(n,a.markerWidth,a.markerHeight)),s.polygonGradientExtent=f)}u6.prepareCanvas(e,s,o);var d=a.markerWidth,p=a.markerHeight,g=a.markerLineWidth/2;if("ellipse"===h)u6.ellipse(e,n,d/2,p/2,p/2,c,A);else if("cross"===h||"x"===h){for(var v=l.length-1;v>=0;v--)l[v]._add(n);u6.path(e,l.slice(0,2),c),u6.path(e,l.slice(2,4),c)}else if("diamond"===h||"bar"===h||"square"===h||"rectangle"===h||"triangle"===h){"bar"===h?n=n.add(0,-g):"rectangle"===h&&(n=n.add(g,g));for(v=l.length-1;v>=0;v--)l[v]._add(n);u6.polygon(e,l,c,A)}else if("pin"===h){n=n.add(0,-g);for(v=l.length-1;v>=0;v--)l[v]._add(n);var w=e.lineCap;e.lineCap="round",u6.bezierCurveAndFill(e,l,c,A),e.lineCap=w}else{if("pie"!==h)throw new Error("unsupported markerType: "+h);n=n.add(0,-g);var C=180*Math.atan(d/2/p)/Math.PI;w=e.lineCap;e.lineCap="round",u6.sector(e,n,p,[90-C,90+C],c,A),e.lineCap=w}return e.canvas}function ott(e){var n={lineColor:e.markerLineColor,linePatternFile:e.markerLinePatternFile,lineWidth:e.markerLineWidth,lineOpacity:e.markerLineOpacity,lineDasharray:e.markerLineDasharray,lineCap:"butt",lineJoin:"round",polygonFill:e.markerFill,polygonPatternFile:e.markerFillPatternFile,polygonOpacity:e.markerFillOpacity};return 0===n.lineWidth&&(n.lineOpacity=0),n}function stt(e,n,i){var o,s,a,h,l=i/2,c=n/2;if("triangle"===e)return[o=new w5(0,0-l),s=new w5(0-c,0+l),a=new w5(0+c,0+l)];if("cross"===e)return[o=new w5(0-c,0),s=new w5(0+c,0),a=new w5(0,0-l),h=new w5(0,0+l)];if("diamond"===e)return[o=new w5(0-c,0),s=new w5(0,0-l),a=new w5(0+c,0),h=new w5(0,0+l)];if("square"===e)return[o=new w5(0-c,0+l),s=new w5(0+c,0+l),a=new w5(0+c,0-l),h=new w5(0-c,0-l)];if("rectangle"===e)return s=(o=new w5(0,0)).add(n,0),a=o.add(n,i),h=o.add(0,i),[o,s,a,h];if("x"===e)return[o=new w5(0-c,0+l),s=new w5(0+c,0-l),a=new w5(0+c,0+l),h=new w5(0-c,0-l)];if("bar"===e)return[o=new w5(0-c,0-i),s=new w5(0+c,0-i),a=new w5(0+c,0),h=new w5(0-c,0)];if("pin"===e||"pie"===e){var A=i*Math.atan(c/l);return[o=new w5(0,0),s=new w5(0-A,0-i),a=new w5(0+A,0-i),h=new w5(0,0)]}return[]}var att=new w5(0,0),htt=new w5(0,0),ltt=new w5(0,0),utt=new w5(0,0),ctt=function(e){function n(n,i,o){var s=e.call(this)||this;return s.symbol=n,s.geometry=i,s.painter=o,s}return p5(n,e),n.prototype.get2DExtent=function(){for(var e=this.getMap(),n=e.getGLRes(),i=new v9,o=this._getRenderPoints()[0],s=o.length-1;s>=0;s--)o[s]&&i._combine(e._pointAtResToPoint(o[s],n));return i},n.prototype.isDynamicSize=function(){var e=this.symbol;return _4(e.markerWidth)||_4(e.markerHeight)||_4(e.textSize)},n.prototype._rotateExtent=function(e,n){return e.convertTo((function(e){return e._rotate(n)}))},n.prototype._getRenderPoints=function(){var e=this.getPainter().isSpriting()?"center":this.getPlacement();return this.getPainter().getRenderPoints(e)},n.prototype._getRenderContainerPoints=function(e){var n=this.getPainter();if(n.isSpriting())return this._getRenderPoints()[0];var i,o=this.geometry,s=this.getDxDy();if(o._cPoint&&!e){var a=e?ltt:utt;a.set(o._cPoint.x,o._cPoint.y),a._sub(n.containerOffset);var h=s.x,l=s.y;(h||l)&&a._add(h||0,l||0),i=[a]}else{var c=this._getRenderPoints()[0];i=this.painter._pointContainerPoints(c,s.x,s.y,e,!0,this.getPlacement())}if(!i||!Array.isArray(i[0]))return i;for(var A=[],f=0,d=i.length;f<d;f++)for(var p=0,g=i[f].length;p<g;p++)A.push(i[f][p]);return A},n.prototype.getPlacement=function(){return this.symbol.markerPlacement},n.prototype.getRotation=function(){return F7(this.style)},n.prototype.getDxDy=function(){var e=this.style;return new w5(e.markerDx,e.markerDy)},n.prototype._getRotationAt=function(e){var n=this.getRotation();n||(n=0);var i=this._getRenderPoints()[1];if(!i||!i[e])return n;var o=this.getMap(),s=i[e][0],a=i[e][1];if(o.isTransforming()){var h=o.getGLRes();return s=o._pointAtResToContainerPoint(i[e][0],h,0,att),a=o._pointAtResToContainerPoint(i[e][1],h,0,htt),n+V5(s.x,s.y,a.x,a.y)}return n+-V5(s.x,s.y,a.x,a.y)},n.prototype._rotate=function(e,n,i){if(i){var o=this.getDxDy(),s=n.sub(o);return e.save(),e.translate(s.x,s.y),e.rotate(i),o}return null},n}(itt),Att=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype.getPlacement=function(){return"point"},n.prototype.getDxDy=function(){return new w5(0,0)},n.prototype.symbolize=function(e){var n=this.geometry,i=n.getLayer();if(n.options.debug||!i||i.options.debug){var o=this.getMap();if(o&&!o.isZooming()){var s=i.options.debugOutline;e.strokeStyle=s,e.fillStyle=s,e.lineWidth=1,e.font="18px  serif";var a=n.getContainerExtent().toArray();u6.polygon(e,[a],1,0);for(var h=this._getRenderContainerPoints(),l=this.geometry.getId(),c=stt("cross",10,10),A=0;A<h.length;A++){var f=h[A];M2(l)||u6.fillText(e,l,f.add(8,-4),s);for(var d=[],p=0;p<c.length;p++)d.push(c[p].add(f));u6.path(e,d.slice(0,2),1),u6.path(e,d.slice(2,4),1)}}}},n}(ctt),ftt=new h3(1,1),dtt=new v9,ptt=function(e){function n(n,i,o){var s=e.call(this,n,i,o)||this;return s.style=s._defineStyle(s.translate()),s}return p5(n,e),n.test=function(e){return U7(e)},n.prototype.symbolize=function(e,n){if(this.isVisible()){var i=this.style;if(this.painter.isHitTesting()||0!==i.markerWidth&&0!==i.markerHeight&&0!==i.markerOpacity){var o=this._getRenderContainerPoints();if(z5(o)){var s=this._getImage(n);if(s){this._prepareContext(e);var a,h=i.markerWidth,l=i.markerHeight;if(!T2(h)||!T2(l)){l=s.height,i.markerWidth=h=s.width,i.markerHeight=l;var c=i.markerFile;n.isResourceLoaded(c)||n.addResource(c,s);var A=this.getPainter();A.isSpriting()||A.removeCache()}"path"!==this.symbol.markerType&&T2(i.markerOpacity)&&i.markerOpacity<1&&(a=e.globalAlpha,e.globalAlpha*=i.markerOpacity),ftt.width=h,ftt.height=l;for(var f=x3(ftt,i.markerHorizontalAlignment,i.markerVerticalAlignment),d=0,p=o.length;d<p;d++){var g=o[d],v=this.getRotation()?this._rotate(e,g,this._getRotationAt(d)):null,w=void 0;if(v){var C=g.sub(v);g=v;var P=this._getRotationAt(d);(w=P7(dtt,P,h,l,g,f))._add(C)}var T=g.x+f.x,S=g.y+f.y;u6.image(e,s,T,S,h,l),v&&e.restore(),v?this._setBBOX(e,w.xmin,w.ymin,w.xmax,w.ymax):this._setBBOX(e,T,S,T+h,S+l)}void 0!==a&&(e.globalAlpha=a)}else"undefined"!=typeof console&&console.warn("no img found for "+(this.style.markerFile||this._url[0]))}}}},n.prototype._getImage=function(e){return function(e,n){return e&&e.getImage(n)||null}(e,this.style.markerFile)},n.prototype.getFixedExtent=function(e){return this._fixedExtent=this._fixedExtent||new v9,N7(this._fixedExtent,this.style,e)},n.prototype.translate=function(){var e=this.symbol;return{markerFile:e.markerFile,markerOpacity:D5(e.markerOpacity,1),markerWidth:D5(e.markerWidth,null),markerHeight:D5(e.markerHeight,null),markerRotation:D5(e.markerRotation,0),markerDx:D5(e.markerDx,0),markerDy:D5(e.markerDy,0),markerHorizontalAlignment:D5(e.markerHorizontalAlignment,"middle"),markerVerticalAlignment:D5(e.markerVerticalAlignment,"top")}},n}(ctt),gtt=new o9(0,0),mtt=new o9(0,0),ytt=function(e){function n(n,i,o){var s=e.call(this)||this;return s.symbol=n,s.geometry=i,s.painter=o,i.isPoint||(s.style=s._defineStyle(s.translate())),s}return p5(n,e),n.test=function(e,n){if(!e)return!1;if(n&&n.isPoint)return!1;for(var i in e){var o=i.slice(0,4);if("line"===o||"poly"===o)return!0}return!1},n.prototype.symbolize=function(e,n){var i,o;if(this.isVisible()){var s=this.style;if(0!==s.polygonOpacity||0!==s.lineOpacity||this.painter.isHitTesting()){var a=this._getPaintParams();if(a){this._prepareContext(e);var h=Z4(s.lineColor),l="Polygon"===this.geometry.getJSONType()||"LineString"===this.geometry.type;!h||!s.lineColor.places&&l||(s.lineGradientExtent=this.geometry.getContainerExtent()._expand(s.lineWidth)),Z4(s.polygonFill)&&(s.polygonGradientExtent=this.geometry.getContainerExtent());var c=this.geometry.getLayer().options.geometryEventTolerance||0,A=this.geometry._hitTestTolerance()+c,f=a[0];if("Polygon"===this.geometry.getJSONType()&&f.length>0&&Array.isArray(f[0][0])||"LineString"===this.geometry.type&&f.length>0&&Array.isArray(f[0]))for(var d=0;d<f.length;d++){this.prepareCanvas(e,s,n),h&&l&&!s.lineColor.places&&this._createGradient(e,f[d],s.lineColor);var p=[e,f[d]];a.length>1&&p.push.apply(p,v5([],y5(a.slice(1)),!1)),p.push(s.lineOpacity,s.polygonOpacity,s.lineDasharray);var g=(i=this.geometry)._paintOn.apply(i,v5([],y5(p),!1));this._setBBOX(e,g),this._bufferBBOX(e,A)}else{this.prepareCanvas(e,s,n),h&&l&&!s.lineColor.places&&this._createGradient(e,f,s.lineColor),(p=[e]).push.apply(p,v5([],y5(a),!1)),p.push(s.lineOpacity,s.polygonOpacity,s.lineDasharray);g=(o=this.geometry)._paintOn.apply(o,v5([],y5(p),!1));this._setBBOX(e,g),this._bufferBBOX(e,A)}e.setLineDash&&Array.isArray(s.lineDasharray)&&e.setLineDash([])}}}},n.prototype.get2DExtent=function(){var e=this.getMap(),n=this.geometry._getPrjExtent();if(!n)return null;this._extMin&&this._extMax||(this._extMin=new o9(0,0),this._extMax=new o9(0,0)),this._extMin.x=n.xmin,this._extMin.y=n.ymin,this._extMax.x=n.xmax,this._extMax.y=n.ymax;var i=e._prjToPoint(this._extMin,void 0,gtt),o=e._prjToPoint(this._extMax,void 0,mtt);return this._pxExtent?this._pxExtent.set(Math.min(i.x,o.x),Math.min(i.y,o.y),Math.max(i.x,o.x),Math.max(i.y,o.y)):this._pxExtent=new v9(i,o),this._pxExtent},n.prototype.getFixedExtent=function(){var e=this.style.lineWidth/2;return new v9(-e,-e,e,e)},n.prototype._getPaintParams=function(){return this.getPainter().getPaintParams(this.style.lineDx,this.style.lineDy)},n.prototype.translate=function(){var e=this.symbol,n={lineColor:D5(e.lineColor,"#000"),lineWidth:D5(e.lineWidth,2),lineOpacity:D5(e.lineOpacity,1),lineDasharray:D5(e.lineDasharray,[]),lineCap:D5(e.lineCap,"butt"),lineJoin:D5(e.lineJoin,"miter"),linePatternFile:D5(e.linePatternFile,null),lineDx:D5(e.lineDx,0),lineDy:D5(e.lineDy,0),polygonFill:D5(e.polygonFill,null),polygonOpacity:D5(e.polygonOpacity,1),polygonPatternFile:D5(e.polygonPatternFile,null),polygonPatternDx:D5(e.polygonPatternDx,0),polygonPatternDy:D5(e.polygonPatternDy,0),linePatternDx:D5(e.linePatternDx,0),linePatternDy:D5(e.linePatternDy,0)};return 0===n.lineWidth&&(n.lineOpacity=0),"LineString"!==this.geometry.type||n.polygonFill||(n.polygonFill=n.lineColor),n},n.prototype._createGradient=function(e,n,i){if(Array.isArray(n)&&n.length){var o=y5(function(e){var n,i=!0;Array.isArray(e[0])?(n=e[0],i=!1):n=e;var o=n.length;if(i)return[n[0],n[o-1]];for(var s,a=n[0],h=0,l=1;l<o;l++){var c=n[l],A=a.distanceTo(c);A>h&&(h=A,s=c)}return[a,s]}(n),2),s=o[0],a=o[1];if(s&&a){var h=e.createLinearGradient(s.x,s.y,a.x,a.y);i.colorStops.forEach((function(e){h.addColorStop.apply(h,v5([],y5(e),!1))})),e.strokeStyle=h}else console.error("unable create canvas LinearGradient,error data:",n)}},n}(itt);var vtt,_tt=new v9,xtt=function(e){function n(n,i,o){var s=e.call(this,n,i,o)||this,a=s.translate();return s._dynamic=x4(a),s.style=s._defineStyle(a),0===s.style.textWrapWidth||(s.strokeAndFill=s._defineStyle(s.translateLineAndFill(s.style))),s}return p5(n,e),n.test=function(e){return j7(e)},n.prototype.symbolize=function(e,n){if(this.isVisible()&&(this.painter.isHitTesting()||0!==this.style.textSize&&(this.style.textOpacity||this.style.textHaloRadius&&this.style.textHaloOpacity)&&0!==this.style.textWrapWidth)){var i=this._getRenderContainerPoints();if(z5(i)){var o=this.style,s=this.strokeAndFill,a=v3(this.style.textName,this.geometry.getProperties());this._dynamic&&delete this._textDesc;var h=this._textDesc=this._textDesc||_3(a,this.style);this._prepareContext(e),this.prepareCanvas(e,s,n),u6.prepareCanvasFont(e,o);for(var l=o.textHaloRadius||0,c=0,A=i.length;c<A;c++){var f=i[c],d=this.getRotation()?this._rotate(e,f,this._getRotationAt(c)):null,p=void 0;if(d){var g=f.sub(d);f=d;var v=this._getRotationAt(c),w=h.size||{width:0,height:0},C=w.width,P=w.height,T=x3(h.size,o.textHorizontalAlignment,o.textVerticalAlignment);(p=P7(_tt,v,C,P,f,T))._add(g)}var S=u6.text(e,a,f,o,h);d?(this._setBBOX(e,p.xmin,p.ymin,p.xmax,p.ymax),e.restore()):this._setBBOX(e,S),this._bufferBBOX(e,l)}}}},n.prototype.getPlacement=function(){return this.symbol.textPlacement},n.prototype.getRotation=function(){var e=this.style.textRotation;return T2(e)?-e*Math.PI/180:null},n.prototype.getDxDy=function(){var e=this.style;return new w5(e.textDx,e.textDy)},n.prototype.getFixedExtent=function(){var e=this.geometry.getTextDesc();return Array.isArray(e)&&(e=e[this._index]),this._fixedExtent=this._fixedExtent||new v9,e?z7(this._fixedExtent,this.style,e):this._fixedExtent},n.prototype.translate=function(){var e=this.symbol,n={textName:e.textName,textFaceName:D5(e.textFaceName,"monospace"),textWeight:D5(e.textWeight,"normal"),textStyle:D5(e.textStyle,"normal"),textSize:D5(e.textSize,a3),textFont:D5(e.textFont,null),textFill:D5(e.textFill,"#000"),textOpacity:D5(e.textOpacity,1),textHaloFill:D5(e.textHaloFill,"#ffffff"),textHaloRadius:D5(e.textHaloRadius,0),textHaloOpacity:D5(e.textHaloOpacity,1),textWrapWidth:D5(e.textWrapWidth,null),textWrapCharacter:D5(e.textWrapCharacter,"\n"),textLineSpacing:D5(e.textLineSpacing,0),textDx:D5(e.textDx,0),textDy:D5(e.textDy,0),textHorizontalAlignment:D5(e.textHorizontalAlignment,"middle"),textVerticalAlignment:D5(e.textVerticalAlignment,"middle"),textAlign:D5(e.textAlign,"center"),textRotation:D5(e.textRotation,0),textMaxWidth:D5(e.textMaxWidth,0),textMaxHeight:D5(e.textMaxHeight,0)};return n.textMaxWidth>0&&(!n.textWrapWidth||n.textWrapWidth>n.textMaxWidth)&&(n.textWrapWidth||(n.textMaxHeight=1),n.textWrapWidth=n.textMaxWidth),n},n.prototype.translateLineAndFill=function(e){return{lineColor:e.textHaloRadius?e.textHaloFill:e.textFill,lineWidth:e.textHaloRadius,lineOpacity:e.textOpacity,lineDasharray:null,lineCap:"butt",lineJoin:"round",polygonFill:e.textFill,polygonOpacity:e.textOpacity}},n}(ctt),btt=[0,0],wtt=new v9,Ctt=new w5(0,0),Ptt=function(e){function n(n,i,o){var s=e.call(this,n,i,o)||this,a=s.translate();return s._dynamic=x4(a),s.style=s._defineStyle(a),s.strokeAndFill=s._defineStyle(ott(s.style)),s.padding=0,s}return p5(n,e),n.test=function(e){return G7(e)},n.prototype.symbolize=function(e,n){if(this.isVisible()){var i=this.style;if(this.painter.isHitTesting()||0!==i.markerWidth&&0!==i.markerHeight&&(0!==i.polygonOpacity||0!==i.lineOpacity)){var o=this._getRenderContainerPoints();z5(o)&&(this._prepareContext(e),this.getPainter().isSpriting()||this.geometry.getLayer().getMask()===this.geometry||this._dynamic||!1===this.geometry.getLayer().options.cacheVectorOnCanvas?this._drawMarkers(e,o,n):this._drawMarkersWithCache(e,o,n))}}},n.prototype._drawMarkers=function(e,n,i){for(var o=n.length-1;o>=0;o--){var s=n[o],a=y5(k7(btt,this.style),2),h=a[0],l=a[1],c=void 0,A=this.getRotation()?this._rotate(e,s,this._getRotationAt(o)):null;if(A){var f=s.sub(A);s=A;var d=this._getRotationAt(o);(c=P7(wtt,d,h,l,s,Ctt))._add(f)}if(this._drawVectorMarker(e,s,i),A)e.restore(),this._setBBOX(e,c.xmin,c.ymin,c.xmax,c.ymax);else{var p=s.x,g=s.y;this._setBBOX(e,p,g,p+h,g+l)}}},n.prototype._drawMarkersWithCache=function(e,n,i){var o=this._stampSymbol(),s=i.getImage(o);s||(s=this._createMarkerImage(e,i),i.addResource([o,s.width,s.height],s));for(var a=D7(this.style,s.width,s.height),h=n.length-1;h>=0;h--){var l=n[h],c=this.getRotation()?this._rotate(e,l,this._getRotationAt(h)):null,A=void 0;if(c){var f=l.sub(c);l=c;var d=this._getRotationAt(h);(A=P7(wtt,d,s.width,s.height,l,a))._add(f)}var p=l.x+a.x,g=l.y+a.y;u6.image(e,s,p,g),c?(e.restore(),this._setBBOX(e,A.xmin,A.ymin,A.xmax,A.ymax)):this._setBBOX(e,p,g,p+s.width,g+s.height)}},n.prototype._createMarkerImage=function(e,n){var i=e.canvas.constructor,o=k7(btt,this.style),s=u6.createCanvas(o[0],o[1],i),a=this._getCacheImageAnchor(o[0],o[1]),h=s.getContext("2d");return this._drawVectorMarker(h,a,n),s},n.prototype._stampSymbol=function(){return this._stamp||(this._stamp=M3([this.style.markerType,Z4(this.style.markerFill)?Q4(this.style.markerFill):this.style.markerFill,this.style.markerFillOpacity,this.style.markerFillPatternFile,Z4(this.style.markerLineColor)?Q4(this.style.markerLineColor):this.style.markerLineColor,this.style.markerLineWidth,this.style.markerLineOpacity,this.style.markerLineDasharray?this.style.markerLineDasharray.join(","):"",this.style.markerLinePatternFile,this.style.markerWidth,this.style.markerHeight,this.style.markerHorizontalAlignment,this.style.markerVerticalAlignment].join("_"))),this._stamp},n.prototype._getCacheImageAnchor=function(e,n){var i=2*(this.symbol.shadowBlur||0)+this.padding,o=this.style.markerType;return"bar"===o||"pie"===o||"pin"===o?new w5(e/2,n-i):"rectangle"===o?new w5(i,i):new w5(e/2,n/2)},n.prototype._getGraidentExtent=function(e){var n=new v9,i=this.getDxDy(),o=this.getFixedExtent();if(Array.isArray(e))for(var s=e.length-1;s>=0;s--)n._combine(e[s]);else n._combine(e);return n.xmin+=o.xmin-i.x,n.ymin+=o.ymin-i.y,n.xmax+=o.xmax-i.x,n.ymax+=o.ymax-i.y,n},n.prototype._drawVectorMarker=function(e,n,i){rtt(e,n,this.style,i)},n.prototype.getFixedExtent=function(){var e=this.isDynamicSize(),n=this.style.markerWidth,i=this.style.markerHeight;return this._fixedExtent=this._fixedExtent||new v9,I7(this._fixedExtent,this.style,e?[128,128*(0===n?1:i/n)]:null)},n.prototype.translate=function(){var e=this.symbol,n={markerType:D5(e.markerType,"ellipse"),markerFill:D5(e.markerFill,"#00f"),markerFillOpacity:D5(e.markerFillOpacity,1),markerFillPatternFile:D5(e.markerFillPatternFile,null),markerLineColor:D5(e.markerLineColor,"#000"),markerLineWidth:D5(e.markerLineWidth,w7.markerLineWidth),markerLineOpacity:D5(e.markerLineOpacity,1),markerLineDasharray:D5(e.markerLineDasharray,[]),markerLinePatternFile:D5(e.markerLinePatternFile,null),markerDx:D5(e.markerDx,0),markerDy:D5(e.markerDy,0),markerWidth:D5(e.markerWidth,w7.markerWidth),markerHeight:D5(e.markerHeight,w7.markerHeight),markerRotation:D5(e.markerRotation,0),shadowBlur:D5(e.shadowBlur,0),shadowOffsetX:D5(e.shadowOffsetX,0),shadowOffsetY:D5(e.shadowOffsetY,0)},i=n.markerType,o=E7(i),s=O7(i);return n.markerHorizontalAlignment=D5(e.markerHorizontalAlignment,o),n.markerVerticalAlignment=D5(e.markerVerticalAlignment,s),T2(e.markerOpacity)&&(T2(e.markerFillOpacity)&&(n.markerFillOpacity*=e.markerOpacity),T2(e.markerLineOpacity)&&(n.markerLineOpacity*=e.markerOpacity)),n},n}(ctt),Mtt=function(e){function n(n,i,o){var s=this;M2(n.markerWidth)&&(n.markerWidth=80),M2(n.markerHeight)&&(n.markerHeight=80),n=P2({},n,(s=e.call(this,n,i,o)||this).translate());var a=s.style=s._defineStyle(n);return s._url=f5.gecko?[G4(a,a.markerWidth,a.markerHeight),a.markerWidth,a.markerHeight]:[G4(a),a.markerWidth,a.markerHeight],s}return p5(n,e),n.test=function(e){return V7(e)},n.prototype._prepareContext=function(){},n.prototype._getImage=function(e){var n=this;if(e&&e.isResourceLoaded(this._url))return e.getImage(this._url);var i=this.painter,o=new Image;return o.onload=function(){var e=i.getLayer()&&i.getLayer().getRenderer();e&&e.setToRedraw()},o.onerror=function(i){i&&"undefined"!=typeof console&&console.warn(i),e.markErrorResource(n._url)},o.src=this._url[0],e&&e.addResource(this._url,o),o},n}(ptt),Ttt={lineWidth:1,polygonFill:"#fff",polygonOpacity:.5},Stt=function(e){function n(n,i,o){var s=e.call(this,n,i,o)||this;return s.style=i.getLayer().options.drawAltitude,s.style&&I2(s.style)||(s.style={lineWidth:2}),s.style.lineWidth||(s.style.lineWidth=0),s.dxdy=s._defineStyle({dx:n.textDx||n.markerDx,dy:n.textDy||n.markerDy}),s}return p5(n,e),n.test=function(e,n){if(!n.getLayer())return!1;var i=n.getJSONType();return"Marker"===i||"LineString"===i},n.prototype.symbolize=function(e){if(this.geometry.getLayer().options.drawAltitude&&this.geometry.hasAltitude()){var n=this._getStyle();if(this._prepareContext(e),"LineString"===this.geometry.type){var i=this._getPaintParams(n.lineDx,n.lineDy);if(!i)return;var o=this.getPainter().getPaintParams(n.lineDx,n.lineDy,!0,!0,"_groundpt")[0];this._drawLineAltitude(e,i[0],o)}else{var s=this._getRenderContainerPoints(),a=this._getRenderContainerPoints(!0);if(!s||0===s.length)return;this._drawMarkerAltitude(e,s[0],a[0])}}},n.prototype.getDxDy=function(){var e=this.dxdy;return new w5(e.dx||0,e.dy||0)},n.prototype.get2DExtent=function(){return"LineString"===this.geometry.type?ytt.prototype.get2DExtent.apply(this):e.prototype.get2DExtent.call(this)},n.prototype.getPlacement=function(){return"point"},n.prototype._getPaintParams=function(e,n){return this.getPainter().getPaintParams(e||0,n||0,null,!0,"_altpt")},n.prototype._drawMarkerAltitude=function(e,n,i){var o=this._getStyle();this.prepareCanvas(e,o),u6.path(e,[n,i],o.lineOpacity,null,o.lineDasharray)},n.prototype._drawLineAltitude=function(e,n,i){var o=this._getStyle();if(n.length>0&&Array.isArray(n[0]))for(var s=0;s<n.length;s++)this._drawLine(e,n[s],i[s]);else this._drawLine(e,n,i);e.setLineDash&&Array.isArray(o.lineDasharray)&&e.setLineDash([])},n.prototype._drawLine=function(e,n,i){var o=this._getStyle();this.prepareCanvas(e,o);for(var s=0,a=n.length-1;s<a;s++)u6.polygon(e,[n[s],n[s+1],i[s+1],i[s]],o.lineOpacity,o.polygonOpacity,o.lineDasharray)},n.prototype._getStyle=function(){var e=this.geometry.getLayer(),n=e.options.drawAltitude;if(Array.isArray(n)){var i=(e.getGeometries()||[]).indexOf(this.geometry);i>=0&&(n=n[i]||Ttt)}return I2(n)||(n=Ttt),n.lineWidth||(n.lineWidth=0,n.lineOpacity=0),n},n}(ctt),Itt=[Stt,ytt,ptt,Mtt,Ptt,xtt],Ett=new w5(0,0),Ott=new v9,Rtt=new v9,Dtt=new v9,ktt=new v9,Ltt=new v9,Ftt={code:void 0},Ntt={minx:1/0,miny:1/0,maxx:-1/0,maxy:-1/0},ztt=function(e){function n(n){var i=e.call(this)||this;return i.geometry=n,i.symbolizers=i._createSymbolizers(),i._altAtGL=i._getGeometryAltitude(),i.bbox=v8(),i._drawTime=0,i}return p5(n,e),n.prototype._setDrawTime=function(e){return this._drawTime=e,this},n.prototype.getRenderBBOX=function(){var e=this.getLayer();if(e&&e._drawTime!==this._drawTime)return null;x8(this.bbox);for(var n=this.symbolizers.length-1;n>=0;n--){var i=this.symbolizers[n].bbox;C8(i)&&w8(this.bbox,i)}return C8(this.bbox)?this.bbox:null},n.prototype.getMap=function(){return this.geometry.getMap()},n.prototype.getLayer=function(){return this.geometry&&this.geometry.getLayer()},n.prototype._createSymbolizers=function(){var e=this.getSymbol(),n=[],i=Itt,o=e;Array.isArray(e)||(o=[e]);for(var s=o.length-1;s>=0;s--)for(var a=o[s],h=i.length-1;h>=0;h--)if(i[h].test(a,this.geometry)){var l=new i[h](a,this.geometry,this);l._index=s,n.push(l),l instanceof ctt&&(this._hasPoint=!0)}if(!n.length&&console){var c=this.geometry.getId();console.warn("invalid symbol for geometry("+(this.geometry?this.geometry.getType()+(c?":"+c:""):"")+") to draw : "+JSON.stringify(e))}return this._debugSymbolizer=new Att(e,this.geometry,this),n},n.prototype.hasPoint=function(){return!!this._hasPoint},n.prototype.getRenderPoints=function(e){return this._verifyProjection(),this._renderPoints||(this._renderPoints={}),e||(e="center"),this._renderPoints[e]||(this._renderPoints[e]=this.geometry._getRenderPoints(e)),this._renderPoints[e]},n.prototype.getPaintParams=function(e,n,i,o,s){void 0===s&&(s="_pt");var a,h,l,c,A,f=this.getLayer()._getRenderer().mapStateCache,d=this.getMap();f&&!this._hitPoint?(a=f.resolution,h=f.pitch,l=f.bearing,c=f.glScale,A=f.containerExtent):(a=d.getResolution(),h=d.getPitch(),l=d.getBearing(),c=d.getGLScale(),A=d.getContainerExtent());var p=this.geometry,g=a,v=0!==h,w=0!==l,C=this._cachedParams,P=p._paintAsPath&&p._paintAsPath();if(P&&this._unsimpledParams&&g<=this._unsimpledParams._res)C=this._unsimpledParams;else if(!C||C._res!==a||this._pitched!==v&&p._redrawWhenPitch()||this._rotated!==w&&p._redrawWhenRotate()){if(!(C=p._getPaintParams()))return null;C._res=g,!p._simplified&&P&&(this._unsimpledParams||(this._unsimpledParams=C),g>this._unsimpledParams._res&&(this._unsimpledParams._res=g)),this._cachedParams=C}if(!C)return null;this._pitched=v,this._rotated=w;var T=c,S=[],I=this._pointContainerPoints(C[0],e,n,i,o||this._hitPoint&&!A.contains(this._hitPoint),null,s);if(!I)return null;S.push(I);for(var E=1,O=C.length;E<O;E++)T2(C[E])||C[E]instanceof h3?T2(C[E])?S.push(C[E]/T):S.push(C[E].multi(1/T)):S.push(C[E]);return S},n.prototype._pointContainerPoints=function(e,n,i,o,s,a,h){if(void 0===h&&(h="_pt"),this._aboveCamera())return null;var l,c,A,f=this.getLayer()._getRenderer(),d=f.mapStateCache,p=this.getMap(),g=this.geometry,v=this.containerOffset;d?(l=d.glRes,c=d.containerExtent):(l=p.getGLRes(),c=p.getContainerExtent());var w=this.getLayer().options.roundPoint,C=1/0,P=1/0,T=-1/0,S=-1/0,I=!s,E=f.layer.options.clipBBoxBufferSize||3,O=this.symbolizers,k=g.options.enableClip;function L(e,o){void 0===e&&(e=[]),void 0===o&&(o=[]);for(var s=X5(e,h),a=0,A=(s=p._pointsAtResToContainerPoints(e,l,o,s)).length;a<A;a++){var f=s[a];f._sub(v),(n||i)&&f._add(n||0,i||0),w&&(f.x=Math.ceil(f.x),f.y=Math.ceil(f.y)),C=Math.min(f.x,C),P=Math.min(f.y,P),T=Math.max(f.x,T),S=Math.max(f.y,S)}if(k&&I&&function(e){void 0===e&&(e=[]),Array.isArray(e)||(e=[e]);for(var n=e.length,i=0;i<n;i++){var o=e[i];if(o.style){var s=o.style,a=s.lineDasharray,h=s.lineWidth;if(h&&T2(h)&&h>0&&a&&Array.isArray(a)&&a.length)return!0}}return!1}(O)){if(Ltt.ymin=c.ymin,Ltt.ymin<E&&(Ltt.ymin=c.ymin-E),Ltt.xmin=c.xmin-E,Ltt.xmax=c.xmax+E,Ltt.ymax=c.ymax+E,g.getShell&&g.getHoles)return J7(s,Ltt);var d=X7(s,Ltt,!1);if(d.length){var L=[];return d.forEach((function(e){for(var n=0,i=e.length;n<i;n++)L.push(e[n].point)})),L}}return s}var F=this.getAltitude();if(Array.isArray(e)){var N=void 0;!s&&this.geometry.options.enableClip?(N=this._clip(e,F)).inView&&(I=!1):N={points:e,altitude:F};var z=N.points;F=N.altitude,o&&(F=0);var H=F;A=[];for(var j=[],W=T2(F),q=0,Y=z.length;q<Y;q++){var J=z[q];if(Array.isArray(J)){if(W){var $=L(J,F);A.push($);continue}for(var it=[],rt=0,ot=J.length;rt<ot;rt++)Array.isArray(F)&&(H=F[q]?F[q][rt]:0),it.push(H);var st=L(J,it);A.push(st)}else Array.isArray(F)&&(H="vertex-last"===a?F[F.length-1-q]:"line"===a?(F[q]+F[q+1])/2:F[q]),j.push(H)}j.length&&(A=L(z,j))}else e instanceof w5&&(o&&(F=0),A=p._pointAtResToContainerPoint(e,l,F)._sub(v),(n||i)&&A._add(n,i));return Ntt.minx=C,Ntt.miny=P,Ntt.maxx=T,Ntt.maxy=S,this._containerBbox=Ntt,A},n.prototype._clip=function(e,n){if(T2(n)&&0!==n)return{points:e,altitude:n};if(Array.isArray(n)){for(var i=!1,o=0,s=n.length;o<s;o++)if(0!==n[o]){i=!0;break}if(i)return{points:e,altitude:n}}var a=this.getMap(),h=this.geometry,l=this.getSymbol().lineWidth;T2(l)||(l=4);var c,A,f,d=this.getLayer()._getRenderer().mapStateCache;d?(c=d._2DExtent,A=d.glExtent,f=d.pitch):(c=a.get2DExtent(),A=a.get2DExtentAtRes(a.getGLRes()),f=a.getPitch());var p=c._expand(l);if(f>0&&n){var g=a.cameraLookAt,v=a.cameraPosition;Ett.set(v[0],v[1]),p=p._combine(Ett._add(k5(g[0]-v[0]),k5(g[1]-v[1])))}var w=e;if(this.get2DExtent(null,ktt).within(p))return{points:w,altitude:n,inView:!0};var C=A._expand(l*a.getGLScale());Dtt.xmin=C.xmin,Dtt.xmax=C.xmax,Dtt.ymin=C.ymin,Dtt.ymax=C.ymax;var P=h.options.smoothness;if(h.getShell&&this.geometry.getHoles&&!P){var T=C.ymin,S=C.ymax,I=Math.abs(C.xmax-C.xmin),E=Math.abs(S-T),O=Math.sqrt(I*I+E*E),k=(O-I)/2,L=(O-E)/2;if(Dtt.xmin=C.xmin-k,Dtt.xmax=C.xmax+k,Dtt.ymin=C.ymin-L,Dtt.ymax=C.ymax+L,Array.isArray(e[0])){w=[];for(o=0;o<e.length;o++){var F=J7(e[o],Dtt);F.length&&w.push(F)}}else w=J7(e,Dtt)}else if("LineString"===h.getJSONType()&&!P){if(Array.isArray(e[0])){w=[];for(o=0;o<e.length;o++)E5(w,X7(e[o],Dtt,!1,!!P))}else w=X7(e,Dtt,!1,!!P);return this._interpolateSegAlt(w,e,n)}return{points:w,altitude:n}},n.prototype._interpolateSegAlt=function(e,n,i){if(!Array.isArray(i)){var o=function(e){return e.point};return{points:e.map((function(e){return Array.isArray(e)?e.map(o):e.point})),altitude:i}}var s=Btt(e,n,i);i=[];var a=s.map((function(e){if(Array.isArray(e)){var n=[],o=e.map((function(e){return n.push(e.altitude),e.point}));return i.push(n),o}return i.push(e.altitude),e.point}));return{points:a,altitude:i}},n.prototype.getSymbol=function(){return this.geometry._getInternalSymbol()},n.prototype._resetSymbolizersBBOX=function(){for(var e=this.symbolizers.length-1;e>=0;e--){x8(this.symbolizers[e].bbox)}return this},n.prototype.paint=function(e,n,i){var o;if(this.symbolizers){var s=this.getLayer(),a=s._getRenderer();if(a&&(a.context||n)){var h=a.mapStateCache||{offset:void 0};if(this.geometry._isCheck||!e||e.intersects(this.get2DExtent(a.resources,Ott))){var l=this.getMap();if(!this._aboveCamera()){this.containerOffset=i||h.offset||l._pointToContainerPoint(a.middleWest)._add(0,-l.height/2),this._beforePaint();var c=n||a.context;c.isHitTesting||this._resetSymbolizersBBOX();for(var A=[c,a.resources],f=this.symbolizers.length-1;f>=0;f--)(c.shadowBlur||this.symbolizers[f].symbol.shadowBlur)&&this._prepareShadow(c,this.symbolizers[f].symbol),(o=this.symbolizers[f]).symbolize.apply(o,v5([],y5(A),!1));this._afterPaint(),this._painted=!0,(this.geometry.options.debug||s.options.debug)&&this._debugSymbolizer.symbolize(c)}}}}},n.prototype.getSprite=function(e,n){var i;if(!this.geometry.isPoint)return null;if(this._spriting=!0,!this._sprite&&this.symbolizers.length>0){var o=new v9;this.symbolizers.forEach((function(n){var i=n.getFixedExtent(e);o._combine(i)}));var s=o.getMin().multi(-1),a=n||(this.getMap()?this.getMap().CanvasClass:null),h=u6.createCanvas(o.getWidth(),o.getHeight(),a),l=void 0;this._renderPoints&&(l=this._renderPoints);for(var c=h.getContext("2d"),A=[c,e],f=this.symbolizers.length-1;f>=0;f--){var d=this.symbolizers[f].getDxDy();this._renderPoints={center:[[s.add(d)]]},this._prepareShadow(c,this.symbolizers[f].symbol),(i=this.symbolizers[f]).symbolize.apply(i,v5([],y5(A),!1))}l&&(this._renderPoints=l),this._sprite={canvas:h,offset:o.getCenter()}}return this._spriting=!1,this._sprite},n.prototype.isSpriting=function(){return!!this._spriting},n.prototype.hitTest=function(e,n){if((!n||n<.5)&&(n=.5),this._hitPoint=e.sub(n,n),!vtt){var i=this.getMap()?this.getMap().CanvasClass:null;vtt=u6.createCanvas(1,1,i)}u6.setHitTesting(!0),vtt.width=vtt.height=2*n;var o=u6.getCanvas2DContext(vtt);o.isHitTesting=!0;try{this.paint(null,o,this._hitPoint)}finally{u6.setHitTesting(!1)}delete this._hitPoint;for(var s=o.getImageData(0,0,vtt.width,vtt.height).data,a=3,h=s.length;a<h;a+=4)if(s[a]>0)return!0;return!1},n.prototype.isHitTesting=function(){return!!this._hitPoint},n.prototype._prepareShadow=function(e,n){n.shadowBlur?(e.shadowBlur=this.isHitTesting()?0:n.shadowBlur,e.shadowColor=n.shadowColor||"#000",e.shadowOffsetX=n.shadowOffsetX||0,e.shadowOffsetY=n.shadowOffsetY||0):e.shadowBlur&&(e.shadowBlur=null,e.shadowColor=null,e.shadowOffsetX=null,e.shadowOffsetY=null)},n.prototype._eachSymbolizer=function(e,n){if(this.symbolizers){n||(n=this);for(var i=this.symbolizers.length-1;i>=0;i--)e.apply(n,[this.symbolizers[i]])}},n.prototype.get2DExtent=function(e,n){this._verifyProjection();var i=this.getMap();e=e||this.getLayer()._getRenderer().resources;var o=i.getZoom(),s=this._isDynamicSize();if(this._extent2D&&this._extent2D._zoom===o&&this._fixedExtent||(this._extent2D&&this._extent2D._zoom!==o&&delete this._extent2D,this.symbolizers&&(this._extent2D||(this._extent2D=this._computeExtent2D(new v9),this._extent2D._zoom=o),this._fixedExtent||(this._fixedExtent=this._computeFixedExtent(e,new v9)))),!this._extent2D)return s&&delete this._fixedExtent,null;var a=this._fixedExtent,h=a.xmin,l=a.ymin,c=a.xmax,A=a.ymax;return s&&delete this._fixedExtent,Rtt.set(h,-A,c,-l),n?(n.set(this._extent2D.xmin,this._extent2D.ymin,this._extent2D.xmax,this._extent2D.ymax),n._add(Rtt),n):this._extent2D.add(Rtt)},n.prototype._computeExtent2D=function(e){for(var n=this.symbolizers.length-1;n>=0;n--){e._combine(this.symbolizers[n].get2DExtent())}return e},n.prototype._computeFixedExtent=function(e,n){for(var i=this.symbolizers.length-1;i>=0;i--){var o=this.symbolizers[i];o.getFixedExtent&&n._combine(o.getFixedExtent(e))}return n},n.prototype._isDynamicSize=function(){for(var e=this.symbolizers.length-1;e>=0;e--){if(this.symbolizers[e].isDynamicSize())return!0}return!1},n.prototype._aboveCamera=function(){var e=this.getMinAltitude(),n=this.getMap(),i=n.getGLRes();e=n.altitudeToPoint(e,i)*k5(e);var o=n.getFrustumAltitude();return e&&o&&o<e},n.prototype.getFixedExtent=function(){var e=this.getMap().getZoom();return this._isDynamicSize()?this._computeFixedExtent(null,new v9):(this._extent2D&&this._extent2D._zoom===e||this.get2DExtent(null,Rtt),this._fixedExtent)},n.prototype.setZIndex=function(e){this._eachSymbolizer((function(n){n.setZIndex(e)}))},n.prototype.show=function(){this._painted?(this.removeCache(),this._eachSymbolizer((function(e){e.show()}))):this.getLayer().isCanvasRender()||this.paint()},n.prototype.hide=function(){this._eachSymbolizer((function(e){e.hide()}))},n.prototype.repaint=function(){this._altAtGL=this._getGeometryAltitude(),this.removeCache();var e=this.getLayer();if(e){var n=e.getRenderer();n&&n.setToRedraw()&&n.setToRedraw()}},n.prototype.refreshSymbol=function(){this.removeCache(),this._removeSymbolizers(),this.symbolizers=this._createSymbolizers()},n.prototype.remove=function(){this.removeCache(),this._removeSymbolizers()},n.prototype._removeSymbolizers=function(){this._eachSymbolizer((function(e){delete e.painter,e.remove()})),delete this.symbolizers},n.prototype.removeCache=function(){delete this._renderPoints,delete this._paintParams,delete this._sprite,delete this._extent2D,delete this._fixedExtent,delete this._cachedParams,delete this._unsimpledParams},n.prototype.getAltitude=function(){return this.geometry._getAltitude()!==this._propAlt&&(this._altAtGL=this._getGeometryAltitude()),this._altAtGL?this._altAtGL:0},n.prototype.getMinAltitude=function(){return this.minAltitude?this.minAltitude:0},n.prototype.getMaxAltitude=function(){return this.maxAltitude?this.maxAltitude:0},n.prototype._getGeometryAltitude=function(){if(!this.getMap())return 0;var e=this.geometry._getAltitude();this._propAlt=e;var n=y5(ett(e),2),i=n[1];return this.minAltitude=n[0],this.maxAltitude=i,e&&this.geometry.getCenter()?e:0},n.prototype._verifyProjection=function(){var e=this.geometry._getProjection()||Ftt;this._projCode&&this._projCode!==e.code&&this.removeCache(),this._projCode=e.code},n.prototype._beforePaint=function(){},n.prototype._afterPaint=function(){},n}(v6);function Btt(e,n,i){if(!Array.isArray(i))return e;for(var o=[],s=0,a=e.length;s<a;s++)if(Array.isArray(e[s]))o.push(Btt(e[s],n,i));else{var h=e[s];if(h.point.equals(n[h.index]))h.altitude=i[h.index],o.push(h);else{var l=void 0,c=void 0;0===h.index?(l=h.index,c=h.index+1):(l=h.index-1,c=h.index);var A=h.point.distanceTo(n[c]),f=A/(A+n[l].distanceTo(h.point)),d=L5(i[l],i[c],1-f);h.altitude=d,o.push(h)}}return o}var Htt=new v9,jtt=function(e){function n(n,i){var o=e.call(this)||this;return o.geometry=n,o.isMask=i,o.bbox=v8(),o._drawTime=0,o}return p5(n,e),n.prototype._setDrawTime=function(e){return this._drawTime=e,this._eachPainter((function(n){n._setDrawTime(e)})),this},n.prototype.getRenderBBOX=function(){var e=this,n=this.getLayer();return n&&n._drawTime!==this._drawTime?null:(x8(this.bbox),this._eachPainter((function(n){var i=n.getRenderBBOX();C8(i)&&w8(e.bbox,i)})),C8(this.bbox)?this.bbox:null)},n.prototype._eachPainter=function(e){for(var n,i=this.geometry.getGeometries(),o=0,s=i.length;o<s&&(!(n=this.isMask?i[o]._getMaskPainter():i[o]._getPainter())||!n||!1!==e.call(this,n));o++);},n.prototype.getLayer=function(){return this.geometry&&this.geometry.getLayer()},n.prototype.paint=function(e){this.geometry&&this._eachPainter((function(n){n.paint(e)}))},n.prototype.get2DExtent=function(e,n){n&&n.set(null,null,null,null);var i=n||new v9;return this._eachPainter((function(n){i=i._combine(n.get2DExtent(e,Htt))})),i},n.prototype.remove=function(){this._eachPainter((function(e){e.remove()}))},n.prototype.setZIndex=function(e){this._eachPainter((function(n){n.setZIndex(e)}))},n.prototype.show=function(){this._eachPainter((function(e){e.show()}))},n.prototype.hide=function(){this._eachPainter((function(e){e.hide()}))},n.prototype.repaint=function(){this._eachPainter((function(e){e.repaint()}))},n.prototype.refreshSymbol=function(){this._eachPainter((function(e){e.refreshSymbol()}))},n.prototype.hasPoint=function(){var e=!1;return this._eachPainter((function(n){return!n.hasPoint()||(e=!0,!1)})),e},n.prototype.getMinAltitude=function(){var e=!0,n=0;return this._eachPainter((function(i){var o=i.getMinAltitude();(e||o<n)&&(e=!1,n=o)})),n},n.prototype.getMaxAltitude=function(){var e=0;return this._eachPainter((function(n){var i=n.getMaxAltitude();i>e&&(e=i)})),e},n}(v6);function Utt(e,n){return void 0===n&&(n=[]),n.forEach((function(n){var i=y5(n,2);e=e.replace(i[0],i[1])})),e}function Gtt(e){var n=e.projection,i=e.isArcgis,o=e.isGeoServer,s=e.isSuperMap,a=.0002645833333333333;return(i||o||s)&&(a=28e-5),n&&n.indexOf("4326")>-1&&(a=2.3767925226029154e-9,(i||s)&&(a=2.518101729011901e-9),o&&(a=2.51528279553466e-9)),a}var Vtt="wmts";function Wtt(e,n){var i=e.getElementsByTagName(n);return i&&i.length?i:e.getElementsByTagName(Vtt+":"+n)}function qtt(e,n){for(var i=0;i<e.length;i++){var o=e[i];if((o=o.getElementsByTagName("ows:Identifier")[0])&&o.textContent===n)return e[i]}return null}function Ztt(e,n){void 0===n&&(n={});var i,o,s,a=Wtt(e,"TileMatrix"),h=[],l=[],c=[],A=!1;if(!i){var f=e.getElementsByTagName("ows:SupportedCRS")[0];f&&(i=function(e){for(var n="",i=e.split(""),o=i.length-1;o>=0&&!isNaN(i[o]);o--)n=i[o]+n;return n}(i=(i=f.textContent).split("EPSG")[1]),i=function(e){var n=e.indexOf("EPSG")>-1?e:"EPSG:"+e;return Utt(n,[["4490","4326"],["102100","3857"],["900913","3857"]])}(i))}o||(o=e.getElementsByTagName("ows:Identifier")[0])&&(o=o.textContent),n.projection=i;for(var d=1/0,p=0;p<a.length;p++){var g=a[p],v=g.getElementsByTagName("ows:Identifier")[0].textContent;isNaN(parseInt(v))?(s=v.substr(0,v.lastIndexOf(":")),v=(v=v.split(":"))[v.length-1],v=parseInt(v),A=!0,n.isGeoServer=!0):v=parseInt(v),d=Math.min(d,v);var w=Wtt(g,"ScaleDenominator")[0].textContent,C=Wtt(g,"TopLeftCorner")[0].textContent,P=Wtt(g,"TileWidth")[0].textContent,T=Wtt(g,"TileHeight")[0].textContent;if(0===c.length&&c.push(parseInt(P),parseInt(T)),0===l.length){var S=y5(C.split(" ").filter((function(e){return""!==e})).map((function(e){return parseFloat(e)})),2),I=S[0],E=S[1];I>0?l.push(1,-1,E,I):l.push(1,-1,I,E)}var O=Gtt(n),k=parseFloat(w)*O;h.push(k)}if(d>0){k=h[0];for(var L=d-1;L>=0;L--)h.splice(0,0,k*=2)}return{resolutions:h,tileSize:c,tileSystem:l,projection:i,TileMatrixSet:o,isGeoServer:A,levelStr:s}}var Qtt=function(e,n,i){void 0===i&&(i={jsonp:!0}),E2(e)&&$3.get(e,(function(o,s){if(o)n(o);else{var a=function(e,n,i){["isArcgis","isSuperMap","isGeoServer"].every((function(e){return null==i[e]}))&&console.warn("Please specify the server type, such as isArcgis, isSuperMap, isGeoServer, Otherwise, the system will determine by itself"),null==i.isArcgis&&(i.isArcgis=["arcgis","geoscene"].some((function(n){return e.indexOf(n)>-1}))),null==i.isSuperMap&&(i.isSuperMap=e.indexOf("supermap")>-1);var o=(new DOMParser).parseFromString(e,"text/xml").querySelectorAll("Contents")[0];if(!o)return[];var s=Wtt(o,"Layer");if(!s.length)return[];for(var a=[],h=0,l=o.childNodes.length;h<l;h++)"TileMatrixSet"===o.childNodes[h].localName&&a.push(o.childNodes[h]);if(!a.length)return[];var c=[];for(h=0,l=s.length;h<l;h++){var A=s[h],f=A.querySelectorAll("Style")[0];f&&(f=f.getElementsByTagName("ows:Identifier")[0])&&(f=f.textContent);var d=A.getElementsByTagName("ows:Identifier")[0];d&&(d=d.textContent);var p=Wtt(A,"TileMatrixSetLink");if(0!==p.length)for(var g=0,v=p.length;g<v;g++){var w=p[g];(w=Wtt(w,"TileMatrixSet")[0])&&(w=w.textContent);var C=qtt(a,w);if(C){var P=A.querySelectorAll("ResourceURL")[0],T="";P&&(T=P.attributes.template.value);var S=Ztt(C,i),I=S.resolutions,E=S.tileSize,O=S.tileSystem,k=S.projection,L=S.TileMatrixSet,F=S.isGeoServer,N=S.levelStr;T.length||(T=n.substr(0,n.lastIndexOf("?")),T+="?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER={LAYER}&STYLE={Style}&TILEMATRIXSET={TileMatrixSet}&FORMAT={tiles}&TILEMATRIX={TileMatrix}&TILEROW={TileRow}&TILECOL={TileCol}");var z=Utt(T,[["{LAYER}",d],["{Layer}",d],["{layer}",d],["{STYLE}",f],["{Style}",f],["{style}",f],["{TileMatrixSet}",L],["{TileMatrix}",F?"".concat(N,":{z}"):"{z}"],["{TileRow}","{y}"],["{TileCol}","{x}"],["{tiles}",F?"image/png":"tiles"]]);c.push({tileSize:E,tileSystem:O,spatialReference:{resolutions:I,projection:k},urlTemplate:z,info:{layerName:d,TileMatrixSet:L,style:f,tileSize:E,tileSystem:O,resolutions:I,projection:k,urlTemplate:z}})}}}return c}(s,e,i);n(null,a)}}),i)};function Xtt(e){for(var n=e.tileInfo,i=[n.cols,n.rows],o=[],s=n.lods,a=0,h=s.length;a<h;a++)o.push(s[a].resolution);var l=e.fullExtent,c=n.origin,A=[1,-1,c.x,c.y];return delete l.spatialReference,{spatialReference:{resolutions:o,fullExtent:l},tileSystem:A,tileSize:i}}var Ytt=23,Jtt={"EPSG:3857":{projection:"EPSG:3857",resolutions:function(){for(var e=[],n=12756274*Math.PI,i=0;i<Ytt;i++)e[i]=n/(256*Math.pow(2,i));return e}(),fullExtent:{top:6378137*Math.PI,left:-6378137*Math.PI,bottom:-6378137*Math.PI,right:6378137*Math.PI}},"EPSG:4326":{projection:"EPSG:4326",fullExtent:{top:90,left:-180,bottom:-90,right:180},resolutions:function(){for(var e=[],n=0;n<Ytt;n++)e[n]=180/(128*Math.pow(2,n));return e}()},BAIDU:{projection:"baidu",resolutions:function(){for(var e=Math.pow(2,18),n=[],i=0;i<Ytt;i++)n[i]=e,e*=.5;return n}(),fullExtent:{top:33554432,left:-33554432,bottom:-33554432,right:33554432}},IDENTITY:{projection:"identity",resolutions:function(){for(var e=Math.pow(2,8),n=[],i=0;i<Ytt;i++)n[i]=e,e*=.5;return n}(),fullExtent:{top:2e5,left:-2e5,bottom:-2e5,right:2e5}},"PRESET-VT-3857":{projection:"EPSG:3857",resolutions:function(){for(var e=[],n=6378137*Math.PI,i=0;i<Ytt;i++)e[i]=n/(256*Math.pow(2,i));return e}(),fullExtent:{top:6378137*Math.PI,left:-6378137*Math.PI,bottom:-6378137*Math.PI,right:6378137*Math.PI}},"PRESET-VT-4326":{projection:"EPSG:4326",fullExtent:{top:90,left:-180,bottom:-90,right:180},resolutions:function(){for(var e=[],n=0;n<Ytt;n++)e[n]=45/(128*Math.pow(2,n));return e}()}};Jtt["EPSG:4490"]=Jtt["EPSG:4326"],Jtt["PRESET-3857-512"]=Jtt["PRESET-VT-3857"],Jtt["PRESET-4326-512"]=Jtt["PRESET-VT-4326"],Jtt["PRESET-4490-512"]=Jtt["PRESET-VT-4326"];var Ktt=function(){function e(e){void 0===e&&(e={}),this.options=e,this._initSpatialRef()}return e.registerPreset=function(e,n){e=e&&e.toUpperCase(),Jtt[e]&&console.warn("Spatial reference ".concat(e," already registered.")),Jtt[e]=n},e.getPreset=function(e){return Jtt[e.toUpperCase()]},e.getAllPresets=function(){return Object.keys(Jtt)},e.loadArcgis=function(e,n,i){return function(e,n,i){if(void 0===i&&(i={jsonp:!0}),E2(e)&&"{"!==e.substring(0,1))$3.getJSON(e,(function(e,i){if(e)n(e);else{var o=Xtt(i);n(null,o)}}),i);else{E2(e)&&(e=I5(e));var o=Xtt(e);n(null,o)}}(e,n,i),this},e.loadWMTS=function(e,n,i){return Qtt(e,n,i),this},e.getProjectionInstance=function(e){var n;if(!e)return null;if((n=E2(e)?{code:e}:e).project)return n.locate||(n=P2({},n),P2(n,k9("identity"===n.measure?"IDENTITY":"EPSG:4326"))),n;var i=(n.code+"").toLowerCase();for(var o in l7)if(D2(l7,o)){var s=l7[o].aliases||[],a=l7[o].code;a&&s.push(a);for(var h=0;h<s.length;h++){var l;if(s[h].toLowerCase()===i)return l7[o].create?((l=l7[o].create(e)).code=s[h],l):l7[o].code===s[h]?l7[o]:((l=P2({},l7[o])).code=s[h],l)}}return null},e.equals=function(e,n){if(E2(e)||E2(n))return e===n;if(!e&&!n)return!0;if(!e||!n)return!1;if(e.projection!==n.projection)return!1;var i=e.fullExtent,o=n.fullExtent;if(i&&!o||!i&&o)return!1;if(i&&o&&(i.top!==o.top||i.bottom!==o.bottom||i.left!==o.left||i.right!==o.right))return!1;var s=e.resolutions,a=n.resolutions;if(s&&a){if(s.length!==a.length)return!1;for(var h=0;h<s.length;h++)if(s[h]!==a[h])return!1}else if(s||a)return!1;return!0},e.prototype._initSpatialRef=function(){var n;if(!(n=this.options.projection?e.getProjectionInstance(this.options.projection):h7))throw new Error("must provide a valid projection in map's spatial reference.");(n=P2({},x9,n)).measureLength||P2(n,O9),this._projection=n;var i,o=this.options.resolutions;if(!o&&(n.code&&(i=Jtt[n.code.toUpperCase()])&&(o=i.resolutions,this.isEPSG="IDENTITY"!==n.code),!o))throw new Error("must provide valid resolutions in map's spatial reference.");if(this._resolutions=o,this._pyramid=!0,this._pyramid)for(var s=0;s<o.length;s++)if(o[s]&&o[s-1]&&Math.round(o[s-1]/o[s]*1e4)/1e4!=2){this._pyramid=!1;break}var a=this.options.fullExtent;if(!a&&(n.code&&(i=Jtt[n.code.toUpperCase()])&&(a=i.fullExtent),!a))throw new Error("must provide a valid fullExtent in map's spatial reference.");if(M2(a.left)?(this._fullExtent=new y9(a),a.left=a.xmin,a.right=a.xmax,a.top=a.ymax,a.bottom=a.ymin):this._fullExtent=new y9(new o9(a.left,a.top),new o9(a.right,a.bottom)),M2(a.top)||M2(a.bottom)||M2(a.left)||M2(a.right))throw new Error("must provide valid top/bottom/left/right in fullExtent.");P2(this._fullExtent,a),this._projection.fullExtent=a,this._transformation=new _9([a.right>=a.left?1:-1,a.top>=a.bottom?-1:1,0,0])},e.prototype.getResolutions=function(){return this._resolutions||[]},e.prototype.getResolution=function(e){var n=0|e;n<0?n=0:n>this._resolutions.length-1&&(n=this._resolutions.length-1);var i=this._resolutions[n];return n!==e&&e>0&&n<this._resolutions.length-1?i+(this._resolutions[n+1]-i)*(e-n):i},e.prototype.getProjection=function(){return this._projection},e.prototype.getFullExtent=function(){return this._fullExtent},e.prototype.getTransformation=function(){return this._transformation},e.prototype.getMinZoom=function(){for(var e=0;e<this._resolutions.length;e++)if(!M2(this._resolutions[e]))return e;return 0},e.prototype.getMaxZoom=function(){for(var e=this._resolutions.length-1;e>=0;e--)if(!M2(this._resolutions[e]))return e;return this._resolutions.length-1},e.prototype.getZoomDirection=function(){return k5(this._resolutions[this.getMinZoom()]-this._resolutions[this.getMaxZoom()])},e.prototype.toJSON=function(){return this.json||(this.json={resolutions:this._resolutions,fullExtent:{top:this._fullExtent.top,left:this._fullExtent.left,bottom:this._fullExtent.bottom,right:this._fullExtent.right},projection:this._projection.code}),this.json},e.prototype.isPyramid=function(){return this._pyramid},e}(),$tt=new w5(0,0),tet=new v9,eet={};var net=function(e){function n(n){var i=this,o=P2({},n),s=o.symbol,a=o.properties,h=o.id;return delete o.symbol,delete o.id,delete o.properties,i=e.call(this,o)||this,s?i.setSymbol(s):i._genSizeSymbol(),a&&i.setProperties(a),M2(h)||i.setId(h),n&&T2(n.rotateAngle)&&(i._dirtyRotate=!0),i}return p5(n,e),n.fromJSON=function(e){return e},n.prototype.getFirstCoordinate=function(){if("GeometryCollection"===this.type){var e=this.getGeometries();return e.length?e[0].getFirstCoordinate():null}var n=this.getCoordinates();if(!Array.isArray(n))return n;do{n=n[0]}while(Array.isArray(n)&&n.length>0);return n},n.prototype.getLastCoordinate=function(){if("GeometryCollection"===this.type){var e=this.getGeometries();return e.length?e[e.length-1].getLastCoordinate():null}var n=this.getCoordinates();if(!Array.isArray(n))return n;do{n=n[n.length-1]}while(Array.isArray(n)&&n.length>0);return n},n.prototype.addTo=function(e,n){return e.addGeometry(this,n),this},n.prototype.getLayer=function(){return this._layer?this._layer:null},n.prototype.getMap=function(){return this._layer?this._layer.getMap():null},n.prototype.getId=function(){return this._id},n.prototype.setId=function(e){var n=this.getId();return this._id=e,this._fireEvent("idchange",{old:n,new:e}),this},n.prototype.getProperties=function(){return this.properties?this.properties:this._getParent()?this._getParent().getProperties():null},n.prototype.setProperties=function(e){var n=this.properties;return this.properties=I2(e)?P2({},e):e,this._clearAltitudeCache(),this._repaint(),this._fireEvent("propertieschange",{old:n,new:e}),this},n.prototype.getType=function(){return this.type},n.prototype.getSymbol=function(){var e=this._symbol;return e?Array.isArray(e)?J4(e):P2({},e):null},n.prototype.setSymbol=function(e){return this._symbolUpdated=e,this._symbol=this._prepareSymbol(e),this.onSymbolChanged(),delete this._compiledSymbol,delete this._symbolHash,this},n.prototype.getSymbolHash=function(){return this._symbolHash||(this._symbolHash=X4(this._symbolUpdated)),this._symbolHash},n.prototype.updateSymbol=function(e){if(!e)return this;var n=this._getSymbol();if(Array.isArray(n)){if(!Array.isArray(e))throw new Error("Parameter of updateSymbol is not an array.");for(var i=0;i<e.length;i++)j7(e[i])&&delete this._textDesc,n[i]&&e[i]&&(n[i]=J4(n[i],e[i]))}else{if(Array.isArray(e))throw new Error("Geometry's symbol is not an array to update.");j7(n)&&delete this._textDesc,n=J4(n||this._getInternalSymbol(),e)}return this._eventSymbolProperties=e,delete this._compiledSymbol,this.setSymbol(n)},n.prototype.getTextContent=function(){var e=this._getInternalSymbol();if(Array.isArray(e)){for(var n=[],i=!1,o=0;o<e.length;o++)n[o]=v3(e[o]&&e[o].textName,this.getProperties()),M2(n[o])||(i=!0);return i?n:null}return v3(e&&e.textName,this.getProperties())},n.prototype.getTextDesc=function(){if(!this._textDesc){var e=this.getTextContent(),n=this._sizeSymbol,i=Array.isArray(e);this._textDesc=Array.isArray(n)?n.map((function(n,o){return _3(i?e[o]:"",n)})):_3(e,n)}return this._textDesc},n.prototype.getCenter=function(){return this._computeCenter(this._getMeasurer())},n.prototype.getExtent=function(){var e=this._getPrjExtent(),n=this._getProjection();if(e&&n){var i=n.unproject(new o9(e.xmin,e.ymin)),o=n.unproject(new o9(e.xmax,e.ymax));return new y9(i,o,n)}return this._computeExtent(this._getMeasurer())},n.prototype.getContainerExtent=function(e){var n=this.get2DExtent();if(!n||!n.isValid())return null;var i=this.getMap(),o=i.getGLRes(),s=this.getMinAltitude(),a=n.convertTo((function(e){return i._pointAtResToContainerPoint(e,o,s,$tt)}),e),h=this.getMaxAltitude();if(h!==s){var l=n.convertTo((function(e){return i._pointAtResToContainerPoint(e,o,h,$tt)}),tet);a._combine(l)}var c=this.getLayer();if(c&&"LineString"===this.type&&h&&c.options.drawAltitude){var A=n.convertTo((function(e){return i._pointAtResToContainerPoint(e,o,0,$tt)}),tet);a._combine(A)}if(a){var f=this._getFixedExtent();(function(e){return!!e&&e.xmax-e.xmin>0&&e.ymax-e.ymin>0})(f)&&a._add(f)}return this.options.smoothness&&a._expand(.15*a.getWidth()),a},n.prototype._getFixedExtent=function(){this._fixedExtent||(this._fixedExtent=new v9);var e=this._sizeSymbol,n=(e&&e.lineWidth||1)/2;return this._fixedExtent.set(-n,-n,n,n),this._fixedExtent._add([e&&e.lineDx||0,0]),this._fixedExtent._add([0,e&&e.lineDy||0]),this._fixedExtent},n.prototype.get2DExtent=function(){var e=this.getMap();if(!e)return null;if(this._extent2d)return this._extent2d;var n=this._getPrjExtent();if(!n||!n.isValid())return null;var i=n.getMin(),o=n.getMax(),s=e.getGLRes();return e._prjToPointAtRes(i,s,i),e._prjToPointAtRes(o,s,o),this._extent2d=new v9(i,o),this._extent2d.z=e.getZoom(),this._extent2d},n.prototype.getSize=function(){var e=this.getContainerExtent();return e?e.getSize():null},n.prototype.containsPoint=function(e,n){if(!this.getMap())throw new Error('The geometry is required to be added on a map to perform "containsPoint".');return e instanceof o9&&(e=this.getMap().coordToContainerPoint(e)),this._containsPoint(e,n)},n.prototype._containsPoint=function(e,n){var i=this._getPainter();return!!i&&(n=n||0,this._hitTestTolerance&&(n+=this._hitTestTolerance()),i.hitTest(e,n))},n.prototype.show=function(){if(this.options.visible=!0,this.getMap()){var e=this._getPainter();e&&e.show(),this._fireEvent("show")}return this},n.prototype.hide=function(){if(this.options.visible=!1,this.getMap()){this.onHide();var e=this._getPainter();e&&e.hide(),this._fireEvent("hide")}return this},n.prototype.isVisible=function(){if(!this.options.visible)return!1;var e=this._getInternalSymbol();if(!e)return!0;if(!this.symbolIsVisible())return!1;if(Array.isArray(e)){if(!e.length)return!0;for(var n=0,i=e.length;n<i;n++)if(M2(e[n].opacity)||e[n].opacity>0)return!0;return!1}return M2(e.opacity)||I2(e.opacity)||T2(e.opacity)&&e.opacity>0},n.prototype.symbolIsVisible=function(){var e=this._getCompiledSymbol();if(!e)return!0;Array.isArray(e)||(e=[e]);for(var n=0,i=e.length;n<i;n++){var o=e[n];if(o){var s=o.visible;if(!1!==s&&0!==s)return!0}}return!1},n.prototype.getZIndex=function(){return this.options.zIndex||0},n.prototype.setZIndex=function(e){var n=this.options.zIndex;return this.options.zIndex=e,this._fireEvent("zindexchange",{old:n,new:e}),this},n.prototype.setZIndexSilently=function(e){return this.options.zIndex=e,this},n.prototype.bringToFront=function(){var e=this.getLayer();if(!e||!e.getGeoMaxZIndex)return this;var n=e.getGeoMaxZIndex();return this.setZIndex(n+1),this},n.prototype.bringToBack=function(){var e=this.getLayer();if(!e||!e.getGeoMinZIndex)return this;var n=e.getGeoMinZIndex();return this.setZIndex(n-1),this},n.prototype.translate=function(e,n){if(M2(e))return this;var i=new o9(e,n);if(0===i.x&&0===i.y)return this;var o=this.getCoordinates();if(this._silence=!0,o)if(Array.isArray(o)){var s=R5(o,(function(e){return e.add(i)}));this.setCoordinates(s)}else this.setCoordinates(o.add(i));return this._silence=!1,this._fireEvent("positionchange"),this},n.prototype._translateRotatePivot=function(e){if(!this._pivot||!e)return this;if(this.options.rotatePivot){var n=this.getCoordinates();if(!n)return this;e instanceof o9||(e=new o9(e));var i=e.sub(n);if(0===i.x&&0===i.y)return this;this._pivot._add(i),this.options.rotatePivot=this._pivot.toArray()}return this},n.prototype.flash=function(e,n,i,o){return Q5.call(this,e,n,i,o)},n.prototype.copy=function(){var e=this.toJSON(),i=n.fromJSON(e);return i.options.visible=!0,i},n.prototype.remove=function(){return this.getLayer()?(this._fireEvent("removestart"),this._unbind(),this._fireEvent("removeend"),this._fireEvent("remove"),this):this},n.prototype.toGeoJSONGeometry=function(){return this._exportGeoJSONGeometry()},n.prototype.toGeoJSON=function(e){e||(e={});var n={type:"Feature",geometry:null};if(M2(e.geometry)||e.geometry){var i=this._exportGeoJSONGeometry();n.geometry=i}var o,s=this.getId();return M2(s)||(n.id=s),(M2(e.properties)||e.properties)&&(o=this._exportProperties()),n.properties=o,n},n.prototype.toJSON=function(e){e||(e={});var n=this._toJSON(e);return P2(n,this._exportGraphicOptions(e)),n},n.prototype.getLength=function(){return this._computeGeodesicLength(this._getMeasurer())},n.prototype.getArea=function(){return this._computeGeodesicArea(this._getMeasurer())},n.prototype.rotate=function(e,n){if(!T2(e))return console.error("angle:".concat(e," is not number")),this;if(this._painter||(this._dirtyRotate=!0),"GeometryCollection"===this.type)return this.getGeometries().forEach((function(i){return i.rotate(e,n)})),this;n=n?new o9(n):this.getCenter(),this._angle=e,this._pivot=n;var i=this._getMeasurer(),o=this.getCoordinates();if(!Array.isArray(o)){if(n.x===o.x&&n.y===o.y||this.getShell)this.onPositionChanged();else{var s=i._rotate(o,n,e);this.setCoordinates(s)}return this.getShell&&(this.options.rotateAngle=e,this.options.rotatePivot=n.toArray()),this}return R5(o,(function(o){return i._rotate(o,n,e)})),this.setCoordinates(o),this},n.prototype._rotatePrjCoordinates=function(e){if(!e||0===this._angle||!this._pivot)return e;var n=this._getProjection();if(!n)return e;var i,o,s=0,a=Array.isArray(e),h=a?e:[e],l=[];if(this.getRotateOffsetAngle){s=this.getRotateOffsetAngle();var c=h[h.length-1];i=c.x,o=c.y}else{var A=v8();b8(h,A);var f=y5(A,4);i=(f[0]+f[2])/2,o=(f[1]+f[3])/2}for(var d=0,p=h.length;d<p;d++){var g=(F=h[d]).x,v=F.y,w=g-i,C=v-o,P=Math.sqrt(w*w+C*C),T=(het(i,o,g,v)-this._angle+s)/180*Math.PI,S=Math.cos(T)*P,I=Math.sin(T)*P,E=new o9(i+S,o+I);l.push(E)}var O=n.project(this._pivot),k=i-O.x,L=o-O.y;for(d=0,p=l.length;d<p;d++){var F;(F=l[d]).x-=k,F.y-=L}return a?l:l[0]},n.prototype.isRotated=function(){return!(!T2(this._angle)||!this._pivot)},n.prototype._getConnectPoints=function(){return[this.getCenter()]},n.prototype._initOptions=function(e){var n=P2({},e),i=n.symbol,o=n.properties,s=n.id;delete n.symbol,delete n.id,delete n.properties,this.setOptions(n),i&&this.setSymbol(i),o&&this.setProperties(o),M2(s)||this.setId(s)},n.prototype._bindLayer=function(e){if(e!==this.getLayer()){if(this.getLayer())throw new Error("Geometry cannot be added to two or more layers at the same time.");this._layer=e,this._clearCache(),this._bindInfoWindow(),this._bindMenu()}},n.prototype._prepareSymbol=function(e){if(Array.isArray(e)){for(var n=[],i=0;i<e.length;i++)n.push(W4(this._checkAndCopySymbol(e[i])));return n}return e?W4(e=this._checkAndCopySymbol(e)):null},n.prototype._checkAndCopySymbol=function(e){var n={};for(var i in e)n[i]=o3[i]&&E2(e[i])?+e[i]:e[i];return n},n.prototype._getSymbol=function(){return this._symbol},n.prototype._setExternSymbol=function(e){return this._eventSymbolProperties=e,this._symbol||delete this._textDesc,this._externSymbol=this._prepareSymbol(e),this.onSymbolChanged(),this},n.prototype._getInternalSymbol=function(){return this._symbol?this._symbol:this._externSymbol?this._externSymbol:this.options.symbol?this.options.symbol:null},n.prototype._getPrjExtent=function(){var e=this._getProjection();return this._verifyProjection(),!this._extent&&e&&(this._extent=this._computePrjExtent(e)),this._extent},n.prototype._unbind=function(){var e=this.getLayer();e&&(this._animPlayer&&this._animPlayer.finish(),this._unbindMenu(),this._unbindInfoWindow(),this.isEditing()&&this.endEdit(),this._removePainter(),this.onRemove&&this.onRemove(),e.onRemoveGeometry&&e.onRemoveGeometry(this),delete this._layer,delete this._internalId,delete this._extent)},n.prototype._getInternalId=function(){return this._internalId},n.prototype._setInternalId=function(e){this._internalId=e},n.prototype._getMeasurer=function(){return this._getProjection()?this._getProjection():Ktt.getProjectionInstance(this.options.defaultProjection)},n.prototype._getProjection=function(){var e=this.getMap();return e?e.getProjection():null},n.prototype._verifyProjection=function(){var e=this._getProjection();this._projCode&&e&&this._projCode!==e.code&&this._clearProjection(),this._projCode=e?e.code:this._projCode},n.prototype._getExternalResources=function(){return V4(this._getInternalSymbol())},n.prototype._getPainter=function(){if(this._painter)return this._painter;var e=this.getLayer();if(!this._painter&&e)if(-1!==e3.indexOf(this.type))e.constructor.getCollectionPainterClass&&(n=e.constructor.getCollectionPainterClass())&&(this._painter=new n(this));else if(e.constructor.getPainterClass){var n;(n=e.constructor.getPainterClass())&&(this._painter=new n(this))}return this._painter},n.prototype._getMaskPainter=function(){return this._maskPainter||(this._maskPainter=this.getGeometries&&this.getGeometries()?new jtt(this,!0):new ztt(this)),this._maskPainter},n.prototype._removePainter=function(){this._painter&&this._painter.remove(),delete this._painter},n.prototype._paint=function(e){if(this.symbolIsVisible()&&this._painter){if(this._dirtyCoords){delete this._dirtyCoords;var n=this._getProjection();n&&(this._pcenter=n.project(this._coordinates),this._clearCache())}this._dirtyRotate&&T2(this.options.rotateAngle)&&this.rotate(this.options.rotateAngle,this.options.rotatePivot),this._dirtyRotate=!1,this._painter.paint(e)}},n.prototype._clearCache=function(){delete this._extent,delete this._extent2d,this._clearAltitudeCache()},n.prototype._clearProjection=function(){delete this._extent,delete this._extent2d},n.prototype._repaint=function(){this._painter&&this._painter.repaint()},n.prototype.onHide=function(){this.closeMenu(),this.closeInfoWindow()},n.prototype.onShapeChanged=function(){this._clearCache(),this._repaint(),this._fireEvent("shapechange")},n.prototype.onPositionChanged=function(){this._clearCache(),this._repaint(),this._fireEvent("positionchange")},n.prototype.onSymbolChanged=function(){this._painter&&this._painter.refreshSymbol();var e={};this._eventSymbolProperties?(e.properties=JSON.parse(JSON.stringify(this._eventSymbolProperties)),delete this._eventSymbolProperties):delete this._textDesc,this._genSizeSymbol(),this._fireEvent("symbolchange",e)},n.prototype._genSizeSymbol=function(){var e=this._getInternalSymbol();if(e)if(Array.isArray(e)){this._sizeSymbol=[];for(var n=!1,i=0;i<e.length;i++){var o=this._sizeSymbol[i]=this._getSizeSymbol(e[i]);!n&&o&&o._dynamic&&(n=!0)}this._sizeSymbol._dynamic=n}else this._sizeSymbol=this._getSizeSymbol(e);else delete this._sizeSymbol},n.prototype._getSizeSymbol=function(e){var n=U4({lineWidth:e.lineWidth,lineDx:e.lineDx,lineDy:e.lineDy},this);return(_4(e.lineWidth)||_4(e.lineDx)||_4(e.lineDy))&&(n._dynamic=!0),n},n.prototype._getCompiledSymbol=function(){return this._compiledSymbol||(this._compiledSymbol=U4(this._getInternalSymbol(),this)),this._compiledSymbol},n.prototype.onConfig=function(e){var n;e.properties&&(n=e.properties,delete e.properties);var i=!1;for(var o in e)if(e.hasOwnProperty(o)){var s=o.slice(0,5);if("arrow"===s||"smoot"===s){i=!0;break}}n?(this.setProperties(n),this._repaint()):i&&this._repaint()},n.prototype._setParent=function(e){e&&(this._parent=e)},n.prototype._getParent=function(){return this._parent},n.prototype._fireEvent=function(e,n){this._silence||(this.getLayer()&&this.getLayer()._onGeometryEvent&&(n||(n={}),n.type=e,n.target=this,this.getLayer()._onGeometryEvent(n)),this.fire(e,n))},n.prototype._toJSON=function(e){return{feature:this.toGeoJSON(e)}},n.prototype._recordVisible=function(){var e=this.options.visible;M2(e)&&(e=!0),this._savedVisible=e},n.prototype._recoveryVisible=function(){delete this._savedVisible},n.prototype._exportGraphicOptions=function(e){var n={};return(M2(e.options)||e.options)&&(n.options=this.config()),n.options&&this.isEditing&&this.isEditing()&&(n.options.visible=this._savedVisible),(M2(e.symbol)||e.symbol)&&(n.symbol=this.getSymbol()),(M2(e.infoWindow)||e.infoWindow)&&this._infoWinOptions&&(n.infoWindow=this._infoWinOptions),n},n.prototype._exportGeoJSONGeometry=function(){var e=this.getCoordinates(),n=o9.toNumberArrays(e);return{type:this.getType(),coordinates:n}},n.prototype._exportProperties=function(){var e=null,n=this.getProperties();return M2(n)||(e=I2(n)?P2({},n):n),e},n.prototype._hitTestTolerance=function(){return 0},n.prototype._getAltitude=function(){var e=this.getLayer();if(!e)return 0;var n=e.options,i=e.getAltitude?e.getAltitude():0,o=n.enableAltitude;if(!o&&e.isVectorLayer)return i;var s=iet(e),a=(this.properties||eet)[s];if(M2(a)){var h=ret(this,i,o);return M2(h)?i:h}return Array.isArray(a)?a.map((function(e){return e+i})):a+i},n.prototype.getAltitude=function(){var e=iet(this.getLayer()),n=(this.properties||eet)[e];if(!M2(n))return n;var i=ret(this,0,!1);return M2(i)?0:i},n.prototype.hasAltitude=function(){return this._genMinMaxAlt(),!!this._minAlt||!!this._maxAlt},n.prototype.setAltitude=function(e){if(!T2(e))return this;var n=this.getLayer(),i=iet(n),o=this.properties||eet,s=o[i];if(!M2(s))if(Array.isArray(s))for(var a=0,h=s.length;a<h;a++)s[a]=e;else o[i]=e;var l=this.getCoordinates?this.getCoordinates():null;if(!l)return this;if(oet(l,e),n){var c=n.getRenderer();c&&c.gl?this.setCoordinates(l):c&&this._repaint()}return this._clearAltitudeCache(),this.onPositionChanged(),this},n.prototype._genMinMaxAlt=function(){if(void 0===this._minAlt||void 0===this._maxAlt){var e=y5(ett(this._getAltitude()),2),n=e[1];this._minAlt=e[0],this._maxAlt=n}},n.prototype.getMinAltitude=function(){return this._genMinMaxAlt(),this._minAlt},n.prototype.getMaxAltitude=function(){return this._genMinMaxAlt(),this._maxAlt},n.prototype._clearAltitudeCache=function(){return this._minAlt=void 0,this._maxAlt=void 0,this},n}(O6(m6(t9(v6))));function iet(e){var n="altitude";if(e){if(!e.isVectorLayer)return null;n=e.options.altitudeProperty}return n}function ret(e,n,i){var o=e.getCoordinates?e.getCoordinates():null;if(o){var s=[];if(set(o,s),s.length)return aet(o,n,i)}return null}function oet(e,n){if(Array.isArray(e))for(var i=0,o=e.length;i<o;i++)oet(e[i],n);else e.z=n}function set(e,n){if(!n.length)if(Array.isArray(e))for(var i=0,o=e.length;i<o;i++)set(e[i],n);else T2(e.z)&&n.push(e.z)}function aet(e,n,i){if(Array.isArray(e)){for(var o=[],s=0,a=e.length;s<a;s++)o.push(aet(e[s],n,i));return o}return T2(e.z)?i?n+e.z:e.z:i?n:0}function het(e,n,i,o){return e===i?o>n?-90:90:(i-=e,o=-(o-=n),Math.atan2(o,i)/Math.PI*180)}net.mergeOptions({id:null,visible:!0,interactive:!0,editable:!0,cursor:null,antiMeridian:!1,defaultProjection:"EPSG:4326"});var uet={attribution:null,minZoom:null,maxZoom:null,visible:!0,opacity:1,globalCompositeOperation:null,renderer:"canvas",debugOutline:"#0f0",cssFilter:null,forceRenderOnMoving:!1,forceRenderOnZooming:!1,forceRenderOnRotating:!1,collision:!1,collisionScope:"layer",hitDetect:!f5.mobile,maskClip:!0},cet=function(e){function n(n,i){var o,s=this;return i&&(o=i.canvas,delete i.canvas),(s=e.call(this,i)||this)._canvas=o,s.setId(n),i&&(s.setZIndex(i.zIndex),i.mask&&s.setMask(net.fromJSON(i.mask))),s.proxyOptions(),s}return p5(n,e),n.prototype.load=function(){if(!this.getMap())return this;if(this.onLoad()){this._initRenderer();var e=this.getZIndex();M2(e)||(this._renderer.setZIndex(e),this.isCanvasRender()||this._renderer.render()),this.onLoadEnd()}return this},n.prototype.getId=function(){return this._id},n.prototype.setId=function(e){var n=this._id;return M2(e)||(e+=""),this._id=e,this.fire("idchange",{type:"idchange",target:this,old:n,new:e}),this},n.prototype.addTo=function(e){return e.addLayer(this),this},n.prototype.setZIndex=function(e){return this._zIndex=e,M2(e)?delete this.options.zIndex:this.options.zIndex=e,this.map&&this.map._sortLayersByZIndex(),this._renderer&&this._renderer.setZIndex(e),this.fire("setzindex",{type:"setzindex",target:this,zIndex:e}),this},n.prototype.getZIndex=function(){return this._zIndex||0},n.prototype.getMinZoom=function(){var e=this.getMap(),n=this.options.minZoom;return e?Math.max(e.getMinZoom(),n||0):n},n.prototype.getMaxZoom=function(){var e=this.getMap(),n=this.options.maxZoom;return e?Math.min(e.getMaxZoom(),M2(n)?1/0:n):n},n.prototype.getOpacity=function(){return this.options.opacity},n.prototype.setOpacity=function(e){return this.config("opacity",e),this.fire("setopacity",{type:"setopacity",target:this,opacity:e}),this},n.prototype.isCanvasRender=function(){var e=this._getRenderer();return e&&e instanceof x7},n.prototype.getMap=function(){return this.map?this.map:null},n.prototype.getProjection=function(){var e=this.getMap();return e?e.getProjection():null},n.prototype.bringToFront=function(){var e=this._getLayerList();if(!e.length)return this;var n=e[e.length-1];if(1===e.length||n===this)return this;var i=n.getZIndex();return this.setZIndex(i+1),this},n.prototype.bringToBack=function(){var e=this._getLayerList();if(!e.length)return this;var n=e[0];if(1===e.length||n===this)return this;var i=n.getZIndex();return this.setZIndex(i-1),this},n.prototype.show=function(){var e=this;if(!this.options.visible){this.options.visible=!0;var n=this.getRenderer();n&&n.show();var i=this.getMap();n&&i?i.once("renderend",(function(){e.fire("show")})):this.fire("show")}return this},n.prototype.hide=function(){var e=this;if(this.options.visible){this.options.visible=!1;var n=this.getRenderer();n&&n.hide();var i=this.getMap();n&&i?i.once("renderend",(function(){e.fire("hide")})):this.fire("hide")}return this},n.prototype.isVisible=function(){if(T2(this.options.opacity)&&this.options.opacity<=0)return!1;var e=this.getMap();if(e){var n=e.getZoom();if(!M2(this.options.maxZoom)&&this.options.maxZoom<n||!M2(this.options.minZoom)&&this.options.minZoom>n)return!1}return M2(this.options.visible)&&(this.options.visible=!0),this.options.visible},n.prototype.remove=function(){if(this.map){var e=this.map.getRenderer();this.map.removeLayer(this),e&&e.setToRedraw()}else this.fire("remove");return this},n.prototype.getMask=function(){return this._mask},n.prototype.setMask=function(e){if(!("Point"===e.type&&e._isVectorMarker()||"Polygon"===e.type||"MultiPolygon"===e.type))throw new Error("Mask for a layer must be a marker with vector marker symbol or a Polygon(MultiPolygon).");if(e._bindLayer(this),"Point"===e.type?e.updateSymbol({markerLineColor:"rgba(0, 0, 0, 0)",markerFillOpacity:0}):e.setSymbol({lineColor:"rgba(0, 0, 0, 0)",polygonOpacity:0}),this._mask=e,e&&e.toGeoJSON)try{this._maskGeoJSON=e.toGeoJSON()}catch(e){delete this._maskGeoJSON,console.error(e)}if(this.options.mask=e.toJSON(),!this.getMap()||this.getMap().isZooming())return this;var n=this._getRenderer();return n&&n.setToRedraw&&this._getRenderer().setToRedraw(),this},n.prototype.removeMask=function(){if(delete this._mask,delete this._maskGeoJSON,delete this.options.mask,!this.getMap()||this.getMap().isZooming())return this;var e=this._getRenderer();return e&&e.setToRedraw&&this._getRenderer().setToRedraw(),this},n.prototype.onLoad=function(){return!0},n.prototype.onLoadEnd=function(){},n.prototype.isLoaded=function(){return!!this._loaded},n.prototype.getCollisionIndex=function(){if("layer"===this.options.collisionScope)return this._collisionIndex||(this._collisionIndex=new $6),this._collisionIndex;var e=this.getMap();return e?e.getCollisionIndex():null},n.prototype.clearCollisionIndex=function(){return"layer"===this.options.collisionScope&&this._collisionIndex&&this._collisionIndex.clear(),this},n.prototype.getRenderer=function(){return this._getRenderer()},n.prototype.onConfig=function(e){if(e&&Object.keys&&Object.keys(e).length>0&&M2(e.animation)){if(this._optionsHook&&O2(this._optionsHook)&&this._optionsHook(e),this._silentConfig)return;var n=this.getRenderer();n&&n.setToRedraw&&n.setToRedraw()}},n.prototype.onAdd=function(){},n.prototype.onRendererCreate=function(){},n.prototype.onCanvasCreate=function(){},n.prototype.onRemove=function(){},n.prototype._bindMap=function(e,n){e&&(this.map=e,M2(n)||this.setZIndex(n),this._switchEvents("on",this),this.onAdd(),this.fire("add"))},n.prototype._initRenderer=function(){var e=this.options.renderer;if(this.constructor.getRendererClass){var n=this.constructor.getRendererClass(e);if(!n)throw new Error("Invalid renderer for Layer("+this.getId()+"):"+e);this._renderer=new n(this),this._renderer.layer=this,this._renderer.setZIndex(this.getZIndex()),this._switchEvents("on",this._renderer),this._renderer.onAdd&&this._renderer.onAdd(),this.onRendererCreate(),this.fire("renderercreate",{type:"renderercreate",target:this,renderer:this._renderer})}},n.prototype._doRemove=function(){this._loaded=!1,this._switchEvents("off",this),this.onRemove(),this._renderer&&(this._switchEvents("off",this._renderer),this._renderer.remove(),delete this._renderer),delete this.map,delete this._collisionIndex},n.prototype._switchEvents=function(e,n){n&&n.getEvents&&this.getMap()&&this.getMap()[e](n.getEvents(),n)},n.prototype._getRenderer=function(){return this._renderer},n.prototype._getLayerList=function(){if(!this.map)return[];var e=+!!this.map.getBaseLayer();return this.map.getLayers().slice(e)},n.prototype._getMask2DExtent=function(){if(!this._mask||!this.getMap())return null;var e=this._mask._getMaskPainter();return e?e.get2DExtent():null},n.prototype.toJSON=function(e){return{type:"Layer",id:this.getId(),options:e||this.config()}},n.fromJSON=function(e){if(!e)return null;var i=e.type,o=n.getJSONClass(i);if(!o||!o.fromJSON)throw new Error("unsupported layer type:"+i);return o.fromJSON(e)},n}(O6(m6(u7(v6))));cet.mergeOptions(uet);var Aet=cet.prototype.fire;cet.prototype.fire=function(e,n){return"layerload"===e&&(this._loaded=!0),this.map&&(n||(n={type:null,target:null}),n.type=e,n.target=this,this.map._onLayerEvent(n)),Aet.apply(this,arguments),["show","hide"].indexOf(e)>-1&&this.fire("visiblechange",Object.assign({},n,{visible:this.options.visible})),this};var fet=new o9(0,0),det=new w5(0,0),pet=["centerCross","fog","fogColor","debugSky"],get={maxVisualPitch:70,maxPitch:80,centerCross:!1,zoomInCenter:!1,zoomOrigin:null,zoomAnimation:!b2,zoomAnimationDuration:330,panAnimation:!b2,panAnimationDuration:600,rotateAnimation:!b2,zoomable:!0,enableInfoWindow:!0,hitDetect:!f5.mobile,hitDetectLimit:5,fpsOnInteracting:25,layerCanvasLimitOnInteracting:-1,maxZoom:null,minZoom:null,maxExtent:null,limitExtentOnMaxExtent:!1,fixCenterOnResize:!0,checkSize:!0,checkSizeInterval:1e3,renderer:"canvas",cascadePitches:[10,60],renderable:!0,clickTimeThreshold:280,stopRenderOnOffscreen:!0,preventWheelScroll:!0,preventTouch:!0,supportPluginEvent:!0,switchDragButton:!1,mousemoveThrottleTime:48,maxFPS:0,debug:!1,cameraFarUndergroundInMeter:2e3},met=function(e){function n(i,o){var s=this;if(!o)throw new Error("Invalid options when creating map.");if(!o.center)throw new Error("Invalid center when creating map.");var a=P2({},o),h=a.zoom;delete a.zoom;var l=new o9(a.center);delete a.center;var c=a.baseLayer;delete a.baseLayer;var A=a.layers;return delete a.layers,(s=e.call(this,a)||this).VERSION=n.VERSION,Object.defineProperty(s,"id",{value:T5(),writable:!1}),s._loaded=!1,s._initContainer(i),s._panels={},s._baseLayer=null,s._layers=[],s._zoomLevel=h,s._center=l,s._centerZ=l.z,s.setSpatialReference(a.spatialReference||a.view),s._mapViewPoint=new w5(0,0),s._initRenderer(),s._updateMapSize(s._getContainerDomSize()),c&&s.setBaseLayer(c),A&&s.addLayer(A),s.setMaxExtent(a.maxExtent),s._Load(),s.proxyOptions(),s.isMap=!0,s}return p5(n,e),n.addOnLoadHook=function(e){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var o="function"==typeof e?e:function(){var i;(i=this[e]).call.apply(i,v5([this],y5(n),!1))};return this.prototype._onLoadHooks=this.prototype._onLoadHooks||[],this.prototype._onLoadHooks.push(o),this},n.prototype.isLoaded=function(){return!!this._loaded},n.prototype.getContainer=function(){return this._containerDOM},n.prototype.getSpatialReference=function(){return this._spatialReference},n.prototype.setSpatialReference=function(e){var n=this.options.spatialReference;return this._loaded&&Ktt.equals(n,e)||this._updateSpatialReference(e,n),this},n.prototype._updateSpatialReference=function(e,n){E2(e)&&(e=Ktt.getPreset(e)),e=P2({},e),this._center=this.getCenter(),this.options.spatialReference=e,this._spatialReference=new Ktt(e);var i=this._spatialReference.getProjection();return this.options.spatialReference&&O2(this.options.spatialReference.projection)&&(this.options.spatialReference.projection=i.code),this._resetMapStatus(),n7.is(i.code)&&(this._originLng=i.centralMeridian,this._altitudeOriginDirty=!0),this._fireEvent("spatialreferencechange",{old:n,new:P2({},this.options.spatialReference)}),this},n.prototype.onConfig=function(e){var n=e.spatialReference||e.view;M2(n)||this._updateSpatialReference(n,null);for(var i=!1,o=0,s=pet.length;o<s;o++){if(!M2(e[pet[o]])){i=!0;break}}if(!i)return this;var a=this.getRenderer();return a&&a.setToRedraw(),this},n.prototype.getProjection=function(){return this._spatialReference?this._spatialReference.getProjection():null},n.prototype.getFullExtent=function(){return this._spatialReference?this._spatialReference.getFullExtent():null},n.prototype.setCursor=function(e){return delete this._cursor,this._trySetCursor(e),this._cursor=e,this},n.prototype.resetCursor=function(){return this.setCursor(null)},n.prototype.getCenter=function(){if(!this._loaded||!this._prjCenter)return this._center;var e=this.getProjection().unproject(this._prjCenter);return e.x=Math.round(1e8*e.x)/1e8,e.y=Math.round(1e8*e.y)/1e8,e.z=this._centerZ,this.centerAltitude&&(e.z=this.centerAltitude),e},n.prototype.setCenter=function(e,n){if(!e)return this;e=new o9(e),n&&(e=this._getCenterByPadding(e,this.getZoom(),n));var i=this.getProjection().project(e);return this._verifyExtent(i)||this.options.limitExtentOnMaxExtent?this._loaded?(this._centerZ=e.z,this.onMoveStart(),this._setPrjCenter(i),this.onMoveEnd(this._parseEventFromCoord(this.getCenter())),this):(this._center=e,this):this},n.prototype.getSize=function(){return M2(this.width)||M2(this.height)?this._getContainerDomSize():new h3(this.width,this.height)},n.prototype.getContainerExtent=function(){var e=this.height,n=this.getPitch(),i=this.options.maxVisualPitch;return i&&n>i&&(e=this._getVisualHeight(i)),new v9(0,this.height-e,this.width,this.height)},n.prototype._getVisualHeight=function(e){e=e||.01;var n=(90-this.getPitch())*Math.PI/180,i=this.getFov()*Math.PI/180;e*=Math.PI/180;var o=this.cameraCenterDistance/this.getGLScale(),s=Math.tan(i/2),a=o*s/(1/Math.tan(e)-s)/Math.sin(e),h=o*(Math.sin(n)*a/(o+Math.cos(n)*a));return this.height/2+h},n.prototype.getExtent=function(){return this.pointToExtent(this.get2DExtent())},n.prototype.getProjExtent=function(){var e=this.get2DExtent();return new y9(this._pointToPrj(e.getMin()),this._pointToPrj(e.getMax()))},n.prototype.getPrjExtent=function(){return this.getProjExtent()},n.prototype.getMaxExtent=function(){return this.options.maxExtent?new y9(this.options.maxExtent,this.getProjection()):null},n.prototype.setMaxExtent=function(e){if(e){var n=new y9(e,this.getProjection());this.options.maxExtent=n;var i=this.getProjection();this._prjMaxExtent=n.convertTo((function(e){return i.project(e)})),this._verifyExtent(this._getPrjCenter())||(this._loaded?this._panTo(this._prjMaxExtent.getCenter()):this._center=i.unproject(this._prjMaxExtent.getCenter()))}else delete this.options.maxExtent,delete this._prjMaxExtent;return this},n.prototype.getZoom=function(){return this._zoomLevel},n.prototype.getZoomForScale=function(e,n,i){var o=this.getZoom();if(M2(n)&&(n=o),1===e&&n===o)return o;var s=this._getResolution(n),a=this.getZoomFromRes(s/e);if(i)return a;var h=1e-6;return this.getSpatialReference().getZoomDirection()<0?Math.ceil(a-h):Math.floor(a+h)},n.prototype.getZoomFromRes=function(e){var n=this._getResolutions(),i=this._getResolution(this.getMinZoom()),o=this._getResolution(this.getMaxZoom());if(i<=o){if(e<=i)return this.getMinZoom();if(e>=o)return this.getMaxZoom()}else{if(e>=i)return this.getMinZoom();if(e<=o)return this.getMaxZoom()}for(var s=n.length,a=0;a<s-1;a++)if(n[a]){var h=n[a+1]-n[a],l=e-n[a];if(k5(h)===k5(l)&&Math.abs(h)>=Math.abs(l))return a+l/h}return s-1},n.prototype.setZoom=function(e,n){return void 0===n&&(n={animation:!0}),isNaN(e)||M2(e)||(e=+e,this._loaded&&this.options.zoomAnimation&&n.animation?this._zoomAnimation(e):this._zoom(e)),this},n.prototype.getMaxZoom=function(){return M2(this.options.maxZoom)?this.getMaxNativeZoom():this.options.maxZoom},n.prototype.setMaxZoom=function(e){var n=this.getMaxNativeZoom();return e>n&&(e=n),null!==e&&e<this._zoomLevel&&(this.setZoom(e),e=+e),this.options.maxZoom=e,this},n.prototype.getMinZoom=function(){return M2(this.options.minZoom)?this._spatialReference.getMinZoom():this.options.minZoom},n.prototype.setMinZoom=function(e){if(null!==e){e=+e;var n=this._spatialReference.getMinZoom();e<n&&(e=n),e>this._zoomLevel&&this.setZoom(e)}return this.options.minZoom=e,this},n.prototype.getMaxNativeZoom=function(){var e=this.getSpatialReference();return e?e.getMaxZoom():null},n.prototype.getGLRes=function(){if(this._glRes)return this._glRes;var e=this.getSpatialReference().getFullExtent();return this._glRes=(e.right-e.left)/Math.pow(2,19),this._glRes},n.prototype.getGLScale=function(e){return M2(e)&&(e=this.getZoom()),this._getResolution(e)/this.getGLRes()},n.prototype.zoomIn=function(){return this.setZoom(this.getZoom()+1)},n.prototype.zoomOut=function(){return this.setZoom(this.getZoom()-1)},n.prototype.isZooming=function(){return!!this._zooming},n.prototype.isInteracting=function(){return this.isZooming()||this.isMoving()||this.isRotating()},n.prototype.setCenterAndZoom=function(e,n){return M2(n)||this._zoomLevel===n?this.setCenter(e):(this.setCenter(e),this.setZoom(n,{animation:!1})),this},n.prototype._getPaddingSize=function(e){return void 0===e&&(e={}),e.paddingLeft||e.paddingTop||e.paddingRight||e.paddingBottom?{width:(e.paddingLeft||0)+(e.paddingRight||0),height:(e.paddingTop||0)+(e.paddingBottom||0)}:null},n.prototype.getFitZoom=function(e,n,i){var o=this;if(!(e&&e instanceof y9))return this._zoomLevel;if(e.xmin===e.xmax&&e.ymin===e.ymax)return this.getMaxZoom();var s=this.getSize(),a=this._getPaddingSize(i);if(a){var h={width:s.width-(a.width||0),height:s.height-(a.height||0)};s=new h3(h.width,h.height)}var l=e.convertTo((function(e){return o.coordToPoint(e)})),c=l.getWidth(),A=l.getHeight(),f=s.width/c,d=s.height/A,p=this.getSpatialReference().getZoomDirection()<0?Math.max(f,d):Math.min(f,d);return this.getZoomForScale(p,null,n)},n.prototype.getView=function(){return{center:this.getCenter().toArray(),zoom:this.getZoom(),pitch:this.getPitch(),bearing:this.getBearing()}},n.prototype._validateView=function(e){if(e&&I2(e)){T2(e.bearing)&&(e.bearing=Math.max(-180,e.bearing),e.bearing=Math.min(180,e.bearing)),T2(e.pitch)&&(e.pitch=Math.max(0,e.pitch),e.pitch=Math.min(this.options.maxPitch,e.pitch));var n=this.getMaxZoom();T2(e.zoom)&&(e.zoom=Math.max(0,e.zoom),e.zoom=Math.min(n,e.zoom))}},n.prototype.setView=function(e){return e?(this._validateView(e),e.center&&this.setCenter(e.center),null===e.zoom||isNaN(+e.zoom)||this.setZoom(+e.zoom,{animation:!1}),null===e.pitch||isNaN(+e.pitch)||this.setPitch(+e.pitch),null===e.bearing||isNaN(+e.bearing)||this.setBearing(+e.bearing),this):this},n.prototype.getResolution=function(e){return this._getResolution(e)},n.prototype.getScale=function(e){var n=M2(e)?this.getZoom():e,i=this._getResolution(this.getMaxNativeZoom());return this._getResolution(n)/i},n.prototype._getCenterByPadding=function(e,n,i){var o=this.coordinateToPoint(e,n),s=i||{},a=s.paddingLeft,h=void 0===a?0:a,l=s.paddingRight,c=void 0===l?0:l,A=s.paddingTop,f=void 0===A?0:A,d=s.paddingBottom,p=void 0===d?0:d,g=0,v=0;(h||c)&&(g=(c-h)/2),(f||p)&&(v=(f-p)/2);var w=new w5({x:o.x+g,y:o.y+v});return this.pointToCoordinate(w,n)},n.prototype.fitExtent=function(e,n,i,o){if(i=i||{},!e)return this;e=new y9(e,this.getProjection());var s=this.getFitZoom(e,i.isFraction||!1,i)+(n||0),a=e.getCenter();return this._getPaddingSize(i)&&(a=this._getCenterByPadding(a,s,i)),void 0===i.animation||i.animation?this._animateTo({center:a,zoom:s},{duration:i.duration||this.options.zoomAnimationDuration,easing:i.easing||"out"},o):this.setCenterAndZoom(a,s)},n.prototype.getBaseLayer=function(){return this._baseLayer},n.prototype.setBaseLayer=function(e){var n=!1;if(this._baseLayer&&(n=!0,this._fireEvent("baselayerchangestart"),this._baseLayer.remove()),!e)return delete this._baseLayer,this._fireEvent("baselayerchangeend"),this._fireEvent("setbaselayer"),this;return this._baseLayer=e,e._bindMap(this,-1),this._baseLayer.on("layerload",(function(){this._fireEvent("baselayerload"),n&&(n=!1,this._fireEvent("baselayerchangeend"))}),this),this._loaded&&this._baseLayer.load(),this._fireEvent("setbaselayer"),this},n.prototype.removeBaseLayer=function(){return this._baseLayer&&(this._baseLayer.remove(),delete this._baseLayer,this._fireEvent("baselayerremove")),this},n.prototype.getLayers=function(e){return this._getLayers((function(n){return!(n===this._baseLayer||n.getId().indexOf(t3)>=0)&&(!e||e(n))}))},n.prototype.getLayer=function(e){if(!e)return null;var n=this._layerCache?this._layerCache[e]:null;if(n)return n;var i=this.getBaseLayer();return i&&i.getId()===e?i:null},n.prototype.addLayer=function(e){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];if(!e)return this;Array.isArray(e)||(e=[e]),n&&n.length&&(e=e.concat(n)),this._layerCache||(this._layerCache={});for(var o=this._layers,s=0,a=e.length;s<a;s++){var h=e[s],l=h.getId();if(M2(l))throw new Error("Invalid id for the layer: "+l);if(h.getMap()!==this){if(this._layerCache[l])throw new Error("Duplicate layer id in the map: "+l);this._layerCache[l]=h,h._bindMap(this),o.push(h),this._loaded&&h.load()}}return this._sortLayersByZIndex(),this._fireEvent("addlayer",{layers:e}),this},n.prototype.removeLayer=function(e){if(!e)return this;if(!Array.isArray(e))return this.removeLayer([e]);for(var n=[],i=0,o=e.length;i<o;i++){var s=e[i];if(s instanceof cet||(s=this.getLayer(s)),s){var a=s.getMap();if(a&&a===this){n.push(s),this._removeLayer(s,this._layers),this._loaded&&s._doRemove();var h=s.getId();this._layerCache&&delete this._layerCache[h]}}}if(n.length>0){var l=this.getRenderer();l&&l.setLayerCanvasUpdated(),this.once("frameend",(function(){n.forEach((function(e){e.fire("remove")}))}))}return this._fireEvent("removelayer",{layers:e}),this},n.prototype.sortLayers=function(e){if(!e||!Array.isArray(e))return this;for(var n=[],i=Number.MAX_VALUE,o=0,s=e.length;o<s;o++){var a=e[o];if(E2(e[o])&&(a=this.getLayer(a)),!(a instanceof cet&&a.getMap()&&a.getMap()===this))throw new Error("It must be a layer added to this map to order.");a.getZIndex()<i&&(i=a.getZIndex()),n.push(a)}for(o=0,s=n.length;o<s;o++)n[o].setZIndex(i+o);return this},n.prototype.toDataURL=function(e){e||(e={});var n=e.mimeType;n||(n="image/png");var i=e.save,o=this._getRenderer();if(o&&o.toDataURL){var s=e.fileName;s||(s="export");var a=o.toDataURL(n,e.quality||.92);if(i&&a){var h=void 0;if("undefined"!=typeof Blob&&"undefined"!=typeof atob){var l=function(e,n){for(var i=atob(e),o=new ArrayBuffer(i.length),s=new Uint8Array(o),a=0;a<i.length;a++)s[a]=255&i.charCodeAt(a);return new Blob([o],{type:n})}(a.replace(/^data:image\/(png|jpeg|jpg|webp);base64,/,""),n);h=URL.createObjectURL(l)}else h=a;var c=document.createElement("a");c.download=s,c.href=h,document.body.appendChild(c),c.click(),document.body.removeChild(c)}return a}return null},n.prototype.coordToPoint=function(e,n,i){return this.coordinateToPoint(e,n,i)},n.prototype.coordToPointAtRes=function(e,n,i){return this.coordinateToPointAtRes(e,n,i)},n.prototype.pointToCoord=function(e,n,i){return this.pointToCoordinate(e,n,i)},n.prototype.pointAtResToCoord=function(e,n,i){return this.pointAtResToCoordinate(e,n,i)},n.prototype.coordToViewPoint=function(e,n,i){return this.coordinateToViewPoint(e,n,i)},n.prototype.viewPointToCoord=function(e,n){return this.viewPointToCoordinate(e,n)},n.prototype.coordToContainerPoint=function(e,n,i){return this.coordinateToContainerPoint(e,n,i)},n.prototype.containerPointToCoord=function(e,n){return this.containerPointToCoordinate(e,n)},n.prototype.containerPointToViewPoint=function(e,n){return n?n.set(e.x,e.y):n=e.copy(),n._sub(this.getViewPoint())},n.prototype.viewPointToContainerPoint=function(e,n){return n?n.set(e.x,e.y):n=e.copy(),n._add(this.getViewPoint())},n.prototype.checkSize=function(e){var n=C2()-this._initTime<1500&&0===this.width||0===this.height,i=this._getContainerDomSize(),o=this.height,s=this.width;if(!e&&i.width===s&&i.height===o)return this;H3(this._containerDOM);var a=this.getCenter();if(this.options.fixCenterOnResize)this._updateMapSize(i);else{var h=this._getVisualHeight(this.getPitch()),l=new w5(0,this.height-h),c=this._containerPointToPrj(l);this._updateMapSize(i);var A=this._getVisualHeight(this.getPitch()),f=new w5(0,this.height-A);this._setPrjCoordAtContainerPoint(c,f),this._mapViewCoord=this._getPrjCenter()}return(n||(0===i.width||0===i.height||0===s||0===o))&&(this._eventSilence=!0,this.setCenter(a),delete this._eventSilence),this._fireEvent("resize"),this},n.prototype.locate=function(e,n,i){return this.getProjection()._locate(new o9(e),n,i)},n.prototype.getMainPanel=function(){var e=this._getRenderer();return e?e.getMainPanel():null},n.prototype.getPanels=function(){return this._panels},n.prototype.remove=function(){var e=this;if(this.isRemoved())return this;this._fireEvent("removestart"),this._removeDomEvents(),this._clearHandlers(),this.removeBaseLayer();for(var n=this.getLayers(),i=0;i<n.length;i++)n[i].remove();return this._getRenderer()&&this._getRenderer().remove(),this._containerDOM.childNodes&&this._containerDOM.childNodes.length>0&&Array.prototype.slice.call(this._containerDOM.childNodes,0).filter((function(e){return"maptalks-wrapper"===e.className})).forEach((function(n){return e._containerDOM.removeChild(n)})),delete this._panels,delete this._containerDOM,delete this._renderer,this._fireEvent("removeend"),this._clearAllListeners(),this},n.prototype.isRemoved=function(){return!this._containerDOM},n.prototype.isMoving=function(){return!!this._moving},n.prototype.onMoveStart=function(e){this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer);var n=this._getPrjCenter();this._originCenter&&!this._verifyExtent(n)||(this._originCenter=n),this._moving=!0,this._trySetCursor("move"),this._fireEvent("movestart",this._parseEvent(e?e.domEvent:null,"movestart"))},n.prototype.onMoving=function(e){this._fireEvent("moving",this._parseEvent(e?e.domEvent:null,"moving")),this._limitMaxExtent()},n.prototype.onMoveEnd=function(e){(this._moving=!1,this._suppressRecenter||this._recenterOnTerrain(),this._trySetCursor("default"),this._fireEvent("moveend",e&&e.domEvent?this._parseEvent(e.domEvent,"moveend"):e),this._verifyExtent(this._getPrjCenter())||!this._originCenter||this.options.limitExtentOnMaxExtent)||this._panTo(this._originCenter);this._limitMaxExtent()},n.prototype.onDragRotateStart=function(e){this._dragRotating=!0,this._fireEvent("dragrotatestart",this._parseEvent(e?e.domEvent:null,"dragrotatestart"))},n.prototype.onDragRotating=function(e){this._fireEvent("dragrotating",this._parseEvent(e?e.domEvent:null,"dragrotating"))},n.prototype.onDragRotateEnd=function(e){this._dragRotating=!1,this._fireEvent("dragrotateend",this._parseEvent(e?e.domEvent:null,"dragrotateend"))},n.prototype.isDragRotating=function(){return!!this._dragRotating},n.prototype.isOffscreen=function(e,n){var i;void 0===n&&(n=0);var o=this.width+n,s=this.height+n,a=e.xmin,h=e.ymin,l=e.xmax,c=e.ymax;return Array.isArray(e)&&(a=(i=y5(e,4))[0],h=i[1],l=i[2],c=i[3]),l<n||a>=o||c<n||h>s},n.prototype.getRenderer=function(){return this._getRenderer()},n.prototype.getDevicePixelRatio=function(){return this.options.devicePixelRatio||f5.devicePixelRatio||1},n.prototype.setDevicePixelRatio=function(e){return T2(e)&&e>0&&e!==this.options.devicePixelRatio&&(this.options.devicePixelRatio=e,this.checkSize(!0)),this},n.prototype._initContainer=function(e){if(E2(e)){if(this._containerDOM=document.getElementById(e),!this._containerDOM)throw new Error("Invalid container when creating map: '"+e+"'")}else this._containerDOM=e,b2&&(this.CanvasClass=this._containerDOM.constructor);if(this._containerDOM.childNodes&&this._containerDOM.childNodes.length>0&&"maptalks-wrapper"===this._containerDOM.childNodes[0].className)throw new Error("Container is already loaded with another map instance, use map.remove() to clear it.")},n.prototype._trySetCursor=function(e){return this._cursor||this._priorityCursor||(e||(e="default"),this._setCursorToPanel(e)),this},n.prototype._setPriorityCursor=function(e){if(e)this._priorityCursor=e,this._setCursorToPanel(e);else{var n=!1;this._priorityCursor&&(n=!0),delete this._priorityCursor,n&&this.setCursor(this._cursor)}return this},n.prototype._setCursorToPanel=function(e){var n=this.getMainPanel();n&&n.style&&n.style.cursor!==e&&(n.style.cursor=e)},n.prototype._removeLayer=function(e,n){if(e&&n){var i=n.indexOf(e);i>-1&&n.splice(i,1)}},n.prototype._sortLayersByZIndex=function(){if(this._layers){for(var e=0,n=this._layers.length;e<n;e++){var i=this._layers[e];i._order=e,i.sortLayersByZIndex&&i.sortLayersByZIndex()}this._layers.sort((function(e,n){var i=e.getZIndex()-n.getZIndex();return 0===i?e._order-n._order:i}))}},n.prototype._fireEvent=function(e,n){if(!this._eventSilence){"_"!==e[0]&&this.fire("_"+e,n),this.fire(e,n)}},n.prototype._Load=function(){this._resetMapStatus(),this.options.pitch&&(this.setPitch(this.options.pitch),delete this.options.pitch),this.options.bearing&&(this.setBearing(this.options.bearing),delete this.options.bearing),delete this._glRes,this._loadAllLayers(),this._getRenderer().onLoad(),this._loaded=!0,this._callOnLoadHooks(),this._initTime=C2()},n.prototype._initRenderer=function(){var e=n.getRendererClass(this.options.renderer);this._renderer=new e(this),this._renderer.load()},n.prototype._getRenderer=function(){return this._renderer},n.prototype._loadAllLayers=function(){this._baseLayer&&this._baseLayer.load(),this._eachLayer((function(e){e&&e.load()}),this.getLayers())},n.prototype._getLayers=function(e){for(var n=this._baseLayer?[this._baseLayer].concat(this._layers):this._layers,i=[],o=0;o<n.length;o++)e&&!e.call(this,n[o])||i.push(n[o]);return i},n.prototype._eachLayer=function(e){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];if(!(arguments.length<2)){n&&!Array.isArray(n)&&(n=[n]);for(var o=[],s=0,a=n.length;s<a;s++)o=o.concat(n[s]);for(var h=0,l=o.length;h<l;h++)e.call(e,o[h])}},n.prototype._onLayerEvent=function(e){e&&"idchange"===e.type&&(delete this._layerCache[e.old],this._layerCache[e.new]=e.target)},n.prototype._resetMapStatus=function(){var e=this.getMaxZoom(),n=this.getMinZoom(),i=this._spatialReference.getMaxZoom(),o=this._spatialReference.getMinZoom();(M2(e)||-1===e||e>i)&&this.setMaxZoom(i),(M2(n)||-1===n||n<o)&&this.setMinZoom(o),(e=this.getMaxZoom())<(n=this.getMinZoom())&&this.setMaxZoom(n),(M2(this._zoomLevel)||this._zoomLevel>e)&&(this._zoomLevel=e),this._zoomLevel<n&&(this._zoomLevel=n),delete this._prjCenter,delete this._glRes;var s=this.getProjection();this._prjCenter=s.project(this._center),this._prjCenter.z=this._center.z,this._calcMatrices();var a=this._getRenderer();a&&a.resetContainer()},n.prototype.setContainerDomRect=function(e){this._containerDomContentRect=e},n.prototype._getContainerDomSize=function(){if(!this._containerDOM)return null;var e,n,i=this._containerDOM;if(this._containerDomContentRect)return new h3(e=this._containerDomContentRect.width,n=this._containerDomContentRect.height);var o=i;if(M2(o.width)||M2(o.height)){if(M2(i.clientWidth)||M2(i.clientHeight))throw new Error("can not get size of container");e=parseInt(i.clientWidth+"",0),n=parseInt(i.clientHeight+"",0)}else{e=o.width,n=o.height;var s=this.getDevicePixelRatio();1!==s&&i.layer&&(e/=s,n/=s)}return new h3(e,n)},n.prototype._updateMapSize=function(e){return this.width=e.width,this.height=e.height,this._getRenderer().updateMapSize(e),this._calcMatrices(),this},n.prototype._getPrjCenter=function(){return this._prjCenter},n.prototype._setPrjCenter=function(e){this._prjCenter=e,this.isInteracting()&&!this.isMoving()&&(this._mapViewCoord=e),this._calcMatrices()},n.prototype._setPrjCoordAtContainerPoint=function(e,n){if(!this.centerAltitude&&n.x===this.width/2&&n.y===this.height/2)return this;var i=this._containerPointToPoint(n)._sub(this._prjToPoint(this._getPrjCenter())),o=this._pointToPrj(this._prjToPoint(e)._sub(i));return this._setPrjCenter(o),this},n.prototype._setPrjCoordAtOffsetToCenter=function(e,n){var i=this._pointToPrj(this._prjToPoint(e)._sub(n));return this._setPrjCenter(i),this},n.prototype._verifyExtent=function(e){if(!e)return!1;var n=this._prjMaxExtent;return!n||n.contains(e)},n.prototype._limitMaxExtent=function(){var e=this;if(this._limitMaxExtenting||!this.options.limitExtentOnMaxExtent)return this;var n=this._prjMaxExtent,i=this.getMaxExtent();if(!n||!i)return this;var o=n.toArray().map((function(n){return e.prjToContainerPoint(n)})),s=v8();b8(o,s);var a=this.getSize(),h=a.width,l=a.height,c=[0,0,h,l];if(M8(c,s))return this;if(M8(s,c))return this;var A=0,f=0,d=0,p=0,g=0,v=0,w=Math.abs,C=y5(s,4),P=C[0],T=C[1],S=C[2],I=C[3];if(P>0&&S>h&&(A=d=w(P)),P<0&&S<h&&(A=d=-w(P)),P<0&&S<h&&(A=p=-w(h-S)),P>0&&S>h&&(A=p=w(h-S)),T>0&&I>l&&(f=g=w(T)),T<0&&I<l&&(f=g=-w(T)),T<0&&I<l&&(f=v=-w(l-I)),T>0&&I>l&&(f=v=w(l-I)),0!==d&&0!==p&&(A=d,w(p)<w(d)&&(A=p)),0!==g&&0!==v&&(f=g,w(v)<w(g)&&(f=v)),0!==A||0!==f){var E=new w5(h/2+A,l/2+f),O=this.containerPointToCoord(E);this._limitMaxExtenting=!0,this.setCenter(O),this._limitMaxExtenting=!1}return this},n.prototype._offsetCenterByPixel=function(e){var n=det.set(this.width/2-e.x,this.height/2-e.y),i=this._containerPointToPrj(n,fet),o=det.set(this.width/2,this.height/2);this._setPrjCoordAtContainerPoint(i,o)},n.prototype.offsetPlatform=function(e){return e?(this._getRenderer().offsetPlatform(e),this._mapViewCoord=this._getPrjCenter(),this._mapViewPoint=this._mapViewPoint.add(e),this._mapViewPoint):this._mapViewPoint},n.prototype.getViewPoint=function(){var e=this.getViewPointFrameOffset(),n=this.offsetPlatform();return e&&(n=n.add(e)),n},n.prototype._resetMapViewPoint=function(){this._mapViewPoint=new w5(0,0),this._mapViewCoord=this._getPrjCenter()},n.prototype._getResolution=function(e){return void 0!==e&&e!==this._zoomLevel||void 0===this._mapRes?(M2(e)&&(e=this._zoomLevel),this._spatialReference.getResolution(e)):this._mapRes},n.prototype._getResolutions=function(){return this._spatialReference.getResolutions()},n.prototype._prjToPoint=function(e,n,i){n=M2(n)?this.getZoom():n;var o=this._getResolution(n);return this._prjToPointAtRes(e,o,i)},n.prototype._prjToPointAtRes=function(e,n,i){return this._spatialReference.getTransformation().transform(e,n,i)},n.prototype._prjsToPointsAtRes=function(e,n,i){void 0===i&&(i=[]);for(var o=this._spatialReference.getTransformation(),s=[],a=0,h=e.length;a<h;a++){var l=o.transform(e[a],n,i[a]);s.push(l)}return s},n.prototype._pointToPrj=function(e,n,i){n=M2(n)?this.getZoom():n;var o=this._getResolution(n);return this._pointToPrjAtRes(e,o,i)},n.prototype._pointToPrjAtRes=function(e,n,i){return this._spatialReference.getTransformation().untransform(e,n,i)},n.prototype._pointToPoint=function(e,n,i){return M2(n)?(i?(i.x=e.x,i.y=e.y):i=e.copy(),i):this._pointAtResToPoint(e,this._getResolution(n),i)},n.prototype._pointAtResToPoint=function(e,n,i){return i?(i.x=e.x,i.y=e.y):i=e.copy(),i._multi(n/this._getResolution())},n.prototype._pointToPointAtRes=function(e,n,i){return i?(i.x=e.x,i.y=e.y):i=e.copy(),i._multi(this._getResolution()/n)},n.prototype._containerPointToPrj=function(e,n){return this._pointToPrj(this._containerPointToPoint(e,void 0,n),void 0,n)},n.prototype._callOnLoadHooks=function(){var e=n.prototype;if(e._onLoadHooks)for(var i=0,o=e._onLoadHooks.length;i<o;i++)e._onLoadHooks[i].call(this)},n.prototype._fixPrjOnWorldWide=function(e){var n=this.getProjection();if(n&&n.fullExtent&&e){var i=n.fullExtent||{},o=i.left,s=i.bottom,a=i.top,h=i.right;T2(o)&&(e.x=Math.max(o,e.x)),T2(h)&&(e.x=Math.min(h,e.x)),T2(s)&&(e.y=Math.max(s,e.y)),T2(a)&&(e.y=Math.min(a,e.y))}return this},n.prototype.toJSON=function(e){e||(e={});var n={jsonVersion:this.JSON_VERSION,version:this.VERSION,extent:this.getExtent().toJSON()};n.options=this.config(),n.options.center=this.getCenter(),n.options.zoom=this.getZoom(),n.options.bearing=this.getBearing(),n.options.pitch=this.getPitch();var i=this.getBaseLayer();(M2(e.baseLayer)||e.baseLayer)&&i&&(n.baseLayer=i.toJSON(e.baseLayer));var o={};e.clipExtent&&(o.clipExtent=!0===e.clipExtent?this.getExtent():e.clipExtent);var s=[];if(M2(e.layers)||e.layers&&!Array.isArray(e.layers)){for(var a=0,h=(c=this.getLayers()).length;a<h;a++)if(c[a].toJSON){var l=P2({},I2(e.layers)?e.layers:{},o);s.push(c[a].toJSON(l))}n.layers=s}else if(z5(e.layers)){var c=e.layers;for(a=0;a<c.length;a++){var A=c[a],f=this.getLayer(A.id);if(f.toJSON){l=P2({},A.options,o);s.push(f.toJSON(l))}}n.layers=s}else n.layers=[];return n},n.fromJSON=function(e,i,o){if(!e||!i)return null;o||(o={});var s=new n(e,i.options);if(M2(o.baseLayer)||o.baseLayer){var a=cet.fromJSON(i.baseLayer);a&&s.setBaseLayer(a)}if(M2(o.layers)||o.layers){for(var h=[],l=i.layers,c=0;c<l.length;c++){var A=cet.fromJSON(l[c]);h.push(A)}s.addLayer(h)}return s},n}(t9(m6(u7(v6))));met.mergeOptions(get);var yet=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype.addHooks=function(){this.target&&this.target.on("_dblclick",this._onDoubleClick,this)},n.prototype.removeHooks=function(){this.target&&this.target.off("_dblclick",this._onDoubleClick,this)},n.prototype._onDoubleClick=function(e){var n=this.target;if(n.options.doubleClickZoom){var i=n.getZoom(),o=e.domEvent.shiftKey?Math.ceil(i)-1:Math.floor(i)+1;n._zoomAnimation(o,e.containerPoint)}},n}(y6);met.mergeOptions({doubleClickZoom:!0}),met.addOnLoadHook("addHandler","doubleClickZoom",yet);var vet=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype.addHooks=function(){var e=this.target;if(e){var n=e.getPanels().mapWrapper||e.getContainer();this._dragHandler=new r9(n,{cancelOn:this._cancelOn.bind(this),rightclick:!0}),this._dragHandler.on("mousedown",this._onMouseDown,this).on("dragstart",this._onDragStart,this).on("dragging",this._onDragging,this).on("dragend",this._onDragEnd,this).enable()}},n.prototype.removeHooks=function(){this._dragHandler.off("mousedown",this._onMouseDown,this).off("dragstart",this._onDragStart,this).off("dragging",this._onDragging,this).off("dragend",this._onDragEnd,this),this._dragHandler.remove(),delete this._dragHandler},n.prototype._cancelOn=function(e){return!(!this.target.isZooming()&&!this._ignore(e))},n.prototype._ignore=function(e){return!!e&&(e.domEvent&&(e=e.domEvent),this.target._ignoreEvent(e)||this.target._isEventOutMap(e))},n.prototype._onMouseDown=function(e){delete this.startDragTime,delete this._mode;var n=this.target.options.switchDragButton;n&&"touchstart"===e.domEvent.type||e.domEvent.button===(n?0:2)||e.domEvent.ctrlKey?(this.target.options.dragRotate||this.target.options.dragPitch)&&(this._mode="rotatePitch"):this.target.options.dragPan&&(this._mode="move"),this.target._stopAnim(this.target._mapAnimPlayer),N3(e.domEvent)},n.prototype._onDragStart=function(e){this.startDragTime=C2(),"move"===this._mode?this._moveStart(e):"rotatePitch"===this._mode&&this._rotateStart(e)},n.prototype._onDragging=function(e){this.target._isEventOutMap(e.domEvent)||("move"===this._mode?this._moving(e):"rotatePitch"===this._mode&&this._rotating(e))},n.prototype._onDragEnd=function(e){"move"===this._mode?this._moveEnd(e):"rotatePitch"===this._mode&&this._rotateEnd(e),delete this.startDragTime,delete this.startBearing},n.prototype._start=function(e){this.preX=e.mousePos.x,this.preY=e.mousePos.y,this.startX=this.preX,this.startY=this.preY,this._startPrjCenter=this.target._getPrjCenter().copy()},n.prototype._moveStart=function(e){this._start(e);var n=this.target;n.onMoveStart(e);var i=j3(n._getActualEvent(e.domEvent),n.getContainer());this.startPrjCoord=this._containerPointToPrj(i)},n.prototype._moving=function(e){if(this.startDragTime){var n=this.target,i=j3(n._getActualEvent(e.domEvent),n.getContainer()),o=n._containerPointToPoint(i,void 0,void 0,this.startPrjCoord.z),s=n._prjToPoint(n._pointToPrj(o))._sub(n._prjToPoint(n._getPrjCenter()));n._setPrjCoordAtOffsetToCenter(this.startPrjCoord,s),n.onMoving(e)}},n.prototype._containerPointToPrj=function(e){var n=this.target,i=n._queryTerrainInfo(e);if(i){var o=n.getProjection().project(i.coordinate);return o.z=i.altitude,o}return n._containerPointToPrj(e)},n.prototype._moveEnd=function(e){if(this.startDragTime){var n="touchend"===e.domEvent.type,i=this.target,o=C2()-this.startDragTime,s=e.mousePos.x-this.startX,a=e.mousePos.y-this.startY,h=i._getPrjCenter(),l=h.sub(this._startPrjCenter);if(this._clear(),i.options.panAnimation&&!e.interupted&&i._verifyExtent(i._getPrjCenter())&&o<280&&Math.abs(a)+Math.abs(s)>5){o*=5;var c=h.add(l._multi(n?5:2.8));i._panTo(c,{duration:n?3*o:2*o,easing:"outExpo"})}else i.onMoveEnd(e)}},n.prototype._rotateStart=function(e){this._start(e),delete this._rotateMode,this.startBearing=this.target.getBearing(),this.target.onDragRotateStart(e),this._db=0},n.prototype._rotating=function(e){var n=this.target,i=e.mousePos.x,o=e.mousePos.y,s=n.getPitch(),a=n.getBearing(),h=Math.abs(i-this.preX),l=Math.abs(o-this.preY);if(this._rotateMode||(this._rotateMode=n.options.dragRotatePitch?"rotate_pitch":h>l?"rotate":h<l?"pitch":"rotate"),!("pitch"===this._rotateMode&&0===s&&l<10)){if(this._rotateMode.indexOf("rotate")>=0&&n.options.dragRotate){var c=.15,A=0;A=n.options.dragPitch||h>l?-.15*(this.preX-i):i>n.width/2?c*(this.preY-o):-.15*(this.preY-o);var f=n.getBearing()+A;this._db=this._db||0,this._db+=A,n._setBearing(f)}this._rotateMode.indexOf("pitch")>=0&&n.options.dragPitch&&n._setPitch(n.getPitch()+.15*(this.preY-o)),this.preX=i,this.preY=o,n.getBearing()===a&&n.getPitch()===s||n.onDragRotating(e)}},n.prototype._rotateEnd=function(e){var n=this.target,i=n.getBearing();this._clear();var o=C2()-this.startDragTime;if(n.onDragRotateEnd(e),n.options.rotateAnimation&&Math.abs(i-this.startBearing)>20&&("rotate"===this._rotateMode||"rotate_pitch"===this._rotateMode)&&!e.interupted&&o<400){var s=n.getBearing();n._animateTo({bearing:s+this._db/1.5},{easing:"outQuint",duration:1600})}},n.prototype._clear=function(){delete this.startPrjCoord,delete this.preX,delete this.preY,delete this.startX,delete this.startY},n}(y6);met.mergeOptions({draggable:!0,dragPan:!0,dragRotatePitch:!0,dragRotate:!0,dragPitch:!0}),met.addOnLoadHook("addHandler","draggable",vet);var _et="mousedown mouseup mousemove click dblclick contextmenu touchstart touchmove touchend mouseout",xet={mousemove:["mousemove","mouseover","mouseout","mouseenter"],touchend:["touchend","click"]},bet=function(e){return e&&e.getLayer&&e.on&&e.fire},wet=function(e){return e._getInternalId?e._getInternalId():e.getId?e.getId():null},Cet=function(e,n,i){if(e._onEvent)return e._onEvent(n,i);var o=e.getLayer();return o&&o.fireGeoEvent?o.fireGeoEvent(e,n,i):null},Pet=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype.addHooks=function(){var e=this.target,n=e.getPanels().allLayers||e.getContainer();X3(n,_et,this._identifyGeometryEvents,this)},n.prototype.removeHooks=function(){var e=this.target,n=e.getPanels().allLayers||e.getContainer();Y3(n,_et,this._identifyGeometryEvents)},n.prototype._identifyGeometryEvents=function(e,n){var i=this.target;if(!i.isInteracting()&&!i._ignoreEvent(e)){var o=null,s=n||e.type;if(J3(s)&&!w2.isTest&&K3(this,i.options.mousemoveThrottleTime))z3(e);else{var a="mousedown"===s||"touchstart"===s&&e.touches&&1===e.touches.length;if(a)this._mouseDownTime=C2();else if(("click"===s||"touchend"===s)&&this._mouseDownTime){var h=this._mouseDownTime;if(delete this._mouseDownTime,C2()-h>300){if("click"===s)return}else"touchend"===s&&(o="click")}var l=e.touches&&e.touches.length>0?e.touches[0]:e.changedTouches&&e.changedTouches.length>0?e.changedTouches[0]:e;if(l){var c=j3(l,i.getContainer());"touchstart"===s&&i.options.preventTouch&&N3(e);for(var A=null,f=this.target.getRenderer().getTopElements(),d=a&&2!==e.button,p=0;p<f.length;p++)if(f[p].hitTest(c)){var g=f[p].options.cursor;if(g&&(A=g),d||f[p].events&&f[p].events.indexOf(s)>=0){var v={target:i,type:s,domEvent:e,containerPoint:c};if(d)return i._setPriorityCursor(A),void f[p].mousedown(v);f[p].onEvent(v)}}var w=i._getLayers((function(e){return!(!e.identify||!e.options.geometryEvents)}));if(w.length){var C={includeInternals:!0,filter:function(n){if(n instanceof net){var i=n._getEventTypeToFire(e);return"mousemove"===s?(!A&&n.options.cursor&&(A=n.options.cursor),!0):!(!n.listens(i)&&!n.listens(o))}return!!bet(n)},count:1,onlyVisible:i.options.onlyVisibleGeometryEvents,containerPoint:c,layers:w,eventTypes:xet[s]||[s],domEvent:e},P=function(n){var a=this,h=!0,l=function(){return a._prevOverGeos&&a._prevOverGeos.geos||[]},c=function(n,i){if(void 0===n&&(n=[]),void 0===i&&(i={}),n&&n.length>0)for(var o=n.length-1;o>=0;o--){var s=n[o];if(bet(s))i[wet(n[o])]||(h=Cet(s,e,"mouseout"))}};if("mouseout"===s){var f=l();this._prevOverGeos={geos:[],geomap:{}},c(f,{})}else if("mousemove"===s){var d={};if(n.length>0)for(var p=n.length-1;p>=0;p--){var g=n[p];if(bet(g)){var v=wet(g);d[v]=g,Cet(g,e),this._prevOverGeos&&this._prevOverGeos.geomap[v]||Cet(g,e,"mouseenter"),h=Cet(g,e,"mouseover")}}i._setPriorityCursor(A);f=l();this._prevOverGeos={geos:n,geomap:d},c(f,d)}else{if(!n||!n.length)return;for(p=n.length-1;p>=0;p--)if(bet(n[p])){h=Cet(n[p],e),o&&Cet(n[p],e,o);break}}!1===h&&z3(e)}.bind(this);J3(s)?this._queryIdentifyTimeout=i.getRenderer().callInNextFrame((function(){i.isInteracting()||i.identifyAtPoint(C,P)})):i.identifyAtPoint(C,P)}}}}},n}(y6);met.mergeOptions({geometryEvents:!0,onlyVisibleGeometryEvents:!0}),met.addOnLoadHook("addHandler","geometryEvents",Pet);
/*!
   * Contains code from mapbox-gl-js
   * http://github.com/mapbox/mapbox-gl-js
   * License BSD-3-Clause
   */
var Met=4.000244140625,Tet=1/450,Iet=function(e){function n(n){var i=e.call(this,n)||this;return i._thisScrollZoom=i._scrollZoom.bind(i),i._thisCheckIfEndZoom=i._checkIfEndZoom.bind(i),i._wheelZoomRate=Tet,i._defaultZoomRate=.01,i._delta=0,i}return p5(n,e),n.prototype.addHooks=function(){k3(this.target._containerDOM,"wheel",this._onWheelScroll,this)},n.prototype.removeHooks=function(){L3(this.target._containerDOM,"wheel",this._onWheelScroll)},n.prototype._onWheelScroll=function(e){var n=this.target;if(n.options.preventWheelScroll&&(N3(e),z3(e)),n._ignoreEvent(e)||n._isEventOutMap(e)||!n.options.zoomable)return!1;var i=n.getContainer(),o=n._checkZoomOrigin(j3(e,i));return n.options.seamlessZoom?(this._zooming||(this._trackPadSuspect=0,this._ensureTrackpad=!1),this._seamless(e,o)):this._interval(e,o)},n.prototype._seamless=function(e,n){var i=e.deltaMode===window.WheelEvent.DOM_DELTA_LINE?60*e.deltaY:e.deltaY;if(i%Met!=0&&(this._ensureTrackpad||(Math.abs(i)<60?this._trackPadSuspect++:this._trackPadSuspect=0,this._trackPadSuspect>=2&&(this._ensureTrackpad=!0)),this._ensureTrackpad&&(i*=14)),e.shiftKey&&i&&(i/=4),this._lastWheelEvent=e,M2(this._delta)&&(this._delta=0),this._delta-=i,!this._zooming&&this._delta){var o=this.target;this._zoomOrigin=n,o.onZoomStart(null,n)}this._start()},n.prototype._start=function(){this._delta&&(this._zooming=!0,this._active||(this.target.getRenderer().callInNextFrame(this._thisScrollZoom),this._active=!0))},n.prototype._scrollZoom=function(){if(this._active=!1,this._delta){var e=Math.abs(this._delta)>Met?this._wheelZoomRate:this._defaultZoomRate,n=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==n&&(n=1/n);var i=this.target,o=i.getZoom(),s=i.getZoomForScale(n,o,!0);this._delta=0,i.onZooming(s,this._zoomOrigin),this._scrollTime=performance.now(),i.getRenderer().callInNextFrame(this._thisCheckIfEndZoom)}},n.prototype._checkIfEndZoom=function(){if(this._zooming){var e=this.target;performance.now()-this._scrollTime>210?(this._zooming=!1,e.onZoomEnd(e.getZoom(),this._zoomOrigin)):e.getRenderer().callInNextFrame(this._thisCheckIfEndZoom)}},n.prototype._interval=function(e,n){var i=this,o=this.target;if(this._zooming)return this._requesting++,!1;this._requesting=0;var s=(e.deltaY?-1*e.deltaY:e.wheelDelta?e.wheelDelta:e.detail)>0?1:-1;e.detail&&(s*=-1);var a=o.getZoom(),h=a+s;if((h=o._checkZoom(s>0?Math.ceil(h):Math.floor(h)))===a)return!1;this._zooming=!0,this._delta||(o.onZoomStart(null,n),this._origin=n,this._delta=s,this._startZoom=o.getZoom());return o._animateTo({zoom:h-1*this._delta/2,around:this._origin},{continueOnViewChanged:!0,easing:"linear",duration:90,wheelZoom:!0},(function(n){"finished"===n.state.playState?i._requesting<1||Math.abs(h-i._startZoom)>2||h===o.getMaxZoom()||h===o.getMinZoom()?(o._animateTo({zoom:h,around:i._origin},{continueOnViewChanged:!0,duration:100},(function(e){"running"!==e.state.playState&&(delete i._zooming,delete i._requesting)})),delete i._startZoom,delete i._origin,delete i._delta,i._requesting=0):M2(i._requesting)||(delete i._zooming,i._onWheelScroll(e)):"running"!==n.state.playState&&(delete i._zooming,delete i._requesting)})),!1},n}(y6);met.mergeOptions({scrollWheelZoom:!0,seamlessZoom:!0}),met.addOnLoadHook("addHandler","scrollWheelZoom",Iet);var Eet=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype.addHooks=function(){k3(this.target.getContainer(),"touchstart",this._onTouchStart,this)},n.prototype.removeHooks=function(){L3(this.target.getContainer(),"touchstart",this._onTouchStart)},n.prototype._onTouchStart=function(e){var n=this.target;if(e.touches&&!(e.touches.length<2)){var i=n.getContainer(),o=j3(e.touches[0],i),s=j3(e.touches[1],i);this.preY=o.y,this._startP1=o,this._startP2=s,this._startDist=o.distanceTo(s),this._startVector=o.sub(s),this._startZoom=n.getZoom(),this._startBearing=n.getBearing(),Y3(document,"touchmove",this._onTouchMove),Y3(document,"touchend",this._onTouchEnd),k3(document,"touchmove",this._onTouchMove,this),k3(document,"touchend",this._onTouchEnd,this),n.options.preventTouch&&N3(e),n._fireEvent("touchactstart")}},n.prototype._onTouchMove=function(e){var n=this.target;if(e.touches&&!(e.touches.length<2)){var i=n.getContainer(),o=j3(e.touches[0],i),s=j3(e.touches[1],i),a=o.sub(this._startP1),h=s.sub(this._startP2),l=o.sub(s),c=o.distanceTo(s)/this._startDist,A=180*l.angleWith(this._startVector)/Math.PI,f=.4*((this.preY||o.y)-o.y);this.preY=o.y;var d={domEvent:e,mousePos:[o,s]};if(this.mode||(n.options.touchRotate&&Math.abs(A)>8?this.mode=n.options.touchZoomRotate?"rotate_zoom":"rotate":n.options.touchPitch&&a.y*h.y>0&&Math.abs(a.y)>10&&Math.abs(h.y)>10?this.mode="pitch":n.options.zoomable&&n.options.touchZoom&&Math.abs(1-c)>.15&&(this.mode=n.options.touchZoomRotate&&n.options.touchRotate?"rotate_zoom":"zoom"),this._startTouching(d)),"zoom"===this.mode||"rotate_zoom"===this.mode){this._scale=c;var p=n._getResolution(this._startZoom)/c,g=n.getZoomFromRes(p);n.onZooming(g,this._Origin)}"rotate"===this.mode||"rotate_zoom"===this.mode?(n._setBearing(this._startBearing+A),n.onDragRotating(d)):"pitch"===this.mode&&(n._setPitch(n.getPitch()+f),n.onDragRotating(d)),n._fireEvent("touchactinging")}},n.prototype._startTouching=function(e){var n=this.target;if("zoom"===this.mode||"rotate_zoom"===this.mode){var i=n.getSize();this._Origin=new w5(i.width/2,i.height/2),n.onZoomStart(null,this._Origin)}"rotate"!==this.mode&&"pitch"!==this.mode&&"rotate_zoom"!==this.mode||n.onDragRotateStart(e)},n.prototype._onTouchEnd=function(e){delete this.preY;var n=this.target;if(Y3(document,"touchmove",this._onTouchMove),Y3(document,"touchend",this._onTouchEnd),"zoom"===this.mode||"rotate_zoom"===this.mode){var i=this._scale,o=n._getResolution(this._startZoom)/i,s=n.getZoomFromRes(o);n.onZoomEnd(s,this._Origin)}"pitch"!==this.mode&&"rotate"!==this.mode&&"rotate_zoom"!==this.mode||n.onDragRotateEnd({domEvent:e}),delete this.mode,n._fireEvent("touchactend")},n}(y6);met.mergeOptions({touchGesture:!0,touchZoom:!0,touchPitch:!0,touchRotate:!0,touchZoomRotate:!1}),met.addOnLoadHook("addHandler","touchGesture",Eet);var Oet="__anim_player",Ret={outExpo:function(e){return 1===e?1:1-Math.pow(2,-10*e)},outQuint:function(e){return 1-Math.pow(1-e,5)},in:function(e){return Math.pow(e,2)},out:function(e){return 1-Ret.in(1-e)},inAndOut:function(e){return 3*e*e-2*e*e*e},linear:function(e){return e},upAndDown:function(e){return e<.5?Ret.inAndOut(2*e):1-Ret.inAndOut(2*(e-.5))}},Det=function(){function e(e,n){this.state=e,this.styles=n}return Object.defineProperty(e.prototype,"playState",{get:function(){return this.state.playState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"symbol",{get:function(){return this.styles.symbol},enumerable:!1,configurable:!0}),e}(),ket=function(){function e(e,n,i,o){this._animation=e,this.options=n,this._onFrame=i,this.playState="idle",this.ready=!0,this.finished=!1,this.target=o}return e.prototype._prepare=function(){var e=this.options,n=e.speed||e.duration;E2(n)&&((n=Let.speed[n])||(n=+n)),n||(n=Let.speed.normal),this.duration=n,this._framer=e.framer||Let._requestAnimFrame.bind(Let)},e.prototype.play=function(){if("idle"!==this.playState&&"paused"!==this.playState||this.target&&this.target[Oet])return this;this.target&&(this.target[Oet]=1),"idle"===this.playState&&(this.currentTime=0,this._prepare());var e=C2();if(!this.startTime){var n=this.options;this.startTime=n.startTime?n.startTime:e}return this._playStartTime=Math.max(e,this.startTime),"paused"===this.playState&&(this._playStartTime-=this.currentTime),this.playState="running",this._run(),this},e.prototype.pause=function(){return"paused"===this.playState||(this.playState="paused",this._run()),this},e.prototype.cancel=function(){return"idle"===this.playState||(this.playState="idle",this.finished=!1,this._run()),this},e.prototype.finish=function(){return"finished"===this.playState||(this.playState="finished",this.finished=!0,this._run()),this},e.prototype.reverse=function(){},e.prototype._run=function(){var e=this,n=this._onFrame,i=C2(),o=i-this._playStartTime;if(this.options.repeat&&o>=this.duration&&(this._playStartTime=i,o=0),"running"===this.playState){var s=this._animation(o,this.duration);this.playState=s.state.playState,"running"!==this.playState&&this.target&&delete this.target[Oet],"idle"===this.playState?this.startTime>i&&setTimeout(this._run.bind(this),this.startTime-i):"running"===this.playState?this._framer((function(){"running"===e.playState&&(e.currentTime=o,n&&n(s),e._run())})):"finished"===this.playState&&(this.finished=!0,n&&n(s))}else if(this.target&&delete this.target[Oet],n){"finished"===this.playState?o=this.duration:"idle"===this.playState&&(o=0);var a=this._animation(o,this.duration);a.state.playState=this.playState,n(a)}},e}(),Let={speed:{slow:2e3,normal:1e3,fast:500},_resolveStyles:function(e){if(!e)return null;function n(e){if(!Array.isArray(e))return Let._resolveStyles(e);for(var n=[],i=[],o=[],s=0;s<e.length;s++){var a=Let._resolveStyles(e[s]);a&&(n.push(a[0]),i.push(a[1]),o.push(a[2]))}return n.length?[n,i,o]:null}function i(e){var n,i=e;Array.isArray(e)||(i=T2(e)?[0,e]:e instanceof w5||e instanceof o9?[new(n=e.constructor)(0,0),e]:[e,e]);var o=i[0],s=i[1];return T2(o)&&T2(s)?o===s?null:[o,s-o,s]:Array.isArray(o)&&T2(o[0])||o instanceof o9||o instanceof w5?(Array.isArray(o)?(o=new o9(o),s=new o9(s)):(o=new(n=o.constructor)(o),s=new n(s)),o.equals(s)?null:[o,s.sub(o),s]):[o,s,s]}var o,s={},a={},h={};for(var l in e)if(e.hasOwnProperty(l)){var c=e[l];if(!c)continue;if(Array.isArray(c)&&(M2(c[0])||M2(c[1])))continue;var A=void 0;o=c,(A=!Array.isArray(o)&&o.constructor===Object||Array.isArray(o)&&o[0].constructor===Object?n(c):i(c))&&(a[l]=A[0],s[l]=A[1],h[l]=A[2])}return[a,s,h]},framing:function(e,n){n||(n={});var i,o,s,a=n.easing?Ret[n.easing]:Ret.linear;a||(a=Ret.linear),(e=Let._resolveStyles(e))&&(o=e[0],i=e[1],s=e[2]);var h=function(e,n,i){if(!n||!i)return null;var o={};for(var a in i)if(i.hasOwnProperty(a)){if(n[a]===s[a]){o[a]=n[a];continue}var l=n[a],c=i[a];if(T2(c))o[a]=l+e*c;else if(Array.isArray(c)){for(var A=[],f=0;f<c.length;f++)A.push(h(e,l[f],c[f]));o[a]=A}else{o[a]=c.constructor===Object?h(e,l,c):l instanceof w5||l instanceof o9?l.add(c.multi(e)):c}}return o};return function(e,n){var l,c;if(e<0)l={playState:"idle",delta:0},c=o;else if(e<n){var A=a(e/n);l={playState:"running",delta:A},c=h(A,o,i)}else l={playState:"finished",delta:1},c=s;return l.startStyles=o,l.destStyles=s,l.progress=e,l.remainingMs=n-e,new Det(l,c)}},_requestAnimFrame:function(e){this._frameQueue||(this._frameQueue=[]),this._frameQueue.push(e),this._a()},_a:function(){this._animationFrameId||(this._animationFrameId=_5(Let._frameFn))},_run:function(){if(this._frameQueue.length){var e=this._frameQueue;this._frameQueue=[];for(var n=0,i=e.length;n<i;n++)e[n]();this._frameQueue.length?this._animationFrameId=_5(Let._frameFn):delete this._animationFrameId}},animate:function(e,n,i,o){n||(n={});var s=Let.framing(e,n);return new ket(s,n,i,o)},_frameFn:function(){}};Let._frameFn=Let._run.bind(Let);var Fet={exports:{}};!function(e){!function(){function n(e,n,i){var o=n.x,s=n.y,a=i.x-o,h=i.y-s;if(0!==a||0!==h){var l=((e.x-o)*a+(e.y-s)*h)/(a*a+h*h);l>1?(o=i.x,s=i.y):l>0&&(o+=a*l,s+=h*l)}return(a=e.x-o)*a+(h=e.y-s)*h}function i(e,o,s,a,h){for(var l,c=a,A=o+1;A<s;A++){var f=n(e[A],e[o],e[s]);f>c&&(l=A,c=f)}c>a&&(l-o>1&&i(e,o,l,a,h),h.push(e[l]),s-l>1&&i(e,l,s,a,h))}function o(e,n){var o=e.length-1,s=[e[0]];return i(e,0,o,n,s),s.push(e[o]),s}function s(e,n,i){if(e.length<=2)return e;var s=void 0!==n?n*n:1;return e=i?e:function(e,n){for(var i,o,s,a,h,l=e[0],c=[l],A=1,f=e.length;A<f;A++)a=void 0,h=void 0,(a=(o=i=e[A]).x-(s=l).x)*a+(h=o.y-s.y)*h>n&&(c.push(i),l=i);return l!==i&&c.push(i),c}(e,s),e=o(e,s)}e.exports=s,e.exports.default=s}()}(Fet);var Net=l8(Fet.exports),zet="not find Geometry' Projection. please add Geometry to Layer and add Layer to Map",Bet=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype.animateShow=function(e,n){var i=this;void 0===e&&(e={}),this._showPlayer&&this._showPlayer.finish(),O2(e)&&(n=e={});var o=this.getCoordinates();if(0!==o.length){this._animIdx=0,this._animLenSoFar=0,this.show();var s=!!this.getShell?this.getShell().concat(this.getShell()[0]):o,a=this._getProjection();if(a){var h=a.projectCoords(s,this.options.antiMeridian);this._prjAniShowCenter=this._getPrjExtent().getCenter(),this._aniShowCenter=a.unproject(this._prjAniShowCenter);var l=e.duration||1e3,c=e.easing||"out";this.setCoordinates([]);var A=0;h.length&&(h[0]._distance=0);for(var f=1;f<h.length;f++){var d=h[f].distanceTo(h[f-1]);h[f]._distance=d,A+=d}this._tempCoord=new o9(0,0),this._tempPrjCoord=new w5(0,0);var p=this._showPlayer=Let.animate({t:l},{duration:l,easing:c},(function(e){if(i.getMap()){var a=i._drawAnimShowFrame(e.styles.t,l,A,s,h);"finished"===e.state.playState&&(delete i._showPlayer,delete i._aniShowCenter,delete i._prjAniShowCenter,delete i._animIdx,delete i._animLenSoFar,delete i._animTailRatio,delete i._tempCoord,delete i._tempPrjCoord,i.setCoordinates(o)),n&&n(e,a)}else if("finished"!==p.playState&&(p.finish(),n)){var c=i.getCoordinates();n(e,c[c.length-1])}}),this);return p.play(),p}console.error(zet)}},n.prototype._drawAnimShowFrame=function(e,n,i,o,s){if(0===e)return o[0];var a,h,l=e/n*i,c=0;for(a=this._animIdx+1,h=s.length;a<h&&!(this._animLenSoFar+(c=s[a]._distance)>l);a++)this._animLenSoFar+=c;if(this._animIdx=a-1,this._animIdx>=h-1)return this.setCoordinates(o),o[o.length-1];var A=this._animIdx,f=s[A],d=s[A+1],p=(l-this._animLenSoFar)/c;this._animTailRatio=p;var g=f.y+(d.y-f.y)*p;this._tempPrjCoord.x=f.x+(d.x-f.x)*p,this._tempPrjCoord.y=g;var v=this._tempPrjCoord,w=o[A],C=o[A+1],P=w.y+(C.y-w.y)*p;this._tempCoord.x=w.x+(C.x-w.x)*p,this._tempCoord.y=P;var T=this._tempCoord,S=!!this.getShell;if(!S&&this.options.smoothness>0){for(var I=[],E=[],O=0;O<=this._animIdx;O++)I.push(o[O]),E.push(s[O]);I.push(T,T),E.push(v,v),this.setCoordinates(I),this._setPrjCoordinates(E)}else{(I=o.slice(0,this._animIdx+1)).push(T),(E=s.slice(0,this._animIdx+1)).push(v),S?(this.setCoordinates([this._aniShowCenter].concat(I)),this._setPrjCoordinates([this._prjAniShowCenter].concat(E))):(this.setCoordinates(I),this._setPrjCoordinates(E))}return T},n.prototype._getCenterInExtent=function(e,n,i){var o=this.getExtent();if(!e.intersects(o))return null;var s=i(n,e);if(0===s.length)return null;var a=y5([0,0,0],3),h=a[0],l=a[1],c=a[2];s.forEach((function(e){Array.isArray(e)?e.forEach((function(e){e.point&&(e=e.point),h+=e.x,l+=e.y,c++})):(e.point&&(e=e.point),h+=e.x,l+=e.y,c++)}));var A=new o9(h,l)._multi(1/c);return A.count=c,A},n.prototype._getPath2DPoints=function(e,n,i){if(!z5(e))return[];var o=this.getMap(),s=!n&&this._shouldSimplify(),a=this.options.simplifyTolerance*o._getResolution(),h=Array.isArray(e[0]);if(delete this._simplified,s&&!h){var l=e.length;e=Net(e,a,!1),this._simplified=e.length<l}if(i||(i=o._getResolution()),Array.isArray(e)){var c=[],A="_glPt";if(!Array.isArray(e[0]))return c=X5(e,A),o._prjsToPointsAtRes(e,i,c);for(var f=[],d=0,p=e.length;d<p;d++){var g=e[d];c=X5(g,A);var v=o._prjsToPointsAtRes(g,i,c);f.push(v)}return f}return o._prjToPointAtRes(e,i)},n.prototype._shouldSimplify=function(){var e=this.getLayer();return e&&e.options.enableSimplify&&!e.options.enableAltitude&&this.options.enableSimplify&&!this._showPlayer},n.prototype._setPrjCoordinates=function(e){this._prjCoords=e,this.onShapeChanged()},n.prototype._getPrjCoordinates=function(){return this._verifyProjection(),!this._prjCoords&&this._getProjection()&&(this._prjCoords=this._projectCoords(this._coordinates)),this._prjCoords},n.prototype._updateCache=function(){this._clearCache(),this._getProjection()&&this._prjCoords&&(this._coordinates=this._unprojectCoords(this._getPrjCoordinates()))},n.prototype._clearProjection=function(){this._prjCoords=null,e.prototype._clearProjection.call(this)},n.prototype._projectCoords=function(e){var n=this._getProjection();return n?n.projectCoords(e,this.options.antiMeridian):[]},n.prototype._unprojectCoords=function(e){var n=this._getProjection();return n?n.unprojectCoords(e):[]},n.prototype._computeCenter=function(){var e=this._coordinates;if(!z5(e))return null;for(var n=0,i=0,o=0,s=e.length,a=0;a<s;a++)e[a]&&T2(e[a].x)&&T2(e[a].y)&&(n+=e[a].x,i+=e[a].y,o++);return new o9(n/o,i/o)},n.prototype._computeExtent=function(e){var n,i=this._coordinates;if(!z5(i))return null;var o=[i];return this.hasHoles&&this.hasHoles()&&(n=o.push).call.apply(n,v5([o],y5(this.getHoles()),!1)),this._coords2Extent(o,this._getProjection())},n.prototype._computePrjExtent=function(e){var n,i=[this._getPrjCoordinates()];return this.hasHoles&&this.hasHoles()&&(n=i.push).call.apply(n,v5([i],y5(this._getPrjHoles()),!1)),this._coords2Extent(i)},n.prototype._get2DLength=function(){for(var e=this._getPath2DPoints(this._getPrjCoordinates(),!0),n=0,i=1,o=e.length;i<o;i++)n+=e[i].distanceTo(e[i-1]);return n},n.prototype._hitTestTolerance=function(){var n,i=this._getInternalSymbol();if(Array.isArray(i)){n=0;for(var o=0;o<i.length;o++)T2(i[o].lineWidth)&&i[o].lineWidth>n&&(n=i[o].lineWidth)}else n=i.lineWidth;return e.prototype._hitTestTolerance.call(this)+(T2(n)?n/2:1.5)},n.prototype._coords2Extent=function(e,n){if(!e||0===e.length||Array.isArray(e[0])&&0===e[0].length)return null;for(var i=new y9(n),o=0,s=e.length;o<s;o++)for(var a=0,h=e[o].length;a<h;a++)i._combine(e[o][a]);return i},n}(net);Bet.mergeOptions({smoothness:!1,enableClip:!0,enableSimplify:!0,simplifyTolerance:2,symbol:{lineColor:"#000",lineWidth:2,lineOpacity:1,polygonFill:"#fff",polygonOpacity:1,opacity:1}});var Het="Polygon",jet=function(e){function n(n,i){var o=e.call(this,i)||this;return o.type="Polygon",n&&o.setCoordinates(n),o}return p5(n,e),n.prototype.getOutline=function(){return this._getPainter()?new n(this.getExtent().toArray(),{symbol:{lineWidth:1,lineColor:"6b707b"}}):null},n.prototype.setCoordinates=function(e){if(!e)return this._coordinates=null,this._holes=null,this._projectRings(),this;var n=o9.toCoordinates(e),i=n.length;if(Array.isArray(n[0]))if(this._coordinates=this._trimRing(n[0]),i>1){for(var o=[],s=1;s<i;s++)n[s]&&o.push(this._trimRing(n[s]));this._holes=o}else this._holes=null;else this._coordinates=this._trimRing(n);return this._projectRings(),this},n.prototype.getCoordinates=function(){if(!this._coordinates)return[];for(var e=this.getHoles(),n=[this._copyAndCloseRing(this._coordinates)],i=0,o=e.length;i<o;i++)n.push(this._copyAndCloseRing(e[i]));return n},n.prototype.getCenterInExtent=function(e){return this._getCenterInExtent(e,this.getShell(),J7)},n.prototype.getShell=function(){return this._coordinates||[]},n.prototype.getHoles=function(){return this._holes||[]},n.prototype.hasHoles=function(){return this.getHoles().length>0},n.prototype._projectRings=function(){this.getMap()?(this._prjCoords=this._projectCoords(this._coordinates),this._prjHoles=this._projectCoords(this._holes),this.onShapeChanged()):this.onShapeChanged()},n.prototype._setPrjCoordinates=function(e){this._prjCoords=e,this.onShapeChanged()},n.prototype._cleanRing=function(e){for(var n=e.length-1;n>=0;n--)e[n]||e.splice(n,1)},n.prototype._checkRing=function(e){if(this._cleanRing(e),!e||!z5(e))return!1;var n=e[e.length-1],i=!0;return e[0].x===n.x&&e[0].y===n.y||(i=!1),i},n.prototype._trimRing=function(e){var n=this._checkRing(e);return z5(e)&&n&&e.splice(e.length-1,1),e},n.prototype._copyAndCloseRing=function(e){e=e.slice(0);var n=this._checkRing(e);return z5(e)&&!n?(e.push(e[0].copy()),e):e},n.prototype._getPrjShell=function(){return this.getJSONType()===Het?this._getPrjCoordinates():(this._verifyProjection(),this._getProjection()&&!this._prjShell&&(this._prjShell=this._projectCoords(this._getShell?this._getShell():this.getShell())),this._prjShell)},n.prototype._getPrjHoles=function(){var e=this._getProjection();return this._verifyProjection(),e&&!this._prjHoles&&(this._prjHoles=this._projectCoords(this.getHoles())),this._prjHoles},n.prototype._computeGeodesicLength=function(e){var n=this.getCoordinates();if(!z5(n))return 0;for(var i=0,o=0,s=n.length;o<s;o++)i+=e.measureLength(n[o]);return i},n.prototype._computeGeodesicArea=function(e){var n=this.getCoordinates();if(!z5(n))return 0;for(var i=e.measureArea(n[0]),o=1,s=n.length;o<s;o++)i-=e.measureArea(n[o]);return i},n.prototype._updateCache=function(){e.prototype._updateCache.call(this),this._prjHoles&&(this._holes=this._unprojectCoords(this._getPrjHoles()))},n.prototype._clearCache=function(){return delete this._prjShell,e.prototype._clearCache.call(this)},n.prototype._clearProjection=function(){this._prjHoles&&(this._prjHoles=null),this._prjShell&&(this._prjShell=null),e.prototype._clearProjection.call(this)},n}(Bet);function Uet(e){return function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype.getCoordinates=function(){return this._coordinates},n.prototype.setCoordinates=function(e){var n=e instanceof o9?e:new o9(e);if(this._translateRotatePivot(n),this._coordinates=n,!this.getMap())return this._dirtyCoords=!0,this.onPositionChanged(),this;var i=this._getProjection();return this._setPrjCoordinates(i.project(this._coordinates)),this},n.prototype._getCenter2DPoint=function(e){var n=this.getMap();if(!n)return null;var i=this._getPrjCoordinates();return i?(e||(e=n._getResolution()),n._prjToPointAtRes(i,e)):null},n.prototype._getPrjCoordinates=function(){var e=this._getProjection();return this._verifyProjection(),!this._pcenter&&e&&this._coordinates&&(this._pcenter=e.project(this._coordinates)),this._pcenter},n.prototype._setPrjCoordinates=function(e){this._pcenter=e,this.onPositionChanged()},n.prototype._updateCache=function(){this._clearCache();var e=this._getProjection();this._pcenter&&e&&(this._coordinates=e.unproject(this._pcenter))},n.prototype._clearProjection=function(){this._pcenter=null,e.prototype._clearProjection.call(this)},n.prototype._computeCenter=function(){return this._coordinates?this._coordinates.copy():null},n}(e)}jet.registerJSONType(Het);var Get=new v9,Vet=function(e){function n(n,i){var o=e.call(this,i)||this;return o.type="Point",o.isPoint=!0,n&&o.setCoordinates(n),o}return p5(n,e),n.prototype.getOutline=function(){var e=this.getCoordinates(),i=this.getContainerExtent(),o=this.getMap().coordToContainerPoint(e);return new n(e,{symbol:{markerType:"square",markerWidth:i.getWidth(),markerHeight:i.getHeight(),markerLineWidth:1,markerLineColor:"6b707b",markerFill:"rgba(0, 0, 0, 0)",markerDx:i.xmin-(o.x-i.getWidth()/2),markerDy:i.ymin-(o.y-i.getHeight()/2)}})},n.prototype.setSymbol=function(n){return delete this._fixedExtent,e.prototype.setSymbol.call(this,n)},n.prototype._getSizeSymbol=function(e){for(var n,i={},o=!1,s=!1,a=0;a<q7.length;a++){M2(h=e[q7[a]])||(!o&&_4(h)&&(o=!0,s=!0),i[q7[a]]=h)}for(a=0;a<Z7.length;a++){var h;M2(h=e[Z7[a]])||(!o&&_4(h)&&(o=!0),i[Z7[a]]=h)}return o?(n=U4(i,this),s&&(n._dynamic=!0)):n=i,n},n.prototype._setExternSymbol=function(n){return this._symbol||delete this._fixedExtent,e.prototype._setExternSymbol.call(this,n)},n.prototype._isDynamicSize=function(){return this._sizeSymbol&&this._sizeSymbol._dynamic},n.prototype._getFixedExtent=function(){if(this._fixedExtent&&!this._isDynamicSize())return this._fixedExtent;this._fixedExtent=this._fixedExtent||new v9,this._fixedExtent.set(null,null,null,null);var e=this._sizeSymbol;if(!e)return this._fixedExtent;var n=this.getLayer()&&this.getLayer().getRenderer(),i=n&&n.resources,o=this.getTextDesc();if(Array.isArray(e)){Get.set(1/0,1/0,-1/0,-1/0);for(var s=0;s<e.length;s++)e[s]&&this._fixedExtent._combine(H7(Get,e[s],i,o&&o[s]))}else this._fixedExtent=H7(this._fixedExtent,e,i,o);return this._fixedExtent},n.prototype._isVectorMarker=function(){var e=this._getInternalSymbol();return!Array.isArray(e)&&G7(e)},n.prototype._canEdit=function(){var e=this._getInternalSymbol();return!Array.isArray(e)&&(G7(e)||V7(e)||U7(e))},n.prototype._containsPoint=function(n,i){var o=this.getContainerExtent();return i&&(o=o.expand(i)),!!o.contains(n)&&(!this.options.hitTestForEvent||e.prototype._containsPoint.call(this,n,i))},n.prototype._computeExtent=function(){return Wet.call(this,"getCenter")},n.prototype._computePrjExtent=function(){return Wet.call(this,"_getPrjCoordinates")},n.prototype._computeGeodesicLength=function(){return 0},n.prototype._computeGeodesicArea=function(){return 0},n.prototype._getSprite=function(e,n){return this._getPainter()?this._getPainter().getSprite(e,n):new ztt(this).getSprite(e,n)},n}(Uet(net));function Wet(e){var n=this[e]();return n?new y9(n,n,this._getProjection()):null}Vet.mergeOptions({symbol:{markerType:"path",markerPath:[{path:"M8 23l0 0 0 0 0 0 0 0 0 0c-4,-5 -8,-10 -8,-14 0,-5 4,-9 8,-9l0 0 0 0c4,0 8,4 8,9 0,4 -4,9 -8,14z M3,9 a5,5 0,1,0,0,-0.9Z",fill:"#DE3333"}],markerPathWidth:16,markerPathHeight:23,markerWidth:24,markerHeight:34},hitTestForEvent:!1,collision:!0}),Vet.registerJSONType("Marker");var qet=function(e){function n(n,i){var o=e.call(this,i)||this;return o.type="LineString",n&&o.setCoordinates(n),o}return p5(n,e),n.prototype.getOutline=function(){return jet.prototype.getOutline.call(this)},n.prototype.setCoordinates=function(e){return e?(this._coordinates=o9.toCoordinates(e),this.getMap()?this._setPrjCoordinates(this._projectCoords(this._coordinates)):this.onShapeChanged(),this):(this._coordinates=null,this._setPrjCoordinates(null),this)},n.prototype.getCoordinates=function(){return this._coordinates||[]},n.prototype.getCenterInExtent=function(e){return this._getCenterInExtent(e,this.getCoordinates(),X7)},n.prototype._computeGeodesicLength=function(e){return e.measureLength(this.getCoordinates())},n.prototype._computeGeodesicArea=function(){return 0},n}(Bet);qet.mergeOptions({arrowStyle:null,arrowPlacement:"vertex-last"}),qet.registerJSONType("LineString");var Zet=new v9,Qet=function(e){function n(n,i){var o=e.call(this,i)||this;return o.type="GeometryCollection",o.setGeometries(n),o}return p5(n,e),n.prototype.getContainerExtent=function(e){var n=e||new v9;return this.forEach((function(e){n._combine(e.getContainerExtent(Zet))})),n},n.prototype.setGeometries=function(e){for(var n=this._checkGeometries(e||[]),i=this._getSymbol(),o=this.config(),s=this.getProperties(),a=n.length-1;a>=0;a--)n[a]._initOptions(o),n[a]._setParent(this),n[a]._setEventParent(this),i&&n[a].setSymbol(i),s&&n[a].setProperties(s);return this._geometries=n,this.getLayer()&&(this._bindGeometriesToLayer(),this.onShapeChanged()),this},n.prototype.getGeometries=function(){return this._geometries||[]},n.prototype.forEach=function(e,n){for(var i=this.getGeometries(),o=0,s=i.length;o<s;o++)i[o]&&(n?e.call(n,i[o],o):e(i[o],o));return this},n.prototype.filter=function(e,i){if(!e)return new n;var o=[],s=O2(e),a=s?e:T4(e);return this.forEach((function(e){var n=s?e:N4(e);(i?a.call(i,n):a(n))&&o.push(e)}),this),new n(o)},n.prototype.translate=function(e){if(!e)return this;if(this.isEmpty())return this;var n=arguments;return this.forEach((function(e){e&&e.translate&&e.translate.apply(e,n)})),this},n.prototype.isEmpty=function(){return!z5(this.getGeometries())},n.prototype.remove=function(){return this.forEach((function(e){e._unbind()})),net.prototype.remove.apply(this,arguments)},n.prototype.show=function(){return this.options.visible=!0,this.forEach((function(e){e.show()})),this},n.prototype.hide=function(){return this.options.visible=!1,this.forEach((function(e){e.hide()})),this},n.prototype.onConfig=function(e){this.forEach((function(n){n.config(e)}))},n.prototype.getSymbol=function(){var n=e.prototype.getSymbol.call(this);if(!n){var i=[],o=!1;this.forEach((function(e){e.getSymbol()&&!o&&(o=!0),i.push(e.getSymbol())})),o&&(n={children:i})}return n},n.prototype.setSymbol=function(e){var n=this;if(e&&e.children)this._symbol=null,this.forEach((function(i,o){i._eventSymbolProperties=n._eventSymbolProperties,i.setSymbol(e.children[o])}));else{var i=this._prepareSymbol(e);this._symbol=i,this.forEach((function(e){e._eventSymbolProperties=n._eventSymbolProperties,e.setSymbol(i)}))}return this.onSymbolChanged(),this},n.prototype._setExternSymbol=function(e){return e=this._prepareSymbol(e),this._externSymbol=e,this.forEach((function(n){n._setExternSymbol(e)})),this.onSymbolChanged(),this},n.prototype._bindLayer=function(){e.prototype._bindLayer.apply(this,arguments),this._bindGeometriesToLayer()},n.prototype._bindGeometriesToLayer=function(){var e=this.getLayer();this.forEach((function(n){n._bindLayer(e)}))},n.prototype._checkGeometries=function(e){for(var n=[],i=0,o=(e=Array.isArray(e)?e:[e]).length;i<o;i++){var s=e[i];s&&(this._checkGeo(s)?Yet(s)?console.error(s," is GeometryCollection sub class,it Cannot be placed in GeometryCollection"):n.push(s):console.error("The geometry added to collection is invalid. Index: "+i))}return n},n.prototype._checkGeo=function(e){return e instanceof net},n.prototype._updateCache=function(){this._clearCache(),this.isEmpty()||this.forEach((function(e){e&&e._updateCache&&e._updateCache()}))},n.prototype._removePainter=function(){this._painter&&this._painter.remove(),delete this._painter,this.forEach((function(e){e._removePainter()}))},n.prototype._computeCenter=function(e){if(!e||this.isEmpty())return null;for(var n=0,i=0,o=0,s=this.getGeometries(),a=0,h=s.length;a<h;a++)if(s[a]){var l=s[a]._computeCenter(e);l&&(n+=l.x,i+=l.y,o++)}return 0===o?null:new o9(n/o,i/o)},n.prototype._containsPoint=function(e,n){if(this.isEmpty())return!1;delete this._pickGeometryIndex;for(var i=this.getGeometries(),o=0,s=i.length;o<s;o++)if(i[o]._containsPoint(e,n))return this._pickGeometryIndex=o,!0;return!1},n.prototype._hitTestTolerance=function(){for(var e=this.getGeometries(),n=0,i=0,o=e.length;i<o;i++){var s=e[i]._hitTestTolerance();n=Math.max(n,s)}return n},n.prototype._computeExtent=function(e){return Xet.call(this,e,"_computeExtent")},n.prototype._computePrjExtent=function(e){return Xet.call(this,e,"_computePrjExtent")},n.prototype._computeGeodesicLength=function(e){if(!e||this.isEmpty())return 0;for(var n=this.getGeometries(),i=0,o=0,s=n.length;o<s;o++)n[o]&&(i+=n[o]._computeGeodesicLength(e));return i},n.prototype._computeGeodesicArea=function(e){if(!e||this.isEmpty())return 0;for(var n=this.getGeometries(),i=0,o=0,s=n.length;o<s;o++)n[o]&&(i+=n[o]._computeGeodesicArea(e));return i},n.prototype._exportGeoJSONGeometry=function(){var e=[];if(!this.isEmpty())for(var n=this.getGeometries(),i=0,o=n.length;i<o;i++)n[i]&&e.push(n[i]._exportGeoJSONGeometry());return{type:"GeometryCollection",geometries:e}},n.prototype._toJSON=function(e){e=P2({},e);var n,i={type:"Feature",geometry:{type:"GeometryCollection",geometries:this.getGeometries().filter((function(e){return e&&e._toJSON})).map((function(e){var n=e._toJSON();return n.subType?n:e._exportGeoJSONGeometry()}))}},o=this.getId();return M2(o)||(i.id=o),(M2(e.properties)||e.properties)&&(n=this._exportProperties()),i.properties=n,e.feature=i,e},n.prototype._clearProjection=function(){if(!this.isEmpty())for(var e=this.getGeometries(),n=0,i=e.length;n<i;n++)e[n]&&e[n]._clearProjection()},n.prototype._getConnectPoints=function(){var e=this.getExtent();return[new o9(e.xmin,e.ymax),new o9(e.xmax,e.ymin),new o9(e.xmin,e.ymin),new o9(e.xmax,e.ymax)]},n.prototype._getExternalResources=function(){if(this.isEmpty())return[];for(var e,n,i=this.getGeometries(),o=[],s={},a=0,h=i.length;a<h;a++)if(i[a])for(var l=0,c=(e=V4(i[a]._getInternalSymbol())).length;l<c;l++)s[n=e[l].join()]||(o.push(e[l]),s[n]=1);return o},n.prototype.startEdit=function(e){var n=this;if(this.isEmpty())return this;e||(e={}),e.symbol&&(this._originalSymbol=this.getSymbol(),this.setSymbol(e.symbol)),this._draggbleBeforeEdit=this.options.draggable,this.config("draggable",!1),this._recordVisible();for(var i=this.getGeometries(),o=0,s=i.length;o<s;o++)i[o].startEdit(e);this._editing=!0;var a=this.getLayer();return a&&"canvas"===a.options.renderer&&this.hide(),setTimeout((function(){n.fire("editstart")}),1),this},n.prototype.endEdit=function(){if(this.isEmpty())return this;this._recoveryVisible();for(var e=this.getGeometries(),n=0,i=e.length;n<i;n++)e[n].endEdit();return this._originalSymbol&&(this.setSymbol(this._originalSymbol),delete this._originalSymbol),this._editing=!1,this.show(),this.config("draggable",this._draggbleBeforeEdit),this.fire("editend"),this},n.prototype.isEditing=function(){return!!this._editing},n}(net);function Xet(e,n){if(this.isEmpty())return null;for(var i=new y9,o=this.getGeometries(),s=0,a=o.length;s<a;s++)if(o[s]){var h=o[s][n](e);h&&i._combine(h)}return i}function Yet(e){return e instanceof Qet}Qet.registerJSONType("GeometryCollection");var Jet=function(e){function n(n,i,o,s){var a=e.call(this,null,s)||this;return a.GeometryType=n,a.type=i,a._initData(o),a}return p5(n,e),n.prototype.getCoordinates=function(){for(var e=[],n=this.getGeometries(),i=0,o=n.length;i<o;i++){var s=n[i];e.push(s.getShell&&"Polygon"!==s.getJSONType()?[s.getShell()]:s.getCoordinates())}return e},n.prototype.setCoordinates=function(e){for(var n=[],i=0,o=(e=e||[]).length;i<o;i++){var s=new this.GeometryType(e[i],this.config());n.push(s)}return this.setGeometries(n),this},n.prototype._initData=function(e){(e=e||[]).length&&(e[0]instanceof this.GeometryType?this.setGeometries(e):this.setCoordinates(e))},n.prototype._checkGeo=function(e){return e instanceof this.GeometryType},n.prototype._exportGeoJSONGeometry=function(){var e=this.getCoordinates(),n=o9.toNumberArrays(e);return{type:this.getType(),coordinates:n}},n.prototype._toJSON=function(e){return{feature:this.toGeoJSON(e)}},n}(Qet),Ket=function(e){function n(n,i){return e.call(this,Vet,"MultiPoint",n,i)||this}return p5(n,e),n.prototype.findClosest=function(e){if(!e)return null;var n=this.getCoordinates(),i=null,o=1/0;return n.forEach((function(n){var s=function(e,n){var i=n.x-e.x,o=n.y-e.y;return Math.sqrt(i*i+o*o)}(n,e);s<o&&(i=n,o=s)})),i},n}(Jet);Ket.registerJSONType("MultiPoint");var $et=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype.getCenterInExtent=function(e){var n=this.getGeometries(),i=y5([0,0,0],3),o=i[0],s=i[1],a=i[2];return n.forEach((function(n){var i=n.getCenterInExtent(e);i&&(o+=i.x*i.count,s+=i.y*i.count,a+=i.count)})),0===a?null:new o9(o,s)._multi(1/a)},n}(Jet),tnt=function(e){function n(n,i){return e.call(this,qet,"MultiLineString",n,i)||this}return p5(n,e),n}($et);tnt.registerJSONType("MultiLineString");var ent=function(e){function n(n,i){return e.call(this,jet,"MultiPolygon",n,i)||this}return p5(n,e),n}($et);ent.registerJSONType("MultiPolygon");var nnt,int={Marker:Vet,LineString:qet,Polygon:jet,MultiPoint:Ket,MultiLineString:tnt,MultiPolygon:ent},rnt="geojson-fetch-worker-page-async",ont=function(e){function n(){return e.call(this,rnt)||this}return p5(n,e),n.prototype._sendMsg=function(e,n,i){var o=this;this.send(e,[],(function(s,a){s?i(s):o._pageFeatures(e,a,n,i)}),e.workerId)},n.prototype._fetchGeoJSON=function(e,n,i,o){void 0===i&&(i=[]);var s=P2({},n);s.type="fetchdata",s.url=e,this._sendMsg(s,i,o)},n.prototype._pageFeatures=function(e,n,i,o){if(i.push(n),0!==n.length){var s=P2({},e);s.type="pagefeatures",this._sendMsg(s,i,o)}else o(null,i)},n}(p7);k8(rnt,(function(){return"\nfunction (exports) {\n    const resultMap = {};\n\n    function handleResult(msg, postResponse) {\n        const data = msg.data || {};\n        const { taskId } = data;\n        const features = resultMap[taskId];\n        if (!features) {\n            postResponse('not find geojson dataset the taskId:' + taskId);\n            return;\n        }\n        if (features.length === 0) {\n            delete resultMap[taskId];\n            postResponse(null, []);\n            return;\n        }\n        const pageSize = data.pageSize || 2000;\n        const pageFeatures = features.slice(0, pageSize);\n        resultMap[taskId] = features.slice(pageSize, Infinity);\n        postResponse(null, pageFeatures);\n    }\n    //worker init\n    exports.initialize = function () {\n        // console.log(\"geojson fetch init\");\n    };\n    //recive message\n    exports.onmessage = function (msg, postResponse) {\n        const { taskId, type, url } = msg.data || {};\n        if (!taskId) {\n            postResponse('not find task id for get geojson dataset,taskId=' + taskId);\n            return;\n        }\n        if (type === 'fetchdata') {\n            if (!url) {\n                postResponse('url is null,url=' + url);\n                return;\n            }\n            fetch(url).then(res => res.json()).then(geojson => {\n                let features;\n                if (Array.isArray(geojson)) {\n                    features = geojson;\n                } else if (geojson.features) {\n                    features = geojson.features;\n                } else {\n                    features = [geojson];\n                }\n                resultMap[taskId] = features;\n                handleResult(msg, postResponse);\n            }).catch(errror => {\n                postResponse(errror.message);\n            });\n        } else if (type === 'pagefeatures') {\n            handleResult(msg, postResponse);\n        } else {\n            postResponse('not support task type:' + type);\n        }\n    };\n}"}));var snt={toGeometry:function(e,n){if(E2(e)&&(e=I5(e)),Array.isArray(e)){for(var i=[],o=0,s=e.length;o<s;o++){var a=snt._convert(e[o],n);Array.isArray(a)?E5(i,a):i.push(a)}return i}return snt._convert(e,n)},toGeometryAsync:function(e,n,i){return void 0===i&&(i=2e3),E2(e)&&(e=I5(e)),new Promise((function(o){var s,a=[];if(e&&(Array.isArray(e)||Array.isArray(e.features))){var h=T2(i)?Math.round(i):2e3,l=e.features||e,c=Math.ceil(l.length/h),A=1;(s={count:c,run:function(){var e=l.slice((A-1)*h,A*h),i=snt.toGeometry(e,n);return A++,i}},$8(),new Promise((function(e,n){if(s)if(O2(s)&&(s={count:1,run:s}),s.run)if(M2(s.count)&&(s.count=1),s.count=Math.ceil(s.count),T2(s.count)){var i=s;i.results=[],q8.push(i),i.resolve=e}else n(new Error("task.count is not number"));else n(new Error("task.run is null"));else n(new Error("task is null"))}))).then((function(e){for(var n=0,i=e.length;n<i;n++){var s=e[n];s&&(Array.isArray(s)?E5(a,s):a.push(s))}o(a)}))}else{var f=snt.toGeometry(e,n);o(f)}}))},_convert:function(e,n){if(!e||M2(e.type))return null;var i=e.type;if("Feature"===i){var o=snt._convert(e.geometry);return o?(o.setId(e.id),o.setProperties(e.properties),n&&n(o),o):null}if("FeatureCollection"===i){var s=e.features;return s?snt.toGeometry(s,n):null}if(["Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon"].indexOf(i)>=0){var a=new int["Point"===i?"Marker":i](e.coordinates);return n&&n(a),a}if("GeometryCollection"===i){var h=e.geometries;if(!z5(h)){var l=new Qet;return n&&n(l),l}for(var c=[],A=h.length,f=0;f<A;f++)c.push(h[f].subType?net.getJSONClass(h[f].subType).fromJSON(h[f]):snt._convert(h[f]));a=new Qet(c);return n&&n(a),a}return null},_isGeoJSON:function(e){if(!e)return!1;if(e=e||{},Array.isArray(e)&&e.length)return snt.isGeoJSON(e[0]);var n=e.type;if(!n)return!1;if(-1===n3.indexOf(n))return!1;var i=e.features,o=e.geometries,s=e.geometry,a=e.coordinates;if(a&&Array.isArray(a))return!0;if(Array.isArray(o))return!0;if(Array.isArray(i))return!0;if(s){var h=s.coordinates;if(h&&Array.isArray(h))return!0}return!1},fetch:function(e,n){return void 0===n&&(n=2e3),new Promise((function(i,o){if(e&&E2(e)){var s=P2({pageSize:2e3},{pageSize:n});e=J5(e),nnt||(nnt=new ont);var a=nnt.workers.length,h=Math.floor(Math.random()*a);h=Math.min(a-1,h),s.workerId=h,s.taskId=S5(),nnt._fetchGeoJSON(e,s,[],(function(e,n){if(e)o(e);else{var s=[];n.forEach((function(e){for(var n=0,i=e.length;n<i;n++)s.push(e[n])})),i({type:"FeatureCollection",features:s})}}))}else o("url is error,It should be string")}))}},ant=function(e){function n(n,i,o){var s=e.call(this,null,o)||this;return n&&s.setCoordinates(n),s._radius=i,s}return p5(n,e),n.fromJSON=function(e){var i=e.feature,o=new n(e.coordinates,e.radius,e.options);return o.setProperties(i.properties),o},n.prototype.getRadius=function(){return this._radius},n.prototype.setRadius=function(e){return this._radius=e,this.onShapeChanged(),this},n.prototype.getShell=function(){for(var e,n,i,o=this._getMeasurer(),s=this.getCoordinates(),a=this.options.numberOfShellPoints,h=this.getRadius(),l=[],c=0,A=a-1;c<A;c++){e=360*c/A*Math.PI/180,n=h*Math.cos(e),i=h*Math.sin(e);var f=o.locate(s,n,i);f.z=s.z,l.push(f)}return l.push(l[0]),l},n.prototype.getHoles=function(){return[]},n.prototype.animateShow=function(){return this.show()},n.prototype._containsPoint=function(n,i){var o=this.getMap();if(o.getPitch())return e.prototype._containsPoint.call(this,n,i);var s=o._pointToContainerPoint(this._getCenter2DPoint()),a=this.getSize(),h=this._hitTestTolerance()+(i||0),l=s.add(a.width/2,a.height/2);return ttt(n,s,l,h)},n.prototype._computePrjExtent=function(e){var n=this._getMinMax(e);if(!n)return null;var i=this._getPrjCoordinates(),o=n.map((function(n){return e.project(n)})),s=o[1].x-i.x,a=o[3].y-i.y;return new y9(i.add(o[0].x-i.x,o[2].y-i.y),i.add(s,a))},n.prototype._computeExtent=function(e){var n=this._getMinMax(e);return n?new y9(n[0].x,n[2].y,n[1].x,n[3].y,this._getProjection()):null},n.prototype._getMinMax=function(e){if(!e||!this._coordinates||M2(this._radius))return null;var n=this._radius;return[e.locate(this._coordinates,-n,0),e.locate(this._coordinates,n,0),e.locate(this._coordinates,0,n),e.locate(this._coordinates,0,-n)]},n.prototype._computeGeodesicLength=function(){return M2(this._radius)?0:2*Math.PI*this._radius},n.prototype._computeGeodesicArea=function(){return M2(this._radius)?0:Math.PI*Math.pow(this._radius,2)},n.prototype._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:o9.toNumberArrays([this.getShell()])}},n.prototype._toJSON=function(e){var n=this.getCenter(),i=P2({},e);i.geometry=!1;var o=this.toGeoJSON(i);return o.geometry={type:"Polygon"},{feature:o,subType:"Circle",coordinates:[n.x,n.y],radius:this.getRadius()}},n}(Uet(jet));function hnt(e){return e*e*e*e}ant.mergeOptions({numberOfShellPoints:60}),ant.registerJSONType("Circle");var lnt=function(e){function n(n,i,o,s){var a=e.call(this,null,s)||this;return n&&a.setCoordinates(n),a.width=i,a.height=o,a}return p5(n,e),n.fromJSON=function(e){var i=e.feature,o=new n(e.coordinates,e.width,e.height,e.options);return o.setProperties(i.properties),o},n.prototype.getWidth=function(){return this.width},n.prototype.setWidth=function(e){return this.width=e,this.onShapeChanged(),this},n.prototype.getHeight=function(){return this.height},n.prototype.setHeight=function(e){return this.height=e,this.onShapeChanged(),this},n.prototype.getShell=function(){return this.isRotated()?this.getRotatedShell():this._getShell()},n.prototype._getShell=function(){var e,n,i,o,s=this._getMeasurer(),a=this.getCoordinates(),h=this.options.numberOfShellPoints-1,l=this.getWidth(),c=this.getHeight(),A=[],f=Math.pow(l/2,2)*Math.pow(c/2,2),d=Math.pow(l/2,2),p=Math.pow(c/2,2),g=[];if(Math.max(l/c,c/l)>2){var v=function(e){for(var n=[],i=[],o=0;o<e;o++)i.push(hnt(o/e));var s=i.map((function(e){return e})).reverse(),a=[];E5(a,i,s,i,s);for(var h=0,l=(o=0,a.length);o<l;o+=4)n.push(a[o]),h+=a[o];return{fs:n,sum:h}}(h),w=v.fs,C=360/v.sum,P=0;c>l&&(P=90);for(var T=0,S=0,I=w.length;S<I;S++)g.push((T+=C*w[S])+P)}else for(S=0;S<h;S++){g.push(T=360*S/h)}this.options.debug&&console.log(g);for(S=0;S<g.length;S++){n=(e=g[S])*Math.PI/180,i=Math.sqrt(f/(d*Math.pow(Math.tan(n),2)+p)),o=Math.sqrt(f/(p*Math.pow(1/Math.tan(n),2)+d)),e>90&&e<270&&(i*=-1),e>180&&e<360&&(o*=-1);var E=s.locate(a,i,o);E.z=a.z,A.push(E)}return A.push(A[0].copy()),A},n.prototype._getPrjShell=function(){var n=e.prototype._getPrjShell.call(this);return this._rotatePrjCoordinates(n)},n.prototype.getHoles=function(){return[]},n.prototype.animateShow=function(){return this.show()},n.prototype._containsPoint=function(n,i){var o=this.getMap();if(o.isTransforming())return e.prototype._containsPoint.call(this,n,i);var s=o.getProjection(),a=this._hitTestTolerance()+(i||0),h=s.projectCoords([this._coordinates,o.locate(this._coordinates,this.getWidth()/2,this.getHeight()/2)],this.options.antiMeridian);return ttt(n,o.prjToContainerPoint(h[0]),o.prjToContainerPoint(h[1]),a)},n.prototype._computePrjExtent=function(){return this.isRotated()?this._computeRotatedPrjExtent():ant.prototype._computePrjExtent.apply(this,arguments)},n.prototype._computeExtent=function(){return ant.prototype._computeExtent.apply(this,arguments)},n.prototype._getMinMax=function(e){if(!e||!this._coordinates||M2(this.width)||M2(this.height))return null;var n=this.getWidth(),i=this.getHeight();return[e.locate(this._coordinates,-n/2,0),e.locate(this._coordinates,n/2,0),e.locate(this._coordinates,0,-i/2),e.locate(this._coordinates,0,i/2)]},n.prototype._computeGeodesicLength=function(){return M2(this.width)||M2(this.height)?0:2*Math.PI*(this.width>this.height?this.width:this.height)/2-4*Math.abs(this.width-this.height)},n.prototype._computeGeodesicArea=function(){return M2(this.width)||M2(this.height)?0:Math.PI*this.width*this.height/4},n.prototype._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:o9.toNumberArrays([this.getShell()])}},n.prototype._toJSON=function(e){var n=P2({},e),i=this.getCenter();n.geometry=!1;var o=this.toGeoJSON(n);return o.geometry={type:"Polygon"},{feature:o,subType:"Ellipse",coordinates:[i.x,i.y],width:this.getWidth(),height:this.getHeight()}},n}(Uet(jet));lnt.mergeOptions({numberOfShellPoints:81}),lnt.registerJSONType("Ellipse");var unt=function(e){function n(n,i,o,s){var a=e.call(this,null,s)||this;return n&&a.setCoordinates(n),a._width=i,a._height=o,a}return p5(n,e),n.fromJSON=function(e){var i=e.feature,o=new n(e.coordinates,e.width,e.height,e.options);return o.setProperties(i.properties),o},n.prototype.getCoordinates=function(){return this._coordinates},n.prototype.setCoordinates=function(e){var n=e instanceof o9?e:new o9(e);if(this._translateRotatePivot(n),this._coordinates=n,!this._coordinates||!this.getMap())return this.onPositionChanged(),this;var i=this._getProjection();return this._setPrjCoordinates(i.project(this._coordinates)),this},n.prototype.getWidth=function(){return this._width},n.prototype.setWidth=function(e){return this._width=e,this.onShapeChanged(),this},n.prototype.getHeight=function(){return this._height},n.prototype.setHeight=function(e){return this._height=e,this.onShapeChanged(),this},n.prototype.getShell=function(){return this.isRotated()?this.getRotatedShell():this._getShell()},n.prototype._getShell=function(){var e=this._getMeasurer(),n=this._coordinates,i=this.getMap(),o=1,s=-1;if(i){var a=i.getFullExtent();a.left>a.right&&(o=-1),a.bottom>a.top&&(s=1)}var h=[];h.push(n);var l=e.locate(n,o*this._width,0);l.z=n.z,h.push(l);var c=e.locate(n,o*this._width,s*this._height);c.z=n.z,h.push(c);var A=e.locate(n,0,s*this._height);return h.push(A),A.z=n.z,h.push(n),h},n.prototype.getHoles=function(){return[]},n.prototype.animateShow=function(){return this.show()},n.prototype._getPrjCoordinates=function(){var e=this._getProjection();return this._verifyProjection(),!this._pnw&&e&&this._coordinates&&(this._pnw=e.project(this._coordinates)),this._pnw},n.prototype._setPrjCoordinates=function(e){this._pnw=e,this.onPositionChanged()},n.prototype._getPrjShell=function(){var n=e.prototype._getPrjShell.call(this),i=this._getProjection();if(!i.isSphere())return this._rotatePrjCoordinates(n);for(var o=i.getSphereExtent(),s=o.sx,a=o.sy,h=this._getProjection().getCircum(),l=n[0],c=1,A=n.length;c<A;c++){var f=n[c],d=0,p=0;s*(l.x-f.x)>0&&(d=h.x*s),a*(l.y-f.y)<0&&(p=h.y*a),n[c]._add(d,p)}return this._rotatePrjCoordinates(n)},n.prototype._updateCache=function(){this._clearCache();var e=this._getProjection();this._pnw&&e&&(this._coordinates=e.unproject(this._pnw))},n.prototype._clearProjection=function(){this._pnw=null,e.prototype._clearProjection.call(this)},n.prototype._computeCenter=function(e){return e.locate(this._coordinates,this._width/2,-this._height/2)},n.prototype._containsPoint=function(n,i){var o=this.getMap();if(o.isTransforming())return e.prototype._containsPoint.call(this,n,i);var s=M2(i)?this._hitTestTolerance():i,a=o._getResolution()*s,h=this._getPrjExtent().expand(a),l=o._containerPointToPrj(n);return h.contains(l)},n.prototype._computePrjExtent=function(e){if(this.isRotated())return this._computeRotatedPrjExtent();var n=this._getSouthEast(e);if(!n)return null;var i=e.projectCoords([new o9(this._coordinates.x,n.y),new o9(n.x,this._coordinates.y)],this.options.antiMeridian);return new y9(i[0],i[1])},n.prototype._computeExtent=function(e){var n=this._getSouthEast(e);return n?new y9(this._coordinates,n,this._getProjection()):null},n.prototype._getSouthEast=function(e){if(!e||!this._coordinates||M2(this._width)||M2(this._height))return null;var n=this.getWidth(),i=-this.getHeight();if(e.fullExtent){var o=e.fullExtent;n*=o.right>o.left?1:-1,i*=o.top>o.bottom?1:-1}var s=e.locate(this._coordinates,n,0),a=e.locate(this._coordinates,0,i);return s.y=a.y,s},n.prototype._computeGeodesicLength=function(){return M2(this._width)||M2(this._height)?0:2*(this._width+this._height)},n.prototype._computeGeodesicArea=function(){return M2(this._width)||M2(this._height)?0:this._width*this._height},n.prototype._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:o9.toNumberArrays([this.getShell()])}},n.prototype._toJSON=function(e){var n=P2({},e),i=this.getCoordinates();n.geometry=!1;var o=this.toGeoJSON(n);return o.geometry={type:"Polygon"},{feature:o,subType:"Rectangle",coordinates:[i.x,i.y],width:this.getWidth(),height:this.getHeight()}},n}(jet);unt.registerJSONType("Rectangle");var cnt=function(e){function n(n,i,o,s,a){var h=e.call(this,n,i,a)||this;return h.startAngle=o,h.endAngle=s,h}return p5(n,e),n.fromJSON=function(e){var i=e.feature,o=new n(e.coordinates,e.radius,e.startAngle,e.endAngle,e.options);return o.setProperties(i.properties),o},n.prototype.getStartAngle=function(){return this.startAngle},n.prototype.setStartAngle=function(e){return this.startAngle=e,this.onShapeChanged(),this},n.prototype.getEndAngle=function(){return this.endAngle},n.prototype.setEndAngle=function(e){return this.endAngle=e,this.onShapeChanged(),this},n.prototype._correctAngles=function(){var e=this.getStartAngle(),n=this.getEndAngle();if(n<e)return console.error("The ending angle should be greater than the starting angle ",e,n),[0,0];return n-e>360?(console.error("The difference between the end angle and the start angle is greater than 360 degrees ",e,n),[0,0]):(e<0&&(e+=360,n+=360),[e,n])},n.prototype.getShell=function(){return this.isRotated()?this.getRotatedShell():this._getShell()},n.prototype._getShell=function(){for(var e,n,i,o=y5(this._correctAngles(),2),s=o[0],a=o[1],h=this._getMeasurer(),l=this.getCoordinates(),c=this.options.numberOfShellPoints-2,A=this.getRadius(),f=[l.copy()],d=a-s,p=0;p<c;p++){e=(d*p/(c-1)+s)*Math.PI/180,n=A*Math.cos(e),i=A*Math.sin(e);var g=h.locate(l,n,i);g.z=l.z,f.push(g)}return f.push(l.copy()),f},n.prototype.getRotateOffsetAngle=function(){return 90},n.prototype._getPrjShell=function(){var n=e.prototype._getPrjShell.call(this);return this._rotatePrjCoordinates(n)},n.prototype._computePrjExtent=function(){return this.isRotated()?this._computeRotatedPrjExtent():ant.prototype._computePrjExtent.apply(this,arguments)},n.prototype._containsPoint=function(n,i){var o=this.getMap();if(o.isTransforming())return e.prototype._containsPoint.call(this,n,i);var s=o._pointToContainerPoint(this._getCenter2DPoint()),a=this._hitTestTolerance()+(i||0),h=this.getSize(),l=s,c=n,A=Math.atan2(l.y-c.y,c.x-l.x),f=A<0?360*(A+2*Math.PI)/(2*Math.PI):360*A/(2*Math.PI),d=y5(this._correctAngles(),2),p=d[0]%360,g=d[1]%360,v=!1;return v=p>g?!(f>g&&f<p):f>=p&&f<=g,c.distanceTo(l)<=h.width/2+a&&v},n.prototype._computeGeodesicLength=function(){if(M2(this._radius))return 0;var e=y5(this._correctAngles(),2);return 2*Math.PI*this._radius*Math.abs(e[0]-e[1])/360+2*this._radius},n.prototype._computeGeodesicArea=function(){if(M2(this._radius))return 0;var e=y5(this._correctAngles(),2),n=e[0],i=e[1];return Math.PI*Math.pow(this._radius,2)*Math.abs(n-i)/360},n.prototype._toJSON=function(e){var n=P2({},e),i=this.getCenter();n.geometry=!1;var o=this.toGeoJSON(n);return o.geometry={type:"Polygon"},{feature:o,subType:"Sector",coordinates:[i.x,i.y],radius:this.getRadius(),startAngle:this.getStartAngle(),endAngle:this.getEndAngle()}},n}(ant);cnt.mergeOptions({numberOfShellPoints:60}),cnt.registerJSONType("Sector");var Ant=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype._arc=function(e,n,i){var o=this.options.arcDegree;0===o&&(o=1);for(var s=o*Math.PI/180,a=1,h=n.length;a<h;a++)u6._arcBetween(e,n[a-1],n[a],s),u6._stroke(e,i)},n.prototype._quadraticCurve=function(e,n){if(n.length<=2)u6._path(e,n);else{var i,o;for(i=2,o=n.length;i<o;i+=2)e.quadraticCurveTo(n[i-1].x,n[i-1].y,n[i].x,n[i].y);if((i-=1)<o)for(;i<o;i++)e.lineTo(n[i].x,n[i].y)}},n.prototype._bezierCurve=function(e,n){if(n.length<=3)u6._path(e,n);else{var i,o;for(i=1,o=n.length;i+2<o;i+=3)e.bezierCurveTo(n[i].x,n[i].y,n[i+1].x,n[i+1].y,n[i+2].x,n[i+2].y);if(i<o)for(;i<o;i++)e.lineTo(n[i].x,n[i].y)}},n.prototype._getCurveArrowPoints=function(e,n,i,o,s,a){var h,l=n.length;for(h=a;h<l;h+=a){(c=this._getArrowShape(n[h-1],n[h],i,o,s))&&e.push(c)}if((h-=a)<l-1)for(h+=1;h<l;h++){var c;(c=this._getArrowShape(n[h-1],n[h],i,o,s))&&e.push(c)}},n}(qet);Ant.mergeOptions({enableSimplify:!1,enableClip:!1});var fnt=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype._toJSON=function(e){return{feature:this.toGeoJSON(e),subType:"ArcCurve"}},n.prototype._paintOn=function(e,n,i){e.beginPath(),this._arc(e,n,i),u6._stroke(e,i),this._paintArrow(e,n,i)},n.fromJSON=function(e){var i=e.feature,o=new n(i.geometry.coordinates,e.options);return o.setProperties(i.properties),o},n}(Ant);fnt.registerJSONType("ArcCurve"),fnt.mergeOptions({arcDegree:90});var dnt=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.fromJSON=function(e){var i=e.feature,o=new n(i.geometry.coordinates,e.options);return o.setProperties(i.properties),o},n.prototype._toJSON=function(e){return{feature:this.toGeoJSON(e),subType:"CubicBezierCurve"}},n.prototype._paintOn=function(e,n,i){e.beginPath(),e.moveTo(n[0].x,n[0].y),this._bezierCurve(e,n),u6._stroke(e,i),this._paintArrow(e,n,i)},n.prototype._getArrowPoints=function(e,n,i,o,s){return this._getCurveArrowPoints(e,n,i,o,s,3)},n}(Ant);dnt.registerJSONType("CubicBezierCurve");var pnt=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.fromJSON=function(e){var i=e.feature,o=new n(i.geometry.coordinates,e.options);return o.setProperties(i.properties),o},n.prototype._toJSON=function(e){return{feature:this.toGeoJSON(e),subType:"QuadBezierCurve"}},n.prototype._paintOn=function(e,n,i){e.beginPath(),e.moveTo(n[0].x,n[0].y),this._quadraticCurve(e,n,i),u6._stroke(e,i),this._paintArrow(e,n,i)},n.prototype._getArrowPoints=function(e,n,i,o,s){return this._getCurveArrowPoints(e,n,i,o,s,2)},n}(Ant);pnt.registerJSONType("QuadBezierCurve");var gnt={textFaceName:"monospace",textSize:12,textLineSpacing:8,textWrapCharacter:"\n",textHorizontalAlignment:"middle",textVerticalAlignment:"middle"},mnt={markerType:"square",markerLineColor:"#000",markerLineWidth:2,markerLineOpacity:1,markerFill:"#fff",markerOpacity:1},ynt=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype.getContent=function(){return this._content},n.prototype.setContent=function(e){var n=this._content;return this._content=f3(e),this._refresh(),this._fireEvent("contentchange",{old:n,new:e}),this},n.prototype.onAdd=function(){this._refresh()},n.prototype.toJSON=function(){var n=e.prototype.toJSON.call(this);return delete n.symbol,n},n.prototype.setSymbol=function(n){if(this._refreshing||!n)return e.prototype.setSymbol.call(this,n);var i,o=this._parseSymbol(n);this.setTextStyle?((i=this.getTextStyle()||{}).symbol=o[0],this.setTextStyle(i)):this.setTextSymbol&&this.setTextSymbol(o[0]);this.setBoxStyle?((i=this.getBoxStyle()||{}).symbol=o[1],this.setBoxStyle(i)):this.setBoxSymbol&&this.setBoxSymbol(o[1]);return this},n.prototype._parseSymbol=function(e){var n={},i={};for(var o in e)D2(e,o)&&(0===o.indexOf("text")?n[o]=e[o]:i[o]=e[o]);return[n,i]},n.prototype._getTextSize=function(e){return P3(this._content,e).size},n.prototype._getInternalSymbol=function(){return this._symbol},n.prototype._getDefaultTextSymbol=function(){return P2({},gnt)},n.prototype._getDefaultBoxSymbol=function(){return P2({},mnt)},n.prototype._getDefaultPadding=function(){return[12,8]},n}(Vet),vnt=function(e){function n(n,i,o,s,a){void 0===a&&(a={});var h=e.call(this,i,a)||this;return h._content=f3(n),h._width=M2(o)?100:o,h._height=M2(s)?40:s,a.boxSymbol&&h.setBoxSymbol(a.boxSymbol),a.textStyle&&h.setTextStyle(a.textStyle),h._refresh(),h}return p5(n,e),n.prototype.getWidth=function(){return this._width},n.prototype.setWidth=function(e){return this._width=e,this._refresh(),this},n.prototype.getHeight=function(){return this._height},n.prototype.setHeight=function(e){return this._height=e,this._refresh(),this},n.prototype.getBoxSymbol=function(){return P2({},this.options.boxSymbol)},n.prototype.setBoxSymbol=function(e){return this.options.boxSymbol=e?P2({},e):e,this.getSymbol()&&this._refresh(),this},n.prototype.getTextStyle=function(){return this.options.textStyle?P2({},this.options.textStyle):null},n.prototype.setTextStyle=function(e){return this.options.textStyle=e?P2({},e):e,this.getSymbol()&&this._refresh(),this},n.fromJSON=function(e){var i=e.feature,o=new n(e.content,i.geometry.coordinates,e.width,e.height,e.options);return o.setProperties(i.properties),o.setId(i.id),e.symbol&&o.setSymbol(e.symbol),o},n.prototype._toJSON=function(e){return{feature:this.toGeoJSON(e),width:this.getWidth(),height:this.getHeight(),subType:"TextBox",content:this._content}},n.prototype._refresh=function(){var e,n,i=this.getTextStyle()||{},o=i.padding||[12,8];if(_4(this._width)){if(A=(e=JSON.parse(JSON.stringify(this._width))).stops)for(var s=0;s<A.length;s++)A[s][1]=A[s][1]-2*o[0]}else e=this._width-2*o[0];if(_4(this._height)){if(A=(n=JSON.parse(JSON.stringify(this._height))).stops)for(s=0;s<A.length;s++)A[s][1]=A[s][1]-2*o[1]}else n=this._height-2*o[1];var a=P2({},i.symbol||this._getDefaultTextSymbol(),this.options.boxSymbol||this._getDefaultBoxSymbol(),{textName:this._content,markerWidth:this._width,markerHeight:this._height,textHorizontalAlignment:"middle",textVerticalAlignment:"middle",textMaxWidth:e,textMaxHeight:n});i.wrap&&!a.textWrapWidth&&(a.textWrapWidth=e);var h,l=i.horizontalAlignment;if(a.textDx=a.markerDx||0,_4(this._width)){if(A=(h=JSON.parse(JSON.stringify(this._width))).stops)for(s=0;s<A.length;s++)A[s][1]=A[s][1]/2-o[0],"left"===l&&(A[s][1]*=-1)}else h=a.markerWidth/2-o[0],"left"===l&&(h*=-1);"left"===l?(a.textHorizontalAlignment="right",a.textDx=h):"right"===l&&(a.textHorizontalAlignment="left",a.textDx=h);var c,A,f=i.verticalAlignment;if(a.textDy=a.markerDy||0,_4(this._height)){if(A=(c=JSON.parse(JSON.stringify(this._height))).stops)for(s=0;s<A.length;s++)A[s][1]=A[s][1]/2-o[1],"top"===f&&(A[s][1]*=-1)}else c=a.markerHeight/2-o[1],"top"===f&&(c*=-1);"top"===f?(a.textVerticalAlignment="bottom",a.textDy=c):"bottom"===f&&(a.textVerticalAlignment="top",a.textDy=c),this._refreshing=!0,this.updateSymbol(a),delete this._refreshing},n.prototype.startEdit=function(n){var i=this._getCompiledSymbol();if(_4(this._width)){var o=i.markerWidth;this._oldWidth=this._width,this.setWidth(o)}if(_4(this._height)){var s=i.markerHeight;this._oldHeight=this._height,this.setHeight(s)}return e.prototype.startEdit.call(this,n)},n.prototype.endEdit=function(){var n=this.getMap(),i=n&&n.getZoom();if(this._oldWidth){for(var o=this._width/b4(this._oldWidth)(i),s=this._oldWidth.stops,a=0;a<s.length;a++)s[a][1]*=o;this.setWidth(this._oldWidth),delete this._oldWidth}if(this._oldHeight){for(o=this._height/b4(this._oldHeight)(i),s=this._oldHeight.stops,a=0;a<s.length;a++)s[a][1]*=o;this.setHeight(this._oldHeight),delete this._oldHeight}return e.prototype.endEdit.call(this)},n}(ynt);vnt.mergeOptions({textStyle:{wrap:!0,padding:[12,8],verticalAlignment:"middle",horizontalAlignment:"middle"},boxSymbol:null}),vnt.registerJSONType("TextBox");var _nt=function(e){function n(n,i,o){void 0===o&&(o={});var s=e.call(this,i,o)||this;return o.textSymbol&&s.setTextSymbol(o.textSymbol),o.boxStyle&&s.setBoxStyle(o.boxStyle),s._content=f3(n),s._refresh(),s}return p5(n,e),n.prototype.getBoxStyle=function(){return this.options.boxStyle?P2({},this.options.boxStyle):null},n.prototype.setBoxStyle=function(e){return this.options.boxStyle=e?P2({},e):e,this._refresh(),this},n.prototype.getTextSymbol=function(){return P2({},this._getDefaultTextSymbol(),this.options.textSymbol)},n.prototype.setTextSymbol=function(e){return this.options.textSymbol=e?P2({},e):e,this._refresh(),this},n.fromJSON=function(e){var i=e.feature,o=new n(e.content,i.geometry.coordinates,e.options);return o.setProperties(i.properties),o.setId(i.id),e.symbol&&o.setSymbol(e.symbol),o},n.prototype._canEdit=function(){return!1},n.prototype._toJSON=function(e){return{feature:this.toGeoJSON(e),subType:"Label",content:this._content}},n.prototype._refresh=function(){var e=P2({},this.getTextSymbol(),{textName:this._content}),n=this.getBoxStyle();if(n){P2(e,n.symbol);var i=this._getBoxSize(e),o=i[1],s=n.padding||this._getDefaultPadding(),a=i[0];e.markerWidth=a.width,e.markerHeight=a.height;var h=e.textDx||0,l=e.textDy||0,c=x3(o,e.textHorizontalAlignment,e.textVerticalAlignment)._add(h,l),A=n.horizontalAlignment||"middle";e.markerDx=c.x,"left"===A?e.markerDx+=e.markerWidth/2-s[0]:"right"===A?e.markerDx-=e.markerWidth/2-o.width-s[0]:e.markerDx+=o.width/2;var f=n.verticalAlignment||"middle";e.markerDy=c.y,"top"===f?e.markerDy+=e.markerHeight/2-s[1]:"bottom"===f?e.markerDy-=e.markerHeight/2-o.height-s[1]:e.markerDy+=o.height/2}this._refreshing=!0,this.updateSymbol(e),delete this._refreshing},n.prototype._getBoxSize=function(e){e.markerType||(e.markerType="square");var n,i,o=this.getBoxStyle(),s=this._getTextSize(e),a=o.padding||this._getDefaultPadding();return n=s.width+2*a[0],i=s.height+2*a[1],o.minWidth&&(!n||n<o.minWidth)&&(n=o.minWidth),o.minHeight&&(!i||i<o.minHeight)&&(i=o.minHeight),[new h3(n,i),s]},n}(ynt);_nt.mergeOptions({boxStyle:null,textSymbol:null}),_nt.registerJSONType("Label");var xnt=function(e){return function(e){function n(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return e.apply(this,v5([],y5(n),!1))||this}return p5(n,e),n._hasConnectors=function(e){return!M2(e.__connectors)&&e.__connectors.length>0},n._getConnectors=function(e){return e.__connectors},n.prototype.getConnectSource=function(){return this._connSource},n.prototype.setConnectSource=function(e){var n=this._connTarget;return this.onRemove(),this._connSource=e,this._connTarget=n,this.onAdd(),this},n.prototype.getConnectTarget=function(){return this._connTarget},n.prototype.setConnectTarget=function(e){var n=this._connSource;return this.onRemove(),this._connSource=n,this._connTarget=e,this._updateCoordinates(),this._registerEvents(),this},n.prototype._updateCoordinates=function(){var e=this.getMap();if(!e&&this._connSource&&(e=this._connSource.getMap()),!e&&this._connTarget&&(e=this._connTarget.getMap()),e&&this._connSource&&this._connTarget){for(var n,i,o=this._connSource._getConnectPoints(),s=this._connTarget._getConnectPoints(),a=0,h=this.getCoordinates(),l=0,c=o.length;l<c;l++)for(var A=o[l],f=0,d=s.length;f<d;f++){var p=s[f],g=e.computeLength(A,p);0===l&&0===f?(n=A,i=p,a=g):g<a&&(n=A,i=p)}z5(h)&&h[0].equals(n)&&h[1].equals(i)||this.setCoordinates([n,i])}},n.prototype.onAdd=function(){this._registerEvents(),this._updateCoordinates()},n.prototype.onRemove=function(){if(this._connSource&&(this._connSource.__connectors&&O5(this,this._connSource.__connectors),this._connSource.off("dragging positionchange",this._updateCoordinates,this).off("remove",this.onRemove,this),this._connSource.off("dragstart mousedown mouseover",this._showConnect,this),this._connSource.off("dragend mouseup mouseout",this.hide,this),this._connSource.off("show",this._showConnect,this).off("hide",this.hide,this),delete this._connSource),this._connTarget&&(O5(this,this._connTarget.__connectors),this._connTarget.off("dragging positionchange",this._updateCoordinates,this).off("remove",this.onRemove,this),this._connTarget.off("show",this._showConnect,this).off("hide",this.hide,this),delete this._connTarget),!(this._connSource instanceof net&&this._connTarget instanceof net)){var e=this.getMap();e&&e.off("movestart moving moveend zoomstart zooming zoomend rotate pitch fovchange spatialreferencechange",this._updateCoordinates,this)}},n.prototype._showConnect=function(){this._connSource&&this._connTarget&&this._connSource.isVisible()&&this._connTarget.isVisible()&&(this._updateCoordinates(),this.show())},n.prototype._registerEvents=function(){if(this._connSource&&this._connTarget){this._connSource.__connectors||(this._connSource.__connectors=[]),this._connTarget.__connectors||(this._connTarget.__connectors=[]),this._connSource.__connectors.push(this),this._connTarget.__connectors.push(this),this._connSource.on("dragging positionchange",this._updateCoordinates,this).on("remove",this.remove,this),this._connTarget.on("dragging positionchange",this._updateCoordinates,this).on("remove",this.remove,this),this._connSource.on("show",this._showConnect,this).on("hide",this.hide,this),this._connTarget.on("show",this._showConnect,this).on("hide",this.hide,this);var e=this.options.showOn;if(this.hide(),"moving"===e?(this._connSource.on("dragstart",this._showConnect,this).on("dragend",this.hide,this),this._connTarget.on("dragstart",this._showConnect,this).on("dragend",this.hide,this)):"click"===e?(this._connSource.on("mousedown",this._showConnect,this).on("mouseup",this.hide,this),this._connTarget.on("mousedown",this._showConnect,this).on("mouseup",this.hide,this)):"mouseover"===e?(this._connSource.on("mouseover",this._showConnect,this).on("mouseout",this.hide,this),this._connTarget.on("mouseover",this._showConnect,this).on("mouseout",this.hide,this)):this._showConnect(),!(this._connSource instanceof net&&this._connTarget instanceof net)){var n=this.getMap();n&&n.on("movestart moving moveend zoomstart zooming zoomend rotate pitch fovchange spatialreferencechange",this._updateCoordinates,this)}}},n}(e)},bnt={showOn:"always"},wnt=function(e){function n(n,i,o){var s=e.call(this,null,o)||this;return 1===arguments.length&&(o=n,n=null,i=null),s._connSource=n,s._connTarget=i,s}return p5(n,e),n}(xnt(qet));wnt.mergeOptions(bnt),wnt.registerJSONType("ConnectorLine");var Cnt=function(e){function n(n,i,o){var s=e.call(this,null,o)||this;return 1===arguments.length&&(o=n,n=null,i=null),s._connSource=n,s._connTarget=i,s}return p5(n,e),n}(xnt(fnt));function Pnt(e){return e&&e instanceof net}Cnt.mergeOptions(bnt),Cnt.registerJSONType("ArcConnectorLine");var Mnt=[],Tnt=function(e){function n(n,i,o){var s=this;i&&!Pnt(i)&&!Array.isArray(i)&&n3.indexOf(i.type)<0&&(o=i,i=null),(s=e.call(this,n,o)||this)._maxZIndex=0,s._minZIndex=0,s._initCache(),i&&s.addGeometry(i);var a=s.options.style;return a&&s.setStyle(a),s}return p5(n,e),n.prototype.getAltitude=function(){return 0},n.prototype.getGeometryById=function(e){return M2(e)||""===e?null:this._geoMap[e]?this._geoMap[e]:null},n.prototype.getGeometries=function(e,n){if(!e)return this._geoList.slice(0);for(var i,o=[],s=0,a=this._geoList.length;s<a;s++)i=this._geoList[s],(n?e.call(n,i):e(i))&&o.push(i);return o},n.prototype.getFirstGeometry=function(){return this._geoList.length?this._geoList[0]:null},n.prototype.getLastGeometry=function(){var e=this._geoList.length;return 0===e?null:this._geoList[e-1]},n.prototype.getCount=function(){return this._geoList.length},n.prototype.getExtent=function(){if(0===this.getCount())return null;var e=new y9(this.getProjection());return this.forEach((function(n){e._combine(n.getExtent())})),e},n.prototype.forEach=function(e,n){for(var i=this._geoList.slice(0),o=0,s=i.length;o<s;o++)n?e.call(n,i[o],o):e(i[o],o);return this},n.prototype.filter=function(e,n){var i=[],o=O2(e),s=o?e:T4(e);return this.forEach((function(e){var a=o?e:N4(e);(n?s.call(n,a):s(a))&&i.push(e)}),this),i},n.prototype.isEmpty=function(){return!this._geoList.length},n.prototype.addGeometry=function(e,n){if(!e)return this;if("FeatureCollection"===e.type)return this.addGeometry(snt.toGeometry(e),n);if(!Array.isArray(e)){var i=arguments.length,o=arguments[i-1];return e=Array.prototype.slice.call(arguments,0,i-1),n=o,o&&I2(o)&&("type"in o||Pnt(o))&&(e.push(o),n=!1),this.addGeometry(e,n)}if(0===e.length)return this;var s;this._initCache(),n&&(s=new y9),this._toSort=this._maxZIndex>0;for(var a=[],h=0,l=e.length;h<l;h++){var c=e[h];if(!c||!snt._isGeoJSON(c)&&!Pnt(c))throw new Error("Invalid geometry to add to layer("+this.getId()+") at index:"+h);if(!c.getLayer||c.getLayer()!==this){if(!Pnt(c)&&(c=net.fromJSON(c),Array.isArray(c)))for(var A=0,f=c.length;A<f;A++)this._add(c[A],s,h),a.push(c[A]);if(!c)throw new Error("Invalid geometry to add to layer("+this.getId()+") at index:"+h);Array.isArray(c)||(this._add(c,s,h),a.push(c))}}var d=this.getMap();if(d&&(this._getRenderer().onGeometryAdd(a),s&&!M2(s.xmin))){var p=s.getCenter(),g=d.getFitZoom(s);if(I2(n)){var v=O2(n.step)?n.step:function(){};d.animateTo({center:p,zoom:g},P2({duration:d.options.zoomAnimationDuration,easing:"out"},n),v)}else!0===n&&d.setCenterAndZoom(p,g)}return this.fire("addgeo",{type:"addgeo",target:this,geometries:e}),this},n.prototype.getGeoMinZIndex=function(){return this._minZIndex},n.prototype.getGeoMaxZIndex=function(){return this._maxZIndex},n.prototype._add=function(e,n,i){this._toSort||(this._toSort=0!==e.getZIndex()),this._updateZIndex(e.getZIndex());var o=e.getId();if(!M2(o)){if(!M2(this._geoMap[o]))throw new Error("Duplicate geometry id in layer("+this.getId()+"):"+o+", at index:"+i);this._geoMap[o]=e}var s=T5();e._setInternalId(s),this._geoList.push(e),this.onAddGeometry(e),e._bindLayer(this),e.onAdd&&e.onAdd(),n&&n._combine(e.getExtent()),e._fireEvent("add",{layer:this}),this._cookedStyles&&this._styleGeometry(e)},n.prototype.removeGeometry=function(e){if(!Array.isArray(e))return this.removeGeometry([e]);for(var n=e.length-1;n>=0;n--)e[n]instanceof net||(e[n]=this.getGeometryById(e[n])),e[n]&&this===e[n].getLayer()&&e[n].remove();return this.fire("removegeo",{type:"removegeo",target:this,geometries:e}),this},n.prototype.clear=function(){this._clearing=!0,this.forEach((function(e){e.remove()})),this._geoMap={};var e=this._geoList;this._geoList=[];var n=this._getRenderer();return n&&(n.onGeometryRemove(e),n.clearImageData&&(n.clearImageData(),delete n._lastGeosToDraw)),this._clearing=!1,this.fire("clear"),this},n.prototype.onRemoveGeometry=function(e){if(e&&!this._clearing&&(this===e.getLayer()&&!M2(e._getInternalId()))){var n=e.getId();M2(n)||delete this._geoMap[n];var i=this._findInList(e);i>=0&&this._geoList.splice(i,1),this._getRenderer()&&this._getRenderer().onGeometryRemove([e])}},n.prototype.getStyle=function(){return this.options.style?this.options.style:null},n.prototype.setStyle=function(e){return this.options.style=e,e=K4(e),this._cookedStyles=z4(e),this.forEach((function(e){this._styleGeometry(e)}),this),this.fire("setstyle",{type:"setstyle",target:this,style:e}),this},n.prototype._styleGeometry=function(e){if(!this._cookedStyles)return!1;for(var n=N4(e),i=0,o=this._cookedStyles.length;i<o;i++)if(!0===this._cookedStyles[i].filter(n))return e._setExternSymbol(this._cookedStyles[i].symbol),!0;return!1},n.prototype.removeStyle=function(){return this.options.style?(delete this.options.style,delete this._cookedStyles,this.forEach((function(e){e._setExternSymbol(null)}),this),this.fire("removestyle"),this):this},n.prototype.onAddGeometry=function(e){this.getStyle()&&this._styleGeometry(e)},n.prototype.hide=function(){for(var e=0,n=this._geoList.length;e<n;e++)this._geoList[e].onHide();return cet.prototype.hide.call(this)},n.prototype._initCache=function(){this._geoList||(this._geoList=[],this._geoMap={})},n.prototype._updateZIndex=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._maxZIndex=Math.max(this._maxZIndex,Math.max.apply(Math,v5([],y5(e),!1))),this._minZIndex=Math.min(this._minZIndex,Math.min.apply(Math,v5([],y5(e),!1)))},n.prototype._sortGeometries=function(){var e=this;this._toSort&&(this._maxZIndex=0,this._minZIndex=0,this._geoList.sort((function(n,i){return e._updateZIndex(n.getZIndex(),i.getZIndex()),e._compare(n,i)})),this._toSort=!1)},n.prototype._compare=function(e,n){return e.getZIndex()===n.getZIndex()?e._getInternalId()-n._getInternalId():e.getZIndex()-n.getZIndex()},n.prototype._findInList=function(e){var n=this._geoList.length;if(0===n)return-1;this._sortGeometries();for(var i,o=0,s=n-1;o<=s;){if(i=Math.floor((o+s)/2),this._geoList[i]===e)return i;this._compare(this._geoList[i],e)>0?s=i-1:o=i+1}return-1},n.prototype.onGeometryEvent=function(e){return this._onGeometryEvent(e)},n.prototype._onGeometryEvent=function(e){if(e&&e.target){var n=e.type;"idchange"===n?this._onGeometryIdChange(e):"zindexchange"===n?this._onGeometryZIndexChange(e):"positionchange"===n?this._onGeometryPositionChange(e):"shapechange"===n?this._onGeometryShapeChange(e):"symbolchange"===n?this._onGeometrySymbolChange(e):"show"===n?this._onGeometryShow(e):"hide"===n?this._onGeometryHide(e):"propertieschange"===n&&this._onGeometryPropertiesChange(e)}},n.prototype._onGeometryIdChange=function(e){if(e.new!==e.old||!this._geoMap[e.old]||this._geoMap[e.old]!==e.target){if(!M2(e.new)){if(this._geoMap[e.new])throw new Error("Duplicate geometry id in layer("+this.getId()+"):"+e.new);this._geoMap[e.new]=e.target}M2(e.old)||e.new===e.old||delete this._geoMap[e.old]}},n.prototype._onGeometryZIndexChange=function(e){e.old!==e.new&&(this._updateZIndex(e.new),this._toSort=!0,this._getRenderer()&&this._getRenderer().onGeometryZIndexChange(e))},n.prototype._onGeometryPositionChange=function(e){this._getRenderer()&&this._getRenderer().onGeometryPositionChange(e)},n.prototype._onGeometryShapeChange=function(e){this._getRenderer()&&this._getRenderer().onGeometryShapeChange(e)},n.prototype._onGeometrySymbolChange=function(e){this._getRenderer()&&this._getRenderer().onGeometrySymbolChange(e)},n.prototype._onGeometryShow=function(e){this._getRenderer()&&this._getRenderer().onGeometryShow(e)},n.prototype._onGeometryHide=function(e){this._getRenderer()&&this._getRenderer().onGeometryHide(e)},n.prototype._onGeometryPropertiesChange=function(e){this._getRenderer()&&this._getRenderer().onGeometryPropertiesChange(e)},n.prototype._hasGeoListeners=function(e){if(!e)return!1;Array.isArray(e)||(Mnt[0]=e,e=Mnt);for(var n=this.getGeometries()||[],i=0,o=n.length;i<o;i++){var s=n[i];if(s){if(s.options.cursor)return!0;for(var a=0,h=e.length;a<h;a++){if(s.listens(e[a])>0)return!0}}}return!1},n.prototype._getRenderer=function(){return e.prototype._getRenderer.call(this)},n}(cet);Tnt.mergeOptions({drawImmediate:!1,geometryEvents:!0,geometryEventTolerance:1});var Snt=new v9,Int={debug:!1,enableSimplify:!0,defaultIconSize:[20,20],cacheVectorOnCanvas:!0,cacheSvgOnCanvas:f5.gecko,enableAltitude:!1,altitudeProperty:"altitude",drawAltitude:!1,sortByDistanceToCamera:!1,roundPoint:!1,altitude:0,clipBBoxBufferSize:3,collision:!1,collisionBufferSize:2,collisionDelay:250,collisionScope:"layer",progressiveRender:!1,progressiveRenderCount:1e3,progressiveRenderDebug:!1},Ent=function(e){function n(n,i,o){var s=e.call(this,n,i,o)||this;return s.isVectorLayer=!0,s}return p5(n,e),n.prototype.onConfig=function(n){if(e.prototype.onConfig.call(this,n),!M2(n.enableAltitude))for(var i=this.getGeometries()||[],o=0,s=i.length;o<s;o++){var a=i[o];a&&(a._clearAltitudeCache(),a.fire("positionchange"))}if(n.enableAltitude||n.drawAltitude||n.altitudeProperty){var h=this.getRenderer();h&&h.setToRedraw&&h.setToRedraw()}},n.prototype.identify=function(e,n){n=n||{};var i=this.getRenderer();e instanceof o9||(e=new o9(e));var o=this.getMap().coordToContainerPoint(e);return n.onlyVisible&&i&&i.identifyAtPoint?i.identifyAtPoint(o,n):this._hitGeos(this._geoList,o,n)},n.prototype.identifyAtPoint=function(e,n){n=n||{};var i=this.getRenderer();return e instanceof w5||(e=new w5(e)),n.onlyVisible&&i&&i.identifyAtPoint?i.identifyAtPoint(e,n):this._hitGeos(this._geoList,e,n)},n.prototype._hitGeos=function(e,n,i){if(!e||!e.length)return[];var o=i.filter,s=[],a=i.tolerance,h=this.getMap(),l=this.getRenderer(),c=l&&l.getImageData&&l.getImageData();if(c){var A=0,f=l.maxTolerance;if(T2(f))A=f;else for(var d=e.length-1;d>=0;d--){var p=e[d]._hitTestTolerance()+(a||0);p>A&&(A=p)}var g=h.getDevicePixelRatio();c.r=g;var v=!1,w=n.x-A,C=n.y-A;for(d=-A;d<=A;d++){for(var P=-A;P<=A;P++){var T=Math.round((w+d)*g),S=Math.round((C+P)*g);if(c.data[S*c.width*4+4*T+3]>0){v=!0;break}}if(v)break}if(!v)return s}var I=i.onlyVisible;for(d=e.length-1;d>=0;d--){var E=e[d];if(E&&E.options.interactive&&(I||E.isVisible())){var O=E._getPainter();if(O){var k=O.getRenderBBOX&&O.getRenderBBOX();if(k){S=n.y;if((T=n.x)<k[0]||S<k[1]||T>k[2]||S>k[3])continue}if(!(E instanceof qet&&(E._getArrowStyle()||E instanceof Ant))){var L=E.getContainerExtent(Snt);if(a&&(L=L._expand(a)),!L||!L.contains(n))continue}if(E._containsPoint(n,a)&&(!o||o(E))&&(s.push(E),i.count&&s.length>=i.count))break}}}return s},n.prototype.getAltitude=function(){return this.options.altitude||0},n.prototype.toJSON=function(e){e||(e={clipExtent:null,geometries:null});var n={type:this.getJSONType(),id:this.getId(),options:this.config()};if(M2(e.geometries)||e.geometries){var i=void 0;if(e.clipExtent){var o=this.getMap(),s=o?o.getProjection():null;i=new y9(e.clipExtent,s)}for(var a=[],h=this.getGeometries(),l=0,c=h.length;l<c;l++){var A=h[l],f=A.getExtent();if(f&&(!i||i.intersects(f))){var d=A.toJSON(e.geometries);a.push(d)}}n.geometries=a}return n},n.prototype.getRenderer=function(){return e.prototype.getRenderer.call(this)},n.fromJSON=function(e){if(!e||"VectorLayer"!==e.type)return null;for(var i=new n(e.id,e.options),o=e.geometries,s=[],a=0;a<o.length;a++){var h=net.fromJSON(o[a]);h&&s.push(h)}return i.addGeometry(s),i},n.getPainterClass=function(){return ztt},n.getCollectionPainterClass=function(){return jtt},n}(Tnt);Ent.mergeOptions(Int),Ent.registerJSONType("VectorLayer");var Ont="_map_tool",Rnt=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype.addTo=function(e){return e?(this._map=e,e[Ont]&&e[Ont].disable(),this.onAdd&&this.onAdd(),this.enable(),e[Ont]=this,this._fireEvent("add"),this):this},n.prototype.getMap=function(){return this._map},n.prototype.enable=function(){return!this._map||this._enabled||(this._enabled=!0,this._switchEvents("off"),this._registerEvents(),this.onEnable&&this.onEnable(),this._fireEvent("enable")),this},n.prototype.disable=function(){return this._enabled&&this._map?(this._enabled=!1,this._switchEvents("off"),this.onDisable&&this.onDisable(),this._fireEvent("disable"),this):this},n.prototype.isEnabled=function(){return!!this._enabled},n.prototype.remove=function(){return this._map?(this.disable(),this._map&&(delete this._map[Ont],delete this._map),this._fireEvent("remove"),this):this},n.prototype._registerEvents=function(){this._switchEvents("on")},n.prototype._switchEvents=function(e){var n=this.getEvents();n&&this._map[e](n,this)},n.prototype._fireEvent=function(e,n){n||(n={}),this.fire(e,n)},n}(m6(v6)),Dnt={symbol:{lineColor:"#000",lineWidth:2,lineOpacity:1,polygonFill:"#fff",polygonOpacity:.3},doubleClickZoom:!1,mode:null,once:!1,autoPanAtEdge:!1,ignoreMouseleave:!0,blockGeometryEvents:!1,zIndex:Number.MAX_VALUE,enableAltitude:!0,interactive:!0,transformCoordinate:null},knt={},Lnt=function(e){function n(n){var i=e.call(this,n)||this;return i._checkMode(),i._events={click:i._clickHandler,"mousemove touchmove":i._mouseMoveHandler,dblclick:i._doubleClickHandler,"mousedown touchstart":i._mouseDownHandler,"mouseup touchend":i._mouseUpHandler,mousemove:i._mouseMoveHandler,mousedown:i._mouseDownHandler,mouseup:i._mouseUpHandler},i}return p5(n,e),n.registerMode=function(e,n){knt[e.toLowerCase()]=n},n.getRegisterMode=function(e){return knt[e.toLowerCase()]},n.prototype.getMode=function(){return this.options.mode?this.options.mode.toLowerCase():null},n.prototype.setMode=function(e){return this._geometry&&(this._geometry.remove(),delete this._geometry),this._clearStage(),this._switchEvents("off"),this.options.mode=e,this._checkMode(),this.isEnabled()&&(this._switchEvents("on"),this._restoreMapCfg(),this._saveMapCfg()),this},n.prototype.getSymbol=function(){var e=this.options.symbol;return J4(e||this.options.symbol)},n.prototype.setSymbol=function(e){return e?(this.options.symbol=e,this._geometry&&this._geometry.setSymbol(e),this):this},n.prototype.getCurrentGeometry=function(){return this._geometry},n.prototype.onAdd=function(){this._checkMode()},n.prototype.onEnable=function(){this._saveMapCfg(),this._drawToolLayer=this._getDrawLayer(),this._clearStage(),this._loadResources();var e=this.getMap();return this.options.autoPanAtEdge&&(this._mapAutoPanAtEdge=e.options.autoPanAtEdge,this._mapAutoPanAtEdge||e.config({autoPanAtEdge:!0})),this._geometryEvents=e.options.geometryEvents,this.options.blockGeometryEvents&&e.config("geometryEvents",!1),this},n.prototype.onDisable=function(){var e=this.getMap();return this._restoreMapCfg(),this.endDraw({ignoreEndEvent:!0}),this._map&&(e.removeLayer(this._getDrawLayer()),this.options.autoPanAtEdge&&(this._mapAutoPanAtEdge||e.config({autoPanAtEdge:!1}))),this.options.blockGeometryEvents&&e.config("geometryEvents",this._geometryEvents),this},n.prototype.undo=function(){var e=this._getRegisterMode();if(!this._shouldRecordHistory(e.action)||!this._historyPointer)return this;var n=this._clickCoords.slice(0,--this._historyPointer);return e.update(this.getMap().getProjection(),n,this._geometry),this},n.prototype.redo=function(){var e=this._getRegisterMode();if(!this._shouldRecordHistory(e.action)||M2(this._historyPointer)||this._historyPointer===this._clickCoords.length)return this;var n=this._clickCoords.slice(0,++this._historyPointer);return e.update(this.getMap().getProjection(),n,this._geometry),this},n.prototype._shouldRecordHistory=function(e){return Array.isArray(e)&&"click"===e[0]&&"mousemove"===e[1]&&"dblclick"===e[2]},n.prototype._checkMode=function(){this._getRegisterMode()},n.prototype._saveMapCfg=function(){var e=this.getMap();this._mapDoubleClickZoom=e.options.doubleClickZoom,e.config({doubleClickZoom:this.options.doubleClickZoom});for(var n=this._getRegisterMode().action,i=!1,o=0;o<n.length;o++)if(n[o].indexOf("mousedown")>=0||n[o].indexOf("touchstart")>=0){i=!0;break}if(i){var s=this.getMap();this._mapDraggable=s.options.draggable,s.config({draggable:!1})}},n.prototype._restoreMapCfg=function(){var e=this.getMap();e.config({doubleClickZoom:this._mapDoubleClickZoom}),M2(this._mapDraggable)||e.config("draggable",this._mapDraggable),delete this._mapDraggable,delete this._mapDoubleClickZoom},n.prototype._loadResources=function(){var e=V4(this.getSymbol());e.length>0&&this._drawToolLayer._getRenderer().loadResources(e)},n.prototype._getProjection=function(){return this._map.getProjection()},n.prototype._getRegisterMode=function(){var e=this.getMode(),i=n.getRegisterMode(e);if(!i)throw new Error(e+" is not a valid mode of DrawTool.");return i},n.prototype.getEvents=function(){var e=this._getRegisterMode().action,n={};if(Array.isArray(e)){for(var i=0;i<e.length;i++)n[e[i]]=this._events[e[i]];return n}return null},n.prototype._mouseDownHandler=function(e){this._createGeometry(e)},n.prototype._mouseUpHandler=function(e){this.endDraw(e)},n.prototype._clickHandler=function(e){if(!this.options.interactive)return this;e.enableAltitude=this.options.enableAltitude;var n=this.getMap(),i=this._getRegisterMode();if(this._clickCoords&&this._clickCoords.length){var o=this._clickCoords.length,s=n._pointToPrj(e.point2d);if(this._clickCoords[o-1].equals(s))return}if(this._geometry){s=n._pointToPrj(e.point2d);M2(this._historyPointer)||(this._clickCoords=this._clickCoords.slice(0,this._historyPointer));var a=this._geometry.snapTo;if(a&&O2(a)){var h=this._getSnapResult(a,e.containerPoint);if(s=h.prjCoord,this._clickCoords=this._clickCoords.concat(h.effectedVertex),this._clickCoords[this._clickCoords.length-1].equals(s))return}if(this._clickCoords.push(s),this._historyPointer=this._clickCoords.length,e.drawTool=this,i.update(n.getProjection(),this._clickCoords,this._geometry,e),"point"===this.getMode())return void this.endDraw(e);this._fireEvent(this._clickCoords.length<=1?"drawstart":"drawvertex",e),i.clickLimit&&i.clickLimit===this._historyPointer&&this.endDraw(e)}else this._createGeometry(e)},n.prototype._createGeometry=function(e){var n=this.getMode(),i=this.getMap(),o=this._getRegisterMode(),s=i._pointToPrj(e.point2d),a=this.getSymbol();if(!this._geometry){this._fireEvent("drawprepare",e),this._clickCoords=[s],e.drawTool=this,this._geometry=o.create(this.getMap().getProjection(),this._clickCoords,e),a&&"point"!==n?this._geometry.setSymbol(a):this.options.hasOwnProperty("symbol")&&this._geometry.setSymbol(this.options.symbol),this._addGeometryToStage(this._geometry),this._fireEvent("drawstart",e);var h=this._geometry.snapTo;if(h&&O2(h)){var l=this._getSnapResult(h,e.containerPoint),c=this.getMap();if(c&&l)this._clickCoords=[l.prjCoord],o.update(c.getProjection(),this._clickCoords,this._geometry,e)}}"point"===n&&"mousemove"!==e.type&&this.endDraw(e)},n.prototype._mouseMoveHandler=function(e){if(!this.options.interactive)return this;e.enableAltitude=this.options.enableAltitude;var n=this.getMap();if(n&&!n.isInteracting())if("point"!==this.getMode()||this._geometry){if(this._geometry){var i=this._getMouseContainerPoint(e);if(this._isValidContainerPoint(i)){var o=n._pointToPrj(e.point2d),s=[],a=this._geometry.snapTo;if(a&&O2(a)){var h=this._getSnapResult(a,i);o=h.prjCoord,s=h.effectedVertex}var l=n.getProjection();e.drawTool=this;var c=this._getRegisterMode();if(this._shouldRecordHistory(c.action)){var A=this._clickCoords.slice(0,this._historyPointer);if(A&&A.length>0&&o.equals(A[A.length-1]))return;c.update(l,A.concat(s,[o]),this._geometry,e)}else c.update(l,o,this._geometry,e);this._fireEvent("mousemove",e)}}}else this._createGeometry(e)},n.prototype._doubleClickHandler=function(e){if(!this.options.interactive)return this;if(e.enableAltitude=this.options.enableAltitude,this._geometry){var n=this._getMouseContainerPoint(e);if(this._isValidContainerPoint(n)){var i=this._getRegisterMode(),o=this._clickCoords;if(o&&!(o.length<2)){var s=this.getMode();if(!(s&&s.indexOf("polygon")>-1&&o.length<3)){for(var a=this.getMap().getProjection(),h=[o[0]],l=1,c=o.length;l<c;l++)o[l].x===o[l-1].x&&o[l].y===o[l-1].y||h.push(o[l]);h.length<2||this._geometry&&this._geometry instanceof jet&&h.length<3||(e.drawTool=this,i.update(a,h,this._geometry,e),this.endDraw(e))}}}}},n.prototype._addGeometryToStage=function(e){this._getDrawLayer().addGeometry(e)},n.prototype.endDraw=function(e){if(!this._geometry||this._ending)return this;this._ending=!0;var n=this._geometry;return this._clearStage(),e=e||{},this._geometry=n,e.ignoreEndEvent||this._fireEvent("drawend",e),delete this._geometry,this.options.once&&this.disable(),delete this._ending,delete this._historyPointer,this._vertexes&&(this._vertexes=[]),this},n.prototype._clearStage=function(){this._getDrawLayer().clear(),delete this._geometry,delete this._clickCoords},n.prototype._getMouseContainerPoint=function(e){var n=this._getRegisterMode().action;return(n[0].indexOf("mousedown")>=0||n[0].indexOf("touchstart")>=0)&&z3(e.domEvent),e.containerPoint},n.prototype._isValidContainerPoint=function(e){var n=this._map.getSize();return!(e.x<0||e.y<0)&&!(e.x>n.width||e.y>n.height)},n.prototype._getSnapResult=function(e,n){var i=this.getMap(),o=[];if(this.options.edgeAutoComplete){o.push(i.prjToContainerPoint(this._clickCoords[(this._historyPointer||1)-1]));var s=this._clickCoords[(this._historyPointer||1)-2];s&&o.push(i.prjToContainerPoint(s))}var a=e(n,o),h=i._containerPointToPrj(n=(a.effectedVertex?a.point:a)||n);return a.effectedVertex&&(a.effectedVertex=a.effectedVertex.map((function(e){return i._containerPointToPrj(e)}))),{prjCoord:h,effectedVertex:a.effectedVertex||[]}},n.prototype._getDrawLayer=function(){var e=t3+"drawtool",n=this._map.getLayer(e);return n||(n=new Ent(e,{enableSimplify:!1,enableAltitude:this.options.enableAltitude,zIndex:this.options.zIndex}),this._map.addLayer(n)),this._pushLayers(n),n},n.prototype._fireEvent=function(e,n){n||(n={}),n=P2({},n),this._geometry&&(n.geometry=this._getRegisterMode().generate(this._geometry,{drawTool:this}),n.tempGeometry=this._geometry),Rnt.prototype._fireEvent.call(this,e,n)},n.prototype._pushLayers=function(e){var n=this;return e?(Array.isArray(e)||(e=[e]),this._layers=this._layers||[],e.forEach((function(e){-1===n._layers.indexOf(e)&&n._layers.push(e)})),this):this},n.prototype._outLayers=function(e){var n=this;return e?(Array.isArray(e)||(e=[e]),this._layers=this._layers||[],e.forEach((function(e){for(var i=0,o=n._layers.length;i<o;i++)if(e===n._layers[i]){n._layers.splice(i,1);break}})),this):this},n.prototype.setLayerZIndex=function(e){return T2(e)?(this.options.zIndex=e,this._layers=this._layers||[],this._layers.forEach((function(n){n&&n.setZIndex&&n.setZIndex(e)})),this):this},n.prototype.addCoordinate=function(e){if(!this.isEnabled())return this;var n=this.getMap();if(!n)return this;e=new o9(e);var i=n._parseEventFromCoord(e);return this._clickHandler(i),this},n.prototype.getTempGeometry=function(){return this._geometry},n}(Rnt);Lnt.mergeOptions(Dnt);var Fnt=function(e){function n(n){var i=e.call(this,n)||this;return i.drawTool=new Lnt({mode:"boxZoom",ignoreMouseleave:!1}),i}return p5(n,e),n.prototype.addHooks=function(){this.target.on("_mousedown",this._onMouseDown,this)},n.prototype.removeHooks=function(){this.target.off("_mousedown",this._onMouseDown,this),this.drawTool.isEnabled()&&this.drawTool.remove()},n.prototype._onMouseDown=function(e){this.target.options.boxZoom&&e.domEvent.shiftKey&&this.drawTool.setSymbol(this.target.options.boxZoomSymbol).on("drawend",this._boxZoom,this).addTo(this.target)},n.prototype._boxZoom=function(e){var n=this.target;this.drawTool.remove();var i=e.geometry,o=i.getCenter(),s=i.getSymbol(),a=new y9(o,n.locateByPoint(o,s.markerWidth,s.markerHeight),n.getProjection()),h=n.getFitZoom(a);n._animateTo({center:a.getCenter(),zoom:h})},n}(y6);met.mergeOptions({boxZoom:!0,boxZoomSymbol:{markerType:"rectangle",markerLineWidth:3,markerLineColor:"#1bbc9b",markerLineDasharray:[10,5],markerFillOpacity:.1,markerFill:"#1bbc9b",markerWidth:1,markerHeight:1}}),met.addOnLoadHook("addHandler","boxZoom",Fnt);var Nnt=30,znt=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype.addHooks=function(){this.target&&this.target.on("_mousemove",this._onMouseMove,this)},n.prototype.removeHooks=function(){this.target&&this.target.off("_mousemove",this._onMouseMove,this)},n.prototype._onMouseMove=function(e){var n=this.target;if(n.options.autoPanAtEdge){var i=e.containerPoint,o=n.getContainerExtent();if(o){var s=i.x,a=i.y,h=o.xmax,l=o.ymax,c=void 0;s<Nnt&&(c=[Math.abs(s-Nnt),0]),a<Nnt&&(c=[0,Math.abs(a-Nnt)]),s+Nnt>h&&(c=[-Math.abs(s+Nnt-h),0]),a+Nnt>l&&(c=[0,-Math.abs(a+Nnt-l)]),c&&n.panBy(c,{duration:1})}}},n}(y6);function Bnt(e,n,i){return e*(1-i)+n*i}function Hnt(e){e.stopPropagation(),e.preventDefault()}met.mergeOptions({autoPanAtEdge:!1}),met.addOnLoadHook("addHandler","autoPanAtEdge",znt),met.include({animateTo:function(e,n,i){var o=this;void 0===n&&(n={}),e=P2({},this.getView(),e),this._validateView(e),O2(n)&&(i=n,n={});var s=this.getProjection(),a=this.getView(),h={},l=!0;for(var c in e)if(D2(e,c)&&!M2(e[c])&&("prjCenter"===c||!M2(a[c])))if(l=!1,"center"===c){var A=new o9(a[c]),f=new o9(e[c]);A.equals(f)||(h.center=[A,f])}else if("prjCenter"===c){A=new o9(this._getPrjCenter()),f=new o9(e[c]);A.equals(f)||(h.prjCenter=[A,f])}else a[c]!==e[c]&&"around"!==c&&(h[c]=[a[c],e[c]]);if(l)return null;this._animPlayer&&(this._isInternalAnimation?"running"===this._animPlayer.playState&&(this._animPlayer.pause(),this._prevAnimPlayer=this._animPlayer):(delete this._prevAnimPlayer,this._stopAnim(this._animPlayer)));var d=e.around||null,p=this._getRenderer(),g=this._animPlayer=Let.animate(h,{easing:n.easing||"out",duration:n.duration||this.options.zoomAnimationDuration,framer:function(e){p.callInNextFrame(e)},repeat:n.repeat},(function(e){if(o.isRemoved())g.finish();else{if("running"===g.playState){if(e.styles.center)o._setPrjCenter(s.project(e.styles.center)),o.onMoving(o._parseEventFromCoord(o.getCenter()));else if(e.styles.prjCenter){o._setPrjCenter(e.styles.prjCenter),o.onMoving(o._parseEventFromCoord(o.getCenter()))}M2(e.styles.zoom)||o.onZooming(e.styles.zoom,d),M2(e.styles.pitch)||o._setPitch(e.styles.pitch),M2(e.styles.bearing)||o._setBearing(e.styles.bearing),o._fireEvent("animating")}else"paused"===g.playState&&g!==o._mapAnimPlayer||(g._interupted||(h.center?o._setPrjCenter(s.project(h.center[1])):h.prjCenter&&o._setPrjCenter(h.prjCenter[1]),M2(h.pitch)||o._setPitch(h.pitch[1]),M2(h.bearing)||o._setBearing(h.bearing[1])),o._endAnim(g,h,d,n));i&&i(e)}}),this);return this._startAnim(h,d),g},_animateTo:function(e,n,i){return void 0===n&&(n={}),this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._isInternalAnimation=!0,this._mapAnimPlayer=this.animateTo(e,n,i),delete this._isInternalAnimation,this._mapAnimPlayer},flyTo:function(e,n,i){var o=this;void 0===n&&(n={}),e=P2({},this.getView(),e),this._validateView(e),this._animPlayer&&(this._isInternalAnimation?"running"===this._animPlayer.playState&&(this._animPlayer.pause(),this._prevAnimPlayer=this._animPlayer):(delete this._prevAnimPlayer,this._stopAnim(this._animPlayer))),O2(n)&&(i=n,n={}),n=P2({curve:1.42},n);var s=this;function a(e,n){return s.getResolution(n)/s.getResolution(e)}var h=e.around||new w5(this.width/2,this.height/2),l=this.getMinZoom(),c=this.getMaxZoom(),A=this.getProjection(),f=this.getView(),d=f.zoom,p=f.bearing,g=f.pitch,v="zoom"in e?N5(+e.zoom,l,c):d,w="bearing"in e?+e.bearing:p,C="pitch"in e?+e.pitch:g,P=A.project(e.center&&new o9(e.center)||this.getCenter()),T=a(v,d),S=A.project(this.getCenter()),I=P.sub(S),E=n.curve,O=Math.max(this.width,this.height),k=O/T,L=I.mag();if("minZoom"in n){var F=N5(Math.min(n.minZoom,d,v),l,c),N=O/a(F,d);E=Math.sqrt(N/L*2)}var z=E*E;function H(e){var n=(k*k-O*O+(e?-1:1)*z*z*L*L)/(2*(e?k:O)*z*L);return Math.log(Math.sqrt(n*n+1)-n)}function j(e){return(Math.exp(e)-Math.exp(-e))/2}function W(e){return(Math.exp(e)+Math.exp(-e))/2}var q=H(0),Y=function(e){return W(q)/W(q+E*e)},J=function(e){return O*((W(q)*function(e){return j(e)/W(e)}(q+E*e)-j(q))/z)/L},$=(H(1)-q)/E;if(Math.abs(L)<1e-6||!isFinite($)){if(Math.abs(O-k)<1e-6)return this.animateTo(e,n,i);var it=k<O?-1:1;$=Math.abs(Math.log(k/O))/E,J=function(){return 0},Y=function(e){return Math.exp(it*E*e)}}var rt=this._getRenderer(),ot=this._animPlayer=Let.animate({k:[0,1]},{easing:n.easing||"out",duration:n.duration||8,framer:function(e){rt.callInNextFrame(e)}},(function(s){if(o.isRemoved())ot.finish();else{var a=s.styles.k,l=a*$,c=1/Y(l),A={};if(e.center){var f=1===a?P:S.add(I.multi(J(l)));A.prjCenter=[P,f]}if(d!==v){var T=1===a?v:o.getZoomForScale(c,d,!0);A.zoom=[d,T]}if(g!==C){var E=Bnt(g,C,a);A.pitch=[C,E]}if(p!==w){var O=Bnt(p,w,a);A.bearing=[w,O]}if("running"===ot.playState){if(A.prjCenter)o._setPrjCenter(A.prjCenter[1]),o.onMoving(o._parseEventFromCoord(o.getCenter()));A.zoom&&o.onZooming(A.zoom[1],h),A.pitch&&o._setPitch(A.pitch[1]),A.bearing&&o._setBearing(A.bearing[1]),o._fireEvent("animating")}else"paused"===ot.playState&&ot!==o._mapAnimPlayer||(ot._interupted||(A.prjCenter&&o._setPrjCenter(A.prjCenter[1]),A.pitch&&o._setPitch(A.pitch[1]),A.bearing&&o._setBearing(A.bearing[1])),o._endAnim(ot,A,h,n));i&&i(s)}}),{});return this._startAnim({center:e.center,zoom:e.zoom!==d,pitch:C!==g,bearing:w!==p},h),this},isAnimating:function(){return!!this._animPlayer},isRotating:function(){return this.isDragRotating()||!!this._animRotating},_endAnim:function(e,n,i,o){delete this._animRotating;var s=e._interupted?"animateinterrupted":"animateend";if(e===this._animPlayer&&delete this._animPlayer,e===this._mapAnimPlayer&&delete this._mapAnimPlayer,n.center){var a=void 0;a=e._interupted?this.getCenter():n.center[1],this.onMoveEnd(this._parseEventFromCoord(a))}else if(n.prjCenter){a=void 0;a=e._interupted?this._getPrjCenter():n.prjCenter[1];var h=this._parseEventFromCoord(this.getProjection().unproject(a));h.point2d=this._prjToPoint(a),this.onMoveEnd(h)}M2(n.zoom)||(e._interupted?this.onZoomEnd(this.getZoom()):o.wheelZoom?this.onZooming(n.zoom[1],i):this.onZoomEnd(n.zoom[1])),s&&this._fireEvent(s),M2(n.pitch)||this.getPitch()||this.getRenderer().setToRedraw(),o.wheelZoom||this._resumePrev(e)},_startAnim:function(e,n){this._animPlayer&&((e.center||e.prjCenter)&&this.onMoveStart(),e.zoom&&!this.isZooming()&&this.onZoomStart(e.zoom[1],n),(e.pitch||e.bearing)&&(this._animRotating=!0),this._fireEvent("animatestart"),this._animPlayer.play())},_stopAnim:function(e){e&&(delete this._animRotating,"finished"!==e.playState&&(e._interupted=!0,e.cancel()),e===this._animPlayer&&delete this._animPlayer,e===this._mapAnimPlayer&&delete this._mapAnimPlayer)},_resumePrev:function(e){if(this._prevAnimPlayer){var n=this._prevAnimPlayer;"paused"!==n.playState&&delete this._prevAnimPlayer,e!==n&&(this._animPlayer=n,n.play())}}});var jnt=["dragstart","dragenter","dragend","dragleave","dragover"].join(" ").toString(),Unt="mousedown mouseup mouseover mouseout mouseenter mouseleave mousemove click dblclick contextmenu keypress touchstart touchmove touchend drop ";function Gnt(e,n,i,o){return e[0]=n,e[1]=i,e[2]=o,e}function Vnt(e,n,i){return e[0]=n[0]-i[0],e[1]=n[1]-i[1],e[2]=n[2]-i[2],e}function Wnt(e){var n=e[0],i=e[1],o=e[2];return Math.sqrt(n*n+i*i+o*o)}function qnt(e,n){var i=n[0],o=n[1],s=n[2],a=i*i+o*o+s*s;return a>0&&(a=1/Math.sqrt(a),e[0]=n[0]*a,e[1]=n[1]*a,e[2]=n[2]*a),e}function Znt(e,n){return e[0]*n[0]+e[1]*n[1]+e[2]*n[2]}function Qnt(e,n,i){var o=n[0],s=n[1],a=n[2],h=i[0],l=i[1],c=i[2];return e[0]=s*c-a*l,e[1]=a*h-o*c,e[2]=o*l-s*h,e}function Xnt(e,n){var i=n[0]-e[0],o=n[1]-e[1],s=n[2]-e[2];return Math.hypot?Math.hypot(i,o,s):function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var i=0,o=e.length;for(;o--;)i+=e[o]*e[o];return Math.sqrt(i)}(i,o,s)}function Ynt(e,n){qnt(e,e),qnt(n,n);var i=Znt(e,n);return i>1?0:i<-1?Math.PI:Math.acos(i)}function Jnt(e,n,i){var o=n[0],s=n[1],a=n[2],h=1/(i[3]*o+i[7]*s+i[11]*a+i[15]);return e[0]=(i[0]*o+i[4]*s+i[8]*a+i[12])*h,e[1]=(i[1]*o+i[5]*s+i[9]*a+i[13])*h,e[2]=(i[2]*o+i[6]*s+i[10]*a+i[14])*h,e}met.include({_registerDomEvents:function(){var e=this._panels.mapWrapper||this._containerDOM;k3(e,Unt,this._handleDOMEvent,this),k3(e,jnt,Hnt,this)},_removeDomEvents:function(){var e=this._panels.mapWrapper||this._containerDOM;L3(e,Unt,this._handleDOMEvent),L3(e,jnt,Hnt)},_handleDOMEvent:function(e){if(e&&"drop"===e.type){e.stopPropagation(),e.preventDefault();var n=this._parseEvent(e,e.type);return n=P2({},n,{dataTransfer:e.dataTransfer}),void this._fireEvent(e.type,n)}var i=this.options.clickTimeThreshold,o=e.type;if(!J3(o)||w2.isTest||!K3(this,this.options.mousemoveThrottleTime)){var s="mousedown"===o||"touchstart"===o&&(!e.touches||1===e.touches.length);s&&(this._domMouseDownTime=C2(),this._domMouseDownView=this.getView());var a="contextmenu"===o&&function(e){if(!e._domMouseDownView)return!0;var n=e.getView(),i=e._domMouseDownView;return n.bearing!==i.bearing||n.pitch!==i.pitch}(this);if("contextmenu"===o){N3(e);var h=this._domMouseDownTime;C2()-h<=i&&!a&&this._fireDOMEvent(this,e,"dom:"+e.type)}else this._fireDOMEvent(this,e,"dom:"+e.type);if(!this._ignoreEvent(e)&&!this._isEventOutMap(e)){var l,c=!1;if(s)this._mouseDownTime=C2();else if("click"===o||"touchend"===o||"contextmenu"===o){if(!this._mouseDownTime)return;h=this._mouseDownTime;if(delete this._mouseDownTime,C2()-h>i){if("click"===o||"contextmenu"===o)return}else if("contextmenu"===o){if(a)return}else"touchend"===o&&(c=!0)}c&&(this._clickTime&&C2()-this._clickTime<=i?(delete this._clickTime,l="dblclick",this._fireDOMEvent(this,e,"dom:dblclick")):(this._clickTime=C2(),l="click",this._fireDOMEvent(this,e,"dom:click"))),this._ignoreEvent(e)||this._isEventOutMap(e)||(this._fireDOMEvent(this,e,o),l&&this._fireDOMEvent(this,e,l))}}},_ignoreEvent:function(e){if(!e||!this._panels.control)return!1;var n,i=e.srcElement||e.target;if(i)for(;i&&i!==this._containerDOM;){if(i.className&&i.className.indexOf&&(i.className.indexOf("maptalks-control")>=0||i.className.indexOf("maptalks-ui")>=0&&n&&!n.eventsPropagation))return!0;n=i,i=i.parentNode}return!1},_isEventOutMap:function(e){if(this.getPitch()>this.options.maxVisualPitch){var n=j3(this._getActualEvent(e),this._containerDOM);if(!this.getContainerExtent().contains(n))return!0}return!1},_wrapTerrainData:function(e){e.containerPoint&&!e.terrain&&(e.terrain=this._queryTerrainInfo(e.containerPoint))},_parseEvent:function(e,n){if(!e)return null;var i={domEvent:e};if("keypress"!==n){var o=this._getActualEvent(e);if(o&&void 0!==o.clientX){var s=j3(o,this._containerDOM);i=P2(i,{containerPoint:s,viewPoint:this.containerPointToViewPoint(s)});var a=this.options.maxVisualPitch;(this.getPitch()<=a||s.y>=this.height-this._getVisualHeight(a))&&(i=P2(i,{coordinate:this.containerPointToCoord(s),point2d:this._containerPointToPoint(s)}))}}return this._wrapTerrainData(i),i},_parseEventFromCoord:function(e){var n=this.coordToContainerPoint(e);return{coordinate:e,containerPoint:n,viewPoint:this.containerPointToViewPoint(n),point2d:this.coordToPoint(e)}},_getActualEvent:function(e){return e.touches&&e.touches.length>0?e.touches[0]:e.changedTouches&&e.changedTouches.length>0?e.changedTouches[0]:e},_fireDOMEvent:function(e,n,i){var o=this;if(!this.isRemoved()){var s=this._parseEvent(n,i);this._wrapTerrainData(s),J3(i)?this.getRenderer().callInNextFrame((function(){o._fireEvent(s.domEvent&&s.domEvent._cancelBubble?"_"+i:i,s)})):this._fireEvent(i,s)}},_getEventParams:function(e){var n=this,i={domEvent:e},o=e.touches&&e.touches.length>0?e.touches[0]:e.changedTouches&&e.changedTouches.length>0?e.changedTouches[0]:e;if(o){var s=j3(o,n.getContainer());i.coordinate=n.containerPointToCoordinate(s),i.containerPoint=s,i.viewPoint=n.containerPointToViewPoint(s),i.point2d=n._containerPointToPoint(s)}return this._wrapTerrainData(i),i}}),met.addOnLoadHook("_registerDomEvents"),met.include({isFullScreen:function(){var e=document;return!!(e.webkitIsFullScreen||e.mozFullScreen||e.msFullscreenElement||e.fullscreenElement)},requestFullScreen:function(e){return this._fireEvent("fullscreenstart"),this._requestFullScreen(e||this._containerDOM),this._fireEvent("fullscreenend"),this},cancelFullScreen:function(){return this._cancelFullScreen(),this._fireEvent("cancelfullscreen"),this},_requestFullScreen:function(e){if(e.requestFullscreen)e.requestFullscreen();else if(e.mozRequestFullScreen)e.mozRequestFullScreen();else if(e.webkitRequestFullScreen)e.webkitRequestFullScreen();else if(e.msRequestFullScreen)e.msRequestFullScreen();else{var n="fullscreen=1,status=no,resizable=yes,top=0,left=0,scrollbars=no,titlebar=no,menubar=no,location=no,toolbar=no,z-look=yes,width="+(screen.availWidth-8)+",height="+(screen.availHeight-45);null!==window.open(location.href,"_blank",n)&&(window.opener=null,window.close())}},_cancelFullScreen:function(){var e=document;if(document.exitFullscreen)document.exitFullscreen();else if(e.mozCancelFullScreen)e.mozCancelFullScreen();else if(e.webkitCancelFullScreen)e.webkitCancelFullScreen();else{null!==window.open(location.href,"_blank","fullscreen=no,status=yes,resizable=yes,scrollbars=no,titlebar=no,menubar=yes,location=yes,toolbar=yes,z-look=yes")&&(window.opener=null,window.close())}}}),met.include({panTo:function(e,n,i){if(void 0===n&&(n={}),!e)return this;if(O2(n)&&(i=n,n={}),e=new o9(e),void 0===n.animation||n.animation){var o=this.getProjection().project(e);return this._panAnimation(o,n.duration,i)}return this.setCenter(e),this},_panTo:function(e,n){return void 0===n&&(n={}),void 0===n.animation||n.animation?this._panAnimation(e,n.duration):(this.onMoveStart(),this._setPrjCenter(e),this.onMoveEnd(this._parseEventFromCoord(this.getCenter())),this)},panBy:function(e,n,i){if(void 0===n&&(n={}),!e)return this;if(O2(n)&&(i=n,n={}),e=new w5(e),this.getContainerExtent().ymin>0&&e.y>30){var o=e.y;e.y=30,e.x=30*e.x/o,console.warn("offset is limited to panBy when pitch is above maxPitch")}if(void 0===n.animation||n.animation){e=e.multi(-1);var s=this._containerPointToPrj(new w5(this.width/2+e.x,this.height/2+e.y));this._panAnimation(s,n.duration,i)}else{this.onMoveStart(),this._offsetCenterByPixel(e);var a=this.containerPointToCoord(new w5(this.width/2,this.height/2));this.onMoveEnd(this._parseEventFromCoord(a))}return this},_panAnimation:function(e,n,i){return this._animateTo({prjCenter:e},{duration:n||this.options.panAnimationDuration},i)}}),met.include({computeLength:function(e,n){if(!this.getProjection())return null;var i=new o9(e),o=new o9(n);return i.equals(o)?0:this.getProjection().measureLength(i,o)},computeGeometryLength:function(e){return e._computeGeodesicLength(this.getProjection())},computeGeometryArea:function(e){return e._computeGeodesicArea(this.getProjection())},identify:function(e,n){var i=new o9((e=e||{}).coordinate);return this._identify(e,n,(function(n){return n.identify(i,e)}))},identifyAtPoint:function(e,n){var i=e.includeInternals,o=e.tolerance,s=new w5((e=e||{}).containerPoint),a=this.containerPointToCoord(s);return this._identify(e,n,(function(n){var s,h=e.containerPoint;if(i&&!M2(n.options.geometryEventTolerance)&&(e.tolerance=e.tolerance||0,e.tolerance+=n.options.geometryEventTolerance),n._hasGeoListeners&&i&&e.eventTypes.indexOf("mousemove")>=0&&!n._hasGeoListeners(e.eventTypes))return[];(s=n.identifyAtPoint?n.identifyAtPoint(h,e):a&&n.identify?n.identify(a,e):[],i&&(M2(o)?delete e.tolerance:e.tolerance=o),s&&s.length)||(n.fire("identifyempty",e),n.getLayers&&O2(n.getLayers)&&(n.getLayers()||[]).filter((function(e){return e})).forEach((function(n){n.fire("identifyempty",e)})));return s}))},_identify:function(e,n,i){var o=e.layers;if(!z5(o))return this;for(var s=e.eventTypes,a=[],h=0,l=o.length;h<l;h++)E2(o[h])?a.push(this.getLayer(o[h])):a.push(o[h]);s&&(a=a.filter((function(e){return!e._hasGeoListeners||e._hasGeoListeners(s)})));var c=[];for(h=a.length-1;h>=0&&!(e.count&&c.length>=e.count);h--){var A=a[h];if(A&&A.getMap()&&(e.includeInvisible||A.isVisible())&&(e.includeInternals||!(A.getId().indexOf(t3)>=0))){var f=i(A),d=A.getId();if(f)if(Array.isArray(f)){for(var p=0;p<f.length;p++)f[p]&&!f[p].getLayer&&M2(f[p].layer)&&(f[p].layer=d);E5(c,f)}else!f.getLayer&&M2(f.layer)&&(f.layer=d),c.push(f)}}return n.call(this,c),this}}),met.include({_zoom:function(e,n){this.options.zoomable&&!this.isZooming()&&(n=this._checkZoomOrigin(n),e=this._checkZoom(e),this.onZoomStart(e,n),this._frameZoom=this.getZoom(),this.onZoomEnd(e,n))},_zoomAnimation:function(e,n,i){this.options.zoomable&&!this.isZooming()&&(e=this._checkZoom(e),this.getZoom()!==e&&(n=this._checkZoomOrigin(n),this._startZoomAnim(e,n,i)))},_checkZoomOrigin:function(e){return e&&!this.options.zoomInCenter||(e=new w5(this.width/2,this.height/2)),this.options.zoomOrigin&&(e=new w5(this.options.zoomOrigin)),e},_startZoomAnim:function(e,n,i){M2(i)&&(i=1);var o=this._getResolution(this._startZoomVal)/this._getResolution(e),s=this.options.zoomAnimationDuration*Math.abs(o-i)/Math.abs(o-1);this._frameZoom=this._startZoomVal,this._animateTo({zoom:e,around:n},{continueOnViewChanged:!0,duration:s})},onZoomStart:function(e,n){this.options.zoomable&&!this.isZooming()&&(this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),delete this.cameraZenithDistance,this._zooming=!0,this._startZoomVal=this.getZoom(),this._startZoomCoord=n&&this._containerPointToPrj(n),this._fireEvent("zoomstart",{from:this._startZoomVal,to:e}))},onZooming:function(e,n,i){if(this.options.zoomable&&this._frameZoom!==e){M2(i)&&(i=1),this._zoomTo(e,n);var o=this.getResolution(e),s=this.getResolution(this._startZoomVal)/o/i,a=this._startZoomCoord&&this.prjToContainerPoint(this._startZoomCoord,this._startZoomVal),h=this.getViewPoint();if(!this.isRotating()&&a&&!a.equals(n)&&1!==s){var l=this.getPitch(),c=a._sub(n)._multi(1/(1-s));l&&(c.y/=Math.cos(l*Math.PI/180)),n=n.add(c)}var A=n&&n.x||this.width/2,f=n&&n.y||this.height/2,d={view:[s,0,0,s,(A-h.x)*(1-s),(f-h.y)*(1-s)]},p=this.getDevicePixelRatio();d.container=[s,0,0,s,A*p*(1-s),f*p*(1-s)],this._fireEvent("zooming",{from:this._startZoomVal,to:e,origin:new w5(A,f),matrix:d}),this._frameZoom=e}},onZoomEnd:function(e,n){if(this.options.zoomable){var i=this._startZoomVal;this._zoomTo(e,n),this._zooming=!1,this._getRenderer().onZoomEnd(),this._suppressRecenter||this._recenterOnTerrain(),this._fireEvent("zoomend",{from:i,to:e}),this._verifyExtent(this._getPrjCenter())||this.options.limitExtentOnMaxExtent||this._panTo(this._prjMaxExtent.getCenter())}},_zoomTo:function(e,n){if(this._zoomLevel=e,this._calcMatrices(),n&&this._startZoomCoord){var i=this._containerPointToPoint(n)._sub(this._prjToPoint(this._getPrjCenter()));this._setPrjCoordAtOffsetToCenter(this._startZoomCoord,i)}},_checkZoom:function(e){var n=this.getMaxZoom(),i=this.getMinZoom();return e<i&&(e=i),e>n&&(e=n),e}});var Knt=Math.PI/180,$nt=new o9(0,0),tit=new w5(0,0),eit=[0,-1,0],nit=[];function iit(){return a8(new Array(16))}
/*!
   * contains code from mapbox-gl-js
   * https://github.com/mapbox/mapbox-gl-js
   * LICENSE : MIT
   * (c) mapbox
   *
   */
met.include({getFov:function(){return this._fov||(this._fov=.6435011087932844),this._fov/Knt},setFov:function(e){if(this.isZooming())return this;if(e=Math.max(.01,Math.min(60,e)),this._fov===e)return this;var n=this.getFov();return this._fov=e*Knt,this._calcMatrices(),this._renderLayers(),this._fireEvent("fovchange",{from:n,to:this.getFov()}),this},getBearing:function(){return this._angle?-this._angle/Knt:0},setBearing:function(e){var n={bearing:e};return this._validateView(n),this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._setBearing(n.bearing)},_setBearing:function(e){if(f5.ie9)throw new Error("map can't rotate in IE9.");var n=-F5(e,-180,180)*Knt;if(this._angle===n)return this;var i=this.getBearing();return this._fireEvent("rotatestart",{from:i,to:n}),this._angle=n,this._calcMatrices(),this._renderLayers(),this._fireEvent("rotate",{from:i,to:n}),this._fireEvent("rotateend",{from:i,to:n}),this},getPitch:function(){return this._pitch?this._pitch/Math.PI*180:0},setPitch:function(e){var n={pitch:e};return this._validateView(n),this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._setPitch(n.pitch)},_setPitch:function(e){if(f5.ie9)throw new Error("map can't tilt in IE9.");var n=N5(e,0,this.options.maxPitch)*Knt;if(this._pitch===n)return this;var i=this.getPitch();return this._fireEvent("pitchstart",{from:i,to:n}),this._pitch=n,this._calcMatrices(),this._renderLayers(),this._fireEvent("pitch",{from:i,to:n}),this._fireEvent("pitchend",{from:i,to:n}),this},setCameraMovements:function(e,n){var i=this;if(!Array.isArray(e)||!e.length)return this;if(e.forEach((function(e){i._validateView(e)})),this.setView({center:e[0].center,zoom:e[0].zoom,pitch:e[0].pitch,bearing:e[0].bearing}),1===e.length)return this;var o=1,s=function(a){if("finished"===a.state.playState){++o===e.length-1&&(s=null);var h=e[o];h.duration=h.timestamp-e[o-1].timestamp,n&&n.autoRotate&&(h.bearing=function(e,n){var i=L2(e[0]),o=L2(n[0]),s=L2(e[1]),a=L2(n[1]),h=Math.sin(o-i)*Math.cos(a),l=Math.cos(s)*Math.sin(a)-Math.sin(s)*Math.cos(a)*Math.cos(o-i);return F2(Math.atan2(h,l))}(e[o-1].center,h.center)),i._setCameraMovement(h,s)}};2===e.length&&(s=null);var a=this.getBearing();this._setCameraMovement(g5({bearing:a,duration:e[o].timestamp-e[o-1].timestamp},e[o]),s);return{play:function(){i._animPlayer.play()},pause:function(){i._animPlayer.pause()},cancel:function(){i._animPlayer.cancel()},finish:function(){i._animPlayer.finish()},reverse:function(){i._animPlayer.reverse()}}},_setCameraMovement:function(e,n){this.animateTo({zoom:e.zoom,center:e.center,pitch:e.pitch,bearing:e.bearing},{duration:e.duration,easing:"out"},n)},setCameraOrientation:function(e){var n=e.position,i=e.pitch,o=e.bearing;this._validateView(e),o=o||0;var s=this.getFitZoomForCamera(n,i=i||0),a=s.zoom,h=s.cameraToGroundDistance,l=Math.sin(i*Knt)*h,c=F5(o,-180,180)*Knt,A=this.getGLRes(),f=new o9(n[0],n[1]),d=this.coordToPointAtRes(f,A),p=new w5(0,0);p.x=d.x+l*Math.sin(c),p.y=d.y+l*Math.cos(c);var g=this._pointToPrjAtRes(p,this.getGLRes());return this._setPrjCenter(g),this.setView({bearing:o,pitch:i,zoom:a}),this},setCameraPosition:function(e){var n=this.getGLRes(),i=this.coordToPointAtRes(e,n);i.z=this.altitudeToPoint(e.z||0,n);var o=this.getCenter(),s=this.coordToPointAtRes(o,n);s.z=this.altitudeToPoint(o.z,n);var a=Vnt([],i.toArray(),s.toArray());Gnt(this.cameraUp||[0,0,0],0,0,1),this._pitch=Ynt(a,this.cameraUp),Gnt(nit,a[0],a[1],0),this._angle=-Ynt(nit,eit),this._zoomLevel=this.getFitZoomForCamera(e,this._pitch).zoom,this._calcMatrices()},getFitZoomForCamera:function(e,n){var i=Array.isArray(e)?e[2]:e.z,o=(this.centerAltitude||0)*this._meterToGLPoint,s=(i*this._meterToGLPoint-o)/Math.cos(n*Knt);return{zoom:this.getFitZoomForAltitude(s+o),cameraToGroundDistance:s}},getFitZoomForAltitude:function(e){for(var n=e*this._getFovRatio()*2/(this.height||1)*this.getGLRes(),i=this._getResolutions(),o=0;o<i.length-1;o++){if(i[o]===n)return o;if(i[o+1]===n)return o+1;if(n<i[o]&&n>i[o+1])return(o=(n-i[o])/(i[o+1]-i[o])+o)-1}return o},isTransforming:function(){return!(!this._pitch&&!this._angle)},getFrustumAltitude:function(){return this._frustumAltitude},_calcFrustumAltitude:function(){var e=90-this.getPitch(),n=this.getFov()/2,i=this.cameraPosition?this.cameraPosition[2]:0;if(n<=e)return i;n=Math.PI*n/180;var o=new w5(this.cameraPosition).distanceTo(new w5(this.cameraLookAt)),s=i*Math.tan(2*n);return i+Math.tan(n)*(o+s)},_pointToContainerPoint:function(e,n,i,o){void 0===i&&(i=0);var s=this._getResolution(n);return this._pointAtResToContainerPoint(e,s,i,o)},_pointAtResToContainerPoint:function(e,n,i,o){void 0===i&&(i=0),o||(o=new w5(0,0)),e=this._pointAtResToPoint(e,n,o);var s,a=this.isTransforming();return a||i||(s=this._prjToPoint(this._getPrjCenter(),void 0,$nt)),this._toContainerPoint(o,a,i,s),o},_pointsAtResToContainerPoints:function(e,n,i,o){void 0===i&&(i=[]),void 0===o&&(o=[]);var s=this.getPitch(),a=this.getBearing(),h=n/this._getResolution();if(0===s&&0===a&&!function(e){if(T2(e))return 0!==e;if(Array.isArray(e)&&e.length>0)for(var n=0,i=e.length;n<i;n++)if(T2(e[n])&&0!==e[n])return!0;return!1}(i)){var l=this.get2DExtent(),c=l.xmin,A=l.ymin,f=l.xmax,d=l.ymax;if(f>c&&d>A){for(var p=this.getSize(),g=p.height,v=(f-c)/p.width,w=(d-A)/g,C=0,P=e.length;C<P;C++){if(e[C])(E=o[C]).x=e[C].x,E.y=e[C].y,E._multi(h),E.x=(E.x-c)*v,E.y=g-(E.y-A)*w;else o[C]=null}return o}}var T=Array.isArray(i),S=this.isTransforming(),I=this._prjToPoint(this._getPrjCenter(),void 0,$nt);for(C=0,P=e.length;C<P;C++){var E;if(e[C])(E=o[C]).x=e[C].x,E.y=e[C].y,E._multi(h),this._toContainerPoint(E,S,T?i[C]||0:i,I);else o[C]=null}return o},_toContainerPoint:function(){var e=[0,0,0];return function(n,i,o,s){var a=this.width/2,h=this.height/2;if(i||o){this._altitudeScale||(this._altitudeScale=this.altitudeToPoint(100,this.getGLRes())/100);var l=this._glScale;Gnt(e,n.x*l,n.y*l,o*this._altitudeScale);var c=this._projIfBehindCamera(e,this.cameraPosition,this.cameraForward);Jnt(c,c,this.projViewMatrix),n.x=c[0]*a+a,n.y=-c[1]*h+h}else n._sub(s.x,s.y),n.set(n.x,-n.y),n._add(a,h)}}(),_projIfBehindCamera:function(){var e=new Array(3),n=new Array(3),i=new Array(3);return function(o,s,a){Vnt(e,o,s);var h=Znt(a,e);return h<=0&&(function(e,n,i){e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i}(n,a,1.01*h),function(e,n,i){e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2]}(o,s,Vnt(i,e,n))),o}}(),_containerPointToPoint:function(e,n,i,o){var s=this._getResolution(n);return this._containerPointToPointAtRes(e,s,i,o)},_containerPointToPointAtRes:function(){var e=[0,0,0],n=[0,0,0,1],i=[0,0,0,1];return function(o,s,a,h){if(this.isTransforming()){var l=this.width/2||1,c=this.height/2||1;Gnt(e,(o.x-l)/l,(c-o.y)/c,0),Gnt(n,e[0],e[1],0),Gnt(i,e[0],e[1],1),n[3]=i[3]=1,Jnt(n,n,this.projViewMatrixInverse),Jnt(i,i,this.projViewMatrixInverse);var A=n[0],f=i[0],d=n[1],p=i[1],g=n[2],v=i[2],w=h?this.altitudeToPoint(h,s)*this._glScale:0,C=g===v?w:(w-g)/(v-g),P=L5(A,f,C),T=L5(d,p,C);return a?(a.x=P,a.y=T):a=new w5(P,T),a._multi(1/this._glScale),this._getResolution()===s?a:this._pointToPointAtRes(a,s,a)}var S=this._prjToPointAtRes(this._getPrjCenter(),s,a),I=this._getResolution()/s;return S._add(I*(o.x-this.width/2),-(I*(o.y-this.height/2)))}}(),_calcMatrices:function(){var e=iit();return function(){delete this._mapRes,delete this._mapGlRes,delete this._mapExtent2D,delete this._mapGlExtent2D;var n=this.getSize(),i=n.width||1,o=n.height||1;this._glScale=this.getGLScale();var s=this._getCameraWorldMatrix(),a=this.getFov()*Math.PI/180,h=this._getCameraFar(a,this.getPitch());this.cameraFar=h,this.cameraNear=this.cameraCenterDistance/20;var l=this.projMatrix||iit();n8(l,a,i/o,this.cameraNear,h),this.projMatrix=l,this.viewMatrix=s8(this.viewMatrix||iit(),s),this.projViewMatrix=o8(this.projViewMatrix||iit(),l,this.viewMatrix),this._calcCascadeMatrixes(),this.projViewMatrixInverse=o8(this.projViewMatrixInverse||iit(),s,s8(e,l)),this.domCssMatrix=this._calcDomMatrix(),this._frustumAltitude=this._calcFrustumAltitude(),this._mapRes=this._getResolution(),this._mapGlRes=this.getGLRes(),this._mapExtent2D=this.get2DExtent(),this._mapGlExtent2D=this.get2DExtentAtRes(this._mapGlRes)}}(),_getCameraFar:function(e,n){var i=this.cameraCenterDistance=Xnt(this.cameraPosition,this.cameraLookAt);n=n*Math.PI/180;var o=i/this._meterToGLPoint+this.options.cameraFarUndergroundInMeter/Math.cos(n);return Math.max(o*this._meterToGLPoint,5*i)},_calcCascadeMatrixes:function(){var e=iit();function n(n,i,o){var s=this.width,a=this.height,h=this.getFov()*Math.PI/180,l=this._getCameraFar(h,i),c=this.cameraCenterDistance;return l=c+(l-c)/Math.cos((90-i)*Math.PI/180)*Math.cos((90-n)*Math.PI/180),n8(e,h,s/a,.1,l),o8(o,e,this.viewMatrix)}return function(){var e=this.getPitch(),i=this.options.cascadePitches[0],o=this.options.cascadePitches[1],s=this.cascadeFrustumMatrix0=this.cascadeFrustumMatrix0||iit(),a=this.cascadeFrustumMatrix1=this.cascadeFrustumMatrix1||iit();e>i?n.call(this,e,i,s):h8(this.cascadeFrustumMatrix0,this.projViewMatrix),e>o?n.call(this,e,o,a):h8(this.cascadeFrustumMatrix1,this.cascadeFrustumMatrix0)}}(),_calcDomMatrix:function(){var e=iit(),n=iit(),i=[1,-1,1],o=[0,0,0];return function(){var s=this.width||1,a=this.height||1,h=.5/Math.tan(this._fov/2)*a;return r8(e,this.projMatrix,i),i8(e,e,Gnt(o,0,0,-h)),this._pitch&&function(e,n,i){var o=Math.sin(i),s=Math.cos(i),a=n[4],h=n[5],l=n[6],c=n[7],A=n[8],f=n[9],d=n[10],p=n[11];n!==e&&(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e[4]=a*s+A*o,e[5]=h*s+f*o,e[6]=l*s+d*o,e[7]=c*s+p*o,e[8]=A*s-a*o,e[9]=f*s-h*o,e[10]=d*s-l*o,e[11]=p*s-c*o}(e,e,this._pitch),this._angle&&function(e,n,i){var o=Math.sin(i),s=Math.cos(i),a=n[0],h=n[1],l=n[2],c=n[3],A=n[4],f=n[5],d=n[6],p=n[7];n!==e&&(e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e[0]=a*s+A*o,e[1]=h*s+f*o,e[2]=l*s+d*o,e[3]=c*s+p*o,e[4]=A*s-a*o,e[5]=f*s-h*o,e[6]=d*s-l*o,e[7]=p*s-c*o}(e,e,this._angle),a8(n),r8(n,n,Gnt(o,s/2,-a/2,1)),o8(this.domCssMatrix||iit(),n,e)}}(),_getFovZ:function(e){var n=this.getGLScale(e),i=this._getFovRatio();return n*(this.height||1)/2/i},_getCameraWorldMatrix:function(){var e={};return function(){var n=this.getGLRes();this._meterToGLPoint||(this._meterToGLPoint=this.distanceToPointAtRes(100,0,n).x/100);var i=this._prjToPointAtRes(this._prjCenter,n,tit),o=this.getCenter().z,s=(void 0!==o?o:this.centerAltitude||0)*this._meterToGLPoint;this.cameraLookAt=Gnt(this.cameraLookAt||[0,0,0],i.x,i.y,s);var a=this.getPitch()*Knt,h=this.getBearing()*Knt,l=this._getFovZ(),c=(void 0===this.cameraZenithDistance?l:this.cameraZenithDistance)-s,A=c*Math.cos(a),f=Math.sin(a)*c,d=i.x-f*Math.sin(h),p=i.y-f*Math.cos(h);this.cameraPosition=Gnt(this.cameraPosition||[0,0,0],d,p,A+s),this.cameraToCenterDistance=l;var g=f||1;this.cameraUp=this.cameraUp||[0,0,0];var v=this.cameraUp=Gnt(this.cameraUp,Math.sin(h)*g,Math.cos(h)*g,Math.sin(a)*g),w=this.cameraWorldMatrix=this.cameraWorldMatrix||iit();!function(e,n,i,o){var s=[0,0,0],a=[0,0,0],h=[0,0,0];Vnt(h,n,i),0===Wnt(h)&&(h[2]=1),qnt(h,h),Qnt(s,o,h),0===Wnt(h)&&(1===Math.abs(o[2])?h[0]+=1e-4:h[2]+=1e-4,qnt(h,h),Qnt(s,o,h)),qnt(s,s),Qnt(a,h,s),e[0]=s[0],e[4]=a[0],e[8]=h[0],e[1]=s[1],e[5]=a[1],e[9]=h[1],e[2]=s[2],e[6]=a[2],e[10]=h[2]}(w,this.cameraPosition,this.cameraLookAt,v);var C=this.cameraForward||[0,0,0];return Vnt(C,this.cameraLookAt,this.cameraPosition),this.cameraForward=qnt(C,C),function(e,n){var i,o=n[0],s=n[4],a=n[8],h=n[1],l=n[5],c=n[9],A=n[2],f=n[6],d=n[10],p=o+l+d;p>0?(i=.5/Math.sqrt(p+1),e.w=.25/i,e.x=(f-c)*i,e.y=(a-A)*i,e.z=(h-s)*i):o>l&&o>d?(i=2*Math.sqrt(1+o-l-d),e.w=(f-c)/i,e.x=.25*i,e.y=(s+h)/i,e.z=(a+A)/i):l>d?(i=2*Math.sqrt(1+l-o-d),e.w=(a-A)/i,e.x=(s+h)/i,e.y=.25*i,e.z=(c+f)/i):(i=2*Math.sqrt(1+d-o-l),e.w=(h-s)/i,e.x=(a+A)/i,e.y=(c+f)/i,e.z=.25*i)}(e,w),function(e,n){var i=e,o=n.x,s=n.y,a=n.z,h=n.w,l=o+o,c=s+s,A=a+a,f=o*l,d=o*c,p=o*A,g=s*c,v=s*A,w=a*A,C=h*l,P=h*c,T=h*A;i[0]=1-(g+w),i[4]=d-T,i[8]=p+P,i[1]=d+T,i[5]=1-(f+w),i[9]=v-C,i[2]=p-P,i[6]=v+C,i[10]=1-(f+g),i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1}(w,e),function(e,n){var i=e;i[12]=n[0],i[13]=n[1],i[14]=n[2]}(w,this.cameraPosition),w}}(),updateCenterAltitude:function(){this.getRenderer().setToRedraw(),!this.centerAltitude&&this._hasAltitudeLayer()&&(this.centerAltitude=0),this._recenterOnTerrain()},_recenterOnTerrain:function(){if(void 0!==this.centerAltitude&&void 0===this._centerZ){var e=this._queryTerrainByProjCoord(this._prjCenter);M2(e)&&this._hasAltitudeLayer()&&(e=this.centerAltitude);var n=e||0,i=this.getPitch()*Knt,o=this.getBearing()*Knt,s=(n-this.centerAltitude)*this._meterToGLPoint,a=this._getFovZ(),h=(void 0===this.cameraZenithDistance?a:this.cameraZenithDistance)-this.centerAltitude*this._meterToGLPoint-s/Math.cos(i),l=this.cameraPosition,c=Math.sin(i)*h,A=tit;A.x=l[0]+c*Math.sin(o),A.y=l[1]+c*Math.cos(o);var f=n*this._meterToGLPoint;this.cameraZenithDistance=(l[2]-f)/Math.cos(i)+f,this.centerAltitude=n;var d=this.pointAtResToCoordinate(A,this.getGLRes(),$nt);this._eventSilence=!0,this._suppressRecenter=!0,this.setCenter(d),delete this._suppressRecenter,delete this._eventSilence,M2(e)&&delete this.centerAltitude}},_queryTerrainByProjCoord:function(e){for(var n=this._getLayers(),i=0;i<n.length;i++)if(n[i].queryTerrainByProjCoord)return n[i].queryTerrainByProjCoord(e)[0];return 0},_hasAltitudeLayer:function(){for(var e=this._getLayers(),n=0;n<e.length;n++)if(e[n].getTerrainLayer&&e[n].getTerrainLayer())return!0;return!1},_queryTerrainInfo:function(e){for(var n=this._getLayers()||[],i=0;i<n.length;i++){var o=n[i];if(e&&o&&o.queryTerrainAtPoint&&o.getTerrainLayer&&o.getTerrainLayer()){var s=o.queryTerrainAtPoint(e);if(s)return{coordinate:s,altitude:s.z};break}}return null},_getFovRatio:function(){var e=this.getFov();return Math.tan(e/2*Knt)},_renderLayers:function(){this.isInteracting()||this._getLayers().forEach((function(e){if(e){var n=e._getRenderer();n&&n.setToRedraw&&n.setToRedraw()}}))}}),met.include({_onViewChange:function(e){this._viewHistory||(this._viewHistory=[],this._viewHistoryPointer=0);for(var n=this._getCurrentView(),i=this._viewHistory.length-1;i>=0;i--)if(q5(e,this._viewHistory[i]))return this._viewHistoryPointer=i,void this._fireViewChange(n,e);this._viewHistoryPointer<this._viewHistory.length-1&&this._viewHistory.splice(this._viewHistoryPointer+1),this._viewHistory.push(e);var o=this.options.viewHistoryCount;o>0&&this._viewHistory.length>o&&this._viewHistory.splice(0,this._viewHistory.length-o),this._viewHistoryPointer=this._viewHistory.length-1,this._fireViewChange(n,e)},zoomToPreviousView:function(e){if(void 0===e&&(e={}),!this.hasPreviousView())return null;var n=this._viewHistory[--this._viewHistoryPointer];return this._zoomToView(n,e),n},hasPreviousView:function(){return!(!this._viewHistory||0===this._viewHistoryPointer)},zoomToNextView:function(e){if(void 0===e&&(e={}),!this.hasNextView())return null;var n=this._viewHistory[++this._viewHistoryPointer];return this._zoomToView(n,e),n},hasNextView:function(){return!(!this._viewHistory||this._viewHistoryPointer===this._viewHistory.length-1)},_zoomToView:function(e,n){var i=this,o=this.getView();n.animation?this._animateTo(e,{duration:n.duration},(function(n){"finished"===n.state.playState&&i._fireViewChange(o,e)})):(this.setView(e),this._fireViewChange(o,e))},getViewHistory:function(){return this._viewHistory},_fireViewChange:function(e,n){this._fireEvent("viewchange",{old:e,new:n}),this._insertUICollidesQueue()},_getCurrentView:function(){return this._viewHistory?this._viewHistory[this._viewHistoryPointer]:null}}),met.mergeOptions({viewHistory:!0,viewHistoryCount:10});var rit=new $6;met.include({getCollisionIndex:function(){return this._collisionIndex||this.createCollisionIndex(),this._collisionIndex||this.createCollisionIndex()},createCollisionIndex:function(){return this.clearCollisionIndex(),this._collisionIndex=new $6,this._collisionIndex},clearCollisionIndex:function(){return this.collisionFrameTime=0,this._collisionIndex&&this._collisionIndex.clear(),this},_insertUICollidesQueue:function(){return this._uiCollidesQueue||(this._uiCollidesQueue=[]),this._uiCollidesQueue.push(1),this},uiCollides:function(){if(!this.uiList||0===this.uiList.length||!this._uiCollidesQueue||0===this._uiCollidesQueue.length)return this;var e=rit;e.clear();for(var n=this.uiList,i=0,o=n.length;i<o;i++){var s=n[i],a=s.options,h=a.collisionBufferSize;if(a.collision){var l=s.getDOM();if(s.isVisible()&&l&&l.getBoundingClientRect){s.bbox||(s.bbox=[0,0,0,0]);var c=l.getBoundingClientRect(),A=c.x,f=c.y,d=c.width,p=c.height;if(0===d||0===p){var g=s.getSize();g&&(d=g.width,p=g.height)}var v=A+d+h,w=f-h,C=f+p+h;s.bbox[0]=A-h,s.bbox[1]=w,s.bbox[2]=v,s.bbox[3]=C,e.collides(s.bbox)?s._collidesEffect(!1):(e.insertBox(s.bbox),s._collidesEffect(!0))}}}return this._uiCollidesQueue=[],this},_addUI:function(e){return this.uiList||(this.uiList=[]),this.uiList.indexOf(e)>-1||(this.uiList.push(e),this.uiList=this.uiList.sort((function(e,n){return n.options.collisionWeight-e.options.collisionWeight}))),this},_removeUI:function(e){if(!this.uiList)return-1;var n=this.uiList.indexOf(e);return n<0||this.uiList.splice(n,1),n}});var oit=new o9(0,0);met.include({coordinateToPoint:function(e,n,i){var o=this._getResolution(n);return this.coordinateToPointAtRes(e,o,i)},coordinateToPointAtRes:function(){var e=new o9(0,0);return function(n,i,o){var s=this.getProjection().project(n,e);return this._prjToPointAtRes(s,i,o)}}(),pointToCoordinate:function(){var e=new o9(0,0);return function(n,i,o){var s=this._pointToPrj(n,i,e);return this.getProjection().unproject(s,o)}}(),pointAtResToCoordinate:function(){var e=new o9(0,0);return function(n,i,o){var s=this._pointToPrjAtRes(n,i,e);return this.getProjection().unproject(s,o)}}(),coordinateToViewPoint:function(){var e=new o9(0,0);return function(n,i,o){return this._prjToViewPoint(this.getProjection().project(n,e),i,o)}}(),viewPointToCoordinate:function(){var e=new o9(0,0);return function(n,i){return this.getProjection().unproject(this._viewPointToPrj(n,e),i)}}(),coordinateToContainerPoint:function(e,n,i){var o=this._getResolution(n);return this.coordinateToContainerPointAtRes(e,o,i)},coordinateToContainerPointAtRes:function(){var e=new o9(0,0);return function(n,i,o){var s=this.getProjection().project(n,e);return this._prjToContainerPointAtRes(s,i,o)}}(),coordinatesToContainerPoints:function(e,n){var i=this._getResolution(n);return this.coordinatesToContainerPointsAtRes(e,i)},coordinatesToContainerPointsAtRes:function(e,n){for(var i=[],o=this._spatialReference.getTransformation(),s=n/this._getResolution(),a=this.getProjection(),h=new o9(0,0),l=this.isTransforming(),c=this._prjToPoint(this._getPrjCenter(),void 0,oit),A=0,f=e.length;A<f;A++){var d=a.project(e[A],h),p=o.transform(d,n);p=p._multi(s),this._toContainerPoint(p,l,e[A].z,c),i.push(p)}return i},containerPointToCoordinate:function(){var e=new o9(0,0);return function(n,i){var o=this._containerPointToPrj(n,e);return this.getProjection().unproject(o,i)}}(),containerToExtent:function(){var e=new w5(0,0),n=new w5(0,0);return function(i){var o=new v9(this._containerPointToPoint(i.getMin(e),void 0,e),this._containerPointToPoint(i.getMax(n),void 0,n));return this._pointToExtent(o)}}(),distanceToPixel:function(){var e=new w5(0,0),n=new w5(0,0);return function(i,o,s){var a=this.getProjection();if(!a)return null;var h=this.getScale()/this.getScale(s),l=this.getCenter(),c=a.locate(l,i,o),A=this.coordToContainerPoint(l,void 0,e),f=this.coordToContainerPoint(c,void 0,n);return f._sub(A)._multi(h)._abs(),new h3(f.x,f.y)}}(),distanceToPoint:function(e,n,i,o){var s=this._getResolution(i);return this.distanceToPointAtRes(e,n,s,o)},distanceToPointAtRes:function(){var e=new w5(0,0),n=new o9(0,0);return function(i,o,s,a,h){var l=this.getProjection();if(!l)return null;var c=a||this.getCenter(),A=l.locate(c,i,o,n),f=this.coordToPointAtRes(c,s,e),d=this.coordToPointAtRes(A,s,h);return d._sub(f)._abs(),d}}(),altitudeToPoint:function(){var e=new o9(0,40),n=new w5(0,0);return function(i,o,s){void 0===i&&(i=0),this._altitudeOriginDirty&&(e.x=this._originLng,this._altitudeOriginDirty=!1);var a=this.distanceToPointAtRes(i,i,o,s||e,n);i<0&&a.x>0&&(a.x=-a.x);var h=this.options.heightFactor;return h&&1!==h&&(a.x*=h,a.y*=h),a.x}}(),pointAtResToAltitude:function(){var e=new o9(0,40);return function(n,i,o){return void 0===n&&(n=0),this.pointAtResToDistance(n,0,i,o||e)}}(),pixelToDistance:function(){var e=new o9(0,0),n=new o9(0,0),i=new o9(0,0),o=new o9(0,0);return function(s,a){var h=this.getProjection();if(!h)return null;var l=this.getFullExtent(),c=l.top>l.bottom?-1:1,A=e.set(this.width/2,this.height/2),f=n.set(this.width/2+s,this.height/2+c*a),d=this.containerPointToCoord(A,i),p=this.containerPointToCoord(f,o);return h.measureLength(d,p)}}(),pointToDistance:function(e,n,i){var o=this.getResolution(i);return this.pointAtResToDistance(e,n,o)},pointAtResToDistance:function(){var e=new w5(0,0),n=new o9(0,0),i=new o9(0,0),o=new o9(0,0);return function(s,a,h,l){var c=this.getProjection();if(!c)return null;var A=l?c.project(l,n):this._getPrjCenter(),f=this._prjToPointAtRes(A,h,e);f._add(s,a);var d=this.pointAtResToCoord(f,h,i),p=l||c.unproject(A,o);return c.measureLength(p,d)}}(),locateByPoint:function(){var e=new w5(0,0);return function(n,i,o){var s=this.coordToContainerPoint(n,void 0,e);return this.containerPointToCoord(s._add(i,o))}}(),_get2DExtent:function(e,n){var i;if(void 0!==e&&e!==this._zoomLevel||!this._mapExtent2D||(i=this._mapExtent2D),i)return n?(n.set(i.xmin,i.ymin,i.xmax,i.ymax),n):i.copy();var o=this._getResolution(e);return this._get2DExtentAtRes(o,n)},get2DExtent:function(e,n){return this._get2DExtent(e,n)},_get2DExtentAtRes:function(){var e=new w5(0,0);return function(n,i){var o=this;return n===this._mapGlRes&&this._mapGlExtent2D?this._mapGlExtent2D:this.getContainerExtent().convertTo((function(i){return o._containerPointToPointAtRes(i,n,e)}),i)}}(),get2DExtentAtRes:function(e,n){return this._get2DExtentAtRes(e,n)},pointToExtent:function(e){return this._pointToExtent(e)},_pointToExtent:function(){var e=new o9(0,0),n=new o9(0,0);return function(i){var o=i.getMin(),s=i.getMax(),a=this.getFullExtent(),h=y5(!a||a.left<=a.right?[o.x,s.x]:[s.x,o.x],2),l=h[0],c=h[1],A=y5(!a||a.top>a.bottom?[s.y,o.y]:[o.y,s.y],2),f=A[0],d=o.set(l,A[1]),p=s.set(c,f);return new y9(this.pointToCoord(d,void 0,e),this.pointToCoord(p,void 0,n),this.getProjection())}}(),getViewPointFrameOffset:function(){var e=new w5(0,0);return function(){if(this.isZooming())return null;var n=this._getPrjCenter();return this._mapViewCoord&&!this._mapViewCoord.equals(n)?this._prjToContainerPoint(this._mapViewCoord)._sub(this._prjToContainerPoint(n,void 0,e)):null}}(),_viewPointToPrj:function(){var e=new w5(0,0);return function(n,i){return this._containerPointToPrj(this.viewPointToContainerPoint(n,e),i)}}(),viewPointToPrj:function(e,n){return this._viewPointToPrj(e,n)},_prjToContainerPoint:function(e,n,i,o){var s=this._getResolution(n);return this._prjToContainerPointAtRes(e,s,i,o)},prjToContainerPoint:function(e,n,i,o){return this._prjToContainerPoint(e,n,i,o)},_prjToContainerPointAtRes:function(){var e=new w5(0,0);return function(n,i,o,s){return this._pointAtResToContainerPoint(this._prjToPointAtRes(n,i,e),i,s||0,o)}}(),prjToContainerPointAtRes:function(e,n,i,o){return this.prjToContainerPointAtRes(e,n,i,o)},_prjToViewPoint:function(){var e=new w5(0,0);return function(n,i,o){var s=this._prjToContainerPoint(n,void 0,e,o);return this.containerPointToViewPoint(s,i)}}(),prjToViewPoint:function(e,n,i){return this._prjToViewPoint(e,n,i)},_viewPointToPoint:function(){var e=new w5(0,0);return function(n,i,o){return this._containerPointToPoint(this.viewPointToContainerPoint(n,e),i,o)}}(),viewPointToPoint:function(e,n,i){return this._viewPointToPoint(e,n,i)},_pointToViewPoint:function(){var e=new o9(0,0);return function(n,i,o){return this._prjToViewPoint(this._pointToPrj(n,i,e),o)}}(),pointToViewPoint:function(e,n,i){return this._pointToViewPoint(e,n,i)}});var sit={distancetool:{start:"",units:{mile:" ",feet:" ",kilometer:" ",meter:" "}},areatool:{units:{mile:" ",feet:" ",kilometer:" ",meter:" "}}},ait={distancetool:{start:"Inicio",units:{mile:" mi",feet:" ft",kilometer:" km",meter:" m"}},areatool:{units:{mile:" mi",feet:" ft",kilometer:" km",meter:" m"}}},hit={distancetool:{start:"Start",units:{mile:" mi",feet:" ft",kilometer:" km",meter:" m"}},areatool:{units:{mile:" mi",feet:" ft",kilometer:" km",meter:" m"}}},lit=function(e){function n(n){var i=e.call(this,"Translator: "+n)||this;return i.name="TranslatorError",i}return p5(n,e),n}(Error),uit=function(e){function n(n){var i=e.call(this)||this;return i.languages={"zh-CN":sit,"es-MX":ait,"en-US":hit},i.setLang(n||"zh-CN"),i}return p5(n,e),n.prototype.setLang=function(e){var n=this.languages[e];if(!n)throw new lit("Setted Lang does not exist");this.nodes=n},n.prototype._validateNestedProps=function(e){e.forEach((function(e){if(""===e)throw new lit('Any of sides of a dot "." cannot be empty')}))},n.prototype.translate=function(e){if(void 0===e&&(e=null),null==e)throw new lit("Missing parameter textNode");if("string"!=typeof e)throw new lit("Param passed has to be a String");if(!e.includes("."))return this.nodes[e];var n=e.split(".");if(n.length>3)throw new lit("Translate function can only access through 3 nested properties, trying to access -> ".concat(n.length));this._validateNestedProps(n);try{var i=null;switch(n.length){case 2:i=this.nodes[n[0]][n[1]];break;case 3:i=this.nodes[n[0]][n[1]][n[2]]}return i}catch(e){throw new lit("Unable to find the text translated in lang json"+e.message)}},n}(v6),cit=function(e){function n(n){var i=e.call(this,n)||this;return i.on("enable",i._afterEnable,i).on("disable",i._afterDisable,i),i._measureLayers=[],i.translator=new uit(i.options.language),i}return p5(n,e),n.prototype.clear=function(){if(z5(this._measureLayers))for(var e=0;e<this._measureLayers.length;e++)this._measureLayers[e].remove();return delete this._lastMeasure,delete this._lastVertex,this._outLayers(this._measureLayers),this._measureLayers=[],this},n.prototype.getMeasureLayers=function(){return this._measureLayers},n.prototype.getLastMeasure=function(){return this._lastMeasure?this._lastMeasure:0},n.prototype.undo=function(){e.prototype.undo.call(this);var n=this._historyPointer;if(n!==this._vertexes.length)for(var i=n;i<this._vertexes.length;i++)this._vertexes[i].label&&this._vertexes[i].label.remove(),this._vertexes[i].marker.remove();return this},n.prototype.redo=function(){e.prototype.redo.call(this);var n=this._historyPointer-1;return this._vertexes[n]&&(this._vertexes[n].marker.getLayer()||(this._vertexes[n].label&&this._vertexes[n].label.addTo(this._measureMarkerLayer),this._vertexes[n].marker.addTo(this._measureMarkerLayer))),this},n.prototype._formatLabelContent=function(e){var n=this.options.formatLabelContent;return n&&O2(n)?n.call(this,e)+"":null},n.prototype._measure=function(e){var n,i=this.getMap();e instanceof net?n=i.computeGeometryLength(e):Array.isArray(e)&&(n=i.getProjection().measureLength(e)),this._lastMeasure=n;var o=this._formatLabelContent(n);if(o)return o;var s=[this.translator.translate("distancetool.units.meter"),this.translator.translate("distancetool.units.kilometer"),this.translator.translate("distancetool.units.feet"),this.translator.translate("distancetool.units.mile")],a="",h=this.options.decimalPlaces;return this.options.metric&&(a+=n<1e3?n.toFixed(h)+s[0]:(n/1e3).toFixed(h)+s[1]),this.options.imperial&&(a.length>0&&(a+="\n"),a+=(n*=3.2808399)<5280?n.toFixed(h)+s[2]:(n/5280).toFixed(h)+s[3]),a},n.prototype._registerMeasureEvents=function(){this.on("drawstart",this._msOnDrawStart,this).on("drawvertex",this._msOnDrawVertex,this).on("mousemove",this._msOnMouseMove,this).on("drawend",this._msOnDrawEnd,this)},n.prototype._afterEnable=function(){this._registerMeasureEvents()},n.prototype._afterDisable=function(){this.off("drawstart",this._msOnDrawStart,this).off("drawvertex",this._msOnDrawVertex,this).off("mousemove",this._msOnMouseMove,this).off("drawend",this._msOnDrawEnd,this)},n.prototype._msOnDrawStart=function(e){var n=this.getMap(),i=T5(),o="distancetool_"+i,s="distancetool_markers_"+i,a=this.options.zIndex,h=this.options.enableAltitude;n.getLayer(o)?(this._measureLineLayer=n.getLayer(o),this._measureMarkerLayer=n.getLayer(s)):(this._measureLineLayer=new Ent(o,{zIndex:a,enableAltitude:h}).addTo(n),this._measureMarkerLayer=new Ent(s,{zIndex:a,enableAltitude:h}).addTo(n)),this._measureLayers.push(this._measureLineLayer),this._measureLayers.push(this._measureMarkerLayer),this._pushLayers([this._measureLineLayer,this._measureMarkerLayer]);var l=this._getFirstCoordinate()||e.coordinate,c=new Vet(l.copy(),{symbol:this.options.vertexSymbol}),A=this.translator.translate("distancetool.start"),f=new _nt(A,l.copy(),this.options.labelOptions);this._lastVertex=f,this._addVertexMarker(c,f)},n.prototype._msOnMouseMove=function(e){var n=this._measure(this._msGetCoordsToMeasure(e));if(!this._tailMarker){var i=J4(this.options.vertexSymbol);i.markerWidth/=2,i.markerHeight/=2,this._tailMarker=new Vet(e.coordinate,{symbol:i}).addTo(this._measureMarkerLayer),this._tailLabel=new _nt(n,e.coordinate,this.options.labelOptions).addTo(this._measureMarkerLayer)}var o=this._getLasttCoordinate()||e.coordinate;this._tailMarker.setCoordinates(o.copy()),this._tailLabel.setContent(n),this._tailLabel.setCoordinates(o.copy())},n.prototype._msGetCoordsToMeasure=function(e){return e.geometry.getCoordinates().concat([e.coordinate])},n.prototype._msOnDrawVertex=function(e){var n=this._getLasttCoordinate()||e.coordinate,i=e.geometry,o=new Vet(n.copy(),{symbol:this.options.vertexSymbol}),s=this._measure(i),a=new _nt(s,n.copy(),this.options.labelOptions);this._addVertexMarker(o,a),this._lastVertex=a},n.prototype._addVertexMarker=function(e,n){this._vertexes||(this._vertexes=[]),void 0!==this._historyPointer&&this._vertexes.length>this._historyPointer-1&&(this._vertexes.length=this._historyPointer-1),this._vertexes.push({label:n,marker:e}),this._measureMarkerLayer.addGeometry(e),n&&this._measureMarkerLayer.addGeometry(n)},n.prototype._msOnDrawEnd=function(e){if(this._clearTailMarker(),e.geometry.getCoordinates().length<2)return this._lastMeasure=0,void this._clearMeasureLayers();var n=this._lastVertex.getSize();n||(n=new h3(10,10)),this._addClearMarker(this._lastVertex.getCoordinates(),this._lastVertex._getPrjCoordinates(),n.width);var i=e.geometry.copy();i.setCoordinates(e.geometry.getCoordinates()),i.addTo(this._measureLineLayer),this._lastMeasure=i.getLength()},n.prototype._addClearMarker=function(e,n,i){var o=this.options.clearButtonSymbol,s={markerDx:(o.markerDx||0)+i,textDx:(o.textDx||0)+i};Array.isArray(o)&&(s=o.map((function(e){return e?{markerDx:(e.markerDx||0)+i,textDx:(e.textDx||0)+i}:null}))),o=J4(o,s);var a=new Vet(e,{symbol:o}),h=this._measureLineLayer,l=this._measureMarkerLayer;a.on("click",(function(){return h.remove(),l.remove(),!1}),this),a.addTo(this._measureMarkerLayer)},n.prototype._clearTailMarker=function(){this._tailMarker&&(this._tailMarker.remove(),delete this._tailMarker),this._tailLabel&&(this._tailLabel.remove(),delete this._tailLabel)},n.prototype._clearMeasureLayers=function(){this._measureLineLayer.remove(),this._measureMarkerLayer.remove()},n.prototype._getFirstCoordinate=function(){return this._geometry?(this._geometry.getCoordinates()||[])[0]:null},n.prototype._getLasttCoordinate=function(){if(!this._geometry)return null;var e=this._geometry.getCoordinates()||[];return e[e.length-1]},n}(Lnt);cit.mergeOptions({formatLabelContent:null,decimalPlaces:2,mode:"LineString",language:"zh-CN",metric:!0,imperial:!1,symbol:{lineColor:"#000",lineWidth:3,lineOpacity:1},vertexSymbol:{markerType:"ellipse",markerFill:"#fff",markerLineColor:"#000",markerLineWidth:3,markerWidth:11,markerHeight:11},labelOptions:{textSymbol:{textFaceName:"monospace",textLineSpacing:1,textHorizontalAlignment:"right",textDx:15},boxStyle:{padding:[6,2],symbol:{markerType:"square",markerFill:"#fff",markerFillOpacity:.9,markerLineColor:"#b4b3b3"}}},clearButtonSymbol:[{markerType:"square",markerFill:"#fff",markerLineColor:"#b4b3b3",markerLineWidth:2,markerWidth:15,markerHeight:15,markerDx:20},{markerType:"x",markerWidth:10,markerHeight:10,markerDx:20}]});var Ait=function(e){function n(n){var i=e.call(this,n)||this;return i.translator=new uit(i.options.language),i._measureLayers=[],i}return p5(n,e),n.prototype._measure=function(e){var n,i=this.getMap();e instanceof net?n=i.computeGeometryArea(e):Array.isArray(e)&&(n=i.getProjection().measureArea(e)),this._lastMeasure=n;var o=this._formatLabelContent(n);if(o)return o;var s=[this.translator.translate("areatool.units.meter"),this.translator.translate("areatool.units.kilometer"),this.translator.translate("areatool.units.feet"),this.translator.translate("areatool.units.mile")],a="",h=this.options.decimalPlaces;if(this.options.metric&&(a+=n<1e6?n.toFixed(h)+s[0]:(n/1e6).toFixed(h)+s[1]),this.options.imperial){n*=Math.pow(3.2808399,2),a.length>0&&(a+="\n");var l=27878400;a+=n<l?n.toFixed(h)+s[2]:(n/l).toFixed(h)+s[3]}return a},n.prototype._msGetCoordsToMeasure=function(e){return e.geometry.getShell().concat([e.coordinate])},n.prototype._msOnDrawVertex=function(e){var n=this._getLasttCoordinate()||e.coordinate,i=new Vet(n.copy(),{symbol:this.options.vertexSymbol});this._measure(e.geometry),this._lastVertex=i,this._addVertexMarker(i)},n.prototype._msOnDrawEnd=function(e){var n;this._clearTailMarker();var i=this.getMap();if(e.point2d)n=i._pointToPrj(e.point2d);else{var o=e.geometry._getPrjCoordinates()||[];n=(o=o.slice(0,o.length-1))[o.length-1]}if(e.geometry.getShell().length<3)return this._lastMeasure=0,void this._clearMeasureLayers();var s=this._measure(e.geometry),a=this._getLasttCoordinate(),h=new _nt(s,a.copy(),this.options.labelOptions).addTo(this._measureMarkerLayer).getSize();h||(h=new h3(10,10)),this._addClearMarker(a.copy(),n,h.width);var l=e.geometry.copy();l.setCoordinates(e.geometry.getCoordinates()),l.addTo(this._measureLineLayer),this._lastMeasure=l.getArea()},n}(cit);function fit(e,n,i){var o,s,a=Array.isArray(n);if(a||(n=[n]),i&&i.drawTool&&i.drawTool.options&&(s=i.drawTool.options.transformCoordinate),s&&O2(s))o=n.map((function(n){return e.unproject(n)})),o=o.map((function(e){return s(e,i)||e}));else{if(!i||!i.target||!i.target._queryTerrainInfo)return o=n.map((function(n){return e.unproject(n)})),a?o:o[0];var h=i.target,l=i.enableAltitude;o=n.map((function(n){if(l){var i=h.prjToContainerPoint(n),o=h._queryTerrainInfo(i);if(o&&o.coordinate)return o.coordinate}return e.unproject(n)}))}return a?o:o[0]}Ait.mergeOptions({mode:"Polygon",symbol:{lineColor:"#000000",lineWidth:2,lineOpacity:1,lineDasharray:"",polygonFill:"#ffffff",polygonOpacity:.5},language:"zh-CN"});var dit={create:function(e,n,i){var o=fit(e,n[0],i);return new ant(o,0)},update:function(e,n,i,o){var s=i.getMap(),a=fit(e,Array.isArray(n)?n[n.length-1]:n,o),h=s.computeLength(i.getCenter(),a);i.setRadius(h)},generate:function(e){return e}};Lnt.registerMode("circle",P2({clickLimit:2,action:["click","mousemove","click"]},dit)),Lnt.registerMode("freeHandCircle",P2({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},dit));var pit={create:function(e,n,i){var o=fit(e,n[0],i);return new lnt(o,0,0)},update:function(e,n,i,o){var s=i.getMap(),a=i.getCenter(),h=fit(e,Array.isArray(n)?n[n.length-1]:n,o),l=s.computeLength(a,new o9({x:h.x,y:a.y})),c=s.computeLength(a,new o9({x:a.x,y:h.y}));i.setWidth(2*l),i.setHeight(2*c)},generate:function(e){return e}};Lnt.registerMode("ellipse",P2({clickLimit:2,action:["click","mousemove","click"]},pit)),Lnt.registerMode("freeHandEllipse",P2({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},pit));var git={create:function(e,n){var i=new jet([]);return i._firstClick=n[0],i},update:function(e,n,i,o){var s=i.getMap(),a=o.containerPoint,h=s.prjToContainerPoint(i._firstClick),l=[[h.x,h.y],[a.x,h.y],[a.x,a.y],[h.x,a.y]].map((function(e){return s._containerPointToPrj(new w5(e))})),c=fit(e,l,o);i.setCoordinates(c)},generate:function(e){return e}};Lnt.registerMode("rectangle",P2({clickLimit:2,action:["click","mousemove","click"]},git)),Lnt.registerMode("freeHandRectangle",P2({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},git)),Lnt.registerMode("point",{clickLimit:1,action:["click","mousemove"],create:function(e,n,i){var o=fit(e,n[0],i);return new Vet(o)},generate:function(e){return e},update:function(e,n,i,o){if(Array.isArray(n)&&(n=n[n.length-1]),!n)return i;var s=fit(e,n,o);return i.setCoordinates(s),i}});var mit={create:function(e,n,i){var o=fit(e,n,i),s=new qet(o);return s.setCoordinates(o),s},update:function(e,n,i,o){var s,a=i.getSymbol();Array.isArray(n)?s=n:(s=i._drawPrjs||[]).push(n),i._drawPrjs=s;var h=fit(e,s,o);i.setCoordinates(h);var l=i.getLayer();if(l){var c=l.getGeometryById("polygon");if(!c&&s.length>=3){if(c=new jet([h],{id:"polygon",zIndex:-1}),a){var A=J4(a,{lineOpacity:0});c.setSymbol(A)}c.addTo(l)}c&&c.setCoordinates([h])}},generate:function(e){var n=new jet(e.getCoordinates(),{symbol:e.getSymbol(),properties:e.getProperties()});return n._projCode=e._projCode,n}};Lnt.registerMode("polygon",P2({action:["click","mousemove","dblclick"]},mit)),Lnt.registerMode("freeHandPolygon",P2({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},mit));var yit={create:function(e,n,i){var o=fit(e,n,i),s=new qet(o);return s.setCoordinates(o),s},update:function(e,n,i,o){var s;Array.isArray(n)?s=n:(s=i._drawPrjs||[]).push(n),i._drawPrjs=s;var a=fit(e,s,o);i.setCoordinates(a)},generate:function(e){return e}};Lnt.registerMode("linestring",P2({action:["click","mousemove","dblclick"]},yit)),Lnt.registerMode("freeHandLinestring",P2({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},yit)),Lnt.registerMode("arccurve",{action:["click","mousemove","dblclick"],create:function(e,n){var i=n.map((function(n){return e.unproject(n)})),o=new fnt(i);return o._setPrjCoordinates(n),o},update:yit.update,generate:function(e){return e}}),Lnt.registerMode("quadbeziercurve",{action:["click","mousemove","dblclick"],create:function(e,n){var i=n.map((function(n){return e.unproject(n)})),o=new pnt(i);return o._setPrjCoordinates(n),o},update:yit.update,generate:function(e){return e}}),Lnt.registerMode("cubicbeziercurve",{action:["click","mousemove","dblclick"],create:function(e,n){var i=n.map((function(n){return e.unproject(n)})),o=new dnt(i);return o._setPrjCoordinates(n),o},update:yit.update,generate:function(e){return e}}),Lnt.registerMode("boxZoom",{action:["mousedown","mousemove","mouseup"],create:function(e,n){var i=e.unproject(n=n[0]),o=new Vet(i);return o._firstClick=n,o},update:function(e,n,i,o){var s=i.getMap(),a=s.prjToContainerPoint(i._firstClick),h=o.containerPoint;n=s._containerPointToPrj(new o9(Math.min(a.x,h.x),Math.min(a.y,h.y)));var l=e.unproject(n);i.setCoordinates(l)._setPrjCoordinates(n),i.updateSymbol({markerWidth:Math.abs(a.x-h.x),markerHeight:Math.abs(a.y-h.y)})},generate:function(e){return e}});var vit=function(e){function n(n){var i=e.call(this,n)||this;return i.proxyOptions(),i}return p5(n,e),n.prototype._appendCustomClass=function(e){if(!e)return console.warn("dom is null:",e),this;if(this.options.cssName){var n=this.options.cssName;Array.isArray(n)||(n=[n]),n.forEach((function(n){e.classList.add(n)}))}return this},n.prototype.onAdd=function(){},n.prototype.onRemove=function(){},n.prototype.onDomRemove=function(){},n.prototype.getEvents=function(){return{}},n.prototype.getOwnerEvents=function(){return{}},n.prototype.buildOn=function(){return null},n.prototype.addTo=function(e){return this._owner=e,this._switchEvents("on"),this.onAdd&&this.onAdd(),this.fire("add"),this},n.prototype.getMap=function(){return this._owner?this._owner.getBaseLayer?this._owner:this._owner.getMap():null},n.prototype._collides=function(){var e=this.getMap();return e?(e._addUI(this),e._insertUICollidesQueue(),this):this},n.prototype._collidesEffect=function(e){var n=this.getDOM();if(!n)return this;if(n.style.visibility=e?"visible":"hidden",!n.classList||!n.classList.add)return this;if(!this.options.collisionFadeIn)return this;var i="mtk-ui-fadein",o=n.classList.contains(i);return e&&!o?n.classList.add(i):!e&&o&&n.classList.remove(i),this},n.prototype.show=function(e){var n=this,i=this.getMap();if(!i)return this;this.options.visible=!0,(e=e||this._coordinate||this._owner.getCenter())instanceof o9||(e=new o9(e));var o=this.isVisible();this._showBySymbolChange||this.fire("showstart");var s=this._getUIContainer();this._coordinate=e,this._removePrevDOM(),this._mapEventsOn||this._switchMapEvents("on");var a=this.__uiDOM=this.buildOn();a.eventsPropagation=this.options.eventsPropagation,this._observerDomSize(a);var h=this.options.zIndex;if(!a)return this._showBySymbolChange||this.fire("showend"),this._collides(),this.setZIndex(h),this;this._measureSize(a),this._singleton()&&(a._uiComponent=this,i[this._uiDomKey()]=a),this._setPosition(),a.style[E3]=null,s.appendChild(a);var l=this._getAnimation();if(o&&(l.ok=!1),l.ok&&(l.fade&&(a.style.opacity="0"),l.scale)){if(this.getTransformOrigin){var c=this.getTransformOrigin();a.style[I3]=c}a.style[S3]=this._toCSSTranslate(this._pos)+" scale(0)"}this.isSupportZoomFilter()||(a.style.display=""),this.options.eventsToStop&&X3(a,this.options.eventsToStop,z3);var A=l.transition;return l.ok&&A&&(A&&(a.style[E3]=A),l.fade&&(a.style.opacity="1"),l.scale&&(a.style[S3]=this._toCSSTranslate(this._pos)+" scale(1)")),this._showBySymbolChange||this.fire("showend"),this._collides(),clearTimeout(this._autoPanId),this.options.autoPan&&(this._autoPanId=setTimeout((function(){n._autoPan()}),32)),this.setZIndex(h),this},n.prototype.hide=function(){var e=this;if(!this.getDOM())return this;this._onDomMouseout&&this._onDomMouseout(),this.options.visible=!1;var n=this._getAnimation(),i=this.getDOM();return this.options.animationOnHide||(n.ok=!1),n.ok?(i.style[E3]=n.transition,setTimeout((function(){i.style.display="none",e.fire("hide")}),this.options.animationDuration)):(i.style.display="none",this.fire("hide")),n.fade&&(i.style.opacity="0"),n.scale&&(i.style[S3]=this._toCSSTranslate(this._pos)+" scale(0)"),this._switchMapEvents("off"),this._collides(),this},n.prototype.isVisible=function(){if(!this.options.visible)return!1;var e=this.getDOM();return this.getMap()&&e&&e.parentNode&&"none"!==e.style.display},n.prototype.remove=function(){if(delete this._mapEventsOn,!this._owner)return this;var e=this.getMap();return e&&e._removeUI(this),this.hide(),this._switchEvents("off"),this.onRemove&&this.onRemove(),!this._singleton()&&this.__uiDOM&&this._removePrevDOM(),delete this._owner,this.fire("remove"),this._collides(),this},n.prototype.getSize=function(){return this._domContentRect&&this._size&&(this._size.width=this._domContentRect.width,this._size.height=this._domContentRect.height),this._size?this._size.copy():null},n.prototype.getOwner=function(){return this._owner},n.prototype.getDOM=function(){return this.__uiDOM},n.prototype.setZIndex=function(e){if(!T2(e))return this;var n=this.getDOM();return n?(n.style.zIndex=e+"",e!==this.options.zIndex&&(this.options.zIndex=e),this):this},n.prototype._roundPoint=function(e){return this.options.roundPoint&&(e=e._round()),e},n.prototype.getPosition=function(){if(!this.getMap())return null;var e=this._roundPoint(this._getViewPoint());if(this.getOffset){var n=this._roundPoint(this.getOffset());n&&e._add(n)}return e},n.prototype._getAnimation=function(){for(var e={fade:!1,scale:!1,ok:!1,transition:""},n=this.options.animation?this.options.animation.split(","):[],i=0;i<n.length;i++){var o=u3(n[i]);"fade"===o?e.fade=!0:"scale"===o&&(e.scale=!0)}var s=null;return e.fade&&(s="opacity "+this.options.animationDuration+"ms"),e.scale&&(s=s?s+",":"",s+=S3+" "+this.options.animationDuration+"ms"),e.transition=s,e.ok=null!==s,e},n.prototype._getViewPoint=function(){var e=0,n=this._coordinate||{};if(T2(n.z)?e=n.z:this._owner&&this._owner.getAltitude&&(T2(e=this._owner.getAltitude()||0)||(e=0)),this._owner.getLayer){var i=this._owner.getLayer();i&&i.isVectorLayer&&(T2(e=this._owner._getAltitude()||0)||(e=0))}var o=this._meterToPoint(this._coordinate,e);return this.getMap().coordToViewPoint(this._coordinate,void 0,o)._add(this.options.dx,this.options.dy)},n.prototype._meterToPoint=function(e,n){return n},n.prototype._autoPan=function(){var e=this.getMap(),n=this.getDOM();if(n&&e&&!e.isMoving()){var i=this._getViewPoint()._round(),o=e.width,s=e.height,a=e.getContainer();if(n&&a&&n.getBoundingClientRect){var h=a.getBoundingClientRect(),l=h.left,c=h.top,A=50,f=n.getBoundingClientRect(),d=0,p=0,g=f.left,v=f.right,w=f.top,C=f.bottom;if(g-=l,v-=l,w-=c,C-=c,f.width>0&&f.height>0){if(g<A&&(d=A-g),0===d&&v+A>o&&(d=-(v+A-o)),w<A&&(p=A-w),0===p&&C+A>s&&(p=-(C+A-s)),0!==d||0!==p)e.getPitch()>40&&0!==p&&this._coordinate?e.animateTo({center:this._coordinate},{duration:e.options.panAnimationDuration}):e.panBy([Math.ceil(d),Math.ceil(p)]);return}}var P=e.viewPointToContainerPoint(i),T=this.getOffset(),S=P.add(T),I=e.viewPointToPrj(i),E=parseInt(n.clientWidth+""),O=parseInt(n.clientHeight+""),k=0,L=0;if(S.x<0?k=50-S.x:S.x+E>o&&(k=-(S.x+E-o)-50),S.y-O<0?L=Math.abs(S.y-O)+50:S.y+O>s&&(L=s-(S.y+O)-50),E>=o&&(k=o/2-P.x),0!==L||0!==k){var F=P.add(k,L),N=e._containerPointToPoint(F)._sub(e._prjToPoint(e._getPrjCenter())),z=e._pointToPrj(e._prjToPoint(I).sub(N));e._panAnimation(z)}}},n.prototype._measureSize=function(e){var n=this._getUIContainer();e.style.position="absolute";var i=e.style.bottom?"bottom":"top";if(e.style.display="",n.appendChild(e),e.getBoundingClientRect){var o=e.getBoundingClientRect();this._size=new h3(o.width,o.height)}else this._size=new h3(e.clientWidth,e.clientHeight);return e.style.display="none",e.style.left="0px",e.style[i]="0px",this._size},n.prototype._removePrevDOM=function(){this.onDomRemove&&this.onDomRemove();var e=this.options.eventsToStop;if(this._singleton()){var n=this.getMap(),i=this._uiDomKey();if(n[i]){e&&Y3(n[i],e,z3);var o=n[i]._uiComponent;o&&o!==this&&o.isVisible()&&o.fire("hide"),D3(n[i]),o&&!this.hideDom&&o._switchMapEvents("off"),delete n[i]}delete this.__uiDOM}else this.__uiDOM&&(e&&Y3(this.__uiDOM,e,z3),D3(this.__uiDOM),delete this.__uiDOM);this._resizeObserver&&(this._resizeObserver.disconnect(),delete this._resizeObserver,delete this._domContentRect)},n.prototype._uiDomKey=function(){return"__ui_"+this._getClassName()},n.prototype._singleton=function(){return this.options.single},n.prototype._getUIContainer=function(){return this.getMap().getPanels().ui},n.prototype._getClassName=function(){return"UIComponent"},n.prototype._switchMapEvents=function(e){var n=this.getMap();if(n){this._mapEventsOn="on"===e;var i=this._getDefaultEvents();if(this.getEvents&&P2(i,this.getEvents()),i)for(var o in i)i.hasOwnProperty(o)&&n[e](o,i[o],this)}},n.prototype._switchEvents=function(e){var n=this._getOwnerEvents();if(this._owner)for(var i in n)n.hasOwnProperty(i)&&this._owner[e](i,n[i],this)},n.prototype._getDefaultEvents=function(){return{"zooming rotate pitch":this.onEvent,zoomend:this.onZoomEnd,moving:this.onMoving,moveend:this.onMoving,resize:this.onResize}},n.prototype._getOwnerEvents=function(){var e={};return this._owner&&this._owner instanceof net&&(e.positionchange=this.onGeometryPositionChange,e.symbolchange=this._updatePosition),this.getOwnerEvents&&P2(e,this.getOwnerEvents()),e},n.prototype.onGeometryPositionChange=function(e){if(this._owner&&this.isVisible()){this._showBySymbolChange=!0;var n=e.target,i=n.getCenter();if(n._getAltitude){var o=n._getAltitude();T2(o)&&(i.z=o)}this.show(i),delete this._showBySymbolChange}},n.prototype.onMoving=function(){this.isVisible()&&this.getMap().isTransforming()&&this._updatePosition()},n.prototype.onEvent=function(){this.isVisible()&&this._updatePosition()},n.prototype.onZoomEnd=function(){this.isVisible()&&this._setPosition()},n.prototype.onResize=function(){this.isVisible()&&this._setPosition()},n.prototype.onDomSizeChange=function(){this.isVisible()&&(this._setPosition(),this._collides())},n.prototype._updatePosition=function(){return this.getMap()?(this.getMap()._getRenderer().callInNextFrame(this._setPosition.bind(this)),this):this},n.prototype._setPosition=function(){var e=this.getDOM();if(e){e.style[E3]=null;var n=this.getPosition();this._pos=n,e.style[S3]=this._toCSSTranslate(n)+" scale(1)"}},n.prototype._toCSSTranslate=function(e){if(!e)return"";if(f5.any3d){var n=this.getMap(),i=n?n.getBearing():0,o=n?n.getPitch():0,s="";return this.options.pitchWithMap&&o&&(s+=" rotateX(".concat(Math.round(o),"deg)")),this.options.rotateWithMap&&i&&(s+=" rotateZ(".concat(Math.round(-i),"deg)")),"translate3d("+Math.fround(e.x)+"px,"+Math.fround(e.y)+"px, 0px)"+s}return"translate("+Math.fround(e.x)+"px,"+Math.fround(e.y)+"px)"},n.prototype._observerDomSize=function(e){var n=this;return e&&f5.resizeObserver&&!this._resizeObserver?(this._resizeObserver=new ResizeObserver((function(e){if(e.length){var i=e[0].borderBoxSize;n._domContentRect=i&&i.length?{width:i[0].inlineSize,height:i[0].blockSize}:e[0].contentRect}else delete n._domContentRect;n.onDomSizeChange&&n.onDomSizeChange()})),this._resizeObserver.observe(e),this):this},n.prototype.isSupportZoomFilter=function(){return!1},n.prototype.onConfig=function(){return this._updatePosition(),this},n.isSupport=function(e){return!!(e&&O2(e.on)&&O2(e.off)&&O2(e.getCenter))},n.prototype._bindDomEvents=function(e,n){if(e){var i=this._getDomEvents()||{},o="on"===n?X3:Y3;for(var s in i)"on"===n&&Y3(e,s,i[s]),o(e,s,i[s],this)}},n.prototype._getDomEvents=function(){return{mouseover:this._onDomMouseover,mouseout:this._onDomMouseout}},n.prototype._configMapPreventWheelScroll=function(e){var n=this.getMap();n&&(this.options.eventsPropagation||(n.options.preventWheelScroll=e))},n.prototype._onDomMouseover=function(){this._configMapPreventWheelScroll(!1)},n.prototype._onDomMouseout=function(){this._configMapPreventWheelScroll(!0)},n}(m6(v6));vit.mergeOptions({eventsPropagation:!1,eventsToStop:null,dx:0,dy:0,autoPan:!1,autoPanDuration:600,single:!0,animation:"scale",animationOnHide:!1,animationDuration:500,pitchWithMap:!1,rotateWithMap:!1,visible:!0,roundPoint:!1,collision:!1,collisionBufferSize:2,collisionWeight:0,collisionFadeIn:!1,zIndex:0});var _it="mousedown mouseup mouseenter mouseover mouseout mousemove click dblclick contextmenu keypress touchstart touchmove touchend",xit=function(e){function n(n,i){var o=e.call(this,i)||this;return o._markerCoord=new o9(n),o}return p5(n,e),n.prototype._getClassName=function(){return"UIMarker"},n.prototype.setCoordinates=function(e){return this._markerCoord=e,this.fire("positionchange"),this.isVisible()&&(this._coordinate=this._markerCoord,this._setPosition(),this._collides()),this},n.prototype.getCoordinates=function(){return this._markerCoord},n.prototype.getCenter=function(){return this.getCoordinates()},n.prototype.getAltitude=function(){var e=this.getCoordinates()||{};return T2(e.z)?e.z:this.options.altitude||0},n.prototype.setAltitude=function(e){return T2(e)&&this._markerCoord&&(this._markerCoord.z=e,this._updatePosition&&(this._updatePosition(),this._collides())),this},n.prototype.setContent=function(e){var n=this.options.content;return this.options.content=e,this.fire("contentchange",{old:n,new:e}),this.isVisible()&&this.show(),this},n.prototype.getContent=function(){return this.options.content},n.prototype.onAdd=function(){if(this._owner&&!this._owner.isMap){var e=this._owner;throw new Error("UIMarker Can only be added to the map, but owner is:"+e.getJSONType&&e.getJSONType())}return this.show(),this},n.prototype.show=function(){return e.prototype.show.call(this,this._markerCoord)},n.prototype.flash=function(e,n,i,o){return Q5.call(this,e,n,i,o)},n.prototype.buildOn=function(){var e,n=this.getDOM();this._bindDomEvents(n,"off");var i=this.options.content,o=E2(i);return o||O2(i)?(e=O3("div"),o?e.innerHTML=this.options.content:i.bind(this)(e)):e=this.options.content,this.options.containerClass&&(e.className=this.options.containerClass),this._registerDOMEvents(e),this._bindDomEvents(e,"on"),this._appendCustomClass(e),e},n.prototype.getOffset=function(){var e=this.getSize(),n=-e.width/2,i=-e.height/2,o=this.options,s=o.horizontalAlignment,a=o.verticalAlignment;return"left"===s?n=-e.width:"right"===s&&(n=0),"top"===a?i=-e.height:"bottom"===a&&(i=0),new w5(n,i)},n.prototype.getTransformOrigin=function(){return"center center"},n.prototype.onDomRemove=function(){var e=this.getDOM();this._removeDOMEvents(e)},n.prototype.isDragging=function(){return!!this.draggable&&this.draggable.isDragging()},n.prototype._registerDOMEvents=function(e){X3(e,_it,this._onDomEvents,this)},n.prototype._onDomEvents=function(e,n){var i=this.getMap()._parseEvent(e,e.type);if("mousedown"===(n=n||e.type)&&(this._mousedownEvent=e),"mouseup"===n&&(this._mouseupEvent=e),("click"!==n||!this._mouseClickPositionIsChange())&&("touchstart"===n&&(this._touchstartTime=C2()),this.fire(n,i),"touchend"===n&&f5.touch)){var o=this.getMap().options.clickTimeThreshold||280;C2()-this._touchstartTime<o&&this._onDomEvents(e,"click")}},n.prototype._removeDOMEvents=function(e){Y3(e,_it,this._onDomEvents)},n.prototype._mouseClickPositionIsChange=function(){var e=this._mousedownEvent||{},n=this._mouseupEvent||{};return e.x!==n.x||e.y!==n.y},n.prototype._getConnectPoints=function(){var e=this.getMap(),n=e.coordToContainerPoint(this.getCoordinates()),i=this.getSize(),o=i.width,s=i.height;return[e.containerPointToCoordinate(n.add(-o/2,0)),e.containerPointToCoordinate(n.add(o/2,0)),e.containerPointToCoordinate(n.add(0,s/2)),e.containerPointToCoordinate(n.add(0,-s/2))]},n.prototype._getViewPoint=function(){var e=0;if(this._owner){var n=this.getAltitude();n>0&&(e=this._meterToPoint(this._coordinate,n))}return this.getMap().coordToViewPoint(this._coordinate,void 0,e)._add(this.options.dx,this.options.dy)},n.prototype._getDefaultEvents=function(){return P2({},e.prototype._getDefaultEvents.call(this),{"zooming zoomend":this.onZoomFilter})},n.prototype._setPosition=function(){this.onZoomFilter(),e.prototype._setPosition.call(this)},n.prototype.onZoomFilter=function(){var e=this.getDOM();e&&(this.isVisible()||"none"===e.style.display?this.isVisible()&&"none"===e.style.display&&(e.style.display=""):e.style.display="none")},n.prototype.isVisible=function(){var e=this.getMap();if(!e)return!1;if(!this.options.visible)return!1;var n=e.getZoom(),i=this.options,o=i.minZoom,s=i.maxZoom;return!(!M2(o)&&n<o||!M2(s)&&n>s)&&(this.getDOM()&&!0)},n.prototype.isSupportZoomFilter=function(){return!0},n}(t9(vit));xit.mergeOptions({containerClass:null,eventsPropagation:!0,draggable:!1,single:!1,content:null,altitude:0,minZoom:0,maxZoom:null,horizontalAlignment:"middle",verticalAlignment:"middle"});var bit=f5.touch?"touchstart mousedown":"mousedown",wit=function(e){function n(n){return e.call(this,n)||this}return p5(n,e),n.prototype.addHooks=function(){this.target.on(bit,this._startDrag,this)},n.prototype.removeHooks=function(){this.target.off(bit,this._startDrag,this)},n.prototype._startDrag=function(e){var n=e.domEvent;n.touches&&n.touches.length>1||2===n.button||this.isDragging()||(this.target.on("click",this._endDrag,this),this._lastCoord=e.coordinate,this._lastPoint=e.containerPoint,this._prepareDragHandler(),this._dragHandler.onMouseDown(e.domEvent),this.target.fire("dragstart",e))},n.prototype._prepareDragHandler=function(){this._dragHandler=new r9(this.target.getDOM(),{cancelOn:this._cancelOn.bind(this),ignoreMouseleave:!0}),this._dragHandler.on("mousedown",this._onMouseDown,this),this._dragHandler.on("dragging",this._dragging,this),this._dragHandler.on("mouseup",this._endDrag,this),this._dragHandler.enable()},n.prototype._cancelOn=function(e){var n=(e.srcElement||e.target).tagName.toLowerCase();return"button"===n||"input"===n||"select"===n||"option"===n||"textarea"===n},n.prototype._onMouseDown=function(e){z3(e.domEvent)},n.prototype._dragging=function(e){var n=this.target,i=n.getMap()._parseEvent(e.domEvent),o=i.domEvent;if(!(o.touches&&o.touches.length>1))if(this._isDragging){var s=i.coordinate,a=i.containerPoint;this._lastCoord||(this._lastCoord=s),this._lastPoint||(this._lastPoint=a);var h=s.sub(this._lastCoord),l=a.sub(this._lastPoint);this._lastCoord=s,this._lastPoint=a,this.target.setCoordinates(this.target.getCoordinates().add(h)),i.coordOffset=h,i.pointOffset=l,n.fire("dragging",i)}else this._isDragging=!0},n.prototype._endDrag=function(e){var n=this.target,i=n.getMap();if(this._dragHandler&&(n.off("click",this._endDrag,this),this._dragHandler.disable(),delete this._dragHandler),delete this._lastCoord,delete this._lastPoint,this._isDragging=!1,i){var o=i._parseEvent(e.domEvent);n&&n._mouseClickPositionIsChange&&n._mouseClickPositionIsChange()&&n.fire("dragend",o)}},n.prototype.isDragging=function(){return!!this._isDragging},n}(y6);xit.addInitHook("addHandler","draggable",wit);var Cit=/\{ *([\w_]+) *\}/g,Pit={containerClass:"maptalks-msgBox",autoPan:!0,autoCloseOn:null,autoOpenOn:"click",width:"auto",minHeight:120,custom:!1,title:null,content:null,enableTemplate:!1},Mit=new h3(0,0),Tit=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype._getClassName=function(){return"InfoWindow"},n.prototype.addTo=function(n){return n instanceof net&&(n.getInfoWindow()&&n.getInfoWindow()!==this&&n.removeInfoWindow(),n._infoWindow=this),e.prototype.addTo.call(this,n)},n.prototype.setContent=function(e){var n=this.options.content;return this.options.content=e,this.fire("contentchange",{old:n,new:e}),this.isVisible()&&this.show(this._coordinate),this},n.prototype.getContent=function(){return this.options.content},n.prototype.setTitle=function(e){var n=e;return this.options.title=e,this.fire("contentchange",{old:n,new:e}),this.isVisible()&&this.show(this._coordinate),this},n.prototype.getTitle=function(){return this.options.title},n.prototype.buildOn=function(){var e=this,n=O2(this.options.content),i=E2(this.options.content);if(this.options.custom){var o=this.getDOM(),s=void 0;if(this._bindDomEvents(o,"off"),i||n){var a=O3("div");i?(a.innerHTML=this.options.content,this._replaceTemplate(a)):this.options.content.bind(this)(a),s=a}else this._replaceTemplate(this.options.content),s=this.options.content;return this._bindDomEvents(s,"on"),this._appendCustomClass(s),s}this._bindDomEvents(this.getDOM(),"off");var h=O3("div");this.options.containerClass&&(h.className=this.options.containerClass);var l=this._getWindowWidth();h.style.width=T2(l)?l+"px":"auto",h.style.bottom="0px";var c='<em class="maptalks-ico"></em>';this.options.title&&(c+="<h2>"+this.options.title+"</h2>"),h.innerHTML=c+='<a href="javascript:void(0);" class="maptalks-close"></a><div class="maptalks-msgContent"></div>',this._replaceTemplate(h);var A=h.querySelector(".maptalks-msgContent");return i||n?i?A.innerHTML=this.options.content:this.options.content.bind(this)(A):A.appendChild(this.options.content),this._onCloseBtnClick=function(n){e.options.eventsPropagation||(N3(n),z3(n)),e.hide()},k3(h.querySelector(".maptalks-close"),"click touchend",this._onCloseBtnClick),n||this._replaceTemplate(A),this._bindDomEvents(h,"on"),this._appendCustomClass(h),h},n.prototype._replaceTemplate=function(e){var n=this._owner;if(this.options.enableTemplate&&n&&n.getProperties&&e&&e.innerHTML){var i=n.getProperties()||{};if(I2(i))e.innerHTML=e.innerHTML.replace(Cit,(function(e,n){return i[n]}))}return this},n.prototype.getTransformOrigin=function(){return this.getSize().width/2+"px bottom"},n.prototype.getOffset=function(){var e=this.getSize(),n=new w5(-e.width/2,0);this.options.custom?n._sub(0,e.height):n._sub(4,12);var i=this.getOwner();if(i instanceof Vet||i instanceof Ket){var o=void 0,s=void 0;if(i instanceof Vet)o=i._getPainter(),s=i.getSize();else{var a=i.getGeometries();if(!a||!a.length)return n;o=a[0]._getPainter(),s=a[0].getSize()}if(s||(s=Mit),o){var h=o.getFixedExtent();n._add(h.xmax-s.width/2,h.ymin)}else n._add(0,-s.height)}return n},n.prototype.show=function(n){return this.getMap()&&this.getMap().options.enableInfoWindow?e.prototype.show.call(this,n):this},n.prototype.getEvents=function(){if(!this.options.autoCloseOn)return null;var e={};return e[this.options.autoCloseOn]=this.hide,e},n.prototype.getOwnerEvents=function(){var e=this.getOwner();if(!this.options.autoOpenOn||!e)return null;var n={};return n[this.options.autoOpenOn]=this._onAutoOpen,n},n.prototype.onRemove=function(){this._onDomMouseout(),this.onDomRemove()},n.prototype.onDomRemove=function(){this._onCloseBtnClick&&(L3(this.getDOM().childNodes[2],"click touchend",this._onCloseBtnClick),delete this._onCloseBtnClick)},n.prototype._onAutoOpen=function(e){var n=this,i=this.getOwner();setTimeout((function(){i instanceof Vet||i instanceof vit?n.show(i.getCoordinates()):i instanceof Ket?n.show(i.findClosest(e.coordinate)):i instanceof qet||i instanceof tnt?(n.getMap().getScale()>=8&&(e.coordinate=n._rectifyMouseCoordinte(i,e.coordinate)),n.show(e.coordinate)):n.show(e.coordinate)}),1)},n.prototype._rectifyMouseCoordinte=function(e,n){var i=this;return e instanceof qet?this._rectifyLineStringMouseCoordinate(e,n).coordinate:e instanceof tnt?e.getGeometries().map((function(e){return i._rectifyLineStringMouseCoordinate(e,n)})).sort((function(e,n){return e.dis-n.dis}))[0].coordinate:n},n.prototype._rectifyLineStringMouseCoordinate=function(e,n){for(var i=this.getMap(),o=e.getCoordinates()||[],s=i.getGLRes(),a=o.map((function(e){var n=i.coordToPointAtRes(e,s);return i._pointAtResToContainerPoint(n,s,e.z||0)})),h=i.coordToContainerPoint(n),l=1/0,c=-1,A=0,f=a.length;A<f;A++){(q=h.distanceTo(a[A]))<l&&(l=q,c=A)}var d=[c-1,c,c+1].filter((function(e){return e>=0&&e<=a.length-1})),p=d.map((function(e){return a[e]})),g=[],v=i.getSize(),w=v.width,C=v.height;for(A=0,f=p.length-1;A<f;A++){var P=A,T=p[A],S=p[A+1];if(T.x===S.x)for(var I=Math.max(0,Math.min(T.y,S.y)),E=Math.min(C,Math.max(T.y,S.y)),O=I;O<=E;O++)g.push({point:new w5(T.x,O),coordinateIndex:P});else for(var k=(S.y-T.y)/(S.x-T.x),L=Math.max(0,Math.min(T.x,S.x)),F=Math.min(w,Math.max(T.x,S.x)),N=L;N<=F;N++){g.push({point:new w5(N,k*(N-T.x)+T.y),coordinateIndex:P})}}var z,H=1/0,j=-1,W=-1;for(A=0,f=g.length;A<f;A++){var q,Y=g[A],J=Y.point,$=Y.coordinateIndex;(q=h.distanceTo(J))<H&&(H=q,j=A,W=$,z=J)}if(j<0)return{dis:H,coordinate:n};var it=p[W],rt=it.distanceTo(p[W+1]),ot=z.distanceTo(it)/rt,st=d.map((function(e){return o[e]})),at=st[W],ht=st[W+1],At=at.x,ft=at.y,gt=at.z||0;return{dis:H,coordinate:new o9(At+(ht.x-At)*ot,ft+(ht.y-ft)*ot,gt+((ht.z||0)-gt)*ot)}},n.prototype._getWindowWidth=function(){var e=this.options.width;return e||(e=Pit.width),e},n}(vit);Tit.mergeOptions(Pit);var Sit="remove hide shapechange positionchange dragend animatestart",Iit=function(e){function n(n,i){void 0===i&&(i={});var o=e.call(this,i)||this;return o._content=n,o}return p5(n,e),n.prototype._getClassName=function(){return"ToolTip"},n.prototype.addTo=function(i){if(n.isSupport(i))return i.on("mousemove",this.onMouseMove,this),i.on("mouseout",this.onMouseOut,this),i.on(Sit,this.hideDom,this),e.prototype.addTo.call(this,i);throw new Error("Invalid geometry or UIMarker the tooltip is added to.")},n.prototype.setStyle=function(e){return this.options.containerClass=e,this},n.prototype.getStyle=function(){return this.options.containerClass},n.prototype.getContent=function(){return this._content},n.prototype.buildOn=function(){var e=O3("div"),n=this.options||{};n.height&&(e.style.height=n.height+"px"),n.width&&(e.style.width=n.width+"px");var i=n.containerClass||n.cssName;return!i&&n.height&&(e.style.lineHeight=n.height+"px"),O2(this._content)?this._content.bind(this)(e):e.innerHTML='<div class="'.concat(i,'">').concat(this._content,"</div>"),this._appendCustomClass(e),e},n.prototype.onMouseOut=function(){clearTimeout(this._timeout),this.isVisible()&&this._removePrevDOM(),this._switchMapEvents("off")},n.prototype.onMouseMove=function(e){var n=this;clearTimeout(this._timeout);var i=this.getMap();if(i){var o=i.locateByPoint(e.coordinate,-5,25);0===this.options.showTimeout?this.show(o):this._timeout=setTimeout((function(){i&&n.show(o)}),this.options.showTimeout)}},n.prototype.onRemove=function(){clearTimeout(this._timeout),this._owner&&(this._owner.off("mousemove",this.onMouseMove,this),this._owner.off("mouseout",this.onMouseOut,this),this._owner.off(Sit,this.hideDom,this))},n.prototype.hideDom=function(){this.hide()},n.prototype.onEvent=function(){return e.prototype.onEvent.call(this),this.hideDom(),this},n.prototype._getViewPoint=function(){return this.getMap().coordToViewPoint(this._coordinate,void 0,0)._add(this.options.dx,this.options.dy)},n}(vit);Iit.mergeOptions({width:0,height:0,animation:"fade",containerClass:"maptalks-tooltip",showTimeout:400});var Eit=function(e){function n(n){return e.call(this,n)||this}return p5(n,e),n.prototype._getClassName=function(){return"Menu"},n.prototype.addTo=function(e){return e._menu&&e._menu!==this&&e.removeMenu(),e._menu=this,this._owner=e,vit.prototype.addTo.apply(this,[e])},n.prototype.setItems=function(e){return this.options.items=e,this},n.prototype.getItems=function(){return this.options.items||[]},n.prototype.buildOn=function(){var e;if(this.options.custom)if(E2(this.options.items)){var n=O3("div");n.innerHTML=this.options.items,this._appendCustomClass(n),e=n}else e=this.options.items;else{e=O3("div"),this.options.containerClass&&V3(e,this.options.containerClass),e.style.width=this._getMenuWidth()+"px";var i=this._createMenuItemDom();e.appendChild(i),X3(e,"contextmenu",N3),this._appendCustomClass(e)}return e&&(this._bindDomEvents(e,"off"),this._bindDomEvents(e,"on")),e},n.prototype.getOffset=function(){if(!this.getMap())return null;var e=this.getMap().getSize(),n=this.getMap().viewPointToContainerPoint(this._getViewPoint()),i=this.getSize(),o=0,s=0;return n.x+i.width>e.width&&(o=-i.width),n.y+i.height>e.height&&(s=-i.height),new w5(o,s)},n.prototype.getTransformOrigin=function(){var e=this.getOffset()._multi(-1);return e.x+"px "+e.y+"px"},n.prototype.getEvents=function(){return{"_zoomstart _zoomend _movestart _dblclick _click":this._removePrevDOM}},n.prototype._createMenuItemDom=function(){var e=this,n=this.getMap(),i=O3("ul");V3(i,"maptalks-menu-items");var o,s,a=this.getItems();function h(i){return function(o){var s=n._parseEvent(o,"click");s.target=e,s.owner=e._owner,s.index=i,!1!==this._callback(s)&&(e.hide(),e._owner&&e._owner.fire("closemenu"))}}for(var l=0,c=a.length;l<c;l++){if("-"===(o=a[l])||"_"===o)V3(s=O3("li"),"maptalks-menu-splitter");else{s=O3("li");var A=o.item;O2(A)&&(A=A({owner:this._owner,index:l})),s.innerHTML=A,s._callback=o.click,X3(s,"click",h(l))}i.appendChild(s)}var f=this.options.maxHeight||0;return f>0&&U3(i,"max-height: "+f+"px; overflow-y: auto;"),i},n.prototype._getMenuWidth=function(){return this.options.width||160},n}(vit);Eit.mergeOptions({containerClass:"maptalks-menu",animation:null,animationDelay:10,animationOnHide:!1,autoPan:!1,width:160,maxHeight:0,custom:!1,items:[]});var Oit={setMenu:function(e){return this._menuOptions=e,this._menu?this._menu.setOptions(e):this.on("contextmenu",this._defaultOpenMenu,this),this},getMenu:function(){return this._menu},openMenu:function(e){var n=this instanceof met?this:this.getMap();return e||(e=this.getCenter()),this._menu?this._menu.show(e):this._menuOptions&&n&&(this._bindMenu(),this._menu.show(e)),this.fire("openmenu",{coordinate:e}),this},setMenuItems:function(e){return this._menuOptions||(this._menuOptions={}),Array.isArray(e)&&(this._menuOptions.custom=!1),this._menuOptions.items=e,this.setMenu(this._menuOptions),this},getMenuItems:function(){return this._menu?this._menu.getItems():this._menuOptions&&this._menuOptions.items||[]},closeMenu:function(){return this._menu&&this._menu.hide(),this.fire("closemenu",{}),this},removeMenu:function(){return this.off("contextmenu",this._defaultOpenMenu,this),this._unbindMenu(),delete this._menuOptions,this.fire("removemenu",{}),this},_bindMenu:function(){return this._menuOptions?(this._menu=new Eit(this._menuOptions),this._menu.addTo(this),this):this},_unbindMenu:function(){return this._menu&&(this.closeMenu(),this._menu.remove(),delete this._menu),this},_defaultOpenMenu:function(e){return this.openMenu(e.coordinate),!1}};met.include(Oit),net.include(Oit);var Rit=function(e){function n(n){return n&&n.position&&!E2(n.position)&&(n.position=P2({},n.position)),e.call(this,n)||this}return p5(n,e),n.prototype._appendCustomClass=function(e){if(!e)return console.warn("dom is null:",e),this;if(this.options.cssName){var n=this.options.cssName;Array.isArray(n)||(n=[n]),n.forEach((function(n){e.classList.add(n)}))}return this},n.prototype.onAdd=function(){},n.prototype.onRemove=function(){},n.prototype.addTo=function(e){if(this.remove(),!e.options.control)return this;this._map=e;var n=e.getPanels().control;return this.__ctrlContainer=O3("div"),U3(this.__ctrlContainer,"position:absolute;overflow:visible;"),this.update(),n.appendChild(this.__ctrlContainer),this.onAdd&&this.onAdd(),this.fire("add",{dom:n}),this},n.prototype.update=function(){return this.__ctrlContainer.innerHTML="",this._controlDom=this.buildOn(this.getMap()),this._controlDom&&(this._updatePosition(),this.__ctrlContainer.appendChild(this._controlDom)),this},n.prototype.getMap=function(){return this._map},n.prototype.getPosition=function(){return P2({},this._parse(this.options.position))},n.prototype.setPosition=function(e){return this.options.position=E2(e)?e:P2({},e),this._updatePosition(),this},n.prototype.getContainerPoint=function(){var e,n,i=this.getPosition(),o=this.getMap().getSize();return M2(i.left)?M2(i.right)||(e=o.width-parseInt(i.right+"")):e=parseInt(i.left+""),M2(i.top)?M2(i.bottom)||(n=o.height-parseInt(i.bottom+"")):n=parseInt(i.top+""),new w5(e,n)},n.prototype.getContainer=function(){return this.__ctrlContainer},n.prototype.getDOM=function(){return this._controlDom},n.prototype.show=function(){return this.__ctrlContainer.style.display="",this},n.prototype.hide=function(){return this.__ctrlContainer.style.display="none",this},n.prototype.isVisible=function(){return this.__ctrlContainer&&""===this.__ctrlContainer.style.display},n.prototype.remove=function(){return this._map?(D3(this.__ctrlContainer),this.onRemove&&this.onRemove(),delete this._map,delete this.__ctrlContainer,delete this._controlDom,this.fire("remove"),this):this},n.prototype._parse=function(e){var i=e;return E2(e)&&(i=n.positions[i]),i},n.prototype._updatePosition=function(){var e=this.getPosition();for(var n in e||(e={top:20,left:20}),e)if(e.hasOwnProperty(n)){var i=e[n]||0;T2(i)&&(i+="px"),this.__ctrlContainer.style[n]=i}this.fire("positionchange",{position:P2({},e)})},n}(m6(v6));Rit.positions={"top-left":{top:20,left:20},"top-right":{top:20,right:20},"bottom-left":{bottom:20,left:20},"bottom-right":{bottom:20,right:20}},met.mergeOptions({control:!0}),met.include({addControl:function(e){return this._containerDOM.getContext||e.addTo(this),this},removeControl:function(e){return e&&e.getMap()===this?(e.remove(),this):this}});var Dit="addlayer removelayer setbaselayer baselayerremove",kit=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype.buildOn=function(){return this._attributionContainer=O3("div"),this._attributionContainer.className="maptalks-attribution",this._appendCustomClass(this._attributionContainer),this._update(),this._attributionContainer},n.prototype.onAdd=function(){this.getMap().on(Dit,this._update,this)},n.prototype.onRemove=function(){this.getMap().off(Dit,this._update,this)},n.prototype._update=function(){var e=this.getMap();if(e){var n=e._getLayers((function(e){return!!e.options.attribution})).reverse().map((function(e){return e.options.attribution})),i=this.options.content+(n.length>0?" - "+n.join(", "):"");this._attributionContainer.innerHTML='<span style="padding:0px 4px">'+i+"</span>"}},n}(Rit);kit.mergeOptions({position:{bottom:0,left:0},content:'<a href="http://maptalks.org" target="_blank">maptalks</a>'}),met.mergeOptions({attribution:!0}),met.addOnLoadHook((function(){var e=this.options.attribution||this.options.attributionControl;e&&(this.attributionControl=new kit(e),this.addControl(this.attributionControl))}));var Lit=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype.buildOn=function(e){var n=this._getCompass();return this._appendCustomClass(n),this._compass=n,this._registerDomEvents(),e.on("resize moving moveend zooming zoomend rotate rotateend dragrotating dragrotateend viewchange",this._rotateCompass,this),n},n.prototype.onAdd=function(){this._rotateCompass()},n.prototype._getCompass=function(){return O3("div","maptalks-compass")},n.prototype._registerDomEvents=function(){X3(this._compass,"click",this._resetView,this)},n.prototype._rotateCompass=function(){var e=this.getMap().getBearing().toFixed(1),n=parseFloat(e);n<=180&&(n*=-1),n!==this._bearing&&(this._bearing=n,U3(this._compass,"transform: rotate(".concat(this._bearing,"deg);")))},n.prototype.onRemove=function(){this.getMap().off("resize moving moveend zooming zoomend rotate rotateend dragrotating dragrotateend viewchange",this._rotateCompass,this),delete this._compass,delete this._bearing},n.prototype._resetView=function(){this.getMap().animateTo({bearing:0})},n}(Rit);Lit.mergeOptions({position:{top:120,left:20}}),met.mergeOptions({compassControl:!1}),met.addOnLoadHook((function(){this.options.compassControl&&(this.compassControl=new Lit(this.options.compassControl),this.addControl(this.compassControl))}));var Fit=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype.buildOn=function(){var e=this.container=O3("div",this.options.containerClass),n=this.panel=O3("div","panel"),i=this.button=O3("button");return e.appendChild(i),e.appendChild(n),this._appendCustomClass(e),e},n.prototype.onAdd=function(){X3(this.button,"mouseover",this._show,this),X3(this.panel,"mouseleave",this._hide,this)},n.prototype.onRemove=function(){this.panel&&(Y3(this.button,"mouseover",this._show),Y3(this.panel,"mouseleave",this._hide),D3(this.panel),D3(this.button),delete this.panel,delete this.button,delete this.container)},n.prototype._show=function(){G3(this.container,"shown")||(V3(this.container,"shown"),this._createPanel())},n.prototype._hide=function(e){this.panel.contains(e.toElement||e.relatedTarget)||W3(this.container,this.options.containerClass)},n.prototype._createPanel=function(){this.panel.innerHTML="";var e=O3("ul");this.panel.appendChild(e),this._renderLayers(this.getMap(),e)},n.prototype._renderLayers=function(e,n){var i=this,o=e.getBaseLayer(),s=e.getLayers(),a=s.length;if(o){var h=o.layers||[o],l=O3("li","group"),c=O3("ul");(d=O3("label")).innerHTML=this.options.baseTitle,l.appendChild(d);for(var A=0,f=h.length;A<f;A++){this._isExcluded(h[A])&&(c.appendChild(this._renderLayer(h[A],!0)),l.appendChild(c),n.appendChild(l))}}if(a){l=O3("li","group"),c=O3("ul");var d=O3("label"),p=O3("input");p.type="checkbox",p.checked=!0,d.innerHTML=this.options.overlayTitle,l.appendChild(p),l.appendChild(d);var g=function(e){var n=e.target.checked,i=e.target.parentNode;if(i){var o=i.getElementsByTagName("ul")[0];if(o){var s=function(e){var i=e._layer;i&&i[n?"show":"hide"]()},a=function(e){var i=e._layer,o=e.childNodes[0];o&&(o.checked=n),i&&i[n?"show":"hide"]()};s(i),o.childNodes.forEach((function(e){a(e);var n=e.getElementsByTagName("ul")[0];n&&(s(e),n.childNodes.forEach((function(e){a(e)})))}))}}},v=function(e){var n=s[e];if(w._isExcluded(n)){if(n.getLayers){var o=O3("li","group"),a=O3("ul"),h=O3("label"),l=O3("input");h.innerHTML=n.getId(),l.type="checkbox",l.checked=n.isVisible(),l.onchange=g,o.appendChild(l),o.appendChild(h),o.appendChild(a),o._layer=n,c.appendChild(o),(n.getLayers()||[]).forEach((function(e){a.appendChild(i._renderLayer(e,!1,l.checked))}))}else c.appendChild(w._renderLayer(n));n&&!n.isVisible()&&(p.checked=!1)}},w=this;for(A=0;A<a;A++)v(A);l.appendChild(c),n.appendChild(l),p.onchange=g}},n.prototype._isExcluded=function(e){var n=e.getId(),i=this.options.excludeLayers;return!(i.length&&i.indexOf(n)>=0)},n.prototype._renderLayer=function(e,n,i){var o=this;void 0===i&&(i=!0);var s=O3("li","layer"),a=O3("label"),h=O3("input"),l=this.getMap(),c=e.options.visible;e.options.visible=!0;var A=e.isVisible();e.options.visible=c,s.className="layer";var f=h;return n?(f.type="radio",f.name="base"):f.type="checkbox",f.checked=c&&A,i||(f.checked=!1),A||f.setAttribute("disabled","disabled"),f.onchange=function(n){if("radio"===n.target.type){var i=l.getBaseLayer(),s=i.layers;if(s)for(var a=0,h=s.length;a<h;a++){var c=s[a];c[c===e?"show":"hide"]()}else i.isVisible()||i.show();l._fireEvent("setbaselayer")}else e[n.target.checked?"show":"hide"]();o.fire("layerchange",{target:e})},s.appendChild(h),a.innerHTML=e.getId(),s.appendChild(a),s._layer=e,s},n}(Rit);Fit.mergeOptions({position:"top-right",baseTitle:"Base Layers",overlayTitle:"Layers",excludeLayers:[],containerClass:"maptalks-layer-switcher"}),met.mergeOptions({layerSwitcherControl:!1}),met.addOnLoadHook((function(){this.options.layerSwitcherControl&&(this.layerSwitcherControl=new Fit(this.options.layerSwitcherControl),this.addControl(this.layerSwitcherControl))}));var Nit=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype.buildOn=function(){var e=this.options.size;this.options.maximize||(e=[0,0]);var n=O3("div");this._appendCustomClass(n);var i=this.mapContainer=O3("div");i.style.width=e[0]+"px",i.style.height=e[1]+"px",i.className=this.options.containerClass;var o=this.button=O3("div");return o.className=this.options.buttonClass,n.appendChild(i),n.appendChild(o),n},n.prototype.onAdd=function(){this.options.maximize&&this._createOverview(),this.getMap().on("resize moving zooming rotate dragrotating viewchange",this._update,this).on("setbaselayer",this._updateBaseLayer,this).on("spatialreferencechange",this._updateSpatialReference,this),X3(this.button,"click",this._onButtonClick,this),this._updateButtonText()},n.prototype.onRemove=function(){this.getMap().off("resize moving zooming rotate dragrotating viewchange",this._update,this).off("setbaselayer",this._updateBaseLayer,this).off("spatialreferencechange",this._updateSpatialReference,this),this._overview&&(this._overview.remove(),delete this._overview,delete this._perspective),Y3(this.button,"click",this._onButtonClick)},n.prototype.maxmize=function(){var e=this.options.size,n=this.mapContainer;return n.style.width=e[0]+"px",n.style.height=e[1]+"px",this._createOverview(),this},n.prototype.minimize=function(){this._overview&&this._overview.remove(),delete this._overview,delete this._perspective;var e=this.mapContainer;return e.style.width="0px",e.style.height="0px",this},n.prototype.getOverviewMap=function(){return this._overview},n.prototype._onButtonClick=function(){this._overview?this.minimize():this.maxmize(),this._updateButtonText()},n.prototype._updateButtonText=function(){this.button.innerHTML=this._overview?"-":"+"},n.prototype._createOverview=function(){var e=this.getMap(),n=this.mapContainer,i=e.config();P2(i,{center:e.getCenter(),zoom:this._getOverviewZoom(),zoomAnimationDuration:150,pitch:0,bearing:0,scrollWheelZoom:!1,checkSize:!1,doubleClickZoom:!1,touchZoom:!1,control:!1,draggable:!1,maxExtent:null}),this._overview=new met(n,i),this._updateBaseLayer(),this._perspective=new jet(this._getPerspectiveCoords(),{draggable:!0,cursor:"move",symbol:this.options.symbol}).on("dragend",this._onDragEnd,this),new Ent("perspective_layer",this._perspective).addTo(this._overview),this.fire("load")},n.prototype._getOverviewZoom=function(){var e=this.getMap(),n=e.getZoom(),i=e.getMinZoom(),o=this.options.level;if(o>0){for(var s=o;s>0;s--)if(n-s>=i)return n-s}else for(s=o;s<0;s++)if(n-s>=i)return n-s;return n},n.prototype._onDragEnd=function(){var e=this._perspective.getCenter();this._overview.setCenter(e),this.getMap().panTo(e)},n.prototype._getPerspectiveCoords=function(){var e=this.getMap(),n=e.getProjection();return e.getContainerExtent().toArray().map((function(i){if(n){var o=e._containerPointToPrj(i);return e._fixPrjOnWorldWide(o),n.unproject(o)}return e.containerPointToCoordinate(i)}))},n.prototype._update=function(){if(this._overview){H3(this._overview.getContainer());var e=this._getPerspectiveCoords();this._perspective.setCoordinates(e),this._overview.setCenterAndZoom(this.getMap().getCenter(),this._getOverviewZoom())}},n.prototype._updateSpatialReference=function(){if(this._overview){var e=this.getMap();this._overview.setSpatialReference(e.options.spatialReference)}},n.prototype._updateBaseLayer=function(){if(this._overview){var e=this.getMap().getBaseLayer();if(e){var n=e.layers,i=0;if(n)for(var o=0,s=n.length;o<s;o++){if(n[o].isVisible()){i=o;break}}var a=e.toJSON(),h=null;n?(h=a.layers[i].options).visible=!0:h=a.options,this._overview.setMinZoom(h.minZoom||null).setMaxZoom(h.maxZoom||null),delete h.minZoom,delete h.maxZoom,delete a.options.canvas,a.options.visible=!0,a.options.renderer="canvas";var l=cet.fromJSON(a);for(var c in e)O2(e[c])&&e.hasOwnProperty(c)&&e[c]!==e.constructor.prototype[c]&&(l[c]=e[c]);this._overview.setBaseLayer(l)}else this._overview.setBaseLayer(null)}},n}(Rit);Nit.mergeOptions({level:4,position:{right:1,bottom:1},size:[300,200],maximize:!0,symbol:{lineWidth:3,lineColor:"#1bbc9b",polygonFill:"#1bbc9b",polygonOpacity:.4},containerClass:"maptalks-overview",buttonClass:"maptalks-overview-button"}),met.mergeOptions({overviewControl:!1}),met.addOnLoadHook((function(){this.options.overviewControl&&(this.overviewControl=new Nit(this.options.overviewControl),this.addControl(this.overviewControl))}));var zit=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype.buildOn=function(){var e,n=this;if(this.options.custom)E2(this.options.content)?((e=O3("div")).innerHTML=this.options.content,this._appendCustomClass(e)):e=this.options.content;else{if(e=O3("div","maptalks-panel"),this._appendCustomClass(e),this.options.closeButton){var i=O3("a","maptalks-close");i.innerText="",i.href="javascript:;",i.onclick=function(){e.style.display="none",n.fire("close")},e.appendChild(i)}var o=O3("div","maptalks-panel-content");E2(this.options.content)?o.innerHTML=this.options.content:o.appendChild(this.options.content),e.appendChild(o)}return this.draggable=new r9(e,{cancelOn:this._cancelOn.bind(this),ignoreMouseleave:!0}),this.draggable.on("dragstart",this._onDragStart,this).on("dragging",this._onDragging,this).on("dragend",this._onDragEnd,this),this.options.draggable&&this.draggable.enable(),e},n.prototype.update=function(){return this.draggable&&(this.draggable.disable(),delete this.draggable),Rit.prototype.update.call(this)},n.prototype.setContent=function(e){var n=this.options.content;return this.options.content=e,this.fire("contentchange",{old:n,new:e}),this.isVisible()&&this.update(),this},n.prototype.getContent=function(){return this.options.content},n.prototype._cancelOn=function(e){var n=(e.srcElement||e.target).tagName.toLowerCase();return"button"===n||"input"===n||"select"===n||"option"===n||"textarea"===n},n.prototype._onDragStart=function(e){this._startPos=e.mousePos,this._startPosition=P2({},this.getPosition()),this.fire("dragstart",e)},n.prototype._onDragging=function(e){var n=e.mousePos.sub(this._startPos),i=this._startPosition,o=this.getPosition();M2(o.top)||(o.top=parseInt(i.top)+n.y),M2(o.bottom)||(o.bottom=parseInt(i.bottom)-n.y),M2(o.left)||(o.left=parseInt(i.left)+n.x),M2(o.right)||(o.right=parseInt(i.right)-n.x),this.setPosition(o),this.fire("dragging",e)},n.prototype._onDragEnd=function(e){delete this._startPos,delete this._startPosition,this.fire("dragend",e)},n.prototype._getConnectPoints=function(){var e=this.getMap(),n=this.getContainerPoint(),i=this.getDOM(),o=parseInt(i.clientWidth+""),s=parseInt(i.clientHeight+"");return[e.containerPointToCoordinate(n.add(o/2,0)),e.containerPointToCoordinate(n.add(o,s/2)),e.containerPointToCoordinate(n.add(o/2,s)),e.containerPointToCoordinate(n.add(0,s/2))]},n}(Rit);zit.mergeOptions({position:"top-right",draggable:!0,custom:!1,content:"",closeButton:!0});var Bit=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype.buildOn=function(){var e=this._getReset();return this._appendCustomClass(e),this._reset=e,this._registerDomEvents(),e},n.prototype.onAdd=function(){this._view=this.options.view?this.options.view:this.getMap().getView()},n.prototype.setView=function(e){this._view=e},n.prototype._getReset=function(){return O3("div","maptalks-reset")},n.prototype._registerDomEvents=function(){X3(this._reset,"click",this._resetView,this)},n.prototype.onRemove=function(){delete this._reset,delete this._view},n.prototype._resetView=function(){this.getMap().setView(this._view)},n}(Rit);Bit.mergeOptions({position:{top:156,left:20},view:null}),met.mergeOptions({resetControl:!1}),met.addOnLoadHook((function(){this.options.resetControl&&(this.resetControl=new Bit(this.options.resetControl),this.addControl(this.resetControl))}));var Hit="zoomend moving moveend",jit=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype.buildOn=function(e){return this._map=e,this._scaleContainer=O3("div",this.options.containerClass),this._addScales(),e.on(Hit,this._update,this),this._map.isLoaded()&&this._update(),this._appendCustomClass(this._scaleContainer),this._scaleContainer},n.prototype.onRemove=function(){this.getMap().off(Hit,this._update,this)},n.prototype._addScales=function(){var e="border: 2px solid #000000;border-top: none;line-height: 1.1;padding: 0px;color: #000000;font-size: 11px;text-align:center;white-space: nowrap;overflow: hidden;-moz-box-sizing: content-box;box-sizing: content-box;background: #fff; background: rgba(255, 255, 255, 0);";this.options.metric&&(this._mScale=R3("div",this.options.containerClass?null:e,this._scaleContainer)),this.options.imperial&&(this._iScale=R3("div",this.options.containerClass?null:e,this._scaleContainer))},n.prototype._update=function(){var e=this._map.pixelToDistance(this.options.maxWidth,0);this._updateScales(e)},n.prototype._updateScales=function(e){this.options.metric&&e&&this._updateMetric(e),this.options.imperial&&e&&this._updateImperial(e)},n.prototype._updateMetric=function(e){var n=this._getRoundNum(e);this._updateScale(this._mScale,n<1e3?n+" m":n/1e3+" km",n/e)},n.prototype._updateImperial=function(e){var n,i,o,s=3.2808399*e;s>5280?(i=this._getRoundNum(n=s/5280),this._updateScale(this._iScale,i+" mile",i/n)):(o=this._getRoundNum(s),this._updateScale(this._iScale,o+" feet",o/s))},n.prototype._updateScale=function(e,n,i){e.style.width=Math.round(this.options.maxWidth*i)+"px",e.innerHTML=n},n.prototype._getRoundNum=function(e){var n=Math.pow(10,(Math.floor(e)+"").length-1),i=e/n;return n*(i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:1)},n}(Rit);jit.mergeOptions({position:"bottom-left",maxWidth:100,metric:!0,imperial:!1,containerClass:null}),met.mergeOptions({scaleControl:!1}),met.addOnLoadHook((function(){this.options.scaleControl&&(this.scaleControl=new jit(this.options.scaleControl),this.addControl(this.scaleControl))}));var Uit=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype.buildOn=function(e){this._map=e;var n=O3("div"),i=O3("ul","maptalks-toolbar-hx");n.appendChild(i),V3(n,this.options.vertical?"maptalks-toolbar-vertical":"maptalks-toolbar-horizonal");var o=this;function s(e,n,i,s){var a=o._getItems()[n];return function(o){return z3(o),e({target:a,index:n,childIndex:i,dom:s})}}var a=this.options.items;if(z5(a))for(var h=0,l=a.length;h<l;h++){var c=a[h],A=O3("li");if(28!==this.options.height&&(A.style.lineHeight=this.options.height+"px"),A.style.height=this.options.height+"px",A.style.cursor="pointer",Z3(c.item)){A.style.textAlign="center";var f=Q3("div",c.item);A.innerHTML='<div style="margin-top:'+(this.options.height-f.height)/2+'px;">'+c.item+"</div>"}else A.innerHTML=c.item;if(c.click&&X3(A,"click",s(c.click,h,null,A)),z5(c.children)){var d=this._createDropMenu(h);A.appendChild(d),A._menu=d,X3(A,"mouseover",(function(){this._menu.style.display=""})),X3(A,"mouseout",(function(){this._menu.style.display="none"}))}i.appendChild(A)}return this._appendCustomClass(n),n},n.prototype._createDropMenu=function(e){var n=this;function i(e,i,o){var s=n._getItems()[i].children[o];return function(n){return z3(n),e({target:s,index:i,childIndex:o})}}var o=O3("div","maptalks-dropMenu"),s=this._getItems(),a=s.length,h=O3("ul"),l=s[e].children;e===a-1&&l&&(o.style.cssText="right: 0px;",h.style.cssText="right: 0px;position: absolute;",this.options.reverseMenu&&(h.style.bottom="0")),o.appendChild(O3("em","maptalks-ico"));for(var c=0,A=0,f=l.length;A<f;A++){var d=g3(l[A].item,"12px");d.width>c&&(c=d.width)}for(A=0,f=l.length;A<f;A++){var p=l[A],g=O3("li");g.innerHTML='<a href="javascript:;">'+p.item+"</a>",g.style.cursor="pointer",g.style.width=c+24+"px",X3(g.childNodes[0],"click",i(p.click,e,A)),h.appendChild(g)}if(this.options.vertical){var v=c<95?95:c;this.options.reverseMenu?o.style.right=-(v+20+2)+"px":o.style.left=-(v+20+2)+"px"}else this.options.reverseMenu?o.style.bottom="28px":o.style.top="29px";return o.appendChild(h),o.style.display="none",o},n.prototype._getItems=function(){return this.options.items||[]},n}(Rit);Uit.mergeOptions({height:28,vertical:!1,position:"top-right",reverseMenu:!1,items:[]});var Git=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype.buildOn=function(e){var n=this.options,i=O3("div","maptalks-zoom");if(this._appendCustomClass(i),n.zoomLevel){var o=O3("span","maptalks-zoom-zoomlevel"),s=O3("span","maptalks-zoom-zoomlevel-text");o.appendChild(s),i.appendChild(o),this._levelDOM=s}var a=O3("div","maptalks-zoom-slider"),h=O3("a","maptalks-zoom-zoomin");h.href="javascript:;",a.appendChild(h),this._zoomInButton=h;var l=O3("a","maptalks-zoom-zoomout");return l.href="javascript:;",a.appendChild(l),this._zoomOutButton=l,i.appendChild(a),e.on("_zoomend _zooming _zoomstart _spatialreferencechange",this._update,this),this._update(),this._registerDomEvents(),i},n.prototype.onRemove=function(){this.getMap().off("_zoomend _zooming _zoomstart _spatialreferencechange",this._update,this)},n.prototype._update=function(){this._updateText()},n.prototype._updateText=function(){if(this._levelDOM){var e=this.getMap().getZoom();S2(e)||(e=Math.floor(10*e)/10),this._levelDOM.innerHTML=e+""}},n.prototype._registerDomEvents=function(){this._zoomInButton&&X3(this._zoomInButton,"click",this._onZoomInClick,this),this._zoomOutButton&&X3(this._zoomOutButton,"click",this._onZoomOutClick,this)},n.prototype._onZoomInClick=function(e){N3(e),this.getMap().zoomIn()},n.prototype._onZoomOutClick=function(e){N3(e),this.getMap().zoomOut()},n}(Rit);Git.mergeOptions({position:"top-left",zoomLevel:!0,seamless:!1}),met.mergeOptions({zoomControl:!1}),met.addOnLoadHook((function(){this.options.zoomControl&&(this.zoomControl=new Git(this.options.zoomControl),this.addControl(this.zoomControl))}));var Vit=function(){function e(e,n,i,o){Array.isArray(e)?(this.scale={x:e[0],y:e[1]},this.origin={x:e[2],y:e[3]}):(this.scale={x:e,y:n},this.origin={x:i,y:o})}return e.getDefault=function(e){var n=e.code.toLowerCase();return"baidu"===n?"baidu":n==="EPSG:4326".toLowerCase()||n==="EPSG:4490".toLowerCase()?"tms-global-geodetic":"identity"===n?[1,-1,0,0]:"web-mercator"},e}(),Wit=6378137*Math.PI;P2(Vit,{"web-mercator":new Vit([1,-1,-Wit,Wit]),"tms-global-mercator":new Vit([1,1,-Wit,-Wit]),"tms-global-geodetic":new Vit([1,1,-180,-90]),baidu:new Vit([1,1,0,0])});for(var qit=function(){function e(e,n,i,o){this.map=e,this.tileSize=o,this.fullExtent=i,this.prepareTileInfo(n,i),this._xScale=i.right>=i.left?1:-1,this._yScale=i.top>=i.bottom?1:-1;var s=e.getGLRes();this._pointOrigin=e._prjToPointAtRes(new w5(this.tileSystem.origin),s),this._glRes=s}return e.prototype.prepareTileInfo=function(e,n){if(E2(e)?e=Vit[e.toLowerCase()]:Array.isArray(e)&&(e=new Vit(e)),!e)throw new Error("Invalid TileSystem");this.tileSystem=e,this.transformation=new _9([n.right>n.left?1:-1,n.top>n.bottom?-1:1,e.origin.x,e.origin.y])},e.prototype._getTileNum=function(e,n){var i=this.tileSystem,o=this.tileSize,s=Math.floor(1e-7*i.scale.x+e.x/(o.width*n)),a=Math.ceil(1e-7*i.scale.y+e.y/(o.height*n));return{x:i.scale.x*s,y:i.scale.y*a}},e.prototype.getTileIndex=function(e,n,i){var o=this.tileSystem,s=this.transformation.transform(e,1),a=this._getTileNum(s,n);return o.scale.x<0&&(a.x-=1),o.scale.y>0&&(a.y-=1),this.getNeighorTileIndex(a.x,a.y,0,0,n,i)},e.prototype.getNeighorTileIndex=function(e,n,i,o,s,a){var h=this.tileSystem,l=e+h.scale.x*i,c=n-h.scale.y*o,A=!1,f=l,d=c,p=this._getTileFullIndex(s);return a&&(!0!==a&&"x"!==a||(p.xmax===p.xmin?l=p.xmin:l<p.xmin?(l=p.xmax-(p.xmin-l)%(p.xmax-p.xmin))===p.xmax&&(l=p.xmin):l>=p.xmax&&(l=p.xmin+(l-p.xmin)%(p.xmax-p.xmin))),!0!==a&&"y"!==a||(p.ymax===p.ymin?c=p.ymin:c>=p.ymax?c=p.ymin+(c-p.ymin)%(p.ymax-p.ymin):c<p.ymin&&(c=p.ymax-(p.ymin-c)%(p.ymax-p.ymin))===p.ymax&&(c=p.ymin))),(l<p.xmin||l>p.xmax||c>p.ymax||c<p.ymin)&&(A=!0),{x:l,y:c,idx:f,idy:d,out:A}},e.prototype._getTileFullIndex=function(e){if(this._tileFullIndex||(this._tileFullIndex={}),this._tileFullIndex[e])return this._tileFullIndex[e];var n=this.fullExtent,i=this.transformation,o=this._getTileNum(i.transform(new o9(n.left,n.top),1),e),s=this._getTileNum(i.transform(new o9(n.right,n.bottom),1),e),a=this.tileSystem;return a.scale.x<0&&(o.x-=1,s.x-=1),a.scale.y>0&&(o.y-=1,s.y-=1),this._tileFullIndex[e]=new y9(o,s,null),this._tileFullIndex[e]},e.prototype.getTilePrjNW=function(e,n,i,o){var s=this.tileSystem,a=this.tileSize,h=s.origin.y+this._yScale*s.scale.y*(n+(1===s.scale.y?1:0))*i*a.height,l=s.origin.x+this._xScale*s.scale.x*(e+(1===s.scale.x?0:1))*i*a.width;return o?(o.set(l,h),o):new o9(l,h)},e.prototype.getTilePointNW=function(e,n,i,o){var s=this._glRes/i,a=this.tileSystem,h=this.tileSize,l=this._pointOrigin.y*s+this._yScale*a.scale.y*(n+(1===a.scale.y?1:0))*h.height,c=this._pointOrigin.x*s+this._xScale*a.scale.x*(e+(1===a.scale.x?0:1))*h.width;return o?(o.set(c,l),o):new w5(c,l)},e.prototype.getTilePrjSE=function(e,n,i,o){var s=this.tileSystem,a=this.tileSize,h=s.origin.y+this._yScale*s.scale.y*(n+(1===s.scale.y?0:1))*i*a.height,l=s.origin.x+this._xScale*s.scale.x*(e+(1===s.scale.x?1:0))*i*a.width;return o?(o.set(l,h),o):new o9(l,h)},e.prototype.getTilePointSE=function(e,n,i,o){var s=this._glRes/i,a=this.tileSystem,h=this.tileSize,l=this._pointOrigin.y*s+this._yScale*a.scale.y*(n+(1===a.scale.y?0:1))*h.height,c=this._pointOrigin.x*s+this._xScale*a.scale.x*(e+(1===a.scale.x?1:0))*h.width;return o?(o.set(c,l),o):new w5(c,l)},e.prototype.getTilePrjExtent=function(e,n,i){var o=this.getTilePrjNW(e,n,i),s=this.getTilePrjSE(e,n,i);return new y9(o,s)},e}(),Zit=[],Qit=0
/*!
  * Contains code from THREE.js
  * MIT License
  * https://github.com/mrdoob/three.js
  */;Qit<6;Qit++)Zit[Qit]=[];var Xit=[];function Yit(e,n,i){!function(e){var n=e,i=n[0],o=n[1],s=n[2],a=n[3],h=n[4],l=n[5],c=n[6],A=n[7],f=n[8],d=n[9],p=n[10],g=n[11],v=n[12],w=n[13],C=n[14],P=n[15];Kit(Zit[0],a-i,A-h,g-f,P-v),Kit(Zit[1],a+i,A+h,g+f,P+v),Kit(Zit[2],a+o,A+l,g+d,P+w),Kit(Zit[3],a-o,A-l,g-d,P-w),Kit(Zit[4],a-s,A-c,g-p,P-C),Kit(Zit[5],a+s,A+c,g+p,P+C)}(e);for(var o=0;o<6;o++){var s=Zit[o];if(Xit[0]=s[0]>0?n[1][0]:n[0][0],Xit[1]=s[1]>0?n[1][1]:n[0][1],Xit[2]=s[2]>0?n[1][2]:n[0][2],$it(s,Xit)<0)return!1}return!0}var Jit=1/6;function Kit(e,n,i,o,s){return e[0]=n*Jit,e[1]=i*Jit,e[2]=o*Jit,e[3]=s*Jit,e}function $it(e,n){return e[0]*n[0]+e[1]*n[1]+e[2]*n[2]+e[3]}var trt=new w5(0,0),ert="undefined"!=typeof Set,nrt=function(){function e(){this._table=ert?new Set:{}}return e.prototype.add=function(e){ert?this._table.add(e):this._table[e]=!0},e.prototype.has=function(e){return ert?this._table.has(e):this._table[e]},e.prototype.reset=function(){ert?this._table.clear():this._table={}},e}(),irt={urlTemplate:null,subdomains:null,errorUrl:null,repeatWorld:!0,background:!0,loadingLimitOnInteracting:3,loadingLimit:0,tileRetryCount:0,placeholder:!1,crossOrigin:null,tileSize:[256,256],offset:[0,0],tileSystem:null,fadeAnimation:!b2,fadeDuration:1e3/60*10,debug:!1,spatialReference:null,maxCacheSize:256,renderer:f5.webgl?"gl":"canvas",clipByPitch:!0,maxAvailableZoom:null,cascadeTiles:!0,zoomOffset:0,pyramidMode:1,decodeImageInWorker:!1,tileLimitPerFrame:0,tileStackStartDepth:7,tileStackDepth:6,awareOfTerrain:!0,bufferPixel:.5,mipmapTexture:!0,depthMask:!0,currentTilesFirst:!0,forceRenderOnMoving:!0},rrt=/\{ *([\w_]+) *\}/g,ort=new w5(0,0),srt=new w5(0,0),art=new w5(0,0),hrt=new w5(0,0),lrt=new w5(0,0),urt=new w5(0,0),crt=[[0,0,0],[0,0,0]],Art=[0,0,0],frt=[0,0,0],drt=[0,0,0],prt=function(e){function n(n,i){return e.call(this,n,i)||this}return p5(n,e),n.fromJSON=function(e){return e&&"TileLayer"===e.type?new n(e.id,e.options):null},n.prototype.forceReload=function(){return this.fire("forcereloadstart"),this.clear(),this.load(),this.fire("forcereloadend"),this},n.prototype.getTileSize=function(e){if(this._tileSize)return this._tileSize;var n=this.options.tileSize;return T2(n)&&(n=[n,n]),this._tileSize=new h3(n),this._tileSize},n.prototype.getTiles=function(e,n){var i,o=this;if(this._coordCache={},i=this._isPyramidMode()?this._getPyramidTiles(e,n):this._getCascadeTiles(e,n),!this._maskGeoJSON)return i;var s=0;return(i.tileGrids||[]).forEach((function(e){e.tiles=(e.tiles||[]).filter((function(e){return o._tileInMask(e)})),s+=e.tiles.length;var n=e.tiles.map((function(e){return e.parent}));e.parents=e.parents.filter((function(e){return n.indexOf(e.id)>-1}))})),i.count=s,i},n.prototype._isPyramidMode=function(){var e=this.getSpatialReference();return!this._disablePyramid&&!this._hasOwnSR&&this.options.pyramidMode&&e&&e.isPyramid()},n.prototype._getTileFullExtent=function(){if(this._tileFullExtent)return this._tileFullExtent;var e=this.getSpatialReference(),n=e.getFullExtent(),i=e.getResolution(0),o=this.getMap();return this._tileFullExtent=n.convertTo((function(e){return o._prjToPointAtRes(e,i,trt)})),this._tileFullExtent},n.prototype._getRootNodes=function(e){var n=this.getMap();if(this._rootNodes){var i=this._rootNodes,o=i.tiles;if(n.width!==i.mapWidth||n.height!==i.mapHeight){for(var s=this._getRootError(),a=0;a<o.length;a++)o[a].error=s;this._rootNodes.mapWidth=n.width,this._rootNodes.mapHeight=n.height}for(a=0;a<o.length;a++)o[a].offset[0]=e[0],o[a].offset[1]=e[1];return this._rootNodes}var h=this.getSpatialReference(),l=h.getResolution(0),c=this._getTileConfig(),A=h.getFullExtent(),f=c.tileSystem,d=f.origin,p=f.scale,g=c.getTilePrjExtent(0,0,l),v=g.getWidth(),w=g.getHeight(),C=1e-5,P=Math.abs((d.x-A.left)/v);P=Math.ceil(P-C);var T=Math.abs((A.right-d.x)/v);T=Math.ceil(T-C);var S=Math.ceil(Math.abs(A.top-d.y)/w);S=Math.ceil(S-C);var I=Math.ceil(Math.abs(A.bottom-d.y)/w);if((T+P)*((I=Math.ceil(I-C))+S)>32)return{status:0,error:"Too many root nodes"};var E=this._getRootError(),O=[];for(a=-P;a<T;a++)for(var k=-S;k<I;k++){var L=p.y<0?k:-(k+1);O.push(this.createTileNode(a,L,0,a,L,l,E))}return this._rootNodes={status:1,tiles:O,mapWidth:n.width,mapHeight:n.height},this._getRootNodes(e)},n.prototype.createTileNode=function(e,n,i,o,s,a,h,l,c,A){var f=this.getMap(),d=this.options.zoomOffset;c||(c=this._getTileConfig().getTilePrjExtent(e,n,a).convertTo((function(e){return f._prjToPointAtRes(e,a,trt)})));var p=this._getTileOffset(i),g=this.getTileUrl(e,n,i+d);return{parent:l,layer:this.getId(),x:e,y:n,z:i,idx:o,idy:s,res:a,extent2d:c,id:A||this._getTileId(e,n,i),url:r4(g),offset:p,error:h,children:[]}},n.prototype._getRootError=function(){var e=this.getMap(),n=L2(e.getFov()),i=e.width/e.height,o=e.cameraPosition[2],s=o*Math.tan(.5*n),a=s*i,h=Math.sqrt(o*o+s*s+a*a);return e._getFovZ(0)*(h/o)*this.getSpatialReference().getResolution(0)/e.getResolution(0)},n.prototype._getPyramidTiles=function(e,n){var i=this.getMap();isNaN(+e)&&(e=this._getTileZoom(i.getZoom()));var o,s=this.getSpatialReference(),a=Math.min(e,this.getMaxZoom(),this.getMaxAvailableZoom()||1/0),h=i.projViewMatrix,l=this._getTileFullExtent(),c=this._getTileOffset(0);if(this.options.repeatWorld){var A=i.getContainerExtent(),f=this._convertToExtent2d(A),d=s.getResolution(0)/i.getResolution();if(f.within(l.copy()._scale(d))){if(1!==(T=this._getRootNodes(c)).status)return console.warn(T.error),this._disablePyramid=!0,this.getTiles(e,n);o=v5([],y5(T.tiles),!1)}else{var p=i.getPitch(),g=i.options.cascadePitches[1],v=Math.floor(i._getVisualHeight(g)),w=p<=g?A:new v9(0,i.height-v,i.width,i.height);this._visitedTiles=new nrt;var C=this._getTiles(0-this.options.zoomOffset,w,2,n&&n.getRenderer(),!0),P=this._getRootError()*Math.pow(2,this.options.zoomOffset);C.tiles.forEach((function(e){e.error=P})),o=C.tiles}}else{var T;if(1!==(T=this._getRootNodes(c)).status)return console.warn(T.error),this._disablePyramid=!0,this.getTiles(e,n);o=v5([],y5(T.tiles),!1)}for(var S=i.getGLRes(),I={0:c},E=new v9,O=[],k=[];o.length>0;){var L=o.pop();L.z!==a?(I[L.z+1]||(I[L.z+1]=this._getTileOffset(L.z+1)),this._splitNode(L,h,o,O,E,a,I[L.z+1],n&&n.getRenderer(),S),this.isParentTile(e,a,L)&&k.push(L)):(E._combine(L.extent2d),O.push(L))}return k.sort(grt),{tileGrids:[{extent:E,count:O.length,tiles:O,parents:k,offset:[0,0],zoom:e}],count:O.length}},n.prototype.isParentTile=function(e,n,i){var o=Math.max(this.getMinZoom(),e-this.options.tileStackStartDepth),s=Math.min(n,o+this.options.tileStackDepth);return i.z>=o&&i.z<s},n.prototype._splitNode=function(e,n,i,o,s,a,h,l,c){for(var A=e.z+1,f=this.getSpatialReference(),d=e.idx,p=e.idy,g=l||this.getRenderer(),v=!1,w=[],C=f.getResolution(A)/c,P=0;P<4;P++){var T=P%2,S=P>>1,I=(d<<1)+T,E=(p<<1)+S;e.children||(e.children=[]);var O=e.children[P];O||(O=this._getTileId(I,E,A),e.children[P]=O);var k=g.isTileCachedOrLoading(O),L=k&&k.info;L||(this.tileInfoCache||(this.tileInfoCache=new r6(4*this.options.maxCacheSize)),(L=this.tileInfoCache.get(O))||(L=this._createChildNode(e,T,S,h,O))),L.error=e.error/2,L.offset[0]=h[0],L.offset[1]=h[1];var F=this._isTileVisible(L,n,C,a,h);if(1===F)v=!0;else{if(-1===F)continue;if(0===F&&A!==a)return o.push(e),void s._combine(e.extent2d)}w.push(L)}A===a?v?i.push.apply(i,v5([],y5(w),!1)):(o.push(e),s._combine(e.extent2d)):i.push.apply(i,v5([],y5(w),!1))},n.prototype._createChildNode=function(e,n,i,o,s){var a,h=e.extent2d,l=e.z+1,c=(e.x<<1)+n,A=(e.y<<1)+i,f=(e.idx<<1)+n,d=(e.idy<<1)+i,p=h.getWidth()/2*2,g=h.getHeight()/2*2,v=2*h.xmin,w=2*h.ymax,C=2*h.ymin,P=this._getTileConfig().tileSystem.scale.y;if(s=s||this._getTileId(f,d,l),P<0){var T=v+n*p,S=w-i*g;a=new v9(T,S-g,T+p,S)}else{var I=v+n*p,E=C+i*g;a=new v9(I,E,I+p,E+g)}var O=this.createTileNode(c,A,l,f,d,e.res/2,e.error/2,e.id,a,s);return this.tileInfoCache.add(s,O),O},n.prototype._isTileVisible=function(e,n,i,o,s){if(0===e.z)return 1;if(!this._isTileInFrustum(e,n,i,s))return-1;var a=this.options.maxError;return M2(a)&&(a=1),this._getScreenSpaceError(e,i,o,s)>=a?1:0},n.prototype._isTileInFrustum=function(e,n,i,o){if(!this._zScale){var s=this.getMap(),a=s.getGLRes();this._zScale=s.altitudeToPoint(100,a)/100}var h=this.getRenderer(),l=e.extent2d,c=l.xmin,A=l.ymin,f=l.xmax,d=l.ymax;if(e.offset&&!O2(this.options.offset)){var p=y5(e.offset,2),g=p[0],v=p[1];c+=g,f+=g,A+=v,d+=v}return crt[0][0]=(c-o[0])*i,crt[0][1]=(A-o[1])*i,crt[0][2]=(e.minAltitude||h&&h.avgMinAltitude||0)*this._zScale,crt[1][0]=(f-o[0])*i,crt[1][1]=(d-o[1])*i,crt[1][2]=(e.maxAltitude||h&&h.avgMaxAltitude||0)*this._zScale,Yit(n,crt)},n.prototype._getScreenSpaceError=function(e,n,i,o){var s=e.error,a=this.getMap(),h=e.extent2d,l=h.ymin,c=h.xmax,A=h.ymax;Art[0]=(h.xmin-o[0])*n,Art[1]=(l-o[1])*n,frt[0]=(c-o[0])*n,frt[1]=(A-o[1])*n;var f=function(e,n,i){var o=Math.max(e[0]-i[0],0,i[0]-n[0]),s=Math.max(e[1]-i[1],0,i[1]-n[1]),a=Math.max(e[2]-i[2],0,i[2]-n[2]);return Math.sqrt(o*o+s*s+a*a)}(Art,frt,a.cameraPosition),d=Math.max(Math.abs(f),1e-7),p=Math.abs(e.z-i),g=s*(a.height<1e3||p<=1?1:p<=2?.7:.605)/d;return this.getMap().getPitch()<=60?1.45*g:g},n.prototype._getCascadeTiles=function(e,n){var i=this.getMap(),o=i.getPitch(),s=n&&n.getRenderer(),a=i.getContainerExtent(),h=[],l=0,c=this.getMinZoom(),A=i.options.cascadePitches[0],f=i.options.cascadePitches[1],d=Math.floor(i._getVisualHeight(f)),p=M2(e)?this._getTileZoom(i.getZoom()):e;if(this._visitedTiles=new nrt,!M2(e)||!this.options.cascadeTiles||o<=A||!M2(c)&&p<=c){var g=o<=f?a:new v9(0,i.height-d,i.width,i.height),v=this._getTiles(p,g,2,s);return v&&(l+=v.tiles.length,h.push(v)),{tileGrids:h,count:l}}var w=Math.floor(i._getVisualHeight(A)),C=new v9(0,i.height-w,i.width,i.height),P=this._getTiles(p,C,0,s);l+=P?P.tiles.length:0,h.push(P);var T,S,I=C.ymin,E=i.getSpatialReference().getZoomDirection(),O=E;if(o>f){p-O<=c&&(O=0);var k=new v9(0,i.height-d,i.width,I);l+=(T=this._getTiles(p-O,k,1,s))?T.tiles.length:0,I=k.ymin,O+=4*E,h.push(T)}if(p-O>=c){var L=new v9(0,a.ymin,i.width,I);l+=(S=this._getTiles(p-O,L,2,s))?S.tiles.length:0,h.push(S)}return T&&S&&(h[1]=S,h[2]=T),{tileGrids:h,count:l}},n.prototype.getTileUrl=function(e,n,i){var o=this.options.urlTemplate,s="";if(this.options.subdomains){var a=this.options.subdomains;if(z5(a)){var h=(e+n)%a.length;h<0&&(h=0),s=a[h]}}if(O2(o))return o(e,n,i,s);var l={x:e,y:n,z:i,s};return this.options.token&&(l.token=this.options.token),this.options.customTags&&P2(l,this.options.customTags),o.replace(rrt,(function(e,n){var i=l[n];if(void 0===i)throw new Error("No value provided for variable "+e);return"function"==typeof i&&(i=i(l)),i}))},n.prototype.clear=function(){return this._renderer&&this._renderer.clear(),this.tileInfoCache&&this.tileInfoCache.reset(),this.fire("clear"),this},n.prototype.toJSON=function(){return{type:this.getJSONType(),id:this.getId(),options:this.config()}},n.prototype.getSpatialReference=function(){var e=this.getMap();if(e&&(!this.options.spatialReference||Ktt.equals(this.options.spatialReference,e.options.spatialReference)))return e.getSpatialReference();if(this._sr)return this._sr;var n=this.options.spatialReference;if(E2(n)&&!(n=Ktt.getPreset(n)))throw new Error("Unsupported spatial reference: ".concat(this.options.spatialReference,", possible values: ").concat(Ktt.getAllPresets().join()));return this._sr=new Ktt(n),this._srMinZoom=this._sr.getMinZoom(),this._srMaxZoom=this._sr.getMaxZoom(),this._hasOwnSR=this._sr.toJSON().projection!==e.getSpatialReference().toJSON().projection,this._sr},n.prototype.getMinZoom=function(){var e=this.options.minZoom||0;return this.getSpatialReference()!==this.getMap().getSpatialReference()?Math.max(e,this._srMinZoom):e},n.prototype.getMaxZoom=function(){return this.getSpatialReference()!==this.getMap().getSpatialReference()?Math.min(e.prototype.getMaxZoom.call(this),this._srMaxZoom):e.prototype.getMaxZoom.call(this)},n.prototype._getTileZoom=function(e){if(!this._hasOwnSR){var n=this.getMap().getResolution(e),i=this.getSpatialReference().getResolution(e);e+=Math.log(i/n)*Math.LOG2E}var o=this.getMaxAvailableZoom();return!M2(o)&&e>o&&(e=o),S2(e)||(e=Math.round(e)),e=Math.max(0,e)},n.prototype.getMaxAvailableZoom=function(){var e=this.getSpatialReference();return this.options.maxAvailableZoom||e&&e.getMaxZoom()},n.prototype._getTiles=function(e,n,i,o,s){var a=this.getMap(),h=e,l=a.projViewMatrix,c=a.getResolution(e)/a.getResolution(e-1)==.5;i<2&&(0===i&&c&&(h-=1),l=0===i?a.cascadeFrustumMatrix0:1===i?a.cascadeFrustumMatrix1:a.projViewMatrix);var A=h+this.options.zoomOffset,f=this._getTileOffset(h),d=f[0]||f[1],p={zoom:h,extent:null,offset:f,tiles:[]};if(A<0)return p;if(!(a&&this.isVisible()&&a.width&&a.height))return p;if(!s){var g=this.getMinZoom(),v=this.getMaxZoom();if(!M2(g)&&h<g||!M2(v)&&h>v)return p}var w=this._getTileConfig();if(!w)return p;var C,P={zoom:f},T=this.getSpatialReference().getResolution(h);C=this._hasOwnSR?a.getGLScale(h):T/a.getGLRes();var S=!this._hasOwnSR&&this.options.repeatWorld,I=this._convertToExtent2d(n),E=this._getMask2DExtent();if(E){var O=E.intersection(I);if(!O)return p;n=O.convertTo((function(e){return a._pointToContainerPoint(e,void 0,0,trt)}))}var k,L=a._containerPointToPrj(n.getCenter(),ort),F=a._prjToPoint(L,h,srt);k=this._project(d?a._pointToPrj(F._add(f),h,srt):L,srt);var N=a.getGLScale()/a.getGLScale(h);art.x=I.xmin*N,art.y=I.ymax*N,hrt.x=I.xmax*N,hrt.y=I.ymin*N;for(var z=this._project(a._pointToPrj(art._add(f),h,art),art),H=this._project(a._pointToPrj(hrt._add(f),h,hrt),hrt),j=w.getTileIndex(k,T,S),W=w.getTileIndex(z,T,S),q=w.getTileIndex(H,T,S),Y=Math.ceil(Math.abs(j.idy-W.idy)),J=Math.ceil(Math.abs(j.idx-W.idx)),$=Math.ceil(Math.abs(j.idy-q.idy)),it=Math.ceil(Math.abs(j.idx-q.idx)),rt=(Y+$+1)*(J+it+1),ot=this.getTileSize(),st=this.getRenderer()||o,at=this._getTileConfig().tileSystem.scale,ht=[],At=new v9,ft=new w5(0,0),gt=-Y;gt<=$;gt++)for(var vt=-J,_t=-1/0,xt=!1;vt>=_t&&vt<=it;){var wt=w.getNeighorTileIndex(j.idx,j.idy,vt,gt,T,S);_t===-1/0?vt++:vt--;var Ct=this._getTileId(wt.idx,wt.idy,h);if(!(wt.out||this._visitedTiles&&this._visitedTiles.has(Ct))){var Ot=st&&st.isTileCachedOrLoading(Ct);Ot&&(Ot=Ot.info);var Dt=void 0;if(Ot){var kt=Ot.extent2d;ft.set(kt.xmin,kt.ymax),Dt=ft}else if(this._hasOwnSR){var Nt=w.getTilePrjNW(wt.x,wt.y,T);Dt=a._prjToPoint(this._unproject(Nt,hrt),h)}else Dt=w.getTilePointNW(wt.x,wt.y,T);var Bt=void 0,Ht=void 0;if(this._hasOwnSR){var Ut=void 0;if(this._hasOwnSR){var Wt=w.getTilePrjSE(wt.x,wt.y,T);Ut=a._prjToPoint(this._unproject(Wt,hrt),h,hrt)}else Ut=w.getTilePointSE(wt.x,wt.y,T);Bt=Math.ceil(Math.abs(Ut.x-Dt.x)),Ht=Math.ceil(Math.abs(Ut.y-Dt.y))}else Bt=ot.width,Ht=ot.height;var Xt=at.x*(wt.idx-wt.x)*Bt,Kt=at.y*(wt.idy-wt.y)*Ht;Ot||!Xt&&!Kt||Dt._add(Xt,Kt);var $t=Ot&&Ot.extent2d||new v9(Dt.x,Dt.y-Ht,Dt.x+Bt,Dt.y);if(rt<=4||xt||this._isTileInExtent(l,$t,f,C)){var te=this._hasOwnSR?a._getResolution(h):T;this._visitedTiles&&0===i&&this._visitedTiles.add(Ct),c&&0===i?(this._splitTiles(l,ht,st,wt,h+1,te,$t,Xt,Kt,P),At._combine($t)):(Ot?(Ot.offset[0]=f[0],Ot.offset[1]=f[1]):Ot=this.createTileNode(wt.x,wt.y,h,wt.idx,wt.idy,te,0,null,$t,Ct),ht.push(Ot),At._combine($t)),_t===-1/0?(_t=vt,vt=it):xt||(xt=!0)}}}if(ht.length){var ee=a._containerPointToPoint(n.getCenter(),h,trt)._add(f),ne=new w5(0,0),ie=new w5(0,0);ht.sort((function(e,n){return ne.set((e.extent2d.xmin+e.extent2d.xmax)/2,(e.extent2d.ymin+e.extent2d.ymax)/2),ie.set((n.extent2d.xmin+n.extent2d.xmax)/2,(n.extent2d.ymin+n.extent2d.ymax)/2),ne.distanceTo(ee)-ie.distanceTo(ee)}))}return{offset:f,zoom:e,extent:At,tiles:ht}},n.prototype._convertToExtent2d=function(e){var n=this,i=this.getMap();return e.convertTo((function(e){if(e.y>0&&e.y<i.height){var o=(0===e.x?0:1)+e.y;n._coordCache[o]||(n._coordCache[o]=i._containerPointToPoint(e)),n._coordCache[o]}return i._containerPointToPoint(e,void 0,trt)}))},n.prototype._splitTiles=function(e,n,i,o,s,a,h,l,c,A){var f=this._getTileConfig().tileSystem.scale.y,d=this.getMap().getGLScale(s),p=lrt.set(2*h.xmin,f<0?2*h.ymax:2*h.ymin),g=h.getWidth(),v=h.getHeight(),w=2*o.idx,C=2*o.idy,P=2*o.x,T=2*o.y,S=this._checkAndAddTile(e,i,w,C,P,T,s,a,0,0,g,v,p,d,A);S&&n.push(S),(S=this._checkAndAddTile(e,i,w,C,P,T,s,a,0,1,g,v,p,d,A))&&n.push(S),(S=this._checkAndAddTile(e,i,w,C,P,T,s,a,1,0,g,v,p,d,A))&&n.push(S),(S=this._checkAndAddTile(e,i,w,C,P,T,s,a,1,1,g,v,p,d,A))&&n.push(S)},n.prototype._checkAndAddTile=function(e,n,i,o,s,a,h,l,c,A,f,d,p,g,v){var w=this._getTileId(i+c,o+A,h);if(this._visitedTiles&&this._visitedTiles.has(w))return null;var C=v[h];C||(C=v[h]=this._getTileOffset(h));var P=this._getTileConfig().tileSystem.scale.y,T=new v9(p.x+c*f,p.y+P*A*d,p.x+(c+1)*f,p.y+P*(A+1)*d);if(/*!rightVisitEnd && */!this._isSplittedTileInExtent(e,T,C,g))return null;var S=l/2,I=n&&n.isTileCachedOrLoading(w);return I?I.info:this.createTileNode(s+c,a+A,h,i+c,i+a,S,0,null,T,w)},n.prototype._getTileOffset=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var i=this.options.offset;return O2(i)&&(i=i.call.apply(i,v5([this],y5(e),!1))),T2(i)&&(i=[i,i]),i||[0,0]},n.prototype.getTileId=function(e,n,i,o){return this._getTileId(e,n,i,o)},n.prototype._getTileId=function(e,n,i,o){return"".concat(o||this.getId(),"_").concat(e,"_").concat(n,"_").concat(i)},n.prototype._project=function(e,n){if(this._hasOwnSR){var i=this.getMap().getProjection();return this.getSpatialReference().getProjection().project(i.unproject(e,n),n)}return e},n.prototype._unproject=function(e,n){if(this._hasOwnSR){var i=this.getMap(),o=this.getSpatialReference(),s=i.getProjection(),a=o.getProjection();return s.project(a.unproject(e,n),n)}return e},n.prototype._initTileConfig=function(){var e=this.getMap(),n=this.getTileSize(),i=this.getSpatialReference(),o=i.getProjection(),s=i.getFullExtent();this._defaultTileConfig=new qit(e,Vit.getDefault(o),s,n),this.options.hasOwnProperty("tileSystem")&&(this._tileConfig=new qit(e,this.options.tileSystem,s,n)),delete this._rootNodes,delete this._tileFullExtent,delete this._disablePyramid},n.prototype._getTileConfig=function(){return this._defaultTileConfig||this._initTileConfig(),this._tileConfig||this._defaultTileConfig},n.prototype._bindMap=function(n){return this._onSpatialReferenceChange(),e.prototype._bindMap.apply(this,arguments)},n.prototype._isTileInExtent=function(e,n,i,o){var s,a=this.getMap();if(e!==a.projViewMatrix){var h=n.getCenter(urt)._sub(i[0],i[1])._multi(o);Gnt(drt,h.x,h.y,0);var l=function(e,n,i){var o=n[0],s=n[1],a=n[2],h=i[3]*o+i[7]*s+i[11]*a+i[15];return e[0]=(i[0]*o+i[4]*s+i[8]*a+i[12])/(h=h||1),e[1]=(i[1]*o+i[5]*s+i[9]*a+i[13])/h,e[2]=(i[2]*o+i[6]*s+i[10]*a+i[14])/h,e}(drt,drt,a.projViewMatrix);s=l[1]<0?a.projViewMatrix:e}else s=a.projViewMatrix;return crt[0][0]=(n.xmin-i[0])*o,crt[0][1]=(n.ymin-i[1])*o,crt[1][0]=(n.xmax-i[0])*o,crt[1][1]=(n.ymax-i[1])*o,Yit(s,crt)},n.prototype._isSplittedTileInExtent=function(e,n,i,o){var s=this.getMap();return crt[0][0]=(n.xmin-i[0])*o,crt[0][1]=(n.ymin-i[1])*o,crt[1][0]=(n.xmax-i[0])*o,crt[1][1]=(n.ymax-i[1])*o,Yit(s.projViewMatrix,crt)},n.prototype.getEvents=function(){return{spatialreferencechange:this._onSpatialReferenceChange}},n.prototype._onSpatialReferenceChange=function(){delete this._tileConfig,delete this._defaultTileConfig,delete this._sr,delete this._srMinZoom,delete this._hasOwnSR,delete this._rootNodes,this.tileInfoCache&&this.tileInfoCache.reset();var e=this.getRenderer();e&&e.clear()},n.prototype.getPolygonOffsetCount=function(){return 2},n.prototype.getPolygonOffset=function(){return this._polygonOffset||0},n.prototype.setPolygonOffset=function(e){return this._polygonOffset=e,this},n.prototype.getRenderer=function(){return e.prototype.getRenderer.call(this)},n.prototype._getTileBBox=function(e){var n=this.getMap();if(n){var i=e.extent2d;if(i){var o=e.res,s=i.xmax,a=i.ymax,h=new w5(i.xmin,i.ymin),l=new w5(s,a),c=n.pointAtResToCoordinate(h,o,ort),A=n.pointAtResToCoordinate(l,o,srt);return[c.x,c.y,A.x,A.y]}}},n.prototype._tileInMask=function(e){var n=this.getMask();if(!n)return!0;var i=n.type;if(!i||-1===i.indexOf("Polygon"))return!0;var o=this._maskGeoJSON;if(!o||!o.geometry)return!0;var s=o.geometry,a=s.type;if(!s.coordinates||!a)return!0;if(-1===a.indexOf("Polygon"))return!0;if(!o.bbox){var h=n.getExtent();if(!h)return!0;o.bbox=[h.xmin,h.ymin,h.xmax,h.ymax]}var l=this._getTileBBox(e);return!l||function(e,n){var i=n.bbox;if(!i)return console.error("maskGeoJSON bbox is null:",n),!1;if((s=i)[2]<(a=e)[0]||s[1]>a[3]||s[0]>a[2]||s[3]<a[1])return!1;var o=n.geometry;if(!o)return console.error("maskGeoJSON is error,not find geometry.",n),!1;var s,a,h=o.coordinates;"Polygon"===o.type&&(h=[h]);for(var l=0,c=h.length;l<c;l++){var A=d8.polygon(h[l][0],e);if(A.length>0){for(var f=1/0,d=-1/0,p=1/0,g=-1/0,v=0,w=A.length;v<w;v++){var C=y5(A[v],2),P=C[0],T=C[1];f=Math.min(P,f),p=Math.min(T,p),d=Math.max(P,d),g=Math.max(T,g)}if(f!==d&&p!==g)return!0}}return!1}(l,this._maskGeoJSON)},n}(cet);function grt(e,n){return e.z-n.z}prt.registerJSONType("TileLayer"),prt.mergeOptions(irt);var mrt=new h3(256,256),yrt="show hide remove setzindex forcereloadstart";function vrt(e){return Array.isArray(e)||(e=[e]),e}var _rt=function(e){function n(n,i,o){var s=e.call(this,n,o)||this;return s.layers=i||[],s._checkChildren(),s.layerMap={},s._groupChildren=[],s}return p5(n,e),n.fromJSON=function(e){if(!e||"GroupTileLayer"!==e.type)return null;var i=e.layers.map((function(e){return cet.fromJSON(e)}));return new n(e.id,i,e.options)},n.prototype.getLayers=function(){return this.layers},n.prototype.addLayer=function(e){var n=this;void 0===e&&(e=[]),e=vrt(e);var i=this.layers.length;return e.forEach((function(e){e instanceof prt&&(-1!==n.layers.indexOf(e)||n.layerMap[e.getId()]||n.layers.push(e))})),i!==this.layers.length&&(this._sortLayers(),this._refresh(),this._renderLayers()),this},n.prototype.removeLayer=function(e){var n=this;void 0===e&&(e=[]),e=vrt(e);var i=this.layers.length;return e.forEach((function(e){if(e instanceof prt||(e=n.layerMap[e]),e instanceof prt){var i=n.layers.indexOf(e);i>=0&&(n.layers.splice(i,1),e._doRemove(),e.off(yrt,n._onLayerShowHide,n))}})),i!==this.layers.length&&(this._refresh(),this._renderLayers()),this},n.prototype.clearLayers=function(){var e=this;return this.layers.forEach((function(n){n._doRemove(),n.off(yrt,e._onLayerShowHide,e)})),this.layers=[],this._refresh(),this._renderLayers(),this},n.prototype.toJSON=function(){return{type:this.getJSONType(),id:this.getId(),layers:this.layers.map((function(e){return e.toJSON()})),options:this.config()}},n.prototype.getTileSize=function(e){var n=this.getLayer(e);return n?n.getTileSize():mrt},n.prototype.getTiles=function(e,n){for(var i=this.layers,o=[],s=0,a=0,h=i.length;a<h;a++){var l=i[a];if(l&&l.options.visible&&l.isVisible()&&l.getMap()){var c=l.getTiles(e,n||this);c&&0!==c.count&&(s+=c.count,E5(o,c.tileGrids))}}return{count:s,tileGrids:o}},n.prototype.onAdd=function(){this._sortLayers(),this._refresh(),e.prototype.onAdd.call(this)},n.prototype.onRemove=function(){var n=this;this.layers.forEach((function(e){e._doRemove(),e.off(yrt,n._onLayerShowHide,n)})),this.layerMap={},this._groupChildren=[],e.prototype.onRemove.call(this)},n.prototype.getLayer=function(e){return this.getChildLayer(e)},n.prototype.getChildLayer=function(e){var n=this.layerMap[e];if(n)return n;for(var i=0;i<this._groupChildren.length;i++){var o=this._groupChildren[i].getChildLayer(e);if(o)return o}return null},n.prototype._removeChildTileCache=function(e){if(!e)return this;var n,i=this.getRenderer();if(!i)return this;var o=e.getId(),s=function(){return n&&n.info&&n.info.layer===o};i.tileCache&&i.tileCache.keys().forEach((function(e){n=i.tileCache.get(e),s()&&i.tileCache.remove(e)}));var a=i.tilesInView||{};for(var h in a)n=a[h],s()&&delete a[h];var l=i.tilesLoading||{};for(var h in l)n=l[h],s()&&i.abortTileLoading(n.image,n.info);return this},n.prototype._onLayerShowHide=function(e){var n=e||{},i=n.type,o=n.target;"remove"===i&&o?(this.layers.splice(this.layers.indexOf(o),1),o._doRemove(),o.off(yrt,this._onLayerShowHide,this),this._refresh()):"setzindex"===i?this._sortLayers():"forcereloadstart"===i&&this._removeChildTileCache(o),this._renderLayers()},n.prototype._renderLayers=function(){var e=this.getRenderer();return e&&e.setToRedraw(),this},n.prototype._refresh=function(){var e=this,n=this.getMap();return this._groupChildren=[],this.layerMap={},this.layers.forEach((function(i){e.layerMap[i.getId()]=i,i.getChildLayer&&e._groupChildren.push(i),i.getMap()||i._bindMap(n),i.off(yrt,e._onLayerShowHide,e),i.on(yrt,e._onLayerShowHide,e)})),this},n.prototype.isVisible=function(){if(!e.prototype.isVisible.call(this))return!1;for(var n=this.layers,i=0,o=n.length;i<o;i++)if(n[i].isVisible())return!0;return!1},n.prototype._checkChildren=function(){var e=this,n={};this.layers.forEach((function(i){var o=i.getId();if(n[o])throw new Error("Duplicate child layer id (".concat(o,") in the GroupTileLayer (").concat(e.getId(),")"));n[o]=1}))},n.prototype._sortLayers=function(){this.layers.sort((function(e,n){return e.options.zIndex-n.options.zIndex}))},n}(prt);_rt.registerJSONType("GroupTileLayer"),_rt.mergeOptions({urlTemplate:"",maxCacheSize:1024});var xrt,brt={urlTemplate:"",crs:null,uppercase:!1,detectRetina:!1},wrt={service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},Crt=function(e){function n(n,i){var o=e.call(this,n)||this;return xrt||(xrt=P2({},o.options)),o.wmsParams=P2({},wrt),o.setOptions(i),o.setZIndex(i.zIndex),f5.proxy||o._optionsHook(i),o}return p5(n,e),n.prototype._optionsHook=function(e){for(var n in void 0===e&&(e={}),e)"tileSize"===n&&(this._tileSize=null),n in xrt||(this.wmsParams[n]=e[n]);var i=this.getTileSize();return this.wmsParams.width=i.width,this.wmsParams.height=i.height,this._wmsVersion=parseFloat(this.wmsParams.version),this},n.prototype.onAdd=function(){var n=this.getMap().getDevicePixelRatio(),i=brt.detectRetina?n:1;this.wmsParams.width*=i,this.wmsParams.height*=i;var o=this.options.crs||this.getMap().getProjection().code;this.wmsParams[this._wmsVersion>=1.3?"crs":"srs"]=o,e.prototype.onAdd.call(this)},n.prototype.getTileUrl=function(n,i,o){var s=this.getSpatialReference().getResolution(o),a=this._getTileConfig().getTilePrjExtent(n,i,s),h=a.getMax(),l=a.getMin(),c=(this._wmsVersion>=1.3&&("EPSG:4326"===this.wmsParams.crs||"EPSG:4490"===this.wmsParams.crs)?[l.y,l.x,h.y,h.x]:[l.x,l.y,h.x,h.y]).join(","),A=e.prototype.getTileUrl.call(this,n,i,o);return A+function(e,n,i){var o=[];for(var s in e)o.push(encodeURIComponent(i?s.toUpperCase():s)+"="+encodeURIComponent(e[s]));return(n&&-1!==n.indexOf("?")?"&":"?")+o.join("&")}(this.wmsParams,A,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+c},n.prototype.toJSON=function(){return{type:"WMSTileLayer",id:this.getId(),options:this.config()}},n.fromJSON=function(e){return e&&"WMSTileLayer"===e.type?new n(e.id,e.options):null},n}(prt);Crt.registerJSONType("WMSTileLayer"),Crt.mergeOptions(brt);var Prt=function(e){function n(n,i){var o=e.call(this,n,i)||this;return o.options.hasOwnProperty("forceRenderOnMoving")||(o.options.forceRenderOnMoving=!1),o}return p5(n,e),n.prototype.drawTile=function(){},n.prototype.toJSON=function(){return{type:"CanvasTileLayer",id:this.getId(),options:this.config()}},n.fromJSON=function(e){return e&&"CanvasTileLayer"===e.type?new n(e.id,e.options):null},n}(prt);function Mrt(e,n,i){var o=e.createShader(n);if(e.shaderSource(o,i),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS)){var s=e.getShaderInfoLog(o);throw e.deleteShader(o),new Error("Failed to compile shader: "+s)}return o}function Trt(e,n,i){var o=Mrt(e,e.VERTEX_SHADER,n),s=Mrt(e,e.FRAGMENT_SHADER,i);if(!o||!s)return null;var a=e.createProgram();return a?(e.attachShader(a,o),e.attachShader(a,s),e.linkProgram(a),{program:a,vertexShader:o,fragmentShader:s}):null}function Srt(e,n,i){if(Array.isArray(i[0])){for(var o=Float32Array.BYTES_PER_ELEMENT,s=0,a=0;a<i.length;a++)s+=i[a][1]||0;var h=0;for(a=0;a<i.length;a++){if((l=e.getAttribLocation(n,i[a][0]))<0)throw new Error("Failed to get the storage location of "+i[a][0]);e.vertexAttribPointer(l,i[a][1],e[i[a][2]||"FLOAT"],!1,o*s,o*h),h+=i[a][1]||0,e.enableVertexAttribArray(l)}}else{var l=e.getAttribLocation(n,i[0]);e.vertexAttribPointer(l,i[1],e[i[2]||"FLOAT"],!1,0,0),e.enableVertexAttribArray(l)}}Prt.registerJSONType("CanvasTileLayer");var Irt={never:512,"<":513,"=":514,"<=":515,">":516,"!=":517,">=":518,always:519};var Ert=[1,1,1,1],Ort=new Float32Array(8),Rrt=new Int16Array(8),Drt="\n        attribute vec2 a_position;\n\n        attribute vec2 a_texCoord;\n\n        uniform mat4 u_matrix;\n\n        varying vec2 v_texCoord;\n\n        void main() {\n            gl_Position = u_matrix * vec4(a_position, 0., 1.);\n\n            v_texCoord = a_texCoord;\n        }\n    ",krt="\n        precision mediump float;\n\n        uniform sampler2D u_image;\n\n        uniform float u_opacity;\n        uniform float u_debug_line;\n        uniform vec4 u_base_color;\n        uniform float u_alpha_test;\n        varying vec2 v_texCoord;\n\n        void main() {\n            if (u_debug_line == 1.) {\n                gl_FragColor = vec4(0., 1., 0., 1.);\n            } else {\n                gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;\n            }\n            gl_FragColor *= u_base_color;\n            if (gl_FragColor.a < u_alpha_test) {\n                discard;\n            }\n        }\n    ",Lrt=["",0],Frt=[0,0,0],Nrt=new Array(16),zrt=new w5(20,20),Brt=function(e){var n=function(e){function n(){var n=e.apply(this,v5([],y5(arguments),!1))||this;return n._layerAlt=0,n._layerAltitude=0,n}return p5(n,e),n.prototype.drawGLImage=function(e,n,i,o,s,a,h,l,c){this.gl.program!==this.program&&this.useProgram(this.program);var A=this.gl;if(this.loadTexture(e),this.canvas.gl&&this.canvas.gl.wrap){var f=this.layer&&this.layer.options.opacity;M2(f)&&(f=1),h*=f}Frt[0]=n||0,Frt[1]=i||0,Frt[2]=0;var d=this.layer;if(d){var p=d.options.altitude,g=T2(p);if(g||(this._layerAlt=0),this._layerAltitude!==p&&g){var v=d.getMap();if(v){var w=v.altitudeToPoint(p,v.getGLRes());this._layerAltitude=p,this._layerAlt=w}}}Frt[2]=this._layerAlt||0;var C=a8(Nrt);i8(C,C,Frt),r8(C,C,[a,a,1]),o8(C,this.getMap().projViewMatrix,C),A.uniformMatrix4fv(this.program.u_matrix,!1,C),A.uniform1f(this.program.u_opacity,h),A.uniform1f(this.program.u_debug_line,0),A.uniform4fv(this.program.u_base_color,c||Ert),A.uniform1f(this.program.u_alpha_test,this.layer.options.alphaTest||0);var P=e.glBuffer;!P||P.width===o&&P.height===s||(this.saveImageBuffer(P),delete e.glBuffer),e.glBuffer?A.bindBuffer(A.ARRAY_BUFFER,P):e.glBuffer=this.bufferTileData(0,0,o,s),Lrt[0]="a_position",Lrt[1]=2,Lrt[2]=e.glBuffer.type,this.enableVertexAttrib(Lrt),A.bindBuffer(A.ARRAY_BUFFER,this.texBuffer),Lrt[0]="a_texCoord",Lrt[1]=2,Lrt[2]="UNSIGNED_BYTE",this.enableVertexAttrib(Lrt),A.drawArrays(A.TRIANGLE_STRIP,0,4),l&&this.drawDebug(C,0,0,o,s,l)},n.prototype.drawDebug=function(e,n,i,o,s,a){var h=this.gl;h.disable(h.DEPTH_TEST),h.bindBuffer(h.ARRAY_BUFFER,this._debugBuffer),this.enableVertexAttrib(["a_position",2,"FLOAT"]),h.bufferData(h.ARRAY_BUFFER,new Float32Array([n,i,n+o,i,n+o,i-s,n,i-s,n,i]),h.DYNAMIC_DRAW),h.uniformMatrix4fv(this.program.u_matrix,!1,e),h.uniform1f(this.program.u_opacity,1),h.uniform1f(this.program.u_debug_line,1),h.uniform4fv(this.program.u_base_color,Ert),h.uniform1f(this.program.u_alpha_test,this.layer.options.alphaTest||0),h.drawArrays(h.LINE_STRIP,0,5);var l=this._debugInfoCanvas;if(!l){var c=this.getMap().getDevicePixelRatio()>1?2:1;(l=this._debugInfoCanvas=document.createElement("canvas")).width=256*c,l.height=32*c;var A=l.getContext("2d");A.font="20px monospace",A.scale(c,c)}var f=l.getContext("2d");f.clearRect(0,0,l.width,l.height),u6.fillText(f,a,zrt,this.layer.options.debugOutline),this.loadTexture(l),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,l);var d=n+(o=256),p=i-s+32,g=i-s;h.bufferData(h.ARRAY_BUFFER,this.set8(n,p,n,g,d,p,d,g),h.DYNAMIC_DRAW),h.uniform1f(this.program.u_debug_line,0),h.bindBuffer(h.ARRAY_BUFFER,this.texBuffer),this.enableVertexAttrib(["a_texCoord",2,"UNSIGNED_BYTE"]),h.drawArrays(h.TRIANGLE_STRIP,0,4),h.enable(h.DEPTH_TEST)},n.prototype.bufferTileData=function(e,n,i,o,s){var a,h=e,l=e+i,c=n,A=n-o;a=S2(h)&&S2(l)&&S2(c)&&S2(A)?this.set8Int(h,c,h,A,l,c,l,A):this.set8(h,c,h,A,l,c,l,A);var f=this.loadImageBuffer(a,s);return f.width=i,f.height=o,f.type=a instanceof Int16Array?"SHORT":"FLOAT",f},n.prototype.createCanvas2=function(){this.canvas2=u6.createCanvas(this.canvas.width,this.canvas.height)},n.prototype.createGLContext=function(){this.gl=this.canvas.gl&&this.canvas.gl.wrap?this.canvas.gl.wrap():function(e,n){for(var i={alpha:!0,stencil:!0,preserveDrawingBuffer:!0,antialias:!1},o=["webgl","experimental-webgl"],s=null,a=0;a<o.length;++a){try{s=e.getContext(o[a],n||i)}catch(e){}if(s)break}return s}(this.canvas2||this.canvas,this.layer.options.glOptions);var e=this.gl;e.clearColor(0,0,0,0),e.enable(e.DEPTH_TEST),e.enable(e.STENCIL_TEST),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),this.program=this.createProgram(Drt,this.layer.options.fragmentShader||krt),this._debugBuffer=this.createBuffer(),this.useProgram(this.program),this.texBuffer=this.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.texBuffer),this.enableVertexAttrib(["a_texCoord",2,"UNSIGNED_BYTE"]),e.bufferData(e.ARRAY_BUFFER,new Uint8Array([0,0,0,1,1,0,1,1]),e.STATIC_DRAW),this.enableSampler("u_image"),e.activeTexture(e.TEXTURE0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0)},n.prototype.resizeGLCanvas=function(){this.gl&&this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.canvas2&&(this.canvas2.width===this.canvas.width&&this.canvas2.height===this.canvas.height||(this.canvas2.width=this.canvas.width,this.canvas2.height=this.canvas.height))},n.prototype.clearGLCanvas=function(){this.gl&&(this.gl.clearStencil(255),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT)),this.gl.wrap||this.gl.clear(this.gl.DEPTH_BUFFER_BIT)},n.prototype.disposeImage=function(e){e&&(e.texture&&this.saveTexture(e.texture),e.glBuffer&&this.saveImageBuffer(e.glBuffer),delete e.texture,delete e.glBuffer)},n.prototype._createTexture=function(e){var n=this.gl,i=this.getTexture()||n.createTexture();n.bindTexture(n.TEXTURE_2D,i),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);var o=this.layer.options.mipmapTexture;return!o||Hrt(e.width)&&Hrt(e.height)||(e=function(e){if(Hrt(e.width)&&Hrt(e.height))return e;var n=e.width,i=e.height;Hrt(n)||(n=jrt(n));Hrt(i)||(i=jrt(i));var o=document.createElement("canvas");o.width=n,o.height=i;var s=o.getContext("2d");return s.imageSmoothingEnabled=!1,s.drawImage(e,0,0,n,i),o}(e)),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e),o&&n.generateMipmap(n.TEXTURE_2D),i},n.prototype.getTexture=function(){this._textures||(this._textures=[]);var e=this._textures;return e&&e.length>0?e.pop():null},n.prototype.saveTexture=function(e){this._textures.push(e)},n.prototype.loadTexture=function(e){var n=this.getMap(),i=this.gl,o=e.texture;return o||(o=this._createTexture(e),e.texture=o),i.bindTexture(i.TEXTURE_2D,o),this.layer.options.mipmapTexture&&(n.isMoving()&&n.getRenderer().isViewChanged()?i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR_MIPMAP_LINEAR):i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR)),o},n.prototype.getImageBuffer=function(){this._imageBuffers||(this._imageBuffers=[]);var e=this._imageBuffers;return e&&e.length>0?e.pop():null},n.prototype.saveImageBuffer=function(e){this._imageBuffers||(this._imageBuffers=[]),this._imageBuffers.push(e)},n.prototype.loadImageBuffer=function(e,n){var i=this.gl,o=n||this.createImageBuffer();return i.bindBuffer(i.ARRAY_BUFFER,o),i.bufferData(i.ARRAY_BUFFER,e,i.STATIC_DRAW),o},n.prototype.createImageBuffer=function(){return this.getImageBuffer()||this.createBuffer()},n.prototype.removeGLCanvas=function(){var e=this.gl;if(e){if(this._debugBuffer&&(e.deleteBuffer(this._debugBuffer),delete this._debugBuffer),this._buffers&&(this._buffers.forEach((function(n){e.deleteBuffer(n)})),delete this._buffers),this._textures&&(this._textures.forEach((function(n){return e.deleteTexture(n)})),delete this._textures),this._debugInfoCanvas){var n=this._debugInfoCanvas.texture;n&&e.deleteTexture(n),delete this._debugInfoCanvas.texture,delete this._debugInfoCanvas}var i=e.program;e.deleteShader(i.fragmentShader),e.deleteShader(i.vertexShader),e.deleteProgram(i),delete this.gl,delete this.canvas2}},n.prototype.createBuffer=function(){var e=this.gl.createBuffer();if(!e)throw new Error("Failed to create the buffer object");return this._buffers||(this._buffers=[]),this._buffers.push(e),e},n.prototype.enableVertexAttrib=function(e){Srt(this.gl,this.gl.program,e)},n.prototype.createProgram=function(e,n){for(var i=this.gl,o=Trt(i,e,n),s=o.program,a=o.vertexShader,h=o.fragmentShader,l=i.getProgramParameter(s,35718),c=[],A=0;A<l;++A){var f=i.getActiveUniform(s,A);c.push(f.name)}return s.vertexShader=a,s.fragmentShader=h,this._initUniforms(s,c),s},n.prototype.useProgram=function(e){var n=this.gl;return n.useProgram(e),n.program=e,this},n.prototype.enableSampler=function(e,n){var i=this.gl,o=this._getUniform(i.program,e);return n||(n=0),i.uniform1i(o,n),o},n.prototype._initUniforms=function(e,n){for(var i=0;i<n.length;i++){var o=n[i],s=n[i],a=o.indexOf("[");a>=0&&(o=o.substring(0,a),b2||(s=s.substring(0,a))),e[o]=this._getUniform(e,s)}},n.prototype._getUniform=function(e,n){var i=this.gl.getUniformLocation(e,n);if(!i)throw new Error("Failed to get the storage location of "+n);return i},n.prototype.set8=function(e,n,i,o,s,a,h,l){var c=Ort;return c[0]=e,c[1]=n,c[2]=i,c[3]=o,c[4]=s,c[5]=a,c[6]=h,c[7]=l,c},n.prototype.set8Int=function(e,n,i,o,s,a,h,l){var c=Rrt;return c[0]=e,c[1]=n,c[2]=i,c[3]=o,c[4]=s,c[5]=a,c[6]=h,c[7]=l,c},n}(e);return n};function Hrt(e){return!(e&e-1)&&0!==e}function jrt(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}var Urt={renderer:f5.webgl?"gl":"canvas",crossOrigin:null,alphaTest:!1,depthMask:!0,depthFunc:"<="},Grt=new w5(0,0),Vrt=function(e){function n(n,i,o){var s=this;return!i||Array.isArray(i)||i.url||(o=i,i=null),(s=e.call(this,n,o)||this)._images=i,s}return p5(n,e),n.prototype.onAdd=function(){this._prepareImages(this._images)},n.prototype.setImages=function(e){return this._images=e,this._prepareImages(e),this},n.prototype.getImages=function(){return this._images},n.prototype._prepareImages=function(e){e=e||[],Array.isArray(e)||(e=[e]);var n=this.getMap(),i=n.getGLRes();this._imageData=e.map((function(e){var o=new y9(e.extent);return P2({},e,{extent:o,extent2d:o.convertTo((function(e){return n.coordToPointAtRes(e,i)}))})})),this._images=e;var o=this.getRenderer();o&&o.refreshImages()},n.prototype.getRenderer=function(){return e.prototype.getRenderer.call(this)},n}(cet);Vrt.mergeOptions(Urt);var Wrt,qrt=[],Zrt=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype.isDrawable=function(){return!this.getMap().getPitch()||(console&&console.warn("ImageLayer with canvas renderer can't be pitched, use gl renderer ('renderer' : 'gl') instead."),!1)},n.prototype.checkResources=function(){var e=this;if(this._imageLoaded)return qrt;var n=this.layer._imageData.map((function(e){return[e.url,null,null]}));if(this.resources){var i=[],o=new b7;n.forEach((function(n){if(e.resources.isResourceLoaded(n)){var s=e.resources.getImage(n);o.addResource(n,s)}else i.push(n)})),this.resources.forEach((function(n,i){o.isResourceLoaded(n)||e.retireImage(i.image)})),this.resources=o,n=i}return this._imageLoaded=!0,n},n.prototype.retireImage=function(e){e.close&&e.close()},n.prototype.refreshImages=function(){this._imageLoaded=!1,this.setToRedraw()},n.prototype.draw=function(e,n){this.isDrawable()&&(this.prepareCanvas(),this._painted=!1,this._drawImages(e,n),this.completeRender())},n.prototype._drawImages=function(e,n){var i=this.layer._imageData,o=this.getMap(),s=o.get2DExtentAtRes(o.getGLRes());if(i&&i.length)for(var a=0;a<i.length;a++){var h=i[a].extent2d,l=this.resources&&this.resources.getImage(i[a].url);l&&s.intersects(h)&&(this._painted=!0,this._drawImage(l,h,i[a].opacity||1))}},n.prototype._drawImage=function(e,n,i){var o=0,s=this.context;i<1&&(o=s.globalAlpha,s.globalAlpha=i);var a=this.getMap(),h=Grt.set(n.xmin,n.ymax),l=a._pointAtResToContainerPoint(h,a.getGLRes()),c=l.x,A=l.y,f=a.getBearing();f&&(s.save(),s.translate(c,A),f&&s.rotate(-f*Math.PI/180),c=A=0);var d=a.getGLScale();s.drawImage(e,c,A,n.getWidth()/d,n.getHeight()/d),f&&s.restore(),o&&(s.globalAlpha=o)},n.prototype.drawOnInteracting=function(e,n,i){this.draw()},n}(x7),Qrt=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype.drawOnInteracting=function(e,n,i){this.draw(n,i)},n.prototype._prepareGLContext=function(){var e=this.gl;e&&(e.disable(e.STENCIL_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.enable(e.DEPTH_TEST),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.depthFunc(function(e){return Irt[e]}(this.layer.options.depthFunc)),e.depthMask(!!this.layer.options.depthMask))},n.prototype._drawImages=function(n,i){var o,s=this.gl;if(i&&i.renderTarget&&(o=i.renderTarget.fbo)){var a=i.renderTarget.getFramebuffer(o);s.bindFramebuffer(s.FRAMEBUFFER,a)}(this._prepareGLContext(),e.prototype._drawImages.call(this),i&&i.renderTarget)&&((o=i.renderTarget.fbo)&&s.bindFramebuffer(s.FRAMEBUFFER,null))},n.prototype.isDrawable=function(){return!0},n.prototype._drawImage=function(e,n,i){this.drawGLImage(e,n.xmin,n.ymax,n.getWidth(),n.getHeight(),1,i)},n.prototype.createContext=function(){this.createGLContext()},n.prototype.resizeCanvas=function(n){this.canvas&&(e.prototype.resizeCanvas.call(this,n),this.resizeGLCanvas())},n.prototype.clearCanvas=function(){this.canvas&&(e.prototype.clearCanvas.call(this),this.clearGLCanvas())},n.prototype.retireImage=function(e){e.close&&e.close(),this.disposeImage(e)},n.prototype.onRemove=function(){this.removeGLCanvas(),e.prototype.onRemove.call(this)},n}(Brt(Zrt));Vrt.registerRenderer("canvas",Zrt),Vrt.registerRenderer("gl",Qrt),function(e){e[e.never=0]="never",e[e["<"]=1]="<",e[e["="]=2]="=",e[e["<="]=3]="<=",e[e[" >"]=4]=" >",e[e["!="]=5]="!=",e[e[">="]=6]=">=",e[e.always=7]="always"}(Wrt||(Wrt={}));var Xrt=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype.getPrepareParams=function(){return[]},n.prototype.getDrawParams=function(){return[]},n.prototype.onCanvasCreate=function(){this.canvas&&this.layer.options.doubleBuffer&&(this.buffer=u6.createCanvas(this.canvas.width,this.canvas.height,this.getMap().CanvasClass))},n.prototype.needToRedraw=function(){return!!this.layer.options.animation||!(this.getMap().isInteracting()&&!this.layer.drawOnInteracting)&&e.prototype.needToRedraw.call(this)},n.prototype.draw=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.prepareCanvas(),this.prepareDrawContext(),this._drawLayer.apply(this,v5([],y5(e),!1))},n.prototype.drawOnInteracting=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._drawLayerOnInteracting.apply(this,v5([],y5(e),!1))},n.prototype.getCanvasImage=function(){var n=e.prototype.getCanvasImage.call(this);if(n&&n.image&&this.layer.options.doubleBuffer){var i=n.image;this.buffer.width===i.width&&this.buffer.height===i.height||(this.buffer.width=i.width,this.buffer.height=i.height);var o=this.buffer.getContext("2d"),s=this.layer.doubleBuffer(o,this.context);(void 0===s||s)&&(u6.image(o,i,0,0),n.image=this.buffer)}return n},n.prototype.remove=function(){return delete this._drawContext,e.prototype.remove.call(this)},n.prototype.onZoomStart=function(n){this.layer.onZoomStart(n),e.prototype.onZoomStart.call(this,n)},n.prototype.onZooming=function(n){this.layer.onZooming(n),e.prototype.onZooming.call(this,n)},n.prototype.onZoomEnd=function(n){this.layer.onZoomEnd(n),e.prototype.onZoomEnd.call(this,n)},n.prototype.onMoveStart=function(n){this.layer.onMoveStart(n),e.prototype.onMoveStart.call(this,n)},n.prototype.onMoving=function(n){this.layer.onMoving(n),e.prototype.onMoving.call(this,n)},n.prototype.onMoveEnd=function(n){this.layer.onMoveEnd(n),e.prototype.onMoveEnd.call(this,n)},n.prototype.onResize=function(n){this.layer.onResize(n),e.prototype.onResize.call(this,n)},n.prototype.prepareDrawContext=function(){var e;if(!this._predrawed){var n=Yrt(this.getPrepareParams());this._drawContext=(e=this.layer).prepareToDraw.apply(e,v5([this.context],y5(n),!1)),this._drawContext||(this._drawContext=[]),Array.isArray(this._drawContext)||(this._drawContext=[this._drawContext]),this._predrawed=!0}},n.prototype._prepareDrawParams=function(){if(!this.getMap())return null;var e=this.getViewExtent();if(e.maskExtent&&!e.extent.intersects(e.maskExtent))return this.completeRender(),null;var n=[this.context,e],i=Yrt(this.getDrawParams());return v5(v5(v5([],y5(n),!1),y5(i),!1),y5(this._drawContext),!1)},n.prototype._drawLayer=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var i=this._prepareDrawParams();i&&(this.layer.draw.apply(this.layer,i.concat(e)),this.completeRender())},n.prototype._drawLayerOnInteracting=function(){for(var e,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];if(this.layer.drawOnInteracting){var o=this._prepareDrawParams();o&&((e=this.layer).drawOnInteracting.apply(e,v5(v5([],y5(o),!1),y5(n),!1)),this.completeRender())}},n}(x7);function Yrt(e){return e||(e=[]),Array.isArray(e)||(e=[e]),e}var Jrt=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype.isCanvasRender=function(){return!0},n.prototype.prepareToDraw=function(){},n.prototype.draw=function(){},n.prototype.redraw=function(){return this._getRenderer()&&this._getRenderer().setToRedraw(),this},n.prototype.play=function(){return this.config("animation",!0),this},n.prototype.pause=function(){return this.config("animation",!1),this},n.prototype.isPlaying=function(){return this.options.animation},n.prototype.clearCanvas=function(){return this._getRenderer()&&this._getRenderer().clearCanvas(),this},n.prototype.requestMapToRender=function(){var e=this._getRenderer();return e&&e.requestMapToRender&&e.requestMapToRender(),this},n.prototype.completeRender=function(){return this._getRenderer()&&this._getRenderer().completeRender(),this},n.prototype.onCanvasCreate=function(){return this},n.prototype.onZoomStart=function(){},n.prototype.onZooming=function(){},n.prototype.onZoomEnd=function(){},n.prototype.onMoveStart=function(){},n.prototype.onMoving=function(){},n.prototype.onMoveEnd=function(){},n.prototype.onResize=function(){},n.prototype.doubleBuffer=function(e){return e.clearRect(0,0,e.canvas.width,e.canvas.height),this},n.prototype._getRenderer=function(){return e.prototype._getRenderer.call(this)},n}(cet);Jrt.mergeOptions({doubleBuffer:!1,animation:!1}),Jrt.registerRenderer("canvas",Xrt);var Krt=new w5(0,0),$rt=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype.getParticles=function(e){},n.prototype.draw=function(e,n){var i=this.getParticles(C2());if(i&&0!==i.length){var o=this.getMap(),s=n.extent;n.maskExtent&&(s=n.extent.intersection(n.maskExtent)),s=s.convertTo((function(e){return o._pointToContainerPoint(e,void 0,0,Krt)}));for(var a=2*Math.PI,h=0,l=i.length;h<l;h++){var c=i[h].point;if(s.contains(c)){var A=i[h].color||this.options.lineColor||"#fff",f=i[h].r;e.fillStyle!==A&&(e.fillStyle=A),f<=2?e.fillRect(c.x-f/2,c.y-f/2,f,f):(e.beginPath(),e.arc(c.x,c.y,f/2,0,a),e.fill())}}this._fillCanvas(e)}else{this._getRenderer()&&(this._getRenderer()._shouldClear=!0)}},n.prototype._fillCanvas=function(e){var n=e.globalCompositeOperation;e.globalCompositeOperation="destination-out",e.fillStyle="rgba(0, 0, 0, "+1/(this.options.trail||30)+")",e.fillRect(0,0,e.canvas.width,e.canvas.height),e.globalCompositeOperation=n},n}(Jrt);$rt.mergeOptions({animation:!0}),$rt.registerRenderer("canvas",function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype.draw=function(){this.canvas&&this.layer.options.animation&&!this._shouldClear||(this.prepareCanvas(),this._shouldClear=!1),this.prepareDrawContext(),this._drawLayer()},n.prototype.drawOnInteracting=function(){this.draw(),this._shouldClear=!1},n.prototype.onSkipDrawOnInteracting=function(){this._shouldClear=!0},n}(Xrt));var tot,eot,not=new b7,iot=function(e){function n(n,i,o){var s=e.call(this,o)||this;s.target=n,n.once("remove",s.delete,s);var a=s.options.symbol,h=a.markerLineWidth||1;return s.w=a.markerWidth+h,s.h=a.markerHeight+h,s.opacity=M2(a.opacity)?1:a.opacity,s.map=i,s.events=o.events,s._fetchImage(),s.addTo(i),s}return p5(n,e),n.prototype.getCursor=function(){return this.options.cursor||"default"},n.prototype._fetchImage=function(){var e=this.map,n=this.options.symbol,i=n.markerFile;this.url=i||X4(n);var o=not.getImage(this.url);if(!o){var s=this.w,a=this.h;if(i)(o=new Image).onload=function(){var n=e.getRenderer();n&&n.setToRedraw()},o.src=this.url;else{var h=document.createElement("canvas");h.width=s,h.height=a,o=rtt(h.getContext("2d"),{x:s/2,y:a/2},n,not)}not.addResource([this.url,s,a],o)}not.login(this.url),this._img=o},n.prototype.setContainerPoint=function(e){this._point=e,this._point._sub(this.w/2,this.h/2)},n.prototype.getContainerPoint=function(){return this._point.add(this.w/2,this.h/2)},n.prototype.offset=function(e){this._point._add(e)},n.prototype.render=function(e){if(!this._img)return!1;var n=this.options.symbol,i=n.markerDx||0,o=n.markerDy||0,s=this.map,a=this._point,h=a.x,l=a.y,c=this.w,A=this.h;if(h+c>0&&h<s.width&&l+A>0&&l<s.height){var f=s.getDevicePixelRatio();return e.globalAlpha=this.opacity,e.drawImage(this._img,Math.round((h+i)*f),Math.round((l+o)*f),Math.round(c*f),Math.round(A*f)),!0}return!1},n.prototype.delete=function(){if(this.map){var e=this.map.getRenderer();e&&e.removeTopElement(this)}not.logout(this.url),this._dragger&&(this._dragger.disable(),delete this._dragger),delete this.map},n.prototype.hitTest=function(e){var n=this.options.symbol,i=this._point.x+(n.markerDx||0),o=this._point.y+(n.markerDy||0);return e.x>=i&&e.x<=i+this.w&&e.y>=o&&e.y<=o+this.h},n.prototype.addTo=function(e){this.map=e,e.getRenderer().addTopElement(this)},n.prototype.onEvent=function(e){this.fire(e.type,e)},n.prototype.mousedown=function(e){var n=this.options.cursor;n&&e.target.setCursor(n),this.onDragstart(e)},n.prototype.onDragstart=function(e){var n=e.containerPoint,i=e.target,o=i.getPanels().mapWrapper||i.getContainer(),s=this._dragger=new r9(o);s.on("dragging",this.onDragging,this).on("mouseup",this.onDragend,this).enable(),s.onMouseDown(e.domEvent),tot=n.x,eot=n.y,this.fire("dragstart",{containerPoint:n})},n.prototype.onDragging=function(e){if(this._dragger){var n=this.map,i=j3(e.domEvent,n.getContainer()),o={x:i.x-tot,y:i.y-eot},s=n.containerPointToCoord(new w5(tot,eot)),a=n.containerPointToCoord(i);tot=i.x,eot=i.y,this.offset(o),this.fire("dragging",{containerPoint:i,coordOffset:a._sub(s)})}},n.prototype.onDragend=function(e){if(this._dragger){var n=this.map;n.resetCursor();var i=j3(e.domEvent,n.getContainer());this.offset({x:i.x-tot,y:i.y-eot}),this._dragger.disable(),delete this._dragger,this.fire("dragend",{containerPoint:i})}},n.prototype.needCollision=function(){var e=this.target;return e&&e.options&&e.options.collision},n.prototype.getRenderBBOX=function(e){var n=this.target,i=this.map;if(!n||!n.options||!i)return null;var o=this.options.symbol,s=o.markerDx||0,a=o.markerDy||0,h=this._point,l=h.x,c=h.y,A=this.w,f=this.h;e=e||i.getDevicePixelRatio(),this.bbox=this.bbox||v8();var d=Math.round((l+s)*e),p=Math.round((c+a)*e),g=Math.round(A*e),v=Math.round(f*e);return this.bbox[0]=d,this.bbox[1]=p,this.bbox[2]=d+g,this.bbox[3]=p+v,P8(this.bbox,n.options.collisionBufferSize||0),this.bbox},n.prototype.setZIndex=function(e){this.options.zIndex=e},n}(m6(v6)),rot=function(){function e(e,n,i){this.target=e,e.once("remove",this.delete,this),this.map=n,this.options=i,this.addTo(n)}return e.prototype.setPoints=function(e){this.points=e;var n=e.map((function(e){return e.x})),i=e.map((function(e){return e.y}));this.xmin=Math.min.apply(Math,v5([],y5(n),!1)),this.xmax=Math.max.apply(Math,v5([],y5(n),!1)),this.ymin=Math.min.apply(Math,v5([],y5(i),!1)),this.ymax=Math.max.apply(Math,v5([],y5(i),!1))},e.prototype.hitTest=function(){return!1},e.prototype.render=function(e){var n=this.map;if(!(this.xmax<=0||this.xmin>=n.width||this.ymax<=0||this.ymin>=n.height)){var i=n.getDevicePixelRatio();e.lineWidth=1,e.strokeStyle="#000",e.globalAlpha=1,e.beginPath();var o=this.points;e.moveTo(a(o[0].x),a(o[0].y));for(var s=1;s<this.points.length;s++)e.lineTo(a(o[s].x),a(o[s].y));e.closePath(),e.stroke()}function a(e){return Math.round(e)*i+.5}},e.prototype.addTo=function(e){this.map=e,e.getRenderer().addTopElement(this)},e.prototype.delete=function(){if(this.map){var e=this.map.getRenderer();e&&e.removeTopElement(this)}},e}(),oot=t3+"_edit_stage_";function sot(e,n){return{markerType:e,markerFill:"#fff",markerLineColor:"#000",markerLineWidth:2,markerWidth:10,markerHeight:10,opacity:n}}var aot={fixAspectRatio:!1,symbol:null,removeVertexOn:"contextmenu",centerHandleSymbol:sot("ellipse",1),vertexHandleSymbol:sot("square",1),newVertexHandleSymbol:sot("square",.4),collision:!1,collisionBufferSize:0,vertexZIndex:0,newVertexZIndex:0},hot=function(e){function n(n,i){var o=e.call(this,i)||this;return o._geometry=n,o}return p5(n,e),n.prototype.getMap=function(){return this._geometry.getMap()},n.prototype.prepare=function(){var e=this.getMap();e&&(e.on("drawtopstart",this._refresh,this),this.options.symbol&&(this._originalSymbol=this._geometry.getSymbol(),this._geometry.setSymbol(this.options.symbol)),this._prepareEditStageLayer())},n.prototype._prepareEditStageLayer=function(){var e=this._geometry.getLayer();if("canvas"===e.options.renderer){var n=this.getMap(),i=T5(),o=oot+i+"_shadow";if(this._shadowLayer=n.getLayer(o),!this._shadowLayer)this._shadowLayer=new(0,e.constructor)(o),n.addLayer(this._shadowLayer)}},n.prototype.start=function(){if(this._geometry&&this._geometry.getMap()&&!this._geometry.editing){this.editing=!0,this.prepare();var e,n=this._geometry,i="canvas"===this._geometry.getLayer().options.renderer;this._geometryDraggble=n.options.draggable,i?(n.config("draggable",!1),(e=n.copy()).setSymbol(n._getInternalSymbol()),e.copyEventListeners(n),n._getParent()&&e.copyEventListeners(n._getParent()),e._setEventTarget(n),e.setId(null).config({draggable:!1}),this._shadow=e,n.hide()):n instanceof Vet&&n.config("draggable",!0),this._switchGeometryEvents("on"),(n instanceof Vet||n instanceof ant||n instanceof unt||n instanceof lnt)&&this._createOrRefreshOutline(),this._shadowLayer&&this._shadowLayer.bringToFront().addGeometry(e),n instanceof Vet?e&&(e.config("draggable",!0),e.on("dragend",this._onMarkerDragEnd,this)):this._createCenterHandle(),n instanceof Vet&&!1!==this.options.resize?this.createMarkerEditor():n instanceof ant?this.createCircleEditor():n instanceof unt||n instanceof lnt?this.createEllipseOrRectEditor():n instanceof cnt||(n instanceof jet||n instanceof qet)&&this.createPolygonEditor()}},n.prototype.stop=function(){delete this._history,delete this._historyPointer,delete this._editOutline,this._switchGeometryEvents("off"),this.getMap()?(this._geometry.config("draggable",this._geometryDraggble),this._shadow&&(delete this._shadow,delete this._geometryDraggble,this._geometry.show()),this._shadowLayer&&(this._shadowLayer.remove(),delete this._shadowLayer),this._refreshHooks=[],this.options.symbol&&(this._geometry.setSymbol(this._originalSymbol),delete this._originalSymbol),this.editing=!1,this.fire("remove")):this.fire("remove")},n.prototype.isEditing=function(){return!M2(this.editing)&&this.editing},n.prototype._getGeometryEvents=function(){return{symbolchange:this._onGeoSymbolChange,dragstart:this._onDragStart,dragend:this._onDragEnd,"positionchange shapechange":this._exeAndReset}},n.prototype._switchGeometryEvents=function(e){if(this._geometry){var n=this._getGeometryEvents();for(var i in n)this._geometry[e](i,n[i],this)}},n.prototype._onGeoSymbolChange=function(e){this._shadow&&this._shadow.setSymbol(e.target._getInternalSymbol())},n.prototype._onMarkerDragEnd=function(){this._update("setCoordinates",this._shadow.getCoordinates().toArray())},n.prototype._createOrRefreshOutline=function(){var e=this._geometry,n=this._editOutline;n||(this._editOutline=new rot(this,this.getMap()),this._addRefreshHook(this._createOrRefreshOutline));var i=this._editOutline.points;if(e instanceof Vet)this._editOutline.setPoints(e.getContainerExtent().toArray(i));else{var o=this.getMap();(i=e._getPrjExtent().toArray(i)).forEach((function(e){return o.prjToContainerPoint(e,null,e)})),this._editOutline.setPoints(i)}return n},n.prototype._createCenterHandle=function(){var e,n=this,i=this.getMap(),o=this.options.centerHandleSymbol,s=i.coordToContainerPoint(this._geometry.getCenter()),a=this.createHandle(s,{symbol:o,cursor:"move",onDown:function(){if(n._shadow){var i=Y4((e=n._shadow.copy())._getInternalSymbol(),.5);e.setSymbol(i).addTo(n._geometry.getLayer())}},onMove:function(i){var o=i.coordOffset;e?e.translate(o):n._geometry.translate(o)},onUp:function(){if(e){var i=e.getFirstCoordinate(),o=n._geometry.getFirstCoordinate(),s=i.sub(o);n._update("translate",s),e.remove()}}});this._addRefreshHook((function(){var e=n._geometry.getCenter();a.setContainerPoint(i.coordToContainerPoint(e))}))},n.prototype._createHandleInstance=function(e,n){var i=this.getMap(),o=w4(n.symbol,(function(){return[i.getZoom(),{"{bearing}":i.getBearing(),"{pitch}":i.getPitch(),"{zoom}":i.getZoom()}]})),s=new iot(this,i,{symbol:o,cursor:n.cursor,events:this.options.removeVertexOn});return s.setContainerPoint(e),s},n.prototype.createHandle=function(e,n){n||(n={});var i=this._createHandleInstance(e,n),o=this;return i.on("dragstart",(function(e){return this._updating=!0,n.onDown&&(n.onDown.call(o,e.containerPoint,e),this._geometry.fire("handledragstart")),!1}),this),i.on("dragging",(function(e){return o._hideContext(),n.onMove&&(n.onMove.call(o,e),this._geometry.fire("handledragging")),!1}),this),i.on("dragend",(function(e){return n.onUp&&(n.onUp.call(o,e),this._geometry.fire("handledragend")),this._updating=!1,!1}),this),n.onRefresh&&(i.refresh=n.onRefresh),i},n.prototype._createResizeHandles=function(e,n,i){var o=this,s=["nw-resize","n-resize","ne-resize","w-resize","e-resize","sw-resize","s-resize","se-resize"],a=[null,"y",null,"x","x",null,"y",null],h=this._geometry,l=h instanceof Vet;e||(e=[]);var c=this,A=[],f={},d=this.getMap(),p=this.options.vertexHandleSymbol,g=function(){for(var g=function(){if(l){var e=h.getContainerExtent();return[new w5(e.xmin,e.ymin),new w5((e.xmax+e.xmin)/2,e.ymin),new w5(e.xmax,e.ymin),new w5(e.xmin,(e.ymin+e.ymax)/2),new w5(e.xmax,(e.ymin+e.ymax)/2),new w5(e.xmin,e.ymax),new w5((e.xmax+e.xmin)/2,e.ymax),new w5(e.xmax,e.ymax)]}var n=h._getPrjExtent();return[new w5(n.xmin,n.ymax),new w5((n.xmax+n.xmin)/2,n.ymax),new w5(n.xmax,n.ymax),new w5(n.xmin,(n.ymax+n.ymin)/2),new w5(n.xmax,(n.ymax+n.ymin)/2),new w5(n.xmin,n.ymin),new w5((n.xmax+n.xmin)/2,n.ymin),new w5(n.xmax,n.ymin)]}(),v=function(v){if(Array.isArray(e)&&e.some((function(e){return e===v})))return"continue";var w,C=g[v],P=l?C:d.prjToContainerPoint(C);if(A.length<g.length-e.length){var T=o.createHandle(P,{symbol:p,cursor:s[v],axis:a[v],onMove:(w=v,function(e){c._updating=!0,n(e.containerPoint,w),h.fire("resizing")}),onUp:function(){c._updating=!1,i()}});f[v]=A.length,A.push(T)}else A[f[v]].setContainerPoint(P)},w=0;w<g.length;w++)v(w)};return g(),this._addRefreshHook(g),A},n.prototype.createMarkerEditor=function(){var e=this,n=this._shadow||this._geometry,i=this.getMap();if(n._canEdit()){this._history||this._recordHistory(g());var o=n._getInternalSymbol(),s=new w5(0,0);T2(o.markerDx)&&(s.x=o.markerDx),T2(o.markerDy)&&(s.y=o.markerDy);var a=null,h="middle",l="middle";if(Ptt.test(o)){var c=o.markerType;"pin"===c||"pie"===c||"bar"===c?(a=[5,6,7],h="bottom"):"rectangle"===c&&(a=[0,1,2,3,5],h="top",l="left")}else(ptt.test(o)||Mtt.test(o))&&(h="bottom",a=[5,6,7]);var A,f=[2,1,2,0,0,2,1,2];if(this.options.fixAspectRatio){var d=n.getSize();A=d.width/d.height}var p=this._createResizeHandles(a,(function(o,c){if(a&&a.indexOf(c)>=0){var d=i.containerPointToCoordinate(o.sub(s)),g=n.getCoordinates();d.x=g.x,n.setCoordinates(d),e._updateCoordFromShadow(!0),o=p[p.length-1-c].getContainerPoint()}var v=i.coordToContainerPoint(n.getCoordinates()).add(s),w=n._getInternalSymbol(),C=o.sub(v);"bottom"===h&&o.y>v.y&&(C.y=0);var P="middle"===h?2:1,T="left"===l?1:2,S=Math.abs(C.x)*T,I=Math.abs(C.y)*P;A&&(I=(S=Math.max(S,I*A))/A);var E=f[c];n instanceof vnt?((A||0===E||2===E)&&(n.setWidth(S),n!==e._geometry&&e._geometry.setWidth(S)),(A||1===E||2===E)&&(n.setHeight(I),n!==e._geometry&&e._geometry.setHeight(I))):((A||0===E||2===E)&&(w.markerWidth=Math.min(S,e._geometry.options.maxMarkerWidth||1/0)),(A||1===E||2===E)&&(w.markerHeight=Math.min(I,e._geometry.options.maxMarkerHeight||1/0)),n.setSymbol(w),n!==e._geometry&&e._geometry.setSymbol(w))}),(function(){e._update(g())}))}else console&&console.warn("A marker can't be resized with symbol:",n.getSymbol());function g(){var e=[["setCoordinates",n.getCoordinates().toArray()]];return n instanceof vnt?(e.push(["setWidth",n.getWidth()]),e.push(["setHeight",n.getHeight()])):e.push(["setSymbol",n.getSymbol()]),e}},n.prototype.createCircleEditor=function(){var e=this,n=this._shadow||this._geometry,i=this.getMap();this._history||this._recordHistory([["setCoordinates",n.getCoordinates().toArray()],["setRadius",n.getRadius()]]),this._createResizeHandles(null,(function(o){var s=n.getCenter(),a=i.containerPointToCoord(o),h=new qet([[s.x,s.y],[a.x,s.y]]),l=new qet([[s.x,s.y],[s.x,a.y]]),c=Math.max(i.computeGeometryLength(h),i.computeGeometryLength(l));n.setRadius(c),n!==e._geometry&&e._geometry.setRadius(c)}),(function(){e._update("setRadius",n.getRadius())}))},n.prototype.createEllipseOrRectEditor=function(){var e=this,n=[2,1,2,0,0,2,1,2],i=this._shadow||this._geometry;this._history||this._recordHistory(l());var o,s=this.getMap(),a=this._geometry instanceof unt;this.options.fixAspectRatio&&(o=i.getWidth()/i.getHeight());var h=this._createResizeHandles(null,(function(l,c){var A,f,d,p=a?1:2,g=h[c].getContainerPoint(),v=n[c];if(a){var w=h[7-c].getContainerPoint(),C=(A=g.sub(w)).abs();f=s.pixelToDistance(C.x,0),d=s.pixelToDistance(0,C.y);var P=i.getSize(),T=i.getCoordinates(),S=i.getWidth(),I=i.getHeight(),E=s.containerPointToCoord(l),O=s.containerPointToCoord(w),k=new qet([[O.x,O.y],[E.x,O.y]]),L=new qet([[O.x,O.y],[O.x,E.y]]);if(f=s.computeGeometryLength(k),d=s.computeGeometryLength(L),0===v)if(o&&(C.y=C.x/o,P.height=Math.abs(C.y),d=f/o),g.y=w.y-P.height/2,E.y=T.y,4===c)E.x=Math.min(E.x,T.x);else{var F=s.locate(T,S,0);E.x=s.locate(new o9(F.x,E.y),-f,0).x}else if(1===v)o&&(C.x=C.y*o,P.width=Math.abs(C.x),f=d*o),g.x=w.x-P.width/2,E.x=T.x,E.y=Math.max(E.y,O.y);else{if(o&&(f>d*o?(d=f/o,g.y=w.y+C.x*k5(A.y)/o):(f=d*o,g.x=w.x+C.y*k5(A.x)*o)),0===c||5===c){F=s.locate(T,S,0===c?0:-I);E.x=s.locate(new o9(F.x,E.y),-f,0).x}else E.x=Math.min(E.x,O.x);E.y=Math.max(E.y,O.y)}i.setCoordinates(E),e._updateCoordFromShadow(!0)}else{var N=i.getCenter();E=s.containerPointToCoord(g),k=new qet([[N.x,N.y],[E.x,N.y]]),L=new qet([[N.x,N.y],[N.x,E.y]]);f=s.computeGeometryLength(k),d=s.computeGeometryLength(L),o&&(d=(f=Math.max(f,d*o))/o)}(o||0===v||2===v)&&(i.setWidth(f*p),i!==e._geometry&&e._geometry.setWidth(f*p)),(o||1===v||2===v)&&(i.setHeight(d*p),i!==e._geometry&&e._geometry.setHeight(d*p))}),(function(){e._update(l())}));function l(){return[["setCoordinates",i.getCoordinates().toArray()],["setWidth",i.getWidth()],["setHeight",i.getHeight()]]}},n.prototype.createPolygonEditor=function(){var e=this.getMap(),n=this._shadow||this._geometry,i=this;this._history||this._recordHistory("setCoordinates",o9.toNumberArrays(n.getCoordinates()));var o=n instanceof jet?3:2,s="maptalks--editor-vertex-index",a=this.options,h=a.vertexZIndex,l=a.newVertexZIndex,c={0:[]},A={0:[]};function f(e){if(void 0===e&&(e=0),n instanceof jet){var i=n.getCoordinates()[e]||[];return i.slice(0,i.length-1)}return n.getCoordinates()}function d(e){return void 0===e&&(e=0),0===e?n._getPrjCoordinates():n._getPrjHoles()[e-1]}function p(){for(var e in c){for(var n=c[e].length-1;n>=0;n--)c[e][n][s]=n;for(n=A[e].length-1;n>=0;n--)A[e][n][s]=n}i._updateCoordFromShadow()}function g(a){i._updating=!0;var h=a.target,l=h[s],f=T2(h._ringIndex)?h._ringIndex:0,g=d(f);if(!(g.length<=o)){var v,w=n instanceof qet&&(0===l||l===g.length-1);if(g.splice(l,1),f>0?n._prjHoles[f-1]=g:n._setPrjCoordinates(g),n._updateCache(),c[f].splice(l,1)[0].delete(),l<A[f].length&&A[f].splice(l,1)[0].delete(),A[f].splice(v=0===l?A[f].length-1:l-1,1)[0].delete(),w||A[f].splice(v,0,S.call(i,v,f)),f>0){var C=n.getCoordinates(),P=C[f];P&&Array.isArray(P)&&P.length>1&&(P.splice(l,1),n!==this._geometry&&n.setCoordinates(C))}p(),i._updating=!1,i._geometry.fire("handleremove",Object.assign({},a,{coordinate:e.containerPointToCoordinate(a.containerPoint),vertex:a.target}))}}function v(o,s,a){void 0===a&&(a=0);var h=i._geometry.snapTo;h&&O2(h)&&(o=i._geometry.snapTo(o)||o);var l,c=d(a),f=e._containerPointToPrj(o.sub(C())),p=c[s];p.x=f.x,p.y=f.y,n._updateCache(),n.onShapeChanged(),i._updateCoordFromShadow(!0),l=0===s?A[a].length-1:s-1,A[a][s]&&A[a][s].refresh(),A[a][l]&&A[a][l].refresh()}var w=new w5(0,0);function C(){var e=n._getCompiledSymbol();return w.x=e.lineDx||0,w.y=e.lineDy||0,w}function P(n,o,a){void 0===o&&(o=0);var l=(a||f(o))[n],c=i.createHandle(e.coordToContainerPoint(l)._add(C()),{symbol:i.options.vertexHandleSymbol,cursor:"pointer",axis:null,onMove:function(){v(c.getContainerPoint(),c[s],o)},onRefresh:function(n,i){l=(i||f(o))[c[s]];var a=e.coordToContainerPoint(l);c.setContainerPoint(a._add(C()))},onUp:function(){i._updateCoordFromShadow()},onDown:function(e,n){}});return c[s]=n,c._ringIndex=o,c.on(i.options.removeVertexOn,g),c.setZIndex(h),c}var T=!1;function S(o,a,h){void 0===a&&(a=0);var g=h||f(a),w=g[o].add(o+1>=g.length?g[0]:g[o+1]).multi(.5),I=i.createHandle(w,{symbol:i.options.newVertexHandleSymbol,cursor:"pointer",axis:null,onDown:function(o,h){if(!h||!h.domEvent||2!==h.domEvent.button){var l=d(a),c=I[s],f=I.getContainerPoint(),p=e._containerPointToPrj(f);l.splice(c+1,0,p),a>0?n._prjHoles[a-1]=l:n._setPrjCoordinates(l),n._updateCache(),I.opacity=1,A[a].splice(c,0,S.call(i,c,a),S.call(i,c+1,a)),T=!0}},onMove:function(){v(I.getContainerPoint(),I[s]+1,a)},onUp:function(e){if(e&&e.domEvent&&2===e.domEvent.button)T=!1;else{var n=I[s];O5(I,A[a]),I.delete(),c[a].splice(n+1,0,P.call(i,n+1,a)),p(),i._updateCoordFromShadow(),T=!1}},onRefresh:function(n,i){g=i||f(n);var o=I[s],a=g[o].add(g[o===g.length-1?0:o+1]).multi(.5),h=e.coordToContainerPoint(a);I.setContainerPoint(h._add(C()))}});return I[s]=o,I.setZIndex(l),I}if(n instanceof jet)for(var I=n.getHoles().length+1,E=0;E<I;E++){c[E]=[],A[E]=[];for(var O=0,k=(L=f(E)).length;O<k;O++)c[E].push(P.call(this,O,E,L)),O<k-1&&A[E].push(S.call(this,O,E,L));A[E].push(S.call(this,L.length-1,E,L))}else{var L;for(O=0,k=(L=f(E=0)).length;O<k;O++)c[E].push(P.call(this,O,E,L)),O<k-1&&A[E].push(S.call(this,O,E,L));A[E].length&&2===n.getCoordinates().length&&(A[E][0].options.symbol.markerDx=12)}var F=e.getRenderer();F&&F.sortTopElements(),this._addRefreshHook((function(){if(!T){for(var e in A)for(var i=f(e),o=A[e].length-1;o>=0;o--)A[e][o].refresh(e,i);for(var e in A[0].length&&n instanceof qet&&(2===n.getCoordinates().length?A[0][0].options.symbol.markerDx=12:n.getCoordinates().length>2&&(A[0][0].options.symbol.markerDx=0)),c)for(i=f(e),o=c[e].length-1;o>=0;o--)c[e][o].refresh(e,i)}}))},n.prototype._refresh=function(){if(this._refreshHooks)for(var e=this._refreshHooks.length-1;e>=0;e--)this._refreshHooks[e].call(this)},n.prototype._hideContext=function(){this._geometry&&(this._geometry.closeMenu(),this._geometry.closeInfoWindow())},n.prototype._addRefreshHook=function(e){e&&(this._refreshHooks||(this._refreshHooks=[]),this._refreshHooks.push(e))},n.prototype._update=function(e){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];this._exeHistory([e,n]),this._recordHistory.apply(this,v5([e],y5(n),!1))},n.prototype._updateCoordFromShadow=function(e){var n=(this._shadow||this._geometry).getCoordinates(),i=this._geometry,o=this._updating;this._updating=!0,i.setCoordinates(n),e||this._recordHistory("setCoordinates",o9.toNumberArrays(i.getCoordinates())),this._updating=o},n.prototype._recordHistory=function(e){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];if(this._history||(this._history=[],this._historyPointer=0),this._history.length){var o=this._history[this._history.length-1];if(o[0]===e&&JSON.stringify(o[1])===JSON.stringify(n))return}this._historyPointer<this._history.length-1&&this._history.splice(this._historyPointer+1),this._history.push([e,n]),this._historyPointer=this._history.length-1,this._geometry.fire("editrecord")},n.prototype.cancel=function(){return this._history&&0!==this._historyPointer?(this._historyPointer=0,this._exeAndReset(this._history[0]),this):this},n.prototype.undo=function(){if(!this._history||0===this._historyPointer)return this;var e=this._history[--this._historyPointer];return this._exeAndReset(e),this},n.prototype.redo=function(){if(!this._history||this._historyPointer===this._history.length-1)return this;var e=this._history[++this._historyPointer];return this._exeAndReset(e),this},n.prototype._exeAndReset=function(e){if(!this._updating){this._exeHistory(e);var n=this._history,i=this._historyPointer;this.stop(),this._history=n,this._historyPointer=i,this.start()}},n.prototype._onDragStart=function(){this._updating=!0},n.prototype._onDragEnd=function(){this._updating=!1},n.prototype._exeHistory=function(e){var n,i;if(Array.isArray(e)){var o=this._updating;this._updating=!0;var s=this._shadow||this._geometry,a=this._geometry;Array.isArray(e[0])?e[0].forEach((function(e){var n,i,o=e[0],h=e.slice(1);(n=s[o]).call.apply(n,v5([s],y5(h),!1)),s!==a&&(i=a[o]).call.apply(i,v5([a],y5(h),!1))})):((n=s[e[0]]).call.apply(n,v5([s],y5(e[1]),!1)),s!==a&&(i=a[e[0]]).call.apply(i,v5([a],y5(e[1]),!1))),this._updating=o}},n}(m6(v6));hot.mergeOptions(aot),ynt.include({startEditText:function(){return this.getMap()?(this._recordVisible(),this.hide(),this.endEditText(),this._prepareEditor(),this._fireEvent("edittextstart"),this):this},endEditText:function(){if(this._textEditor){var e=this._textEditor.innerHTML;e=e.replace(/<p>/gi,"").replace(/<\/p>/gi,"<br/>"),this._textEditor.innerHTML=e;var n=this._textEditor.innerText.replace(/[\r\n]+$/gi,"");this.setContent(n),Y3(this._textEditor,"mousedown dblclick",z3),this.getMap().off("mousedown",this.endEditText,this),this._editUIMarker.remove(),delete this._editUIMarker,this._textEditor.onkeyup=null,delete this._textEditor,this._recoveryVisible(),this.show(),this._fireEvent("edittextend")}return this},isEditingText:function(){return!!this._textEditor},getTextEditor:function(){return this._editUIMarker},_prepareEditor:function(){var e=this.getMap(),n=this._createEditor();this._textEditor=n,e.on("mousedown",this.endEditText,this);var i=this._getEditorOffset();this._editUIMarker=new xit(this.getCoordinates(),{animation:null,content:n,dx:i.dx,dy:i.dy}).addTo(e),this._setCursorToLast(this._textEditor)},_getEditorOffset:function(){var e=this._getInternalSymbol()||{},n=0,i=0,o=e.textHorizontalAlignment;return"middle"===o||M2(o)?(n=(e.textDx||0)-2,i=(e.textDy||0)-2):(n=(e.markerDx||0)-2,i=(e.markerDy||0)-2),{dx:n,dy:i}},_createEditor:function(){var e=this.getContent(),n=this.getSize(),i=this._getInternalSymbol()||{},o=n.width,s=i.textFill||"#000000",a=i.textSize||12,h=n.height,l=i.markerLineColor||"#000",c=i.markerFill||"#3398CC",A=i.textLineSpacing||0,f=O3("div");return f.contentEditable=!0,f.style.cssText="background:".concat(c,"; border:1px solid ").concat(l,";\n            color:").concat(s,";font-size:").concat(a,"px;width:").concat(o-2,"px;height:").concat(h-2,"px;margin: auto;\n            line-height:").concat(a+A,"px;outline: 0; padding:0; margin:0;word-wrap: break-word;\n            overflow: hidden;-webkit-user-modify: read-write-plaintext-only;"),f.innerText=e,X3(f,"mousedown dblclick",z3),f.onkeyup=function(e){13===e.keyCode&&(f.style.height=parseInt(f.style.height||0)+a/2+"px")},f},_setCursorToLast:function(e){var n;window.getSelection?(e.focus(),(n=window.getSelection()).selectAllChildren(e),n.collapseToEnd()):document.selection&&((n=document.selection.createRange()).moveToElementText(e),n.collapse(!1),n.select())}}),net.include({animate:function(e,n,i){var o=this;this._animPlayer&&this._animPlayer.finish(),O2(n)&&(i=n),n||(n={});var s,a=this.getMap(),h=this._getProjection(),l=this._prepareAnimationStyles(e),c=n.focus;if(delete this._animationStarted,a){var A=a._getRenderer();n.framer=function(e){A.callInNextFrame(e)}}if(h||!c){var f=Let.animate(l,n,(function(e){if(a&&a.isRemoved())f.finish();else{a&&!o._animationStarted&&c&&a.onMoveStart();var n=e.styles;for(var l in n)if("symbol"!==l&&"translate"!==l&&n.hasOwnProperty(l)){var A="set"+l[0].toUpperCase()+l.slice(1);o[A](n[l])}var d=n.translate;if(d){var p=d;s&&(p=d.sub(s)),s=d,o.translate(p)}var g=n.symbol;if(g){var v=o.getSymbol()||{};o.setSymbol(J4(v,g))}if(a&&c){var w=h.project(o.getCenter());a._setPrjCenter(w);var C=a._parseEventFromCoord(h.unproject(w));"running"!==f.playState?a.onMoveEnd(C):a.onMoving(C)}o._fireAnimateEvent(f.playState),i&&i(e)}}),this);return this._animPlayer=f,this._animPlayer.play()}console.error(zet)},_prepareAnimationStyles:function(e){var n=this._getInternalSymbol(),i={};for(var o in e)if(e.hasOwnProperty(o)){var s=e[o];if("translate"!==o&&"symbol"!==o){var a=this["get"+o[0].toUpperCase()+o.substring(1)]();i[o]=[a,s]}else if("symbol"===o){var h=void 0;if(Array.isArray(e.symbol)){if(!Array.isArray(n))throw new Error("geometry'symbol isn't a composite symbol, while the symbol in styles is.");h=[];for(var l=e.symbol,c=0;c<l.length;c++)if(l[c]){var A={};for(var f in l[c])l[c].hasOwnProperty(f)&&(A[f]=[n[c][f],l[c][f]]);h.push(A)}else h.push(null)}else{if(Array.isArray(n))throw new Error("geometry'symbol is a composite symbol, while the symbol in styles isn't.");for(var f in h={},s)s.hasOwnProperty(f)&&(h[f]=[n[f],s[f]])}i.symbol=h}else"translate"===o&&(i.translate=new o9(s))}return i},_fireAnimateEvent:function(e){"finished"===e?(delete this._animationStarted,this._fireEvent("animateend")):"running"===e&&(this._animationStarted?this._fireEvent("animating"):(this._fireEvent("animatestart"),this._animationStarted=!0))}});var lot=t3+"_drag_stage",uot=f5.touch?"touchstart mousedown":"mousedown",cot=function(e){function n(n){return e.call(this,n)||this}return p5(n,e),n.prototype.addHooks=function(){this.target.on(uot,this._startDrag,this)},n.prototype.removeHooks=function(){this._endDrag(),this.target.off(uot,this._startDrag,this),delete this.container},n.prototype._prepareDragHandler=function(){this._dragHandler=new r9(this.container),this._dragHandler.on("dragging",this._dragging,this).on("mouseup",this._endDrag,this).enable()},n.prototype._prepareShadow=function(){var e=this,n=this.target;if("canvas"===n.getLayer().options.renderer&&n.options.dragShadow){this._prepareDragStageLayer(),this._shadow&&this._shadow.remove();var i=this._shadow=n.copy();if(i.getGeometries){var o=i.getGeometries(),s=n.getGeometries();o.forEach((function(n,i){e._updateShadowSymbol(n,s[i])}))}else this._updateShadowSymbol(i,n);i.setId(null),this._prepareShadowConnectors()}},n.prototype._updateShadowSymbol=function(e,n){if(e.setSymbol(n._getInternalSymbol()),n.options.dragShadow){var i=Y4(e._getInternalSymbol(),.5);e.setSymbol(i)}},n.prototype._prepareShadowConnectors=function(){var e=this.target,n=this._shadow,i=this._dragStageLayer._getRenderer().resources,o=[];if(wnt._hasConnectors(e))for(var s=wnt._getConnectors(e),a=0,h=s.length;a<h;a++){var l=s[a],c=l.config(),A=l._getInternalSymbol();c.symbol=Y4(A,.5);var f=void 0;f=l.getConnectSource()===e?new l.constructor(n,l.getConnectTarget(),c):new l.constructor(l.getConnectSource(),n,c),o.push(f),l.getLayer()&&l.getLayer()._getRenderer()&&i.merge(l.getLayer()._getRenderer().resources)}this._shadowConnectors=o,o.push(n),this._dragStageLayer.bringToFront().addGeometry(o)},n.prototype._onTargetUpdated=function(){this._shadow&&this._shadow.setSymbol(this.target._getSymbol())},n.prototype._prepareDragStageLayer=function(){var e=this.target.getMap(),n=this.target.getLayer();this._dragStageLayer=e.getLayer(lot),this._dragStageLayer||(this._dragStageLayer=new Ent(lot,{enableAltitude:n.options.enableAltitude,altitudeProperty:n.options.altitudeProperty}),e.addLayer(this._dragStageLayer));var i=new b7;i.merge(n._getRenderer().resources),this._dragStageLayer._getRenderer().resources=i},n.prototype._startDrag=function(e){var n=this.target.getMap();if(n&&(!this.target._getParent()&&!this.isDragging())){var i=e.domEvent;i.touches&&i.touches.length>1||2===i.button||(this.container=n.getPanels().mapWrapper||n.getContainer(),this.target.on("click",this._endDrag,this),this._lastCoord=this._correctCoord(e.coordinate),this._lastPoint=e.containerPoint,this._prepareDragHandler(),this._dragHandler.onMouseDown(e.domEvent),X3(this.container,"mouseleave",this._endDrag,this),this._startParam=e,this._moved=!1)}},n.prototype._dragging=function(e){var n=this.target,i=n.getMap();if(!i._isEventOutMap(e.domEvent)){var o=i._parseEvent(e.domEvent),s=o.domEvent;if(!(s.touches&&s.touches.length>1)){var a=i._getVisualHeight(i.options.maxVisualPitch);if(!(o.containerPoint.y<i.height-a)){if(!this._moved)return this._moved=!0,n.on("symbolchange",this._onTargetUpdated,this),this._isDragging=!0,this._prepareShadow(),this._shadow&&(n.options.dragShadow||n.hide(),this._shadow._fireEvent("dragstart",o)),this.target._fireEvent("dragstart",this._startParam||o),void delete this._startParam;var h=this._shadow||n,l=h.options.dragOnAxis,c=h.options.dragOnScreenAxis,A=o.containerPoint,f=o.coordinate;this._lastPoint=this._lastPoint||A,this._lastCoord=this._lastCoord||f,c?("x"===l?A.y=this._lastPoint.y:"y"===l&&(A.x=this._lastPoint.x),f=i.containerPointToCoord(A)):f=this._correctCoord(f);var d=A.sub(this._lastPoint),p=f.sub(this._lastCoord);c||("x"===l?d.y=p.y=0:"y"===l&&(d.x=p.x=0)),this._lastPoint=A,this._lastCoord=f;var g=!h.getGeometries&&h.isPoint;g?h.setCoordinates(f):h.translate(p),h===n||n.options.dragShadow||(g?n.setCoordinates(f):n.translate(p)),o.coordOffset=p,o.pointOffset=d,h._fireEvent("dragging",o),h!==n&&n._fireEvent("dragging",o)}}}},n.prototype._endDrag=function(e){if(this._dragHandler&&(this._dragHandler.disable(),delete this._dragHandler),this.container&&Y3(this.container,"mouseleave",this._endDrag),this.target){var n=this.target;n.off("click",this._endDrag,this),n.off("symbolchange",this._onTargetUpdated,this),delete this._lastCoord,delete this._lastPoint,this._isDragging=!1;var i=n.getMap();if(this.enabled()&&i){var o=i._parseEvent(e?e.domEvent:null);this._updateTargetAndRemoveShadow(o),this._moved&&n._fireEvent("dragend",o)}}},n.prototype.isDragging=function(){return!!this._isDragging},n.prototype._updateTargetAndRemoveShadow=function(e){if(this._shadow){var n=this.target,i=n.getMap();n.options.dragShadow||n.show();var o=this._shadow;if(o){if(n.options.dragShadow){var s=o.getFirstCoordinate(),a=n.getFirstCoordinate(),h=s.sub(a);n.translate(h)}o._fireEvent("dragend",e),o.remove(),delete this._shadow}this._shadowConnectors&&(i.getLayer(lot).removeGeometry(this._shadowConnectors),delete this._shadowConnectors),this._dragStageLayer&&(this._dragStageLayer._getRenderer().resources=new b7,this._dragStageLayer.remove())}},n.prototype._correctCoord=function(e){var n=this.target.getMap();if(!n.getPitch())return e;var i=this.target;if(!i.getMinAltitude())return e;var o=(i.getMinAltitude()+i.getMaxAltitude())/2;return n.locateByPoint(e,0,-o)},n}(y6);net.mergeOptions({draggable:!1,dragShadow:!0,dragOnAxis:null,dragOnScreenAxis:!1}),net.addInitHook("addHandler","draggable",cot),net.include({isDragging:function(){return this._getParent()?this._getParent().isDragging():!!this.draggable&&this.draggable.isDragging()}}),net.include({startEdit:function(e){var n=this.getMap();return n&&this.options.editable?(this._editor&&this.endEdit(),this._recordVisible(),this._editor=new hot(this,e),this._editor.start(),this._getParent()||this.fire("editstart"),n.getRenderer().setToRedraw(),this):this},endEdit:function(){if(this._editor){this._editor.stop(),delete this._editor,this._recoveryVisible(),this._getParent()||this.fire("editend");var e=this.getMap();e&&e.getRenderer().setToRedraw()}return this},redoEdit:function(){return this.isEditing()?(this._editor.redo(),this._getParent()||this.fire("redoedit"),this):this},undoEdit:function(){return this.isEditing()?(this._editor.undo(),this._getParent()||this.fire("undoedit"),this):this},cancelEdit:function(){return this.isEditing()?(this._recoveryVisible(),this._editor.cancel(),this._getParent()||this.fire("canceledit"),this):this},isEditing:function(){return!!this._editor&&this._editor.isEditing()}}),net.include({_onEvent:function(e,n){var i=this.getMap();if(i){var o=n||this._getEventTypeToFire(e);"contextmenu"===o&&this.listens("contextmenu")&&(z3(e),N3(e));var s=i._getEventParams(e);T2(this._pickGeometryIndex)&&(s.pickGeometryIndex=this._pickGeometryIndex),this._fireEvent(o,s)}},_getEventTypeToFire:function(e){return e.type}}),net.include({setInfoWindow:function(e){return this.removeInfoWindow(),e instanceof Tit?(this._infoWindow=e,this._infoWinOptions=P2({},this._infoWindow.options),this._infoWindow.addTo(this),this):(this._infoWinOptions=P2({},e),this._infoWindow?this._infoWindow.setOptions(e):this.getMap()&&this._bindInfoWindow(),this)},getInfoWindow:function(){return this._infoWindow?this._infoWindow:null},openInfoWindow:function(e){return this.getMap()?(e||(e=this.getCenter()),this._infoWindow?this._infoWindow.show(e):this._infoWinOptions&&this.getMap()&&(this._bindInfoWindow(),this._infoWindow.show(e)),this):this},closeInfoWindow:function(){return this._infoWindow&&this._infoWindow.hide(),this},removeInfoWindow:function(){return this._unbindInfoWindow(),delete this._infoWinOptions,delete this._infoWindow,this},_bindInfoWindow:function(){var e=this._infoWinOptions;return e?(this._infoWindow=new Tit(e),this._infoWindow.addTo(this),this):this},_unbindInfoWindow:function(){return this._infoWindow&&(this.closeInfoWindow(),this._infoWindow.remove(),delete this._infoWindow),this}}),net.fromJSON=function(e){if(Array.isArray(e)){for(var n=[],i=0,o=e.length;i<o;i++){var s=net.fromJSON(e[i]);Array.isArray(e)?n=n.concat(s):n.push(s)}return n}return e&&!e.feature?snt.toGeometry(e):(e.subType?(a=net.getJSONClass(e.subType).fromJSON(e),M2(e.feature.id)||a.setId(e.feature.id)):(a=snt.toGeometry(e.feature),e.options&&a.config(e.options)),e.symbol&&a.setSymbol(e.symbol),e.infoWindow&&a.setInfoWindow(e.infoWindow),a);var a};var Aot=new w5(0,0),fot=new w5(0,0),dot=new w5(0,0),pot=new w5(0,0),got=[],mot=function(e){function n(){return e.call(this,S8)||this}return p5(n,e),n.prototype.checkUrl=function(e){return e&&E2(e)?J5(e):e},n.prototype.fetchImage=function(e,n,i,o){e=this.checkUrl(e),this.send({url:e,fetchOptions:o},got,i,n)},n}(p7),yot=function(e){function n(n){var i=e.call(this,n)||this;i.tilesInView={},i.tilesLoading={},i._parentTiles=[],i._childTiles=[],i._tileQueue=[],i._tileQueueIds=new Set;var o=n.getTileSize().width;return i.tileCache=new r6(n.options.maxCacheSize*o/512*o/512,(function(e){i.deleteTile(e)})),f5.decodeImageInWorker&&i.layer.options.decodeImageInWorker&&("gl"===n.options.renderer||!f5.safari&&!f5.iosWeixin)&&(i._tileImageWorkerConn=new mot),i._compareTiles=_ot.bind(i),i}return p5(n,e),n.prototype.getCurrentTileZoom=function(){return this._tileZoom},n.prototype.draw=function(e,n){var i=this.getMap();if(this.isDrawable()){var o=this.prepareCanvas();if(!o||o.intersects(this.canvasExtent2D)){var s;this._renderTimestamp!==e&&(this._consumeTileQueue(),this._computeAvgTileAltitude(),this._renderTimestamp=e);var a=!1,h=this._frameTiles;if(h&&e===h.timestamp){if(h.empty)return;s=h}else{if(!(s=this._getTilesInCurrentFrame()))return this._frameTiles={empty:!0,timestamp:e},void this.completeRender();a=!0,this._frameTiles=s,this._frameTiles.timestamp=e,s.loadingCount&&this.loadTileQueue(s.tileQueue)}var l=s.loading,c=s.loadingCount;this._drawTiles(s.tiles,s.parentTiles,s.childTiles,s.placeholders,n,s.missedTiles,s.incompleteTiles),c||l||(i.isAnimating()||!this._parentTiles.length&&!this._childTiles.length||(this._parentTiles=[],this._childTiles=[],this.setToRedraw()),this.completeRender()),a&&this.retireTiles()}else this.completeRender()}},n.prototype.getTileGridsInCurrentFrame=function(){return this._frameTileGrids},n.prototype.getCurrentTimestamp=function(){return this._renderTimestamp||0},n.prototype._getTilesInCurrentFrame=function(){var e=this.getMap(),n=this.layer,i=n._isPyramidMode()&&n.options.terrainTileMode,o=n.getTiles();if(this._frameTileGrids=o,!(o=o.tileGrids)||!o.length)return null;var s=o.reduce((function(e,n){return e+(n&&n.tiles&&n.tiles.length||0)}),0);s>=this.tileCache.max/2&&this.tileCache.setMaxSize(2*s+1);var a=0,h=!1,l={},c=[],A=[],f={},d=[],p={},g=[],v={},w={},C=this.markTiles(),P=this._getLoadLimit(),T=o.length,S=void 0===this._tileZoom&&n.options.currentTilesFirst&&!this._terrainHelper;this._tileZoom=o[0].zoom;var I=null,E=null;i&&(I=[],E=new Map);for(var O=0;O<T;O++){var k=o[O],L=k.tiles,F=k.parents||got,N=F.length,z=S?L:F.concat(L),H=void 0;z.length&&(H=this._generatePlaceHolder(z[0].res));for(var j=0,W=z.length;j<W;j++){var q=(ht=z[j]).id,Y=j<N,J=!1,$=c.length;if(this._isLoadingTile(q))J=h=!0,this.markCurrent(this.tilesLoading[q],!0);else{var it=this.getCachedTile(ht,Y);if(it)Y||(it.image&&this.isTileFadingIn(it.image)&&(J=h=!0,this.setToRedraw()),this.isTileComplete(it)?c.push(it):(J=!0,i&&E.set(q,it)));else{J=h=!0;var rt=P&&a+C[0]>P;if(!this._tileQueueIds.has(ht.id)&&!rt&&(!e.isInteracting()||e.isMoving()||e.isRotating()))a++,w[q]=ht}}if(i&&!Y&&(c.length===$?I.push(ht):l[ht.id]=1),!i)if(!Y)if(J)if(!l[q])if(l[q]=1,H&&!v[q]&&(ht.cache=!1,g.push({image:H,info:ht}),v[q]=1),(At=this._findChildTiles(ht)).length&&At.forEach((function(e){p[e.info.id]||(d.push(e),p[e.info.id]=1)})),!At.length||4!==At.length){var ot=this._findParentTile(ht);if(ot){var st=ot.info.id;void 0===f[st]&&(f[st]=A.length,A.push(ot))}}}}var at=[];if(i)for(O=0;O<I.length;O++){var ht;if((ht=I[O].info?I[O].info:I[O]).parent&&!l[ht.id]){var At,ft=this._findChildTiles(ht),gt=ft.missedTiles;(At=ft.tiles).length?(E5(c,At),E5(at,gt)):E.has(ht.id)?(c.push(E.get(ht.id)),E.delete(ht.id)):(l[ht.id]=1,at.push(ht))}}return this.tileCache.shrink(),{childTiles:d,missedTiles:at,parentTiles:A,tiles:c,incompleteTiles:E&&Array.from(E.values()),placeholders:g,loading:h,loadingCount:a,tileQueue:w}},n.prototype.removeTileCache=function(e){delete this.tilesInView[e],this.tileCache.remove(e)},n.prototype.isTileCachedOrLoading=function(e){return this.tileCache.get(e)||this.tilesInView[e]||this.tilesLoading[e]},n.prototype.isTileCached=function(e){return!(!this.tileCache.get(e)&&!this.tilesInView[e])},n.prototype.isTileFadingIn=function(e){return this._getTileFadingOpacity(e)<1},n.prototype._drawTiles=function(e,n,i,o,s,a,h){var l=this;n.length&&(n.sort(this._compareTiles),this._parentTiles=n),i.length&&(this._childTiles=i,this._childTiles.sort(this._compareTiles));var c=!0;this.layer.constructor!==prt&&this.layer.constructor!==Crt||(this._renderTimestamp===this.canvas._parentTileTimestamp?c=!1:this.canvas._parentTileTimestamp=this._renderTimestamp);var A="gl"===this.layer.options.renderer&&(!this.isGL||this.isGL()),f={tiles:e,parentTiles:this._parentTiles,childTiles:this._childTiles,parentContext:s};if(this.onDrawTileStart(f,s),c&&1===this.layer.options.opacity){this.layer._silentConfig=!0;var d=this.layer.options.fadeAnimation;this.layer.options.fadeAnimation=!1,A?(this._drawChildTiles(i,s),this._drawParentTiles(this._parentTiles,s)):(this._drawParentTiles(this._parentTiles,s),this._drawChildTiles(i,s)),this.layer.options.fadeAnimation=d,this.layer._silentConfig=!1}this.drawingCurrentTiles=!0,e.sort(this._compareTiles);for(var p=0,g=e.length;p<g;p++)this._drawTileAndCache(e[p],s);if(delete this.drawingCurrentTiles,c&&this.layer.options.opacity<1){this.layer._silentConfig=!0;d=this.layer.options.fadeAnimation;this.layer.options.fadeAnimation=!1,A?(this._drawChildTiles(i,s),this._drawParentTiles(this._parentTiles,s)):(this._drawParentTiles(this._parentTiles,s),this._drawChildTiles(i,s)),this.layer.options.fadeAnimation=d,this.layer._silentConfig=!1}o.forEach((function(e){return l._drawTile(e.info,e.image,s)})),this.onDrawTileEnd(f,s)},n.prototype._drawChildTiles=function(e,n){var i=this;this.drawingChildTiles=!0,e.forEach((function(e){return i._drawTile(e.info,e.image,n)})),delete this.drawingChildTiles},n.prototype._drawParentTiles=function(e,n){var i=this;this.drawingParentTiles=!0,this._parentTiles.forEach((function(e){return i._drawTile(e.info,e.image,n)})),delete this.drawingParentTiles},n.prototype.onDrawTileStart=function(e,n){},n.prototype.onDrawTileEnd=function(e,n){},n.prototype._drawTile=function(e,n,i){n&&this.drawTile(e,n,i)},n.prototype._drawTileAndCache=function(e,n){this.isValidCachedTile(e)&&(this.tilesInView[e.info.id]=e),this._drawTile(e.info,e.image,n)},n.prototype.drawOnInteracting=function(e,n,i){this.draw(n,i)},n.prototype.needToRedraw=function(){var n=this.getMap();return!!this._tileQueue.length||(n.getPitch()?e.prototype.needToRedraw.call(this):!(!n.isRotating()&&!n.isZooming())||(n.isMoving()?!!this.layer.options.forceRenderOnMoving:e.prototype.needToRedraw.call(this)))},n.prototype.hitDetect=function(){return!1},n.prototype._getLoadLimit=function(){return this.getMap().isInteracting()?this.layer.options.loadingLimitOnInteracting:this.layer.options.loadingLimit||0},n.prototype.isDrawable=function(){return!this.getMap().getPitch()||(console&&console.warn("TileLayer with canvas renderer can't be pitched, use gl renderer ('renderer' : 'gl') instead."),this.clear(),!1)},n.prototype.clear=function(){this.retireTiles(!0),this.tileCache.reset(),this.tilesInView={},this.tilesLoading={},this._tileQueue=[],this._tileQueueIds.clear(),this._parentTiles=[],this._childTiles=[],e.prototype.clear.call(this)},n.prototype._isLoadingTile=function(e){return!!this.tilesLoading[e]},n.prototype.clipCanvas=function(n){return e.prototype.clipCanvas.call(this,n)},n.prototype._clipByPitch=function(e){var n=this.getMap();if(n.getPitch()<=n.options.maxVisualPitch)return!1;if(!this.layer.options.clipByPitch)return!1;var i=n.getContainerExtent(),o=n.getDevicePixelRatio();return e.save(),e.strokeStyle="rgba(0, 0, 0, 0)",e.beginPath(),e.rect(0,Math.ceil(i.ymin)*o,Math.ceil(i.getWidth())*o,Math.ceil(i.getHeight())*o),e.stroke(),e.clip(),!0},n.prototype.loadTileQueue=function(e){for(var n in e)if(e.hasOwnProperty(n)){var i=e[n],o=this.loadTile(i);void 0===o.loadTime&&(this.tilesLoading[i.id]={image:o,current:!0,info:i})}},n.prototype.loadTile=function(e){var n=this,i={};if(this.loadTileBitmap){this.loadTileBitmap(e.url,e,(function(i){n.onTileLoad(i,e)}),(function(i,o){n.onTileError(o,e,i)}))}else if(this._tileImageWorkerConn&&this.loadTileImage===this.constructor.prototype.loadTileImage)this._fetchImage(i,e);else{var o=this.layer.getTileSize(e.layer);(i=new Image).width=o.width,i.height=o.height,i.onload=this.onTileLoad.bind(this,i,e),i.onerror=this.onTileError.bind(this,i,e),this.loadTileImage(i,e.url)}return i},n.prototype._fetchImage=function(e,n){var i=this;if(e instanceof Image)e.src=n.url;else{var o=Math.abs(n.x+n.y)%this._tileImageWorkerConn.workers.length;this._tileImageWorkerConn.fetchImage(n.url,o,(function(o,s){o?i.onTileError(e,n,o):Y5(s,(function(e){i.onTileLoad(e,n)}))}),this.layer.options.fetchOptions||{referrer:document.location.href,headers:{accept:"image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8"}})}},n.prototype.loadTileImage=function(e,n){var i=this.layer.options.crossOrigin;return M2(i)||(e.crossOrigin=i),P5(e,[n])},n.prototype.abortTileLoading=function(e,n){n&&void 0!==n.id&&this.removeTileLoading(n),e&&e instanceof Image&&(e.onload=vot,e.onerror=vot,e.src=W5)},n.prototype.onTileLoad=function(e,n){this.removeTileLoading(n),this._tileQueue.push({tileInfo:n,tileData:e}),this._tileQueueIds.add(n.id),this.setToRedraw()},n.prototype.removeTileLoading=function(e){delete this.tilesLoading[e.id],this.setToRedraw()},n.prototype._consumeTileQueue=function(){for(var e=0,n=this.layer.options.tileLimitPerFrame,i=this._tileQueue;i.length&&(n<=0||e<n);){var o=i.shift(),s=o.tileData,a=o.tileInfo;this._tileQueueIds.has(a.id)&&(this._tileQueueIds.delete(a.id),this.checkTileInQueue(s,a)&&(this.consumeTile(s,a),e++))}},n.prototype._computeAvgTileAltitude=function(){var e=0,n=0,i=0;for(var o in this.tilesInView){var s=this.tilesInView[o]&&this.tilesInView[o].info;s&&(e+=s.minAltitude||0,n+=s.maxAltitude||0,i++)}this.avgMinAltitude=e/i,this.avgMaxAltitude=n/i},n.prototype.checkTileInQueue=function(e,n){return!0},n.prototype.consumeTile=function(e,n){if(this.layer&&this.tilesInView){var i={tile:n,tileImage:e};this.resetTileLoadTime(e=i.tileImage),this.removeTileLoading(n),this._addTileToCache(n,e),this.layer.fire("tileload",i),this.setToRedraw()}},n.prototype.resetTileLoadTime=function(e){0!==e.loadTime&&(e.loadTime=C2())},n.prototype.onTileError=function(e,n,i){if(this.layer){if(e.onerrorTick=e.onerrorTick||0,this.layer.options.tileRetryCount>e.onerrorTick)return e.onerrorTick++,this._fetchImage(e,n),void this.removeTileLoading(n);var o=this.layer.options.errorUrl;if(o){if(e instanceof Image&&e.src!==o)return e.src=o,void this.removeTileLoading(n);(e=new Image).src=o}this.abortTileLoading(e,n),e.loadTime=0,this.removeTileLoading(n),this._addTileToCache(n,e),this.setToRedraw(),this.layer.fire("tileerror",{tile:n})}},n.prototype.drawTile=function(e,n,i){if(n&&this.getMap()){var o=e.extent2d,s=e.offset,a=Aot.set(o.xmin-s[0],o.ymax-s[1]),h=e.z,l=e.id,c=this.getMap(),A=c.getZoom(),f=this.context,d=c._pointAtResToContainerPoint(a,e.res,0,fot),p=c.getBearing(),g=p||A!==h,v=this.getTileOpacity(n,e),w=f.globalAlpha;v<1&&(f.globalAlpha=v),g||d._round();var C=d.x,P=d.y,T=e.extent2d.xmax-e.extent2d.xmin,S=e.extent2d.ymax-e.extent2d.ymin,I=this.layer,E=I?I.options.bufferPixel:0;if(g){f.save(),f.translate(C,P),p&&f.rotate(-p*Math.PI/180),T+=E,S+=E;var O=c._getResolution();if(O!==e.res){var k=e.res/O;f.scale(k,k)}C=P=0}if(u6.image(f,n,C,P,T,S),this.layer.options.debug){var L=this.layer.options.debugOutline;f.save(),f.strokeStyle=L,f.fillStyle=L,f.font="20px monospace";var F=new w5(C,P);u6.rectangle(f,F,{width:T,height:S},1,0),u6.fillText(f,this.getDebugInfo(l),F._add(32,S-14),L),u6.drawCross(f,C+T/2,P+S/2,2,L),f.restore()}g&&f.restore(),f.globalAlpha!==w&&(f.globalAlpha=w),this.setCanvasUpdated()}},n.prototype.getDebugInfo=function(e){var n=e.split("_"),i=n.length;return n[i-3]+"/"+n[i-2]+"/"+n[i-1]},n.prototype.findChildTiles=function(e){return this._findChildTiles(e)},n.prototype._findChildTiles=function(e){var n=this._getLayerOfTile(e.layer),i=n&&n.options.terrainTileMode&&n._isPyramidMode();if(!n||!n.options.background&&!i||e.z>this.layer.getMaxZoom())return got;var o=this.getMap(),s=[];if(n._isPyramidMode()){if(!i){for(var a=this._getLayerOfTile(e.layer),h=2*e.x,l=2*e.y,c=e.z+1,A=[],f=0;f<2;f++)for(var d=0;d<2;d++)A.push(h+f,l+d,c);for(;A.length;){var p=A.pop(),g=A.pop(),v=A.pop(),w=a._getTileId(v,g,p,e.layer),C=p+1<=e.z+2;if(L=this.tileCache.getAndRemove(w)){if(this.isValidCachedTile(L))s.push(L),this.tileCache.add(w,L);else if(C)for(f=0;f<2;f++)for(d=0;d<2;d++)A.push(2*v+f,2*g+d,p+1)}else if(C)for(f=0;f<2;f++)for(d=0;d<2;d++)A.push(2*v+f,2*g+d,p+1)}return s}var P=void 0;i&&(P=[]);for(var T=2*e.x,S=2*e.y,I=e.z+1,E=[],O=0;O<2;O++)for(var k=0;k<2;k++){var L;w=n._getTileId(v=T+O,g=S+k,p=I,e.layer);(L=this.tileCache.getAndRemove(w))&&this.isValidCachedTile(L)?(s.push(L),this.tileCache.add(w,L),E.push(null)):E.push(w)}if(s.length<4){var F=0;for(O=0;O<2;O++)for(k=0;k<2;k++){if(w=E[F++]){v=T+O,g=S+k,p=I;var N=s.length,z=[];for(f=0;f<2;f++)for(d=0;d<2;d++){var H=n._getTileId(2*v+f,2*g+d,p+1,e.layer),j=this.tileCache.getAndRemove(H);j&&this.isValidCachedTile(j)?(s.push(j),this.tileCache.add(H,j),z.push(null)):z.push(H)}if(i&&s.length-N<4){var W=n.tileInfoCache.get(w)||n._createChildNode(e,O,k,[0,0],w);if(s.length-N==0)P.push(W);else{var q=0;for(f=0;f<2;f++)for(d=0;d<2;d++){var Y=z[q++];if(Y){var J=this.layer.tileInfoCache.get(Y)||n._createChildNode(W,f,d,[0,0],Y);P.push(J)}}}}}}}return i?{tiles:s,missedTiles:P}:s}var $=e.res,it=e.extent2d.getMin(),rt=e.extent2d.getMax(),ot=n._project(o._pointToPrjAtRes(it,$,dot),dot),st=n._project(o._pointToPrjAtRes(rt,$,pot),pot);for(O=1;O<1;O++)this._findChildTilesAt(s,ot,st,n,e.z+O);return s},n.prototype._findChildTilesAt=function(e,n,i,o,s){var a=o.getId(),h=o.getSpatialReference().getResolution(s);if(h)for(var l,c,A=o._getTileConfig().getTileIndex(n,h),f=o._getTileConfig().getTileIndex(i,h),d=Math.min(A.idx,f.idx),p=Math.max(A.idx,f.idx),g=Math.min(A.idy,f.idy),v=Math.max(A.idy,f.idy),w=d;w<p;w++)for(var C=g;C<v;C++)l=o._getTileId(w,C,s,a),(c=this.tileCache.getAndRemove(l))&&this.isValidCachedTile(c)&&(e.push(c),this.tileCache.add(l,c))},n.prototype.findParentTile=function(e,n){return this._findParentTile(e,n)},n.prototype._findParentTile=function(e,n){var i=this.getMap(),o=this._getLayerOfTile(e.layer);if(!o||!o.options.background&&!o.options.terrainTileMode)return null;var s=o.getMinZoom(),a=n||e.z-s;if(o._isPyramidMode()){for(var h=e.z-a,l=e.z-1;l>=h;l--){var c=e.z-l,A=Math.pow(2,c),f=Math.floor(e.x/A),d=Math.floor(e.y/A),p=void 0;if(p=l===e.z-1?e.parent:o._getTileId(f,d,l,e.layer),(S=this.tileCache.getAndRemove(p))&&this.isValidCachedTile(S))return this.tileCache.add(p,S),S}return null}var g=o.getSpatialReference(),v=g.getZoomDirection(),w=e.res,C=e.extent2d.getCenter(),P=o._project(i._pointToPrjAtRes(C,w));for(c=1;c<=a;c++){var T=g.getResolution(l=e.z-v*c);if(T){var S,I=o._getTileConfig().getTileIndex(P,T);p=o._getTileId(I.x,I.y,l,e.layer);if(S=this.tileCache.getAndRemove(p))return this.tileCache.add(p,S),S}}return null},n.prototype.isValidCachedTile=function(e){return!!e.image},n.prototype.isTileComplete=function(e){return!0},n.prototype._getLayerOfTile=function(e){return this.layer.getChildLayer?this.layer.getChildLayer(e):this.layer},n.prototype.getCachedTile=function(e,n){var i=e.id,o=this.tilesInView,s=this.tileCache.getAndRemove(i);if(s){n||(o[i]=s);var a=this.tilesLoading;if(a&&a[i]){this.markCurrent(a[i],!1);var h=a[i];this.abortTileLoading(h.image,h.info),delete a[i]}}else s=o[i];return s&&(s.current=!0,this.isValidCachedTile(s)&&this.tileCache.add(i,s)),s},n.prototype._addTileToCache=function(e,n){this.isValidCachedTile({info:e,image:n})&&this.tileCache.add(e.id,{image:n,info:e})},n.prototype.getTileOpacity=function(e,n){var i=this._getTileFadingOpacity(e);if(this.layer.getChildLayer){var o=this.layer.getLayer(n.layer);o&&(i*=o.options.opacity)}return i},n.prototype._getTileFadingOpacity=function(e){return this.layer.options.fadeAnimation&&e.loadTime?Math.min(1,(C2()-e.loadTime)/this.layer.options.fadeDuration):1},n.prototype.onRemove=function(){this.clear(),delete this.tileCache,delete this._tilePlaceHolder,delete this._tileZoom,e.prototype.onRemove.call(this)},n.prototype.markCurrent=function(e,n){e.current=n},n.prototype.markTiles=function(){var e=0,n=0;if(this.tilesLoading)for(var i in this.tilesLoading)this.markCurrent(this.tilesLoading[i],!1),e++;if(this.tilesInView)for(var i in this.tilesInView)this.markCurrent(this.tilesInView[i],!1),n++;return[e,n]},n.prototype.retireTiles=function(e){for(var n in this.tilesLoading){var i=this.tilesLoading[n];!e&&i.current||(i.image&&this.abortTileLoading(i.image,i.info),this.deleteTile(i),this.removeTileLoading(i.info))}for(var n in this.tilesInView){(i=this.tilesInView[n]).current||(delete this.tilesInView[n],this.tileCache.has(n)||this.deleteTile(i))}},n.prototype.deleteTile=function(e){if(e&&e.image){var n=e.info.id;this._tileQueueIds.has(n)&&this._tileQueueIds.delete(n),e.image.close&&e.image.close(),e.image instanceof Image&&(e.image.onload=null,e.image.onerror=null)}},n.prototype._generatePlaceHolder=function(e){var n=this.getMap(),i=this.layer.options.placeholder;if(!i||n.getPitch())return null;var o=this.layer.getTileSize(),s=e/n._getResolution(),a=this._tilePlaceHolder=this._tilePlaceHolder||u6.createCanvas(1,1,n.CanvasClass);return a.width=o.width*s,a.height=o.height*s,O2(i)?i(a):function(e){var n=e.getContext("2d"),i=e.width,o=e.height,s=i/16,a=o/16;n.beginPath();for(var h=0;h<16;h++)n.moveTo(0,h*a),n.lineTo(i,h*a),n.moveTo(h*s,0),n.lineTo(h*s,o);n.strokeStyle="rgba(180, 180, 180, 0.1)",n.lineWidth=1,n.stroke(),n.beginPath();var l=[[0,0],[i,0],[0,o],[i,o],[0,0],[0,o],[i,0],[i,o],[0,o/2],[i,o/2],[i/2,0],[i/2,o]];for(h=1;h<l.length;h+=2)n.moveTo(l[h-1][0],l[h-1][1]),n.lineTo(l[h][0],l[h][1]);n.lineWidth=4,n.stroke()}(a),a},n.prototype.setTerrainHelper=function(e){this._terrainHelper=e},n}(x7);function vot(){return!1}function _ot(e,n){return Math.abs(this._tileZoom-e.info.z)-Math.abs(this._tileZoom-n.info.z)}prt.registerRenderer("canvas",yot);var xot=new w5(0,0),bot={properties:{}},wot=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype.isDrawable=function(){return!0},n.prototype.needToRedraw=function(){var n=this.getMap();return!(!this.isGL()||n.getPitch()||!n.isZooming()||n.isMoving()||n.isRotating())||e.prototype.needToRedraw.call(this)},n.prototype.onDrawTileStart=function(e,n){var i=this.gl;if(i.enable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL),i.enable(i.POLYGON_OFFSET_FILL),i.enable(i.STENCIL_TEST),i.stencilOp(i.KEEP,i.KEEP,i.REPLACE),i.depthMask(!!this.layer.options.depthMask),n&&n.renderTarget){var o=n.renderTarget.fbo;if(o){var s=n.renderTarget.getFramebuffer(o);i.bindFramebuffer(i.FRAMEBUFFER,s)}}},n.prototype.onDrawTileEnd=function(e,n){var i=this.gl;n&&n.renderTarget&&(n.renderTarget.fbo&&i.bindFramebuffer(i.FRAMEBUFFER,null))},n.prototype.drawTile=function(n,i,o){if(!o||!o.sceneFilter||o.sceneFilter(bot)){var s=this.getMap();if(n&&s&&i){var a=n._glScale=n._glScale||n.res/s.getGLRes(),h=n.extent2d.xmax-n.extent2d.xmin,l=n.extent2d.ymax-n.extent2d.ymin;if(!1!==n.cache&&this._bindGLBuffer(i,h,l),this.isGL()){var c=n.offset,A=xot.set(n.extent2d.xmin-c[0],n.extent2d.ymax-c[1]),f=A.x*a,d=A.y*a,p=this.getTileOpacity(i,n),g=null;this.layer.options.debug&&(g=this.getDebugInfo(n.id));var v=this.gl;v.stencilFunc(v.LEQUAL,Math.abs(this.getCurrentTileZoom()-n.z),255);var w=this.layer.getPolygonOffset(),C=this.drawingCurrentTiles?w:w+1;v.polygonOffset(C,C),this.drawGLImage(i,f,d,h,l,a,p,g),this._getTileFadingOpacity(i)<1?this.setToRedraw():this.setCanvasUpdated()}else e.prototype.drawTile.call(this,n,i)}}},n.prototype._bindGLBuffer=function(e,n,i){e.glBuffer||(e.glBuffer=this.bufferTileData(0,0,n,i))},n.prototype.loadTileImage=function(e,n){var i=this.layer.options.crossOrigin;e.crossOrigin=null!==i?i:"",e.src=n},n.prototype.onCanvasCreate=function(){this.canvas.gl&&this.canvas.gl.wrap||this.createCanvas2()},n.prototype.createContext=function(){e.prototype.createContext.call(this),this.createGLContext()},n.prototype.resizeCanvas=function(n){this.canvas&&(e.prototype.resizeCanvas.call(this,n),this.resizeGLCanvas())},n.prototype.clearCanvas=function(){this.canvas&&(e.prototype.clearCanvas.call(this),this.clearGLCanvas())},n.prototype.getCanvasImage=function(){if(!this.isGL()||!this.canvas2)return e.prototype.getCanvasImage.call(this);var n=e.prototype.getCanvasImage.call(this);return n&&(n.image=this.canvas2),n},n.prototype.isGL=function(){if(this.canvas.gl&&this.canvas.gl.wrap)return!0;var e=this.getMap();return e&&(e.getPitch()||e.getBearing())||this.layer&&!!this.layer.options.fragmentShader},n.prototype.deleteTile=function(n){e.prototype.deleteTile.call(this,n),n&&n.image&&this.disposeImage(n.image),delete n.image},n.prototype.onRemove=function(){e.prototype.onRemove.call(this),this.removeGLCanvas()},n}(Brt(yot));function Cot(e){var n=this,i=this.layer.getTileSize(),o=this.canvas.constructor,s=this.getMap(),a=s.getDevicePixelRatio(),h=u6.createCanvas(i.width*a,i.height*a,o);h.layer=this.layer;var l=new w5(e.extent2d.xmin,e.extent2d.ymax),c=new y9(s.pointToCoordinate(l),s.pointToCoordinate(l.add(i.width,i.height)),s.getProjection());return this.layer.drawTile(h,{url:e.url,point:l,center:s.pointToCoordinate(l.add(i.width/2,i.height/2)),extent:c,z:e.z,x:e.x,y:e.y},(function(i){i?n.onTileError(h,e):n.onTileLoad(h,e)})),h}prt.registerRenderer("gl",wot);var Pot=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype.loadTile=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return Cot.apply(this,e)},n}(yot),Mot=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype.loadTile=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return Cot.apply(this,e)},n}(wot);Prt.registerRenderer("canvas",Pot),Prt.registerRenderer("gl",Mot);var Tot="undefined"!=typeof Int8Array?new Int8Array([-1,1,0,-1,-1,0,1,1,0,1,-1,0]):[];function Sot(e){return e instanceof Float32Array?"FLOAT":e instanceof Int16Array?"SHORT":e instanceof Uint16Array?"UNSIGNED_SHORT":e instanceof Int8Array?"BYTE":e instanceof Uint8Array||e instanceof Uint8ClampedArray?"UNSIGNED_BYTE":"FLOAT"}!function(){function e(e,n,i){this.gl=e,this.quadVertices=n||Tot,this.attributes=["a_position",3,Sot(n)],this.debug=i}e.prototype.start=function(){var e=this.gl;e.enable(e.STENCIL_TEST),e.stencilMask(255),e.stencilOp(e.KEEP,e.REPLACE,e.REPLACE),e.depthMask(!1),this._save(),this.buffer||(this._createBuffer(),this._createProgram()),e.useProgram(this.program),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),Srt(e,this.program,this.attributes),this.transformLoc||(this.transformLoc=e.getUniformLocation(this.program,"transform")),this.colorLoc||(this.colorLoc=e.getUniformLocation(this.program,"color")),this.debug||e.colorMask(!1,!1,!1,!1)},e.prototype.end=function(){var e=this.gl;e.depthMask(!0),this._restore(),this.debug||e.colorMask(!0,!0,!0,!0)},e.prototype.draw=function(e){var n=this.gl;n.uniformMatrix4fv(this.transformLoc,!1,e),n.uniform3fv(this.colorLoc,[Math.random(),Math.random(),Math.random()]),n.drawArrays(n.TRIANGLE_STRIP,0,4)},e.prototype.remove=function(){var e=this.gl;return this.buffer&&e.deleteBuffer(this.buffer),this.program&&(e.deleteShader(this.program.fragmentShader),e.deleteShader(this.program.vertexShader),e.deleteProgram(this.program)),delete this.transformLoc,delete this.gl,this},e.prototype.stencilMask=function(e){return this.gl.stencilMask(e),this},e.prototype.stencilFunc=function(e,n,i){return this.ref=n,this.gl.stencilFunc(e,n,i),this},e.prototype.stencilOp=function(e,n,i){return this.gl.stencilOp(e,n,i),this},e.prototype.resetFunc=function(){return this.ref=1,this.gl.stencilFunc(this.gl.ALWAYS,1,255),this},e.prototype._save=function(){this._savedProgram=this.gl.program},e.prototype._restore=function(){var e=this.gl;e.program=this._savedProgram,e.program&&e.useProgram(e.program)},e.prototype._createBuffer=function(){var e=this.gl;if(this.buffer=e.createBuffer(),!this.buffer)throw new Error("Failed to create the buffer object");e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,this.quadVertices,e.STATIC_DRAW)},e.prototype._createProgram=function(){var e=Trt(this.gl,"\n    attribute vec3 a_position;\n    uniform mat4 transform;\n\n    void main()\n    {\n        gl_Position = transform * vec4(a_position, 1.0);\n    }\n","\n    precision mediump float;\n    uniform vec3 color;\n    void main()\n    {\n        gl_FragColor = vec4(color, 1.0);\n    }\n"),n=e.program,i=e.fragmentShader;n.vertexShader=e.vertexShader,n.fragmentShader=i,this.program=n}}();var Iot=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype.checkResources=function(){var e=this._geosToCheck||[];if(!this._resourceChecked&&this.layer._geoList&&E5(e,this.layer._geoList),!z5(e))return[];for(var n=[],i={},o=e.length-1;o>=0;o--){var s=e[o]._getExternalResources();if(s.length)if(this.resources)for(var a=0;a<s.length;a++){var h=s[a][0];this.resources.isResourceLoaded(s[a])||i[h]||(n.push(s[a]),i[h]=1)}else n.push.apply(n,v5([],y5(s),!1))}return this._resourceChecked=!0,delete this._geosToCheck,n},n.prototype.render=function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return this.layer._sortGeometries(),e.prototype.render.apply(this,n)},n.prototype._addGeoToCheckRes=function(e){e&&(Array.isArray(e)||(e=[e]),this._geosToCheck||(this._geosToCheck=[]),E5(this._geosToCheck,e))},n.prototype.onGeometryAdd=function(e){this._addGeoToCheckRes(e),Eot(this)},n.prototype.onGeometryRemove=function(e){Eot(this)},n.prototype.onGeometrySymbolChange=function(e){this._addGeoToCheckRes(e.target),Eot(this)},n.prototype.onGeometryShapeChange=function(e){Eot(this)},n.prototype.onGeometryPositionChange=function(e){Eot(this)},n.prototype.onGeometryZIndexChange=function(e){Eot(this)},n.prototype.onGeometryShow=function(e){Eot(this)},n.prototype.onGeometryHide=function(e){Eot(this)},n.prototype.onGeometryPropertiesChange=function(e){Eot(this)},n}(x7);function Eot(e){e.layer.options.drawImmediate&&e.render(),e.setToRedraw()}var Oot=new v9,Rot=[],Dot=new v9,kot=new $6;function Lot(e){if(!e)return null;var n=e.getContext("2d");return n.clearRect(0,0,e.width,e.height),n}function Fot(e){return e&&e.options.progressiveRender&&e.options.progressiveRenderDebug}var Not=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return p5(n,e),n.prototype.setToRedraw=function(){return e.prototype.setToRedraw.call(this),this._resetProgressiveRender(),this},n.prototype._geoIsCollision=function(e,n){if(!e)return!1;if(!e.options.collision)return!1;if(e.isPoint&&e.getContainerExtent){e.bbox||(e.bbox=[0,0,0,0]);var i=this.layer.options.collisionBufferSize,o=e.getContainerExtent();if(!o)return!1;if(e.bbox[0]=o.xmin-i,e.bbox[1]=o.ymin-i,e.bbox[2]=o.xmax+i,e.bbox[3]=o.ymax+i,n.collides(e.bbox))return!0;n.insertBox(e.bbox)}return!1},n.prototype.getImageData=function(){if(!this._lastRenderTime||C2()-this._lastRenderTime<32)return null;if(!this.context||!this.context.canvas)return null;if(!this._imageData){var e=this.context.canvas,n=e.width,i=e.height;try{this._imageData=this.context.getImageData(0,0,n,i)}catch(e){console.warn("hit detect failed with tainted canvas, some geometries have external resources in another domain:\n",e)}}return this._imageData},n.prototype.clearImageData=function(){this._imageData=null,delete this._imageData,this._lastRenderTime=C2()},n.prototype.checkResources=function(){for(var n=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];var s=e.prototype.checkResources.apply(this,i),a=this.layer.getStyle();return a&&(Array.isArray(a)||(a=[a]),a.forEach((function(e){for(var i=V4(e.symbol,!0),o=0,a=i.length;o<a;o++)n.resources.isResourceLoaded(i[o])||s.push(i[o])}))),s},n.prototype.needToRedraw=function(){if(this.isProgressiveRender()&&!this.renderEnd)return!0;var n=this.getMap();return!(!n.isInteracting()||!this.layer.options.enableAltitude)||!(n.isZooming()&&!n.isRotating()&&!n.getPitch()&&!this._hasPoint&&this.layer.constructor===Ent)&&e.prototype.needToRedraw.call(this)},n.prototype.draw=function(){if(this.getMap()){if(!this.layer.isVisible()||this.layer.isEmpty())return this.clearCanvas(),void this.completeRender();this.prepareCanvas(),this.drawGeos(),this.completeRender()}},n.prototype.isBlank=function(){return!!this.context&&(!this.isProgressiveRender()&&!this.context.canvas._drawn)},n.prototype.drawOnInteracting=function(){if(this._geosToDraw){this._updateMapStateCache(),this._updateDisplayExtent();var e=this.getMap(),n=this.layer.getCount(),i=this.mapStateCache.resolution;(e.isZooming()&&e.options.seamlessZoom&&void 0!==this._drawnRes&&i>1.5*this._drawnRes&&this._geosToDraw.length<n||e.isMoving()||e.isInteracting())&&(this.prepareToDraw(),this._batchConversionMarkers(this.mapStateCache.glRes),this._onlyHasPoint||this._checkGeos(),this._drawnRes=i),this._sortByDistanceToCamera(e.cameraPosition);var o=this.layer.options,s=o.collisionDelay;if(o.collision){var a=C2();this._lastCollisionTime||(this._lastCollisionTime=a),a-this._lastCollisionTime<=s?this._geosToDraw=this._lastGeosToDraw||this._geosToDraw:(this._collidesGeos(),this._lastCollisionTime=a)}for(var h=0,l=this._geosToDraw.length;h<l;h++){var c=this._geosToDraw[h];c._isCheck||c.isVisible()?(c._paint(this._displayExtent),this._geosToDraw[h]._cPoint=void 0,this._geosToDraw[h]._inCurrentView=void 0):(delete c._cPoint,delete c._inCurrentView)}this.clearImageData(),this._lastGeosToDraw=this._geosToDraw,Fot(this.layer)&&console.log("progressiveRender on drawOnInteracting page:",this.page)}},n.prototype.show=function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];this.layer.forEach((function(e){e._repaint()})),e.prototype.show.apply(this,n)},n.prototype.forEachGeo=function(e,n){this.layer.forEach(e,n)},n.prototype._checkGeos=function(){for(var e=this._getCurrentNeedRenderGeos(),n=0,i=e.length;n<i;n++)this.checkGeo(e[n]);return this},n.prototype.drawGeos=function(){this._drawSnapshot(),this._updateMapStateCache(),this._drawnRes=this.mapStateCache.resolution,this._updateDisplayExtent(),this.prepareToDraw(),this._batchConversionMarkers(this.mapStateCache.glRes),this._onlyHasPoint||this._checkGeos(),this._sortByDistanceToCamera(this.getMap().cameraPosition),this._collidesGeos();for(var e=0,n=this._geosToDraw.length;e<n;e++)this._geosToDraw[e]._paint(),this._geosToDraw[e]._cPoint=void 0,this._geosToDraw[e]._inCurrentView=void 0;this.clearImageData(),this._lastGeosToDraw=this._geosToDraw,Fot(this.layer)&&console.log("progressiveRender drawGeos page:",this.page),this._snapshot(),this._setDrawGeosDrawTime()},n.prototype.prepareToDraw=function(){return this.layer._drawTime=C2(),this._hasPoint=!1,this._geosToDraw=[],this},n.prototype._setDrawGeosDrawTime=function(){for(var e=C2(),n=this.layer._drawTime,i=this.getGeoPainterList(),o=0,s=i.length;o<s;o++){var a=i[o];a&&a._setDrawTime&&a._setDrawTime(n)}return Fot(this.layer)&&console.log("_setDrawGeosDrawTime time:",C2()-e+"ms"),this},n.prototype.checkGeo=function(e){if(e.isPoint&&void 0!==this._onlyHasPoint)(e._inCurrentView||e.hasAltitude())&&(this._hasPoint=!0,e._isCheck=!0,this._geosToDraw.push(e));else if(e._isCheck=!1,e&&e.isVisible()&&e.getMap()&&e.getLayer()&&e.getLayer().isCanvasRender()){var n=e._getPainter(),i=!0;if(e._inCurrentView||!M2(e.options.arcDegree)||e.hasAltitude())i=!0;else if(!1===e._inCurrentView)i=!1;else{var o=n.get2DExtent(this.resources,Oot);o&&o.intersects(this._displayExtent)||(i=!1)}i&&(n.hasPoint()&&(this._hasPoint=!0),e._isCheck=!0,this._geosToDraw.push(e))}},n.prototype._collidesGeos=function(){if(!this.layer.options.collision)return this;var e=this.layer.options.collisionScope,n=this.layer.getMap(),i="map"===e?n.getCollisionIndex():kot;i===kot&&i.clear();var o=this._geosToDraw;this._geosToDraw=[];for(var s=0,a=o.length;s<a;s++)this._geoIsCollision(o[s],i)||this._geosToDraw.push(o[s]);return this},n.prototype.onZoomEnd=function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];delete this.canvasExtent2D,e.prototype.onZoomEnd.apply(this,n)},n.prototype.onRemove=function(){this.forEachGeo((function(e){e.onHide()})),delete this._geosToDraw,delete this.snapshotCanvas,delete this.pageGeos,delete this.geoPainterList},n.prototype.onGeometryPropertiesChange=function(n){n&&this.layer._styleGeometry(n.target),e.prototype.onGeometryPropertiesChange.call(this,n)},n.prototype._updateDisplayExtent=function(){var e=this.canvasExtent2D;if(this._maskExtent){if(!this._maskExtent.intersects(e))return void this.completeRender();e=e.intersection(this._maskExtent)}this._displayExtent=e},n.prototype.identifyAtPoint=function(e,n){void 0===n&&(n={});var i=this.getGeosForIdentify();return i?this.layer._hitGeos(i,e,n):[]},n.prototype._updateMapStateCache=function(){var e=this.getMap(),n=e._pointToContainerPoint(this.middleWest)._add(0,-e.height/2),i=e.getResolution(),o=e.getPitch(),s=e.getBearing(),a=e.getGLScale(),h=e.getGLRes(),l=e.getContainerExtent(),c=e.get2DExtent(),A=e.get2DExtentAtRes(h);return this.mapStateCache={resolution:i,pitch:o,bearing:s,glScale:a,glRes:h,_2DExtent:c,glExtent:A,containerExtent:l,offset:n},this},n.prototype._batchConversionMarkers=function(e){if(this._onlyHasPoint=void 0,!this._constructorIsThis())return[];var n=[],i=[],o=[],s={},a=this.layer,h=a.options,l=a.getAltitude?a.getAltitude():0,c=a.isCanvasRender();this._onlyHasPoint=!0;for(var A=0,f=this._getCurrentNeedRenderGeos(),d=0,p=f.length;d<p;d++){if((L=f[d]).isPoint){var g=L._painter;g||(g=L._getPainter());var v=g.getRenderPoints("center")[0][0],w=h.enableAltitude?L._getAltitude():l;void 0===s[w]&&(s[w]=g.getAltitude()),n[A]=v,o[A]=s[w],i[A]=L,A++}else this._onlyHasPoint=!1}if(0===A)return[];var C=this.getMap(),P=X5(n,"_pt");P=C._pointsAtResToContainerPoints(n,e,o,P);var T=C.getContainerExtent(),S=T.xmax,I=T.ymax,E=T.xmin,O=T.ymin,k={};for(d=0,p=i.length;d<p;d++){var L;if((L=i[d])._cPoint=P[d],L._cPoint){var F=P[d],N=F.x,z=F.y;if(L._inCurrentView=N>=E&&z>=O&&N<=S&&z<=I||L.hasAltitude(),!L._inCurrentView){var H=L.getSymbolHash(),j=void 0;j=H?k[H]=k[H]||L._painter.getFixedExtent():L._painter.getFixedExtent(),Dot.set(j.xmin,j.ymin,j.xmax,j.ymax),Dot._add(P[d]),L._inCurrentView=Dot.intersects(T)}L._inCurrentView&&(L.isVisible()&&c||(L._inCurrentView=!1),this._onlyHasPoint&&L._inCurrentView&&(this._hasPoint=!0,L._isCheck=!0,this._geosToDraw.push(L)))}else L._inCurrentView=!1}return P},n.prototype._sortByDistanceToCamera=function(e){if(this.layer.options.sortByDistanceToCamera&&this._geosToDraw.length){var n=this.getMap(),i=n.distanceToPoint(1e3,0,n.getGLScale()).x/1e3,o="center";this._geosToDraw.sort((function(n,s){if(!n.isPoint||!s.isPoint)return 0;var a=n._painter,h=s._painter;if(!a||!h)return 0;var l=a.getRenderPoints(o)[0][0],c=h.getRenderPoints(o)[0][0],A=a.getAltitude()*i,f=h.getAltitude()*i;Gnt(Rot,l.x,l.y,A);var d=Xnt(Rot,e);return Gnt(Rot,c.x,c.y,f),Xnt(Rot,e)-d}))}},n.prototype._constructorIsThis=function(){return this.constructor===n},n.prototype.isProgressiveRender=function(){var e=this.layer;if(!e)return!1;var n=e.options||{};return!n.collision&&n.progressiveRender},n.prototype.getGeosForIdentify=function(){return this.isProgressiveRender()?this.pageGeos||[]:this._geosToDraw||[]},n.prototype.getGeoPainterList=function(){if(!this.isProgressiveRender()){for(var e=[],n=this._geosToDraw||[],i=0,o=n.length;i<o;i++)e.push(n[i]._painter);return e}return this.geoPainterList||[]},n.prototype._checkSnapshotCanvas=function(){if(!this.isProgressiveRender())return delete this.snapshotCanvas,null;var e=this.canvas;if(!e)return delete this.snapshotCanvas,null;this.snapshotCanvas||(this.snapshotCanvas=u6.createCanvas(1,1));var n=this.snapshotCanvas,i=e.width,o=e.height,s=e.style;return n.width===i&&n.height===o||(n.width=i,n.height=o),n.style.width===s.width&&n.style.height===s.height||(n.style.width=s.width,n.style.height=s.height),n},n.prototype._getCurrentNeedRenderGeos=function(){var e=this.layer._geoList||[];if(!this.isProgressiveRender())return e;var n=this.layer.options.progressiveRenderCount,i=this.page;return e.slice((i-1)*n,i*n)},n.prototype._resetProgressiveRender=function(){Fot(this.layer)&&console.log("progressiveRender resetProgressiveRender"),this.renderEnd=!1,this.page=1,this.pageGeos=[],this.geoPainterList=[],this.maxTolerance=0,this._clearSnapshotCanvas()},n.prototype._clearSnapshotCanvas=function(){var e=this._checkSnapshotCanvas();e&&Lot(e)},n.prototype._snapshot=function(){for(var e=this.isProgressiveRender(),n=this._geosToDraw||[],i=0,o=n.length;i<o;i++){var s=n[i],a=s._hitTestTolerance()||0;if(this.maxTolerance=Math.max(this.maxTolerance,a),e)this.pageGeos.push(s),this.geoPainterList.push(s._painter)}if(!e)return this;var h=C2(),l=this._checkSnapshotCanvas();l&&this.canvas&&Lot(l).drawImage(this.canvas,0,0);var c=this.layer,A=Math.ceil((c._geoList||[]).length/c.options.progressiveRenderCount);return this.renderEnd=this.page>=A,this.renderEnd&&this._setDrawGeosDrawTime(),Fot(this.layer)&&console.log("snapshot time:",C2()-h+"ms"),this.renderEnd||this.page++,this},n.prototype._drawSnapshot=function(){if(!this.isProgressiveRender())return this;var e=this.snapshotCanvas,n=this.context;if(!e||!n)return this;var i=this.getMap();if(!i)return this;var o=i.getDevicePixelRatio()||1;return this._canvasContextScale(n,1/o),n.drawImage(e,0,0),this._canvasContextScale(n,o),this},n}(Iot);Ent.registerRenderer("canvas",Not);var zot=function(e){function n(n){var i=e.call(this)||this;return i.map=n,i._handlerQueue=[],i._thisDocVisibilitychange=i._onDocVisibilitychange.bind(i),i._thisDocDragStart=i._onDocDragStart.bind(i),i._thisDocDragEnd=i._onDocDragEnd.bind(i),i._thisDocDPRChange=i._onDocDPRChange.bind(i),i}return p5(n,e),n.prototype.callInNextFrame=function(e){this._handlerQueue.push(e)},n.prototype.executeFrameCallbacks=function(){var e=this._handlerQueue;this._handlerQueue=[];for(var n=0,i=e.length;n<i;n++)e[n]()},n.prototype.offsetPlatform=function(e,n){if(!this.map.getPanels().front)return this;if(!n&&0===e.x&&0===e.y)return this;var i=this.map.getPanels(),o=this._frontCount=i.back.layerDOM.childElementCount,s=this._backCount=i.front.layerDOM.childElementCount,a=this._uiCount=i.front.uiDOM.childElementCount;if(o||s||a){var h=this.map.offsetPlatform();h=e?h.add(e)._round():h.round(),s&&B3(i.back,h),(o||a)&&B3(i.front,h)}return this},n.prototype.domChanged=function(){var e=this.map.getPanels();return!!e.front&&(void 0===this._frontCount||this._frontCount!==e.back.layerDOM.childElementCount||(void 0===this._backCount||this._backCount!==e.front.layerDOM.childElementCount||(void 0===this._uiCount||this._uiCount!==e.front.uiDOM.childElementCount)))},n.prototype.resetContainer=function(){if(this.map&&(this.map._resetMapViewPoint(),this.map.getPanels().front)){var e=new w5(0,0);B3(this.map.getPanels().back,e),B3(this.map.getPanels().front,e)}},n.prototype.onZoomEnd=function(){this.resetContainer()},n.prototype.onLoad=function(){this._frameLoop()},n.prototype._onDocVisibilitychange=function(){"visible"===document.visibilityState&&this.setToRedraw()},n.prototype._getWrapPanel=function(){if(!this.map)return null;var e=this.map.getPanels();return e&&e.mapWrapper},n.prototype._onDocDragStart=function(){var e=this._getWrapPanel();e&&(e.style.overflow="visible")},n.prototype._onDocDragEnd=function(){var e=this._getWrapPanel();e&&(e.style.overflow="hidden")},n.prototype._onDocDPRChange=function(){var e=this.map;e&&e.options&&!e.options.devicePixelRatio&&e.checkSize&&e.getRenderer&&(e.getRenderer()&&e.checkSize(!0))},n.prototype._containerIsOffscreen=function(){var e=this.map.getContainer();return!e||!e.style||"none"===e.style.display||Math.min(e.clientWidth,e.clientHeight)<=0},n}(v6),Bot=new $6,Hot=function(e){function n(n){var i=e.call(this,n)||this;return i._containerIsCanvas=!!n.getContainer().getContext,i._registerEvents(),i._loopTime=0,i._resizeEventList=[],i._resizeTime=-1/0,i._frameCycleRenderCount=0,i}return p5(n,e),n.prototype.load=function(){this.initContainer()},n.prototype.renderFrame=function(e){var n=this.map;if(!n||!n.options.renderable)return!1;if(this._handleResizeEventList(e),n.options.stopRenderOnOffscreen&&this._containerIsOffscreen())return!0;this._updateDomPosition(e),delete this._isViewChanged,n._fireEvent("framestart"),this.updateMapDOM(),n.clearCollisionIndex();var i=this._getAllLayerToRender();return this.drawLayers(i,e),this.drawLayerCanvas(i)&&(this.drawTops(),this._drawCenterCross(),n.options.debugSky&&this._debugSky()),this._needClear=!1,n._fireEvent("frameend"),this._recordView(),this._mapview=this._getMapView(),delete this._spatialRefChanged,this._fireLayerLoadEvents(),this.executeFrameCallbacks(),this._canvasUpdated=!1,n.uiCollides(),!0},n.prototype.getFrameTimestamp=function(){return this._frameTimestamp||0},n.prototype.updateMapDOM=function(){var e=this.map;if(!e.isZooming()){var n=e.getViewPointFrameOffset();n?e.offsetPlatform(n):this.domChanged()&&this.offsetPlatform(null,!0)}},n.prototype._needRedrawAllLayers=function(e){var n=this;if(this.isSpatialReferenceChanged())return!0;var i=[];e.forEach((function(e){if(e&&(e._toRedraw=n._checkLayerRedraw(e))){i.push(e);var o=e.getLayers&&e.getLayers();o&&Array.isArray(o)&&E5(i,o)}}));for(var o=0,s=i.length;o<s;o++){var a=i[o],h=a&&a.options;if(h&&h.collision&&"map"===h.collisionScope)return!0}return!1},n.prototype.drawLayers=function(e,n){for(var i=this._needRedrawAllLayers(e),o=this.map,s=o.isInteracting(),a=[],h=[],l=o.options.fpsOnInteracting||0,c=0===l?0:1e3/l,A=this.map.options.layerCanvasLimitOnInteracting,f=e.length,d=o.getBaseLayer(),p=0,g=0;g<f;g++){var v=e[g];if(v.isVisible()){var w=v.isCanvasRender();w&&a.push(v.getId());var C=v._getRenderer();if(C){var P=i||v._toRedraw;w&&C.isCanvasUpdated()&&(P||h.push(v.getId()),this.setLayerCanvasUpdated());var T=C.__zoomTransformMatrix;if(delete C.__zoomTransformMatrix,P){if(s&&w){if(A>0&&f-1-g>A&&v!==d){v._getRenderer().clearCanvas();continue}p+=this._drawCanvasLayerOnInteracting(v,p,c,n)}else s&&C.drawOnInteracting?(C.prepareRender&&C.prepareRender(),C.checkAndDraw?C.checkAndDraw(C.drawOnInteracting,this._eventParam,n):C.drawOnInteracting(this._eventParam,n)):(C.render(n),w&&T&&C.isLoadingResource()&&(C.__zoomTransformMatrix=T));w&&(h.push(v.getId()),this.setLayerCanvasUpdated())}else w&&s&&(o.isZooming()&&!o.getPitch()?(C.prepareRender(),C.__zoomTransformMatrix=this._zoomMatrix):(o.getPitch()||o.isRotating())&&C.clearCanvas())}}}var S=this._canvasIds||[],I=this._updatedIds||[];if(this._canvasIds=a,this._updatedIds=h,!this.isLayerCanvasUpdated()){var E="---";S.join(E)===a.join(E)&&I.join(E)===h.join(E)||this.setLayerCanvasUpdated()}},n.prototype._checkLayerRedraw=function(e){if(this.isSpatialReferenceChanged())return!0;var n=this.map,i=e._getRenderer();return!!i&&(e.isCanvasRender()?i.testIfNeedRedraw():!(!i.needToRedraw||!i.needToRedraw())||(n.isInteracting()||this.isViewChanged()))},n.prototype._drawCanvasLayerOnInteracting=function(e,n,i,o){var s=this.map,a=e._getRenderer(),h=a.getDrawTime(),l=0===i||i>0&&n+h<=i;if(a.mustRenderOnInteracting&&a.mustRenderOnInteracting())a.render(o);else{if(a.drawOnInteracting&&(e===s.getBaseLayer()||l||s.isZooming()&&e.options.forceRenderOnZooming||s.isMoving()&&e.options.forceRenderOnMoving||s.isRotating()&&e.options.forceRenderOnRotating))return a.prepareRender(),a.prepareCanvas(),a.checkAndDraw?a.checkAndDraw(a.drawOnInteracting,this._eventParam,o):a.drawOnInteracting(this._eventParam,o),h;!s.isZooming()||s.getPitch()||s.isRotating()?(s.getPitch()||s.isRotating())&&a.clearCanvas():(a.prepareRender(),a.__zoomTransformMatrix=this._zoomMatrix)}return a.drawOnInteracting&&!l&&a.onSkipDrawOnInteracting(this._eventParam,o),0},n.prototype._fireLayerLoadEvents=function(){if(this._updatedIds&&this._updatedIds.length>0){var e=this.map;this._updatedIds.reverse().forEach((function(n){var i=e.getLayer(n);if(i){var o=i._getRenderer();o&&o.isRenderComplete()&&i.fire("layerload")}}))}},n.prototype.isLayerCanvasUpdated=function(){return this._canvasUpdated},n.prototype.setLayerCanvasUpdated=function(){this._canvasUpdated=!0},n.prototype.drawLayerCanvas=function(e){var n=this.map;if(!n)return!1;if(!this.isLayerCanvasUpdated()&&!this.isViewChanged()&&!1===this._needClear)return!1;this.canvas||this.createCanvas(),n._fireEvent("renderstart",{context:this.context}),this._updateCanvasSize()||this.clearCanvas();for(var i,o=n.isInteracting(),s=n.options.layerCanvasLimitOnInteracting,a=e.length,h=[],l=0;l<a;l++){if(e[l].isVisible()&&e[l].isCanvasRender())if(e[l]._getRenderer()){var c=this._getLayerImage(e[l]);c&&c.image&&(e[l]===n.getBaseLayer()?i=[e[l],c]:h.push([e[l],c]))}}var A=this.canvas.width,f=this.canvas.height;i&&(this._drawLayerCanvasImage(i[0],i[1],A,f),this._drawFog()),a=h.length;for(l=o&&s>=0&&a>s?a-s:0;l<a;l++)this._drawLayerCanvasImage(h[l][0],h[l][1],A,f);return n._fireEvent("renderend",{context:this.context}),!0},n.prototype.setToRedraw=function(){var e=this._getAllLayerToRender();this._needClear=!0;for(var n=0,i=e.length;n<i;n++){var o=e[n].getRenderer();o&&o.canvas&&o.setToRedraw&&o.setToRedraw()}},n.prototype.updateMapSize=function(e){if(e&&!this._containerIsCanvas){var n=e.width+"px",i=e.height+"px",o=this.map.getPanels();o.mapWrapper.style.width=n,o.mapWrapper.style.height=i,this._updateCanvasSize()}},n.prototype.getMainPanel=function(){return this.map?this._containerIsCanvas?this.map.getContainer():this.map.getPanels()?this.map.getPanels().mapWrapper:null:null},n.prototype.toDataURL=function(e,n){return this.canvas?this.canvas.toDataURL(e,n):null},n.prototype.remove=function(){f5.webgl&&"undefined"!=typeof document&&(x6.off(b6,this._thisDocDPRChange,this),x6.off(w6,this._thisDocVisibilitychange,this),x6.off(C6,this._thisDocDragStart,this),x6.off(P6,this._thisDocDragEnd,this)),this._resizeInterval&&clearInterval(this._resizeInterval),this._resizeObserver&&this._resizeObserver.disconnect(),delete this.context,delete this.canvas,delete this.map,delete this._spatialRefChanged,this._cancelFrameLoop()},n.prototype.hitDetect=function(e){var n=this.map;if(n&&n.options.hitDetect&&!n.isInteracting()){var i=n._getLayers(),o="default",s=n.options.hitDetectLimit||0,a=0;e&&e._round&&e._round();for(var h=i.length-1;h>=0;h--){var l=i[h];if(!(!l.options.hitDetect||l.isEmpty&&l.isEmpty())&&l.options.geometryEvents){var c=l._getRenderer();if(c&&c.hitDetect&&(!c.isBlank||!c.isBlank())){if("default"!==l.options.cursor&&c.hitDetect(e)){o=l.options.cursor||"pointer";break}if(a++,s>0&&a>s)break}}}n._trySetCursor(o)}},n.prototype._getLayerImage=function(e){var n=e._getRenderer();return n.getCanvasImage?n.getCanvasImage():null},n.prototype.initContainer=function(){var e=this.map.getPanels();function n(n,i,o,s){var a=O3("div",i);return o&&(a.style.cssText=o),e[n]=a,s||function(e){e.onselectstart=function(){return!1},e.ondragstart=function(){return!1},e.setAttribute("unselectable","on")}(a),a}var i=this.map.getContainer();if(!this._containerIsCanvas){i.innerHTML="";var o="position:absolute;top:0px;left:0px;",s=n("mapWrapper","maptalks-wrapper","position:absolute;overflow:hidden;",!0),a=n("allLayers","maptalks-all-layers",o+"padding:0px;margin:0px;z-index:0;overflow:visible;",!0),h=n("backStatic","maptalks-back-static",o+"z-index:0;",!0),l=n("back","maptalks-back",o+"z-index:1;"),c=n("backLayer","maptalks-back-layer",o),A=n("canvasContainer","maptalks-canvas-layer",o+"border:none;z-index:2;"),f=n("frontStatic","maptalks-front-static",o+"z-index:3;",!0),d=n("front","maptalks-front",o+"z-index:4;",!0),p=n("frontLayer","maptalks-front-layer",o+"z-index:0;"),g=n("ui","maptalks-ui",o+"border:none;z-index:1;",!0),v=n("control","maptalks-control","z-index:1",!0);i.appendChild(s),a.appendChild(h),l.appendChild(c),l.layerDOM=c,a.appendChild(l),a.appendChild(A),d.appendChild(p),d.layerDOM=p,d.uiDOM=g,a.appendChild(f),a.appendChild(d),d.appendChild(g),s.appendChild(a),s.appendChild(v),this.createCanvas(),this.resetContainer();var w=this.map._getContainerDomSize();this.updateMapSize(w)}},n.prototype.isViewChanged=function(){if(void 0!==this._isViewChanged)return this._isViewChanged;var e=this._mapview,n=this._getMapView();return this._isViewChanged=!e||!q5(e,n),this._isViewChanged},n.prototype._recordView=function(){var e=this.map;!e._onViewChange||e.isInteracting()||e.isAnimating()||q5(e.getView(),e._getCurrentView())||e._onViewChange(e.getView())},n.prototype.isSpatialReferenceChanged=function(){return this._spatialRefChanged},n.prototype._getMapView=function(){var e=this.map,n=e._getPrjCenter();return{x:n.x,y:n.y,zoom:e.getZoom(),pitch:e.getPitch(),bearing:e.getBearing(),width:e.width,height:e.height}},n.prototype._lockFrameRenderEnable=function(){var e=(this.map.options||{}).maxFPS;if(e<=0||w2.maxFPS<=e)return!0;var n=Math.ceil(w2.maxFPS/e);return this._frameCycleRenderCount>=n},n.prototype._frameLoop=function(e){var n=this;this.map?(this._frameCycleRenderCount++,this._lockFrameRenderEnable()?(this._frameTimestamp=e=e||0,this._resizeCount=0,this.renderFrame(e),this._frameCycleRenderCount=0):this.map.options.debug&&console.log("skip frame ing,frameCycleRenderCount:",this._frameCycleRenderCount),this._animationFrame=_5((function(e){n._frameLoop(e)}))):this._cancelFrameLoop()},n.prototype._cancelFrameLoop=function(){this._animationFrame&&x5(this._animationFrame)},n.prototype._drawLayerCanvasImage=function(e,n,i,o){var s=this.context,a=n.point.round(),h=this.map.getDevicePixelRatio();1!==h&&a._multi(h);var l=n.image,c=l.width,A=l.height;if(!(a.x+c<=0||a.y+A<=0)){var f=e.options.opacity;if(T2(f)||(f=1),!(f<=0)){var d=n.opacity;if(T2(d)||(d=1),!(d<=0)){var p=s.globalAlpha;f<1&&(s.globalAlpha*=f),d<1&&(s.globalAlpha*=d),e.options.cssFilter&&(s.filter=e.options.cssFilter);var g=e.getRenderer(),v=g.__zoomTransformMatrix,w=g.clipCanvas(this.context);v&&(s.save(),s.setTransform.apply(s,v5([],y5(v),!1))),s.drawImage(l,0,0,c,A,a.x,a.y,i,o),v&&s.restore(),w&&s.restore(),"none"!==s.filter&&(s.filter="none"),s.globalAlpha=p}}}},n.prototype._drawCenterCross=function(){var e=this.map.options.centerCross;if(e){var n=this.context,i=new w5(this.canvas.width/2,this.canvas.height/2);O2(e)?e(n,i):u6.drawCross(this.context,i.x,i.y,2,"#f00")}},n.prototype._drawContainerExtent=function(){var e=this.map.options.cascadePitches,n=this.map.height-this.map._getVisualHeight(e[0]),i=this.map.height-this.map._getVisualHeight(e[1]),o=this.map.getContainerExtent(),s=this.context;s.beginPath(),s.moveTo(0,o.ymin),s.lineTo(o.xmax,o.ymin),s.stroke(),s.beginPath(),s.moveTo(0,n),s.lineTo(o.xmax,n),s.stroke(),s.beginPath(),s.moveTo(0,i),s.lineTo(o.xmax,i),s.stroke()},n.prototype._drawFog=function(){var e=this.map;if(!(e.getPitch()<=e.options.maxVisualPitch)&&e.options.fog){var n=e.getDevicePixelRatio(),i=this.context,o=e.getContainerExtent(),s=(e.height-e._getVisualHeight(75))*n;s<0&&(s=0);var a=o.ymin*n,h=Math.ceil(a-s),l=e.options.fogColor.join(),c=i.createLinearGradient(0,s,0,a+30),A=1-30/(h+30);c.addColorStop(0,"rgba(".concat(l,", 0)")),c.addColorStop(.3,"rgba(".concat(l,", 0.3)")),c.addColorStop(A,"rgba(".concat(l,", 1)")),c.addColorStop(1,"rgba(".concat(l,", 0)")),i.beginPath(),i.fillStyle=c,i.fillRect(0,s,Math.ceil(o.getWidth())*n,Math.ceil(h+30))}},n.prototype._debugSky=function(){var e=this.map;if(!e)return this;var n=e.getContainerExtent().ymin;if(n<=0)return this;var i=this.context;return i.strokeStyle="red",i.strokeRect(0,0,e.width,n),this},n.prototype._getAllLayerToRender=function(){return this.map._getLayers()},n.prototype.clearCanvas=function(){this.canvas&&u6.clearRect(this.context,0,0,this.canvas.width,this.canvas.height)},n.prototype._updateCanvasSize=function(){if(!this.canvas||this._containerIsCanvas)return!1;var e=this.map,n=e.getSize(),i=this.canvas,o=$5(n,e.getDevicePixelRatio()),s=o.width,a=o.height,h=o.cssWidth,l=o.cssHeight;return!i.style||i.style.width===h&&i.style.height===l||(i.style.width=h,i.style.height=l),(s!==i.width||a!==i.height)&&(i.height=a,i.width=s,this.topLayer.width=i.width,this.topLayer.height=i.height,!0)},n.prototype.createCanvas=function(){this.topLayer=O3("canvas"),this.topCtx=this.topLayer.getContext("2d"),this._containerIsCanvas?this.canvas=this.map.getContainer():(this.canvas=O3("canvas"),this._updateCanvasSize(),this.map.getPanels().canvasContainer.appendChild(this.canvas)),this.context=this.canvas.getContext("2d")},n.prototype._updateDomPosition=function(e){return void 0===this._checkPositionTime&&(this._checkPositionTime=-1/0),Math.abs(e-this._checkPositionTime)>=500&&(H3(this.map.getContainer()),this._checkPositionTime=Math.min(e,this._checkPositionTime)),this},n.prototype._handleResizeEventList=function(e){if(!this._resizeEventList)return this;var n=this._resizeEventList.length;return 0===n||this._resizeTime&&e-this._resizeTime<60||(this.map.setContainerDomRect(this._resizeEventList[n-1].contentRect),this._resizeEventList=[],this._checkSize(),this._resizeCount=this._resizeCount||0,this.renderFrame((this._frameTimestamp||0)+ ++this._resizeCount/100),this._resizeTime=e),this},n.prototype._checkSize=function(){this.map&&this.map.checkSize()},n.prototype._setCheckSizeInterval=function(e){var n=this;f5.resizeObserver?(this._resizeObserver&&this._resizeObserver.disconnect(),this.map&&(this._resizeObserver=new ResizeObserver((function(e){!n.map||n.map.isRemoved()?n._resizeObserver.disconnect():e.length&&(n._resizeEventList=n._resizeEventList||[],n._resizeEventList.push(e[0]))})),this._resizeObserver.observe(this.map.getContainer()))):(clearInterval(this._resizeInterval),this._checkSizeInterval=e,this._resizeInterval=setInterval((function(){!n.map||n.map.isRemoved()?clearInterval(n._resizeInterval):n._checkSize()}),this._checkSizeInterval))},n.prototype._registerEvents=function(){var e=this,n=this.map;n.options.checkSize&&!b2&&"undefined"!=typeof window&&this._setCheckSizeInterval(n.options.checkSizeInterval),f5.mobile||n.on("_mousemove",this._onMapMouseMove,this),n.on("_dragrotatestart _dragrotating _dragrotateend _movestart _moving _moveend _zoomstart",(function(n){e._eventParam=n})),n.on("_zooming",(function(i){n.getPitch()||(e._zoomMatrix=i.matrix.container),e._eventParam=i})),n.on("_zoomend",(function(n){e._eventParam=n,delete e._zoomMatrix})),n.on("_spatialreferencechange",(function(){e._spatialRefChanged=!0})),f5.webgl&&"undefined"!=typeof document&&(x6.on(b6,this._thisDocDPRChange,this),x6.on(w6,this._thisDocVisibilitychange,this),x6.on(C6,this._thisDocDragStart,this),x6.on(P6,this._thisDocDragEnd,this))},n.prototype._onMapMouseMove=function(e){var n=this,i=this.map;!i.isInteracting()&&i.options.hitDetect&&(this._hitDetectFrame&&x5(this._hitDetectFrame),this._hitDetectFrame=_5((function(){n.hitDetect(e.containerPoint)})))},n.prototype._getCanvasLayers=function(){return this.map._getLayers((function(e){return e.isCanvasRender()}))},n.prototype.addTopElement=function(e){this._tops||(this._tops=[]),this._tops.push(e)},n.prototype.removeTopElement=function(e){if(this._tops){var n=this._tops.indexOf(e);n>=0&&this._tops.splice(n,1)}},n.prototype.getTopElements=function(){return this._tops||[]},n.prototype.sortTopElements=function(){this._tops=this._tops.sort((function(e,n){return(n.options.zIndex||0)-(e.options.zIndex||0)}))},n.prototype.drawTops=function(){this.topCtx.clearRect(0,0,this.topLayer.width,this.topLayer.height);var e=Bot;e.clear(),this.map.fire("drawtopstart"),this.map.fire("drawtops");for(var n=this.getTopElements(),i=!1,o=this.map.getDevicePixelRatio(),s=[],a=0;a<n.length;a++){var h=n[a];if(h.needCollision&&h.needCollision()){var l=h.getRenderBBOX(o);if(l){if(e.collides(l)){var c=h.target&&h.target._geometry;c&&-1===s.indexOf(c)&&(s.push(c),c.fire("handlecollision"));continue}e.insertBox(l)}}h.render(this.topCtx)&&(i=!0)}i&&this.context.drawImage(this.topLayer,0,0),this.map.fire("drawtopsend")},n}(zot);met.registerRenderer("canvas",Hot),met.mergeOptions({fog:!1,fogColor:[233,233,233]});var jot={_getRenderPoints:function(){return[[this._getCenter2DPoint(this.getMap().getGLRes())],null]}};Vet.include(jot),lnt.include(jot),ant.include(jot),cnt.include(jot),unt.include({_getRenderPoints:function(e){var n=this.getMap(),i=n.getGLRes();if("vertex"===e){for(var o=this._trimRing(this.getShell()),s=[],a=0,h=o.length;a<h;a++)s.push(n.coordToPointAtRes(o[a],i));return[s,null]}return[[n.coordToPointAtRes(this.getCenter(),i)],null]}});var Uot={_getRenderPoints:function(e){var n,i=this.getMap(),o=i.getGLRes(),s=null;if("point"===e)(n=this._getPath2DPoints(this._getPrjCoordinates(),!1,o))&&n.length>0&&Array.isArray(n[0])&&(n=n[0].concat(n[1]));else if("vertex"===e)if(s=[],(n=this._getPath2DPoints(this._getPrjCoordinates(),!1,o))&&n.length>0&&Array.isArray(n[0])){for(var a=0,h=n.length;a<h;a++)for(var l=0,c=n[a].length;l<c;l++)s.push(0===l?[n[a][l],n[a][l+1]]:[n[a][l-1],n[a][l]]);n=n[0].concat(n[1])}else for(a=0,h=n.length;a<h;a++)s.push(0===a?[n[a],n[a+1]]:[n[a-1],n[a]]);else if("line"===e){n=[],s=[];var A=this._getPath2DPoints(this._getPrjCoordinates(),!1,o);if(A.length>0&&Array.isArray(A[0])){var f=void 0;for(a=1,h=A.length;a<h;a++){f=A[a],this instanceof jet&&f.length>0&&!f[0].equals(f[f.length-1])&&f.push(f[0]);for(l=1,c=f.length;l<c;l++)n.push(f[l].add(f[l-1])._multi(.5)),s.push([f[l-1],f[l]])}}else{this instanceof jet&&A.length>0&&!A[0].equals(A[A.length-1])&&A.push(A[0]);for(a=1,h=A.length;a<h;a++)n.push(A[a].add(A[a-1])._multi(.5)),s.push([A[a-1],A[a]])}}else if("vertex-first"===e){var d=(h=(p=this._getPrjCoordinates()).length)?i._prjToPointAtRes(p[0],o):null;n=h?[d]:[],s=h?[[d,p[1]?i._prjToPointAtRes(p[1],o):d]]:[]}else if("vertex-last"===e){var p,g=(h=(p=this._getPrjCoordinates()).length)?i._prjToPointAtRes(p[h-1],o):null;n=h?[g]:[];var v=h>1?h-2:h-1;s=h?[[p[v]?i._prjToPointAtRes(p[v],o):g,g]]:[]}else{var w=this.getCenter();if(w){var C=this._getProjection().project(w);n=[i._prjToPointAtRes(C,o)]}else n=[]}return[n,s]}};qet.include(Uot),jet.include(Uot);var Got={within:!1,center:[0,0]};function Vot(e){if(e&&e._containerBbox){Got.within=!1;var n=e._containerBbox,i=n.minx,o=n.miny,s=n.maxx,a=n.maxy,h=Math.abs(s-i),l=Math.abs(a-o);h<=1&&l<=1&&(Got.within=!0,Got.center[0]=(i+s)/2,Got.center[1]=(o+a)/2),delete e._containerBbox}else Got.within=!1;return Got}function Wot(){var e=this._getPrjShell(),n=v8();b8(e,n);var i=y5(n,4);return new y9(i[0],i[1],i[2],i[3])}function qot(){var e=this._getPrjShell();if(!e||!Array.isArray(e))return[];var n=this._getProjection(),i=this.getCoordinates()||{};return e.map((function(e){var o=n.unproject(e);return o.z=i.z||0,o}))}net.include({_redrawWhenPitch:function(){return!1},_redrawWhenRotate:function(){return!1},_getRenderBBOX:function(e,n){return e.isHitTesting?null:(x8(_8),b8(n,_8),_8)}});var Zot={_redrawWhenPitch:function(){return!0},_redrawWhenRotate:function(){return this instanceof lnt||this instanceof cnt},_computeRotatedPrjExtent:Wot,getRotatedShell:qot,_paintAsPath:function(){if(this.isRotated())return!0;var e=this.getMap();return this._getAltitude()>0||e.getPitch()||this instanceof lnt&&e.getBearing()},_getPaintParams:function(){var e=this.getMap();if(this._paintAsPath())return jet.prototype._getPaintParams.call(this,!0);var n=this._getPrjCoordinates(),i=e._prjToPointAtRes(n,e.getGLRes());return v5([i],y5(this._getRenderSize(i)),!1)},_paintOn:function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return this._paintAsPath()?u6.polygon.apply(u6,v5([],y5(e),!1)):u6.ellipse.apply(u6,v5([],y5(e),!1))},_getRenderSize:function(e){var n=this.getMap(),i=n.getGLRes(),o=this._getPrjExtent(),s=n._prjToPointAtRes(o.getMin(),i),a=n._prjToPointAtRes(o.getMax(),i);return[Math.abs(a.x-s.x)/2,Math.abs(a.y-e.y),Math.abs(e.y-s.y)]}};lnt.include(Zot),ant.include(Zot),unt.include({_getPaintParams:function(){var e=this.getMap(),n=this._getPrjShell();return[this._getPath2DPoints(n,!1,e.getGLRes())]},_paintOn:u6.polygon,_computeRotatedPrjExtent:Wot,getRotatedShell:qot});var Qot={_redrawWhenPitch:function(){return!0},_getPaintParams:function(){if(this._paintAsPath())return jet.prototype._getPaintParams.call(this,!0);var e=this.getMap(),n=e._prjToPointAtRes(this._getPrjCoordinates(),e.getGLRes()),i=this._getRenderSize(n),o=y5(this._correctAngles(),2);return[n,i[0],[o[0],o[1]]]},_paintOn:function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(this._paintAsPath())return u6.polygon.apply(u6,v5([],y5(e),!1));var i=this.getMap().getBearing();return i&&(e[3]=e[3].slice(0),e[3][0]+=i,e[3][1]+=i),u6.sector.apply(u6,v5([],y5(e),!1))}};cnt.include(Zot,Qot),Bet.include({_paintAsPath:function(){return!0}});var Xot={arrowStyles:{classic:[3,4]},_getArrowShape:function(e,n,i,o,s){if(!e||!n||e.equals(n))return null;s||(s=0);var a,h=i*o[1]+s,l=i*o[0]/2+s;(a=n.sub(n.nextCtrlPoint||n.prevCtrlPoint?new w5(n.prevCtrlPoint?n.prevCtrlPoint:n.nextCtrlPoint):e))._unit();var c=n.sub(a.multi(h));a._perp();var A=c.add(a.multi(l));return a._multi(-1),[A,n,c.add(a.multi(l)),A]},_getPaintParams:function(){var e=this._getPrjCoordinates();return[this._getPath2DPoints(e,!1,this.getMap().getGLRes())]},_paintOn:function(e,n,i,o,s){var a=Vot(this._painter);return a.within?u6.pixelRect(e,a.center,i,o):this.options.smoothness?u6.paintSmoothLine(e,n,i,this.options.smoothness,!1,this._animIdx,this._animTailRatio):u6.path(e,n,i,null,s),this._paintArrow(e,n,i),this._getRenderBBOX(e,n)},_getArrowPlacement:function(){return this.options.arrowPlacement},_getArrowStyle:function(){var e=this.options.arrowStyle;return e?Array.isArray(e)?e:this.arrowStyles[e]:null},_getArrows:function(e,n,i){var o=this,s=this._getArrowStyle();if(!s||e.length<2)return[];for(var a,h,l=e.length>0&&Array.isArray(e[0])?e:[e],c=this._getArrowPlacement(),A=[],f=function(){if(a&&h){var e=o._getArrowShape(a,h,n,s,i);e&&A.push(e)}},d=l.length-1;d>=0;d--){var p=l[d],g=p.length,v=p[0],w=p[g-1];"vertex-first"===c?(a=v.arrowNextPoint||p[1],h=v):"vertex-last"===c&&(a=w.arrowPrePoint||p[g-2],h=w),f(),"vertex-firstlast"===c&&(a=v.arrowNextPoint||p[1],h=v,f(),a=w.arrowPrePoint||p[g-2],h=w,f()),"point"===c&&this._getArrowPoints(A,p,n,s,i)}return A},_getArrowPoints:function(e,n,i,o,s){for(var a=0,h=n.length-1;a<h;a++){var l=n[a+1],c=this._getArrowShape(l.arrowPrePoint||n[a],l,i,o,s);c&&e.push(c)}},_paintArrow:function(e,n,i){var o=this._getInternalSymbol().lineWidth;(!T2(o)||o<3)&&(o=3);var s=this._getArrows(n,o);if(s.length){e.setLineDash&&e.setLineDash([]);for(var a=s.length-1;a>=0;a--)e.fillStyle=e.strokeStyle,u6.polygon(e,s[a],i,i)}}};qet.include(Xot);var Yot={_getPaintParams:function(e){var n=this.getMap().getGLRes(),i=this._getPrjShell(),o=this._getPath2DPoints(i,e,n),s=o.length>0&&Array.isArray(o[0]);s&&(o=[[o[0]],[o[1]]]);var a=this._getPrjHoles(),h=[];if(a&&a.length>0){for(var l=this._simplified,c=0;c<a.length;c++){var A=this._getPath2DPoints(a[c],e,n);Array.isArray(A)&&s?Array.isArray(A[0])?(o[0].push(A[0]),o[1].push(A[1])):o[0].push(A):h.push(A)}l&&(this._simplified=l)}return s||E5(o=[o],h),[o]},_paintOn:function(e,n,i,o,s){var a=Vot(this._painter);return a.within?u6.pixelRect(e,a.center,i,o):u6.polygon(e,n,i,o,s,this.options.smoothness),this._getRenderBBOX(e,n)}};jet.include(Yot),met.VERSION="1.0.0-rc.35";
/*!
   * @maptalks/transform-control v0.102.1
   * LICENSE : UNLICENSED
   * (c) 2016-2024 maptalks.org
   */
const Jot={yuanhuan:{accessors:[{name:"_1_0_positions",componentType:5126,count:104,min:[-5.407599925994873,-5.404099941253662,0],max:[5.405200004577637,5.406300067901611,0],type:"VEC3",bufferView:0,byteOffset:0},{name:"_1_0_normals",componentType:5126,count:104,min:[0,0,1],max:[0,0,1],type:"VEC3",bufferView:1,byteOffset:0},{name:"_1_0_indices",componentType:5123,count:288,min:[0],max:[103],type:"SCALAR",bufferView:2,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"-",byteLength:3072,uri:"data:application/octet-stream;base64,KVyjQLbzPT4AAAAAZvesQLbzPT4AAAAAhsmqQC7/YT8AAAAAZ0ShQDC7Vz8AAAAA+u2lwGKhxr8AAAAArK2cwLpJvL8AAAAAEFihwB04V78AAAAAXdyqwE7RYb8AAAAAat6lQEaUxj8AAAAAApqcQG+BvD8AAAAAB18EQFOWlcAAAAAA+u0LQLBynsAAAAAARPoxQNSalMAAAAAAJzEoQIxKjMAAAAAAQBNVQFyPiMAAAAAAIEFJQMDsgMAAAAAA0950QK36dMAAAAAAejZnQFRSZ8AAAAAAXdyAQBBYScAAAAAA+n6IQI0oVcAAAAAAcoqUQAMJMsAAAAAAKjqMQIlBKMAAAAAAXdyAQFdbSUAAAAAA+n6IQDsBVUAAAAAA0950QBTQdEAAAAAAejZnQA5PZ0AAAAAA+n6IwI0oVcAAAAAAwOyAwBBYScAAAAAAXkuMwIlBKMAAAAAA0ZGUwAMJMsAAAAAA5j+8P9ejnMAAAAAAkDFXP65HocAAAAAA1JrGPz7opcAAAAAA/7I7PvhTo8AAAAAA/7I7PmPurMAAAAAAM8RhP/vLqsAAAAAADwutwLbzPT4AAAAA0m+jwLbzPT4AAAAAEFihwDC7Vz8AAAAAXdyqwC7/YT8AAAAArK2cwG+BvD8AAAAA+u2lwEaUxj8AAAAADXGewN/gC0AAAAAAa5qVwIV8BEAAAAAAXkuMwAFNKEAAAAAA0ZGUwD7oMUAAAAAAlIeVQIV8BEAAAAAAlWWeQN/gC0AAAAAAcoqUQD7oMUAAAAAAKjqMQAFNKEAAAAAAQBNVQBB6iEAAAAAAIEFJQKfogEAAAAAAW9N0wK36dMAAAAAAsVBnwFRSZ8AAAAAAlWWeQM/3C8AAAAAAlIeVQNxoBMAAAAAA+n6IwDsBVUAAAAAAwOyAwFdbSUAAAAAAsVBnwA5PZ0AAAAAAW9N0wBTQdEAAAAAAd74LwLBynsAAAAAAkxi8v9ejnMAAAAAAwFsEwFOWlcAAAAAARpRWv65HocAAAAAAayvGvz7opcAAAAAA2c43vvhTo8AAAAAA2c43vmPurMAAAAAAt9Fgv/vLqsAAAAAAt9Fgv7fRqkAAAAAAayvGvybkpUAAAAAAd74LwAponkAAAAAA2c43vv5lo0AAAAAA2c43vmkArUAAAAAARpRWvzxOoUAAAAAAkxi8v9ejnEAAAAAAOdYxwHKKlEAAAAAAwFsEwDqSlUAAAAAA+zoowNBEjEAAAAAAJlNJwKfogEAAAAAAUPxUwBB6iEAAAAAAat6lQGKhxr8AAAAAApqcQLpJvL8AAAAAhsmqQE7RYb8AAAAAZ0ShQB04V78AAAAAZvesQP+yO74AAAAAKVyjQP+yO74AAAAAM8RhP7fRqkAAAAAA/7I7PmkArUAAAAAA/7I7Pv5lo0AAAAAA+u0LQAponkAAAAAA1JrGPybkpUAAAAAAkDFXPzxOoUAAAAAA5j+8P9ejnEAAAAAARPoxQHKKlEAAAAAAB18EQDqSlUAAAAAAJzEoQNBEjEAAAAAA+zoowIxKjMAAAAAAOdYxwNSalMAAAAAAUPxUwFyPiMAAAAAAJlNJwMDsgMAAAAAAa5qVwNxoBMAAAAAADXGewM/3C8AAAAAA0m+jwP+yO74AAAAADwutwP+yO74AAAAAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAABAAIAAAACAAMABAAFAAYABAAGAAcAAwACAAgAAwAIAAkACgALAAwACgAMAA0ADQAMAA4ADQAOAA8ADwAOABAADwAQABEAEgATABQAEgAUABUAFgAXABgAFgAYABkAGgAbABwAGgAcAB0AHgALAAoAHwALAB4AHwAgAAsAIQAgAB8AIgAjACAAIgAgACEAJAAlACYAJAAmACcAJwAmACgAJwAoACkAKgArACwAKgAsAC0ALgAvADAALgAwADEAGQAYADIAGQAyADMANAA1ABsANAAbABoAFQAUADYAFQA2ADcAOAA5ADoAOAA6ADsAPAA9AD4APAA/AD0AQAA/ADwAQABBAD8AQgBBAEAAQgBAAEMARABFAEYARABGAEcARABHAEgARgBJAEcARgBKAEkASwBKAEYASwBMAEoASwBNAEwACQAIAC8ACQAvAC4ALQAsADkALQA5ADgAOwA6AE4AOwBOAE8ATwBOAE0ATwBNAEsAKQAoACsAKQArACoANwA2AFAANwBQAFEAUQBQAFIAUQBSAFMAUwBSAFQAUwBUAFUAVgBXAFgAVgBYAFkAVgBZAFoAWwBZAFgAXABZAFsAXABdAFkAXgBdAFwAXwBdAF4APAA+AGAAPABgAGEAMQAwABcAMQAXABYAYgBjADUAYgA1ADQAYQBgAGMAYQBjAGIAMwAyAF0AMwBdAF8AHQAcAGQAHQBkAGUAZQBkAAUAZQAFAAQAZgBnAAcAZgAHAAYAEQAQABMAEQATABIA"}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:1248,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:1248,byteOffset:1248,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:576,byteOffset:2496,target:34963}],materials:[{name:"SVGMat_001",pbrMetallicRoughness:{baseColorFactor:[.5,.5,.5,1],metallicFactor:0,roughnessFactor:1},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"_1",primitives:[{attributes:{POSITION:0,NORMAL:1},indices:2,material:0,mode:4}]}],nodes:[{name:"",mesh:0}],scene:0,scenes:[{nodes:[0]}]},yuanhuan41:{accessors:[{name:"_1_0_positions",componentType:5126,count:39,min:[0,0,0],max:[5.489999771118164,0,5.488900184631348],type:"VEC3",bufferView:0,byteOffset:0},{name:"_1_0_normals",componentType:5126,count:39,min:[0,-.999939501285553,-1],max:[.13969914615154266,1,1],type:"VEC3",bufferView:1,byteOffset:0},{name:"_1_0_indices",componentType:5123,count:105,min:[0],max:[38],type:"SCALAR",bufferView:2,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"yh41",byteLength:1148,uri:"data:application/octet-stream;base64,8tKXQAAAAACoNU09FK6vQAAAAAB1Ako/FK6vQAAAAAAAAACATfOAQAAAAAACmkg+K4dWQAAAAAAIrNw+WvUtQAAAAABbsT8/X5gIQAAAAACMSpI/OUWbQAAAAAD0/VQ/LbKHQAAAAAD0/XQ/W0JqQAAAAAC6SZQ/dLXNPwAAAACfq80/H4VHQAAAAAB0JLc/ZognQAAAAAA1XuI/YVSSPwAAAAAukAhABaMKQAAAAAB4nApABcU/PwAAAACF6y1Aw2TiPwAAAACRfidASS63PwAAAABKe0dAJLncPgAAAACze1ZAj1OUPwAAAADjNmpAAppIPgAAAADu64BAnRF1PwAAAAD8qYdAqDVNPQAAAADBypdAgQRVPwAAAAAIPZtAAAAAAAAAAAASpa9AAwlKPwAAAAASpa9AJJd/PAAAAAASpa9AAwlKPwAAAAASpa9AAAAAAAAAAAASpa9Asp1vPQAAAAASpa9AJLn8PQAAAAASpa9AqoJRPgAAAAASpa9ARwOYPgAAAAASpa9AHhbKPgAAAAASpa9A2hv8PgAAAAASpa9A5q4VPwAAAAASpa9A+n4qPwAAAAASpa9AQxw7PwAAAAASpa9AwhdGPwAAAAASpa9AAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAJ5X/OwL+fz8AAACAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIC/Kzs0PAn8f78AAACApLK/PA7uf78AAACAeJkZPefRfz8AAACA+ZldPQSgf78AAACA6XSTPelVfz8AAACALLO3PdT3fr8AAACAfkjZPR2Ofr8AAACANf32Paohfj8AAACAeUYHPqDBfT8AAACASw0PPlt9fb8AAACAAAABAAIAAwABAAAABAABAAMABQABAAQABgAHAAUABwABAAUABgAIAAcABgAJAAgACgAJAAYACgALAAkACgAMAAsADQAMAAoADQAOAAwADwAOAA0ADwAQAA4ADwARABAAEgARAA8AEgATABEAFAATABIAFAAVABMAFgAVABQAFgAXABUAGAAXABYAGAAZABcAGgAbABwAHQAbABoAHgAbAB0AHwAbAB4AIAAbAB8AIQAbACAAIgAbACEAIwAbACIAJAAbACMAJQAbACQAJgAbACUAAAA="}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:468,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:468,byteOffset:468,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:212,byteOffset:936,target:34963}],materials:[{name:"SVGMat_002",pbrMetallicRoughness:{baseColorFactor:[.588,.588,.588,1],metallicFactor:0,roughnessFactor:.99},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"_1",primitives:[{attributes:{POSITION:0,NORMAL:1},indices:2,material:0,mode:4}]}],nodes:[{name:"",mesh:0}],scene:0,scenes:[{nodes:[0]}]},yuanhuan411:{accessors:[{name:"_1_0_positions",componentType:5126,count:28,min:[.026000000536441803,-4.6834001541137695,0],max:[4.696700096130371,-.014800000004470348,0],type:"VEC3",bufferView:0,byteOffset:0},{name:"_1_0_normals",componentType:5126,count:28,min:[0,0,1],max:[0,0,1],type:"VEC3",bufferView:1,byteOffset:0},{name:"_1_0_indices",componentType:5123,count:78,min:[0],max:[27],type:"SCALAR",bufferView:2,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"yuanhuan411",byteLength:828,uri:"data:application/octet-stream;base64,ufwXQLN7Mr8AAAAAObRAQLFQK78AAAAA1ediQMWP8b4AAAAAGQQ6QCv2174AAAAAqFdeQHUCWr4AAAAA7FGCQL6fmr0AAAAAHHyDQDLmrr4AAAAAXkuWQJf/kL4AAAAAXkuWQLN7crwAAAAAMCrxP2RdhL8AAAAA/BgDQJeQn78AAAAADeARQAg9i78AAAAAukkIQISeXb8AAAAAZaogQH/Zbb8AAAAA7Q3ePr4wOcAAAAAA5IMuP9/gP8AAAAAAJQZxPwrXH8AAAAAAPZs1P6UsF8AAAAAAdy2hP0VHAsAAAAAAb/CFP5eQ778AAAAA0ES4P32utr8AAAAAAprQPyL9zr8AAAAAi/1lPqqCXcAAAAAA9dv3PtcSYsAAAAAADi2yPZvmgcAAAAAAYTK1PssQg8AAAAAA9P3UPGrelcAAAAAA4liXPmrelcAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAABAAIAAAACAAMAAwACAAQABQAGAAcABQAHAAgABAACAAYABAAGAAUACQAKAAsACQALAAwAAAANAAEADgAPABAADgAQABEAEQAQABIAEQASABMAFAAVAAoAFAAKAAkADAALAA0ADAANAAAAFgAXAA8AFgAPAA4AGAAZABcAGAAXABYAGgAZABgAGgAbABkAEwASABUAEwAVABQA"}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:336,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:336,byteOffset:336,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:156,byteOffset:672,target:34963}],materials:[{name:"SVGMat",pbrMetallicRoughness:{baseColorFactor:[.588,.588,.588,1],metallicFactor:0,roughnessFactor:.99},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"_1",primitives:[{attributes:{POSITION:0,NORMAL:1},indices:2,material:0,mode:4}]}],nodes:[{name:"",mesh:0}],scene:0,scenes:[{nodes:[0]}]},yuanpan:{accessors:[{name:"Circle001_1_0_positions",componentType:5126,count:28,min:[-1.9510999917984009,0,-1.9510999917984009],max:[1.9510999917984009,0,1.9510999917984009],type:"VEC3",bufferView:0,byteOffset:0},{name:"Circle001_1_0_normals",componentType:5126,count:28,min:[0,1,0],max:[0,1,0],type:"VEC3",bufferView:1,byteOffset:0},{name:"Circle001_1_0_indices",componentType:5123,count:78,min:[0],max:[27],type:"SCALAR",bufferView:2,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"yuanpan",byteLength:828,uri:"data:application/octet-stream;base64,S+rkvgAAAADRIvM/AAAAAAAAAAClvfk/S+rkPgAAAADRIvM/0SLzvwAAAABL6uQ+MlXgvwAAAACsi1s/c9fCvwAAAACvJZw/pb35vwAAAAAAAAAA0SLzvwAAAABL6uS+MlXgvwAAAACsi1u/c9fCvwAAAACvJZy/ryWcvwAAAABz18K/rItbvwAAAAAyVeC/S+rkvgAAAADRIvO/AAAAgAAAAAClvfm/S+rkPgAAAADRIvO/rItbPwAAAAAyVeC/ryWcPwAAAABz18K/c9fCPwAAAACvJZy/MlXgPwAAAACsi1u/0SLzPwAAAABL6uS+pb35PwAAAAAAAACA0SLzPwAAAABL6uQ+MlXgPwAAAACsi1s/c9fCPwAAAACvJZw/ryWcvwAAAABz18I/ryWcPwAAAABz18I/rItbvwAAAAAyVeA/rItbPwAAAAAyVeA/AAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAABAAIAAwAEAAUABgADAAUABwAGAAUACAAHAAUACQAIAAUACgAJAAUACwAKAAUADAALAAUADQAMAAUADgANAAUADwAOAAUAEAAPAAUAEQAQAAUAEgARAAUAEwASAAUAFAATAAUAFQAUAAUAFgAVAAUAFwAWAAUAFwAFABgAGQAXABgAGQAYABoAGwAZABoAAgAbABoAAAACABoA"}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:336,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:336,byteOffset:336,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:156,byteOffset:672,target:34963}],materials:[{name:"wire_008110135",pbrMetallicRoughness:{baseColorFactor:[.0314,.4314,.5294,1],metallicFactor:0,roughnessFactor:.968},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"Circle001_1",primitives:[{attributes:{POSITION:0,NORMAL:1},indices:2,material:0,mode:4}]}],nodes:[{name:"Circle001",mesh:0}],scene:0,scenes:[{nodes:[0]}]},zzhou:{accessors:[{name:"Cube.001-Mesh_0_positions",componentType:5126,count:45,min:[-.2711470127105713,-5.473427772521973,-.2711470127105713],max:[.2711470127105713,.46298399567604065,.2711470127105713],type:"VEC3",bufferView:0,byteOffset:0},{name:"Cube.001-Mesh_0_normals",componentType:5126,count:45,min:[-1,-1,-1],max:[1,1,1],type:"VEC3",bufferView:1,byteOffset:0},{name:"Cube.001-Mesh_0_texcoords",componentType:5126,count:45,min:[.125,0],max:[.875,1],type:"VEC2",bufferView:2,byteOffset:0},{name:"Cube.001-Mesh_0_indices",componentType:5123,count:72,min:[0],max:[44],type:"SCALAR",bufferView:3,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"Z",byteLength:1584,uri:"data:application/octet-stream;base64,/waNvZMdK77/Bo09/waNPZMdK77/Bo09/waNPR4Kr8D/Bo09l+KKPVImr8D/Bo09/waNvVImr8D/Bo09yNOKPsjTir7I04o+AAAAAD0M7T4AAAAAyNOKvsjTir7I04o+yNOKvsjTir7I04o+AAAAAD0M7T4AAAAAyNOKvsjTir7I04q+yNOKvsjTir7I04q+yNOKPsjTir7I04q+yNOKPsjTir7I04o+yNOKvsjTir7I04o+yNOKPsjTir7I04q+AAAAAD0M7T4AAAAAyNOKPsjTir7I04o+yNOKvsjTir7I04q+AAAAAD0M7T4AAAAAyNOKPsjTir7I04q+/waNPZMdK77/Bo09/waNPZMdK77/Bo29/waNPVImr8D/Bo29/waNPVImr8D/Bo09/waNPR4Kr8D/Bo09/waNvZMdK77/Bo09/waNvVImr8D/Bo09/waNvVImr8D/Bo29/waNvZMdK77/Bo29/waNvZMdK77/Bo29/waNvVImr8D/Bo29/waNPVImr8D/Bo29/waNPZMdK77/Bo29/waNPZMdK77/Bo09/waNvZMdK77/Bo09/waNvZMdK77/Bo29/waNPZMdK77/Bo29/waNvVImr8D/Bo09cooOO1Imr8BAMTI7/waNvVImr8D/Bo29/waNPVImr8D/Bo29/waNPVImr8D/Bo09l+KKPVImr8D/Bo09/waNPVImr8D/Bo09AAAAAAAAAAAAAIC/AAAAAAAAAAAAAIC/AAAAAAAAAAAAAIC/AAAAAAAAAAAAAIC/AAAAAAAAAAAAAIC/AAAAAFFmsT5wJHA/AAAAAFFmsT5wJHA/AAAAAFFmsT5wJHA/cCRwv1FmsT4AAAAAcCRwv1FmsT4AAAAAcCRwv1FmsT4AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAcCRwP1FmsT4AAAAAcCRwP1FmsT4AAAAAcCRwP1FmsT4AAAAAAAAAAFFmsT5wJHC/AAAAAFFmsT5wJHC/AAAAAFFmsT5wJHC/AACAvwAAAAAAAAAAAACAvwAAAAAAAAAAAACAvwAAAAAAAAAAAACAvwAAAAAAAAAAAACAvwAAAAAAAAAAAACAPwAAAAAAAAAAAACAPwAAAAAAAAAAAACAPwAAAAAAAAAAAACAPwAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgD8AAAAAAAAAAAAAgD8AAAAAAAAAAAAAgD8AAAAAAAAAAAAAgD8AAAAAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAAAAAAAAAAAAgD8AAAAAAADAPgAAQD8AAMA+AACAP2L1Hz8AAIA/AAAgP3uDfz8AACA/AABAPwAAwD4AAIA+AAAgPwAAAAAAAMA+AAAAAAAAwD4AAIA/AAAgPwAAQD8AAMA+AABAPwAAAD4AAAA/AADAPgAAAD8AAMA+AACAPgAAAD4AAIA+AADAPgAAAD8AACA/AACAPgAAwD4AAIA+AADAPgAAQD8AACA/AAAAPwAAwD4AAAA/AADAPgAAAD8AAMA+AABAPwAAID8AAEA/AAAgPwAAAD9i9R8/AAAAPwAAwD4AAAA/AAAgPwAAAD8AACA/AACAPgAAwD4AAIA+AADAPgAAgD4AACA/AACAPgAAID8AAAAAAADAPgAAAAAAAAA+AAAAPwAAwD4AAAA/AADAPgAAgD4AAAA+AACAPgAAID8AAAA/vAJBP/mGwj4AACA/AACAPgAAYD8AAIA+AAAgPwAAgD97g18/AAAAPwAAYD8AAAA/AAABAAIAAgADAAQAAgAEAAAABQAGAAcACAAJAAoACwAMAA0ACwANAA4ADwAQABEAEgATABQAFQAWABcAFwAYABkAFwAZABUAGgAbABwAGgAcAB0AHgAfACAAHgAgACEAIgAjACQAIgAkACUAJgAnACgAKAAnACkAAwACACoAKQAnACsAKQArACwAJwAmACsA"}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:540,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:540,byteOffset:540,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:360,byteOffset:1080,byteStride:8,target:34962},{name:"bufferView_3",buffer:0,byteLength:144,byteOffset:1440,target:34963}],materials:[{name:"Material.001",pbrMetallicRoughness:{baseColorFactor:[.8,.8,.8,1],metallicFactor:0,roughnessFactor:.676000006},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"Cube.001-Mesh",primitives:[{attributes:{POSITION:0,NORMAL:1,TEXCOORD_0:2},indices:3,material:0,mode:4}]}],nodes:[{name:"Cube.001",mesh:0}],scene:0,scenes:[{nodes:[0]}]},jiantou:{accessors:[{name:"_1_0_positions",componentType:5126,count:7,min:[-.47690001130104065,-.8044000267982483,0],max:[.47780001163482666,0,0],type:"VEC3",bufferView:0,byteOffset:0},{name:"_1_0_normals",componentType:5126,count:7,min:[0,0,1],max:[0,0,1],type:"VEC3",bufferView:1,byteOffset:0},{name:"_1_0_indices",componentType:5123,count:15,min:[0],max:[6],type:"SCALAR",bufferView:2,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"jiantou",byteLength:200,uri:"data:application/octet-stream;base64,bxIDOintTb8AAAAAH/RsvsKGp74AAAAAPSz0vsKGp74AAAAANs17PsKGp74AAAAANKL0PsKGp74AAAAANs17PgAAAAAAAAAAH/RsvgAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAABAAIAAAADAAEAAAAEAAMAAQAFAAYAAQADAAUAAAA="}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:84,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:84,byteOffset:84,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:32,byteOffset:168,target:34963}],materials:[{name:"SVGMat_003",pbrMetallicRoughness:{baseColorFactor:[.588,.588,.588,1],metallicFactor:0,roughnessFactor:.99},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"_1",primitives:[{attributes:{POSITION:0,NORMAL:1},indices:2,material:0,mode:4}]}],nodes:[{name:"",mesh:0}],scene:0,scenes:[{nodes:[0]}]},xuanzhuan:{accessors:[{name:"001_1_0_positions",componentType:5126,count:369,min:[-6.572299957275391,-7.298999786376953,0],max:[6.5742998123168945,7.298299789428711,0],type:"VEC3",bufferView:0,byteOffset:0},{name:"001_1_0_normals",componentType:5126,count:369,min:[0,-1,0],max:[0,0,1],type:"VEC3",bufferView:1,byteOffset:0},{name:"001_1_0_indices",componentType:5123,count:1089,min:[0],max:[368],type:"SCALAR",bufferView:2,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"-",byteLength:11036,uri:"data:application/octet-stream;base64,1zQDwHql3kAAAAAA48e4vgMJ1kAAAAAAQmD1v6yL6UAAAAAA2qxqv1Fr0EAAAAAAVHSkvnuD1UAAAAAAF7eRvjXv1EAAAAAAyeV/vqVO1EAAAAAA5INevsuh00AAAAAAW7E/vpHt0kAAAAAAZogjvoMv0kAAAAAAAwkKvrpr0UAAAAAA+aDnvTSi0EAAAAAAXCDBvWfVz0AAAAAAqoLZv4NRy0AAAAAALv+hvfcGz0AAAAAAAwmKvVg5zkAAAAAA/Yd0vYtszUAAAAAAak1zvSBBzUAAAAAA1xJyveQUzUAAAAAAIEFxvTLmzEAAAAAARdhwvd21zEAAAAAARdhwvbaEzEAAAAAAIEFxvb1SzEAAAAAAs3tyvSEfzEAAAAAARrZzvYXry0AAAAAAayt2vRe3y0AAAAAAkKB4vQaBy0AAAAAASFB8vfVKy0AAAAAAhXwcwLRZw0AAAAAAbjSAveQUy0AAAAAA3EaDvcX+ykAAAAAAb/CFvTLmykAAAAAAcM6IvRTQykAAAAAAcayLvSS5ykAAAAAAcoqOvQWjykAAAAAA4XqUvWx4ykAAAAAAUI2XvSBjykAAAAAACD2bvQFNykAAAAAAUrievbU3ykAAAAAAeJyivTojykAAAAAA5x2nve0NykAAAAAAMCqpvaMBykAAAAAAVp+rvVr1yUAAAAAAexSuvbPqyUAAAAAAxSCwvTvfyUAAAAAA6pWyvfLSyUAAAAAAoda0vUvIyUAAAAAAx0u3vQK8yUAAAAAAWvW5vVuxyUAAAAAA7Z68vYenyUAAAAAA7ny/veCcyUAAAAAAgSbCvQyTyUAAAAAAgQTFvQmKyUAAAAAA1CvlvRUdyUAAAAAAXW0FviS5yEAAAAAALNQavjVeyEAAAAAADi0yvqYKyEAAAAAAlkNLvki/x0AAAAAA5q5lvhx8x0AAAAAAZaqAvqs+x0AAAAAA4L6OvsgHx0AAAAAAyAedvnPXxkAAAAAAlkOrvqytxkAAAAAAEFi5vs6IxkAAAAAAH4XLvpVlxkAAAAAAAwnKvjhnxkAAAAAA54zIvjhnxkAAAAAAsAPHvgpoxkAAAAAAOwHNvsNkxkAAAAAAO3DOvvFjxkAAAAAA0ETYvpJcxkAAAAAAV+zPvk5ixkAAAAAAV1vRvtlfxkAAAAAAWMrSvgdfxkAAAAAAWDnUvmRdxkAAAAAAIo7VvpJcxkAAAAAA6+LWvpJcxkAAAAAAiIXavgRWxkAAAAAAJLncvkhQxkAAAAAA2/nevl5LxkAAAAAAkzrhvhdIxkAAAAAASnvjvtBExkAAAAAAMzPzvoY4xkAAAAAAArzlvrhAxkAAAAAAufznvkI+xkAAAAAAcT3qvs07xkAAAAAAKH7svlg5xkAAAAAAxLHuvoY4xkAAAAAAfPLwvoY4xkAAAAAA9Gz2vsoyxkAAAAAAtab5vj0sxkAAAAAAduD8vlInxkAAAAAAqRMAvzojxkAAAAAApb0Bv08exkAAAAAAE2EDvzcaxkAAAAAAnREFv00VxkAAAAAAC7UGvzQRxkAAAAAAlWUIv0oMxkAAAAAAHhYKv18HxkAAAAAAGsALv6MBxkAAAAAADk8Pv7n8xUAAAAAAgEgPv7n8xUAAAAAApHANv7n8xUAAAAAAUwWrv90kwkAAAAAASS4Pv7n8xUAAAAAApHANv7n8xUAAAAAAgEgPv7n8xUAAAAAA9wYPv7n8xUAAAAAAidIOv7n8xUAAAAAAG54Ov7n8xUAAAAAAIGMOv7n8xUAAAAAAJCgOv7n8xUAAAAAAKe0Nv7n8xUAAAAAASL8Nv7n8xUAAAAAA9pcNv7n8xUAAAAAAv30Nv7n8xUAAAAAABoFJwDm0uEAAAAAAZvcEwJtVu0AAAAAAwcoxwOzAsUAAAAAARiUFQFdbu8AAAAAAdZMcQM9mw8AAAAAA9pdJQIPAuMAAAAAAtvMxQEvIscAAAAAA2IFzQISeq8AAAAAAjLlbQECkpcAAAAAAZveMQPkxnMAAAAAAPQqBQNEil8AAAAAA+zqeQJOpisAAAAAAdk+SQPd1hsAAAAAAA3ihQFafZ8AAAAAAnl6tQN5xbsAAAAAAsi66QCEfRMAAAAAASFCuQLTIPsAAAAAA4XrEQPW5FsAAAAAAHqe4QJ/NEsAAAAAA1xLMQJhMzb8AAAAA6UjAQFInyL8AAAAAnMTQQM4ZUb8AAAAAsAPFQKMBTL8AAAAAduCMwKMjWcAAAAAA9P1wwOauOcAAAAAA6GqDwG1WGcAAAAAA46WZwA5PM8AAAAAANKLGQBe30TkAAAAAqmDSQBe30TkAAAAAdQLMwEYlzT8AAAAALUPAwAAAyD8AAAAAvp+4wFK4EkAAAAAArWnEwAWjFkAAAAAAF0iuwGizPkAAAAAATx66wI4GREAAAAAAXW2hwAmKZ0AAAAAAPE6twEtZbkAAAAAAW0KSwFFrhkAAAAAAayuewO2eikAAAAAAUPyAwPwYl0AAAAAA1eeMwK8lnEAAAAAAyJhbwA+cpUAAAAAAoWdzwDqSq0AAAAAA6GqrP8cpwsAAAAAA+zoQP6MBxsAAAAAAbqPZPxNhy8AAAAAAYHYPPxsNxsAAAAAAukkMPzQRxsAAAAAA0gAOPxsNxsAAAAAARPoNPxsNxsAAAAAAexQOPxsNxsAAAAAAPzUOPxsNxsAAAAAAIGMOPxsNxsAAAAAAcooOPxsNxsAAAAAAUrgOPxsNxsAAAAAAMuYOPxsNxsAAAAAAoBoPPxsNxsAAAAAAZDsPPxsNxsAAAAAAKVwPPxsNxsAAAAAA0m8PPxsNxsAAAAAAMZkKP00VxsAAAAAAp+gIPzcaxsAAAAAAqz4HPyEfxsAAAAAAIo4FP90kxsAAAAAAmN0DP2srxsAAAAAADi0CPycxxsAAAAAAhXwAP+M2xsAAAAAA9pf9PnE9xsAAAAAA/kP6PltCxsAAAAAA6+L2PqJFxsAAAAAA2IHzPulIxsAAAAAAc2jxPl5LxsAAAAAADk/vPtNNxsAAAAAAqDXtPkhQxsAAAAAAKA/rPr1SxsAAAAAAjNvoPmFUxsAAAAAAC7XmPjJVxsAAAAAAVHTkPgRWxsAAAAAA003iPnlYxsAAAAAAGw3gPh1axsAAAAAAZMzdPpJcxsAAAAAArIvbPgdfxsAAAAAA9UrZPnxhxsAAAAAA2c7XPvFjxsAAAAAA2V/WPpVlxsAAAAAA2PDUPgpoxsAAAAAA847TPn9qxsAAAAAA8x/SPiJsxsAAAAAA8rDQPvRsxsAAAAAA8kHPPphuxsAAAAAAKe3NPg1xxsAAAAAAKH7MPt5xxsAAAAAADALLPlR0xsAAAAAADJPJPsl2xsAAAAAA8BbIPj55xsAAAAAA4za6PryWxsAAAAAATRWsPvW5xsAAAAAASL+dPuvixsAAAAAAYHaPPp0Rx8AAAAAA5WGBPgtGx8AAAAAAi2xnPtiBx8AAAAAAOwFNPtbFx8AAAAAA6gQ0PmIQyMAAAAAAP8YcPiBjyMAAAAAA3pMHPrG/yMAAAAAAZ0TpPdEiycAAAAAAg1HJPcWPycAAAAAAy6HFPQ+cycAAAAAA7lrCPYenycAAAAAAEhS/PdCzycAAAAAAowG8PRrAycAAAAAAEFi5PZLLycAAAAAAfa62PdzXycAAAAAA6gS0PVTjycAAAAAAxY+xPZ7vycAAAAAADk+vPef7ycAAAAAA6NmsPV8HysAAAAAAn82qPakTysAAAAAAeVioPfMfysAAAAAAwaikPT81ysAAAAAA5WGhPYxKysAAAAAACRuePapgysAAAAAACD2bPcl2ysAAAAAAB1+YPbmNysAAAAAAdLWVPamkysAAAAAAvJaQPVvTysAAAAAABFaOPRzrysAAAAAA3+CLPd4Cy8AAAAAAldSJPXEby8AAAAAAcF+HPTMzy8AAAAAA3bWEPc9my8AAAAAALNRqP1Z90MAAAAAAuECCPciYy8AAAAAA3GiAPZLLy8AAAAAAtvN9PS7/y8AAAAAASFB8PScxzMAAAAAA/kN6PSBjzMAAAAAAI9t5PUaUzMAAAAAAI9t5PRHHzMAAAAAAI9t5PTj4zMAAAAAA/kN6PV8pzcAAAAAAkX57PYZazcAAAAAAJLl8PQmKzcAAAAAAcoqOPdZWzsAAAAAAMEymPaMjz8AAAAAAXW3FPZ7vz8AAAAAAjLnrPfW50MAAAAAAqz4DQN213sAAAAAAgy8MPmN/0cAAAAAA5q4lPrhA0sAAAAAAE/JBPn/70sAAAAAAnMRgPhSu08AAAAAAJQaBPnlY1MAAAAAAPL2SPpT21MAAAAAAeHqlPgmK1cAAAAAAhxa5Pr8O1sAAAAAA63P1P2iR6cAAAAAApb1Bv4xKsEAAAAAAMlVAP4xKsEAAAAAAw2QquxDpsUAAAAAAMne9v/OOq0AAAAAA3bW8P/OOq0AAAAAAYqEKwG/wo0AAAAAAcT0KQG/wo0AAAAAA/7IzwG6jmUAAAAAAak0zQG6jmUAAAAAA8IVZwAHejEAAAAAAHcklvw6+lkAAAAAAw2Qqu8UgmEAAAAAAxm0kPw6+lkAAAAAAuB5ZQAHejEAAAAAAc2ihP5aykkAAAAAA1xKiv5aykkAAAAAAKH7sP+AtjEAAAAAAjSjtv+AtjEAAAAAAuK97wBSue0AAAAAAOUV7QBSue0AAAAAAnl4ZQHBfg0AAAAAAdLUZwHBfg0AAAAAAXro5QGDlcEAAAAAA7Q06wGDlcEAAAAAAduCMwPCFWUAAAAAAZaqMQPCFWUAAAAAAqvFWQJAxV0AAAAAA3EZXwJAxV0AAAAAA46WZwEa2M0AAAAAA0m+ZQEa2M0AAAAAAHqdwQIv9OUAAAAAA9P1wwIv9OUAAAAAAIEGDQLWmGUAAAAAA6GqDwLWmGUAAAAAAnzyMwMZt7L8AAAAAiPSjwHE9CsAAAAAAIEGDQG1WGcAAAAAA0m+ZQA5PM8AAAAAA07yjQHE9CsAAAAAANBGMQMZt7L8AAAAA+1yrQAisvL8AAAAA6pWSQBBYob8AAAAAOpKrwAisvL8AAAAAVcGSwBBYob8AAAAA+8uWwI9TJL8AAAAA002wwG40QL8AAAAAYqGWQMbcJT8AAAAA8BawQPfkQT8AAAAA+1yrQE2EvT8AAAAA6pWSQJEPoj8AAAAAVTCYwInSXjsAAAAA+u2xwInSXjsAAAAA6gSYQInSXjsAAAAARraxQInSXjsAAAAAObTQwEXYUD8AAAAAIv3EwBrASz8AAAAAYqGWQI9TJL8AAAAA8BawQG40QL8AAAAA+8uWwMbcJT8AAAAA002wwPfkQT8AAAAAVcGSwJEPoj8AAAAAOpKrwE2EvT8AAAAAnzyMwOQU7T8AAAAAiPSjwEymCkAAAAAA07yjQEymCkAAAAAANBGMQOQU7T8AAAAAHqdwQOauOcAAAAAAZaqMQKMjWcAAAAAA3EZXwOviVsAAAAAAqvFWQOviVsAAAAAA7Q06wLyWcMAAAAAAXro5QLyWcMAAAAAAOUV7QMdLe8AAAAAAuK97wMdLe8AAAAAAdLUZwHo2g8AAAAAAnl4ZQHo2g8AAAAAAuB5ZQE+vjMAAAAAA8IVZwE+vjMAAAAAAjSjtv+oEjMAAAAAAKH7sP+oEjMAAAAAA1xKiv86IksAAAAAAc2ihP86IksAAAAAAak0zQGB2mcAAAAAA/7IzwGB2mcAAAAAAHcklv0aUlsAAAAAAxm0kP0aUlsAAAAAAw2Qqu/32l8AAAAAAcT0KQDPEo8AAAAAAYqEKwDPEo8AAAAAA3bW8P4hjq8AAAAAAMne9v4hjq8AAAAAAMlVAPyEfsMAAAAAApb1BvyEfsMAAAAAAw2Qqu3e+scAAAAAASFDSwG8Sg7oAAAAASZ3GwG8Sg7oAAAAAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAABAAIAAwABAAAAAwAEAAEAAwAFAAQAAwAGAAUAAwAHAAYAAwAIAAcAAwAJAAgAAwAKAAkAAwALAAoAAwAMAAsADQAMAAMADQAOAAwADQAPAA4ADQAQAA8ADQARABAADQASABEADQATABIADQAUABMADQAVABQADQAWABUADQAXABYADQAYABcADQAZABgADQAaABkADQAbABoAHAAbAA0AHAAdABsAHAAeAB0AHAAfAB4AHAAgAB8AHAAhACAAHAAiACEAHAAjACIAHAAkACMAHAAlACQAHAAmACUAHAAnACYAHAAoACcAHAApACgAHAAqACkAHAArACoAHAAsACsAHAAtACwAHAAuAC0AHAAvAC4AHAAwAC8AHAAxADAAHAAyADEAHAAzADIAHAA0ADMAHAA1ADQAHAA2ADUAHAA3ADYAHAA4ADcAHAA5ADgAHAA6ADkAHAA7ADoAHAA8ADsAHAA9ADwAHAA+AD0AHAA/AD4AHABAAD8AQABBAD8AQQBCAD8AQgBDAD8AHABAAEQAHABEAEUAHABGAEUARgBHAEUARgBIAEcARgBJAEgARgBKAEkARgBLAEoARgBMAEsAHABNAEYAHABOAE0AHABPAE4AHABQAE8AHABRAFAAHABSAFEAUgBTAFEAUgBUAFMAUgBVAFQAUgBWAFUAUgBXAFYAUgBYAFcAHABZAFIAHABaAFkAHABbAFoAHABcAFsAHABdAFwAHABeAF0AHABfAF4AHABgAF8AHABhAGAAHABiAGEAHABjAGIAHABjAGQAZABlAGMAZQBmAGMAHABnAGQAaABpAGoAawBpAGgAbABpAGsAbQBpAGwAbgBpAG0AbwBpAG4AcABpAG8AcQBpAHAAcgBpAHEAcwBpAHIAdABnABwAdAB1AGcAdAB2AHUAdwB4AHkAdwB5AHoAegB5AHsAegB7AHwAfAB7AH0AfAB9AH4AfgB9AH8AfgB/AIAAgQCCAIMAgQCDAIQAhACDAIUAhACFAIYAhgCFAIcAhgCHAIgAiACHAIkAiACJAIoAiwCMAI0AiwCNAI4AjwCKAJAAigCJAJAAkQCSAJMAkQCTAJQAlACTAJUAlACVAJYAlgCVAJcAlgCXAJgAgAB/AIIAgACCAIEAmACXAJkAmACZAJoAmgCZAJsAmgCbAJwAnACbAJ0AnACdAJ4AngCdAHYAngB2AHQAnwB4AHcAoAB4AJ8AoAChAHgAogChAKAAowCkAKUAowCmAKQAowCnAKYAowCoAKcAowCpAKgAowCqAKkAowCrAKoAowCsAKsAowCtAKwAowCuAK0AowCvAK4AowCiAK8AowChAKIAsAChAKMAsQChALAAsgChALEAswChALIAtAChALMAtQChALQAtgChALUAtwChALYAuAChALcAuQChALgAugChALkAuwChALoAvAChALsAvQChALwAvgChAL0AvwChAL4AwAChAL8AwQChAMAAwgChAMEAwwChAMIAxAChAMMAxQChAMQAxgChAMUAxwChAMYAyAChAMcAyQChAMgAygChAMkAywChAMoAzAChAMsAzQChAMwAzgChAM0AzwChAM4A0AChAM8A0QChANAA0gChANEA0wChANIA1AChANMA1QChANQA1gChANUA1wChANYA2AChANcA2QChANgA2gChANkA2wChANoA3AChANsA3QChANwA3gChAN0A3wChAN4A4AChAN8A4QChAOAA4gChAOEA4wChAOIA5AChAOMA5QChAOQA5gChAOUA5wChAOYA6AChAOcA6QChAOgA6gChAOkA6wChAOoA7AChAOsA7QChAOwA7gChAO0A7wChAO4A8AChAO8A8QChAO8A8gChAPEA8wChAPIA9AChAPMA9QChAPQA9gChAPUA9gD3AKEA+AD3APYA+QD3APgA+gD3APkA+wD3APoA/AD3APsA/QD3APwA/gD3AP0A/wD3AP4AAAH3AP8AAQH3AAABAgH3AAEBAwH3AAIBBAH3AAMBBQH3AAQBBgH3AAUBBgEHAfcACAEHAQYBCQEHAQgBCgEHAQkBCwEHAQoBDAEHAQsBDQEHAQwBDgEHAQ0BDwEHAQ4BEAEHAQ8BEQESARMBFAESAREBFAEVARIBFgEVARQBFgEXARUBGAEXARYBGAEZARcBGgEbARgBGwEcARgBHAEZARgBHAEdARkBHQEeARkBHwEeAR0BGgEgARsBIQEeAR8BGgEiASABIwEiARoBIQEkAR4BJQEkASEBIwEmASIBJwEkASUBIwEoASYBKQEoASMBJwEqASQBKwEqAScBKQEsASgBLQEsASkBKwEuASoBLwEuASsBLQEwASwBMQEuAS8BLQEyATABjgCNADMBjgAzATQBNQE2ATcBNQE3ATgBOAE3ATkBOAE5AToBOwE8AT0BOwE9AT4BPwFAAUEBPwFBAUIBPgE9AUMBPgFDAUQBRQFGAUABRQFAAT8BRwFIAZIARwGSAJEASQFKAUYBSQFGAUUBRAFDAUsBRAFLAUwBOgE5AUoBOgFKAUkBTAFLAU0BTAFNAU4BTgFNAU8BTgFPAVABQgFBAVEBQgFRAVIBUgFRAS4BUgEuATEBNAEzATwBNAE8ATsBUwFUATYBUwE2ATUBUAFPATIBUAEyAS0BiwBVAYwAVgFUAVMBiwBXAVUBWAFUAVYBWAFZAVQBWgFXAYsAWgFbAVcBXAFZAVgBXAFdAVkBXgFbAVoBXgFfAVsBYAFdAVwBXgFhAV8BYgFdAWABYgFjAV0BZAFhAV4BZAFlAWEBZgFjAWIBZAFnAWUBZwFjAWYBZAFjAWcBZAFoAWMBaQFoAWQBaQFqAWgBawFqAWkBawFsAWoBbQFsAWsBbQFuAWwBbwFwAUgBbwFIAUcBAAA="}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:4428,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:4428,byteOffset:4428,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:2180,byteOffset:8856,target:34963}],materials:[{name:"SVGMat",pbrMetallicRoughness:{baseColorFactor:[.5,.5,.5,1],metallicFactor:0,roughnessFactor:1},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"001_1",primitives:[{attributes:{POSITION:0,NORMAL:1},indices:2,material:0,mode:4}]}],nodes:[{name:"001",mesh:0}],scene:0,scenes:[{nodes:[0]}]},plane:{accessors:[{name:"Rectangle001_1_0_positions",componentType:5126,count:4,min:[-5,-5,0],max:[5,5,0],type:"VEC3",bufferView:0,byteOffset:0},{name:"Rectangle001_1_0_normals",componentType:5126,count:4,min:[0,0,1],max:[0,0,1],type:"VEC3",bufferView:1,byteOffset:0},{name:"Rectangle001_1_0_indices",componentType:5123,count:6,min:[0],max:[3],type:"SCALAR",bufferView:2,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"plane",byteLength:108,uri:"data:application/octet-stream;base64,AACgQAAAoEAAAAAAAACgwAAAoEAAAAAAAACgwAAAoMAAAAAAAACgQAAAoMAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAABAAIAAgADAAAA"}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:48,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:48,byteOffset:48,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:12,byteOffset:96,target:34963}],materials:[{name:"wire_225198087",pbrMetallicRoughness:{baseColorFactor:[.8824,.7765,.3412,1],metallicFactor:0,roughnessFactor:.968},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"Rectangle001_1",primitives:[{attributes:{POSITION:0,NORMAL:1},indices:2,material:0,mode:4}]}],nodes:[{name:"Rectangle001",mesh:0}],scene:0,scenes:[{nodes:[0]}]},xyzScale:{asset:{generator:"Khronos glTF Blender I/O v1.6.16",version:"2.0"},scene:0,scenes:[{name:"Scene",nodes:[0,1,2,3,4,5,6]}],nodes:[{mesh:0,name:"Cube",scale:[.7008190751075745,.014999999664723873,.014999999664723873]},{mesh:1,name:"Cube.001",scale:[.10000000149011612,.10000000149011612,.10000000149011612]},{mesh:2,name:"Cube.004",rotation:[0,-.7071068286895752,0,.7071068286895752],scale:[.7008190751075745,.014999999664723873,.014999999664723873]},{mesh:3,name:"Cube.003",rotation:[0,-.7071068286895752,0,.7071068286895752],scale:[.10000000149011612,.10000000149011612,.10000000149011612]},{mesh:4,name:"Cube.006",rotation:[0,0,.7071068286895752,.7071068286895752],scale:[.7008190751075745,.014999999664723873,.014999999664723873]},{mesh:5,name:"Cube.005",rotation:[0,0,.7071068286895752,.7071068286895752],scale:[.10000000149011612,.10000000149011612,.10000000149011612]},{mesh:6,name:"Cube.002",scale:[.10000000149011612,.10000000149011612,.10000000149011612]}],materials:[{doubleSided:!0,name:"Material",pbrMetallicRoughness:{baseColorFactor:[.6938720345497131,.020288480445742607,.011612260714173317,1],metallicFactor:0,roughnessFactor:.4000000059604645}},{doubleSided:!0,name:"Material.001",pbrMetallicRoughness:{baseColorFactor:[.6938720345497131,.020288480445742607,.011612260714173317,1],metallicFactor:0,roughnessFactor:.4000000059604645}},{doubleSided:!0,name:"Material.002",pbrMetallicRoughness:{baseColorFactor:[.626582869887352,.626582869887352,.626582869887352,1],metallicFactor:0,roughnessFactor:.4000000059604645}},{doubleSided:!0,name:"Material.006",pbrMetallicRoughness:{baseColorFactor:[.11193240433931351,.5583405494689941,.033104799687862396,1],metallicFactor:0,roughnessFactor:.4000000059604645}},{doubleSided:!0,name:"Material.005",pbrMetallicRoughness:{baseColorFactor:[.11193240433931351,.5583405494689941,.033104799687862396,1],metallicFactor:0,roughnessFactor:.4000000059604645}},{doubleSided:!0,name:"Material.010",pbrMetallicRoughness:{baseColorFactor:[.004391402006149292,.21223078668117523,.5209956169128418,1],metallicFactor:0,roughnessFactor:.4000000059604645}},{doubleSided:!0,name:"Material.009",pbrMetallicRoughness:{baseColorFactor:[.004391402006149292,.21223078668117523,.5209956169128418,1],metallicFactor:0,roughnessFactor:.4000000059604645}}],meshes:[{name:"Cube",primitives:[{attributes:{POSITION:0,NORMAL:1,TEXCOORD_0:2},indices:3,material:0}]},{name:"Cube.001",primitives:[{attributes:{POSITION:4,NORMAL:5,TEXCOORD_0:6},indices:3,material:1}]},{name:"Cube.006",primitives:[{attributes:{POSITION:10,NORMAL:11,TEXCOORD_0:12},indices:3,material:3}]},{name:"Cube.005",primitives:[{attributes:{POSITION:13,NORMAL:14,TEXCOORD_0:15},indices:3,material:4}]},{name:"Cube.010",primitives:[{attributes:{POSITION:16,NORMAL:17,TEXCOORD_0:18},indices:3,material:5}]},{name:"Cube.009",primitives:[{attributes:{POSITION:19,NORMAL:20,TEXCOORD_0:21},indices:3,material:6}]},{name:"Cube.002",primitives:[{attributes:{POSITION:7,NORMAL:8,TEXCOORD_0:9},indices:3,material:2}]}],accessors:[{bufferView:0,componentType:5126,count:24,max:[2.0003609657287598,1,1],min:[.0003610849380493164,-1,-1],type:"VEC3"},{bufferView:1,componentType:5126,count:24,type:"VEC3"},{bufferView:2,componentType:5126,count:24,type:"VEC2"},{bufferView:3,componentType:5123,count:36,type:"SCALAR"},{bufferView:4,componentType:5126,count:24,max:[14.549108505249023,1,1],min:[12.549108505249023,-1,-1],type:"VEC3"},{bufferView:5,componentType:5126,count:24,type:"VEC3"},{bufferView:6,componentType:5126,count:24,type:"VEC2"},{bufferView:7,componentType:5126,count:24,max:[1,1,1],min:[-1,-1,-1],type:"VEC3"},{bufferView:8,componentType:5126,count:24,type:"VEC3"},{bufferView:9,componentType:5126,count:24,type:"VEC2"},{bufferView:10,componentType:5126,count:24,max:[2.0003609657287598,1,1],min:[.0003610849380493164,-1,-1],type:"VEC3"},{bufferView:11,componentType:5126,count:24,type:"VEC3"},{bufferView:12,componentType:5126,count:24,type:"VEC2"},{bufferView:13,componentType:5126,count:24,max:[14.549108505249023,1,1],min:[12.549108505249023,-1,-1],type:"VEC3"},{bufferView:14,componentType:5126,count:24,type:"VEC3"},{bufferView:15,componentType:5126,count:24,type:"VEC2"},{bufferView:16,componentType:5126,count:24,max:[2.0003609657287598,1,1],min:[.0003610849380493164,-1,-1],type:"VEC3"},{bufferView:17,componentType:5126,count:24,type:"VEC3"},{bufferView:18,componentType:5126,count:24,type:"VEC2"},{bufferView:19,componentType:5126,count:24,max:[14.549108505249023,1,1],min:[12.549108505249023,-1,-1],type:"VEC3"},{bufferView:20,componentType:5126,count:24,type:"VEC3"},{bufferView:21,componentType:5126,count:24,type:"VEC2"}],bufferViews:[{buffer:0,byteLength:288,byteOffset:0},{buffer:0,byteLength:288,byteOffset:288},{buffer:0,byteLength:192,byteOffset:576},{buffer:0,byteLength:72,byteOffset:768},{buffer:0,byteLength:288,byteOffset:840},{buffer:0,byteLength:288,byteOffset:1128},{buffer:0,byteLength:192,byteOffset:1416},{buffer:0,byteLength:288,byteOffset:1608},{buffer:0,byteLength:288,byteOffset:1896},{buffer:0,byteLength:192,byteOffset:2184},{buffer:0,byteLength:288,byteOffset:2376},{buffer:0,byteLength:288,byteOffset:2664},{buffer:0,byteLength:192,byteOffset:2952},{buffer:0,byteLength:288,byteOffset:3144},{buffer:0,byteLength:288,byteOffset:3432},{buffer:0,byteLength:192,byteOffset:3720},{buffer:0,byteLength:288,byteOffset:3912},{buffer:0,byteLength:288,byteOffset:4200},{buffer:0,byteLength:192,byteOffset:4488},{buffer:0,byteLength:288,byteOffset:4680},{buffer:0,byteLength:288,byteOffset:4968},{buffer:0,byteLength:192,byteOffset:5256}],buffers:[{byteLength:5448,uri:"data:application/octet-stream;base64,6gUAQAAAgD8AAIC/6gUAQAAAgD8AAIC/6gUAQAAAgD8AAIC/6gUAQAAAgL8AAIC/6gUAQAAAgL8AAIC/6gUAQAAAgL8AAIC/6gUAQAAAgD8AAIA/6gUAQAAAgD8AAIA/6gUAQAAAgD8AAIA/6gUAQAAAgL8AAIA/6gUAQAAAgL8AAIA/6gUAQAAAgL8AAIA/AFC9OQAAgD8AAIC/AFC9OQAAgD8AAIC/AFC9OQAAgD8AAIC/AFC9OQAAgL8AAIC/AFC9OQAAgL8AAIC/AFC9OQAAgL8AAIC/AFC9OQAAgD8AAIA/AFC9OQAAgD8AAIA/AFC9OQAAgD8AAIA/AFC9OQAAgL8AAIA/AFC9OQAAgL8AAIA/AFC9OQAAgL8AAIA/AAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAPwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AACAPwAAAAAAAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AAAgPwAAAD8AACA/AAAAPwAAID8AAAA/AADAPgAAAD8AAMA+AAAAPwAAwD4AAAA/AAAgPwAAgD4AACA/AACAPgAAID8AAIA+AADAPgAAgD4AAMA+AACAPgAAwD4AAIA+AAAgPwAAQD8AACA/AABAPwAAYD8AAAA/AADAPgAAQD8AAAA+AAAAPwAAwD4AAEA/AAAgPwAAgD8AACA/AAAAAAAAYD8AAIA+AADAPgAAgD8AAAA+AACAPgAAwD4AAAAAAQAOABQAAQAUAAcACgAGABMACgATABcAFQASAAwAFQAMAA8AEAADAAkAEAAJABYABQACAAgABQAIAAsAEQANAAAAEQAAAAQAJsloQQAAgD8AAIC/JsloQQAAgD8AAIC/JsloQQAAgD8AAIC/JsloQQAAgL8AAIC/JsloQQAAgL8AAIC/JsloQQAAgL8AAIC/JsloQQAAgD8AAIA/JsloQQAAgD8AAIA/JsloQQAAgD8AAIA/JsloQQAAgL8AAIA/JsloQQAAgL8AAIA/JsloQQAAgL8AAIA/JslIQQAAgD8AAIC/JslIQQAAgD8AAIC/JslIQQAAgD8AAIC/JslIQQAAgL8AAIC/JslIQQAAgL8AAIC/JslIQQAAgL8AAIC/JslIQQAAgD8AAIA/JslIQQAAgD8AAIA/JslIQQAAgD8AAIA/JslIQQAAgL8AAIA/JslIQQAAgL8AAIA/JslIQQAAgL8AAIA/AAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAPwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AACAPwAAAAAAAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AAAgPwAAAD8AACA/AAAAPwAAID8AAAA/AADAPgAAAD8AAMA+AAAAPwAAwD4AAAA/AAAgPwAAgD4AACA/AACAPgAAID8AAIA+AADAPgAAgD4AAMA+AACAPgAAwD4AAIA+AAAgPwAAQD8AACA/AABAPwAAYD8AAAA/AADAPgAAQD8AAAA+AAAAPwAAwD4AAEA/AAAgPwAAgD8AACA/AAAAAAAAYD8AAIA+AADAPgAAgD8AAAA+AACAPgAAwD4AAAAAAACAPwAAgD8AAIC/AACAPwAAgD8AAIC/AACAPwAAgD8AAIC/AACAPwAAgL8AAIC/AACAPwAAgL8AAIC/AACAPwAAgL8AAIC/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgL8AAIA/AACAPwAAgL8AAIA/AACAPwAAgL8AAIA/AACAvwAAgD8AAIC/AACAvwAAgD8AAIC/AACAvwAAgD8AAIC/AACAvwAAgL8AAIC/AACAvwAAgL8AAIC/AACAvwAAgL8AAIC/AACAvwAAgD8AAIA/AACAvwAAgD8AAIA/AACAvwAAgD8AAIA/AACAvwAAgL8AAIA/AACAvwAAgL8AAIA/AACAvwAAgL8AAIA/AAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAPwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AACAPwAAAAAAAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AAAgPwAAAD8AACA/AAAAPwAAID8AAAA/AADAPgAAAD8AAMA+AAAAPwAAwD4AAAA/AAAgPwAAgD4AACA/AACAPgAAID8AAIA+AADAPgAAgD4AAMA+AACAPgAAwD4AAIA+AAAgPwAAQD8AACA/AABAPwAAYD8AAAA/AADAPgAAQD8AAAA+AAAAPwAAwD4AAEA/AAAgPwAAgD8AACA/AAAAAAAAYD8AAIA+AADAPgAAgD8AAAA+AACAPgAAwD4AAAAA6gUAQAAAgD8AAIC/6gUAQAAAgD8AAIC/6gUAQAAAgD8AAIC/6gUAQAAAgL8AAIC/6gUAQAAAgL8AAIC/6gUAQAAAgL8AAIC/6gUAQAAAgD8AAIA/6gUAQAAAgD8AAIA/6gUAQAAAgD8AAIA/6gUAQAAAgL8AAIA/6gUAQAAAgL8AAIA/6gUAQAAAgL8AAIA/AFC9OQAAgD8AAIC/AFC9OQAAgD8AAIC/AFC9OQAAgD8AAIC/AFC9OQAAgL8AAIC/AFC9OQAAgL8AAIC/AFC9OQAAgL8AAIC/AFC9OQAAgD8AAIA/AFC9OQAAgD8AAIA/AFC9OQAAgD8AAIA/AFC9OQAAgL8AAIA/AFC9OQAAgL8AAIA/AFC9OQAAgL8AAIA/AAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAPwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AACAPwAAAAAAAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AAAgPwAAAD8AACA/AAAAPwAAID8AAAA/AADAPgAAAD8AAMA+AAAAPwAAwD4AAAA/AAAgPwAAgD4AACA/AACAPgAAID8AAIA+AADAPgAAgD4AAMA+AACAPgAAwD4AAIA+AAAgPwAAQD8AACA/AABAPwAAYD8AAAA/AADAPgAAQD8AAAA+AAAAPwAAwD4AAEA/AAAgPwAAgD8AACA/AAAAAAAAYD8AAIA+AADAPgAAgD8AAAA+AACAPgAAwD4AAAAAJsloQQAAgD8AAIC/JsloQQAAgD8AAIC/JsloQQAAgD8AAIC/JsloQQAAgL8AAIC/JsloQQAAgL8AAIC/JsloQQAAgL8AAIC/JsloQQAAgD8AAIA/JsloQQAAgD8AAIA/JsloQQAAgD8AAIA/JsloQQAAgL8AAIA/JsloQQAAgL8AAIA/JsloQQAAgL8AAIA/JslIQQAAgD8AAIC/JslIQQAAgD8AAIC/JslIQQAAgD8AAIC/JslIQQAAgL8AAIC/JslIQQAAgL8AAIC/JslIQQAAgL8AAIC/JslIQQAAgD8AAIA/JslIQQAAgD8AAIA/JslIQQAAgD8AAIA/JslIQQAAgL8AAIA/JslIQQAAgL8AAIA/JslIQQAAgL8AAIA/AAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAPwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AACAPwAAAAAAAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AAAgPwAAAD8AACA/AAAAPwAAID8AAAA/AADAPgAAAD8AAMA+AAAAPwAAwD4AAAA/AAAgPwAAgD4AACA/AACAPgAAID8AAIA+AADAPgAAgD4AAMA+AACAPgAAwD4AAIA+AAAgPwAAQD8AACA/AABAPwAAYD8AAAA/AADAPgAAQD8AAAA+AAAAPwAAwD4AAEA/AAAgPwAAgD8AACA/AAAAAAAAYD8AAIA+AADAPgAAgD8AAAA+AACAPgAAwD4AAAAA6gUAQAAAgD8AAIC/6gUAQAAAgD8AAIC/6gUAQAAAgD8AAIC/6gUAQAAAgL8AAIC/6gUAQAAAgL8AAIC/6gUAQAAAgL8AAIC/6gUAQAAAgD8AAIA/6gUAQAAAgD8AAIA/6gUAQAAAgD8AAIA/6gUAQAAAgL8AAIA/6gUAQAAAgL8AAIA/6gUAQAAAgL8AAIA/AFC9OQAAgD8AAIC/AFC9OQAAgD8AAIC/AFC9OQAAgD8AAIC/AFC9OQAAgL8AAIC/AFC9OQAAgL8AAIC/AFC9OQAAgL8AAIC/AFC9OQAAgD8AAIA/AFC9OQAAgD8AAIA/AFC9OQAAgD8AAIA/AFC9OQAAgL8AAIA/AFC9OQAAgL8AAIA/AFC9OQAAgL8AAIA/AAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAPwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AACAPwAAAAAAAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AAAgPwAAAD8AACA/AAAAPwAAID8AAAA/AADAPgAAAD8AAMA+AAAAPwAAwD4AAAA/AAAgPwAAgD4AACA/AACAPgAAID8AAIA+AADAPgAAgD4AAMA+AACAPgAAwD4AAIA+AAAgPwAAQD8AACA/AABAPwAAYD8AAAA/AADAPgAAQD8AAAA+AAAAPwAAwD4AAEA/AAAgPwAAgD8AACA/AAAAAAAAYD8AAIA+AADAPgAAgD8AAAA+AACAPgAAwD4AAAAAJsloQQAAgD8AAIC/JsloQQAAgD8AAIC/JsloQQAAgD8AAIC/JsloQQAAgL8AAIC/JsloQQAAgL8AAIC/JsloQQAAgL8AAIC/JsloQQAAgD8AAIA/JsloQQAAgD8AAIA/JsloQQAAgD8AAIA/JsloQQAAgL8AAIA/JsloQQAAgL8AAIA/JsloQQAAgL8AAIA/JslIQQAAgD8AAIC/JslIQQAAgD8AAIC/JslIQQAAgD8AAIC/JslIQQAAgL8AAIC/JslIQQAAgL8AAIC/JslIQQAAgL8AAIC/JslIQQAAgD8AAIA/JslIQQAAgD8AAIA/JslIQQAAgD8AAIA/JslIQQAAgL8AAIA/JslIQQAAgL8AAIA/JslIQQAAgL8AAIA/AAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAPwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AACAPwAAAAAAAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AAAgPwAAAD8AACA/AAAAPwAAID8AAAA/AADAPgAAAD8AAMA+AAAAPwAAwD4AAAA/AAAgPwAAgD4AACA/AACAPgAAID8AAIA+AADAPgAAgD4AAMA+AACAPgAAwD4AAIA+AAAgPwAAQD8AACA/AABAPwAAYD8AAAA/AADAPgAAQD8AAAA+AAAAPwAAwD4AAEA/AAAgPwAAgD8AACA/AAAAAAAAYD8AAIA+AADAPgAAgD8AAAA+AACAPgAAwD4AAAAA"}]}};function Kot(e,n,i,o,s,a){const h=[],l=zv([],Ax([],i[0],i[1],i[2]),n,o),c=function(e){return new eI.GLTFLoader("",JSON.parse(JSON.stringify(Jot[e]))).load().then((e=>e))}(e);return c.then((e=>{nM.exportGLTFPack(e).getMeshesInfo().forEach(((e,c)=>{const A=new cC({color:s||e.materialInfo.baseColorFactor}),f=new bC(e.geometry,A);f.setUniform("uPickingId",a+c);const d=f.getDefines();d.HAS_PICKING_ID=2,f.setDefines(d),f.translate=n,f.rotation=i,f.scaling=o,Cv(f.localTransform,l,e.nodeMatrix),f.originTransform=_v([],f.localTransform),f.originColor=s||e.materialInfo.baseColorFactor,h.push(f)})),a>100&&(h[0].properties.relatedMeshes=h.slice(1,2),h[1].properties.relatedMeshes=h.slice(0,1),h[2].properties.relatedMeshes=h.slice(3,4),h[3].properties.relatedMeshes=h.slice(2,3),h[4].properties.relatedMeshes=h.slice(5,6),h[5].properties.relatedMeshes=h.slice(4,5),h[6].properties.relatedMeshes=h.slice(0,6))})),h}function $ot(e,n){return Math.abs(e)*Math.sign(n)}function tst(e,n){const i=e.getCoordinates(),o=n.coordinateToPointAtRes(i,n.getGLRes()),s=[o.x,o.y,0];t_(s,s,est(n,e.getTranslation()));const a=function(e,n,i,o){return e._pointAtResToContainerPoint(n,i,void 0)}(n,new w5(s[0],s[1]),n.getGLRes());a.x+=85;const h=function(e,n,i,o){{const o=e.containerPointToCoordinate(n);return e.coordinateToPointAtRes(o,i)}}(n,a,n.getGLRes());return Math.sqrt(Math.pow(h.x-s[0],2)+Math.pow(h.y-s[1],2))/5.272881136101205}function est(e,n){if(!e)return n;const i=e.distanceToPointAtRes(n[0],n[1],e.getGLRes()),o=e.altitudeToPoint(n[2],e.getGLRes());return $v([],$ot(i.x,n[0]),$ot(i.y,n[1]),$ot(o,n[2]))}let nst=class u{constructor(e){this.A=e,this._meshes=this.t()}setCoordinate(e){this.A=e}t(){const e=[],n=340/177,i=Kot("jiantou",[1.2*n,0,0],[0,0,90],[n,n,n],[89/255,206/255,147/255,0],7),o=Kot("jiantou",[0,1.2*n,0],[0,0,180],[n,n,n],[89/255,206/255,147/255,0],8),s=Kot("jiantou",[-1.2*n,0,0],[0,0,270],[n,n,n],[89/255,206/255,147/255,0],9),a=Kot("jiantou",[0,-1.2*n,0],[0,0,0],[n,n,n],[89/255,206/255,147/255,0],10);return e.push(i,o,s,a),e}getMeshes(){return this._meshes}},ist=class m{constructor(e){this.A=e,this._meshes=this.t()}setCoordinate(e){this.A=e}t(){const e=[],n=340/177,i=Kot("xuanzhuan",[0,0,0],[180,0,0],[.5*n,.5*n,.5*n],[50/255,130/255,184/255,.8],11);return e.push(i),e}getMeshes(){return this._meshes}},rst=class b{constructor(e){this.A=e,this._meshes=this.t()}setCoordinate(e){this.A=e}t(){const e=[],n=340/177,i=Kot("yuanhuan",[0,0,0],[0,0,0],[.5*n,.5*n,.5*n],[149/255,179/255,199/255,.5],12);return e.push(i),e}getMeshes(){return this._meshes}},ost=class B{constructor(e){this.A=e,this._meshes=this.t()}setCoordinate(e){this.A=e}t(){const e=[],n=Kot("plane",[0,0,0],[0,0,0],[10,10,10],[1,0,0,.5],16);return e.push(n),e}getMeshes(){return this._meshes}},sst=class y{constructor(e){this.A=e,this._meshes=this.t()}setCoordinate(e){this.A=e}t(){const e=[],n=Kot("xyzScale",[0,0,0],[0,0,0],[2,2,2],null,113);return e.push(n),e}getMeshes(){return this._meshes}};const ast=[],hst=[],lst=[],ust=[],cst=[],Ast=[177/170,177/170,177/170],fst=[],dst=[1,2,3,4,12];let pst=class x{constructor(){this.translate=new nst,this.rotation=new ist,this.scaling=new rst,this.planeHelper=new ost,this.xyzScaleHelper=new sst,this._meshes=this.t(),this.i=!0}t(){const e={};e.translate=this.translate.getMeshes(),e.rotation=this.rotation.getMeshes(),e.scaling=this.scaling.getMeshes(),e.planeHelper=this.planeHelper.getMeshes(),e.xyzScale=this.xyzScaleHelper.getMeshes();const n=340/177,i=Kot("yuanhuan41",[-2.745*n,2.745*n,0],[90,0,0],[.5*n,.5*n,.5*n],[149/255,179/255,199/255,.6],1),o=Kot("yuanhuan41",[2.745*n,2.745*n,0],[-90,0,180],[.5*n,.5*n,.5*n],[50/255,130/255,184/255,.5],2),s=Kot("yuanhuan41",[2.745*n,-2.745*n,0],[90,0,180],[.5*n,.5*n,.5*n],[149/255,179/255,199/255,.6],3),a=Kot("yuanhuan41",[-2.745*n,-2.745*n,0],[-90,0,0],[.5*n,.5*n,.5*n],[50/255,130/255,184/255,.5],4),h=Kot("yuanpan",[0,0,0],[90,0,0],[.5*n,.5*n,.5*n],[89/255,206/255,147/255,.5],5),l=Kot("zzhou",[0,0,6.5],[90,0,0],[1,1,1],[14/255,127/255,191/255,1],6);return e.translate.push(i,o,s,a,h,l),e}updateMatrix(e,n,i,o,s){const a=n.getCoordinates(),h=e.coordinateToPointAtRes(a,e.getGLRes()),l=n.I();$v(hst,h.x,h.y,l);const c=Kv(ast,s),A=est(e,n.getTranslation());t_(hst,hst,A),t_(hst,hst,c);for(const s in this._meshes)for(let a=0;a<this._meshes[s].length;a++){const h=this._meshes[s][a];for(let a=0;a<h.length;a++){const l=h[a],c=l.getUniform("uPickingId"),A=Kv(ast,l.translate);let f=Kv(fst,l.rotation);const d=l.scaling;if(11===c&&(this.i?(f[2]+=i,l.rotation[2]+=i):this.i||(f[2]+=i,l.rotation[2]+=i,f[0]=360,f[2]-=90)),c>100&&1===n.getTargets().length&&(f=n.getTargets()[0].getRotation()),dst.indexOf(c)>-1)if(12!==c)d[0]+=o,d[1]+=o,d[2]+=o;else{const e=this._meshes.translate[4][0];d[0]=1.2*e.scaling[0],d[1]=1.2*e.scaling[0],d[2]=1.2*e.scaling[0]}let p=tst(n,e);if(p=$v(lst,p,p,p),n_(A,A,p),n_(p,p,d),1===c||2===c||3===c||4===c){const e=n_(cst,d,Ast);n_(A,A,e)}const g=Ax(ust,f[0],f[1],f[2]);if(t_(A,A,hst),"xyzScale"===s){const e=zv([],g,A,p);Cv(l.localTransform,e,l.originTransform)}else zv(l.localTransform,g,A,p)}}}getMeshes(e){const n={};return e?("xyzScale"===e?n[e]=this._meshes[e]:(n.translate=this._meshes.translate,"translate"!==e&&(n[e]=this._meshes[e])),n):n}o(e){this.i=e}dispose(){for(const e in this._meshes)for(let n=0;n<this._meshes[e].length;n++){const i=this._meshes[e][n];for(let e=0;e<i.length;e++){const n=i[e];n.geometry.dispose(),n.dispose()}}}};const gst=[],mst=[],yst=[],vst=new w5(0,0),_st=[],xst=[],bst=[],wst=[0,0,0];let Cst=class R{constructor(){this.C=[],this.h=[0,0,0],this.l=[1,1,1],this.P=[0,0,0]}D(e){Array.isArray(e)?e.forEach((e=>{this.D(e)})):(e.on("remove",this.u,this),e.m={coordinate:e.getCoordinates(),translation:e.getTranslation(),rotation:e.getRotation(),scale:e.getScale()},this.C.push(e))}B(){this.C.forEach((e=>{e.off("remove",this.u,this)})),this.C=[]}p(e,n,i,o,s,a,h){for(let h=0;h<this.C.length;h++){const l=this.C[h],c=l.getRotation(),A=l.getScale(),f=this.v(a,l,o,i,n);let d=null;d=o>=0?o:o*(this.options&&this.options.scaleStrength||1);const p=t_(bst,$v(gst,d*A[0],d*A[1],d*A[2]),A),g=Math.min(...p);if(Math.abs(g)<s){const e=Math.abs(g);p[0]=p[0]*(s/e),p[1]=p[1]*(s/e),p[2]=p[2]*(s/e)}const v=t_(c,i,c);l.setCoordinates(f),this.L(e,p,A);const w=l.getTranslation();l.setTRS(w,v,p)}$v(bst,o,o,o),t_(this.P,i,this.P),t_(this.l,bst,this.l),t_(this.h,n,this.h),e.indexOf("translate")>-1?h.fire("positionchange",{action:e,type:"positionchange",target:this.C,center:this.getCoordinates(),scale:this.l,rotation:this.P,translation:this.h,deltaTranslate:n,deltaRotation:i,deltaScale:o}):h.fire("transforming",{action:e,type:"transforming",target:this.C,center:this.C[0].getTransformOrigin(),scale:this.l,rotation:this.P,translation:this.h,deltaTranslate:n,deltaRotation:i,deltaScale:o})}v(e,n,i,o,s){const a=n.getCenter(),h=n.getTransformOrigin(),l=e.getGLRes(),c=e.coordinateToPointAtRes(a,l,vst);c.z=e.altitudeToPoint(a.z,l),$v(_st,c.x,c.y,c.z||0);const A=e.coordinateToPointAtRes(h,l,vst);A.z=e.altitudeToPoint(h.z,l),$v(xst,A.x,A.y,A.z||0);const f=m_(gst,_st,xst),d=Ax(mst,0,0,o[2]);$v(bst,i+1,i+1,i+1);A_(f,f,zv(yst,d,s,bst)),t_(f,f,xst),vst.set(f[0],f[1]);const p=e.pointAtResToCoordinate(vst,l);return p.z=f[2]/e.altitudeToPoint(1,l),p}L(e,n,i){return"x-scale"===e&&(n[1]=i[1],n[2]=i[2]),"y-scale"===e&&(n[0]=i[0],n[2]=i[2]),"z-scale"===e&&(n[0]=i[0],n[1]=i[1]),n}M(){this.C.forEach((e=>{if(e.m){const{coordinate:n,translation:i,rotation:o,scale:s}=e.m;e.setCoordinates(n),e.setTRS(i,o,s)}}))}getScale(){return this.l}getTranslation(){return 1===this.C.length&&this.C[0].getTranslation()||wst}getRotation(){return this.P}O(){return this.C[0]?this.C[0].getLayer():null}getCoordinates(){let e=0,n=0,i=0;const o=this.C.length;if(!o)return null;for(let s=0;s<o;s++){const o=this.C[s].getCenter();e+=o.x,n+=o.y,i+=o.z||0}e/=o,n/=o,i/=o;const s=new o9(e,n,i);for(let e=0;e<o;e++)this.C[e].setTransformOrigin(s);return s}u(e){const n=e.target,i=this.C.indexOf(n);i>-1&&(delete n.m,this.C.splice(i,1))}getTargets(){return this.C}I(){let e=0;const n=this.C.length;for(let i=0;i<n;i++)e+=this.C[i].getPointZ();return e/=n,e}F(){for(let e=0;e<this.C.length;e++)if(this.C[e].isVisible())return!0;return!1}};const Pst=[5,6,7,8,9,10],Mst=[5,7,8,9,10],Tst=[2,4,11],Sst=[1,3,12],Ist=[12,16],Est=[1,2,3,4],Ost=[1,2,3,4,12],Rst=[],Dst=[],kst=[],Lst=[],Fst=[],Nst=[],zst=[];let Bst=class sA extends(m6(t9(v6))){constructor(e={}){super(e),this.options=e,this.mouseAction="moving",this.U=this.options.mode||"translate",this.V=!0,this.TransformHelper=new pst,this.S=new Cst,this.helperScene=new kC([]),this.addToMapCount=0,this.k()}setCoordinates(e){this.T.setCoordinates(e),this.transform(this.T)}enable(){return this.V=!0,this.layerRenderer&&this.layerRenderer.setToRedraw(),this}disable(){return this.V=!1,this.layerRenderer&&this.layerRenderer.setToRedraw(),this.map&&this.map.resetCursor(),this}setMode(e){this.U=e,this.H(),this.layerRenderer&&this.layerRenderer.setToRedraw(),this.fire("modechange",{mode:e,type:"modechange"})}getMode(){return this.U}isEnable(){return this.V}J(e){Pst.indexOf(e)>-1?this.U="translate":Tst.indexOf(e)>-1?this.U="rotation":Sst.indexOf(e)>-1?this.U="scaling":"xyzScale"!==this.U&&(this.U="translate")}N(){return this.U}addTo(e){if(this.map)return this.R(),void console.warn("transform control has been added to a map, it suggest remove from the map before");this.addToMapCount++,this.map=e,this._.addTo(this.map),this.container=e.getContainer(),e.on("dom:mousemove",this.K,this),e.on("dom:mousedown",this.G,this),e.on("dom:mouseup",this.j,this),e.on("zooming moving dragrotating",this.Z,this),this.Y()}k(){this._=new n2(`${t3}_transformcontrol`),this.T=new N1([0,0],{symbol:{url:"cube",modelHeight:1,uniforms:{polygonOpacity:.01}}}).addTo(this._)}remove(){this.map&&this.container&&this.layerRenderer&&(this.R(),this.TransformHelper.dispose(),this.layerRenderer.setToRedraw(),this._.remove(),delete this.T,delete this._,delete this.map,delete this.layer,delete this.layerRenderer,delete this.container,delete this.S)}R(){this.container&&this.map&&(this.map.off("dom:mousemove",this.K,this),this.map.off("dom:mousedown",this.G,this),this.map.off("dom:mouseup",this.j,this),this.map.off("zooming moving dragrotating",this.Z,this),this.layer&&this.layer.off("renderend",this.render,this))}K(e){if(this.W()){if(this.currentMousePosition={x:e.containerPoint.x,y:e.containerPoint.y},"moving"===this.mouseAction){const e=this.q();this.currentPickingObject=this.X(this.currentMousePosition,e,"meshes"),this.currentPickingObject&&null!=this.currentPickingObject.pickingId?(this.J(this.currentPickingObject.pickingId),this.$(6===this.currentPickingObject.pickingId)):(this.$(!1),this.J()),this.AA()}this.eA(this.currentMousePosition)}}G(e){if(!this.W()||0!==e.domEvent.button)return;const n=this.q();this.currentMousePosition={x:e.containerPoint.x,y:e.containerPoint.y},this.tA=!0,this.currentPickingObject=this.X(this.currentMousePosition,n,"meshes"),this.firstDownPoint=this.X(this.currentMousePosition,n,"meshes"),this.currentPickingObject&&null!=this.currentPickingObject.meshId?(this.mouseAction="transform",this.sA(this.currentPickingObject.pickingId),this.map.config("zoomable",!1),this.map.config("draggable",!1),this.layerRenderer&&this.layerRenderer.setToRedraw()):(this.mouseAction="pan",this.map.config("zoomable",!0),this.map.config("draggable",!0),this.H()),this.lastMousePosition=this.currentMousePosition,this.lastPickingObject=this.currentPickingObject,this.lastPickingMesh=n[this.currentPickingObject.meshId]}j(){"transform"===this.mouseAction&&(this.firstDownPoint=null,this.H(),this.tA=!0,this.fire("transformend",{action:this.iA,type:"transformend"})),this.mouseAction="moving","xyzScale"!==this.U&&(this.U="translate"),this.map.config("zoomable",!0),this.map.config("draggable",!0),this.layerRenderer&&this.layerRenderer.setToRedraw()}Z(){const e=this.TransformHelper.planeHelper.getMeshes()[0][0],n=this.map.getBearing();e.rotation[2]=-n,this.nA()}nA(){this.W()&&(this.TransformHelper.updateMatrix(this.map,this.S,0,0,[0,0,0]),this.tA=!0)}picked(e){if(!this.layerRenderer)return!1;const n=this.q();let i=e;e instanceof w5||(i=this.map.coordinateToContainerPoint(new o9(e)));const o=this.X(i,n,"picked");return!(!o||null===o.meshId)}H(){const e=this.TransformHelper.getMeshes("scaling").scaling[0][0],n=340/177;e.scaling=[.6*n,.6*n,.6*n],this.layerRenderer&&(this.IA(e),this.oA())}oA(){this.TransformHelper._meshes.translate.forEach((e=>{for(let n=0;n<e.length;n++){const i=e[n];Est.indexOf(i.getUniform("uPickingId"))>-1&&i.material.set("color",i.originColor)}}))}IA(e){const n=this.S.getCoordinates(),i=this.map.coordinateToPointAtRes(n,this.map.getGLRes()),o=[i.x,i.y,0],s=est(this.map,this.S.getTranslation());t_(o,o,s);const a=Kv([],e.translate),h=e.scaling;let l=tst(this.S,this.map);l=$v([],l,l,l),n_(a,a,l),n_(l,l,h),t_(a,a,o),zv(e.localTransform,[0,0,0,1],a,l),this.q().forEach((e=>{const n=e.getUniform("uPickingId");if(1===n||3===n||2===n||4===n){const n=Kv([],e.translate),i=170/177;e.scaling=[i,i,i];const s=e.scaling,a=e.rotation;let h=tst(this.S,this.map);h=$v([],h,h,h),n_(n,n,h),n_(h,h,s),t_(n,n,o);const l=Ax([],a[0],a[1],a[2]);zv(e.localTransform,l,n,h)}}))}gA(e){const n=this.map.containerPointToCoordinate(e),i=this.map.coordinateToPointAtRes(n,this.map.getGLRes());return{point:[i.x,i.y]}}eA(e){if("transform"===this.mouseAction){const e=this.N(),n=est(this.map,this.S.getTranslation()),i=this.S.I();let o=null,s=null;if(n[2]+i<.01&&"z-translate"!==this.iA)o=this.gA(this.currentMousePosition),s=this.gA(this.lastMousePosition);else{const e=this.TransformHelper.planeHelper.getMeshes()[0];if(o=this.X(this.currentMousePosition,e,"plane"),s=this.X(this.lastMousePosition,e,"plane"),!o||null===o.meshId||!s||null===s.meshId)return}const a=[0,0,0],h=[0,0,0];let l=0,c=0,A=0;if("translate"===e){if("xy-translate"===this.iA){const e=o.point[1]-s.point[1];a[0]=o.point[0]-s.point[0],a[1]=e}else if("x-translate"===this.iA){a[0]=o.point[0]-s.point[0]}else if("y-translate"===this.iA){a[1]=o.point[1]-s.point[1]}else if("z-translate"===this.iA){let e=0;if(this.rA()){const n=this.map.getGLRes(),i=this.map._pointAtResToContainerPoint(new w5(s.point[0],s.point[1]),n),a=this.map._pointAtResToContainerPoint(new w5(o.point[0],o.point[1]),n),h=eb(Zx(Lst,o.point[0]-s.point[0],o.point[1]-s.point[1]));e=a.y<i.y?h:-h}else e=o.point[2]-s.point[2];a[2]=e}}else if("rotation"===e)c=this.aA(o.point,s.point),this.TransformHelper.o(c>=0),h[2]+=c;else if("scaling"===e||"xyzScale"===e){const e=this.CA(),n=eb(Zx(Lst,this.firstDownPoint.point[0]-e[0],this.firstDownPoint.point[1]-e[1])),i=eb(Zx(Lst,s.point[0]-e[0],s.point[1]-e[1]));l=this.hA(o.point,s.point,e,i),A=this.hA(o.point,s.point,e,n)}this.TransformHelper.updateMatrix(this.map,this.S,c,A,a),this.S.p(this.iA,a,h,l,.01,this.map,this)}this.lastMousePosition=e,this.lastPickingObject=this.currentPickingObject;const n=this.q();this.lastPickingMesh=n[this.currentPickingObject.meshId]}hA(e,n,i,o,s){const a=(eb(Zx(Lst,e[0]-i[0],e[1]-i[1]))-eb(Zx(Lst,n[0]-i[0],n[1]-i[1])))/o;return s?(s[0]-.01)*a:a}CA(){const e=this.map,n=this.S.getCoordinates(),i=e.coordinateToPointAtRes(n,e.getGLRes()),o=$v(Fst,i.x,i.y,0);return t_(o,o,est(e,this.S.getTranslation())),o}$(e){const n=this.TransformHelper.planeHelper.getMeshes()[0][0],i=Lv(kst,n.localTransform),o=Fv(Dst,n.localTransform);let s=Ax(Rst,0,0,0);const a=this.map.getBearing();e&&!this.rA()?(s=Ax(Rst,90,0,-a),0===n.rotation[0]&&(this.tA=!0),$v(n.rotation,90,0,-a)):(90===n.rotation[0]&&(this.tA=!0),$v(n.rotation,0,0,-a)),zv(n.localTransform,s,i,o)}rA(){if(this.map.getPitch())return!1;const e=this.map.cameraPosition,n=this.map.coordinateToPointAtRes(this.map.getCenter(),this.map.getGLRes());$v(n,n.x,n.y,0);const i=this.S.getCoordinates(),o=this.map.coordinateToPointAtRes(i,this.map.getGLRes()),s=est(this.map,this.S.getTranslation()),a=$v(kst,o.x,o.y,0);return f_(e_([],e,t_(a,a,s)),e_([],e,n))<1/180*Math.PI}AA(){const e=this.q();if(this.currentPickingObject&&null!=this.currentPickingObject.meshId){this.wA(),this.lastPickingObject&&null!=this.lastPickingObject.meshId&&this.lastPickingObject.meshId!==this.currentPickingObject.meshId&&this.cA();const n=e[this.currentPickingObject.meshId];if(n&&Ist.indexOf(this.currentPickingObject.pickingId)<0)if(this.currentPickingObject.pickingId>100)this.QA(n);else{n.material.set("color",[n.originColor[0],n.originColor[1],n.originColor[2],.8]),this.fA(n,.5)}this.layerRenderer.setToRedraw()}else this.lastPickingObject&&null!=this.lastPickingObject.meshId&&(this.map.resetCursor(),this.cA(),this.layerRenderer.setToRedraw())}QA(e){const n=[1,179/255,2/255,1];e.material.set("color",n),e.properties.relatedMeshes&&e.properties.relatedMeshes.forEach((e=>{e.material.set("color",n)}))}wA(){6===this.currentPickingObject.pickingId?this.map.setCursor("ns-resize"):Mst.indexOf(this.currentPickingObject.pickingId)>-1?this.map.setCursor("move"):this.map.setCursor("pointer")}cA(){const e=this.lastPickingMesh;if(!e)return;const n=e.getUniform("uPickingId"),i=this.q();Mst.indexOf(n)>-1?i.forEach((e=>{Mst.indexOf(e.getUniform("uPickingId"))>-1&&e.material.set("color",e.originColor)})):Ost.indexOf(n)>-1?i.forEach((e=>{const n=e.getUniform("uPickingId");Est.indexOf(n)>-1&&e.material.set("color",e.originColor)})):11===n&&i.forEach((e=>{Est.indexOf(e.getUniform("uPickingId"))>-1&&e.material.set("color",e.originColor)})),e.material.set("color",e.originColor),e.properties.relatedMeshes&&e.properties.relatedMeshes.forEach((e=>{e.material.set("color",e.originColor)}))}fA(e,n){const i=e.getUniform("uPickingId"),o=this.q();Mst.indexOf(i)>-1?o.forEach((i=>{if(Mst.indexOf(i.getUniform("uPickingId"))>-1&&i.getUniform("uPickingId")!==e.getUniform("uPickingId")){i.material.set("color",[i.originColor[0],i.originColor[1],i.originColor[2],n])}})):"scaling"===this.U?o.forEach((e=>{const n=e.getUniform("uPickingId");if(1===n||3===n||2===n||4===n){e.material.set("color",[149/255,179/255,199/255,.8])}})):"rotation"===this.U&&o.forEach((e=>{const n=e.getUniform("uPickingId");if(1===n||3===n||2===n||4===n){const n=e.originColor;e.material.set("color",[n[0],n[1],n[2],0])}}))}reset(){this.map&&this.S&&(this.S.M(),this.TransformHelper.updateMatrix(this.map,this.S,0,0,[0,0,0]))}aA(e,n){const i=this.CA(),o=Zx(Nst,n[0]-i[0],n[1]-i[1]),s=Zx(zst,e[0]-i[0],e[1]-i[1]),a=Math.atan2(o[1],o[0]);return(Math.atan2(s[1],s[0])-a)/Math.PI*180}sA(e){return this.iA=113===e||114===e?"x-scale":115===e||116===e?"z-scale":117===e||118===e?"y-scale":119===e?"xyz-scale":5===e?"xy-translate":6===e?"z-translate":7===e||9===e?"x-translate":8===e||10===e?"y-translate":11===e?"z-rotate":"scale",this.iA}transform(e){if(!e)return;if(this.layerRenderer&&this.layerRenderer.layer&&(this.layerRenderer.layer.off("renderend",this.render),this.layerRenderer.layer.off("resizeCanvas",this.lA)),!this.map)return void console.error("should add to a target first");if(this.S&&(this.S.B(),this.S.D(e)),!this.S.getTargets().length)return;this.TransformHelper.updateMatrix(this.map,this.S,0,0,[0,0,0]),this.PA(),this.tA=!0}getTransformTarget(){return this.S}u(){delete this.S}PA(){const e=this.S.O();e&&(e.off("renderend",this.render),e.off("resizeCanvas",this.lA));const n=this.map,i=e.getRenderer();this.layerRenderer=i,this.regl=i.regl,this.renderer=i.renderer,this.DA=this.layerRenderer.getFBORayPicking(),this.uA={projViewMatrix:n.projViewMatrix,projMatrix:n.projMatrix,viewMatrix:n.viewMatrix,pointSize:1},e.on("renderend",this.render,this),e.on("resizeCanvas",this.lA,this),i.setToRedraw()}lA(){this.DA.clear(),this.tA=!0}X(e,n,i){const o=this.map;if(!(o&&this.DA&&this.layerRenderer&&this.layerRenderer.canvas))return null;const s=o.getDevicePixelRatio(),a=e.x*s,h=e.y*s,l=this.uA;return(this.tA||this.layerRenderer.canvas.gl&&this.layerRenderer.canvas.gl.wrap||!this.mA||this.mA!==i)&&(this.DA.render(n,l,!0),this.mA=i,this.tA=!1),this.DA.pick(a,h,10,l,{viewMatrix:this.map.viewMatrix,projMatrix:this.map.projMatrix,returnPoint:!0})}Y(){const e=this.map.getDevicePixelRatio();this.bA=new eP({vert:"attribute vec3 aPosition;\n\nuniform mat4 projViewModelMatrix;\n\n\n\nvoid main()\n\n{\n\n    gl_Position = projViewModelMatrix * vec4(aPosition, 1.0);\n\n\n\n}\n\n",frag:"precision mediump float;\n\nuniform vec4 color;\n\n\n\nvoid main() {\n\n    gl_FragColor = color;\n\n}\n\n",uniforms:["color",{name:"projViewModelMatrix",type:"function",fn:function(e,n){return Cv([],n.projViewMatrix,n.modelMatrix)}}],extraCommandProps:{viewport:{x:0,y:0,width:()=>this.map?this.map.width*e:1,height:()=>this.map?this.map.height*e:1},depth:{enable:!0,func:"always",mask:!0,range:[0,0]},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}},defines:{}})}render(){if(!this.W())return;const e=this.q();this.helperScene.setMeshes(e);const n=this.layerRenderer.getFrameContext();if(n&&n.renderTarget&&this.layerRenderer.getFrameTimestamp()!==n.timestamp)return;this.nA(),this.bA.filter=n&&n.sceneFilter;this.renderer.render(this.bA,this.uA,this.helperScene,n&&n.renderTarget&&n.renderTarget.fbo)}q(){let e=[];const n=this.TransformHelper.getMeshes(this.U);for(const i in n){if("translate"===i)continue;const o=n[i];for(let n=0;n<o.length;n++)e=e.concat(o[n])}const i=n.translate;if(i)for(let n=0;n<i.length;n++)e=e.concat(i[n]);return e}W(){const e=this.layerRenderer,n=e&&e.layer;return e&&this.S&&n&&n.isVisible()&&this.S.F()&&this.regl&&this.V}};Bst.mergeOptions({scaleStrength:2}),"undefined"!=typeof console&&console.log("@maptalks/transform-control v0.102.1");
/*!
   * @maptalks/msd-json-loader v0.1.0
   * LICENSE : BSD-3-Clause
   * (c) 2016-2022 maptalks.com
   */
class t{constructor(e){this.t=e||{}}getJSON(){return Hst(this.t)}getId(){return this.t.id}getStyle(){return this.t.options?Hst(this.t.options.style):null}getData(){return this.t.options?Hst(this.t.options.data):null}getGeometryById(e){const n=this.t.geometries;if(!n)return null;for(let i=0;i<n.length;i++)if(n[i]&&n[i].options&&n[i].options.id===e)return Hst(n[i]);return null}getGeometries(){return this.t.geometries?Hst(this.t.geometries):[]}}function Hst(e){return e?JSON.parse(JSON.stringify(e)):null}
/*!
   * @maptalks/video-layer v0.98.3
   * LICENSE : UNLICENSED
   * (c) 2016-2024 maptalks.org
   */
/*!
  * Contains code from THREE.js
  * MIT License
  * https://github.com/mrdoob/three.js
  */for(var jst=[],Ust=0;Ust<6;Ust++)jst[Ust]=[];var Gst=[];function Vst(e,n,i){var o,s,a,h,l,c,A,f,d,p,g,v,w,C,P,T,S;s=(o=e)[0],a=o[1],h=o[2],A=o[5],f=o[6],g=o[9],v=o[10],P=o[13],T=o[14],Wst(jst[0],(l=o[3])-s,(d=o[7])-(c=o[4]),(w=o[11])-(p=o[8]),(S=o[15])-(C=o[12])),Wst(jst[1],l+s,d+c,w+p,S+C),Wst(jst[2],l+a,d+A,w+g,S+P),Wst(jst[3],l-a,d-A,w-g,S-P),Wst(jst[4],l-h,d-f,w-v,S-T),Wst(jst[5],l+h,d+f,w+v,S+T);for(var I=0;I<6;I++){var E=jst[I];if(Gst[0]=E[0]>0?n[1][0]:n[0][0],Gst[1]=E[1]>0?n[1][1]:n[0][1],Gst[2]=E[2]>0?n[1][2]:n[0][2],qst(E,Gst)<0)return!1}return!0}function Wst(e,n,i,o,s){var a=1/Math.sqrt(n*n+i*i+o*o);return e[0]=n*a,e[1]=i*a,e[2]=o*a,e[3]=s*a,e}function qst(e,n){return e[0]*n[0]+e[1]*n[1]+e[2]*n[2]+e[3]}const Zst={vert:"\n    attribute vec3 aPosition;\n    attribute vec2 aTexCoord;\n    uniform mat4 projViewModelMatrix;\n    uniform mat4 positionMatrix;\n    uniform mat4 modelMatrix;\n    varying vec2 vTexCoords;\n    #include <get_output>\n    void main()\n    {\n        mat4 localPositionMatrix = getPositionMatrix();\n        vec4 localPosition = getPosition(aPosition);\n        gl_Position = projViewModelMatrix * localPositionMatrix * localPosition;\n        vTexCoords = aTexCoord;\n    }\n",frag:"\n    precision mediump float;\n    uniform sampler2D videoTexture;\n    uniform float opacity;\n\n    varying vec2 vTexCoords;\n    void main() {\n        vec4 color = texture2D(videoTexture, vTexCoords);\n        gl_FragColor = color * opacity;\n    }\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(e,n)=>Cv([],n.projViewMatrix,n.modelMatrix)},"texture","opacity"],positionAttribute:"POSITION",extraCommandProps:{depth:{enable:!0,func:"always"},cull:{enable:!1,face:"back"},frontFace:"cw",blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}},Qst=[1,0,3,3,2,1];function Xst(e,n,i){if(!e)return null;const o=e.coordinateToPointAtRes(n,e.getGLRes());return[o.x,o.y,i]}let Yst=class y extends(Th(Uh(Ih))){constructor(e,n){super(n),this.setCoordinates(e),this.I()}setCoordinates(e){this.R=e}getCoordinates(){return this.R}setVideo(e){this.D="stop",this.options.url=e,delete this.options.elementId,this.I()}setElementId(e){this.D="stop",this.options.elementId=e,delete this.options.url,this.I()}I(){this.D="stop";const e=this.options.url;let n=document.getElementById(this.options.elementId);if(e&&(n=document.createElement("video"),n.src=e),!n)throw new Error("there is no element or url setting for video mask");n.autoplay=!0,n.loop=!0,n.muted=!0,n.play(),n.addEventListener("playing",(()=>{this.D="playing",this.fire("playing",{state:this.D,url:e})})),n.addEventListener("pause",(()=>{this.D="pause",this.fire("pause",{state:this.D,url:e})})),n.addEventListener("error",(()=>{throw this.D="pause",this.fire("error",{state:this.D,url:e}),new Error("video resource load error")})),this.video=n}getVideo(){return this.video}L(e){this.j=e}C(){return this.j}addTo(e){if(this.F)throw new Error("VideoSurface cannot be added to two or more layers at the same time.");return e.addSurfaces(this),this}show(){return this.options.visible=!0,this}hide(){return this.options.visible=!1,this}isVisible(){return this.options.visible}play(){this.video&&this.video.play()}pause(){this.video&&this.video.pause()}setAudio(e){this.video.muted=e}setOpacity(e){this.options.opacity=e}getOpacity(){return this.options.opacity}remove(){delete this.video;const e=this.getLayer();e&&e.removeVideoSurfaces(this),this.endEdit()}getLayer(){return this.F}A(){return"playing"===this.D}startEdit(){const e=this.getLayer();if(!e)return void console.warn("videosurface should be added to a map before edit");const n=e.getMap();if(!n)return void console.warn("videosurface should be added to a map before edit");if(this.N(),!this.G){const i=e.getId();this.G=new ad(`internal_${i}_edit`,{enableAltitude:!0}).addTo(n)}const i=this.getCoordinates();this.H=new Af(i,{symbol:{lineColor:"#34495e",lineWidth:2,polygonFill:"rgb(135,196,240)",polygonOpacity:.1}}).addTo(this.G),this.H.startEdit({newVertexHandleSymbol:{polygonFill:"rgba(0, 0, 0, 0)",polygonOpacity:0,markerType:"ellipse",markerWidth:1,markerHeight:1}}),this.H.on("shapechange",(n=>{const i=n.target.getCoordinates()[0].slice(0,4).map((e=>[e.x,e.y,0]));this.setCoordinates(i),e.getRenderer().M(this)}),this)}endEdit(){this.G&&(this.H.endEdit(),this.H.remove(),this.G.remove()),delete this.G,delete this.H}N(){this.G&&this.G.clear(),delete this.H}};Yst.mergeOptions({opacity:1,visible:!0});let Jst=class b extends RA{constructor(e,n,i){!n||Array.isArray(n)||n instanceof Yst||(i=n,n=null),super(e,i),this.W={},this.videoId=0,this.W={},this.videoId=0,n&&this.addSurfaces(n)}addSurfaces(e){if(e)if(Array.isArray(e))e.forEach((e=>{this.addMarker(e)}));else{e.F=this,this.W[this.videoId]=e,e.L(this.videoId);const n=this.getRenderer();n?n.m()&&n.u(e):this.on("renderercreate",(n=>{n.renderer.m()&&n.renderer.u(e)})),this.videoId++}}showTopAlways(e){this.options.showTopAlways=e;const n=this.getRenderer();n&&n.v()}setDoubleSide(e){this.options.doubleSide=e;const n=this.getRenderer();n&&n.v()}getVideoSurfaces(){const e=[];for(const n in this.W)e.push(this.W[n]);return e}removeVideoSurfaces(e){if(Array.isArray(e))e.forEach((e=>{this.removeVideoSurfaces(e)}));else{const n=e.C(),i=this.getRenderer();i&&i.k(n),delete this.W[n]}}remove(){this.clear(),super.remove()}clear(){const e=this.getVideoSurfaces();for(let n=0;n<e.length;n++)e[n].remove()}};Jst.mergeOptions({renderer:"gl",doubleBuffer:!1,glOptions:null,markerEvents:!0,forceRenderOnZooming:!0,forceRenderOnMoving:!0,forceRenderOnRotating:!0,showTopAlways:!0,doubleSide:!0}),Jst.registerJSONType("VideoLayer"),Jst.registerRenderer("gl",class x extends Mm.CanvasRenderer{constructor(e){super(e),this.t={}}draw(e,n){this.prepareCanvas(),this.i(n)}drawOnInteracting(e,n,i){this.i(i)}needToRedraw(){return!0}hitDetect(){return!1}createContext(){if(this.canvas.gl&&this.canvas.gl.wrap)this.gl=this.canvas.gl.wrap(),this.regl=this.canvas.gl.regl;else{const e=this.layer.options.glOptions||{alpha:!0,depth:!0,stencil:!0};this.glOptions=e,this.gl=this.gl||this.o(this.canvas,e),this.regl=jm({gl:this.gl,extensions:["ANGLE_instanced_arrays","OES_texture_float","OES_texture_half_float","OES_texture_float_linear","OES_texture_half_float_linear","EXT_shader_texture_lod","OES_element_index_uint","OES_standard_derivatives","WEBGL_depth_texture"],optionalExtensions:this.layer.options.glExtensions||[]})}this.h(),this.l();const e=this.layer.getVideoSurfaces();for(let n=0;n<e.length;n++)this.u(e[n])}o(e,n){const i=["webgl","experimental-webgl"];let o=null;for(let s=0;s<i.length;++s){try{o=e.getContext(i[s],n)}catch(e){}if(o)break}return o}l(){const e=this.layer.getMap(),n=new PC(this.regl);this.renderer=n,this.p={projMatrix:e.projMatrix,projViewMatrix:e.projViewMatrix,viewMatrix:e.viewMatrix,halton:[.2107,-.0202],uHalton:[.2107,-.0202],uCameraPosition:e.cameraPosition,cameraPosition:e.cameraPosition,globalTexSize:[e.width,e.height]}}m(){return this.regl}h(){this.viewport={x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1},this.v()}v(){this._&&this._.dispose(),this.layer.options.showTopAlways?(Zst.extraCommandProps.depth.mask=!1,Zst.extraCommandProps.depth.range=[0,0]):(delete Zst.extraCommandProps.depth.mask,delete Zst.extraCommandProps.depth.range),Zst.extraCommandProps.cull.enable=!this.layer.options.doubleSide,this._=new eP(Zst)}u(e){const n=this.regl.texture(),i=new cC({videoTexture:n,opacity:1}),o=e.getCoordinates(),{worldCenter:s,points:a}=this.O(o),h=this.S(a),l=new bC(h,i);this.T(l,s);const c=new kC(l),A=e.C();this.t[A]=c}M(e){const n=e.C(),i=this.t[n].getMeshes()[0],o=e.getCoordinates();i.geometry.dispose();const{worldCenter:s,points:a}=this.O(o),h=this.S(a);i.geometry=h,this.T(i,s)}i(e){const n=this.layer.getVideoSurfaces().filter((e=>e.isVisible()));if(!n.length)return;const i=this.P(n);if(!i)return;let o=null;e&&(o=e.renderTarget&&e.renderTarget.fbo),this.renderer.render(this._,this.p,i,o)}S(e){return new Lw({POSITION:e,TEXCOORD:[0,0,1,0,1,1,0,1]},Qst,0,{primitive:"triangles",positionAttribute:"POSITION",uv0Attribute:"TEXCOORD",normalAttribute:"NORMAL",positionSize:3})}O(e){let n=[];const i=this.getMap(),o=new Af(e).getCenter(),s=Xst(i,o,0);return this.V=s,i&&e.forEach((e=>{const o=new Zh(e[0],e[1]),a=i.altitudeToPoint(e[2]||0,i.getGLRes()),h=Xst(i,o,a);h[0]=h[0]-s[0],h[1]=h[1]-s[1],n=n.concat(h)})),{worldCenter:s,points:n}}P(e){const n=[],i=this.layer.getMap();for(let o=0;o<e.length;o++){const s=e[o],a=this.t[s.C()];if(!a)continue;const h=a.getMeshes();for(let e=0;e<h.length;e++){const o=h[e],a=o.getMaterial(),l=a.get("videoTexture");l&&s.A()&&(l(s.video),a.set("opacity",s.getOpacity())),Vst(i.projViewMatrix,o.getBoundingBox())&&n.push(o)}}return n.length?new kC(n):null}T(e,n){zv(e.localTransform,Ax([],0,0,0),n,[1,1,1])}remove(){this._&&this._.dispose(),super.remove()}clearCanvas(){this.canvas&&(this.regl.clear({color:[0,0,0,0],depth:1,stencil:0}),super.clearCanvas())}k(e){const n=this.t[e];n&&n.getMeshes().forEach((e=>{e.geometry.dispose(),e.material&&e.material.dispose(),e.dispose()}))}}),"undefined"!=typeof console&&console.log("@maptalks/video-layer v0.98.3");
/*!
   * @maptalks/analysis v0.98.3
   * LICENSE : MIT
   * (c) 2016-2024 maptalks.org
   */
const Kst=2048;class D{constructor(e,n){this.renderer=e,this.regl=e.regl,this.i=n,this.u()}u(){this.h=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:Kst,height:Kst,wrap:"clamp",mag:"nearest",min:"nearest"}),depth:!0})}l(e,n,i){const o={projViewMatrix:n,minAltitude:0,logDepthBufFC:2/(Math.log(i+1)/Math.LN2)};this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this.h}),this.renderer.render(this.C,o,e,this.h)}D(e,n){this.C=new eP({vert:"#include <gl2_vert>\n\n#ifdef HAS_ALTITUDE\n\n    attribute vec2 aPosition;\n\n    attribute float aAltitude;\n\n#else\n\n    attribute vec3 aPosition;\n\n#endif\n\n// uniform mat4 projViewMatrix;\n\n// uniform mat4 modelMatrix;\n\nuniform mat4 projViewModelMatrix;\n\nuniform mat4 positionMatrix;\n\nvarying vec2 vHighPrecisionZW;\n\n#include <get_output>\n\nvarying float vFragDepth;\n\n\n\n#ifdef HAS_ALTITUDE\n\n    vec3 unpackVTPosition() {\n\n        return vec3(aPosition, aAltitude);\n\n    }\n\n#endif\n\nvoid main()\n\n{\n\n    #ifdef HAS_ALTITUDE\n\n        vec3 i = unpackVTPosition();\n\n        vec4 j = vec4(i, 1.);\n\n        gl_Position = projViewModelMatrix * j;\n\n    #else\n\n        mat4 localPositionMatrix = getPositionMatrix();\n\n        gl_Position = projViewModelMatrix * localPositionMatrix * getPosition(aPosition);\n\n    #endif\n\n    vFragDepth = 1.0 + gl_Position.w;\n\n    vHighPrecisionZW = gl_Position.zw;\n\n}\n\n",frag:"#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\n#include <gl2_frag>\n\n\n\nuniform float logDepthBufFC;\n\nvarying float vFragDepth;\n\nvarying vec2 vHighPrecisionZW;\n\n\n\nconst float PackUpscale = 256. / 255.;\n\nconst float UnpackDownscale = 255. / 256.;\n\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\n\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\n\nconst float ShiftRight8 = 1. / 256.;\n\nvec4 packDepthToRGBA(const in float v ) {\n\n    vec4 r = vec4(fract(v * PackFactors), v);\n\n    r.yzw -= r.xyz * ShiftRight8;\n\n    return r * PackUpscale;\n\n}\n\nvoid main() {\n\n    gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n    float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\n    glFragColor = packDepthToRGBA(fragCoordZ);\n\n    #if __VERSION__ == 100\n\n        gl_FragColor = glFragColor;\n\n    #endif\n\n}\n\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(e,n)=>Cv([],n.projViewMatrix,n.modelMatrix)}],extraCommandProps:{viewport:{x:0,y:0,width:()=>{const i=this.I(e,n);return i?i.width:1},height:()=>{const i=this.I(e,n);return i?i.height:1}}}}),this.C.version=300}I(e,n){return this.m(e,n)?{width:Kst,height:Kst}:null}m(e,n){return e&&n&&e*n>0}dispose(){this.h&&this.h.destroy(),this.C&&this.C.dispose()}}const $st=[0,0,0,1];class b extends D{u(){this.T=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0});const e=[];this.O=new eP({vert:"attribute vec3 aPosition;\n\nuniform mat4 positionMatrix;\n\nuniform mat4 projViewModelMatrix;\n\n#include <get_output>\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    vec4 localPosition = localPositionMatrix * getPosition(aPosition);\n\n    gl_Position = projViewModelMatrix * localPosition;\n\n}\n\n",frag:"#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\n\n\nvoid main() {\n\n    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n\n}\n\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(n,i)=>Cv(e,i.projViewMatrix,i.modelMatrix)}],extraCommandProps:{viewport:this.i}}),this.F=new kC}render(e,n){this.U(),this.renderer.clear({color:$st,depth:1,framebuffer:this.T}),this.F.setMeshes(e);return this.renderer.render(this.O,{projViewMatrix:n},this.F,this.T),this.T}U(){const e=Yo.isFunction(this.i.width.data)?this.i.width.data():this.i.width,n=Yo.isFunction(this.i.height.data)?this.i.height.data():this.i.height;!this.T||this.T.width===e&&this.T.height===n||this.T.resize(e,n)}dispose(){this.T&&(this.T.destroy(),delete this.T),this.O&&(this.O.dispose(),delete this.O)}}function tat(e,n){return e.altitudeToPoint(n||0,e.getGLRes())}const eat=new Zh(0,0);function nat(e,n,i,o){if(!e)return null;eat.set(n,i);const s=e.coordinateToPointAtRes(eat,e.getGLRes()),a=tat(e,o);return[s.x,s.y,a]}class x extends(Th(Uh(Ih))){constructor(e){super(e),this.N=!0}addTo(e){return e.getMap()?(this.layer=e,this.j()):e.once("add",(()=>{this.addTo(e)}),this),this}j(){const e=this.layer.getRenderer();e?(this.regl=e.regl,this.S(e)):this.layer.once("renderercreate",(e=>{this.regl=e.renderer.regl,this.S(e.renderer)}),this)}enable(){this.N=!0;const e=this.layer.getRenderer();e&&e.setToRedraw()}disable(){this.N=!1;const e=this.layer.getRenderer();e&&e.setToRedraw()}isEnable(){return this.N}remove(){if(this.layer){const e=this.layer;delete this.layer,e.removeAnalysis(this),this.B&&(this.B.dispose(),delete this.B),this.k&&(this.k.dispose(),delete this.k),this.R&&(this.R.forEach((e=>{e.geometry.dispose(),e.dispose()})),delete this.R),this.G&&(this.G.dispose(),delete this.G)}}update(e,n){this.options[e]=n;const i=this.layer.getRenderer();i&&i.setToRedraw()}getExcludeLayers(){return this.options.excludeLayers||[]}setExcludeLayers(e){this.options.excludeLayers=e}exportAnalysisMap(e){if(!this.isEnable())return null;let n=this.B.render(e,this.q);n=n.meshesMap?n.meshesMap:n;const i=this.layer.getRenderer();if(n&&i){const e=i.regl,o=n.width,s=n.height,a=new Uint8Array(4*o*s);return e.read({data:a,x:0,y:0,framebuffer:n,width:o,height:s}),a}return null}getAnalysisType(){return this.type}V(e){const n=new Af(e,{symbol:{polygonOpacity:.2}}).getExtent();return this.W(n,e)}W(e,n){const i=this.layer.getMap(),o=i.getCenter(),s=i.getZoom(),a=i.getPitch(),h=i.getBearing(),l=i.getFitZoom(e),c=e.getCenter();i.setZoom(l),i.setCenter(c),i.setPitch(0),i.setBearing(0);const A=i.getExtent();this._=this._||[],_v(this._,i.projViewMatrix);const f=nat(i,A.xmin,A.ymin),d=nat(i,A.xmax,A.ymax),p=[f[0],f[1],d[0],d[1]],g=nat(i,e.xmin,e.ymin),v=nat(i,e.xmax,e.ymax),w=[g[0],g[1],v[0],v[1]];if(i.setZoom(s),i.setCenter(o),i.setPitch(a),i.setBearing(h),this.R=this.K(n,c),!this.k){const e=new PC(this.regl);this.k=new b(e,this.i)}return{extentMap:this.k.render(this.R,this._),extentInWorld:p,extentPolygon:w}}K(e,n){const i=[],o=this.layer.getMap(),s=nat(o,n.x,n.y,0);for(let n=0;n<e.length;n++){const a=nat(o,...e[n]);i.push(a[0]-s[0]),i.push(a[1]-s[1]),i.push(0)}const a=OT(i,null,3);this.R&&(this.R[0].geometry.dispose(),this.R[0].dispose());const h=new Lw({POSITION:i},a,0,{positionAttribute:"POSITION"}),l=new bC(h),c=zv([],nx([]),s,[1,1,1]);return l.localTransform=c,this.R=[l],this.R}}var iat="attribute vec3 aPosition;\n\nattribute vec2 aTexCoord;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform mat4 projViewModelMatrix;\n\nuniform mat4 cut_projViewMatrixFromViewpoint;\n\nvarying vec4 cut_positionFromViewpoint;\n\nvarying vec2 v_texCoord;\n\n#include <get_output>\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    vec4 localPosition = localPositionMatrix * getPosition(aPosition);\n\n    gl_PointSize = 1.0;\n\n    gl_Position = projViewModelMatrix * localPosition;\n\n    cut_positionFromViewpoint = cut_projViewMatrixFromViewpoint * modelMatrix * localPosition;\n\n    v_texCoord = aTexCoord;\n\n}\n\n",rat="#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\nuniform sampler2D meshesMap;\n\nvarying vec4 cut_positionFromViewpoint;\n\nvarying vec2 v_texCoord;\n\n\n\nvoid main() {\n\n    vec3 shadowCoord = (cut_positionFromViewpoint.xyz / cut_positionFromViewpoint.w)/2.0 + 0.5;\n\n    if (shadowCoord.x > 0.0 && shadowCoord.x < 1.0 && shadowCoord.y > 0.0 && shadowCoord.y < 1.0 && shadowCoord.z < 1.0) {\n\n        gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n\n    } else {\n\n        #ifdef HAS_HELPERPARTS\n\n          gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);\n\n        #else\n\n          gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);\n\n        #endif\n\n        vec2 v = v_texCoord;\n\n    }\n\n}\n\n";const oat={helper:{asset:{generator:"Khronos glTF Blender I/O v1.6.16",version:"2.0"},scene:0,scenes:[{name:"Scene",nodes:[0,1,2,3,4,5,6,7]}],nodes:[{mesh:0,name:"2",scale:[1.365131139755249,1.365131139755249,.21621514856815338],translation:[-8.534053802490234,0,-9.680065155029297]},{mesh:1,name:"3",rotation:[1,0,0,-4.371138828673793e-8],scale:[1.365131139755249,1.365131139755249,.21621514856815338],translation:[-8.534053802490234,.04612281173467636,9.669971466064453]},{mesh:2,name:"1",rotation:[0,0,-1,-4.371138828673793e-8],scale:[1.365131139755249,1.365131139755249,.21621514856815338],translation:[8.530546188354492,.028526417911052704,-9.667880058288574]},{mesh:3,name:"4",rotation:[0,-1,0,1910685676922942e-30],scale:[1.365131139755249,1.365131139755249,.21621514856815338],translation:[8.530546188354492,0,9.639498710632324]},{mesh:4,name:"X",translation:[.008500291034579277,0,11.816417694091797]},{mesh:5,name:"",scale:[9.5003657913208,9.5003657913208,9.5003657913208]},{mesh:6,name:"Y",rotation:[.5384660959243774,.45831674337387085,-.45831674337387085,-.5384663343429565],translation:[11.712308883666992,0,.32547950744628906]},{mesh:7,name:"Z",scale:[.49277400970458984,.41999998688697815,.49277400970458984],translation:[.0035659661516547203,1.6771862506866455,-11.201739311218262]}],materials:[{doubleSided:!0,name:".015",pbrMetallicRoughness:{baseColorFactor:[0,.2746773362159729,.6795424818992615,1],metallicFactor:0,roughnessFactor:.5}},{doubleSided:!0,name:".014",pbrMetallicRoughness:{baseColorFactor:[0,.2746773362159729,.6795424818992615,1],metallicFactor:0,roughnessFactor:.5}},{doubleSided:!0,name:".016",pbrMetallicRoughness:{baseColorFactor:[0,.2746773362159729,.6795424818992615,1],metallicFactor:0,roughnessFactor:.5}},{doubleSided:!0,name:".013",pbrMetallicRoughness:{baseColorFactor:[0,.2746773362159729,.6795424818992615,1],metallicFactor:0,roughnessFactor:.5}},{doubleSided:!0,name:".009",pbrMetallicRoughness:{baseColorFactor:[0,.2746773362159729,.6795424818992615,.800000011920929],metallicFactor:0,roughnessFactor:.5}},{alphaMode:"BLEND",name:"Color_H04",pbrMetallicRoughness:{metallicFactor:0,roughnessFactor:.6000000238418579}},{doubleSided:!0,name:".017",pbrMetallicRoughness:{baseColorFactor:[0,.2746773362159729,.6795424818992615,.800000011920929],metallicFactor:0,roughnessFactor:.5}},{alphaMode:"BLEND",name:"Color_H04.006",pbrMetallicRoughness:{metallicFactor:0,roughnessFactor:.6000000238418579}},{doubleSided:!0,name:".023",pbrMetallicRoughness:{baseColorFactor:[.010960042476654053,.25818300247192383,.7991030216217041,1],metallicFactor:0,roughnessFactor:.5}},{doubleSided:!0,name:".022",pbrMetallicRoughness:{baseColorFactor:[.010960042476654053,.25818300247192383,.7991030216217041,1],metallicFactor:0,roughnessFactor:.5}},{doubleSided:!0,name:".021",pbrMetallicRoughness:{baseColorFactor:[.010960042476654053,.25818300247192383,.7991030216217041,1],metallicFactor:0,roughnessFactor:.5}}],meshes:[{name:".009",primitives:[{attributes:{POSITION:0,NORMAL:1,TEXCOORD_0:2},indices:3,material:0}]},{name:".010",primitives:[{attributes:{POSITION:4,NORMAL:5,TEXCOORD_0:6},indices:3,material:1}]},{name:".011",primitives:[{attributes:{POSITION:7,NORMAL:8,TEXCOORD_0:9},indices:3,material:2}]},{name:".012",primitives:[{attributes:{POSITION:10,NORMAL:11,TEXCOORD_0:12},indices:3,material:3}]},{name:".004",primitives:[{attributes:{POSITION:13,NORMAL:14,TEXCOORD_0:15},indices:16,material:4},{attributes:{POSITION:17,NORMAL:18,TEXCOORD_0:19},indices:20,material:5}]},{name:".015",primitives:[{attributes:{POSITION:21,NORMAL:22,TEXCOORD_0:23},indices:24}]},{name:".008",primitives:[{attributes:{POSITION:25,NORMAL:26,TEXCOORD_0:27},indices:16,material:6},{attributes:{POSITION:28,NORMAL:29,TEXCOORD_0:30},indices:20,material:7}]},{name:".011",primitives:[{attributes:{POSITION:31,NORMAL:32,TEXCOORD_0:33},indices:34,material:8},{attributes:{POSITION:35,NORMAL:36,TEXCOORD_0:37},indices:38,material:9},{attributes:{POSITION:39,NORMAL:40,TEXCOORD_0:41},indices:42,material:10}]}],accessors:[{bufferView:0,componentType:5126,count:68,max:[1,.08513133227825165,11.627518653869629],min:[-1,0,-1.0000085830688477],type:"VEC3"},{bufferView:1,componentType:5126,count:68,type:"VEC3"},{bufferView:2,componentType:5126,count:68,type:"VEC2"},{bufferView:3,componentType:5123,count:144,type:"SCALAR"},{bufferView:4,componentType:5126,count:68,max:[1,.08513133227825165,11.627518653869629],min:[-1,0,-1.0000085830688477],type:"VEC3"},{bufferView:5,componentType:5126,count:68,type:"VEC3"},{bufferView:6,componentType:5126,count:68,type:"VEC2"},{bufferView:7,componentType:5126,count:68,max:[1,.08513133227825165,11.627518653869629],min:[-1,0,-1.0000085830688477],type:"VEC3"},{bufferView:8,componentType:5126,count:68,type:"VEC3"},{bufferView:9,componentType:5126,count:68,type:"VEC2"},{bufferView:10,componentType:5126,count:68,max:[1,.08513133227825165,11.627518653869629],min:[-1,0,-1.0000085830688477],type:"VEC3"},{bufferView:11,componentType:5126,count:68,type:"VEC3"},{bufferView:12,componentType:5126,count:68,type:"VEC2"},{bufferView:13,componentType:5126,count:32,max:[1,0,1],min:[-1,0,-1],type:"VEC3"},{bufferView:14,componentType:5126,count:32,type:"VEC3"},{bufferView:15,componentType:5126,count:32,type:"VEC2"},{bufferView:16,componentType:5123,count:90,type:"SCALAR"},{bufferView:17,componentType:5126,count:745,max:[.7661519646644592,.011582847684621811,.664243221282959],min:[-.7468101978302002,-.015204675495624542,-.6202079057693481],type:"VEC3"},{bufferView:18,componentType:5126,count:745,type:"VEC3"},{bufferView:19,componentType:5126,count:745,type:"VEC2"},{bufferView:20,componentType:5123,count:1053,type:"SCALAR"},{bufferView:21,componentType:5126,count:4,max:[1,0,1],min:[-1,0,-1],type:"VEC3"},{bufferView:22,componentType:5126,count:4,type:"VEC3"},{bufferView:23,componentType:5126,count:4,type:"VEC2"},{bufferView:24,componentType:5123,count:6,type:"SCALAR"},{bufferView:25,componentType:5126,count:32,max:[1,0,1],min:[-1,0,-1],type:"VEC3"},{bufferView:26,componentType:5126,count:32,type:"VEC3"},{bufferView:27,componentType:5126,count:32,type:"VEC2"},{bufferView:28,componentType:5126,count:745,max:[.7661519646644592,.011582847684621811,.664243221282959],min:[-.7468101978302002,-.015204675495624542,-.6202079057693481],type:"VEC3"},{bufferView:29,componentType:5126,count:745,type:"VEC3"},{bufferView:30,componentType:5126,count:745,type:"VEC2"},{bufferView:31,componentType:5126,count:16,max:[1,1,1],min:[-1,-1,-1],type:"VEC3"},{bufferView:32,componentType:5126,count:16,type:"VEC3"},{bufferView:33,componentType:5126,count:16,type:"VEC2"},{bufferView:34,componentType:5123,count:18,type:"SCALAR"},{bufferView:35,componentType:5126,count:16,max:[1.0000004768371582,-6.847862720489502,1.0000038146972656],min:[-.999999463558197,-8.847862243652344,-.9999960660934448],type:"VEC3"},{bufferView:36,componentType:5126,count:16,type:"VEC3"},{bufferView:37,componentType:5126,count:16,type:"VEC2"},{bufferView:38,componentType:5123,count:18,type:"SCALAR"},{bufferView:39,componentType:5126,count:24,max:[.23352710902690887,-.6051979064941406,.20581023395061493],min:[-.16755716502666473,-7.437830924987793,-.19527404010295868],type:"VEC3"},{bufferView:40,componentType:5126,count:24,type:"VEC3"},{bufferView:41,componentType:5126,count:24,type:"VEC2"},{bufferView:42,componentType:5123,count:36,type:"SCALAR"}],bufferViews:[{buffer:0,byteLength:816,byteOffset:0},{buffer:0,byteLength:816,byteOffset:816},{buffer:0,byteLength:544,byteOffset:1632},{buffer:0,byteLength:288,byteOffset:2176},{buffer:0,byteLength:816,byteOffset:2464},{buffer:0,byteLength:816,byteOffset:3280},{buffer:0,byteLength:544,byteOffset:4096},{buffer:0,byteLength:816,byteOffset:4640},{buffer:0,byteLength:816,byteOffset:5456},{buffer:0,byteLength:544,byteOffset:6272},{buffer:0,byteLength:816,byteOffset:6816},{buffer:0,byteLength:816,byteOffset:7632},{buffer:0,byteLength:544,byteOffset:8448},{buffer:0,byteLength:384,byteOffset:8992},{buffer:0,byteLength:384,byteOffset:9376},{buffer:0,byteLength:256,byteOffset:9760},{buffer:0,byteLength:180,byteOffset:10016},{buffer:0,byteLength:8940,byteOffset:10196},{buffer:0,byteLength:8940,byteOffset:19136},{buffer:0,byteLength:5960,byteOffset:28076},{buffer:0,byteLength:2106,byteOffset:34036},{buffer:0,byteLength:48,byteOffset:36144},{buffer:0,byteLength:48,byteOffset:36192},{buffer:0,byteLength:32,byteOffset:36240},{buffer:0,byteLength:12,byteOffset:36272},{buffer:0,byteLength:384,byteOffset:36284},{buffer:0,byteLength:384,byteOffset:36668},{buffer:0,byteLength:256,byteOffset:37052},{buffer:0,byteLength:8940,byteOffset:37308},{buffer:0,byteLength:8940,byteOffset:46248},{buffer:0,byteLength:5960,byteOffset:55188},{buffer:0,byteLength:192,byteOffset:61148},{buffer:0,byteLength:192,byteOffset:61340},{buffer:0,byteLength:128,byteOffset:61532},{buffer:0,byteLength:36,byteOffset:61660},{buffer:0,byteLength:192,byteOffset:61696},{buffer:0,byteLength:192,byteOffset:61888},{buffer:0,byteLength:128,byteOffset:62080},{buffer:0,byteLength:36,byteOffset:62208},{buffer:0,byteLength:288,byteOffset:62244},{buffer:0,byteLength:288,byteOffset:62532},{buffer:0,byteLength:192,byteOffset:62820},{buffer:0,byteLength:72,byteOffset:63012}],buffers:[{byteLength:63084,uri:"data:application/octet-stream;base64,AACAvwAAAAAAAIA/AACAvwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIA/AACAvwAAAAAAAIC/AACAvwAAAAAAAIC/AACAPwAAAAAAAIC/AACAPwAAAAAAAIC/1Pt/v2EECDtIAIC/1Pt/v2EECDtIAIC/1vt/v2EECDtRCjpB1vt/v2EECDtRCjpBGuQuv2EECDtIAIC/GuQuv2EECDtIAIC/HOQuv2EECDtRCjpBHOQuv2EECDtRCjpBAACAvwAAAAAAAIC/AACAvwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIC/GuQuv2EECDtIAIC/GuQuv2EECDtIAIC/GuQuv2EECDtIAIC/1Pt/v2EECDtIAIC/1Pt/v2EECDtIAIC/1Pt/v2EECDtIAIC/1vt/v2EECDtRCjpB1vt/v2EECDtRCjpB1vt/v2EECDtRCjpBHOQuv2EECDtRCjpBHOQuv2EECDtRCjpBHOQuv2EECDtRCjpBAACAvwAAAAAAAIC/AACAvwAAAAAAAIC/AACAvwAAAAAAAIC/AACAvwAAAAAAAIA/AACAvwAAAAAAAIA/AACAvwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIC/AACAPwAAAAAAAIC/AACAPwAAAAAAAIC/GuQuv1ZZrj1IAIC/GuQuv1ZZrj1IAIC/GuQuv1ZZrj1IAIC/1Pt/v1ZZrj1IAIC/1Pt/v1ZZrj1IAIC/1Pt/v1ZZrj1IAIC/1vt/v1ZZrj1RCjpB1vt/v1ZZrj1RCjpB1vt/v1ZZrj1RCjpBHOQuv1ZZrj1RCjpBHOQuv1ZZrj1RCjpBHOQuv1ZZrj1RCjpBAACAvzMZqj0AAIC/AACAvzMZqj0AAIC/AACAvzMZqj0AAIC/AACAvzMZqj0AAIA/AACAvzMZqj0AAIA/AACAvzMZqj0AAIA/AACAPzMZqj0AAIA/AACAPzMZqj0AAIA/AACAPzMZqj0AAIA/AACAPzMZqj0AAIC/AACAPzMZqj0AAIC/AACAPzMZqj0AAIC/AAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAA6F3SyAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAA6F3SyAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAA6F3SyAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAA6F3SyAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAAAAAAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAgD8AAIA/AACAPwAAgD8AAIA/AAAAAAAAAAAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAAAAAAAAAAAAAAAAAAAAAIA/AACAPwAAgD8AAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAABAAGAAAABgACAAgADAAOAAgADgAKABMAEAAiABMAIgAqAB8AFgAuAB8ALgA3AA0ACQAZAA0AGQAVAAMABwATAAMAEwASAAUAAQARAAUAEQAQAA8ADQAVAA8AFQAeAAkACwAcAAkAHAAZAAcABQAQAAcAEAATAAEAAwASAAEAEgARAAsADwAeAAsAHgAcACgAKwBDACgAQwBAABEAEgAnABEAJwAlABIAEwAqABIAKgAnABAAEQAlABAAJQAiADEANAA2ADEANgAtAD0APwBCAD0AQgA6ACAAIwA7ACAAOwA4ABcAGgAyABcAMgAvACkAIQA5ACkAOQBBACQAJgA+ACQAPgA8ABsAHQA1ABsANQAzABQAGAAwABQAMAAsAAAAgL8AAAAAAACAPwAAgL8AAAAAAACAPwAAgD8AAAAAAACAPwAAgD8AAAAAAACAPwAAgL8AAAAAAACAvwAAgL8AAAAAAACAvwAAgD8AAAAAAACAvwAAgD8AAAAAAACAv9T7f79hBAg7SACAv9T7f79hBAg7SACAv9b7f79hBAg7UQo6Qdb7f79hBAg7UQo6QRrkLr9hBAg7SACAvxrkLr9hBAg7SACAvxzkLr9hBAg7UQo6QRzkLr9hBAg7UQo6QQAAgL8AAAAAAACAvwAAgL8AAAAAAACAPwAAgD8AAAAAAACAPwAAgD8AAAAAAACAvxrkLr9hBAg7SACAvxrkLr9hBAg7SACAvxrkLr9hBAg7SACAv9T7f79hBAg7SACAv9T7f79hBAg7SACAv9T7f79hBAg7SACAv9b7f79hBAg7UQo6Qdb7f79hBAg7UQo6Qdb7f79hBAg7UQo6QRzkLr9hBAg7UQo6QRzkLr9hBAg7UQo6QRzkLr9hBAg7UQo6QQAAgL8AAAAAAACAvwAAgL8AAAAAAACAvwAAgL8AAAAAAACAvwAAgL8AAAAAAACAPwAAgL8AAAAAAACAPwAAgL8AAAAAAACAPwAAgD8AAAAAAACAPwAAgD8AAAAAAACAPwAAgD8AAAAAAACAPwAAgD8AAAAAAACAvwAAgD8AAAAAAACAvwAAgD8AAAAAAACAvxrkLr9WWa49SACAvxrkLr9WWa49SACAvxrkLr9WWa49SACAv9T7f79WWa49SACAv9T7f79WWa49SACAv9T7f79WWa49SACAv9b7f79WWa49UQo6Qdb7f79WWa49UQo6Qdb7f79WWa49UQo6QRzkLr9WWa49UQo6QRzkLr9WWa49UQo6QRzkLr9WWa49UQo6QQAAgL8zGao9AACAvwAAgL8zGao9AACAvwAAgL8zGao9AACAvwAAgL8zGao9AACAPwAAgL8zGao9AACAPwAAgL8zGao9AACAPwAAgD8zGao9AACAPwAAgD8zGao9AACAPwAAgD8zGao9AACAPwAAgD8zGao9AACAvwAAgD8zGao9AACAvwAAgD8zGao9AACAvwAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgD8AAAAAOhf0MQAAgL8AAAAAOhd0sgAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgL8AAAAAOhd0sgAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAgD8AAAAAOhf0MQAAgL8AAAAAAAAAgAAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgL8AAAAAAAAAgAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAgD8AAAAAAAAAgAAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgD8AAAAAAAAAgAAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgD8AAAAAOhf0MQAAgL8AAAAAOhd0sgAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgL8AAAAAOhd0sgAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAgD8AAAAAOhf0MQAAgL8AAAAAAAAAgAAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgL8AAAAAAAAAgAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAgD8AAAAAAAAAgAAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgD8AAAAAAAAAgAAAAAAAAIA/AAAAAAAAgD8AAIA/AACAPwAAgD8AAIA/AAAAAAAAAAAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAAAAAAAAAACAPwAAAAAAAIA/AACAPwAAgD8AAIA/AACAPwAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAAAAAAAAAAAAAAAAAACAPwAAgD8AAIA/AACAPwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIC/AAAAAAAAgD8AAIC/AAAAAAAAgD8AAIA/AAAAAAAAgD8AAIA/AAAAAAAAgD8AAIC/AAAAAAAAgL8AAIC/AAAAAAAAgL8AAIA/AAAAAAAAgL8AAIA/AAAAAAAAgL/U+3+/YQQIO0gAgL/U+3+/YQQIO0gAgL/W+3+/YQQIO1EKOkHW+3+/YQQIO1EKOkEa5C6/YQQIO0gAgL8a5C6/YQQIO0gAgL8c5C6/YQQIO1EKOkEc5C6/YQQIO1EKOkEAAIC/AAAAAAAAgL8AAIC/AAAAAAAAgD8AAIA/AAAAAAAAgD8AAIA/AAAAAAAAgL8a5C6/YQQIO0gAgL8a5C6/YQQIO0gAgL8a5C6/YQQIO0gAgL/U+3+/YQQIO0gAgL/U+3+/YQQIO0gAgL/U+3+/YQQIO0gAgL/W+3+/YQQIO1EKOkHW+3+/YQQIO1EKOkHW+3+/YQQIO1EKOkEc5C6/YQQIO1EKOkEc5C6/YQQIO1EKOkEc5C6/YQQIO1EKOkEAAIC/AAAAAAAAgL8AAIC/AAAAAAAAgL8AAIC/AAAAAAAAgL8AAIC/AAAAAAAAgD8AAIC/AAAAAAAAgD8AAIC/AAAAAAAAgD8AAIA/AAAAAAAAgD8AAIA/AAAAAAAAgD8AAIA/AAAAAAAAgD8AAIA/AAAAAAAAgL8AAIA/AAAAAAAAgL8AAIA/AAAAAAAAgL8a5C6/VlmuPUgAgL8a5C6/VlmuPUgAgL8a5C6/VlmuPUgAgL/U+3+/VlmuPUgAgL/U+3+/VlmuPUgAgL/U+3+/VlmuPUgAgL/W+3+/VlmuPVEKOkHW+3+/VlmuPVEKOkHW+3+/VlmuPVEKOkEc5C6/VlmuPVEKOkEc5C6/VlmuPVEKOkEc5C6/VlmuPVEKOkEAAIC/MxmqPQAAgL8AAIC/MxmqPQAAgL8AAIC/MxmqPQAAgL8AAIC/MxmqPQAAgD8AAIC/MxmqPQAAgD8AAIC/MxmqPQAAgD8AAIA/MxmqPQAAgD8AAIA/MxmqPQAAgD8AAIA/MxmqPQAAgD8AAIA/MxmqPQAAgL8AAIA/MxmqPQAAgL8AAIA/MxmqPQAAgL8AAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIA/AAAAADoX9DEAAIC/AAAAADoXdLIAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIC/AAAAADoXdLIAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAIA/AAAAADoX9DEAAIC/AAAAAAAAAIAAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIC/AAAAAAAAAIAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAIA/AAAAAAAAAIAAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIA/AAAAAAAAAIAAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIA/AAAAADoX9DEAAIC/AAAAADoXdLIAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIC/AAAAADoXdLIAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAIA/AAAAADoX9DEAAIC/AAAAAAAAAIAAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIC/AAAAAAAAAIAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAIA/AAAAAAAAAIAAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIA/AAAAAAAAAIAAAAAAAACAPwAAAAAAAIA/AACAPwAAgD8AAIA/AACAPwAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAAAAAAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAAAAAAAAgD8AAIA/AACAPwAAgD8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAvwAAAAAAAIA/AACAvwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIA/AACAvwAAAAAAAIC/AACAvwAAAAAAAIC/AACAPwAAAAAAAIC/AACAPwAAAAAAAIC/1Pt/v2EECDtIAIC/1Pt/v2EECDtIAIC/1vt/v2EECDtRCjpB1vt/v2EECDtRCjpBGuQuv2EECDtIAIC/GuQuv2EECDtIAIC/HOQuv2EECDtRCjpBHOQuv2EECDtRCjpBAACAvwAAAAAAAIC/AACAvwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIC/GuQuv2EECDtIAIC/GuQuv2EECDtIAIC/GuQuv2EECDtIAIC/1Pt/v2EECDtIAIC/1Pt/v2EECDtIAIC/1Pt/v2EECDtIAIC/1vt/v2EECDtRCjpB1vt/v2EECDtRCjpB1vt/v2EECDtRCjpBHOQuv2EECDtRCjpBHOQuv2EECDtRCjpBHOQuv2EECDtRCjpBAACAvwAAAAAAAIC/AACAvwAAAAAAAIC/AACAvwAAAAAAAIC/AACAvwAAAAAAAIA/AACAvwAAAAAAAIA/AACAvwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIC/AACAPwAAAAAAAIC/AACAPwAAAAAAAIC/GuQuv1ZZrj1IAIC/GuQuv1ZZrj1IAIC/GuQuv1ZZrj1IAIC/1Pt/v1ZZrj1IAIC/1Pt/v1ZZrj1IAIC/1Pt/v1ZZrj1IAIC/1vt/v1ZZrj1RCjpB1vt/v1ZZrj1RCjpB1vt/v1ZZrj1RCjpBHOQuv1ZZrj1RCjpBHOQuv1ZZrj1RCjpBHOQuv1ZZrj1RCjpBAACAvzMZqj0AAIC/AACAvzMZqj0AAIC/AACAvzMZqj0AAIC/AACAvzMZqj0AAIA/AACAvzMZqj0AAIA/AACAvzMZqj0AAIA/AACAPzMZqj0AAIA/AACAPzMZqj0AAIA/AACAPzMZqj0AAIA/AACAPzMZqj0AAIC/AACAPzMZqj0AAIC/AACAPzMZqj0AAIC/AAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAA6F3SyAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAA6F3SyAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAA6F3SyAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAA6F3SyAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAAAAAAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAgD8AAIA/AACAPwAAgD8AAIA/AAAAAAAAAAAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAAAAAAAAAAAAAAAAAAAAAIA/AACAPwAAgD8AAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAACAv8LFR74AAAAAvhR7vxbvw74AAAAAXoNsv9o5Dr8AAAAAMdtUv/MENb8AAAAA8wQ1vzHbVL8AAAAA2jkOv16DbL8AAAAAFe/Dvr4Ue78AAAAAxMVHvgAAgL8AAAAALr07M74Ue78AAAAAwsVHPl+DbL8AAAAAFO/DPjLbVL8AAAAA2TkOP/MENb8AAAAA8wQ1P9k5Dr8AAAAAMttUPxfvw74AAAAAXoNsP8HFR74AAAAAvxR7Py69uzMAAAAAAACAP73FRz4AAAAAvxR7PxXvwz4AAAAAXoNsP9s5Dj8AAAAAMNtUP/IENT8AAAAA9AQ1Py/bVD8AAAAA3TkOP16DbD8AAAAAGu/DPr4Uez8AAAAAxsVHPgAAgD8AAAAALt5Msr4Uez8AAAAAyMVHvl2DbD8AAAAAG+/DvjPbVD8AAAAA1zkOv/UENT8AAAAA8gQ1v9s5Dj8AAAAAMdtUvxXvwz4AAAAAX4Nsv7zFRz4AAAAAvxR7vwAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAEAAgACAAMABAAEAAUABgAGAAcACAAIAAkACgAKAAsADAAMAA0ADgAOAA8AEAAQABEAEgASABMAFAAUABUAFgAWABcAGAAYABkAGgAaABsAHAAcAB0AHgAeAB8AAAAAAAIABAAEAAYACAAIAAoADAAMAA4AEAAQABIAFAAUABYAGAAYABoAHAAcAB4AAAAAAAQACAAIAAwAEAAQABQAGAAYABwAAAAAAAgAEAAQABgAAAAcfF8+4Bx5vDz+Fb8cfF8+4Bx5vDz+Fb8cfF8+4Bx5vDz+Fb8cfF8+4Bx5vDz+Fb8cfF8+4Bx5vDz+Fb8McFu+mRx5vOP/r74McFu+mRx5vOP/r74McFu+mRx5vOP/r74Uxg8+2Bx5vOJ5G78Uxg8+2Bx5vOJ5G78Uxg8+2Bx5vOJ5G78Uxg8+2Bx5vOJ5G7/osCq+oRx5vN/bvL7osCq+oRx5vN/bvL7INe69qBx5vOSPxr7INe69qBx5vOSPxr7Q/IK9sBx5vL30zL7Q/IK9sBx5vL30zL7Q/IK9sBx5vL30zL7K6JU+5xx5vEYODr/K6JU+5xx5vEYODr/K6JU+5xx5vEYODr/K6JU+5xx5vEYODr/K6JU+5xx5vEYODr8APSu8txx5vJ3wz74APSu8txx5vJ3wz77QnjE9vRx5vHt3z77QnjE9vRx5vHt3z7746sU9wxx5vDOLy7746sU9wxx5vDOLy7746sU9wxx5vDOLy74Wybk+7Rx5vAjKA78Wybk+7Rx5vAjKA78Wybk+7Rx5vAjKA78Wybk+7Rx5vAjKA7+MGRg+yBx5vLA7xL6MGRg+yBx5vLA7xL40/Uo+zRx5vGimub40/Uo+zRx5vGimub40/Uo+zRx5vGimub4izto+8Rx5vOq17r4izto+8Rx5vOq17r4izto+8Rx5vOq17r7U0no+0Rx5vA72q77U0no+0Rx5vA72q77U0no+0Rx5vA72q76qcvg+9Bx5vIbm0b6qcvg+9Bx5vIbm0b6qcvg+9Bx5vIbm0b6qcvg+9Bx5vIbm0b7SbJM+1Bx5vPdhm77SbJM+1Bx5vPdhm77WL6c+1Rx5vAYtiL7WL6c+1Rx5vAYtiL7WL6c+1Rx5vAYtiL59Hwk/9Rx5vDiasb59Hwk/9Rx5vDiasb59Hwk/9Rx5vDiasb66Yrg+1hx5vJhJZb66Yrg+1hx5vJhJZb66Yrg+1hx5vJhJZb5x5RM/9Rx5vFZTjr5x5RM/9Rx5vFZTjr5x5RM/9Rx5vFZTjr5x5RM/9Rx5vFZTjr6yasU+1hx5vCieOr6yasU+1hx5vCieOr6yasU+1hx5vCieOr4+dd8+zhx5vABTRzs+dd8+zhx5vABTRzs+dd8+zhx5vABTRzs+dd8+zhx5vABTRzs+dd8+zhx5vABTRztGxYA+xRx5vOoPLL69LRw/9Bx5vEj9Ur69LRw/9Bx5vEj9Ur6JIkQ/CB15vAzvY76JIkQ/CB15vAzvY74zFgo/1Bx5vDBIyT3AWYK+pRx5vGN2EL/AWYK+pRx5vGN2EL/AWYK+pRx5vGN2EL/Zw8i+jRx5vKrq9b7Zw8i+jRx5vKrq9b4k6aa+mRx5vGTRBr8tYee+ghx5vDUk2r4tYee+ghx5vDUk2r4tYee+ghx5vDUk2r6UUje+sBx5vGO9F7+UUje+sBx5vGO9F7+UUje+sBx5vGO9F7/EIgG/dxx5vIu/ur7EIgG/dxx5vIu/ur7EIgG/dxx5vIu/ur6oz829uxx5vAaJHL+oz829uxx5vAaJHL+oz829uxx5vAaJHL8qggy/bBx5vGs7mL4qggy/bBx5vGs7mL4qggy/bBx5vGs7mL7AvqW8xhx5vPLFHr/AvqW8xhx5vPLFHr/AvqW8xhx5vPLFHr/goBW/Yxx5vFxGZr7goBW/Yxx5vFxGZr7goBW/Yxx5vFxGZr5QxXc90Bx5vBVrHr9QxXc90Bx5vBVrHr9QxXc90Bx5vBVrHr8WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL7aSYS+kRx5vM4voL7aSYS+kRx5vM4voL7aSYS+kRx5vM4voL6+spi+ihx5vH6rjb6+spi+ihx5vH6rjb5KoKq+ghx5vHN7cb5KoKq+ghx5vHN7cb4qyrm+exx5vPJ1Q74qyrm+exx5vPJ1Q74c88W+dRx5vE0AEr4c88W+dRx5vE0AEr4O6s6+bxx5vFTEu71x5RM/MMU9PFZTjr69LRw/9Bx5vEj9Ur5x5RM/9Rx5vFZTjr69LRw/MsU9PEj9Ur6JIkQ/HsU9PAzvY76JIkQ/HsU9PAzvY769LRw/9Bx5vEj9Ur69LRw/9Bx5vEj9Ur69LRw/MsU9PEj9Ur6JIkQ/CB15vAzvY76JIkQ/CB15vAzvY76JIkQ/CB15vAzvY74zFgo/UsU9PDBIyT0zFgo/UsU9PDBIyT0zFgo/1Bx5vDBIyT2JIkQ/HsU9PAzvY74zFgo/UsU9PDBIyT0zFgo/UsU9PDBIyT0zFgo/UsU9PDBIyT0zFgo/UsU9PDBIyT0+dd8+zhx5vABTRzs+dd8+zhx5vABTRzszFgo/1Bx5vDBIyT1GxYA+xRx5vOoPLL5GxYA+xRx5vOoPLL5GxYA+YsU9POoPLL5GxYA+YsU9POoPLL4+dd8+WMU9PABTRzuyasU+UMU9PCieOr5GxYA+xRx5vOoPLL5GxYA+YsU9POoPLL6yasU+1hx5vCieOr6yasU+UMU9PCieOr66Yrg+1hx5vJhJZb6yasU+1hx5vCieOr66Yrg+UMU9PJhJZb7WL6c+1Rx5vAYtiL7WL6c+UMU9PAYtiL7SbJM+1Bx5vPdhm77SbJM+UsU9PPdhm77U0no+0Rx5vA72q77U0no+VsU9PA72q740/Uo+zRx5vGimub40/Uo+WsU9PGimub6MGRg+yBx5vLA7xL6MGRg+XsU9PLA7xL746sU9wxx5vDOLy7746sU9YsU9PDOLy77QnjE9aMU9PHt3z77QnjE9vRx5vHt3z74APSu8cMU9PJ3wz74APSu8txx5vJ3wz77Q/IK9dsU9PL30zL7Q/IK9sBx5vL30zL7INe69fsU9POSPxr7INe69qBx5vOSPxr7osCq+hsU9PN/bvL7osCq+oRx5vN/bvL4McFu+jsU9POP/r74McFu+mRx5vOP/r77aSYS+lMU9PM4voL7aSYS+kRx5vM4voL6+spi+nMU9PH6rjb6+spi+ihx5vH6rjb5KoKq+pMU9PHN7cb5KoKq+ghx5vHN7cb4qyrm+qsU9PPJ1Q74qyrm+exx5vPJ1Q74c88W+ssU9PE0AEr4c88W+dRx5vE0AEr4O6s6+uMU9PFTEu70O6s6+bxx5vFTEu70O6s6+uMU9PFTEu70O6s6+uMU9PFTEu70WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL4O6s6+bxx5vFTEu70WWhy/zMU9PCkZGL7goBW/xMU9PFxGZr4WWhy/WRx5vCkZGL4WWhy/zMU9PCkZGL7goBW/Yxx5vFxGZr4qggy/usU9PGs7mL4qggy/bBx5vGs7mL7EIgG/sMU9PIu/ur7EIgG/dxx5vIu/ur4tYee+pMU9PDUk2r4tYee+ghx5vDUk2r7Zw8i+mMU9PKrq9b7Zw8i+jRx5vKrq9b4k6aa+jMU9PGTRBr8k6aa+mRx5vGTRBr/AWYK+gsU9PGN2EL/AWYK+pRx5vGN2EL+UUje+dsU9PGO9F7+UUje+sBx5vGO9F7+oz829asU9PAaJHL+oz829uxx5vAaJHL/AvqW8YMU9PPLFHr/AvqW8xhx5vPLFHr9QxXc9VsU9PBVrHr9QxXc90Bx5vBVrHr8Uxg8+TsU9POJ5G78Uxg8+2Bx5vOJ5G78cfF8+4Bx5vDz+Fb8cfF8+RsU9PDz+Fb/K6JU+5xx5vEYODr/K6JU+PsU9PEYODr8Wybk+7Rx5vAjKA78Wybk+OsU9PAjKA78izto+8Rx5vOq17r4izto+NsU9POq17r6qcvg+9Bx5vIbm0b6qcvg+MsU9PIbm0b59Hwk/9Rx5vDiasb59Hwk/MMU9PDiasb7Zw8i+mMU9PKrq9b7Zw8i+mMU9PKrq9b7AWYK+gsU9PGN2EL/AWYK+gsU9PGN2EL/AWYK+gsU9PGN2EL8k6aa+jMU9PGTRBr8tYee+pMU9PDUk2r4tYee+pMU9PDUk2r4tYee+pMU9PDUk2r6UUje+dsU9PGO9F7+UUje+dsU9PGO9F7+UUje+dsU9PGO9F7/EIgG/sMU9PIu/ur7EIgG/sMU9PIu/ur7EIgG/sMU9PIu/ur6oz829asU9PAaJHL+oz829asU9PAaJHL+oz829asU9PAaJHL8qggy/usU9PGs7mL4qggy/usU9PGs7mL4qggy/usU9PGs7mL7AvqW8YMU9PPLFHr/AvqW8YMU9PPLFHr/AvqW8YMU9PPLFHr/goBW/xMU9PFxGZr7goBW/xMU9PFxGZr7goBW/xMU9PFxGZr5QxXc9VsU9PBVrHr9QxXc9VsU9PBVrHr9QxXc9VsU9PBVrHr8WWhy/zMU9PCkZGL4WWhy/zMU9PCkZGL4WWhy/zMU9PCkZGL4WWhy/zMU9PCkZGL4WWhy/zMU9PCkZGL4WWhy/zMU9PCkZGL4WWhy/zMU9PCkZGL4WWhy/zMU9PCkZGL4Uxg8+TsU9POJ5G78Uxg8+TsU9POJ5G78Uxg8+TsU9POJ5G78Uxg8+TsU9POJ5G7/aSYS+lMU9PM4voL7aSYS+lMU9PM4voL7aSYS+lMU9PM4voL6+spi+nMU9PH6rjb6+spi+nMU9PH6rjb5KoKq+pMU9PHN7cb5KoKq+pMU9PHN7cb4qyrm+qsU9PPJ1Q74qyrm+qsU9PPJ1Q74c88W+ssU9PE0AEr4c88W+ssU9PE0AEr4O6s6+uMU9PFTEu70McFu+jsU9POP/r74McFu+jsU9POP/r74McFu+jsU9POP/r74+dd8+WMU9PABTRzs+dd8+WMU9PABTRzs+dd8+WMU9PABTRzs+dd8+WMU9PABTRzs+dd8+WMU9PABTRzuyasU+UMU9PCieOr6yasU+UMU9PCieOr6yasU+UMU9PCieOr5GxYA+YsU9POoPLL5x5RM/MMU9PFZTjr5x5RM/MMU9PFZTjr5x5RM/MMU9PFZTjr5x5RM/MMU9PFZTjr69LRw/MsU9PEj9Ur69LRw/MsU9PEj9Ur6JIkQ/HsU9PAzvY76JIkQ/HsU9PAzvY74zFgo/UsU9PDBIyT0cfF8+RsU9PDz+Fb8cfF8+RsU9PDz+Fb8cfF8+RsU9PDz+Fb8cfF8+RsU9PDz+Fb8cfF8+RsU9PDz+Fb/osCq+hsU9PN/bvL7osCq+hsU9PN/bvL7INe69fsU9POSPxr7INe69fsU9POSPxr7Q/IK9dsU9PL30zL7Q/IK9dsU9PL30zL7Q/IK9dsU9PL30zL7K6JU+PsU9PEYODr/K6JU+PsU9PEYODr/K6JU+PsU9PEYODr/K6JU+PsU9PEYODr/K6JU+PsU9PEYODr8APSu8cMU9PJ3wz74APSu8cMU9PJ3wz77QnjE9aMU9PHt3z77QnjE9aMU9PHt3z7746sU9YsU9PDOLy7746sU9YsU9PDOLy7746sU9YsU9PDOLy74Wybk+OsU9PAjKA78Wybk+OsU9PAjKA78Wybk+OsU9PAjKA78Wybk+OsU9PAjKA7+MGRg+XsU9PLA7xL6MGRg+XsU9PLA7xL40/Uo+WsU9PGimub40/Uo+WsU9PGimub40/Uo+WsU9PGimub4izto+NsU9POq17r4izto+NsU9POq17r4izto+NsU9POq17r7U0no+VsU9PA72q77U0no+VsU9PA72q77U0no+VsU9PA72q76qcvg+MsU9PIbm0b6qcvg+MsU9PIbm0b6qcvg+MsU9PIbm0b6qcvg+MsU9PIbm0b7SbJM+UsU9PPdhm77SbJM+UsU9PPdhm77WL6c+UMU9PAYtiL7WL6c+UMU9PAYtiL7WL6c+UMU9PAYtiL59Hwk/MMU9PDiasb59Hwk/MMU9PDiasb59Hwk/MMU9PDiasb66Yrg+UMU9PJhJZb66Yrg+UMU9PJhJZb66Yrg+UMU9PJhJZb4JJda+Yxx5vLwSJT0JJda+Yxx5vLwSJT30Lj+/KRx5vKvqiD70Lj+/KRx5vKvqiD70Lj+/KRx5vKvqiD4FbAW/XRx5vKwxXr387m2+bRx5vA4gWD787m2+bRx5vA4gWD787m2+bRx5vA4gWD5yeRe/Phx5vIU3gD5yeRe/Phx5vIU3gD5yeRe/Phx5vIU3gD6mNry+Wxx5vPBLZz6mNry+Wxx5vPBLZz6mNry+Wxx5vPBLZz6mNry+Wxx5vPBLZz5HOw+/PBx5vCrfpD5HOw+/PBx5vCrfpD5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT56R88+vRx5vOgXPz56R88+vRx5vOgXPz5qPtg+wxx5vLz5Cj6KHsM+thx5vI6NcD6KHsM+thx5vI6NcD6q9LM+rxx5vIhJjz6q9LM+rxx5vIhJjz4aB6I+qBx5vFA3pD4aB6I+qBx5vFA3pD42no0+oBx5vJ67tj42no0+oBx5vJ67tj68GG4+mBx5vLCLxj68GG4+mBx5vLCLxj68GG4+mBx5vLCLxj7oOvq9WRx5vMe/Jj/oOvq9WRx5vMe/Jj/oOvq9WRx5vMe/Jj/oOvq9WRx5vMe/Jj/oOvq9WRx5vMe/Jj9wIi29Yhx5vP6wKT9wIi29Yhx5vP6wKT9wIi29Yhx5vP6wKT8LSxo/zxx5vACviT4LSxo/zxx5vACviT4LSxo/zxx5vACviT5Qgh09axx5vNgLKj9Qgh09axx5vNgLKj9Qgh09axx5vNgLKj9dLBE/xRx5vDzHrj5dLBE/xRx5vDzHrj5dLBE/xRx5vDzHrj74IPM9dhx5vPLOJz/4IPM9dhx5vPLOJz/4IPM9dhx5vPLOJz/rzAU/uhx5vFxL0T7rzAU/uhx5vFxL0T7rzAU/uhx5vFxL0T40+0k+gRx5vEwDIz80+0k+gRx5vEwDIz80+0k+gRx5vEwDIz+KtfA+rxx5vPyv8D6KtfA+rxx5vPyv8D6KtfA+rxx5vPyv8D4eros+jBx5vE68Gz8eros+jBx5vE68Gz8eros+jBx5vE68Gz8yGNI+pBx5vD47Bj8yGNI+pBx5vD47Bj+CPbA+mBx5vEwXEj9OdQS/PBx5vAomyD5OdQS/PBx5vAomyD5OdQS/PBx5vAomyD5OdQS/PBx5vAomyD5eDq++Wxx5vKAwiT5eDq++Wxx5vKAwiT5+252+XBx5vNe4nj5+252+XBx5vNe4nj5+252+XBx5vNe4nj5MHu++PRx5vF5y6D5MHu++PRx5vF5y6D5MHu++PRx5vF5y6D52GIq+Xhx5vMrtsT52GIq+Xhx5vMrtsT52GIq+Xhx5vMrtsT7KedG+QBx5vNygAj/KedG+QBx5vNygAj/KedG+QBx5vNygAj/KedG+QBx5vNygAj8kKmi+YRx5vOSBwj4kKmi+YRx5vOSBwj5sVDi+ZBx5vDQy0D5sVDi+ZBx5vDQy0D5sVDi+ZBx5vDQy0D62dLC+RBx5vO4PDz+2dLC+RBx5vO4PDz+2dLC+RBx5vO4PDz/UcAW+aRx5vH7H2j7UcAW+aRx5vH7H2j7UcAW+aRx5vH7H2j5mlIy+Shx5vC1UGT9mlIy+Shx5vC1UGT9mlIy+Shx5vC1UGT9mlIy+Shx5vC1UGT+omaC9bhx5vAgX4j6omaC9bhx5vAgX4j5g9828dBx5vFAD5j5g9828dBx5vFAD5j5g9828dBx5vFAD5j5g00y+URx5vChEIT9g00y+URx5vChEIT9g00y+URx5vChEIT9g00y+URx5vChEIT9g00y+URx5vChEIT/g4+o8exx5vGh85j7g4+o8exx5vGh85j5ITqg9ghx5vJSA4z5ITqg9ghx5vJSA4z6kwwk+iRx5vLwb3T6kwwk+iRx5vLwb3T6kwwk+iRx5vLwb3T6UWT0+kRx5vKxn0z6UWT0+kRx5vKxn0z787m2+bRx5vA4gWD787m2+bRx5vA4gWD6mNry+zMU9PPBLZz6mNry+zMU9PPBLZz6mNry+Wxx5vPBLZz787m2+usU9PA4gWD6mNry+zMU9PPBLZz5eDq++Wxx5vKAwiT6mNry+Wxx5vPBLZz5eDq++zMU9PKAwiT5+252+XBx5vNe4nj5+252+ysU9PNe4nj52GIq+Xhx5vMrtsT52GIq+yMU9PMrtsT4kKmi+YRx5vOSBwj4kKmi+xsU9POSBwj5sVDi+ZBx5vDQy0D5sVDi+wsU9PDQy0D7UcAW+aRx5vH7H2j7UcAW+vsU9PH7H2j6omaC9bhx5vAgX4j6omaC9uMU9PAgX4j5g9828ssU9PFAD5j5g9828dBx5vFAD5j7g4+o8rMU9PGh85j7g4+o8exx5vGh85j5ITqg9pMU9PJSA4z5ITqg9ghx5vJSA4z6kwwk+nsU9PLwb3T6kwwk+iRx5vLwb3T6UWT0+lsU9PKxn0z6UWT0+kRx5vKxn0z68GG4+jsU9PLCLxj68GG4+mBx5vLCLxj42no0+hsU9PJ67tj42no0+oBx5vJ67tj4aB6I+fsU9PFA3pD4aB6I+qBx5vFA3pD6q9LM+dsU9PIhJjz6q9LM+rxx5vIhJjz6KHsM+cMU9PI6NcD6KHsM+thx5vI6NcD56R88+asU9POgXPz56R88+vRx5vOgXPz5qPtg+ZMU9PLz5Cj5qPtg+wxx5vLz5Cj5qPtg+ZMU9PLz5Cj5qPtg+ZMU9PLz5Cj5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5qPtg+wxx5vLz5Cj5DBCE/TsU9PLwwRT5DBCE/2Bx5vLwwRT4LSxo/WMU9PACviT4LSxo/zxx5vACviT5DBCE/TsU9PLwwRT5dLBE/YsU9PDzHrj5dLBE/xRx5vDzHrj7rzAU/bMU9PFxL0T7rzAU/uhx5vFxL0T6KtfA+dsU9PPyv8D6KtfA+rxx5vPyv8D4yGNI+gsU9PD47Bj8yGNI+pBx5vD47Bj+CPbA+jsU9PEwXEj+CPbA+mBx5vEwXEj8eros+msU9PE68Gz8eros+jBx5vE68Gz80+0k+pMU9PEwDIz80+0k+gRx5vEwDIz/4IPM9sMU9PPLOJz/4IPM9dhx5vPLOJz9Qgh09usU9PNgLKj9Qgh09axx5vNgLKj9wIi29xMU9PP6wKT9wIi29Yhx5vP6wKT/oOvq9zsU9PMe/Jj/oOvq9WRx5vMe/Jj9g00y+URx5vChEIT9g00y+1sU9PChEIT9mlIy+Shx5vC1UGT9mlIy+3MU9PC1UGT+2dLC+RBx5vO4PDz+2dLC+4sU9PO4PDz/KedG+QBx5vNygAj/KedG+5sU9PNygAj9MHu++PRx5vF5y6D5MHu++6MU9PF5y6D5OdQS/PBx5vAomyD5OdQS/6sU9PAomyD5HOw+/PBx5vCrfpD5HOw+/6sU9PCrfpD5yeRe/Phx5vIU3gD5yeRe/6MU9PIU3gD5yeRe/Phx5vIU3gD70Lj+//MU9PKvqiD70Lj+/KRx5vKvqiD5yeRe/6MU9PIU3gD4FbAW/yMU9PKwxXr0FbAW/yMU9PKwxXr30Lj+/KRx5vKvqiD70Lj+/KRx5vKvqiD70Lj+//MU9PKvqiD4FbAW/XRx5vKwxXr0FbAW/yMU9PKwxXr0FbAW/yMU9PKwxXr0FbAW/yMU9PKwxXr0JJda+Yxx5vLwSJT0JJda+Yxx5vLwSJT0FbAW/XRx5vKwxXr387m2+bRx5vA4gWD787m2+bRx5vA4gWD787m2+usU9PA4gWD5OdQS/6sU9PAomyD5OdQS/6sU9PAomyD5OdQS/6sU9PAomyD5OdQS/6sU9PAomyD6mNry+zMU9PPBLZz6mNry+zMU9PPBLZz6mNry+zMU9PPBLZz6mNry+zMU9PPBLZz5HOw+/6sU9PCrfpD5HOw+/6sU9PCrfpD5eDq++zMU9PKAwiT5eDq++zMU9PKAwiT5+252+ysU9PNe4nj5+252+ysU9PNe4nj5+252+ysU9PNe4nj5MHu++6MU9PF5y6D5MHu++6MU9PF5y6D5MHu++6MU9PF5y6D52GIq+yMU9PMrtsT52GIq+yMU9PMrtsT52GIq+yMU9PMrtsT7KedG+5sU9PNygAj/KedG+5sU9PNygAj/KedG+5sU9PNygAj/KedG+5sU9PNygAj8kKmi+xsU9POSBwj4kKmi+xsU9POSBwj5sVDi+wsU9PDQy0D5sVDi+wsU9PDQy0D5sVDi+wsU9PDQy0D62dLC+4sU9PO4PDz+2dLC+4sU9PO4PDz+2dLC+4sU9PO4PDz/UcAW+vsU9PH7H2j7UcAW+vsU9PH7H2j7UcAW+vsU9PH7H2j5mlIy+3MU9PC1UGT9mlIy+3MU9PC1UGT9mlIy+3MU9PC1UGT9mlIy+3MU9PC1UGT+omaC9uMU9PAgX4j6omaC9uMU9PAgX4j5g9828ssU9PFAD5j5g9828ssU9PFAD5j5g9828ssU9PFAD5j5g00y+1sU9PChEIT9g00y+1sU9PChEIT9g00y+1sU9PChEIT9g00y+1sU9PChEIT9g00y+1sU9PChEIT/g4+o8rMU9PGh85j7g4+o8rMU9PGh85j5ITqg9pMU9PJSA4z5ITqg9pMU9PJSA4z6kwwk+nsU9PLwb3T6kwwk+nsU9PLwb3T6kwwk+nsU9PLwb3T7oOvq9zsU9PMe/Jj/oOvq9zsU9PMe/Jj/oOvq9zsU9PMe/Jj/oOvq9zsU9PMe/Jj/oOvq9zsU9PMe/Jj+UWT0+lsU9PKxn0z6UWT0+lsU9PKxn0z68GG4+jsU9PLCLxj68GG4+jsU9PLCLxj68GG4+jsU9PLCLxj56R88+asU9POgXPz56R88+asU9POgXPz5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5qPtg+ZMU9PLz5Cj6KHsM+cMU9PI6NcD6KHsM+cMU9PI6NcD6q9LM+dsU9PIhJjz6q9LM+dsU9PIhJjz4aB6I+fsU9PFA3pD4aB6I+fsU9PFA3pD42no0+hsU9PJ67tj42no0+hsU9PJ67tj5wIi29xMU9PP6wKT9wIi29xMU9PP6wKT9wIi29xMU9PP6wKT8LSxo/WMU9PACviT4LSxo/WMU9PACviT4LSxo/WMU9PACviT5Qgh09usU9PNgLKj9Qgh09usU9PNgLKj9Qgh09usU9PNgLKj9dLBE/YsU9PDzHrj5dLBE/YsU9PDzHrj5dLBE/YsU9PDzHrj74IPM9sMU9PPLOJz/4IPM9sMU9PPLOJz/4IPM9sMU9PPLOJz/rzAU/bMU9PFxL0T7rzAU/bMU9PFxL0T7rzAU/bMU9PFxL0T40+0k+pMU9PEwDIz80+0k+pMU9PEwDIz80+0k+pMU9PEwDIz+KtfA+dsU9PPyv8D6KtfA+dsU9PPyv8D6KtfA+dsU9PPyv8D4eros+msU9PE68Gz8eros+msU9PE68Gz8eros+msU9PE68Gz8yGNI+gsU9PD47Bj8yGNI+gsU9PD47Bj+CPbA+jsU9PEwXEj/0Lj+//MU9PKvqiD70Lj+//MU9PKvqiD70Lj+//MU9PKvqiD4JJda+xMU9PLwSJT0JJda+xMU9PLwSJT0FbAW/yMU9PKwxXr387m2+usU9PA4gWD787m2+usU9PA4gWD787m2+usU9PA4gWD5yeRe/6MU9PIU3gD5yeRe/6MU9PIU3gD5yeRe/6MU9PIU3gD4eeCG0AACAvyvyJDPYIA20//9/v/jrjTM+Zwm0AACAvwGvAzRUadWzAACAv2wBkzMAAAAAAACAv1sy8rNUadWzAACAv2wBkzMAAAAAAACAv1sy8rMAAAAAAACAv/sMtrMvygK0//9/v6OQjDMt3tWzAACAv4PItjNUadWzAACAv2wBkzMAAAAAAACAv/sMtrM+Zwm0AACAvwGvAzQAAAAAAACAv1sy8rMeeCG0AACAvyvyJDM+Zwm0AACAvwGvAzQeeCG0AACAvyvyJDPYIA20//9/v/jrjTMeeKGzAACAv1bqjzPYIA20//9/v/jrjTPeWvGzAACAv9ZSuDP9L+6zAACAvyhzjjMGTcqzAACAv3rnlTMeeKGzAACAv1bqjzPeWvGzAACAv9ZSuDMeeKGzAACAv1bqjzPeWvGzAACAv9ZSuDMGTcqzAACAv3rnlTP9L+6zAACAvyhzjjMGTcqzAACAv3rnlTMGTcqzAACAv46mqzNGxgi0AACAv0PmizOdo/yzAACAv1rInTP9L+6zAACAvyhzjjMGTcqzAACAv46mqzNGxgi0AACAv0PmizMGTcqzAACAv46mqzNexgi0AACAv4iLizNGxgi0AACAv0PmizOdo/yzAACAv1rInTNexgi0AACAv4iLizOdo/yzAACAv1rInTNomu6zAACAv3yUkjP8kR+0AACAv/n0jjNexgi0AACAv4iLizNomu6zAACAv3yUkjP8kR+0AACAv/n0jjPITQK0AACAvzKJojNomu6zAACAv3yUkjPmvK2zAACAvzROtDP8kR+0AACAv/n0jjPmvK2zAACAvzROtDPITQK0AACAvzKJojOcTQK0AACAvxVtljPmvK2zAACAvzROtDPITQK0AACAvzKJojOcTQK0AACAvxVtljPSscqzAACAv2EalzMCow+0AACAv80alzOcTQK0AACAvxVtljPSscqzAACAv2EalzMCow+0AACAv80alzPEuQG0AACAvy3imTOCvc+zAACAvze8kTPSscqzAACAv2EalzMCow+0AACAv80alzPEuQG0AACAvy3imTNklMOz//9/v+eNlzPEuQG0AACAvy3imTOqIAC0AACAv7IwkjO3aO+zAACAv241pTOCvc+zAACAvze8kTNklMOz//9/v+eNlzNklMOz//9/v+eNlzO3aO+zAACAv241pTOCvc+zAACAvze8kTOqIAC0AACAv7IwkjO3aO+zAACAv241pTOqIAC0AACAv7IwkjPTFk20AACAvxck/zLKARm0AACAv8NAmzMNM4GzAACAv4MQxDPTFk20AACAvxck/zLKARm0AACAv8NAmzPKARm0AACAv8NAmzPTFk20AACAvxck/zJjBjy0AACAv1jUkjMNM4GzAACAv4MQxDNjBjy0AACAv1jUkjPE8rOzAACAv07jlzMNM4GzAACAv4MQxDNjBjy0AACAv1jUkjMT1vWzAACAv1zarjPE8rOzAACAv07jlzMT1vWzAACAv1zarjP0ZdCzAACAv51NhDPE8rOzAACAv07jlzMT1vWzAACAv1zarjMc6N+z//9/v/qUZzP0ZdCzAACAv51NhDO8riO0AACAv7WyjzMc6N+z//9/v/qUZzP0ZdCzAACAv51NhDO8riO0AACAv7WyjzMc6N+z//9/v/qUZzMFsM2zAACAv91zuDO8riO0AACAv7WyjzMt3tWzAACAv4PItjMFsM2zAACAv91zuDMB1km0//9/v1NUFzMvygK0//9/v6OQjDO4TQK0AACAv6h2lDP6wPqzAACAv/jvdzOxluOzAACAv6tQkzMt3tWzAACAv4PItjNHL9OzAACAvxxNvTMFsM2zAACAv91zuDMB1km0//9/v1NUFzMvygK0//9/v6OQjDMAAAAAAACAv/sMtrMB1km0//9/v1NUFzNHL9OzAACAvxxNvTOxluOzAACAv6tQkzNHL9OzAACAvxxNvTP6wPqzAACAv/jvdzOxluOzAACAv6tQkzO4TQK0AACAv6h2lDP6wPqzAACAv/jvdzO4TQK0AACAv6h2lDPFaWI/AAAAAN7p7r7Td2k/AAAAAKQB0r7FaWI/AAAAAN7p7r7Td2k/AAAAAKQB0r5z6te9AAAAAMSSfr9n6te9AAAAAMSSfr9z6te9AAAAAMSSfr9n6te9AAAAAMSSfr9n6te9AAAAAMSSfr9z6te9AAAAAMSSfr8GEVE/AAAAAIS9Ez8JEVE/AAAAAIO9Ez8GEVE/AAAAAIS9Ez8JEVE/AAAAAIO9Ez8JEVE/AAAAAIO9Ez8GEVE/AAAAAIS9Ez9t1i2/AAAAAEXtOz9j1i2/AAAAAEztOz9i1i2/lvevtk3tOz9c1S2/wAFgOXjrOz9t1i2/AAAAAEXtOz9i1i2/lvevtk3tOz9t1i2/AAAAAEXtOz9j1i2/AAAAAEztOz9i1i2/lvevtk3tOz9j1i2/AAAAAEztOz9c1S2/AAAAAHjrOz+uAdc7AP5/PxABCDvX6te9AAAAAMOSfr/X6te9AAAAAMOSfr/X6te9AAAAAMOSfr/X6te9AAAAAMOSfr+1d1q/AAAAAAtvBT+jp1G/AAAAACbjEj+1d1q/AAAAAAtvBT+jp1G/AAAAACbjEj97lz2/AAAAAFgDLD97lz2/AAAAAFgDLD9NiSa/AAAAAIVrQj9NiSa/AAAAAIVrQj8a3Qy/AAAAAKzBVT8a3Qy/AAAAAKzBVT/E6eG+AAAAAMu5ZT/E6eG+AAAAAMu5ZT9Njaa+AAAAAOQRcj9Njaa+AAAAAOQRcj+iGVG+AAAAAPWZej+iGVG+AAAAAPWZej9HoaO9AAAAAP4tfz9HoaO9AAAAAP4tfz924To9AAAAAP+5fz924To9AAAAAP+5fz9dkS4+AAAAAPg/fD9dkS4+AAAAAPg/fD8s0ZU+AAAAAOrJdD8s0ZU+AAAAAOrJdD+kAdI+AAAAANN3aT+kAdI+AAAAANN3aT8LbwU/AAAAALV3Wj8LbwU/AAAAALV3Wj9Awx8/AAAAAJAFSD9Awx8/AAAAAJAFSD9vkzc/AAAAAGVrMj9vkzc/AAAAAGVrMj+ZfUw/AAAAADQBGj+ZfUw/AAAAADQBGj+8LV4/AAAAAP1R/j68LV4/AAAAAP1R/j7ZXWw/AAAAAImdxD7ZXWw/AAAAAImdxD7kEXI/AAAAAE2Npj7kEXI/AAAAAE2Npj6Z04e+AAAAANTTdj+P04e+AAAAANTTdj+Z04e+AAAAANTTdj+P04e+AAAAANTTdj+Z04e+AAAAANTTdj+P04e+AAAAANTTdj/ZXWy/AAAAAImdxL7kEXK/AAAAAE2Npr7kEXK/AAAAAE2Npr7ZXWy/AAAAAImdxL68LV6/AAAAAP1R/r68LV6/AAAAAP1R/r6ZfUy/AAAAADQBGr+ZfUy/AAAAADQBGr9vkze/AAAAAGVrMr9vkze/AAAAAGVrMr9Awx+/AAAAAJAFSL9Awx+/AAAAAJAFSL8LbwW/AAAAALV3Wr8LbwW/AAAAALV3Wr+kAdK+AAAAANN3ab+kAdK+AAAAANN3ab8s0ZW+AAAAAOrJdL8s0ZW+AAAAAOrJdL9dkS6+AAAAAPg/fL9dkS6+AAAAAPg/fL924Tq9AAAAAP+5f7924Tq9AAAAAP+5f79HoaM9AAAAAP4tf79HoaM9AAAAAP4tf7+iGVE+AAAAAPWZer+iGVE+AAAAAPWZer9NjaY+AAAAAOQRcr9NjaY+AAAAAOQRcr/E6eE+AAAAAMu5Zb/E6eE+AAAAAMu5Zb8a2ww/AAAAAKzBVb8a2ww/AAAAAKzBVb9NiSY/AAAAAIVpQr9NiSY/AAAAAIVpQr97lz0/AAAAAFgDLL97lz0/AAAAAFgDLL+jp1E/AAAAACbjEr+jp1E/AAAAACbjEr8AAAAAAACAP99/b7ToFs0zAACAPztbCbQAAAAAAACAP99/b7ToFs0zAACAPztbCbQVuM4zAACAPxB8JrMAAAAAAACAP99/b7ToFs0zAACAPztbCbQVuM4zAACAPxB8JrPGBA00AACAP04+17MVuM4zAACAPxB8JrNaC/4zAACAP9AmXLPGBA00AACAP04+17NaC/4zAACAP9AmXLNvSAo0AACAPwePZLPGBA00AACAP04+17Ow0OozAACAP6P0tbNaC/4zAACAP9AmXLNvSAo0AACAPwePZLOw0OozAACAP6P0tbNvSAo0AACAPwePZLM4mxA0AACAP94+m7Ow0OozAACAP6P0tbMDsPQzAACAP9OilLM4mxA0AACAP94+m7MDsPQzAACAP9OilLOB+wY0AACAPyWKabM4mxA0AACAP94+m7NMxNwzAACAP09Bs7MDsPQzAACAP9OilLOB+wY0AACAPyWKabPxA7UzAACAP67AxbNMxNwzAACAP09Bs7Oigewz//9/P+Fg1rPR4+4zAACAPwWMmrMINPIzAACAP9R1vbNU4PwzAACAP6VWQrOB+wY0AACAPyWKabNn3g80//9/P5hCdLPus1O1AACAP1RpgrVMxNwzAACAP09Bs7MfDQw0AACAPweLmLNn3g80//9/P5hCdLPus1O1AACAP1RpgrUINPIzAACAP9R1vbNn3g80//9/P5hCdLPxA7UzAACAP67AxbMINPIzAACAP9R1vbPxA7UzAACAP67AxbNU4PwzAACAP6VWQrOigewz//9/P+Fg1rNU4PwzAACAP6VWQrOigewz//9/P+Fg1rPR4+4zAACAPwWMmrPR4+4zAACAPwWMmrPus1O1AACAP1RpgrWDL7y0AACAP8e4RTMfDQw0AACAPweLmLOOm8kzAACAP4A1pbNX6/YzAACAP4WIm7OyGPczAACAP6NlnLNsGvczAACAP7AwkrNx1gE0AACAPzDFo7NX6/YzAACAP4WIm7OyGPczAACAP6NlnLPCqgM0AACAP6X6m7NX6/YzAACAP4WIm7MUIfYzAACAPyr6m7OyGPczAACAP6NlnLNx1gE0AACAPzDFo7PCqgM0AACAP6X6m7OOm8kzAACAP4A1pbNx1gE0AACAPzDFo7OOm8kzAACAP4A1pbNsGvczAACAP7AwkrNsGvczAACAP7AwkrODL7y0AACAP8e4RTM91skzAACAPz/yJLMfDQw0AACAPweLmLM+5Q80AACAPzbdabMZ3mc0//9/P/75HrODL7y0AACAP8e4RTMZ3mc0//9/P/75HrM91skzAACAPz/yJLMZ3mc0//9/P/75HrPPVJIz//9/P5ozCrQ91skzAACAPz/yJLM+5Q80AACAPzbdabPPVJIz//9/P5ozCrQDMO4zAACAP8z6t7NbmQE0AACAP3jnlbM+5Q80AACAPzbdabPT9xg0AACAP8ew/7LPVJIz//9/P5ozCrTT9xg0AACAP8ew/7JbmQE0AACAP3jnlbPT9xg0AACAP8ew/7LNVbczAACAP9yCzLMDMO4zAACAP8z6t7NbmQE0AACAP3jnlbPNVbczAACAP9yCzLMDMO4zAACAP8z6t7PyDfUzAACAPzLsqbOdo/wzAACAP1PInbPNVbczAACAP9yCzLPyDfUzAACAPzLsqbPyDfUzAACAPzLsqbMIwfozAACAP5GLi7Odo/wzAACAP1PInbMIwfozAACAP5GLi7OBo/wzAACAP1gyfLOdo/wzAACAP1PInbPdwPozAACAP97yVbMIwfozAACAP5GLi7OBo/wzAACAP1gyfLPdwPozAACAP97yVbOBo/wzAACAP1gyfLOuTQI0AACAP24GkrPKTQI0AACAPx1RirPdwPozAACAP97yVbOuTQI0AACAP24GkrOk4+4zAACAPzvBurOuTQI0AACAP24GkrPKTQI0AACAPx1RirOk4+4zAACAPzvBurMUIfYzAACAPyr6m7PKTQI0AACAPx1RirOk4+4zAACAPzvBurMUIfYzAACAPyr6m7PCqgM0AACAP6X6m7PA8hK0//9/v4LkkjOSF/Sz//9/v1t7mDOg9f+7oPV/v7H0grzA8hK0//9/v4LkkjOSF/Sz//9/v1t7mDPA8hK0//9/v4LkkjOg9f+7oPV/v7H0grySF/Sz//9/v1t7mDO/zMw57/9/v8Cotjqg9f+7oPV/v7H0grxtqQW0AACAv4YwpDO/zMw57/9/v8CotjoBQg60AACAv44alzNtqQW0AACAv4YwpDOapuezAACAv5IalzO/zMw57/9/v8CotjptqQW0AACAv4YwpDOapuezAACAv5IalzMeeCG0AACAv6F1vTPbuRe0AACAv5pQkzOCdQS0AACAv06elTOlWvGzAACAv3GmdDOt4+6zAACAvzWBlzPdZeezAACAv/hIlzNI9eOzAACAv3ssqTPQ6+KzAACAv1AdgTMAAAAAAACAv8iawDOt4+6zAACAvzWBlzNI9eOzAACAv3ssqTOt4+6zAACAvzWBlzPbuRe0AACAv5pQkzNI9eOzAACAv3ssqTPbuRe0AACAv5pQkzOlWvGzAACAv3GmdDMeeCG0AACAv6F1vTOlWvGzAACAv3GmdDMeeCG0AACAv6F1vTMAAAAAAACAv8iawDPQ6+KzAACAv1AdgTOmGs6zAACAv9nYDTQAAAAAAACAv8iawDMC1AS0//9/v4IBlTOCdQS0AACAv06elTPQ6+KzAACAv1AdgTOmGs6zAACAv9nYDTTuNXKzAACAv31SazMn7hi0AACAv3gntzOCdQS0AACAv06elTPdZeezAACAv/hIlzMn7hi0AACAv3gntzNakPKzAACAv2U/mzPdZeezAACAv/hIlzMn7hi0AACAv3gntzNp4wy0AACAv8hMhDNakPKzAACAv2U/mzNp4wy0AACAv8hMhDPT1vWzAACAv0bZrjNakPKzAACAv2U/mzNp4wy0AACAv8hMhDPYC/6zAACAv07jlzPT1vWzAACAv0bZrjPYC/6zAACAv07jlzPT1vWzAACAv0bZrjOGBryzAACAvznWkjPYC/6zAACAv07jlzPHts6zAACAvyQRxDOGBryzAACAvznWkjPHts6zAACAvyQRxDOGBryzAACAvznWkjNDFk2zAACAv2If/zLHts6zAACAvyQRxDNDFk2zAACAv2If/zIAAAAAAACAv65CmzNDFk2zAACAv2If/zIAAAAAAACAv65CmzMAAAAAAACAv65CmzMBQg60AACAv44alzOcpuezAACAvxeJojOapuezAACAv5IalzOjdMOz//9/vx9tljMBQg60AACAv44alzOjdMOz//9/vx9tljNiKQ20AACAvzO7mDOcpuezAACAvxeJojOjdMOz//9/vx9tljNSyBC0AACAv0C7mDNiKQ20AACAvzO7mDOcpuezAACAvxeJojNSyBC0AACAv0C7mDNiKQ20AACAvzO7mDMaLNmzAACAv+FtlzNSyBC0AACAv0C7mDNKW++zAACAv/dUtTNjkeCzAACAv4LInTMaLNmzAACAv+FtlzNKW++zAACAv/dUtTMaLNmzAACAv+FtlzNKW++zAACAv/dUtTNjkeCzAACAv4LInTPPXbazAACAvwnmizMAbSi0AACAv0+3kjNjkeCzAACAv4LInTPPXbazAACAvwnmizMAbSi0AACAv0+3kjPPXbazAACAvwnmizPKXbaz//9/vx/YoTMAbSi0AACAv0+3kjN7UwS0AACAv9makjMfbeCzAACAv0DolTPKXbaz//9/vx/YoTMfbeCzAACAv0DolTPKXbaz//9/vx/YoTNbkAS0AACAvydkhTN7UwS0AACAv9makjMfbeCzAACAv0DolTNpnRq0AACAv8gDnDMC1AS0//9/v4IBlTNbkAS0AACAvydkhTN7UwS0AACAv9makjNqj6uzAACAv/ODvjNpnRq0AACAv8gDnDNbkAS0AACAvydkhTNpnRq0AACAv8gDnDNqj6uzAACAv/ODvjMC1AS0//9/v4IBlTNqj6uzAACAv/ODvjPuNXKzAACAv31SazOmGs6zAACAv9nYDTTuNXKzAACAv31SazMtBN89AAAAAEh6fj8wBN89AAAAAEd6fj8tBN89AAAAAEh6fj8wBN89AAAAAEd6fj8tBN89AAAAAEh6fj8wBN89AAAAAEd6fj+1d1o/AAAAAAtvBb+jp1E/AAAAACbjEr+1d1o/AAAAAAtvBb+jp1E/AAAAACbjEr97lz0/AAAAAFgDLL97lz0/AAAAAFgDLL9NiSY/AAAAAIVpQr9NiSY/AAAAAIVpQr8a2ww/AAAAAKzBVb8a2ww/AAAAAKzBVb/E6eE+AAAAAMu5Zb/E6eE+AAAAAMu5Zb9NjaY+AAAAAOQRcr9NjaY+AAAAAOQRcr+iGVE+AAAAAPWZer+iGVE+AAAAAPWZer9HoaM9AAAAAP4tf79HoaM9AAAAAP4tf7924Tq9AAAAAP+5f7924Tq9AAAAAP+5f79dkS6+AAAAAPg/fL9dkS6+AAAAAPg/fL8s1ZW+AAAAAOrJdL8s1ZW+AAAAAOrJdL+kAdK+AAAAANN3ab+kAdK+AAAAANN3ab8LbwW/AAAAALV3Wr8LbwW/AAAAALV3Wr9Awx+/AAAAAJAFSL9Awx+/AAAAAJAFSL9vkze/AAAAAGVrMr9vkze/AAAAAGVrMr+ZfUy/AAAAADQBGr+ZfUy/AAAAADQBGr+8LV6/AAAAAP1R/r68LV6/AAAAAP1R/r7ZXWy/AAAAAImdxL7ZXWy/AAAAAImdxL7kEXK/AAAAAE2Npr7kEXK/AAAAAE2Npr6Z04c+AAAAANTTdr+Z04c+AAAAANLTdr+Z04c+AAAAANTTdr+Z04c+AAAAANLTdr+Z04c+AAAAANTTdr+Z04c+AAAAANLTdr/kEXI/AAAAAE2Npj7ZXWw/AAAAAImdxD7ZXWw/AAAAAImdxD7kEXI/AAAAAE2Npj68LV4/AAAAAP1R/j68LV4/AAAAAP1R/j6ZfUw/AAAAADQBGj+ZfUw/AAAAADQBGj9vkzc/AAAAAGVrMj9vkzc/AAAAAGVrMj9Awx8/AAAAAJAFSD9Awx8/AAAAAJAFSD8LbwU/AAAAALV3Wj8LbwU/AAAAALV3Wj+kAdI+AAAAANN3aT+kAdI+AAAAANN3aT8s0ZU+AAAAAOrJdD8s0ZU+AAAAAOrJdD9dkS4+AAAAAPg/fD9dkS4+AAAAAPg/fD924To9AAAAAP+5fz924To9AAAAAP+5fz9HoaO9AAAAAP4tfz9HoaO9AAAAAP4tfz+iGVG+AAAAAPWZej+iGVG+AAAAAPWZej9Njaa+AAAAAOQRcj9Njaa+AAAAAOQRcj/E6eG+AAAAAMu5ZT/E6eG+AAAAAMu5ZT8a2wy/AAAAAKzBVT8a2wy/AAAAAKzBVT9NiSa/AAAAAIVrQj9NiSa/AAAAAIVrQj97lz2/AAAAAFgDLD97lz2/AAAAAFgDLD+jp1G/AAAAACbjEj+jp1G/AAAAACbjEj/FaWK/AAAAAN7p7j7FaWK/AAAAAN7p7j7Td2m/AAAAAKQB0j7Td2m/AAAAAKQB0j5IA989AAAAAEp6fj9IA989AAAAAEp6fj9IA989AAAAAEp6fj9IA989AAAAAEp6fj+MlFG/AAAAALUCE7+HlFG/AAAAAL8CE7+MlFG/AAAAALUCE7+HlFG/AAAAAL8CE7+HlFG/AAAAAL8CE7+MlFG/AAAAALUCE79rLi0/u+QTNiGIPL9tLi0/AAAAACKIPL9xLi0/AAAAAB6IPL9rLi0/u+QTNiGIPL9xLi0/AAAAAB6IPL9xLi0/AAAAAB6IPL9rLi0/u+QTNiGIPL9tLi0/AAAAACKIPL9tLi0/AAAAACKIPL+cpuczAACAP706krMJIfYzAACAPwhRirPCTQI0//9/P/wxZLMDQg40AACAP786krOJzEy6q/9/P70fSrsKxd4zAACAPy1doLOcpuczAACAP706krMDQg40AACAP786krMKxd4zAACAPy1doLOcpuczAACAP706krPCTQI0//9/P/wxZLMDQg40AACAP786krMJIfYzAACAPwhRirOXTQI0AACAP5AGkrPCTQI0//9/P/wxZLPqpuczAACAPxfhqLMJIfYzAACAPwhRirOXTQI0AACAP5AGkrMgLNkzAACAP46mr7PqpuczAACAPxfhqLOXTQI0AACAP5AGkrMgLNkzAACAP46mr7PqpuczAACAPxfhqLNymu4z//9/P33InbN2xgg0AACAPymMi7MgLNkzAACAP46mr7N2xgg0AACAPymMi7NI9eMzAACAP+7rqbNymu4z//9/P33InbN2xgg0AACAPymMi7PLjNkzAACAPy7ZirNI9eMzAACAP+7rqbNymu4z//9/P33InbPLjNkzAACAPy7ZirNI9eMzAACAP+7rqbNSxgg0AACAPzElfLPLjNkzAACAPy7ZirPk3/wzAACAPzzolbOYBAE0AACAP2wCrbNSxgg0AACAPzElfLPk3/wzAACAPzzolbNSxgg0AACAPzElfLOmTcozAACAP2uos7Pk3/wzAACAPzzolbOYBAE0AACAP2wCrbPrd6EzAACAP1VHFbSmTcozAACAP2uos7NaYd0z//9/P4IBlbOYBAE0AACAP2wCrbM8AzU0AACAPxCjSbOmTcozAACAP2uos7M8AzU0AACAPxCjSbPrd6EzAACAP1VHFbQ8AzU0AACAPxCjSbPrd6EzAACAP1VHFbRaYd0z//9/P4IBlbNQeSE0AACAP4dSa7MAAAAAAACAP+jSZbNaYd0z//9/P4IBlbPQ6+IzAACAPw2bl7O91gU0AACAPz72b7NQeSE0AACAP4dSa7MAAAAAAACAP+jSZbNQeSE0AACAP4dSa7MAAAAAAACAP+jSZbPQ6+IzAACAPw2bl7Pm7jw0AACAP5mawLOnTQI0AACAP392lLNexgg0AACAPwDwd7Mop7Uz//9/P6h1vbPcr80zAACAPyjNubPQ6+IzAACAPw2bl7Ns4PwzAACAP4RWQrOnTQI0AACAP392lLO91gU0AACAPz72b7P3wgc0AACAPynAxbNexgg0AACAPwDwd7Pm7jw0AACAP5mawLOnTQI0AACAP392lLNs4PwzAACAP4RWQrNexgg0AACAPwDwd7Ns4PwzAACAP4RWQrP3wgc0AACAPynAxbMop7Uz//9/P6h1vbP3wgc0AACAPynAxbMop7Uz//9/P6h1vbPm7jw0AACAP5mawLPcr80zAACAPyjNubML3wE0AACAP+HCirO91gU0AACAPz72b7Pcr80zAACAPyjNubML3wE0AACAP+HCirOCnAI0AACAP8CQoLPh2bszAACAP9rfprML3wE0AACAP+HCirOCnAI0AACAP8CQoLPh2bszAACAP9rfprOCnAI0AACAP8CQoLM6phk0AACAP1dkerPh2bszAACAP9rfprNL9gY0AACAP73yJrM6phk0AACAP1dkerNL9gY0AACAP73yJrM6phk0AACAP1dkerMksBw0AACAPwfZHLMVCZszAACAP1pxGrRL9gY0AACAP73yJrMksBw0AACAPwfZHLMvFk0zAACAP/6ZsLMVCZszAACAP1pxGrQksBw0AACAPwfZHLMvFk0zAACAP/6ZsLOBApkzAACAP65Cm7MVCZszAACAP1pxGrQvFk0zAACAP/6ZsLOBApkzAACAP65Cm7OBApkzAACAP65Cm7MAAAAAqv9/P7lLUzsgbNwzAACAP3x4o7OSF/Qz//9/P1XrkLMgbNwzAACAP3x4o7OSF/Qz//9/P1XrkLMgbNwzAACAP3x4o7OJzEy6q/9/P70fSrsAAAAAqv9/P7lLUzuSF/Qz//9/P1XrkLOJzEy6q/9/P70fSrsAAAAAqv9/P7lLUzsKxd4zAACAPy1doLMAAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwMABQAKAAYABAANAAwAAgAPAA4AAAAQABEAAQATABIAFwAZABgAFAAaABsAFgAdABwAFQAhAB4AIgAkACMAHwAmACcAIAApACUAKAAsAC0AKgAwACsALgAyADMAMQA2ADQALwA3ADUAOAA7ADwAOQBAADoAPQBBAEMASABJAEQAQgA+AEcAPwBLAEYASgBNAEUATABOAFAAUwBUAFIATwBVAFcAUQBaAFYAWABbAF0AWQBgAFwAXgBhAGMAXwBmAGIAZQBoAGcAZABqAGkAbAB0AHIAawAJAG4ACAB2AG0AdQB4AHMAeQB7AHEAegB9AHAAfAB/AG8AfgCAAHcACwAHAIEAggCDAIIAgQCEAIYAiACJAIcAhQCKAIwAjgCPAI0AiwCQAJEAlQCXAJYAkwCZAJgAkgCaAJsAlACcAJ0AngCfAJ4AnQCgAKEAogCjAKIAoQCkAKQApQCiAKUApACmAKYApwClAKcApgCoAKgAqQCnAKkAqACqAKoAqwCpAKsAqgCsAKwArQCrAK0ArACuAK4ArwCtAK8ArgCwAK8AsQCyALEArwCwALIAswC0ALMAsgCxALQAtQC2ALUAtACzALYAtwC4ALcAtgC1ALgAuQC6ALkAuAC3ALoAuwC8ALsAugC5ALwAvQC+AL0AvAC7AL4AvwDAAL8AvgC9AMAAwQDCAMEAwAC/AMIAwwDEAMMAwgDBAMQAxQDGAMUAxADDAMYAxwDIAMcAxgDFAMkAywDNAMwAygDOAM8A0ADRANAAzwDSANMA0gDPANIA0wDUANUA1ADTANQA1QDWANcA1gDVANYA1wDYANkA2ADXANgA2QDaANsA2gDZANoA2wDcAN0A3ADbANwA3QDeAN8A3gDdAN4A3wDgAOEA4ADfAOAA4QDiAOMA4gDhAOIA4wDkAOUA5ADjAOQA5QDmAOcA5gDlAOYA5wDoAOcA6QDoAOkA5wDqAOoA6wDpAOsA6gDsAOwA7QDrAO0A7ADuAO4A7wDtAO8A7gDwAPAA8QDvAPEA8ADyAPIA8wDxAPMA8gD0APQAgwDzAIMA9ACBAPUA9wD6APgA9gD7APkA/AD+AAAB/QADAf8AAQEFAQYBAgEIAQQBBwEKAQwBCQEPAQsBDQERARIBDgEZARABFAEcAR4BGgEhASABFwEjASIBEwEkASUBGAEnASYBFQEoASkBFgEqARsBHwErAS8BMwE2ATQBMAE4ATkBMgE8ATsBLgE9AT4BMQE/AS0BQgEdAUABLAFFAUQBRgFIAUEBRwFKAUMBSwFPAUwBSQFRAVABUgFUAU4BUwFXAU0BVgFZAVgBVQFcAVoBXQFeAVsBYAFjAWEBXwFlAWIBZgFoAWcBZAFrAWkBbAFuAWoBbwFyAXABbQFzAXEBdAE3AToBdQE1AXYBeQF7AXoBdwF9AXgBfAF/AYEBfgGFAYABgwGGAYwBkQGTAZIBjgGVAZQBiQGWAZcBiwGZAZgBiAGaAZsBkAGeAZwBjwGhAaABigGlAaYBjQGpAaQBpwGqAawBqAGvAasBrQGwAbIBrgG0AbEBswG2AbgBtQG6AbcBuQG8Ab0BuwG/Ab4BwAHBAYQBxAGHAcIBggHGAcUBxwHKAcMByQHNAcwByAHPAcsBzgHRAdQB0AHWAdIB1QHXAdMB2AHbAdwB2QHeAdoB3QHgAeMB3wHlAeIB5AHoAeEB5wHsAesB5gHvAekB7gHwAe0B8QHzAeoB8gGfAaMB9AH2AaIB9QGdAfcB+QH7AfoB+AH8Af0B/gH/Af4B/QEAAgACAQL+AQECAAICAgICAwIBAgMCAgIEAgQCBQIDAgUCBAIGAgYCBwIFAgcCBgIIAggCCQIHAgkCCAIKAgoCCwIJAgsCCgIMAg0CCwIMAgsCDQIOAg8CDgINAg4CDwIQAhECEAIPAhACEQISAhMCEgIRAhICEwIUAhUCFAITAhQCFQIWAhcCFgIVAhYCFwIYAhkCGAIXAhgCGQIaAhsCGgIZAhoCGwIcAh0CHAIbAhwCHQIeAh8CHgIdAh4CHwIgAiECIAIfAiACIQIiAiMCIgIhAiICIwIkAiUCJwIpAigCJgIqAisCLAItAiwCKwIuAi0CLwIwAi8CLQIsAjACMQIyAjECMAIvAjICMwI0AjMCMgIxAjQCNQI2AjUCNAIzAjYCNwI4AjcCNgI1AjgCOQI6AjkCOAI3AjoCOwI8AjsCOgI5AjwCPQI+Aj0CPAI7Aj4CPwJAAj8CPgI9AkACQQJCAkECQAI/AkICQwJEAkMCQgJBAkMCRQJEAkUCQwJGAkYCRwJFAkcCRgJIAkgCSQJHAkkCSAJKAkoCSwJJAksCSgJMAkwCTQJLAk0CTAJOAk4CTwJNAk8CTgJQAlACUQJPAlECUAJSAlICUwJRAlMCUgJUAlUCVgJXAlYCVQJYAloCXAJdAlsCWQJeAmECYwJkAmICXwJlAmYCYAJnAmgCbgJxAm8CawJzAnICagJ2AnQCaQJ4AnUCeQJ8AnsCdwJ+AnoCfQKBAoICgAKFAoQCfwKIAoMChwKKAokChgKMAosCjwKRApACjQKTApQCjgKYApIClgKaApsCmQKdApwClQKeAp8ClwKiAqACpQKnAqYCoQKoAqsCsQK2ArQCrAK4ArACtwK5ArMCugK8Aq0CuwK9ArUCvgKqAq8CqQKjArICpALBAq4CvwLCAsMCwALGAsQCxwLJAsgCxQLLAsoCzQLPAs4CzALSAtAC0wLWAtUC0QLZAtQC1wLaAtsC2ALcAt4C4ALiAuEC3wLlAuQC3QLnAuMC5gJsAm0C6AJwAgAAAACAvwAAAAAAAIA/AACAPwAAAAAAAIA/AACAvwAAAAAAAIC/AACAPwAAAAAAAIC/AAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAIA/AACAPwAAAAAAAAAAAACAPwAAAAAAAAEAAwAAAAMAAgAAAAAAAAAAAAAAgL/CxUe+AAAAAL4Ue78W78O+AAAAAF6DbL/aOQ6/AAAAADHbVL/zBDW/AAAAAPMENb8x21S/AAAAANo5Dr9eg2y/AAAAABXvw76+FHu/AAAAAMTFR74AAIC/AAAAAC69OzO+FHu/AAAAAMLFRz5fg2y/AAAAABTvwz4y21S/AAAAANk5Dj/zBDW/AAAAAPMENT/ZOQ6/AAAAADLbVD8X78O+AAAAAF6DbD/BxUe+AAAAAL8Uez8uvbszAAAAAAAAgD+9xUc+AAAAAL8Uez8V78M+AAAAAF6DbD/bOQ4/AAAAADDbVD/yBDU/AAAAAPQENT8v21Q/AAAAAN05Dj9eg2w/AAAAABrvwz6+FHs/AAAAAMbFRz4AAIA/AAAAAC7eTLK+FHs/AAAAAMjFR75dg2w/AAAAABvvw74z21Q/AAAAANc5Dr/1BDU/AAAAAPIENb/bOQ4/AAAAADHbVL8V78M+AAAAAF+DbL+8xUc+AAAAAL8Ue78AAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/HHxfPuAcebw8/hW/HHxfPuAcebw8/hW/HHxfPuAcebw8/hW/HHxfPuAcebw8/hW/HHxfPuAcebw8/hW/DHBbvpkcebzj/6++DHBbvpkcebzj/6++DHBbvpkcebzj/6++FMYPPtgcebzieRu/FMYPPtgcebzieRu/FMYPPtgcebzieRu/FMYPPtgcebzieRu/6LAqvqEcebzf27y+6LAqvqEcebzf27y+yDXuvagcebzkj8a+yDXuvagcebzkj8a+0PyCvbAceby99My+0PyCvbAceby99My+0PyCvbAceby99My+yuiVPuccebxGDg6/yuiVPuccebxGDg6/yuiVPuccebxGDg6/yuiVPuccebxGDg6/yuiVPuccebxGDg6/AD0rvLccebyd8M++AD0rvLccebyd8M++0J4xPb0cebx7d8++0J4xPb0cebx7d8+++OrFPcMcebwzi8u++OrFPcMcebwzi8u++OrFPcMcebwzi8u+Fsm5Pu0cebwIygO/Fsm5Pu0cebwIygO/Fsm5Pu0cebwIygO/Fsm5Pu0cebwIygO/jBkYPsgcebywO8S+jBkYPsgcebywO8S+NP1KPs0cebxoprm+NP1KPs0cebxoprm+NP1KPs0cebxoprm+Is7aPvEcebzqte6+Is7aPvEcebzqte6+Is7aPvEcebzqte6+1NJ6PtEcebwO9qu+1NJ6PtEcebwO9qu+1NJ6PtEcebwO9qu+qnL4PvQcebyG5tG+qnL4PvQcebyG5tG+qnL4PvQcebyG5tG+qnL4PvQcebyG5tG+0myTPtQcebz3YZu+0myTPtQcebz3YZu+1i+nPtUcebwGLYi+1i+nPtUcebwGLYi+1i+nPtUcebwGLYi+fR8JP/Ucebw4mrG+fR8JP/Ucebw4mrG+fR8JP/Ucebw4mrG+umK4PtYcebyYSWW+umK4PtYcebyYSWW+umK4PtYcebyYSWW+ceUTP/UcebxWU46+ceUTP/UcebxWU46+ceUTP/UcebxWU46+ceUTP/UcebxWU46+smrFPtYcebwonjq+smrFPtYcebwonjq+smrFPtYcebwonjq+PnXfPs4cebwAU0c7PnXfPs4cebwAU0c7PnXfPs4cebwAU0c7PnXfPs4cebwAU0c7PnXfPs4cebwAU0c7RsWAPsUcebzqDyy+vS0cP/QcebxI/VK+vS0cP/QcebxI/VK+iSJEPwgdebwM72O+iSJEPwgdebwM72O+MxYKP9QcebwwSMk9wFmCvqUcebxjdhC/wFmCvqUcebxjdhC/wFmCvqUcebxjdhC/2cPIvo0cebyq6vW+2cPIvo0cebyq6vW+JOmmvpkcebxk0Qa/LWHnvoIcebw1JNq+LWHnvoIcebw1JNq+LWHnvoIcebw1JNq+lFI3vrAcebxjvRe/lFI3vrAcebxjvRe/lFI3vrAcebxjvRe/xCIBv3ccebyLv7q+xCIBv3ccebyLv7q+xCIBv3ccebyLv7q+qM/NvbscebwGiRy/qM/NvbscebwGiRy/qM/NvbscebwGiRy/KoIMv2wcebxrO5i+KoIMv2wcebxrO5i+KoIMv2wcebxrO5i+wL6lvMYcebzyxR6/wL6lvMYcebzyxR6/wL6lvMYcebzyxR6/4KAVv2McebxcRma+4KAVv2McebxcRma+4KAVv2McebxcRma+UMV3PdAcebwVax6/UMV3PdAcebwVax6/UMV3PdAcebwVax6/Flocv1kcebwpGRi+Flocv1kcebwpGRi+Flocv1kcebwpGRi+Flocv1kcebwpGRi+Flocv1kcebwpGRi+Flocv1kcebwpGRi+Flocv1kcebwpGRi+Flocv1kcebwpGRi+2kmEvpEcebzOL6C+2kmEvpEcebzOL6C+2kmEvpEcebzOL6C+vrKYvoocebx+q42+vrKYvoocebx+q42+SqCqvoIcebxze3G+SqCqvoIcebxze3G+Ksq5vnscebzydUO+Ksq5vnscebzydUO+HPPFvnUcebxNABK+HPPFvnUcebxNABK+DurOvm8cebxUxLu9ceUTPzDFPTxWU46+vS0cP/QcebxI/VK+ceUTP/UcebxWU46+vS0cPzLFPTxI/VK+iSJEPx7FPTwM72O+iSJEPx7FPTwM72O+vS0cP/QcebxI/VK+vS0cP/QcebxI/VK+vS0cPzLFPTxI/VK+iSJEPwgdebwM72O+iSJEPwgdebwM72O+iSJEPwgdebwM72O+MxYKP1LFPTwwSMk9MxYKP1LFPTwwSMk9MxYKP9QcebwwSMk9iSJEPx7FPTwM72O+MxYKP1LFPTwwSMk9MxYKP1LFPTwwSMk9MxYKP1LFPTwwSMk9MxYKP1LFPTwwSMk9PnXfPs4cebwAU0c7PnXfPs4cebwAU0c7MxYKP9QcebwwSMk9RsWAPsUcebzqDyy+RsWAPsUcebzqDyy+RsWAPmLFPTzqDyy+RsWAPmLFPTzqDyy+PnXfPljFPTwAU0c7smrFPlDFPTwonjq+RsWAPsUcebzqDyy+RsWAPmLFPTzqDyy+smrFPtYcebwonjq+smrFPlDFPTwonjq+umK4PtYcebyYSWW+smrFPtYcebwonjq+umK4PlDFPTyYSWW+1i+nPtUcebwGLYi+1i+nPlDFPTwGLYi+0myTPtQcebz3YZu+0myTPlLFPTz3YZu+1NJ6PtEcebwO9qu+1NJ6PlbFPTwO9qu+NP1KPs0cebxoprm+NP1KPlrFPTxoprm+jBkYPsgcebywO8S+jBkYPl7FPTywO8S++OrFPcMcebwzi8u++OrFPWLFPTwzi8u+0J4xPWjFPTx7d8++0J4xPb0cebx7d8++AD0rvHDFPTyd8M++AD0rvLccebyd8M++0PyCvXbFPTy99My+0PyCvbAceby99My+yDXuvX7FPTzkj8a+yDXuvagcebzkj8a+6LAqvobFPTzf27y+6LAqvqEcebzf27y+DHBbvo7FPTzj/6++DHBbvpkcebzj/6++2kmEvpTFPTzOL6C+2kmEvpEcebzOL6C+vrKYvpzFPTx+q42+vrKYvoocebx+q42+SqCqvqTFPTxze3G+SqCqvoIcebxze3G+Ksq5vqrFPTzydUO+Ksq5vnscebzydUO+HPPFvrLFPTxNABK+HPPFvnUcebxNABK+DurOvrjFPTxUxLu9DurOvm8cebxUxLu9DurOvrjFPTxUxLu9DurOvrjFPTxUxLu9Flocv1kcebwpGRi+Flocv1kcebwpGRi+DurOvm8cebxUxLu9Flocv8zFPTwpGRi+4KAVv8TFPTxcRma+Flocv1kcebwpGRi+Flocv8zFPTwpGRi+4KAVv2McebxcRma+KoIMv7rFPTxrO5i+KoIMv2wcebxrO5i+xCIBv7DFPTyLv7q+xCIBv3ccebyLv7q+LWHnvqTFPTw1JNq+LWHnvoIcebw1JNq+2cPIvpjFPTyq6vW+2cPIvo0cebyq6vW+JOmmvozFPTxk0Qa/JOmmvpkcebxk0Qa/wFmCvoLFPTxjdhC/wFmCvqUcebxjdhC/lFI3vnbFPTxjvRe/lFI3vrAcebxjvRe/qM/NvWrFPTwGiRy/qM/NvbscebwGiRy/wL6lvGDFPTzyxR6/wL6lvMYcebzyxR6/UMV3PVbFPTwVax6/UMV3PdAcebwVax6/FMYPPk7FPTzieRu/FMYPPtgcebzieRu/HHxfPuAcebw8/hW/HHxfPkbFPTw8/hW/yuiVPuccebxGDg6/yuiVPj7FPTxGDg6/Fsm5Pu0cebwIygO/Fsm5PjrFPTwIygO/Is7aPvEcebzqte6+Is7aPjbFPTzqte6+qnL4PvQcebyG5tG+qnL4PjLFPTyG5tG+fR8JP/Ucebw4mrG+fR8JPzDFPTw4mrG+2cPIvpjFPTyq6vW+2cPIvpjFPTyq6vW+wFmCvoLFPTxjdhC/wFmCvoLFPTxjdhC/wFmCvoLFPTxjdhC/JOmmvozFPTxk0Qa/LWHnvqTFPTw1JNq+LWHnvqTFPTw1JNq+LWHnvqTFPTw1JNq+lFI3vnbFPTxjvRe/lFI3vnbFPTxjvRe/lFI3vnbFPTxjvRe/xCIBv7DFPTyLv7q+xCIBv7DFPTyLv7q+xCIBv7DFPTyLv7q+qM/NvWrFPTwGiRy/qM/NvWrFPTwGiRy/qM/NvWrFPTwGiRy/KoIMv7rFPTxrO5i+KoIMv7rFPTxrO5i+KoIMv7rFPTxrO5i+wL6lvGDFPTzyxR6/wL6lvGDFPTzyxR6/wL6lvGDFPTzyxR6/4KAVv8TFPTxcRma+4KAVv8TFPTxcRma+4KAVv8TFPTxcRma+UMV3PVbFPTwVax6/UMV3PVbFPTwVax6/UMV3PVbFPTwVax6/Flocv8zFPTwpGRi+Flocv8zFPTwpGRi+Flocv8zFPTwpGRi+Flocv8zFPTwpGRi+Flocv8zFPTwpGRi+Flocv8zFPTwpGRi+Flocv8zFPTwpGRi+Flocv8zFPTwpGRi+FMYPPk7FPTzieRu/FMYPPk7FPTzieRu/FMYPPk7FPTzieRu/FMYPPk7FPTzieRu/2kmEvpTFPTzOL6C+2kmEvpTFPTzOL6C+2kmEvpTFPTzOL6C+vrKYvpzFPTx+q42+vrKYvpzFPTx+q42+SqCqvqTFPTxze3G+SqCqvqTFPTxze3G+Ksq5vqrFPTzydUO+Ksq5vqrFPTzydUO+HPPFvrLFPTxNABK+HPPFvrLFPTxNABK+DurOvrjFPTxUxLu9DHBbvo7FPTzj/6++DHBbvo7FPTzj/6++DHBbvo7FPTzj/6++PnXfPljFPTwAU0c7PnXfPljFPTwAU0c7PnXfPljFPTwAU0c7PnXfPljFPTwAU0c7PnXfPljFPTwAU0c7smrFPlDFPTwonjq+smrFPlDFPTwonjq+smrFPlDFPTwonjq+RsWAPmLFPTzqDyy+ceUTPzDFPTxWU46+ceUTPzDFPTxWU46+ceUTPzDFPTxWU46+ceUTPzDFPTxWU46+vS0cPzLFPTxI/VK+vS0cPzLFPTxI/VK+iSJEPx7FPTwM72O+iSJEPx7FPTwM72O+MxYKP1LFPTwwSMk9HHxfPkbFPTw8/hW/HHxfPkbFPTw8/hW/HHxfPkbFPTw8/hW/HHxfPkbFPTw8/hW/HHxfPkbFPTw8/hW/6LAqvobFPTzf27y+6LAqvobFPTzf27y+yDXuvX7FPTzkj8a+yDXuvX7FPTzkj8a+0PyCvXbFPTy99My+0PyCvXbFPTy99My+0PyCvXbFPTy99My+yuiVPj7FPTxGDg6/yuiVPj7FPTxGDg6/yuiVPj7FPTxGDg6/yuiVPj7FPTxGDg6/yuiVPj7FPTxGDg6/AD0rvHDFPTyd8M++AD0rvHDFPTyd8M++0J4xPWjFPTx7d8++0J4xPWjFPTx7d8+++OrFPWLFPTwzi8u++OrFPWLFPTwzi8u++OrFPWLFPTwzi8u+Fsm5PjrFPTwIygO/Fsm5PjrFPTwIygO/Fsm5PjrFPTwIygO/Fsm5PjrFPTwIygO/jBkYPl7FPTywO8S+jBkYPl7FPTywO8S+NP1KPlrFPTxoprm+NP1KPlrFPTxoprm+NP1KPlrFPTxoprm+Is7aPjbFPTzqte6+Is7aPjbFPTzqte6+Is7aPjbFPTzqte6+1NJ6PlbFPTwO9qu+1NJ6PlbFPTwO9qu+1NJ6PlbFPTwO9qu+qnL4PjLFPTyG5tG+qnL4PjLFPTyG5tG+qnL4PjLFPTyG5tG+qnL4PjLFPTyG5tG+0myTPlLFPTz3YZu+0myTPlLFPTz3YZu+1i+nPlDFPTwGLYi+1i+nPlDFPTwGLYi+1i+nPlDFPTwGLYi+fR8JPzDFPTw4mrG+fR8JPzDFPTw4mrG+fR8JPzDFPTw4mrG+umK4PlDFPTyYSWW+umK4PlDFPTyYSWW+umK4PlDFPTyYSWW+CSXWvmMceby8EiU9CSXWvmMceby8EiU99C4/vykcebyr6og+9C4/vykcebyr6og+9C4/vykcebyr6og+BWwFv10cebysMV69/O5tvm0cebwOIFg+/O5tvm0cebwOIFg+/O5tvm0cebwOIFg+cnkXvz4cebyFN4A+cnkXvz4cebyFN4A+cnkXvz4cebyFN4A+pja8vlscebzwS2c+pja8vlscebzwS2c+pja8vlscebzwS2c+pja8vlscebzwS2c+RzsPvzwcebwq36Q+RzsPvzwcebwq36Q+QwQhP9gceby8MEU+QwQhP9gceby8MEU+QwQhP9gceby8MEU+QwQhP9gceby8MEU+QwQhP9gceby8MEU+QwQhP9gceby8MEU+QwQhP9gceby8MEU+QwQhP9gceby8MEU+QwQhP9gceby8MEU+ekfPPr0cebzoFz8+ekfPPr0cebzoFz8+aj7YPsMceby8+Qo+ih7DPrYcebyOjXA+ih7DPrYcebyOjXA+qvSzPq8cebyISY8+qvSzPq8cebyISY8+GgeiPqgcebxQN6Q+GgeiPqgcebxQN6Q+Np6NPqAcebyeu7Y+Np6NPqAcebyeu7Y+vBhuPpgcebywi8Y+vBhuPpgcebywi8Y+vBhuPpgcebywi8Y+6Dr6vVkcebzHvyY/6Dr6vVkcebzHvyY/6Dr6vVkcebzHvyY/6Dr6vVkcebzHvyY/6Dr6vVkcebzHvyY/cCItvWIcebz+sCk/cCItvWIcebz+sCk/cCItvWIcebz+sCk/C0saP88cebwAr4k+C0saP88cebwAr4k+C0saP88cebwAr4k+UIIdPWscebzYCyo/UIIdPWscebzYCyo/UIIdPWscebzYCyo/XSwRP8Ucebw8x64+XSwRP8Ucebw8x64+XSwRP8Ucebw8x64++CDzPXYcebzyzic/+CDzPXYcebzyzic/+CDzPXYcebzyzic/68wFP7ocebxcS9E+68wFP7ocebxcS9E+68wFP7ocebxcS9E+NPtJPoEcebxMAyM/NPtJPoEcebxMAyM/NPtJPoEcebxMAyM/irXwPq8cebz8r/A+irXwPq8cebz8r/A+irXwPq8cebz8r/A+Hq6LPowcebxOvBs/Hq6LPowcebxOvBs/Hq6LPowcebxOvBs/MhjSPqQcebw+OwY/MhjSPqQcebw+OwY/gj2wPpgcebxMFxI/TnUEvzwcebwKJsg+TnUEvzwcebwKJsg+TnUEvzwcebwKJsg+TnUEvzwcebwKJsg+Xg6vvlscebygMIk+Xg6vvlscebygMIk+ftudvlwcebzXuJ4+ftudvlwcebzXuJ4+ftudvlwcebzXuJ4+TB7vvj0cebxecug+TB7vvj0cebxecug+TB7vvj0cebxecug+dhiKvl4cebzK7bE+dhiKvl4cebzK7bE+dhiKvl4cebzK7bE+ynnRvkAcebzcoAI/ynnRvkAcebzcoAI/ynnRvkAcebzcoAI/ynnRvkAcebzcoAI/JCpovmEcebzkgcI+JCpovmEcebzkgcI+bFQ4vmQcebw0MtA+bFQ4vmQcebw0MtA+bFQ4vmQcebw0MtA+tnSwvkQcebzuDw8/tnSwvkQcebzuDw8/tnSwvkQcebzuDw8/1HAFvmkcebx+x9o+1HAFvmkcebx+x9o+1HAFvmkcebx+x9o+ZpSMvkocebwtVBk/ZpSMvkocebwtVBk/ZpSMvkocebwtVBk/ZpSMvkocebwtVBk/qJmgvW4cebwIF+I+qJmgvW4cebwIF+I+YPfNvHQcebxQA+Y+YPfNvHQcebxQA+Y+YPfNvHQcebxQA+Y+YNNMvlEcebwoRCE/YNNMvlEcebwoRCE/YNNMvlEcebwoRCE/YNNMvlEcebwoRCE/YNNMvlEcebwoRCE/4OPqPHscebxofOY+4OPqPHscebxofOY+SE6oPYIcebyUgOM+SE6oPYIcebyUgOM+pMMJPokceby8G90+pMMJPokceby8G90+pMMJPokceby8G90+lFk9PpEcebysZ9M+lFk9PpEcebysZ9M+/O5tvm0cebwOIFg+/O5tvm0cebwOIFg+pja8vszFPTzwS2c+pja8vszFPTzwS2c+pja8vlscebzwS2c+/O5tvrrFPTwOIFg+pja8vszFPTzwS2c+Xg6vvlscebygMIk+pja8vlscebzwS2c+Xg6vvszFPTygMIk+ftudvlwcebzXuJ4+ftudvsrFPTzXuJ4+dhiKvl4cebzK7bE+dhiKvsjFPTzK7bE+JCpovmEcebzkgcI+JCpovsbFPTzkgcI+bFQ4vmQcebw0MtA+bFQ4vsLFPTw0MtA+1HAFvmkcebx+x9o+1HAFvr7FPTx+x9o+qJmgvW4cebwIF+I+qJmgvbjFPTwIF+I+YPfNvLLFPTxQA+Y+YPfNvHQcebxQA+Y+4OPqPKzFPTxofOY+4OPqPHscebxofOY+SE6oPaTFPTyUgOM+SE6oPYIcebyUgOM+pMMJPp7FPTy8G90+pMMJPokceby8G90+lFk9PpbFPTysZ9M+lFk9PpEcebysZ9M+vBhuPo7FPTywi8Y+vBhuPpgcebywi8Y+Np6NPobFPTyeu7Y+Np6NPqAcebyeu7Y+GgeiPn7FPTxQN6Q+GgeiPqgcebxQN6Q+qvSzPnbFPTyISY8+qvSzPq8cebyISY8+ih7DPnDFPTyOjXA+ih7DPrYcebyOjXA+ekfPPmrFPTzoFz8+ekfPPr0cebzoFz8+aj7YPmTFPTy8+Qo+aj7YPsMceby8+Qo+aj7YPmTFPTy8+Qo+aj7YPmTFPTy8+Qo+QwQhP9gceby8MEU+QwQhP9gceby8MEU+aj7YPsMceby8+Qo+QwQhP07FPTy8MEU+QwQhP9gceby8MEU+C0saP1jFPTwAr4k+C0saP88cebwAr4k+QwQhP07FPTy8MEU+XSwRP2LFPTw8x64+XSwRP8Ucebw8x64+68wFP2zFPTxcS9E+68wFP7ocebxcS9E+irXwPnbFPTz8r/A+irXwPq8cebz8r/A+MhjSPoLFPTw+OwY/MhjSPqQcebw+OwY/gj2wPo7FPTxMFxI/gj2wPpgcebxMFxI/Hq6LPprFPTxOvBs/Hq6LPowcebxOvBs/NPtJPqTFPTxMAyM/NPtJPoEcebxMAyM/+CDzPbDFPTzyzic/+CDzPXYcebzyzic/UIIdPbrFPTzYCyo/UIIdPWscebzYCyo/cCItvcTFPTz+sCk/cCItvWIcebz+sCk/6Dr6vc7FPTzHvyY/6Dr6vVkcebzHvyY/YNNMvlEcebwoRCE/YNNMvtbFPTwoRCE/ZpSMvkocebwtVBk/ZpSMvtzFPTwtVBk/tnSwvkQcebzuDw8/tnSwvuLFPTzuDw8/ynnRvkAcebzcoAI/ynnRvubFPTzcoAI/TB7vvj0cebxecug+TB7vvujFPTxecug+TnUEvzwcebwKJsg+TnUEv+rFPTwKJsg+RzsPvzwcebwq36Q+RzsPv+rFPTwq36Q+cnkXvz4cebyFN4A+cnkXv+jFPTyFN4A+cnkXvz4cebyFN4A+9C4/v/zFPTyr6og+9C4/vykcebyr6og+cnkXv+jFPTyFN4A+BWwFv8jFPTysMV69BWwFv8jFPTysMV699C4/vykcebyr6og+9C4/vykcebyr6og+9C4/v/zFPTyr6og+BWwFv10cebysMV69BWwFv8jFPTysMV69BWwFv8jFPTysMV69BWwFv8jFPTysMV69CSXWvmMceby8EiU9CSXWvmMceby8EiU9BWwFv10cebysMV69/O5tvm0cebwOIFg+/O5tvm0cebwOIFg+/O5tvrrFPTwOIFg+TnUEv+rFPTwKJsg+TnUEv+rFPTwKJsg+TnUEv+rFPTwKJsg+TnUEv+rFPTwKJsg+pja8vszFPTzwS2c+pja8vszFPTzwS2c+pja8vszFPTzwS2c+pja8vszFPTzwS2c+RzsPv+rFPTwq36Q+RzsPv+rFPTwq36Q+Xg6vvszFPTygMIk+Xg6vvszFPTygMIk+ftudvsrFPTzXuJ4+ftudvsrFPTzXuJ4+ftudvsrFPTzXuJ4+TB7vvujFPTxecug+TB7vvujFPTxecug+TB7vvujFPTxecug+dhiKvsjFPTzK7bE+dhiKvsjFPTzK7bE+dhiKvsjFPTzK7bE+ynnRvubFPTzcoAI/ynnRvubFPTzcoAI/ynnRvubFPTzcoAI/ynnRvubFPTzcoAI/JCpovsbFPTzkgcI+JCpovsbFPTzkgcI+bFQ4vsLFPTw0MtA+bFQ4vsLFPTw0MtA+bFQ4vsLFPTw0MtA+tnSwvuLFPTzuDw8/tnSwvuLFPTzuDw8/tnSwvuLFPTzuDw8/1HAFvr7FPTx+x9o+1HAFvr7FPTx+x9o+1HAFvr7FPTx+x9o+ZpSMvtzFPTwtVBk/ZpSMvtzFPTwtVBk/ZpSMvtzFPTwtVBk/ZpSMvtzFPTwtVBk/qJmgvbjFPTwIF+I+qJmgvbjFPTwIF+I+YPfNvLLFPTxQA+Y+YPfNvLLFPTxQA+Y+YPfNvLLFPTxQA+Y+YNNMvtbFPTwoRCE/YNNMvtbFPTwoRCE/YNNMvtbFPTwoRCE/YNNMvtbFPTwoRCE/YNNMvtbFPTwoRCE/4OPqPKzFPTxofOY+4OPqPKzFPTxofOY+SE6oPaTFPTyUgOM+SE6oPaTFPTyUgOM+pMMJPp7FPTy8G90+pMMJPp7FPTy8G90+pMMJPp7FPTy8G90+6Dr6vc7FPTzHvyY/6Dr6vc7FPTzHvyY/6Dr6vc7FPTzHvyY/6Dr6vc7FPTzHvyY/6Dr6vc7FPTzHvyY/lFk9PpbFPTysZ9M+lFk9PpbFPTysZ9M+vBhuPo7FPTywi8Y+vBhuPo7FPTywi8Y+vBhuPo7FPTywi8Y+ekfPPmrFPTzoFz8+ekfPPmrFPTzoFz8+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+aj7YPmTFPTy8+Qo+ih7DPnDFPTyOjXA+ih7DPnDFPTyOjXA+qvSzPnbFPTyISY8+qvSzPnbFPTyISY8+GgeiPn7FPTxQN6Q+GgeiPn7FPTxQN6Q+Np6NPobFPTyeu7Y+Np6NPobFPTyeu7Y+cCItvcTFPTz+sCk/cCItvcTFPTz+sCk/cCItvcTFPTz+sCk/C0saP1jFPTwAr4k+C0saP1jFPTwAr4k+C0saP1jFPTwAr4k+UIIdPbrFPTzYCyo/UIIdPbrFPTzYCyo/UIIdPbrFPTzYCyo/XSwRP2LFPTw8x64+XSwRP2LFPTw8x64+XSwRP2LFPTw8x64++CDzPbDFPTzyzic/+CDzPbDFPTzyzic/+CDzPbDFPTzyzic/68wFP2zFPTxcS9E+68wFP2zFPTxcS9E+68wFP2zFPTxcS9E+NPtJPqTFPTxMAyM/NPtJPqTFPTxMAyM/NPtJPqTFPTxMAyM/irXwPnbFPTz8r/A+irXwPnbFPTz8r/A+irXwPnbFPTz8r/A+Hq6LPprFPTxOvBs/Hq6LPprFPTxOvBs/Hq6LPprFPTxOvBs/MhjSPoLFPTw+OwY/MhjSPoLFPTw+OwY/gj2wPo7FPTxMFxI/9C4/v/zFPTyr6og+9C4/v/zFPTyr6og+9C4/v/zFPTyr6og+CSXWvsTFPTy8EiU9CSXWvsTFPTy8EiU9BWwFv8jFPTysMV69/O5tvrrFPTwOIFg+/O5tvrrFPTwOIFg+/O5tvrrFPTwOIFg+cnkXv+jFPTyFN4A+cnkXv+jFPTyFN4A+cnkXv+jFPTyFN4A+HnghtAAAgL8r8iQz2CANtP//f7/4640zPmcJtAAAgL8BrwM0VGnVswAAgL9sAZMzAAAAAAAAgL9bMvKzVGnVswAAgL9sAZMzAAAAAAAAgL9bMvKzAAAAAAAAgL/7DLazL8oCtP//f7+jkIwzLd7VswAAgL+DyLYzVGnVswAAgL9sAZMzAAAAAAAAgL/7DLazPmcJtAAAgL8BrwM0AAAAAAAAgL9bMvKzHnghtAAAgL8r8iQzPmcJtAAAgL8BrwM0HnghtAAAgL8r8iQz2CANtP//f7/4640zHnihswAAgL9W6o8z2CANtP//f7/4640z3lrxswAAgL/WUrgz/S/uswAAgL8oc44zBk3KswAAgL9655UzHnihswAAgL9W6o8z3lrxswAAgL/WUrgzHnihswAAgL9W6o8z3lrxswAAgL/WUrgzBk3KswAAgL9655Uz/S/uswAAgL8oc44zBk3KswAAgL9655UzBk3KswAAgL+OpqszRsYItAAAgL9D5osznaP8swAAgL9ayJ0z/S/uswAAgL8oc44zBk3KswAAgL+OpqszRsYItAAAgL9D5oszBk3KswAAgL+OpqszXsYItAAAgL+Ii4szRsYItAAAgL9D5osznaP8swAAgL9ayJ0zXsYItAAAgL+Ii4sznaP8swAAgL9ayJ0zaJruswAAgL98lJIz/JEftAAAgL/59I4zXsYItAAAgL+Ii4szaJruswAAgL98lJIz/JEftAAAgL/59I4zyE0CtAAAgL8yiaIzaJruswAAgL98lJIz5rytswAAgL80TrQz/JEftAAAgL/59I4z5rytswAAgL80TrQzyE0CtAAAgL8yiaIznE0CtAAAgL8VbZYz5rytswAAgL80TrQzyE0CtAAAgL8yiaIznE0CtAAAgL8VbZYz0rHKswAAgL9hGpczAqMPtAAAgL/NGpcznE0CtAAAgL8VbZYz0rHKswAAgL9hGpczAqMPtAAAgL/NGpczxLkBtAAAgL8t4pkzgr3PswAAgL83vJEz0rHKswAAgL9hGpczAqMPtAAAgL/NGpczxLkBtAAAgL8t4pkzZJTDs///f7/njZczxLkBtAAAgL8t4pkzqiAAtAAAgL+yMJIzt2jvswAAgL9uNaUzgr3PswAAgL83vJEzZJTDs///f7/njZczZJTDs///f7/njZczt2jvswAAgL9uNaUzgr3PswAAgL83vJEzqiAAtAAAgL+yMJIzt2jvswAAgL9uNaUzqiAAtAAAgL+yMJIz0xZNtAAAgL8XJP8yygEZtAAAgL/DQJszDTOBswAAgL+DEMQz0xZNtAAAgL8XJP8yygEZtAAAgL/DQJszygEZtAAAgL/DQJsz0xZNtAAAgL8XJP8yYwY8tAAAgL9Y1JIzDTOBswAAgL+DEMQzYwY8tAAAgL9Y1JIzxPKzswAAgL9O45czDTOBswAAgL+DEMQzYwY8tAAAgL9Y1JIzE9b1swAAgL9c2q4zxPKzswAAgL9O45czE9b1swAAgL9c2q4z9GXQswAAgL+dTYQzxPKzswAAgL9O45czE9b1swAAgL9c2q4zHOjfs///f7/6lGcz9GXQswAAgL+dTYQzvK4jtAAAgL+1so8zHOjfs///f7/6lGcz9GXQswAAgL+dTYQzvK4jtAAAgL+1so8zHOjfs///f7/6lGczBbDNswAAgL/dc7gzvK4jtAAAgL+1so8zLd7VswAAgL+DyLYzBbDNswAAgL/dc7gzAdZJtP//f79TVBczL8oCtP//f7+jkIwzuE0CtAAAgL+odpQz+sD6swAAgL/473czsZbjswAAgL+rUJMzLd7VswAAgL+DyLYzRy/TswAAgL8cTb0zBbDNswAAgL/dc7gzAdZJtP//f79TVBczL8oCtP//f7+jkIwzAAAAAAAAgL/7DLazAdZJtP//f79TVBczRy/TswAAgL8cTb0zsZbjswAAgL+rUJMzRy/TswAAgL8cTb0z+sD6swAAgL/473czsZbjswAAgL+rUJMzuE0CtAAAgL+odpQz+sD6swAAgL/473czuE0CtAAAgL+odpQzxWliPwAAAADe6e6+03dpPwAAAACkAdK+xWliPwAAAADe6e6+03dpPwAAAACkAdK+c+rXvQAAAADEkn6/Z+rXvQAAAADEkn6/c+rXvQAAAADEkn6/Z+rXvQAAAADEkn6/Z+rXvQAAAADEkn6/c+rXvQAAAADEkn6/BhFRPwAAAACEvRM/CRFRPwAAAACDvRM/BhFRPwAAAACEvRM/CRFRPwAAAACDvRM/CRFRPwAAAACDvRM/BhFRPwAAAACEvRM/bdYtvwAAAABF7Ts/Y9YtvwAAAABM7Ts/YtYtv5b3r7ZN7Ts/XNUtv8ABYDl46zs/bdYtvwAAAABF7Ts/YtYtv5b3r7ZN7Ts/bdYtvwAAAABF7Ts/Y9YtvwAAAABM7Ts/YtYtv5b3r7ZN7Ts/Y9YtvwAAAABM7Ts/XNUtvwAAAAB46zs/rgHXOwD+fz8QAQg71+rXvQAAAADDkn6/1+rXvQAAAADDkn6/1+rXvQAAAADDkn6/1+rXvQAAAADDkn6/tXdavwAAAAALbwU/o6dRvwAAAAAm4xI/tXdavwAAAAALbwU/o6dRvwAAAAAm4xI/e5c9vwAAAABYAyw/e5c9vwAAAABYAyw/TYkmvwAAAACFa0I/TYkmvwAAAACFa0I/Gt0MvwAAAACswVU/Gt0MvwAAAACswVU/xOnhvgAAAADLuWU/xOnhvgAAAADLuWU/TY2mvgAAAADkEXI/TY2mvgAAAADkEXI/ohlRvgAAAAD1mXo/ohlRvgAAAAD1mXo/R6GjvQAAAAD+LX8/R6GjvQAAAAD+LX8/duE6PQAAAAD/uX8/duE6PQAAAAD/uX8/XZEuPgAAAAD4P3w/XZEuPgAAAAD4P3w/LNGVPgAAAADqyXQ/LNGVPgAAAADqyXQ/pAHSPgAAAADTd2k/pAHSPgAAAADTd2k/C28FPwAAAAC1d1o/C28FPwAAAAC1d1o/QMMfPwAAAACQBUg/QMMfPwAAAACQBUg/b5M3PwAAAABlazI/b5M3PwAAAABlazI/mX1MPwAAAAA0ARo/mX1MPwAAAAA0ARo/vC1ePwAAAAD9Uf4+vC1ePwAAAAD9Uf4+2V1sPwAAAACJncQ+2V1sPwAAAACJncQ+5BFyPwAAAABNjaY+5BFyPwAAAABNjaY+mdOHvgAAAADU03Y/j9OHvgAAAADU03Y/mdOHvgAAAADU03Y/j9OHvgAAAADU03Y/mdOHvgAAAADU03Y/j9OHvgAAAADU03Y/2V1svwAAAACJncS+5BFyvwAAAABNjaa+5BFyvwAAAABNjaa+2V1svwAAAACJncS+vC1evwAAAAD9Uf6+vC1evwAAAAD9Uf6+mX1MvwAAAAA0ARq/mX1MvwAAAAA0ARq/b5M3vwAAAABlazK/b5M3vwAAAABlazK/QMMfvwAAAACQBUi/QMMfvwAAAACQBUi/C28FvwAAAAC1d1q/C28FvwAAAAC1d1q/pAHSvgAAAADTd2m/pAHSvgAAAADTd2m/LNGVvgAAAADqyXS/LNGVvgAAAADqyXS/XZEuvgAAAAD4P3y/XZEuvgAAAAD4P3y/duE6vQAAAAD/uX+/duE6vQAAAAD/uX+/R6GjPQAAAAD+LX+/R6GjPQAAAAD+LX+/ohlRPgAAAAD1mXq/ohlRPgAAAAD1mXq/TY2mPgAAAADkEXK/TY2mPgAAAADkEXK/xOnhPgAAAADLuWW/xOnhPgAAAADLuWW/GtsMPwAAAACswVW/GtsMPwAAAACswVW/TYkmPwAAAACFaUK/TYkmPwAAAACFaUK/e5c9PwAAAABYAyy/e5c9PwAAAABYAyy/o6dRPwAAAAAm4xK/o6dRPwAAAAAm4xK/AAAAAAAAgD/ff2+06BbNMwAAgD87Wwm0AAAAAAAAgD/ff2+06BbNMwAAgD87Wwm0FbjOMwAAgD8QfCazAAAAAAAAgD/ff2+06BbNMwAAgD87Wwm0FbjOMwAAgD8QfCazxgQNNAAAgD9OPtezFbjOMwAAgD8QfCazWgv+MwAAgD/QJlyzxgQNNAAAgD9OPtezWgv+MwAAgD/QJlyzb0gKNAAAgD8Hj2SzxgQNNAAAgD9OPtezsNDqMwAAgD+j9LWzWgv+MwAAgD/QJlyzb0gKNAAAgD8Hj2SzsNDqMwAAgD+j9LWzb0gKNAAAgD8Hj2SzOJsQNAAAgD/ePpuzsNDqMwAAgD+j9LWzA7D0MwAAgD/TopSzOJsQNAAAgD/ePpuzA7D0MwAAgD/TopSzgfsGNAAAgD8limmzOJsQNAAAgD/ePpuzTMTcMwAAgD9PQbOzA7D0MwAAgD/TopSzgfsGNAAAgD8limmz8QO1MwAAgD+uwMWzTMTcMwAAgD9PQbOzooHsM///fz/hYNaz0ePuMwAAgD8FjJqzCDTyMwAAgD/Udb2zVOD8MwAAgD+lVkKzgfsGNAAAgD8limmzZ94PNP//fz+YQnSz7rNTtQAAgD9UaYK1TMTcMwAAgD9PQbOzHw0MNAAAgD8Hi5izZ94PNP//fz+YQnSz7rNTtQAAgD9UaYK1CDTyMwAAgD/Udb2zZ94PNP//fz+YQnSz8QO1MwAAgD+uwMWzCDTyMwAAgD/Udb2z8QO1MwAAgD+uwMWzVOD8MwAAgD+lVkKzooHsM///fz/hYNazVOD8MwAAgD+lVkKzooHsM///fz/hYNaz0ePuMwAAgD8FjJqz0ePuMwAAgD8FjJqz7rNTtQAAgD9UaYK1gy+8tAAAgD/HuEUzHw0MNAAAgD8Hi5izjpvJMwAAgD+ANaWzV+v2MwAAgD+FiJuzshj3MwAAgD+jZZyzbBr3MwAAgD+wMJKzcdYBNAAAgD8wxaOzV+v2MwAAgD+FiJuzshj3MwAAgD+jZZyzwqoDNAAAgD+l+puzV+v2MwAAgD+FiJuzFCH2MwAAgD8q+puzshj3MwAAgD+jZZyzcdYBNAAAgD8wxaOzwqoDNAAAgD+l+puzjpvJMwAAgD+ANaWzcdYBNAAAgD8wxaOzjpvJMwAAgD+ANaWzbBr3MwAAgD+wMJKzbBr3MwAAgD+wMJKzgy+8tAAAgD/HuEUzPdbJMwAAgD8/8iSzHw0MNAAAgD8Hi5izPuUPNAAAgD823WmzGd5nNP//fz/++R6zgy+8tAAAgD/HuEUzGd5nNP//fz/++R6zPdbJMwAAgD8/8iSzGd5nNP//fz/++R6zz1SSM///fz+aMwq0PdbJMwAAgD8/8iSzPuUPNAAAgD823Wmzz1SSM///fz+aMwq0AzDuMwAAgD/M+rezW5kBNAAAgD9455WzPuUPNAAAgD823Wmz0/cYNAAAgD/HsP+yz1SSM///fz+aMwq00/cYNAAAgD/HsP+yW5kBNAAAgD9455Wz0/cYNAAAgD/HsP+yzVW3MwAAgD/cgsyzAzDuMwAAgD/M+rezW5kBNAAAgD9455WzzVW3MwAAgD/cgsyzAzDuMwAAgD/M+rez8g31MwAAgD8y7KmznaP8MwAAgD9TyJ2zzVW3MwAAgD/cgsyz8g31MwAAgD8y7Kmz8g31MwAAgD8y7KmzCMH6MwAAgD+Ri4uznaP8MwAAgD9TyJ2zCMH6MwAAgD+Ri4uzgaP8MwAAgD9YMnyznaP8MwAAgD9TyJ2z3cD6MwAAgD/e8lWzCMH6MwAAgD+Ri4uzgaP8MwAAgD9YMnyz3cD6MwAAgD/e8lWzgaP8MwAAgD9YMnyzrk0CNAAAgD9uBpKzyk0CNAAAgD8dUYqz3cD6MwAAgD/e8lWzrk0CNAAAgD9uBpKzpOPuMwAAgD87wbqzrk0CNAAAgD9uBpKzyk0CNAAAgD8dUYqzpOPuMwAAgD87wbqzFCH2MwAAgD8q+puzyk0CNAAAgD8dUYqzpOPuMwAAgD87wbqzFCH2MwAAgD8q+puzwqoDNAAAgD+l+puzwPIStP//f7+C5JIzkhf0s///f79be5gzoPX/u6D1f7+x9IK8wPIStP//f7+C5JIzkhf0s///f79be5gzwPIStP//f7+C5JIzoPX/u6D1f7+x9IK8khf0s///f79be5gzv8zMOe//f7/AqLY6oPX/u6D1f7+x9IK8bakFtAAAgL+GMKQzv8zMOe//f7/AqLY6AUIOtAAAgL+OGpczbakFtAAAgL+GMKQzmqbnswAAgL+SGpczv8zMOe//f7/AqLY6bakFtAAAgL+GMKQzmqbnswAAgL+SGpczHnghtAAAgL+hdb0z27kXtAAAgL+aUJMzgnUEtAAAgL9OnpUzpVrxswAAgL9xpnQzrePuswAAgL81gZcz3WXnswAAgL/4SJczSPXjswAAgL97LKkz0OviswAAgL9QHYEzAAAAAAAAgL/ImsAzrePuswAAgL81gZczSPXjswAAgL97LKkzrePuswAAgL81gZcz27kXtAAAgL+aUJMzSPXjswAAgL97LKkz27kXtAAAgL+aUJMzpVrxswAAgL9xpnQzHnghtAAAgL+hdb0zpVrxswAAgL9xpnQzHnghtAAAgL+hdb0zAAAAAAAAgL/ImsAz0OviswAAgL9QHYEzphrOswAAgL/Z2A00AAAAAAAAgL/ImsAzAtQEtP//f7+CAZUzgnUEtAAAgL9OnpUz0OviswAAgL9QHYEzphrOswAAgL/Z2A007jVyswAAgL99UmszJ+4YtAAAgL94J7czgnUEtAAAgL9OnpUz3WXnswAAgL/4SJczJ+4YtAAAgL94J7czWpDyswAAgL9lP5sz3WXnswAAgL/4SJczJ+4YtAAAgL94J7czaeMMtAAAgL/ITIQzWpDyswAAgL9lP5szaeMMtAAAgL/ITIQz09b1swAAgL9G2a4zWpDyswAAgL9lP5szaeMMtAAAgL/ITIQz2Av+swAAgL9O45cz09b1swAAgL9G2a4z2Av+swAAgL9O45cz09b1swAAgL9G2a4zhga8swAAgL851pIz2Av+swAAgL9O45czx7bOswAAgL8kEcQzhga8swAAgL851pIzx7bOswAAgL8kEcQzhga8swAAgL851pIzQxZNswAAgL9iH/8yx7bOswAAgL8kEcQzQxZNswAAgL9iH/8yAAAAAAAAgL+uQpszQxZNswAAgL9iH/8yAAAAAAAAgL+uQpszAAAAAAAAgL+uQpszAUIOtAAAgL+OGpcznKbnswAAgL8XiaIzmqbnswAAgL+SGpczo3TDs///f78fbZYzAUIOtAAAgL+OGpczo3TDs///f78fbZYzYikNtAAAgL8zu5gznKbnswAAgL8XiaIzo3TDs///f78fbZYzUsgQtAAAgL9Au5gzYikNtAAAgL8zu5gznKbnswAAgL8XiaIzUsgQtAAAgL9Au5gzYikNtAAAgL8zu5gzGizZswAAgL/hbZczUsgQtAAAgL9Au5gzSlvvswAAgL/3VLUzY5HgswAAgL+CyJ0zGizZswAAgL/hbZczSlvvswAAgL/3VLUzGizZswAAgL/hbZczSlvvswAAgL/3VLUzY5HgswAAgL+CyJ0zz122swAAgL8J5oszAG0otAAAgL9Pt5IzY5HgswAAgL+CyJ0zz122swAAgL8J5oszAG0otAAAgL9Pt5Izz122swAAgL8J5oszyl22s///f78f2KEzAG0otAAAgL9Pt5Ize1MEtAAAgL/ZmpIzH23gswAAgL9A6JUzyl22s///f78f2KEzH23gswAAgL9A6JUzyl22s///f78f2KEzW5AEtAAAgL8nZIUze1MEtAAAgL/ZmpIzH23gswAAgL9A6JUzaZ0atAAAgL/IA5wzAtQEtP//f7+CAZUzW5AEtAAAgL8nZIUze1MEtAAAgL/ZmpIzao+rswAAgL/zg74zaZ0atAAAgL/IA5wzW5AEtAAAgL8nZIUzaZ0atAAAgL/IA5wzao+rswAAgL/zg74zAtQEtP//f7+CAZUzao+rswAAgL/zg74z7jVyswAAgL99UmszphrOswAAgL/Z2A007jVyswAAgL99UmszLQTfPQAAAABIen4/MATfPQAAAABHen4/LQTfPQAAAABIen4/MATfPQAAAABHen4/LQTfPQAAAABIen4/MATfPQAAAABHen4/tXdaPwAAAAALbwW/o6dRPwAAAAAm4xK/tXdaPwAAAAALbwW/o6dRPwAAAAAm4xK/e5c9PwAAAABYAyy/e5c9PwAAAABYAyy/TYkmPwAAAACFaUK/TYkmPwAAAACFaUK/GtsMPwAAAACswVW/GtsMPwAAAACswVW/xOnhPgAAAADLuWW/xOnhPgAAAADLuWW/TY2mPgAAAADkEXK/TY2mPgAAAADkEXK/ohlRPgAAAAD1mXq/ohlRPgAAAAD1mXq/R6GjPQAAAAD+LX+/R6GjPQAAAAD+LX+/duE6vQAAAAD/uX+/duE6vQAAAAD/uX+/XZEuvgAAAAD4P3y/XZEuvgAAAAD4P3y/LNWVvgAAAADqyXS/LNWVvgAAAADqyXS/pAHSvgAAAADTd2m/pAHSvgAAAADTd2m/C28FvwAAAAC1d1q/C28FvwAAAAC1d1q/QMMfvwAAAACQBUi/QMMfvwAAAACQBUi/b5M3vwAAAABlazK/b5M3vwAAAABlazK/mX1MvwAAAAA0ARq/mX1MvwAAAAA0ARq/vC1evwAAAAD9Uf6+vC1evwAAAAD9Uf6+2V1svwAAAACJncS+2V1svwAAAACJncS+5BFyvwAAAABNjaa+5BFyvwAAAABNjaa+mdOHPgAAAADU03a/mdOHPgAAAADS03a/mdOHPgAAAADU03a/mdOHPgAAAADS03a/mdOHPgAAAADU03a/mdOHPgAAAADS03a/5BFyPwAAAABNjaY+2V1sPwAAAACJncQ+2V1sPwAAAACJncQ+5BFyPwAAAABNjaY+vC1ePwAAAAD9Uf4+vC1ePwAAAAD9Uf4+mX1MPwAAAAA0ARo/mX1MPwAAAAA0ARo/b5M3PwAAAABlazI/b5M3PwAAAABlazI/QMMfPwAAAACQBUg/QMMfPwAAAACQBUg/C28FPwAAAAC1d1o/C28FPwAAAAC1d1o/pAHSPgAAAADTd2k/pAHSPgAAAADTd2k/LNGVPgAAAADqyXQ/LNGVPgAAAADqyXQ/XZEuPgAAAAD4P3w/XZEuPgAAAAD4P3w/duE6PQAAAAD/uX8/duE6PQAAAAD/uX8/R6GjvQAAAAD+LX8/R6GjvQAAAAD+LX8/ohlRvgAAAAD1mXo/ohlRvgAAAAD1mXo/TY2mvgAAAADkEXI/TY2mvgAAAADkEXI/xOnhvgAAAADLuWU/xOnhvgAAAADLuWU/GtsMvwAAAACswVU/GtsMvwAAAACswVU/TYkmvwAAAACFa0I/TYkmvwAAAACFa0I/e5c9vwAAAABYAyw/e5c9vwAAAABYAyw/o6dRvwAAAAAm4xI/o6dRvwAAAAAm4xI/xWlivwAAAADe6e4+xWlivwAAAADe6e4+03dpvwAAAACkAdI+03dpvwAAAACkAdI+SAPfPQAAAABKen4/SAPfPQAAAABKen4/SAPfPQAAAABKen4/SAPfPQAAAABKen4/jJRRvwAAAAC1AhO/h5RRvwAAAAC/AhO/jJRRvwAAAAC1AhO/h5RRvwAAAAC/AhO/h5RRvwAAAAC/AhO/jJRRvwAAAAC1AhO/ay4tP7vkEzYhiDy/bS4tPwAAAAAiiDy/cS4tPwAAAAAeiDy/ay4tP7vkEzYhiDy/cS4tPwAAAAAeiDy/cS4tPwAAAAAeiDy/ay4tP7vkEzYhiDy/bS4tPwAAAAAiiDy/bS4tPwAAAAAiiDy/nKbnMwAAgD+9OpKzCSH2MwAAgD8IUYqzwk0CNP//fz/8MWSzA0IONAAAgD+/OpKzicxMuqv/fz+9H0q7CsXeMwAAgD8tXaCznKbnMwAAgD+9OpKzA0IONAAAgD+/OpKzCsXeMwAAgD8tXaCznKbnMwAAgD+9OpKzwk0CNP//fz/8MWSzA0IONAAAgD+/OpKzCSH2MwAAgD8IUYqzl00CNAAAgD+QBpKzwk0CNP//fz/8MWSz6qbnMwAAgD8X4aizCSH2MwAAgD8IUYqzl00CNAAAgD+QBpKzICzZMwAAgD+Opq+z6qbnMwAAgD8X4aizl00CNAAAgD+QBpKzICzZMwAAgD+Opq+z6qbnMwAAgD8X4aizcpruM///fz99yJ2zdsYINAAAgD8pjIuzICzZMwAAgD+Opq+zdsYINAAAgD8pjIuzSPXjMwAAgD/u66mzcpruM///fz99yJ2zdsYINAAAgD8pjIuzy4zZMwAAgD8u2YqzSPXjMwAAgD/u66mzcpruM///fz99yJ2zy4zZMwAAgD8u2YqzSPXjMwAAgD/u66mzUsYINAAAgD8xJXyzy4zZMwAAgD8u2Yqz5N/8MwAAgD886JWzmAQBNAAAgD9sAq2zUsYINAAAgD8xJXyz5N/8MwAAgD886JWzUsYINAAAgD8xJXyzpk3KMwAAgD9rqLOz5N/8MwAAgD886JWzmAQBNAAAgD9sAq2z63ehMwAAgD9VRxW0pk3KMwAAgD9rqLOzWmHdM///fz+CAZWzmAQBNAAAgD9sAq2zPAM1NAAAgD8Qo0mzpk3KMwAAgD9rqLOzPAM1NAAAgD8Qo0mz63ehMwAAgD9VRxW0PAM1NAAAgD8Qo0mz63ehMwAAgD9VRxW0WmHdM///fz+CAZWzUHkhNAAAgD+HUmuzAAAAAAAAgD/o0mWzWmHdM///fz+CAZWz0OviMwAAgD8Nm5ezvdYFNAAAgD8+9m+zUHkhNAAAgD+HUmuzAAAAAAAAgD/o0mWzUHkhNAAAgD+HUmuzAAAAAAAAgD/o0mWz0OviMwAAgD8Nm5ez5u48NAAAgD+ZmsCzp00CNAAAgD9/dpSzXsYINAAAgD8A8HezKKe1M///fz+odb2z3K/NMwAAgD8ozbmz0OviMwAAgD8Nm5ezbOD8MwAAgD+EVkKzp00CNAAAgD9/dpSzvdYFNAAAgD8+9m+z98IHNAAAgD8pwMWzXsYINAAAgD8A8Hez5u48NAAAgD+ZmsCzp00CNAAAgD9/dpSzbOD8MwAAgD+EVkKzXsYINAAAgD8A8HezbOD8MwAAgD+EVkKz98IHNAAAgD8pwMWzKKe1M///fz+odb2z98IHNAAAgD8pwMWzKKe1M///fz+odb2z5u48NAAAgD+ZmsCz3K/NMwAAgD8ozbmzC98BNAAAgD/hwoqzvdYFNAAAgD8+9m+z3K/NMwAAgD8ozbmzC98BNAAAgD/hwoqzgpwCNAAAgD/AkKCz4dm7MwAAgD/a36azC98BNAAAgD/hwoqzgpwCNAAAgD/AkKCz4dm7MwAAgD/a36azgpwCNAAAgD/AkKCzOqYZNAAAgD9XZHqz4dm7MwAAgD/a36azS/YGNAAAgD+98iazOqYZNAAAgD9XZHqzS/YGNAAAgD+98iazOqYZNAAAgD9XZHqzJLAcNAAAgD8H2RyzFQmbMwAAgD9acRq0S/YGNAAAgD+98iazJLAcNAAAgD8H2RyzLxZNMwAAgD/+mbCzFQmbMwAAgD9acRq0JLAcNAAAgD8H2RyzLxZNMwAAgD/+mbCzgQKZMwAAgD+uQpuzFQmbMwAAgD9acRq0LxZNMwAAgD/+mbCzgQKZMwAAgD+uQpuzgQKZMwAAgD+uQpuzAAAAAKr/fz+5S1M7IGzcMwAAgD98eKOzkhf0M///fz9V65CzIGzcMwAAgD98eKOzkhf0M///fz9V65CzIGzcMwAAgD98eKOzicxMuqv/fz+9H0q7AAAAAKr/fz+5S1M7khf0M///fz9V65CzicxMuqv/fz+9H0q7AAAAAKr/fz+5S1M7CsXeMwAAgD8tXaCzAAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAIC/AACAvwAAgD8AAIC/AACAvwAAgD8AAIC/AACAvwAAgD8AAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAIC/AACAvwAAgL8AAIC/AACAvwAAgL8AAIC/AACAvwAAgL8AAIA/AACAvwAAgD8AAIA/AACAvwAAgD8AAIA/AACAvwAAgD8AAIA/AACAvwAAgL8AAIA/AACAvwAAgL8AAIA/AACAvwAAgL8u+WS/LvnkPgAAAIAAAAAAAACAvwAAAIAAAAAALvnkPi75ZD8u+WS/LvnkPgAAAIAAAAAALvnkPi75ZL8AAAAALvnkPi75ZD8u+WQ/LvnkPgAAAIAu+WS/LvnkPgAAAIAAAAAAAACAvwAAAIAAAAAALvnkPi75ZL8AAAAAAACAvwAAAIAAAAAALvnkPi75ZD8u+WQ/LvnkPgAAAIAAAAAAAACAvwAAAIAAAAAALvnkPi75ZL8u+WQ/LvnkPgAAAIAAAMA+AACAPwAAAD4AAIA+AADAPgAAAAAAACA/AABAPwAAID8AAAA/AAAgPwAAAAAAACA/AACAPgAAwD4AAEA/AAAAPgAAAD8AAMA+AABAPwAAwD4AAIA+AADAPgAAgD4AAMA+AACAPgAAwD4AAAA/AADAPgAAAD8AAMA+AAAAPwAAAwAHAAkABAAOAA8ABgAMAAsABQACAAgADQAKAAgACgABAPf/f7+xIdvAvv9/v/f/f7+xIdvAvv9/v/f/f7+xIdvAvv9/vwAAADXYkA3B5f96NgAAADXYkA3B5f96NgAAADXYkA3B5f96NgAAADXYkA3B5f96Nvf/f7+xIdvAIACAP/f/f7+xIdvAIACAP/f/f7+xIdvAIACAPwQAgD+xIdvAvv9/vwQAgD+xIdvAvv9/vwQAgD+xIdvAvv9/vwQAgD+xIdvAIACAPwQAgD+xIdvAIACAPwQAgD+xIdvAIACAPy35ZL8u+eS+AAAAgAAAAAAu+eS+LflkvwAAAAAAAIA/AAAAgC35ZL8u+eS+AAAAgAAAAAA0+eS+LPlkPwAAAAAu+eS+Lflkvy35ZD8v+eS+AAAAgC35ZL8u+eS+AAAAgAAAAAA0+eS+LPlkPwAAAAAAAIA/AAAAgAAAAAAu+eS+LflkvwAAAAAAAIA/AAAAgC35ZD8v+eS+AAAAgAAAAAA0+eS+LPlkPwAAAAAAAIA/AAAAgC35ZD8v+eS+AAAAgAAAwD4AAIA/AADAPgAAAAAAAAA+AACAPgAAID8AAEA/AAAgPwAAAD8AACA/AAAAAAAAID8AAIA+AADAPgAAQD8AAMA+AABAPwAAAD4AAAA/AADAPgAAgD4AAMA+AACAPgAAwD4AAIA+AADAPgAAAD8AAMA+AAAAPwAAwD4AAAA/AAADAAcACAAEAA0ADwAGAAwACgAFAAEACQAOAAsACQALAAIAG5QrvrYC7sDrv1I+G5QrvrYC7sDrv1I+G5QrvrYC7sDrv1I+G5QrvkDuGr/rv1I+G5QrvkDuGr/rv1I+G5QrvkDuGr/rv1I+G5QrvrYC7sDr9Ue+G5QrvrYC7sDr9Ue+G5QrvrYC7sDr9Ue+G5QrvkDuGr/r9Ue+G5QrvkDuGr/r9Ue+G5QrvkDuGr/r9Ue+uyFvPrYC7sDrv1I+uyFvPrYC7sDrv1I+uyFvPrYC7sDrv1I+uyFvPkDuGr/rv1I+uyFvPkDuGr/rv1I+uyFvPkDuGr/rv1I+uyFvPrYC7sDr9Ue+uyFvPrYC7sDr9Ue+uyFvPrYC7sDr9Ue+uyFvPkDuGr/r9Ue+uyFvPkDuGr/r9Ue+uyFvPkDuGr/r9Ue+//9/vwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAD//38///9/vwAAAAAAAACAAAAAAAAAAAD//38/AAAAAAAAgD8AAACA//9/vwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAD//3+///9/vwAAAAAAAACAAAAAAAAAAAD//3+/AAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAAAD//38///9/PwAAAAAAAACAAAAAAAAAAAD//38/AAAAAAAAgD8AAACA//9/PwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAD//3+///9/PwAAAAAAAACAAAAAAAAAAAD//3+/AAAAAAAAgD8AAACA//9/PwAAAAAAAACAAADAPgAAgD8AAAA+AACAPgAAwD4AAAAAAAAgPwAAgD8AACA/AAAAAAAAYD8AAIA+AADAPgAAQD8AAAA+AAAAPwAAwD4AAEA/AAAgPwAAQD8AACA/AABAPwAAYD8AAAA/AADAPgAAgD4AAMA+AACAPgAAwD4AAIA+AAAgPwAAgD4AACA/AACAPgAAID8AAIA+AADAPgAAAD8AAMA+AAAAPwAAwD4AAAA/AAAgPwAAAD8AACA/AAAAPwAAID8AAAA/AAADAAkAAAAJAAYACAAKABUACAAVABMAFAAXABEAFAARAA4ADQAPAAQADQAEAAIABwASAAwABwAMAAEAFgALAAUAFgAFABAA"}]}};var sat="#include <gl2_vert>\n\nattribute vec3 aPosition;\n\nuniform mat4 projViewMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform float pointSize;\n\n//fbo pickingvert\n\n#include <fbo_picking_vert>\n\n#include <get_output>\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    gl_Position = projViewMatrix * modelMatrix * localPositionMatrix * getPosition(aPosition);\n\n    //gl_Positiondepth\n\n    fbo_picking_setData(gl_Position.w, true);\n\n}\n\n";const aat=[0,1e5,0],hat=[0,0,0],lat=[-1,-1,0,1,-1,0,-1,1,0,1,1,0],uat=[3,1,0,0,2,3],cat=[.1,.1,.1],Aat=[],fat=[],dat=[],pat=[],gat=[],mat=[],yat=[],vat=[],_at=[0,-1,0],xat={lightAmbient:[1,1,1],lightDiffuse:[1,1,1],lightSpecular:[1,1,1],lightDirection:[1,1,1]},bat={4:[4,5],5:[4,5],7:[7,8],8:[7,8],9:[9,10,11],10:[9,10,11],11:[9,10,11]},wat=[6];class _{constructor(e,n,i,o,s){this.map=e,this.renderer=n,this.updateTRS(i,o,s),this.createPickHelper(),this.createHelperMeshes(),this.H(),this.registEvents(),this.mouseAction="moving",this.J=null,this.$=!0}registEvents(){const e=this.map;e.on("dom:mousemove",this.AA,this),e.on("dom:mousedown",this.tA,this),e.on("dom:mouseup",this.nA,this),e.on("zooming moving dragrotating",this.iA,this)}unregistEvents(){const e=this.map;e.off("dom:mousemove",this.AA,this),e.off("dom:mousedown",this.tA,this),e.off("dom:mouseup",this.nA,this),e.off("zooming moving dragrotating",this.iA,this)}AA(e){this.currentMousePosition={x:e.containerPoint.x,y:e.containerPoint.y};const n=this.getCntrollerMeshes();if(this.currentPickingObject=this.rA(this.currentMousePosition,n,"meshes"),"transform"===this.mouseAction){if("z-translate"===this.eA){const e=Lv(dat,n[9].localTransform);this.sA(!0,e,[this.uA[0]*Math.PI/180,this.uA[1]*Math.PI/180,this.uA[2]*Math.PI/180])}else if("y-rotate"===this.eA){const e=Lv(dat,n[4].localTransform);this.sA(!0,e,[90*Math.PI/180,0,-this.uA[2]])}else if("z-rotate"===this.eA){const e=Lv(dat,n[7].localTransform);this.sA(!0,e,[0,0,0])}}else this.sA(!1);this.oA(),this.hA(this.currentMousePosition)}oA(){this.fA(),this.currentPickingObject&&null!=this.currentPickingObject.meshId&&(this.lastPickingMeshId=this.currentPickingObject.pickingId,this.cA(this.currentPickingObject.pickingId,.6)),this.aA()}hA(e){if("transform"===this.mouseAction){const e=this.vA,n=this.rA(this.currentMousePosition,[e],"plane"),i=this.rA(this.lastMousePosition,[e],"plane");if(!n||null===n.meshId||!i||null===i.meshId)return;const o=[0,0,0];let s=0;if("z-translate"===this.eA){o[0]=n.point[0]-i.point[0],o[1]=n.point[1]-i.point[1],o[2]=n.point[2]-i.point[2];const e=this.lA(),s=f_(o,e),a=Yv(o)*Math.cos(s),h=Math.sign(a)*Math.sqrt(Math.pow(a,2)/(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2))),l=$v(pat,e[0]*h,e[1]*h,e[2]*h);this.wA(l)}else"y-rotate"!==this.eA&&"z-rotate"!==this.eA||(s=this.PA(n.point,i.point,this.eA),this.gA(s,this.eA))}this.lastMousePosition=e,this.lastPickingObject=this.currentPickingObject,this.lastPickingMeshId=this.currentPickingObject.meshId}PA(e,n,i){const o=this.CA;let s,a;"y-rotate"===i?(s=Zx(yat,n[0]-o[0],n[2]-o[2]),a=Zx(vat,e[0]-o[0],e[2]-o[2])):"z-rotate"===i&&(s=Zx(yat,n[0]-o[0],n[1]-o[1]),a=Zx(vat,e[0]-o[0],e[1]-o[1]));const h=Math.atan2(s[1],s[0]);return(Math.atan2(a[1],a[0])-h)/Math.PI*180}wA(e){t_(this.CA,this.CA,e),this.DA()}gA(e,n){"y-rotate"===n?this.uA[1]-=e:"z-rotate"===n&&(this.uA[2]+=e),this.DA()}DA(){const e=this.updateMatrix();Mv(e,e,cat);const n=this.getCntrollerMeshes();for(let i=0;i<n.length;i++){const o=n[i];let s=e;7!==i&&8!==i||(s=this.updateMatrixExcept(0),Mv(s,s,cat)),Cv(o.localTransform,s,o.nodeMatrix)}}aA(){this.renderer&&this.renderer.parentRenderer.setToRedraw()}tA(e){this.currentMousePosition={x:e.containerPoint.x,y:e.containerPoint.y};const n=this.getCntrollerMeshes();this.firstDownPoint=this.currentPickingObject=this.rA(this.currentMousePosition,n,"meshes"),this.currentPickingObject&&null!=this.currentPickingObject.meshId?(this.mouseAction="transform",this.IA(this.currentPickingObject.pickingId),this.map.config("zoomable",!1),this.map.config("draggable",!1),this.aA()):(this.mouseAction="pan",this.map.config("zoomable",!0),this.map.config("draggable",!0)),this.lastMousePosition=this.currentMousePosition,this.lastPickingObject=this.currentPickingObject,this.lastPickingMesh=n[this.currentPickingObject.meshId]}IA(e){bat[9].indexOf(e)>-1?this.eA="z-translate":bat[4].indexOf(e)>-1?this.eA="y-rotate":bat[7].indexOf(e)>-1&&(this.eA="z-rotate")}sA(e,n,i){const o=this.vA,s=n||o.originTranslation,a=Fv(fat,o.localTransform),h=Ax(Aat,0,0,0);zv(o.localTransform,h,s,a),e&&!this.bA()&&(Ev(o.localTransform,o.localTransform,i[2]),Sv(o.localTransform,o.localTransform,i[0]),Iv(o.localTransform,o.localTransform,i[1]))}bA(){if(this.map.getPitch())return!1;const e=this.map.cameraPosition,n=this.map.coordinateToPointAtRes(this.map.getCenter(),this.map.getGLRes());$v(n,n.x,n.y,0);const i=this.MA.getCoordinates(),o=this.map.coordinateToPointAtRes(i,this.map.getGLRes()),s=this.MA.getTranslation(),a=$v(dat,o.x,o.y,0),h=t_(a,a,s);return f_(e_(pat,e,h),e_(pat,e,n))<1/180*Math.PI}nA(){"transform"===this.mouseAction&&(this.firstDownPoint=null,this.$=!0),this.mouseAction="moving",this.eA=null,this.map.config("zoomable",!0),this.map.config("draggable",!0),this.aA()}iA(){this.$=!0}fA(){(function(e){return null==e})(this.lastPickingMeshId)||this.cA(this.lastPickingMeshId),this.map.resetCursor()}cA(e,n){const i=this.getCntrollerMeshes();if(wat.indexOf(e)<0){const o=bat[e];if(o)for(let e=0;e<o.length;e++){this.zA(i[o[e]],n)}else{this.zA(i[e],n)}}this.map.setCursor("pointer")}zA(e,n){const i=e.material.get("polygonFill");i[3]=n||e.originOpacity,e.material.set("polygonFill",i)}rA(e,n,i){const o=this.map;if(!(o&&this.G&&this.renderer&&this.renderer.canvas))return null;const s=o.getDevicePixelRatio(),a=e.x*s,h=e.y*s,l={projViewMatrix:this.map.projViewMatrix,pointSize:1};return!this.$&&this.dA&&this.dA===i||(this.G.render(n,l,!0),this.dA=i,this.$=!1),this.G.pick(a,h,10,l,{viewMatrix:this.map.viewMatrix,projMatrix:this.map.projMatrix,returnPoint:!0})}updateTRS(e,n,i){this.CA=Kv([],e),this.xA=Kv([],i),this.uA=Kv([],n)}updateMatrix(){const e=this.uA,n=this.CA,i=this.xA,o=nx(Aat);return ax(o,o,e[2]*Math.PI/180),ox(o,o,e[0]*Math.PI/180),sx(o,o,e[1]*Math.PI/180),zv(gat,o,n,i)}updateMatrixExcept(){const e=Kv([],this.uA);e[0]=0;const n=this.CA,i=this.xA,o=nx(Aat);return ax(o,o,e[2]*Math.PI/180),ox(o,o,e[0]*Math.PI/180),sx(o,o,e[1]*Math.PI/180),zv(mat,o,n,i)}lA(){const e=this.uA,n=xv([]);return Ev(n,n,e[2]*Math.PI/180),Sv(n,n,e[0]*Math.PI/180),Iv(n,n,e[1]*Math.PI/180),A_(pat,_at,n)}createPickHelper(){const e=new Lw({POSITION:lat},uat,0,{primitive:"triangles",positionAttribute:"POSITION"}),n=Yo.extend({},xat,{polygonFill:[0,0,0,.001]});this.vA=new bC(e,new dC(n)),this.vA.setUniform("uPickingId",12);const i=xv([]),o=Ax([],0,0,0);this.vA.originRotation=[0,0,0],zv(i,o,this.CA,[3,3,3]),this.vA.originTranslation=this.CA,this.vA.localTransform=i,this.vA.transparent=!0,this.vA.setDefines({HAS_HELPERPARTS:1,HAS_PICKING_ID:2})}createHelperMeshes(){this.mA=this.yA("helper"),this.pA=[],this.pA.push(...this.mA),this.pA.push(this.vA)}getPickHelperMesh(){return this.vA}getCntrollerMeshes(){return this.mA}getAllMeshes(){return this.pA.length<12&&this.pA.push(...this.mA),this.pA}createProjViewMatrix(){const e=this.updateMatrix(),n=A_([],hat,e),i=A_([],aat,e),o=Math.sqrt(Math.pow(i[0]-n[0],2)+Math.pow(i[1]-n[1],2)+Math.pow(i[2]-n[2],2));return Cv([],Gv([],-this.xA[0],this.xA[1],-this.xA[0],this.xA[1],1,o),Vv([],i,n,[0,0,1]))}yA(e){const n=[],i=function(e){return nM.loadGLTF("",oat[e]).then((e=>e))}(e),o=this.updateMatrix();return Mv(o,o,cat),i.then((e=>{nM.exportGLTFPack(e).getMeshesInfo().forEach(((e,i)=>{const s=e.materialInfo||{};s.polygonFill=6===i?[1,1,1,.1]:[1,1,1,1],Yo.extend(s,xat,s);const a=new dC(s),h=new bC(e.geometry,a);h.setUniform("uPickingId",i);const l=h.getDefines();if(l.HAS_HELPERPARTS=1,l.HAS_PICKING_ID=2,h.setDefines(l),h.nodeMatrix=e.nodeMatrix,h.originTransform=_v([],h.localTransform),7===i||8===i){const e=this.updateMatrixExcept(0);Mv(e,e,cat),Cv(h.localTransform,e,h.nodeMatrix)}else Cv(h.localTransform,o,h.nodeMatrix);h.originOpacity=6===i?.1:1,h.transparent=!0,n.push(h)}))})),n}H(){this.pickingFBO=this.renderer.regl.framebuffer(this.renderer.canvas.width,this.renderer.canvas.height),this.G=new XM(this.renderer,{vert:sat,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(e,n){return Cv([],n.projViewMatrix,n.modelMatrix)}}]},this.pickingFBO,this.map)}LA(){this.unregistEvents(),this.dispose()}dispose(){this.getAllMeshes().forEach((e=>{e.geometry.dispose(),e.dispose()})),this.pickingFBO&&this.pickingFBO.destroy()}resize(e,n){this.pickingFBO.width===e&&this.pickingFBO.height===n||this.pickingFBO.resize(e,n)}}class K extends eP{constructor(e={}){const n=[],i=[],o=e.uniforms,s=[{name:"modelNormalMatrix",type:"function",fn:function(e,i){return uv(n,i.modelMatrix)}},{name:"modelViewMatrix",type:"function",fn:function(e,n){return Cv(i,n.viewMatrix,n.modelMatrix)}}];o&&s.push(...o),super({vert:"#include <gl2_vert>\n\nattribute vec3 aPosition;\n\n#include <line_extrusion_vert>\n\n\n\n#ifdef HAS_MAP\n\n    uniform vec2 uvScale;\n\n    uniform vec2 uvOffset;\n\n    attribute vec2 aTexCoord;\n\n    varying vec2 vTexCoord;\n\n#endif\n\n#if defined(HAS_COLOR)\n\n    attribute vec4 aColor;\n\n    varying vec4 vColor;\n\n#elif defined(HAS_COLOR0)\n\n    attribute vec4 aColor0;\n\n    varying vec4 vColor;\n\n#endif\n\n\n\nvarying vec3 vFragPos;\n\nvarying vec3 vNormal;\n\n\n\nuniform mat4 projMatrix;\n\nuniform mat4 modelViewMatrix;\n\nuniform mat3 modelNormalMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform vec2 halton;\n\nuniform vec2 outSize;\n\n\n\nuniform mat4 projViewMatrix;\n\n\n\n#include <get_output>\n\n#include <heatmap_render_vert>\n\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n\n    #include <vsm_shadow_vert>\n\n#endif\n\n\n\n#ifdef HAS_EXTRUSION_OPACITY\n\n    attribute float aExtrusionOpacity;\n\n    varying float vExtrusionOpacity;\n\n#endif\n\n\n\n#if defined(HAS_TANGENT)\n\n    varying vec4 vTangent;\n\n#endif\n\n\n\nuniform mat4 cut_projViewMatrixFromViewpoint;\n\nvarying vec4 cut_positionFromViewpoint;\n\n\n\n\n\nvoid toTangentFrame(const highp vec4 q, out highp vec3 n) {\n\n    n = vec3( 0.0,  0.0,  1.0) +\n\n        vec3( 2.0, -2.0, -2.0) * q.x * q.zwx +\n\n        vec3( 2.0,  2.0, -2.0) * q.y * q.wzy;\n\n}\n\n\n\n\n\nvoid toTangentFrame(const highp vec4 q, out highp vec3 n, out highp vec3 t) {\n\n    toTangentFrame(q, n);\n\n    t = vec3( 1.0,  0.0,  0.0) +\n\n        vec3(-2.0,  2.0, -2.0) * q.y * q.yxw +\n\n        vec3(-2.0,  2.0,  2.0) * q.z * q.zwx;\n\n}\n\n\n\n\n\nvoid main()\n\n{\n\n    #ifdef IS_LINE_EXTRUSION\n\n        vec4 localPosition = getPosition(getLineExtrudePosition(aPosition));\n\n    #else\n\n        vec4 localPosition = getPosition(aPosition);\n\n    #endif\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n\n\n    vFragPos = vec3(modelMatrix * localPositionMatrix * localPosition);\n\n\n\n    #if defined(HAS_NORMAL) || defined(HAS_TANGENT)\n\n        mat3 localNormalMatrix = modelNormalMatrix * mat3(localPositionMatrix);\n\n        vec3 Normal;\n\n        #if defined(HAS_TANGENT)\n\n            vec3 t;\n\n            toTangentFrame(aTangent, Normal, t);\n\n            vTangent = vec4(localNormalMatrix * t, aTangent.w);\n\n        #else\n\n            #ifdef HAS_DECODE_NORMAL\n\n                Normal = getNormal(aNormal);\n\n            #else\n\n                Normal = aNormal;\n\n            #endif\n\n        #endif\n\n        vec3 localNormal = appendMorphNormal(Normal);\n\n        vNormal = normalize(localNormalMatrix * localNormal);\n\n    #else\n\n        vNormal = vec3(0.0);\n\n    #endif\n\n\n\n    mat4 jitteredProjection = projMatrix;\n\n    jitteredProjection[2].xy += halton.xy / outSize.xy;\n\n    gl_Position = jitteredProjection * modelViewMatrix * localPositionMatrix * localPosition;\n\n    #ifdef HAS_MAP\n\n        vec2 TexCoord = decode_getTexcoord(aTexCoord);\n\n        vTexCoord = TexCoord * uvScale + uvOffset;\n\n    #endif\n\n    #ifdef HAS_EXTRUSION_OPACITY\n\n        vExtrusionOpacity = aExtrusionOpacity;\n\n    #endif\n\n    #if defined(HAS_COLOR)\n\n        vColor = aColor / 255.0;\n\n    #elif defined(HAS_COLOR0)\n\n        vColor = aColor0 / 255.0;\n\n    #endif\n\n    cut_positionFromViewpoint = cut_projViewMatrixFromViewpoint * modelMatrix * localPositionMatrix * localPosition;\n\n}\n\n",frag:"precision mediump float;\n\n#include <gl2_frag>\n\n\n\nuniform vec4 baseColorFactor;\n\nuniform float materialShininess;///\n\nuniform float opacity;\n\nuniform float environmentExposure;\n\nuniform float specularStrength;\n\n\n\nuniform vec3 light0_viewDirection;\n\nuniform vec3 ambientColor;\n\nuniform vec4 light0_diffuse;\n\nuniform vec3 lightSpecular;\n\nuniform vec3 cameraPosition;\n\n\n\n#ifdef HAS_TANGENT\n\n    varying vec4 vTangent;\n\n#endif\n\n\n\n#ifdef HAS_MAP\n\n    varying vec2 vTexCoord;\n\n#endif\n\nvarying vec3 vNormal;\n\nvarying vec3 vFragPos;\n\n\n\n#ifdef HAS_INSTANCE_COLOR\n\n    varying vec4 vInstanceColor;\n\n#endif\n\n\n\n#ifdef HAS_BASECOLOR_MAP\n\n    uniform sampler2D baseColorTexture;\n\n#endif\n\n\n\n#ifdef HAS_EXTRUSION_OPACITY\n\n    uniform vec2 extrusionOpacityRange;\n\n    varying float vExtrusionOpacity;\n\n#endif\n\n\n\n#if defined(HAS_COLOR) || defined(HAS_COLOR0)\n\n    varying vec4 vColor;\n\n#elif defined(IS_LINE_EXTRUSION)\n\n    uniform vec4 lineColor;\n\n#else\n\n    uniform vec4 polygonFill;\n\n#endif\n\n\n\n#ifdef IS_LINE_EXTRUSION\n\n    uniform float lineOpacity;\n\n#else\n\n    uniform float polygonOpacity;\n\n#endif\n\n\n\n#ifdef HAS_OCCLUSION_MAP\n\n    uniform sampler2D occlusionTexture;\n\n#endif\n\n\n\n#ifdef HAS_NORMAL_MAP\n\n    uniform sampler2D normalTexture;\n\n#endif\n\n\n\n#ifdef HAS_EMISSIVE_MAP\n\n    uniform sampler2D emissiveTexture;\n\n#endif\n\n\n\n#ifdef SHADING_MODEL_SPECULAR_GLOSSINESS\n\n    uniform vec4 diffuseFactor;\n\n    uniform vec3 specularFactor;\n\n    #ifdef HAS_DIFFUSE_MAP\n\n        uniform sampler2D diffuseTexture;\n\n    #endif\n\n    #ifdef HAS_SPECULARGLOSSINESS_MAP\n\n        uniform sampler2D specularGlossinessTexture;\n\n    #endif\n\n#endif\n\n#include <heatmap_render_frag>\n\n\n\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n\n  #include <vsm_shadow_frag>\n\n#endif\n\nvarying vec4 cut_positionFromViewpoint;\n\n\n\nvec3 transformNormal() {\n\n    #if defined(HAS_NORMAL_MAP)\n\n        vec3 n = normalize(vNormal);\n\n        vec3 normal = texture2D(normalTexture, vTexCoord).xyz * 2.0 - 1.0;\n\n        #if defined(HAS_TANGENT)\n\n            vec3 t = normalize(vTangent.xyz);\n\n            vec3 b = normalize(cross(n, t) * sign(vTangent.w));\n\n            mat3 tbn = mat3(t, b, n);\n\n            return normalize(tbn * normal);\n\n        #else\n\n            return normalize(normal);\n\n        #endif\n\n    #else\n\n        return normalize(vNormal);\n\n    #endif\n\n}\n\n\n\nvec4 linearTosRGB(const in vec4 color) {\n\n    return vec4( color.r < 0.0031308 ? color.r * 12.92 : 1.055 * pow(color.r, 1.0/2.4) - 0.055, color.g < 0.0031308 ? color.g * 12.92 : 1.055 * pow(color.g, 1.0/2.4) - 0.055, color.b < 0.0031308 ? color.b * 12.92 : 1.055 * pow(color.b, 1.0/2.4) - 0.055, color.a);\n\n}\n\n\n\nvec4 getBaseColor() {\n\n    #if defined(HAS_BASECOLOR_MAP)\n\n        return texture2D(baseColorTexture, vTexCoord);\n\n    #elif defined(HAS_DIFFUSE_MAP)\n\n        return texture2D(diffuseTexture, vTexCoord);\n\n    #elif defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\n\n        return diffuseFactor;\n\n    #else\n\n        return baseColorFactor;\n\n    #endif\n\n}\n\n\n\nvec3 getSpecularColor() {\n\n    #if defined(HAS_SPECULARGLOSSINESS_MAP)\n\n        return texture2D(specularGlossinessTexture, vTexCoord).rgb;\n\n    #elif defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\n\n        return specularFactor;\n\n    #else\n\n        return vec3(1.0);\n\n    #endif\n\n}\n\n\n\nvoid main() {\n\n    //\n\n    vec4 baseColor = getBaseColor();\n\n    vec3 ambient = environmentExposure * ambientColor * baseColor.rgb;\n\n\n\n    #ifdef HAS_INSTANCE_COLOR\n\n        ambient *= vInstanceColor.rgb;\n\n    #endif\n\n\n\n    //\n\n    vec3 norm = transformNormal();\n\n    vec3 lightDir = normalize(-light0_viewDirection);\n\n    float diff = max(dot(norm, lightDir), 0.0);\n\n    vec3 diffuse = light0_diffuse.rgb * diff * baseColor.rgb;\n\n    #if defined(HAS_COLOR) || defined(HAS_COLOR0)\n\n        vec3 color = vColor.rgb;\n\n    #elif defined(IS_LINE_EXTRUSION)\n\n        vec3 color = lineColor.rgb;\n\n    #else\n\n        vec3 color = polygonFill.rgb;\n\n    #endif\n\n    #ifdef HAS_INSTANCE_COLOR\n\n        color *= vInstanceColor.rgb;\n\n    #endif\n\n    ambient *= color.rgb;\n\n    diffuse *= color.rgb;\n\n\n\n    //\n\n    vec3 viewDir = normalize(cameraPosition - vFragPos);\n\n    vec3 halfwayDir = normalize(lightDir + viewDir);\n\n    float spec = pow(max(dot(norm, halfwayDir), 0.0), materialShininess);\n\n    vec3 specular = specularStrength * lightSpecular * spec * getSpecularColor();\n\n    #ifdef HAS_OCCLUSION_MAP\n\n        float ao = texture2D(occlusionTexture, vTexCoord).r;\n\n        ambient *= ao;\n\n    #endif\n\n    #if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n\n        float shadowCoeff = shadow_computeShadow();\n\n        diffuse = shadow_blend(diffuse, shadowCoeff).rgb;\n\n        specular = shadow_blend(specular, shadowCoeff).rgb;\n\n    #endif\n\n    vec3 result = ambient + diffuse + specular;\n\n\n\n    #ifdef HAS_EMISSIVE_MAP\n\n        vec3 emit = texture2D(emissiveTexture, vTexCoord).rgb;\n\n        result += emit;\n\n    #endif\n\n    vec3 shadowCoord = (cut_positionFromViewpoint.xyz / cut_positionFromViewpoint.w)/2.0 + 0.5;\n\n    if (shadowCoord.x > 0.0 && shadowCoord.x < 1.0 && shadowCoord.y > 0.0 && shadowCoord.y < 1.0 && shadowCoord.z < 1.0) {\n\n        discard;\n\n    }\n\n    glFragColor = vec4(result, opacity);\n\n    // glFragColor = linearTosRGB(glFragColor);\n\n    #if defined(HAS_COLOR) || defined(HAS_COLOR0)\n\n        float colorAlpha = vColor.a;\n\n    #elif defined(IS_LINE_EXTRUSION)\n\n        float colorAlpha = lineColor.a;\n\n    #else\n\n        float colorAlpha = polygonFill.a;\n\n    #endif\n\n        glFragColor *= colorAlpha;\n\n    #ifdef HAS_EXTRUSION_OPACITY\n\n        float topAlpha = extrusionOpacityRange.x;\n\n        float bottomAlpha = extrusionOpacityRange.y;\n\n        float alpha = topAlpha + vExtrusionOpacity * (bottomAlpha - topAlpha);\n\n        alpha = clamp(alpha, 0.0, 1.0);\n\n        glFragColor *= alpha;\n\n    #endif\n\n\n\n    #if __VERSION__ == 100\n\n        gl_FragColor = glFragColor;\n\n    #endif\n\n}\n\n",uniforms:s,defines:e.defines||{},extraCommandProps:e.extraCommandProps||{}}),this.version=300}}const Cat=[0,0,0,1],Pat={lightAmbient:[1,1,1],lightDiffuse:[1,1,1],lightSpecular:[1,1,1],lightDirection:[1,1,1]};class Z extends D{u(){this.TA=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this.OA=new eP({vert:iat,frag:rat,uniforms:[{name:"projViewModelMatrix",type:"function",fn:(e,n)=>Cv([],n.projViewMatrix,n.modelMatrix)}],extraCommandProps:{viewport:this.i}}),this.FA=new eP({vert:iat,frag:rat,uniforms:[{name:"projViewModelMatrix",type:"function",fn:(e,n)=>Cv([],n.projViewMatrix,n.modelMatrix)}],extraCommandProps:{viewport:this.i,depth:{enable:!0,func:"always",mask:!1,range:[0,0]}}}),this.UA=new K({extraCommandProps:{viewport:this.i,blend:{enable:(e,n)=>!!n.meshConfig.transparent,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"},equation:"add"}}}),this.EA=new K({extraCommandProps:{viewport:this.i,blend:{enable:(e,n)=>!!n.meshConfig.transparent,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"},equation:"add"},depth:{enable:!0,func:"always",mask:!1,range:[0,0]}}}),this.T=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this.NA=new kC,this.jA=new kC,this.F=new kC}QA(e,n,i,o){this.controller=new _(e,this.renderer,n,i,o)}SA(e,n,i){this.controller&&(this.controller.updateTRS(e,n,i),this.controller.DA(),this.controller.aA())}render(e,n){this.U(),this.renderer.clear({color:Cat,depth:1,framebuffer:this.T});const i=this.BA(e),o=this.controller.getAllMeshes(),s=this.controller.createProjViewMatrix();return this.kA(i,o,s,n.map),this.RA(i,o,s,n.map),{meshesMap:this.TA,invisibleMap:this.T}}BA(e){const n=[];for(let i=0;i<e.length;i++){const o=Yo.extend({},e[i].material.uniforms,Pat),s=new dC(o),a=new bC(e[i].geometry,s),h=a.getDefines();h.HAS_CUT=1,a.setDefines(h),a.localTransform=e[i].localTransform,n.push(a)}return n}RA(e,n,i,o){this.renderer.clear({color:[0,0,0,0],depth:1,framebuffer:this.T});const s={cut_projViewMatrixFromViewpoint:i,projViewMatrix:o.projViewMatrix};this.F.setMeshes(e),this.renderer.render(this.OA,s,this.F,this.T),this.F.setMeshes(n),this.renderer.render(this.FA,s,this.F,this.T)}kA(e,n,i,o){this.renderer.clear({color:[0,0,0,0],depth:1,framebuffer:this.TA});const s=Yo.isFunction(this.i.width.data)?this.i.width.data():this.i.width,a=Yo.isFunction(this.i.height.data)?this.i.height.data():this.i.height,h={projMatrix:o.projMatrix,cut_projViewMatrixFromViewpoint:i,projViewMatrix:o.projViewMatrix,viewMatrix:o.viewMatrix,cameraPosition:o.cameraPosition,altitudeScale:1,outSize:[s,a],halton:[.2107,-.0202],polygonFill:[1,1,1,1],polygonOpacity:1};!function(e,n,i,o){const{iblTexes:s,dfgLUT:a}=DT.PBRUtils.getIBLResOnCanvas(n);if(i&&i.getLights()){const n=DT.PBRUtils.getPBRUniforms(i,s,a,o,o),h=i.getLights();e.ambientColor=h.ambient&&h.ambient.color?h.ambient.color:[1,1,1],n&&Yo.extend(e,n)}else{const n=DT.PBRUtils.getPBRUniforms(i,null,a,o,o);Yo.extend(e,n)}}(h,this.renderer.canvas,o),this.NA.setMeshes(e),this.renderer.render(this.UA,h,this.NA,this.TA),this.jA.setMeshes(n),this.renderer.render(this.EA,h,this.jA,this.TA)}dispose(){this.T&&this.T.destroy(),this.C&&this.C.dispose(),this.GA&&this.GA.dispose(),this.controller&&this.controller.LA()}U(){const e=Yo.isFunction(this.i.width.data)?this.i.width.data():this.i.width,n=Yo.isFunction(this.i.height.data)?this.i.height.data():this.i.height;!this.T||this.T.width===e&&this.T.height===n||this.T.resize(e,n),!this.TA||this.TA.width===e&&this.TA.height===n||this.TA.resize(e,n),this.controller&&this.controller.resize(e,n)}}const Mat=[0,0,0,1,1,-1,1,-1,-1,1,-1,1,1,1,1,1,0,0],Tat=[0,1,0,2,0,3,0,4,1,2,2,3,3,4,4,1,0,5],Sat=[],Iat=nx([]),Eat=nx([]),Oat=[],Rat=[1,0,0],Dat=[],kat=[],Lat=[],Fat=new ee(0,0),Nat=[0,0,0,1];let zat=.01;class aA extends D{u(){super.u(),this.qA=new eP({vert:"attribute vec3 aPosition;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform mat4 projViewModelMatrix;\n\nuniform mat4 viewshed_projViewMatrixFromViewpoint;\n\nvarying vec4 viewshed_positionFromViewpoint;\n\n#include <get_output>\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    vec4 localPosition = localPositionMatrix * getPosition(aPosition);\n\n    viewshed_positionFromViewpoint = viewshed_projViewMatrixFromViewpoint * modelMatrix * localPosition;\n\n    gl_PointSize = 1.0;\n\n    gl_Position = projViewModelMatrix * localPosition;\n\n}\n\n",frag:"#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\nvarying vec4 viewshed_positionFromViewpoint;\n\nuniform sampler2D depthMap;\n\nuniform float near;\n\nuniform float far;\n\n#ifdef HAS_HELPERLINE\n\n  uniform vec3 lineColor;\n\n#endif\n\n\n\nconst float UnpackDownscale = 255. / 256.;\n\nconst vec3 PackFactors = vec3(256. * 256. * 256., 256. * 256., 256.);\n\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1.);\n\nfloat unpackRGBAToDepth(const in vec4 v) {\n\n    return dot(v, UnpackFactors);\n\n}\n\n\n\nfloat linear(float value) {\n\n    float z = value * 2.0 - 1.0;\n\n    return (2.0 * near * far) / (far + near - z * (far - near));\n\n}\n\n\n\nvoid main() {\n\n    #ifdef HAS_HELPERLINE\n\n        gl_FragColor = vec4(lineColor, 0.009);\n\n    #else\n\n        vec3 shadowCoord = (viewshed_positionFromViewpoint.xyz / viewshed_positionFromViewpoint.w)/2.0 + 0.5;\n\n        vec4 rgbaDepth = texture2D(depthMap, shadowCoord.xy);\n\n        float depth = unpackRGBAToDepth(rgbaDepth);\n\n        float linearZ = linear(shadowCoord.z);\n\n        float linearDepth = linear(depth);\n\n        if (shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0 && linearZ >= near && linearZ <= far - near) {\n\n            if (linearZ / far <= linearDepth / (far - near)) {\n\n                gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);//\n\n            } else {\n\n                gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);//\n\n            }\n\n        } else {\n\n            gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);\n\n        }\n\n    #endif\n\n}\n\n\n\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(e,n)=>Cv([],n.projViewMatrix,n.modelMatrix)}],extraCommandProps:{viewport:this.i}}),this.T=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0});const e=new Lw({POSITION:Mat},Tat,0,{primitive:"lines",positionAttribute:"POSITION"});this.VA=new bC(e,new cC({lineColor:[.8,.8,.1]}));const n=this.VA.getDefines();n.HAS_HELPERLINE=1,this.VA.setDefines(n),this.F=new kC}render(e,n){const{eyePos:i,lookPoint:o,horizontalAngle:s,verticalAngle:a}=n;if(!this.m(s,a)||!i||!o)return this.T;this.C||this.D(s,a),this.U(s,a),this.renderer.clear({color:Nat,depth:1,framebuffer:this.T}),this.VA.localTransform=this.WA(i,o,s,a),e.push(this.VA),this.F.setMeshes(e);const{projViewMatrixFromViewpoint:h,far:l}=this._A(i,o,a,s);return this.l(this.F,h,l),this.KA(this.F,h,n.projViewMatrix,l),this.T}WA(e,n,i,o){const s=Math.sqrt(Math.pow(e[0]-n[0],2)+Math.pow(e[1]-n[1],2)+Math.pow(e[2]-n[2],2));s<=0&&console.warn("both lookpoint and eyePos are in the same position");const a=xv(Sat),h=$v(Oat,n[0]-e[0],n[1]-e[1],n[2]-e[2]),l=i*Math.PI/360,c=o*Math.PI/360;let A=f_(Rat,$v(Dat,h[0],h[1],0));A=h[1]>=0?A:2*Math.PI-A;const f=ax(Iat,Eat,A);let d=f_($v(kat,h[0],h[1],0),h);return d=h[0]>=0?-d:2*Math.PI-d,sx(f,f,d),zv(a,f,e,[s,s*Math.tan(l),s*Math.tan(c)]),a}HA(e){const n=this.VA.localTransform,i=[],o=e.getGLRes();for(let s=1;s<(Mat.length-3)/3;s++){Lat[0]=Mat[3*s],Lat[1]=Mat[3*s+1],Lat[2]=Mat[3*s+2];const a=A_([],Lat,n);Fat.set(a[0],a[1]);const h=e.pointAtResToCoord(Fat,o),l=e.pointAtResToAltitude(a[2],o);h.z=l,i.push(h)}return i}KA(e,n,i,o){this.renderer.render(this.qA,{viewshed_projViewMatrixFromViewpoint:n,projViewMatrix:i,near:zat,far:o,depthMap:this.h,minAltitude:0},e,this.T)}_A(e,n,i,o){const s=i/o,a=Math.sqrt(Math.pow(e[0]-n[0],2)+Math.pow(e[1]-n[1],2)+Math.pow(e[2]-n[2],2));zat=a/100;return{projViewMatrixFromViewpoint:Cv([],jv([],o*Math.PI/180,s,zat,a),Vv([],e,n,[0,1,0])),far:a}}dispose(){super.dispose(),this.T&&this.T.destroy(),this.qA&&this.qA.dispose(),this.VA&&(this.VA.geometry.dispose(),this.VA.dispose())}U(e,n){const i=Yo.isFunction(this.i.width.data)?this.i.width.data():this.i.width,o=Yo.isFunction(this.i.height.data)?this.i.height.data():this.i.height;if(!this.T||this.T.width===i&&this.T.height===o||this.T.resize(i,o),this.h&&this.h.width/this.h.height!=e/n){const i=this.I(e,n);i&&this.h.resize(i.width,i.height)}}}class lA extends D{render(e,{projViewMatrix:n,lineColor:i,lineWidth:o}){return e&&e.length?(this.JA(),this.U(),this.F.setMeshes(e),this.ZA(this.F,n),this.XA(i,o,this.T),this.T):null}u(){this.fboExtent=this.$A();const e=this.i;this.extentShader=new eP({vert:"attribute vec3 aPosition;\n\nuniform mat4 projViewMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\n#include <get_output>  \n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    gl_Position = projViewMatrix * modelMatrix * localPositionMatrix * getPosition(aPosition);\n\n}",frag:"precision highp float;\n\nvoid main() {\n\n    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\n}",extraCommandProps:{viewport:e,cull:{enable:!1}}}),this.outlineShader=new sP({vert:"#if __VERSION__ == 300\n\n\t#define attribute in\n\n\t#define varying out\n\n#endif\n\n\n\nattribute vec2 aPosition;\n\nattribute vec2 aTexCoord;\n\n\n\nvarying vec2 vTexCoord;\n\n\n\nvoid main()\n\n{\n\n  gl_Position = vec4(aPosition, 0., 1.);\n\n  vTexCoord = aTexCoord;\n\n}\n\n",frag:"precision highp float;\n\nprecision highp int;\n\n\n\nvarying vec2 vTexCoord;\n\nuniform sampler2D maskTexture;\n\nuniform vec2 texSize;\n\nuniform vec3 visibleEdgeColor;\n\nuniform float lineWidth;\n\nvoid main() {\n\n    vec2 invSize = (1.0 / texSize) * lineWidth;\n\n    vec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize.x, invSize.y, invSize.x, invSize.y);\n\n    vec4 c1 = texture2D(maskTexture, vTexCoord + uvOffset.xy);\n\n    vec4 c2 = texture2D(maskTexture, vTexCoord - uvOffset.xy);\n\n    vec4 c3 = texture2D(maskTexture, vTexCoord + uvOffset.yw);\n\n    vec4 c4 = texture2D(maskTexture, vTexCoord - uvOffset.yw);\n\n    float diff1 = (c1.r - c2.r)*0.7;\n\n    float diff2 = (c3.r - c4.r)*0.7;\n\n    float d = length(vec2(diff1, diff2) );\n\n    float a1 = min(c1.g, c2.g);\n\n    float a2 = min(c3.g, c4.g);\n\n    float visibilityFactor = min(a1, a2);\n\n    gl_FragColor = 1.0 - visibilityFactor > 0.001 ? vec4(visibleEdgeColor, 1.0) * vec4(d) : vec4(0.0);\n\n}",extraCommandProps:{viewport:e,depth:{enable:!0,mask:!1,func:"always"},blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"}}}),this.T=this.regl.framebuffer({color:this.regl.texture({width:e.width(),height:e.height(),wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this.F=new kC}ZA(e,n){this.renderer.render(this.extentShader,{projViewMatrix:n,minAltitude:0},e,this.fboExtent)}XA(e,n,i){this.renderer.render(this.outlineShader,{texSize:[i.width,i.height],visibleEdgeColor:e||[1,0,0],maskTexture:this.fboExtent,lineWidth:n||1,minAltitude:0},null,i)}$A(){return this.regl.framebuffer({color:this.regl.texture({width:2,height:2,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0})}getRenderMeshes(){return this.F.getMeshes()}JA(){this.regl.clear({color:[1,1,1,1],depth:1,framebuffer:this.fboExtent})}dispose(){this.fboExtent&&(this.fboExtent.destroy(),this.extentShader.dispose(),this.outlineShader.dispose(),delete this.fboExtent),this.T&&(this.T.destroy(),delete this.T)}U(){const e=Yo.isFunction(this.i.width.data)?this.i.width.data():this.i.width,n=Yo.isFunction(this.i.height.data)?this.i.height.data():this.i.height;this.T.width===e&&this.fboExtent.height===n||this.T.resize(e,n),this.fboExtent.width===e&&this.fboExtent.height===n||this.fboExtent.resize(e,n)}}const Bat="undefined"==typeof document?null:document.createElement("canvas");class gA extends D{u(){this.O=new eP({vert:"attribute vec3 aPosition;\n\nuniform mat4 projViewMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\n#include <get_output>\n\nvarying float flood_height;\n\nvarying vec4 vWorldPosition;\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    vec4 worldPosition = modelMatrix * localPositionMatrix * getPosition(aPosition);\n\n    vWorldPosition = worldPosition;\n\n    gl_Position = projViewMatrix * worldPosition;\n\n    flood_height = worldPosition.z;\n\n}\n\n",frag:"#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\nuniform vec4 extent;\n\nuniform float waterHeight;\n\nuniform sampler2D extentMap;\n\nuniform float hasExtent;\n\nuniform float type;\n\nvarying float flood_height;\n\nvarying vec4 vWorldPosition;\n\nvoid main() {\n\n    float width = extent.z - extent.x;\n\n    float height = extent.y - extent.w;\n\n    vec2 uvInExtent = vec2((vWorldPosition.x - extent.x) / width, 1.0 - (vWorldPosition.y - extent.w) / height);\n\n    vec4 extentColor = texture2D(extentMap, uvInExtent);\n\n    bool compare = type == 1.0 ? flood_height < waterHeight : flood_height >= waterHeight;\n\n    if (compare) {\n\n        if (hasExtent == 1.0) {\n\n            if (extentColor.r > 0.0) {\n\n                gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n\n            } else {\n\n                gl_FragColor = vec4(0.0);\n\n            }\n\n        } else {\n\n            gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n\n        }\n\n    } else {\n\n        gl_FragColor = vec4(0.0);\n\n    }\n\n}\n\n",extraCommandProps:{viewport:this.i}}),this.T=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0})}render(e,n){this.U(),this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this.T});const i=new kC(e);return this.it(i,n),this.T}it(e,n){this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this.T}),this.renderer.render(this.O,n,e,this.T)}dispose(){this.T&&this.T.destroy(),this.O&&this.O.dispose()}U(){const e=Yo.isFunction(this.i.width.data)?this.i.width.data():this.i.width,n=Yo.isFunction(this.i.height.data)?this.i.height.data():this.i.height;!this.T||this.T.width===e&&this.T.height===n||this.T.resize(e,n)}}const Hat=[.1451,.2588,.4863],jat=[0,0,0,0];class IA extends x{constructor(e){super(e),this.type="floodAnalysis"}YA(e){const n=this.layer.getMap();if(this.q={},this.q.waterHeight=tat(n,this.options.waterHeight),this.q.waterOpacity=this.options.waterOpacity,this.q.waterColor=this.options.waterColor,this.q.extent=jat,this.q.extentMap=e.regl.texture({width:2,height:2}),this.q.hasExtent=0,this.q.type=1,this.options.boundary){const{extentMap:e,extentInWorld:n}=this.V(this.options.boundary);this.q.extent=n,this.q.extentMap=e,this.q.hasExtent=1}this.q.projViewMatrix=n.projViewMatrix,this.q.minAltitude=0}S(e){const n=this.i={x:0,y:0,width:()=>e.canvas?e.canvas.width:1,height:()=>e.canvas?e.canvas.height:1};this.YA(e);const i=new PC(e.regl);this.B=this.B||new gA(i,n),this.layer.addAnalysis(this)}update(e,n){if("boundary"===e){const{extentMap:e,extentInWorld:i,extentPolygon:o}=this.V(n);this.q.extent=i,this.q.extentPolygon=o,this.q.extentMap=e}else if("waterHeight"===e){const e=this.layer.getMap();this.q.waterHeight=e.altitudeToPoint(n||0,e.getGLRes())}else this.q[e]=n;super.update(e,n)}renderAnalysis(e){const n={};return this.options.boundary&&this.k.render(this.R,this._),n.flood_waterColor=this.q.waterColor||Hat,n.flood_waterOpacity=this.q.waterOpacity||.6,n.floodMap=this.B.render(e,this.q),n}getDefines(){return{HAS_FLOODANALYSE:1}}}const Uat=[0,0,0,1,0,0],Gat=[0,1],Vat=[],Wat=[0,0,0,1];class xA extends D{u(){super.u(),this.rt=new eP({vert:"attribute vec3 aPosition;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform mat4 projViewModelMatrix;\n\nuniform mat4 insight_projViewMatrixFromViewpoint;\n\nvarying vec4 insight_positionFromViewpoint;\n\n#include <get_output>\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    vec4 localPosition = localPositionMatrix * getPosition(aPosition);\n\n    gl_Position = projViewModelMatrix * localPosition;\n\n    insight_positionFromViewpoint = insight_projViewMatrixFromViewpoint * modelMatrix * localPosition;\n\n}\n\n",frag:"#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\nvarying vec4 insight_positionFromViewpoint;\n\nuniform sampler2D depthMap;\n\n\n\nconst float UnpackDownscale = 255. / 256.;\n\nconst vec3 PackFactors = vec3(256. * 256. * 256., 256. * 256., 256.);\n\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1.);\n\nfloat unpackRGBAToDepth(const in vec4 v) {\n\n    return dot(v, UnpackFactors);\n\n}\n\n\n\nvoid main() {\n\n    vec3 shadowCoord = (insight_positionFromViewpoint.xyz / insight_positionFromViewpoint.w)/2.0 + 0.5;\n\n    vec4 rgbaDepth = texture2D(depthMap, shadowCoord.xy);\n\n    float depth = unpackRGBAToDepth(rgbaDepth); // Retrieve the z-value from R\n\n    if (shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0 && shadowCoord.z <= 1.0) {\n\n        if (depth <0.001) {\n\n            gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);//,green\n\n        } else {\n\n            if (shadowCoord.z <= depth + 0.002) {\n\n                gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);//,green\n\n            } else {\n\n                gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);//,red\n\n            }\n\n        }\n\n    } else {\n\n        gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);//,blue\n\n    }\n\n}\n\n\n\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(e,n)=>Cv([],n.projViewMatrix,n.modelMatrix)}],extraCommandProps:{viewport:this.i}}),this.T=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0});const e=new Lw({POSITION:Uat},Gat,0,{primitive:"lines",positionAttribute:"POSITION"});this.et=e,this.VA=new bC(e,new cC({lineColor:[.8,.8,.1]})),this.F=new kC}render(e,n){const{lines:i,horizontalAngle:o,verticalAngle:s}=n;this.C||this.D(o,s),this.U(o,s),this.renderer.clear({color:Wat,depth:1,framebuffer:this.T});const a=xv(Vat);this.VA.localTransform=a;for(let a=0;a<i.length;a++){const{from:h,to:l}=i[a];if(!this.m(o,s)||!h||!l)continue;const{projViewMatrixFromViewpoint:c,far:A}=this._A(h,l,o,s);this.F.setMeshes(e),this.l(this.F,c,A),this.st(h,l),this.F.setMeshes(this.VA),this.ut(this.F,c,n.projViewMatrix)}return this.T}st(e,n){this.et&&(this.et.dispose(),this.VA.dispose(),Uat[0]=e[0],Uat[1]=e[1],Uat[2]=e[2],Uat[3]=n[0],Uat[4]=n[1],Uat[5]=n[2],this.et=new Lw({POSITION:Uat},Gat,0,{primitive:"lines",positionAttribute:"POSITION"}),this.VA=new bC(this.et,new cC({lineColor:[.8,.8,.1]})))}ut(e,n,i){this.renderer.render(this.rt,{insight_projViewMatrixFromViewpoint:n,projViewMatrix:i,depthMap:this.h},e,this.T)}_A(e,n,i,o){const s=i/o,a=Math.sqrt(Math.pow(e[0]-n[0],2)+Math.pow(e[1]-n[1],2)+Math.pow(e[2]-n[2],2));return{projViewMatrixFromViewpoint:Cv([],jv([],o*Math.PI/180,s,1,a+1e3),Vv([],e,n,[0,1,0])),far:a}}dispose(){super.dispose(),this.T&&this.T.destroy(),this.rt&&this.rt.dispose(),this.VA&&(this.VA.geometry.dispose(),this.VA.dispose())}U(e,n){const i=Yo.isFunction(this.i.width.data)?this.i.width.data():Yo.isFunction(this.i.width)?this.i.width():this.i.width,o=Yo.isFunction(this.i.height.data)?this.i.height.data():Yo.isFunction(this.i.height)?this.i.height():this.i.height;if(!this.T||this.T.width===i&&this.T.height===o||this.T.resize(i,o),this.h&&this.h.width/this.h.height!=e/n){const i=this.I(e,n);i&&this.h.resize(i.width,i.height)}}}const qat=[0,0,0,1],Zat=[],Qat=[];class TA extends D{u(){this.T=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this.O=new eP({vert:"attribute vec3 aPosition;\n\nuniform mat4 projViewModelMatrix;\n\nuniform mat4 modelViewMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\n#include <get_output>\n\nvarying vec4 vPosition;\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    vec4 worldPosition = modelMatrix * localPositionMatrix * getPosition(aPosition);\n\n    vPosition = worldPosition;\n\n    gl_Position = projViewModelMatrix * localPositionMatrix * getPosition(aPosition);\n\n}\n\n",frag:"#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\n#include <gl2_frag>\n\n\n\nvarying vec4 vPosition;\n\n\n\nconst vec2 range = vec2(-100.0, 1000.0);\n\nvec4 encodeHeight(const in float height) {\n\n    float alpha = 1.0;\n\n    vec4 pack = vec4(0.0);\n\n    pack.a = alpha;\n\n    const vec3 code = vec3(1.0, 255.0, 65025.0);\n\n    pack.rgb = vec3(code * height);\n\n    pack.gb = fract(pack.gb);\n\n    pack.rg -= pack.gb * (1.0 / 256.0);\n\n    pack.b -= mod(pack.b, 4.0 / 255.0);\n\n    return pack;\n\n}\n\n\n\nvoid main() {\n\n    float height = (vPosition.z - range.x) / (range.y - range.x);\n\n    glFragColor = encodeHeight(height);\n\n    #if __VERSION__ == 100\n\n        gl_FragColor = glFragColor;\n\n    #endif\n\n}\n\n",uniforms:[{name:"modelViewMatrix",type:"function",fn:(e,n)=>Cv(Zat,n.viewMatrix,n.modelMatrix)},{name:"projViewModelMatrix",type:"function",fn:(e,n)=>Cv(Qat,n.projViewMatrix,n.modelMatrix)}],extraCommandProps:{viewport:this.i,cull:{enable:!0},frontFace:"ccw"}}),this.F=new kC}render(e,n){this.U(),this.renderer.clear({color:qat,depth:1,framebuffer:this.T}),this.F.setMeshes(e);return this.renderer.render(this.O,{projViewMatrix:n},this.F,this.T),this.T}U(){const e=Yo.isFunction(this.i.width)?this.i.width():this.i.width,n=Yo.isFunction(this.i.height)?this.i.height():this.i.height;!this.T||this.T.width===e&&this.T.height===n||this.T.resize(e,n)}dispose(){this.T&&(this.T.destroy(),delete this.T),this.O&&(this.O.dispose(),delete this.O)}}const Xat=Qd.getRendererClass("gl");class FA extends Qd{excavate(e){this.N=!0,this.wt=Array.isArray(e)?e:[e];const n=this.getRenderer();n&&(n.Pt(),n.setToRedraw())}getExcavatedLayers(){return this.wt}enable(){this.N=!0,this.Ct()}disable(){this.N=!1,this.Ct()}isEnable(){return this.N}Ct(){const e=this.getRenderer();e&&e.setToRedraw()}}FA.registerRenderer("gl",class extends Xat{draw(e,n){this.layer.getExcavatedLayers()&&this.layer.isEnable()&&(this.Dt(),super.draw(e,n))}Dt(){this._&&this.It||this.bt(),this.Mt=this.Mt||this.Pt();const e=this.getMap(),n=this.meshes;if(n&&this.Mt){for(let i=0;i<n.length;i++){const o=n[i],s=o.getDefines();s.HAS_EXCAVATE_ANALYSIS=1,o.setDefines(s),o.setUniform("heightmap",this.Mt),o.setUniform("excavateExtent",this.It),o.setUniform("excavateHeight",tat(e,this.options.height))}this.setToRedraw()}}Pt(){const e=this.layer.getExcavatedLayers();this.zt=[];for(let n=0;n<e.length;n++){const i=e[n].getRenderer();if(!i.getAnalysisMeshes)continue;const o=i.getAnalysisMeshes();Yo.pushIn(this.zt,o)}return this.zt.length?(this.B=this.B||this.S(),this.B.render(this.zt,this._)):null}bt(){const e=this.layer.getMap(),n=this.layer.getExtent(),i=e.getCenter(),o=e.getZoom(),s=e.getPitch(),a=e.getBearing(),h=e.getFitZoom(n),l=n.getCenter();e.setZoom(h),e.setCenter(l),e.setPitch(0),e.setBearing(0);const c=e.getExtent();this._=this._||[],_v(this._,e.projViewMatrix);const A=nat(e,c.xmin,c.ymin),f=nat(e,c.xmax,c.ymax);this.It=E_(this.It||[],A[0],A[1],f[0],f[1]),e.setZoom(o),e.setCenter(i),e.setPitch(s),e.setBearing(a)}S(){this.i={x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1};const e=new PC(this.regl);return this.B=this.B||new TA(e,this.i),this.B}dt(){this.bt(),this.setToRedraw()}onGeometryAdd(e){super.onGeometryAdd(e),this.dt()}onGeometryRemove(){super.onGeometryRemove(),this.dt()}remove(){super.remove(),this.B&&this.B.dispose()}});class UA extends D{u(){this.O=new eP({vert:"attribute vec3 aPosition;\n\nuniform mat4 projMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform mat4 modelViewMatrix;\n\n#include <get_output>\n\nvarying vec4 vWorldPosition;\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    vec4 worldPosition = modelMatrix * localPositionMatrix * getPosition(aPosition);\n\n    vWorldPosition = worldPosition;\n\n    gl_Position = projMatrix * modelViewMatrix * localPositionMatrix * getPosition(aPosition);\n\n}\n\n",frag:"#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\nuniform vec4 extent;\n\nuniform sampler2D extentMap;\n\nvarying vec4 vWorldPosition;\n\nvoid main() {\n\n    float width = extent.z - extent.x;\n\n    float height = extent.y - extent.w;\n\n    vec2 uvInExtent = vec2((vWorldPosition.x - extent.x) / width, 1.0 - (vWorldPosition.y - extent.w) / height);\n\n    vec4 extentColor = texture2D(extentMap, uvInExtent);\n\n    if (extentColor.r > 0.0) {\n\n        gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n\n    } else {\n\n        gl_FragColor = vec4(0.0);\n\n    }\n\n}\n\n",uniforms:[{name:"modelViewMatrix",type:"function",fn:function(e,n){return Cv([],n.viewMatrix,n.modelMatrix)}}],extraCommandProps:{viewport:this.i}}),this.T=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0})}render(e,n){this.U(),this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this.T});const i=new kC(e);return this.it(i,n),this.T}it(e,n){this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this.T}),this.renderer.render(this.O,n,e,this.T)}dispose(){this.T&&this.T.destroy(),this.O&&this.O.dispose()}U(){const e=Yo.isFunction(this.i.width.data)?this.i.width.data():this.i.width,n=Yo.isFunction(this.i.height.data)?this.i.height.data():this.i.height;!this.T||this.T.width===e&&this.T.height===n||this.T.resize(e,n)}}var Yat=6371008.8,Jat={centimeters:100*Yat,centimetres:100*Yat,degrees:Yat/111325,feet:3.28084*Yat,inches:39.37*Yat,kilometers:Yat/1e3,kilometres:Yat/1e3,meters:Yat,metres:Yat,miles:Yat/1609.344,millimeters:1e3*Yat,millimetres:1e3*Yat,nauticalmiles:Yat/1852,radians:1,yards:1.0936*Yat};function Kat(e,n,i){void 0===i&&(i={});var o={type:"Feature"};return(0===i.id||i.id)&&(o.id=i.id),i.bbox&&(o.bbox=i.bbox),o.properties=n||{},o.geometry=e,o}function $at(e,n,i){if(void 0===i&&(i={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!sht(e[0])||!sht(e[1]))throw new Error("coordinates must contain numbers");return Kat({type:"Point",coordinates:e},n,i)}function tht(e,n,i){if(void 0===i&&(i={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");return Kat({type:"LineString",coordinates:e},n,i)}function eht(e,n){void 0===n&&(n={});var i={type:"FeatureCollection"};return n.id&&(i.id=n.id),n.bbox&&(i.bbox=n.bbox),i.features=e,i}function nht(e,n){void 0===n&&(n="kilometers");var i=Jat[n];if(!i)throw new Error(n+" units is invalid");return e*i}function iht(e,n){void 0===n&&(n="kilometers");var i=Jat[n];if(!i)throw new Error(n+" units is invalid");return e/i}function rht(e){return e%(2*Math.PI)*180/Math.PI}function oht(e){return e%360*Math.PI/180}function sht(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function aht(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return e.geometry.coordinates;if("Point"===e.type)return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function hht(e,n,i){if(void 0===i&&(i={}),!0===i.final)return function(e,n){var i=hht(n,e);return(i+180)%360}(e,n);var o=aht(e),s=aht(n),a=oht(o[0]),h=oht(s[0]),l=oht(o[1]),c=oht(s[1]),A=Math.sin(h-a)*Math.cos(c),f=Math.cos(l)*Math.sin(c)-Math.sin(l)*Math.cos(c)*Math.cos(h-a);return rht(Math.atan2(A,f))}function lht(e,n,i,o){void 0===o&&(o={});var s=aht(e),a=oht(s[0]),h=oht(s[1]),l=oht(i),c=iht(n,o.units),A=Math.asin(Math.sin(h)*Math.cos(c)+Math.cos(h)*Math.sin(c)*Math.cos(l));return $at([rht(a+Math.atan2(Math.sin(l)*Math.sin(c)*Math.cos(h),Math.cos(c)-Math.sin(h)*Math.sin(A))),rht(A)],o.properties)}function uht(e,n,i){void 0===i&&(i={});var o=aht(e),s=aht(n),a=oht(s[1]-o[1]),h=oht(s[0]-o[0]),l=oht(o[1]),c=oht(s[1]),A=Math.pow(Math.sin(a/2),2)+Math.pow(Math.sin(h/2),2)*Math.cos(l)*Math.cos(c);return nht(2*Math.atan2(Math.sqrt(A),Math.sqrt(1-A)),i.units)}function cht(e,n,i){void 0===i&&(i={});for(var o,s=("Feature"===(o=e).type?o.geometry:o).coordinates,a=0,h=0;h<s.length&&!(n>=a&&h===s.length-1);h++){if(a>=n){var l=n-a;if(l){var c=hht(s[h],s[h-1])-180;return lht(s[h],l,c,i)}return $at(s[h])}a+=uht(s[h],s[h+1],i)}return $at(s[s.length-1])}function Aht(e,n,i){if(null!==e)for(var o,s,a,h,l,c,A,f,d=0,p=0,g=e.type,v="FeatureCollection"===g,w="Feature"===g,C=v?e.features.length:1,P=0;P<C;P++){l=(f=!!(A=v?e.features[P].geometry:w?e.geometry:e)&&"GeometryCollection"===A.type)?A.geometries.length:1;for(var T=0;T<l;T++){var S=0,I=0;if(null!==(h=f?A.geometries[T]:A)){c=h.coordinates;var E=h.type;switch(d=0,E){case null:break;case"Point":if(!1===n(c,p,P,S,I))return!1;p++,S++;break;case"LineString":case"MultiPoint":for(o=0;o<c.length;o++){if(!1===n(c[o],p,P,S,I))return!1;p++,"MultiPoint"===E&&S++}"LineString"===E&&S++;break;case"Polygon":case"MultiLineString":for(o=0;o<c.length;o++){for(s=0;s<c[o].length-d;s++){if(!1===n(c[o][s],p,P,S,I))return!1;p++}"MultiLineString"===E&&S++,"Polygon"===E&&I++}"Polygon"===E&&S++;break;case"MultiPolygon":for(o=0;o<c.length;o++){for(I=0,s=0;s<c[o].length;s++){for(a=0;a<c[o][s].length-d;a++){if(!1===n(c[o][s][a],p,P,S,I))return!1;p++}I++}S++}break;case"GeometryCollection":for(o=0;o<h.geometries.length;o++)if(!1===Aht(h.geometries[o],n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function fht(e,n){if("Feature"===e.type)n(e,0);else if("FeatureCollection"===e.type)for(var i=0;i<e.features.length&&!1!==n(e.features[i],i);i++);}function dht(e,n){var i,o,s,a,h,l,c,A,f,d,p=0,g="FeatureCollection"===e.type,v="Feature"===e.type,w=g?e.features.length:1;for(i=0;i<w;i++){for(A=g?e.features[i].properties:v?e.properties:{},f=g?e.features[i].bbox:v?e.bbox:void 0,d=g?e.features[i].id:v?e.id:void 0,h=(c=!!(l=g?e.features[i].geometry:v?e.geometry:e)&&"GeometryCollection"===l.type)?l.geometries.length:1,s=0;s<h;s++)if(null!==(a=c?l.geometries[s]:l))switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===n(a,p,A,f,d))return!1;break;case"GeometryCollection":for(o=0;o<a.geometries.length;o++)if(!1===n(a.geometries[o],p,A,f,d))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===n(null,p,A,f,d))return!1;p++}}function pht(e){var n=[1/0,1/0,-1/0,-1/0];return Aht(e,(function(e){n[0]>e[0]&&(n[0]=e[0]),n[1]>e[1]&&(n[1]=e[1]),n[2]<e[0]&&(n[2]=e[0]),n[3]<e[1]&&(n[3]=e[1])})),n}pht.default=pht,"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(e){if(null==this)throw new TypeError(this+" is not an object");var n=Object(this),i=Math.max(Math.min(n.length,9007199254740991),0)||0,o=1 in arguments&&parseInt(Number(arguments[1]),10)||0;o=o<0?Math.max(i+o,0):Math.min(o,i);var s=2 in arguments&&void 0!==arguments[2]?parseInt(Number(arguments[2]),10)||0:i;for(s=s<0?Math.max(i+arguments[2],0):Math.min(s,i);o<s;)n[o]=e,++o;return n},writable:!0}),Number.isFinite=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},Number.parseFloat=Number.parseFloat||parseFloat,Number.isNaN=Number.isNaN||function(e){return e!=e},Math.trunc=Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)};var ght=function(){};ght.prototype.interfaces_=function(){return[]},ght.prototype.getClass=function(){return ght},ght.prototype.equalsWithTolerance=function(e,n,i){return Math.abs(e-n)<=i};var mht=function(e){function n(n){e.call(this,n),this.name="IllegalArgumentException",this.message=n,this.stack=(new e).stack}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n}(Error),yht=function(){},vht={MAX_VALUE:{configurable:!0}};yht.isNaN=function(e){return Number.isNaN(e)},yht.doubleToLongBits=function(e){return e},yht.longBitsToDouble=function(e){return e},yht.isInfinite=function(e){return!Number.isFinite(e)},vht.MAX_VALUE.get=function(){return Number.MAX_VALUE},Object.defineProperties(yht,vht);var _ht=function(){},xht=function(){},bht=function(){};function wht(){}var Cht=function e(){if(this.x=null,this.y=null,this.z=null,0===arguments.length)this.x=0,this.y=0,this.z=e.NULL_ORDINATE;else if(1===arguments.length){var n=arguments[0];this.x=n.x,this.y=n.y,this.z=n.z}else 2===arguments.length?(this.x=arguments[0],this.y=arguments[1],this.z=e.NULL_ORDINATE):3===arguments.length&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},Pht={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};Cht.prototype.setOrdinate=function(e,n){switch(e){case Cht.X:this.x=n;break;case Cht.Y:this.y=n;break;case Cht.Z:this.z=n;break;default:throw new mht("Invalid ordinate index: "+e)}},Cht.prototype.equals2D=function(){if(1===arguments.length){var e=arguments[0];return this.x===e.x&&this.y===e.y}if(2===arguments.length){var n=arguments[0],i=arguments[1];return!!ght.equalsWithTolerance(this.x,n.x,i)&&!!ght.equalsWithTolerance(this.y,n.y,i)}},Cht.prototype.getOrdinate=function(e){switch(e){case Cht.X:return this.x;case Cht.Y:return this.y;case Cht.Z:return this.z}throw new mht("Invalid ordinate index: "+e)},Cht.prototype.equals3D=function(e){return this.x===e.x&&this.y===e.y&&(this.z===e.z||yht.isNaN(this.z))&&yht.isNaN(e.z)},Cht.prototype.equals=function(e){return e instanceof Cht&&this.equals2D(e)},Cht.prototype.equalInZ=function(e,n){return ght.equalsWithTolerance(this.z,e.z,n)},Cht.prototype.compareTo=function(e){return this.x<e.x?-1:this.x>e.x?1:this.y<e.y?-1:this.y>e.y?1:0},Cht.prototype.clone=function(){},Cht.prototype.copy=function(){return new Cht(this)},Cht.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},Cht.prototype.distance3D=function(e){var n=this.x-e.x,i=this.y-e.y,o=this.z-e.z;return Math.sqrt(n*n+i*i+o*o)},Cht.prototype.distance=function(e){var n=this.x-e.x,i=this.y-e.y;return Math.sqrt(n*n+i*i)},Cht.prototype.hashCode=function(){var e=17;return 37*(e=37*e+Cht.hashCode(this.x))+Cht.hashCode(this.y)},Cht.prototype.setCoordinate=function(e){this.x=e.x,this.y=e.y,this.z=e.z},Cht.prototype.interfaces_=function(){return[_ht,xht,wht]},Cht.prototype.getClass=function(){return Cht},Cht.hashCode=function(){if(1===arguments.length)return yht.doubleToLongBits(arguments[0]),Math.trunc(0)},Pht.DimensionalComparator.get=function(){return Mht},Pht.serialVersionUID.get=function(){return 0x5cbf2c235c7e5800},Pht.NULL_ORDINATE.get=function(){return yht.NaN},Pht.X.get=function(){return 0},Pht.Y.get=function(){return 1},Pht.Z.get=function(){return 2},Object.defineProperties(Cht,Pht);var Mht=function(e){if(this.xt=2,0===arguments.length);else if(1===arguments.length){var n=arguments[0];if(2!==n&&3!==n)throw new mht("only 2 or 3 dimensions may be specified");this.xt=n}};Mht.prototype.compare=function(e,n){var i=e,o=n,s=Mht.compare(i.x,o.x);if(0!==s)return s;var a=Mht.compare(i.y,o.y);return 0!==a?a:this.xt<=2?0:Mht.compare(i.z,o.z)},Mht.prototype.interfaces_=function(){return[bht]},Mht.prototype.getClass=function(){return Mht},Mht.compare=function(e,n){return e<n?-1:e>n?1:yht.isNaN(e)?yht.isNaN(n)?0:-1:yht.isNaN(n)?1:0};var Tht=function(){};Tht.prototype.create=function(){},Tht.prototype.interfaces_=function(){return[]},Tht.prototype.getClass=function(){return Tht};var Sht=function(){},Iht={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};Sht.prototype.interfaces_=function(){return[]},Sht.prototype.getClass=function(){return Sht},Sht.toLocationSymbol=function(e){switch(e){case Sht.EXTERIOR:return"e";case Sht.BOUNDARY:return"b";case Sht.INTERIOR:return"i";case Sht.NONE:return"-"}throw new mht("Unknown location value: "+e)},Iht.INTERIOR.get=function(){return 0},Iht.BOUNDARY.get=function(){return 1},Iht.EXTERIOR.get=function(){return 2},Iht.NONE.get=function(){return-1},Object.defineProperties(Sht,Iht);var Eht=function(e,n){return e.interfaces_&&e.interfaces_().indexOf(n)>-1},Oht=function(){},Rht={LOG_10:{configurable:!0}};Oht.prototype.interfaces_=function(){return[]},Oht.prototype.getClass=function(){return Oht},Oht.log10=function(e){var n=Math.log(e);return yht.isInfinite(n)||yht.isNaN(n)?n:n/Oht.LOG_10},Oht.min=function(e,n,i,o){var s=e;return n<s&&(s=n),i<s&&(s=i),o<s&&(s=o),s},Oht.clamp=function(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var e=arguments[0],n=arguments[1],i=arguments[2];return e<n?n:e>i?i:e}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var o=arguments[0],s=arguments[1],a=arguments[2];return o<s?s:o>a?a:o}},Oht.wrap=function(e,n){return e<0?n- -e%n:e%n},Oht.max=function(){if(3===arguments.length){var e=arguments[1],n=arguments[2],i=arguments[0];return e>i&&(i=e),n>i&&(i=n),i}if(4===arguments.length){var o=arguments[1],s=arguments[2],a=arguments[3],h=arguments[0];return o>h&&(h=o),s>h&&(h=s),a>h&&(h=a),h}},Oht.average=function(e,n){return(e+n)/2},Rht.LOG_10.get=function(){return Math.log(10)},Object.defineProperties(Oht,Rht);var Dht=function(e){this.str=e};Dht.prototype.append=function(e){this.str+=e},Dht.prototype.setCharAt=function(e,n){this.str=this.str.substr(0,e)+n+this.str.substr(e+1)},Dht.prototype.toString=function(e){return this.str};var kht=function(e){this.value=e};kht.prototype.intValue=function(){return this.value},kht.prototype.compareTo=function(e){return this.value<e?-1:this.value>e?1:0},kht.isNaN=function(e){return Number.isNaN(e)};var Lht=function(){};Lht.isWhitespace=function(e){return e<=32&&e>=0||127===e},Lht.toUpperCase=function(e){return e.toUpperCase()};var Fht=function e(){if(this.yt=0,this.Lt=0,0===arguments.length)this.init(0);else if(1===arguments.length){if("number"==typeof arguments[0])this.init(arguments[0]);else if(arguments[0]instanceof e){this.init(arguments[0])}else"string"==typeof arguments[0]&&e.call(this,e.parse(arguments[0]))}else if(2===arguments.length){this.init(arguments[0],arguments[1])}},Nht={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};Fht.prototype.le=function(e){return(this.yt<e.yt||this.yt===e.yt)&&this.Lt<=e.Lt},Fht.prototype.extractSignificantDigits=function(e,n){var i=this.abs(),o=Fht.magnitude(i.yt),s=Fht.TEN.pow(o);(i=i.divide(s)).gt(Fht.TEN)?(i=i.divide(Fht.TEN),o+=1):i.lt(Fht.ONE)&&(i=i.multiply(Fht.TEN),o-=1);for(var a=o+1,h=new Dht,l=Fht.MAX_PRINT_DIGITS-1,c=0;c<=l;c++){e&&c===a&&h.append(".");var A=Math.trunc(i.yt);if(A<0)break;var f=!1,d=0;A>9?(f=!0,d="9"):d="0"+A,h.append(d),i=i.subtract(Fht.valueOf(A)).multiply(Fht.TEN),f&&i.selfAdd(Fht.TEN);var p=!0,g=Fht.magnitude(i.yt);if(g<0&&Math.abs(g)>=l-c&&(p=!1),!p)break}return n[0]=o,h.toString()},Fht.prototype.sqr=function(){return this.multiply(this)},Fht.prototype.doubleValue=function(){return this.yt+this.Lt},Fht.prototype.subtract=function(){return arguments[0]instanceof Fht?this.add(arguments[0].negate()):"number"==typeof arguments[0]?this.add(-arguments[0]):void 0},Fht.prototype.equals=function(){if(1===arguments.length){var e=arguments[0];return this.yt===e.yt&&this.Lt===e.Lt}},Fht.prototype.isZero=function(){return 0===this.yt&&0===this.Lt},Fht.prototype.selfSubtract=function(){if(arguments[0]instanceof Fht){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e.yt,-e.Lt)}if("number"==typeof arguments[0]){var n=arguments[0];return this.isNaN()?this:this.selfAdd(-n,0)}},Fht.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null},Fht.prototype.min=function(e){return this.le(e)?this:e},Fht.prototype.selfDivide=function(){if(1===arguments.length){if(arguments[0]instanceof Fht){var e=arguments[0];return this.selfDivide(e.yt,e.Lt)}if("number"==typeof arguments[0])return this.selfDivide(arguments[0],0)}else if(2===arguments.length){var n,i,o,s,a=arguments[0],h=null,l=null,c=null,A=null;return A=(h=(c=Fht.SPLIT*(o=this.yt/a))-(h=c-o))*(l=(A=Fht.SPLIT*a)-(l=A-a))-(s=o*a)+h*(i=a-l)+(n=o-h)*l+n*i,A=o+(c=(this.yt-s-A+this.Lt-o*arguments[1])/a),this.yt=A,this.Lt=o-A+c,this}},Fht.prototype.dump=function(){return"DD<"+this.yt+", "+this.Lt+">"},Fht.prototype.divide=function(){if(arguments[0]instanceof Fht){var e,n,i,o,s=arguments[0],a=null,h=null,l=null,c=null;return e=(i=this.yt/s.yt)-(a=(l=Fht.SPLIT*i)-(a=l-i)),c=a*(h=(c=Fht.SPLIT*s.yt)-(h=c-s.yt))-(o=i*s.yt)+a*(n=s.yt-h)+e*h+e*n,new Fht(c=i+(l=(this.yt-o-c+this.Lt-i*s.Lt)/s.yt),i-c+l)}if("number"==typeof arguments[0]){var A=arguments[0];return yht.isNaN(A)?Fht.createNaN():Fht.copy(this).selfDivide(A,0)}},Fht.prototype.ge=function(e){return(this.yt>e.yt||this.yt===e.yt)&&this.Lt>=e.Lt},Fht.prototype.pow=function(e){if(0===e)return Fht.valueOf(1);var n=new Fht(this),i=Fht.valueOf(1),o=Math.abs(e);if(o>1)for(;o>0;)o%2==1&&i.selfMultiply(n),(o/=2)>0&&(n=n.sqr());else i=n;return e<0?i.reciprocal():i},Fht.prototype.ceil=function(){if(this.isNaN())return Fht.NaN;var e=Math.ceil(this.yt),n=0;return e===this.yt&&(n=Math.ceil(this.Lt)),new Fht(e,n)},Fht.prototype.compareTo=function(e){return this.yt<e.yt?-1:this.yt>e.yt?1:this.Lt<e.Lt?-1:this.Lt>e.Lt?1:0},Fht.prototype.rint=function(){return this.isNaN()?this:this.add(.5).floor()},Fht.prototype.setValue=function(){return arguments[0]instanceof Fht||"number"==typeof arguments[0]?(this.init(arguments[0]),this):void 0},Fht.prototype.max=function(e){return this.ge(e)?this:e},Fht.prototype.sqrt=function(){if(this.isZero())return Fht.valueOf(0);if(this.isNegative())return Fht.NaN;var e=1/Math.sqrt(this.yt),n=Fht.valueOf(this.yt*e),i=this.subtract(n.sqr()).yt*(.5*e);return n.add(i)},Fht.prototype.selfAdd=function(){if(1===arguments.length){if(arguments[0]instanceof Fht){var e=arguments[0];return this.selfAdd(e.yt,e.Lt)}if("number"==typeof arguments[0]){var n,i,o,s,a,h=arguments[0],l=null;return l=(o=this.yt+h)-(s=o-this.yt),i=(a=(l=h-s+(this.yt-l))+this.Lt)+(o-(n=o+a)),this.yt=n+i,this.Lt=i+(n-this.yt),this}}else if(2===arguments.length){var c,A,f,d,p=arguments[0],g=arguments[1],v=null,w=null,C=null;w=(f=this.yt+p)-(C=f-this.yt),v=(A=this.Lt+g)-(d=A-this.Lt);var P=(c=f+(C=(w=p-C+(this.yt-w))+A))+(C=(v=g-d+(this.Lt-v))+(C+(f-c))),T=C+(c-P);return this.yt=P,this.Lt=T,this}},Fht.prototype.selfMultiply=function(){if(1===arguments.length){if(arguments[0]instanceof Fht){var e=arguments[0];return this.selfMultiply(e.yt,e.Lt)}if("number"==typeof arguments[0])return this.selfMultiply(arguments[0],0)}else if(2===arguments.length){var n,i,o=arguments[0],s=null,a=null,h=null,l=null;s=(h=Fht.SPLIT*this.yt)-this.yt,s=h-s;var c=(h=this.yt*o)+(l=s*(a=(l=Fht.SPLIT*o)-(a=l-o))-h+s*(i=o-a)+(n=this.yt-s)*a+n*i+(this.yt*arguments[1]+this.Lt*o)),A=l+(s=h-c);return this.yt=c,this.Lt=A,this}},Fht.prototype.selfSqr=function(){return this.selfMultiply(this)},Fht.prototype.floor=function(){if(this.isNaN())return Fht.NaN;var e=Math.floor(this.yt),n=0;return e===this.yt&&(n=Math.floor(this.Lt)),new Fht(e,n)},Fht.prototype.negate=function(){return this.isNaN()?this:new Fht(-this.yt,-this.Lt)},Fht.prototype.clone=function(){},Fht.prototype.multiply=function(){if(arguments[0]instanceof Fht){var e=arguments[0];return e.isNaN()?Fht.createNaN():Fht.copy(this).selfMultiply(e)}if("number"==typeof arguments[0]){var n=arguments[0];return yht.isNaN(n)?Fht.createNaN():Fht.copy(this).selfMultiply(n,0)}},Fht.prototype.isNaN=function(){return yht.isNaN(this.yt)},Fht.prototype.intValue=function(){return Math.trunc(this.yt)},Fht.prototype.toString=function(){var e=Fht.magnitude(this.yt);return e>=-3&&e<=20?this.toStandardNotation():this.toSciNotation()},Fht.prototype.toStandardNotation=function(){var e=this.getSpecialNumberString();if(null!==e)return e;var n=new Array(1).fill(null),i=this.extractSignificantDigits(!0,n),o=n[0]+1,s=i;if("."===i.charAt(0))s="0"+i;else if(o<0)s="0."+Fht.stringOfChar("0",-o)+i;else if(-1===i.indexOf(".")){s=i+Fht.stringOfChar("0",o-i.length)+".0"}return this.isNegative()?"-"+s:s},Fht.prototype.reciprocal=function(){var e,n,i,o,s=null,a=null,h=null,l=null;e=(i=1/this.yt)-(s=(h=Fht.SPLIT*i)-(s=h-i)),a=(l=Fht.SPLIT*this.yt)-this.yt;var c=i+(h=(1-(o=i*this.yt)-(l=s*(a=l-a)-o+s*(n=this.yt-a)+e*a+e*n)-i*this.Lt)/this.yt);return new Fht(c,i-c+h)},Fht.prototype.toSciNotation=function(){if(this.isZero())return Fht.SCI_NOT_ZERO;var e=this.getSpecialNumberString();if(null!==e)return e;var n=new Array(1).fill(null),i=this.extractSignificantDigits(!1,n),o=Fht.SCI_NOT_EXPONENT_CHAR+n[0];if("0"===i.charAt(0))throw new Error("Found leading zero: "+i);var s="";i.length>1&&(s=i.substring(1));var a=i.charAt(0)+"."+s;return this.isNegative()?"-"+a+o:a+o},Fht.prototype.abs=function(){return this.isNaN()?Fht.NaN:this.isNegative()?this.negate():new Fht(this)},Fht.prototype.isPositive=function(){return(this.yt>0||0===this.yt)&&this.Lt>0},Fht.prototype.lt=function(e){return(this.yt<e.yt||this.yt===e.yt)&&this.Lt<e.Lt},Fht.prototype.add=function(){if(arguments[0]instanceof Fht){var e=arguments[0];return Fht.copy(this).selfAdd(e)}if("number"==typeof arguments[0]){var n=arguments[0];return Fht.copy(this).selfAdd(n)}},Fht.prototype.init=function(){if(1===arguments.length){if("number"==typeof arguments[0])this.yt=arguments[0],this.Lt=0;else if(arguments[0]instanceof Fht){var e=arguments[0];this.yt=e.yt,this.Lt=e.Lt}}else if(2===arguments.length){var n=arguments[1];this.yt=arguments[0],this.Lt=n}},Fht.prototype.gt=function(e){return(this.yt>e.yt||this.yt===e.yt)&&this.Lt>e.Lt},Fht.prototype.isNegative=function(){return(this.yt<0||0===this.yt)&&this.Lt<0},Fht.prototype.trunc=function(){return this.isNaN()?Fht.NaN:this.isPositive()?this.floor():this.ceil()},Fht.prototype.signum=function(){return this.yt>0?1:this.yt<0?-1:this.Lt>0?1:this.Lt<0?-1:0},Fht.prototype.interfaces_=function(){return[wht,_ht,xht]},Fht.prototype.getClass=function(){return Fht},Fht.sqr=function(e){return Fht.valueOf(e).selfMultiply(e)},Fht.valueOf=function(){return"string"==typeof arguments[0]?Fht.parse(arguments[0]):"number"==typeof arguments[0]?new Fht(arguments[0]):void 0},Fht.sqrt=function(e){return Fht.valueOf(e).sqrt()},Fht.parse=function(e){for(var n=0,i=e.length;Lht.isWhitespace(e.charAt(n));)n++;var o=!1;if(n<i){var s=e.charAt(n);"-"!==s&&"+"!==s||(n++,"-"===s&&(o=!0))}for(var a=new Fht,h=0,l=0,c=0;!(n>=i);){var A=e.charAt(n);if(n++,Lht.isDigit(A)){var f=A-"0";a.selfMultiply(Fht.TEN),a.selfAdd(f),h++}else{if("."!==A){if("e"===A||"E"===A){var d=e.substring(n);try{c=kht.parseInt(d)}catch(n){throw n instanceof Error?new Error("Invalid exponent "+d+" in string "+e):n}break}throw new Error("Unexpected character '"+A+"' at position "+n+" in string "+e)}l=h}}var p=a,g=h-l-c;if(0===g)p=a;else if(g>0){var v=Fht.TEN.pow(g);p=a.divide(v)}else if(g<0){var w=Fht.TEN.pow(-g);p=a.multiply(w)}return o?p.negate():p},Fht.createNaN=function(){return new Fht(yht.NaN,yht.NaN)},Fht.copy=function(e){return new Fht(e)},Fht.magnitude=function(e){var n=Math.abs(e),i=Math.log(n)/Math.log(10),o=Math.trunc(Math.floor(i));return 10*Math.pow(10,o)<=n&&(o+=1),o},Fht.stringOfChar=function(e,n){for(var i=new Dht,o=0;o<n;o++)i.append(e);return i.toString()},Nht.PI.get=function(){return new Fht(3.141592653589793,12246467991473532e-32)},Nht.TWO_PI.get=function(){return new Fht(6.283185307179586,24492935982947064e-32)},Nht.PI_2.get=function(){return new Fht(1.5707963267948966,6123233995736766e-32)},Nht.E.get=function(){return new Fht(2.718281828459045,14456468917292502e-32)},Nht.NaN.get=function(){return new Fht(yht.NaN,yht.NaN)},Nht.EPS.get=function(){return 123259516440783e-46},Nht.SPLIT.get=function(){return 134217729},Nht.MAX_PRINT_DIGITS.get=function(){return 32},Nht.TEN.get=function(){return Fht.valueOf(10)},Nht.ONE.get=function(){return Fht.valueOf(1)},Nht.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"},Nht.SCI_NOT_ZERO.get=function(){return"0.0E0"},Object.defineProperties(Fht,Nht);var zht=function(){},Bht={DP_SAFE_EPSILON:{configurable:!0}};zht.prototype.interfaces_=function(){return[]},zht.prototype.getClass=function(){return zht},zht.orientationIndex=function(e,n,i){var o=zht.orientationIndexFilter(e,n,i);if(o<=1)return o;var s=Fht.valueOf(n.x).selfAdd(-e.x),a=Fht.valueOf(n.y).selfAdd(-e.y),h=Fht.valueOf(i.x).selfAdd(-n.x),l=Fht.valueOf(i.y).selfAdd(-n.y);return s.selfMultiply(l).selfSubtract(a.selfMultiply(h)).signum()},zht.signOfDet2x2=function(e,n,i,o){return e.multiply(o).selfSubtract(n.multiply(i)).signum()},zht.intersection=function(e,n,i,o){var s=Fht.valueOf(o.y).selfSubtract(i.y).selfMultiply(Fht.valueOf(n.x).selfSubtract(e.x)),a=Fht.valueOf(o.x).selfSubtract(i.x).selfMultiply(Fht.valueOf(n.y).selfSubtract(e.y)),h=s.subtract(a),l=Fht.valueOf(o.x).selfSubtract(i.x).selfMultiply(Fht.valueOf(e.y).selfSubtract(i.y)),c=Fht.valueOf(o.y).selfSubtract(i.y).selfMultiply(Fht.valueOf(e.x).selfSubtract(i.x)),A=l.subtract(c).selfDivide(h).doubleValue(),f=Fht.valueOf(e.x).selfAdd(Fht.valueOf(n.x).selfSubtract(e.x).selfMultiply(A)).doubleValue(),d=Fht.valueOf(n.x).selfSubtract(e.x).selfMultiply(Fht.valueOf(e.y).selfSubtract(i.y)),p=Fht.valueOf(n.y).selfSubtract(e.y).selfMultiply(Fht.valueOf(e.x).selfSubtract(i.x)),g=d.subtract(p).selfDivide(h).doubleValue(),v=Fht.valueOf(i.y).selfAdd(Fht.valueOf(o.y).selfSubtract(i.y).selfMultiply(g)).doubleValue();return new Cht(f,v)},zht.orientationIndexFilter=function(e,n,i){var o=null,s=(e.x-i.x)*(n.y-i.y),a=(e.y-i.y)*(n.x-i.x),h=s-a;if(s>0){if(a<=0)return zht.signum(h);o=s+a}else{if(!(s<0))return zht.signum(h);if(a>=0)return zht.signum(h);o=-s-a}var l=zht.DP_SAFE_EPSILON*o;return h>=l||-h>=l?zht.signum(h):2},zht.signum=function(e){return e>0?1:e<0?-1:0},Bht.DP_SAFE_EPSILON.get=function(){return 1e-15},Object.defineProperties(zht,Bht);var Hht=function(){},jht={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};jht.X.get=function(){return 0},jht.Y.get=function(){return 1},jht.Z.get=function(){return 2},jht.M.get=function(){return 3},Hht.prototype.setOrdinate=function(e,n,i){},Hht.prototype.size=function(){},Hht.prototype.getOrdinate=function(e,n){},Hht.prototype.getCoordinate=function(){},Hht.prototype.getCoordinateCopy=function(e){},Hht.prototype.getDimension=function(){},Hht.prototype.getX=function(e){},Hht.prototype.clone=function(){},Hht.prototype.expandEnvelope=function(e){},Hht.prototype.copy=function(){},Hht.prototype.getY=function(e){},Hht.prototype.toCoordinateArray=function(){},Hht.prototype.interfaces_=function(){return[xht]},Hht.prototype.getClass=function(){return Hht},Object.defineProperties(Hht,jht);var Uht=function(){},Ght=function(e){function n(){e.call(this,"Projective point not representable on the Cartesian plane.")}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n}(Uht),Vht=function(){};Vht.arraycopy=function(e,n,i,o,s){for(var a=0,h=n;h<n+s;h++)i[o+a]=e[h],a++},Vht.getProperty=function(e){return{"line.separator":"\n"}[e]};var Wht=function e(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.x=0,this.y=0,this.w=1;else if(1===arguments.length){var n=arguments[0];this.x=n.x,this.y=n.y,this.w=1}else if(2===arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var i=arguments[1];this.x=arguments[0],this.y=i,this.w=1}else if(arguments[0]instanceof e&&arguments[1]instanceof e){var o=arguments[0],s=arguments[1];this.x=o.y*s.w-s.y*o.w,this.y=s.x*o.w-o.x*s.w,this.w=o.x*s.y-s.x*o.y}else if(arguments[0]instanceof Cht&&arguments[1]instanceof Cht){var a=arguments[0],h=arguments[1];this.x=a.y-h.y,this.y=h.x-a.x,this.w=a.x*h.y-h.x*a.y}}else if(3===arguments.length){var l=arguments[1],c=arguments[2];this.x=arguments[0],this.y=l,this.w=c}else if(4===arguments.length){var A=arguments[0],f=arguments[1],d=arguments[2],p=arguments[3],g=A.y-f.y,v=f.x-A.x,w=A.x*f.y-f.x*A.y,C=d.y-p.y,P=p.x-d.x,T=d.x*p.y-p.x*d.y;this.x=v*T-P*w,this.y=C*w-g*T,this.w=g*P-C*v}};Wht.prototype.getY=function(){var e=this.y/this.w;if(yht.isNaN(e)||yht.isInfinite(e))throw new Ght;return e},Wht.prototype.getX=function(){var e=this.x/this.w;if(yht.isNaN(e)||yht.isInfinite(e))throw new Ght;return e},Wht.prototype.getCoordinate=function(){var e=new Cht;return e.x=this.getX(),e.y=this.getY(),e},Wht.prototype.interfaces_=function(){return[]},Wht.prototype.getClass=function(){return Wht},Wht.intersection=function(e,n,i,o){var s=e.y-n.y,a=n.x-e.x,h=e.x*n.y-n.x*e.y,l=i.y-o.y,c=o.x-i.x,A=i.x*o.y-o.x*i.y,f=s*c-l*a,d=(a*A-c*h)/f,p=(l*h-s*A)/f;if(yht.isNaN(d)||yht.isInfinite(d)||yht.isNaN(p)||yht.isInfinite(p))throw new Ght;return new Cht(d,p)};var qht=function e(){if(this.Tt=null,this.Ot=null,this.Ft=null,this.Ut=null,0===arguments.length)this.init();else if(1===arguments.length){if(arguments[0]instanceof Cht){var n=arguments[0];this.init(n.x,n.x,n.y,n.y)}else if(arguments[0]instanceof e){this.init(arguments[0])}}else if(2===arguments.length){var i=arguments[0],o=arguments[1];this.init(i.x,o.x,i.y,o.y)}else if(4===arguments.length){this.init(arguments[0],arguments[1],arguments[2],arguments[3])}},Zht={serialVersionUID:{configurable:!0}};qht.prototype.getArea=function(){return this.getWidth()*this.getHeight()},qht.prototype.equals=function(e){if(!(e instanceof qht))return!1;var n=e;return this.isNull()?n.isNull():this.Ot===n.getMaxX()&&this.Ut===n.getMaxY()&&this.Tt===n.getMinX()&&this.Ft===n.getMinY()},qht.prototype.intersection=function(e){return this.isNull()||e.isNull()||!this.intersects(e)?new qht:new qht(this.Tt>e.Tt?this.Tt:e.Tt,this.Ot<e.Ot?this.Ot:e.Ot,this.Ft>e.Ft?this.Ft:e.Ft,this.Ut<e.Ut?this.Ut:e.Ut)},qht.prototype.isNull=function(){return this.Ot<this.Tt},qht.prototype.getMaxX=function(){return this.Ot},qht.prototype.covers=function(){if(1===arguments.length){if(arguments[0]instanceof Cht){var e=arguments[0];return this.covers(e.x,e.y)}if(arguments[0]instanceof qht){var n=arguments[0];return!this.isNull()&&!n.isNull()&&n.getMinX()>=this.Tt&&n.getMaxX()<=this.Ot&&n.getMinY()>=this.Ft&&n.getMaxY()<=this.Ut}}else if(2===arguments.length){var i=arguments[0],o=arguments[1];return!this.isNull()&&i>=this.Tt&&i<=this.Ot&&o>=this.Ft&&o<=this.Ut}},qht.prototype.intersects=function(){if(1===arguments.length){if(arguments[0]instanceof qht){var e=arguments[0];return!this.isNull()&&!e.isNull()&&!(e.Tt>this.Ot||e.Ot<this.Tt||e.Ft>this.Ut||e.Ut<this.Ft)}if(arguments[0]instanceof Cht){var n=arguments[0];return this.intersects(n.x,n.y)}}else if(2===arguments.length){var i=arguments[0],o=arguments[1];return!this.isNull()&&!(i>this.Ot||i<this.Tt||o>this.Ut||o<this.Ft)}},qht.prototype.getMinY=function(){return this.Ft},qht.prototype.getMinX=function(){return this.Tt},qht.prototype.expandToInclude=function(){if(1===arguments.length){if(arguments[0]instanceof Cht){var e=arguments[0];this.expandToInclude(e.x,e.y)}else if(arguments[0]instanceof qht){var n=arguments[0];if(n.isNull())return null;this.isNull()?(this.Tt=n.getMinX(),this.Ot=n.getMaxX(),this.Ft=n.getMinY(),this.Ut=n.getMaxY()):(n.Tt<this.Tt&&(this.Tt=n.Tt),n.Ot>this.Ot&&(this.Ot=n.Ot),n.Ft<this.Ft&&(this.Ft=n.Ft),n.Ut>this.Ut&&(this.Ut=n.Ut))}}else if(2===arguments.length){var i=arguments[0],o=arguments[1];this.isNull()?(this.Tt=i,this.Ot=i,this.Ft=o,this.Ut=o):(i<this.Tt&&(this.Tt=i),i>this.Ot&&(this.Ot=i),o<this.Ft&&(this.Ft=o),o>this.Ut&&(this.Ut=o))}},qht.prototype.minExtent=function(){if(this.isNull())return 0;var e=this.getWidth(),n=this.getHeight();return e<n?e:n},qht.prototype.getWidth=function(){return this.isNull()?0:this.Ot-this.Tt},qht.prototype.compareTo=function(e){var n=e;return this.isNull()?n.isNull()?0:-1:n.isNull()?1:this.Tt<n.Tt?-1:this.Tt>n.Tt?1:this.Ft<n.Ft?-1:this.Ft>n.Ft?1:this.Ot<n.Ot?-1:this.Ot>n.Ot?1:this.Ut<n.Ut?-1:this.Ut>n.Ut?1:0},qht.prototype.translate=function(e,n){if(this.isNull())return null;this.init(this.getMinX()+e,this.getMaxX()+e,this.getMinY()+n,this.getMaxY()+n)},qht.prototype.toString=function(){return"Env["+this.Tt+" : "+this.Ot+", "+this.Ft+" : "+this.Ut+"]"},qht.prototype.setToNull=function(){this.Tt=0,this.Ot=-1,this.Ft=0,this.Ut=-1},qht.prototype.getHeight=function(){return this.isNull()?0:this.Ut-this.Ft},qht.prototype.maxExtent=function(){if(this.isNull())return 0;var e=this.getWidth(),n=this.getHeight();return e>n?e:n},qht.prototype.expandBy=function(){if(1===arguments.length){var e=arguments[0];this.expandBy(e,e)}else if(2===arguments.length){var n=arguments[0],i=arguments[1];if(this.isNull())return null;this.Tt-=n,this.Ot+=n,this.Ft-=i,this.Ut+=i,(this.Tt>this.Ot||this.Ft>this.Ut)&&this.setToNull()}},qht.prototype.contains=function(){if(1===arguments.length){if(arguments[0]instanceof qht)return this.covers(arguments[0]);if(arguments[0]instanceof Cht)return this.covers(arguments[0])}else if(2===arguments.length){return this.covers(arguments[0],arguments[1])}},qht.prototype.centre=function(){return this.isNull()?null:new Cht((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)},qht.prototype.init=function(){if(0===arguments.length)this.setToNull();else if(1===arguments.length){if(arguments[0]instanceof Cht){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof qht){var n=arguments[0];this.Tt=n.Tt,this.Ot=n.Ot,this.Ft=n.Ft,this.Ut=n.Ut}}else if(2===arguments.length){var i=arguments[0],o=arguments[1];this.init(i.x,o.x,i.y,o.y)}else if(4===arguments.length){var s=arguments[0],a=arguments[1],h=arguments[2],l=arguments[3];s<a?(this.Tt=s,this.Ot=a):(this.Tt=a,this.Ot=s),h<l?(this.Ft=h,this.Ut=l):(this.Ft=l,this.Ut=h)}},qht.prototype.getMaxY=function(){return this.Ut},qht.prototype.distance=function(e){if(this.intersects(e))return 0;var n=0;this.Ot<e.Tt?n=e.Tt-this.Ot:this.Tt>e.Ot&&(n=this.Tt-e.Ot);var i=0;return this.Ut<e.Ft?i=e.Ft-this.Ut:this.Ft>e.Ut&&(i=this.Ft-e.Ut),0===n?i:0===i?n:Math.sqrt(n*n+i*i)},qht.prototype.hashCode=function(){var e=17;return 37*(e=37*(e=37*(e=37*e+Cht.hashCode(this.Tt))+Cht.hashCode(this.Ot))+Cht.hashCode(this.Ft))+Cht.hashCode(this.Ut)},qht.prototype.interfaces_=function(){return[_ht,wht]},qht.prototype.getClass=function(){return qht},qht.intersects=function(){if(3===arguments.length){var e=arguments[0],n=arguments[1],i=arguments[2];return i.x>=(e.x<n.x?e.x:n.x)&&i.x<=(e.x>n.x?e.x:n.x)&&i.y>=(e.y<n.y?e.y:n.y)&&i.y<=(e.y>n.y?e.y:n.y)}if(4===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2],h=arguments[3],l=Math.min(a.x,h.x),c=Math.max(a.x,h.x),A=Math.min(o.x,s.x),f=Math.max(o.x,s.x);return!(A>c||f<l||(l=Math.min(a.y,h.y),c=Math.max(a.y,h.y),A=Math.min(o.y,s.y),f=Math.max(o.y,s.y),A>c||f<l))}},Zht.serialVersionUID.get=function(){return 0x51845cd552189800},Object.defineProperties(qht,Zht);var Qht={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},Xht=function(e){this.geometryFactory=e||new kut};Xht.prototype.read=function(e){var n,i;e=e.replace(/[\n\r]/g," ");var o=Qht.typeStr.exec(e);if(-1!==e.search("EMPTY")&&((o=Qht.emptyTypeStr.exec(e))[2]=void 0),o&&(i=o[1].toLowerCase(),Jht[i]&&(n=Jht[i].apply(this,[o[2]]))),void 0===n)throw new Error("Could not parse WKT "+e);return n},Xht.prototype.write=function(e){return this.extractGeometry(e)},Xht.prototype.extractGeometry=function(e){var n=e.getGeometryType().toLowerCase();if(!Yht[n])return null;var i=n.toUpperCase();return e.isEmpty()?i+" EMPTY":i+"("+Yht[n].apply(this,[e])+")"};var Yht={coordinate:function(e){return e.x+" "+e.y},point:function(e){return Yht.coordinate.call(this,e.Et.Et[0])},multipoint:function(e){for(var n=[],i=0,o=e.Nt.length;i<o;++i)n.push("("+Yht.point.apply(this,[e.Nt[i]])+")");return n.join(",")},linestring:function(e){for(var n=[],i=0,o=e.jt.Et.length;i<o;++i)n.push(Yht.coordinate.apply(this,[e.jt.Et[i]]));return n.join(",")},linearring:function(e){for(var n=[],i=0,o=e.jt.Et.length;i<o;++i)n.push(Yht.coordinate.apply(this,[e.jt.Et[i]]));return n.join(",")},multilinestring:function(e){for(var n=[],i=0,o=e.Nt.length;i<o;++i)n.push("("+Yht.linestring.apply(this,[e.Nt[i]])+")");return n.join(",")},polygon:function(e){var n=[];n.push("("+Yht.linestring.apply(this,[e.Qt])+")");for(var i=0,o=e.St.length;i<o;++i)n.push("("+Yht.linestring.apply(this,[e.St[i]])+")");return n.join(",")},multipolygon:function(e){for(var n=[],i=0,o=e.Nt.length;i<o;++i)n.push("("+Yht.polygon.apply(this,[e.Nt[i]])+")");return n.join(",")},geometrycollection:function(e){for(var n=[],i=0,o=e.Nt.length;i<o;++i)n.push(this.extractGeometry(e.Nt[i]));return n.join(",")}},Jht={point:function(e){if(void 0===e)return this.geometryFactory.createPoint();var n=e.trim().split(Qht.spaces);return this.geometryFactory.createPoint(new Cht(Number.parseFloat(n[0]),Number.parseFloat(n[1])))},multipoint:function(e){var n;if(void 0===e)return this.geometryFactory.createMultiPoint();for(var i=e.trim().split(","),o=[],s=0,a=i.length;s<a;++s)n=i[s].replace(Qht.trimParens,"$1"),o.push(Jht.point.apply(this,[n]));return this.geometryFactory.createMultiPoint(o)},linestring:function(e){if(void 0===e)return this.geometryFactory.createLineString();for(var n,i=e.trim().split(","),o=[],s=0,a=i.length;s<a;++s)n=i[s].trim().split(Qht.spaces),o.push(new Cht(Number.parseFloat(n[0]),Number.parseFloat(n[1])));return this.geometryFactory.createLineString(o)},linearring:function(e){if(void 0===e)return this.geometryFactory.createLinearRing();for(var n,i=e.trim().split(","),o=[],s=0,a=i.length;s<a;++s)n=i[s].trim().split(Qht.spaces),o.push(new Cht(Number.parseFloat(n[0]),Number.parseFloat(n[1])));return this.geometryFactory.createLinearRing(o)},multilinestring:function(e){var n;if(void 0===e)return this.geometryFactory.createMultiLineString();for(var i=e.trim().split(Qht.parenComma),o=[],s=0,a=i.length;s<a;++s)n=i[s].replace(Qht.trimParens,"$1"),o.push(Jht.linestring.apply(this,[n]));return this.geometryFactory.createMultiLineString(o)},polygon:function(e){var n,i,o;if(void 0===e)return this.geometryFactory.createPolygon();for(var s,a=e.trim().split(Qht.parenComma),h=[],l=0,c=a.length;l<c;++l)n=a[l].replace(Qht.trimParens,"$1"),i=Jht.linestring.apply(this,[n]),o=this.geometryFactory.createLinearRing(i.jt),0===l?s=o:h.push(o);return this.geometryFactory.createPolygon(s,h)},multipolygon:function(e){var n;if(void 0===e)return this.geometryFactory.createMultiPolygon();for(var i=e.trim().split(Qht.doubleParenComma),o=[],s=0,a=i.length;s<a;++s)n=i[s].replace(Qht.trimParens,"$1"),o.push(Jht.polygon.apply(this,[n]));return this.geometryFactory.createMultiPolygon(o)},geometrycollection:function(e){if(void 0===e)return this.geometryFactory.createGeometryCollection();for(var n=(e=e.replace(/,\s*([A-Za-z])/g,"|$1")).trim().split("|"),i=[],o=0,s=n.length;o<s;++o)i.push(this.read(n[o]));return this.geometryFactory.createGeometryCollection(i)}},Kht=function(e){this.parser=new Xht(e)};Kht.prototype.write=function(e){return this.parser.write(e)},Kht.toLineString=function(e,n){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+e.x+" "+e.y+", "+n.x+" "+n.y+" )"};var $ht=function(e){function n(n){e.call(this,n),this.name="RuntimeException",this.message=n,this.stack=(new e).stack}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n}(Error),tlt=function(e){function n(){if(e.call(this),0===arguments.length)e.call(this);else if(1===arguments.length){e.call(this,arguments[0])}}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n}($ht),elt=function(){};elt.prototype.interfaces_=function(){return[]},elt.prototype.getClass=function(){return elt},elt.shouldNeverReachHere=function(){if(0===arguments.length)elt.shouldNeverReachHere(null);else if(1===arguments.length){var e=arguments[0];throw new tlt("Should never reach here"+(null!==e?": "+e:""))}},elt.isTrue=function(){var e;if(1===arguments.length)elt.isTrue(arguments[0],null);else if(2===arguments.length&&(e=arguments[1],!arguments[0]))throw null===e?new tlt:new tlt(e)},elt.equals=function(){var e,n,i;if(2===arguments.length)elt.equals(e=arguments[0],n=arguments[1],null);else if(3===arguments.length&&(i=arguments[2],!(n=arguments[1]).equals(e=arguments[0])))throw new tlt("Expected "+e+" but encountered "+n+(null!==i?": "+i:""))};var nlt=function(){this.Bt=null,this.kt=Array(2).fill().map((function(){return Array(2)})),this.Rt=new Array(2).fill(null),this.Gt=null,this.Yt=null,this.qt=null,this.Vt=null,this.Wt=null,this.Rt[0]=new Cht,this.Rt[1]=new Cht,this.qt=this.Rt[0],this.Vt=this.Rt[1],this.Bt=0},ilt={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};nlt.prototype.getIndexAlongSegment=function(e,n){return this.computeIntLineIndex(),this.Gt[e][n]},nlt.prototype.getTopologySummary=function(){var e=new Dht;return this.isEndPoint()&&e.append(" endpoint"),this.Yt&&e.append(" proper"),this.isCollinear()&&e.append(" collinear"),e.toString()},nlt.prototype.computeIntersection=function(e,n,i,o){this.kt[0][0]=e,this.kt[0][1]=n,this.kt[1][0]=i,this.kt[1][1]=o,this.Bt=this.computeIntersect(e,n,i,o)},nlt.prototype.getIntersectionNum=function(){return this.Bt},nlt.prototype.computeIntLineIndex=function(){if(0===arguments.length)null===this.Gt&&(this.Gt=Array(2).fill().map((function(){return Array(2)})),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){var e=arguments[0];this.getEdgeDistance(e,0)>this.getEdgeDistance(e,1)?(this.Gt[e][0]=0,this.Gt[e][1]=1):(this.Gt[e][0]=1,this.Gt[e][1]=0)}},nlt.prototype.isProper=function(){return this.hasIntersection()&&this.Yt},nlt.prototype.setPrecisionModel=function(e){this.Wt=e},nlt.prototype.isInteriorIntersection=function(){var e=this;if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var n=arguments[0],i=0;i<this.Bt;i++)if(!e.Rt[i].equals2D(e.kt[n][0])&&!e.Rt[i].equals2D(e.kt[n][1]))return!0;return!1}},nlt.prototype.getIntersection=function(e){return this.Rt[e]},nlt.prototype.isEndPoint=function(){return this.hasIntersection()&&!this.Yt},nlt.prototype.hasIntersection=function(){return this.Bt!==nlt.NO_INTERSECTION},nlt.prototype.getEdgeDistance=function(e,n){return nlt.computeEdgeDistance(this.Rt[n],this.kt[e][0],this.kt[e][1])},nlt.prototype.isCollinear=function(){return this.Bt===nlt.COLLINEAR_INTERSECTION},nlt.prototype.toString=function(){return Kht.toLineString(this.kt[0][0],this.kt[0][1])+" - "+Kht.toLineString(this.kt[1][0],this.kt[1][1])+this.getTopologySummary()},nlt.prototype.getEndpoint=function(e,n){return this.kt[e][n]},nlt.prototype.isIntersection=function(e){for(var n=0;n<this.Bt;n++)if(this.Rt[n].equals2D(e))return!0;return!1},nlt.prototype.getIntersectionAlongSegment=function(e,n){return this.computeIntLineIndex(),this.Rt[this.Gt[e][n]]},nlt.prototype.interfaces_=function(){return[]},nlt.prototype.getClass=function(){return nlt},nlt.computeEdgeDistance=function(e,n,i){var o=Math.abs(i.x-n.x),s=Math.abs(i.y-n.y),a=-1;if(e.equals(n))a=0;else if(e.equals(i))a=o>s?o:s;else{var h=Math.abs(e.x-n.x),l=Math.abs(e.y-n.y);0!==(a=o>s?h:l)||e.equals(n)||(a=Math.max(h,l))}return elt.isTrue(!(0===a&&!e.equals(n)),"Bad distance calculation"),a},nlt.nonRobustComputeEdgeDistance=function(e,n,i){var o=e.x-n.x,s=e.y-n.y,a=Math.sqrt(o*o+s*s);return elt.isTrue(!(0===a&&!e.equals(n)),"Invalid distance calculation"),a},ilt.DONT_INTERSECT.get=function(){return 0},ilt.DO_INTERSECT.get=function(){return 1},ilt.COLLINEAR.get=function(){return 2},ilt.NO_INTERSECTION.get=function(){return 0},ilt.POINT_INTERSECTION.get=function(){return 1},ilt.COLLINEAR_INTERSECTION.get=function(){return 2},Object.defineProperties(nlt,ilt);var rlt=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.isInSegmentEnvelopes=function(e){var n=new qht(this.kt[0][0],this.kt[0][1]),i=new qht(this.kt[1][0],this.kt[1][1]);return n.contains(e)&&i.contains(e)},n.prototype.computeIntersection=function(){if(3!==arguments.length)return e.prototype.computeIntersection.apply(this,arguments);var n=arguments[0],i=arguments[1],o=arguments[2];if(this.Yt=!1,qht.intersects(i,o,n)&&0===alt.orientationIndex(i,o,n)&&0===alt.orientationIndex(o,i,n))return this.Yt=!0,(n.equals(i)||n.equals(o))&&(this.Yt=!1),this.Bt=e.POINT_INTERSECTION,null;this.Bt=e.NO_INTERSECTION},n.prototype.normalizeToMinimum=function(e,n,i,o,s){s.x=this.smallestInAbsValue(e.x,n.x,i.x,o.x),s.y=this.smallestInAbsValue(e.y,n.y,i.y,o.y),e.x-=s.x,e.y-=s.y,n.x-=s.x,n.y-=s.y,i.x-=s.x,i.y-=s.y,o.x-=s.x,o.y-=s.y},n.prototype.safeHCoordinateIntersection=function(e,i,o,s){var a=null;try{a=Wht.intersection(e,i,o,s)}catch(h){if(!(h instanceof Ght))throw h;a=n.nearestEndpoint(e,i,o,s)}return a},n.prototype.intersection=function(e,i,o,s){var a=this.intersectionWithNormalization(e,i,o,s);return this.isInSegmentEnvelopes(a)||(a=new Cht(n.nearestEndpoint(e,i,o,s))),null!==this.Wt&&this.Wt.makePrecise(a),a},n.prototype.smallestInAbsValue=function(e,n,i,o){var s=e,a=Math.abs(s);return Math.abs(n)<a&&(s=n,a=Math.abs(n)),Math.abs(i)<a&&(s=i,a=Math.abs(i)),Math.abs(o)<a&&(s=o),s},n.prototype.checkDD=function(e,n,i,o,s){var a=zht.intersection(e,n,i,o),h=this.isInSegmentEnvelopes(a);Vht.out.println("DD in env = "+h+"  --------------------- "+a),s.distance(a)>1e-4&&Vht.out.println("Distance = "+s.distance(a))},n.prototype.intersectionWithNormalization=function(e,n,i,o){var s=new Cht(e),a=new Cht(n),h=new Cht(i),l=new Cht(o),c=new Cht;this.normalizeToEnvCentre(s,a,h,l,c);var A=this.safeHCoordinateIntersection(s,a,h,l);return A.x+=c.x,A.y+=c.y,A},n.prototype.computeCollinearIntersection=function(n,i,o,s){var a=qht.intersects(n,i,o),h=qht.intersects(n,i,s),l=qht.intersects(o,s,n),c=qht.intersects(o,s,i);return a&&h?(this.Rt[0]=o,this.Rt[1]=s,e.COLLINEAR_INTERSECTION):l&&c?(this.Rt[0]=n,this.Rt[1]=i,e.COLLINEAR_INTERSECTION):a&&l?(this.Rt[0]=o,this.Rt[1]=n,!o.equals(n)||h||c?e.COLLINEAR_INTERSECTION:e.POINT_INTERSECTION):a&&c?(this.Rt[0]=o,this.Rt[1]=i,!o.equals(i)||h||l?e.COLLINEAR_INTERSECTION:e.POINT_INTERSECTION):h&&l?(this.Rt[0]=s,this.Rt[1]=n,!s.equals(n)||a||c?e.COLLINEAR_INTERSECTION:e.POINT_INTERSECTION):h&&c?(this.Rt[0]=s,this.Rt[1]=i,!s.equals(i)||a||l?e.COLLINEAR_INTERSECTION:e.POINT_INTERSECTION):e.NO_INTERSECTION},n.prototype.normalizeToEnvCentre=function(e,n,i,o,s){var a=e.x<n.x?e.x:n.x,h=e.y<n.y?e.y:n.y,l=e.x>n.x?e.x:n.x,c=e.y>n.y?e.y:n.y,A=i.x<o.x?i.x:o.x,f=i.y<o.y?i.y:o.y,d=i.x>o.x?i.x:o.x,p=i.y>o.y?i.y:o.y,g=((h>f?h:f)+(c<p?c:p))/2;s.x=((a>A?a:A)+(l<d?l:d))/2,s.y=g,e.x-=s.x,e.y-=s.y,n.x-=s.x,n.y-=s.y,i.x-=s.x,i.y-=s.y,o.x-=s.x,o.y-=s.y},n.prototype.computeIntersect=function(n,i,o,s){if(this.Yt=!1,!qht.intersects(n,i,o,s))return e.NO_INTERSECTION;var a=alt.orientationIndex(n,i,o),h=alt.orientationIndex(n,i,s);if(a>0&&h>0||a<0&&h<0)return e.NO_INTERSECTION;var l=alt.orientationIndex(o,s,n),c=alt.orientationIndex(o,s,i);return l>0&&c>0||l<0&&c<0?e.NO_INTERSECTION:0===a&&0===h&&0===l&&0===c?this.computeCollinearIntersection(n,i,o,s):(0===a||0===h||0===l||0===c?(this.Yt=!1,n.equals2D(o)||n.equals2D(s)?this.Rt[0]=n:i.equals2D(o)||i.equals2D(s)?this.Rt[0]=i:0===a?this.Rt[0]=new Cht(o):0===h?this.Rt[0]=new Cht(s):0===l?this.Rt[0]=new Cht(n):0===c&&(this.Rt[0]=new Cht(i))):(this.Yt=!0,this.Rt[0]=this.intersection(n,i,o,s)),e.POINT_INTERSECTION)},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n.nearestEndpoint=function(e,n,i,o){var s=e,a=alt.distancePointLine(e,i,o),h=alt.distancePointLine(n,i,o);return h<a&&(a=h,s=n),(h=alt.distancePointLine(i,e,n))<a&&(a=h,s=i),(h=alt.distancePointLine(o,e,n))<a&&(a=h,s=o),s},n}(nlt),olt=function(){};olt.prototype.interfaces_=function(){return[]},olt.prototype.getClass=function(){return olt},olt.orientationIndex=function(e,n,i){return olt.signOfDet2x2(n.x-e.x,n.y-e.y,i.x-n.x,i.y-n.y)},olt.signOfDet2x2=function(e,n,i,o){var s=null,a=null,h=null;if(s=1,0===e||0===o)return 0===n||0===i?0:n>0?i>0?-s:s:i>0?s:-s;if(0===n||0===i)return o>0?e>0?s:-s:e>0?-s:s;if(n>0?o>0?n<=o||(s=-s,a=e,e=i,i=a,a=n,n=o,o=a):n<=-o?(s=-s,i=-i,o=-o):(a=e,e=-i,i=a,a=n,n=-o,o=a):o>0?-n<=o?(s=-s,e=-e,n=-n):(a=-e,e=i,i=a,a=-n,n=o,o=a):n>=o?(e=-e,n=-n,i=-i,o=-o):(s=-s,a=-e,e=-i,i=a,a=-n,n=-o,o=a),e>0){if(!(i>0))return s;if(!(e<=i))return s}else{if(i>0)return-s;if(!(e>=i))return-s;s=-s,e=-e,i=-i}for(;;){if((o-=(h=Math.floor(i/e))*n)<0)return-s;if(o>n)return s;if(e>(i-=h*e)+i){if(n<o+o)return s}else{if(n>o+o)return-s;i=e-i,o=n-o,s=-s}if(0===o)return 0===i?0:-s;if(0===i)return s;if((n-=(h=Math.floor(e/i))*o)<0)return s;if(n>o)return-s;if(i>(e-=h*i)+e){if(o<n+n)return-s}else{if(o>n+n)return s;e=i-e,n=o-n,s=-s}if(0===n)return 0===e?0:s;if(0===e)return-s}};var slt=function(){this._t=null,this.Kt=0,this.Ht=!1,this._t=arguments[0]};slt.prototype.countSegment=function(e,n){if(e.x<this._t.x&&n.x<this._t.x)return null;if(this._t.x===n.x&&this._t.y===n.y)return this.Ht=!0,null;if(e.y===this._t.y&&n.y===this._t.y){var i=e.x,o=n.x;return i>o&&(i=n.x,o=e.x),this._t.x>=i&&this._t.x<=o&&(this.Ht=!0),null}if(e.y>this._t.y&&n.y<=this._t.y||n.y>this._t.y&&e.y<=this._t.y){var s=e.y-this._t.y,a=n.y-this._t.y,h=olt.signOfDet2x2(e.x-this._t.x,s,n.x-this._t.x,a);if(0===h)return this.Ht=!0,null;a<s&&(h=-h),h>0&&this.Kt++}},slt.prototype.isPointInPolygon=function(){return this.getLocation()!==Sht.EXTERIOR},slt.prototype.getLocation=function(){return this.Ht?Sht.BOUNDARY:this.Kt%2==1?Sht.INTERIOR:Sht.EXTERIOR},slt.prototype.isOnSegment=function(){return this.Ht},slt.prototype.interfaces_=function(){return[]},slt.prototype.getClass=function(){return slt},slt.locatePointInRing=function(){if(arguments[0]instanceof Cht&&Eht(arguments[1],Hht)){for(var e=arguments[1],n=new slt(arguments[0]),i=new Cht,o=new Cht,s=1;s<e.size();s++)if(e.getCoordinate(s,i),e.getCoordinate(s-1,o),n.countSegment(i,o),n.isOnSegment())return n.getLocation();return n.getLocation()}if(arguments[0]instanceof Cht&&arguments[1]instanceof Array){for(var a=arguments[1],h=new slt(arguments[0]),l=1;l<a.length;l++){if(h.countSegment(a[l],a[l-1]),h.isOnSegment())return h.getLocation()}return h.getLocation()}};var alt=function(){},hlt={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};alt.prototype.interfaces_=function(){return[]},alt.prototype.getClass=function(){return alt},alt.orientationIndex=function(e,n,i){return zht.orientationIndex(e,n,i)},alt.signedArea=function(){if(arguments[0]instanceof Array){var e=arguments[0];if(e.length<3)return 0;for(var n=0,i=e[0].x,o=1;o<e.length-1;o++){n+=(e[o].x-i)*(e[o-1].y-e[o+1].y)}return n/2}if(Eht(arguments[0],Hht)){var s=arguments[0],a=s.size();if(a<3)return 0;var h=new Cht,l=new Cht,c=new Cht;s.getCoordinate(0,l),s.getCoordinate(1,c);var A=l.x;c.x-=A;for(var f=0,d=1;d<a-1;d++)h.y=l.y,l.x=c.x,l.y=c.y,s.getCoordinate(d+1,c),c.x-=A,f+=l.x*(h.y-c.y);return f/2}},alt.distanceLineLine=function(e,n,i,o){if(e.equals(n))return alt.distancePointLine(e,i,o);if(i.equals(o))return alt.distancePointLine(o,e,n);var s=!1;if(qht.intersects(e,n,i,o)){var a=(n.x-e.x)*(o.y-i.y)-(n.y-e.y)*(o.x-i.x);if(0===a)s=!0;else{var h=((e.y-i.y)*(n.x-e.x)-(e.x-i.x)*(n.y-e.y))/a,l=((e.y-i.y)*(o.x-i.x)-(e.x-i.x)*(o.y-i.y))/a;(l<0||l>1||h<0||h>1)&&(s=!0)}}else s=!0;return s?Oht.min(alt.distancePointLine(e,i,o),alt.distancePointLine(n,i,o),alt.distancePointLine(i,e,n),alt.distancePointLine(o,e,n)):0},alt.isPointInRing=function(e,n){return alt.locatePointInRing(e,n)!==Sht.EXTERIOR},alt.computeLength=function(e){var n=e.size();if(n<=1)return 0;var i=0,o=new Cht;e.getCoordinate(0,o);for(var s=o.x,a=o.y,h=1;h<n;h++){e.getCoordinate(h,o);var l=o.x,c=o.y,A=l-s,f=c-a;i+=Math.sqrt(A*A+f*f),s=l,a=c}return i},alt.isCCW=function(e){var n=e.length-1;if(n<3)throw new mht("Ring has fewer than 4 points, so orientation cannot be determined");for(var i=e[0],o=0,s=1;s<=n;s++){var a=e[s];a.y>i.y&&(i=a,o=s)}var h=o;do{(h-=1)<0&&(h=n)}while(e[h].equals2D(i)&&h!==o);var l=o;do{l=(l+1)%n}while(e[l].equals2D(i)&&l!==o);var c=e[h],A=e[l];if(c.equals2D(i)||A.equals2D(i)||c.equals2D(A))return!1;var f=alt.computeOrientation(c,i,A);return 0===f?c.x>A.x:f>0},alt.locatePointInRing=function(e,n){return slt.locatePointInRing(e,n)},alt.distancePointLinePerpendicular=function(e,n,i){var o=(i.x-n.x)*(i.x-n.x)+(i.y-n.y)*(i.y-n.y);return Math.abs(((n.y-e.y)*(i.x-n.x)-(n.x-e.x)*(i.y-n.y))/o)*Math.sqrt(o)},alt.computeOrientation=function(e,n,i){return alt.orientationIndex(e,n,i)},alt.distancePointLine=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];if(0===n.length)throw new mht("Line array must contain at least one vertex");for(var i=e.distance(n[0]),o=0;o<n.length-1;o++){var s=alt.distancePointLine(e,n[o],n[o+1]);s<i&&(i=s)}return i}if(3===arguments.length){var a=arguments[0],h=arguments[1],l=arguments[2];if(h.x===l.x&&h.y===l.y)return a.distance(h);var c=(l.x-h.x)*(l.x-h.x)+(l.y-h.y)*(l.y-h.y),A=((a.x-h.x)*(l.x-h.x)+(a.y-h.y)*(l.y-h.y))/c;return A<=0?a.distance(h):A>=1?a.distance(l):Math.abs(((h.y-a.y)*(l.x-h.x)-(h.x-a.x)*(l.y-h.y))/c)*Math.sqrt(c)}},alt.isOnLine=function(e,n){for(var i=new rlt,o=1;o<n.length;o++){if(i.computeIntersection(e,n[o-1],n[o]),i.hasIntersection())return!0}return!1},hlt.CLOCKWISE.get=function(){return-1},hlt.RIGHT.get=function(){return alt.CLOCKWISE},hlt.COUNTERCLOCKWISE.get=function(){return 1},hlt.LEFT.get=function(){return alt.COUNTERCLOCKWISE},hlt.COLLINEAR.get=function(){return 0},hlt.STRAIGHT.get=function(){return alt.COLLINEAR},Object.defineProperties(alt,hlt);var llt=function(){};llt.prototype.filter=function(e){},llt.prototype.interfaces_=function(){return[]},llt.prototype.getClass=function(){return llt};var ult=function(){var e=arguments[0];this.Jt=null,this.Zt=null,this.Xt=null,this.$t=null,this.Zt=e,this.Xt=e.getSRID()},clt={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};ult.prototype.isGeometryCollection=function(){return this.getSortIndex()===ult.SORTINDEX_GEOMETRYCOLLECTION},ult.prototype.getFactory=function(){return this.Zt},ult.prototype.getGeometryN=function(e){return this},ult.prototype.getArea=function(){return 0},ult.prototype.isRectangle=function(){return!1},ult.prototype.equals=function(){if(arguments[0]instanceof ult){var e=arguments[0];return null!==e&&this.equalsTopo(e)}if(arguments[0]instanceof Object){var n=arguments[0];return n instanceof ult&&this.equalsExact(n)}},ult.prototype.equalsExact=function(e){return this===e||this.equalsExact(e,0)},ult.prototype.geometryChanged=function(){this.apply(ult.geometryChangedFilter)},ult.prototype.geometryChangedAction=function(){this.Jt=null},ult.prototype.equalsNorm=function(e){return null!==e&&this.norm().equalsExact(e.norm())},ult.prototype.getLength=function(){return 0},ult.prototype.getNumGeometries=function(){return 1},ult.prototype.compareTo=function(){if(1===arguments.length){var e=arguments[0],n=e;return this.getSortIndex()!==n.getSortIndex()?this.getSortIndex()-n.getSortIndex():this.isEmpty()&&n.isEmpty()?0:this.isEmpty()?-1:n.isEmpty()?1:this.compareToSameClass(e)}if(2===arguments.length){var i=arguments[0],o=arguments[1];return this.getSortIndex()!==i.getSortIndex()?this.getSortIndex()-i.getSortIndex():this.isEmpty()&&i.isEmpty()?0:this.isEmpty()?-1:i.isEmpty()?1:this.compareToSameClass(i,o)}},ult.prototype.getUserData=function(){return this.$t},ult.prototype.getSRID=function(){return this.Xt},ult.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())},ult.prototype.checkNotGeometryCollection=function(e){if(e.getSortIndex()===ult.SORTINDEX_GEOMETRYCOLLECTION)throw new mht("This method does not support GeometryCollection arguments")},ult.prototype.equal=function(e,n,i){return 0===i?e.equals(n):e.distance(n)<=i},ult.prototype.norm=function(){var e=this.copy();return e.normalize(),e},ult.prototype.getPrecisionModel=function(){return this.Zt.getPrecisionModel()},ult.prototype.getEnvelopeInternal=function(){return null===this.Jt&&(this.Jt=this.computeEnvelopeInternal()),new qht(this.Jt)},ult.prototype.setSRID=function(e){this.Xt=e},ult.prototype.setUserData=function(e){this.$t=e},ult.prototype.compare=function(e,n){for(var i=e.iterator(),o=n.iterator();i.hasNext()&&o.hasNext();){var s=i.next(),a=o.next(),h=s.compareTo(a);if(0!==h)return h}return i.hasNext()?1:o.hasNext()?-1:0},ult.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()},ult.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===ult.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===ult.SORTINDEX_MULTIPOINT||this.getSortIndex()===ult.SORTINDEX_MULTILINESTRING||this.getSortIndex()===ult.SORTINDEX_MULTIPOLYGON},ult.prototype.interfaces_=function(){return[xht,_ht,wht]},ult.prototype.getClass=function(){return ult},ult.hasNonEmptyElements=function(e){for(var n=0;n<e.length;n++)if(!e[n].isEmpty())return!0;return!1},ult.hasNullElements=function(e){for(var n=0;n<e.length;n++)if(null===e[n])return!0;return!1},clt.serialVersionUID.get=function(){return 0x799ea46522854c00},clt.SORTINDEX_POINT.get=function(){return 0},clt.SORTINDEX_MULTIPOINT.get=function(){return 1},clt.SORTINDEX_LINESTRING.get=function(){return 2},clt.SORTINDEX_LINEARRING.get=function(){return 3},clt.SORTINDEX_MULTILINESTRING.get=function(){return 4},clt.SORTINDEX_POLYGON.get=function(){return 5},clt.SORTINDEX_MULTIPOLYGON.get=function(){return 6},clt.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7},clt.geometryChangedFilter.get=function(){return Alt},Object.defineProperties(ult,clt);var Alt=function(){};Alt.interfaces_=function(){return[llt]},Alt.filter=function(e){e.geometryChangedAction()};var flt=function(){};flt.prototype.filter=function(e){},flt.prototype.interfaces_=function(){return[]},flt.prototype.getClass=function(){return flt};var dlt=function(){},plt={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};dlt.prototype.isInBoundary=function(e){},dlt.prototype.interfaces_=function(){return[]},dlt.prototype.getClass=function(){return dlt},plt.Mod2BoundaryNodeRule.get=function(){return glt},plt.EndPointBoundaryNodeRule.get=function(){return mlt},plt.MultiValentEndPointBoundaryNodeRule.get=function(){return ylt},plt.MonoValentEndPointBoundaryNodeRule.get=function(){return vlt},plt.MOD2_BOUNDARY_RULE.get=function(){return new glt},plt.ENDPOINT_BOUNDARY_RULE.get=function(){return new mlt},plt.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new ylt},plt.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new vlt},plt.OGC_SFS_BOUNDARY_RULE.get=function(){return dlt.MOD2_BOUNDARY_RULE},Object.defineProperties(dlt,plt);var glt=function(){};glt.prototype.isInBoundary=function(e){return e%2==1},glt.prototype.interfaces_=function(){return[dlt]},glt.prototype.getClass=function(){return glt};var mlt=function(){};mlt.prototype.isInBoundary=function(e){return e>0},mlt.prototype.interfaces_=function(){return[dlt]},mlt.prototype.getClass=function(){return mlt};var ylt=function(){};ylt.prototype.isInBoundary=function(e){return e>1},ylt.prototype.interfaces_=function(){return[dlt]},ylt.prototype.getClass=function(){return ylt};var vlt=function(){};vlt.prototype.isInBoundary=function(e){return 1===e},vlt.prototype.interfaces_=function(){return[dlt]},vlt.prototype.getClass=function(){return vlt};var _lt=function(){};function xlt(e){this.message=e||""}_lt.prototype.add=function(){},_lt.prototype.addAll=function(){},_lt.prototype.isEmpty=function(){},_lt.prototype.iterator=function(){},_lt.prototype.size=function(){},_lt.prototype.toArray=function(){},_lt.prototype.remove=function(){},(xlt.prototype=new Error).name="IndexOutOfBoundsException";var blt=function(){};blt.prototype.hasNext=function(){},blt.prototype.next=function(){},blt.prototype.remove=function(){};var wlt=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.get=function(){},n.prototype.set=function(){},n.prototype.isEmpty=function(){},n}(_lt);function Clt(e){this.message=e||""}(Clt.prototype=new Error).name="NoSuchElementException";var Plt=function(e){function n(){e.call(this),this.array_=[],arguments[0]instanceof _lt&&this.addAll(arguments[0])}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.ensureCapacity=function(){},n.prototype.interfaces_=function(){return[e,_lt]},n.prototype.add=function(e){return 1===arguments.length?this.array_.push(e):this.array_.splice(arguments[0],arguments[1]),!0},n.prototype.clear=function(){this.array_=[]},n.prototype.addAll=function(e){for(var n=e.iterator();n.hasNext();)this.add(n.next());return!0},n.prototype.set=function(e,n){var i=this.array_[e];return this.array_[e]=n,i},n.prototype.iterator=function(){return new Mlt(this)},n.prototype.get=function(e){if(e<0||e>=this.size())throw new xlt;return this.array_[e]},n.prototype.isEmpty=function(){return 0===this.array_.length},n.prototype.size=function(){return this.array_.length},n.prototype.toArray=function(){for(var e=[],n=0,i=this.array_.length;n<i;n++)e.push(this.array_[n]);return e},n.prototype.remove=function(e){for(var n=!1,i=0,o=this.array_.length;i<o;i++)if(this.array_[i]===e){this.array_.splice(i,1),n=!0;break}return n},n}(wlt),Mlt=function(e){function n(n){e.call(this),this.arrayList_=n,this.position_=0}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new Clt;return this.arrayList_.get(this.position_++)},n.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},n.prototype.set=function(e){return this.arrayList_.set(this.position_-1,e)},n.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},n}(blt),Tlt=function(e){function n(){if(e.call(this),0===arguments.length);else if(1===arguments.length){var n=arguments[0];this.ensureCapacity(n.length),this.add(n,!0)}else if(2===arguments.length){var i=arguments[0],o=arguments[1];this.ensureCapacity(i.length),this.add(i,o)}}e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n;var i={coordArrayType:{configurable:!0}};return i.coordArrayType.get=function(){return new Array(0).fill(null)},n.prototype.getCoordinate=function(e){return this.get(e)},n.prototype.addAll=function(){if(2===arguments.length){for(var n=arguments[1],i=!1,o=arguments[0].iterator();o.hasNext();)this.add(o.next(),n),i=!0;return i}return e.prototype.addAll.apply(this,arguments)},n.prototype.clone=function(){for(var n=e.prototype.clone.call(this),i=0;i<this.size();i++)n.add(i,this.get(i).copy());return n},n.prototype.toCoordinateArray=function(){return this.toArray(n.coordArrayType)},n.prototype.add=function(){var n=this;if(1===arguments.length)e.prototype.add.call(this,arguments[0]);else if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1])return this.add(arguments[0],arguments[1],!0),!0;if(arguments[0]instanceof Cht&&"boolean"==typeof arguments[1]){var i=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(i))return null;e.prototype.add.call(this,i)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1]){return this.add(arguments[0],arguments[1]),!0}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var o=arguments[0],s=arguments[1];if(arguments[2])for(var a=0;a<o.length;a++)n.add(o[a],s);else for(var h=o.length-1;h>=0;h--)n.add(o[h],s);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof Cht){var l=arguments[0],c=arguments[1];if(!arguments[2]){var A=this.size();if(A>0){if(l>0&&this.get(l-1).equals2D(c))return null;if(l<A&&this.get(l).equals2D(c))return null}}e.prototype.add.call(this,l,c)}}else if(4===arguments.length){var f=arguments[0],d=arguments[1],p=arguments[2],g=arguments[3],v=1;p>g&&(v=-1);for(var w=p;w!==g;w+=v)n.add(f[w],d);return!0}},n.prototype.closeRing=function(){this.size()>0&&this.add(new Cht(this.get(0)),!1)},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},Object.defineProperties(n,i),n}(Plt),Slt=function(){},Ilt={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};Ilt.ForwardComparator.get=function(){return Elt},Ilt.BidirectionalComparator.get=function(){return Olt},Ilt.coordArrayType.get=function(){return new Array(0).fill(null)},Slt.prototype.interfaces_=function(){return[]},Slt.prototype.getClass=function(){return Slt},Slt.isRing=function(e){return!(e.length<4||!e[0].equals2D(e[e.length-1]))},Slt.ptNotInList=function(e,n){for(var i=0;i<e.length;i++){var o=e[i];if(Slt.indexOf(o,n)<0)return o}return null},Slt.scroll=function(e,n){var i=Slt.indexOf(n,e);if(i<0)return null;var o=new Array(e.length).fill(null);Vht.arraycopy(e,i,o,0,e.length-i),Vht.arraycopy(e,0,o,e.length-i,i),Vht.arraycopy(o,0,e,0,e.length)},Slt.equals=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];if(e===n)return!0;if(null===e||null===n)return!1;if(e.length!==n.length)return!1;for(var i=0;i<e.length;i++)if(!e[i].equals(n[i]))return!1;return!0}if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];if(o===s)return!0;if(null===o||null===s)return!1;if(o.length!==s.length)return!1;for(var h=0;h<o.length;h++)if(0!==a.compare(o[h],s[h]))return!1;return!0}},Slt.intersection=function(e,n){for(var i=new Tlt,o=0;o<e.length;o++)n.intersects(e[o])&&i.add(e[o],!0);return i.toCoordinateArray()},Slt.hasRepeatedPoints=function(e){for(var n=1;n<e.length;n++)if(e[n-1].equals(e[n]))return!0;return!1},Slt.removeRepeatedPoints=function(e){return Slt.hasRepeatedPoints(e)?new Tlt(e,!1).toCoordinateArray():e},Slt.reverse=function(e){for(var n=e.length-1,i=Math.trunc(n/2),o=0;o<=i;o++){var s=e[o];e[o]=e[n-o],e[n-o]=s}},Slt.removeNull=function(e){for(var n=0,i=0;i<e.length;i++)null!==e[i]&&n++;var o=new Array(n).fill(null);if(0===n)return o;for(var s=0,a=0;a<e.length;a++)null!==e[a]&&(o[s++]=e[a]);return o},Slt.copyDeep=function(){if(1===arguments.length){for(var e=arguments[0],n=new Array(e.length).fill(null),i=0;i<e.length;i++)n[i]=new Cht(e[i]);return n}if(5===arguments.length)for(var o=arguments[0],s=arguments[1],a=arguments[2],h=arguments[3],l=arguments[4],c=0;c<l;c++)a[h+c]=new Cht(o[s+c])},Slt.isEqualReversed=function(e,n){for(var i=0;i<e.length;i++){if(0!==e[i].compareTo(n[e.length-i-1]))return!1}return!0},Slt.envelope=function(e){for(var n=new qht,i=0;i<e.length;i++)n.expandToInclude(e[i]);return n},Slt.toCoordinateArray=function(e){return e.toArray(Slt.coordArrayType)},Slt.atLeastNCoordinatesOrNothing=function(e,n){return n.length>=e?n:[]},Slt.indexOf=function(e,n){for(var i=0;i<n.length;i++)if(e.equals(n[i]))return i;return-1},Slt.increasingDirection=function(e){for(var n=0;n<Math.trunc(e.length/2);n++){var i=e[n].compareTo(e[e.length-1-n]);if(0!==i)return i}return 1},Slt.compare=function(e,n){for(var i=0;i<e.length&&i<n.length;){var o=e[i].compareTo(n[i]);if(0!==o)return o;i++}return i<n.length?-1:i<e.length?1:0},Slt.minCoordinate=function(e){for(var n=null,i=0;i<e.length;i++)(null===n||n.compareTo(e[i])>0)&&(n=e[i]);return n},Slt.extract=function(e,n,i){n=Oht.clamp(n,0,e.length);var o=(i=Oht.clamp(i,-1,e.length))-n+1;i<0&&(o=0),n>=e.length&&(o=0),i<n&&(o=0);var s=new Array(o).fill(null);if(0===o)return s;for(var a=0,h=n;h<=i;h++)s[a++]=e[h];return s},Object.defineProperties(Slt,Ilt);var Elt=function(){};Elt.prototype.compare=function(e,n){return Slt.compare(e,n)},Elt.prototype.interfaces_=function(){return[bht]},Elt.prototype.getClass=function(){return Elt};var Olt=function(){};Olt.prototype.compare=function(e,n){var i=e,o=n;if(i.length<o.length)return-1;if(i.length>o.length)return 1;if(0===i.length)return 0;var s=Slt.compare(i,o);return Slt.isEqualReversed(i,o)?0:s},Olt.prototype.OLDcompare=function(e,n){var i=e,o=n;if(i.length<o.length)return-1;if(i.length>o.length)return 1;if(0===i.length)return 0;for(var s=Slt.increasingDirection(i),a=Slt.increasingDirection(o),h=s>0?0:i.length-1,l=a>0?0:i.length-1,c=0;c<i.length;c++){var A=i[h].compareTo(o[l]);if(0!==A)return A;h+=s,l+=a}return 0},Olt.prototype.interfaces_=function(){return[bht]},Olt.prototype.getClass=function(){return Olt};var Rlt=function(){};Rlt.prototype.get=function(){},Rlt.prototype.put=function(){},Rlt.prototype.size=function(){},Rlt.prototype.values=function(){},Rlt.prototype.entrySet=function(){};var Dlt=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n}(Rlt);function klt(e){this.message=e||""}function Llt(){}(klt.prototype=new Error).name="OperationNotSupported",(Llt.prototype=new _lt).contains=function(){};var Flt=function(e){function n(){e.call(this),this.array_=[],arguments[0]instanceof _lt&&this.addAll(arguments[0])}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.contains=function(e){for(var n=0,i=this.array_.length;n<i;n++)if(this.array_[n]===e)return!0;return!1},n.prototype.add=function(e){return!this.contains(e)&&(this.array_.push(e),!0)},n.prototype.addAll=function(e){for(var n=e.iterator();n.hasNext();)this.add(n.next());return!0},n.prototype.remove=function(e){throw new Error},n.prototype.size=function(){return this.array_.length},n.prototype.isEmpty=function(){return 0===this.array_.length},n.prototype.toArray=function(){for(var e=[],n=0,i=this.array_.length;n<i;n++)e.push(this.array_[n]);return e},n.prototype.iterator=function(){return new Nlt(this)},n}(Llt),Nlt=function(e){function n(n){e.call(this),this.hashSet_=n,this.position_=0}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new Clt;return this.hashSet_.array_[this.position_++]},n.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},n.prototype.remove=function(){throw new klt},n}(blt);function zlt(e){return null===e?0:e.color}function Blt(e){return null===e?null:e.parent}function Hlt(e,n){null!==e&&(e.color=n)}function jlt(e){return null===e?null:e.left}function Ult(e){return null===e?null:e.right}function Glt(){this.root_=null,this.size_=0}(Glt.prototype=new Dlt).get=function(e){for(var n=this.root_;null!==n;){var i=e.compareTo(n.key);if(i<0)n=n.left;else{if(!(i>0))return n.value;n=n.right}}return null},Glt.prototype.put=function(e,n){if(null===this.root_)return this.root_={key:e,value:n,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var i,o,s=this.root_;do{if(i=s,(o=e.compareTo(s.key))<0)s=s.left;else{if(!(o>0)){var a=s.value;return s.value=n,a}s=s.right}}while(null!==s);var h={key:e,left:null,right:null,value:n,parent:i,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return o<0?i.left=h:i.right=h,this.fixAfterInsertion(h),this.size_++,null},Glt.prototype.fixAfterInsertion=function(e){var n=this;for(e.color=1;null!=e&&e!==this.root_&&1===e.parent.color;)if(Blt(e)===jlt(Blt(Blt(e)))){var i=Ult(Blt(Blt(e)));1===zlt(i)?(Hlt(Blt(e),0),Hlt(i,0),Hlt(Blt(Blt(e)),1),e=Blt(Blt(e))):(e===Ult(Blt(e))&&(e=Blt(e),n.rotateLeft(e)),Hlt(Blt(e),0),Hlt(Blt(Blt(e)),1),n.rotateRight(Blt(Blt(e))))}else{var o=jlt(Blt(Blt(e)));1===zlt(o)?(Hlt(Blt(e),0),Hlt(o,0),Hlt(Blt(Blt(e)),1),e=Blt(Blt(e))):(e===jlt(Blt(e))&&(e=Blt(e),n.rotateRight(e)),Hlt(Blt(e),0),Hlt(Blt(Blt(e)),1),n.rotateLeft(Blt(Blt(e))))}this.root_.color=0},Glt.prototype.values=function(){var e=new Plt,n=this.getFirstEntry();if(null!==n)for(e.add(n.value);null!==(n=Glt.successor(n));)e.add(n.value);return e},Glt.prototype.entrySet=function(){var e=new Flt,n=this.getFirstEntry();if(null!==n)for(e.add(n);null!==(n=Glt.successor(n));)e.add(n);return e},Glt.prototype.rotateLeft=function(e){if(null!=e){var n=e.right;e.right=n.left,null!=n.left&&(n.left.parent=e),n.parent=e.parent,null===e.parent?this.root_=n:e.parent.left===e?e.parent.left=n:e.parent.right=n,n.left=e,e.parent=n}},Glt.prototype.rotateRight=function(e){if(null!=e){var n=e.left;e.left=n.right,null!=n.right&&(n.right.parent=e),n.parent=e.parent,null===e.parent?this.root_=n:e.parent.right===e?e.parent.right=n:e.parent.left=n,n.right=e,e.parent=n}},Glt.prototype.getFirstEntry=function(){var e=this.root_;if(null!=e)for(;null!=e.left;)e=e.left;return e},Glt.successor=function(e){if(null===e)return null;if(null!==e.right){for(var n=e.right;null!==n.left;)n=n.left;return n}for(var i=e.parent,o=e;null!==i&&o===i.right;)o=i,i=i.parent;return i},Glt.prototype.size=function(){return this.size_};var Vlt=function(){};function Wlt(){}function qlt(){this.array_=[],arguments[0]instanceof _lt&&this.addAll(arguments[0])}Vlt.prototype.interfaces_=function(){return[]},Vlt.prototype.getClass=function(){return Vlt},Wlt.prototype=new Llt,(qlt.prototype=new Wlt).contains=function(e){for(var n=0,i=this.array_.length;n<i;n++)if(0===this.array_[n].compareTo(e))return!0;return!1},qlt.prototype.add=function(e){if(this.contains(e))return!1;for(var n=0,i=this.array_.length;n<i;n++)if(1===this.array_[n].compareTo(e))return this.array_.splice(n,0,e),!0;return this.array_.push(e),!0},qlt.prototype.addAll=function(e){for(var n=e.iterator();n.hasNext();)this.add(n.next());return!0},qlt.prototype.remove=function(e){throw new klt},qlt.prototype.size=function(){return this.array_.length},qlt.prototype.isEmpty=function(){return 0===this.array_.length},qlt.prototype.toArray=function(){for(var e=[],n=0,i=this.array_.length;n<i;n++)e.push(this.array_[n]);return e},qlt.prototype.iterator=function(){return new Zlt(this)};var Zlt=function(e){this.treeSet_=e,this.position_=0};Zlt.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new Clt;return this.treeSet_.array_[this.position_++]},Zlt.prototype.hasNext=function(){return this.position_<this.treeSet_.size()},Zlt.prototype.remove=function(){throw new klt};var Qlt=function(){};Qlt.sort=function(){var e,n,i,o,s=arguments[0];if(1===arguments.length)o=function(e,n){return e.compareTo(n)},s.sort(o);else if(2===arguments.length)i=arguments[1],o=function(e,n){return i.compare(e,n)},s.sort(o);else if(3===arguments.length){(n=s.slice(arguments[1],arguments[2])).sort();var a=s.slice(0,arguments[1]).concat(n,s.slice(arguments[2],s.length));for(s.splice(0,s.length),e=0;e<a.length;e++)s.push(a[e])}else if(4===arguments.length)for(n=s.slice(arguments[1],arguments[2]),i=arguments[3],o=function(e,n){return i.compare(e,n)},n.sort(o),a=s.slice(0,arguments[1]).concat(n,s.slice(arguments[2],s.length)),s.splice(0,s.length),e=0;e<a.length;e++)s.push(a[e])},Qlt.asList=function(e){for(var n=new Plt,i=0,o=e.length;i<o;i++)n.add(e[i]);return n};var Xlt=function(){},Ylt={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};Ylt.P.get=function(){return 0},Ylt.L.get=function(){return 1},Ylt.A.get=function(){return 2},Ylt.FALSE.get=function(){return-1},Ylt.TRUE.get=function(){return-2},Ylt.DONTCARE.get=function(){return-3},Ylt.SYM_FALSE.get=function(){return"F"},Ylt.SYM_TRUE.get=function(){return"T"},Ylt.SYM_DONTCARE.get=function(){return"*"},Ylt.SYM_P.get=function(){return"0"},Ylt.SYM_L.get=function(){return"1"},Ylt.SYM_A.get=function(){return"2"},Xlt.prototype.interfaces_=function(){return[]},Xlt.prototype.getClass=function(){return Xlt},Xlt.toDimensionSymbol=function(e){switch(e){case Xlt.FALSE:return Xlt.SYM_FALSE;case Xlt.TRUE:return Xlt.SYM_TRUE;case Xlt.DONTCARE:return Xlt.SYM_DONTCARE;case Xlt.P:return Xlt.SYM_P;case Xlt.L:return Xlt.SYM_L;case Xlt.A:return Xlt.SYM_A}throw new mht("Unknown dimension value: "+e)},Xlt.toDimensionValue=function(e){switch(Lht.toUpperCase(e)){case Xlt.SYM_FALSE:return Xlt.FALSE;case Xlt.SYM_TRUE:return Xlt.TRUE;case Xlt.SYM_DONTCARE:return Xlt.DONTCARE;case Xlt.SYM_P:return Xlt.P;case Xlt.SYM_L:return Xlt.L;case Xlt.SYM_A:return Xlt.A}throw new mht("Unknown dimension symbol: "+e)},Object.defineProperties(Xlt,Ylt);var Jlt=function(){};Jlt.prototype.filter=function(e){},Jlt.prototype.interfaces_=function(){return[]},Jlt.prototype.getClass=function(){return Jlt};var Klt=function(){};Klt.prototype.filter=function(e,n){},Klt.prototype.isDone=function(){},Klt.prototype.isGeometryChanged=function(){},Klt.prototype.interfaces_=function(){return[]},Klt.prototype.getClass=function(){return Klt};var $lt=function(e){function n(n,i){if(e.call(this,i),this.Nt=n||[],e.hasNullElements(this.Nt))throw new mht("geometries must not contain null elements")}e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n;var i={serialVersionUID:{configurable:!0}};return n.prototype.computeEnvelopeInternal=function(){for(var e=new qht,n=0;n<this.Nt.length;n++)e.expandToInclude(this.Nt[n].getEnvelopeInternal());return e},n.prototype.getGeometryN=function(e){return this.Nt[e]},n.prototype.getSortIndex=function(){return e.SORTINDEX_GEOMETRYCOLLECTION},n.prototype.getCoordinates=function(){for(var e=new Array(this.getNumPoints()).fill(null),n=-1,i=0;i<this.Nt.length;i++)for(var o=this.Nt[i].getCoordinates(),s=0;s<o.length;s++)e[++n]=o[s];return e},n.prototype.getArea=function(){for(var e=0,n=0;n<this.Nt.length;n++)e+=this.Nt[n].getArea();return e},n.prototype.equalsExact=function(){if(2===arguments.length){var n=arguments[0],i=arguments[1];if(!this.isEquivalentClass(n))return!1;var o=n;if(this.Nt.length!==o.Nt.length)return!1;for(var s=0;s<this.Nt.length;s++)if(!this.Nt[s].equalsExact(o.Nt[s],i))return!1;return!0}return e.prototype.equalsExact.apply(this,arguments)},n.prototype.normalize=function(){for(var e=0;e<this.Nt.length;e++)this.Nt[e].normalize();Qlt.sort(this.Nt)},n.prototype.getCoordinate=function(){return this.isEmpty()?null:this.Nt[0].getCoordinate()},n.prototype.getBoundaryDimension=function(){for(var e=Xlt.FALSE,n=0;n<this.Nt.length;n++)e=Math.max(e,this.Nt[n].getBoundaryDimension());return e},n.prototype.getDimension=function(){for(var e=Xlt.FALSE,n=0;n<this.Nt.length;n++)e=Math.max(e,this.Nt[n].getDimension());return e},n.prototype.getLength=function(){for(var e=0,n=0;n<this.Nt.length;n++)e+=this.Nt[n].getLength();return e},n.prototype.getNumPoints=function(){for(var e=0,n=0;n<this.Nt.length;n++)e+=this.Nt[n].getNumPoints();return e},n.prototype.getNumGeometries=function(){return this.Nt.length},n.prototype.reverse=function(){for(var e=new Array(this.Nt.length).fill(null),n=0;n<this.Nt.length;n++)e[n]=this.Nt[n].reverse();return this.getFactory().createGeometryCollection(e)},n.prototype.compareToSameClass=function(){if(1===arguments.length){var e=arguments[0],n=new qlt(Qlt.asList(this.Nt)),i=new qlt(Qlt.asList(e.Nt));return this.compare(n,i)}if(2===arguments.length){for(var o=arguments[1],s=arguments[0],a=this.getNumGeometries(),h=s.getNumGeometries(),l=0;l<a&&l<h;){var c=this.getGeometryN(l),A=s.getGeometryN(l),f=c.compareToSameClass(A,o);if(0!==f)return f;l++}return l<a?1:l<h?-1:0}},n.prototype.apply=function(){var e=this;if(Eht(arguments[0],flt))for(var n=arguments[0],i=0;i<this.Nt.length;i++)e.Nt[i].apply(n);else if(Eht(arguments[0],Klt)){var o=arguments[0];if(0===this.Nt.length)return null;for(var s=0;s<this.Nt.length&&(e.Nt[s].apply(o),!o.isDone());s++);o.isGeometryChanged()&&this.geometryChanged()}else if(Eht(arguments[0],Jlt)){var a=arguments[0];a.filter(this);for(var h=0;h<this.Nt.length;h++)e.Nt[h].apply(a)}else if(Eht(arguments[0],llt)){var l=arguments[0];l.filter(this);for(var c=0;c<this.Nt.length;c++)e.Nt[c].apply(l)}},n.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),elt.shouldNeverReachHere(),null},n.prototype.clone=function(){var n=e.prototype.clone.call(this);n.Nt=new Array(this.Nt.length).fill(null);for(var i=0;i<this.Nt.length;i++)n.Nt[i]=this.Nt[i].clone();return n},n.prototype.getGeometryType=function(){return"GeometryCollection"},n.prototype.copy=function(){for(var e=new Array(this.Nt.length).fill(null),i=0;i<e.length;i++)e[i]=this.Nt[i].copy();return new n(e,this.Zt)},n.prototype.isEmpty=function(){for(var e=0;e<this.Nt.length;e++)if(!this.Nt[e].isEmpty())return!1;return!0},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},i.serialVersionUID.get=function(){return-0x4f07bcb1f857d800},Object.defineProperties(n,i),n}(ult),tut=function(e){function n(){e.apply(this,arguments)}e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n;var i={serialVersionUID:{configurable:!0}};return n.prototype.getSortIndex=function(){return ult.SORTINDEX_MULTILINESTRING},n.prototype.equalsExact=function(){if(2===arguments.length){var n=arguments[0],i=arguments[1];return!!this.isEquivalentClass(n)&&e.prototype.equalsExact.call(this,n,i)}return e.prototype.equalsExact.apply(this,arguments)},n.prototype.getBoundaryDimension=function(){return this.isClosed()?Xlt.FALSE:0},n.prototype.isClosed=function(){if(this.isEmpty())return!1;for(var e=0;e<this.Nt.length;e++)if(!this.Nt[e].isClosed())return!1;return!0},n.prototype.getDimension=function(){return 1},n.prototype.reverse=function(){for(var e=this.Nt.length,n=new Array(e).fill(null),i=0;i<this.Nt.length;i++)n[e-1-i]=this.Nt[i].reverse();return this.getFactory().createMultiLineString(n)},n.prototype.getBoundary=function(){return new eut(this).getBoundary()},n.prototype.getGeometryType=function(){return"MultiLineString"},n.prototype.copy=function(){for(var e=new Array(this.Nt.length).fill(null),i=0;i<e.length;i++)e[i]=this.Nt[i].copy();return new n(e,this.Zt)},n.prototype.interfaces_=function(){return[Vlt]},n.prototype.getClass=function(){return n},i.serialVersionUID.get=function(){return 0x7155d2ab4afa8000},Object.defineProperties(n,i),n}($lt),eut=function(){if(this.An=null,this.tn=null,this.nn=null,this.rn=null,1===arguments.length){var e=arguments[0],n=dlt.MOD2_BOUNDARY_RULE;this.An=e,this.tn=e.getFactory(),this.nn=n}else if(2===arguments.length){var i=arguments[0],o=arguments[1];this.An=i,this.tn=i.getFactory(),this.nn=o}};eut.prototype.boundaryMultiLineString=function(e){if(this.An.isEmpty())return this.getEmptyMultiPoint();var n=this.computeBoundaryCoordinates(e);return 1===n.length?this.tn.createPoint(n[0]):this.tn.createMultiPointFromCoords(n)},eut.prototype.getBoundary=function(){return this.An instanceof Aut?this.boundaryLineString(this.An):this.An instanceof tut?this.boundaryMultiLineString(this.An):this.An.getBoundary()},eut.prototype.boundaryLineString=function(e){return this.An.isEmpty()?this.getEmptyMultiPoint():e.isClosed()?this.nn.isInBoundary(2)?e.getStartPoint():this.tn.createMultiPoint():this.tn.createMultiPoint([e.getStartPoint(),e.getEndPoint()])},eut.prototype.getEmptyMultiPoint=function(){return this.tn.createMultiPoint()},eut.prototype.computeBoundaryCoordinates=function(e){var n=this,i=new Plt;this.rn=new Glt;for(var o=0;o<e.getNumGeometries();o++){var s=e.getGeometryN(o);0!==s.getNumPoints()&&(n.addEndpoint(s.getCoordinateN(0)),n.addEndpoint(s.getCoordinateN(s.getNumPoints()-1)))}for(var a=this.rn.entrySet().iterator();a.hasNext();){var h=a.next(),l=h.getValue().count;n.nn.isInBoundary(l)&&i.add(h.getKey())}return Slt.toCoordinateArray(i)},eut.prototype.addEndpoint=function(e){var n=this.rn.get(e);null===n&&(n=new nut,this.rn.put(e,n)),n.count++},eut.prototype.interfaces_=function(){return[]},eut.prototype.getClass=function(){return eut},eut.getBoundary=function(){return 1===arguments.length?new eut(arguments[0]).getBoundary():2===arguments.length?new eut(arguments[0],arguments[1]).getBoundary():void 0};var nut=function(){this.count=null};function iut(){}function rut(){}nut.prototype.interfaces_=function(){return[]},nut.prototype.getClass=function(){return nut};var out=function(){};function sut(){}function aut(){}function hut(){}var lut=function(){},uut={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};lut.prototype.interfaces_=function(){return[]},lut.prototype.getClass=function(){return lut},lut.chars=function(e,n){for(var i=new Array(n).fill(null),o=0;o<n;o++)i[o]=e;return String(i)},lut.getStackTrace=function(){if(1===arguments.length){var e=arguments[0],n=new sut,i=new iut;return e.printStackTrace(i),n.toString()}if(2===arguments.length){var o=arguments[1],s="";new rut(lut.getStackTrace(arguments[0]));for(var a=new hut,h=0;h<o;h++)try{s+=a.readLine()+lut.NEWLINE}catch(e){if(!(e instanceof aut))throw e;elt.shouldNeverReachHere()}return s}},lut.split=function(e,n){for(var i=n.length,o=new Plt,s=""+e,a=s.indexOf(n);a>=0;){var h=s.substring(0,a);o.add(h),a=(s=s.substring(a+i)).indexOf(n)}s.length>0&&o.add(s);for(var l=new Array(o.size()).fill(null),c=0;c<l.length;c++)l[c]=o.get(c);return l},lut.toString=function(){if(1===arguments.length)return lut.SIMPLE_ORDINATE_FORMAT.format(arguments[0])},lut.spaces=function(e){return lut.chars(" ",e)},uut.NEWLINE.get=function(){return Vht.getProperty("line.separator")},uut.SIMPLE_ORDINATE_FORMAT.get=function(){return new out},Object.defineProperties(lut,uut);var cut=function(){};cut.prototype.interfaces_=function(){return[]},cut.prototype.getClass=function(){return cut},cut.copyCoord=function(e,n,i,o){for(var s=Math.min(e.getDimension(),i.getDimension()),a=0;a<s;a++)i.setOrdinate(o,a,e.getOrdinate(n,a))},cut.isRing=function(e){var n=e.size();return 0===n||!(n<=3)&&e.getOrdinate(0,Hht.X)===e.getOrdinate(n-1,Hht.X)&&e.getOrdinate(0,Hht.Y)===e.getOrdinate(n-1,Hht.Y)},cut.isEqual=function(e,n){var i=e.size();if(i!==n.size())return!1;for(var o=Math.min(e.getDimension(),n.getDimension()),s=0;s<i;s++)for(var a=0;a<o;a++){var h=e.getOrdinate(s,a),l=n.getOrdinate(s,a);if(!(e.getOrdinate(s,a)===n.getOrdinate(s,a)||yht.isNaN(h)&&yht.isNaN(l)))return!1}return!0},cut.extend=function(e,n,i){var o=e.create(i,n.getDimension()),s=n.size();if(cut.copy(n,0,o,0,s),s>0)for(var a=s;a<i;a++)cut.copy(n,s-1,o,a,1);return o},cut.reverse=function(e){for(var n=e.size()-1,i=Math.trunc(n/2),o=0;o<=i;o++)cut.swap(e,o,n-o)},cut.swap=function(e,n,i){if(n===i)return null;for(var o=0;o<e.getDimension();o++){var s=e.getOrdinate(n,o);e.setOrdinate(n,o,e.getOrdinate(i,o)),e.setOrdinate(i,o,s)}},cut.copy=function(e,n,i,o,s){for(var a=0;a<s;a++)cut.copyCoord(e,n+a,i,o+a)},cut.toString=function(){if(1===arguments.length){var e=arguments[0],n=e.size();if(0===n)return"()";var i=e.getDimension(),o=new Dht;o.append("(");for(var s=0;s<n;s++){s>0&&o.append(" ");for(var a=0;a<i;a++)a>0&&o.append(","),o.append(lut.toString(e.getOrdinate(s,a)))}return o.append(")"),o.toString()}},cut.ensureValidRing=function(e,n){var i=n.size();return 0===i?n:i<=3?cut.createClosedRing(e,n,4):n.getOrdinate(0,Hht.X)===n.getOrdinate(i-1,Hht.X)&&n.getOrdinate(0,Hht.Y)===n.getOrdinate(i-1,Hht.Y)?n:cut.createClosedRing(e,n,i+1)},cut.createClosedRing=function(e,n,i){var o=e.create(i,n.getDimension()),s=n.size();cut.copy(n,0,o,0,s);for(var a=s;a<i;a++)cut.copy(n,0,o,a,1);return o};var Aut=function(e){function n(n,i){e.call(this,i),this.jt=null,this.init(n)}e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n;var i={serialVersionUID:{configurable:!0}};return n.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new qht:this.jt.expandEnvelope(new qht)},n.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},n.prototype.getSortIndex=function(){return e.SORTINDEX_LINESTRING},n.prototype.getCoordinates=function(){return this.jt.toCoordinateArray()},n.prototype.equalsExact=function(){if(2===arguments.length){var n=arguments[0],i=arguments[1];if(!this.isEquivalentClass(n))return!1;var o=n;if(this.jt.size()!==o.jt.size())return!1;for(var s=0;s<this.jt.size();s++)if(!this.equal(this.jt.getCoordinate(s),o.jt.getCoordinate(s),i))return!1;return!0}return e.prototype.equalsExact.apply(this,arguments)},n.prototype.normalize=function(){for(var e=this,n=0;n<Math.trunc(this.jt.size()/2);n++){var i=e.jt.size()-1-n;if(!e.jt.getCoordinate(n).equals(e.jt.getCoordinate(i)))return e.jt.getCoordinate(n).compareTo(e.jt.getCoordinate(i))>0&&cut.reverse(e.jt),null}},n.prototype.getCoordinate=function(){return this.isEmpty()?null:this.jt.getCoordinate(0)},n.prototype.getBoundaryDimension=function(){return this.isClosed()?Xlt.FALSE:0},n.prototype.isClosed=function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},n.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},n.prototype.getDimension=function(){return 1},n.prototype.getLength=function(){return alt.computeLength(this.jt)},n.prototype.getNumPoints=function(){return this.jt.size()},n.prototype.reverse=function(){var e=this.jt.copy();return cut.reverse(e),this.getFactory().createLineString(e)},n.prototype.compareToSameClass=function(){if(1===arguments.length){for(var e=arguments[0],n=0,i=0;n<this.jt.size()&&i<e.jt.size();){var o=this.jt.getCoordinate(n).compareTo(e.jt.getCoordinate(i));if(0!==o)return o;n++,i++}return n<this.jt.size()?1:i<e.jt.size()?-1:0}if(2===arguments.length)return arguments[1].compare(this.jt,arguments[0].jt)},n.prototype.apply=function(){if(Eht(arguments[0],flt))for(var e=arguments[0],n=0;n<this.jt.size();n++)e.filter(this.jt.getCoordinate(n));else if(Eht(arguments[0],Klt)){var i=arguments[0];if(0===this.jt.size())return null;for(var o=0;o<this.jt.size()&&(i.filter(this.jt,o),!i.isDone());o++);i.isGeometryChanged()&&this.geometryChanged()}else(Eht(arguments[0],Jlt)||Eht(arguments[0],llt))&&arguments[0].filter(this)},n.prototype.getBoundary=function(){return new eut(this).getBoundary()},n.prototype.isEquivalentClass=function(e){return e instanceof n},n.prototype.clone=function(){var n=e.prototype.clone.call(this);return n.jt=this.jt.clone(),n},n.prototype.getCoordinateN=function(e){return this.jt.getCoordinate(e)},n.prototype.getGeometryType=function(){return"LineString"},n.prototype.copy=function(){return new n(this.jt.copy(),this.Zt)},n.prototype.getCoordinateSequence=function(){return this.jt},n.prototype.isEmpty=function(){return 0===this.jt.size()},n.prototype.init=function(e){if(null===e&&(e=this.getFactory().getCoordinateSequenceFactory().create([])),1===e.size())throw new mht("Invalid number of points in LineString (found "+e.size()+" - must be 0 or >= 2)");this.jt=e},n.prototype.isCoordinate=function(e){for(var n=0;n<this.jt.size();n++)if(this.jt.getCoordinate(n).equals(e))return!0;return!1},n.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},n.prototype.getPointN=function(e){return this.getFactory().createPoint(this.jt.getCoordinate(e))},n.prototype.interfaces_=function(){return[Vlt]},n.prototype.getClass=function(){return n},i.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(n,i),n}(ult),fut=function(){};fut.prototype.interfaces_=function(){return[]},fut.prototype.getClass=function(){return fut};var dut=function(e){function n(n,i){e.call(this,i),this.Et=n||null,this.init(this.Et)}e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n;var i={serialVersionUID:{configurable:!0}};return n.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new qht;var e=new qht;return e.expandToInclude(this.Et.getX(0),this.Et.getY(0)),e},n.prototype.getSortIndex=function(){return e.SORTINDEX_POINT},n.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},n.prototype.equalsExact=function(){if(2===arguments.length){var n=arguments[0],i=arguments[1];return!!this.isEquivalentClass(n)&&(!(!this.isEmpty()||!n.isEmpty())||this.isEmpty()===n.isEmpty()&&this.equal(n.getCoordinate(),this.getCoordinate(),i))}return e.prototype.equalsExact.apply(this,arguments)},n.prototype.normalize=function(){},n.prototype.getCoordinate=function(){return 0!==this.Et.size()?this.Et.getCoordinate(0):null},n.prototype.getBoundaryDimension=function(){return Xlt.FALSE},n.prototype.getDimension=function(){return 0},n.prototype.getNumPoints=function(){return this.isEmpty()?0:1},n.prototype.reverse=function(){return this.copy()},n.prototype.getX=function(){if(null===this.getCoordinate())throw new Error("getX called on empty Point");return this.getCoordinate().x},n.prototype.compareToSameClass=function(){if(1===arguments.length){var e=arguments[0];return this.getCoordinate().compareTo(e.getCoordinate())}if(2===arguments.length)return arguments[1].compare(this.Et,arguments[0].Et)},n.prototype.apply=function(){if(Eht(arguments[0],flt)){var e=arguments[0];if(this.isEmpty())return null;e.filter(this.getCoordinate())}else if(Eht(arguments[0],Klt)){var n=arguments[0];if(this.isEmpty())return null;n.filter(this.Et,0),n.isGeometryChanged()&&this.geometryChanged()}else(Eht(arguments[0],Jlt)||Eht(arguments[0],llt))&&arguments[0].filter(this)},n.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},n.prototype.clone=function(){var n=e.prototype.clone.call(this);return n.Et=this.Et.clone(),n},n.prototype.getGeometryType=function(){return"Point"},n.prototype.copy=function(){return new n(this.Et.copy(),this.Zt)},n.prototype.getCoordinateSequence=function(){return this.Et},n.prototype.getY=function(){if(null===this.getCoordinate())throw new Error("getY called on empty Point");return this.getCoordinate().y},n.prototype.isEmpty=function(){return 0===this.Et.size()},n.prototype.init=function(e){null===e&&(e=this.getFactory().getCoordinateSequenceFactory().create([])),elt.isTrue(e.size()<=1),this.Et=e},n.prototype.isSimple=function(){return!0},n.prototype.interfaces_=function(){return[fut]},n.prototype.getClass=function(){return n},i.serialVersionUID.get=function(){return 0x44077bad161cbc00},Object.defineProperties(n,i),n}(ult),put=function(){};put.prototype.interfaces_=function(){return[]},put.prototype.getClass=function(){return put};var gut=function(e){function n(n,i,o){if(e.call(this,o),this.Qt=null,this.St=null,null===n&&(n=this.getFactory().createLinearRing()),null===i&&(i=[]),e.hasNullElements(i))throw new mht("holes must not contain null elements");if(n.isEmpty()&&e.hasNonEmptyElements(i))throw new mht("shell is empty but holes are not");this.Qt=n,this.St=i}e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n;var i={serialVersionUID:{configurable:!0}};return n.prototype.computeEnvelopeInternal=function(){return this.Qt.getEnvelopeInternal()},n.prototype.getSortIndex=function(){return e.SORTINDEX_POLYGON},n.prototype.getCoordinates=function(){if(this.isEmpty())return[];for(var e=new Array(this.getNumPoints()).fill(null),n=-1,i=this.Qt.getCoordinates(),o=0;o<i.length;o++)e[++n]=i[o];for(var s=0;s<this.St.length;s++)for(var a=this.St[s].getCoordinates(),h=0;h<a.length;h++)e[++n]=a[h];return e},n.prototype.getArea=function(){var e=0;e+=Math.abs(alt.signedArea(this.Qt.getCoordinateSequence()));for(var n=0;n<this.St.length;n++)e-=Math.abs(alt.signedArea(this.St[n].getCoordinateSequence()));return e},n.prototype.isRectangle=function(){if(0!==this.getNumInteriorRing())return!1;if(null===this.Qt)return!1;if(5!==this.Qt.getNumPoints())return!1;for(var e=this.Qt.getCoordinateSequence(),n=this.getEnvelopeInternal(),i=0;i<5;i++){var o=e.getX(i);if(o!==n.getMinX()&&o!==n.getMaxX())return!1;var s=e.getY(i);if(s!==n.getMinY()&&s!==n.getMaxY())return!1}for(var a=e.getX(0),h=e.getY(0),l=1;l<=4;l++){var c=e.getX(l),A=e.getY(l);if(c!==a==(A!==h))return!1;a=c,h=A}return!0},n.prototype.equalsExact=function(){if(2===arguments.length){var n=arguments[0],i=arguments[1];if(!this.isEquivalentClass(n))return!1;var o=n;if(!this.Qt.equalsExact(o.Qt,i))return!1;if(this.St.length!==o.St.length)return!1;for(var s=0;s<this.St.length;s++)if(!this.St[s].equalsExact(o.St[s],i))return!1;return!0}return e.prototype.equalsExact.apply(this,arguments)},n.prototype.normalize=function(){if(0===arguments.length){this.normalize(this.Qt,!0);for(var e=0;e<this.St.length;e++)this.normalize(this.St[e],!1);Qlt.sort(this.St)}else if(2===arguments.length){var n=arguments[0],i=arguments[1];if(n.isEmpty())return null;var o=new Array(n.getCoordinates().length-1).fill(null);Vht.arraycopy(n.getCoordinates(),0,o,0,o.length);var s=Slt.minCoordinate(n.getCoordinates());Slt.scroll(o,s),Vht.arraycopy(o,0,n.getCoordinates(),0,o.length),n.getCoordinates()[o.length]=o[0],alt.isCCW(n.getCoordinates())===i&&Slt.reverse(n.getCoordinates())}},n.prototype.getCoordinate=function(){return this.Qt.getCoordinate()},n.prototype.getNumInteriorRing=function(){return this.St.length},n.prototype.getBoundaryDimension=function(){return 1},n.prototype.getDimension=function(){return 2},n.prototype.getLength=function(){var e=0;e+=this.Qt.getLength();for(var n=0;n<this.St.length;n++)e+=this.St[n].getLength();return e},n.prototype.getNumPoints=function(){for(var e=this.Qt.getNumPoints(),n=0;n<this.St.length;n++)e+=this.St[n].getNumPoints();return e},n.prototype.reverse=function(){var e=this.copy();e.Qt=this.Qt.copy().reverse(),e.St=new Array(this.St.length).fill(null);for(var n=0;n<this.St.length;n++)e.St[n]=this.St[n].copy().reverse();return e},n.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},n.prototype.compareToSameClass=function(){if(1===arguments.length)return this.Qt.compareToSameClass(arguments[0].Qt);if(2===arguments.length){var e=arguments[1],n=arguments[0],i=this.Qt.compareToSameClass(n.Qt,e);if(0!==i)return i;for(var o=this.getNumInteriorRing(),s=n.getNumInteriorRing(),a=0;a<o&&a<s;){var h=this.getInteriorRingN(a),l=n.getInteriorRingN(a),c=h.compareToSameClass(l,e);if(0!==c)return c;a++}return a<o?1:a<s?-1:0}},n.prototype.apply=function(e){var n=this;if(Eht(e,flt)){this.Qt.apply(e);for(var i=0;i<this.St.length;i++)n.St[i].apply(e)}else if(Eht(e,Klt)){if(this.Qt.apply(e),!e.isDone())for(var o=0;o<this.St.length&&(n.St[o].apply(e),!e.isDone());o++);e.isGeometryChanged()&&this.geometryChanged()}else if(Eht(e,Jlt))e.filter(this);else if(Eht(e,llt)){e.filter(this),this.Qt.apply(e);for(var s=0;s<this.St.length;s++)n.St[s].apply(e)}},n.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var e=new Array(this.St.length+1).fill(null);e[0]=this.Qt;for(var n=0;n<this.St.length;n++)e[n+1]=this.St[n];return e.length<=1?this.getFactory().createLinearRing(e[0].getCoordinateSequence()):this.getFactory().createMultiLineString(e)},n.prototype.clone=function(){var n=e.prototype.clone.call(this);n.Qt=this.Qt.clone(),n.St=new Array(this.St.length).fill(null);for(var i=0;i<this.St.length;i++)n.St[i]=this.St[i].clone();return n},n.prototype.getGeometryType=function(){return"Polygon"},n.prototype.copy=function(){for(var e=this.Qt.copy(),i=new Array(this.St.length).fill(null),o=0;o<i.length;o++)i[o]=this.St[o].copy();return new n(e,i,this.Zt)},n.prototype.getExteriorRing=function(){return this.Qt},n.prototype.isEmpty=function(){return this.Qt.isEmpty()},n.prototype.getInteriorRingN=function(e){return this.St[e]},n.prototype.interfaces_=function(){return[put]},n.prototype.getClass=function(){return n},i.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(n,i),n}(ult),mut=function(e){function n(){e.apply(this,arguments)}e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n;var i={serialVersionUID:{configurable:!0}};return n.prototype.getSortIndex=function(){return ult.SORTINDEX_MULTIPOINT},n.prototype.isValid=function(){return!0},n.prototype.equalsExact=function(){if(2===arguments.length){var n=arguments[0],i=arguments[1];return!!this.isEquivalentClass(n)&&e.prototype.equalsExact.call(this,n,i)}return e.prototype.equalsExact.apply(this,arguments)},n.prototype.getCoordinate=function(){return 1===arguments.length?this.Nt[arguments[0]].getCoordinate():e.prototype.getCoordinate.apply(this,arguments)},n.prototype.getBoundaryDimension=function(){return Xlt.FALSE},n.prototype.getDimension=function(){return 0},n.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},n.prototype.getGeometryType=function(){return"MultiPoint"},n.prototype.copy=function(){for(var e=new Array(this.Nt.length).fill(null),i=0;i<e.length;i++)e[i]=this.Nt[i].copy();return new n(e,this.Zt)},n.prototype.interfaces_=function(){return[fut]},n.prototype.getClass=function(){return n},i.serialVersionUID.get=function(){return-0x6fb1ed4162e0fc00},Object.defineProperties(n,i),n}($lt),yut=function(e){function n(n,i){n instanceof Cht&&i instanceof kut&&(n=i.getCoordinateSequenceFactory().create(n)),e.call(this,n,i),this.validateConstruction()}e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n;var i={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return n.prototype.getSortIndex=function(){return ult.SORTINDEX_LINEARRING},n.prototype.getBoundaryDimension=function(){return Xlt.FALSE},n.prototype.isClosed=function(){return!!this.isEmpty()||e.prototype.isClosed.call(this)},n.prototype.reverse=function(){var e=this.jt.copy();return cut.reverse(e),this.getFactory().createLinearRing(e)},n.prototype.validateConstruction=function(){if(!this.isEmpty()&&!e.prototype.isClosed.call(this))throw new mht("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<n.MINIMUM_VALID_SIZE)throw new mht("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},n.prototype.getGeometryType=function(){return"LinearRing"},n.prototype.copy=function(){return new n(this.jt.copy(),this.Zt)},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},i.MINIMUM_VALID_SIZE.get=function(){return 4},i.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(n,i),n}(Aut),vut=function(e){function n(){e.apply(this,arguments)}e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n;var i={serialVersionUID:{configurable:!0}};return n.prototype.getSortIndex=function(){return ult.SORTINDEX_MULTIPOLYGON},n.prototype.equalsExact=function(){if(2===arguments.length){var n=arguments[0],i=arguments[1];return!!this.isEquivalentClass(n)&&e.prototype.equalsExact.call(this,n,i)}return e.prototype.equalsExact.apply(this,arguments)},n.prototype.getBoundaryDimension=function(){return 1},n.prototype.getDimension=function(){return 2},n.prototype.reverse=function(){for(var e=new Array(this.Nt.length).fill(null),n=0;n<this.Nt.length;n++)e[n]=this.Nt[n].reverse();return this.getFactory().createMultiPolygon(e)},n.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var e=new Plt,n=0;n<this.Nt.length;n++)for(var i=this.Nt[n].getBoundary(),o=0;o<i.getNumGeometries();o++)e.add(i.getGeometryN(o));var s=new Array(e.size()).fill(null);return this.getFactory().createMultiLineString(e.toArray(s))},n.prototype.getGeometryType=function(){return"MultiPolygon"},n.prototype.copy=function(){for(var e=new Array(this.Nt.length).fill(null),i=0;i<e.length;i++)e[i]=this.Nt[i].copy();return new n(e,this.Zt)},n.prototype.interfaces_=function(){return[put]},n.prototype.getClass=function(){return n},i.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(n,i),n}($lt),_ut=function(e){this.Zt=e||null,this.en=!1},xut={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};_ut.prototype.setCopyUserData=function(e){this.en=e},_ut.prototype.edit=function(e,n){if(null===e)return null;var i=this.editInternal(e,n);return this.en&&i.setUserData(e.getUserData()),i},_ut.prototype.editInternal=function(e,n){return null===this.Zt&&(this.Zt=e.getFactory()),e instanceof $lt?this.editGeometryCollection(e,n):e instanceof gut?this.editPolygon(e,n):e instanceof dut||e instanceof Aut?n.edit(e,this.Zt):(elt.shouldNeverReachHere("Unsupported Geometry class: "+e.getClass().getName()),null)},_ut.prototype.editGeometryCollection=function(e,n){for(var i=n.edit(e,this.Zt),o=new Plt,s=0;s<i.getNumGeometries();s++){var a=this.edit(i.getGeometryN(s),n);null===a||a.isEmpty()||o.add(a)}return i.getClass()===mut?this.Zt.createMultiPoint(o.toArray([])):i.getClass()===tut?this.Zt.createMultiLineString(o.toArray([])):i.getClass()===vut?this.Zt.createMultiPolygon(o.toArray([])):this.Zt.createGeometryCollection(o.toArray([]))},_ut.prototype.editPolygon=function(e,n){var i=n.edit(e,this.Zt);if(null===i&&(i=this.Zt.createPolygon(null)),i.isEmpty())return i;var o=this.edit(i.getExteriorRing(),n);if(null===o||o.isEmpty())return this.Zt.createPolygon();for(var s=new Plt,a=0;a<i.getNumInteriorRing();a++){var h=this.edit(i.getInteriorRingN(a),n);null===h||h.isEmpty()||s.add(h)}return this.Zt.createPolygon(o,s.toArray([]))},_ut.prototype.interfaces_=function(){return[]},_ut.prototype.getClass=function(){return _ut},_ut.GeometryEditorOperation=function(){},xut.NoOpGeometryOperation.get=function(){return but},xut.CoordinateOperation.get=function(){return wut},xut.CoordinateSequenceOperation.get=function(){return Cut},Object.defineProperties(_ut,xut);var but=function(){};but.prototype.edit=function(e,n){return e},but.prototype.interfaces_=function(){return[_ut.GeometryEditorOperation]},but.prototype.getClass=function(){return but};var wut=function(){};wut.prototype.edit=function(e,n){var i=this.editCoordinates(e.getCoordinates(),e);return null===i?e:e instanceof yut?n.createLinearRing(i):e instanceof Aut?n.createLineString(i):e instanceof dut?i.length>0?n.createPoint(i[0]):n.createPoint():e},wut.prototype.interfaces_=function(){return[_ut.GeometryEditorOperation]},wut.prototype.getClass=function(){return wut};var Cut=function(){};Cut.prototype.edit=function(e,n){return e instanceof yut?n.createLinearRing(this.edit(e.getCoordinateSequence(),e)):e instanceof Aut?n.createLineString(this.edit(e.getCoordinateSequence(),e)):e instanceof dut?n.createPoint(this.edit(e.getCoordinateSequence(),e)):e},Cut.prototype.interfaces_=function(){return[_ut.GeometryEditorOperation]},Cut.prototype.getClass=function(){return Cut};var Put=function(){var e=this;if(this.sn=3,this.Et=null,1===arguments.length){if(arguments[0]instanceof Array)this.Et=arguments[0],this.sn=3;else if(Number.isInteger(arguments[0])){var n=arguments[0];this.Et=new Array(n).fill(null);for(var i=0;i<n;i++)e.Et[i]=new Cht}else if(Eht(arguments[0],Hht)){var o=arguments[0];if(null===o)return this.Et=new Array(0).fill(null),null;this.sn=o.getDimension(),this.Et=new Array(o.size()).fill(null);for(var s=0;s<this.Et.length;s++)e.Et[s]=o.getCoordinateCopy(s)}}else if(2===arguments.length)if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var a=arguments[0],h=arguments[1];this.Et=a,this.sn=h,null===a&&(this.Et=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var l=arguments[0],c=arguments[1];this.Et=new Array(l).fill(null),this.sn=c;for(var A=0;A<l;A++)e.Et[A]=new Cht}},Mut={serialVersionUID:{configurable:!0}};Put.prototype.setOrdinate=function(e,n,i){switch(n){case Hht.X:this.Et[e].x=i;break;case Hht.Y:this.Et[e].y=i;break;case Hht.Z:this.Et[e].z=i;break;default:throw new mht("invalid ordinateIndex")}},Put.prototype.size=function(){return this.Et.length},Put.prototype.getOrdinate=function(e,n){switch(n){case Hht.X:return this.Et[e].x;case Hht.Y:return this.Et[e].y;case Hht.Z:return this.Et[e].z}return yht.NaN},Put.prototype.getCoordinate=function(){if(1===arguments.length)return this.Et[arguments[0]];if(2===arguments.length){var e=arguments[0],n=arguments[1];n.x=this.Et[e].x,n.y=this.Et[e].y,n.z=this.Et[e].z}},Put.prototype.getCoordinateCopy=function(e){return new Cht(this.Et[e])},Put.prototype.getDimension=function(){return this.sn},Put.prototype.getX=function(e){return this.Et[e].x},Put.prototype.clone=function(){for(var e=new Array(this.size()).fill(null),n=0;n<this.Et.length;n++)e[n]=this.Et[n].clone();return new Put(e,this.sn)},Put.prototype.expandEnvelope=function(e){for(var n=0;n<this.Et.length;n++)e.expandToInclude(this.Et[n]);return e},Put.prototype.copy=function(){for(var e=new Array(this.size()).fill(null),n=0;n<this.Et.length;n++)e[n]=this.Et[n].copy();return new Put(e,this.sn)},Put.prototype.toString=function(){if(this.Et.length>0){var e=new Dht(17*this.Et.length);e.append("("),e.append(this.Et[0]);for(var n=1;n<this.Et.length;n++)e.append(", "),e.append(this.Et[n]);return e.append(")"),e.toString()}return"()"},Put.prototype.getY=function(e){return this.Et[e].y},Put.prototype.toCoordinateArray=function(){return this.Et},Put.prototype.interfaces_=function(){return[Hht,wht]},Put.prototype.getClass=function(){return Put},Mut.serialVersionUID.get=function(){return-0xcb44a778db18e00},Object.defineProperties(Put,Mut);var Tut=function(){},Sut={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};Tut.prototype.readResolve=function(){return Tut.instance()},Tut.prototype.create=function(){if(1===arguments.length){if(arguments[0]instanceof Array)return new Put(arguments[0]);if(Eht(arguments[0],Hht))return new Put(arguments[0])}else if(2===arguments.length){var e=arguments[0],n=arguments[1];return n>3&&(n=3),n<2?new Put(e):new Put(e,n)}},Tut.prototype.interfaces_=function(){return[Tht,wht]},Tut.prototype.getClass=function(){return Tut},Tut.instance=function(){return Tut.instanceObject},Sut.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00},Sut.instanceObject.get=function(){return new Tut},Object.defineProperties(Tut,Sut);var Iut=function(e){function n(){e.call(this),this.map_=new Map}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.get=function(e){return this.map_.get(e)||null},n.prototype.put=function(e,n){return this.map_.set(e,n),n},n.prototype.values=function(){for(var e=new Plt,n=this.map_.values(),i=n.next();!i.done;)e.add(i.value),i=n.next();return e},n.prototype.entrySet=function(){var e=new Flt;return this.map_.entries().forEach((function(n){return e.add(n)})),e},n.prototype.size=function(){return this.map_.size()},n}(Rlt),Eut=function e(){if(this.un=null,this.xA=null,0===arguments.length)this.un=e.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof Rut){var n=arguments[0];this.un=n,n===e.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){var i=arguments[0];this.un=e.FIXED,this.setScale(i)}else if(arguments[0]instanceof e){var o=arguments[0];this.un=o.un,this.xA=o.xA}},Out={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};Eut.prototype.equals=function(e){if(!(e instanceof Eut))return!1;return this.un===e.un&&this.xA===e.xA},Eut.prototype.compareTo=function(e){var n=e,i=this.getMaximumSignificantDigits(),o=n.getMaximumSignificantDigits();return new kht(i).compareTo(new kht(o))},Eut.prototype.getScale=function(){return this.xA},Eut.prototype.isFloating=function(){return this.un===Eut.FLOATING||this.un===Eut.FLOATING_SINGLE},Eut.prototype.getType=function(){return this.un},Eut.prototype.toString=function(){var e="UNKNOWN";return this.un===Eut.FLOATING?e="Floating":this.un===Eut.FLOATING_SINGLE?e="Floating-Single":this.un===Eut.FIXED&&(e="Fixed (Scale="+this.getScale()+")"),e},Eut.prototype.makePrecise=function(){if("number"==typeof arguments[0]){var e=arguments[0];return yht.isNaN(e)||this.un===Eut.FLOATING_SINGLE?e:this.un===Eut.FIXED?Math.round(e*this.xA)/this.xA:e}if(arguments[0]instanceof Cht){var n=arguments[0];if(this.un===Eut.FLOATING)return null;n.x=this.makePrecise(n.x),n.y=this.makePrecise(n.y)}},Eut.prototype.getMaximumSignificantDigits=function(){var e=16;return this.un===Eut.FLOATING?e=16:this.un===Eut.FLOATING_SINGLE?e=6:this.un===Eut.FIXED&&(e=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),e},Eut.prototype.setScale=function(e){this.xA=Math.abs(e)},Eut.prototype.interfaces_=function(){return[wht,_ht]},Eut.prototype.getClass=function(){return Eut},Eut.mostPrecise=function(e,n){return e.compareTo(n)>=0?e:n},Out.serialVersionUID.get=function(){return 0x6bee6404e9a25c00},Out.maximumPreciseValue.get=function(){return 9007199254740992},Object.defineProperties(Eut,Out);var Rut=function e(n){this.hn=n||null,e.nameToTypeMap.put(n,this)},Dut={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};Rut.prototype.readResolve=function(){return Rut.nameToTypeMap.get(this.hn)},Rut.prototype.toString=function(){return this.hn},Rut.prototype.interfaces_=function(){return[wht]},Rut.prototype.getClass=function(){return Rut},Dut.serialVersionUID.get=function(){return-552860263173159e4},Dut.nameToTypeMap.get=function(){return new Iut},Object.defineProperties(Rut,Dut),Eut.Type=Rut,Eut.FIXED=new Rut("FIXED"),Eut.FLOATING=new Rut("FLOATING"),Eut.FLOATING_SINGLE=new Rut("FLOATING SINGLE");var kut=function e(){this.Wt=new Eut,this.Xt=0,this.cn=e.getDefaultCoordinateSequenceFactory(),0===arguments.length||(1===arguments.length?Eht(arguments[0],Tht)?this.cn=arguments[0]:arguments[0]instanceof Eut&&(this.Wt=arguments[0]):2===arguments.length?(this.Wt=arguments[0],this.Xt=arguments[1]):3===arguments.length&&(this.Wt=arguments[0],this.Xt=arguments[1],this.cn=arguments[2]))},Lut={serialVersionUID:{configurable:!0}};kut.prototype.toGeometry=function(e){return e.isNull()?this.createPoint(null):e.getMinX()===e.getMaxX()&&e.getMinY()===e.getMaxY()?this.createPoint(new Cht(e.getMinX(),e.getMinY())):e.getMinX()===e.getMaxX()||e.getMinY()===e.getMaxY()?this.createLineString([new Cht(e.getMinX(),e.getMinY()),new Cht(e.getMaxX(),e.getMaxY())]):this.createPolygon(this.createLinearRing([new Cht(e.getMinX(),e.getMinY()),new Cht(e.getMinX(),e.getMaxY()),new Cht(e.getMaxX(),e.getMaxY()),new Cht(e.getMaxX(),e.getMinY()),new Cht(e.getMinX(),e.getMinY())]),null)},kut.prototype.createLineString=function(e){return e?e instanceof Array?new Aut(this.getCoordinateSequenceFactory().create(e),this):Eht(e,Hht)?new Aut(e,this):void 0:new Aut(this.getCoordinateSequenceFactory().create([]),this)},kut.prototype.createMultiLineString=function(){return 0===arguments.length?new tut(null,this):1===arguments.length?new tut(arguments[0],this):void 0},kut.prototype.buildGeometry=function(e){for(var n=null,i=!1,o=!1,s=e.iterator();s.hasNext();){var a=s.next(),h=a.getClass();null===n&&(n=h),h!==n&&(i=!0),a.isGeometryCollectionOrDerived()&&(o=!0)}if(null===n)return this.createGeometryCollection();if(i||o)return this.createGeometryCollection(kut.toGeometryArray(e));var l=e.iterator().next();if(e.size()>1){if(l instanceof gut)return this.createMultiPolygon(kut.toPolygonArray(e));if(l instanceof Aut)return this.createMultiLineString(kut.toLineStringArray(e));if(l instanceof dut)return this.createMultiPoint(kut.toPointArray(e));elt.shouldNeverReachHere("Unhandled class: "+l.getClass().getName())}return l},kut.prototype.createMultiPointFromCoords=function(e){return this.createMultiPoint(null!==e?this.getCoordinateSequenceFactory().create(e):null)},kut.prototype.createPoint=function(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Cht){var e=arguments[0];return this.createPoint(null!==e?this.getCoordinateSequenceFactory().create([e]):null)}if(Eht(arguments[0],Hht))return new dut(arguments[0],this)}},kut.prototype.getCoordinateSequenceFactory=function(){return this.cn},kut.prototype.createPolygon=function(){if(0===arguments.length)return new gut(null,null,this);if(1===arguments.length){if(Eht(arguments[0],Hht))return this.createPolygon(this.createLinearRing(arguments[0]));if(arguments[0]instanceof Array)return this.createPolygon(this.createLinearRing(arguments[0]));if(arguments[0]instanceof yut)return this.createPolygon(arguments[0],null)}else if(2===arguments.length)return new gut(arguments[0],arguments[1],this)},kut.prototype.getSRID=function(){return this.Xt},kut.prototype.createGeometryCollection=function(){return 0===arguments.length?new $lt(null,this):1===arguments.length?new $lt(arguments[0],this):void 0},kut.prototype.createGeometry=function(e){return new _ut(this).edit(e,{edit:function(){if(2===arguments.length)return this.cn.create(arguments[0])}})},kut.prototype.getPrecisionModel=function(){return this.Wt},kut.prototype.createLinearRing=function(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var e=arguments[0];return this.createLinearRing(null!==e?this.getCoordinateSequenceFactory().create(e):null)}if(Eht(arguments[0],Hht))return new yut(arguments[0],this)}},kut.prototype.createMultiPolygon=function(){return 0===arguments.length?new vut(null,this):1===arguments.length?new vut(arguments[0],this):void 0},kut.prototype.createMultiPoint=function(){if(0===arguments.length)return new mut(null,this);if(1===arguments.length){if(arguments[0]instanceof Array)return new mut(arguments[0],this);if(arguments[0]instanceof Array){var e=arguments[0];return this.createMultiPoint(null!==e?this.getCoordinateSequenceFactory().create(e):null)}if(Eht(arguments[0],Hht)){var n=arguments[0];if(null===n)return this.createMultiPoint(new Array(0).fill(null));for(var i=new Array(n.size()).fill(null),o=0;o<n.size();o++){var s=this.getCoordinateSequenceFactory().create(1,n.getDimension());cut.copy(n,o,s,0,1),i[o]=this.createPoint(s)}return this.createMultiPoint(i)}}},kut.prototype.interfaces_=function(){return[wht]},kut.prototype.getClass=function(){return kut},kut.toMultiPolygonArray=function(e){var n=new Array(e.size()).fill(null);return e.toArray(n)},kut.toGeometryArray=function(e){if(null===e)return null;var n=new Array(e.size()).fill(null);return e.toArray(n)},kut.getDefaultCoordinateSequenceFactory=function(){return Tut.instance()},kut.toMultiLineStringArray=function(e){var n=new Array(e.size()).fill(null);return e.toArray(n)},kut.toLineStringArray=function(e){var n=new Array(e.size()).fill(null);return e.toArray(n)},kut.toMultiPointArray=function(e){var n=new Array(e.size()).fill(null);return e.toArray(n)},kut.toLinearRingArray=function(e){var n=new Array(e.size()).fill(null);return e.toArray(n)},kut.toPointArray=function(e){var n=new Array(e.size()).fill(null);return e.toArray(n)},kut.toPolygonArray=function(e){var n=new Array(e.size()).fill(null);return e.toArray(n)},kut.createPointFromInternalCoord=function(e,n){return n.getPrecisionModel().makePrecise(e),n.getFactory().createPoint(e)},Lut.serialVersionUID.get=function(){return-0x5ea75f2051eeb400},Object.defineProperties(kut,Lut);var Fut=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],Nut=function(e){this.geometryFactory=e||new kut};Nut.prototype.read=function(e){var n,i=(n="string"==typeof e?JSON.parse(e):e).type;if(!zut[i])throw new Error("Unknown GeoJSON type: "+n.type);return-1!==Fut.indexOf(i)?zut[i].apply(this,[n.coordinates]):zut[i].apply(this,"GeometryCollection"===i?[n.geometries]:[n])},Nut.prototype.write=function(e){var n=e.getGeometryType();if(!But[n])throw new Error("Geometry is not supported");return But[n].apply(this,[e])};var zut={Feature:function(e){var n={};for(var i in e)n[i]=e[i];if(e.geometry){if(!zut[e.geometry.type])throw new Error("Unknown GeoJSON type: "+e.type);n.geometry=this.read(e.geometry)}return e.bbox&&(n.bbox=zut.bbox.apply(this,[e.bbox])),n},FeatureCollection:function(e){var n={};if(e.features){n.features=[];for(var i=0;i<e.features.length;++i)n.features.push(this.read(e.features[i]))}return e.bbox&&(n.bbox=this.parse.bbox.apply(this,[e.bbox])),n},coordinates:function(e){for(var n=[],i=0;i<e.length;++i){var o=e[i];n.push(new Cht(o[0],o[1]))}return n},bbox:function(e){return this.geometryFactory.createLinearRing([new Cht(e[0],e[1]),new Cht(e[2],e[1]),new Cht(e[2],e[3]),new Cht(e[0],e[3]),new Cht(e[0],e[1])])},Point:function(e){var n=new Cht(e[0],e[1]);return this.geometryFactory.createPoint(n)},MultiPoint:function(e){for(var n=[],i=0;i<e.length;++i)n.push(zut.Point.apply(this,[e[i]]));return this.geometryFactory.createMultiPoint(n)},LineString:function(e){var n=zut.coordinates.apply(this,[e]);return this.geometryFactory.createLineString(n)},MultiLineString:function(e){for(var n=[],i=0;i<e.length;++i)n.push(zut.LineString.apply(this,[e[i]]));return this.geometryFactory.createMultiLineString(n)},Polygon:function(e){for(var n=zut.coordinates.apply(this,[e[0]]),i=this.geometryFactory.createLinearRing(n),o=[],s=1;s<e.length;++s){var a=zut.coordinates.apply(this,[e[s]]),h=this.geometryFactory.createLinearRing(a);o.push(h)}return this.geometryFactory.createPolygon(i,o)},MultiPolygon:function(e){for(var n=[],i=0;i<e.length;++i){n.push(zut.Polygon.apply(this,[e[i]]))}return this.geometryFactory.createMultiPolygon(n)},GeometryCollection:function(e){for(var n=[],i=0;i<e.length;++i){n.push(this.read(e[i]))}return this.geometryFactory.createGeometryCollection(n)}},But={coordinate:function(e){return[e.x,e.y]},Point:function(e){return{type:"Point",coordinates:But.coordinate.apply(this,[e.getCoordinate()])}},MultiPoint:function(e){for(var n=[],i=0;i<e.Nt.length;++i){var o=But.Point.apply(this,[e.Nt[i]]);n.push(o.coordinates)}return{type:"MultiPoint",coordinates:n}},LineString:function(e){for(var n=[],i=e.getCoordinates(),o=0;o<i.length;++o){n.push(But.coordinate.apply(this,[i[o]]))}return{type:"LineString",coordinates:n}},MultiLineString:function(e){for(var n=[],i=0;i<e.Nt.length;++i){var o=But.LineString.apply(this,[e.Nt[i]]);n.push(o.coordinates)}return{type:"MultiLineString",coordinates:n}},Polygon:function(e){var n=[],i=But.LineString.apply(this,[e.Qt]);n.push(i.coordinates);for(var o=0;o<e.St.length;++o){var s=But.LineString.apply(this,[e.St[o]]);n.push(s.coordinates)}return{type:"Polygon",coordinates:n}},MultiPolygon:function(e){for(var n=[],i=0;i<e.Nt.length;++i){var o=But.Polygon.apply(this,[e.Nt[i]]);n.push(o.coordinates)}return{type:"MultiPolygon",coordinates:n}},GeometryCollection:function(e){for(var n=[],i=0;i<e.Nt.length;++i){var o=e.Nt[i],s=o.getGeometryType();n.push(But[s].apply(this,[o]))}return{type:"GeometryCollection",geometries:n}}},Hut=function(e){this.geometryFactory=e||new kut,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new Nut(this.geometryFactory)};Hut.prototype.read=function(e){var n=this.parser.read(e);return this.precisionModel.getType()===Eut.FIXED&&this.reducePrecision(n),n},Hut.prototype.reducePrecision=function(e){var n,i;if(e.coordinate)this.precisionModel.makePrecise(e.coordinate);else if(e.points)for(n=0,i=e.points.length;n<i;n++)this.precisionModel.makePrecise(e.points[n]);else if(e.geometries)for(n=0,i=e.geometries.length;n<i;n++)this.reducePrecision(e.geometries[n])};var jut=function(){this.parser=new Nut(this.geometryFactory)};jut.prototype.write=function(e){return this.parser.write(e)};var Uut=function(){},Gut={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};function Vut(e){this.message=e||""}function Wut(){this.array_=[]}Uut.prototype.interfaces_=function(){return[]},Uut.prototype.getClass=function(){return Uut},Uut.opposite=function(e){return e===Uut.LEFT?Uut.RIGHT:e===Uut.RIGHT?Uut.LEFT:e},Gut.ON.get=function(){return 0},Gut.LEFT.get=function(){return 1},Gut.RIGHT.get=function(){return 2},Object.defineProperties(Uut,Gut),(Vut.prototype=new Error).name="EmptyStackException",(Wut.prototype=new wlt).add=function(e){return this.array_.push(e),!0},Wut.prototype.get=function(e){if(e<0||e>=this.size())throw new Error;return this.array_[e]},Wut.prototype.push=function(e){return this.array_.push(e),e},Wut.prototype.pop=function(e){if(0===this.array_.length)throw new Vut;return this.array_.pop()},Wut.prototype.peek=function(){if(0===this.array_.length)throw new Vut;return this.array_[this.array_.length-1]},Wut.prototype.empty=function(){return 0===this.array_.length},Wut.prototype.isEmpty=function(){return this.empty()},Wut.prototype.search=function(e){return this.array_.indexOf(e)},Wut.prototype.size=function(){return this.array_.length},Wut.prototype.toArray=function(){for(var e=[],n=0,i=this.array_.length;n<i;n++)e.push(this.array_[n]);return e};var qut=function(){this.an=-1,this.vn=null,this.ln=null,this.wn=null};qut.prototype.getCoordinate=function(){return this.vn},qut.prototype.getRightmostSide=function(e,n){var i=this.getRightmostSideOfSegment(e,n);return i<0&&(i=this.getRightmostSideOfSegment(e,n-1)),i<0&&(this.vn=null,this.checkForRightmostCoordinate(e)),i},qut.prototype.findRightmostEdgeAtVertex=function(){var e=this.ln.getEdge().getCoordinates();elt.isTrue(this.an>0&&this.an<e.length,"rightmost point expected to be interior vertex of edge");var n=e[this.an-1],i=e[this.an+1],o=alt.computeOrientation(this.vn,i,n),s=!1;(n.y<this.vn.y&&i.y<this.vn.y&&o===alt.COUNTERCLOCKWISE||n.y>this.vn.y&&i.y>this.vn.y&&o===alt.CLOCKWISE)&&(s=!0),s&&(this.an=this.an-1)},qut.prototype.getRightmostSideOfSegment=function(e,n){var i=e.getEdge().getCoordinates();if(n<0||n+1>=i.length)return-1;if(i[n].y===i[n+1].y)return-1;var o=Uut.LEFT;return i[n].y<i[n+1].y&&(o=Uut.RIGHT),o},qut.prototype.getEdge=function(){return this.wn},qut.prototype.checkForRightmostCoordinate=function(e){for(var n=this,i=e.getEdge().getCoordinates(),o=0;o<i.length-1;o++)(null===n.vn||i[o].x>n.vn.x)&&(n.ln=e,n.an=o,n.vn=i[o])},qut.prototype.findRightmostEdgeAtNode=function(){var e=this.ln.getNode().getEdges();this.ln=e.getRightmostEdge(),this.ln.isForward()||(this.ln=this.ln.getSym(),this.an=this.ln.getEdge().getCoordinates().length-1)},qut.prototype.findEdge=function(e){for(var n=e.iterator();n.hasNext();){var i=n.next();i.isForward()&&this.checkForRightmostCoordinate(i)}elt.isTrue(0!==this.an||this.vn.equals(this.ln.getCoordinate()),"inconsistency in rightmost processing"),0===this.an?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this.wn=this.ln,this.getRightmostSide(this.ln,this.an)===Uut.LEFT&&(this.wn=this.ln.getSym())},qut.prototype.interfaces_=function(){return[]},qut.prototype.getClass=function(){return qut};var Zut=function(e){function n(i,o){e.call(this,n.msgWithCoord(i,o)),this.pt=o?new Cht(o):null,this.name="TopologyException"}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.getCoordinate=function(){return this.pt},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n.msgWithCoord=function(e,n){return n?e:e+" [ "+n+" ]"},n}($ht),Qut=function(){this.array_=[]};Qut.prototype.addLast=function(e){this.array_.push(e)},Qut.prototype.removeFirst=function(){return this.array_.shift()},Qut.prototype.isEmpty=function(){return 0===this.array_.length};var Xut=function(){this.Pn=null,this.gn=new Plt,this.Cn=new Plt,this.Dn=null,this.In=null,this.Pn=new qut};Xut.prototype.clearVisitedEdges=function(){for(var e=this.gn.iterator();e.hasNext();)e.next().setVisited(!1)},Xut.prototype.getRightmostCoordinate=function(){return this.Dn},Xut.prototype.computeNodeDepth=function(e){for(var n=null,i=e.getEdges().iterator();i.hasNext();){var o=i.next();if(o.isVisited()||o.getSym().isVisited()){n=o;break}}if(null===n)throw new Zut("unable to find edge to compute depths at "+e.getCoordinate());e.getEdges().computeDepths(n);for(var s=e.getEdges().iterator();s.hasNext();){var a=s.next();a.setVisited(!0),this.copySymDepths(a)}},Xut.prototype.computeDepth=function(e){this.clearVisitedEdges();var n=this.Pn.getEdge();n.setEdgeDepths(Uut.RIGHT,e),this.copySymDepths(n),this.computeDepths(n)},Xut.prototype.create=function(e){this.addReachable(e),this.Pn.findEdge(this.gn),this.Dn=this.Pn.getCoordinate()},Xut.prototype.findResultEdges=function(){for(var e=this.gn.iterator();e.hasNext();){var n=e.next();n.getDepth(Uut.RIGHT)>=1&&n.getDepth(Uut.LEFT)<=0&&!n.isInteriorAreaEdge()&&n.setInResult(!0)}},Xut.prototype.computeDepths=function(e){var n=new Flt,i=new Qut,o=e.getNode();for(i.addLast(o),n.add(o),e.setVisited(!0);!i.isEmpty();){var s=i.removeFirst();n.add(s),this.computeNodeDepth(s);for(var a=s.getEdges().iterator();a.hasNext();){var h=a.next().getSym();if(!h.isVisited()){var l=h.getNode();n.contains(l)||(i.addLast(l),n.add(l))}}}},Xut.prototype.compareTo=function(e){return this.Dn.x<e.Dn.x?-1:this.Dn.x>e.Dn.x?1:0},Xut.prototype.getEnvelope=function(){if(null===this.In){for(var e=new qht,n=this.gn.iterator();n.hasNext();)for(var i=n.next().getEdge().getCoordinates(),o=0;o<i.length-1;o++)e.expandToInclude(i[o]);this.In=e}return this.In},Xut.prototype.addReachable=function(e){var n=new Wut;for(n.add(e);!n.empty();){var i=n.pop();this.add(i,n)}},Xut.prototype.copySymDepths=function(e){var n=e.getSym();n.setDepth(Uut.LEFT,e.getDepth(Uut.RIGHT)),n.setDepth(Uut.RIGHT,e.getDepth(Uut.LEFT))},Xut.prototype.add=function(e,n){e.setVisited(!0),this.Cn.add(e);for(var i=e.getEdges().iterator();i.hasNext();){var o=i.next();this.gn.add(o);var s=o.getSym().getNode();s.isVisited()||n.push(s)}},Xut.prototype.getNodes=function(){return this.Cn},Xut.prototype.getDirectedEdges=function(){return this.gn},Xut.prototype.interfaces_=function(){return[_ht]},Xut.prototype.getClass=function(){return Xut};var Yut=function e(){if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array)this.init(arguments[0].length);else if(Number.isInteger(arguments[0])){var n=arguments[0];this.init(1),this.location[Uut.ON]=n}else if(arguments[0]instanceof e){var i=arguments[0];if(this.init(i.location.length),null!==i)for(var o=0;o<this.location.length;o++)this.location[o]=i.location[o]}}else if(3===arguments.length){var s=arguments[0],a=arguments[1],h=arguments[2];this.init(3),this.location[Uut.ON]=s,this.location[Uut.LEFT]=a,this.location[Uut.RIGHT]=h}};Yut.prototype.setAllLocations=function(e){for(var n=0;n<this.location.length;n++)this.location[n]=e},Yut.prototype.isNull=function(){for(var e=0;e<this.location.length;e++)if(this.location[e]!==Sht.NONE)return!1;return!0},Yut.prototype.setAllLocationsIfNull=function(e){for(var n=0;n<this.location.length;n++)this.location[n]===Sht.NONE&&(this.location[n]=e)},Yut.prototype.isLine=function(){return 1===this.location.length},Yut.prototype.merge=function(e){if(e.location.length>this.location.length){var n=new Array(3).fill(null);n[Uut.ON]=this.location[Uut.ON],n[Uut.LEFT]=Sht.NONE,n[Uut.RIGHT]=Sht.NONE,this.location=n}for(var i=0;i<this.location.length;i++)this.location[i]===Sht.NONE&&i<e.location.length&&(this.location[i]=e.location[i])},Yut.prototype.getLocations=function(){return this.location},Yut.prototype.flip=function(){if(this.location.length<=1)return null;var e=this.location[Uut.LEFT];this.location[Uut.LEFT]=this.location[Uut.RIGHT],this.location[Uut.RIGHT]=e},Yut.prototype.toString=function(){var e=new Dht;return this.location.length>1&&e.append(Sht.toLocationSymbol(this.location[Uut.LEFT])),e.append(Sht.toLocationSymbol(this.location[Uut.ON])),this.location.length>1&&e.append(Sht.toLocationSymbol(this.location[Uut.RIGHT])),e.toString()},Yut.prototype.setLocations=function(e,n,i){this.location[Uut.ON]=e,this.location[Uut.LEFT]=n,this.location[Uut.RIGHT]=i},Yut.prototype.get=function(e){return e<this.location.length?this.location[e]:Sht.NONE},Yut.prototype.isArea=function(){return this.location.length>1},Yut.prototype.isAnyNull=function(){for(var e=0;e<this.location.length;e++)if(this.location[e]===Sht.NONE)return!0;return!1},Yut.prototype.setLocation=function(){if(1===arguments.length)this.setLocation(Uut.ON,arguments[0]);else if(2===arguments.length){this.location[arguments[0]]=arguments[1]}},Yut.prototype.init=function(e){this.location=new Array(e).fill(null),this.setAllLocations(Sht.NONE)},Yut.prototype.isEqualOnSide=function(e,n){return this.location[n]===e.location[n]},Yut.prototype.allPositionsEqual=function(e){for(var n=0;n<this.location.length;n++)if(this.location[n]!==e)return!1;return!0},Yut.prototype.interfaces_=function(){return[]},Yut.prototype.getClass=function(){return Yut};var Jut=function e(){if(this.elt=new Array(2).fill(null),1===arguments.length){if(Number.isInteger(arguments[0])){var n=arguments[0];this.elt[0]=new Yut(n),this.elt[1]=new Yut(n)}else if(arguments[0]instanceof e){var i=arguments[0];this.elt[0]=new Yut(i.elt[0]),this.elt[1]=new Yut(i.elt[1])}}else if(2===arguments.length){var o=arguments[0],s=arguments[1];this.elt[0]=new Yut(Sht.NONE),this.elt[1]=new Yut(Sht.NONE),this.elt[o].setLocation(s)}else if(3===arguments.length){var a=arguments[0],h=arguments[1],l=arguments[2];this.elt[0]=new Yut(a,h,l),this.elt[1]=new Yut(a,h,l)}else if(4===arguments.length){var c=arguments[0],A=arguments[1],f=arguments[2],d=arguments[3];this.elt[0]=new Yut(Sht.NONE,Sht.NONE,Sht.NONE),this.elt[1]=new Yut(Sht.NONE,Sht.NONE,Sht.NONE),this.elt[c].setLocations(A,f,d)}};Jut.prototype.getGeometryCount=function(){var e=0;return this.elt[0].isNull()||e++,this.elt[1].isNull()||e++,e},Jut.prototype.setAllLocations=function(e,n){this.elt[e].setAllLocations(n)},Jut.prototype.isNull=function(e){return this.elt[e].isNull()},Jut.prototype.setAllLocationsIfNull=function(){if(1===arguments.length){var e=arguments[0];this.setAllLocationsIfNull(0,e),this.setAllLocationsIfNull(1,e)}else if(2===arguments.length){this.elt[arguments[0]].setAllLocationsIfNull(arguments[1])}},Jut.prototype.isLine=function(e){return this.elt[e].isLine()},Jut.prototype.merge=function(e){for(var n=this,i=0;i<2;i++)null===n.elt[i]&&null!==e.elt[i]?n.elt[i]=new Yut(e.elt[i]):n.elt[i].merge(e.elt[i])},Jut.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()},Jut.prototype.getLocation=function(){return 1===arguments.length?this.elt[arguments[0]].get(Uut.ON):2===arguments.length?this.elt[arguments[0]].get(arguments[1]):void 0},Jut.prototype.toString=function(){var e=new Dht;return null!==this.elt[0]&&(e.append("A:"),e.append(this.elt[0].toString())),null!==this.elt[1]&&(e.append(" B:"),e.append(this.elt[1].toString())),e.toString()},Jut.prototype.isArea=function(){return 0===arguments.length?this.elt[0].isArea()||this.elt[1].isArea():1===arguments.length?this.elt[arguments[0]].isArea():void 0},Jut.prototype.isAnyNull=function(e){return this.elt[e].isAnyNull()},Jut.prototype.setLocation=function(){if(2===arguments.length)this.elt[arguments[0]].setLocation(Uut.ON,arguments[1]);else if(3===arguments.length){this.elt[arguments[0]].setLocation(arguments[1],arguments[2])}},Jut.prototype.isEqualOnSide=function(e,n){return this.elt[0].isEqualOnSide(e.elt[0],n)&&this.elt[1].isEqualOnSide(e.elt[1],n)},Jut.prototype.allPositionsEqual=function(e,n){return this.elt[e].allPositionsEqual(n)},Jut.prototype.toLine=function(e){this.elt[e].isArea()&&(this.elt[e]=new Yut(this.elt[e].location[0]))},Jut.prototype.interfaces_=function(){return[]},Jut.prototype.getClass=function(){return Jut},Jut.toLineLabel=function(e){for(var n=new Jut(Sht.NONE),i=0;i<2;i++)n.setLocation(i,e.getLocation(i));return n};var Kut=function(){this.bn=null,this.Mn=-1,this.zn=new Plt,this.dn=new Plt,this.xn=new Jut(Sht.NONE),this.mn=null,this.yn=null,this.Qt=null,this.St=new Plt,this.pn=null;var e=arguments[0];this.pn=arguments[1],this.computePoints(e),this.computeRing()};Kut.prototype.computeRing=function(){if(null!==this.mn)return null;for(var e=new Array(this.dn.size()).fill(null),n=0;n<this.dn.size();n++)e[n]=this.dn.get(n);this.mn=this.pn.createLinearRing(e),this.yn=alt.isCCW(this.mn.getCoordinates())},Kut.prototype.isIsolated=function(){return 1===this.xn.getGeometryCount()},Kut.prototype.computePoints=function(e){var n=this;this.bn=e;var i=e,o=!0;do{if(null===i)throw new Zut("Found null DirectedEdge");if(i.getEdgeRing()===n)throw new Zut("Directed Edge visited twice during ring-building at "+i.getCoordinate());n.zn.add(i);var s=i.getLabel();elt.isTrue(s.isArea()),n.mergeLabel(s),n.addPoints(i.getEdge(),i.isForward(),o),o=!1,n.setEdgeRing(i,n),i=n.getNext(i)}while(i!==this.bn)},Kut.prototype.getLinearRing=function(){return this.mn},Kut.prototype.getCoordinate=function(e){return this.dn.get(e)},Kut.prototype.computeMaxNodeDegree=function(){var e=this;this.Mn=0;var n=this.bn;do{var i=n.getNode().getEdges().getOutgoingDegree(e);i>e.Mn&&(e.Mn=i),n=e.getNext(n)}while(n!==this.bn);this.Mn*=2},Kut.prototype.addPoints=function(e,n,i){var o=e.getCoordinates();if(n){var s=1;i&&(s=0);for(var a=s;a<o.length;a++)this.dn.add(o[a])}else{var h=o.length-2;i&&(h=o.length-1);for(var l=h;l>=0;l--)this.dn.add(o[l])}},Kut.prototype.isHole=function(){return this.yn},Kut.prototype.setInResult=function(){var e=this.bn;do{e.getEdge().setInResult(!0),e=e.getNext()}while(e!==this.bn)},Kut.prototype.containsPoint=function(e){var n=this.getLinearRing();if(!n.getEnvelopeInternal().contains(e))return!1;if(!alt.isPointInRing(e,n.getCoordinates()))return!1;for(var i=this.St.iterator();i.hasNext();)if(i.next().containsPoint(e))return!1;return!0},Kut.prototype.addHole=function(e){this.St.add(e)},Kut.prototype.isShell=function(){return null===this.Qt},Kut.prototype.getLabel=function(){return this.xn},Kut.prototype.getEdges=function(){return this.zn},Kut.prototype.getMaxNodeDegree=function(){return this.Mn<0&&this.computeMaxNodeDegree(),this.Mn},Kut.prototype.getShell=function(){return this.Qt},Kut.prototype.mergeLabel=function(){if(1===arguments.length){var e=arguments[0];this.mergeLabel(e,0),this.mergeLabel(e,1)}else if(2===arguments.length){var n=arguments[1],i=arguments[0].getLocation(n,Uut.RIGHT);if(i===Sht.NONE)return null;if(this.xn.getLocation(n)===Sht.NONE)return this.xn.setLocation(n,i),null}},Kut.prototype.setShell=function(e){this.Qt=e,null!==e&&e.addHole(this)},Kut.prototype.toPolygon=function(e){for(var n=new Array(this.St.size()).fill(null),i=0;i<this.St.size();i++)n[i]=this.St.get(i).getLinearRing();return e.createPolygon(this.getLinearRing(),n)},Kut.prototype.interfaces_=function(){return[]},Kut.prototype.getClass=function(){return Kut};var $ut=function(e){function n(){e.call(this,arguments[0],arguments[1])}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.setEdgeRing=function(e,n){e.setMinEdgeRing(n)},n.prototype.getNext=function(e){return e.getNextMin()},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n}(Kut),tct=function(e){function n(){e.call(this,arguments[0],arguments[1])}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.buildMinimalRings=function(){var e=new Plt,n=this.bn;do{if(null===n.getMinEdgeRing()){var i=new $ut(n,this.pn);e.add(i)}n=n.getNext()}while(n!==this.bn);return e},n.prototype.setEdgeRing=function(e,n){e.setEdgeRing(n)},n.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var e=this.bn;do{e.getNode().getEdges().linkMinimalDirectedEdges(this),e=e.getNext()}while(e!==this.bn)},n.prototype.getNext=function(e){return e.getNext()},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n}(Kut),ect=function(){if(this.xn=null,this.Ln=!1,this.Tn=!1,this.On=!1,this.Fn=!1,0===arguments.length);else if(1===arguments.length){this.xn=arguments[0]}};ect.prototype.setVisited=function(e){this.Fn=e},ect.prototype.setInResult=function(e){this.Ln=e},ect.prototype.isCovered=function(){return this.Tn},ect.prototype.isCoveredSet=function(){return this.On},ect.prototype.setLabel=function(e){this.xn=e},ect.prototype.getLabel=function(){return this.xn},ect.prototype.setCovered=function(e){this.Tn=e,this.On=!0},ect.prototype.updateIM=function(e){elt.isTrue(this.xn.getGeometryCount()>=2,"found partial label"),this.computeIM(e)},ect.prototype.isInResult=function(){return this.Ln},ect.prototype.isVisited=function(){return this.Fn},ect.prototype.interfaces_=function(){return[]},ect.prototype.getClass=function(){return ect};var nct=function(e){function n(){e.call(this),this.Un=null,this.zn=null;var n=arguments[1];this.Un=arguments[0],this.zn=n,this.xn=new Jut(0,Sht.NONE)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.isIncidentEdgeInResult=function(){for(var e=this.getEdges().getEdges().iterator();e.hasNext();)if(e.next().getEdge().isInResult())return!0;return!1},n.prototype.isIsolated=function(){return 1===this.xn.getGeometryCount()},n.prototype.getCoordinate=function(){return this.Un},n.prototype.print=function(e){e.println("node "+this.Un+" lbl: "+this.xn)},n.prototype.computeIM=function(e){},n.prototype.computeMergedLocation=function(e,n){var i=Sht.NONE;if(i=this.xn.getLocation(n),!e.isNull(n)){var o=e.getLocation(n);i!==Sht.BOUNDARY&&(i=o)}return i},n.prototype.setLabel=function(){if(2!==arguments.length)return e.prototype.setLabel.apply(this,arguments);var n=arguments[0],i=arguments[1];null===this.xn?this.xn=new Jut(n,i):this.xn.setLocation(n,i)},n.prototype.getEdges=function(){return this.zn},n.prototype.mergeLabel=function(){var e=this;if(arguments[0]instanceof n)this.mergeLabel(arguments[0].xn);else if(arguments[0]instanceof Jut)for(var i=arguments[0],o=0;o<2;o++){var s=e.computeMergedLocation(i,o);e.xn.getLocation(o)===Sht.NONE&&e.xn.setLocation(o,s)}},n.prototype.add=function(e){this.zn.insert(e),e.setNode(this)},n.prototype.setLabelBoundary=function(e){if(null===this.xn)return null;var n=Sht.NONE;null!==this.xn&&(n=this.xn.getLocation(e));this.xn.setLocation(e,n===Sht.BOUNDARY?Sht.INTERIOR:Sht.BOUNDARY)},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n}(ect),ict=function(){this.nodeMap=new Glt,this.nodeFact=null,this.nodeFact=arguments[0]};ict.prototype.find=function(e){return this.nodeMap.get(e)},ict.prototype.addNode=function(){if(arguments[0]instanceof Cht){var e=arguments[0],n=this.nodeMap.get(e);return null===n&&(n=this.nodeFact.createNode(e),this.nodeMap.put(e,n)),n}if(arguments[0]instanceof nct){var i=arguments[0],o=this.nodeMap.get(i.getCoordinate());return null===o?(this.nodeMap.put(i.getCoordinate(),i),i):(o.mergeLabel(i),o)}},ict.prototype.print=function(e){for(var n=this.iterator();n.hasNext();)n.next().print(e)},ict.prototype.iterator=function(){return this.nodeMap.values().iterator()},ict.prototype.values=function(){return this.nodeMap.values()},ict.prototype.getBoundaryNodes=function(e){for(var n=new Plt,i=this.iterator();i.hasNext();){var o=i.next();o.getLabel().getLocation(e)===Sht.BOUNDARY&&n.add(o)}return n},ict.prototype.add=function(e){var n=e.getCoordinate();this.addNode(n).add(e)},ict.prototype.interfaces_=function(){return[]},ict.prototype.getClass=function(){return ict};var rct=function(){},oct={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};rct.prototype.interfaces_=function(){return[]},rct.prototype.getClass=function(){return rct},rct.isNorthern=function(e){return e===rct.NE||e===rct.NW},rct.isOpposite=function(e,n){return e!==n&&2==(e-n+4)%4},rct.commonHalfPlane=function(e,n){if(e===n)return e;if(2==(e-n+4)%4)return-1;var i=e<n?e:n;return 0===i&&3===(e>n?e:n)?3:i},rct.isInHalfPlane=function(e,n){return n===rct.SE?e===rct.SE||e===rct.SW:e===n||e===n+1},rct.quadrant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var e=arguments[0],n=arguments[1];if(0===e&&0===n)throw new mht("Cannot compute the quadrant for point ( "+e+", "+n+" )");return e>=0?n>=0?rct.NE:rct.SE:n>=0?rct.NW:rct.SW}if(arguments[0]instanceof Cht&&arguments[1]instanceof Cht){var i=arguments[0],o=arguments[1];if(o.x===i.x&&o.y===i.y)throw new mht("Cannot compute the quadrant for two identical points "+i);return o.x>=i.x?o.y>=i.y?rct.NE:rct.SE:o.y>=i.y?rct.NW:rct.SW}},oct.NE.get=function(){return 0},oct.NW.get=function(){return 1},oct.SW.get=function(){return 2},oct.SE.get=function(){return 3},Object.defineProperties(rct,oct);var sct=function(){if(this.En=null,this.xn=null,this.Nn=null,this.jn=null,this.Qn=null,this.Sn=null,this.Bn=null,this.kn=null,1===arguments.length)this.En=arguments[0];else if(3===arguments.length){var e=arguments[1],n=arguments[2];this.En=arguments[0],this.init(e,n),this.xn=null}else if(4===arguments.length){var i=arguments[1],o=arguments[2],s=arguments[3];this.En=arguments[0],this.init(i,o),this.xn=s}};sct.prototype.compareDirection=function(e){return this.Sn===e.Sn&&this.Bn===e.Bn?0:this.kn>e.kn?1:this.kn<e.kn?-1:alt.computeOrientation(e.jn,e.Qn,this.Qn)},sct.prototype.getDy=function(){return this.Bn},sct.prototype.getCoordinate=function(){return this.jn},sct.prototype.setNode=function(e){this.Nn=e},sct.prototype.print=function(e){var n=Math.atan2(this.Bn,this.Sn),i=this.getClass().getName(),o=i.lastIndexOf("."),s=i.substring(o+1);e.print("  "+s+": "+this.jn+" - "+this.Qn+" "+this.kn+":"+n+"   "+this.xn)},sct.prototype.compareTo=function(e){return this.compareDirection(e)},sct.prototype.getDirectedCoordinate=function(){return this.Qn},sct.prototype.getDx=function(){return this.Sn},sct.prototype.getLabel=function(){return this.xn},sct.prototype.getEdge=function(){return this.En},sct.prototype.getQuadrant=function(){return this.kn},sct.prototype.getNode=function(){return this.Nn},sct.prototype.toString=function(){var e=Math.atan2(this.Bn,this.Sn),n=this.getClass().getName(),i=n.lastIndexOf(".");return"  "+n.substring(i+1)+": "+this.jn+" - "+this.Qn+" "+this.kn+":"+e+"   "+this.xn},sct.prototype.computeLabel=function(e){},sct.prototype.init=function(e,n){this.jn=e,this.Qn=n,this.Sn=n.x-e.x,this.Bn=n.y-e.y,this.kn=rct.quadrant(this.Sn,this.Bn),elt.isTrue(!(0===this.Sn&&0===this.Bn),"EdgeEnd with identical endpoints found")},sct.prototype.interfaces_=function(){return[_ht]},sct.prototype.getClass=function(){return sct};var act=function(e){function n(){var n=arguments[0],i=arguments[1];if(e.call(this,n),this.Rn=null,this.Ln=!1,this.Fn=!1,this.Gn=null,this.Yn=null,this.qn=null,this.Vn=null,this.Wn=null,this._n=[0,-999,-999],this.Rn=i,i)this.init(n.getCoordinate(0),n.getCoordinate(1));else{var o=n.getNumPoints()-1;this.init(n.getCoordinate(o),n.getCoordinate(o-1))}this.computeDirectedLabel()}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.getNextMin=function(){return this.qn},n.prototype.getDepth=function(e){return this._n[e]},n.prototype.setVisited=function(e){this.Fn=e},n.prototype.computeDirectedLabel=function(){this.xn=new Jut(this.En.getLabel()),this.Rn||this.xn.flip()},n.prototype.getNext=function(){return this.Yn},n.prototype.setDepth=function(e,n){if(-999!==this._n[e]&&this._n[e]!==n)throw new Zut("assigned depths do not match",this.getCoordinate());this._n[e]=n},n.prototype.isInteriorAreaEdge=function(){for(var e=this,n=!0,i=0;i<2;i++)e.xn.isArea(i)&&e.xn.getLocation(i,Uut.LEFT)===Sht.INTERIOR&&e.xn.getLocation(i,Uut.RIGHT)===Sht.INTERIOR||(n=!1);return n},n.prototype.setNextMin=function(e){this.qn=e},n.prototype.print=function(n){e.prototype.print.call(this,n),n.print(" "+this._n[Uut.LEFT]+"/"+this._n[Uut.RIGHT]),n.print(" ("+this.getDepthDelta()+")"),this.Ln&&n.print(" inResult")},n.prototype.setMinEdgeRing=function(e){this.Wn=e},n.prototype.isLineEdge=function(){var e=this.xn.isLine(0)||this.xn.isLine(1),n=!this.xn.isArea(0)||this.xn.allPositionsEqual(0,Sht.EXTERIOR),i=!this.xn.isArea(1)||this.xn.allPositionsEqual(1,Sht.EXTERIOR);return e&&n&&i},n.prototype.setEdgeRing=function(e){this.Vn=e},n.prototype.getMinEdgeRing=function(){return this.Wn},n.prototype.getDepthDelta=function(){var e=this.En.getDepthDelta();return this.Rn||(e=-e),e},n.prototype.setInResult=function(e){this.Ln=e},n.prototype.getSym=function(){return this.Gn},n.prototype.isForward=function(){return this.Rn},n.prototype.getEdge=function(){return this.En},n.prototype.printEdge=function(e){this.print(e),e.print(" "),this.Rn?this.En.print(e):this.En.printReverse(e)},n.prototype.setSym=function(e){this.Gn=e},n.prototype.setVisitedEdge=function(e){this.setVisited(e),this.Gn.setVisited(e)},n.prototype.setEdgeDepths=function(e,n){var i=this.getEdge().getDepthDelta();this.Rn||(i=-i);var o=1;e===Uut.LEFT&&(o=-1);var s=Uut.opposite(e),a=n+i*o;this.setDepth(e,n),this.setDepth(s,a)},n.prototype.getEdgeRing=function(){return this.Vn},n.prototype.isInResult=function(){return this.Ln},n.prototype.setNext=function(e){this.Yn=e},n.prototype.isVisited=function(){return this.Fn},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n.depthFactor=function(e,n){return e===Sht.EXTERIOR&&n===Sht.INTERIOR?1:e===Sht.INTERIOR&&n===Sht.EXTERIOR?-1:0},n}(sct),hct=function(){};hct.prototype.createNode=function(e){return new nct(e,null)},hct.prototype.interfaces_=function(){return[]},hct.prototype.getClass=function(){return hct};var lct=function(){if(this.zn=new Plt,this.Cn=null,this.Kn=new Plt,0===arguments.length)this.Cn=new ict(new hct);else if(1===arguments.length){this.Cn=new ict(arguments[0])}};lct.prototype.printEdges=function(e){e.println("Edges:");for(var n=0;n<this.zn.size();n++){e.println("edge "+n+":");var i=this.zn.get(n);i.print(e),i.eiList.print(e)}},lct.prototype.find=function(e){return this.Cn.find(e)},lct.prototype.addNode=function(){return arguments[0]instanceof nct||arguments[0]instanceof Cht?this.Cn.addNode(arguments[0]):void 0},lct.prototype.getNodeIterator=function(){return this.Cn.iterator()},lct.prototype.linkResultDirectedEdges=function(){for(var e=this.Cn.iterator();e.hasNext();)e.next().getEdges().linkResultDirectedEdges()},lct.prototype.debugPrintln=function(e){Vht.out.println(e)},lct.prototype.isBoundaryNode=function(e,n){var i=this.Cn.find(n);if(null===i)return!1;var o=i.getLabel();return null!==o&&o.getLocation(e)===Sht.BOUNDARY},lct.prototype.linkAllDirectedEdges=function(){for(var e=this.Cn.iterator();e.hasNext();)e.next().getEdges().linkAllDirectedEdges()},lct.prototype.matchInSameDirection=function(e,n,i,o){return!!e.equals(i)&&alt.computeOrientation(e,n,o)===alt.COLLINEAR&&rct.quadrant(e,n)===rct.quadrant(i,o)},lct.prototype.getEdgeEnds=function(){return this.Kn},lct.prototype.debugPrint=function(e){Vht.out.print(e)},lct.prototype.getEdgeIterator=function(){return this.zn.iterator()},lct.prototype.findEdgeInSameDirection=function(e,n){for(var i=this,o=0;o<this.zn.size();o++){var s=i.zn.get(o),a=s.getCoordinates();if(i.matchInSameDirection(e,n,a[0],a[1]))return s;if(i.matchInSameDirection(e,n,a[a.length-1],a[a.length-2]))return s}return null},lct.prototype.insertEdge=function(e){this.zn.add(e)},lct.prototype.findEdgeEnd=function(e){for(var n=this.getEdgeEnds().iterator();n.hasNext();){var i=n.next();if(i.getEdge()===e)return i}return null},lct.prototype.addEdges=function(e){for(var n=this,i=e.iterator();i.hasNext();){var o=i.next();n.zn.add(o);var s=new act(o,!0),a=new act(o,!1);s.setSym(a),a.setSym(s),n.add(s),n.add(a)}},lct.prototype.add=function(e){this.Cn.add(e),this.Kn.add(e)},lct.prototype.getNodes=function(){return this.Cn.values()},lct.prototype.findEdge=function(e,n){for(var i=0;i<this.zn.size();i++){var o=this.zn.get(i),s=o.getCoordinates();if(e.equals(s[0])&&n.equals(s[1]))return o}return null},lct.prototype.interfaces_=function(){return[]},lct.prototype.getClass=function(){return lct},lct.linkResultDirectedEdges=function(e){for(var n=e.iterator();n.hasNext();)n.next().getEdges().linkResultDirectedEdges()};var uct=function(){this.pn=null,this.Hn=new Plt,this.pn=arguments[0]};uct.prototype.sortShellsAndHoles=function(e,n,i){for(var o=e.iterator();o.hasNext();){var s=o.next();s.isHole()?i.add(s):n.add(s)}},uct.prototype.computePolygons=function(e){for(var n=new Plt,i=e.iterator();i.hasNext();){var o=i.next().toPolygon(this.pn);n.add(o)}return n},uct.prototype.placeFreeHoles=function(e,n){for(var i=n.iterator();i.hasNext();){var o=i.next();if(null===o.getShell()){var s=this.findEdgeRingContaining(o,e);if(null===s)throw new Zut("unable to assign hole to a shell",o.getCoordinate(0));o.setShell(s)}}},uct.prototype.buildMinimalEdgeRings=function(e,n,i){for(var o=new Plt,s=e.iterator();s.hasNext();){var a=s.next();if(a.getMaxNodeDegree()>2){a.linkDirectedEdgesForMinimalEdgeRings();var h=a.buildMinimalRings(),l=this.findShell(h);null!==l?(this.placePolygonHoles(l,h),n.add(l)):i.addAll(h)}else o.add(a)}return o},uct.prototype.containsPoint=function(e){for(var n=this.Hn.iterator();n.hasNext();)if(n.next().containsPoint(e))return!0;return!1},uct.prototype.buildMaximalEdgeRings=function(e){for(var n=new Plt,i=e.iterator();i.hasNext();){var o=i.next();if(o.isInResult()&&o.getLabel().isArea()&&null===o.getEdgeRing()){var s=new tct(o,this.pn);n.add(s),s.setInResult()}}return n},uct.prototype.placePolygonHoles=function(e,n){for(var i=n.iterator();i.hasNext();){var o=i.next();o.isHole()&&o.setShell(e)}},uct.prototype.getPolygons=function(){return this.computePolygons(this.Hn)},uct.prototype.findEdgeRingContaining=function(e,n){for(var i=e.getLinearRing(),o=i.getEnvelopeInternal(),s=i.getCoordinateN(0),a=null,h=null,l=n.iterator();l.hasNext();){var c=l.next(),A=c.getLinearRing(),f=A.getEnvelopeInternal();null!==a&&(h=a.getLinearRing().getEnvelopeInternal());var d=!1;f.contains(o)&&alt.isPointInRing(s,A.getCoordinates())&&(d=!0),d&&(null===a||h.contains(f))&&(a=c)}return a},uct.prototype.findShell=function(e){for(var n=0,i=null,o=e.iterator();o.hasNext();){var s=o.next();s.isHole()||(i=s,n++)}return elt.isTrue(n<=1,"found two shells in MinimalEdgeRing list"),i},uct.prototype.add=function(){if(1===arguments.length){var e=arguments[0];this.add(e.getEdgeEnds(),e.getNodes())}else if(2===arguments.length){var n=arguments[0];lct.linkResultDirectedEdges(arguments[1]);var i=this.buildMaximalEdgeRings(n),o=new Plt,s=this.buildMinimalEdgeRings(i,this.Hn,o);this.sortShellsAndHoles(s,this.Hn,o),this.placeFreeHoles(this.Hn,o)}},uct.prototype.interfaces_=function(){return[]},uct.prototype.getClass=function(){return uct};var cct=function(){};cct.prototype.getBounds=function(){},cct.prototype.interfaces_=function(){return[]},cct.prototype.getClass=function(){return cct};var Act=function(){this.Jn=null,this.Zn=null;var e=arguments[1];this.Jn=arguments[0],this.Zn=e};Act.prototype.getItem=function(){return this.Zn},Act.prototype.getBounds=function(){return this.Jn},Act.prototype.interfaces_=function(){return[cct,wht]},Act.prototype.getClass=function(){return Act};var fct=function(){this.Xn=null,this.$n=null,this.Xn=0,this.$n=new Plt,this.$n.add(null)};fct.prototype.poll=function(){if(this.isEmpty())return null;var e=this.$n.get(1);return this.$n.set(1,this.$n.get(this.Xn)),this.Xn-=1,this.reorder(1),e},fct.prototype.size=function(){return this.Xn},fct.prototype.reorder=function(e){for(var n=this,i=null,o=this.$n.get(e);2*e<=this.Xn&&((i=2*e)!==n.Xn&&n.$n.get(i+1).compareTo(n.$n.get(i))<0&&i++,n.$n.get(i).compareTo(o)<0);e=i)n.$n.set(e,n.$n.get(i));this.$n.set(e,o)},fct.prototype.clear=function(){this.Xn=0,this.$n.clear()},fct.prototype.isEmpty=function(){return 0===this.Xn},fct.prototype.add=function(e){this.$n.add(null),this.Xn+=1;var n=this.Xn;for(this.$n.set(0,e);e.compareTo(this.$n.get(Math.trunc(n/2)))<0;n/=2)this.$n.set(n,this.$n.get(Math.trunc(n/2)));this.$n.set(n,e)},fct.prototype.interfaces_=function(){return[]},fct.prototype.getClass=function(){return fct};var dct=function(){};dct.prototype.visitItem=function(e){},dct.prototype.interfaces_=function(){return[]},dct.prototype.getClass=function(){return dct};var pct=function(){};pct.prototype.insert=function(e,n){},pct.prototype.remove=function(e,n){},pct.prototype.query=function(){},pct.prototype.interfaces_=function(){return[]},pct.prototype.getClass=function(){return pct};var gct=function(){if(this.Ai=new Plt,this.Jn=null,this.ti=null,0===arguments.length);else if(1===arguments.length){this.ti=arguments[0]}},mct={serialVersionUID:{configurable:!0}};gct.prototype.getLevel=function(){return this.ti},gct.prototype.size=function(){return this.Ai.size()},gct.prototype.getChildBoundables=function(){return this.Ai},gct.prototype.addChildBoundable=function(e){elt.isTrue(null===this.Jn),this.Ai.add(e)},gct.prototype.isEmpty=function(){return this.Ai.isEmpty()},gct.prototype.getBounds=function(){return null===this.Jn&&(this.Jn=this.computeBounds()),this.Jn},gct.prototype.interfaces_=function(){return[cct,wht]},gct.prototype.getClass=function(){return gct},mct.serialVersionUID.get=function(){return 0x5a1e55ec41369800},Object.defineProperties(gct,mct);var yct=function(){};yct.reverseOrder=function(){return{compare:function(e,n){return n.compareTo(e)}}},yct.min=function(e){return yct.sort(e),e.get(0)},yct.sort=function(e,n){var i=e.toArray();n?Qlt.sort(i,n):Qlt.sort(i);for(var o=e.iterator(),s=0,a=i.length;s<a;s++)o.next(),o.set(i[s])},yct.singletonList=function(e){var n=new Plt;return n.add(e),n};var vct=function(){this.ni=null,this.ii=null,this.ri=null,this.ei=null;var e=arguments[1],n=arguments[2];this.ni=arguments[0],this.ii=e,this.ei=n,this.ri=this.distance()};vct.prototype.expandToQueue=function(e,n){var i=vct.isComposite(this.ni),o=vct.isComposite(this.ii);if(i&&o)return vct.area(this.ni)>vct.area(this.ii)?(this.expand(this.ni,this.ii,e,n),null):(this.expand(this.ii,this.ni,e,n),null);if(i)return this.expand(this.ni,this.ii,e,n),null;if(o)return this.expand(this.ii,this.ni,e,n),null;throw new mht("neither boundable is composite")},vct.prototype.isLeaves=function(){return!(vct.isComposite(this.ni)||vct.isComposite(this.ii))},vct.prototype.compareTo=function(e){return this.ri<e.ri?-1:this.ri>e.ri?1:0},vct.prototype.expand=function(e,n,i,o){for(var s=e.getChildBoundables().iterator();s.hasNext();){var a=s.next(),h=new vct(a,n,this.ei);h.getDistance()<o&&i.add(h)}},vct.prototype.getBoundable=function(e){return 0===e?this.ni:this.ii},vct.prototype.getDistance=function(){return this.ri},vct.prototype.distance=function(){return this.isLeaves()?this.ei.distance(this.ni,this.ii):this.ni.getBounds().distance(this.ii.getBounds())},vct.prototype.interfaces_=function(){return[_ht]},vct.prototype.getClass=function(){return vct},vct.area=function(e){return e.getBounds().getArea()},vct.isComposite=function(e){return e instanceof gct};var _ct=function e(){if(this.si=null,this.ui=!1,this.oi=new Plt,this.hi=null,0===arguments.length)this.hi=e.DEFAULT_NODE_CAPACITY;else if(1===arguments.length){var n=arguments[0];elt.isTrue(n>1,"Node capacity must be greater than 1"),this.hi=n}},xct={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};_ct.prototype.getNodeCapacity=function(){return this.hi},_ct.prototype.lastNode=function(e){return e.get(e.size()-1)},_ct.prototype.size=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this.si));if(1===arguments.length){for(var e=0,n=arguments[0].getChildBoundables().iterator();n.hasNext();){var i=n.next();i instanceof gct?e+=this.size(i):i instanceof Act&&(e+=1)}return e}},_ct.prototype.removeItem=function(e,n){for(var i=null,o=e.getChildBoundables().iterator();o.hasNext();){var s=o.next();s instanceof Act&&s.getItem()===n&&(i=s)}return null!==i&&(e.getChildBoundables().remove(i),!0)},_ct.prototype.itemsTree=function(){if(0===arguments.length){this.build();var e=this.itemsTree(this.si);return null===e?new Plt:e}if(1===arguments.length){for(var n=arguments[0],i=new Plt,o=n.getChildBoundables().iterator();o.hasNext();){var s=o.next();if(s instanceof gct){var a=this.itemsTree(s);null!==a&&i.add(a)}else s instanceof Act?i.add(s.getItem()):elt.shouldNeverReachHere()}return i.size()<=0?null:i}},_ct.prototype.insert=function(e,n){elt.isTrue(!this.ui,"Cannot insert items into an STR packed R-tree after it has been built."),this.oi.add(new Act(e,n))},_ct.prototype.boundablesAtLevel=function(){if(1===arguments.length){var e=arguments[0],n=new Plt;return this.boundablesAtLevel(e,this.si,n),n}if(3===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2];if(elt.isTrue(i>-2),o.getLevel()===i)return s.add(o),null;for(var a=o.getChildBoundables().iterator();a.hasNext();){var h=a.next();h instanceof gct?this.boundablesAtLevel(i,h,s):(elt.isTrue(h instanceof Act),-1===i&&s.add(h))}return null}},_ct.prototype.query=function(){var e=this;if(1===arguments.length){var n=arguments[0];this.build();var i=new Plt;return this.isEmpty()||this.getIntersectsOp().intersects(this.si.getBounds(),n)&&this.query(n,this.si,i),i}if(2===arguments.length){var o=arguments[0],s=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this.si.getBounds(),o)&&this.query(o,this.si,s)}else if(3===arguments.length)if(Eht(arguments[2],dct)&&arguments[0]instanceof Object&&arguments[1]instanceof gct)for(var a=arguments[0],h=arguments[2],l=arguments[1].getChildBoundables(),c=0;c<l.size();c++){var A=l.get(c);e.getIntersectsOp().intersects(A.getBounds(),a)&&(A instanceof gct?e.query(a,A,h):A instanceof Act?h.visitItem(A.getItem()):elt.shouldNeverReachHere())}else if(Eht(arguments[2],wlt)&&arguments[0]instanceof Object&&arguments[1]instanceof gct)for(var f=arguments[0],d=arguments[2],p=arguments[1].getChildBoundables(),g=0;g<p.size();g++){var v=p.get(g);e.getIntersectsOp().intersects(v.getBounds(),f)&&(v instanceof gct?e.query(f,v,d):v instanceof Act?d.add(v.getItem()):elt.shouldNeverReachHere())}},_ct.prototype.build=function(){if(this.ui)return null;this.si=this.oi.isEmpty()?this.createNode(0):this.createHigherLevels(this.oi,-1),this.oi=null,this.ui=!0},_ct.prototype.getRoot=function(){return this.build(),this.si},_ct.prototype.remove=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this.si.getBounds(),e)&&this.remove(e,this.si,n)}if(3===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2],a=this.removeItem(o,s);if(a)return!0;for(var h=null,l=o.getChildBoundables().iterator();l.hasNext();){var c=l.next();if(this.getIntersectsOp().intersects(c.getBounds(),i)&&c instanceof gct&&(a=this.remove(i,c,s))){h=c;break}}return null!==h&&h.getChildBoundables().isEmpty()&&o.getChildBoundables().remove(h),a}},_ct.prototype.createHigherLevels=function(e,n){elt.isTrue(!e.isEmpty());var i=this.createParentBoundables(e,n+1);return 1===i.size()?i.get(0):this.createHigherLevels(i,n+1)},_ct.prototype.depth=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this.si));if(1===arguments.length){for(var e=0,n=arguments[0].getChildBoundables().iterator();n.hasNext();){var i=n.next();if(i instanceof gct){var o=this.depth(i);o>e&&(e=o)}}return e+1}},_ct.prototype.createParentBoundables=function(e,n){var i=this;elt.isTrue(!e.isEmpty());var o=new Plt;o.add(this.createNode(n));var s=new Plt(e);yct.sort(s,this.getComparator());for(var a=s.iterator();a.hasNext();){var h=a.next();i.lastNode(o).getChildBoundables().size()===i.getNodeCapacity()&&o.add(i.createNode(n)),i.lastNode(o).addChildBoundable(h)}return o},_ct.prototype.isEmpty=function(){return this.ui?this.si.isEmpty():this.oi.isEmpty()},_ct.prototype.interfaces_=function(){return[wht]},_ct.prototype.getClass=function(){return _ct},_ct.compareDoubles=function(e,n){return e>n?1:e<n?-1:0},xct.IntersectsOp.get=function(){return bct},xct.serialVersionUID.get=function(){return-0x35ef64c82d4c5400},xct.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(_ct,xct);var bct=function(){},wct=function(){};wct.prototype.distance=function(e,n){},wct.prototype.interfaces_=function(){return[]},wct.prototype.getClass=function(){return wct};var Cct=function(e){function n(i){e.call(this,i=i||n.DEFAULT_NODE_CAPACITY)}e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n;var i={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return n.prototype.createParentBoundablesFromVerticalSlices=function(e,n){elt.isTrue(e.length>0);for(var i=new Plt,o=0;o<e.length;o++)i.addAll(this.createParentBoundablesFromVerticalSlice(e[o],n));return i},n.prototype.createNode=function(e){return new Pct(e)},n.prototype.size=function(){return 0===arguments.length?e.prototype.size.call(this):e.prototype.size.apply(this,arguments)},n.prototype.insert=function(){if(2!==arguments.length)return e.prototype.insert.apply(this,arguments);var n=arguments[0],i=arguments[1];if(n.isNull())return null;e.prototype.insert.call(this,n,i)},n.prototype.getIntersectsOp=function(){return n.intersectsOp},n.prototype.verticalSlices=function(e,n){for(var i=Math.trunc(Math.ceil(e.size()/n)),o=new Array(n).fill(null),s=e.iterator(),a=0;a<n;a++){o[a]=new Plt;for(var h=0;s.hasNext()&&h<i;){var l=s.next();o[a].add(l),h++}}return o},n.prototype.query=function(){if(1===arguments.length)return e.prototype.query.call(this,arguments[0]);if(2===arguments.length)e.prototype.query.call(this,arguments[0],arguments[1]);else if(3===arguments.length)if(Eht(arguments[2],dct)&&arguments[0]instanceof Object&&arguments[1]instanceof gct){e.prototype.query.call(this,arguments[0],arguments[1],arguments[2])}else if(Eht(arguments[2],wlt)&&arguments[0]instanceof Object&&arguments[1]instanceof gct){e.prototype.query.call(this,arguments[0],arguments[1],arguments[2])}},n.prototype.getComparator=function(){return n.yComparator},n.prototype.createParentBoundablesFromVerticalSlice=function(n,i){return e.prototype.createParentBoundables.call(this,n,i)},n.prototype.remove=function(){return 2===arguments.length?e.prototype.remove.call(this,arguments[0],arguments[1]):e.prototype.remove.apply(this,arguments)},n.prototype.depth=function(){return 0===arguments.length?e.prototype.depth.call(this):e.prototype.depth.apply(this,arguments)},n.prototype.createParentBoundables=function(e,i){elt.isTrue(!e.isEmpty());var o=Math.trunc(Math.ceil(e.size()/this.getNodeCapacity())),s=new Plt(e);yct.sort(s,n.xComparator);var a=this.verticalSlices(s,Math.trunc(Math.ceil(Math.sqrt(o))));return this.createParentBoundablesFromVerticalSlices(a,i)},n.prototype.nearestNeighbour=function(){if(1===arguments.length){if(Eht(arguments[0],wct)){var e=arguments[0],i=new vct(this.getRoot(),this.getRoot(),e);return this.nearestNeighbour(i)}if(arguments[0]instanceof vct)return this.nearestNeighbour(arguments[0],yht.POSITIVE_INFINITY)}else if(2===arguments.length){if(arguments[0]instanceof n&&Eht(arguments[1],wct)){var o=arguments[0],s=arguments[1],a=new vct(this.getRoot(),o.getRoot(),s);return this.nearestNeighbour(a)}if(arguments[0]instanceof vct&&"number"==typeof arguments[1]){var h=arguments[0],l=arguments[1],c=null,A=new fct;for(A.add(h);!A.isEmpty()&&l>0;){var f=A.poll(),d=f.getDistance();if(d>=l)break;f.isLeaves()?(l=d,c=f):f.expandToQueue(A,l)}return[c.getBoundable(0).getItem(),c.getBoundable(1).getItem()]}}else if(3===arguments.length){var p=arguments[2],g=new Act(arguments[0],arguments[1]),v=new vct(this.getRoot(),g,p);return this.nearestNeighbour(v)[0]}},n.prototype.interfaces_=function(){return[pct,wht]},n.prototype.getClass=function(){return n},n.centreX=function(e){return n.avg(e.getMinX(),e.getMaxX())},n.avg=function(e,n){return(e+n)/2},n.centreY=function(e){return n.avg(e.getMinY(),e.getMaxY())},i.STRtreeNode.get=function(){return Pct},i.serialVersionUID.get=function(){return 0x39920f7d5f261e0},i.xComparator.get=function(){return{interfaces_:function(){return[bht]},compare:function(i,o){return e.compareDoubles(n.centreX(i.getBounds()),n.centreX(o.getBounds()))}}},i.yComparator.get=function(){return{interfaces_:function(){return[bht]},compare:function(i,o){return e.compareDoubles(n.centreY(i.getBounds()),n.centreY(o.getBounds()))}}},i.intersectsOp.get=function(){return{interfaces_:function(){return[e.IntersectsOp]},intersects:function(e,n){return e.intersects(n)}}},i.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(n,i),n}(_ct),Pct=function(e){function n(){e.call(this,arguments[0])}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.computeBounds=function(){for(var e=null,n=this.getChildBoundables().iterator();n.hasNext();){var i=n.next();null===e?e=new qht(i.getBounds()):e.expandToInclude(i.getBounds())}return e},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n}(gct),Mct=function(){};Mct.prototype.interfaces_=function(){return[]},Mct.prototype.getClass=function(){return Mct},Mct.relativeSign=function(e,n){return e<n?-1:e>n?1:0},Mct.compare=function(e,n,i){if(n.equals2D(i))return 0;var o=Mct.relativeSign(n.x,i.x),s=Mct.relativeSign(n.y,i.y);switch(e){case 0:return Mct.compareValue(o,s);case 1:return Mct.compareValue(s,o);case 2:return Mct.compareValue(s,-o);case 3:return Mct.compareValue(-o,s);case 4:return Mct.compareValue(-o,-s);case 5:return Mct.compareValue(-s,-o);case 6:return Mct.compareValue(-s,o);case 7:return Mct.compareValue(o,-s)}return elt.shouldNeverReachHere("invalid octant value"),0},Mct.compareValue=function(e,n){return e<0?-1:e>0?1:n<0?-1:n>0?1:0};var Tct=function(){this.fi=null,this.coord=null,this.segmentIndex=null,this.ci=null,this.ai=null;var e=arguments[0],n=arguments[1],i=arguments[2],o=arguments[3];this.fi=e,this.coord=new Cht(n),this.segmentIndex=i,this.ci=o,this.ai=!n.equals2D(e.getCoordinate(i))};Tct.prototype.getCoordinate=function(){return this.coord},Tct.prototype.print=function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex)},Tct.prototype.compareTo=function(e){var n=e;return this.segmentIndex<n.segmentIndex?-1:this.segmentIndex>n.segmentIndex?1:this.coord.equals2D(n.coord)?0:Mct.compare(this.ci,this.coord,n.coord)},Tct.prototype.isEndPoint=function(e){return 0===this.segmentIndex&&!this.ai||this.segmentIndex===e},Tct.prototype.isInterior=function(){return this.ai},Tct.prototype.interfaces_=function(){return[_ht]},Tct.prototype.getClass=function(){return Tct};var Sct=function(){this.vi=new Glt,this.En=null,this.En=arguments[0]};Sct.prototype.getSplitCoordinates=function(){var e=new Tlt;this.addEndpoints();for(var n=this.iterator(),i=n.next();n.hasNext();){var o=n.next();this.addEdgeCoordinates(i,o,e),i=o}return e.toCoordinateArray()},Sct.prototype.addCollapsedNodes=function(){var e=new Plt;this.findCollapsesFromInsertedNodes(e),this.findCollapsesFromExistingVertices(e);for(var n=e.iterator();n.hasNext();){var i=n.next().intValue();this.add(this.En.getCoordinate(i),i)}},Sct.prototype.print=function(e){e.println("Intersections:");for(var n=this.iterator();n.hasNext();)n.next().print(e)},Sct.prototype.findCollapsesFromExistingVertices=function(e){for(var n=0;n<this.En.size()-2;n++){var i=this.En.getCoordinate(n),o=this.En.getCoordinate(n+2);i.equals2D(o)&&e.add(new kht(n+1))}},Sct.prototype.addEdgeCoordinates=function(e,n,i){var o=this.En.getCoordinate(n.segmentIndex),s=n.isInterior()||!n.coord.equals2D(o);i.add(new Cht(e.coord),!1);for(var a=e.segmentIndex+1;a<=n.segmentIndex;a++)i.add(this.En.getCoordinate(a));s&&i.add(new Cht(n.coord))},Sct.prototype.iterator=function(){return this.vi.values().iterator()},Sct.prototype.addSplitEdges=function(e){this.addEndpoints(),this.addCollapsedNodes();for(var n=this.iterator(),i=n.next();n.hasNext();){var o=n.next(),s=this.createSplitEdge(i,o);e.add(s),i=o}},Sct.prototype.findCollapseIndex=function(e,n,i){if(!e.coord.equals2D(n.coord))return!1;var o=n.segmentIndex-e.segmentIndex;return n.isInterior()||o--,1===o&&(i[0]=e.segmentIndex+1,!0)},Sct.prototype.findCollapsesFromInsertedNodes=function(e){for(var n=new Array(1).fill(null),i=this.iterator(),o=i.next();i.hasNext();){var s=i.next();this.findCollapseIndex(o,s,n)&&e.add(new kht(n[0])),o=s}},Sct.prototype.getEdge=function(){return this.En},Sct.prototype.addEndpoints=function(){var e=this.En.size()-1;this.add(this.En.getCoordinate(0),0),this.add(this.En.getCoordinate(e),e)},Sct.prototype.createSplitEdge=function(e,n){var i=n.segmentIndex-e.segmentIndex+2,o=this.En.getCoordinate(n.segmentIndex),s=n.isInterior()||!n.coord.equals2D(o);s||i--;var a=new Array(i).fill(null),h=0;a[h++]=new Cht(e.coord);for(var l=e.segmentIndex+1;l<=n.segmentIndex;l++)a[h++]=this.En.getCoordinate(l);return s&&(a[h]=new Cht(n.coord)),new Rct(a,this.En.getData())},Sct.prototype.add=function(e,n){var i=new Tct(this.En,e,n,this.En.getSegmentOctant(n)),o=this.vi.get(i);return null!==o?(elt.isTrue(o.coord.equals2D(e),"Found equal nodes with different coordinates"),o):(this.vi.put(i,i),i)},Sct.prototype.checkSplitEdgesCorrectness=function(e){var n=this.En.getCoordinates(),i=e.get(0).getCoordinate(0);if(!i.equals2D(n[0]))throw new $ht("bad split edge start point at "+i);var o=e.get(e.size()-1).getCoordinates(),s=o[o.length-1];if(!s.equals2D(n[n.length-1]))throw new $ht("bad split edge end point at "+s)},Sct.prototype.interfaces_=function(){return[]},Sct.prototype.getClass=function(){return Sct};var Ict=function(){};Ict.prototype.interfaces_=function(){return[]},Ict.prototype.getClass=function(){return Ict},Ict.octant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var e=arguments[0],n=arguments[1];if(0===e&&0===n)throw new mht("Cannot compute the octant for point ( "+e+", "+n+" )");var i=Math.abs(e),o=Math.abs(n);return e>=0?n>=0?i>=o?0:1:i>=o?7:6:n>=0?i>=o?3:2:i>=o?4:5}if(arguments[0]instanceof Cht&&arguments[1]instanceof Cht){var s=arguments[0],a=arguments[1],h=a.x-s.x,l=a.y-s.y;if(0===h&&0===l)throw new mht("Cannot compute the octant for two identical points "+s);return Ict.octant(h,l)}};var Ect=function(){};Ect.prototype.getCoordinates=function(){},Ect.prototype.size=function(){},Ect.prototype.getCoordinate=function(e){},Ect.prototype.isClosed=function(){},Ect.prototype.setData=function(e){},Ect.prototype.getData=function(){},Ect.prototype.interfaces_=function(){return[]},Ect.prototype.getClass=function(){return Ect};var Oct=function(){};Oct.prototype.addIntersection=function(e,n){},Oct.prototype.interfaces_=function(){return[Ect]},Oct.prototype.getClass=function(){return Oct};var Rct=function(){this.li=new Sct(this),this.dn=null,this.wi=null;var e=arguments[1];this.dn=arguments[0],this.wi=e};Rct.prototype.getCoordinates=function(){return this.dn},Rct.prototype.size=function(){return this.dn.length},Rct.prototype.getCoordinate=function(e){return this.dn[e]},Rct.prototype.isClosed=function(){return this.dn[0].equals(this.dn[this.dn.length-1])},Rct.prototype.getSegmentOctant=function(e){return e===this.dn.length-1?-1:this.safeOctant(this.getCoordinate(e),this.getCoordinate(e+1))},Rct.prototype.setData=function(e){this.wi=e},Rct.prototype.safeOctant=function(e,n){return e.equals2D(n)?0:Ict.octant(e,n)},Rct.prototype.getData=function(){return this.wi},Rct.prototype.addIntersection=function(){if(2===arguments.length)this.addIntersectionNode(arguments[0],arguments[1]);else if(4===arguments.length){var e=arguments[1],n=new Cht(arguments[0].getIntersection(arguments[3]));this.addIntersection(n,e)}},Rct.prototype.toString=function(){return Kht.toLineString(new Put(this.dn))},Rct.prototype.getNodeList=function(){return this.li},Rct.prototype.addIntersectionNode=function(e,n){var i=n,o=i+1;o<this.dn.length&&(e.equals2D(this.dn[o])&&(i=o));return this.li.add(e,i)},Rct.prototype.addIntersections=function(e,n,i){for(var o=0;o<e.getIntersectionNum();o++)this.addIntersection(e,n,i,o)},Rct.prototype.interfaces_=function(){return[Oct]},Rct.prototype.getClass=function(){return Rct},Rct.getNodedSubstrings=function(){if(1===arguments.length){var e=arguments[0],n=new Plt;return Rct.getNodedSubstrings(e,n),n}if(2===arguments.length)for(var i=arguments[1],o=arguments[0].iterator();o.hasNext();)o.next().getNodeList().addSplitEdges(i)};var Dct=function(){if(this.p0=null,this.p1=null,0===arguments.length)this.p0=new Cht,this.p1=new Cht;else if(1===arguments.length){var e=arguments[0];this.p0=new Cht(e.p0),this.p1=new Cht(e.p1)}else if(2===arguments.length)this.p0=arguments[0],this.p1=arguments[1];else if(4===arguments.length){var n=arguments[2],i=arguments[3];this.p0=new Cht(arguments[0],arguments[1]),this.p1=new Cht(n,i)}},kct={serialVersionUID:{configurable:!0}};Dct.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)},Dct.prototype.orientationIndex=function(){if(arguments[0]instanceof Dct){var e=arguments[0],n=alt.orientationIndex(this.p0,this.p1,e.p0),i=alt.orientationIndex(this.p0,this.p1,e.p1);return n>=0&&i>=0||n<=0&&i<=0?Math.max(n,i):0}if(arguments[0]instanceof Cht)return alt.orientationIndex(this.p0,this.p1,arguments[0])},Dct.prototype.toGeometry=function(e){return e.createLineString([this.p0,this.p1])},Dct.prototype.isVertical=function(){return this.p0.x===this.p1.x},Dct.prototype.equals=function(e){if(!(e instanceof Dct))return!1;var n=e;return this.p0.equals(n.p0)&&this.p1.equals(n.p1)},Dct.prototype.intersection=function(e){var n=new rlt;return n.computeIntersection(this.p0,this.p1,e.p0,e.p1),n.hasIntersection()?n.getIntersection(0):null},Dct.prototype.project=function(){if(arguments[0]instanceof Cht){var e=arguments[0];if(e.equals(this.p0)||e.equals(this.p1))return new Cht(e);var n=this.projectionFactor(e),i=new Cht;return i.x=this.p0.x+n*(this.p1.x-this.p0.x),i.y=this.p0.y+n*(this.p1.y-this.p0.y),i}if(arguments[0]instanceof Dct){var o=arguments[0],s=this.projectionFactor(o.p0),a=this.projectionFactor(o.p1);if(s>=1&&a>=1)return null;if(s<=0&&a<=0)return null;var h=this.project(o.p0);s<0&&(h=this.p0),s>1&&(h=this.p1);var l=this.project(o.p1);return a<0&&(l=this.p0),a>1&&(l=this.p1),new Dct(h,l)}},Dct.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()},Dct.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)},Dct.prototype.getCoordinate=function(e){return 0===e?this.p0:this.p1},Dct.prototype.distancePerpendicular=function(e){return alt.distancePointLinePerpendicular(e,this.p0,this.p1)},Dct.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)},Dct.prototype.midPoint=function(){return Dct.midPoint(this.p0,this.p1)},Dct.prototype.projectionFactor=function(e){if(e.equals(this.p0))return 0;if(e.equals(this.p1))return 1;var n=this.p1.x-this.p0.x,i=this.p1.y-this.p0.y,o=n*n+i*i;return o<=0?yht.NaN:((e.x-this.p0.x)*n+(e.y-this.p0.y)*i)/o},Dct.prototype.closestPoints=function(e){var n=this.intersection(e);if(null!==n)return[n,n];var i=new Array(2).fill(null),o=yht.MAX_VALUE,s=null,a=this.closestPoint(e.p0);o=a.distance(e.p0),i[0]=a,i[1]=e.p0;var h=this.closestPoint(e.p1);(s=h.distance(e.p1))<o&&(o=s,i[0]=h,i[1]=e.p1);var l=e.closestPoint(this.p0);(s=l.distance(this.p0))<o&&(o=s,i[0]=this.p0,i[1]=l);var c=e.closestPoint(this.p1);return(s=c.distance(this.p1))<o&&(o=s,i[0]=this.p1,i[1]=c),i},Dct.prototype.closestPoint=function(e){var n=this.projectionFactor(e);return n>0&&n<1?this.project(e):this.p0.distance(e)<this.p1.distance(e)?this.p0:this.p1},Dct.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)},Dct.prototype.getLength=function(){return this.p0.distance(this.p1)},Dct.prototype.compareTo=function(e){var n=e,i=this.p0.compareTo(n.p0);return 0!==i?i:this.p1.compareTo(n.p1)},Dct.prototype.reverse=function(){var e=this.p0;this.p0=this.p1,this.p1=e},Dct.prototype.equalsTopo=function(e){return this.p0.equals(e.p0)&&(this.p1.equals(e.p1)||this.p0.equals(e.p1))&&this.p1.equals(e.p0)},Dct.prototype.lineIntersection=function(e){try{return Wht.intersection(this.p0,this.p1,e.p0,e.p1)}catch(e){if(!(e instanceof Ght))throw e}return null},Dct.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)},Dct.prototype.pointAlongOffset=function(e,n){var i=this.p0.x+e*(this.p1.x-this.p0.x),o=this.p0.y+e*(this.p1.y-this.p0.y),s=this.p1.x-this.p0.x,a=this.p1.y-this.p0.y,h=Math.sqrt(s*s+a*a),l=0,c=0;if(0!==n){if(h<=0)throw new Error("Cannot compute offset from zero-length line segment");l=n*s/h,c=n*a/h}return new Cht(i-c,o+l)},Dct.prototype.setCoordinates=function(){if(1===arguments.length){var e=arguments[0];this.setCoordinates(e.p0,e.p1)}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.p0.x=n.x,this.p0.y=n.y,this.p1.x=i.x,this.p1.y=i.y}},Dct.prototype.segmentFraction=function(e){var n=this.projectionFactor(e);return n<0?n=0:(n>1||yht.isNaN(n))&&(n=1),n},Dct.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"},Dct.prototype.isHorizontal=function(){return this.p0.y===this.p1.y},Dct.prototype.distance=function(){if(arguments[0]instanceof Dct){var e=arguments[0];return alt.distanceLineLine(this.p0,this.p1,e.p0,e.p1)}if(arguments[0]instanceof Cht)return alt.distancePointLine(arguments[0],this.p0,this.p1)},Dct.prototype.pointAlong=function(e){var n=new Cht;return n.x=this.p0.x+e*(this.p1.x-this.p0.x),n.y=this.p0.y+e*(this.p1.y-this.p0.y),n},Dct.prototype.hashCode=function(){var e=yht.doubleToLongBits(this.p0.x);e^=31*yht.doubleToLongBits(this.p0.y);var n=Math.trunc(e)^Math.trunc(e>>32),i=yht.doubleToLongBits(this.p1.x);return i^=31*yht.doubleToLongBits(this.p1.y),n^Math.trunc(i)^Math.trunc(i>>32)},Dct.prototype.interfaces_=function(){return[_ht,wht]},Dct.prototype.getClass=function(){return Dct},Dct.midPoint=function(e,n){return new Cht((e.x+n.x)/2,(e.y+n.y)/2)},kct.serialVersionUID.get=function(){return 0x2d2172135f411c00},Object.defineProperties(Dct,kct);var Lct=function(){this.tempEnv1=new qht,this.tempEnv2=new qht,this.Pi=new Dct,this.gi=new Dct};Lct.prototype.overlap=function(){if(2===arguments.length);else if(4===arguments.length){var e=arguments[2],n=arguments[3];arguments[0].getLineSegment(arguments[1],this.Pi),e.getLineSegment(n,this.gi),this.overlap(this.Pi,this.gi)}},Lct.prototype.interfaces_=function(){return[]},Lct.prototype.getClass=function(){return Lct};var Fct=function(){this.dn=null,this.Ci=null,this.Di=null,this.In=null,this.Ii=null,this.bi=null;var e=arguments[1],n=arguments[2],i=arguments[3];this.dn=arguments[0],this.Ci=e,this.Di=n,this.Ii=i};Fct.prototype.getLineSegment=function(e,n){n.p0=this.dn[e],n.p1=this.dn[e+1]},Fct.prototype.computeSelect=function(e,n,i,o){if(o.tempEnv1.init(this.dn[n],this.dn[i]),i-n==1)return o.select(this,n),null;if(!e.intersects(o.tempEnv1))return null;var s=Math.trunc((n+i)/2);n<s&&this.computeSelect(e,n,s,o),s<i&&this.computeSelect(e,s,i,o)},Fct.prototype.getCoordinates=function(){for(var e=new Array(this.Di-this.Ci+1).fill(null),n=0,i=this.Ci;i<=this.Di;i++)e[n++]=this.dn[i];return e},Fct.prototype.computeOverlaps=function(e,n){this.computeOverlapsInternal(this.Ci,this.Di,e,e.Ci,e.Di,n)},Fct.prototype.setId=function(e){this.bi=e},Fct.prototype.select=function(e,n){this.computeSelect(e,this.Ci,this.Di,n)},Fct.prototype.getEnvelope=function(){null===this.In&&(this.In=new qht(this.dn[this.Ci],this.dn[this.Di]));return this.In},Fct.prototype.getEndIndex=function(){return this.Di},Fct.prototype.getStartIndex=function(){return this.Ci},Fct.prototype.getContext=function(){return this.Ii},Fct.prototype.getId=function(){return this.bi},Fct.prototype.computeOverlapsInternal=function(e,n,i,o,s,a){var h=this.dn[e],l=this.dn[n],c=i.dn[o],A=i.dn[s];if(n-e==1&&s-o==1)return a.overlap(this,e,i,o),null;if(a.tempEnv1.init(h,l),a.tempEnv2.init(c,A),!a.tempEnv1.intersects(a.tempEnv2))return null;var f=Math.trunc((e+n)/2),d=Math.trunc((o+s)/2);e<f&&(o<d&&this.computeOverlapsInternal(e,f,i,o,d,a),d<s&&this.computeOverlapsInternal(e,f,i,d,s,a)),f<n&&(o<d&&this.computeOverlapsInternal(f,n,i,o,d,a),d<s&&this.computeOverlapsInternal(f,n,i,d,s,a))},Fct.prototype.interfaces_=function(){return[]},Fct.prototype.getClass=function(){return Fct};var Nct=function(){};Nct.prototype.interfaces_=function(){return[]},Nct.prototype.getClass=function(){return Nct},Nct.getChainStartIndices=function(e){var n=0,i=new Plt;i.add(new kht(n));do{var o=Nct.findChainEnd(e,n);i.add(new kht(o)),n=o}while(n<e.length-1);return Nct.toIntArray(i)},Nct.findChainEnd=function(e,n){for(var i=n;i<e.length-1&&e[i].equals2D(e[i+1]);)i++;if(i>=e.length-1)return e.length-1;for(var o=rct.quadrant(e[i],e[i+1]),s=n+1;s<e.length&&(e[s-1].equals2D(e[s])||rct.quadrant(e[s-1],e[s])===o);)s++;return s-1},Nct.getChains=function(){if(1===arguments.length)return Nct.getChains(arguments[0],null);if(2===arguments.length){for(var e=arguments[0],n=arguments[1],i=new Plt,o=Nct.getChainStartIndices(e),s=0;s<o.length-1;s++){var a=new Fct(e,o[s],o[s+1],n);i.add(a)}return i}},Nct.toIntArray=function(e){for(var n=new Array(e.size()).fill(null),i=0;i<n.length;i++)n[i]=e.get(i).intValue();return n};var zct=function(){};zct.prototype.computeNodes=function(e){},zct.prototype.getNodedSubstrings=function(){},zct.prototype.interfaces_=function(){return[]},zct.prototype.getClass=function(){return zct};var Bct=function(){if(this.Mi=null,0===arguments.length);else if(1===arguments.length){this.setSegmentIntersector(arguments[0])}};Bct.prototype.setSegmentIntersector=function(e){this.Mi=e},Bct.prototype.interfaces_=function(){return[zct]},Bct.prototype.getClass=function(){return Bct};var Hct=function(e){function n(n){n?e.call(this,n):e.call(this),this.zi=new Plt,this.di=new Cct,this.xi=0,this.mi=null,this.yi=0}e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n;var i={SegmentOverlapAction:{configurable:!0}};return n.prototype.getMonotoneChains=function(){return this.zi},n.prototype.getNodedSubstrings=function(){return Rct.getNodedSubstrings(this.mi)},n.prototype.getIndex=function(){return this.di},n.prototype.add=function(e){for(var n=this,i=Nct.getChains(e.getCoordinates(),e).iterator();i.hasNext();){var o=i.next();o.setId(n.xi++),n.di.insert(o.getEnvelope(),o),n.zi.add(o)}},n.prototype.computeNodes=function(e){this.mi=e;for(var n=e.iterator();n.hasNext();)this.add(n.next());this.intersectChains()},n.prototype.intersectChains=function(){for(var e=this,n=new jct(this.Mi),i=this.zi.iterator();i.hasNext();)for(var o=i.next(),s=e.di.query(o.getEnvelope()).iterator();s.hasNext();){var a=s.next();if(a.getId()>o.getId()&&(o.computeOverlaps(a,n),e.yi++),e.Mi.isDone())return null}},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},i.SegmentOverlapAction.get=function(){return jct},Object.defineProperties(n,i),n}(Bct),jct=function(e){function n(){e.call(this),this.pi=null,this.pi=arguments[0]}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.overlap=function(){if(4!==arguments.length)return e.prototype.overlap.apply(this,arguments);var n=arguments[1],i=arguments[2],o=arguments[3],s=arguments[0].getContext(),a=i.getContext();this.pi.processIntersections(s,n,a,o)},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n}(Lct),Uct=function e(){if(this.Li=e.DEFAULT_QUADRANT_SEGMENTS,this.Ti=e.CAP_ROUND,this.Oi=e.JOIN_ROUND,this.Fi=e.DEFAULT_MITRE_LIMIT,this.Ui=!1,this.Ei=e.DEFAULT_SIMPLIFY_FACTOR,0===arguments.length);else if(1===arguments.length){this.setQuadrantSegments(arguments[0])}else if(2===arguments.length){var n=arguments[1];this.setQuadrantSegments(arguments[0]),this.setEndCapStyle(n)}else if(4===arguments.length){var i=arguments[1],o=arguments[2],s=arguments[3];this.setQuadrantSegments(arguments[0]),this.setEndCapStyle(i),this.setJoinStyle(o),this.setMitreLimit(s)}},Gct={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};Uct.prototype.getEndCapStyle=function(){return this.Ti},Uct.prototype.isSingleSided=function(){return this.Ui},Uct.prototype.setQuadrantSegments=function(e){this.Li=e,0===this.Li&&(this.Oi=Uct.JOIN_BEVEL),this.Li<0&&(this.Oi=Uct.JOIN_MITRE,this.Fi=Math.abs(this.Li)),e<=0&&(this.Li=1),this.Oi!==Uct.JOIN_ROUND&&(this.Li=Uct.DEFAULT_QUADRANT_SEGMENTS)},Uct.prototype.getJoinStyle=function(){return this.Oi},Uct.prototype.setJoinStyle=function(e){this.Oi=e},Uct.prototype.setSimplifyFactor=function(e){this.Ei=e<0?0:e},Uct.prototype.getSimplifyFactor=function(){return this.Ei},Uct.prototype.getQuadrantSegments=function(){return this.Li},Uct.prototype.setEndCapStyle=function(e){this.Ti=e},Uct.prototype.getMitreLimit=function(){return this.Fi},Uct.prototype.setMitreLimit=function(e){this.Fi=e},Uct.prototype.setSingleSided=function(e){this.Ui=e},Uct.prototype.interfaces_=function(){return[]},Uct.prototype.getClass=function(){return Uct},Uct.bufferDistanceError=function(e){var n=Math.PI/2/e;return 1-Math.cos(n/2)},Gct.CAP_ROUND.get=function(){return 1},Gct.CAP_FLAT.get=function(){return 2},Gct.CAP_SQUARE.get=function(){return 3},Gct.JOIN_ROUND.get=function(){return 1},Gct.JOIN_MITRE.get=function(){return 2},Gct.JOIN_BEVEL.get=function(){return 3},Gct.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8},Gct.DEFAULT_MITRE_LIMIT.get=function(){return 5},Gct.DEFAULT_SIMPLIFY_FACTOR.get=function(){return.01},Object.defineProperties(Uct,Gct);var Vct=function(e){this.Ni=null,this.ji=null,this.Qi=alt.COUNTERCLOCKWISE,this.Si=e||null},Wct={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};Vct.prototype.isDeletable=function(e,n,i,o){var s=this.Si[e],a=this.Si[n],h=this.Si[i];return!!this.isConcave(s,a,h)&&!!this.isShallow(s,a,h,o)&&this.isShallowSampled(s,a,e,i,o)},Vct.prototype.deleteShallowConcavities=function(){for(var e=this,n=1,i=this.findNextNonDeletedIndex(n),o=this.findNextNonDeletedIndex(i),s=!1;o<this.Si.length;){var a=!1;e.isDeletable(n,i,o,e.Ni)&&(e.ji[i]=Vct.DELETE,a=!0,s=!0),i=e.findNextNonDeletedIndex(n=a?o:i),o=e.findNextNonDeletedIndex(i)}return s},Vct.prototype.isShallowConcavity=function(e,n,i,o){return alt.computeOrientation(e,n,i)===this.Qi&&alt.distancePointLine(n,e,i)<o},Vct.prototype.isShallowSampled=function(e,n,i,o,s){var a=Math.trunc((o-i)/Vct.NUM_PTS_TO_CHECK);a<=0&&(a=1);for(var h=i;h<o;h+=a)if(!this.isShallow(e,n,this.Si[h],s))return!1;return!0},Vct.prototype.isConcave=function(e,n,i){return alt.computeOrientation(e,n,i)===this.Qi},Vct.prototype.simplify=function(e){this.Ni=Math.abs(e),e<0&&(this.Qi=alt.CLOCKWISE),this.ji=new Array(this.Si.length).fill(null);var n=!1;do{n=this.deleteShallowConcavities()}while(n);return this.collapseLine()},Vct.prototype.findNextNonDeletedIndex=function(e){for(var n=e+1;n<this.Si.length&&this.ji[n]===Vct.DELETE;)n++;return n},Vct.prototype.isShallow=function(e,n,i,o){return alt.distancePointLine(n,e,i)<o},Vct.prototype.collapseLine=function(){for(var e=new Tlt,n=0;n<this.Si.length;n++)this.ji[n]!==Vct.DELETE&&e.add(this.Si[n]);return e.toCoordinateArray()},Vct.prototype.interfaces_=function(){return[]},Vct.prototype.getClass=function(){return Vct},Vct.simplify=function(e,n){return new Vct(e).simplify(n)},Wct.INIT.get=function(){return 0},Wct.DELETE.get=function(){return 1},Wct.KEEP.get=function(){return 1},Wct.NUM_PTS_TO_CHECK.get=function(){return 10},Object.defineProperties(Vct,Wct);var qct=function(){this.Bi=null,this.Wt=null,this.ki=0,this.Bi=new Plt},Zct={COORDINATE_ARRAY_TYPE:{configurable:!0}};qct.prototype.getCoordinates=function(){return this.Bi.toArray(qct.COORDINATE_ARRAY_TYPE)},qct.prototype.setPrecisionModel=function(e){this.Wt=e},qct.prototype.addPt=function(e){var n=new Cht(e);if(this.Wt.makePrecise(n),this.isRedundant(n))return null;this.Bi.add(n)},qct.prototype.revere=function(){},qct.prototype.addPts=function(e,n){if(n)for(var i=0;i<e.length;i++)this.addPt(e[i]);else for(var o=e.length-1;o>=0;o--)this.addPt(e[o])},qct.prototype.isRedundant=function(e){if(this.Bi.size()<1)return!1;var n=this.Bi.get(this.Bi.size()-1);return e.distance(n)<this.ki},qct.prototype.toString=function(){return(new kut).createLineString(this.getCoordinates()).toString()},qct.prototype.closeRing=function(){if(this.Bi.size()<1)return null;var e=new Cht(this.Bi.get(0)),n=this.Bi.get(this.Bi.size()-1);if(e.equals(n))return null;this.Bi.add(e)},qct.prototype.setMinimumVertexDistance=function(e){this.ki=e},qct.prototype.interfaces_=function(){return[]},qct.prototype.getClass=function(){return qct},Zct.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)},Object.defineProperties(qct,Zct);var Qct=function(){},Xct={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};Qct.prototype.interfaces_=function(){return[]},Qct.prototype.getClass=function(){return Qct},Qct.toDegrees=function(e){return 180*e/Math.PI},Qct.normalize=function(e){for(;e>Math.PI;)e-=Qct.PI_TIMES_2;for(;e<=-Math.PI;)e+=Qct.PI_TIMES_2;return e},Qct.angle=function(){if(1===arguments.length){var e=arguments[0];return Math.atan2(e.y,e.x)}if(2===arguments.length){var n=arguments[0],i=arguments[1];return Math.atan2(i.y-n.y,i.x-n.x)}},Qct.isAcute=function(e,n,i){return(e.x-n.x)*(i.x-n.x)+(e.y-n.y)*(i.y-n.y)>0},Qct.isObtuse=function(e,n,i){return(e.x-n.x)*(i.x-n.x)+(e.y-n.y)*(i.y-n.y)<0},Qct.interiorAngle=function(e,n,i){var o=Qct.angle(n,e),s=Qct.angle(n,i);return Math.abs(s-o)},Qct.normalizePositive=function(e){if(e<0){for(;e<0;)e+=Qct.PI_TIMES_2;e>=Qct.PI_TIMES_2&&(e=0)}else{for(;e>=Qct.PI_TIMES_2;)e-=Qct.PI_TIMES_2;e<0&&(e=0)}return e},Qct.angleBetween=function(e,n,i){var o=Qct.angle(n,e),s=Qct.angle(n,i);return Qct.diff(o,s)},Qct.diff=function(e,n){var i=null;return(i=e<n?n-e:e-n)>Math.PI&&(i=2*Math.PI-i),i},Qct.toRadians=function(e){return e*Math.PI/180},Qct.getTurn=function(e,n){var i=Math.sin(n-e);return i>0?Qct.COUNTERCLOCKWISE:i<0?Qct.CLOCKWISE:Qct.NONE},Qct.angleBetweenOriented=function(e,n,i){var o=Qct.angle(n,e),s=Qct.angle(n,i)-o;return s<=-Math.PI?s+Qct.PI_TIMES_2:s>Math.PI?s-Qct.PI_TIMES_2:s},Xct.PI_TIMES_2.get=function(){return 2*Math.PI},Xct.PI_OVER_2.get=function(){return Math.PI/2},Xct.PI_OVER_4.get=function(){return Math.PI/4},Xct.COUNTERCLOCKWISE.get=function(){return alt.COUNTERCLOCKWISE},Xct.CLOCKWISE.get=function(){return alt.CLOCKWISE},Xct.NONE.get=function(){return alt.COLLINEAR},Object.defineProperties(Qct,Xct);var Yct=function e(){this.Ri=0,this.Gi=null,this.Yi=1,this.qi=null,this.ri=0,this.Wt=null,this.Vi=null,this.Wi=null,this._i=null,this.Ki=null,this.Hi=null,this.Ji=new Dct,this.Zi=new Dct,this.Xi=new Dct,this.$i=new Dct,this.Ar=0,this.tr=!1;var n=arguments[1],i=arguments[2];this.Wt=arguments[0],this.Vi=n,this.Wi=new rlt,this.Gi=Math.PI/2/n.getQuadrantSegments(),n.getQuadrantSegments()>=8&&n.getJoinStyle()===Uct.JOIN_ROUND&&(this.Yi=e.MAX_CLOSING_SEG_LEN_FACTOR),this.init(i)},Jct={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};Yct.prototype.addNextSegment=function(e,n){if(this._i=this.Ki,this.Ki=this.Hi,this.Hi=e,this.Ji.setCoordinates(this._i,this.Ki),this.computeOffsetSegment(this.Ji,this.Ar,this.ri,this.Xi),this.Zi.setCoordinates(this.Ki,this.Hi),this.computeOffsetSegment(this.Zi,this.Ar,this.ri,this.$i),this.Ki.equals(this.Hi))return null;var i=alt.computeOrientation(this._i,this.Ki,this.Hi),o=i===alt.CLOCKWISE&&this.Ar===Uut.LEFT||i===alt.COUNTERCLOCKWISE&&this.Ar===Uut.RIGHT;0===i?this.addCollinear(n):o?this.addOutsideTurn(i,n):this.addInsideTurn(i,n)},Yct.prototype.addLineEndCap=function(e,n){var i=new Dct(e,n),o=new Dct;this.computeOffsetSegment(i,Uut.LEFT,this.ri,o);var s=new Dct;this.computeOffsetSegment(i,Uut.RIGHT,this.ri,s);var a=Math.atan2(n.y-e.y,n.x-e.x);switch(this.Vi.getEndCapStyle()){case Uct.CAP_ROUND:this.qi.addPt(o.p1),this.addFilletArc(n,a+Math.PI/2,a-Math.PI/2,alt.CLOCKWISE,this.ri),this.qi.addPt(s.p1);break;case Uct.CAP_FLAT:this.qi.addPt(o.p1),this.qi.addPt(s.p1);break;case Uct.CAP_SQUARE:var h=new Cht;h.x=Math.abs(this.ri)*Math.cos(a),h.y=Math.abs(this.ri)*Math.sin(a);var l=new Cht(o.p1.x+h.x,o.p1.y+h.y),c=new Cht(s.p1.x+h.x,s.p1.y+h.y);this.qi.addPt(l),this.qi.addPt(c)}},Yct.prototype.getCoordinates=function(){return this.qi.getCoordinates()},Yct.prototype.addMitreJoin=function(e,n,i,o){var s=!0,a=null;try{a=Wht.intersection(n.p0,n.p1,i.p0,i.p1),(o<=0?1:a.distance(e)/Math.abs(o))>this.Vi.getMitreLimit()&&(s=!1)}catch(e){if(!(e instanceof Ght))throw e;a=new Cht(0,0),s=!1}s?this.qi.addPt(a):this.addLimitedMitreJoin(n,i,o,this.Vi.getMitreLimit())},Yct.prototype.addFilletCorner=function(e,n,i,o,s){var a=Math.atan2(n.y-e.y,n.x-e.x),h=Math.atan2(i.y-e.y,i.x-e.x);o===alt.CLOCKWISE?a<=h&&(a+=2*Math.PI):a>=h&&(a-=2*Math.PI),this.qi.addPt(n),this.addFilletArc(e,a,h,o,s),this.qi.addPt(i)},Yct.prototype.addOutsideTurn=function(e,n){if(this.Xi.p1.distance(this.$i.p0)<this.ri*Yct.OFFSET_SEGMENT_SEPARATION_FACTOR)return this.qi.addPt(this.Xi.p1),null;this.Vi.getJoinStyle()===Uct.JOIN_MITRE?this.addMitreJoin(this.Ki,this.Xi,this.$i,this.ri):this.Vi.getJoinStyle()===Uct.JOIN_BEVEL?this.addBevelJoin(this.Xi,this.$i):(n&&this.qi.addPt(this.Xi.p1),this.addFilletCorner(this.Ki,this.Xi.p1,this.$i.p0,e,this.ri),this.qi.addPt(this.$i.p0))},Yct.prototype.createSquare=function(e){this.qi.addPt(new Cht(e.x+this.ri,e.y+this.ri)),this.qi.addPt(new Cht(e.x+this.ri,e.y-this.ri)),this.qi.addPt(new Cht(e.x-this.ri,e.y-this.ri)),this.qi.addPt(new Cht(e.x-this.ri,e.y+this.ri)),this.qi.closeRing()},Yct.prototype.addSegments=function(e,n){this.qi.addPts(e,n)},Yct.prototype.addFirstSegment=function(){this.qi.addPt(this.$i.p0)},Yct.prototype.addLastSegment=function(){this.qi.addPt(this.$i.p1)},Yct.prototype.initSideSegments=function(e,n,i){this.Ki=e,this.Hi=n,this.Ar=i,this.Zi.setCoordinates(e,n),this.computeOffsetSegment(this.Zi,i,this.ri,this.$i)},Yct.prototype.addLimitedMitreJoin=function(e,n,i,o){var s=this.Ji.p1,a=Qct.angle(s,this.Ji.p0),h=Qct.angleBetweenOriented(this.Ji.p0,s,this.Zi.p1)/2,l=Qct.normalize(a+h),c=Qct.normalize(l+Math.PI),A=o*i,f=i-A*Math.abs(Math.sin(h)),d=s.x+A*Math.cos(c),p=s.y+A*Math.sin(c),g=new Cht(d,p),v=new Dct(s,g),w=v.pointAlongOffset(1,f),C=v.pointAlongOffset(1,-f);this.Ar===Uut.LEFT?(this.qi.addPt(w),this.qi.addPt(C)):(this.qi.addPt(C),this.qi.addPt(w))},Yct.prototype.computeOffsetSegment=function(e,n,i,o){var s=n===Uut.LEFT?1:-1,a=e.p1.x-e.p0.x,h=e.p1.y-e.p0.y,l=Math.sqrt(a*a+h*h),c=s*i*a/l,A=s*i*h/l;o.p0.x=e.p0.x-A,o.p0.y=e.p0.y+c,o.p1.x=e.p1.x-A,o.p1.y=e.p1.y+c},Yct.prototype.addFilletArc=function(e,n,i,o,s){var a=o===alt.CLOCKWISE?-1:1,h=Math.abs(n-i),l=Math.trunc(h/this.Gi+.5);if(l<1)return null;for(var c=h/l,A=0,f=new Cht;A<h;){var d=n+a*A;f.x=e.x+s*Math.cos(d),f.y=e.y+s*Math.sin(d),this.qi.addPt(f),A+=c}},Yct.prototype.addInsideTurn=function(e,n){if(this.Wi.computeIntersection(this.Xi.p0,this.Xi.p1,this.$i.p0,this.$i.p1),this.Wi.hasIntersection())this.qi.addPt(this.Wi.getIntersection(0));else if(this.tr=!0,this.Xi.p1.distance(this.$i.p0)<this.ri*Yct.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this.qi.addPt(this.Xi.p1);else{if(this.qi.addPt(this.Xi.p1),this.Yi>0){var i=new Cht((this.Yi*this.Xi.p1.x+this.Ki.x)/(this.Yi+1),(this.Yi*this.Xi.p1.y+this.Ki.y)/(this.Yi+1));this.qi.addPt(i);var o=new Cht((this.Yi*this.$i.p0.x+this.Ki.x)/(this.Yi+1),(this.Yi*this.$i.p0.y+this.Ki.y)/(this.Yi+1));this.qi.addPt(o)}else this.qi.addPt(this.Ki);this.qi.addPt(this.$i.p0)}},Yct.prototype.createCircle=function(e){var n=new Cht(e.x+this.ri,e.y);this.qi.addPt(n),this.addFilletArc(e,0,2*Math.PI,-1,this.ri),this.qi.closeRing()},Yct.prototype.addBevelJoin=function(e,n){this.qi.addPt(e.p1),this.qi.addPt(n.p0)},Yct.prototype.init=function(e){this.ri=e,this.Ri=e*(1-Math.cos(this.Gi/2)),this.qi=new qct,this.qi.setPrecisionModel(this.Wt),this.qi.setMinimumVertexDistance(e*Yct.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)},Yct.prototype.addCollinear=function(e){this.Wi.computeIntersection(this._i,this.Ki,this.Ki,this.Hi),this.Wi.getIntersectionNum()>=2&&(this.Vi.getJoinStyle()===Uct.JOIN_BEVEL||this.Vi.getJoinStyle()===Uct.JOIN_MITRE?(e&&this.qi.addPt(this.Xi.p1),this.qi.addPt(this.$i.p0)):this.addFilletCorner(this.Ki,this.Xi.p1,this.$i.p0,alt.CLOCKWISE,this.ri))},Yct.prototype.closeRing=function(){this.qi.closeRing()},Yct.prototype.hasNarrowConcaveAngle=function(){return this.tr},Yct.prototype.interfaces_=function(){return[]},Yct.prototype.getClass=function(){return Yct},Jct.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return.001},Jct.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return.001},Jct.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6},Jct.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80},Object.defineProperties(Yct,Jct);var Kct=function(){this.ri=0,this.Wt=null,this.Vi=null;var e=arguments[1];this.Wt=arguments[0],this.Vi=e};Kct.prototype.getOffsetCurve=function(e,n){if(this.ri=n,0===n)return null;var i=n<0,o=Math.abs(n),s=this.getSegGen(o);e.length<=1?this.computePointCurve(e[0],s):this.computeOffsetCurve(e,i,s);var a=s.getCoordinates();return i&&Slt.reverse(a),a},Kct.prototype.computeSingleSidedBufferCurve=function(e,n,i){var o=this.simplifyTolerance(this.ri);if(n){i.addSegments(e,!0);var s=Vct.simplify(e,-o),a=s.length-1;i.initSideSegments(s[a],s[a-1],Uut.LEFT),i.addFirstSegment();for(var h=a-2;h>=0;h--)i.addNextSegment(s[h],!0)}else{i.addSegments(e,!1);var l=Vct.simplify(e,o),c=l.length-1;i.initSideSegments(l[0],l[1],Uut.LEFT),i.addFirstSegment();for(var A=2;A<=c;A++)i.addNextSegment(l[A],!0)}i.addLastSegment(),i.closeRing()},Kct.prototype.computeRingBufferCurve=function(e,n,i){var o=this.simplifyTolerance(this.ri);n===Uut.RIGHT&&(o=-o);var s=Vct.simplify(e,o),a=s.length-1;i.initSideSegments(s[a-1],s[0],n);for(var h=1;h<=a;h++){i.addNextSegment(s[h],1!==h)}i.closeRing()},Kct.prototype.computeLineBufferCurve=function(e,n){var i=this.simplifyTolerance(this.ri),o=Vct.simplify(e,i),s=o.length-1;n.initSideSegments(o[0],o[1],Uut.LEFT);for(var a=2;a<=s;a++)n.addNextSegment(o[a],!0);n.addLastSegment(),n.addLineEndCap(o[s-1],o[s]);var h=Vct.simplify(e,-i),l=h.length-1;n.initSideSegments(h[l],h[l-1],Uut.LEFT);for(var c=l-2;c>=0;c--)n.addNextSegment(h[c],!0);n.addLastSegment(),n.addLineEndCap(h[1],h[0]),n.closeRing()},Kct.prototype.computePointCurve=function(e,n){switch(this.Vi.getEndCapStyle()){case Uct.CAP_ROUND:n.createCircle(e);break;case Uct.CAP_SQUARE:n.createSquare(e)}},Kct.prototype.getLineCurve=function(e,n){if(this.ri=n,n<0&&!this.Vi.isSingleSided())return null;if(0===n)return null;var i=Math.abs(n),o=this.getSegGen(i);if(e.length<=1)this.computePointCurve(e[0],o);else if(this.Vi.isSingleSided()){this.computeSingleSidedBufferCurve(e,n<0,o)}else this.computeLineBufferCurve(e,o);return o.getCoordinates()},Kct.prototype.getBufferParameters=function(){return this.Vi},Kct.prototype.simplifyTolerance=function(e){return e*this.Vi.getSimplifyFactor()},Kct.prototype.getRingCurve=function(e,n,i){if(this.ri=i,e.length<=2)return this.getLineCurve(e,i);if(0===i)return Kct.copyCoordinates(e);var o=this.getSegGen(i);return this.computeRingBufferCurve(e,n,o),o.getCoordinates()},Kct.prototype.computeOffsetCurve=function(e,n,i){var o=this.simplifyTolerance(this.ri);if(n){var s=Vct.simplify(e,-o),a=s.length-1;i.initSideSegments(s[a],s[a-1],Uut.LEFT),i.addFirstSegment();for(var h=a-2;h>=0;h--)i.addNextSegment(s[h],!0)}else{var l=Vct.simplify(e,o),c=l.length-1;i.initSideSegments(l[0],l[1],Uut.LEFT),i.addFirstSegment();for(var A=2;A<=c;A++)i.addNextSegment(l[A],!0)}i.addLastSegment()},Kct.prototype.getSegGen=function(e){return new Yct(this.Wt,this.Vi,e)},Kct.prototype.interfaces_=function(){return[]},Kct.prototype.getClass=function(){return Kct},Kct.copyCoordinates=function(e){for(var n=new Array(e.length).fill(null),i=0;i<n.length;i++)n[i]=new Cht(e[i]);return n};var $ct=function(){this.nr=null,this.ir=new Dct,this.rr=new alt,this.nr=arguments[0]},tAt={DepthSegment:{configurable:!0}};$ct.prototype.findStabbedSegments=function(){var e=this;if(1===arguments.length){for(var n=arguments[0],i=new Plt,o=this.nr.iterator();o.hasNext();){var s=o.next(),a=s.getEnvelope();n.y<a.getMinY()||n.y>a.getMaxY()||e.findStabbedSegments(n,s.getDirectedEdges(),i)}return i}if(3===arguments.length)if(Eht(arguments[2],wlt)&&arguments[0]instanceof Cht&&arguments[1]instanceof act){for(var h=arguments[0],l=arguments[1],c=arguments[2],A=l.getEdge().getCoordinates(),f=0;f<A.length-1;f++)if(e.ir.p0=A[f],e.ir.p1=A[f+1],e.ir.p0.y>e.ir.p1.y&&e.ir.reverse(),!(Math.max(e.ir.p0.x,e.ir.p1.x)<h.x||e.ir.isHorizontal()||h.y<e.ir.p0.y||h.y>e.ir.p1.y||alt.computeOrientation(e.ir.p0,e.ir.p1,h)===alt.RIGHT)){var d=l.getDepth(Uut.LEFT);e.ir.p0.equals(A[f])||(d=l.getDepth(Uut.RIGHT));var p=new eAt(e.ir,d);c.add(p)}}else if(Eht(arguments[2],wlt)&&arguments[0]instanceof Cht&&Eht(arguments[1],wlt))for(var g=arguments[0],v=arguments[2],w=arguments[1].iterator();w.hasNext();){var C=w.next();C.isForward()&&e.findStabbedSegments(g,C,v)}},$ct.prototype.getDepth=function(e){var n=this.findStabbedSegments(e);return 0===n.size()?0:yct.min(n).er},$ct.prototype.interfaces_=function(){return[]},$ct.prototype.getClass=function(){return $ct},tAt.DepthSegment.get=function(){return eAt},Object.defineProperties($ct,tAt);var eAt=function(){this.sr=null,this.er=null;var e=arguments[1];this.sr=new Dct(arguments[0]),this.er=e};eAt.prototype.compareTo=function(e){var n=e;if(this.sr.minX()>=n.sr.maxX())return 1;if(this.sr.maxX()<=n.sr.minX())return-1;var i=this.sr.orientationIndex(n.sr);return 0!==i||0!=(i=-1*n.sr.orientationIndex(this.sr))?i:this.sr.compareTo(n.sr)},eAt.prototype.compareX=function(e,n){var i=e.p0.compareTo(n.p0);return 0!==i?i:e.p1.compareTo(n.p1)},eAt.prototype.toString=function(){return this.sr.toString()},eAt.prototype.interfaces_=function(){return[_ht]},eAt.prototype.getClass=function(){return eAt};var nAt=function(e,n,i){this.p0=e||null,this.p1=n||null,this.p2=i||null};nAt.prototype.area=function(){return nAt.area(this.p0,this.p1,this.p2)},nAt.prototype.signedArea=function(){return nAt.signedArea(this.p0,this.p1,this.p2)},nAt.prototype.interpolateZ=function(e){if(null===e)throw new mht("Supplied point is null.");return nAt.interpolateZ(e,this.p0,this.p1,this.p2)},nAt.prototype.longestSideLength=function(){return nAt.longestSideLength(this.p0,this.p1,this.p2)},nAt.prototype.isAcute=function(){return nAt.isAcute(this.p0,this.p1,this.p2)},nAt.prototype.circumcentre=function(){return nAt.circumcentre(this.p0,this.p1,this.p2)},nAt.prototype.area3D=function(){return nAt.area3D(this.p0,this.p1,this.p2)},nAt.prototype.centroid=function(){return nAt.centroid(this.p0,this.p1,this.p2)},nAt.prototype.inCentre=function(){return nAt.inCentre(this.p0,this.p1,this.p2)},nAt.prototype.interfaces_=function(){return[]},nAt.prototype.getClass=function(){return nAt},nAt.area=function(e,n,i){return Math.abs(((i.x-e.x)*(n.y-e.y)-(n.x-e.x)*(i.y-e.y))/2)},nAt.signedArea=function(e,n,i){return((i.x-e.x)*(n.y-e.y)-(n.x-e.x)*(i.y-e.y))/2},nAt.det=function(e,n,i,o){return e*o-n*i},nAt.interpolateZ=function(e,n,i,o){var s=n.x,a=n.y,h=i.x-s,l=o.x-s,c=i.y-a,A=o.y-a,f=h*A-l*c,d=e.x-s,p=e.y-a;return n.z+(A*d-l*p)/f*(i.z-n.z)+(-c*d+h*p)/f*(o.z-n.z)},nAt.longestSideLength=function(e,n,i){var o=e.distance(n),s=n.distance(i),a=i.distance(e),h=o;return s>h&&(h=s),a>h&&(h=a),h},nAt.isAcute=function(e,n,i){return!!Qct.isAcute(e,n,i)&&!!Qct.isAcute(n,i,e)&&!!Qct.isAcute(i,e,n)},nAt.circumcentre=function(e,n,i){var o=i.x,s=i.y,a=e.x-o,h=e.y-s,l=n.x-o,c=n.y-s,A=2*nAt.det(a,h,l,c),f=nAt.det(h,a*a+h*h,c,l*l+c*c),d=nAt.det(a,a*a+h*h,l,l*l+c*c);return new Cht(o-f/A,s+d/A)},nAt.perpendicularBisector=function(e,n){var i=n.x-e.x,o=n.y-e.y,s=new Wht(e.x+i/2,e.y+o/2,1),a=new Wht(e.x-o+i/2,e.y+i+o/2,1);return new Wht(s,a)},nAt.angleBisector=function(e,n,i){var o=n.distance(e),s=o/(o+n.distance(i));return new Cht(e.x+s*(i.x-e.x),e.y+s*(i.y-e.y))},nAt.area3D=function(e,n,i){var o=n.x-e.x,s=n.y-e.y,a=n.z-e.z,h=i.x-e.x,l=i.y-e.y,c=i.z-e.z,A=s*c-a*l,f=a*h-o*c,d=o*l-s*h;return Math.sqrt(A*A+f*f+d*d)/2},nAt.centroid=function(e,n,i){return new Cht((e.x+n.x+i.x)/3,(e.y+n.y+i.y)/3)},nAt.inCentre=function(e,n,i){var o=n.distance(i),s=e.distance(i),a=e.distance(n),h=o+s+a;return new Cht((o*e.x+s*n.x+a*i.x)/h,(o*e.y+s*n.y+a*i.y)/h)};var iAt=function(){this.ur=null,this.ri=null,this.hr=null,this.cr=new Plt;var e=arguments[1],n=arguments[2];this.ur=arguments[0],this.ri=e,this.hr=n};iAt.prototype.addPoint=function(e){if(this.ri<=0)return null;var n=e.getCoordinates(),i=this.hr.getLineCurve(n,this.ri);this.addCurve(i,Sht.EXTERIOR,Sht.INTERIOR)},iAt.prototype.addPolygon=function(e){var n=this,i=this.ri,o=Uut.LEFT;this.ri<0&&(i=-this.ri,o=Uut.RIGHT);var s=e.getExteriorRing(),a=Slt.removeRepeatedPoints(s.getCoordinates());if(this.ri<0&&this.isErodedCompletely(s,this.ri))return null;if(this.ri<=0&&a.length<3)return null;this.addPolygonRing(a,i,o,Sht.EXTERIOR,Sht.INTERIOR);for(var h=0;h<e.getNumInteriorRing();h++){var l=e.getInteriorRingN(h),c=Slt.removeRepeatedPoints(l.getCoordinates());n.ri>0&&n.isErodedCompletely(l,-n.ri)||n.addPolygonRing(c,i,Uut.opposite(o),Sht.INTERIOR,Sht.EXTERIOR)}},iAt.prototype.isTriangleErodedCompletely=function(e,n){var i=new nAt(e[0],e[1],e[2]),o=i.inCentre();return alt.distancePointLine(o,i.p0,i.p1)<Math.abs(n)},iAt.prototype.addLineString=function(e){if(this.ri<=0&&!this.hr.getBufferParameters().isSingleSided())return null;var n=Slt.removeRepeatedPoints(e.getCoordinates()),i=this.hr.getLineCurve(n,this.ri);this.addCurve(i,Sht.EXTERIOR,Sht.INTERIOR)},iAt.prototype.addCurve=function(e,n,i){if(null===e||e.length<2)return null;var o=new Rct(e,new Jut(0,Sht.BOUNDARY,n,i));this.cr.add(o)},iAt.prototype.getCurves=function(){return this.add(this.ur),this.cr},iAt.prototype.addPolygonRing=function(e,n,i,o,s){if(0===n&&e.length<yut.MINIMUM_VALID_SIZE)return null;var a=o,h=s;e.length>=yut.MINIMUM_VALID_SIZE&&alt.isCCW(e)&&(a=s,h=o,i=Uut.opposite(i));var l=this.hr.getRingCurve(e,i,n);this.addCurve(l,a,h)},iAt.prototype.add=function(e){if(e.isEmpty())return null;e instanceof gut?this.addPolygon(e):e instanceof Aut?this.addLineString(e):e instanceof dut?this.addPoint(e):(e instanceof mut||e instanceof tut||e instanceof vut||e instanceof $lt)&&this.addCollection(e)},iAt.prototype.isErodedCompletely=function(e,n){var i=e.getCoordinates();if(i.length<4)return n<0;if(4===i.length)return this.isTriangleErodedCompletely(i,n);var o=e.getEnvelopeInternal(),s=Math.min(o.getHeight(),o.getWidth());return n<0&&2*Math.abs(n)>s},iAt.prototype.addCollection=function(e){for(var n=0;n<e.getNumGeometries();n++){var i=e.getGeometryN(n);this.add(i)}},iAt.prototype.interfaces_=function(){return[]},iAt.prototype.getClass=function(){return iAt};var rAt=function(){};rAt.prototype.locate=function(e){},rAt.prototype.interfaces_=function(){return[]},rAt.prototype.getClass=function(){return rAt};var oAt=function(){this.ar=null,this.vr=null,this.lr=null,this.di=null,this.wr=null;var e=arguments[0];this.ar=e,this.vr=!0,this.di=0,this.lr=e.getNumGeometries()};oAt.prototype.next=function(){if(this.vr)return this.vr=!1,oAt.isAtomic(this.ar)&&this.di++,this.ar;if(null!==this.wr){if(this.wr.hasNext())return this.wr.next();this.wr=null}if(this.di>=this.lr)throw new Clt;var e=this.ar.getGeometryN(this.di++);return e instanceof $lt?(this.wr=new oAt(e),this.wr.next()):e},oAt.prototype.remove=function(){throw new Error(this.getClass().getName())},oAt.prototype.hasNext=function(){if(this.vr)return!0;if(null!==this.wr){if(this.wr.hasNext())return!0;this.wr=null}return!(this.di>=this.lr)},oAt.prototype.interfaces_=function(){return[blt]},oAt.prototype.getClass=function(){return oAt},oAt.isAtomic=function(e){return!(e instanceof $lt)};var sAt=function(){this.An=null,this.An=arguments[0]};sAt.prototype.locate=function(e){return sAt.locate(e,this.An)},sAt.prototype.interfaces_=function(){return[rAt]},sAt.prototype.getClass=function(){return sAt},sAt.isPointInRing=function(e,n){return!!n.getEnvelopeInternal().intersects(e)&&alt.isPointInRing(e,n.getCoordinates())},sAt.containsPointInPolygon=function(e,n){if(n.isEmpty())return!1;var i=n.getExteriorRing();if(!sAt.isPointInRing(e,i))return!1;for(var o=0;o<n.getNumInteriorRing();o++){var s=n.getInteriorRingN(o);if(sAt.isPointInRing(e,s))return!1}return!0},sAt.containsPoint=function(e,n){if(n instanceof gut)return sAt.containsPointInPolygon(e,n);if(n instanceof $lt)for(var i=new oAt(n);i.hasNext();){var o=i.next();if(o!==n&&sAt.containsPoint(e,o))return!0}return!1},sAt.locate=function(e,n){return n.isEmpty()?Sht.EXTERIOR:sAt.containsPoint(e,n)?Sht.INTERIOR:Sht.EXTERIOR};var aAt=function(){this.Pr=new Glt,this.gr=null,this.Cr=[Sht.NONE,Sht.NONE]};aAt.prototype.getNextCW=function(e){this.getEdges();var n=this.gr.indexOf(e),i=n-1;return 0===n&&(i=this.gr.size()-1),this.gr.get(i)},aAt.prototype.propagateSideLabels=function(e){for(var n=Sht.NONE,i=this.iterator();i.hasNext();){var o=i.next().getLabel();o.isArea(e)&&o.getLocation(e,Uut.LEFT)!==Sht.NONE&&(n=o.getLocation(e,Uut.LEFT))}if(n===Sht.NONE)return null;for(var s=n,a=this.iterator();a.hasNext();){var h=a.next(),l=h.getLabel();if(l.getLocation(e,Uut.ON)===Sht.NONE&&l.setLocation(e,Uut.ON,s),l.isArea(e)){var c=l.getLocation(e,Uut.LEFT),A=l.getLocation(e,Uut.RIGHT);if(A!==Sht.NONE){if(A!==s)throw new Zut("side location conflict",h.getCoordinate());c===Sht.NONE&&elt.shouldNeverReachHere("found single null side (at "+h.getCoordinate()+")"),s=c}else elt.isTrue(l.getLocation(e,Uut.LEFT)===Sht.NONE,"found single null side"),l.setLocation(e,Uut.RIGHT,s),l.setLocation(e,Uut.LEFT,s)}}},aAt.prototype.getCoordinate=function(){var e=this.iterator();return e.hasNext()?e.next().getCoordinate():null},aAt.prototype.print=function(e){Vht.out.println("EdgeEndStar:   "+this.getCoordinate());for(var n=this.iterator();n.hasNext();)n.next().print(e)},aAt.prototype.isAreaLabelsConsistent=function(e){return this.computeEdgeEndLabels(e.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)},aAt.prototype.checkAreaLabelsConsistent=function(e){var n=this.getEdges();if(n.size()<=0)return!0;var i=n.size()-1,o=n.get(i).getLabel().getLocation(e,Uut.LEFT);elt.isTrue(o!==Sht.NONE,"Found unlabelled area edge");for(var s=o,a=this.iterator();a.hasNext();){var h=a.next().getLabel();elt.isTrue(h.isArea(e),"Found non-area edge");var l=h.getLocation(e,Uut.LEFT),c=h.getLocation(e,Uut.RIGHT);if(l===c)return!1;if(c!==s)return!1;s=l}return!0},aAt.prototype.findIndex=function(e){this.iterator();for(var n=0;n<this.gr.size();n++)if(this.gr.get(n)===e)return n;return-1},aAt.prototype.iterator=function(){return this.getEdges().iterator()},aAt.prototype.getEdges=function(){return null===this.gr&&(this.gr=new Plt(this.Pr.values())),this.gr},aAt.prototype.getLocation=function(e,n,i){return this.Cr[e]===Sht.NONE&&(this.Cr[e]=sAt.locate(n,i[e].getGeometry())),this.Cr[e]},aAt.prototype.toString=function(){var e=new Dht;e.append("EdgeEndStar:   "+this.getCoordinate()),e.append("\n");for(var n=this.iterator();n.hasNext();){var i=n.next();e.append(i),e.append("\n")}return e.toString()},aAt.prototype.computeEdgeEndLabels=function(e){for(var n=this.iterator();n.hasNext();)n.next().computeLabel(e)},aAt.prototype.computeLabelling=function(e){this.computeEdgeEndLabels(e[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var n=[!1,!1],i=this.iterator();i.hasNext();)for(var o=i.next().getLabel(),s=0;s<2;s++)o.isLine(s)&&o.getLocation(s)===Sht.BOUNDARY&&(n[s]=!0);for(var a=this.iterator();a.hasNext();)for(var h=a.next(),l=h.getLabel(),c=0;c<2;c++)if(l.isAnyNull(c)){var A=Sht.NONE;if(n[c])A=Sht.EXTERIOR;else{var f=h.getCoordinate();A=this.getLocation(c,f,e)}l.setAllLocationsIfNull(c,A)}},aAt.prototype.getDegree=function(){return this.Pr.size()},aAt.prototype.insertEdgeEnd=function(e,n){this.Pr.put(e,n),this.gr=null},aAt.prototype.interfaces_=function(){return[]},aAt.prototype.getClass=function(){return aAt};var hAt=function(e){function n(){e.call(this),this.Dr=null,this.xn=null,this.Ir=1,this.br=2}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.linkResultDirectedEdges=function(){var e=this;this.getResultAreaEdges();for(var n=null,i=null,o=this.Ir,s=0;s<this.Dr.size();s++){var a=e.Dr.get(s),h=a.getSym();if(a.getLabel().isArea())switch(null===n&&a.isInResult()&&(n=a),o){case e.Ir:if(!h.isInResult())continue;i=h,o=e.br;break;case e.br:if(!a.isInResult())continue;i.setNext(a),o=e.Ir}}if(o===this.br){if(null===n)throw new Zut("no outgoing dirEdge found",this.getCoordinate());elt.isTrue(n.isInResult(),"unable to link last incoming dirEdge"),i.setNext(n)}},n.prototype.insert=function(e){this.insertEdgeEnd(e,e)},n.prototype.getRightmostEdge=function(){var e=this.getEdges(),n=e.size();if(n<1)return null;var i=e.get(0);if(1===n)return i;var o=e.get(n-1),s=i.getQuadrant(),a=o.getQuadrant();return rct.isNorthern(s)&&rct.isNorthern(a)?i:rct.isNorthern(s)||rct.isNorthern(a)?0!==i.getDy()?i:0!==o.getDy()?o:(elt.shouldNeverReachHere("found two horizontal edges incident on node"),null):o},n.prototype.print=function(e){Vht.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var n=this.iterator();n.hasNext();){var i=n.next();e.print("out "),i.print(e),e.println(),e.print("in "),i.getSym().print(e),e.println()}},n.prototype.getResultAreaEdges=function(){if(null!==this.Dr)return this.Dr;this.Dr=new Plt;for(var e=this.iterator();e.hasNext();){var n=e.next();(n.isInResult()||n.getSym().isInResult())&&this.Dr.add(n)}return this.Dr},n.prototype.updateLabelling=function(e){for(var n=this.iterator();n.hasNext();){var i=n.next().getLabel();i.setAllLocationsIfNull(0,e.getLocation(0)),i.setAllLocationsIfNull(1,e.getLocation(1))}},n.prototype.linkAllDirectedEdges=function(){this.getEdges();for(var e=null,n=null,i=this.gr.size()-1;i>=0;i--){var o=this.gr.get(i),s=o.getSym();null===n&&(n=s),null!==e&&s.setNext(e),e=o}n.setNext(e)},n.prototype.computeDepths=function(){if(1===arguments.length){var e=arguments[0],n=this.findIndex(e),i=e.getDepth(Uut.LEFT),o=e.getDepth(Uut.RIGHT),s=this.computeDepths(n+1,this.gr.size(),i);if(this.computeDepths(0,n,s)!==o)throw new Zut("depth mismatch at "+e.getCoordinate())}else if(3===arguments.length){for(var a=arguments[1],h=arguments[2],l=arguments[0];l<a;l++){var c=this.gr.get(l);c.setEdgeDepths(Uut.RIGHT,h),h=c.getDepth(Uut.LEFT)}return h}},n.prototype.mergeSymLabels=function(){for(var e=this.iterator();e.hasNext();){var n=e.next();n.getLabel().merge(n.getSym().getLabel())}},n.prototype.linkMinimalDirectedEdges=function(e){for(var n=this,i=null,o=null,s=this.Ir,a=this.Dr.size()-1;a>=0;a--){var h=n.Dr.get(a),l=h.getSym();switch(null===i&&h.getEdgeRing()===e&&(i=h),s){case n.Ir:if(l.getEdgeRing()!==e)continue;o=l,s=n.br;break;case n.br:if(h.getEdgeRing()!==e)continue;o.setNextMin(h),s=n.Ir}}s===this.br&&(elt.isTrue(null!==i,"found null for first outgoing dirEdge"),elt.isTrue(i.getEdgeRing()===e,"unable to link last incoming dirEdge"),o.setNextMin(i))},n.prototype.getOutgoingDegree=function(){if(0===arguments.length){for(var e=0,n=this.iterator();n.hasNext();)n.next().isInResult()&&e++;return e}if(1===arguments.length){for(var i=arguments[0],o=0,s=this.iterator();s.hasNext();)s.next().getEdgeRing()===i&&o++;return o}},n.prototype.getLabel=function(){return this.xn},n.prototype.findCoveredLineEdges=function(){for(var e=Sht.NONE,n=this.iterator();n.hasNext();){var i=n.next(),o=i.getSym();if(!i.isLineEdge()){if(i.isInResult()){e=Sht.INTERIOR;break}if(o.isInResult()){e=Sht.EXTERIOR;break}}}if(e===Sht.NONE)return null;for(var s=e,a=this.iterator();a.hasNext();){var h=a.next(),l=h.getSym();h.isLineEdge()?h.getEdge().setCovered(s===Sht.INTERIOR):(h.isInResult()&&(s=Sht.EXTERIOR),l.isInResult()&&(s=Sht.INTERIOR))}},n.prototype.computeLabelling=function(n){e.prototype.computeLabelling.call(this,n),this.xn=new Jut(Sht.NONE);for(var i=this.iterator();i.hasNext();)for(var o=i.next().getEdge().getLabel(),s=0;s<2;s++){var a=o.getLocation(s);a!==Sht.INTERIOR&&a!==Sht.BOUNDARY||this.xn.setLocation(s,Sht.INTERIOR)}},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n}(aAt),lAt=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.createNode=function(e){return new nct(e,new hAt)},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n}(hct),uAt=function e(){this.dn=null,this.Mr=null;var n=arguments[0];this.dn=n,this.Mr=e.orientation(n)};uAt.prototype.compareTo=function(e){return uAt.compareOriented(this.dn,this.Mr,e.dn,e.Mr)},uAt.prototype.interfaces_=function(){return[_ht]},uAt.prototype.getClass=function(){return uAt},uAt.orientation=function(e){return 1===Slt.increasingDirection(e)},uAt.compareOriented=function(e,n,i,o){for(var s=n?1:-1,a=o?1:-1,h=n?e.length:-1,l=o?i.length:-1,c=n?0:e.length-1,A=o?0:i.length-1;;){var f=e[c].compareTo(i[A]);if(0!==f)return f;var d=(c+=s)===h,p=(A+=a)===l;if(d&&!p)return-1;if(!d&&p)return 1;if(d&&p)return 0}};var cAt=function(){this.zn=new Plt,this.zr=new Glt};cAt.prototype.print=function(e){e.print("MULTILINESTRING ( ");for(var n=0;n<this.zn.size();n++){var i=this.zn.get(n);n>0&&e.print(","),e.print("(");for(var o=i.getCoordinates(),s=0;s<o.length;s++)s>0&&e.print(","),e.print(o[s].x+" "+o[s].y);e.println(")")}e.print(")  ")},cAt.prototype.addAll=function(e){for(var n=e.iterator();n.hasNext();)this.add(n.next())},cAt.prototype.findEdgeIndex=function(e){for(var n=0;n<this.zn.size();n++)if(this.zn.get(n).equals(e))return n;return-1},cAt.prototype.iterator=function(){return this.zn.iterator()},cAt.prototype.getEdges=function(){return this.zn},cAt.prototype.get=function(e){return this.zn.get(e)},cAt.prototype.findEqualEdge=function(e){var n=new uAt(e.getCoordinates());return this.zr.get(n)},cAt.prototype.add=function(e){this.zn.add(e);var n=new uAt(e.getCoordinates());this.zr.put(n,e)},cAt.prototype.interfaces_=function(){return[]},cAt.prototype.getClass=function(){return cAt};var AAt=function(){};AAt.prototype.processIntersections=function(e,n,i,o){},AAt.prototype.isDone=function(){},AAt.prototype.interfaces_=function(){return[]},AAt.prototype.getClass=function(){return AAt};var fAt=function(){this.dr=!1,this.mr=!1,this.yr=!1,this.pr=!1,this.Lr=null,this.Wi=null,this.Tr=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0,this.Wi=arguments[0]};fAt.prototype.isTrivialIntersection=function(e,n,i,o){if(e===i&&1===this.Wi.getIntersectionNum()){if(fAt.isAdjacentSegments(n,o))return!0;if(e.isClosed()){var s=e.size()-1;if(0===n&&o===s||0===o&&n===s)return!0}}return!1},fAt.prototype.getProperIntersectionPoint=function(){return this.Lr},fAt.prototype.hasProperInteriorIntersection=function(){return this.yr},fAt.prototype.getLineIntersector=function(){return this.Wi},fAt.prototype.hasProperIntersection=function(){return this.mr},fAt.prototype.processIntersections=function(e,n,i,o){if(e===i&&n===o)return null;this.numTests++;var s=e.getCoordinates()[n],a=e.getCoordinates()[n+1],h=i.getCoordinates()[o],l=i.getCoordinates()[o+1];this.Wi.computeIntersection(s,a,h,l),this.Wi.hasIntersection()&&(this.numIntersections++,this.Wi.isInteriorIntersection()&&(this.numInteriorIntersections++,this.pr=!0),this.isTrivialIntersection(e,n,i,o)||(this.dr=!0,e.addIntersections(this.Wi,n,0),i.addIntersections(this.Wi,o,1),this.Wi.isProper()&&(this.numProperIntersections++,this.mr=!0,this.yr=!0)))},fAt.prototype.hasIntersection=function(){return this.dr},fAt.prototype.isDone=function(){return!1},fAt.prototype.hasInteriorIntersection=function(){return this.pr},fAt.prototype.interfaces_=function(){return[AAt]},fAt.prototype.getClass=function(){return fAt},fAt.isAdjacentSegments=function(e,n){return 1===Math.abs(e-n)};var dAt=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var e=arguments[1],n=arguments[2];this.coord=new Cht(arguments[0]),this.segmentIndex=e,this.dist=n};dAt.prototype.getSegmentIndex=function(){return this.segmentIndex},dAt.prototype.getCoordinate=function(){return this.coord},dAt.prototype.print=function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex),e.println(" dist = "+this.dist)},dAt.prototype.compareTo=function(e){return this.compare(e.segmentIndex,e.dist)},dAt.prototype.isEndPoint=function(e){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===e},dAt.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist},dAt.prototype.getDistance=function(){return this.dist},dAt.prototype.compare=function(e,n){return this.segmentIndex<e?-1:this.segmentIndex>e?1:this.dist<n?-1:this.dist>n?1:0},dAt.prototype.interfaces_=function(){return[_ht]},dAt.prototype.getClass=function(){return dAt};var pAt=function(){this.vi=new Glt,this.edge=null,this.edge=arguments[0]};pAt.prototype.print=function(e){e.println("Intersections:");for(var n=this.iterator();n.hasNext();)n.next().print(e)},pAt.prototype.iterator=function(){return this.vi.values().iterator()},pAt.prototype.addSplitEdges=function(e){this.addEndpoints();for(var n=this.iterator(),i=n.next();n.hasNext();){var o=n.next(),s=this.createSplitEdge(i,o);e.add(s),i=o}},pAt.prototype.addEndpoints=function(){var e=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[e],e,0)},pAt.prototype.createSplitEdge=function(e,n){var i=n.segmentIndex-e.segmentIndex+2,o=n.dist>0||!n.coord.equals2D(this.edge.pts[n.segmentIndex]);o||i--;var s=new Array(i).fill(null),a=0;s[a++]=new Cht(e.coord);for(var h=e.segmentIndex+1;h<=n.segmentIndex;h++)s[a++]=this.edge.pts[h];return o&&(s[a]=n.coord),new _At(s,new Jut(this.edge.xn))},pAt.prototype.add=function(e,n,i){var o=new dAt(e,n,i),s=this.vi.get(o);return null!==s?s:(this.vi.put(o,o),o)},pAt.prototype.isIntersection=function(e){for(var n=this.iterator();n.hasNext();)if(n.next().coord.equals(e))return!0;return!1},pAt.prototype.interfaces_=function(){return[]},pAt.prototype.getClass=function(){return pAt};var gAt=function(){};gAt.prototype.getChainStartIndices=function(e){var n=0,i=new Plt;i.add(new kht(n));do{var o=this.findChainEnd(e,n);i.add(new kht(o)),n=o}while(n<e.length-1);return gAt.toIntArray(i)},gAt.prototype.findChainEnd=function(e,n){for(var i=rct.quadrant(e[n],e[n+1]),o=n+1;o<e.length&&rct.quadrant(e[o-1],e[o])===i;)o++;return o-1},gAt.prototype.interfaces_=function(){return[]},gAt.prototype.getClass=function(){return gAt},gAt.toIntArray=function(e){for(var n=new Array(e.size()).fill(null),i=0;i<n.length;i++)n[i]=e.get(i).intValue();return n};var mAt=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new qht,this.env2=new qht;var e=arguments[0];this.e=e,this.pts=e.getCoordinates();var n=new gAt;this.startIndex=n.getChainStartIndices(this.pts)};mAt.prototype.getCoordinates=function(){return this.pts},mAt.prototype.getMaxX=function(e){var n=this.pts[this.startIndex[e]].x,i=this.pts[this.startIndex[e+1]].x;return n>i?n:i},mAt.prototype.getMinX=function(e){var n=this.pts[this.startIndex[e]].x,i=this.pts[this.startIndex[e+1]].x;return n<i?n:i},mAt.prototype.computeIntersectsForChain=function(){if(4===arguments.length){var e=arguments[0],n=arguments[1],i=arguments[2];this.computeIntersectsForChain(this.startIndex[e],this.startIndex[e+1],n,n.startIndex[i],n.startIndex[i+1],arguments[3])}else if(6===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2],h=arguments[3],l=arguments[4],c=arguments[5],A=this.pts[o],f=this.pts[s],d=a.pts[h],p=a.pts[l];if(s-o==1&&l-h==1)return c.addIntersections(this.e,o,a.e,h),null;if(this.env1.init(A,f),this.env2.init(d,p),!this.env1.intersects(this.env2))return null;var g=Math.trunc((o+s)/2),v=Math.trunc((h+l)/2);o<g&&(h<v&&this.computeIntersectsForChain(o,g,a,h,v,c),v<l&&this.computeIntersectsForChain(o,g,a,v,l,c)),g<s&&(h<v&&this.computeIntersectsForChain(g,s,a,h,v,c),v<l&&this.computeIntersectsForChain(g,s,a,v,l,c))}},mAt.prototype.getStartIndexes=function(){return this.startIndex},mAt.prototype.computeIntersects=function(e,n){for(var i=0;i<this.startIndex.length-1;i++)for(var o=0;o<e.startIndex.length-1;o++)this.computeIntersectsForChain(i,e,o,n)},mAt.prototype.interfaces_=function(){return[]},mAt.prototype.getClass=function(){return mAt};var yAt=function e(){this._n=Array(2).fill().map((function(){return Array(3)}));for(var n=0;n<2;n++)for(var i=0;i<3;i++)this._n[n][i]=e.NULL_VALUE},vAt={NULL_VALUE:{configurable:!0}};yAt.prototype.getDepth=function(e,n){return this._n[e][n]},yAt.prototype.setDepth=function(e,n,i){this._n[e][n]=i},yAt.prototype.isNull=function(){if(0===arguments.length){for(var e=0;e<2;e++)for(var n=0;n<3;n++)if(this._n[e][n]!==yAt.NULL_VALUE)return!1;return!0}return 1===arguments.length?this._n[arguments[0]][1]===yAt.NULL_VALUE:2===arguments.length?this._n[arguments[0]][arguments[1]]===yAt.NULL_VALUE:void 0},yAt.prototype.normalize=function(){for(var e=this,n=0;n<2;n++)if(!e.isNull(n)){var i=e._n[n][1];e._n[n][2]<i&&(i=e._n[n][2]),i<0&&(i=0);for(var o=1;o<3;o++){var s=0;e._n[n][o]>i&&(s=1),e._n[n][o]=s}}},yAt.prototype.getDelta=function(e){return this._n[e][Uut.RIGHT]-this._n[e][Uut.LEFT]},yAt.prototype.getLocation=function(e,n){return this._n[e][n]<=0?Sht.EXTERIOR:Sht.INTERIOR},yAt.prototype.toString=function(){return"A: "+this._n[0][1]+","+this._n[0][2]+" B: "+this._n[1][1]+","+this._n[1][2]},yAt.prototype.add=function(){var e=this;if(1===arguments.length)for(var n=arguments[0],i=0;i<2;i++)for(var o=1;o<3;o++){var s=n.getLocation(i,o);s!==Sht.EXTERIOR&&s!==Sht.INTERIOR||(e.isNull(i,o)?e._n[i][o]=yAt.depthAtLocation(s):e._n[i][o]+=yAt.depthAtLocation(s))}else if(3===arguments.length){arguments[2]===Sht.INTERIOR&&this._n[arguments[0]][arguments[1]]++}},yAt.prototype.interfaces_=function(){return[]},yAt.prototype.getClass=function(){return yAt},yAt.depthAtLocation=function(e){return e===Sht.EXTERIOR?0:e===Sht.INTERIOR?1:yAt.NULL_VALUE},vAt.NULL_VALUE.get=function(){return-1},Object.defineProperties(yAt,vAt);var _At=function(e){function n(){if(e.call(this),this.pts=null,this.In=null,this.eiList=new pAt(this),this.hn=null,this.Or=null,this.Fr=!0,this._n=new yAt,this.Ur=0,1===arguments.length)n.call(this,arguments[0],null);else if(2===arguments.length){var i=arguments[1];this.pts=arguments[0],this.xn=i}}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.getDepth=function(){return this._n},n.prototype.getCollapsedEdge=function(){var e=new Array(2).fill(null);return e[0]=this.pts[0],e[1]=this.pts[1],new n(e,Jut.toLineLabel(this.xn))},n.prototype.isIsolated=function(){return this.Fr},n.prototype.getCoordinates=function(){return this.pts},n.prototype.setIsolated=function(e){this.Fr=e},n.prototype.setName=function(e){this.hn=e},n.prototype.equals=function(e){if(!(e instanceof n))return!1;var i=e;if(this.pts.length!==i.pts.length)return!1;for(var o=!0,s=!0,a=this.pts.length,h=0;h<this.pts.length;h++)if(this.pts[h].equals2D(i.pts[h])||(o=!1),this.pts[h].equals2D(i.pts[--a])||(s=!1),!o&&!s)return!1;return!0},n.prototype.getCoordinate=function(){return 0===arguments.length?this.pts.length>0?this.pts[0]:null:1===arguments.length?this.pts[arguments[0]]:void 0},n.prototype.print=function(e){e.print("edge "+this.hn+": "),e.print("LINESTRING (");for(var n=0;n<this.pts.length;n++)n>0&&e.print(","),e.print(this.pts[n].x+" "+this.pts[n].y);e.print(")  "+this.xn+" "+this.Ur)},n.prototype.computeIM=function(e){n.updateIM(this.xn,e)},n.prototype.isCollapsed=function(){return!!this.xn.isArea()&&3===this.pts.length&&!!this.pts[0].equals(this.pts[2])},n.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},n.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},n.prototype.getDepthDelta=function(){return this.Ur},n.prototype.getNumPoints=function(){return this.pts.length},n.prototype.printReverse=function(e){e.print("edge "+this.hn+": ");for(var n=this.pts.length-1;n>=0;n--)e.print(this.pts[n]+" ");e.println("")},n.prototype.getMonotoneChainEdge=function(){return null===this.Or&&(this.Or=new mAt(this)),this.Or},n.prototype.getEnvelope=function(){if(null===this.In){this.In=new qht;for(var e=0;e<this.pts.length;e++)this.In.expandToInclude(this.pts[e])}return this.In},n.prototype.addIntersection=function(e,n,i,o){var s=new Cht(e.getIntersection(o)),a=n,h=e.getEdgeDistance(i,o),l=a+1;l<this.pts.length&&(s.equals2D(this.pts[l])&&(a=l,h=0));this.eiList.add(s,a,h)},n.prototype.toString=function(){var e=new Dht;e.append("edge "+this.hn+": "),e.append("LINESTRING (");for(var n=0;n<this.pts.length;n++)n>0&&e.append(","),e.append(this.pts[n].x+" "+this.pts[n].y);return e.append(")  "+this.xn+" "+this.Ur),e.toString()},n.prototype.isPointwiseEqual=function(e){if(this.pts.length!==e.pts.length)return!1;for(var n=0;n<this.pts.length;n++)if(!this.pts[n].equals2D(e.pts[n]))return!1;return!0},n.prototype.setDepthDelta=function(e){this.Ur=e},n.prototype.getEdgeIntersectionList=function(){return this.eiList},n.prototype.addIntersections=function(e,n,i){for(var o=0;o<e.getIntersectionNum();o++)this.addIntersection(e,n,i,o)},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n.updateIM=function(){if(2!==arguments.length)return e.prototype.updateIM.apply(this,arguments);var n=arguments[0],i=arguments[1];i.setAtLeastIfValid(n.getLocation(0,Uut.ON),n.getLocation(1,Uut.ON),1),n.isArea()&&(i.setAtLeastIfValid(n.getLocation(0,Uut.LEFT),n.getLocation(1,Uut.LEFT),2),i.setAtLeastIfValid(n.getLocation(0,Uut.RIGHT),n.getLocation(1,Uut.RIGHT),2))},n}(ect),xAt=function(e){this.Er=null,this.Nr=null,this.tn=null,this.jr=null,this.gr=new cAt,this.Vi=e||null};xAt.prototype.setWorkingPrecisionModel=function(e){this.Er=e},xAt.prototype.insertUniqueEdge=function(e){var n=this.gr.findEqualEdge(e);if(null!==n){var i=n.getLabel(),o=e.getLabel();n.isPointwiseEqual(e)||(o=new Jut(e.getLabel())).flip(),i.merge(o);var s=xAt.depthDelta(o),a=n.getDepthDelta()+s;n.setDepthDelta(a)}else this.gr.add(e),e.setDepthDelta(xAt.depthDelta(e.getLabel()))},xAt.prototype.buildSubgraphs=function(e,n){for(var i=new Plt,o=e.iterator();o.hasNext();){var s=o.next(),a=s.getRightmostCoordinate(),h=new $ct(i).getDepth(a);s.computeDepth(h),s.findResultEdges(),i.add(s),n.add(s.getDirectedEdges(),s.getNodes())}},xAt.prototype.createSubgraphs=function(e){for(var n=new Plt,i=e.getNodes().iterator();i.hasNext();){var o=i.next();if(!o.isVisited()){var s=new Xut;s.create(o),n.add(s)}}return yct.sort(n,yct.reverseOrder()),n},xAt.prototype.createEmptyResultGeometry=function(){return this.tn.createPolygon()},xAt.prototype.getNoder=function(e){if(null!==this.Nr)return this.Nr;var n=new Hct,i=new rlt;return i.setPrecisionModel(e),n.setSegmentIntersector(new fAt(i)),n},xAt.prototype.buffer=function(e,n){var i=this.Er;null===i&&(i=e.getPrecisionModel()),this.tn=e.getFactory();var o=new Kct(i,this.Vi),s=new iAt(e,n,o).getCurves();if(s.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(s,i),this.jr=new lct(new lAt),this.jr.addEdges(this.gr.getEdges());var a=this.createSubgraphs(this.jr),h=new uct(this.tn);this.buildSubgraphs(a,h);var l=h.getPolygons();return l.size()<=0?this.createEmptyResultGeometry():this.tn.buildGeometry(l)},xAt.prototype.computeNodedEdges=function(e,n){var i=this.getNoder(n);i.computeNodes(e);for(var o=i.getNodedSubstrings().iterator();o.hasNext();){var s=o.next(),a=s.getCoordinates();if(2!==a.length||!a[0].equals2D(a[1])){var h=s.getData(),l=new _At(s.getCoordinates(),new Jut(h));this.insertUniqueEdge(l)}}},xAt.prototype.setNoder=function(e){this.Nr=e},xAt.prototype.interfaces_=function(){return[]},xAt.prototype.getClass=function(){return xAt},xAt.depthDelta=function(e){var n=e.getLocation(0,Uut.LEFT),i=e.getLocation(0,Uut.RIGHT);return n===Sht.INTERIOR&&i===Sht.EXTERIOR?1:n===Sht.EXTERIOR&&i===Sht.INTERIOR?-1:0},xAt.convertSegStrings=function(e){for(var n=new kut,i=new Plt;e.hasNext();){var o=e.next(),s=n.createLineString(o.getCoordinates());i.add(s)}return n.buildGeometry(i)};var bAt=function(){if(this.Qr=null,this.Sr=null,this.Br=null,this.kr=null,this.Rr=!1,2===arguments.length){var e=arguments[1];this.Qr=arguments[0],this.Sr=e,this.Br=0,this.kr=0,this.Rr=!this.isIntegerPrecision()}else if(4===arguments.length){var n=arguments[1],i=arguments[2],o=arguments[3];this.Qr=arguments[0],this.Sr=n,this.Br=i,this.kr=o,this.Rr=!this.isIntegerPrecision()}};bAt.prototype.rescale=function(){var e=this;if(Eht(arguments[0],_lt))for(var n=arguments[0].iterator();n.hasNext();){var i=n.next();e.rescale(i.getCoordinates())}else if(arguments[0]instanceof Array){for(var o=arguments[0],s=0;s<o.length;s++)o[s].x=o[s].x/e.Sr+e.Br,o[s].y=o[s].y/e.Sr+e.kr;2===o.length&&o[0].equals2D(o[1])&&Vht.out.println(o)}},bAt.prototype.scale=function(){var e=this;if(Eht(arguments[0],_lt)){for(var n=arguments[0],i=new Plt,o=n.iterator();o.hasNext();){var s=o.next();i.add(new Rct(e.scale(s.getCoordinates()),s.getData()))}return i}if(arguments[0]instanceof Array){for(var a=arguments[0],h=new Array(a.length).fill(null),l=0;l<a.length;l++)h[l]=new Cht(Math.round((a[l].x-e.Br)*e.Sr),Math.round((a[l].y-e.kr)*e.Sr),a[l].z);return Slt.removeRepeatedPoints(h)}},bAt.prototype.isIntegerPrecision=function(){return 1===this.Sr},bAt.prototype.getNodedSubstrings=function(){var e=this.Qr.getNodedSubstrings();return this.Rr&&this.rescale(e),e},bAt.prototype.computeNodes=function(e){var n=e;this.Rr&&(n=this.scale(e)),this.Qr.computeNodes(n)},bAt.prototype.interfaces_=function(){return[zct]},bAt.prototype.getClass=function(){return bAt};var wAt=function(){this.Wi=new rlt,this.Gr=null,this.Gr=arguments[0]},CAt={fact:{configurable:!0}};wAt.prototype.checkEndPtVertexIntersections=function(){var e=this;if(0===arguments.length)for(var n=this.Gr.iterator();n.hasNext();){var i=n.next().getCoordinates();e.checkEndPtVertexIntersections(i[0],e.Gr),e.checkEndPtVertexIntersections(i[i.length-1],e.Gr)}else if(2===arguments.length)for(var o=arguments[0],s=arguments[1].iterator();s.hasNext();)for(var a=s.next().getCoordinates(),h=1;h<a.length-1;h++)if(a[h].equals(o))throw new $ht("found endpt/interior pt intersection at index "+h+" :pt "+o)},wAt.prototype.checkInteriorIntersections=function(){if(0===arguments.length)for(var e=this.Gr.iterator();e.hasNext();)for(var n=e.next(),i=this.Gr.iterator();i.hasNext();){var o=i.next();this.checkInteriorIntersections(n,o)}else if(2===arguments.length)for(var s=arguments[0],a=arguments[1],h=s.getCoordinates(),l=a.getCoordinates(),c=0;c<h.length-1;c++)for(var A=0;A<l.length-1;A++)this.checkInteriorIntersections(s,c,a,A);else if(4===arguments.length){var f=arguments[0],d=arguments[1],p=arguments[2],g=arguments[3];if(f===p&&d===g)return null;var v=f.getCoordinates()[d],w=f.getCoordinates()[d+1],C=p.getCoordinates()[g],P=p.getCoordinates()[g+1];if(this.Wi.computeIntersection(v,w,C,P),this.Wi.hasIntersection()&&(this.Wi.isProper()||this.hasInteriorIntersection(this.Wi,v,w)||this.hasInteriorIntersection(this.Wi,C,P)))throw new $ht("found non-noded intersection at "+v+"-"+w+" and "+C+"-"+P)}},wAt.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()},wAt.prototype.checkCollapses=function(){if(0===arguments.length)for(var e=this.Gr.iterator();e.hasNext();){var n=e.next();this.checkCollapses(n)}else if(1===arguments.length)for(var i=arguments[0].getCoordinates(),o=0;o<i.length-2;o++)this.checkCollapse(i[o],i[o+1],i[o+2])},wAt.prototype.hasInteriorIntersection=function(e,n,i){for(var o=0;o<e.getIntersectionNum();o++){var s=e.getIntersection(o);if(!s.equals(n)&&!s.equals(i))return!0}return!1},wAt.prototype.checkCollapse=function(e,n,i){if(e.equals(i))throw new $ht("found non-noded collapse at "+wAt.fact.createLineString([e,n,i]))},wAt.prototype.interfaces_=function(){return[]},wAt.prototype.getClass=function(){return wAt},CAt.fact.get=function(){return new kut},Object.defineProperties(wAt,CAt);var PAt=function(){this.Wi=null,this.Yr=null,this.qr=null,this.Vr=null,this.Wr=null,this._r=null,this.Sr=null,this.Tt=null,this.Ot=null,this.Ft=null,this.Ut=null,this.Kr=new Array(4).fill(null),this.Hr=null;var e=arguments[0],n=arguments[1],i=arguments[2];if(this.qr=e,this.Yr=e,this.Sr=n,this.Wi=i,n<=0)throw new mht("Scale factor must be non-zero");1!==n&&(this.Yr=new Cht(this.scale(e.x),this.scale(e.y)),this.Wr=new Cht,this._r=new Cht),this.initCorners(this.Yr)},MAt={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};PAt.prototype.intersectsScaled=function(e,n){var i=Math.min(e.x,n.x),o=Math.max(e.x,n.x),s=Math.min(e.y,n.y),a=Math.max(e.y,n.y),h=this.Ot<i||this.Tt>o||this.Ut<s||this.Ft>a;if(h)return!1;var l=this.intersectsToleranceSquare(e,n);return elt.isTrue(!(h&&l),"Found bad envelope test"),l},PAt.prototype.initCorners=function(e){var n=.5;this.Tt=e.x-n,this.Ot=e.x+n,this.Ft=e.y-n,this.Ut=e.y+n,this.Kr[0]=new Cht(this.Ot,this.Ut),this.Kr[1]=new Cht(this.Tt,this.Ut),this.Kr[2]=new Cht(this.Tt,this.Ft),this.Kr[3]=new Cht(this.Ot,this.Ft)},PAt.prototype.intersects=function(e,n){return 1===this.Sr?this.intersectsScaled(e,n):(this.copyScaled(e,this.Wr),this.copyScaled(n,this._r),this.intersectsScaled(this.Wr,this._r))},PAt.prototype.scale=function(e){return Math.round(e*this.Sr)},PAt.prototype.getCoordinate=function(){return this.qr},PAt.prototype.copyScaled=function(e,n){n.x=this.scale(e.x),n.y=this.scale(e.y)},PAt.prototype.getSafeEnvelope=function(){if(null===this.Hr){var e=PAt.SAFE_ENV_EXPANSION_FACTOR/this.Sr;this.Hr=new qht(this.qr.x-e,this.qr.x+e,this.qr.y-e,this.qr.y+e)}return this.Hr},PAt.prototype.intersectsPixelClosure=function(e,n){return this.Wi.computeIntersection(e,n,this.Kr[0],this.Kr[1]),!!(this.Wi.hasIntersection()||(this.Wi.computeIntersection(e,n,this.Kr[1],this.Kr[2]),this.Wi.hasIntersection()||(this.Wi.computeIntersection(e,n,this.Kr[2],this.Kr[3]),this.Wi.hasIntersection()||(this.Wi.computeIntersection(e,n,this.Kr[3],this.Kr[0]),this.Wi.hasIntersection()))))},PAt.prototype.intersectsToleranceSquare=function(e,n){var i=!1,o=!1;return this.Wi.computeIntersection(e,n,this.Kr[0],this.Kr[1]),!!(this.Wi.isProper()||(this.Wi.computeIntersection(e,n,this.Kr[1],this.Kr[2]),this.Wi.isProper()||(this.Wi.hasIntersection()&&(i=!0),this.Wi.computeIntersection(e,n,this.Kr[2],this.Kr[3]),this.Wi.isProper()||(this.Wi.hasIntersection()&&(o=!0),this.Wi.computeIntersection(e,n,this.Kr[3],this.Kr[0]),this.Wi.isProper()||i&&o||e.equals(this.Yr)||n.equals(this.Yr)))))},PAt.prototype.addSnappedNode=function(e,n){var i=e.getCoordinate(n),o=e.getCoordinate(n+1);return!!this.intersects(i,o)&&(e.addIntersection(this.getCoordinate(),n),!0)},PAt.prototype.interfaces_=function(){return[]},PAt.prototype.getClass=function(){return PAt},MAt.SAFE_ENV_EXPANSION_FACTOR.get=function(){return.75},Object.defineProperties(PAt,MAt);var TAt=function(){this.tempEnv1=new qht,this.selectedSegment=new Dct};TAt.prototype.select=function(){if(1===arguments.length);else if(2===arguments.length){arguments[0].getLineSegment(arguments[1],this.selectedSegment),this.select(this.selectedSegment)}},TAt.prototype.interfaces_=function(){return[]},TAt.prototype.getClass=function(){return TAt};var SAt=function(){this.di=null,this.di=arguments[0]},IAt={HotPixelSnapAction:{configurable:!0}};SAt.prototype.snap=function(){if(1===arguments.length)return this.snap(arguments[0],null,-1);if(3===arguments.length){var e=arguments[0],n=arguments[1],i=arguments[2],o=e.getSafeEnvelope(),s=new EAt(e,n,i);return this.di.query(o,{interfaces_:function(){return[dct]},visitItem:function(e){e.select(o,s)}}),s.isNodeAdded()}},SAt.prototype.interfaces_=function(){return[]},SAt.prototype.getClass=function(){return SAt},IAt.HotPixelSnapAction.get=function(){return EAt},Object.defineProperties(SAt,IAt);var EAt=function(e){function n(){e.call(this),this.Jr=null,this.Zr=null,this.Xr=null,this.$r=!1;var n=arguments[1],i=arguments[2];this.Jr=arguments[0],this.Zr=n,this.Xr=i}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.isNodeAdded=function(){return this.$r},n.prototype.select=function(){if(2!==arguments.length)return e.prototype.select.apply(this,arguments);var n=arguments[1],i=arguments[0].getContext();if(null!==this.Zr&&i===this.Zr&&n===this.Xr)return null;this.$r=this.Jr.addSnappedNode(i,n)},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n}(TAt),OAt=function(){this.Wi=null,this.Ae=null,this.Wi=arguments[0],this.Ae=new Plt};OAt.prototype.processIntersections=function(e,n,i,o){if(e===i&&n===o)return null;var s=e.getCoordinates()[n],a=e.getCoordinates()[n+1],h=i.getCoordinates()[o],l=i.getCoordinates()[o+1];if(this.Wi.computeIntersection(s,a,h,l),this.Wi.hasIntersection()&&this.Wi.isInteriorIntersection()){for(var c=0;c<this.Wi.getIntersectionNum();c++)this.Ae.add(this.Wi.getIntersection(c));e.addIntersections(this.Wi,n,0),i.addIntersections(this.Wi,o,1)}},OAt.prototype.isDone=function(){return!1},OAt.prototype.getInteriorIntersections=function(){return this.Ae},OAt.prototype.interfaces_=function(){return[AAt]},OAt.prototype.getClass=function(){return OAt};var RAt=function(){this.te=null,this.Wi=null,this.Sr=null,this.Qr=null,this.ne=null,this.mi=null;var e=arguments[0];this.te=e,this.Wi=new rlt,this.Wi.setPrecisionModel(e),this.Sr=e.getScale()};RAt.prototype.checkCorrectness=function(e){var n=Rct.getNodedSubstrings(e),i=new wAt(n);try{i.checkValid()}catch(e){if(!(e instanceof Uht))throw e;e.printStackTrace()}},RAt.prototype.getNodedSubstrings=function(){return Rct.getNodedSubstrings(this.mi)},RAt.prototype.snapRound=function(e,n){var i=this.findInteriorIntersections(e,n);this.computeIntersectionSnaps(i),this.computeVertexSnaps(e)},RAt.prototype.findInteriorIntersections=function(e,n){var i=new OAt(n);return this.Qr.setSegmentIntersector(i),this.Qr.computeNodes(e),i.getInteriorIntersections()},RAt.prototype.computeVertexSnaps=function(){var e=this;if(Eht(arguments[0],_lt))for(var n=arguments[0].iterator();n.hasNext();){var i=n.next();e.computeVertexSnaps(i)}else if(arguments[0]instanceof Rct)for(var o=arguments[0],s=o.getCoordinates(),a=0;a<s.length;a++){var h=new PAt(s[a],e.Sr,e.Wi);e.ne.snap(h,o,a)&&o.addIntersection(s[a],a)}},RAt.prototype.computeNodes=function(e){this.mi=e,this.Qr=new Hct,this.ne=new SAt(this.Qr.getIndex()),this.snapRound(e,this.Wi)},RAt.prototype.computeIntersectionSnaps=function(e){for(var n=this,i=e.iterator();i.hasNext();){var o=i.next(),s=new PAt(o,n.Sr,n.Wi);n.ne.snap(s)}},RAt.prototype.interfaces_=function(){return[zct]},RAt.prototype.getClass=function(){return RAt};var DAt=function(){if(this.ie=null,this.ri=null,this.Vi=new Uct,this.re=null,this.ee=null,1===arguments.length)this.ie=arguments[0];else if(2===arguments.length){var e=arguments[1];this.ie=arguments[0],this.Vi=e}},kAt={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};DAt.prototype.bufferFixedPrecision=function(e){var n=new bAt(new RAt(new Eut(1)),e.getScale()),i=new xAt(this.Vi);i.setWorkingPrecisionModel(e),i.setNoder(n),this.re=i.buffer(this.ie,this.ri)},DAt.prototype.bufferReducedPrecision=function(){var e=this;if(0===arguments.length){for(var n=DAt.MAX_PRECISION_DIGITS;n>=0;n--){try{e.bufferReducedPrecision(n)}catch(n){if(!(n instanceof Zut))throw n;e.ee=n}if(null!==e.re)return null}throw this.ee}if(1===arguments.length){var i=DAt.precisionScaleFactor(this.ie,this.ri,arguments[0]),o=new Eut(i);this.bufferFixedPrecision(o)}},DAt.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),null!==this.re)return null;var e=this.ie.getFactory().getPrecisionModel();e.getType()===Eut.FIXED?this.bufferFixedPrecision(e):this.bufferReducedPrecision()},DAt.prototype.setQuadrantSegments=function(e){this.Vi.setQuadrantSegments(e)},DAt.prototype.bufferOriginalPrecision=function(){try{var e=new xAt(this.Vi);this.re=e.buffer(this.ie,this.ri)}catch(e){if(!(e instanceof $ht))throw e;this.ee=e}},DAt.prototype.getResultGeometry=function(e){return this.ri=e,this.computeGeometry(),this.re},DAt.prototype.setEndCapStyle=function(e){this.Vi.setEndCapStyle(e)},DAt.prototype.interfaces_=function(){return[]},DAt.prototype.getClass=function(){return DAt},DAt.bufferOp=function(){if(2===arguments.length){var e=arguments[1];return new DAt(arguments[0]).getResultGeometry(e)}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof ult&&"number"==typeof arguments[1]){var n=arguments[1],i=arguments[2],o=new DAt(arguments[0]);return o.setQuadrantSegments(i),o.getResultGeometry(n)}if(arguments[2]instanceof Uct&&arguments[0]instanceof ult&&"number"==typeof arguments[1]){var s=arguments[1];return new DAt(arguments[0],arguments[2]).getResultGeometry(s)}}else if(4===arguments.length){var a=arguments[1],h=arguments[2],l=arguments[3],c=new DAt(arguments[0]);return c.setQuadrantSegments(h),c.setEndCapStyle(l),c.getResultGeometry(a)}},DAt.precisionScaleFactor=function(e,n,i){var o=e.getEnvelopeInternal(),s=Oht.max(Math.abs(o.getMaxX()),Math.abs(o.getMaxY()),Math.abs(o.getMinX()),Math.abs(o.getMinY()))+2*(n>0?n:0),a=i-Math.trunc(Math.log(s)/Math.log(10)+1);return Math.pow(10,a)},kAt.CAP_ROUND.get=function(){return Uct.CAP_ROUND},kAt.CAP_BUTT.get=function(){return Uct.CAP_FLAT},kAt.CAP_FLAT.get=function(){return Uct.CAP_FLAT},kAt.CAP_SQUARE.get=function(){return Uct.CAP_SQUARE},kAt.MAX_PRECISION_DIGITS.get=function(){return 12},Object.defineProperties(DAt,kAt);var LAt=function(){this.Yr=[new Cht,new Cht],this.ri=yht.NaN,this.se=!0};LAt.prototype.getCoordinates=function(){return this.Yr},LAt.prototype.getCoordinate=function(e){return this.Yr[e]},LAt.prototype.setMinimum=function(){if(1===arguments.length){var e=arguments[0];this.setMinimum(e.Yr[0],e.Yr[1])}else if(2===arguments.length){var n=arguments[0],i=arguments[1];if(this.se)return this.initialize(n,i),null;var o=n.distance(i);o<this.ri&&this.initialize(n,i,o)}},LAt.prototype.initialize=function(){if(0===arguments.length)this.se=!0;else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.Yr[0].setCoordinate(e),this.Yr[1].setCoordinate(n),this.ri=e.distance(n),this.se=!1}else if(3===arguments.length){var i=arguments[1],o=arguments[2];this.Yr[0].setCoordinate(arguments[0]),this.Yr[1].setCoordinate(i),this.ri=o,this.se=!1}},LAt.prototype.getDistance=function(){return this.ri},LAt.prototype.setMaximum=function(){if(1===arguments.length){var e=arguments[0];this.setMaximum(e.Yr[0],e.Yr[1])}else if(2===arguments.length){var n=arguments[0],i=arguments[1];if(this.se)return this.initialize(n,i),null;var o=n.distance(i);o>this.ri&&this.initialize(n,i,o)}},LAt.prototype.interfaces_=function(){return[]},LAt.prototype.getClass=function(){return LAt};var FAt=function(){};FAt.prototype.interfaces_=function(){return[]},FAt.prototype.getClass=function(){return FAt},FAt.computeDistance=function(){if(arguments[2]instanceof LAt&&arguments[0]instanceof Aut&&arguments[1]instanceof Cht)for(var e=arguments[1],n=arguments[2],i=arguments[0].getCoordinates(),o=new Dct,s=0;s<i.length-1;s++){o.setCoordinates(i[s],i[s+1]);var a=o.closestPoint(e);n.setMinimum(a,e)}else if(arguments[2]instanceof LAt&&arguments[0]instanceof gut&&arguments[1]instanceof Cht){var h=arguments[0],l=arguments[1],c=arguments[2];FAt.computeDistance(h.getExteriorRing(),l,c);for(var A=0;A<h.getNumInteriorRing();A++)FAt.computeDistance(h.getInteriorRingN(A),l,c)}else if(arguments[2]instanceof LAt&&arguments[0]instanceof ult&&arguments[1]instanceof Cht){var f=arguments[0],d=arguments[1],p=arguments[2];if(f instanceof Aut)FAt.computeDistance(f,d,p);else if(f instanceof gut)FAt.computeDistance(f,d,p);else if(f instanceof $lt)for(var g=f,v=0;v<g.getNumGeometries();v++){var w=g.getGeometryN(v);FAt.computeDistance(w,d,p)}else p.setMinimum(f.getCoordinate(),d)}else if(arguments[2]instanceof LAt&&arguments[0]instanceof Dct&&arguments[1]instanceof Cht){var C=arguments[1],P=arguments[2],T=arguments[0].closestPoint(C);P.setMinimum(T,C)}};var NAt=function(e){this.ue=new LAt,this.ur=e||null},zAt={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};NAt.prototype.computeMaxMidpointDistance=function(e){var n=new HAt(this.ur);e.apply(n),this.ue.setMaximum(n.getMaxPointDistance())},NAt.prototype.computeMaxVertexDistance=function(e){var n=new BAt(this.ur);e.apply(n),this.ue.setMaximum(n.getMaxPointDistance())},NAt.prototype.findDistance=function(e){return this.computeMaxVertexDistance(e),this.computeMaxMidpointDistance(e),this.ue.getDistance()},NAt.prototype.getDistancePoints=function(){return this.ue},NAt.prototype.interfaces_=function(){return[]},NAt.prototype.getClass=function(){return NAt},zAt.MaxPointDistanceFilter.get=function(){return BAt},zAt.MaxMidpointDistanceFilter.get=function(){return HAt},Object.defineProperties(NAt,zAt);var BAt=function(e){this.ue=new LAt,this.oe=new LAt,this.An=e||null};BAt.prototype.filter=function(e){this.oe.initialize(),FAt.computeDistance(this.An,e,this.oe),this.ue.setMaximum(this.oe)},BAt.prototype.getMaxPointDistance=function(){return this.ue},BAt.prototype.interfaces_=function(){return[flt]},BAt.prototype.getClass=function(){return BAt};var HAt=function(e){this.ue=new LAt,this.oe=new LAt,this.An=e||null};HAt.prototype.filter=function(e,n){if(0===n)return null;var i=e.getCoordinate(n-1),o=e.getCoordinate(n),s=new Cht((i.x+o.x)/2,(i.y+o.y)/2);this.oe.initialize(),FAt.computeDistance(this.An,s,this.oe),this.ue.setMaximum(this.oe)},HAt.prototype.isDone=function(){return!1},HAt.prototype.isGeometryChanged=function(){return!1},HAt.prototype.getMaxPointDistance=function(){return this.ue},HAt.prototype.interfaces_=function(){return[Klt]},HAt.prototype.getClass=function(){return HAt};var jAt=function(e){this.he=e||null};jAt.prototype.filter=function(e){e instanceof gut&&this.he.add(e)},jAt.prototype.interfaces_=function(){return[Jlt]},jAt.prototype.getClass=function(){return jAt},jAt.getPolygons=function(){if(1===arguments.length)return jAt.getPolygons(arguments[0],new Plt);if(2===arguments.length){var e=arguments[0],n=arguments[1];return e instanceof gut?n.add(e):e instanceof $lt&&e.apply(new jAt(n)),n}};var UAt=function(){if(this.ot=null,this.fe=!1,1===arguments.length)this.ot=arguments[0];else if(2===arguments.length){var e=arguments[1];this.ot=arguments[0],this.fe=e}};UAt.prototype.filter=function(e){if(this.fe&&e instanceof yut){var n=e.getFactory().createLineString(e.getCoordinateSequence());return this.ot.add(n),null}e instanceof Aut&&this.ot.add(e)},UAt.prototype.setForceToLineString=function(e){this.fe=e},UAt.prototype.interfaces_=function(){return[llt]},UAt.prototype.getClass=function(){return UAt},UAt.getGeometry=function(){if(1===arguments.length){var e=arguments[0];return e.getFactory().buildGeometry(UAt.getLines(e))}if(2===arguments.length){var n=arguments[0],i=arguments[1];return n.getFactory().buildGeometry(UAt.getLines(n,i))}},UAt.getLines=function(){if(1===arguments.length)return UAt.getLines(arguments[0],!1);if(2===arguments.length){if(Eht(arguments[0],_lt)&&Eht(arguments[1],_lt)){for(var e=arguments[1],n=arguments[0].iterator();n.hasNext();){var i=n.next();UAt.getLines(i,e)}return e}if(arguments[0]instanceof ult&&"boolean"==typeof arguments[1]){var o=arguments[0],s=arguments[1],a=new Plt;return o.apply(new UAt(a,s)),a}if(arguments[0]instanceof ult&&Eht(arguments[1],_lt)){var h=arguments[0],l=arguments[1];return h instanceof Aut?l.add(h):h.apply(new UAt(l)),l}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&Eht(arguments[0],_lt)&&Eht(arguments[1],_lt)){for(var c=arguments[1],A=arguments[2],f=arguments[0].iterator();f.hasNext();){var d=f.next();UAt.getLines(d,c,A)}return c}if("boolean"==typeof arguments[2]&&arguments[0]instanceof ult&&Eht(arguments[1],_lt)){var p=arguments[1];return arguments[0].apply(new UAt(p,arguments[2])),p}}};var GAt=function(){if(this.ce=dlt.OGC_SFS_BOUNDARY_RULE,this.ae=null,this.ve=null,0===arguments.length);else if(1===arguments.length){var e=arguments[0];if(null===e)throw new mht("Rule must be non-null");this.ce=e}};GAt.prototype.locateInternal=function(){if(arguments[0]instanceof Cht&&arguments[1]instanceof gut){var e=arguments[0],n=arguments[1];if(n.isEmpty())return Sht.EXTERIOR;var i=n.getExteriorRing(),o=this.locateInPolygonRing(e,i);if(o===Sht.EXTERIOR)return Sht.EXTERIOR;if(o===Sht.BOUNDARY)return Sht.BOUNDARY;for(var s=0;s<n.getNumInteriorRing();s++){var a=n.getInteriorRingN(s),h=this.locateInPolygonRing(e,a);if(h===Sht.INTERIOR)return Sht.EXTERIOR;if(h===Sht.BOUNDARY)return Sht.BOUNDARY}return Sht.INTERIOR}if(arguments[0]instanceof Cht&&arguments[1]instanceof Aut){var l=arguments[0],c=arguments[1];if(!c.getEnvelopeInternal().intersects(l))return Sht.EXTERIOR;var A=c.getCoordinates();return c.isClosed()||!l.equals(A[0])&&!l.equals(A[A.length-1])?alt.isOnLine(l,A)?Sht.INTERIOR:Sht.EXTERIOR:Sht.BOUNDARY}if(arguments[0]instanceof Cht&&arguments[1]instanceof dut){var f=arguments[0];return arguments[1].getCoordinate().equals2D(f)?Sht.INTERIOR:Sht.EXTERIOR}},GAt.prototype.locateInPolygonRing=function(e,n){return n.getEnvelopeInternal().intersects(e)?alt.locatePointInRing(e,n.getCoordinates()):Sht.EXTERIOR},GAt.prototype.intersects=function(e,n){return this.locate(e,n)!==Sht.EXTERIOR},GAt.prototype.updateLocationInfo=function(e){e===Sht.INTERIOR&&(this.ae=!0),e===Sht.BOUNDARY&&this.ve++},GAt.prototype.computeLocation=function(e,n){var i=this;if(n instanceof dut&&this.updateLocationInfo(this.locateInternal(e,n)),n instanceof Aut)this.updateLocationInfo(this.locateInternal(e,n));else if(n instanceof gut)this.updateLocationInfo(this.locateInternal(e,n));else if(n instanceof tut)for(var o=n,s=0;s<o.getNumGeometries();s++){var a=o.getGeometryN(s);i.updateLocationInfo(i.locateInternal(e,a))}else if(n instanceof vut)for(var h=n,l=0;l<h.getNumGeometries();l++){var c=h.getGeometryN(l);i.updateLocationInfo(i.locateInternal(e,c))}else if(n instanceof $lt)for(var A=new oAt(n);A.hasNext();){var f=A.next();f!==n&&i.computeLocation(e,f)}},GAt.prototype.locate=function(e,n){return n.isEmpty()?Sht.EXTERIOR:n instanceof Aut||n instanceof gut?this.locateInternal(e,n):(this.ae=!1,this.ve=0,this.computeLocation(e,n),this.ce.isInBoundary(this.ve)?Sht.BOUNDARY:this.ve>0||this.ae?Sht.INTERIOR:Sht.EXTERIOR)},GAt.prototype.interfaces_=function(){return[]},GAt.prototype.getClass=function(){return GAt};var VAt=function e(){if(this.we=null,this.Pe=null,this.Yr=null,2===arguments.length)e.call(this,arguments[0],e.INSIDE_AREA,arguments[1]);else if(3===arguments.length){var n=arguments[1],i=arguments[2];this.we=arguments[0],this.Pe=n,this.Yr=i}},WAt={INSIDE_AREA:{configurable:!0}};VAt.prototype.isInsideArea=function(){return this.Pe===VAt.INSIDE_AREA},VAt.prototype.getCoordinate=function(){return this.Yr},VAt.prototype.getGeometryComponent=function(){return this.we},VAt.prototype.getSegmentIndex=function(){return this.Pe},VAt.prototype.interfaces_=function(){return[]},VAt.prototype.getClass=function(){return VAt},WAt.INSIDE_AREA.get=function(){return-1},Object.defineProperties(VAt,WAt);var qAt=function(e){this.dn=e||null};qAt.prototype.filter=function(e){e instanceof dut&&this.dn.add(e)},qAt.prototype.interfaces_=function(){return[Jlt]},qAt.prototype.getClass=function(){return qAt},qAt.getPoints=function(){if(1===arguments.length){var e=arguments[0];return e instanceof dut?yct.singletonList(e):qAt.getPoints(e,new Plt)}if(2===arguments.length){var n=arguments[0],i=arguments[1];return n instanceof dut?i.add(n):n instanceof $lt&&n.apply(new qAt(i)),i}};var ZAt=function(){this.Ce=null,this.Ce=arguments[0]};ZAt.prototype.filter=function(e){(e instanceof dut||e instanceof Aut||e instanceof gut)&&this.Ce.add(new VAt(e,0,e.getCoordinate()))},ZAt.prototype.interfaces_=function(){return[Jlt]},ZAt.prototype.getClass=function(){return ZAt},ZAt.getLocations=function(e){var n=new Plt;return e.apply(new ZAt(n)),n};var QAt=function(){if(this.An=null,this.De=0,this.Ie=new GAt,this.be=null,this.Me=yht.MAX_VALUE,2===arguments.length)this.An=[arguments[0],arguments[1]],this.De=0;else if(3===arguments.length){var e=arguments[0],n=arguments[1],i=arguments[2];this.An=new Array(2).fill(null),this.An[0]=e,this.An[1]=n,this.De=i}};QAt.prototype.computeContainmentDistance=function(){var e=this;if(0===arguments.length){var n=new Array(2).fill(null);if(this.computeContainmentDistance(0,n),this.Me<=this.De)return null;this.computeContainmentDistance(1,n)}else if(2===arguments.length){var i=arguments[0],o=arguments[1],s=1-i,a=jAt.getPolygons(this.An[i]);if(a.size()>0){var h=ZAt.getLocations(this.An[s]);if(this.computeContainmentDistance(h,a,o),this.Me<=this.De)return this.be[s]=o[0],this.be[i]=o[1],null}}else if(3===arguments.length)if(arguments[2]instanceof Array&&Eht(arguments[0],wlt)&&Eht(arguments[1],wlt)){for(var l=arguments[0],c=arguments[1],A=arguments[2],f=0;f<l.size();f++)for(var d=l.get(f),p=0;p<c.size();p++)if(e.computeContainmentDistance(d,c.get(p),A),e.Me<=e.De)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof VAt&&arguments[1]instanceof gut){var g=arguments[0],v=arguments[1],w=arguments[2],C=g.getCoordinate();if(Sht.EXTERIOR!==this.Ie.locate(C,v))return this.Me=0,w[0]=g,w[1]=new VAt(v,C),null}},QAt.prototype.computeMinDistanceLinesPoints=function(e,n,i){for(var o=this,s=0;s<e.size();s++)for(var a=e.get(s),h=0;h<n.size();h++){var l=n.get(h);if(o.computeMinDistance(a,l,i),o.Me<=o.De)return null}},QAt.prototype.computeFacetDistance=function(){var e=new Array(2).fill(null),n=UAt.getLines(this.An[0]),i=UAt.getLines(this.An[1]),o=qAt.getPoints(this.An[0]),s=qAt.getPoints(this.An[1]);return this.computeMinDistanceLines(n,i,e),this.updateMinDistance(e,!1),this.Me<=this.De?null:(e[0]=null,e[1]=null,this.computeMinDistanceLinesPoints(n,s,e),this.updateMinDistance(e,!1),this.Me<=this.De?null:(e[0]=null,e[1]=null,this.computeMinDistanceLinesPoints(i,o,e),this.updateMinDistance(e,!0),this.Me<=this.De?null:(e[0]=null,e[1]=null,this.computeMinDistancePoints(o,s,e),void this.updateMinDistance(e,!1))))},QAt.prototype.nearestLocations=function(){return this.computeMinDistance(),this.be},QAt.prototype.updateMinDistance=function(e,n){if(null===e[0])return null;n?(this.be[0]=e[1],this.be[1]=e[0]):(this.be[0]=e[0],this.be[1]=e[1])},QAt.prototype.nearestPoints=function(){return this.computeMinDistance(),[this.be[0].getCoordinate(),this.be[1].getCoordinate()]},QAt.prototype.computeMinDistance=function(){var e=this;if(0===arguments.length){if(null!==this.be)return null;if(this.be=new Array(2).fill(null),this.computeContainmentDistance(),this.Me<=this.De)return null;this.computeFacetDistance()}else if(3===arguments.length)if(arguments[2]instanceof Array&&arguments[0]instanceof Aut&&arguments[1]instanceof dut){var n=arguments[0],i=arguments[1],o=arguments[2];if(n.getEnvelopeInternal().distance(i.getEnvelopeInternal())>this.Me)return null;for(var s=n.getCoordinates(),a=i.getCoordinate(),h=0;h<s.length-1;h++){var l=alt.distancePointLine(a,s[h],s[h+1]);if(l<e.Me){e.Me=l;var c=new Dct(s[h],s[h+1]).closestPoint(a);o[0]=new VAt(n,h,c),o[1]=new VAt(i,0,a)}if(e.Me<=e.De)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof Aut&&arguments[1]instanceof Aut){var A=arguments[0],f=arguments[1],d=arguments[2];if(A.getEnvelopeInternal().distance(f.getEnvelopeInternal())>this.Me)return null;for(var p=A.getCoordinates(),g=f.getCoordinates(),v=0;v<p.length-1;v++)for(var w=0;w<g.length-1;w++){var C=alt.distanceLineLine(p[v],p[v+1],g[w],g[w+1]);if(C<e.Me){e.Me=C;var P=new Dct(p[v],p[v+1]),T=new Dct(g[w],g[w+1]),S=P.closestPoints(T);d[0]=new VAt(A,v,S[0]),d[1]=new VAt(f,w,S[1])}if(e.Me<=e.De)return null}}},QAt.prototype.computeMinDistancePoints=function(e,n,i){for(var o=this,s=0;s<e.size();s++)for(var a=e.get(s),h=0;h<n.size();h++){var l=n.get(h),c=a.getCoordinate().distance(l.getCoordinate());if(c<o.Me&&(o.Me=c,i[0]=new VAt(a,0,a.getCoordinate()),i[1]=new VAt(l,0,l.getCoordinate())),o.Me<=o.De)return null}},QAt.prototype.distance=function(){if(null===this.An[0]||null===this.An[1])throw new mht("null geometries are not supported");return this.An[0].isEmpty()||this.An[1].isEmpty()?0:(this.computeMinDistance(),this.Me)},QAt.prototype.computeMinDistanceLines=function(e,n,i){for(var o=this,s=0;s<e.size();s++)for(var a=e.get(s),h=0;h<n.size();h++){var l=n.get(h);if(o.computeMinDistance(a,l,i),o.Me<=o.De)return null}},QAt.prototype.interfaces_=function(){return[]},QAt.prototype.getClass=function(){return QAt},QAt.distance=function(e,n){return new QAt(e,n).distance()},QAt.isWithinDistance=function(e,n,i){return new QAt(e,n,i).distance()<=i},QAt.nearestPoints=function(e,n){return new QAt(e,n).nearestPoints()};var XAt=function(){this.Yr=[new Cht,new Cht],this.ri=yht.NaN,this.se=!0};XAt.prototype.getCoordinates=function(){return this.Yr},XAt.prototype.getCoordinate=function(e){return this.Yr[e]},XAt.prototype.setMinimum=function(){if(1===arguments.length){var e=arguments[0];this.setMinimum(e.Yr[0],e.Yr[1])}else if(2===arguments.length){var n=arguments[0],i=arguments[1];if(this.se)return this.initialize(n,i),null;var o=n.distance(i);o<this.ri&&this.initialize(n,i,o)}},XAt.prototype.initialize=function(){if(0===arguments.length)this.se=!0;else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.Yr[0].setCoordinate(e),this.Yr[1].setCoordinate(n),this.ri=e.distance(n),this.se=!1}else if(3===arguments.length){var i=arguments[1],o=arguments[2];this.Yr[0].setCoordinate(arguments[0]),this.Yr[1].setCoordinate(i),this.ri=o,this.se=!1}},XAt.prototype.toString=function(){return Kht.toLineString(this.Yr[0],this.Yr[1])},XAt.prototype.getDistance=function(){return this.ri},XAt.prototype.setMaximum=function(){if(1===arguments.length){var e=arguments[0];this.setMaximum(e.Yr[0],e.Yr[1])}else if(2===arguments.length){var n=arguments[0],i=arguments[1];if(this.se)return this.initialize(n,i),null;var o=n.distance(i);o>this.ri&&this.initialize(n,i,o)}},XAt.prototype.interfaces_=function(){return[]},XAt.prototype.getClass=function(){return XAt};var YAt=function(){};YAt.prototype.interfaces_=function(){return[]},YAt.prototype.getClass=function(){return YAt},YAt.computeDistance=function(){if(arguments[2]instanceof XAt&&arguments[0]instanceof Aut&&arguments[1]instanceof Cht)for(var e=arguments[0],n=arguments[1],i=arguments[2],o=new Dct,s=e.getCoordinates(),a=0;a<s.length-1;a++){o.setCoordinates(s[a],s[a+1]);var h=o.closestPoint(n);i.setMinimum(h,n)}else if(arguments[2]instanceof XAt&&arguments[0]instanceof gut&&arguments[1]instanceof Cht){var l=arguments[0],c=arguments[1],A=arguments[2];YAt.computeDistance(l.getExteriorRing(),c,A);for(var f=0;f<l.getNumInteriorRing();f++)YAt.computeDistance(l.getInteriorRingN(f),c,A)}else if(arguments[2]instanceof XAt&&arguments[0]instanceof ult&&arguments[1]instanceof Cht){var d=arguments[0],p=arguments[1],g=arguments[2];if(d instanceof Aut)YAt.computeDistance(d,p,g);else if(d instanceof gut)YAt.computeDistance(d,p,g);else if(d instanceof $lt)for(var v=d,w=0;w<v.getNumGeometries();w++){var C=v.getGeometryN(w);YAt.computeDistance(C,p,g)}else g.setMinimum(d.getCoordinate(),p)}else if(arguments[2]instanceof XAt&&arguments[0]instanceof Dct&&arguments[1]instanceof Cht){var P=arguments[1],T=arguments[2],S=arguments[0].closestPoint(P);T.setMinimum(S,P)}};var JAt=function(){this.ze=null,this.de=null,this.xe=new XAt,this.me=0;var e=arguments[1];this.ze=arguments[0],this.de=e},KAt={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};JAt.prototype.getCoordinates=function(){return this.xe.getCoordinates()},JAt.prototype.setDensifyFraction=function(e){if(e>1||e<=0)throw new mht("Fraction is not in range (0.0 - 1.0]");this.me=e},JAt.prototype.compute=function(e,n){this.computeOrientedDistance(e,n,this.xe),this.computeOrientedDistance(n,e,this.xe)},JAt.prototype.distance=function(){return this.compute(this.ze,this.de),this.xe.getDistance()},JAt.prototype.computeOrientedDistance=function(e,n,i){var o=new $At(n);if(e.apply(o),i.setMaximum(o.getMaxPointDistance()),this.me>0){var s=new tft(n,this.me);e.apply(s),i.setMaximum(s.getMaxPointDistance())}},JAt.prototype.orientedDistance=function(){return this.computeOrientedDistance(this.ze,this.de,this.xe),this.xe.getDistance()},JAt.prototype.interfaces_=function(){return[]},JAt.prototype.getClass=function(){return JAt},JAt.distance=function(){if(2===arguments.length)return new JAt(arguments[0],arguments[1]).distance();if(3===arguments.length){var e=arguments[2],n=new JAt(arguments[0],arguments[1]);return n.setDensifyFraction(e),n.distance()}},KAt.MaxPointDistanceFilter.get=function(){return $At},KAt.MaxDensifiedByFractionDistanceFilter.get=function(){return tft},Object.defineProperties(JAt,KAt);var $At=function(){this.ue=new XAt,this.oe=new XAt,this.ye=new YAt,this.An=null,this.An=arguments[0]};$At.prototype.filter=function(e){this.oe.initialize(),YAt.computeDistance(this.An,e,this.oe),this.ue.setMaximum(this.oe)},$At.prototype.getMaxPointDistance=function(){return this.ue},$At.prototype.interfaces_=function(){return[flt]},$At.prototype.getClass=function(){return $At};var tft=function(){this.ue=new XAt,this.oe=new XAt,this.An=null,this.pe=0;var e=arguments[1];this.An=arguments[0],this.pe=Math.trunc(Math.round(1/e))};tft.prototype.filter=function(e,n){var i=this;if(0===n)return null;for(var o=e.getCoordinate(n-1),s=e.getCoordinate(n),a=(s.x-o.x)/this.pe,h=(s.y-o.y)/this.pe,l=0;l<this.pe;l++){var c=new Cht(o.x+l*a,o.y+l*h);i.oe.initialize(),YAt.computeDistance(i.An,c,i.oe),i.ue.setMaximum(i.oe)}},tft.prototype.isDone=function(){return!1},tft.prototype.isGeometryChanged=function(){return!1},tft.prototype.getMaxPointDistance=function(){return this.ue},tft.prototype.interfaces_=function(){return[Klt]},tft.prototype.getClass=function(){return tft};var eft=function(e,n,i){this.Le=null,this.Te=null,this.Oe=null,this.Fe=null,this.Ue=!0,this.Ee=null,this.Ne=null,this.je=null,this.Qe=e||null,this.Se=n||null,this.Bt=i||null},nft={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};eft.prototype.checkMaximumDistance=function(e,n,i){var o=new JAt(n,e);if(o.setDensifyFraction(.25),this.Fe=o.orientedDistance(),this.Fe>i){this.Ue=!1;var s=o.getCoordinates();this.Ne=s[1],this.je=e.getFactory().createLineString(s),this.Ee="Distance between buffer curve and input is too large ("+this.Fe+" at "+Kht.toLineString(s[0],s[1])+")"}},eft.prototype.isValid=function(){var e=Math.abs(this.Se),n=eft.MAX_DISTANCE_DIFF_FRAC*e;return this.Le=e-n,this.Te=e+n,!(!this.Qe.isEmpty()&&!this.Bt.isEmpty())||(this.Se>0?this.checkPositiveValid():this.checkNegativeValid(),eft.VERBOSE&&Vht.out.println("Min Dist= "+this.Oe+"  err= "+(1-this.Oe/this.Se)+"  Max Dist= "+this.Fe+"  err= "+(this.Fe/this.Se-1)),this.Ue)},eft.prototype.checkNegativeValid=function(){if(!(this.Qe instanceof gut||this.Qe instanceof vut||this.Qe instanceof $lt))return null;var e=this.getPolygonLines(this.Qe);if(this.checkMinimumDistance(e,this.Bt,this.Le),!this.Ue)return null;this.checkMaximumDistance(e,this.Bt,this.Te)},eft.prototype.getErrorIndicator=function(){return this.je},eft.prototype.checkMinimumDistance=function(e,n,i){var o=new QAt(e,n,i);if(this.Oe=o.distance(),this.Oe<i){this.Ue=!1;var s=o.nearestPoints();this.Ne=o.nearestPoints()[1],this.je=e.getFactory().createLineString(s),this.Ee="Distance between buffer curve and input is too small ("+this.Oe+" at "+Kht.toLineString(s[0],s[1])+" )"}},eft.prototype.checkPositiveValid=function(){var e=this.Bt.getBoundary();if(this.checkMinimumDistance(this.Qe,e,this.Le),!this.Ue)return null;this.checkMaximumDistance(this.Qe,e,this.Te)},eft.prototype.getErrorLocation=function(){return this.Ne},eft.prototype.getPolygonLines=function(e){for(var n=new Plt,i=new UAt(n),o=jAt.getPolygons(e).iterator();o.hasNext();)o.next().apply(i);return e.getFactory().buildGeometry(n)},eft.prototype.getErrorMessage=function(){return this.Ee},eft.prototype.interfaces_=function(){return[]},eft.prototype.getClass=function(){return eft},nft.VERBOSE.get=function(){return!1},nft.MAX_DISTANCE_DIFF_FRAC.get=function(){return.012},Object.defineProperties(eft,nft);var ift=function(e,n,i){this.Ue=!0,this.Be=null,this.Ne=null,this.je=null,this.Qe=e||null,this.ri=n||null,this.Bt=i||null},rft={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};ift.prototype.isValid=function(){return this.checkPolygonal(),this.Ue?(this.checkExpectedEmpty(),this.Ue?(this.checkEnvelope(),this.Ue?(this.checkArea(),this.Ue?(this.checkDistance(),this.Ue):this.Ue):this.Ue):this.Ue):this.Ue},ift.prototype.checkEnvelope=function(){if(this.ri<0)return null;var e=this.ri*ift.MAX_ENV_DIFF_FRAC;0===e&&(e=.001);var n=new qht(this.Qe.getEnvelopeInternal());n.expandBy(this.ri);var i=new qht(this.Bt.getEnvelopeInternal());i.expandBy(e),i.contains(n)||(this.Ue=!1,this.Be="Buffer envelope is incorrect",this.je=this.Qe.getFactory().toGeometry(i)),this.report("Envelope")},ift.prototype.checkDistance=function(){var e=new eft(this.Qe,this.ri,this.Bt);e.isValid()||(this.Ue=!1,this.Be=e.getErrorMessage(),this.Ne=e.getErrorLocation(),this.je=e.getErrorIndicator()),this.report("Distance")},ift.prototype.checkArea=function(){var e=this.Qe.getArea(),n=this.Bt.getArea();this.ri>0&&e>n&&(this.Ue=!1,this.Be="Area of positive buffer is smaller than input",this.je=this.Bt),this.ri<0&&e<n&&(this.Ue=!1,this.Be="Area of negative buffer is larger than input",this.je=this.Bt),this.report("Area")},ift.prototype.checkPolygonal=function(){this.Bt instanceof gut||this.Bt instanceof vut||(this.Ue=!1),this.Be="Result is not polygonal",this.je=this.Bt,this.report("Polygonal")},ift.prototype.getErrorIndicator=function(){return this.je},ift.prototype.getErrorLocation=function(){return this.Ne},ift.prototype.checkExpectedEmpty=function(){return this.Qe.getDimension()>=2||this.ri>0?null:(this.Bt.isEmpty()||(this.Ue=!1,this.Be="Result is non-empty",this.je=this.Bt),void this.report("ExpectedEmpty"))},ift.prototype.report=function(e){if(!ift.VERBOSE)return null;Vht.out.println("Check "+e+": "+(this.Ue?"passed":"FAILED"))},ift.prototype.getErrorMessage=function(){return this.Be},ift.prototype.interfaces_=function(){return[]},ift.prototype.getClass=function(){return ift},ift.isValidMsg=function(e,n,i){var o=new ift(e,n,i);return o.isValid()?null:o.getErrorMessage()},ift.isValid=function(e,n,i){return!!new ift(e,n,i).isValid()},rft.VERBOSE.get=function(){return!1},rft.MAX_ENV_DIFF_FRAC.get=function(){return.012},Object.defineProperties(ift,rft);var oft=function(){this.dn=null,this.wi=null;var e=arguments[1];this.dn=arguments[0],this.wi=e};oft.prototype.getCoordinates=function(){return this.dn},oft.prototype.size=function(){return this.dn.length},oft.prototype.getCoordinate=function(e){return this.dn[e]},oft.prototype.isClosed=function(){return this.dn[0].equals(this.dn[this.dn.length-1])},oft.prototype.getSegmentOctant=function(e){return e===this.dn.length-1?-1:Ict.octant(this.getCoordinate(e),this.getCoordinate(e+1))},oft.prototype.setData=function(e){this.wi=e},oft.prototype.getData=function(){return this.wi},oft.prototype.toString=function(){return Kht.toLineString(new Put(this.dn))},oft.prototype.interfaces_=function(){return[Ect]},oft.prototype.getClass=function(){return oft};var sft=function(){this.ke=!1,this.Re=!1,this.Wi=null,this.Ge=null,this.Ye=null,this.qe=new Plt,this.Ve=0,this.We=!0,this.Wi=arguments[0],this.Ge=null};sft.prototype.getInteriorIntersection=function(){return this.Ge},sft.prototype.setCheckEndSegmentsOnly=function(e){this.Re=e},sft.prototype.getIntersectionSegments=function(){return this.Ye},sft.prototype.count=function(){return this.Ve},sft.prototype.getIntersections=function(){return this.qe},sft.prototype.setFindAllIntersections=function(e){this.ke=e},sft.prototype.setKeepIntersections=function(e){this.We=e},sft.prototype.processIntersections=function(e,n,i,o){if(!this.ke&&this.hasIntersection())return null;if(e===i&&n===o)return null;if(this.Re&&!this.isEndSegment(e,n)&&!this.isEndSegment(i,o))return null;var s=e.getCoordinates()[n],a=e.getCoordinates()[n+1],h=i.getCoordinates()[o],l=i.getCoordinates()[o+1];this.Wi.computeIntersection(s,a,h,l),this.Wi.hasIntersection()&&this.Wi.isInteriorIntersection()&&(this.Ye=new Array(4).fill(null),this.Ye[0]=s,this.Ye[1]=a,this.Ye[2]=h,this.Ye[3]=l,this.Ge=this.Wi.getIntersection(0),this.We&&this.qe.add(this.Ge),this.Ve++)},sft.prototype.isEndSegment=function(e,n){return 0===n||n>=e.size()-2},sft.prototype.hasIntersection=function(){return null!==this.Ge},sft.prototype.isDone=function(){return!this.ke&&null!==this.Ge},sft.prototype.interfaces_=function(){return[AAt]},sft.prototype.getClass=function(){return sft},sft.createAllIntersectionsFinder=function(e){var n=new sft(e);return n.setFindAllIntersections(!0),n},sft.createAnyIntersectionFinder=function(e){return new sft(e)},sft.createIntersectionCounter=function(e){var n=new sft(e);return n.setFindAllIntersections(!0),n.setKeepIntersections(!1),n};var aft=function(){this.Wi=new rlt,this.Gr=null,this.ke=!1,this.Mi=null,this.Ue=!0,this.Gr=arguments[0]};aft.prototype.execute=function(){if(null!==this.Mi)return null;this.checkInteriorIntersections()},aft.prototype.getIntersections=function(){return this.Mi.getIntersections()},aft.prototype.isValid=function(){return this.execute(),this.Ue},aft.prototype.setFindAllIntersections=function(e){this.ke=e},aft.prototype.checkInteriorIntersections=function(){this.Ue=!0,this.Mi=new sft(this.Wi),this.Mi.setFindAllIntersections(this.ke);var e=new Hct;if(e.setSegmentIntersector(this.Mi),e.computeNodes(this.Gr),this.Mi.hasIntersection())return this.Ue=!1,null},aft.prototype.checkValid=function(){if(this.execute(),!this.Ue)throw new Zut(this.getErrorMessage(),this.Mi.getInteriorIntersection())},aft.prototype.getErrorMessage=function(){if(this.Ue)return"no intersections found";var e=this.Mi.getIntersectionSegments();return"found non-noded intersection between "+Kht.toLineString(e[0],e[1])+" and "+Kht.toLineString(e[2],e[3])},aft.prototype.interfaces_=function(){return[]},aft.prototype.getClass=function(){return aft},aft.computeIntersections=function(e){var n=new aft(e);return n.setFindAllIntersections(!0),n.isValid(),n.getIntersections()};var hft=function e(){this._e=null,this._e=new aft(e.toSegmentStrings(arguments[0]))};hft.prototype.checkValid=function(){this._e.checkValid()},hft.prototype.interfaces_=function(){return[]},hft.prototype.getClass=function(){return hft},hft.toSegmentStrings=function(e){for(var n=new Plt,i=e.iterator();i.hasNext();){var o=i.next();n.add(new oft(o.getCoordinates(),o))}return n},hft.checkValid=function(e){new hft(e).checkValid()};var lft=function(e){this.Ke=e};lft.prototype.map=function(e){for(var n=new Plt,i=0;i<e.getNumGeometries();i++){var o=this.Ke.map(e.getGeometryN(i));o.isEmpty()||n.add(o)}return e.getFactory().createGeometryCollection(kut.toGeometryArray(n))},lft.prototype.interfaces_=function(){return[]},lft.prototype.getClass=function(){return lft},lft.map=function(e,n){return new lft(n).map(e)};var uft=function(){this.He=null,this.pn=null,this.Ie=null,this.Je=new Plt,this.Ze=new Plt;var e=arguments[1],n=arguments[2];this.He=arguments[0],this.pn=e,this.Ie=n};uft.prototype.collectLines=function(e){for(var n=this,i=this.He.getGraph().getEdgeEnds().iterator();i.hasNext();){var o=i.next();n.collectLineEdge(o,e,n.Je),n.collectBoundaryTouchEdge(o,e,n.Je)}},uft.prototype.labelIsolatedLine=function(e,n){var i=this.Ie.locate(e.getCoordinate(),this.He.getArgGeometry(n));e.getLabel().setLocation(n,i)},uft.prototype.build=function(e){return this.findCoveredLineEdges(),this.collectLines(e),this.buildLines(e),this.Ze},uft.prototype.collectLineEdge=function(e,n,i){var o=e.getLabel(),s=e.getEdge();e.isLineEdge()&&(e.isVisited()||!Vft.isResultOfOp(o,n)||s.isCovered()||(i.add(s),e.setVisitedEdge(!0)))},uft.prototype.findCoveredLineEdges=function(){for(var e=this.He.getGraph().getNodes().iterator();e.hasNext();)e.next().getEdges().findCoveredLineEdges();for(var n=this.He.getGraph().getEdgeEnds().iterator();n.hasNext();){var i=n.next(),o=i.getEdge();if(i.isLineEdge()&&!o.isCoveredSet()){var s=this.He.isCoveredByA(i.getCoordinate());o.setCovered(s)}}},uft.prototype.labelIsolatedLines=function(e){for(var n=e.iterator();n.hasNext();){var i=n.next(),o=i.getLabel();i.isIsolated()&&(o.isNull(0)?this.labelIsolatedLine(i,0):this.labelIsolatedLine(i,1))}},uft.prototype.buildLines=function(e){for(var n=this.Je.iterator();n.hasNext();){var i=n.next(),o=this.pn.createLineString(i.getCoordinates());this.Ze.add(o),i.setInResult(!0)}},uft.prototype.collectBoundaryTouchEdge=function(e,n,i){var o=e.getLabel();return e.isLineEdge()||e.isVisited()||e.isInteriorAreaEdge()||e.getEdge().isInResult()?null:(elt.isTrue(!(e.isInResult()||e.getSym().isInResult())||!e.getEdge().isInResult()),void(Vft.isResultOfOp(o,n)&&n===Vft.INTERSECTION&&(i.add(e.getEdge()),e.setVisitedEdge(!0))))},uft.prototype.interfaces_=function(){return[]},uft.prototype.getClass=function(){return uft};var cft=function(){this.He=null,this.pn=null,this.Xe=new Plt;var e=arguments[1];this.He=arguments[0],this.pn=e};cft.prototype.filterCoveredNodeToPoint=function(e){var n=e.getCoordinate();if(!this.He.isCoveredByLA(n)){var i=this.pn.createPoint(n);this.Xe.add(i)}},cft.prototype.extractNonCoveredResultNodes=function(e){for(var n=this.He.getGraph().getNodes().iterator();n.hasNext();){var i=n.next();if(!(i.isInResult()||i.isIncidentEdgeInResult()||0!==i.getEdges().getDegree()&&e!==Vft.INTERSECTION)){var o=i.getLabel();Vft.isResultOfOp(o,e)&&this.filterCoveredNodeToPoint(i)}}},cft.prototype.build=function(e){return this.extractNonCoveredResultNodes(e),this.Xe},cft.prototype.interfaces_=function(){return[]},cft.prototype.getClass=function(){return cft};var Aft=function(){this.ur=null,this.Zt=null,this.$e=!0,this.As=!0,this.ts=!1,this.ns=!1};Aft.prototype.transformPoint=function(e,n){return this.Zt.createPoint(this.transformCoordinates(e.getCoordinateSequence(),e))},Aft.prototype.transformPolygon=function(e,n){var i=!0,o=this.transformLinearRing(e.getExteriorRing(),e);null!==o&&o instanceof yut&&!o.isEmpty()||(i=!1);for(var s=new Plt,a=0;a<e.getNumInteriorRing();a++){var h=this.transformLinearRing(e.getInteriorRingN(a),e);null===h||h.isEmpty()||(h instanceof yut||(i=!1),s.add(h))}if(i)return this.Zt.createPolygon(o,s.toArray([]));var l=new Plt;return null!==o&&l.add(o),l.addAll(s),this.Zt.buildGeometry(l)},Aft.prototype.createCoordinateSequence=function(e){return this.Zt.getCoordinateSequenceFactory().create(e)},Aft.prototype.getInputGeometry=function(){return this.ur},Aft.prototype.transformMultiLineString=function(e,n){for(var i=new Plt,o=0;o<e.getNumGeometries();o++){var s=this.transformLineString(e.getGeometryN(o),e);null!==s&&(s.isEmpty()||i.add(s))}return this.Zt.buildGeometry(i)},Aft.prototype.transformCoordinates=function(e,n){return this.copy(e)},Aft.prototype.transformLineString=function(e,n){return this.Zt.createLineString(this.transformCoordinates(e.getCoordinateSequence(),e))},Aft.prototype.transformMultiPoint=function(e,n){for(var i=new Plt,o=0;o<e.getNumGeometries();o++){var s=this.transformPoint(e.getGeometryN(o),e);null!==s&&(s.isEmpty()||i.add(s))}return this.Zt.buildGeometry(i)},Aft.prototype.transformMultiPolygon=function(e,n){for(var i=new Plt,o=0;o<e.getNumGeometries();o++){var s=this.transformPolygon(e.getGeometryN(o),e);null!==s&&(s.isEmpty()||i.add(s))}return this.Zt.buildGeometry(i)},Aft.prototype.copy=function(e){return e.copy()},Aft.prototype.transformGeometryCollection=function(e,n){for(var i=new Plt,o=0;o<e.getNumGeometries();o++){var s=this.transform(e.getGeometryN(o));null!==s&&(this.$e&&s.isEmpty()||i.add(s))}return this.As?this.Zt.createGeometryCollection(kut.toGeometryArray(i)):this.Zt.buildGeometry(i)},Aft.prototype.transform=function(e){if(this.ur=e,this.Zt=e.getFactory(),e instanceof dut)return this.transformPoint(e,null);if(e instanceof mut)return this.transformMultiPoint(e,null);if(e instanceof yut)return this.transformLinearRing(e,null);if(e instanceof Aut)return this.transformLineString(e,null);if(e instanceof tut)return this.transformMultiLineString(e,null);if(e instanceof gut)return this.transformPolygon(e,null);if(e instanceof vut)return this.transformMultiPolygon(e,null);if(e instanceof $lt)return this.transformGeometryCollection(e,null);throw new mht("Unknown Geometry subtype: "+e.getClass().getName())},Aft.prototype.transformLinearRing=function(e,n){var i=this.transformCoordinates(e.getCoordinateSequence(),e);if(null===i)return this.Zt.createLinearRing(null);var o=i.size();return o>0&&o<4&&!this.ns?this.Zt.createLineString(i):this.Zt.createLinearRing(i)},Aft.prototype.interfaces_=function(){return[]},Aft.prototype.getClass=function(){return Aft};var fft=function e(){if(this.rs=0,this.es=null,this.ir=new Dct,this.ss=!1,this.us=!1,arguments[0]instanceof Aut&&"number"==typeof arguments[1]){var n=arguments[1];e.call(this,arguments[0].getCoordinates(),n)}else if(arguments[0]instanceof Array&&"number"==typeof arguments[1]){var i=arguments[0],o=arguments[1];this.es=i,this.us=e.isClosed(i),this.rs=o}};fft.prototype.snapVertices=function(e,n){for(var i=this.us?e.size()-1:e.size(),o=0;o<i;o++){var s=e.get(o),a=this.findSnapForVertex(s,n);null!==a&&(e.set(o,new Cht(a)),0===o&&this.us&&e.set(e.size()-1,new Cht(a)))}},fft.prototype.findSnapForVertex=function(e,n){for(var i=0;i<n.length;i++){if(e.equals2D(n[i]))return null;if(e.distance(n[i])<this.rs)return n[i]}return null},fft.prototype.snapTo=function(e){var n=new Tlt(this.es);return this.snapVertices(n,e),this.snapSegments(n,e),n.toCoordinateArray()},fft.prototype.snapSegments=function(e,n){if(0===n.length)return null;var i=n.length;n[0].equals2D(n[n.length-1])&&(i=n.length-1);for(var o=0;o<i;o++){var s=n[o],a=this.findSegmentIndexToSnap(s,e);a>=0&&e.add(a+1,new Cht(s),!1)}},fft.prototype.findSegmentIndexToSnap=function(e,n){for(var i=this,o=yht.MAX_VALUE,s=-1,a=0;a<n.size()-1;a++){if(i.ir.p0=n.get(a),i.ir.p1=n.get(a+1),i.ir.p0.equals2D(e)||i.ir.p1.equals2D(e)){if(i.ss)continue;return-1}var h=i.ir.distance(e);h<i.rs&&h<o&&(o=h,s=a)}return s},fft.prototype.setAllowSnappingToSourceVertices=function(e){this.ss=e},fft.prototype.interfaces_=function(){return[]},fft.prototype.getClass=function(){return fft},fft.isClosed=function(e){return!(e.length<=1)&&e[0].equals2D(e[e.length-1])};var dft=function(e){this.os=e||null},pft={SNAP_PRECISION_FACTOR:{configurable:!0}};dft.prototype.snapTo=function(e,n){var i=this.extractTargetCoordinates(e);return new gft(n,i).transform(this.os)},dft.prototype.snapToSelf=function(e,n){var i=this.extractTargetCoordinates(this.os),o=new gft(e,i,!0).transform(this.os),s=o;return n&&Eht(s,put)&&(s=o.buffer(0)),s},dft.prototype.computeSnapTolerance=function(e){return this.computeMinimumSegmentLength(e)/10},dft.prototype.extractTargetCoordinates=function(e){for(var n=new qlt,i=e.getCoordinates(),o=0;o<i.length;o++)n.add(i[o]);return n.toArray(new Array(0).fill(null))},dft.prototype.computeMinimumSegmentLength=function(e){for(var n=yht.MAX_VALUE,i=0;i<e.length-1;i++){var o=e[i].distance(e[i+1]);o<n&&(n=o)}return n},dft.prototype.interfaces_=function(){return[]},dft.prototype.getClass=function(){return dft},dft.snap=function(e,n,i){var o=new Array(2).fill(null),s=new dft(e);o[0]=s.snapTo(n,i);var a=new dft(n);return o[1]=a.snapTo(o[0],i),o},dft.computeOverlaySnapTolerance=function(){if(1===arguments.length){var e=arguments[0],n=dft.computeSizeBasedSnapTolerance(e),i=e.getPrecisionModel();if(i.getType()===Eut.FIXED){var o=1/i.getScale()*2/1.415;o>n&&(n=o)}return n}if(2===arguments.length){var s=arguments[1];return Math.min(dft.computeOverlaySnapTolerance(arguments[0]),dft.computeOverlaySnapTolerance(s))}},dft.computeSizeBasedSnapTolerance=function(e){var n=e.getEnvelopeInternal();return Math.min(n.getHeight(),n.getWidth())*dft.SNAP_PRECISION_FACTOR},dft.snapToSelf=function(e,n,i){return new dft(e).snapToSelf(n,i)},pft.SNAP_PRECISION_FACTOR.get=function(){return 1e-9},Object.defineProperties(dft,pft);var gft=function(e){function n(n,i,o){e.call(this),this.rs=n||null,this.hs=i||null,this.fs=void 0!==o&&o}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.snapLine=function(e,n){var i=new fft(e,this.rs);return i.setAllowSnappingToSourceVertices(this.fs),i.snapTo(n)},n.prototype.transformCoordinates=function(e,n){var i=e.toCoordinateArray(),o=this.snapLine(i,this.hs);return this.Zt.getCoordinateSequenceFactory().create(o)},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n}(Aft),mft=function(){this.cs=!0,this.vs=53,this.ls=0,this.ws=null};mft.prototype.getCommon=function(){return yht.longBitsToDouble(this.ls)},mft.prototype.add=function(e){var n=yht.doubleToLongBits(e);return this.cs?(this.ls=n,this.ws=mft.signExpBits(this.ls),this.cs=!1,null):mft.signExpBits(n)!==this.ws?(this.ls=0,null):(this.vs=mft.numCommonMostSigMantissaBits(this.ls,n),void(this.ls=mft.zeroLowerBits(this.ls,64-(12+this.vs))))},mft.prototype.toString=function(){if(1===arguments.length){var e=arguments[0],n=yht.longBitsToDouble(e),i="0000000000000000000000000000000000000000000000000000000000000000"+yht.toBinaryString(e),o=i.substring(i.length-64);return o.substring(0,1)+"  "+o.substring(1,12)+"(exp) "+o.substring(12)+" [ "+n+" ]"}},mft.prototype.interfaces_=function(){return[]},mft.prototype.getClass=function(){return mft},mft.getBit=function(e,n){return e&1<<n?1:0},mft.signExpBits=function(e){return e>>52},mft.zeroLowerBits=function(e,n){return e&~((1<<n)-1)},mft.numCommonMostSigMantissaBits=function(e,n){for(var i=0,o=52;o>=0;o--){if(mft.getBit(e,o)!==mft.getBit(n,o))return i;i++}return 52};var yft=function(){this.Ps=null,this.gs=new _ft},vft={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};yft.prototype.addCommonBits=function(e){var n=new xft(this.Ps);e.apply(n),e.geometryChanged()},yft.prototype.removeCommonBits=function(e){if(0===this.Ps.x&&0===this.Ps.y)return e;var n=new Cht(this.Ps);n.x=-n.x,n.y=-n.y;var i=new xft(n);return e.apply(i),e.geometryChanged(),e},yft.prototype.getCommonCoordinate=function(){return this.Ps},yft.prototype.add=function(e){e.apply(this.gs),this.Ps=this.gs.getCommonCoordinate()},yft.prototype.interfaces_=function(){return[]},yft.prototype.getClass=function(){return yft},vft.CommonCoordinateFilter.get=function(){return _ft},vft.Translater.get=function(){return xft},Object.defineProperties(yft,vft);var _ft=function(){this.Cs=new mft,this.Ds=new mft};_ft.prototype.filter=function(e){this.Cs.add(e.x),this.Ds.add(e.y)},_ft.prototype.getCommonCoordinate=function(){return new Cht(this.Cs.getCommon(),this.Ds.getCommon())},_ft.prototype.interfaces_=function(){return[flt]},_ft.prototype.getClass=function(){return _ft};var xft=function(){this.trans=null,this.trans=arguments[0]};xft.prototype.filter=function(e,n){var i=e.getOrdinate(n,0)+this.trans.x,o=e.getOrdinate(n,1)+this.trans.y;e.setOrdinate(n,0,i),e.setOrdinate(n,1,o)},xft.prototype.isDone=function(){return!1},xft.prototype.isGeometryChanged=function(){return!0},xft.prototype.interfaces_=function(){return[Klt]},xft.prototype.getClass=function(){return xft};var bft=function(e,n){this.An=new Array(2).fill(null),this.rs=null,this.Is=null,this.An[0]=e,this.An[1]=n,this.computeSnapTolerance()};bft.prototype.selfSnap=function(e){return new dft(e).snapTo(e,this.rs)},bft.prototype.removeCommonBits=function(e){this.Is=new yft,this.Is.add(e[0]),this.Is.add(e[1]);var n=new Array(2).fill(null);return n[0]=this.Is.removeCommonBits(e[0].copy()),n[1]=this.Is.removeCommonBits(e[1].copy()),n},bft.prototype.prepareResult=function(e){return this.Is.addCommonBits(e),e},bft.prototype.getResultGeometry=function(e){var n=this.snap(this.An),i=Vft.overlayOp(n[0],n[1],e);return this.prepareResult(i)},bft.prototype.checkValid=function(e){e.isValid()||Vht.out.println("Snapped geometry is invalid")},bft.prototype.computeSnapTolerance=function(){this.rs=dft.computeOverlaySnapTolerance(this.An[0],this.An[1])},bft.prototype.snap=function(e){var n=this.removeCommonBits(e);return dft.snap(n[0],n[1],this.rs)},bft.prototype.interfaces_=function(){return[]},bft.prototype.getClass=function(){return bft},bft.overlayOp=function(e,n,i){return new bft(e,n).getResultGeometry(i)},bft.union=function(e,n){return bft.overlayOp(e,n,Vft.UNION)},bft.intersection=function(e,n){return bft.overlayOp(e,n,Vft.INTERSECTION)},bft.symDifference=function(e,n){return bft.overlayOp(e,n,Vft.SYMDIFFERENCE)},bft.difference=function(e,n){return bft.overlayOp(e,n,Vft.DIFFERENCE)};var wft=function(e,n){this.An=new Array(2).fill(null),this.An[0]=e,this.An[1]=n};wft.prototype.getResultGeometry=function(e){var n=null,i=!1,o=null;try{n=Vft.overlayOp(this.An[0],this.An[1],e),i=!0}catch(e){if(!(e instanceof $ht))throw e;o=e}if(!i)try{n=bft.overlayOp(this.An[0],this.An[1],e)}catch(e){throw e instanceof $ht?o:e}return n},wft.prototype.interfaces_=function(){return[]},wft.prototype.getClass=function(){return wft},wft.overlayOp=function(e,n,i){return new wft(e,n).getResultGeometry(i)},wft.union=function(e,n){return wft.overlayOp(e,n,Vft.UNION)},wft.intersection=function(e,n){return wft.overlayOp(e,n,Vft.INTERSECTION)},wft.symDifference=function(e,n){return wft.overlayOp(e,n,Vft.SYMDIFFERENCE)},wft.difference=function(e,n){return wft.overlayOp(e,n,Vft.DIFFERENCE)};var Cft=function(){this.mce=null,this.chainIndex=null;var e=arguments[1];this.mce=arguments[0],this.chainIndex=e};Cft.prototype.computeIntersections=function(e,n){this.mce.computeIntersectsForChain(this.chainIndex,e.mce,e.chainIndex,n)},Cft.prototype.interfaces_=function(){return[]},Cft.prototype.getClass=function(){return Cft};var Pft=function e(){if(this.xn=null,this.bs=null,this.Ms=null,this.zs=null,this.ds=null,this.xs=null,2===arguments.length){var n=arguments[0],i=arguments[1];this.Ms=e.DELETE,this.bs=n,this.zs=i}else if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];this.Ms=e.INSERT,this.xn=o,this.bs=s,this.xs=a}},Mft={INSERT:{configurable:!0},DELETE:{configurable:!0}};Pft.prototype.isDelete=function(){return this.Ms===Pft.DELETE},Pft.prototype.setDeleteEventIndex=function(e){this.ds=e},Pft.prototype.getObject=function(){return this.xs},Pft.prototype.compareTo=function(e){return this.bs<e.bs?-1:this.bs>e.bs?1:this.Ms<e.Ms?-1:this.Ms>e.Ms?1:0},Pft.prototype.getInsertEvent=function(){return this.zs},Pft.prototype.isInsert=function(){return this.Ms===Pft.INSERT},Pft.prototype.isSameLabel=function(e){return null!==this.xn&&this.xn===e.xn},Pft.prototype.getDeleteEventIndex=function(){return this.ds},Pft.prototype.interfaces_=function(){return[_ht]},Pft.prototype.getClass=function(){return Pft},Mft.INSERT.get=function(){return 1},Mft.DELETE.get=function(){return 2},Object.defineProperties(Pft,Mft);var Tft=function(){};Tft.prototype.interfaces_=function(){return[]},Tft.prototype.getClass=function(){return Tft};var Sft=function(){this.dr=!1,this.mr=!1,this.yr=!1,this.Lr=null,this.Wi=null,this.ys=null,this.ps=null,this.Tr=null,this.Ls=0,this.numTests=0,this.Ts=null,this.Os=!1,this.Fs=!1;var e=arguments[1],n=arguments[2];this.Wi=arguments[0],this.ys=e,this.ps=n};Sft.prototype.isTrivialIntersection=function(e,n,i,o){if(e===i&&1===this.Wi.getIntersectionNum()){if(Sft.isAdjacentSegments(n,o))return!0;if(e.isClosed()){var s=e.getNumPoints()-1;if(0===n&&o===s||0===o&&n===s)return!0}}return!1},Sft.prototype.getProperIntersectionPoint=function(){return this.Lr},Sft.prototype.setIsDoneIfProperInt=function(e){this.Fs=e},Sft.prototype.hasProperInteriorIntersection=function(){return this.yr},Sft.prototype.isBoundaryPointInternal=function(e,n){for(var i=n.iterator();i.hasNext();){var o=i.next().getCoordinate();if(e.isIntersection(o))return!0}return!1},Sft.prototype.hasProperIntersection=function(){return this.mr},Sft.prototype.hasIntersection=function(){return this.dr},Sft.prototype.isDone=function(){return this.Os},Sft.prototype.isBoundaryPoint=function(e,n){return!(null===n||!this.isBoundaryPointInternal(e,n[0])&&!this.isBoundaryPointInternal(e,n[1]))},Sft.prototype.setBoundaryNodes=function(e,n){this.Ts=new Array(2).fill(null),this.Ts[0]=e,this.Ts[1]=n},Sft.prototype.addIntersections=function(e,n,i,o){if(e===i&&n===o)return null;this.numTests++;var s=e.getCoordinates()[n],a=e.getCoordinates()[n+1],h=i.getCoordinates()[o],l=i.getCoordinates()[o+1];this.Wi.computeIntersection(s,a,h,l),this.Wi.hasIntersection()&&(this.ps&&(e.setIsolated(!1),i.setIsolated(!1)),this.Ls++,this.isTrivialIntersection(e,n,i,o)||(this.dr=!0,!this.ys&&this.Wi.isProper()||(e.addIntersections(this.Wi,n,0),i.addIntersections(this.Wi,o,1)),this.Wi.isProper()&&(this.Lr=this.Wi.getIntersection(0).copy(),this.mr=!0,this.Fs&&(this.Os=!0),this.isBoundaryPoint(this.Wi,this.Ts)||(this.yr=!0))))},Sft.prototype.interfaces_=function(){return[]},Sft.prototype.getClass=function(){return Sft},Sft.isAdjacentSegments=function(e,n){return 1===Math.abs(e-n)};var Ift=function(e){function n(){e.call(this),this.events=new Plt,this.nOverlaps=null}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.prepareEvents=function(){yct.sort(this.events);for(var e=0;e<this.events.size();e++){var n=this.events.get(e);n.isDelete()&&n.getInsertEvent().setDeleteEventIndex(e)}},n.prototype.computeIntersections=function(){if(1===arguments.length){var e=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var n=0;n<this.events.size();n++){var i=this.events.get(n);if(i.isInsert()&&this.processOverlaps(n,i.getDeleteEventIndex(),i,e),e.isDone())break}}else if(3===arguments.length)if(arguments[2]instanceof Sft&&Eht(arguments[0],wlt)&&Eht(arguments[1],wlt)){var o=arguments[0],s=arguments[1],a=arguments[2];this.addEdges(o,o),this.addEdges(s,s),this.computeIntersections(a)}else if("boolean"==typeof arguments[2]&&Eht(arguments[0],wlt)&&arguments[1]instanceof Sft){var h=arguments[0],l=arguments[1];arguments[2]?this.addEdges(h,null):this.addEdges(h),this.computeIntersections(l)}},n.prototype.addEdge=function(e,n){for(var i=e.getMonotoneChainEdge(),o=i.getStartIndexes(),s=0;s<o.length-1;s++){var a=new Cft(i,s),h=new Pft(n,i.getMinX(s),a);this.events.add(h),this.events.add(new Pft(i.getMaxX(s),h))}},n.prototype.processOverlaps=function(e,n,i,o){for(var s=i.getObject(),a=e;a<n;a++){var h=this.events.get(a);if(h.isInsert()){var l=h.getObject();i.isSameLabel(h)||(s.computeIntersections(l,o),this.nOverlaps++)}}},n.prototype.addEdges=function(){if(1===arguments.length)for(var e=arguments[0].iterator();e.hasNext();){var n=e.next();this.addEdge(n,n)}else if(2===arguments.length)for(var i=arguments[1],o=arguments[0].iterator();o.hasNext();){var s=o.next();this.addEdge(s,i)}},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n}(Tft),Eft=function(){this.Us=yht.POSITIVE_INFINITY,this.lr=yht.NEGATIVE_INFINITY},Oft={NodeComparator:{configurable:!0}};Eft.prototype.getMin=function(){return this.Us},Eft.prototype.intersects=function(e,n){return!(this.Us>n||this.lr<e)},Eft.prototype.getMax=function(){return this.lr},Eft.prototype.toString=function(){return Kht.toLineString(new Cht(this.Us,0),new Cht(this.lr,0))},Eft.prototype.interfaces_=function(){return[]},Eft.prototype.getClass=function(){return Eft},Oft.NodeComparator.get=function(){return Rft},Object.defineProperties(Eft,Oft);var Rft=function(){};Rft.prototype.compare=function(e,n){var i=(e.Us+e.lr)/2,o=(n.Us+n.lr)/2;return i<o?-1:i>o?1:0},Rft.prototype.interfaces_=function(){return[bht]},Rft.prototype.getClass=function(){return Rft};var Dft=function(e){function n(){e.call(this),this.Zn=null;var n=arguments[1],i=arguments[2];this.Us=arguments[0],this.lr=n,this.Zn=i}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.query=function(e,n,i){if(!this.intersects(e,n))return null;i.visitItem(this.Zn)},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n}(Eft),kft=function(e){function n(){e.call(this),this.Es=null,this.Ns=null;var n=arguments[1];this.Es=arguments[0],this.Ns=n,this.buildExtent(this.Es,this.Ns)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.buildExtent=function(e,n){this.Us=Math.min(e.Us,n.Us),this.lr=Math.max(e.lr,n.lr)},n.prototype.query=function(e,n,i){if(!this.intersects(e,n))return null;null!==this.Es&&this.Es.query(e,n,i),null!==this.Ns&&this.Ns.query(e,n,i)},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n}(Eft),Lft=function(){this.js=new Plt,this.si=null,this.ti=0};Lft.prototype.buildTree=function(){yct.sort(this.js,new Eft.NodeComparator);for(var e=this.js,n=null,i=new Plt;;){if(this.buildLevel(e,i),1===i.size())return i.get(0);n=e,e=i,i=n}},Lft.prototype.insert=function(e,n,i){if(null!==this.si)throw new Error("Index cannot be added to once it has been queried");this.js.add(new Dft(e,n,i))},Lft.prototype.query=function(e,n,i){this.init(),this.si.query(e,n,i)},Lft.prototype.buildRoot=function(){if(null!==this.si)return null;this.si=this.buildTree()},Lft.prototype.printNode=function(e){Vht.out.println(Kht.toLineString(new Cht(e.Us,this.ti),new Cht(e.lr,this.ti)))},Lft.prototype.init=function(){if(null!==this.si)return null;this.buildRoot()},Lft.prototype.buildLevel=function(e,n){this.ti++,n.clear();for(var i=0;i<e.size();i+=2){var o=e.get(i);if(null===(i+1<e.size()?e.get(i):null))n.add(o);else{var s=new kft(e.get(i),e.get(i+1));n.add(s)}}},Lft.prototype.interfaces_=function(){return[]},Lft.prototype.getClass=function(){return Lft};var Fft=function(){this.$n=new Plt};Fft.prototype.visitItem=function(e){this.$n.add(e)},Fft.prototype.getItems=function(){return this.$n},Fft.prototype.interfaces_=function(){return[dct]},Fft.prototype.getClass=function(){return Fft};var Nft=function(){this.di=null;var e=arguments[0];if(!Eht(e,put))throw new mht("Argument must be Polygonal");this.di=new Hft(e)},zft={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};Nft.prototype.locate=function(e){var n=new slt(e),i=new Bft(n);return this.di.query(e.y,e.y,i),n.getLocation()},Nft.prototype.interfaces_=function(){return[rAt]},Nft.prototype.getClass=function(){return Nft},zft.SegmentVisitor.get=function(){return Bft},zft.IntervalIndexedGeometry.get=function(){return Hft},Object.defineProperties(Nft,zft);var Bft=function(){this.Qs=null,this.Qs=arguments[0]};Bft.prototype.visitItem=function(e){var n=e;this.Qs.countSegment(n.getCoordinate(0),n.getCoordinate(1))},Bft.prototype.interfaces_=function(){return[dct]},Bft.prototype.getClass=function(){return Bft};var Hft=function(){this.di=new Lft,this.init(arguments[0])};Hft.prototype.init=function(e){for(var n=UAt.getLines(e).iterator();n.hasNext();){var i=n.next().getCoordinates();this.addLine(i)}},Hft.prototype.addLine=function(e){for(var n=1;n<e.length;n++){var i=new Dct(e[n-1],e[n]),o=Math.min(i.p0.y,i.p1.y),s=Math.max(i.p0.y,i.p1.y);this.di.insert(o,s,i)}},Hft.prototype.query=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1],i=new Fft;return this.di.query(e,n,i),i.getItems()}3===arguments.length&&this.di.query(arguments[0],arguments[1],arguments[2])},Hft.prototype.interfaces_=function(){return[]},Hft.prototype.getClass=function(){return Hft};var jft=function(e){function n(){if(e.call(this),this.Ss=null,this.Bs=new Iut,this.ks=null,this.Rs=!0,this.Gs=null,this.Ys=null,this.qs=!1,this.Vs=null,this.Ws=null,this.Ie=new GAt,2===arguments.length){var n=arguments[1],i=dlt.OGC_SFS_BOUNDARY_RULE;this.Gs=arguments[0],this.Ss=n,this.ks=i,null!==n&&this.add(n)}else if(3===arguments.length){var o=arguments[1],s=arguments[2];this.Gs=arguments[0],this.Ss=o,this.ks=s,null!==o&&this.add(o)}}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.insertBoundaryPoint=function(e,i){var o=this.Cn.addNode(i).getLabel(),s=1;o.getLocation(e,Uut.ON)===Sht.BOUNDARY&&s++;var a=n.determineBoundary(this.ks,s);o.setLocation(e,a)},n.prototype.computeSelfNodes=function(){if(2===arguments.length)return this.computeSelfNodes(arguments[0],arguments[1],!1);if(3===arguments.length){var e=arguments[1],n=arguments[2],i=new Sft(arguments[0],!0,!1);return i.setIsDoneIfProperInt(n),this.createEdgeSetIntersector().computeIntersections(this.zn,i,e||!(this.Ss instanceof yut||this.Ss instanceof gut||this.Ss instanceof vut)),this.addSelfIntersectionNodes(this.Gs),i}},n.prototype.computeSplitEdges=function(e){for(var n=this.zn.iterator();n.hasNext();)n.next().eiList.addSplitEdges(e)},n.prototype.computeEdgeIntersections=function(e,n,i){var o=new Sft(n,i,!0);return o.setBoundaryNodes(this.getBoundaryNodes(),e.getBoundaryNodes()),this.createEdgeSetIntersector().computeIntersections(this.zn,e.zn,o),o},n.prototype.getGeometry=function(){return this.Ss},n.prototype.getBoundaryNodeRule=function(){return this.ks},n.prototype.hasTooFewPoints=function(){return this.qs},n.prototype.addPoint=function(){if(arguments[0]instanceof dut){var e=arguments[0].getCoordinate();this.insertPoint(this.Gs,e,Sht.INTERIOR)}else if(arguments[0]instanceof Cht){this.insertPoint(this.Gs,arguments[0],Sht.INTERIOR)}},n.prototype.addPolygon=function(e){this.addPolygonRing(e.getExteriorRing(),Sht.EXTERIOR,Sht.INTERIOR);for(var n=0;n<e.getNumInteriorRing();n++){var i=e.getInteriorRingN(n);this.addPolygonRing(i,Sht.INTERIOR,Sht.EXTERIOR)}},n.prototype.addEdge=function(e){this.insertEdge(e);var n=e.getCoordinates();this.insertPoint(this.Gs,n[0],Sht.BOUNDARY),this.insertPoint(this.Gs,n[n.length-1],Sht.BOUNDARY)},n.prototype.addLineString=function(e){var n=Slt.removeRepeatedPoints(e.getCoordinates());if(n.length<2)return this.qs=!0,this.Vs=n[0],null;var i=new _At(n,new Jut(this.Gs,Sht.INTERIOR));this.Bs.put(e,i),this.insertEdge(i),elt.isTrue(n.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this.Gs,n[0]),this.insertBoundaryPoint(this.Gs,n[n.length-1])},n.prototype.getInvalidPoint=function(){return this.Vs},n.prototype.getBoundaryPoints=function(){for(var e=this.getBoundaryNodes(),n=new Array(e.size()).fill(null),i=0,o=e.iterator();o.hasNext();){var s=o.next();n[i++]=s.getCoordinate().copy()}return n},n.prototype.getBoundaryNodes=function(){return null===this.Ys&&(this.Ys=this.Cn.getBoundaryNodes(this.Gs)),this.Ys},n.prototype.addSelfIntersectionNode=function(e,n,i){if(this.isBoundaryNode(e,n))return null;i===Sht.BOUNDARY&&this.Rs?this.insertBoundaryPoint(e,n):this.insertPoint(e,n,i)},n.prototype.addPolygonRing=function(e,n,i){if(e.isEmpty())return null;var o=Slt.removeRepeatedPoints(e.getCoordinates());if(o.length<4)return this.qs=!0,this.Vs=o[0],null;var s=n,a=i;alt.isCCW(o)&&(s=i,a=n);var h=new _At(o,new Jut(this.Gs,Sht.BOUNDARY,s,a));this.Bs.put(e,h),this.insertEdge(h),this.insertPoint(this.Gs,o[0],Sht.BOUNDARY)},n.prototype.insertPoint=function(e,n,i){var o=this.Cn.addNode(n),s=o.getLabel();null===s?o.xn=new Jut(e,i):s.setLocation(e,i)},n.prototype.createEdgeSetIntersector=function(){return new Ift},n.prototype.addSelfIntersectionNodes=function(e){for(var n=this.zn.iterator();n.hasNext();)for(var i=n.next(),o=i.getLabel().getLocation(e),s=i.eiList.iterator();s.hasNext();){var a=s.next();this.addSelfIntersectionNode(e,a.coord,o)}},n.prototype.add=function(){if(1!==arguments.length)return e.prototype.add.apply(this,arguments);var n=arguments[0];if(n.isEmpty())return null;if(n instanceof vut&&(this.Rs=!1),n instanceof gut)this.addPolygon(n);else if(n instanceof Aut)this.addLineString(n);else if(n instanceof dut)this.addPoint(n);else if(n instanceof mut)this.addCollection(n);else if(n instanceof tut)this.addCollection(n);else if(n instanceof vut)this.addCollection(n);else{if(!(n instanceof $lt))throw new Error(n.getClass().getName());this.addCollection(n)}},n.prototype.addCollection=function(e){for(var n=0;n<e.getNumGeometries();n++){var i=e.getGeometryN(n);this.add(i)}},n.prototype.locate=function(e){return Eht(this.Ss,put)&&this.Ss.getNumGeometries()>50?(null===this.Ws&&(this.Ws=new Nft(this.Ss)),this.Ws.locate(e)):this.Ie.locate(e,this.Ss)},n.prototype.findEdge=function(){return 1===arguments.length?this.Bs.get(arguments[0]):e.prototype.findEdge.apply(this,arguments)},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n.determineBoundary=function(e,n){return e.isInBoundary(n)?Sht.BOUNDARY:Sht.INTERIOR},n}(lct),Uft=function(){if(this.Wi=new rlt,this._s=null,this.Ks=null,1===arguments.length){var e=arguments[0];this.setComputationPrecision(e.getPrecisionModel()),this.Ks=new Array(1).fill(null),this.Ks[0]=new jft(0,e)}else if(2===arguments.length){var n=arguments[0],i=arguments[1],o=dlt.OGC_SFS_BOUNDARY_RULE;n.getPrecisionModel().compareTo(i.getPrecisionModel())>=0?this.setComputationPrecision(n.getPrecisionModel()):this.setComputationPrecision(i.getPrecisionModel()),this.Ks=new Array(2).fill(null),this.Ks[0]=new jft(0,n,o),this.Ks[1]=new jft(1,i,o)}else if(3===arguments.length){var s=arguments[0],a=arguments[1],h=arguments[2];s.getPrecisionModel().compareTo(a.getPrecisionModel())>=0?this.setComputationPrecision(s.getPrecisionModel()):this.setComputationPrecision(a.getPrecisionModel()),this.Ks=new Array(2).fill(null),this.Ks[0]=new jft(0,s,h),this.Ks[1]=new jft(1,a,h)}};Uft.prototype.getArgGeometry=function(e){return this.Ks[e].getGeometry()},Uft.prototype.setComputationPrecision=function(e){this._s=e,this.Wi.setPrecisionModel(this._s)},Uft.prototype.interfaces_=function(){return[]},Uft.prototype.getClass=function(){return Uft};var Gft=function(){};Gft.prototype.interfaces_=function(){return[]},Gft.prototype.getClass=function(){return Gft},Gft.map=function(){if(arguments[0]instanceof ult&&Eht(arguments[1],Gft.MapOp)){for(var e=arguments[0],n=arguments[1],i=new Plt,o=0;o<e.getNumGeometries();o++){var s=n.map(e.getGeometryN(o));null!==s&&i.add(s)}return e.getFactory().buildGeometry(i)}if(Eht(arguments[0],_lt)&&Eht(arguments[1],Gft.MapOp)){for(var a=arguments[0],h=arguments[1],l=new Plt,c=a.iterator();c.hasNext();){var A=c.next(),f=h.map(A);null!==f&&l.add(f)}return l}},Gft.MapOp=function(){};var Vft=function(e){function n(){var n=arguments[0];e.call(this,n,arguments[1]),this.Ie=new GAt,this.tn=null,this.Hs=null,this.jr=null,this.gr=new cAt,this.Js=new Plt,this.Ze=new Plt,this.Xe=new Plt,this.jr=new lct(new lAt),this.tn=n.getFactory()}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.insertUniqueEdge=function(e){var n=this.gr.findEqualEdge(e);if(null!==n){var i=n.getLabel(),o=e.getLabel();n.isPointwiseEqual(e)||(o=new Jut(e.getLabel())).flip();var s=n.getDepth();s.isNull()&&s.add(i),s.add(o),i.merge(o)}else this.gr.add(e)},n.prototype.getGraph=function(){return this.jr},n.prototype.cancelDuplicateResultEdges=function(){for(var e=this.jr.getEdgeEnds().iterator();e.hasNext();){var n=e.next(),i=n.getSym();n.isInResult()&&i.isInResult()&&(n.setInResult(!1),i.setInResult(!1))}},n.prototype.isCoveredByLA=function(e){return!!this.isCovered(e,this.Ze)||!!this.isCovered(e,this.Js)},n.prototype.computeGeometry=function(e,i,o,s){var a=new Plt;return a.addAll(e),a.addAll(i),a.addAll(o),a.isEmpty()?n.createEmptyResult(s,this.Ks[0].getGeometry(),this.Ks[1].getGeometry(),this.tn):this.tn.buildGeometry(a)},n.prototype.mergeSymLabels=function(){for(var e=this.jr.getNodes().iterator();e.hasNext();)e.next().getEdges().mergeSymLabels()},n.prototype.isCovered=function(e,n){for(var i=n.iterator();i.hasNext();){var o=i.next();if(this.Ie.locate(e,o)!==Sht.EXTERIOR)return!0}return!1},n.prototype.replaceCollapsedEdges=function(){for(var e=new Plt,n=this.gr.iterator();n.hasNext();){var i=n.next();i.isCollapsed()&&(n.remove(),e.add(i.getCollapsedEdge()))}this.gr.addAll(e)},n.prototype.updateNodeLabelling=function(){for(var e=this.jr.getNodes().iterator();e.hasNext();){var n=e.next(),i=n.getEdges().getLabel();n.getLabel().merge(i)}},n.prototype.getResultGeometry=function(e){return this.computeOverlay(e),this.Hs},n.prototype.insertUniqueEdges=function(e){for(var n=e.iterator();n.hasNext();){var i=n.next();this.insertUniqueEdge(i)}},n.prototype.computeOverlay=function(e){this.copyPoints(0),this.copyPoints(1),this.Ks[0].computeSelfNodes(this.Wi,!1),this.Ks[1].computeSelfNodes(this.Wi,!1),this.Ks[0].computeEdgeIntersections(this.Ks[1],this.Wi,!0);var n=new Plt;this.Ks[0].computeSplitEdges(n),this.Ks[1].computeSplitEdges(n),this.insertUniqueEdges(n),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),hft.checkValid(this.gr.getEdges()),this.jr.addEdges(this.gr.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(e),this.cancelDuplicateResultEdges();var i=new uct(this.tn);i.add(this.jr),this.Js=i.getPolygons();var o=new uft(this,this.tn,this.Ie);this.Ze=o.build(e);var s=new cft(this,this.tn,this.Ie);this.Xe=s.build(e),this.Hs=this.computeGeometry(this.Xe,this.Ze,this.Js,e)},n.prototype.labelIncompleteNode=function(e,n){var i=this.Ie.locate(e.getCoordinate(),this.Ks[n].getGeometry());e.getLabel().setLocation(n,i)},n.prototype.copyPoints=function(e){for(var n=this.Ks[e].getNodeIterator();n.hasNext();){var i=n.next();this.jr.addNode(i.getCoordinate()).setLabel(e,i.getLabel().getLocation(e))}},n.prototype.findResultAreaEdges=function(e){for(var i=this.jr.getEdgeEnds().iterator();i.hasNext();){var o=i.next(),s=o.getLabel();s.isArea()&&!o.isInteriorAreaEdge()&&n.isResultOfOp(s.getLocation(0,Uut.RIGHT),s.getLocation(1,Uut.RIGHT),e)&&o.setInResult(!0)}},n.prototype.computeLabelsFromDepths=function(){for(var e=this.gr.iterator();e.hasNext();){var n=e.next(),i=n.getLabel(),o=n.getDepth();if(!o.isNull()){o.normalize();for(var s=0;s<2;s++)i.isNull(s)||!i.isArea()||o.isNull(s)||(0===o.getDelta(s)?i.toLine(s):(elt.isTrue(!o.isNull(s,Uut.LEFT),"depth of LEFT side has not been initialized"),i.setLocation(s,Uut.LEFT,o.getLocation(s,Uut.LEFT)),elt.isTrue(!o.isNull(s,Uut.RIGHT),"depth of RIGHT side has not been initialized"),i.setLocation(s,Uut.RIGHT,o.getLocation(s,Uut.RIGHT))))}}},n.prototype.computeLabelling=function(){for(var e=this.jr.getNodes().iterator();e.hasNext();)e.next().getEdges().computeLabelling(this.Ks);this.mergeSymLabels(),this.updateNodeLabelling()},n.prototype.labelIncompleteNodes=function(){for(var e=this.jr.getNodes().iterator();e.hasNext();){var n=e.next(),i=n.getLabel();n.isIsolated()&&(i.isNull(0)?this.labelIncompleteNode(n,0):this.labelIncompleteNode(n,1)),n.getEdges().updateLabelling(i)}},n.prototype.isCoveredByA=function(e){return!!this.isCovered(e,this.Js)},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n}(Uft);Vft.overlayOp=function(e,n,i){return new Vft(e,n).getResultGeometry(i)},Vft.intersection=function(e,n){if(e.isEmpty()||n.isEmpty())return Vft.createEmptyResult(Vft.INTERSECTION,e,n,e.getFactory());if(e.isGeometryCollection()){var i=n;return lft.map(e,{interfaces_:function(){return[Gft.MapOp]},map:function(e){return e.intersection(i)}})}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(n),wft.overlayOp(e,n,Vft.INTERSECTION)},Vft.symDifference=function(e,n){if(e.isEmpty()||n.isEmpty()){if(e.isEmpty()&&n.isEmpty())return Vft.createEmptyResult(Vft.SYMDIFFERENCE,e,n,e.getFactory());if(e.isEmpty())return n.copy();if(n.isEmpty())return e.copy()}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(n),wft.overlayOp(e,n,Vft.SYMDIFFERENCE)},Vft.resultDimension=function(e,n,i){var o=n.getDimension(),s=i.getDimension(),a=-1;switch(e){case Vft.INTERSECTION:a=Math.min(o,s);break;case Vft.UNION:a=Math.max(o,s);break;case Vft.DIFFERENCE:a=o;break;case Vft.SYMDIFFERENCE:a=Math.max(o,s)}return a},Vft.createEmptyResult=function(e,n,i,o){var s=null;switch(Vft.resultDimension(e,n,i)){case-1:s=o.createGeometryCollection(new Array(0).fill(null));break;case 0:s=o.createPoint();break;case 1:s=o.createLineString();break;case 2:s=o.createPolygon()}return s},Vft.difference=function(e,n){return e.isEmpty()?Vft.createEmptyResult(Vft.DIFFERENCE,e,n,e.getFactory()):n.isEmpty()?e.copy():(e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(n),wft.overlayOp(e,n,Vft.DIFFERENCE))},Vft.isResultOfOp=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1],i=e.getLocation(0),o=e.getLocation(1);return Vft.isResultOfOp(i,o,n)}if(3===arguments.length){var s=arguments[0],a=arguments[1];switch(s===Sht.BOUNDARY&&(s=Sht.INTERIOR),a===Sht.BOUNDARY&&(a=Sht.INTERIOR),arguments[2]){case Vft.INTERSECTION:return s===Sht.INTERIOR&&a===Sht.INTERIOR;case Vft.UNION:return s===Sht.INTERIOR||a===Sht.INTERIOR;case Vft.DIFFERENCE:return s===Sht.INTERIOR&&a!==Sht.INTERIOR;case Vft.SYMDIFFERENCE:return s===Sht.INTERIOR&&a!==Sht.INTERIOR||s!==Sht.INTERIOR&&a===Sht.INTERIOR}return!1}},Vft.INTERSECTION=1,Vft.UNION=2,Vft.DIFFERENCE=3,Vft.SYMDIFFERENCE=4;var Wft=function(){this.Zs=null,this.Xs=null,this.$s=null,this.Ie=new GAt,this.ir=new Dct;var e=arguments[0],n=arguments[1];this.Zs=e,this.Xs=n,this.$s=this.extractLinework(e)};Wft.prototype.isWithinToleranceOfBoundary=function(e){for(var n=this,i=0;i<this.$s.getNumGeometries();i++)for(var o=n.$s.getGeometryN(i).getCoordinateSequence(),s=0;s<o.size()-1;s++)if(o.getCoordinate(s,n.ir.p0),o.getCoordinate(s+1,n.ir.p1),n.ir.distance(e)<=n.Xs)return!0;return!1},Wft.prototype.getLocation=function(e){return this.isWithinToleranceOfBoundary(e)?Sht.BOUNDARY:this.Ie.locate(e,this.Zs)},Wft.prototype.extractLinework=function(e){var n=new qft;e.apply(n);var i=n.getLinework(),o=kut.toLineStringArray(i);return e.getFactory().createMultiLineString(o)},Wft.prototype.interfaces_=function(){return[]},Wft.prototype.getClass=function(){return Wft};var qft=function(){this.$s=null,this.$s=new Plt};qft.prototype.getLinework=function(){return this.$s},qft.prototype.filter=function(e){if(e instanceof gut){var n=e;this.$s.add(n.getExteriorRing());for(var i=0;i<n.getNumInteriorRing();i++)this.$s.add(n.getInteriorRingN(i))}},qft.prototype.interfaces_=function(){return[Jlt]},qft.prototype.getClass=function(){return qft};var Zft=function(){this.Zs=null,this.Au=!0,this.tu=!0,this.Zs=arguments[0]};Zft.prototype.extractPoints=function(e,n,i){for(var o=e.getCoordinates(),s=0;s<o.length-1;s++)this.computeOffsetPoints(o[s],o[s+1],n,i)},Zft.prototype.setSidesToGenerate=function(e,n){this.Au=e,this.tu=n},Zft.prototype.getPoints=function(e){for(var n=new Plt,i=UAt.getLines(this.Zs).iterator();i.hasNext();){var o=i.next();this.extractPoints(o,e,n)}return n},Zft.prototype.computeOffsetPoints=function(e,n,i,o){var s=n.x-e.x,a=n.y-e.y,h=Math.sqrt(s*s+a*a),l=i*s/h,c=i*a/h,A=(n.x+e.x)/2,f=(n.y+e.y)/2;if(this.Au){var d=new Cht(A-c,f+l);o.add(d)}if(this.tu){var p=new Cht(A+c,f-l);o.add(p)}},Zft.prototype.interfaces_=function(){return[]},Zft.prototype.getClass=function(){return Zft};var Qft=function e(){this.An=null,this.nu=null,this.iu=new Array(3).fill(null),this.ru=null,this.Xs=e.TOLERANCE,this.eu=new Plt;var n=arguments[0],i=arguments[1],o=arguments[2];this.Xs=e.computeBoundaryDistanceTolerance(n,i),this.An=[n,i,o],this.nu=[new Wft(this.An[0],this.Xs),new Wft(this.An[1],this.Xs),new Wft(this.An[2],this.Xs)]},Xft={TOLERANCE:{configurable:!0}};Qft.prototype.reportResult=function(e,n,i){Vht.out.println("Overlay result invalid - A:"+Sht.toLocationSymbol(n[0])+" B:"+Sht.toLocationSymbol(n[1])+" expected:"+(i?"i":"e")+" actual:"+Sht.toLocationSymbol(n[2]))},Qft.prototype.isValid=function(e){return this.addTestPts(this.An[0]),this.addTestPts(this.An[1]),this.checkValid(e)},Qft.prototype.checkValid=function(){var e=this;if(1===arguments.length){for(var n=arguments[0],i=0;i<this.eu.size();i++){var o=e.eu.get(i);if(!e.checkValid(n,o))return e.ru=o,!1}return!0}if(2===arguments.length){var s=arguments[0],a=arguments[1];return this.iu[0]=this.nu[0].getLocation(a),this.iu[1]=this.nu[1].getLocation(a),this.iu[2]=this.nu[2].getLocation(a),!!Qft.hasLocation(this.iu,Sht.BOUNDARY)||this.isValidResult(s,this.iu)}},Qft.prototype.addTestPts=function(e){var n=new Zft(e);this.eu.addAll(n.getPoints(5*this.Xs))},Qft.prototype.isValidResult=function(e,n){var i=Vft.isResultOfOp(n[0],n[1],e),o=!(i^n[2]===Sht.INTERIOR);return o||this.reportResult(e,n,i),o},Qft.prototype.getInvalidLocation=function(){return this.ru},Qft.prototype.interfaces_=function(){return[]},Qft.prototype.getClass=function(){return Qft},Qft.hasLocation=function(e,n){for(var i=0;i<3;i++)if(e[i]===n)return!0;return!1},Qft.computeBoundaryDistanceTolerance=function(e,n){return Math.min(dft.computeSizeBasedSnapTolerance(e),dft.computeSizeBasedSnapTolerance(n))},Qft.isValid=function(e,n,i,o){return new Qft(e,n,o).isValid(i)},Xft.TOLERANCE.get=function(){return 1e-6},Object.defineProperties(Qft,Xft);var Yft=function e(n){this.su=null,this.uu=!1,this.ou=null,this.su=e.extractFactory(n),this.ou=n};Yft.prototype.extractElements=function(e,n){if(null===e)return null;for(var i=0;i<e.getNumGeometries();i++){var o=e.getGeometryN(i);this.uu&&o.isEmpty()||n.add(o)}},Yft.prototype.combine=function(){for(var e=new Plt,n=this.ou.iterator();n.hasNext();){var i=n.next();this.extractElements(i,e)}return 0===e.size()?null!==this.su?this.su.createGeometryCollection(null):null:this.su.buildGeometry(e)},Yft.prototype.interfaces_=function(){return[]},Yft.prototype.getClass=function(){return Yft},Yft.combine=function(){return 1===arguments.length?new Yft(arguments[0]).combine():2===arguments.length?new Yft(Yft.createList(arguments[0],arguments[1])).combine():3===arguments.length?new Yft(Yft.createList(arguments[0],arguments[1],arguments[2])).combine():void 0},Yft.extractFactory=function(e){return e.isEmpty()?null:e.iterator().next().getFactory()},Yft.createList=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1],i=new Plt;return i.add(e),i.add(n),i}if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2],h=new Plt;return h.add(o),h.add(s),h.add(a),h}};var Jft=function(){this.hu=null,this.su=null,this.hu=arguments[0],null===this.hu&&(this.hu=new Plt)},Kft={STRTREE_NODE_CAPACITY:{configurable:!0}};Jft.prototype.reduceToGeometries=function(e){for(var n=new Plt,i=e.iterator();i.hasNext();){var o=i.next(),s=null;Eht(o,wlt)?s=this.unionTree(o):o instanceof ult&&(s=o),n.add(s)}return n},Jft.prototype.extractByEnvelope=function(e,n,i){for(var o=new Plt,s=0;s<n.getNumGeometries();s++){var a=n.getGeometryN(s);a.getEnvelopeInternal().intersects(e)?o.add(a):i.add(a)}return this.su.buildGeometry(o)},Jft.prototype.unionOptimized=function(e,n){var i=e.getEnvelopeInternal(),o=n.getEnvelopeInternal();if(!i.intersects(o))return Yft.combine(e,n);if(e.getNumGeometries()<=1&&n.getNumGeometries()<=1)return this.unionActual(e,n);var s=i.intersection(o);return this.unionUsingEnvelopeIntersection(e,n,s)},Jft.prototype.union=function(){if(null===this.hu)throw new Error("union() method cannot be called twice");if(this.hu.isEmpty())return null;this.su=this.hu.iterator().next().getFactory();for(var e=new Cct(Jft.STRTREE_NODE_CAPACITY),n=this.hu.iterator();n.hasNext();){var i=n.next();e.insert(i.getEnvelopeInternal(),i)}this.hu=null;var o=e.itemsTree();return this.unionTree(o)},Jft.prototype.binaryUnion=function(){if(1===arguments.length){var e=arguments[0];return this.binaryUnion(e,0,e.size())}if(3===arguments.length){var n=arguments[0],i=arguments[1],o=arguments[2];if(o-i<=1){var s=Jft.getGeometry(n,i);return this.unionSafe(s,null)}if(o-i==2)return this.unionSafe(Jft.getGeometry(n,i),Jft.getGeometry(n,i+1));var a=Math.trunc((o+i)/2),h=this.binaryUnion(n,i,a),l=this.binaryUnion(n,a,o);return this.unionSafe(h,l)}},Jft.prototype.repeatedUnion=function(e){for(var n=null,i=e.iterator();i.hasNext();){var o=i.next();n=null===n?o.copy():n.union(o)}return n},Jft.prototype.unionSafe=function(e,n){return null===e&&null===n?null:null===e?n.copy():null===n?e.copy():this.unionOptimized(e,n)},Jft.prototype.unionActual=function(e,n){return Jft.restrictToPolygons(e.union(n))},Jft.prototype.unionTree=function(e){var n=this.reduceToGeometries(e);return this.binaryUnion(n)},Jft.prototype.unionUsingEnvelopeIntersection=function(e,n,i){var o=new Plt,s=this.extractByEnvelope(i,e,o),a=this.extractByEnvelope(i,n,o),h=this.unionActual(s,a);return o.add(h),Yft.combine(o)},Jft.prototype.bufferUnion=function(){if(1===arguments.length){var e=arguments[0];return e.get(0).getFactory().buildGeometry(e).buffer(0)}if(2===arguments.length){var n=arguments[0],i=arguments[1];return n.getFactory().createGeometryCollection([n,i]).buffer(0)}},Jft.prototype.interfaces_=function(){return[]},Jft.prototype.getClass=function(){return Jft},Jft.restrictToPolygons=function(e){if(Eht(e,put))return e;var n=jAt.getPolygons(e);return 1===n.size()?n.get(0):e.getFactory().createMultiPolygon(kut.toPolygonArray(n))},Jft.getGeometry=function(e,n){return n>=e.size()?null:e.get(n)},Jft.union=function(e){return new Jft(e).union()},Kft.STRTREE_NODE_CAPACITY.get=function(){return 4},Object.defineProperties(Jft,Kft);var $ft=function(){};function tdt(){return new edt}function edt(){this.reset()}$ft.prototype.interfaces_=function(){return[]},$ft.prototype.getClass=function(){return $ft},$ft.union=function(e,n){if(e.isEmpty()||n.isEmpty()){if(e.isEmpty()&&n.isEmpty())return Vft.createEmptyResult(Vft.UNION,e,n,e.getFactory());if(e.isEmpty())return n.copy();if(n.isEmpty())return e.copy()}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(n),wft.overlayOp(e,n,Vft.UNION)},edt.prototype={constructor:edt,reset:function(){this.s=this.t=0},add:function(e){idt(ndt,e,this.t),idt(this,ndt.s,this.s),this.s?this.t+=ndt.t:this.s=ndt.t},valueOf:function(){return this.s}};var ndt=new edt;function idt(e,n,i){var o=e.s=n+i,s=o-n;e.t=n-(o-s)+(i-s)}var rdt=1e-6,odt=Math.PI,sdt=odt/2,adt=odt/4,hdt=2*odt,ldt=180/odt,udt=odt/180,cdt=Math.abs,Adt=Math.atan,fdt=Math.atan2,ddt=Math.cos,pdt=Math.sin,gdt=Math.sqrt;function mdt(e){return e>1?0:e<-1?odt:Math.acos(e)}function ydt(e){return e>1?sdt:e<-1?-sdt:Math.asin(e)}function vdt(){}function _dt(e,n){e&&Cdt.hasOwnProperty(e.type)&&Cdt[e.type](e,n)}var xdt,bdt,wdt={Feature:function(e,n){_dt(e.geometry,n)},FeatureCollection:function(e,n){for(var i=e.features,o=-1,s=i.length;++o<s;)_dt(i[o].geometry,n)}},Cdt={Sphere:function(e,n){n.sphere()},Point:function(e,n){n.point((e=e.coordinates)[0],e[1],e[2])},MultiPoint:function(e,n){for(var i=e.coordinates,o=-1,s=i.length;++o<s;)n.point((e=i[o])[0],e[1],e[2])},LineString:function(e,n){Pdt(e.coordinates,n,0)},MultiLineString:function(e,n){for(var i=e.coordinates,o=-1,s=i.length;++o<s;)Pdt(i[o],n,0)},Polygon:function(e,n){Mdt(e.coordinates,n)},MultiPolygon:function(e,n){for(var i=e.coordinates,o=-1,s=i.length;++o<s;)Mdt(i[o],n)},GeometryCollection:function(e,n){for(var i=e.geometries,o=-1,s=i.length;++o<s;)_dt(i[o],n)}};function Pdt(e,n,i){var o,s=-1,a=e.length-i;for(n.lineStart();++s<a;)n.point((o=e[s])[0],o[1],o[2]);n.lineEnd()}function Mdt(e,n){var i=-1,o=e.length;for(n.polygonStart();++i<o;)Pdt(e[i],n,1);n.polygonEnd()}function Tdt(e){return[fdt(e[1],e[0]),ydt(e[2])]}function Sdt(e){var n=e[0],i=e[1],o=ddt(i);return[o*ddt(n),o*pdt(n),pdt(i)]}function Idt(e,n){return e[0]*n[0]+e[1]*n[1]+e[2]*n[2]}function Edt(e,n){return[e[1]*n[2]-e[2]*n[1],e[2]*n[0]-e[0]*n[2],e[0]*n[1]-e[1]*n[0]]}function Odt(e,n){e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]}function Rdt(e,n){return[e[0]*n,e[1]*n,e[2]*n]}function Ddt(e){var n=gdt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=n,e[1]/=n,e[2]/=n}function kdt(e,n){function i(i,o){return i=e(i,o),n(i[0],i[1])}return e.invert&&n.invert&&(i.invert=function(i,o){return(i=n.invert(i,o))&&e.invert(i[0],i[1])}),i}function Ldt(e,n){return[e>odt?e-hdt:e<-odt?e+hdt:e,n]}function Fdt(e){return function(n,i){return[(n+=e)>odt?n-hdt:n<-odt?n+hdt:n,i]}}function Ndt(e){var n=Fdt(e);return n.invert=Fdt(-e),n}function zdt(e,n){var i=ddt(e),o=pdt(e),s=ddt(n),a=pdt(n);function h(e,n){var h=ddt(n),l=ddt(e)*h,c=pdt(e)*h,A=pdt(n),f=A*i+l*o;return[fdt(c*s-f*a,l*i-A*o),ydt(f*s+c*a)]}return h.invert=function(e,n){var h=ddt(n),l=ddt(e)*h,c=pdt(e)*h,A=pdt(n),f=A*s-c*a;return[fdt(c*s+A*a,l*i+f*o),ydt(f*i-l*o)]},h}function Bdt(e,n){(n=Sdt(n))[0]-=e,Ddt(n);var i=mdt(-n[1]);return((-n[2]<0?-i:i)+hdt-rdt)%hdt}function Hdt(){var e,n=[];return{point:function(n,i){e.push([n,i])},lineStart:function(){n.push(e=[])},lineEnd:vdt,rejoin:function(){n.length>1&&n.push(n.pop().concat(n.shift()))},result:function(){var i=n;return n=[],e=null,i}}}function jdt(e,n){return cdt(e[0]-n[0])<rdt&&cdt(e[1]-n[1])<rdt}function Udt(e,n,i,o){this.x=e,this.z=n,this.o=i,this.e=o,this.v=!1,this.n=this.p=null}function Gdt(e,n,i,o,s){var a,h,l=[],c=[];if(e.forEach((function(e){if(!((n=e.length-1)<=0)){var n,i,o=e[0],h=e[n];if(jdt(o,h)){for(s.lineStart(),a=0;a<n;++a)s.point((o=e[a])[0],o[1]);s.lineEnd()}else l.push(i=new Udt(o,e,null,!0)),c.push(i.o=new Udt(o,null,i,!1)),l.push(i=new Udt(h,e,null,!1)),c.push(i.o=new Udt(h,null,i,!0))}})),l.length){for(c.sort(n),Vdt(l),Vdt(c),a=0,h=c.length;a<h;++a)c[a].e=i=!i;for(var A,f,d=l[0];;){for(var p=d,g=!0;p.v;)if((p=p.n)===d)return;A=p.z,s.lineStart();do{if(p.v=p.o.v=!0,p.e){if(g)for(a=0,h=A.length;a<h;++a)s.point((f=A[a])[0],f[1]);else o(p.x,p.n.x,1,s);p=p.n}else{if(g)for(a=(A=p.p.z).length-1;a>=0;--a)s.point((f=A[a])[0],f[1]);else o(p.x,p.p.x,-1,s);p=p.p}A=(p=p.o).z,g=!g}while(!p.v);s.lineEnd()}}}function Vdt(e){if(n=e.length){for(var n,i,o=0,s=e[0];++o<n;)s.n=i=e[o],i.p=s,s=i;s.n=i=e[0],i.p=s}}function Wdt(e,n){return e<n?-1:e>n?1:e>=n?0:NaN}function qdt(e){for(var n,i,o,s=e.length,a=-1,h=0;++a<s;)h+=e[a].length;for(i=new Array(h);--s>=0;)for(n=(o=e[s]).length;--n>=0;)i[--h]=o[n];return i}tdt(),tdt(),tdt(),Ldt.invert=Ldt,1===(xdt=Wdt).length&&(bdt=xdt,xdt=function(e,n){return Wdt(bdt(e),n)});var Zdt=1e9,Qdt=-Zdt;var Xdt=tdt();function Ydt(e){return e}tdt(),tdt(),tdt();var Jdt=1/0,Kdt=Jdt,$dt=-Jdt,tpt=$dt,ept={point:function(e,n){e<Jdt&&(Jdt=e),e>$dt&&($dt=e),n<Kdt&&(Kdt=n),n>tpt&&(tpt=n)},lineStart:vdt,lineEnd:vdt,polygonStart:vdt,polygonEnd:vdt,result:function(){var e=[[Jdt,Kdt],[$dt,tpt]];return $dt=tpt=-(Kdt=Jdt=1/0),e}};function npt(e,n,i,o){return function(s,a){var h,l,c,A=n(a),f=s.invert(o[0],o[1]),d=Hdt(),p=n(d),g=!1,v={point:w,lineStart:P,lineEnd:T,polygonStart:function(){v.point=S,v.lineStart=I,v.lineEnd=E,l=[],h=[]},polygonEnd:function(){v.point=w,v.lineStart=P,v.lineEnd=T,l=qdt(l);var e=function(e,n){var i=n[0],o=n[1],s=[pdt(i),-ddt(i),0],a=0,h=0;Xdt.reset();for(var l=0,c=e.length;l<c;++l)if(f=(A=e[l]).length)for(var A,f,d=A[f-1],p=d[0],g=d[1]/2+adt,v=pdt(g),w=ddt(g),C=0;C<f;++C,p=T,v=I,w=E,d=P){var P=A[C],T=P[0],S=P[1]/2+adt,I=pdt(S),E=ddt(S),O=T-p,k=O>=0?1:-1,L=k*O,F=L>odt,N=v*I;if(Xdt.add(fdt(N*k*pdt(L),w*E+N*ddt(L))),a+=F?O+k*hdt:O,F^p>=i^T>=i){var z=Edt(Sdt(d),Sdt(P));Ddt(z);var H=Edt(s,z);Ddt(H);var j=(F^O>=0?-1:1)*ydt(H[2]);(o>j||o===j&&(z[0]||z[1]))&&(h+=F^O>=0?1:-1)}}return(a<-rdt||a<rdt&&Xdt<-rdt)^1&h}(h,f);l.length?(g||(a.polygonStart(),g=!0),Gdt(l,rpt,e,i,a)):e&&(g||(a.polygonStart(),g=!0),a.lineStart(),i(null,null,1,a),a.lineEnd()),g&&(a.polygonEnd(),g=!1),l=h=null},sphere:function(){a.polygonStart(),a.lineStart(),i(null,null,1,a),a.lineEnd(),a.polygonEnd()}};function w(n,i){var o=s(n,i);e(n=o[0],i=o[1])&&a.point(n,i)}function C(e,n){var i=s(e,n);A.point(i[0],i[1])}function P(){v.point=C,A.lineStart()}function T(){v.point=w,A.lineEnd()}function S(e,n){c.push([e,n]);var i=s(e,n);p.point(i[0],i[1])}function I(){p.lineStart(),c=[]}function E(){S(c[0][0],c[0][1]),p.lineEnd();var e,n,i,o,s=p.clean(),A=d.result(),f=A.length;if(c.pop(),h.push(c),c=null,f)if(1&s){if((n=(i=A[0]).length-1)>0){for(g||(a.polygonStart(),g=!0),a.lineStart(),e=0;e<n;++e)a.point((o=i[e])[0],o[1]);a.lineEnd()}}else f>1&&2&s&&A.push(A.pop().concat(A.shift())),l.push(A.filter(ipt))}return v}}function ipt(e){return e.length>1}function rpt(e,n){return((e=e.x)[0]<0?e[1]-sdt-rdt:sdt-e[1])-((n=n.x)[0]<0?n[1]-sdt-rdt:sdt-n[1])}tdt();var opt=npt((function(){return!0}),(function(e){var n,i=NaN,o=NaN,s=NaN;return{lineStart:function(){e.lineStart(),n=1},point:function(a,h){var l=a>0?odt:-odt,c=cdt(a-i);cdt(c-odt)<rdt?(e.point(i,o=(o+h)/2>0?sdt:-sdt),e.point(s,o),e.lineEnd(),e.lineStart(),e.point(l,o),e.point(a,o),n=0):s!==l&&c>=odt&&(cdt(i-s)<rdt&&(i-=s*rdt),cdt(a-l)<rdt&&(a-=l*rdt),o=function(e,n,i,o){var s,a,h=pdt(e-i);return cdt(h)>rdt?Adt((pdt(n)*(a=ddt(o))*pdt(i)-pdt(o)*(s=ddt(n))*pdt(e))/(s*a*h)):(n+o)/2}(i,o,a,h),e.point(s,o),e.lineEnd(),e.lineStart(),e.point(l,o),n=0),e.point(i=a,o=h),s=l},lineEnd:function(){e.lineEnd(),i=o=NaN},clean:function(){return 2-n}}}),(function(e,n,i,o){var s;if(null==e)o.point(-odt,s=i*sdt),o.point(0,s),o.point(odt,s),o.point(odt,0),o.point(odt,-s),o.point(0,-s),o.point(-odt,-s),o.point(-odt,0),o.point(-odt,s);else if(cdt(e[0]-n[0])>rdt){var a=e[0]<n[0]?odt:-odt;o.point(-a,s=i*a/2),o.point(0,s),o.point(a,s)}else o.point(n[0],n[1])}),[-odt,-sdt]);function spt(e){return function(n){var i=new apt;for(var o in e)i[o]=e[o];return i.stream=n,i}}function apt(){}function hpt(e,n,i){var o=n[1][0]-n[0][0],s=n[1][1]-n[0][1],a=e.clipExtent&&e.clipExtent();e.scale(150).translate([0,0]),null!=a&&e.clipExtent(null),function(e,n){e&&wdt.hasOwnProperty(e.type)?wdt[e.type](e,n):_dt(e,n)}(i,e.stream(ept));var h=ept.result(),l=Math.min(o/(h[1][0]-h[0][0]),s/(h[1][1]-h[0][1])),c=+n[0][0]+(o-l*(h[1][0]+h[0][0]))/2,A=+n[0][1]+(s-l*(h[1][1]+h[0][1]))/2;return null!=a&&e.clipExtent(a),e.scale(150*l).translate([c,A])}apt.prototype={constructor:apt,point:function(e,n){this.stream.point(e,n)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var lpt=16,upt=ddt(30*udt);function cpt(e,n){return+n?function(e,n){function i(o,s,a,h,l,c,A,f,d,p,g,v,w,C){var P=A-o,T=f-s,S=P*P+T*T;if(S>4*n&&w--){var I=h+p,E=l+g,O=c+v,k=gdt(I*I+E*E+O*O),L=ydt(O/=k),F=cdt(cdt(O)-1)<rdt||cdt(a-d)<rdt?(a+d)/2:fdt(E,I),N=e(F,L),z=N[0],H=N[1],j=z-o,W=H-s,q=T*j-P*W;(q*q/S>n||cdt((P*j+T*W)/S-.5)>.3||h*p+l*g+c*v<upt)&&(i(o,s,a,h,l,c,z,H,F,I/=k,E/=k,O,w,C),C.point(z,H),i(z,H,F,I,E,O,A,f,d,p,g,v,w,C))}}return function(n){var o,s,a,h,l,c,A,f,d,p,g,v,w={point:C,lineStart:P,lineEnd:S,polygonStart:function(){n.polygonStart(),w.lineStart=I},polygonEnd:function(){n.polygonEnd(),w.lineStart=P}};function C(i,o){i=e(i,o),n.point(i[0],i[1])}function P(){f=NaN,w.point=T,n.lineStart()}function T(o,s){var a=Sdt([o,s]),h=e(o,s);i(f,d,A,p,g,v,f=h[0],d=h[1],A=o,p=a[0],g=a[1],v=a[2],lpt,n),n.point(f,d)}function S(){w.point=C,n.lineEnd()}function I(){P(),w.point=E,w.lineEnd=O}function E(e,n){T(o=e,n),s=f,a=d,h=p,l=g,c=v,w.point=T}function O(){i(f,d,A,p,g,v,s,a,o,h,l,c,lpt,n),w.lineEnd=S,S()}return w}}(e,n):function(e){return spt({point:function(n,i){n=e(n,i),this.stream.point(n[0],n[1])}})}(e)}var Apt=spt({point:function(e,n){this.stream.point(e*udt,n*udt)}});function fpt(e){return function(e){var n,i,o,s,a,h,l,c,A,f,d=150,p=480,g=250,v=0,w=0,C=0,P=0,T=0,S=null,I=opt,E=null,O=Ydt,k=.5,L=cpt(z,k);function F(e){return[(e=a(e[0]*udt,e[1]*udt))[0]*d+i,o-e[1]*d]}function N(e){return(e=a.invert((e[0]-i)/d,(o-e[1])/d))&&[e[0]*ldt,e[1]*ldt]}function z(e,s){return[(e=n(e,s))[0]*d+i,o-e[1]*d]}function H(){a=kdt(s=function(e,n,i){return(e%=hdt)?n||i?kdt(Ndt(e),zdt(n,i)):Ndt(e):n||i?zdt(n,i):Ldt}(C,P,T),n);var e=n(v,w);return i=p-e[0]*d,o=g+e[1]*d,j()}function j(){return A=f=null,F}return F.stream=function(e){return A&&f===e?A:A=Apt(I(s,L(O(f=e))))},F.clipAngle=function(e){return arguments.length?(I=+e?function(e,n){var i=ddt(e),o=i>0,s=cdt(i)>rdt;function a(e,n){return ddt(e)*ddt(n)>i}function h(e,n,o){var s=[1,0,0],a=Edt(Sdt(e),Sdt(n)),h=Idt(a,a),l=a[0],c=h-l*l;if(!c)return!o&&e;var A=i*h/c,f=-i*l/c,d=Edt(s,a),p=Rdt(s,A);Odt(p,Rdt(a,f));var g=d,v=Idt(p,g),w=Idt(g,g),C=v*v-w*(Idt(p,p)-1);if(!(C<0)){var P=gdt(C),T=Rdt(g,(-v-P)/w);if(Odt(T,p),T=Tdt(T),!o)return T;var S,I=e[0],E=n[0],O=e[1],k=n[1];E<I&&(S=I,I=E,E=S);var L=E-I,F=cdt(L-odt)<rdt;if(!F&&k<O&&(S=O,O=k,k=S),F||L<rdt?F?O+k>0^T[1]<(cdt(T[0]-I)<rdt?O:k):O<=T[1]&&T[1]<=k:L>odt^(I<=T[0]&&T[0]<=E)){var N=Rdt(g,(-v+P)/w);return Odt(N,p),[T,Tdt(N)]}}}function l(n,i){var s=o?e:odt-e,a=0;return n<-s?a|=1:n>s&&(a|=2),i<-s?a|=4:i>s&&(a|=8),a}return npt(a,(function(e){var n,i,c,A,f;return{lineStart:function(){A=c=!1,f=1},point:function(d,p){var g,v=[d,p],w=a(d,p),C=o?w?0:l(d,p):w?l(d+(d<0?odt:-odt),p):0;if(!n&&(A=c=w)&&e.lineStart(),w!==c&&(!(g=h(n,v))||jdt(n,g)||jdt(v,g))&&(v[0]+=rdt,v[1]+=rdt,w=a(v[0],v[1])),w!==c)f=0,w?(e.lineStart(),g=h(v,n),e.point(g[0],g[1])):(g=h(n,v),e.point(g[0],g[1]),e.lineEnd()),n=g;else if(s&&n&&o^w){var P;C&i||!(P=h(v,n,!0))||(f=0,o?(e.lineStart(),e.point(P[0][0],P[0][1]),e.point(P[1][0],P[1][1]),e.lineEnd()):(e.point(P[1][0],P[1][1]),e.lineEnd(),e.lineStart(),e.point(P[0][0],P[0][1])))}!w||n&&jdt(n,v)||e.point(v[0],v[1]),n=v,c=w,i=C},lineEnd:function(){c&&e.lineEnd(),n=null},clean:function(){return f|(A&&c)<<1}}}),(function(i,o,s,a){!function(e,n,i,o,s,a){if(i){var h=ddt(n),l=pdt(n),c=o*i;null==s?(s=n+o*hdt,a=n-c/2):(s=Bdt(h,s),a=Bdt(h,a),(o>0?s<a:s>a)&&(s+=o*hdt));for(var A,f=s;o>0?f>a:f<a;f-=c)A=Tdt([h,-l*ddt(f),-l*pdt(f)]),e.point(A[0],A[1])}}(a,e,n,s,i,o)}),o?[0,-e]:[-odt,e-odt])}(S=e*udt,6*udt):(S=null,opt),j()):S*ldt},F.clipExtent=function(e){return arguments.length?(O=null==e?(E=h=l=c=null,Ydt):function(e,n,i,o){function s(s,a){return e<=s&&s<=i&&n<=a&&a<=o}function a(s,a,l,A){var f=0,d=0;if(null==s||(f=h(s,l))!==(d=h(a,l))||c(s,a)<0^l>0)do{A.point(0===f||3===f?e:i,f>1?o:n)}while((f=(f+l+4)%4)!==d);else A.point(a[0],a[1])}function h(o,s){return cdt(o[0]-e)<rdt?s>0?0:3:cdt(o[0]-i)<rdt?s>0?2:1:cdt(o[1]-n)<rdt?s>0?1:0:s>0?3:2}function l(e,n){return c(e.x,n.x)}function c(e,n){var i=h(e,1),o=h(n,1);return i!==o?i-o:0===i?n[1]-e[1]:1===i?e[0]-n[0]:2===i?e[1]-n[1]:n[0]-e[0]}return function(h){var c,A,f,d,p,g,v,w,C,P,T,S=h,I=Hdt(),E={point:O,lineStart:function(){E.point=k,A&&A.push(f=[]),P=!0,C=!1,v=w=NaN},lineEnd:function(){c&&(k(d,p),g&&C&&I.rejoin(),c.push(I.result())),E.point=O,C&&S.lineEnd()},polygonStart:function(){S=I,c=[],A=[],T=!0},polygonEnd:function(){var n=function(){for(var n=0,i=0,s=A.length;i<s;++i)for(var a,h,l=A[i],c=1,f=l.length,d=l[0],p=d[0],g=d[1];c<f;++c)a=p,h=g,p=(d=l[c])[0],g=d[1],h<=o?g>o&&(p-a)*(o-h)>(g-h)*(e-a)&&++n:g<=o&&(p-a)*(o-h)<(g-h)*(e-a)&&--n;return n}(),i=T&&n,s=(c=qdt(c)).length;(i||s)&&(h.polygonStart(),i&&(h.lineStart(),a(null,null,1,h),h.lineEnd()),s&&Gdt(c,l,n,a,h),h.polygonEnd()),S=h,c=A=f=null}};function O(e,n){s(e,n)&&S.point(e,n)}function k(a,h){var l=s(a,h);if(A&&f.push([a,h]),P)d=a,p=h,g=l,P=!1,l&&(S.lineStart(),S.point(a,h));else if(l&&C)S.point(a,h);else{var c=[v=Math.max(Qdt,Math.min(Zdt,v)),w=Math.max(Qdt,Math.min(Zdt,w))],I=[a=Math.max(Qdt,Math.min(Zdt,a)),h=Math.max(Qdt,Math.min(Zdt,h))];!function(e,n,i,o,s,a){var h,l=e[0],c=e[1],A=0,f=1,d=n[0]-l,p=n[1]-c;if(h=i-l,d||!(h>0)){if(h/=d,d<0){if(h<A)return;h<f&&(f=h)}else if(d>0){if(h>f)return;h>A&&(A=h)}if(h=s-l,d||!(h<0)){if(h/=d,d<0){if(h>f)return;h>A&&(A=h)}else if(d>0){if(h<A)return;h<f&&(f=h)}if(h=o-c,p||!(h>0)){if(h/=p,p<0){if(h<A)return;h<f&&(f=h)}else if(p>0){if(h>f)return;h>A&&(A=h)}if(h=a-c,p||!(h<0)){if(h/=p,p<0){if(h>f)return;h>A&&(A=h)}else if(p>0){if(h<A)return;h<f&&(f=h)}return A>0&&(e[0]=l+A*d,e[1]=c+A*p),f<1&&(n[0]=l+f*d,n[1]=c+f*p),!0}}}}}(c,I,e,n,i,o)?l&&(S.lineStart(),S.point(a,h),T=!1):(C||(S.lineStart(),S.point(c[0],c[1])),S.point(I[0],I[1]),l||S.lineEnd(),T=!1)}v=a,w=h,C=l}return E}}(E=+e[0][0],h=+e[0][1],l=+e[1][0],c=+e[1][1]),j()):null==E?null:[[E,h],[l,c]]},F.scale=function(e){return arguments.length?(d=+e,H()):d},F.translate=function(e){return arguments.length?(p=+e[0],g=+e[1],H()):[p,g]},F.center=function(e){return arguments.length?(v=e[0]%360*udt,w=e[1]%360*udt,H()):[v*ldt,w*ldt]},F.rotate=function(e){return arguments.length?(C=e[0]%360*udt,P=e[1]%360*udt,T=e.length>2?e[2]%360*udt:0,H()):[C*ldt,P*ldt,T*ldt]},F.precision=function(e){return arguments.length?(L=cpt(z,k=e*e),j()):gdt(k)},F.fitExtent=function(e,n){return hpt(F,e,n)},F.fitSize=function(e,n){return function(e,n,i){return hpt(e,[[0,0],n],i)}(F,e,n)},function(){return n=e.apply(this,arguments),F.invert=n.invert&&N,H()}}((function(){return e}))()}function dpt(e){return function(n,i){var o=ddt(n),s=ddt(i),a=e(o*s);return[a*s*pdt(n),a*pdt(i)]}}function ppt(e){return function(n,i){var o=gdt(n*n+i*i),s=e(o),a=pdt(s),h=ddt(s);return[fdt(n*a,o*h),ydt(o&&i*a/o)]}}dpt((function(e){return gdt(2/(1+e))})).invert=ppt((function(e){return 2*ydt(e/2)}));var gpt=dpt((function(e){return(e=mdt(e))&&e/pdt(e)}));function mpt(e,n){return[e,n]}function ypt(e,n,i,o){var s=e.properties||{},a="Feature"===e.type?e.geometry:e;if("GeometryCollection"===a.type){var h=[];return dht(e,(function(e){var s=ypt(e,n,i,o);s&&h.push(s)})),eht(h)}var l=function(e){var n=function(e,n){void 0===n&&(n={});var i=pht(e);return $at([(i[0]+i[2])/2,(i[1]+i[3])/2],n.properties,n)}(e).geometry.coordinates,i=[-n[0],-n[1]];return fpt(gpt).scale(79.4188).clipAngle(179.999).rotate(i).scale(Yat)}(a),c={type:a.type,coordinates:_pt(a.coordinates,l)},A=(new Hut).read(c),f=nht(iht(n,i),"meters"),d=DAt.bufferOp(A,f,o);if(!vpt((d=(new jut).write(d)).coordinates))return Kat({type:d.type,coordinates:xpt(d.coordinates,l)},s)}function vpt(e){return Array.isArray(e[0])?vpt(e[0]):isNaN(e[0])}function _pt(e,n){return"object"!=typeof e[0]?n(e):e.map((function(e){return _pt(e,n)}))}function xpt(e,n){return"object"!=typeof e[0]?n.invert(e):e.map((function(e){return xpt(e,n)}))}gpt.invert=ppt((function(e){return e})),mpt.invert=mpt;const bpt=[.8451,.2588,.4863],wpt=[],Cpt=[],Ppt=[];const Mpt=[.8,.1,.1];class go extends Ad{constructor(e){super(e),this.on("enable",this.Du,this),this.on("disable",this.Iu,this),this.bu=[]}addTo(e){return e&&(super.addTo(e),this.Mu=e,this.zu()),this}zu(){this.Mu.getLayer(An+"drawtool").hide()}Du(){this.on("drawstart",this.du,this).on("drawvertex",this.xu,this).on("mousemove",this.mu,this).on("drawend",this.yu,this)}Iu(){this.off("drawstart",this.du,this).off("drawvertex",this.xu,this).off("mousemove",this.mu,this).off("drawend",this.yu,this)}pu(e){const{coordinate:n,containerPoint:i}=e,o=this.Mu.getLayers((e=>e.queryTerrainAtPoint))[0];if(!o)return n.z=n.z||0,n;const s=o.identify(n,{includeInternals:!1})[0];let a=null;if(s&&s.coordinate?a=new Zh(s.coordinate):(n.z=n.z||0,a=n),o.getTerrainLayer()){const e=o.queryTerrainAtPoint(i);return e&&e.z>a.z?e:a}return a}du(e){const n=this.pu(e);n&&(this.Lu=!0,this.bu.push(n),this.Tu(n))}xu(e){const n=this.pu(e);n&&(this.Lu=!0,this.bu[this.bu.length-1]=n,this.Ou())}mu(e){const n=this.pu(e);n&&(this.Lu?this.bu.push(n):this.bu[this.bu.length-1]=n,this.Ou(),this.Lu=!1)}yu(e){const n=this.pu(e);n&&(this.bu.push(n),this.Fu())}Fu(){this.Ou(),this.bu=[],this.et=null,this.xn=null}remove(){this.Uu&&this.Uu.remove(),this.Eu&&this.Eu.remove()}clear(){this.Uu&&this.Uu.clear(),this.Eu&&this.Eu.clear()}}go.mergeOptions({mode:"LineString",language:"zh-CN",metric:!0,imperial:!1,once:!0,symbol:{lineColor:"#e8542b",lineWidth:2,polygonFill:"#eee",polygonOpacity:.5},vertexSymbol:{markerType:"ellipse",markerFill:"#e8542b",markerLineColor:"#fff",markerLineWidth:2,markerWidth:10,markerHeight:10,markerDy:0},labelSymbol:{boxStyle:{padding:[15,6],verticalAlignment:"top",horizontalAlignment:"left",minWidth:150,minHeight:30,symbol:{markerType:"square",markerFill:"rgb(60, 60, 60)",markerFillOpacity:.8,markerLineColor:"#fff",markerLineWidth:2,textDx:-110}},textSymbol:{textFill:"#fff",textSize:16,textVerticalAlignment:"top"}}});const Tpt=[["","",""],["spatial distance","vertical height","horizontal distance"]];"undefined"!=typeof console&&console.log("@maptalks/analysis v0.98.3"),"undefined"!=typeof window&&(window.maptalksgl=window.maptalksgl||{},window.maptalksgl.transcoders=window.maptalksgl.transcoders||fD),e.AEMarker=class Qt extends J1{constructor(e,n){super(e,n);const i=Yo.extend({},_2,this.options.symbol);this.setSymbol(i);const o=Yo.extend({},x2,this.options.symbol.uniforms);this.setUniforms(o)}},e.Ajax=rr,e.ArcConnectorLine=ed,e.ArcCurve=Hf,e.Area3DTool=class Io extends go{zu(){super.zu(),this.Uu=new ad(An+"_area3dtool",{enableAltitude:!0}).addTo(this.Mu),this.Eu=new ad(An+"_area3dtool_marker",{enableAltitude:!0}).addTo(this.Mu)}Ou(){const e=this.Bu(this.bu);this.et.setCoordinates(e),this.ku.setCoordinates(e);const n=this.Eu.getGeometries(),i=this.Uu.getGeometries().length;for(let e=0;e<n.length;e++){const o=n[e].getId();o!=="label"+i&&o.indexOf(`${i}_`)>-1&&n[e].remove()}for(let e=0;e<this.bu.length;e++)new pf(this.bu[e],{id:i+"_"+e,symbol:this.options.vertexSymbol}).addTo(this.Eu);this.Nu()}Bu(e){const n=e.map((e=>e));return e.length>2&&n.push(e[0]),n}Nu(){const e=this.getMeasureResult(),n=("zh-CN"!==this.options.language?"area: ":": ")+this.ju(e),i=this.bu[this.bu.length-1],o=this.Uu.getGeometries().length,s=Yo.extend({id:"label"+o},this.options.labelSymbol);this.xn?(this.xn.setContent(n),this.xn.setCoordinates(i)):this.xn=new Xf(n,i,s).addTo(this.Eu)}ju(e){let n;n="zh-CN"===this.options.language?[" "," "," "," "]:[" sq.m"," sq.km"," sq.ft"," sq.mi"];let i="";if(this.options.metric&&(this.Qu=e<1e6?e.toFixed(2):(e/1e6).toFixed(2),this.Su=e<1e6?n[0]:n[1]),this.options.imperial){i.length>0&&(i+="\n");const o=27878400;this.Qu=(e*=3.2808399)<o?e.toFixed(2):(e/o).toFixed(2),this.Su=e<o?n[2]:n[3]}return i+=this.Qu+this.Su,i}Tu(e){this.et||(this.et=new mf([e],{symbol:this.options.symbol}).addTo(this.Uu),this.ku=new Af([e])),this.Ou(),this.Lu=!0}getMeasureResult(){return this.ku.getArea()}},e.AreaTool=jd,e.B3DMLoader=V0,e.BBOXUtil=ws,e.BoxInsideClipMask=BoxInsideClipper,e.BoxOutsideClipMask=BoxOutsideClipper,e.Browser=wt,e.CMPTLoader=class rs{constructor(e,n,i,o){this.Re=i,this.Dn=e,this.Fn=n||zy,this.Gn=o}load(e,n,i=0,o=0,s){return n?this.zn(e,n,i,o,s):yy.getArrayBuffer(e,{}).then((n=>this.zn(e,n.data,i,o)))}zn(e,n,i,o,s){o||(o=n.byteLength);const a=this.Qn(n,e,i,o),h=[];for(let i=0;i<a.length;i++){let o;if("b3dm"===a[i].magic)o=new V0(this.Dn,this.Fn,this.Re);else if("i3dm"===a[i].magic)o=new W0(this.Dn,this.Fn,this.Re,this.Gn);else if("pnts"===a[i].magic)o=new X0;else{if("cmpt"!==a[i].magic){console.warn("Unsupported magic in CMPT tile:",a[i].magic);continue}o=new rs(this.Dn,this.Fn,this.Re,this.Gn)}h.push(o.load(e,n,a[i].offset,a[i].byteLength,s).then((e=>e)))}return Promise.all(h).then((e=>({magic:"cmpt",tiles:e})))}Qn(e,n,i,o){const s=new DataView(e,i,o),a=s.getUint32(4,!0);if(1!==a){const e="Unsupported cmpt version: "+a+", url:"+n;return console.warn(e),{error:e}}if(16===s.byteLength)return[];const h=[],l=s.getUint32(12,!0);let c=16;for(let n=0;n<l;n++){const n=gJ(s,c),o=s.getUint32(c+8,!0);h.push({magic:n,buffer:e,offset:c+i,byteLength:o}),c+=o}return h}},e.COLOR_PROPERTIES=bn,e.CRS=Qh,e.Canvas=_h,e.CanvasLayer=Eg,e.CanvasTileLayer=rg,e.Circle=Df,e.Class=Ih,e.ClipInsideMask=ClipInsideMask,e.ClipOutsideMask=ClipOutsideMask,e.CollisionIndex=eh,e.ColorMask=ColorMask,e.ConnectorLine=$f,e.ContextUtil=bO,e.Coordinate=Zh,e.CrossCutAnalysis=class lo extends x{constructor(e){super(e),this.type="crosscutAnalysis",this.$=!0}YA(){const e=this.layer.getMap();this.q={};const{extentMap:n,extentInWorld:i}=this.fu(this.options.cutLine);this.q.extent=i,this.q.extentMap=n,this.q.projMatrix=e.projMatrix,this.q.viewMatrix=e.viewMatrix,this.q.minAltitude=0;const o=new mf(this.options.cutLine);this.cu=o.getExtent()}getAltitudes(e){const n=tht(this.options.cutLine);let i=0;for(let e=0;e<this.options.cutLine.length-1;e++)i+=uht(this.options.cutLine[e],this.options.cutLine[e+1]);const o=i/e,s=[],a=[];for(let i=0;i<e;i++){const e=cht(n,o*(i+1));a.push(e.geometry.coordinates)}const h=this.layer.getMap(),l=h.getDevicePixelRatio(),{projViewMatrix:c,projMatrix:A,viewMatrix:f}=this.au(a);for(let e=0;e<a.length;e++){const n=this.vu(a[e],a),i=this.lu(n.x*l,n.y*l,c,A,f);if(!i)continue;const d=h.pointAtResToAltitude(i[2],h.getGLRes()),p=h.pointAtResToCoordinate(new ee(i[0],i[1]),h.getGLRes());s.push({coordinate:new Zh(p.x,p.y,d),distance:o*e})}return s}fu(e){const n=function(e,n,i){var o=(i=i||{}).units||"kilometers",s=i.steps||8;if(!e)throw new Error("geojson is required");if("object"!=typeof i)throw new Error("options must be an object");if("number"!=typeof s)throw new Error("steps must be an number");if(s<=0)throw new Error("steps must be greater than 0");var a=[];switch(e.type){case"GeometryCollection":return dht(e,(function(e){var i=ypt(e,n,o,s);i&&a.push(i)})),eht(a);case"FeatureCollection":return fht(e,(function(e){var i=ypt(e,n,o,s);i&&fht(i,(function(e){e&&a.push(e)}))})),eht(a)}return ypt(e,n,o,s)}(tht(e),.001);return this.V(n.geometry.coordinates[0])}S(e){const n=this.i={x:0,y:0,width:()=>e.canvas?e.canvas.width:1,height:()=>e.canvas?e.canvas.height:1};this.YA(e),this.wu(e);const i=new PC(e.regl);this.B=this.B||new UA(i,n),this.layer.addAnalysis(this)}wu(e){const n=this.layer.getMap();this.pickingFBO=e.canvas.pickingFBO||e.regl.framebuffer(e.canvas.width,e.canvas.height);const i=new PC(e.regl);this.G=new XM(i,{vert:sat,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(e,n){return Cv([],n.projViewMatrix,n.modelMatrix)}}]},this.pickingFBO,n)}au(){if(this.Pu)return this.Pu;const e=this.layer.getMap(),{precenter:n,prezoom:i,prepitch:o,prebearing:s}=this.gu();return _v(wpt,e.projViewMatrix),_v(Cpt,e.projMatrix),_v(Ppt,e.viewMatrix),e.setZoom(i),e.setCenter(n),e.setPitch(o),e.setBearing(s),this.Pu={projViewMatrix:wpt,projMatrix:Cpt,viewMatrix:Ppt},this.Pu}gu(){const e=this.cu,n=this.layer.getMap(),i=n.getCenter(),o=n.getZoom(),s=n.getPitch(),a=n.getBearing(),h=n.getFitZoom(e);return n.setZoom(h),n.setCenter(e.getCenter()),n.setPitch(0),{precenter:i,prezoom:o,prepitch:s,prebearing:a}}vu(e){const{precenter:n,prezoom:i,prepitch:o,prebearing:s}=this.gu(),a=this.layer.getMap(),h=a.coordinateToContainerPoint(new Zh(e));return a.setZoom(i),a.setCenter(n),a.setPitch(o),a.setBearing(s),h}lu(e,n,i,o,s,a={}){if(this.$){if(!this.Cu||0===this.Cu.length)return null;const e=this.Cu;e.forEach((e=>{const n=e.getDefines();n.HAS_PICKING_ID=2,e.setDefines(n),e.setUniform("uPickingId",1)})),this.G.render(e,{projViewMatrix:i,minAltitude:this.q.minAltitude},!0),this.$=!1}const{point:h}=this.G.pick(e,n,a.tolerance||3,{projViewMatrix:i,minAltitude:this.q.minAltitude},{viewMatrix:s,projMatrix:o,returnPoint:!0});return h}update(e,n){if(super.update(e,n),"cutLine"===e){const{extentMap:e,extentInWorld:i}=this.fu(n);this.q.extent=i,this.q.extentMap=e;const o=new mf(this.options.cutLine);this.cu=o.getExtent(),this.$=!0,delete this.Pu}else this.q[e]=n}renderAnalysis(e){const n={};return this.k.render(this.R,this._),n.cutLineColor=this.options.cutLineColor||bpt,n.crosscutMap=this.B.render(e,this.q),this.Cu=e,n}getDefines(){return{HAS_CROSSCUT:1}}},e.CubicBezierCurve=jf,e.Curve=Bf,e.CutAnalysis=class X extends x{constructor(e){super(e),this.type="cut"}update(e,n){if("eyePos"===e||"lookPoint"===e){const i=this.layer.getMap();this.q[e]=nat(i,...n)}else this.q[e]=n;super.update(e,n)}reset(){if(this.B){this.B.SA(this.q.position,this.q.rotation,this.q.scale)}}YA(){const e=this.layer.getMap();this.q={},this.q.position=nat(e,...this.options.position),this.q.rotation=this.options.rotation||[0,0,0],this.q.scale=this.options.scale||[1,1,1],this.q.projViewMatrix=e.projViewMatrix,this.q.minAltitude=0}S(e){const n={x:0,y:0,width:()=>e.canvas?e.canvas.width:1,height:()=>e.canvas?e.canvas.height:1},i=new PC(e.regl);i.canvas=e.canvas,i.parentRenderer=e,this.YA(),this.B=new Z(i,n)||this.B;const o=this.layer.getMap();this.B.QA(o,this.q.position,this.q.rotation,this.q.scale),this.layer.addAnalysis(this),e.setToRedraw()}renderAnalysis(e){const n={};this.q.map=this.layer.getMap();const{meshesMap:i,invisibleMap:o}=this.B.render(e,this.q);return n.meshesMap=i,n.invisibleMap=o,n}getDefines(){return{HAS_CUT:1}}},e.DEFAULT_TEXT_SIZE=wn,e.Distance3DTool=class bo extends go{zu(){super.zu(),this.Uu=new ad(An+"_distance3dtool",{enableAltitude:!0}).addTo(this.Mu),this.Eu=new ad(An+"_distance3dtool_marker",{enableAltitude:!0}).addTo(this.Mu)}Ou(){this.et.setCoordinates(this.bu);const e=this.Eu.getGeometries(),n=this.Uu.getGeometries().length;for(let i=0;i<e.length;i++){const o=e[i].getId();o!=="label"+n&&o.indexOf(`${n}_`)>-1&&e[i].remove()}for(let e=0;e<this.bu.length;e++)new pf(this.bu[e],{id:n+"_"+e,symbol:this.options.vertexSymbol}).addTo(this.Eu);this.Nu()}Nu(){const e=this.getMeasureResult(),n=("zh-CN"!==this.options.language?"distance: ":": ")+this.ju(e),i=this.bu[this.bu.length-1],o=this.Uu.getGeometries().length,s=Yo.extend({id:"label"+o},this.options.labelSymbol);this.xn?(this.xn.setContent(n),this.xn.setCoordinates(i)):this.xn=new Xf(n,i,s).addTo(this.Eu)}ju(e){let n;n="zh-CN"===this.options.language?[" "," "," "," "]:[" m"," km"," feet"," mile"];let i="";return this.options.metric&&(this.Qu=e<1e3?e.toFixed(1):(e/1e3).toFixed(2),this.Su=e<1e3?n[0]:n[1]),this.options.imperial&&(i.length>0&&(i+="\n"),this.Qu=(e*=3.2808399)<5280?e.toFixed(1):(e/5280).toFixed(2),this.Su=e<5280?n[2]:n[3]),i+=this.Qu+this.Su,i}Tu(e){this.et||(this.et=new mf([e],{symbol:this.options.symbol}).addTo(this.Uu)),this.Ou(),this.Lu=!0}getMeasureResult(){return this.et.getLength()}},e.DistanceTool=Hd,e.DomUtil=ir,e.DragHandler=qh,e.DrawTool=Ad,e.EffectLayer=A2,e.EffectLine=class zt extends J1{constructor(e,n){super(e,n);const i=Yo.extend({},p2,this.options.symbol);this.setSymbol(i);const o=Yo.extend({},g2,this.options.symbol.uniforms);this.setUniforms(o),this.setShader("effectline"),this.h="effectmarker"}getEffectType(){return"sequence"}setTexture(e){return this.setUniform("texture",e),this}setHeight(e){return this.setUniform("modelHeight",e),this}setStartOpacity(e){return this.setUniform("startOpacity",e),this}setEndOpacity(e){return this.setUniform("endOpacity",e),this}},e.EffectLineLayer=m2,e.EffectMarker=J1,e.EffectRing=class Zt extends N1{constructor(e,n){super(e,n);const i=Yo.extend({},y2,this.options.symbol.uniforms);this.setUniforms(i),this.setShader("effectring"),this.h="effectring"}},e.EffectRingLayer=v2,e.ElevateMask=ElevateMask,e.Ellipse=Lf,e.Eventable=Th,e.ExcavateAnalysis=FA,e.Extent=al,e.ExtrudePolygonLayer=Qd,e.FillPainter=zl,e.FillPlugin=bZ,e.FilterUtil=tH,e.FlatInsideMask=sD,e.FlatOutsideMask=FlatInsideMask,e.FloodAnalysis=IA,e.GEOJSON_TYPES=mn,e.GEOMETRY_COLLECTION_TYPES=gn,e.GLContext=WT,e.GLTFGeometry=class Pt extends N1{$(e){const n=this.getMap(),i=n.getGLRes(),o=n.distanceToPointAtRes(100,100,i,this.getCenter()),s=n.altitudeToPoint(100,i);return e[0]*=o.x/100,e[1]*=o.y/100,e[2]*=s/100,e}},e.GLTFLayer=n2,e.GLTFLineString=h2,e.GLTFMarker=N1,e.GLTFMercatorGeometry=class Rt extends N1{$(e){const n=this.getMap(),i=n.getGLRes(),o=this.getCoordinates(),s=n.coordToPointAtRes(o,i,o2),a=su.EPSG3857.project(o,i2)._add(1,1),h=su.EPSG3857.unproject(a,r2),l=n.coordToPointAtRes(h,i,s2),c=l.x-s.x,A=l.y-s.y,f=n.altitudeToPoint(100,i);return e[0]*=c,e[1]*=A,e[2]*=f/100,e}},e.GLTFPhongPlugin=RZ,e.GLTFStandardPlugin=DZ,e.Geo3DTilesLayer=k0,e.Geo3DTilesUtil=DY,e.Geo3DTransform=dJ,e.GeoJSON=Rf,e.GeoJSONVectorTileLayer=bf,e.Geometry=_A,e.GeometryCollection=_f,e.GlobalConfig=o,e.GlobalEvent=Oh,e.GlowMarker=f2,e.GlowMarkerLayer=d2,e.GroundPainter=GroundPainter,e.GroupGLLayer=GroupGLLayer,e.GroupTileLayer=$p,e.Handler=Sh,e.Handlerable=Uh,e.HeatmapPlugin=kZ,e.HeatmapProcess=HeatmapProcess,e.Height3DTool=class Do extends go{zu(){super.zu(),this.Eu=new ad(An+"_height3dtool_marker",{enableAltitude:!0}).addTo(this.Mu).bringToFront(),this.Uu=new ad(An+"_height3dtool",{enableAltitude:!0}).addTo(this.Mu).bringToFront()}xu(e){super.xu(e),this.bu.length>1&&(this.Fu(),this.disable())}Ou(){const e=this.Eu.getGeometries(),n=this.Uu.getGeometries().length;for(let i=0;i<e.length;i++){const o=e[i].getId();o!=="label"+n+"_"+i&&0===o.indexOf(`${n}_`)&&e[i].remove()}for(let e=0;e<this.bu.length;e++)new pf(this.bu[e],{id:n+"_"+e,symbol:this.options.vertexSymbol}).addTo(this.Eu);const i=this.bu.length;if(i>1){const e=new Zh([this.bu[i-1].x,this.bu[i-1].y,this.bu[i-2].z]);new pf(e,{id:n+"_2",symbol:this.options.vertexSymbol}).addTo(this.Eu);const o=[].concat(this.bu);o.push(e),o.push(this.bu[0]);const s=o.map((e=>e.z));this.et.setCoordinates(o),this.et.setProperties({altitude:s});const a=this.Mu.getProjection().measureLenBetween(o[0],o[2]),h=o[1].z-o[2].z,l=Math.sqrt(Math.pow(a,2)+Math.pow(h,2));this.Nu(o,[l,h,a])}}Nu(e,n){for(let i=0;i<e.length-1;i++){const o=e[i],s=e[i+1],a="zh-CN"===this.options.language?0:1,h=this.ju(n[i]),l=Tpt[a][i]+":"+h,c="label"+this.Uu.getGeometries().length+"_"+i,A=JSON.parse(JSON.stringify(this.options.labelSymbol));A.id=c,i<2&&(A.boxStyle.symbol.textDx*=-1);const f=1===i?o:new Zh((o.x+s.x)/2,(o.y+s.y)/2,(o.z+s.z)/2),d=this.Eu.getGeometryById(c),p=`${c}_marker`,g=this.Eu.getGeometryById(p);d?(d.setContent(l),d.setCoordinates(f),g.setCoordinates(f)):(new Xf(l,f,A).addTo(this.Eu),new pf(f,{id:p,symbol:this.options.vertexSymbol}).addTo(this.Eu))}}ju(e){let n;n="zh-CN"===this.options.language?[" "," "," "," "]:[" m"," km"," feet"," mile"];let i="";return this.options.metric&&(this.Qu=e<1e3?e.toFixed(1):(e/1e3).toFixed(2),this.Su=e<1e3?n[0]:n[1]),this.options.imperial&&(i.length>0&&(i+="\n"),this.Qu=(e*=3.2808399)<5280?e.toFixed(1):(e/5280).toFixed(2),this.Su=e<5280?n[2]:n[3]),i+=this.Qu+this.Su,i}Tu(e){this.et||(this.et=new mf([e],{symbol:this.options.symbol}).addTo(this.Uu)),this.Ou(),this.Lu=!0}getMeasureResult(){return this.et.getLength()}},e.HeightLimitAnalysis=class Po extends IA{constructor(e){super(e),this.type="heightLimitAnalysis"}YA(e){super.YA(e);const n=this.layer.getMap();this.q.waterHeight=tat(n,this.options.limitHeight),this.q.type=2}update(e,n){if(super.update(e,n),"limitHeight"===e){const e=this.layer.getMap();this.q.waterHeight=e.altitudeToPoint(n||0,e.getGLRes())}}renderAnalysis(e){const n=super.renderAnalysis(e);return n.heightLimitMap=n.floodMap,n.limitColor=this.options.limitColor||Mpt,n}getDefines(){return{HAS_HEIGHTLIMIT:1}}},e.HighlightUtil=rD,e.INTERNAL_LAYER_PREFIX=An,e.IconPainter=YW,e.IconPlugin=PZ,e.ImageLayer=wg,e.InSightAnalysis=class mA extends x{constructor(e){super(e),this.ot=e.lines||[],this.ht=new RayCaster,this.type="insight"}update(e,n){"lines"===e?this.setLines(n):this.q[e]=n,super.update(e,n)}addLine(e){const{from:n,to:i}=e;n&&i&&this.ot.push(e),this.ft()}removeLine(e){const n=this.ot.indexOf(e);n>-1&&this.ot.splice(n,1),this.ft()}getLines(){return this.ot}setLines(e){this.ot=e,this.ft()}clearLines(){this.ot=[],this.ft()}getIntersetction(){const e=[];if(!this.ct)return e;const n=this.layer.getMap();for(let i=0;i<this.ot.length;i++){const{from:o,to:s}=this.ot[i];this.ht.setFromPoint(o),this.ht.setToPoint(s);const a=this.ht.test(this.ct,n);if(a&&a.length){const n={inSightLine:this.ot[i],intersects:[]};a.forEach((e=>{const i=this.vt(e);i&&n.intersects.push(i)})),e.push(n)}}return e}vt(e){const n=[],i=this.layer;if(!i)return n;const{mesh:o,coordinates:s}=e,a=this.getExcludeLayers();return i.getLayers().forEach((e=>{const i=e.getId(),h=e.getRenderer();if(a.indexOf(i)<0&&h&&h.getRayCastData&&s.length){const e=h.getRayCastData(o,s[0].indices[0]);e&&n.push({data:e,coordinates:s})}})),n}ft(){this.YA();const e=this.layer.getRenderer();e&&e.setToRedraw()}YA(){const e=this.layer.getMap();this.q={},this.q.lines=this.ot.map((n=>{const{from:i,to:o}=n;return{from:nat(e,i.x||i[0],i.y||i[1],i.z||i[2]),to:nat(e,o.x||o[0],o.y||o[1],o.z||o[2])}})),this.q.visibleColor=this.options.visibleColor,this.q.invisibleColor=this.options.invisibleColor,this.q.projViewMatrix=e.projViewMatrix,this.q.horizontalAngle=45,this.q.verticalAngle=45,this.q.minAltitude=0}S(e){const n={x:0,y:0,width:()=>e.canvas?e.canvas.width:1,height:()=>e.canvas?e.canvas.height:1};this.YA();const i=new PC(e.regl);this.B=this.B||new xA(i,n),this.layer.addAnalysis(this),e.setToRedraw()}renderAnalysis(e){const n={};this.ct=e;const i=this.B.render(e,this.q);return n.insightMap=i,n.insight_visibleColor=this.q.visibleColor||[0,1,0,1],n.insight_invisibleColor=this.q.invisibleColor||[1,0,0,1],n}getDefines(){return{HAS_INSIGHT:1}}},e.JSONAble=jh,e.LRUCache=Oa,e.Label=Xf,e.Layer=RA,e.LineGradientPlugin=CZ,e.LinePainter=jl,e.LinePlugin=wZ,e.LineString=mf,e.LineStringLayer=Jf,e.LitPlugin=EZ,e.MSDJSONLoader=class r{constructor(e){this.i=e||{}}load(){const e=this.i.data;let n=this.i.basePath;if("string"==typeof(i=e)||null!==i.constructor&&i.constructor===String){const i=this.i.fetchFunction||fetch,o=this.i.fetchOptions;if(!n){const i=e.lastIndexOf("/");n=i<0?"./":e.substring(0,i)}return i(e,o).then((e=>e.json())).then((e=>(this.s(e,n),this)))}return this.s(e,n||"./"),Promise.resolve(this);var i}getMSDJSON(){return Hst(this.h)}getMapJSON(){return Hst(this.t)}getView(){if(!this.t)return null;const{center:e,zoom:n,pitch:i,bearing:o}=this.t;return{center:e,zoom:n,pitch:i,bearing:o}}getLights(){return this.t&&this.t.options.lights}getSceneConfig(){return this.t&&this.t.layers[0].options.sceneConfig}s(e,n){if("./"!==n&&"."!==n){"/"!==n[n.length-1]&&(n+="/"),this.h=e;let i=JSON.stringify(e);i=i.replace(/".\/res/g,'"'+n+"res"),e=JSON.parse(i)}else this.h=Hst(e);this.t=e||{},this.u=function(e){return e.layers?e.layers.map((e=>e?new t(e):null)):[]}(e.layers[0])}getLayer(e){const n=this.u;if(!n)return null;for(let i=0;i<n.length;i++){const o=n[i];if(o&&e===o.getId())return o}return null}getLayers(){return this.u||[]}},e.Map=BA,e.MapTool=ld,e.MapboxUtil=po,e.MapboxVectorTileLayer=vf,e.Marker=pf,e.MaskLayerMixin=uR,e.MaskRendererMixin=LO,e.MicroTask=Ma,e.MultiGLTFMarker=W1,e.MultiLineString=Mf,e.MultiPoint=Cf,e.MultiPolygon=Tf,e.NUMERICAL_PROPERTIES=xn,e.NativeLinePainter=dc,e.NativeLinePlugin=TZ,e.NativePointPainter=uc,e.OverlayLayer=rd,e.PackUtil=Zj,e.ParticleLayer=Rg,e.PhongPainter=kc,e.PhongPlugin=SZ,e.Point=ee,e.PointExtent=ll,e.PointLayer=qf,e.Polygon=Af,e.PolygonLayer=Zf,e.QuadBezierCurve=Uf,e.RESOURCE_PROPERTIES=vn,e.RESOURCE_SIZE_PROPERTIES=_n,e.RayCaster=RayCaster,e.Rectangle=Ff,e.ResourceProxy=Ar,e.SYMBOLS_NEED_REBUILD_IN_VECTOR=tU,e.SYMBOLS_NEED_REBUILD_IN_VT=$j,e.Sector=Nf,e.Size=Cn,e.SkylineAnalysis=class PA extends x{constructor(e){super(e),this.type="skyline"}YA(){const e=this.layer.getMap();this.q={},this.q.lineColor=this.options.lineColor,this.q.lineWidth=this.options.lineWidth,this.q.projViewMatrix=e.projViewMatrix,this.q.minAltitude=0}S(e){const n={x:0,y:0,width:()=>e.canvas?e.canvas.width:1,height:()=>e.canvas?e.canvas.height:1};this.YA(),this.renderer=new PC(e.regl),this.B=new lA(this.renderer,n)||this.B,this.layer.addAnalysis(this),this.At=this.tt(e.regl)}renderAnalysis(e){this.At=this.At||this.tt(this.renderer.regl);const n=this.layer.getMap();this.nt(n);const i={},o=e.concat([this.At]);return this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this.T}),this.T=this.B.render(o,this.q),i.skylineMap=this.T,i}exportSkylineMap(e){if(!Bat||!this.isEnable())return null;e||(e={});const n=this.B.getRenderMeshes(),i=this.exportAnalysisMap(n),o=this.T.width,s=this.T.height,a=new Uint8ClampedArray(i.length);for(let e=0;e<o;e++)for(let n=0;n<s;n++)a[4*(n*o+e)]=i[4*((s-n)*o+e)],a[4*(n*o+e)+1]=i[4*((s-n)*o+e)+1],a[4*(n*o+e)+2]=i[4*((s-n)*o+e)+2],a[4*(n*o+e)+3]=i[4*((s-n)*o+e)+3],0===a[4*(n*o+e)]&&0===a[4*(n*o+e)+1]&&0===a[4*(n*o+e)+2]&&(a[4*(n*o+e)+3]=0);Bat.width=o,Bat.height=s;const h=new ImageData(a,o,s);Bat.getContext("2d").putImageData(h,0,0);const l=Bat.toDataURL();if(e.save){const n=document.createElement("a");n.download=e.filename||"export",n.href=l,document.body.appendChild(n),n.click(),document.body.removeChild(n)}return l}update(e,n){this.q[e]=n,super.update(e,n)}tt(e){const n=new WC;return n.generateBuffers(e),n.data.aTexCoord=new Float32Array(8),new bC(n)}nt(e){const n=GroundPainter.getGroundTransform(this.At.localTransform,e);this.At.setLocalTransform(n)}remove(){super.remove(),this.At&&(this.At.geometry.dispose(),this.At.dispose(),delete this.At)}getDefines(){return{HAS_SKYLINE:1}}},e.SpatialReference=fA,e.StringUtil=vi,e.TextBox=Qf,e.TextMarker=Wf,e.TextPainter=sc,e.TextPlugin=MZ,e.TileConfig=Pp,e.TileLayer=Qp,e.TileSystem=wp,e.TransformControl=Bst,e.Transformation=ul,e.TubePlugin=OZ,e.Util=Yo,e.Vector3DLayer=La,e.VectorLayer=ad,e.VectorTileLayer=Ta,e.VectorTileLayerRenderer=ga,e.VideoLayer=Jst,e.VideoMask=VideoMask,e.VideoSurface=Yst,e.ViewshedAnalysis=class vA extends x{constructor(e){super(e),this.type="viewshed"}update(e,n){if("eyePos"===e||"lookPoint"===e){const i=this.layer.getMap();this.q[e]=nat(i,...n)}else this.q[e]=n;super.update(e,n)}YA(){const e=this.layer.getMap();this.q={},this.q.eyePos=nat(e,...this.options.eyePos),this.q.lookPoint=nat(e,...this.options.lookPoint),this.q.verticalAngle=this.options.verticalAngle,this.q.horizontalAngle=this.options.horizontalAngle,this.q.visibleColor=this.options.visibleColor,this.q.invisibleColor=this.options.invisibleColor,this.q.projViewMatrix=e.projViewMatrix,this.q.minAltitude=0}S(e){const n={x:0,y:0,width:()=>e.canvas?e.canvas.width:1,height:()=>e.canvas?e.canvas.height:1};this.YA();const i=new PC(e.regl);this.B=new aA(i,n)||this.B,this.layer.addAnalysis(this),e.setToRedraw()}renderAnalysis(e){const n={},i=this.B.render(e,this.q);return n.viewshedMap=i,n.viewshed_visibleColor=this.q.visibleColor||[0,1,0,.3],n.viewshed_invisibleColor=this.q.invisibleColor||[1,0,0,.3],n}getVertexCoordinates(){const e=this.layer.getMap();return e?this.B.HA(e):[]}getDefines(){return{HAS_VIEWSHED:1}}},e.WMSTileLayer=ig,e.WaterPlugin=LZ,e.WireframePainter=Tc,e.WireframePlugin=IZ,e.animate=of,e.animation=sf,e.color=WI,e.control=bp,e.createREGL=jm,e.earcut=OT,e.formatResourceUrl=fr,e.getDefaultSpatialReference=function(){return JSON.parse(JSON.stringify(AA))},e.glMatrix=tv,e.gltf=eI,e.mat2=ov,e.mat2d=hv,e.mat3=yv,e.mat4=Qv,e.math=Qs,e.measurer=Ml,e.parseSVG=xr,e.projection=su,e.quat=zx,e.quat2=Vx,e.registerWorkerAdapter=na,e.renderer=Mm,e.reshader=kT,e.symbolizer=zc,e.transcoders=fD,e.ui=lp,e.vec2=pb,e.vec3=P_,e.vec4=tx,e.worker=Nm,"undefined"!=typeof console&&console.log("maptalks-gl v0.103.1")}));
//# sourceMappingURL=maptalks-gl.js.map
